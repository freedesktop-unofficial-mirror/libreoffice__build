AC_INIT(bin/build-ooo)

AC_PREREQ(2.12)

AC_WITH(tag,
[
	--with-tag:	define the tag to use, defaults to the latest
			release; eg. --with-tag=OOO_1_0_3
],,)

AM_INIT_AUTOMAKE(ooo-build, 1.1.30)

AM_MAINTAINER_MODE

AC_PATH_PROG(PKG_CONFIG, pkg-config)
if test "!" -x "$PKG_CONFIG" ; then
   AC_MSG_ERROR([
*** You need the latest pkg-config.
*** Get the latest version of pkg-config from
*** <http://www.freedesktop.org/software/pkgconfig/>.])
fi
AC_SUBST(PKG_CONFIG)

PKG_CHECK_MODULES( FOO, gtk+-2.0 libxml-2.0 gnome-vfs-2.0 )
PKG_CHECK_MODULES( FOO, libgnomecups-1.0 >= 0.1.0 fontconfig >= 1.0.1 )

AC_MSG_CHECKING( for tag )
if test "z$with_tag" = "z"; then
   with_tag=`bin/latest-patchset patches 2>/dev/null`;	
   if test "z$with_tag" = "z"; then
      AC_MSG_ERROR( Can't locate latest patchset )
   fi
fi

if test -f patches/$with_tag/apply; then
   AC_MSG_RESULT( found $with_tag )
else
   AC_MSG_ERROR( Can't locate patch set for: $with_tag )
fi
TAG=$with_tag
AC_SUBST(TAG)

AC_MSG_CHECKING( for tag's source )
if test -f src/$TAG.tar.bz2; then
   AC_MSG_RESULT( found )
else
   AC_MSG_ERROR([

     Missing source $TAG.tar.bz2, please use the
   'download' script to ensure the required source
   is up to date:

	download [[optional-tag]]

])
fi

if test ${TAG:0:3} != 'OOO'; then
   PKG_CHECK_MODULES( FOO, mozilla-xpcom mozilla-nspr )
   PKG_CHECK_MODULES( FOO, libstartup-notification-1.0 )
   PKG_CHECK_MODULES( FOO, libart-2.0 >= 2.3.13 )
fi

dnl
dnl Setup the misc. tweaks we need.
dnl
BASEDIR=`pwd`;
TOOLSDIR=$BASEDIR;
IN_PKG=yes
AC_SUBST(IN_PKG)
AC_SUBST(BASEDIR)
AC_SUBST(TOOLSDIR)

AC_OUTPUT([
Makefile
bin/setup
bin/Makefile
desktop/Makefile
etc/Makefile
patches/Makefile
patches/OOO_1_0_3/Makefile
patches/RC3/Makefile
patches/RC3_030721/Makefile
www/Makefile
www/tinder-scripts/Makefile
])
