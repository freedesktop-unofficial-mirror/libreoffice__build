#!/bin/bash

usage() {
    echo "cws-extract cws_name"
    exit 1;
}

echo "Warning!  This is the SVN version of cws-extract, use
cws-extract-cvs for the older OOo CWSes."

CWS="$1"

[ -n "$CWS" ] || usage

LOG=`mktemp /tmp/cws-extract.XXXXXX`

# log of the branch only
svn log --stop-on-copy "svn+ssh://svn@svn.services.openoffice.org/ooo/cws/$CWS" > "$LOG"

MERGE_BASE=`grep -A 1 '^--------------------------------------' "$LOG" | \
            grep '^r' | tail -n 1 | sed 's/^r\([0-9]*\)[^0-9].*/\1/'`

if [ -n "$MERGE_BASE" ] ; then
    svn diff -r $MERGE_BASE "svn+ssh://svn@svn.services.openoffice.org/ooo/cws/$CWS" > "cws-$CWS.diff"
fi

rm "$LOG"
