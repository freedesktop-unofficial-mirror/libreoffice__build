#!/usr/bin/perl -w

my @output_buffer = ();

sub pure_guff($)
{
  my $array = shift;
  my @lines = @{$array};
  my $contains_sense = '';
  my $contains_guff = '';
  while (scalar @lines)
  {
    my $line = pop @lines;
    if ($line =~ m/\$Revision:/ ||
	$line =~ m/\$Author:/) {
      $contains_guff = '1';
    } elsif ($line =~ m/^[\+\-]/) {
      $contains_sense = '1';
    }
  }
  if ($contains_guff && $contains_sense) {
    die ("Patch fragment with mixed good/bad changes");
  }
#  print "contains guff: $contains_guff\n";
  return $contains_guff;
}

sub output_lines($)
{
  my $array = shift;
  my @lines = @{$array};

  if (pure_guff (\@lines)) {
    return;
  }

  while (scalar @lines)
  {
    my $line = pop @lines;
    push @output_buffer, $line;
  }
}

my $header;
my @lines;
my $frag_count = 0;

while (<>) {
  if (/^\@\@/) {
    output_lines (\@lines);
    @lines = ();
    $frag_count++;
  }
  unshift @lines, $_;
}
output_lines(\@lines);

if ($frag_count > 1) {
  print @output_buffer;
}
