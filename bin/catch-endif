#!/usr/bin/perl -w

while ($file = shift @ARGV) {
    open (File, "$file") || die "Can't open $file\n";
    my $intermediate = $file.".oo.int";
    open (Tmp, ">$intermediate") || die "Can't open $intermediate\n";
    $hit = 0;
    $num = 0;
    while (<File>) {
	$num++;
	if (/^#endif\s+[^\/]/) {
	    print STDERR "Error on line $num of $file\n";
	    $hit = 1;
	    s/^#endif\s+/#endif \/\//;
	}
	print Tmp $_;
    }
    close File;
    close Tmp;
    if ($hit) {
	print "$file\n";
	rename $file, "$file.old";
	rename $intermediate, $file;
    } else {
	unlink $intermediate;
    }
}
