#!/bin/sh

help()
{
	cat<<EOF
Usage: `basename $0` setting=value
where setting is one of:
	--enable-accessibility
	--enable-auto-save
	--enable-create-backup
	--enable-font-anti-aliasing
	--enable-font-history
	--enable-font-preview
	--enable-menu-icons
	--enable-menu-inactive-items
	--enable-opengl
	--enable-optimize-opengl
	--enable-printing
	--enable-printing-modifies-doc
	--enable-recommend-password-on-save
	--enable-remove-personal-info-on-save
	--enable-system-file-dialog
	--enable-system-font
	--enable-ui-customization
	--enable-warn-alien-format
	--enable-warn-info-create-pdf
	--enable-warn-info-printing
	--enable-warn-info-signing
	--enable-warn-info-saving
	--set-auto-save-interval
	--set-calc-default-document
	--set-font-anti-aliasing-min-pixel
	--set-icon-size
	--set-impress-default-document
	--set-macro-security-level
	--set-mailer-program
	--set-proxy-mode
	--set-proxy-http-host
	--set-proxy-http-port
	--set-proxy-ftp-host
	--set-proxy-ftp-port
	--set-undo-steps
	--set-writer-default-document
EOF
}

isdigit()
{
	case $1 in

		*[!0-9]*)
			return 1 ;;

		*)
			return 0 ;;

	esac
}

validate_and_translate()
{
	if [ -z "$1" -o -z "$2" ] ; then
		help
		exit 1
	fi

	case "$1" in

		--enable-printing						| \
		--enable-ui-customization)

			if [ "$2" == "yes" ] ; then
				value=0
			elif [ "$2" == "no" ] ; then
				value=1
			else
				echo "Supported values for $1 are 'yes' or 'no'"
				exit 1
			fi ;;

		--enable-accessibility					| \
		--enable-auto-save						| \
		--enable-create-backup					| \
		--enable-font-anti-aliasing				| \
		--enable-font-history					| \
		--enable-font-preview					| \
		--enable-menu-icons						| \
		--enable-menu-inactive-items			| \
		--enable-opengl							| \
		--enable-optimize-opengl				| \
		--enable-printing-modifies-doc			| \
		--enable-recommend-password-on-save		| \
		--enable-remove-personal-info-on-save	| \
		--enable-system-file-dialog				| \
		--enable-system-font					| \
		--enable-warn-alien-format				| \
		--enable-warn-info-create-pdf			| \
		--enable-warn-info-printing				| \
		--enable-warn-info-signing				| \
		--enable-warn-info-saving)

			if [ "$2" == "yes" ] ; then
				value=1
			elif [ "$2" == "no" ] ; then
				value=0
			else
				echo "Supported values for $1 are 'yes' or 'no'"
				exit 1
			fi ;;

		--set-auto-save-interval)

			if ! isdigit "$2" -o [ "$2" -lt 1 -o "$2" -gt 60 ] ; then
				echo "Supported values for $1 are integers from 1 through 60"
				exit 1
			else
				value=$2
			fi ;;

		--set-font-anti-aliasing-min-pixel | \
		--set-undo-steps)

			if ! isdigit "$2" -o [ "$2" -lt 1 ] ; then
				echo "Supported values for $1 are integers greater than 1"
				exit 1
			else
				value=$2
			fi ;;

		--set-icon-size)

			if [ "$2" == "small" ] ; then
				value=0
			elif [ "$2" == "large" ] ; then
				value=1
			elif [ "$2" == "auto" ] ; then
				value=2
			else
				echo "Supported values for $1 are 'small', 'large' and 'auto'"
				exit 1
			fi ;;

		--set-macro-security-level)

			if [ "$2" == "low" ] ; then
				value=0
			elif [ "$2" == "medium" ]; then
				value=1
			elif [ "$2" == "high" ] ; then
				value=2
			elif [ "$2" == "veryhigh" ] ; then
				value=3
			else
				echo "Supported values for $1 are 'low', 'medium', 'high' and 'veryhigh'"
				exit 1
			fi ;;

		--set-proxy-mode)

			if [ "$2" != "none" -a "$2" != "manual" -a "$2" != "auto" ] ; then
				echo "Supported values for $1 are 'none', 'manual' and 'auto'"
				exit 1
			else
				value=$2
			fi ;;

		--set-proxy-http-port			| \
		--set-proxy-ftp-port)

			if ! isdigit "$2" -o "$2" -lt 0 ] ; then
				echo "Supported values for $1 are positive integers"
				exit 1
			else
				value=$2
			fi ;;

		--set-mailer-program			| \
		--set-proxy-mode				| \
		--set-proxy-http-host			| \
		--set-proxy-ftp-host)

			echo "Use with care. No validation done."
			value="$2" ;;

		--set-calc-default-document)

			if [ "$2" == "ods" ] ; then
				value="calc8"
			elif [ "$2" == "xls" ]; then
				value="MS Excel 97"
			elif [ "$2" == "sxc" ] ; then
				value="StarOffice XML (Calc)"
			else
				echo "Supported values for $1 are 'ods', 'xls' and 'sxc'"
				exit 1
			fi ;;

		--set-impress-default-document)

			if [ "$2" == "odp" ] ; then
				value="impress8"
			elif [ "$2" == "ppt" ]; then
				value="MS PowerPoint 97"
			elif [ "$2" == "sxi" ] ; then
				value="StarOffice XML (Impress)"
			else
				echo "Supported values for $1 are 'odp', 'ppt' and 'sxi'"
				exit 1
			fi ;;

		--set-writer-default-document)

			if [ "$2" == "odt" ] ; then
				value="writer8"
			elif [ "$2" == "doc" ]; then
				value="MS Word 97"
			elif [ "$2" == "sxw" ] ; then
				value="StarOffice XML (Writer)"
			else
				echo "Supported values for $1 are 'odt', 'doc' and 'sxw'"
				exit 1
			fi ;;

		*)
			help
			exit 1 ;;

	esac
}


main()
{
	echo "$@" | grep -q =
	if [ $? -ne 0 -o $# -ne 1 ] ; then
		help
		exit 1
	fi

	setting=`echo $1 | awk -F= '{print $1}'`
	input_value=`echo $1 | awk -F= '{print $2}'`

	validate_and_translate "$setting" "$input_value"

	case "$setting" in

		--enable-accessibility)
			gconftool-2 --set "/desktop/gnome/interface/accessibility" --type bool "$value" ;;

		--enable-auto-save)
			gconftool-2 --set "/apps/openoffice/auto_save" --type bool "$value" ;;

		--enable-create-backup)
			gconftool-2 --set "/apps/openoffice/create_backup" --type bool "$value" ;;

		--enable-font-anti-aliasing)
			gconftool-2 --set "/apps/openoffice/use_font_anti_aliasing" --type bool "$value" ;;

		--enable-font-history)
			gconftool-2 --set "/apps/openoffice/show_font_history" --type bool "$value" ;;

		--enable-font-preview)
			gconftool-2 --set "/apps/openoffice/show_font_preview" --type bool "$value" ;;

		--enable-menu-icons)
			gconftool-2 --set "/apps/openoffice/show_menu_icons" --type bool "$value" ;;

		--enable-menu-inactive-items)
			gconftool-2 --set "/apps/openoffice/show_menu_inactive_items" --type bool "$value" ;;

		--enable-opengl)
			gconftool-2 --set "/apps/openoffice/use_opengl" --type bool "$value" ;;

		--enable-optimize-opengl)
			gconftool-2 --set "/apps/openoffice/optimize_opengl" --type bool "$value" ;;

		--enable-printing)
			gconftool-2 --set "/desktop/gnome/lockdown/disable_printing" --type bool "$value" ;;

		--enable-printing-modifies-doc)
			gconftool-2 --set "/apps/openoffice/printing_modifies_doc" --type bool "$value" ;;

		--enable-recommend-password-on-save)
			gconftool-2 --set "/apps/openoffice/lockdown/recommend_password_on_save" --type bool "$value" ;;

		--enable-remove-personal-info-on-save)
			gconftool-2 --set "/apps/openoffice/lockdown/remove_personal_info_on_save" --type bool "$value" ;;

		--enable-system-file-dialog)
			gconftool-2 --set "/apps/openoffice/use_system_file_dialog" --type bool "$value" ;;

		--enable-system-font)
			gconftool-2 --set "/apps/openoffice/use_system_font" --type bool "$value" ;;

		--enable-ui-customization)
			gconftool-2 --set "/apps/openoffice/lockdown/disable_ui_customization" --type bool "$value" ;;

		--enable-warn-alien-format)
			gconftool-2 --set "/apps/openoffice/warn_alien_format" --type bool "$value" ;;

		--enable-warn-info-create-pdf)
			gconftool-2 --set "/apps/openoffice/lockdown/warn_info_create_pdf" --type bool "$value" ;;

		--enable-warn-info-printing)
			gconftool-2 --set "/apps/openoffice/lockdown/warn_info_printing" --type bool "$value" ;;

		--enable-warn-info-signing)
			gconftool-2 --set "/apps/openoffice/lockdown/warn_info_signing" --type bool "$value" ;;

		--enable-warn-info-saving)
			gconftool-2 --set "/apps/openoffice/lockdown/warn_info_saving" --type bool "$value" ;;

		--set-auto-save-interval)
			gconftool-2 --set "/apps/openoffice/auto_save_interval" --type int "$value" ;;

		--set-calc-default-document)
			gconftool-2 --set "/apps/openoffice/calc_default_document_format" --type string "$value" ;;

		--set-font-anti-aliasing-min-pixel)
			gconftool-2 --set "/apps/openoffice/font_anti_aliasing_min_pixel" --type int "$value" ;;

		--set-icon-size)
			gconftool-2 --set "/apps/openoffice/icon_size" --type int "$value" ;;

		--set-impress-default-document)
			gconftool-2 --set "/apps/openoffice/impress_default_document_format" --type string "$value" ;;

		--set-macro-security-level)
			gconftool-2 --set "/apps/openoffice/lockdown/macro_security_level" --type int "$value" ;;

		--set-mailer-program)
			gconftool-2 --set "/desktop/gnome/url-handlers/mailto/command" --type string "$value %s" ;;

		--set-proxy-mode)
			gconftool-2 --set "/system/proxy/mode" --type string "$value" ;;

		--set-proxy-http-host)
			gconftool-2 --set "/system/http_proxy/host" --type string "$value" ;;

		--set-proxy-http-port)
			gconftool-2 --set "/system/http_proxy/port" --type int "$value" ;;

		--set-proxy-ftp-host)
			gconftool-2 --set "/system/proxy/ftp_host" --type string "$value" ;;

		--set-proxy-ftp-port)
			gconftool-2 --set "/system/proxy/ftp_port" --type int "$value" ;;

		--set-undo-steps)
			gconftool-2 --set "/apps/openoffice/undo_steps" --type int "$value" ;;

		--set-writer-default-document)
			gconftool-2 --set "/apps/openoffice/writer_default_document_format" --type string "$value" ;;

		*)
			help ;;
	esac

}


main "$@"
