#!/bin/bash

if test -f ./setup; then
	. ./setup
elif test -f bin/setup; then
	. bin/setup
else
	echo "Can't find setup";
	exit 1;
fi

if test "z$1" = "z"; then
	echo "ooinstall <prefix to install to> [-l]";
	echo "  -l - performs a linkoo on the installed source";
	exit 1;
fi

#
# This is one big, horrible - but useful hack ...
#

INSTALL_PATH=$1
export SOLARENV=$OOBUILDDIR/solenv
BUILD=8825
export OUT='../unxlngi4.pro'
export LOCAL_OUT='../unxlngi4.pro'
export LOCAL_COMMON_OUT='../unxlngi4.pro'

cd $OOBUILDDIR/instsetoo_native/util
perl -w $SOLARENV/bin/make_installer.pl \
	-f openoffice.lst -l en-US -p OpenOffice \
	-packagelist ../inc_openoffice/unix/packagelist.txt \
	-buildid $BUILD -rpm -simple $INSTALL_PATH

cd $INSTALL_PATH/program
./pkgchk --shared --quiet || exit 1;
./configimport --spool || exit 1;

if test "z$2" = "z-l"; then
	$SOLARENV/bin/linkoo $INSTALL_PATH $SRC_ROOT
fi
