#!/bin/bash

piece=$1
ooo_build_tag=$2

source $OO_TOOLSDIR/piece/sys-setup

# generate the common file list
$OO_TOOLSDIR/piece/merge-file-lists "files-$piece.txt" $DESTDIR/gid_*

# prune redundant files the scp2 likes to make for us
remove_file "files-$piece.txt" "$OO_INSTDIR/basis-link"
remove_file "files-$piece.txt" "$OO_INSTDIR/basis3.0/ure-link"
remove_dir  "files-$piece.txt" "$OO_INSTDIR/ure"

# move the stuff to /usr/share when enabled
if test "$OOO_BUILD_NOARCH" = 'YES' ; then
    # common stuff is easy
    $OO_TOOLSDIR/piece/install-l10n-helper $piece $ooo_build_tag "$DESTDIR" files-$piece.txt
    # ugly hack to move solver to /usr/share
    mv $DESTDIR$OO_INSTDIR/solver $DESTDIR$OO_INSTDIR_SHARE/solver
    #
    rm -f files-$piece-devel.txt
    for dir in `find $DESTDIR$OO_INSTDIR_SHARE/solver -type d | sed "s|$DESTDIR||" | grep -v "$OO_INSTDIR_SHARE/solver/noarch"` ; do
	echo "%dir $dir" >>files-$piece-devel.txt
    done
    find $DESTDIR$OO_INSTDIR_SHARE/solver -type f | sed "s|$DESTDIR||" | grep -v "$OO_INSTDIR_SHARE/solver/noarch" >>files-$piece-devel.txt
    cp files-$piece-devel.txt $DESTDIR$OO_INSTDIR_SHARE/
    echo "$OO_INSTDIR_SHARE/files-$piece-devel.txt" >>files-$piece-devel.txt
    #
    rm -f files-$piece-prebuilt.txt
    for dir in `find $DESTDIR$OO_INSTDIR_SHARE/solver -type d | sed "s|$DESTDIR||" | grep "$OO_INSTDIR_SHARE/solver/noarch"` ; do
	echo "%dir $dir" >>files-$piece-prebuilt.txt
    done
    find $DESTDIR$OO_INSTDIR_SHARE/solver -type f | sed "s|$DESTDIR||" | grep "$OO_INSTDIR_SHARE/solver/noarch" >>files-$piece-prebuilt.txt
    cp files-$piece-prebuilt.txt $DESTDIR$OO_INSTDIR_SHARE/
    echo "$OO_INSTDIR_SHARE/files-$piece-prebuilt.txt" >>files-$piece-prebuilt.txt
fi    
