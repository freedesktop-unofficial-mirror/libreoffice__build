#!/bin/bash

piece=$1
ooo_build_tag=$2

source $OO_TOOLSDIR/piece/sys-setup

# this script saves the architecture independent files back into solver
# they could be installed later in the noarch RPMs

# the file lists are needed
test -n "$DESTDIR" || exit 0;

# you should use --enable-build-noarch configure switch to enable this feature
test "$OOO_BUILD_NOARCH" = 'YES' || exit 0;

DEST="$DESTDIR$OO_SOLVERDIR/noarch"

echo "Saving noarch stuff back into solver ..."

# always create the top dir, so we could put it into the package even when
# just en-US is being built
mkdir -p $DEST

# lang packs are noarch
for list in  $DESTDIR/gid_Module_Langpack* ; do
    test -f $list || continue;
    # we want to keep the en_US localization in the package
    echo $list | grep "en_US" && continue;
    for file in `grep -v "^%dir" $list | sort -ru` ; do
	dir=`dirname $file`
	mkdir -p "$DEST$dir"
	mv "$DESTDIR$file" "$DEST$dir"
	rmdir --ignore-fail-on-non-empty "$DESTDIR$dir"
    done
    mv $list $DEST
done

# icon themes are noarch but they could be keep as is in the separate package
# and just repacked later, see $OO_TOOLSDIR/piece/file-list-postprocess
