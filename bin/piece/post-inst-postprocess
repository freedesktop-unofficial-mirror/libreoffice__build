#!/bin/bash

piece=$1
ooo_build_tag=$2

source $OO_TOOLSDIR/piece/sys-setup

# Now do magic stuff to register the services - fully hacky (sadly).
export OO_BUILD_SERVICES=1
# avoid infinite recursion ;-)
export OO_BUILD_POST_PROCESS_ENABLE='NO'
# do not remove the already created file lists
export OO_BUILD_FILE_LISTS_ENABLE='NO'
#
$OO_TOOLSDIR/piece/install-generic $piece $ooo_build_tag
# urgh - unbelievably nasty:
cp -a OpenOffice/gid_Starregistry_Services_Rdb_servicesrdb/*/services.rdb \
    $DESTDIR$OO_INSTDIR/basis3.0/program/services.rdb
cp -a OpenOffice/gid_Starregistry_Services_Rdb_Ure_servicesrdb/*/services.rdb \
    $DESTDIR$OO_INSTDIR/ure/share/misc/services.rdb
# udpate the file list
if test -f "files-$piece.txt" ; then
    echo "$OO_INSTDIR/basis3.0/program/services.rdb" >>"files-$piece.txt"
    echo "$OO_INSTDIR/ure/share/misc/services.rdb" >>"files-$piece.txt"
fi

# no need for solver bits at this late stage
rm -Rf "$DESTDIR/$OO_INSTDIR/solver"
