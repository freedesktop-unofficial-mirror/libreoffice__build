#!/bin/sh

# This script does a fast analyze of the .res files generated by testtool.bin

indexes="0 1 2 3 4 5 6 7 8"

for i in $indexes ; do
    TOTAL[$i]=0
    TESTS_WITH[$i]=
    TESTS_WITH_COUNT[$i]=0
done

NAME[0]="Runned:       "
NAME[1]="Test cases:   "
NAME[2]="Error:        "
NAME[3]="Call stack:   "
NAME[4]="Message:      "
NAME[5]="Warning:      "
NAME[6]="Assertion:    "
NAME[7]="QA Error:     "
NAME[8]="Assert Stack: "

usage()
{
    echo "This script does a fast analyze of the .res files generated by testtool.bin."
    echo "The statistics are printed on the standard output."
    echo
    echo "Usage: ${0##*/} file.res ..."
}

if test -z "$1" ; then
    usage
    exit 1;
fi

while test -n "$1" ; do

    res_file="$1"

    echo "$res_file:"
    echo "--------------------------------"

    for i in $indexes ; do
	count=`grep "^$i;" $res_file | wc -l`
	echo ${NAME[$i]}: $count
        TOTAL[$i]=$((${TOTAL[$i]} + count))
#	test "$count" != "0" && TESTS_WITH[$i]="${TESTS_WITH[$i]} $res_file($count)"
	test "$count" != "0" && TESTS_WITH[$i]="${TESTS_WITH[$i]} $count:$res_file"
    done

    echo
    echo

    shift
done 

echo "====================================================="
echo "All tests"
echo "====================================================="
for i in $indexes ; do
    echo ${NAME[$i]}: ${TOTAL[$i]}
done
echo
echo
#for i in 2 5 7 3 ; do
for i in 2 ; do
    echo "Test with ${NAME[$i]}"
    echo "----------------------------"
    for test in ${TESTS_WITH[$i]} ; do
	echo $test
    done
    echo
    echo
    echo
done
