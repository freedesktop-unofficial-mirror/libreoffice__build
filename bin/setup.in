# If we're building in the build system the above line
# reads BUILD_VERSION=[TAG]
#
# The tree layout is:
#
#   ooo/ <cwd>
#     binutils-2.13
#     gcc-3.0.4
#     j2sdk1.3.1
#     ooo-build-$BUILD_VERSION

# shrink this to ENUS,GERM for a faster build
LANGS="ENUS,FREN,GERM,SPAN,ITAL,DTCH,PORT,SWED,POL,RUSS";
LANGS="$LANGS,DAN,GREEK,TURK,CHINSIM,CHINTRAD,JAPN,KOREAN";
LANGS="$LANGS,CAT";

# Path bits
if !(test "z$BUILD_VERSION" = "z"); then
	TAG=$BUILD_VERSION;
else
	TAG=$1;
fi

CONFIGURE_OPTIONS="--with-lang=$LANGS"

if test "z$TAG" = "z" ||
   test "z$TAG" = "zOOO_1_0_3"; then
	CVSTAG=OOO_1_0_3;
	VERSION=1.0.3;
	BINSUFFIX=;
else
	CVSTAG=$TAG;
	VERSION=1.1;
	BINSUFFIX=1.1;

	CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS \
			   --enable-libart --enable-libsn --enable-crashdump=no";
	gcc_ver=`gcc -dumpversion | awk -F. '{ print \$1*10000+\$2*100+\$3 }'`;

	if test "$gcc_ver" -lt "30200"; then
		echo "Error: Your gcc ($gcc_ver) is too old to use the system mozilla: good luck";
	else
		CONFIGURE_OPTIONS="$CONFIGURE_OPTIONS --with-mozilla"
	fi
fi

# Misc. internal
STAMP=ooo-build-stamp
CCACHE_DIR=$BUILDDIR/.ccache
OODESTDIR=

if test "z@IN_PKG@" = "zyes"; then
	TOOLSDIR='@TOOLSDIR@'
	BASEDIR='@BASEDIR@'

elif !(test "z$BUILD_VERSION" = "z"); then
# Building in the build system ...
	echo "In the build system ..."

	OODESTDIR=$1

	# clobber bogus env vars. they badly screw things up
	unset DESTDIR;
	unset CC;
	unset CXX;
	unset ERROR_FLAGS;
	unset MAKE
	unset BUILDDIR
	unset SRCDIR
	unset WARN_CFLAGS

	echo "Initial environment:";
	set

	TOOLSDIR="`pwd`/..";
	BASEDIR="$TOOLSDIR/.."

	SRCDIR='<No manual unpacking required>'
	BUILDDIR=$BASEDIR
	OOBUILDDIR=$BUILDDIR/$CVSTAG

# Michael's machine
elif test "z`hostname`" = "zserver.home"; then
	BASEDIR=/opt/OpenOffice/openoffice
	TOOLSDIR=/opt/OpenOffice/openoffice

# Federico's office heater
elif test "z`hostname`" = "zchampignon.ximian.com"; then
	BASEDIR=/oo
	TOOLSDIR=/cvs/ximian/openoffice

# Anders' machine
elif test "z`hostname`" = "zcarbon"; then
	BASEDIR=$HOME/src/ooo
	TOOLSDIR=$HOME/src/ooo
fi

# Where to install to
PREFIX=$OODESTDIR/usr
SYSCONFDIR=$OODESTDIR/etc
OOINSTBASE=usr/lib/ooo-$VERSION
OOINSTDIR=$OODESTDIR/$OOINSTBASE

CVSROOT=':pserver:anoncvs@cvs.openoffice.org:/cvs'
TCSH=/bin/tcsh

# Misc directories
if test "z$BUILD_VERSION" = "z"; then
	SRCDIR=$BASEDIR/src
	BUILDDIR=$BASEDIR/build
	OOBUILDDIR=$BUILDDIR/$CVSTAG
fi

# setup paths
PATH="$BUILDDIR/bin:$BUILDDIR/jdk/bin:$PATH"
LD_LIBRARY_PATH="$BUILDDIR/lib:$LD_LIBRARY_PATH"
RPM_RELEASE=1.ximian.1

export LD_LIBRARY_PATH PATH CVSROOT CVSTAG
export CCACHE_DIR BUILDDIR OOBUILDDIR BUILD_FLAGS
export VERSION RPM_RELEASE TOOLSDIR
export PREFIX SYSCONFDIR OOINSTDIR OOINSTBASE
export OODESTDIR CONFIGURE_OPTIONS

echo "Setup:"
echo " Tag:       '$CVSTAG'"
echo " Flags:     '$BUILD_FLAGS'"
echo " Suffix:    '$BINSUFFIX'"
echo " Dir:       '$BUILDDIR'"
echo " DestDir:   '$DESTDIR'"
echo " Path:      '$PATH'"
echo " Prefix:    '$PREFIX'"
echo " Sysconf:   '$SYSCONFDIR'"
echo " OOInBase:  '$OOINSTBASE'"
echo " OOInstall: '$OOINSTDIR'"
echo " OODestDir: '$OODESTDIR'"
echo " Config:    '$CONFIGURE_OPTIONS'"

if !(test "z$BUILD_VERSION" = "z"); then
	echo "Build environment:";
	set
fi
