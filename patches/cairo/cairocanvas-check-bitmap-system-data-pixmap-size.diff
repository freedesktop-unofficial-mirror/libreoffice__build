Index: cairo_helper.cxx
===================================================================
RCS file: /cvs/gsl/canvas/source/cairo/cairo_helper.cxx,v
retrieving revision 1.2
diff -u -p -r1.2 cairo_helper.cxx
--- canvas/source/cairo/cairo_helper.cxx	28 Feb 2006 10:35:47 -0000	1.2
+++ canvas/source/cairo/cairo_helper.cxx	9 Aug 2006 16:29:37 -0000
@@ -154,15 +154,29 @@ cairoHelperFlush( const void* pSysDataVo
 void*
 cairoHelperGetSurface( const void* pSysDataVoid, const void* pBmpDataVoid, int width, int height )
 {
-	const BitmapSystemData* pBmpData = (const BitmapSystemData*) pBmpDataVoid;
-	const SystemEnvData* pSysData = (const SystemEnvData*) pSysDataVoid;
+    const BitmapSystemData* pBmpData = (const BitmapSystemData*) pBmpDataVoid;
+    const SystemEnvData* pSysData = (const SystemEnvData*) pSysDataVoid;
 
-	return cairo_xlib_surface_create( (Display*) pSysData->pDisplay,
-					  (Drawable) pBmpData->aPixmap,
-					  (Visual*) pSysData->pVisual,
-					  width, height );
+    if( pBmpData->mnWidth != width || pBmpData->mnHeight != height )
+        return NULL;
+
+#ifdef CAIRO_HAS_XLIB_SURFACE
+    return cairo_xlib_surface_create( (Display*) pSysData->pDisplay,
+                                      (Drawable) pBmpData->aPixmap,
+                                      (Visual*) pSysData->pVisual,
+                                      width, height );
+#elif defined (CAIRO_HAS_WIN32_SURFACE)
+    HDC hDC = CreateCompatibleDC( NULL );
+    if (pBmpData->pDIB)
+        SelectObject( hDC, (HANDLE) pBmpData->pDIB );
+    else
+        SelectObject( hDC, (HANDLE) pBmpData->pDDB );
+    return cairo_win32_surface_create( hDC );
+#endif
 }
 
+#ifdef CAIRO_HAS_XLIB_SURFACE
+
 void*
 cairoHelperGetDisplay( const void* pSysData )
 {
@@ -210,6 +210,19 @@
 	return ((const SystemEnvData*) pSysData)->aWindow;
 }
 
+#endif
+#ifdef CAIRO_HAS_WIN32_SURFACE
+
+void *
+cairoHelperGetWindow( const void* pSysData )
+{
+	return (void*) ((const SystemEnvData*) pSysData)->hWnd;
+}
+
+#endif
+
+#ifdef CAIRO_HAS_XLIB_SURFACE
+ 
 void*
 cairoHelperGetVisual( const void* pSysData )
 {
@@ -240,3 +240,5 @@
 	OSL_TRACE("depth: %d", ((const SystemEnvData*) pSysData)->nDepth);
 	return ((const SystemEnvData*) pSysData)->nDepth;
 }
+
+#endif
Index: cairo_devicehelper.cxx
===================================================================
RCS file: /cvs/gsl/canvas/source/cairo/cairo_devicehelper.cxx,v
retrieving revision 1.3
diff -u -p -r1.3 cairo_devicehelper.cxx
--- canvas/source/cairo/cairo_devicehelper.cxx	22 Mar 2006 11:00:26 -0000	1.3
+++ canvas/source/cairo/cairo_devicehelper.cxx	9 Aug 2006 16:32:13 -0000
@@ -375,7 +375,11 @@ namespace cairocanvas
 
     Surface* DeviceHelper::getSurface( BitmapSystemData& rData, const Size& rSize )
     {
-		return new Surface ( mpSysData, &rData, rSize.Width(), rSize.Height() );
+        OSL_TRACE( "requested size: %d x %d available size: %d x %d", rSize.Width (), rSize.Height (), rData.mnWidth, rData.mnHeight );
+        if ( rData.mnWidth == rSize.Width() && rData.mnHeight == rSize.Height() )
+            return new Surface ( mpSysData, &rData, rSize.Width(), rSize.Height() );
+        else
+            return NULL;
     }
 
     void DeviceHelper::flush()
