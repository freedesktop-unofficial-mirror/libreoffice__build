From 9a8b311fd777db3ae126c38497bc11026d06b44e Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:58:28 +0200
Subject: [PATCH 282/768] speed-hash-style.diff

---
 configure.in         |    8 ++++++--
 set_soenv.in         |    1 +
 solenv/inc/unxlng.mk |    2 +-
 stlport/makefile.mk  |    2 +-
 4 files changed, 9 insertions(+), 4 deletions(-)

diff --git configure.in configure.in
index 77b2ea5..0b91195 100644
--- configure.in
+++ configure.in
@@ -564,6 +564,9 @@ AC_ARG_WITH(system-mozilla,
                           libxul (default), xulrunner, firefox, seamonkey,
                           mozilla
 ], WITH_SYSTEM_MOZILLA=$withval, WITH_SYSTEM_MOZILLA=no)
+AC_ARG_WITH(linker-hash-style,
+[  --with-linker-hash-style
+], WITH_LINKER_HASH_STYLE=$withval, WITH_LINKER_HASH_STYLE=gnu)
 AC_ARG_WITH(stlport,
 [  --with-stlport         The location that STLport is installed in. The STL
                           header files are assumed to be in
@@ -1604,9 +1607,9 @@ if test "$_os" = "SunOS"; then
 fi
 
 if test "$GCC" = "yes"; then
-   AC_MSG_CHECKING( for --hash-style=both linker support )
+   AC_MSG_CHECKING( for --hash-style=$WITH_LINKER_HASH_STYLE linker support )
    hash_style_ldflags_save=$LDFLAGS
-   LDFLAGS="$LDFLAGS -Wl,--hash-style=both"
+   LDFLAGS="$LDFLAGS -Wl,--hash-style=$WITH_LINKER_HASH_STYLE"
    AC_LINK_IFELSE([AC_LANG_PROGRAM([
    #include <stdio.h>
    ],[
@@ -1620,6 +1623,7 @@ if test "$GCC" = "yes"; then
    LDFLAGS=$hash_style_ldflags_save
 fi
 AC_SUBST(HAVE_LD_HASH_STYLE)
+AC_SUBST(WITH_LINKER_HASH_STYLE)
 
 dnl ===================================================================
 dnl  Test the Compaq compiler for OSF1
diff --git set_soenv.in set_soenv.in
index bfed518..7ca75ff 100644
--- set_soenv.in
+++ set_soenv.in
@@ -1734,6 +1734,7 @@ ToFile( "HAVE_GCC_VISIBILITY_FEATURE",
 ToFile( "HAVE_GCC_VISIBILITY_BROKEN",
         "@HAVE_GCC_VISIBILITY_BROKEN@", "e" );
 ToFile( "HAVE_LD_HASH_STYLE","@HAVE_LD_HASH_STYLE@","e" );
+ToFile( "WITH_LINKER_HASH_STYLE","@WITH_LINKER_HASH_STYLE@","e" );
 ToFile( "HAVE_LD_BSYMBOLIC_FUNCTIONS",
 		"@HAVE_LD_BSYMBOLIC_FUNCTIONS@","e" );
 ToFile( "CXX",               $CXX,               "e" );
diff --git solenv/inc/unxlng.mk solenv/inc/unxlng.mk
index 446775f..46f8d91 100644
--- solenv/inc/unxlng.mk
+++ solenv/inc/unxlng.mk
@@ -198,7 +198,7 @@ STDSHLGUIMT+=-ltcmalloc
 STDSHLCUIMT+=-ltcmalloc
 .ENDIF
 .IF "$(HAVE_LD_HASH_STYLE)"  == "TRUE"
-LINKFLAGS += -Wl,--hash-style=both
+LINKFLAGS += -Wl,--hash-style=$(WITH_LINKER_HASH_STYLE)
 .ELSE
 LINKFLAGS += -Wl,-zdynsort
 .ENDIF
diff --git stlport/makefile.mk stlport/makefile.mk
index 907c093..9084d40 100644
--- stlport/makefile.mk
+++ stlport/makefile.mk
@@ -144,7 +144,7 @@ BUILD_FLAGS=-f vc7.mak EXFLAGS="/EHa /Zc:wchar_t-" CCNUMVER=$(CCNUMVER)
     BUILD_FLAGS+= -j$(MAXPROCESS)
 .ENDIF
 .IF "$(HAVE_LD_HASH_STYLE)"  == "TRUE"
-CXX+= -Wl,--hash-style=both
+CXX+= -Wl,--hash-style=$(WITH_LINKER_HASH_STYLE)
 .ENDIF
 
 .IF "$(HAVE_LD_BSYMBOLIC_FUNCTIONS)"  == "TRUE"
-- 
1.7.0.1

