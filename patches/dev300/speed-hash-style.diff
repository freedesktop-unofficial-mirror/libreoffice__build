From ab79d7a919077a3d9ec8b9051ef811f1e12adbee Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:58:28 +0200
Subject: [PATCH 319/878] speed-hash-style.diff

---
 configure.in         |    8 ++++++--
 set_soenv.in         |    1 +
 solenv/inc/unxlng.mk |    2 +-
 stlport/makefile.mk  |    2 +-
 4 files changed, 9 insertions(+), 4 deletions(-)

diff --git a/configure.in b/configure.in
index eed386e..5030b4a 100644
--- a/configure.in
+++ b/configure.in
@@ -559,6 +559,9 @@ AC_ARG_WITH(system-mozilla,
                           libxul (default), xulrunner, firefox, seamonkey,
                           mozilla
 ], WITH_SYSTEM_MOZILLA=$withval, WITH_SYSTEM_MOZILLA=no)
+AC_ARG_WITH(linker-hash-style,
+[  --with-linker-hash-style
+], WITH_LINKER_HASH_STYLE=$withval, WITH_LINKER_HASH_STYLE=gnu)
 AC_ARG_WITH(stlport,
 [  --with-stlport         The location that STLport is installed in. The STL
                           header files are assumed to be in
@@ -1651,9 +1654,9 @@ if test "$_os" = "SunOS"; then
 fi
 
 if test "$GCC" = "yes"; then
-   AC_MSG_CHECKING( for --hash-style=both linker support )
+   AC_MSG_CHECKING( for --hash-style=$WITH_LINKER_HASH_STYLE linker support )
    hash_style_ldflags_save=$LDFLAGS
-   LDFLAGS="$LDFLAGS -Wl,--hash-style=both"
+   LDFLAGS="$LDFLAGS -Wl,--hash-style=$WITH_LINKER_HASH_STYLE"
    AC_LINK_IFELSE([AC_LANG_PROGRAM([
    #include <stdio.h>
    ],[
@@ -1667,6 +1670,7 @@ if test "$GCC" = "yes"; then
    LDFLAGS=$hash_style_ldflags_save
 fi
 AC_SUBST(HAVE_LD_HASH_STYLE)
+AC_SUBST(WITH_LINKER_HASH_STYLE)
 
 dnl ===================================================================
 dnl  Test the IRIX SGI Mips pro compiler
diff --git a/set_soenv.in b/set_soenv.in
index 93b8d06..c4e8e13 100644
--- a/set_soenv.in
+++ b/set_soenv.in
@@ -1802,6 +1802,7 @@ ToFile( "HAVE_GCC_VISIBILITY_FEATURE",
 ToFile( "HAVE_GCC_VISIBILITY_BROKEN",
         "@HAVE_GCC_VISIBILITY_BROKEN@", "e" );
 ToFile( "HAVE_LD_HASH_STYLE","@HAVE_LD_HASH_STYLE@","e" );
+ToFile( "WITH_LINKER_HASH_STYLE","@WITH_LINKER_HASH_STYLE@","e" );
 ToFile( "HAVE_LD_BSYMBOLIC_FUNCTIONS",
 		"@HAVE_LD_BSYMBOLIC_FUNCTIONS@","e" );
 ToFile( "CXX",               $CXX,               "e" );
diff --git a/solenv/inc/unxlng.mk b/solenv/inc/unxlng.mk
index d765570..2c8855b 100644
--- a/solenv/inc/unxlng.mk
+++ b/solenv/inc/unxlng.mk
@@ -198,7 +198,7 @@ STDSHLGUIMT+=-ltcmalloc
 STDSHLCUIMT+=-ltcmalloc
 .ENDIF
 .IF "$(HAVE_LD_HASH_STYLE)"  == "TRUE"
-LINKFLAGS += -Wl,--hash-style=both
+LINKFLAGS += -Wl,--hash-style=$(WITH_LINKER_HASH_STYLE)
 .ELSE
 LINKFLAGS += -Wl,-zdynsort
 .ENDIF
diff --git a/stlport/makefile.mk b/stlport/makefile.mk
index 9faef62..e4eba05 100644
--- a/stlport/makefile.mk
+++ b/stlport/makefile.mk
@@ -144,7 +144,7 @@ BUILD_FLAGS=-f vc7.mak EXFLAGS="/EHa /Zc:wchar_t-" CCNUMVER=$(CCNUMVER)
     BUILD_FLAGS+= -j$(MAXPROCESS)
 .ENDIF
 .IF "$(HAVE_LD_HASH_STYLE)"  == "TRUE"
-CXX+= -Wl,--hash-style=both
+CXX+= -Wl,--hash-style=$(WITH_LINKER_HASH_STYLE)
 .ENDIF
 
 .IF "$(HAVE_LD_BSYMBOLIC_FUNCTIONS)"  == "TRUE"
-- 
1.7.0.1

