--- /dev/null	2008-06-06 22:36:48.000000000 +0200
+++ libxmlsec/xmlsec1-broken-system-nss.patch	2010-08-20 20:46:58.000000000 +0200
@@ -0,0 +1,26 @@
+--- misc/xmlsec1-1.2.14/configure.in.old	2010-08-20 20:43:01.000000000 +0200
++++ misc/build/xmlsec1-1.2.14/configure.in	2010-08-20 20:45:29.000000000 +0200
+@@ -604,6 +604,11 @@ elif test "z$with_nss" = "z" -a "z$with_
+     dnl We are going to try all options
+     dnl
+     if test "z$NSS_FOUND" = "zno" ; then
++        PKG_CHECK_MODULES(NSS, nspr >= $MOZILLA_MIN_VERSION nss >= $MOZILLA_MIN_VERSION,
++    	    [NSS_FOUND=yes NSPR_PACKAGE=nspr NSS_PACKAGE=nss],
++	    [NSS_FOUND=no])
++    fi
++    if test "z$NSS_FOUND" = "zno" ; then
+         PKG_CHECK_MODULES(NSS, $MOZ_FLAVOUR-nspr >= $MOZILLA_MIN_VERSION $MOZ_FLAVOUR >= $MOZILLA_MIN_VERSION,
+     	    [NSS_FOUND=yes NSPR_PACKAGE=$MOZ_FLAVOUR-nspr NSS_PACKAGE=$MOZ_FLAVOUR-nss],
+ 	    [NSS_FOUND=no])
+@@ -618,11 +623,6 @@ elif test "z$with_nss" = "z" -a "z$with_
+     	    [NSS_FOUND=yes NSPR_PACKAGE=xulrunner-nspr NSS_PACKAGE=xulrunner-nss],
+ 	    [NSS_FOUND=no])
+     fi
+-    if test "z$NSS_FOUND" = "zno" ; then
+-        PKG_CHECK_MODULES(NSS, nspr >= $MOZILLA_MIN_VERSION nss >= $MOZILLA_MIN_VERSION,
+-    	    [NSS_FOUND=yes NSPR_PACKAGE=nspr NSS_PACKAGE=nss],
+-	    [NSS_FOUND=no])
+-    fi
+ fi
+ 
+ if test "z$NSS_FOUND" = "zno" ; then 
--- libxmlsec/makefile.mk.old	2010-11-11 16:35:21.000000000 +0100
+++ libxmlsec/makefile.mk	2010-12-20 18:45:39.000000000 +0100
@@ -61,6 +61,7 @@ PATCH_FILES=\
    xmlsec1-configure.patch \
    xmlsec1-configure-libxml-libxslt.patch \
    xmlsec1-olderlibxml2.patch \
+   xmlsec1-broken-system-nss.patch \
    xmlsec1-nssdisablecallbacks.patch \
    xmlsec1-customkeymanage.patch \
    xmlsec1-nssmangleciphers.patch \
@@ -153,7 +154,7 @@ LDFLAGS:=$(xmlsec_LDFLAGS)
 
 .ENDIF
 CONFIGURE_DIR=
-CONFIGURE_ACTION=.$/configure ADDCFLAGS="$(xmlsec_CFLAGS)" CPPFLAGS="$(xmlsec_CPPFLAGS)"
+CONFIGURE_ACTION=autoreconf -I m4 -f -i && .$/configure ADDCFLAGS="$(xmlsec_CFLAGS)" CPPFLAGS="$(xmlsec_CPPFLAGS)"
 CONFIGURE_FLAGS=--with-pic --disable-shared --disable-crypto-dl --with-libxslt=no --with-openssl=no --with-gnutls=no LIBXML2LIB="$(LIBXML2LIB)"
 # system-mozilla needs pkgconfig to get the information about nss
 # FIXME: This also will enable pkg-config usage for libxml2. It *seems*
