From 08922184ee4d56475c09433b06db0f8ad64ecdb6 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:59:00 +0200
Subject: [PATCH 348/878] fpicker-kde-resmgr.diff

---
 fpicker/source/unx/kde_unx/UnxFilePicker.cxx |   11 +++++++----
 fpicker/source/unx/kde_unx/UnxFilePicker.hxx |    3 +++
 fpicker/source/unx/kde_unx/makefile.mk       |    3 +--
 3 files changed, 11 insertions(+), 6 deletions(-)

diff --git a/fpicker/source/unx/kde_unx/UnxFilePicker.cxx b/fpicker/source/unx/kde_unx/UnxFilePicker.cxx
index 461434c..a7737fa 100644
--- a/fpicker/source/unx/kde_unx/UnxFilePicker.cxx
+++ b/fpicker/source/unx/kde_unx/UnxFilePicker.cxx
@@ -107,8 +107,8 @@
 #include <FPServiceInfo.hxx>
 #endif
 
-#ifndef _SVTOOLS_SVTDATA_HXX
-#include <svtools/svtdata.hxx>
+#ifndef _TOOLS_RESMGR_HXX
+#include <tools/resmgr.hxx>
 #endif
 
 #ifndef _SVTOOLS_HRC
@@ -178,7 +178,8 @@ UnxFilePicker::UnxFilePicker( const uno::Reference<lang::XMultiServiceFactory>&
           m_nFilePickerWrite( -1 ),
           m_nFilePickerRead( -1 ),
           m_pNotifyThread( NULL ),
-          m_pCommandThread( NULL )
+          m_pCommandThread( NULL ),
+          m_pResMgr( CREATEVERSIONRESMGR( fps_office ) )
 {
 }
 
@@ -211,6 +212,8 @@ UnxFilePicker::~UnxFilePicker()
 
     if ( m_nFilePickerRead >= 0 )
         close( m_nFilePickerRead );
+
+    delete m_pResMgr, m_pResMgr = NULL;
 }
 
 void SAL_CALL UnxFilePicker::addFilePickerListener( const uno::Reference<XFilePickerListener>& xListener )
@@ -970,7 +973,7 @@ void UnxFilePicker::sendAppendControlCommand( sal_Int16 nControlId )
         aBuffer.appendAscii( " ", 1 );
         appendEscaped( aBuffer, aType );
         aBuffer.appendAscii( " ", 1 );
-        appendEscaped( aBuffer, String( SvtResId( nTitleId ) ) );
+        appendEscaped( aBuffer, m_pResMgr? String( ResId( nTitleId, *m_pResMgr ) ): String() );
 
         sendCommand( aBuffer.makeStringAndClear() );
     }
diff --git a/fpicker/source/unx/kde_unx/UnxFilePicker.hxx b/fpicker/source/unx/kde_unx/UnxFilePicker.hxx
index d0fc93d..b9865bd 100644
--- a/fpicker/source/unx/kde_unx/UnxFilePicker.hxx
+++ b/fpicker/source/unx/kde_unx/UnxFilePicker.hxx
@@ -114,6 +114,7 @@
 
 class UnxFilePickerCommandThread;
 class UnxFilePickerNotifyThread;
+class ResMgr;
 
 class UnxFilePickerDummy
 {
@@ -145,6 +146,8 @@ protected:
     UnxFilePickerNotifyThread  *m_pNotifyThread;
     UnxFilePickerCommandThread *m_pCommandThread;
 
+    ResMgr                     *m_pResMgr;
+
 public:
     UnxFilePicker( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& xServiceMgr );
     virtual ~UnxFilePicker();
diff --git a/fpicker/source/unx/kde_unx/makefile.mk b/fpicker/source/unx/kde_unx/makefile.mk
index 4a944f0..59ab62d 100644
--- a/fpicker/source/unx/kde_unx/makefile.mk
+++ b/fpicker/source/unx/kde_unx/makefile.mk
@@ -96,8 +96,7 @@ SHL1STDLIBS=$(CPPULIB)\
         $(CPPUHELPERLIB)\
         $(SALLIB)\
         $(VCLLIB)\
-        $(TOOLSLIB)\
-        $(SVTOOLLIB)
+        $(TOOLSLIB)
 
 SHL1OBJS=$(SLOFILES)
 SHL1DEF=$(MISC)$/$(SHL1TARGET).def
-- 
1.7.0.1

