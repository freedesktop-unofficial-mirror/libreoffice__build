--- xmlhelp/source/com/sun/star/help/makefile.mk.orig	2008-10-03 11:07:56.000000000 +0200
+++ xmlhelp/source/com/sun/star/help/makefile.mk	2008-10-03 11:45:41.000000000 +0200
@@ -103,6 +103,7 @@
 JARFILES  = ridl.jar jurt.jar unoil.jar juh.jar
 .IF "$(SYSTEM_LUCENE)" == "YES"
 XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(LUCENE_CORE_JAR)$(PATH_SEPERATOR)$(LUCENE_ANALYZERS_JAR)
+COMP=fix_system_lucene
 .ELSE
 JARFILES += lucene-core-2.3.jar lucene-analyzers-2.3.jar
 .ENDIF
@@ -115,3 +116,12 @@
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :  target.mk
+
+.IF "$(JARTARGETN)"!=""
+$(JARTARGETN) : $(COMP)
+.ENDIF
+
+fix_system_lucene:
+	@echo "Fix Java Class-Path entry for Lucene libraries from system."
+	@$(SED) -r -e "s#^(Class-Path:).*#\1 file://$(LUCENE_CORE_JAR) file://$(LUCENE_ANALYZERS_JAR)#" \
+	-i ../../../../../unxlngx6.pro/class/HelpLinker/META-INF/MANIFEST.MF
