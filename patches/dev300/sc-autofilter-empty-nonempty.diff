From 7bdeddfaffa940c90224c36ea618cfb4f56c7d12 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:12 +0200
Subject: [PATCH 145/878] sc-autofilter-empty-nonempty.diff

---
 sc/source/ui/view/gridwin.cxx |   19 ++++++++++++++++++-
 1 files changed, 18 insertions(+), 1 deletions(-)

diff --git a/sc/source/ui/view/gridwin.cxx b/sc/source/ui/view/gridwin.cxx
index fca812e..e977db7 100644
--- a/sc/source/ui/view/gridwin.cxx
+++ b/sc/source/ui/view/gridwin.cxx
@@ -140,6 +140,8 @@ const BYTE SC_NESTEDBUTTON_UP   = 2;
 #define SC_AUTOFILTER_ALL		0
 #define	SC_AUTOFILTER_TOP10     1
 #define	SC_AUTOFILTER_CUSTOM    2
+#define        SC_AUTOFILTER_EMPTY     3
+#define        SC_AUTOFILTER_NOTEMPTY  4
 
 //	Modi fuer die FilterListBox
 enum ScFilterBoxMode
@@ -898,7 +900,7 @@ void ScGridWindow::DoAutoFilterMenue( SCCOL nCol, SCROW nRow, BOOL bDataSelect )
         long nMaxText = 0;
 
         //	default entries
-        static const USHORT nDefIDs[] = { SCSTR_ALLFILTER, SCSTR_TOP10FILTER, SCSTR_STDFILTER };
+        static const USHORT nDefIDs[] = { SCSTR_ALLFILTER, SCSTR_TOP10FILTER, SCSTR_STDFILTER, SCSTR_EMPTY, SCSTR_NOTEMPTY };
         const USHORT nDefCount = sizeof(nDefIDs) / sizeof(USHORT);
         for (i=0; i<nDefCount; i++)
         {
@@ -1231,6 +1233,21 @@ void ScGridWindow::ExecFilter( ULONG nSel,
                         rNewEntry.eOp	= SC_TOPVAL;
                         *rNewEntry.pStr	= String::CreateFromAscii(RTL_CONSTASCII_STRINGPARAM("10"));
                     }
+                    else if (nSel == SC_AUTOFILTER_EMPTY)
+                    {
+                        rNewEntry.pStr->Erase();
+                        rNewEntry.bQueryByString = FALSE;
+                        rNewEntry.eOp	= SC_EQUAL;
+                        rNewEntry.nVal	= SC_EMPTYFIELDS;
+
+                    }
+                    else if (nSel == SC_AUTOFILTER_NOTEMPTY)
+                    {
+                        rNewEntry.pStr->Erase();
+                        rNewEntry.bQueryByString = FALSE;
+                        rNewEntry.eOp	= SC_EQUAL;
+                        rNewEntry.nVal	= SC_NONEMPTYFIELDS;
+                    }
                     else
                     {
                         rNewEntry.eOp	= SC_EQUAL;
-- 
1.7.0.1

