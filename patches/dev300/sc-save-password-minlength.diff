From 90b5a68b5c540d7afb8b2e1656374454f1213486 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:15 +0200
Subject: [PATCH 124/768] sc-save-password-minlength.diff

---
 sfx2/inc/sfx2/passwd.hxx      |    6 ++++++
 sfx2/source/dialog/passwd.cxx |   26 ++++++++++++++++++++++++++
 sfx2/source/dialog/passwd.hrc |    3 +++
 sfx2/source/dialog/passwd.src |   16 ++++++++++++++++
 4 files changed, 51 insertions(+), 0 deletions(-)

diff --git sfx2/inc/sfx2/passwd.hxx sfx2/inc/sfx2/passwd.hxx
index e6cbed2..6a583fe 100644
--- sfx2/inc/sfx2/passwd.hxx
+++ sfx2/inc/sfx2/passwd.hxx
@@ -55,6 +55,7 @@ private:
     Edit			maPasswordED;
     FixedText		maConfirmFT;
     Edit			maConfirmED;
+    FixedText		maMinLengthFT;
     FixedLine       maPasswordBox;
 
     OKButton		maOKBtn;
@@ -63,12 +64,17 @@ private:
 
     String			maConfirmStr;
     USHORT			mnMinLen;
+    String			maMinLenPwdStr;
+    String			maEmptyPwdStr;
+    String			maMainPwdStr;
     USHORT			mnExtras;
 
     bool            mbAsciiOnly;
     DECL_DLLPRIVATE_LINK( EditModifyHdl, Edit* );
     DECL_DLLPRIVATE_LINK( OKHdl, OKButton* );
 
+    void			SetPasswdText();
+
 public:
     SfxPasswordDialog( Window* pParent, const String* pGroupText = NULL );
 
diff --git sfx2/source/dialog/passwd.cxx sfx2/source/dialog/passwd.cxx
index 0999ae5..d454c8c 100644
--- sfx2/source/dialog/passwd.cxx
+++ sfx2/source/dialog/passwd.cxx
@@ -103,6 +103,7 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
     maPasswordED	( this, SfxResId( ED_PASSWD_PASSWORD ) ),
     maConfirmFT		( this, SfxResId( FT_PASSWD_CONFIRM ) ),
     maConfirmED		( this, SfxResId( ED_PASSWD_CONFIRM ) ),
+    maMinLengthFT	( this, SfxResId( FT_PASSWD_MINLEN ) ),
     maPasswordBox	( this, SfxResId( GB_PASSWD_PASSWORD ) ),
     maOKBtn			( this, SfxResId( BTN_PASSWD_OK ) ),
     maCancelBtn		( this, SfxResId( BTN_PASSWD_CANCEL ) ),
@@ -110,6 +111,9 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
     maConfirmStr	( 		SfxResId( STR_PASSWD_CONFIRM ) ),
 
     mnMinLen		( 5 ),
+    maMinLenPwdStr	( SfxResId( STR_PASSWD_MIN_LEN ) ),
+    maEmptyPwdStr	( SfxResId( STR_PASSWD_EMPTY ) ),
+    maMainPwdStr    ( ),
     mnExtras		( 0 ),
     mbAsciiOnly     ( false )
 
@@ -123,6 +127,25 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
 
     if ( pGroupText )
           maPasswordBox.SetText( *pGroupText );
+
+//set the text to the pasword length
+    SetPasswdText();
+}
+
+// -----------------------------------------------------------------------
+
+void SfxPasswordDialog::SetPasswdText( )
+{
+//set the new string to the minimum password length
+    if( mnMinLen == 0 )
+        maMinLengthFT.SetText( maEmptyPwdStr );
+    else
+    {
+        maMainPwdStr = maMinLenPwdStr;
+        maMainPwdStr.SearchAndReplace( String::CreateFromAscii( "$(MINLEN)" ), String::CreateFromInt32((sal_Int32) mnMinLen ), 0);
+        maMinLengthFT.SetText( maMainPwdStr );
+        maMinLengthFT.Show();
+    }
 }
 
 // -----------------------------------------------------------------------
@@ -130,6 +153,7 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
 void SfxPasswordDialog::SetMinLen( USHORT nLen )
 {
     mnMinLen = nLen;
+    SetPasswdText();
     EditModifyHdl( NULL );
 }
 
@@ -189,8 +213,10 @@ short SfxPasswordDialog::Execute()
             aPos = maUserED.GetPosPixel();
             maPasswordED.SetPosPixel( aPos );
 
+            aPos = maConfirmFT.GetPosPixel();
             maConfirmFT.SetPosPixel( aPwdPos1 );
             maConfirmED.SetPosPixel( aPwdPos2 );
+            maMinLengthFT.SetPosPixel(aPos);
         }
 
         Size aBoxSize = maPasswordBox.GetSizePixel();
diff --git sfx2/source/dialog/passwd.hrc sfx2/source/dialog/passwd.hrc
index 7c96e13..059619a 100644
--- sfx2/source/dialog/passwd.hrc
+++ sfx2/source/dialog/passwd.hrc
@@ -36,12 +36,15 @@
 #define ED_PASSWD_PASSWORD 14
 #define FT_PASSWD_CONFIRM 15
 #define ED_PASSWD_CONFIRM 16
+#define FT_PASSWD_MINLEN 17
 
 #define BTN_PASSWD_OK 20
 #define BTN_PASSWD_CANCEL 21
 #define BTN_PASSWD_HELP 22
 
 #define STR_PASSWD_CONFIRM 30
+#define STR_PASSWD_MIN_LEN	31
+#define STR_PASSWD_EMPTY	32
 
 #endif
 
diff --git sfx2/source/dialog/passwd.src sfx2/source/dialog/passwd.src
index b95c14c..b335bf0 100644
--- sfx2/source/dialog/passwd.src
+++ sfx2/source/dialog/passwd.src
@@ -77,6 +77,22 @@ ModalDialog DLG_PASSWD
         Pos = MAP_APPFONT( 57, 44 );
         Size = MAP_APPFONT( 75, 12 );
     };
+
+    String STR_PASSWD_MIN_LEN
+    {
+        Text [ en-US ] = "(Minimum $(MINLEN) characters)" ;
+    };
+    String STR_PASSWD_EMPTY
+    {
+        Text [ en-US ] = "(The password can be empty)" ;
+    };
+
+    FixedText FT_PASSWD_MINLEN
+    {
+        Pos = MAP_APPFONT(12, 65 );
+        Size = MAP_APPFONT( 126, 10 );
+    };
+
     FixedLine GB_PASSWD_PASSWORD
     {
         Pos = MAP_APPFONT( 6, 3 );
-- 
1.7.0.1

