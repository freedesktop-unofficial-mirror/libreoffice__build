diff --git oox/inc/oox/drawingml/customshapeproperties.hxx oox/inc/oox/drawingml/customshapeproperties.hxx
index 4bd9381..387c072 100644
--- oox/inc/oox/drawingml/customshapeproperties.hxx
+++ oox/inc/oox/drawingml/customshapeproperties.hxx
@@ -74,6 +74,7 @@ public:
             const ::com::sun::star::uno::Reference < ::com::sun::star::beans::XPropertySet > & xPropSet,
                         const ::com::sun::star::uno::Reference < ::com::sun::star::drawing::XShape > & xShape) const;
 
+    const rtl::OUString getShapePresetType() const { return maShapePresetType; }
     void setShapePresetType( const rtl::OUString& rShapePresetType ){ maShapePresetType = rShapePresetType; };
     std::vector< CustomShapeGuide >& getAdjustmentValues(){ return maAdjustmentValues; };
 
diff --git oox/inc/oox/drawingml/shape.hxx oox/inc/oox/drawingml/shape.hxx
index 7ba2a44..9adf64b 100644
--- oox/inc/oox/drawingml/shape.hxx
+++ oox/inc/oox/drawingml/shape.hxx
@@ -160,6 +160,11 @@ public:
 
     virtual void        applyShapeReference( const Shape& rReferencedShape );
 
+    const ::com::sun::star::awt::Size&
+                        getSize() const { return maSize; }
+    const ::com::sun::star::awt::Point&
+                        getPosition() const { return maPosition; }
+
 protected:
 
     ::com::sun::star::uno::Reference< ::com::sun::star::drawing::XShape >
diff --git oox/source/export/drawingml.cxx oox/source/export/drawingml.cxx
index e4e8fba..659ce4c 100644
--- oox/source/export/drawingml.cxx
+++ oox/source/export/drawingml.cxx
@@ -65,6 +65,7 @@
 #include <tools/string.hxx>
 #include <vcl/cvtgrf.hxx>
 #include <unotools/fontcvt.hxx>
+#include <unotools/fontdefs.hxx>
 #include <vcl/graph.hxx>
 #include <svtools/grfmgr.hxx>
 #include <rtl/strbuf.hxx>
@@ -520,7 +521,7 @@ OUString DrawingML::WriteImage( const Graphic& rGraphic )
             }
 
             aData = aStream.GetData();
-            nDataSize = aStream.GetSize();
+            nDataSize = aStream.GetEndOfData();
             break;
             }
     }
diff --git oox/source/export/preset-definitions-to-shape-types.pl oox/source/export/preset-definitions-to-shape-types.pl
index 0dc98c1..bc5163b 100644
--- oox/source/export/preset-definitions-to-shape-types.pl
+++ oox/source/export/preset-definitions-to-shape-types.pl
@@ -1204,7 +1204,7 @@ print <<EOF;
 //   '$src_text'
 // which are part of the OOXML documentation
 
-#include <svx/escherex.hxx>
+#include <filter/msfilter/escherex.hxx>
 
 const char* pShapeTypes[ ESCHER_ShpInst_COUNT ] =
 {
diff --git oox/source/export/vmlexport.cxx oox/source/export/vmlexport.cxx
index 6da08a2..1223519 100644
--- oox/source/export/vmlexport.cxx
+++ oox/source/export/vmlexport.cxx
@@ -64,7 +64,7 @@ public:
 };
 
 VMLExport::VMLExport( ::sax_fastparser::FSHelperPtr pSerializer )
-    : EscherEx( *( new SvNullStream ), 0 ),
+    : EscherEx( EscherExGlobalRef(new EscherExGlobal(0)), *( new SvNullStream ) ),
       m_pSerializer( pSerializer ),
       m_pShapeAttrList( NULL ),
       m_nShapeType( ESCHER_ShpInst_Nil ),
@@ -128,6 +128,9 @@ void VMLExport::CloseContainer()
 
 UINT32 VMLExport::EnterGroup( const String& rShapeName, const Rectangle* pRect )
 {
+#if 1 // FIXME dev300-m77 please fix this.
+    return 0;
+#else
     UINT32 nShapeId = GetShapeID();
 
     OStringBuffer aStyle( 200 );
@@ -163,6 +166,7 @@ UINT32 VMLExport::EnterGroup( const String& rShapeName, const Rectangle* pRect )
 
     mnGroupLevel++;
     return nShapeId;
+#endif
 }
 
 void VMLExport::LeaveGroup()
diff --git oox/util/makefile.mk oox/util/makefile.mk
index 33c53d1..977b3b9 100644
--- oox/util/makefile.mk
+++ oox/util/makefile.mk
@@ -74,7 +74,9 @@ SHL1STDLIBS= \
         $(GOODIESLIB)		\
         $(SVTOOLLIB)		\
         $(SVXCORELIB)		\
-        $(SVXMSFILTERLIB)	\
+        $(SVLLIB)		\
+        $(UNOTOOLSLIB)		\
+        $(MSFILTERLIB)	\
         $(TOOLSLIB)
 
 # link openssl, copied this bit from ucb/source/ucp/webdav/makefile.mk
