---
 oox/inc/oox/export/drawingml.hxx                   |    2 +-
 oox/inc/oox/export/vmlexport.hxx                   |    2 +-
 oox/prj/build.lst                                  |    2 +-
 oox/source/export/drawingml.cxx                    |    6 +++---
 .../export/preset-definitions-to-shape-types.pl    |    2 +-
 oox/source/export/shapes.cxx                       |    4 ++--
 oox/source/export/vmlexport.cxx                    |    6 +++++-
 oox/util/makefile.mk                               |    4 +++-
 10 files changed, 23 insertions(+), 11 deletions(-)

diff --git oox/inc/oox/export/drawingml.hxx oox/inc/oox/export/drawingml.hxx
index 211c90e..10397a5 100644
--- oox/inc/oox/export/drawingml.hxx
+++ oox/inc/oox/export/drawingml.hxx
@@ -7,7 +7,7 @@
 #include <com/sun/star/awt/FontDescriptor.hpp>
 #include <com/sun/star/uno/XReference.hpp>
 #include <tools/poly.hxx>
-#include <svx/escherex.hxx>
+#include <filter/msfilter/escherex.hxx>
 
 class Graphic;
 class String;
diff --git oox/inc/oox/export/vmlexport.hxx oox/inc/oox/export/vmlexport.hxx
index b749297..cde0224 100644
--- oox/inc/oox/export/vmlexport.hxx
+++ oox/inc/oox/export/vmlexport.hxx
@@ -27,7 +27,7 @@
 
 #include <oox/dllapi.h>
 #include <sax/fshelper.hxx>
-#include <svx/escherex.hxx>
+#include <filter/msfilter/escherex.hxx>
 
 namespace rtl {
     class OString;
diff --git oox/prj/build.lst oox/prj/build.lst
index 0a15fd9..b254e14 100644
--- oox/prj/build.lst
+++ oox/prj/build.lst
@@ -1,4 +1,4 @@
-oox	oox : vos cppu cppuhelper comphelper sal offapi sax basegfx svx xmlscript tools vcl unotools BOOST:boost OPENSSL:openssl NULL
+oox	oox : vos cppu cppuhelper comphelper sal offapi sax basegfx svx xmlscript tools vcl filter unotools BOOST:boost OPENSSL:openssl NULL
 oox	oox				usr1	-   all	oox_mkout NULL
 oox	oox\prj				get	-   all	oox_prj NULL
 oox	oox\source\token		nmake	-   all	oox_token NULL
diff --git oox/source/export/drawingml.cxx oox/source/export/drawingml.cxx
index bd4854a..f19a393 100644
--- oox/source/export/drawingml.cxx
+++ oox/source/export/drawingml.cxx
@@ -65,13 +65,13 @@
 #include <tools/string.hxx>
 #include <vcl/cvtgrf.hxx>
 #include <unotools/fontcvt.hxx>
+#include <unotools/fontdefs.hxx>
 #include <vcl/graph.hxx>
 #include <svtools/grfmgr.hxx>
 #include <rtl/strbuf.hxx>
 #include <sfx2/app.hxx>
 #include <svl/languageoptions.hxx>
-#include <svx/escherex.hxx>
-#include <svx/svxenum.hxx>
+#include <editeng/svxenum.hxx>
 
 using namespace ::com::sun::star;
 using namespace ::com::sun::star::beans;
@@ -520,7 +520,7 @@ OUString DrawingML::WriteImage( const Graphic& rGraphic )
             }
 
             aData = aStream.GetData();
-            nDataSize = aStream.GetSize();
+            nDataSize = aStream.GetEndOfData();
             break;
             }
     }
diff --git oox/source/export/preset-definitions-to-shape-types.pl oox/source/export/preset-definitions-to-shape-types.pl
index 0dc98c1..bc5163b 100644
--- oox/source/export/preset-definitions-to-shape-types.pl
+++ oox/source/export/preset-definitions-to-shape-types.pl
@@ -1204,7 +1204,7 @@ print <<EOF;
 //   '$src_text'
 // which are part of the OOXML documentation
 
-#include <svx/escherex.hxx>
+#include <filter/msfilter/escherex.hxx>
 
 const char* pShapeTypes[ ESCHER_ShpInst_COUNT ] =
 {
diff --git oox/source/export/shapes.cxx oox/source/export/shapes.cxx
index 71d3f9c..fee5abc 100644
--- oox/source/export/shapes.cxx
+++ oox/source/export/shapes.cxx
@@ -66,9 +66,9 @@
 #include <rtl/strbuf.hxx>
 #include <sfx2/app.hxx>
 #include <svl/languageoptions.hxx>
-#include <svx/escherex.hxx>
+#include <filter/msfilter/escherex.hxx>
 #include <svx/svdoashp.hxx>
-#include <svx/svxenum.hxx>
+#include <editeng/svxenum.hxx>
 #include <svx/unoapi.hxx>
 
 using namespace ::com::sun::star;
diff --git oox/source/export/vmlexport.cxx oox/source/export/vmlexport.cxx
index 6da08a2..1223519 100644
--- oox/source/export/vmlexport.cxx
+++ oox/source/export/vmlexport.cxx
@@ -64,7 +64,7 @@ public:
 };
 
 VMLExport::VMLExport( ::sax_fastparser::FSHelperPtr pSerializer )
-    : EscherEx( *( new SvNullStream ), 0 ),
+    : EscherEx( EscherExGlobalRef(new EscherExGlobal(0)), *( new SvNullStream ) ),
       m_pSerializer( pSerializer ),
       m_pShapeAttrList( NULL ),
       m_nShapeType( ESCHER_ShpInst_Nil ),
@@ -128,6 +128,9 @@ void VMLExport::CloseContainer()
 
 UINT32 VMLExport::EnterGroup( const String& rShapeName, const Rectangle* pRect )
 {
+#if 1 // FIXME dev300-m77 please fix this.
+    return 0;
+#else
     UINT32 nShapeId = GetShapeID();
 
     OStringBuffer aStyle( 200 );
@@ -163,6 +166,7 @@ UINT32 VMLExport::EnterGroup( const String& rShapeName, const Rectangle* pRect )
 
     mnGroupLevel++;
     return nShapeId;
+#endif
 }
 
 void VMLExport::LeaveGroup()
diff --git oox/util/makefile.mk oox/util/makefile.mk
index deb8dbb..c932dd3 100644
--- oox/util/makefile.mk
+++ oox/util/makefile.mk
@@ -75,7 +75,9 @@ SHL1STDLIBS= \
         $(GOODIESLIB)		\
         $(SVTOOLLIB)		\
         $(SVXCORELIB)		\
-        $(SVXMSFILTERLIB)	\
+        $(SVLLIB)		\
+        $(UNOTOOLSLIB)		\
+        $(MSFILTERLIB)	\
         $(XMLOFFLIB)	\
         $(TOOLSLIB)
 
-- 
1.7.0.1

