From 4e48363df681294b1ab31dcf2d676cdf47d59d4a Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:58:49 +0200
Subject: [PATCH 338/878] unoxml-reset-secprefs.diff

---
 unoxml/source/rdf/librdf_repository.cxx |    5 +++++
 unoxml/source/rdf/makefile.mk           |    8 ++++++++
 2 files changed, 13 insertions(+), 0 deletions(-)

diff --git a/unoxml/source/rdf/librdf_repository.cxx b/unoxml/source/rdf/librdf_repository.cxx
index b42d02f..61ea858 100644
--- a/unoxml/source/rdf/librdf_repository.cxx
+++ b/unoxml/source/rdf/librdf_repository.cxx
@@ -52,6 +52,7 @@
 #include <rtl/ustring.hxx>
 
 #include <librdf.h>
+#include <libxslt/security.h>
 
 #include <boost/utility.hpp>
 #include <boost/shared_ptr.hpp>
@@ -1974,7 +1975,11 @@ librdf_world *librdf_TypeConverter::createWorld() const
             m_rRep);
     }
     //FIXME logger, digest, features?
+    xsltSecurityPrefsPtr origprefs = xsltGetDefaultSecurityPrefs();
     librdf_world_open(pWorld);
+    xsltSecurityPrefsPtr newprefs = xsltGetDefaultSecurityPrefs();
+    if (newprefs != origprefs)
+        xsltSetDefaultSecurityPrefs(origprefs);
     return pWorld;
 }
 
diff --git a/unoxml/source/rdf/makefile.mk b/unoxml/source/rdf/makefile.mk
index 5f33b5c..fac7d48 100644
--- a/unoxml/source/rdf/makefile.mk
+++ b/unoxml/source/rdf/makefile.mk
@@ -41,6 +41,13 @@ ENABLE_EXCEPTIONS=TRUE
 CFLAGS+=-DSYSTEM_REDLAND $(REDLAND_CFLAGS)
 .ENDIF
 
+.IF "$(SYSTEM_LIBXSLT)" == "YES"
+CFLAGS+= $(LIBXSLT_CFLAGS)
+.ELSE
+LIBXSLTINCDIR=external$/libxslt
+CFLAGS+= -I$(SOLARINCDIR)$/$(LIBXSLTINCDIR)
+.ENDIF
+
 # --- Files --------------------------------------------------------
 .IF "$(L10N_framework)"==""
 
@@ -64,6 +71,7 @@ DEF1NAME=$(SHL1TARGET)
 
 SHL1STDLIBS= \
     $(REDLANDLIB) \
+    $(XSLTLIB) \
     $(CPPUHELPERLIB) \
     $(CPPULIB)	\
     $(SALLIB) \
-- 
1.7.0.1

