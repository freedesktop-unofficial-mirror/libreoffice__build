dlopen libs with global symbol namespace

From: Thorsten Behrens <thb@openoffice.org>


---

 sc/source/ui/attrdlg/scabstdlg.cxx |    3 ++-
 sc/source/ui/docshell/impex.cxx    |    3 ++-
 sd/source/filter/sdfilter.cxx      |    3 ++-
 sd/source/ui/dlg/sdabstdlg.cxx     |    3 ++-
 sw/source/filter/basflt/fltini.cxx |    3 ++-
 sw/source/ui/dialog/swabstdlg.cxx  |    3 ++-
 vcl/source/window/abstdlg.cxx      |    3 ++-
 7 files changed, 14 insertions(+), 7 deletions(-)


diff --git sc/source/ui/attrdlg/scabstdlg.cxx sc/source/ui/attrdlg/scabstdlg.cxx
index abb1d31..eb30872 100644
--- sc/source/ui/attrdlg/scabstdlg.cxx
+++ sc/source/ui/attrdlg/scabstdlg.cxx
@@ -50,7 +50,8 @@ ScAbstractDialogFactory* ScAbstractDialogFactory::Create()
     OUStringBuffer aStrBuf;
     aStrBuf.appendAscii( SVLIBRARY("scui") );
 
-    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, aStrBuf.makeStringAndClear() ) )
+    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, aStrBuf.makeStringAndClear(),
+                                                             SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY ) )
         fp = ( ScAbstractDialogFactory* (__LOADONCALLAPI*)() )
             aDialogLibrary.getFunctionSymbol( ::rtl::OUString::createFromAscii("CreateDialogFactory") );
     if ( fp )
diff --git sc/source/ui/docshell/impex.cxx sc/source/ui/docshell/impex.cxx
index 8dc8646..26aa5d1 100644
--- sc/source/ui/docshell/impex.cxx
+++ sc/source/ui/docshell/impex.cxx
@@ -2105,7 +2105,8 @@ ScFormatFilterPlugin &ScFormatFilter::Get()
 
     static ::osl::Module aModule;
     if ( aModule.loadRelative( &thisModule,
-                   ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SVLIBRARY( "scfilt" ) ) ) ) )
+                   ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SVLIBRARY( "scfilt" ) ) ),
+                               SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY ) )
     {
     oslGenericFunction fn = aModule.getFunctionSymbol( ::rtl::OUString::createFromAscii( "ScFilterCreate" ) );
     if (fn != NULL)
diff --git sd/source/filter/sdfilter.cxx sd/source/filter/sdfilter.cxx
index 9e6860f..6aec89c 100644
--- sd/source/filter/sdfilter.cxx
+++ sd/source/filter/sdfilter.cxx
@@ -95,7 +95,8 @@ extern "C" { static void SAL_CALL thisModule() {} }
 ::osl::Module* SdFilter::OpenLibrary( const ::rtl::OUString& rLibraryName ) const
 {
     std::auto_ptr< osl::Module > mod(new osl::Module);
-    return mod->loadRelative(&thisModule, ImplGetFullLibraryName(rLibraryName))
+    return mod->loadRelative(&thisModule, ImplGetFullLibraryName(rLibraryName),
+                             SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY)
         ? mod.release() : 0;
 }
 
diff --git sd/source/ui/dlg/sdabstdlg.cxx sd/source/ui/dlg/sdabstdlg.cxx
index 1b1418c..2369fca 100644
--- sd/source/ui/dlg/sdabstdlg.cxx
+++ sd/source/ui/dlg/sdabstdlg.cxx
@@ -45,7 +45,8 @@ SdAbstractDialogFactory* SdAbstractDialogFactory::Create()
 {
     SdFuncPtrCreateDialogFactory fp = 0;
     static ::osl::Module aDialogLibrary;
-    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, String( RTL_CONSTASCII_USTRINGPARAM( DLL_NAME ) ) ) )
+    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, String( RTL_CONSTASCII_USTRINGPARAM( DLL_NAME ) ),
+                                                             SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY ) )
         fp = ( SdAbstractDialogFactory* (__LOADONCALLAPI*)() )
             aDialogLibrary.getFunctionSymbol( ::rtl::OUString::createFromAscii("CreateDialogFactory") );
     if ( fp )
diff --git sw/source/filter/basflt/fltini.cxx sw/source/filter/basflt/fltini.cxx
index 4e55ee6..4a2869f 100644
--- sw/source/filter/basflt/fltini.cxx
+++ sw/source/filter/basflt/fltini.cxx
@@ -961,7 +961,8 @@ static oslGenericFunction GetMswordLibSymbol( const char *pSymbol )
     static ::osl::Module aModule;
     if ( aModule.is() ||
          aModule.loadRelative( &thisModule,
-             ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SVLIBRARY( "msword" ) ) ) ) )
+             ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SVLIBRARY( "msword" ) ) ),
+                               SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY ) )
     {
         return aModule.getFunctionSymbol( ::rtl::OUString::createFromAscii( pSymbol ) );
     }
diff --git sw/source/ui/dialog/swabstdlg.cxx sw/source/ui/dialog/swabstdlg.cxx
index 596ee4e..68a4c10 100644
--- sw/source/ui/dialog/swabstdlg.cxx
+++ sw/source/ui/dialog/swabstdlg.cxx
@@ -45,7 +45,8 @@ SwAbstractDialogFactory* SwAbstractDialogFactory::Create()
 {
     SwFuncPtrCreateDialogFactory fp = 0;
     static ::osl::Module aDialogLibrary;
-    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, String( RTL_CONSTASCII_USTRINGPARAM( DLL_NAME ) ) ) )
+    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, String( RTL_CONSTASCII_USTRINGPARAM( DLL_NAME ) ),
+                                                             SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY ) )
         fp = ( SwAbstractDialogFactory* (__LOADONCALLAPI*)() )
             aDialogLibrary.getFunctionSymbol( ::rtl::OUString::createFromAscii("CreateDialogFactory") );
     if ( fp )
diff --git vcl/source/window/abstdlg.cxx vcl/source/window/abstdlg.cxx
index 5c3a500..057cadc 100644
--- vcl/source/window/abstdlg.cxx
+++ vcl/source/window/abstdlg.cxx
@@ -45,7 +45,8 @@ VclAbstractDialogFactory* VclAbstractDialogFactory::Create()
 {
     FuncPtrCreateDialogFactory fp = 0;
     static ::osl::Module aDialogLibrary;
-    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, String( RTL_CONSTASCII_USTRINGPARAM( DLL_NAME ) ) ) )
+    if ( aDialogLibrary.is() || aDialogLibrary.loadRelative( &thisModule, String( RTL_CONSTASCII_USTRINGPARAM( DLL_NAME ) ),
+                                                             SAL_LOADMODULE_GLOBAL | SAL_LOADMODULE_LAZY ) )
         fp = ( VclAbstractDialogFactory* (__LOADONCALLAPI*)() )
             aDialogLibrary.getFunctionSymbol( ::rtl::OUString::createFromAscii("CreateDialogFactory") );
     if ( fp )
