From 35d80873a034c96187418ddd6dbe52d604168be3 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:58:50 +0200
Subject: [PATCH 302/768] fix-system-mythes-for-mythes-1.2.diff

---
 configure.in       |   22 ++++++++++++++++++----
 set_soenv.in       |    2 ++
 solenv/inc/libs.mk |    4 ++++
 3 files changed, 24 insertions(+), 4 deletions(-)

diff --git configure.in configure.in
index 0d5fabc..c4f37b9 100644
--- configure.in
+++ configure.in
@@ -5231,15 +5231,29 @@ AC_MSG_CHECKING([which mythes to use])
 if test -n "$with_system_mythes" && test "$with_system_mythes" != "no"; then
     AC_MSG_RESULT([external])
     SYSTEM_MYTHES=YES
-    AC_CHECK_HEADER(mythes.hxx, [],
-       [ AC_MSG_ERROR(mythes.hxx headers not found.)], [])
-    AC_CHECK_LIB(mythes, main, [],
-        [ AC_MSG_ERROR(mythes library not found.)], [])
+    AC_LANG_PUSH([C++])
+    PKG_CHECK_MODULES(MYTHES, mythes, MYTHES_PKGCONFIG=yes, MYTHES_PKGCONFIG=no)
+    if test "$MYTHES_PKGCONFIG" = "no"; then
+        AC_CHECK_HEADER(mythes.hxx, [],
+            [ AC_MSG_ERROR(mythes.hxx headers not found.)], [])
+        AC_CHECK_LIB(mythes-1.2, main, [],
+            [ MYTHES_FOUND=no], [])
+    if test "$MYTHES_FOUND" = "no"; then
+            AC_CHECK_LIB(mythes, main, [MYTHES_FOUND=yes],
+                [ MYTHES_FOUND=no], [])
+    fi
+    if test "$MYTHES_FOUND" = "no"; then
+        AC_MSG_ERROR([mythes library not found!.])
+    fi
+    fi
+    AC_LANG_POP([C++])
 else
     AC_MSG_RESULT([internal])
     SYSTEM_MYTHES=NO
 fi
 AC_SUBST(SYSTEM_MYTHES)
+AC_SUBST(MYTHES_CFLAGS)
+AC_SUBST(MYTHES_LIBS)
 
 dnl ===================================================================
 dnl Checking for lpsolve
diff --git set_soenv.in set_soenv.in
index cda1deb..d8f68c1 100644
--- set_soenv.in
+++ set_soenv.in
@@ -1894,6 +1894,8 @@ ToFile( "SYSTEM_LPSOLVE",    "@SYSTEM_LPSOLVE@",   "e" );
 ToFile( "SYSTEM_HYPH",       "@SYSTEM_HYPH@",      "e" );
 ToFile( "HYPHEN_LIB",        "@HYPHEN_LIB@",       "e" );
 ToFile( "SYSTEM_MYTHES",     "@SYSTEM_MYTHES@",    "e" );
+ToFile( "MYTHES_CFLAGS",     "@MYTHES_CFLAGS@",    "e" );
+ToFile( "MYTHES_LIBS",       "@MYTHES_LIBS@",      "e" );
 ToFile( "PAM",               "@PAM@",              "e" );
 ToFile( "NEW_SHADOW_API",    "@NEW_SHADOW_API@",   "e" );
 ToFile( "PAM_LINK",          "@PAM_LINK@",         "e" );
diff --git solenv/inc/libs.mk solenv/inc/libs.mk
index b835f52..3c014a8 100644
--- solenv/inc/libs.mk
+++ solenv/inc/libs.mk
@@ -342,7 +342,11 @@ HUNSPELLLIB=$(HUNSPELL_LIBS)
 .ELSE
 HUNSPELLLIB=-lhunspell-1.2
 .ENDIF
+.IF "$(SYSTEM_MYTHES)" == "YES"
+MYTHESLIB=$(MYTHES_LIBS)
+.ELSE
 MYTHESLIB=-lmythes
+.ENDIF
 PYUNOLIB=-lpyuno
 LPSOLVELIB=-llpsolve55
 SOFFICELIB=-lsofficeapp
-- 
1.7.0.1

