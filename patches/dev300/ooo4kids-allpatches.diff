ooo4kids all in one patch

From: Eric Bachard <ericb@openoffice.org>


---

 .../org/openoffice/accessibility/makefile.mk       |    4 
 .../org/openoffice/java/accessibility/makefile.mk  |    5 
 accessibility/bridge/source/java/makefile.mk       |    5 
 apple_remote/AppleRemote.m                         |   45 
 apple_remote/HIDRemoteControlDevice.m              |   10 
 apple_remote/MultiClickRemoteBehavior.m            |    2 
 apple_remote/RemoteMainController.m                |    9 
 apple_remote/inc/RemoteControl.h                   |    5 
 apple_remote/makefile2.pmk                         |   35 
 automation/packimages/makefile.mk                  |    5 
 automation/source/app/makefile.mk                  |    5 
 automation/source/communi/makefile.mk              |    5 
 automation/source/miniapp/makefile.mk              |    5 
 automation/source/mozillaserver/makefile.mk        |    5 
 automation/source/server/makefile.mk               |    7 
 automation/source/simplecm/makefile.mk             |    5 
 automation/source/testtool/makefile.mk             |    5 
 automation/util/makefile.mk                        |    5 
 avmedia/prj/build.lst                              |    3 
 avmedia/source/gstreamer/ChangeLog                 |  112 +
 avmedia/source/gstreamer/exports.dxp               |    4 
 avmedia/source/gstreamer/gstcommon.hxx             |   83 
 avmedia/source/gstreamer/gstframegrabber.cxx       |  244 +
 avmedia/source/gstreamer/gstframegrabber.hxx       |   78 
 avmedia/source/gstreamer/gstmanager.cxx            |  114 +
 avmedia/source/gstreamer/gstmanager.hxx            |   74 
 avmedia/source/gstreamer/gstplayer.cxx             |  639 +++
 avmedia/source/gstreamer/gstplayer.hxx             |  121 +
 avmedia/source/gstreamer/gstuno.cxx                |  111 +
 avmedia/source/gstreamer/gstwindow.cxx             |  365 ++
 avmedia/source/gstreamer/gstwindow.hxx             |  119 +
 avmedia/source/gstreamer/makefile.mk               |   85 
 avmedia/source/inc/mediamisc.hxx                   |    4 
 avmedia/source/viewer/mediawindow.cxx              |    1 
 avmedia/source/viewer/mediawindow_impl.cxx         |   49 
 avmedia/source/viewer/mediawindow_impl.hxx         |    8 
 bean/com/sun/star/beans/makefile.mk                |    9 
 bean/com/sun/star/comp/beans/makefile.mk           |   11 
 bean/native/win32/makefile.mk                      |    5 
 bean/util/makefile.mk                              |    8 
 boost/prj/d.lst                                    |   37 
 .../java/com/sun/star/bridges/jni_uno/makefile.mk  |    6 
 bridges/source/jni_uno/makefile.mk                 |    2 
 canvas/source/cairo/cairo_canvashelper.cxx         |   22 
 chart2/uiconfig/toolbar/average.xml                |   22 
 chart2/uiconfig/toolbar/beginner.xml               |   22 
 chart2/uiconfig/toolbar/chart2_average.xml         |   22 
 chart2/uiconfig/toolbar/chart2_beginner.xml        |   22 
 cli_ure/source/basetypes/makefile.mk               |    7 
 cli_ure/source/climaker/makefile.mk                |    8 
 cli_ure/source/native/makefile.mk                  |    2 
 cli_ure/source/ure/makefile.mk                     |    7 
 cli_ure/unotypes/makefile.mk                       |    7 
 cli_ure/util/makefile.pmk                          |    4 
 configure.in                                       |   81 
 .../com/sun/star/sdbcx/comp/hsqldb/makefile.mk     |    6 
 connectivity/source/commontools/CommonTools.cxx    |    2 
 connectivity/source/drivers/adabas/makefile.mk     |    6 
 connectivity/source/drivers/dbase/makefile.mk      |    6 
 connectivity/source/drivers/evoab2/makefile.mk     |    2 
 connectivity/source/drivers/hsqldb/makefile.mk     |    2 
 connectivity/source/drivers/jdbc/makefile.mk       |    6 
 .../source/drivers/mozab/bootstrap/makefile.mk     |    9 
 connectivity/source/drivers/mozab/makefile.mk      |    2 
 .../source/drivers/mozab/mozillasrc/makefile.mk    |    4 
 connectivity/source/drivers/mysql/makefile.mk      |    6 
 connectivity/source/drivers/odbc/makefile.mk       |    5 
 connectivity/source/drivers/odbcbase/makefile.mk   |    5 
 cppcanvas/inc/cppcanvas/color.hxx                  |   10 
 cppuhelper/source/findsofficepath.c                |    5 
 dbaccess/source/core/api/makefile.mk               |    5 
 dbaccess/source/core/dataaccess/makefile.mk        |    5 
 dbaccess/source/core/misc/makefile.mk              |    5 
 dbaccess/source/core/resource/makefile.mk          |    5 
 dbaccess/source/ext/adabas/makefile.mk             |    6 
 dbaccess/source/ext/macromigration/makefile.mk     |    5 
 dbaccess/source/filter/migration/makefile.mk       |    5 
 dbaccess/source/filter/xml/makefile.mk             |    5 
 dbaccess/source/filter/xml/xmlJavaClassPath.cxx    |  113 +
 dbaccess/source/filter/xml/xmlJavaClassPath.hxx    |   58 
 dbaccess/source/sdbtools/connection/makefile.mk    |    5 
 dbaccess/source/sdbtools/misc/makefile.mk          |    5 
 dbaccess/source/sdbtools/resource/makefile.mk      |    5 
 dbaccess/source/shared/makefile.mk                 |    5 
 dbaccess/source/ui/app/makefile.mk                 |    5 
 dbaccess/source/ui/browser/makefile.mk             |    5 
 dbaccess/source/ui/control/makefile.mk             |    5 
 dbaccess/source/ui/dlg/makefile.mk                 |    5 
 dbaccess/source/ui/misc/makefile.mk                |    5 
 dbaccess/source/ui/querydesign/makefile.mk         |    5 
 dbaccess/source/ui/relationdesign/makefile.mk      |    5 
 dbaccess/source/ui/tabledesign/makefile.mk         |    5 
 dbaccess/source/ui/uno/makefile.mk                 |    5 
 dbaccess/util/makefile.mk                          |    5 
 desktop/scripts/soffice.sh                         |    2 
 desktop/source/app/app.cxx                         |   51 
 desktop/source/app/appfirststart.cxx               |    4 
 desktop/source/app/cmdlineargs.cxx                 |    8 
 desktop/source/app/cmdlineargs.hxx                 |    2 
 desktop/source/app/cmdlinehelp.cxx                 |    4 
 desktop/source/app/copyright_ascii_ooo.c           |   12 
 desktop/source/app/copyright_ascii_sun.c           |   22 
 desktop/source/app/officeipcthread.cxx             |    2 
 desktop/source/deployment/gui/dp_gui_service.cxx   |    8 
 desktop/source/migration/pages.cxx                 |    7 
 desktop/source/migration/services/makefile.mk      |    6 
 desktop/source/splash/makefile.mk                  |   13 
 desktop/source/splash/splash_png.cxx               |  750 ++++
 desktop/source/splash/splash_png.hxx               |  143 +
 desktop/util/ooverinfo.rc                          |   11 
 desktop/util/ooverinfo2.rc                         |    4 
 desktop/util/template.manifest                     |    2 
 desktop/util/verinfo.rc                            |    8 
 desktop/win32/source/applauncher/ooo/makefile.mk   |    2 
 desktop/zipintro/makefile.mk                       |   40 
 dictionaries/de_CH/VERSION                         |    1 
 dictionaries/de_DE/VERSION                         |    1 
 dictionaries/zu_ZA/dictionary.lst                  |    1 
 epm/epm-3.7.patch                                  |  512 +--
 filter/source/config/fragments/makefile.mk         |    3 
 filter/source/config/tools/merge/FCFGMerge.cfg     |  125 +
 filter/source/config/tools/merge/FCFGMerge.java    |  128 +
 filter/source/config/tools/merge/Manifest.mf       |    1 
 filter/source/config/tools/merge/Merger.java       |  362 ++
 filter/source/config/tools/merge/makefile.mk       |   95 
 .../config/tools/utils/AnalyzeStartupLog.java      |  324 ++
 filter/source/config/tools/utils/Cache.java        | 2444 +++++++++++++
 filter/source/config/tools/utils/ConfigHelper.java |  297 ++
 filter/source/config/tools/utils/FileHelper.java   |  760 ++++
 filter/source/config/tools/utils/Logger.java       |  172 +
 .../tools/utils/MalformedCommandLineException.java |   46 
 filter/source/config/tools/utils/XMLHelper.java    |  820 ++++
 filter/source/config/tools/utils/makefile.mk       |   68 
 filter/source/svg/makefile.mk                      |    5 
 filter/source/svg/svgfilter.cxx                    |    4 
 filter/source/svg/svgfilter.hxx                    |   12 
 filter/source/xsltfilter/makefile.mk               |    4 
 filter/source/xsltvalidate/makefile.mk             |    2 
 fpicker/source/aqua/FilterHelper.cxx               |    3 
 fpicker/source/aqua/makefile.mk                    |    1 
 fpicker/util/makefile.pmk                          |   35 
 framework/inc/framework.hrc                        |   37 
 .../source/dispatch/windowcommanddispatch.cxx      |    4 
 .../source/inc/dispatch/windowcommanddispatch.hxx  |    5 
 .../source/services/backingwindow-OOo4Kids.cxx     |  662 +++
 framework/source/services/backingwindow.hxx        |   27 
 framework/source/services/fwk_services.src         |  135 -
 framework/source/services/makefile.mk              |    7 
 framework/uiconfig/startmodule/menubar/menubar.xml |   38 
 framework/util/makefile.mk                         |    6 
 graphite/graphite-2.3.1.patch.mingw                |  168 -
 helpcontent2/prj/d.lst                             |    3 
 helpcontent2/settings.pmk                          |    5 
 helpcontent2/source/auxiliary/makefile.mk          |    2 
 helpcontent2/util/sbasic/makefile.mk               |    6 
 helpcontent2/util/sdatabase/makefile.mk            |    5 
 helpcontent2/util/smath/makefile.mk                |    6 
 helpcontent2/util/target.pmk                       |    6 
 hsqldb/makefile.mk                                 |    5 
 hsqldb/patches/i103528.patch                       |   11 
 hsqldb/patches/i104901.patch                       |   27 
 hsqldb/patches/i96823.patch                        |   94 
 hsqldb/patches/i97032.patch                        |   10 
 hsqldb/patches/index.txt                           |   17 
 .../windows/msi_templates/Binary.idt               |    4 
 .../windows/msi_languages/Control.ulf              |   22 
 .../inc_openoffice/windows/msi_languages/Nsis.ulf  |    4 
 .../windows/msi_templates/Binary.idt               |    4 
 .../windows/msi_templates/RegLocat.idt             |   16 
 .../windows/msi_templates/TextStyl.idt             |    2 
 .../inc_openoffice/windows/msi_templates/codes.txt |    2 
 .../inc_sdkoo/windows/msi_templates/RegLocat.idt   |    4 
 instsetoo_native/macosx/make_versioned.sh          |   13 
 instsetoo_native/macosx/makefile.mk                |    5 
 instsetoo_native/util/OOo4Kids.lst                 |  526 +++
 instsetoo_native/util/makefile.mk                  |   48 
 instsetoo_native/util/pack-OOo4Kids.lst            |   23 
 javaunohelper/com/sun/star/comp/helper/makefile.mk |    5 
 .../com/sun/star/comp/juhtest/makefile.mk          |    5 
 javaunohelper/com/sun/star/comp/makefile.mk        |    5 
 .../com/sun/star/lib/uno/adapter/makefile.mk       |    5 
 .../com/sun/star/lib/uno/helper/makefile.mk        |    5 
 javaunohelper/source/makefile.mk                   |    2 
 javaunohelper/util/makefile.mk                     |    5 
 jurt/com/sun/star/comp/bridgefactory/makefile.mk   |    5 
 jurt/com/sun/star/comp/connections/makefile.mk     |    5 
 jurt/com/sun/star/comp/loader/makefile.mk          |    5 
 jurt/com/sun/star/comp/servicemanager/makefile.mk  |    5 
 jurt/com/sun/star/comp/urlresolver/makefile.mk     |    5 
 jurt/com/sun/star/lib/connections/pipe/makefile.mk |    5 
 .../sun/star/lib/connections/socket/makefile.mk    |    5 
 .../star/lib/uno/bridges/java_remote/makefile.mk   |    5 
 .../sun/star/lib/uno/environments/java/makefile.mk |    5 
 .../star/lib/uno/environments/remote/makefile.mk   |    6 
 jurt/com/sun/star/lib/uno/makefile.mk              |    5 
 .../com/sun/star/lib/uno/protocols/urp/makefile.mk |    5 
 jurt/com/sun/star/lib/util/makefile.mk             |    5 
 jurt/com/sun/star/uno/makefile.mk                  |    5 
 jurt/source/pipe/makefile.mk                       |    2 
 jvmaccess/inc/jvmaccess/classpath.hxx              |    2 
 jvmaccess/inc/jvmaccess/virtualmachine.hxx         |    3 
 jvmaccess/source/classpath.cxx                     |    6 
 jvmaccess/source/unovirtualmachine.cxx             |    6 
 jvmaccess/source/virtualmachine.cxx                |    6 
 jvmaccess/util/gcc3.map                            |    4 
 jvmaccess/util/msvc_win32_intel.map                |    1 
 jvmfwk/inc/jvmfwk/framework.h                      |    2 
 jvmfwk/inc/jvmfwk/vendorplugin.h                   |    2 
 jvmfwk/plugins/sunmajor/pluginlib/makefile.mk      |    2 
 .../plugins/sunmajor/pluginlib/sunjavaplugin.cxx   |   15 
 jvmfwk/source/elements.cxx                         |    5 
 jvmfwk/source/framework.cxx                        |   12 
 jvmfwk/source/javasettings_template.xml            |    6 
 .../libtextcat-2.2-gdium-mips-workaround.patch     |   22 
 libtextcat/makefile.mk                             |    3 
 lucene/makefile.mk                                 |    4 
 offapi/com/sun/star/awt/SystemPointer.idl          |    5 
 offapi/com/sun/star/presentation/XSlideShow.idl    |   19 
 offapi/util/makefile.mk                            |    4 
 .../registry/data/org/openoffice/Office/Common.xcu |   15 
 .../registry/data/org/openoffice/Office/Jobs.xcu   |   45 
 .../org/openoffice/Office/UI/CalcWindowState.xcu   |  100 -
 .../org/openoffice/Office/UI/DrawWindowState.xcu   |  138 +
 .../org/openoffice/Office/UI/GenericCommands.xcu   |   13 
 .../org/openoffice/Office/UI/WriterWindowState.xcu |  240 +
 .../registry/data/org/openoffice/Office/Views.xcu  |   39 
 officecfg/registry/data/org/openoffice/Setup.xcu   |    4 
 .../schema/org/openoffice/Office/Common.xcs        |   64 
 .../schema/org/openoffice/Office/Impress.xcs       |    2 
 .../schema/org/openoffice/Office/Writer.xcs        |   22 
 openssl/makefile.mk                                |    6 
 packimages/pack/image-OOo4Kids-sort.lst            |  314 ++
 packimages/pack/makefile.mk                        |   26 
 .../macosx/macosx_menubar_modification.xsl         |    3 
 postprocess/rebase/makefile.mk                     |    4 
 qadevOOo/makefile.mk                               |    7 
 qadevOOo/runner/makefile.mk                        |    5 
 readlicense_oo/docs/readme/makefile.mk             |    7 
 readlicense_oo/docs/readme/readme_OOo4Kids.xrm     |  300 ++
 readlicense_oo/html/THIRDPARTYLICENSEREADME.html   |   28 
 readlicense_oo/source/license/license_en-US.html   |  180 -
 readlicense_oo/source/license/license_en-US.txt    |    9 
 readlicense_oo/util/makefile.pmk                   |   10 
 reportdesign/source/core/api/makefile.mk           |    7 
 reportdesign/source/core/misc/makefile.mk          |    6 
 reportdesign/source/core/resource/makefile.mk      |    5 
 reportdesign/source/core/sdr/makefile.mk           |    6 
 reportdesign/source/filter/xml/makefile.mk         |    6 
 reportdesign/source/ui/dlg/makefile.mk             |    4 
 reportdesign/source/ui/inspection/makefile.mk      |    4 
 reportdesign/source/ui/misc/makefile.mk            |    5 
 reportdesign/source/ui/report/makefile.mk          |    5 
 reportdesign/util/makefile.mk                      |    6 
 ridljar/com/makefile.mk                            |    9 
 ridljar/javamaker/makefile.mk                      |    5 
 .../com/sun/star/lib/unoloader/makefile.mk         |    5 
 ridljar/source/unoloader/makefile.mk               |    5 
 ridljar/util/makefile.mk                           |    5 
 sandbox/com/sun/star/lib/sandbox/makefile.mk       |    4 
 sandbox/util/makefile.mk                           |    6 
 saxon/makefile.mk                                  |    5 
 sc/inc/address.hxx                                 |   17 
 sc/source/core/data/global.cxx                     |  158 +
 sc/source/ui/view/tabvwsh4.cxx                     |    4 
 sc/uiconfig/scalc/menubar/menubar.xml              |  294 --
 sc/uiconfig/scalc/toolbar/average.xml              |   49 
 sc/uiconfig/scalc/toolbar/beginner.xml             |   49 
 sc/uiconfig/scalc/toolbar/calc_average.xml         |   49 
 sc/uiconfig/scalc/toolbar/calc_beginner.xml        |   49 
 sc/uiconfig/scalc/toolbar/formatobjectbar.xml      |   60 
 sc/uiconfig/scalc/toolbar/standardbar.xml          |   37 
 scp2/source/base/file_base.scp                     |    3 
 scp2/source/base/makefile.mk                       |    5 
 scp2/source/binfilter/makefile.mk                  |    5 
 scp2/source/impress/makefile.mk                    |    4 
 scp2/source/impress/module_impress.scp             |    3 
 scp2/source/impress/module_ogltrans.scp            |    4 
 scp2/source/javafilter/makefile.mk                 |    9 
 scp2/source/math/file_math.scp                     |    2 
 scp2/source/math/makefile.mk                       |    4 
 scp2/source/ooo/common_brand.scp                   |   55 
 scp2/source/ooo/directory_ooo.scp                  |   21 
 scp2/source/ooo/file_extra_ooo.scp                 |   14 
 scp2/source/ooo/file_library_ooo.scp               |   55 
 scp2/source/ooo/file_ooo.scp                       |   81 
 scp2/source/ooo/file_resource_ooo.scp              |    2 
 scp2/source/ooo/folderitem_ooo.ulf                 |    2 
 scp2/source/ooo/makefile.mk                        |   11 
 scp2/source/ooo/module_hidden_ooo.scp              |    5 
 scp2/source/ooo/ooo_brand.scp                      |    5 
 scp2/source/ooo/profileitem_ooo.scp                |    4 
 scp2/source/ooo/registryitem_ooo.scp               |   48 
 scp2/source/ooo/registryitem_ooo.ulf               |    2 
 scp2/source/ooo/scpaction_ooo.scp                  |   13 
 scp2/source/ooo/shortcut_ooo.scp                   |    4 
 scp2/source/ooo/ure.scp                            |   58 
 scp2/source/ooo/ure_standalone.scp                 |   12 
 scp2/source/quickstart/registryitem_quickstart.scp |    4 
 scp2/source/sdkoo/makefile.mk                      |    5 
 scp2/source/sdkoo/sdkoo.scp                        |    4 
 scp2/source/testtool/makefile.mk                   |    5 
 scp2/source/writer/makefile.mk                     |    4 
 scp2/util/makefile.mk                              |   64 
 scripting/examples/java/makefile.mk                |    5 
 scripting/examples/makefile.mk                     |    7 
 scripting/java/makefile.mk                         |    6 
 scripting/source/basprov/makefile.mk               |    5 
 scripting/source/dlgprov/makefile.mk               |    5 
 sd/source/ui/inc/docprev.hxx                       |    2 
 sd/source/ui/slideshow/makefile.mk                 |    5 
 sd/source/ui/slideshow/slideshow.cxx               |    2 
 sd/source/ui/slideshow/slideshow.hrc               |   22 
 sd/source/ui/slideshow/slideshow.src               |  128 +
 sd/source/ui/slideshow/slideshowimpl.cxx           |  411 ++
 sd/source/ui/slideshow/slideshowimpl.hxx           |   17 
 sd/uiconfig/sdraw/accelerator/de/default.xml       |   63 
 sd/uiconfig/sdraw/accelerator/en-GB/default.xml    |   63 
 sd/uiconfig/sdraw/accelerator/en-US/default.xml    |   63 
 sd/uiconfig/sdraw/accelerator/es/default.xml       |   63 
 sd/uiconfig/sdraw/accelerator/fr/default.xml       |   63 
 sd/uiconfig/sdraw/menubar/menubar.xml              |  118 -
 sd/uiconfig/sdraw/toolbar/average.xml              |   37 
 sd/uiconfig/sdraw/toolbar/beginner.xml             |   37 
 sd/uiconfig/sdraw/toolbar/draw_average.xml         |   37 
 sd/uiconfig/sdraw/toolbar/draw_beginner.xml        |   37 
 sd/uiconfig/sdraw/toolbar/drawingobjectbar.xml     |    2 
 sd/uiconfig/sdraw/toolbar/standardbar.xml          |   26 
 sd/uiconfig/simpress/accelerator/de/default.xml    |   11 
 sd/uiconfig/simpress/accelerator/default.xml       |   71 
 sd/uiconfig/simpress/accelerator/es/default.xml    |    9 
 sd/uiconfig/simpress/accelerator/fr/default.xml    |    4 
 sd/uiconfig/simpress/menubar/menubar.xml           |    4 
 sd/uiconfig/simpress/toolbar/average.xml           |   39 
 sd/uiconfig/simpress/toolbar/beginner.xml          |   39 
 sd/uiconfig/simpress/toolbar/impress_average.xml   |   39 
 sd/uiconfig/simpress/toolbar/impress_beginner.xml  |   39 
 set_soenv.in                                       |   12 
 setup_native/scripts/update.sh                     |    2 
 setup_native/scripts/userland.txt                  |    2 
 setup_native/source/packinfo/package_names.txt     |   91 
 setup_native/source/packinfo/packinfo_brand.txt    |   30 
 setup_native/source/packinfo/packinfo_office.txt   |  256 +
 .../source/packinfo/packinfo_office_lang.txt       |  104 -
 setup_native/source/packinfo/packinfo_sdkoo.txt    |    8 
 setup_native/source/packinfo/packinfo_ure.txt      |    8 
 .../source/packinfo/shellscripts_brand.txt         |    8 
 .../source/packinfo/shellscripts_core01.txt        |   14 
 .../source/packinfo/spellchecker_selection.txt     |   12 
 .../win32/customactions/relnotes/makefile.mk       |    5 
 .../win32/customactions/relnotes/relnotes.cxx      |    3 
 setup_native/source/win32/stwrapper/resource.rc    |   14 
 setup_native/source/win32/stwrapper/stwrapper.cxx  |    2 
 sfx2/inc/sfx2/passwd.hxx                           |   20 
 sfx2/inc/sfx2/sfx.hrc                              |   11 
 sfx2/inc/sfx2/sfxsids.hrc                          |   10 
 sfx2/inc/showlicense.hxx                           |   85 
 sfx2/sdi/appslots.sdi                              |    4 
 sfx2/sdi/sfx.sdi                                   |   25 
 sfx2/source/appl/appserv.cxx                       |   95 
 sfx2/source/appl/appuno.cxx                        |    5 
 sfx2/source/appl/newhelp.cxx                       |    3 
 sfx2/source/appl/sfxhelp.cxx                       |    4 
 sfx2/source/appl/shutdownicon.hxx                  |    2 
 sfx2/source/appl/shutdowniconaqua.mm               |    7 
 sfx2/source/appl/shutdowniconunx.cxx               |    4 
 sfx2/source/appl/shutdowniconw32.cxx               |    4 
 sfx2/source/appl/workwin.cxx                       |  149 +
 sfx2/source/control/bindings.cxx                   |    4 
 sfx2/source/dialog/about.cxx                       |   82 
 sfx2/source/dialog/dialog.hrc                      |    1 
 sfx2/source/dialog/makefile.mk                     |   11 
 sfx2/source/dialog/passwd.cxx                      |  285 +
 sfx2/source/dialog/passwd.hrc                      |   14 
 sfx2/source/dialog/passwd.src                      |   67 
 sfx2/source/dialog/passwd_OOo4Kids.cxx             |  468 ++
 sfx2/source/dialog/showlicense.cxx                 |  436 ++
 sfx2/source/doc/sfxbasemodel.cxx                   |   37 
 sfx2/util/makefile.mk                              |    4 
 shell/source/unix/misc/senddoc.sh                  |   33 
 shell/source/unix/sysshell/systemshell.cxx         |  151 +
 slideshow/prj/build.lst                            |    4 
 .../engine/OGLTrans/OGLTrans_TransitionImpl.cxx    | 1318 -------
 .../engine/OGLTrans/OGLTrans_TransitionImpl.hxx    |  509 ---
 .../engine/OGLTrans/OGLTrans_TransitionerImpl.cxx  | 1487 --------
 .../engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.h  |   94 
 .../engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.m  |  236 +
 .../OGLTrans/mac/OGLTrans_TransitionImpl.hxx       |  501 +++
 .../OGLTrans/mac/OGLTrans_TransitionImpl_MACOSX.mm | 1329 +++++++
 .../mac/OGLTrans_TransitionerImpl_MACOSX.mm        | 1137 ++++++
 .../source/engine/OGLTrans/mac/aquaOpenGLView.h    |   36 
 .../source/engine/OGLTrans/mac/aquaOpenGLView.m    |  195 +
 slideshow/source/engine/OGLTrans/mac/makefile.mk   |   92 
 slideshow/source/engine/OGLTrans/makefile.mk       |   84 
 .../engine/OGLTrans/unx/OGLTrans_Shaders.hxx       |   71 
 .../engine/OGLTrans/unx/OGLTrans_Shaders_LINUX.cxx |  143 +
 .../OGLTrans/unx/OGLTrans_TransitionImpl.cxx       | 1318 +++++++
 .../OGLTrans/unx/OGLTrans_TransitionImpl.hxx       |  509 +++
 .../unx/OGLTrans_TransitionerImpl_LINUX.cxx        | 1487 ++++++++
 slideshow/source/engine/OGLTrans/unx/makefile.mk   |   76 
 .../engine/OGLTrans/win/OGLTrans_Shaders.hxx       |   71 
 .../engine/OGLTrans/win/OGLTrans_Shaders_WNT.cxx   |  143 +
 .../OGLTrans/win/OGLTrans_TransitionImpl.cxx       | 1321 +++++++
 .../OGLTrans/win/OGLTrans_TransitionImpl.hxx       |  513 +++
 .../OGLTrans/win/OGLTrans_TransitionerImpl_WNT.cxx | 1455 ++++++++
 slideshow/source/engine/OGLTrans/win/makefile.mk   |   76 
 slideshow/source/engine/color.cxx                  |   13 
 slideshow/source/engine/eventmultiplexer.cxx       |   39 
 slideshow/source/engine/makefile.mk                |    4 
 slideshow/source/engine/shapes/shapeimporter.cxx   |  104 +
 slideshow/source/engine/shapes/viewmediashape.cxx  |   33 
 slideshow/source/engine/shapes/viewmediashape.hxx  |    5 
 slideshow/source/engine/slide/slideimpl.cxx        |   84 
 slideshow/source/engine/slide/userpaintoverlay.cxx |  241 +
 slideshow/source/engine/slide/userpaintoverlay.hxx |   12 
 slideshow/source/engine/slideshowimpl.cxx          |  336 ++
 slideshow/source/engine/tools.cxx                  |   32 
 slideshow/source/inc/eventmultiplexer.hxx          |   27 
 slideshow/source/inc/rgbcolor.hxx                  |    3 
 slideshow/source/inc/shapeimporter.hxx             |   22 
 slideshow/source/inc/slide.hxx                     |   15 
 slideshow/source/inc/tools.hxx                     |    3 
 slideshow/source/inc/userpainteventhandler.hxx     |    6 
 solenv/bin/deliver.pl                              |    4 
 solenv/bin/modules/installer/download.pm           |    3 
 solenv/bin/modules/installer/epmfile.pm            |   36 
 solenv/bin/modules/installer/globals.pm            |   10 
 solenv/bin/modules/installer/servicesfile.pm       |    9 
 solenv/bin/modules/installer/windows/msp.pm        |   13 
 solenv/bin/modules/installer/windows/sign.pm       |  277 -
 solenv/bin/modules/installer/ziplist.pm            |    5 
 solenv/bin/modules/packager/globals.pm             |    8 
 solenv/inc/minor.mk                                |   10 
 solenv/inc/settings.mk                             |    4 
 solenv/inc/shlinfo.rc                              |    8 
 solenv/inc/unxlng.mk                               |    5 
 solenv/inc/unxlngi6.mk                             |    9 
 solenv/inc/unxlngmips.mk                           |    5 
 solenv/inc/unxlngppc.mk                            |    2 
 solenv/inc/unxlngppc4.mk                           |    4 
 solenv/inc/unxlngx6.mk                             |   15 
 solenv/inc/unxmacx.mk                              |    9 
 solenv/inc/version.hrc                             |    4 
 solenv/inc/wnt.mk                                  |    3 
 solenv/inc/wntmsci10.mk                            |    4 
 solenv/inc/wntmsci11.mk                            |    4 
 starmath/inc/rect.hxx                              |    5 
 starmath/source/makefile.mk                        |    5 
 starmath/source/node.cxx                           |    3 
 starmath/source/viewhdl.cxx                        |  170 +
 starmath/uiconfig/smath/menubar/menubar.xml        |    1 
 starmath/uiconfig/smath/toolbar/average.xml        |   26 
 starmath/uiconfig/smath/toolbar/beginner.xml       |   26 
 starmath/uiconfig/smath/toolbar/math_average.xml   |   26 
 starmath/uiconfig/smath/toolbar/math_beginner.xml  |   26 
 starmath/util/makefile.mk                          |    5 
 stax/makefile.mk                                   |    7 
 svtools/inc/imgdef.hxx                             |   10 
 svtools/inc/svtools/inettype.hxx                   |    4 
 svtools/inc/svtools/svtools.hrc                    |  210 +
 svtools/source/config/miscopt.cxx                  |   10 
 svtools/source/misc1/inettype.cxx                  |    5 
 svtools/source/misc1/loginerr.cxx                  |   45 
 svtools/source/misc1/mediatyp.src                  |  162 +
 svx/inc/globlmn_tmpl.hrc                           |   10 
 svx/inc/helpid.hrc                                 |   12 
 svx/inc/svx/svxacorr.hxx                           |    4 
 svx/inc/svx/swafopt.hxx                            |    1 
 svx/source/cui/autocdlg.cxx                        |   15 
 svx/source/cui/autocdlg.hrc                        |    1 
 svx/source/cui/autocdlg.hxx                        |    2 
 svx/source/cui/autocdlg.src                        |    4 
 svx/source/cui/cfg.src                             |    4 
 svx/source/cui/makefile.mk                         |    4 
 svx/source/cui/optgdlg.cxx                         |  612 +++
 svx/source/cui/optgdlg.hrc                         |   17 
 svx/source/cui/optgdlg.hxx                         |   53 
 svx/source/cui/optgdlg.src                         |  163 +
 svx/source/cui/tpcolor.cxx                         |    7 
 svx/source/cui/treeopt.cxx                         |  176 +
 svx/source/cui/treeopt.hrc                         |   15 
 svx/source/cui/treeopt.hxx                         |   15 
 svx/source/cui/treeopt.src                         |   92 
 svx/source/editeng/acorrcfg.cxx                    |   14 
 svx/source/editeng/svxacorr.cxx                    |   54 
 svx/source/editeng/swafopt.cxx                     |    2 
 svx/source/inc/dbcharsethelper.hxx                 |   69 
 svx/source/inc/dbtoolsclient.hxx                   |  238 +
 svx/source/intro/intro_tmpl.hrc                    |   26 
 svx/source/intro/iso.src                           |    4 
 svx/source/intro/ooo.src                           |   38 
 svx/source/tbxctrls/tbcontrl.cxx                   |   12 
 svx/source/tbxctrls/tbunocontroller.cxx            |    5 
 sw/inc/bookmrk.hxx                                 |  218 +
 sw/inc/comcore.hrc                                 |    3 
 sw/inc/fmthbsh.hxx                                 |   74 
 sw/inc/swenumdef.hxx                               |   72 
 .../complex/writer/TextPortionEnumerationTest.java | 3871 --------------------
 sw/source/core/doc/docfly.cxx                      |   32 
 sw/source/core/edit/autofmt.cxx                    |    9 
 sw/source/core/text/txtfrm.cxx                     |    6 
 sw/source/core/txtnode/fmtatr1.cxx                 |   97 +
 sw/source/ui/dbui/dbtree.cxx                       |    4 
 sw/source/ui/dialog/SwDialogAssistant.cxx          | 2066 +++++++++++
 sw/source/ui/dialog/SwDialogAssistant.src          |  240 +
 sw/source/ui/fldui/fldtdlg.src                     |    6 
 sw/source/ui/inc/SwAssistantClass.hxx              |   89 
 sw/source/ui/inc/SwDialogAssistant.hrc             |  123 +
 sw/source/ui/inc/SwDialogAssistant.hxx             |   83 
 sw/source/ui/utlui/utlui.src                       |    4 
 sw/uiconfig/swriter/menubar/menubar.xml            |  331 --
 sw/uiconfig/swriter/toolbar/average.xml            |   30 
 sw/uiconfig/swriter/toolbar/beginner.xml           |   21 
 sw/uiconfig/swriter/toolbar/standardbar.xml        |   35 
 sw/uiconfig/swriter/toolbar/textobjectbar.xml      |   64 
 sw/uiconfig/swriter/toolbar/viewerbar.xml          |    8 
 sw/uiconfig/swriter/toolbar/writer_average.xml     |   30 
 sw/uiconfig/swriter/toolbar/writer_beginner.xml    |   21 
 sysui/desktop/debian/OOo4Kids-debian-menus         |   42 
 sysui/desktop/debian/control                       |    8 
 sysui/desktop/debian/makefile.mk                   |   12 
 sysui/desktop/debian/postinst                      |    6 
 sysui/desktop/freedesktop/freedesktop-menus.spec   |   10 
 sysui/desktop/icons/makefile.mk                    |   10 
 sysui/desktop/macosx/Info.plist                    |   43 
 sysui/desktop/macosx/makefile.mk                   |    2 
 sysui/desktop/mandriva/mandriva-menus.spec         |   24 
 sysui/desktop/menus/base.desktop                   |   11 
 sysui/desktop/menus/calc.desktop                   |    2 
 sysui/desktop/menus/draw.desktop                   |    2 
 sysui/desktop/menus/impress.desktop                |    2 
 sysui/desktop/menus/math.desktop                   |    2 
 sysui/desktop/menus/ooo4kids.desktop               |   11 
 sysui/desktop/menus/printeradmin.desktop           |    2 
 sysui/desktop/menus/qstart.desktop                 |    2 
 sysui/desktop/menus/startcenter.desktop            |    2 
 sysui/desktop/menus/writer.desktop                 |    2 
 sysui/desktop/mimetypes/OOo4Kids.applications      |    9 
 sysui/desktop/mimetypes/OOo4Kids.mime              |   80 
 sysui/desktop/productversion.mk                    |   20 
 sysui/desktop/redhat/redhat-menus.spec             |   29 
 sysui/desktop/share/OOo4Kids.sh                    |    2 
 sysui/desktop/share/brand.pl                       |    4 
 sysui/desktop/share/create_mime_xml.pl             |    2 
 sysui/desktop/share/create_tree.sh                 |   16 
 sysui/desktop/share/documents.ulf                  |    3 
 sysui/desktop/share/launcher_comment.ulf           |    6 
 sysui/desktop/share/launcher_genericname.ulf       |    4 
 sysui/desktop/share/makefile.mk                    |   50 
 sysui/desktop/share/misc/MANIFEST                  |    6 
 sysui/desktop/share/misc/activity-ooo4kids.svg     |  729 ++++
 sysui/desktop/share/misc/activity.info             |    8 
 sysui/desktop/share/misc/ooo4kidsrc.txt            |   44 
 sysui/desktop/share/misc/setup.py                  |    3 
 sysui/desktop/share/misc/sugarOOo4Kids             |   13 
 sysui/desktop/share/translate.pl                   |    2 
 sysui/desktop/slackware/makefile.mk                |    2 
 sysui/desktop/slackware/slack-desc                 |    2 
 sysui/desktop/suse/suse-menus.spec                 |   15 
 sysui/prj/d.lst                                    |   14 
 testtools/com/sun/star/comp/bridge/makefile.mk     |    4 
 testtools/source/bridgetest/cli/makefile.mk        |    5 
 testtools/source/bridgetest/idl/makefile.mk        |    6 
 testtools/source/bridgetest/makefile.mk            |   10 
 testtools/source/bridgetest/pyuno/makefile.mk      |    6 
 testtools/source/cliversioning/makefile.mk         |    5 
 testtools/source/performance/makefile.mk           |    5 
 testtools/source/servicetests/makefile.mk          |    6 
 testtools/util/makefile.pmk                        |    4 
 transex3/java/l10nconv/makefile.mk                 |    5 
 transex3/java/receditor/makefile.mk                |    5 
 transex3/source/filter/merge/makefile.mk           |    7 
 transex3/source/filter/utils/makefile.mk           |    5 
 transex3/source/help/makefile.mk                   |    4 
 unoil/climaker/makefile.mk                         |    5 
 unoil/climaker/version.txt                         |    6 
 unoil/util/makefile.mk                             |    5 
 unotools/inc/unotools/configmgr.hxx                |    3 
 unotools/source/config/configmgr.cxx               |   10 
 unoxml/source/rdf/makefile.mk                      |    5 
 vcl/aqua/source/app/saldata.cxx                    |    9 
 vcl/aqua/source/window/salframe.cxx                |    2 
 vcl/aqua/source/window/salmenu.cxx                 |   34 
 vcl/inc/vcl/cmdevt.hxx                             |    4 
 vcl/inc/vcl/graphite_layout.hxx                    |    3 
 vcl/inc/vcl/introwin.hxx                           |    2 
 vcl/inc/vcl/menu.hxx                               |    1 
 vcl/inc/vcl/ptrstyle.hxx                           |    7 
 vcl/inc/vcl/salobj.hxx                             |    1 
 vcl/inc/vcl/settings.hxx                           |    6 
 vcl/inc/vcl/svids.hrc                              |    3 
 vcl/inc/vcl/syschild.hxx                           |    1 
 vcl/inc/vcl/toolbox.h                              |    8 
 vcl/inc/vcl/wrkwin.hxx                             |    6 
 vcl/source/app/settings.cxx                        |   28 
 vcl/source/src/stdtext.src                         |   12 
 vcl/source/window/cursor.cxx                       |    9 
 vcl/source/window/javachild.cxx                    |   10 
 vcl/source/window/syschild.cxx                     |    6 
 vcl/source/window/toolbox.cxx                      |    9 
 vcl/source/window/toolbox2.cxx                     |    8 
 vcl/source/window/window.cxx                       |    2 
 vcl/unx/gtk/window/gtkobject.cxx                   |    9 
 vcl/unx/inc/ooo4kidsint.hxx                        |   57 
 vcl/unx/inc/plugins/gtk/gtkobject.hxx              |    1 
 vcl/unx/inc/sugarxproperties.hxx                   |   18 
 vcl/unx/source/app/makefile.mk                     |    4 
 vcl/unx/source/app/saldisp.cxx                     |    8 
 vcl/unx/source/app/sm.cxx                          |    7 
 vcl/unx/source/app/wmadaptor.cxx                   |   32 
 vcl/unx/source/gdi/dtint.cxx                       |    6 
 vcl/unx/source/gdi/makefile.mk                     |    5 
 vcl/unx/source/gdi/ooo4kidsint.cxx                 |  259 +
 vcl/unx/source/gdi/salgdi.cxx                      |   12 
 vcl/unx/source/gdi/salgdi2.cxx                     |    5 
 vcl/unx/source/window/FWS.cxx                      |    7 
 vcl/unx/source/window/SugarProperties.cxx          |   95 
 vcl/unx/source/window/makefile.mk                  |    9 
 vcl/unx/source/window/salframe.cxx                 |   24 
 vcl/win/source/window/salframe.cxx                 |    2 
 wizards/com/sun/star/wizards/agenda/makefile.mk    |    6 
 wizards/com/sun/star/wizards/fax/makefile.mk       |    5 
 wizards/com/sun/star/wizards/form/makefile.mk      |    5 
 wizards/com/sun/star/wizards/letter/makefile.mk    |    5 
 wizards/com/sun/star/wizards/makefile.mk           |    5 
 wizards/com/sun/star/wizards/query/makefile.mk     |    5 
 wizards/com/sun/star/wizards/report/makefile.mk    |    5 
 .../star/wizards/reportbuilder/layout/makefile.mk  |    5 
 .../com/sun/star/wizards/reportbuilder/makefile.mk |    5 
 wizards/com/sun/star/wizards/table/makefile.mk     |    5 
 wizards/com/sun/star/wizards/web/data/makefile.mk  |    5 
 .../com/sun/star/wizards/web/export/makefile.mk    |    6 
 wizards/com/sun/star/wizards/web/makefile.mk       |    5 
 wizards/util/makefile.mk                           |    4 
 writerperfect/prj/d.lst                            |    1 
 xmerge/source/aportisdoc/makefile.mk               |    5 
 xmerge/source/bridge/makefile.mk                   |    6 
 xmerge/source/htmlsoff/makefile.mk                 |    5 
 xmerge/source/pexcel/makefile.mk                   |    5 
 xmerge/source/pocketword/makefile.mk               |    6 
 xmerge/source/xmerge/makefile.mk                   |    5 
 xmerge/util/makefile.mk                            |    6 
 xmlhelp/source/com/sun/star/help/makefile.mk       |    4 
 xmloff/source/forms/elementimport.cxx              |    6 
 643 files changed, 36911 insertions(+), 10492 deletions(-)
 create mode 100644 apple_remote/makefile2.pmk
 create mode 100644 avmedia/source/gstreamer/ChangeLog
 create mode 100644 avmedia/source/gstreamer/exports.dxp
 create mode 100644 avmedia/source/gstreamer/gstcommon.hxx
 create mode 100644 avmedia/source/gstreamer/gstframegrabber.cxx
 create mode 100644 avmedia/source/gstreamer/gstframegrabber.hxx
 create mode 100644 avmedia/source/gstreamer/gstmanager.cxx
 create mode 100644 avmedia/source/gstreamer/gstmanager.hxx
 create mode 100644 avmedia/source/gstreamer/gstplayer.cxx
 create mode 100644 avmedia/source/gstreamer/gstplayer.hxx
 create mode 100644 avmedia/source/gstreamer/gstuno.cxx
 create mode 100644 avmedia/source/gstreamer/gstwindow.cxx
 create mode 100644 avmedia/source/gstreamer/gstwindow.hxx
 create mode 100644 avmedia/source/gstreamer/makefile.mk
 create mode 100644 chart2/uiconfig/toolbar/average.xml
 create mode 100644 chart2/uiconfig/toolbar/beginner.xml
 create mode 100644 chart2/uiconfig/toolbar/chart2_average.xml
 create mode 100644 chart2/uiconfig/toolbar/chart2_beginner.xml
 create mode 100644 dbaccess/source/filter/xml/xmlJavaClassPath.cxx
 create mode 100644 dbaccess/source/filter/xml/xmlJavaClassPath.hxx
 create mode 100644 desktop/source/splash/splash_png.cxx
 create mode 100644 desktop/source/splash/splash_png.hxx
 create mode 100644 dictionaries/de_CH/VERSION
 create mode 100644 dictionaries/de_DE/VERSION
 create mode 100644 dictionaries/zu_ZA/dictionary.lst
 create mode 100644 filter/source/config/tools/merge/FCFGMerge.cfg
 create mode 100644 filter/source/config/tools/merge/FCFGMerge.java
 create mode 100644 filter/source/config/tools/merge/Manifest.mf
 create mode 100644 filter/source/config/tools/merge/Merger.java
 create mode 100644 filter/source/config/tools/merge/makefile.mk
 create mode 100644 filter/source/config/tools/utils/AnalyzeStartupLog.java
 create mode 100644 filter/source/config/tools/utils/Cache.java
 create mode 100644 filter/source/config/tools/utils/ConfigHelper.java
 create mode 100644 filter/source/config/tools/utils/FileHelper.java
 create mode 100644 filter/source/config/tools/utils/Logger.java
 create mode 100644 filter/source/config/tools/utils/MalformedCommandLineException.java
 create mode 100644 filter/source/config/tools/utils/XMLHelper.java
 create mode 100644 filter/source/config/tools/utils/makefile.mk
 create mode 100644 fpicker/util/makefile.pmk
 create mode 100644 framework/source/services/backingwindow-OOo4Kids.cxx
 delete mode 100755 graphite/graphite-2.3.1.patch.mingw
 delete mode 100644 hsqldb/patches/i103528.patch
 delete mode 100644 hsqldb/patches/i104901.patch
 delete mode 100644 hsqldb/patches/i96823.patch
 delete mode 100644 hsqldb/patches/i97032.patch
 create mode 100644 hsqldb/patches/index.txt
 create mode 100644 instsetoo_native/util/OOo4Kids.lst
 create mode 100644 instsetoo_native/util/pack-OOo4Kids.lst
 create mode 100644 libtextcat/libtextcat-2.2-gdium-mips-workaround.patch
 create mode 100644 packimages/pack/image-OOo4Kids-sort.lst
 create mode 100644 readlicense_oo/docs/readme/readme_OOo4Kids.xrm
 create mode 100644 sc/uiconfig/scalc/toolbar/average.xml
 create mode 100644 sc/uiconfig/scalc/toolbar/beginner.xml
 create mode 100644 sc/uiconfig/scalc/toolbar/calc_average.xml
 create mode 100644 sc/uiconfig/scalc/toolbar/calc_beginner.xml
 create mode 100644 sd/uiconfig/sdraw/accelerator/de/default.xml
 create mode 100644 sd/uiconfig/sdraw/accelerator/en-GB/default.xml
 create mode 100644 sd/uiconfig/sdraw/accelerator/en-US/default.xml
 create mode 100644 sd/uiconfig/sdraw/accelerator/es/default.xml
 create mode 100644 sd/uiconfig/sdraw/accelerator/fr/default.xml
 create mode 100644 sd/uiconfig/sdraw/toolbar/average.xml
 create mode 100644 sd/uiconfig/sdraw/toolbar/beginner.xml
 create mode 100644 sd/uiconfig/sdraw/toolbar/draw_average.xml
 create mode 100644 sd/uiconfig/sdraw/toolbar/draw_beginner.xml
 create mode 100644 sd/uiconfig/simpress/accelerator/de/default.xml
 create mode 100644 sd/uiconfig/simpress/accelerator/default.xml
 create mode 100644 sd/uiconfig/simpress/accelerator/es/default.xml
 create mode 100644 sd/uiconfig/simpress/accelerator/fr/default.xml
 create mode 100644 sd/uiconfig/simpress/toolbar/average.xml
 create mode 100644 sd/uiconfig/simpress/toolbar/beginner.xml
 create mode 100644 sd/uiconfig/simpress/toolbar/impress_average.xml
 create mode 100644 sd/uiconfig/simpress/toolbar/impress_beginner.xml
 create mode 100644 sfx2/inc/showlicense.hxx
 create mode 100644 sfx2/source/dialog/passwd_OOo4Kids.cxx
 create mode 100644 sfx2/source/dialog/showlicense.cxx
 create mode 100644 shell/source/unix/sysshell/systemshell.cxx
 delete mode 100644 slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.cxx
 delete mode 100644 slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.hxx
 delete mode 100644 slideshow/source/engine/OGLTrans/OGLTrans_TransitionerImpl.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.h
 create mode 100644 slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.m
 create mode 100644 slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl.hxx
 create mode 100644 slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl_MACOSX.mm
 create mode 100644 slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionerImpl_MACOSX.mm
 create mode 100644 slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.h
 create mode 100644 slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.m
 create mode 100644 slideshow/source/engine/OGLTrans/mac/makefile.mk
 delete mode 100644 slideshow/source/engine/OGLTrans/makefile.mk
 create mode 100644 slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders.hxx
 create mode 100644 slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders_LINUX.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.hxx
 create mode 100644 slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionerImpl_LINUX.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/unx/makefile.mk
 create mode 100644 slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders.hxx
 create mode 100644 slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders_WNT.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.hxx
 create mode 100644 slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionerImpl_WNT.cxx
 create mode 100644 slideshow/source/engine/OGLTrans/win/makefile.mk
 create mode 100644 starmath/source/viewhdl.cxx
 create mode 100644 starmath/uiconfig/smath/toolbar/average.xml
 create mode 100644 starmath/uiconfig/smath/toolbar/beginner.xml
 create mode 100644 starmath/uiconfig/smath/toolbar/math_average.xml
 create mode 100644 starmath/uiconfig/smath/toolbar/math_beginner.xml
 create mode 100644 svtools/source/misc1/loginerr.cxx
 create mode 100644 svx/source/inc/dbcharsethelper.hxx
 create mode 100644 svx/source/inc/dbtoolsclient.hxx
 create mode 100644 sw/inc/bookmrk.hxx
 create mode 100644 sw/inc/fmthbsh.hxx
 create mode 100644 sw/inc/swenumdef.hxx
 delete mode 100755 sw/qa/complex/writer/TextPortionEnumerationTest.java
 create mode 100644 sw/source/core/txtnode/fmtatr1.cxx
 create mode 100644 sw/source/ui/dialog/SwDialogAssistant.cxx
 create mode 100644 sw/source/ui/dialog/SwDialogAssistant.src
 create mode 100644 sw/source/ui/inc/SwAssistantClass.hxx
 create mode 100644 sw/source/ui/inc/SwDialogAssistant.hrc
 create mode 100644 sw/source/ui/inc/SwDialogAssistant.hxx
 create mode 100644 sw/uiconfig/swriter/toolbar/average.xml
 create mode 100644 sw/uiconfig/swriter/toolbar/beginner.xml
 create mode 100644 sw/uiconfig/swriter/toolbar/writer_average.xml
 create mode 100644 sw/uiconfig/swriter/toolbar/writer_beginner.xml
 create mode 100644 sysui/desktop/debian/OOo4Kids-debian-menus
 delete mode 100644 sysui/desktop/menus/base.desktop
 create mode 100644 sysui/desktop/menus/ooo4kids.desktop
 create mode 100644 sysui/desktop/mimetypes/OOo4Kids.applications
 create mode 100644 sysui/desktop/mimetypes/OOo4Kids.mime
 create mode 100644 sysui/desktop/share/OOo4Kids.sh
 create mode 100644 sysui/desktop/share/misc/MANIFEST
 create mode 100644 sysui/desktop/share/misc/activity-ooo4kids.svg
 create mode 100644 sysui/desktop/share/misc/activity.info
 create mode 100644 sysui/desktop/share/misc/ooo4kidsrc.txt
 create mode 100644 sysui/desktop/share/misc/setup.py
 create mode 100644 sysui/desktop/share/misc/sugarOOo4Kids
 create mode 100644 vcl/unx/inc/ooo4kidsint.hxx
 create mode 100644 vcl/unx/inc/sugarxproperties.hxx
 create mode 100644 vcl/unx/source/gdi/ooo4kidsint.cxx
 create mode 100644 vcl/unx/source/window/SugarProperties.cxx


diff --git accessibility/bridge/org/openoffice/accessibility/makefile.mk accessibility/bridge/org/openoffice/accessibility/makefile.mk
index dc6f848..8ee787c 100755
--- accessibility/bridge/org/openoffice/accessibility/makefile.mk
+++ accessibility/bridge/org/openoffice/accessibility/makefile.mk
@@ -35,6 +35,10 @@ TARGET	= java_uno_accessbridge
 PACKAGE	= org$/openoffice$/accessibility
 
 # --- Settings -----------------------------------------------------
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
 
 .INCLUDE :  settings.mk
 
diff --git accessibility/bridge/org/openoffice/java/accessibility/makefile.mk accessibility/bridge/org/openoffice/java/accessibility/makefile.mk
index d48817b..cfbb246 100755
--- accessibility/bridge/org/openoffice/java/accessibility/makefile.mk
+++ accessibility/bridge/org/openoffice/java/accessibility/makefile.mk
@@ -38,6 +38,11 @@ PACKAGE	= org$/openoffice$/java$/accessibility
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVADIR = $(OUT)$/misc$/java
 JARFILES = sandbox.jar jurt.jar unoil.jar ridl.jar
 JAVAFILES = \
diff --git accessibility/bridge/source/java/makefile.mk accessibility/bridge/source/java/makefile.mk
index 7f81f85..db74d0f 100644
--- accessibility/bridge/source/java/makefile.mk
+++ accessibility/bridge/source/java/makefile.mk
@@ -43,6 +43,11 @@ VERSIONOBJ=
 
 # --- Files --------------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(GUI)"=="WNT"
 
 SLOFILES= $(SLO)$/WindowsAccessBridgeAdapter.obj
diff --git apple_remote/AppleRemote.m apple_remote/AppleRemote.m
index 25a6771..09f5f5f 100644
--- apple_remote/AppleRemote.m
+++ apple_remote/AppleRemote.m
@@ -43,16 +43,25 @@ const char* AppleRemoteDeviceName = "AppleIRController";
 	#define NSAppKitVersionNumber10_4 824
 #endif
 
+#ifndef NSAppKitVersionNumber10_5
+    #define NSAppKitVersionNumber10_5 949
+#endif
+
 @implementation AppleRemote
 
 + (const char*) remoteControlDeviceName {
 	return AppleRemoteDeviceName;
 }
 
-- (void) setCookieMappingInDictionary: (NSMutableDictionary*) _cookieToButtonMapping	{	
-    
+- (void) setCookieMappingInDictionary: (NSMutableDictionary*) _cookieToButtonMapping
+{	
     // TODO : avoid such magics 
-	if (floor(NSAppKitVersionNumber) <= NSAppKitVersionNumber10_4) {
+    if (floor(NSAppKitVersionNumber) <= NSAppKitVersionNumber10_4) 
+    {
+        #ifdef DEBUG
+            NSLog( @"setting 10.4 cookies" );
+        #endif
+
 		// 10.4.x Tiger
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlus]		forKey:@"14_12_11_6_"];
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonMinus]		forKey:@"14_13_11_6_"];		
@@ -65,7 +74,12 @@ const char* AppleRemoteDeviceName = "AppleIRController";
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonMenu_Hold]	forKey:@"14_6_14_6_"];
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlay_Hold]	forKey:@"18_14_6_18_14_6_"];
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteControl_Switched]	forKey:@"19_"];			
-	} else {
+    } 
+    else if( floor(NSAppKitVersionNumber) <= NSAppKitVersionNumber10_5 )
+    {
+        #ifdef DEBUG
+            NSLog( @"setting 10.5 cookies" );
+        #endif
 		// 10.5.x Leopard
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlus]		forKey:@"31_29_28_19_18_"];
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonMinus]		forKey:@"31_30_28_19_18_"];	
@@ -79,9 +93,30 @@ const char* AppleRemoteDeviceName = "AppleIRController";
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlay_Hold]	forKey:@"35_31_19_18_35_31_19_18_"];
 		[_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteControl_Switched]	forKey:@"19_"];			
 	}
+    else
+    {
+        #ifdef DEBUG
+            NSLog( @"setting 10.6 cookies" );
+        #endif
+        // 10.6.x Snow Leopard
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlus]		forKey:@"33_31_30_21_20_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonMinus]		forKey:@"33_32_30_21_20_2_"];	
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonMenu]		forKey:@"33_22_21_20_2_33_22_21_20_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlay]		forKey:@"33_23_21_20_2_33_23_21_20_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonRight]		forKey:@"33_24_21_20_2_33_24_21_20_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonLeft]		forKey:@"33_25_21_20_2_33_25_21_20_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonRight_Hold]	forKey:@"33_21_20_14_12_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonLeft_Hold]	forKey:@"33_21_20_13_12_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonMenu_Hold]	forKey:@"33_21_20_2_33_21_20_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteButtonPlay_Hold]	forKey:@"37_33_21_20_2_37_33_21_20_2_"];
+        [cookieToButtonMapping setObject:[NSNumber numberWithInt:kMetallicRemote2009ButtonPlay]       forKey:@"33_21_20_8_2_33_21_20_8_2_"];
+        [cookieToButtonMapping setObject:[NSNumber numberWithInt:kMetallicRemote2009ButtonMiddlePlay] forKey:@"33_21_20_3_2_33_21_20_3_2_"];
+        [_cookieToButtonMapping setObject:[NSNumber numberWithInt:kRemoteControl_Switched]	forKey:@"19_"];
+    }
 }
 
-- (void) sendRemoteButtonEvent: (RemoteControlEventIdentifier) event pressedDown: (BOOL) pressedDown {
+- (void) sendRemoteButtonEvent: (RemoteControlEventIdentifier) event pressedDown: (BOOL) pressedDown
+{
 	if (pressedDown == NO && event == kRemoteButtonMenu_Hold) {
 		// There is no seperate event for pressed down on menu hold. We are simulating that event here
 		[super sendRemoteButtonEvent:event pressedDown:YES];
diff --git apple_remote/HIDRemoteControlDevice.m apple_remote/HIDRemoteControlDevice.m
index 9421590..93f34be 100644
--- apple_remote/HIDRemoteControlDevice.m
+++ apple_remote/HIDRemoteControlDevice.m
@@ -281,7 +281,17 @@ cleanup:
 		
 	NSNumber* buttonId = [[self cookieToButtonMapping] objectForKey: cookieString];
 	if (buttonId != nil) {
+        switch ( (int)buttonId )
+        {
+        case kMetallicRemote2009ButtonPlay:
+        case kMetallicRemote2009ButtonMiddlePlay:
+            buttonId = [NSNumber numberWithInt:kRemoteButtonPlay];
+            break;
+        default:
+            break;
+        }
 		[self sendRemoteButtonEvent: [buttonId intValue] pressedDown: (sumOfValues>0)];
+
 	} else {
 		// let's see if a number of events are stored in the cookie string. this does
 		// happen when the main thread is too busy to handle all incoming events in time.
diff --git apple_remote/MultiClickRemoteBehavior.m apple_remote/MultiClickRemoteBehavior.m
index 03b2497..070aefa 100644
--- apple_remote/MultiClickRemoteBehavior.m
+++ apple_remote/MultiClickRemoteBehavior.m
@@ -75,7 +75,7 @@ const NSTimeInterval HOLD_RECOGNITION_TIME_INTERVAL = 0.4;
 }
 - (void) setClickCountingEnabled: (BOOL) value {
 	if (value) {
-		[self setClickCountEnabledButtons: kRemoteButtonPlus | kRemoteButtonMinus | kRemoteButtonPlay | kRemoteButtonLeft | kRemoteButtonRight | kRemoteButtonMenu];
+        [self setClickCountEnabledButtons: kRemoteButtonPlus | kRemoteButtonMinus | kRemoteButtonPlay | kRemoteButtonLeft | kRemoteButtonRight | kRemoteButtonMenu | kMetallicRemote2009ButtonPlay | kMetallicRemote2009ButtonMiddlePlay];
 	} else {
 		[self setClickCountEnabledButtons: 0];
 	}
diff --git apple_remote/RemoteMainController.m apple_remote/RemoteMainController.m
index 5b3b893..4f1db29 100644
--- apple_remote/RemoteMainController.m
+++ apple_remote/RemoteMainController.m
@@ -63,15 +63,6 @@
 #endif
         }
 
-        if ( [container instantiateAndAddRemoteControlDeviceWithClass: [KeyspanFrontRowControl class]] != 0 ) {
-#ifdef DEBUG
-            NSLog(@"[container instantiateAndAddRemoteControlDeviceWithClass: [KeyspanFrontRowControl class]] successfull");
-        }
-        else {
-            NSLog(@"[container instantiateAndAddRemoteControlDeviceWithClass: [KeyspanFrontRowControl class]] failed");
-#endif
-        }
-
         if ( [container instantiateAndAddRemoteControlDeviceWithClass: [GlobalKeyboardDevice class]] != 0 ) {
 #ifdef DEBUG
             NSLog(@"[container instantiateAndAddRemoteControlDeviceWithClass: [GlobalKeyboardDevice class]] successfull");
diff --git apple_remote/inc/RemoteControl.h apple_remote/inc/RemoteControl.h
index c736775..d3f1616 100644
--- apple_remote/inc/RemoteControl.h
+++ apple_remote/inc/RemoteControl.h
@@ -65,6 +65,11 @@ typedef enum _RemoteControlEventIdentifier {
     
     // special events (not supported by all devices)	
     kRemoteControl_Switched			=1<<13,
+
+    // New values for the "metallic" Remote (2009 model)
+    kMetallicRemote2009ButtonPlay		=1<<14,
+    kMetallicRemote2009ButtonMiddlePlay	=1<<15
+
 } RemoteControlEventIdentifier;
 
 @interface NSObject(RemoteControlDelegate)
diff --git apple_remote/makefile2.pmk apple_remote/makefile2.pmk
new file mode 100644
index 0000000..cc06558
--- /dev/null
+++ apple_remote/makefile2.pmk
@@ -0,0 +1,35 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile2.pmk,v $
+#
+# $Revision: 1.1 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+.IF "$(GUIBASE)"=="aqua"
+OBJCXXFLAGS=-x objective-c++ -fobjc-exceptions
+CFLAGSCXX+=$(OBJCXXFLAGS)
+.ENDIF  # "$(GUIBASE)"=="aqua"
diff --git automation/packimages/makefile.mk automation/packimages/makefile.mk
index 1c497b2..3807d37 100644
--- automation/packimages/makefile.mk
+++ automation/packimages/makefile.mk
@@ -41,6 +41,11 @@ RSCCUSTOMIMG*=$(PRJNAME)$/util
 # to a "find" that looks for "*.png"
 RSCCUSTOMIMG*=$(PRJNAME)$/util
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE:  settings.mk
 
 .INCLUDE: target.mk
diff --git automation/source/app/makefile.mk automation/source/app/makefile.mk
index ab1de73..35ac2ba 100644
--- automation/source/app/makefile.mk
+++ automation/source/app/makefile.mk
@@ -38,6 +38,11 @@ TARGET=app
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
+
 # --- Allgemein ------------------------------------------------------------
 
 CXXFILES = \
diff --git automation/source/communi/makefile.mk automation/source/communi/makefile.mk
index 6c3a576..31f5ecd 100644
--- automation/source/communi/makefile.mk
+++ automation/source/communi/makefile.mk
@@ -38,6 +38,11 @@ TARGET=communi
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 SLOFILES=   \
diff --git automation/source/miniapp/makefile.mk automation/source/miniapp/makefile.mk
index 4ab23d9..318f9ca 100644
--- automation/source/miniapp/makefile.mk
+++ automation/source/miniapp/makefile.mk
@@ -38,6 +38,11 @@ TARGET=miniapp
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
+
 # --- Allgemein ------------------------------------------------------------
 
 OBJFILES = \
diff --git automation/source/mozillaserver/makefile.mk automation/source/mozillaserver/makefile.mk
index 761f09d..cd9c37d 100644
--- automation/source/mozillaserver/makefile.mk
+++ automation/source/mozillaserver/makefile.mk
@@ -42,6 +42,11 @@ LIBTARGET=NO
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # ------------------------------------------------------------------
 
 PACKAGE := com$/sun$/star$/testtool
diff --git automation/source/server/makefile.mk automation/source/server/makefile.mk
index 5f0ada2..4ccd5ce 100644
--- automation/source/server/makefile.mk
+++ automation/source/server/makefile.mk
@@ -37,6 +37,13 @@ TARGET=server
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+
+dummy:
+    @echo "Nothing to build."
+
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 SLOFILES = \
diff --git automation/source/simplecm/makefile.mk automation/source/simplecm/makefile.mk
index ab2e70e..0d94c80 100644
--- automation/source/simplecm/makefile.mk
+++ automation/source/simplecm/makefile.mk
@@ -38,6 +38,11 @@ TARGET=simplecm
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 SLOFILES=   \
diff --git automation/source/testtool/makefile.mk automation/source/testtool/makefile.mk
index 79a811f..c7d801f 100644
--- automation/source/testtool/makefile.mk
+++ automation/source/testtool/makefile.mk
@@ -38,6 +38,11 @@ TARGET=testtool
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Allgemein ------------------------------------------------------------
 
 OBJFILES = \
diff --git automation/util/makefile.mk automation/util/makefile.mk
index 8d68000..268ae26 100644
--- automation/util/makefile.mk
+++ automation/util/makefile.mk
@@ -39,6 +39,11 @@ TARGETTYPE=GUI
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Allgemein ---------------------------------------------------
 
 LIB1TARGET=$(SLB)$/$(TARGET).lib
diff --git avmedia/prj/build.lst avmedia/prj/build.lst
index 1ef04ca..9e3f9ea 100644
--- avmedia/prj/build.lst
+++ avmedia/prj/build.lst
@@ -8,4 +8,5 @@ av  avmedia\source\win	    	nmake	-	all	av_win	            									NULL
 av	avmedia\source\java			nmake	-	all	av_java	            									NULL
 av	avmedia\source\xine			nmake	-	all	av_xine	            									NULL
 av	avmedia\source\quicktime	nmake	-	all	av_quicktime											NULL
-av	avmedia\util				nmake	-	all	av_util av_viewer av_framework av_win av_java av_quicktime av_xine	NULL
+av	avmedia\source\gstreamer		nmake	-	all	av_gstreamer           									NULL
+av	avmedia\util				nmake	-	all	av_util av_viewer av_framework av_win av_java av_quicktime av_xine av_gstreamer	NULL
diff --git avmedia/source/gstreamer/ChangeLog avmedia/source/gstreamer/ChangeLog
new file mode 100644
index 0000000..beef4f0
--- /dev/null
+++ avmedia/source/gstreamer/ChangeLog
@@ -0,0 +1,112 @@
+2006-09-22  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx (processSyncMessage): remember GstXOverlay
+    (processMessage): explicit expose when we reach paused state -
+    this mean that now once stream is loaded/video inserted, the 1st
+    frame is rendered
+    (setMediaTime): if not playing set PAUSED state again, seems like
+    seek is changing state to PLAYING. this fixes problem when stop
+    seeked to begin and started playing again
+
+2006-09-21  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx (processSyncMessage): when error occurs, set the
+    condition so that OOo does'n waste time waiting for us to finish
+    reaching PAUSED state
+
+2006-09-19  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx (processSyncMessage): set condition even if we
+    weren't able to get video size - might be audio only stream
+    (getPreferredPlayerWindowSize): init size to 0, 0 - in case we
+    don't have video size, it will fallback to system media window
+    content (some icon)
+
+2006-08-31  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx (processSyncMessage): when we get to paused state,
+    get stream-info from playbin and look for video size. set
+    condition when done
+    (Player): added width, height, size condition
+    (preparePlaybin): new helper method, extracted from create
+    method. use fake video sink in the beggining so that we don't get
+    xwindow-id message too early
+    (getPreferredPlayerWindowSize): wait for size condition to be sure
+    we know video size (if possible). reset video sink to default one
+    (NULL) and set state to READY and immediatelly to PAUSE so that
+    the default sink is relinked
+
+2006-08-16  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx (create): set state to PAUSED so that we can query
+    duration ASAP
+    (processMessage): watch for state changed and query duration when
+    going to PAUSED state
+
+2006-08-15  Radek Doulik  <rodo@novell.com>
+
+    * makefile.mk: require gstreamer-plugins-base-0.10 and link with
+    gst interfaces library
+
+    * gstwindow.cxx: make it build
+
+    * gstplayer.cxx: removed WINNT ifdefs (relict from time when I
+    thought Cedric develops on win architecture)
+    (gst_pipeline_bus_callback): added sync handler for setting
+    xwindow id to to video sink
+    (processSyncMessage): new metrhod, process message from sync
+    handler
+    (create): set playbin state to READY so that playback start is
+    faster
+    (createPlayerWindow): implemented, we pass xwindow id in 3rd
+    argument
+
+2006-08-04  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx (create): add bus watch, watch for EOS in
+    processMessage method (called from watch callback)
+
+2006-08-02  Radek Doulik  <rodo@novell.com>
+
+    * gstplayer.cxx: test for mpPlaybin != NULL before using it,
+    initialize it in constructor to NULL and also reset it to NULL
+    after unrefing
+    (getDuration): check for sucessful query and the right format
+    (getMediaTime): ditto, 
+    (setMediaTime): implemented
+
+2006-08-01  Radek Doulik  <rodo@novell.com>
+
+    * gstwindow.hxx: removed mpWndClass for now, so that the rest
+    compiles
+
+    * gstuno.cxx (component_getFactory): s/DirectX/GStreamer so that
+    component is loaded
+
+    * gstplayer.cxx (Player::Player): do not create gerror object, it
+    is noit needed, free the error object only if created during
+    initialization of gstremer
+    (Player::create, start, stop): use g_main_loop only on windows
+    (create): fixed ascURL declaration, added rtl namespace prefix
+    (setMute): set mbMuted
+    (setVolumeDB): convert avmedia volume to gstreamer volume, added
+    missing NULL to the end of g_object_set call
+    (getVolumeDB): convert gstreamer volume back to avmedia volume
+
+    * gstplayer.hxx: keep g_main_loop only on win platform. make
+    mnUnmutedVolume double, moved mbInitialized to the end to quiet
+    compiler warning
+
+    * gstcommon.hxx: removed wrong #include <rtl/ustring>
+
+    * renamed source files, prefixed the names with gst so that obj
+    file names do not clash with xine object files
+
+    * makefile.mk: changed PRJNAME and TARGET to reflect
+    gstreamer. enabled build on unix as well. removed win library
+    references. removed source files which are not yet ported from
+    SLOFILES list.
+
+2006-08-31  Radek Doulik  <rodo@novell.com>
+
+        * imported initial sources from Cedric Bosdonnat
\ No newline at end of file
diff --git avmedia/source/gstreamer/exports.dxp avmedia/source/gstreamer/exports.dxp
new file mode 100644
index 0000000..db9c0a5
--- /dev/null
+++ avmedia/source/gstreamer/exports.dxp
@@ -0,0 +1,4 @@
+component_getImplementationEnvironment
+component_writeInfo
+component_getFactory
+
diff --git avmedia/source/gstreamer/gstcommon.hxx avmedia/source/gstreamer/gstcommon.hxx
new file mode 100644
index 0000000..54df6e8
--- /dev/null
+++ avmedia/source/gstreamer/gstcommon.hxx
@@ -0,0 +1,83 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef _GSTCOMMON_HXX
+#define _GSTCOMMON_HXX
+
+#include <gst/gst.h>
+
+#ifndef _OSL_MUTEX_HXX_
+#include <osl/mutex.hxx>
+#endif
+#ifndef _DEBUG_HXX
+#include <tools/debug.hxx>
+#endif
+#ifndef _STREAM_HXX
+#include <tools/stream.hxx>
+#endif
+#ifndef _STRING_HXX
+#include <tools/string.hxx>
+#endif
+#ifndef _URLOBJ_HXX
+#include <tools/urlobj.hxx>
+#endif
+#ifndef _CPPUHELPER_IMPLBASE1_HXX_
+#include <cppuhelper/implbase1.hxx>
+#endif
+#ifndef _CPPUHELPER_IMPLBASE2_HXX_
+#include <cppuhelper/implbase2.hxx>
+#endif
+#ifndef _CPPUHELPER_WEAK_HXX_
+#include <cppuhelper/weak.hxx>
+#endif
+#ifndef _CPPUHELPER_FACTORY_HXX_
+#include <cppuhelper/factory.hxx>
+#endif
+
+#include <com/sun/star/uno/Reference.h>
+#include <com/sun/star/uno/RuntimeException.hpp>
+#include <com/sun/star/lang/XMultiServiceFactory.hpp>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/registry/XRegistryKey.hpp>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/lang/XServiceInfo.hpp>
+#include <com/sun/star/awt/Rectangle.hpp>
+#include <com/sun/star/awt/KeyModifier.hpp>
+#include <com/sun/star/awt/MouseButton.hpp>
+#include <com/sun/star/media/XManager.hpp>
+
+#define WM_GRAPHNOTIFY (WM_USER + 567)
+
+#endif // _GSTCOMMOM_HXX
diff --git avmedia/source/gstreamer/gstframegrabber.cxx avmedia/source/gstreamer/gstframegrabber.cxx
new file mode 100644
index 0000000..bbe0062
--- /dev/null
+++ avmedia/source/gstreamer/gstframegrabber.cxx
@@ -0,0 +1,244 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include <tools/prewin.h>
+#include <windows.h>
+#include <objbase.h>
+#include <strmif.h>
+#include <Amvideo.h>
+#include <Qedit.h>
+#include <uuids.h>
+#include <tools/postwin.h>
+
+#include "framegrabber.hxx"
+#include "player.hxx"
+
+#include <tools/stream.hxx>
+#include <vcl/graph.hxx>
+#include <unotools/localfilehelper.hxx>
+
+#define AVMEDIA_GST_FRAMEGRABBER_IMPLEMENTATIONNAME "com.sun.star.comp.avmedia.FrameGrabber_GStreamer"
+#define AVMEDIA_GST_FRAMEGRABBER_SERVICENAME "com.sun.star.media.FrameGrabber_GStreamer"
+
+using namespace ::com::sun::star;
+
+namespace avmedia { namespace gstreamer {
+
+// ----------------
+// - FrameGrabber -
+// ----------------
+
+FrameGrabber::FrameGrabber( const uno::Reference< lang::XMultiServiceFactory >& rxMgr ) :
+    mxMgr( rxMgr )
+{
+    ::CoInitialize( NULL );
+}
+
+// ------------------------------------------------------------------------------
+
+FrameGrabber::~FrameGrabber()
+{
+    ::CoUninitialize();
+}
+
+// ------------------------------------------------------------------------------
+
+IMediaDet* FrameGrabber::implCreateMediaDet( const ::rtl::OUString& rURL ) const
+{
+    IMediaDet* pDet = NULL;
+
+    if( SUCCEEDED( CoCreateInstance( CLSID_MediaDet, NULL, CLSCTX_INPROC_SERVER, IID_IMediaDet, (void**) &pDet ) ) )
+    {
+        String aLocalStr;
+        
+        if( ::utl::LocalFileHelper::ConvertURLToPhysicalName( rURL, aLocalStr ) && aLocalStr.Len() )
+        {
+            if( !SUCCEEDED( pDet->put_Filename( ::SysAllocString( aLocalStr.GetBuffer() ) ) ) )
+            {
+                pDet->Release();
+                pDet = NULL;
+            }
+        }
+    }
+    
+    return pDet;
+}
+
+// ------------------------------------------------------------------------------
+
+bool FrameGrabber::create( const ::rtl::OUString& rURL )
+{
+    // just check if a MediaDet interface can be created with the given URL
+    IMediaDet*  pDet = implCreateMediaDet( rURL );
+   
+    if( pDet )
+    {
+        maURL = rURL;
+        pDet->Release();
+        pDet = NULL;
+    }
+    else
+        maURL = ::rtl::OUString();
+
+    return( maURL.getLength() > 0 );
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Reference< graphic::XGraphic > SAL_CALL FrameGrabber::grabFrame( double fMediaTime )
+    throw (uno::RuntimeException)
+{
+    uno::Reference< graphic::XGraphic > xRet;
+    IMediaDet*                          pDet = implCreateMediaDet( maURL );
+   
+    if( pDet )
+    {
+        double  fLength;
+        long    nStreamCount;
+        bool    bFound = false;
+    
+        if( SUCCEEDED( pDet->get_OutputStreams( &nStreamCount ) ) )
+        {
+            for( long n = 0; ( n < nStreamCount ) && !bFound; ++n )
+            {
+                GUID aMajorType;
+                
+                if( SUCCEEDED( pDet->put_CurrentStream( n ) )  &&
+                    SUCCEEDED( pDet->get_StreamType( &aMajorType ) ) &&
+                    ( aMajorType == MEDIATYPE_Video ) )
+                {
+                    bFound = true;
+                }
+            }
+        }
+        
+        if( bFound &&
+            ( S_OK == pDet->get_StreamLength( &fLength ) ) &&
+            ( fLength > 0.0 ) && ( fMediaTime >= 0.0 ) && ( fMediaTime <= fLength ) )
+        {
+            AM_MEDIA_TYPE   aMediaType;
+            long            nWidth = 0, nHeight = 0, nSize = 0; 
+            
+            if( SUCCEEDED( pDet->get_StreamMediaType( &aMediaType ) ) )
+            {
+                if( ( aMediaType.formattype == FORMAT_VideoInfo ) && 
+                    ( aMediaType.cbFormat >= sizeof( VIDEOINFOHEADER ) ) )
+                {
+                    VIDEOINFOHEADER* pVih = reinterpret_cast< VIDEOINFOHEADER* >( aMediaType.pbFormat );
+                    
+                    nWidth = pVih->bmiHeader.biWidth;
+                    nHeight = pVih->bmiHeader.biHeight;
+                
+                    if( nHeight < 0 )
+                        nHeight *= -1;
+                }
+
+                if( aMediaType.cbFormat != 0 )
+                {
+                    ::CoTaskMemFree( (PVOID) aMediaType.pbFormat );
+                    aMediaType.cbFormat = 0;
+                    aMediaType.pbFormat = NULL;
+                }
+                
+                if( aMediaType.pUnk != NULL )
+                {
+                    aMediaType.pUnk->Release();
+                    aMediaType.pUnk = NULL;
+                }            
+            }
+            
+            if( ( nWidth > 0 ) && ( nHeight > 0 ) &&
+                SUCCEEDED( pDet->GetBitmapBits( 0, &nSize, NULL, nWidth, nHeight ) ) &&
+                ( nSize > 0  ) )
+            {
+                char* pBuffer = new char[ nSize ];
+
+                try 
+                {
+                    if( SUCCEEDED( pDet->GetBitmapBits( fMediaTime, NULL, pBuffer, nWidth, nHeight ) ) )
+                    {
+                        SvMemoryStream  aMemStm( pBuffer, nSize, STREAM_READ | STREAM_WRITE );
+                        Bitmap          aBmp;
+                        
+                        if( aBmp.Read( aMemStm, false ) && !aBmp.IsEmpty() )
+                        {
+                            const Graphic aGraphic( aBmp );
+                            xRet = aGraphic.GetXGraphic();
+                        }
+                    }
+                }
+                catch( ... )
+                {
+                }
+
+                delete [] pBuffer;
+            }
+        }
+
+        pDet->Release();
+    }
+    
+    return xRet;
+}
+
+// ------------------------------------------------------------------------------
+
+::rtl::OUString SAL_CALL FrameGrabber::getImplementationName(  )
+    throw (uno::RuntimeException)
+{
+    return ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( AVMEDIA_GST_FRAMEGRABBER_IMPLEMENTATIONNAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL FrameGrabber::supportsService( const ::rtl::OUString& ServiceName )
+    throw (uno::RuntimeException)
+{
+    return ServiceName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM ( AVMEDIA_GST_FRAMEGRABBER_SERVICENAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Sequence< ::rtl::OUString > SAL_CALL FrameGrabber::getSupportedServiceNames(  )
+    throw (uno::RuntimeException)
+{
+    uno::Sequence< ::rtl::OUString > aRet(1);
+    aRet[0] = ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM ( AVMEDIA_GST_FRAMEGRABBER_SERVICENAME ) );
+
+    return aRet;
+}
+
+} // namespace gstreamer
+} // namespace avmedia
diff --git avmedia/source/gstreamer/gstframegrabber.hxx avmedia/source/gstreamer/gstframegrabber.hxx
new file mode 100644
index 0000000..30e431f
--- /dev/null
+++ avmedia/source/gstreamer/gstframegrabber.hxx
@@ -0,0 +1,78 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef _FRAMEGRABBER_HXX
+#define _FRAMEGRABBER_HXX
+
+#include "gstcommon.hxx"
+
+#ifndef _COM_SUN_STAR_MEDIA_XFRAMEGRABBER_HDL_
+#include "com/sun/star/media/XFrameGrabber.hdl"
+#endif
+
+namespace avmedia { namespace gstreamer {
+
+// ----------------
+// - FrameGrabber -
+// ----------------
+
+class FrameGrabber : public ::cppu::WeakImplHelper2 < ::com::sun::star::media::XFrameGrabber,
+                                                      ::com::sun::star::lang::XServiceInfo >
+{
+public:
+
+            FrameGrabber( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& rxMgr );
+            ~FrameGrabber();
+
+    bool    create( const ::rtl::OUString& rURL );
+
+    // XFrameGrabber
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::graphic::XGraphic > SAL_CALL grabFrame( double fMediaTime ) throw (::com::sun::star::uno::RuntimeException);
+
+    // XServiceInfo
+    virtual ::rtl::OUString SAL_CALL getImplementationName(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL supportsService( const ::rtl::OUString& ServiceName ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Sequence< ::rtl::OUString > SAL_CALL getSupportedServiceNames(  ) throw (::com::sun::star::uno::RuntimeException);
+
+private:
+
+    ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >    mxMgr;
+    ::rtl::OUString                                                                     maURL;
+};
+
+} // namespace gstreamer
+} // namespace avmedia
+
+#endif // _FRAMEGRABBER_HXX
diff --git avmedia/source/gstreamer/gstmanager.cxx avmedia/source/gstreamer/gstmanager.cxx
new file mode 100644
index 0000000..5b6cb15
--- /dev/null
+++ avmedia/source/gstreamer/gstmanager.cxx
@@ -0,0 +1,114 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include "gstmanager.hxx"
+#include "gstplayer.hxx"
+
+#include <tools/urlobj.hxx>
+
+#define AVMEDIA_GST_MANAGER_IMPLEMENTATIONNAME "com.sun.star.comp.avmedia.Manager_GStreamer"
+#define AVMEDIA_GST_MANAGER_SERVICENAME "com.sun.star.media.Manager"
+
+#if DEBUG
+#define DBG OSL_TRACE
+#else
+#define DBG(...)
+#endif
+
+using namespace ::com::sun::star;
+
+namespace avmedia { namespace gstreamer {
+// ----------------
+// - Manager -
+// ----------------
+
+Manager::Manager( const uno::Reference< lang::XMultiServiceFactory >& rxMgr ) :
+    mxMgr( rxMgr )
+{
+    DBG( "avmediagst: Manager::Manager" );
+}
+
+// ------------------------------------------------------------------------------
+
+Manager::~Manager()
+{
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Reference< media::XPlayer > SAL_CALL Manager::createPlayer( const ::rtl::OUString& rURL )
+    throw (uno::RuntimeException)
+{
+    Player*                             pPlayer( new Player( mxMgr ) );
+    uno::Reference< media::XPlayer >    xRet( pPlayer );
+    const INetURLObject                 aURL( rURL );
+
+    DBG( "avmediagst: Manager::createPlayer" );
+
+    if( !pPlayer->create( aURL.GetMainURL( INetURLObject::DECODE_UNAMBIGUOUS ) )  )
+        xRet = uno::Reference< media::XPlayer >();
+
+    return xRet;
+}
+
+// ------------------------------------------------------------------------------
+
+::rtl::OUString SAL_CALL Manager::getImplementationName(  )
+    throw (uno::RuntimeException)
+{
+    return ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( AVMEDIA_GST_MANAGER_IMPLEMENTATIONNAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Manager::supportsService( const ::rtl::OUString& ServiceName )
+    throw (uno::RuntimeException)
+{
+    return ServiceName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM ( AVMEDIA_GST_MANAGER_SERVICENAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Sequence< ::rtl::OUString > SAL_CALL Manager::getSupportedServiceNames(  )
+    throw (uno::RuntimeException)
+{
+    uno::Sequence< ::rtl::OUString > aRet(1);
+    aRet[0] = ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM ( AVMEDIA_GST_MANAGER_SERVICENAME ) );
+
+    return aRet;
+}
+
+} // namespace gstreamer
+} // namespace avmedia
diff --git avmedia/source/gstreamer/gstmanager.hxx avmedia/source/gstreamer/gstmanager.hxx
new file mode 100644
index 0000000..8ed38bb
--- /dev/null
+++ avmedia/source/gstreamer/gstmanager.hxx
@@ -0,0 +1,74 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef _MANAGER_HXX
+#define _MANAGER_HXX
+
+#include "gstcommon.hxx"
+
+#ifndef _COM_SUN_STAR_MEDIA_XMANAGER_HDL_
+#include "com/sun/star/media/XManager.hdl"
+#endif
+
+// -----------
+// - Manager -
+// -----------
+
+namespace avmedia { namespace gstreamer {
+
+class Manager : public ::cppu::WeakImplHelper2 < ::com::sun::star::media::XManager,
+                                                 ::com::sun::star::lang::XServiceInfo >
+{
+public:
+
+    Manager( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& rxMgr );
+    ~Manager();
+
+    // XManager
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::media::XPlayer > SAL_CALL createPlayer( const ::rtl::OUString& aURL ) throw (::com::sun::star::uno::RuntimeException);
+
+    // XServiceInfo
+    virtual ::rtl::OUString SAL_CALL getImplementationName(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL supportsService( const ::rtl::OUString& ServiceName ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Sequence< ::rtl::OUString > SAL_CALL getSupportedServiceNames(  ) throw (::com::sun::star::uno::RuntimeException);
+private:
+
+    ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory > mxMgr;
+};
+
+} // namespace gstreamer
+} // namespace avmedia
+
+#endif // _MANAGER_HXX
diff --git avmedia/source/gstreamer/gstplayer.cxx avmedia/source/gstreamer/gstplayer.cxx
new file mode 100644
index 0000000..f1a53e7
--- /dev/null
+++ avmedia/source/gstreamer/gstplayer.cxx
@@ -0,0 +1,639 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include <math.h>
+
+#ifndef __RTL_USTRING_
+#include <rtl/string.hxx>
+#endif
+
+#include "gstplayer.hxx"
+#include "gstframegrabber.hxx"
+#include "gstwindow.hxx"
+
+#include <gst/interfaces/xoverlay.h>
+
+#define AVMEDIA_GST_PLAYER_IMPLEMENTATIONNAME "com.sun.star.comp.avmedia.Player_GStreamer"
+#define AVMEDIA_GST_PLAYER_SERVICENAME "com.sun.star.media.Player_GStreamer"
+
+#if DEBUG
+#define DBG OSL_TRACE
+#else
+#define DBG(...)
+#endif
+
+using namespace ::com::sun::star;
+
+namespace avmedia { namespace gstreamer {
+
+// ----------------
+// - Player -
+// ----------------
+
+Player::Player( const uno::Reference< lang::XMultiServiceFactory >& rxMgr ) :
+    mxMgr( rxMgr ),
+    mpPlaybin( NULL ),
+    mbFakeVideo (sal_False ),
+    mnUnmutedVolume( 0 ),
+    mbPlayPending ( false ),
+    mbMuted( false ),
+    mbLooping( false ),
+    mbInitialized( false ),
+    mnWindowID( 0 ),
+    mpXOverlay( NULL ),
+    mnDuration( 0 ),
+    mnWidth( 0 ),
+    mnHeight( 0 ),
+    maSizeCondition( osl_createCondition() )
+{
+    // Initialize GStreamer library
+    int argc = 1;
+    char *arguments[] = { "openoffice.org" };
+    char** argv = arguments;
+    GError* pError = NULL;
+
+    mbInitialized = gst_init_check( &argc, &argv, &pError );
+
+    if (pError != NULL)
+        // TODO: thow an exception?
+        g_error_free (pError);
+}
+
+// ------------------------------------------------------------------------------
+
+Player::~Player()
+{
+    // Release the elements and pipeline
+    if( mbInitialized )
+    {
+        if( mpPlaybin )
+        {
+            gst_element_set_state( mpPlaybin, GST_STATE_NULL );
+            gst_object_unref( GST_OBJECT( mpPlaybin ) );
+
+            mpPlaybin = NULL;
+        }
+
+        if( mpXOverlay ) {
+            g_object_unref( G_OBJECT ( mpXOverlay ) );
+            mpXOverlay = NULL;
+        }
+    }
+}
+
+// ------------------------------------------------------------------------------
+
+static gboolean gst_pipeline_bus_callback( GstBus *, GstMessage *message, gpointer data )
+{
+    Player* pPlayer = (Player *) data;
+
+    pPlayer->processMessage( message );
+
+    return TRUE;
+}
+
+static GstBusSyncReply gst_pipeline_bus_sync_handler( GstBus *, GstMessage * message, gpointer data )
+{
+    Player* pPlayer = (Player *) data;
+
+    return pPlayer->processSyncMessage( message );
+}
+
+void Player::processMessage( GstMessage *message )
+{
+    //DBG ( "gst message received: src name: %s structure type: %s",
+    //            gst_object_get_name (message->src),
+    //            message->structure ? gst_structure_get_name (message->structure) : "<none>");
+
+    switch( GST_MESSAGE_TYPE( message ) ) {
+    case GST_MESSAGE_EOS:
+        //DBG( "EOS, reset state to NULL" );
+        gst_element_set_state( mpPlaybin, GST_STATE_READY );
+        mbPlayPending = false;
+        if (mbLooping)
+            start();
+        break;
+    case GST_MESSAGE_STATE_CHANGED:
+        if( message->src == GST_OBJECT( mpPlaybin ) ) {
+            GstState newstate, pendingstate;
+
+            gst_message_parse_state_changed (message, NULL, &newstate, &pendingstate);
+
+            if( newstate == GST_STATE_PAUSED &&
+                pendingstate == GST_STATE_VOID_PENDING &&
+                mpXOverlay )
+                gst_x_overlay_expose( mpXOverlay );
+
+        if (mbPlayPending)
+            mbPlayPending = ((newstate == GST_STATE_READY) || (newstate == GST_STATE_PAUSED));
+        }
+    default:
+        break;
+    }
+}
+
+GstBusSyncReply Player::processSyncMessage( GstMessage *message )
+{
+    DBG( "%p processSyncMessage", this );
+    //DBG ( "gst message received: src name: %s structure type: %s",
+    //            gst_object_get_name (message->src),
+    //            message->structure ? gst_structure_get_name (message->structure) : "<none>");
+
+    if (message->structure) {
+        if( !strcmp( gst_structure_get_name( message->structure ), "prepare-xwindow-id" ) && mnWindowID != 0 ) {
+            if( mpXOverlay )
+                g_object_unref( G_OBJECT ( mpXOverlay ) );
+            mpXOverlay = GST_X_OVERLAY( GST_MESSAGE_SRC( message ) );
+            g_object_ref( G_OBJECT ( mpXOverlay ) );
+            gst_x_overlay_set_xwindow_id( mpXOverlay, mnWindowID );
+            return GST_BUS_DROP;
+        }
+    }
+
+    if( GST_MESSAGE_TYPE( message ) == GST_MESSAGE_STATE_CHANGED ) {
+        if( message->src == GST_OBJECT( mpPlaybin ) ) {
+            GstState newstate, pendingstate;
+
+            gst_message_parse_state_changed (message, NULL, &newstate, &pendingstate);
+
+            DBG( "%p state change received, new state %d", this, newstate );
+            if( newstate == GST_STATE_PAUSED &&
+                pendingstate == GST_STATE_VOID_PENDING ) {
+                
+                DBG( "%p change to paused received", this );
+
+                if( mnDuration == 0) {
+                    GstFormat format = GST_FORMAT_TIME;
+                    gint64 gst_duration = 0L;
+
+                    if( gst_element_query_duration( mpPlaybin, &format, &gst_duration) && format == GST_FORMAT_TIME && gst_duration > 0L )
+                        mnDuration = gst_duration;
+                }
+
+                if( mnWidth == 0 ) {
+                    GList *pStreamInfo = NULL;
+
+                    g_object_get( G_OBJECT( mpPlaybin ), "stream-info", &pStreamInfo, NULL );
+
+                    for ( ; pStreamInfo != NULL; pStreamInfo = pStreamInfo->next) {
+                        GObject *pInfo = G_OBJECT( pStreamInfo->data );
+
+                        if( !pInfo )
+                            continue;
+
+                        int nType;
+                        g_object_get( pInfo, "type", &nType, NULL );
+                        GEnumValue *pValue = g_enum_get_value( G_PARAM_SPEC_ENUM( g_object_class_find_property( G_OBJECT_GET_CLASS( pInfo ), "type" ) )->enum_class,
+                                                               nType );
+
+                        if( !g_strcasecmp( pValue->value_nick, "video" ) ) {
+                            GstStructure *pStructure;
+                            GstPad *pPad;
+
+                            g_object_get( pInfo, "object", &pPad, NULL );
+                            pStructure = gst_caps_get_structure( GST_PAD_CAPS( pPad ), 0 );
+                            if( pStructure ) {
+                                gst_structure_get_int( pStructure, "width", &mnWidth );
+                                gst_structure_get_int( pStructure, "height", &mnHeight );
+                                DBG( "queried size: %d x %d", mnWidth, mnHeight );
+                            }
+                        }
+                    }
+
+                    sal_Bool aSuccess = osl_setCondition( maSizeCondition );
+                    DBG( "%p set condition result: %d", this, aSuccess );
+                }
+            }
+        }
+    } else if( GST_MESSAGE_TYPE( message ) == GST_MESSAGE_ERROR ) {
+        if( mnWidth == 0 ) {
+            // an error occured, set condition so that OOo thread doesn't wait for us
+            sal_Bool aSuccess = osl_setCondition( maSizeCondition );
+            DBG( "%p set condition result: %d", this, aSuccess );
+        }
+    }
+
+    return GST_BUS_PASS;
+}
+
+void Player::preparePlaybin( const ::rtl::OUString& rURL, bool bFakeVideo )
+{
+        GstBus *pBus;
+
+        //sal_Bool aSuccess = osl_setCondition( maSizeCondition );
+        //DBG( "%p set condition result: %d", this, aSuccess );
+
+        if( mpPlaybin != NULL ) {
+            gst_element_set_state( mpPlaybin, GST_STATE_NULL );
+            mbPlayPending = false;
+            g_object_unref( mpPlaybin );
+        }
+
+        mpPlaybin = gst_element_factory_make( "playbin", NULL );
+
+        if( bFakeVideo )
+            g_object_set( G_OBJECT( mpPlaybin ), "video-sink", gst_element_factory_make( "fakesink", NULL ), NULL );
+
+        mbFakeVideo = bFakeVideo;
+
+        rtl::OString ascURL = OUStringToOString( rURL, RTL_TEXTENCODING_ASCII_US );
+        g_object_set( G_OBJECT( mpPlaybin ), "uri", ascURL.getStr() , NULL );
+
+        pBus = gst_element_get_bus( mpPlaybin );
+        gst_bus_add_watch( pBus, gst_pipeline_bus_callback, this );
+        DBG( "%p set sync handler", this );
+        gst_bus_set_sync_handler( pBus, gst_pipeline_bus_sync_handler, this );
+        g_object_unref( pBus );
+}
+
+bool Player::create( const ::rtl::OUString& rURL )
+{
+    bool    bRet = false;
+
+    // create all the elements and link them     
+    
+    if( mbInitialized )
+    {
+        preparePlaybin( rURL, true );
+
+        gst_element_set_state( mpPlaybin, GST_STATE_PAUSED );
+        mbPlayPending = false;
+
+        bRet = true;
+    }
+
+
+    if( bRet )
+        maURL = rURL;
+    else
+        maURL = ::rtl::OUString();
+
+    return bRet;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::start(  )
+    throw (uno::RuntimeException)
+{
+    //DBG ("Player::start");
+
+    // set the pipeline state to READY and run the loop
+    if( mbInitialized && NULL != mpPlaybin )
+    {
+        gst_element_set_state( mpPlaybin, GST_STATE_PLAYING );
+        mbPlayPending = true;
+    }
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::stop(  )
+    throw (uno::RuntimeException)
+{
+    // set the pipeline in PAUSED STATE
+    if( mpPlaybin )
+        gst_element_set_state( mpPlaybin, GST_STATE_PAUSED );
+
+    mbPlayPending = false;
+    DBG( "stop %p", mpPlaybin );
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Player::isPlaying()
+    throw (uno::RuntimeException)
+{
+    bool            bRet = mbPlayPending;
+
+    // return whether the pipeline is in PLAYING STATE or not
+    if( !mbPlayPending && mbInitialized && mpPlaybin )
+    {
+        bRet = GST_STATE_PLAYING == GST_STATE( mpPlaybin );
+    }
+
+    DBG( "isPlaying %d", bRet );
+
+    return bRet;
+}
+
+// ------------------------------------------------------------------------------
+
+double SAL_CALL Player::getDuration(  )
+    throw (uno::RuntimeException)
+{
+    // slideshow checks for non-zero duration, so cheat here
+    double duration = 0.01;
+
+    if( mpPlaybin && mnDuration > 0 ) {
+        duration = mnDuration / 1E9;
+
+        //DBG( "gst duration: %lld ns duration: %lf s", gst_duration, duration );
+    }
+
+    return duration;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::setMediaTime( double fTime )
+    throw (uno::RuntimeException)
+{
+    if( mpPlaybin ) {
+        gint64 gst_position = llround (fTime * 1E9);
+
+        gst_element_seek( mpPlaybin, 1.0,
+                          GST_FORMAT_TIME,
+                          GST_SEEK_FLAG_FLUSH,
+                          GST_SEEK_TYPE_SET, gst_position,
+                          GST_SEEK_TYPE_NONE, 0 );
+        if( !isPlaying() )
+            gst_element_set_state( mpPlaybin, GST_STATE_PAUSED );
+
+        DBG( "seek to: %lld ns original: %lf s", gst_position, fTime );
+    }
+}
+
+// ------------------------------------------------------------------------------
+
+double SAL_CALL Player::getMediaTime(  )
+    throw (uno::RuntimeException)
+{
+    double position = 0.0;
+
+    if( mpPlaybin ) {
+        // get current position in the stream
+        GstFormat format = GST_FORMAT_TIME;
+        gint64 gst_position;
+        if( gst_element_query_position( mpPlaybin, &format, &gst_position ) && format == GST_FORMAT_TIME && gst_position > 0L )
+            position = gst_position / 1E9;
+    }
+    
+    return position; 
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::setStopTime( double fTime )
+    throw (uno::RuntimeException)
+{
+    // TODO implement
+}
+
+// ------------------------------------------------------------------------------
+
+double SAL_CALL Player::getStopTime(  )
+    throw (uno::RuntimeException)
+{
+    // Get the time at which to stop
+
+    return 0; 
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::setRate( double fRate )
+    throw (uno::RuntimeException)
+{
+    // TODO set the window rate
+}
+
+// ------------------------------------------------------------------------------
+
+double SAL_CALL Player::getRate(  )
+    throw (uno::RuntimeException)
+{
+    double rate = 0.0;
+
+    // TODO get the window rate
+    if( mbInitialized )
+    {
+        
+    }
+    
+    return rate;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::setPlaybackLoop( sal_Bool bSet )
+    throw (uno::RuntimeException)
+{
+    // TODO check how to do with GST
+    mbLooping = bSet;
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Player::isPlaybackLoop(  )
+    throw (uno::RuntimeException)
+{
+    // TODO check how to do with GST
+    return mbLooping;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::setMute( sal_Bool bSet )
+    throw (uno::RuntimeException)
+{
+    DBG( "set mute: %d muted: %d unmuted volume: %lf", bSet, mbMuted, mnUnmutedVolume );
+
+    // change the volume to 0 or the unmuted volume
+    if(  mpPlaybin && mbMuted != bSet )
+    {
+        double nVolume = mnUnmutedVolume;
+        if( bSet )
+        {
+            nVolume = 0.0;
+        }
+
+        g_object_set( G_OBJECT( mpPlaybin ), "volume", nVolume, NULL );
+
+        mbMuted = bSet;
+    }
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Player::isMute(  )
+    throw (uno::RuntimeException)
+{
+    return mbMuted;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Player::setVolumeDB( sal_Int16 nVolumeDB ) 
+    throw (uno::RuntimeException)
+{
+    mnUnmutedVolume = pow( 10.0, nVolumeDB / 20.0 );
+
+    DBG( "set volume: %d gst volume: %lf", nVolumeDB, mnUnmutedVolume );
+
+    // change volume
+     if( !mbMuted && mpPlaybin )
+     {
+         g_object_set( G_OBJECT( mpPlaybin ), "volume", (gdouble) mnUnmutedVolume, NULL );
+     }
+}
+
+// ------------------------------------------------------------------------------
+    
+sal_Int16 SAL_CALL Player::getVolumeDB(  ) 
+    throw (uno::RuntimeException)
+{
+    sal_Int16 nVolumeDB;
+
+    if( mpPlaybin ) {
+        double nGstVolume = 0.0;
+
+        g_object_get( G_OBJECT( mpPlaybin ), "volume", &nGstVolume, NULL );
+
+        nVolumeDB = (sal_Int16) ( 20.0*log10 ( nGstVolume ) );
+
+        //DBG( "get volume: %d gst volume: %lf", nVolumeDB, nGstVolume );
+    }
+
+    return nVolumeDB;
+}
+
+// ------------------------------------------------------------------------------
+
+awt::Size SAL_CALL Player::getPreferredPlayerWindowSize(  )
+    throw (uno::RuntimeException)
+{
+    awt::Size aSize( 0, 0 );
+    
+    DBG( "%p Player::getPreferredPlayerWindowSize, member %d x %d", this, mnWidth, mnHeight );
+
+    TimeValue aTimeout = { 10, 0 };
+    oslConditionResult aResult = osl_waitCondition( maSizeCondition, &aTimeout );
+
+    if( mbFakeVideo ) {
+        mbFakeVideo = sal_False;
+
+         g_object_set( G_OBJECT( mpPlaybin ), "video-sink", NULL, NULL );
+         gst_element_set_state( mpPlaybin, GST_STATE_READY );
+         gst_element_set_state( mpPlaybin, GST_STATE_PAUSED );
+    }
+
+    DBG( "%p Player::getPreferredPlayerWindowSize after waitCondition %d, member %d x %d", this, aResult, mnWidth, mnHeight );
+
+    if( mnWidth != 0 && mnHeight != 0 ) {
+        aSize.Width = mnWidth;
+        aSize.Height = mnHeight;
+    }
+
+    return aSize;
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Reference< ::media::XPlayerWindow > SAL_CALL Player::createPlayerWindow( const uno::Sequence< uno::Any >& rArguments )
+    throw (uno::RuntimeException)
+{
+    uno::Reference< ::media::XPlayerWindow >    xRet;
+    awt::Size                                   aSize( getPreferredPlayerWindowSize() );
+
+    DBG( "Player::createPlayerWindow %d %d length: %d", aSize.Width, aSize.Height, rArguments.getLength() );
+
+    if( aSize.Width > 0 && aSize.Height > 0 )
+    {
+        ::avmedia::gstreamer::Window* pWindow = new ::avmedia::gstreamer::Window( mxMgr, *this );
+
+        xRet = pWindow;
+
+        if( rArguments.getLength() > 2 ) {
+            rArguments[ 2 ] >>= mnWindowID;
+            DBG( "window ID: %ld", mnWindowID );
+        }
+
+        //if( !pWindow->create( aArguments ) )
+        //xRet = uno::Reference< ::media::XPlayerWindow >();
+    }
+
+    return xRet;
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Reference< media::XFrameGrabber > SAL_CALL Player::createFrameGrabber(  )
+    throw (uno::RuntimeException)
+{
+    uno::Reference< media::XFrameGrabber > xRet;
+
+    /*if( maURL.getLength() > 0 )
+    {
+        FrameGrabber* pGrabber = new FrameGrabber( mxMgr );
+        
+        xRet = pGrabber;
+        
+        if( !pGrabber->create( maURL ) )
+            xRet.clear();
+            }*/
+    
+    return xRet;
+}
+
+// ------------------------------------------------------------------------------
+
+::rtl::OUString SAL_CALL Player::getImplementationName(  )
+    throw (uno::RuntimeException)
+{
+    return ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( AVMEDIA_GST_PLAYER_IMPLEMENTATIONNAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Player::supportsService( const ::rtl::OUString& ServiceName )
+    throw (uno::RuntimeException)
+{
+    return ServiceName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM ( AVMEDIA_GST_PLAYER_SERVICENAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Sequence< ::rtl::OUString > SAL_CALL Player::getSupportedServiceNames(  )
+    throw (uno::RuntimeException)
+{
+    uno::Sequence< ::rtl::OUString > aRet(1);
+    aRet[0] = ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM ( AVMEDIA_GST_PLAYER_SERVICENAME ) );
+
+    return aRet;
+}
+
+} // namespace gstreamer
+} // namespace avmedia
diff --git avmedia/source/gstreamer/gstplayer.hxx avmedia/source/gstreamer/gstplayer.hxx
new file mode 100644
index 0000000..f259c5b
--- /dev/null
+++ avmedia/source/gstreamer/gstplayer.hxx
@@ -0,0 +1,121 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef _PLAYER_HXX
+#define _PLAYER_HXX
+
+#include <osl/conditn.h>
+#include "gstcommon.hxx"
+
+#ifndef _COM_SUN_STAR_MEDIA_XPLAYER_HDL_
+#include "com/sun/star/media/XPlayer.hdl"
+#endif
+
+typedef struct _GstXOverlay GstXOverlay;
+
+namespace avmedia { namespace gstreamer {
+
+// ----------
+// - Player -
+// ----------
+
+class Player : public ::cppu::WeakImplHelper2< ::com::sun::star::media::XPlayer,
+                                               ::com::sun::star::lang::XServiceInfo >
+{
+public:
+
+    Player( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& rxMgr );
+    ~Player();
+
+    void preparePlaybin( const ::rtl::OUString& rURL, bool bFakeVideo );
+    bool create( const ::rtl::OUString& rURL );
+    void processMessage( GstMessage *message );
+    GstBusSyncReply processSyncMessage( GstMessage *message );
+
+    // XPlayer
+    virtual void SAL_CALL start(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL stop(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL isPlaying(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual double SAL_CALL getDuration(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setMediaTime( double fTime ) throw (::com::sun::star::uno::RuntimeException);
+    virtual double SAL_CALL getMediaTime(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setStopTime( double fTime ) throw (::com::sun::star::uno::RuntimeException);
+    virtual double SAL_CALL getStopTime(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setRate( double fRate ) throw (::com::sun::star::uno::RuntimeException);
+    virtual double SAL_CALL getRate(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setPlaybackLoop( sal_Bool bSet ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL isPlaybackLoop(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setMute( sal_Bool bSet ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL isMute(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setVolumeDB( sal_Int16 nVolumeDB ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Int16 SAL_CALL getVolumeDB(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::awt::Size SAL_CALL getPreferredPlayerWindowSize(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::media::XPlayerWindow > SAL_CALL createPlayerWindow( const ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Any >& aArguments ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::media::XFrameGrabber > SAL_CALL createFrameGrabber(  ) throw (::com::sun::star::uno::RuntimeException);
+
+    // XServiceInfo
+    virtual ::rtl::OUString SAL_CALL getImplementationName(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL supportsService( const ::rtl::OUString& ServiceName ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Sequence< ::rtl::OUString > SAL_CALL getSupportedServiceNames(  ) throw (::com::sun::star::uno::RuntimeException);
+
+private:
+
+    ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory > mxMgr;
+
+    ::rtl::OUString         maURL;
+    
+    // Add elements and pipeline here
+    GstElement*             mpPlaybin;  // the playbin is also a pipeline
+    sal_Bool                mbFakeVideo;
+
+    gdouble                 mnUnmutedVolume;
+    sal_Bool                mbPlayPending;
+    sal_Bool                mbMuted;
+    sal_Bool                mbLooping;
+    sal_Bool                mbInitialized;
+
+    long                    mnWindowID;
+    GstXOverlay*            mpXOverlay;
+    gint64                  mnDuration;
+    int                     mnWidth;
+    int                     mnHeight;
+
+    oslCondition            maSizeCondition;
+};
+
+} // namespace gstreamer
+} // namespace avmedia
+
+#endif // _PLAYER_HXX
diff --git avmedia/source/gstreamer/gstuno.cxx avmedia/source/gstreamer/gstuno.cxx
new file mode 100644
index 0000000..e39d023
--- /dev/null
+++ avmedia/source/gstreamer/gstuno.cxx
@@ -0,0 +1,111 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include "gstmanager.hxx"
+
+using namespace ::com::sun::star;
+
+// -------------------
+// - factory methods -
+// -------------------
+
+static uno::Reference< uno::XInterface > SAL_CALL create_MediaPlayer( const uno::Reference< lang::XMultiServiceFactory >& rxFact )
+{
+    return uno::Reference< uno::XInterface >( *new ::avmedia::gstreamer::Manager( rxFact ) );
+}
+
+// ------------------------------------------
+// - component_getImplementationEnvironment -
+// ------------------------------------------
+
+extern "C" void SAL_CALL component_getImplementationEnvironment( const sal_Char ** ppEnvTypeName, uno_Environment ** ppEnv )
+{
+    *ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
+}
+
+// -----------------------
+// - component_writeInfo -
+// -----------------------
+
+extern "C" sal_Bool SAL_CALL component_writeInfo( void* pServiceManager, void* pRegistryKey )
+{
+    sal_Bool bRet = sal_False;
+
+    if( pRegistryKey )
+    {
+        try
+        {
+            uno::Reference< registry::XRegistryKey > xNewKey1(
+                static_cast< registry::XRegistryKey* >( pRegistryKey )->createKey(                                
+                ::rtl::OUString::createFromAscii( "/com.sun.star.comp.media.Manager_GStreamer/UNO/SERVICES/com.sun.star.media.Manager_GStreamer" ) ) );
+
+            bRet = sal_True;
+        }
+        catch( registry::InvalidRegistryException& )
+        {
+            OSL_ENSURE( sal_False, "### InvalidRegistryException!" );
+        }
+    }
+
+    return bRet;
+}
+
+// ------------------------
+// - component_getFactory -
+// ------------------------
+
+extern "C" void* SAL_CALL component_getFactory( const sal_Char* pImplName, void* pServiceManager, void* pRegistryKey )
+{
+    uno::Reference< lang::XSingleServiceFactory > xFactory;
+    void*									pRet = 0;
+
+    if( rtl_str_compare( pImplName, "com.sun.star.comp.media.Manager_GStreamer" ) == 0 )
+    {
+        const ::rtl::OUString aServiceName( ::rtl::OUString::createFromAscii( "com.sun.star.media.Manager_GStreamer" ) );
+
+        xFactory = uno::Reference< lang::XSingleServiceFactory >( ::cppu::createSingleFactory(
+                        reinterpret_cast< lang::XMultiServiceFactory* >( pServiceManager ),
+                        ::rtl::OUString::createFromAscii( "com.sun.star.comp.media.Manager_GStreamer" ),
+                        create_MediaPlayer, uno::Sequence< ::rtl::OUString >( &aServiceName, 1 ) ) );
+    }
+
+    if( xFactory.is() )
+    {
+        xFactory->acquire();
+        pRet = xFactory.get();
+    }
+
+    return pRet;
+}
diff --git avmedia/source/gstreamer/gstwindow.cxx avmedia/source/gstreamer/gstwindow.cxx
new file mode 100644
index 0000000..3ba5e61
--- /dev/null
+++ avmedia/source/gstreamer/gstwindow.cxx
@@ -0,0 +1,365 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include <com/sun/star/awt/SystemPointer.hdl>
+
+#include "gstwindow.hxx"
+#include "gstplayer.hxx"
+
+#define AVMEDIA_GST_WINDOW_IMPLEMENTATIONNAME "com.sun.star.comp.avmedia.Window_GStreamer"
+#define AVMEDIA_GST_WINDOW_SERVICENAME "com.sun.star.media.Window_GStreamer"
+
+using namespace ::com::sun::star;
+
+namespace avmedia { namespace gstreamer {
+
+// -----------
+// - statics -
+// -----------
+
+static ::osl::Mutex& ImplGetOwnStaticMutex()
+{
+    static ::osl::Mutex* pMutex = NULL;
+
+    if( pMutex == NULL )
+    {
+        ::osl::MutexGuard aGuard( ::osl::Mutex::getGlobalMutex() );
+
+        if( pMutex == NULL )
+        {
+            static ::osl::Mutex aMutex;
+            pMutex = &aMutex;
+        }
+    }
+
+    return *pMutex;
+}
+
+// ---------------
+// - Window -
+// ---------------
+
+// ------------------------------------------------------------------------------
+
+Window::Window( const uno::Reference< lang::XMultiServiceFactory >& rxMgr, Player& rPlayer ) :
+    mxMgr( rxMgr ),
+    maListeners( maMutex ),
+    meZoomLevel( media::ZoomLevel_NOT_AVAILABLE ),
+    mrPlayer( rPlayer ),
+    mnPointerType( awt::SystemPointer::ARROW )
+{
+    ::osl::MutexGuard aGuard( ImplGetOwnStaticMutex() );
+
+}
+
+// ------------------------------------------------------------------------------
+
+Window::~Window()
+{
+}
+
+// XPlayerWindow
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::update(  )
+    throw (uno::RuntimeException)
+{
+    //::RedrawWindow( (HWND) mnFrameWnd, NULL, NULL, RDW_ALLCHILDREN | RDW_INVALIDATE | RDW_UPDATENOW | RDW_ERASE  );
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Window::setZoomLevel( media::ZoomLevel eZoomLevel )
+    throw (uno::RuntimeException)
+{
+        sal_Bool bRet = false;
+
+        if( media::ZoomLevel_NOT_AVAILABLE != meZoomLevel &&
+            media::ZoomLevel_NOT_AVAILABLE != eZoomLevel )
+        {
+            if( eZoomLevel != meZoomLevel )
+            {
+                meZoomLevel = eZoomLevel;
+                //ImplLayoutVideoWindow();
+            }
+
+            bRet = true;
+        }
+
+        return bRet;
+}
+
+// ------------------------------------------------------------------------------
+
+media::ZoomLevel SAL_CALL Window::getZoomLevel(  )
+    throw (uno::RuntimeException)
+{
+    return meZoomLevel;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::setPointerType( sal_Int32 nPointerType ) 
+    throw (uno::RuntimeException)
+{
+    mnPointerType = nPointerType;
+}
+
+// XWindow
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::setPosSize( sal_Int32 X, sal_Int32 Y, sal_Int32 Width, sal_Int32 Height, sal_Int16 Flags )
+    throw (uno::RuntimeException)
+{
+//     if( mnFrameWnd )
+//     {
+//         ::SetWindowPos( (HWND) mnFrameWnd, HWND_TOP, X, Y, Width, Height, 0 );
+//         ImplLayoutVideoWindow();
+//     }
+}
+
+// ------------------------------------------------------------------------------
+
+awt::Rectangle SAL_CALL Window::getPosSize()
+    throw (uno::RuntimeException)
+{
+    awt::Rectangle aRet;
+
+    aRet.X = aRet.Y = 0;
+    aRet.Width = 320;
+    aRet.Height = 240;
+
+//     if( mnFrameWnd )
+//     {
+//         ::RECT  aWndRect;
+//         long    nX = 0, nY = 0, nWidth = 0, nHeight = 0;
+
+//         if( ::GetClientRect( (HWND) mnFrameWnd, &aWndRect ) )
+//         {
+//             aRet.X = aWndRect.left;
+//             aRet.Y = aWndRect.top;
+//             aRet.Width = aWndRect.right - aWndRect.left + 1;
+//             aRet.Height = aWndRect.bottom - aWndRect.top + 1;
+//         }
+//     }
+
+    return aRet;
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::setVisible( sal_Bool bVisible )
+    throw (uno::RuntimeException)
+{
+//     if( mnFrameWnd )
+//     {
+//         IVideoWindow* pVideoWindow = const_cast< IVideoWindow* >( mrPlayer.getVideoWindow() );
+
+//         if( pVideoWindow )
+//             pVideoWindow->put_Visible( bVisible ? OATRUE : OAFALSE );
+
+//         ::ShowWindow( (HWND) mnFrameWnd, bVisible ? SW_SHOW : SW_HIDE );
+//     }
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::setEnable( sal_Bool bEnable )
+    throw (uno::RuntimeException)
+{
+//     if( mnFrameWnd )
+//         ::EnableWindow( (HWND) mnFrameWnd, bEnable );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::setFocus(  )
+    throw (uno::RuntimeException)
+{
+//     if( mnFrameWnd )
+//         ::SetFocus( (HWND) mnFrameWnd );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addWindowListener( const uno::Reference< awt::XWindowListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removeWindowListener( const uno::Reference< awt::XWindowListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addFocusListener( const uno::Reference< awt::XFocusListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removeFocusListener( const uno::Reference< awt::XFocusListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addKeyListener( const uno::Reference< awt::XKeyListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removeKeyListener( const uno::Reference< awt::XKeyListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addMouseListener( const uno::Reference< awt::XMouseListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removeMouseListener( const uno::Reference< awt::XMouseListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addMouseMotionListener( const uno::Reference< awt::XMouseMotionListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removeMouseMotionListener( const uno::Reference< awt::XMouseMotionListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addPaintListener( const uno::Reference< awt::XPaintListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removePaintListener( const uno::Reference< awt::XPaintListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+
+// XComponent
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::dispose(  )
+    throw (uno::RuntimeException)
+{
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::addEventListener( const uno::Reference< lang::XEventListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.addInterface( getCppuType( &xListener ), xListener );
+}
+
+// ------------------------------------------------------------------------------
+
+void SAL_CALL Window::removeEventListener( const uno::Reference< lang::XEventListener >& xListener )
+    throw (uno::RuntimeException)
+{
+    maListeners.removeInterface( getCppuType( &xListener ), xListener );
+}
+
+// XServiceInfo
+// ------------------------------------------------------------------------------
+
+::rtl::OUString SAL_CALL Window::getImplementationName(  )
+    throw (uno::RuntimeException)
+{
+    return ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( AVMEDIA_GST_WINDOW_IMPLEMENTATIONNAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL Window::supportsService( const ::rtl::OUString& ServiceName )
+    throw (uno::RuntimeException)
+{
+    return ServiceName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM ( AVMEDIA_GST_WINDOW_SERVICENAME ) );
+}
+
+// ------------------------------------------------------------------------------
+
+uno::Sequence< ::rtl::OUString > SAL_CALL Window::getSupportedServiceNames(  )
+    throw (uno::RuntimeException)
+{
+    uno::Sequence< ::rtl::OUString > aRet(1);
+    aRet[0] = ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM ( AVMEDIA_GST_WINDOW_SERVICENAME ) );
+
+    return aRet;
+}
+
+} // namespace gstreamer
+} // namespace avmedia
diff --git avmedia/source/gstreamer/gstwindow.hxx avmedia/source/gstreamer/gstwindow.hxx
new file mode 100644
index 0000000..b4dd5c3
--- /dev/null
+++ avmedia/source/gstreamer/gstwindow.hxx
@@ -0,0 +1,119 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef _WINDOW_HXX
+#define _WINDOW_HXX
+
+#include "gstcommon.hxx"
+#include <cppuhelper/interfacecontainer.h>
+
+#ifndef _COM_SUN_STAR_MEDIA_XPLAYERWINDOW_HDL_
+#include "com/sun/star/media/XPlayerWindow.hdl"
+#endif
+
+namespace avmedia { namespace gstreamer {
+
+// ---------------
+// - Window -
+// ---------------
+
+class Player;
+
+class Window : public ::cppu::WeakImplHelper2 < ::com::sun::star::media::XPlayerWindow,
+                                                ::com::sun::star::lang::XServiceInfo >
+{
+public:
+
+            Window( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& rxMgr,
+                    Player& rPlayer );
+            ~Window();
+
+    bool    create( const ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Any >& aArguments );
+    void    processGraphEvent();
+    void    updatePointer();
+
+    // XPlayerWindow
+    virtual void SAL_CALL update(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL setZoomLevel( ::com::sun::star::media::ZoomLevel ZoomLevel ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::media::ZoomLevel SAL_CALL getZoomLevel(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setPointerType( sal_Int32 nPointerType ) throw (::com::sun::star::uno::RuntimeException);
+
+    // XWindow
+    virtual void SAL_CALL setPosSize( sal_Int32 X, sal_Int32 Y, sal_Int32 Width, sal_Int32 Height, sal_Int16 Flags ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::awt::Rectangle SAL_CALL getPosSize(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setVisible( sal_Bool Visible ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setEnable( sal_Bool Enable ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL setFocus(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XWindowListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeWindowListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XWindowListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addFocusListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XFocusListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeFocusListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XFocusListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addKeyListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XKeyListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeKeyListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XKeyListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addMouseListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMouseListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeMouseListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMouseListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addMouseMotionListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMouseMotionListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeMouseMotionListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMouseMotionListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addPaintListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XPaintListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removePaintListener( const ::com::sun::star::uno::Reference< ::com::sun::star::awt::XPaintListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+
+    // XComponent
+    virtual void SAL_CALL dispose(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL addEventListener( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XEventListener >& xListener ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeEventListener( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XEventListener >& aListener ) throw (::com::sun::star::uno::RuntimeException);
+
+    // XServiceInfo
+    virtual ::rtl::OUString SAL_CALL getImplementationName(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual sal_Bool SAL_CALL supportsService( const ::rtl::OUString& ServiceName ) throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Sequence< ::rtl::OUString > SAL_CALL getSupportedServiceNames(  ) throw (::com::sun::star::uno::RuntimeException);
+
+
+private:
+
+    ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory > mxMgr;
+
+    ::osl::Mutex                                maMutex;
+    ::cppu::OMultiTypeInterfaceContainerHelper  maListeners;
+    ::com::sun::star::media::ZoomLevel          meZoomLevel;
+    Player&                                     mrPlayer;
+    int                                         mnPointerType;
+
+    void                                        ImplLayoutVideoWindow();
+};
+
+} // namespace gstreamer
+} // namespace avmedia
+
+#endif // _WINDOW_HXX
diff --git avmedia/source/gstreamer/makefile.mk avmedia/source/gstreamer/makefile.mk
new file mode 100644
index 0000000..2f1b9c8
--- /dev/null
+++ avmedia/source/gstreamer/makefile.mk
@@ -0,0 +1,85 @@
+#*************************************************************************
+#
+#   OpenOffice.org - a multi-platform office productivity suite
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to
+#   the terms of GNU Lesser General Public License Version 2.1.
+#
+#
+#     GNU Lesser General Public License Version 2.1
+#     =============================================
+#     Copyright 2005 by Sun Microsystems, Inc.
+#     901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License version 2.1, as published by the Free Software Foundation.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#     MA  02111-1307  USA
+#
+#*************************************************************************
+
+PRJ=..$/..
+PRJNAME=avmedia
+TARGET=avmediagst
+
+# --- Settings ----------------------------------
+
+.INCLUDE :  	settings.mk
+
+.IF "$(ENABLE_GSTREAMER)" == "TRUE"
+
+.IF "$(verbose)"!="" || "$(VERBOSE)"!=""
+CDEFS+= -DVERBOSE
+.ENDIF
+
+PKGCONFIG_MODULES=gstreamer-0.10, gstreamer-plugins-base-0.10
+.INCLUDE: pkg_config.mk
+PKGCONFIG_LIBS+=-lgstinterfaces-0.10
+
+# --- Files ----------------------------------
+
+.IF "$(GUI)" == "UNX" || "$(GUI)" == "WNT"
+
+.IF "$(GUI)" == "WNT"
+CDEFS+= -DWINNT
+.ENDIF
+
+SLOFILES= \
+        $(SLO)$/gstuno.obj      \
+        $(SLO)$/gstmanager.obj  \
+        $(SLO)$/gstplayer.obj	\
+        $(SLO)$/gstwindow.obj
+        
+
+EXCEPTIONSFILES= \
+        $(SLO)$/gstuno.obj      \
+
+SHL1TARGET=$(TARGET)
+SHL1STDLIBS= $(CPPULIB) $(SALLIB) $(COMPHELPERLIB) $(CPPUHELPERLIB) $(PKGCONFIG_LIBS) $(TOOLSLIB)
+SHL1IMPLIB=i$(TARGET)
+SHL1LIBS=$(SLB)$/$(TARGET).lib
+SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+
+DEF1NAME=$(SHL1TARGET)
+DEF1EXPORTFILE=exports.dxp
+
+.ENDIF
+
+.ENDIF
+
+.INCLUDE :  	target.mk
diff --git avmedia/source/inc/mediamisc.hxx avmedia/source/inc/mediamisc.hxx
index 1ff044d..a505f23 100644
--- avmedia/source/inc/mediamisc.hxx
+++ avmedia/source/inc/mediamisc.hxx
@@ -32,6 +32,9 @@ class ResMgr;
 
 #define AVMEDIA_RESID( nId ) ResId( nId, * ::avmedia::GetResMgr() )
 
+#ifdef GSTREAMER
+#define AVMEDIA_MANAGER_SERVICE_NAME "com.sun.star.media.Manager_GStreamer"
+#else
 #ifdef WNT 
 #define AVMEDIA_MANAGER_SERVICE_NAME "com.sun.star.media.Manager_DirectX"
 #else
@@ -41,6 +44,7 @@ class ResMgr;
 #define AVMEDIA_MANAGER_SERVICE_NAME "com.sun.star.media.Manager_Java"
 #endif
 #endif
+#endif
  
 namespace avmedia
 {
diff --git avmedia/source/viewer/mediawindow.cxx avmedia/source/viewer/mediawindow.cxx
index f6ca9f0..d345bb8 100644
--- avmedia/source/viewer/mediawindow.cxx
+++ avmedia/source/viewer/mediawindow.cxx
@@ -371,6 +371,7 @@ void MediaWindow::getMediaFilters( FilterNameVector& rFilterNameVector )
                                         "AU Audio", "au",
                                         "AVI", "avi",
                                         "CD Audio", "cda",
+                                        "FLAC Audio", "flac",
                                         "MIDI Audio", "mid;midi",
                                         "MPEG Audio", "mp2;mp3;mpa",
                                         "MPEG Video", "mpg;mpeg;mpv;mp4",
diff --git avmedia/source/viewer/mediawindow_impl.cxx avmedia/source/viewer/mediawindow_impl.cxx
index 9ea9742..ca9e08e 100644
--- avmedia/source/viewer/mediawindow_impl.cxx
+++ avmedia/source/viewer/mediawindow_impl.cxx
@@ -39,6 +39,11 @@
 #include <osl/mutex.hxx>
 #include <tools/time.hxx>
 #include <vcl/svapp.hxx>
+#ifdef UNX
+#ifndef _SV_SYSDATA_HXX
+#include <vcl/sysdata.hxx>
+#endif
+#endif
 
 #ifndef _COM_SUN_STAR_AWT_SYSTEMPOINTER_HDL_
 #include <com/sun/star/awt/SystemPointer.hdl>
@@ -97,7 +102,11 @@ void  MediaWindowControl::execute( const MediaItem& rItem )
 // --------------------
 
 MediaChildWindow::MediaChildWindow( Window* pParent ) :
+#ifdef GSTREAMER
+    SystemChildWindow( pParent, WB_CLIPCHILDREN )
+#else
     JavaChildWindow( pParent, WB_CLIPCHILDREN )
+#endif
 {
 }
 
@@ -114,7 +123,11 @@ void MediaChildWindow::MouseMove( const MouseEvent& rMEvt )
     const MouseEvent aTransformedEvent( GetParent()->ScreenToOutputPixel( OutputToScreenPixel( rMEvt.GetPosPixel() ) ),
                                           rMEvt.GetClicks(), rMEvt.GetMode(), rMEvt.GetButtons(), rMEvt.GetModifier() );
     
+#ifdef GSTREAMER
+    SystemChildWindow::MouseMove( rMEvt );
+#else
     JavaChildWindow::MouseMove( rMEvt );
+#endif
     GetParent()->MouseMove( aTransformedEvent );
 }
 
@@ -125,7 +138,11 @@ void MediaChildWindow::MouseButtonDown( const MouseEvent& rMEvt )
     const MouseEvent aTransformedEvent( GetParent()->ScreenToOutputPixel( OutputToScreenPixel( rMEvt.GetPosPixel() ) ),
                                           rMEvt.GetClicks(), rMEvt.GetMode(), rMEvt.GetButtons(), rMEvt.GetModifier() );
     
+#ifdef GSTREAMER
+    SystemChildWindow::MouseButtonDown( rMEvt );
+#else
     JavaChildWindow::MouseButtonDown( rMEvt );
+#endif
     GetParent()->MouseButtonDown( aTransformedEvent );
 }
 
@@ -136,7 +153,11 @@ void MediaChildWindow::MouseButtonUp( const MouseEvent& rMEvt )
     const MouseEvent aTransformedEvent( GetParent()->ScreenToOutputPixel( OutputToScreenPixel( rMEvt.GetPosPixel() ) ),
                                           rMEvt.GetClicks(), rMEvt.GetMode(), rMEvt.GetButtons(), rMEvt.GetModifier() );
     
+#ifdef GSTREAMER
+    SystemChildWindow::MouseButtonUp( rMEvt );
+#else
     JavaChildWindow::MouseButtonUp( rMEvt );
+#endif
     GetParent()->MouseButtonUp( aTransformedEvent );
 }
 
@@ -144,7 +165,11 @@ void MediaChildWindow::MouseButtonUp( const MouseEvent& rMEvt )
 
 void MediaChildWindow::KeyInput( const KeyEvent& rKEvt )
 {
+#ifdef GSTREAMER
+    SystemChildWindow::KeyInput( rKEvt );
+#else
     JavaChildWindow::KeyInput( rKEvt );
+#endif
     GetParent()->KeyInput( rKEvt );
 }
 
@@ -152,7 +177,11 @@ void MediaChildWindow::KeyInput( const KeyEvent& rKEvt )
 
 void MediaChildWindow::KeyUp( const KeyEvent& rKEvt )
 {
+#ifdef GSTREAMER
+    SystemChildWindow::KeyUp( rKEvt );
+#else
     JavaChildWindow::KeyUp( rKEvt );
+#endif
     GetParent()->KeyUp( rKEvt );
 }
 
@@ -163,7 +192,11 @@ void MediaChildWindow::Command( const CommandEvent& rCEvt )
     const CommandEvent aTransformedEvent( GetParent()->ScreenToOutputPixel( OutputToScreenPixel( rCEvt.GetMousePosPixel() ) ),
                                             rCEvt.GetCommand(), rCEvt.IsMouseEvent(), rCEvt.GetData() );
     
+#ifdef GSTREAMER
+    SystemChildWindow::Command( rCEvt );
+#else
     JavaChildWindow::Command( rCEvt );
+#endif
     GetParent()->Command( aTransformedEvent );
 }
 
@@ -232,18 +265,32 @@ void MediaWindowImpl::onURLChanged()
 {
     if( getPlayer().is() )
     {
-        uno::Sequence< uno::Any >              aArgs( 2 );
+        uno::Sequence< uno::Any >              aArgs( 3 );
         uno::Reference< media::XPlayerWindow > xPlayerWindow;
         const Point                            aPoint;
         const Size					           aSize( maChildWindow.GetSizePixel() );
+#ifndef GSTREAMER
         const sal_IntPtr                       nWndHandle = static_cast< sal_IntPtr >( maChildWindow.getParentWindowHandleForJava() );
+#else
+        const sal_Int32                        nWndHandle = 0;
+#endif
        
         aArgs[ 0 ] = uno::makeAny( nWndHandle );
         aArgs[ 1 ] = uno::makeAny( awt::Rectangle( aPoint.X(), aPoint.Y(), aSize.Width(), aSize.Height() ) );
         
+#ifdef GSTREAMER
+        const SystemEnvData *pSystemData = maChildWindow.GetSystemData();
+        OSL_TRACE( "MediaWindowImpl::onURLChanged xwindow id: %ld", pSystemData->aWindow );
+        aArgs[ 2 ] = uno::makeAny( pSystemData->aWindow );
+#endif
+        
         try
         {
+#ifdef GSTREAMER
+            if( pSystemData->aWindow != 0 )
+#else
             if( nWndHandle != 0 )
+#endif
                 xPlayerWindow = getPlayer()->createPlayerWindow( aArgs );
         }
         catch( uno::RuntimeException )
diff --git avmedia/source/viewer/mediawindow_impl.hxx avmedia/source/viewer/mediawindow_impl.hxx
index e84f4c2..52a47d0 100644
--- avmedia/source/viewer/mediawindow_impl.hxx
+++ avmedia/source/viewer/mediawindow_impl.hxx
@@ -32,7 +32,11 @@
 #define _AVMEDIA_MEDIAWINDOW_IMPL_HXX
 
 #include <svtools/transfer.hxx>
+#ifdef GSTREAMER
+#include <vcl/syschild.hxx>
+#else
 #include <vcl/javachild.hxx>
+#endif
 
 #include "mediawindowbase_impl.hxx"
 #include "mediacontrol.hxx"
@@ -64,7 +68,11 @@ namespace avmedia
         // - MediaChildWindow -
         // --------------------
         
+#ifdef GSTREAMER
+        class MediaChildWindow : public SystemChildWindow
+#else
         class MediaChildWindow : public JavaChildWindow
+#endif
         {
         public:
         
diff --git bean/com/sun/star/beans/makefile.mk bean/com/sun/star/beans/makefile.mk
index 1c38ff1..81fcb4c 100644
--- bean/com/sun/star/beans/makefile.mk
+++ bean/com/sun/star/beans/makefile.mk
@@ -36,14 +36,17 @@ PACKAGE = com$/sun$/star$/beans
 
 # --- Settings -----------------------------------------------------
 .INCLUDE: settings.mk
-.IF "$(L10N_framework)"==""
-.IF "$(OS)"=="MACOSX"
+
+.IF "$(OS)"=="MACOSX" || "$(OOo4Kids)"=="YES"
 
 dummy:
     @echo "Nothing to build for OS $(OS)"
 
 .ELSE		# "$(OS)"=="MACOSX"
 
+.INCLUDE: settings.mk
+.IF "$(L10N_framework)"==""
+
 JARFILES 		= sandbox.jar ridl.jar unoil.jar jurt.jar juh.jar
 
 # --- Sources --------------------------------------------------------
@@ -61,8 +64,8 @@ JAVAFILES=  \
 JAVACLASSFILES= $(foreach,i,$(JAVAFILES) $(CLASSDIR)$/$(PACKAGE)$/$(i:b).class)
 
 .ENDIF
+.ENDIF
 
 # --- Targets ------------------------------------------------------
-.ENDIF # L10N_framework
 
 .INCLUDE :  target.mk
diff --git bean/com/sun/star/comp/beans/makefile.mk bean/com/sun/star/comp/beans/makefile.mk
index 983991f..5df4096 100644
--- bean/com/sun/star/comp/beans/makefile.mk
+++ bean/com/sun/star/comp/beans/makefile.mk
@@ -36,14 +36,12 @@ PACKAGE = com$/sun$/star$/comp$/beans
 
 # --- Settings -----------------------------------------------------
 .INCLUDE: settings.mk
-.IF "$(L10N_framework)"==""
-.IF "$(OS)"=="MACOSX"
 
+.IF "$(OS)"=="MACOSX" || "$(OOo4Kids)"=="YES"
 dummy:
-    @echo "Nothing to build for OS $(OS)"
-
+    @echo "Nothing to build for OS $(OS) || OOo4Kids"
 .ELSE		# "$(OS)"=="MACOSX"
-
+.IF "$(L10N_framework)"==""
 JARFILES 		= sandbox.jar ridl.jar unoil.jar jurt.jar juh.jar
 
 # --- Sources --------------------------------------------------------
@@ -70,10 +68,9 @@ JAVAFILES=  \
     CallWatchThread.java
 
 JAVACLASSFILES= $(foreach,i,$(JAVAFILES) $(CLASSDIR)$/$(PACKAGE)$/$(i:b).class)
-
+.ENDIF
 .ENDIF
 
 # --- Targets ------------------------------------------------------
-.ENDIF # L10N_framework
 
 .INCLUDE :  target.mk
diff --git bean/native/win32/makefile.mk bean/native/win32/makefile.mk
index 9ccd0a0..5ff2202 100644
--- bean/native/win32/makefile.mk
+++ bean/native/win32/makefile.mk
@@ -11,6 +11,11 @@ USE_DEFFILE=TRUE
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 SLOFILES = \
diff --git bean/util/makefile.mk bean/util/makefile.mk
index ac495a7..1fbef8e 100644
--- bean/util/makefile.mk
+++ bean/util/makefile.mk
@@ -36,7 +36,12 @@ TARGET  = officebean
 # --- Settings -----------------------------------------------------
 
 .INCLUDE : settings.mk
-.IF "$(L10N_framework)"==""
+
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 JARCLASSDIRS    = \
     com$/sun$/star$/comp$/beans \
     com$/sun$/star$/beans
@@ -53,7 +58,6 @@ ZIP1DIR=$(PRJ)
 ZIP1LIST=com -x "*makefile.mk"
 
 # --- Targets ------------------------------------------------------
-.ENDIF # L10N_framework
 
 .INCLUDE : target.mk
 
diff --git boost/prj/d.lst boost/prj/d.lst
index 1db88f3..e2cb301 100644
--- boost/prj/d.lst
+++ boost/prj/d.lst
@@ -1,10 +1,18 @@
 mkdir: %_DEST%\inc%_EXT%\boost
+mkdir: %_DEST%\inc%_EXT%\boost\algorithm\string
+mkdir: %_DEST%\inc%_EXT%\boost\algorithm\string\detail
+mkdir: %_DEST%\inc%_EXT%\boost\algorithm\string\std
 mkdir: %_DEST%\inc%_EXT%\boost\bind
+mkdir: %_DEST%\inc%_EXT%\boost\concept
+mkdir: %_DEST%\inc%_EXT%\boost\concept\detail
 mkdir: %_DEST%\inc%_EXT%\boost\config
 mkdir: %_DEST%\inc%_EXT%\boost\config\compiler
 mkdir: %_DEST%\inc%_EXT%\boost\config\no_tr1
 mkdir: %_DEST%\inc%_EXT%\boost\config\platform
 mkdir: %_DEST%\inc%_EXT%\boost\config\stdlib
+mkdir: %_DEST%\inc%_EXT%\boost\date_time\gregorian
+mkdir: %_DEST%\inc%_EXT%\boost\date_time\local_time
+mkdir: %_DEST%\inc%_EXT%\boost\date_time\posix_time
 mkdir: %_DEST%\inc%_EXT%\boost\detail
 mkdir: %_DEST%\inc%_EXT%\boost\function
 mkdir: %_DEST%\inc%_EXT%\boost\function\detail
@@ -13,6 +21,7 @@ mkdir: %_DEST%\inc%_EXT%\boost\iterator\detail
 mkdir: %_DEST%\inc%_EXT%\boost\exception
 mkdir: %_DEST%\inc%_EXT%\boost\exception\detail
 mkdir: %_DEST%\inc%_EXT%\boost\function
+mkdir: %_DEST%\inc%_EXT%\boost\io
 mkdir: %_DEST%\inc%_EXT%\boost\mpl
 mkdir: %_DEST%\inc%_EXT%\boost\mpl\aux_
 mkdir: %_DEST%\inc%_EXT%\boost\mpl\aux_\config
@@ -81,6 +90,8 @@ mkdir: %_DEST%\inc%_EXT%\boost\preprocessor\seq\detail
 mkdir: %_DEST%\inc%_EXT%\boost\preprocessor\slot
 mkdir: %_DEST%\inc%_EXT%\boost\preprocessor\slot\detail
 mkdir: %_DEST%\inc%_EXT%\boost\preprocessor\tuple
+mkdir: %_DEST%\inc%_EXT%\boost\range
+mkdir: %_DEST%\inc%_EXT%\boost\range\detail
 mkdir: %_DEST%\inc%_EXT%\boost\spirit
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\actor
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\attribute
@@ -106,6 +117,7 @@ mkdir: %_DEST%\inc%_EXT%\boost\spirit\home
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\actor
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\actor\impl
+mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\attribute
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\debug
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\meta
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\meta\impl
@@ -119,10 +131,15 @@ mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\core\primitives
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\core\primitives\impl
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\core\composite
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\core\composite\impl
+mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\dynamic
+mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\dynamic\impl
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\error_handling
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\error_handling\impl
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\iterator
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\iterator\impl
+mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\phoenix
+mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\symbols
+mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\symbols\impl
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\utility
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\utility\impl
 mkdir: %_DEST%\inc%_EXT%\boost\spirit\home\classic\utility\impl\chset
@@ -298,3 +315,23 @@ mkdir: %_DEST%\inc%_EXT%\boost\variant\detail
 ..\%__SRC%\inc\boost\utility\* %_DEST%\inc%_EXT%\boost\utility
 ..\%__SRC%\inc\boost\variant\* %_DEST%\inc%_EXT%\boost\variant
 ..\%__SRC%\inc\boost\variant\detail\* %_DEST%\inc%_EXT%\boost\variant\detail
+..\%__SRC%\misc\build\boost_1_39_0\boost\algorithm\string\* %_DEST%\inc%_EXT%\boost\algorithm\string\
+..\%__SRC%\misc\build\boost_1_39_0\boost\algorithm\string\detail\* %_DEST%\inc%_EXT%\boost\algorithm\string\detail
+..\%__SRC%\misc\build\boost_1_39_0\boost\algorithm\string\std\* %_DEST%\inc%_EXT%\boost\algorithm\string\std
+..\%__SRC%\misc\build\boost_1_39_0\boost\concept\* %_DEST%\inc%_EXT%\boost\concept
+..\%__SRC%\misc\build\boost_1_39_0\boost\concept\detail\* %_DEST%\inc%_EXT%\boost\concept\detail
+..\%__SRC%\misc\build\boost_1_39_0\boost\date_time\* %_DEST%\inc%_EXT%\boost\date_time\*
+..\%__SRC%\misc\build\boost_1_39_0\boost\date_time\gregorian\* %_DEST%\inc%_EXT%\boost\date_time\gregorian
+..\%__SRC%\misc\build\boost_1_39_0\boost\date_time\local_time\* %_DEST%\inc%_EXT%\boost\date_time\local_time
+..\%__SRC%\misc\build\boost_1_39_0\boost\date_time\posix_time\* %_DEST%\inc%_EXT%\boost\date_time\posix_time
+..\%__SRC%\misc\build\boost_1_39_0\boost\io\* %_DEST%\inc%_EXT%\boost\io
+..\%__SRC%\misc\build\boost_1_39_0\boost\range\* %_DEST%\inc%_EXT%\boost\range
+..\%__SRC%\misc\build\boost_1_39_0\boost\range\detail\* %_DEST%\inc%_EXT%\boost\range\detail
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\attribute\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\attribute
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\dynamic\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\dynamic
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\dynamic\impl\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\dynamic\impl
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\phoenix\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\phoenix
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\symbols\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\symbols
+..\%__SRC%\misc\build\boost_1_39_0\boost\spirit\home\classic\symbols\impl\* %_DEST%\inc%_EXT%\boost\spirit\home\classic\symbols\impl
+
diff --git bridges/source/jni_uno/java/com/sun/star/bridges/jni_uno/makefile.mk bridges/source/jni_uno/java/com/sun/star/bridges/jni_uno/makefile.mk
index cc23338..bc6796e 100644
--- bridges/source/jni_uno/java/com/sun/star/bridges/jni_uno/makefile.mk
+++ bridges/source/jni_uno/java/com/sun/star/bridges/jni_uno/makefile.mk
@@ -38,6 +38,12 @@ PACKAGE=com$/sun$/star$/bridges$/jni_uno
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+
 JARFILES=jurt.jar ridl.jar
 JAVAFILES=$(subst,$(CLASSDIR)$/$(PACKAGE)$/, $(subst,.class,.java $(JAVACLASSFILES)))
 
diff --git bridges/source/jni_uno/makefile.mk bridges/source/jni_uno/makefile.mk
index d020eb7..e47117c 100644
--- bridges/source/jni_uno/makefile.mk
+++ bridges/source/jni_uno/makefile.mk
@@ -40,7 +40,7 @@ ENABLE_EXCEPTIONS=TRUE
 
 .INCLUDE :  settings.mk
 
-.IF "$(SOLAR_JAVA)"==""
+.IF "$(SOLAR_JAVA)"=="" || "$(OOo4Kids)"=="YES"
 nojava:
     @echo "Not building jni-uno bridge because Java is disabled"
 .ENDIF
diff --git canvas/source/cairo/cairo_canvashelper.cxx canvas/source/cairo/cairo_canvashelper.cxx
index 6c9de63..22280fe 100644
--- canvas/source/cairo/cairo_canvashelper.cxx
+++ canvas/source/cairo/cairo_canvashelper.cxx
@@ -1640,12 +1640,12 @@ namespace cairocanvas
                 rendering::RGBColor* pOut( aRes.getArray() );
                 for( sal_Size i=0; i<nLen; i+=4 )
                 {
-                    const sal_Int8 nAlpha(pIn[3]);
-                    if( nAlpha )
+                    const double fAlpha((sal_uInt8)pIn[3]);
+                    if( fAlpha )
                         *pOut++ = rendering::RGBColor(
-                            vcl::unotools::toDoubleColor(pIn[2]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[1]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[0]/nAlpha));
+                            pIn[2]/fAlpha,
+                            pIn[1]/fAlpha,
+                            pIn[0]/fAlpha);
                     else
                         *pOut++ = rendering::RGBColor(0,0,0);
                     pIn += 4;
@@ -1665,13 +1665,13 @@ namespace cairocanvas
                 rendering::ARGBColor* pOut( aRes.getArray() );
                 for( sal_Size i=0; i<nLen; i+=4 )
                 {
-                    const sal_Int8 nAlpha(pIn[3]);
-                    if( nAlpha )
+                    const double fAlpha((sal_uInt8)pIn[3]);
+                    if( fAlpha )
                         *pOut++ = rendering::ARGBColor(
-                            vcl::unotools::toDoubleColor(nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[2]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[1]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[0]/nAlpha));
+                            fAlpha/255.0,
+                            pIn[2]/fAlpha,
+                            pIn[1]/fAlpha,
+                            pIn[0]/fAlpha);
                     else
                         *pOut++ = rendering::ARGBColor(0,0,0,0);
                     pIn += 4;
diff --git chart2/uiconfig/toolbar/average.xml chart2/uiconfig/toolbar/average.xml
new file mode 100644
index 0000000..28b7f13
--- /dev/null
+++ chart2/uiconfig/toolbar/average.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+</toolbar:toolbar>
\ No newline at end of file
diff --git chart2/uiconfig/toolbar/beginner.xml chart2/uiconfig/toolbar/beginner.xml
new file mode 100644
index 0000000..28b7f13
--- /dev/null
+++ chart2/uiconfig/toolbar/beginner.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+</toolbar:toolbar>
\ No newline at end of file
diff --git chart2/uiconfig/toolbar/chart2_average.xml chart2/uiconfig/toolbar/chart2_average.xml
new file mode 100644
index 0000000..28b7f13
--- /dev/null
+++ chart2/uiconfig/toolbar/chart2_average.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+</toolbar:toolbar>
\ No newline at end of file
diff --git chart2/uiconfig/toolbar/chart2_beginner.xml chart2/uiconfig/toolbar/chart2_beginner.xml
new file mode 100644
index 0000000..28b7f13
--- /dev/null
+++ chart2/uiconfig/toolbar/chart2_beginner.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+</toolbar:toolbar>
\ No newline at end of file
diff --git cli_ure/source/basetypes/makefile.mk cli_ure/source/basetypes/makefile.mk
index 3e2e199..d198e1c 100644
--- cli_ure/source/basetypes/makefile.mk
+++ cli_ure/source/basetypes/makefile.mk
@@ -32,6 +32,11 @@
 PRJ = ..$/..
 PRJNAME = cli_ure
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # for dummy
 TARGET = basetypes
 
@@ -48,7 +53,7 @@ ECHOQUOTE='
 ECHOQUOTE=
 .ENDIF
 
-.IF "$(BUILD_FOR_CLI)" != ""
+.IF "$(BUILD_FOR_CLI)" != "" && "$(OOo4Kids)" != "YES"
 
 .INCLUDE : $(BIN)$/cliureversion.mk
 
diff --git cli_ure/source/climaker/makefile.mk cli_ure/source/climaker/makefile.mk
index dd67d26..6da9cd8 100644
--- cli_ure/source/climaker/makefile.mk
+++ cli_ure/source/climaker/makefile.mk
@@ -45,7 +45,9 @@ CCACHE_DISABLE=TRUE
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
-.IF "$(BUILD_FOR_CLI)" != ""
+
+.IF "$(BUILD_FOR_CLI)" != "" && "$(OOo4Kids)" != "YES"
+
 
 NO_OFFUH=TRUE
 CPPUMAKERFLAGS =
@@ -130,8 +132,7 @@ $(CLIMAKER_CONFIG): climaker.exe.config
     chmod +x $@
 .ENDIF          # "$(USE_SHELL)"!="4nt"
 
-
-.IF "$(BUILD_FOR_CLI)" != ""
+.IF "$(BUILD_FOR_CLI)" != "" && "$(OOo4Kids)"!="YES"
 
 $(OBJFILES): $(BIN)$/cli_basetypes.dll
 
@@ -140,4 +141,3 @@ $(OBJFILES): $(BIN)$/cli_basetypes.dll
 
 
 
-
diff --git cli_ure/source/native/makefile.mk cli_ure/source/native/makefile.mk
index 16eeedb..e73a2de 100644
--- cli_ure/source/native/makefile.mk
+++ cli_ure/source/native/makefile.mk
@@ -55,7 +55,7 @@ ECHOQUOTE=
 .ENDIF
 
 
-.IF "$(BUILD_FOR_CLI)" == ""
+.IF "$(BUILD_FOR_CLI)" == "" || "$(OOo4Kids)"=="YES"
 #do not even build the cxx files because they contain cli cpp
 all:
 .ELSE
diff --git cli_ure/source/ure/makefile.mk cli_ure/source/ure/makefile.mk
index 1bdbada..8e629a7 100644
--- cli_ure/source/ure/makefile.mk
+++ cli_ure/source/ure/makefile.mk
@@ -32,6 +32,11 @@
 PRJ = ..$/..
 PRJNAME = cli_ure
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # for dummy
 TARGET = ure
 
@@ -48,7 +53,7 @@ ECHOQUOTE='
 ECHOQUOTE=
 .ENDIF
 
-.IF "$(BUILD_FOR_CLI)" != ""
+.IF "$(BUILD_FOR_CLI)" != "" && "$(OOo4Kids)"!="YES"
 
 .INCLUDE : $(BIN)$/cliureversion.mk
 
diff --git cli_ure/unotypes/makefile.mk cli_ure/unotypes/makefile.mk
index 0f4d476..105a150 100644
--- cli_ure/unotypes/makefile.mk
+++ cli_ure/unotypes/makefile.mk
@@ -35,13 +35,18 @@ PRJNAME = cli_ure
 # for dummy
 TARGET = unotypes
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
 .INCLUDE : $(PRJ)$/util$/target.pmk
 .INCLUDE : target.mk
 
-.IF "$(BUILD_FOR_CLI)" != ""
+.IF "$(BUILD_FOR_CLI)" != "" && "$(OOo4Kids)" != "YES"
 
 .INCLUDE : $(BIN)$/cliureversion.mk
 
diff --git cli_ure/util/makefile.pmk cli_ure/util/makefile.pmk
index 9127092..17efb16 100644
--- cli_ure/util/makefile.pmk
+++ cli_ure/util/makefile.pmk
@@ -37,3 +37,7 @@ CFLAGSENABLESYMBOLS:=-Z7
 .ENDIF
 .ENDIF			# "L10N_framework"==""
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
diff --git configure.in configure.in
index 900c2ff..4a14086 100644
--- configure.in
+++ configure.in
@@ -8,7 +8,7 @@ dnl *
 dnl * Desc: This file serves as input for the GNU autoconf package
 dnl *       in order to create a configure script.
 dnl *       In this stage configure just checks the pre-requisites
-dnl *       necessary to build OpenOffice.org
+dnl *       necessary to build OOo4Kids
 dnl *
 dnl *
 dnl ******************************************************************/
@@ -296,6 +296,9 @@ AC_ARG_ENABLE(randr-link,
 [  --disable-randr-link    disable linking with libXrandr, instead dynamically 
                            open it at runtime
 ],,enable_randr_link=yes)
+AC_ARG_ENABLE(gstreamer,
+[  --disable-gstreamer     disable building the gstreamer avmedia backend
+],,enable_gstreamer=yes)
 AC_ARG_WITH(myspell-dicts,
 [  --without-myspell-dicts Removes myspell dictionaries from openoffice.org
                           installation set, for people building for specific
@@ -389,6 +392,10 @@ AC_ARG_WITH(beanshell-jar,
 [  --with-beanshell-jar=JARFILE   Specify path to jarfile manually ],
 [ BSH_JAR="$withval"
 ])
+AC_ARG_ENABLE(presenter-extra-ui,
+[  --enable-presenter-extra-ui   enables extra functionality during slideshow,
+                                 e.g. selecting pen color, erasing drawings etc.
+],,enable_presenter_extra_ui=no)
 AC_ARG_ENABLE(minimizer,
 [  --enable-minimizer          enables the build of the Presentation Minimizer extension
 ],,)
@@ -732,6 +739,12 @@ AC_ARG_WITH(vendor,
 
                           Usage: --with-vendor="John the Builder"
 ],,)
+AC_ARG_WITH(OOo4Kids,
+[  --with-OOo4Kids         Build OOo4Kids instead of OpenOffice.org
+],,)
+AC_ARG_WITH(xo-intel-build,
+[  --with-xo-intel-build  Build OOo4Kids on OLPC's XO
+],,)
 AC_ARG_WITH(unix-wrapper,
 [  --with-unix-wrapper    Redefines the name of the UNIX wrapper that will be used
                           in the desktop files and in the desktop-integration RPMs.
@@ -902,6 +915,7 @@ case "$build_os" in
 	solaris*)
 		test_gtk=yes
 		test_cairo=yes
+        build_gstreamer=yes
 		test_kde=yes
 		test_cups=yes
         test_randr=yes
@@ -935,6 +949,7 @@ case "$build_os" in
 	linux-gnu*)
 		test_gtk=yes
 		test_cairo=yes
+        build_gstreamer=yes
 		test_kde=yes
 		test_kde4=yes
 		test_cups=yes
@@ -979,6 +994,7 @@ case "$build_os" in
 	freebsd*)
 		test_gtk=yes
 		test_cairo=yes
+        build_gstreamer=yes
 		test_kde=yes
 		test_kde4=yes
 		test_cups=yes
@@ -1013,6 +1029,7 @@ case "$build_os" in
 	netbsd)
 		test_gtk=yes
 		test_cairo=yes
+        build_gstreamer=yes
 		test_kde=yes
 		test_kde4=yes
 		test_cups=no
@@ -3338,6 +3355,8 @@ if test "$_os" != "WINNT" -a \( "z$enable_epm" = "z" -o "$enable_epm" != "no" \)
       # if building on Debian, default should be deb...
       if test -e /etc/debian_version; then
          PKGFORMAT=deb
+      elif test -e /etc/puppyversion; then
+        PKGFORMAT=installed
       else
          PKGFORMAT=rpm
       fi
@@ -5610,10 +5629,36 @@ AC_SUBST(CAIRO_CFLAGS)
 AC_SUBST(CAIRO_LIBS)
 
 dnl ===================================================================
+dnl Check whether the GStreamer libraries are available.
+dnl ===================================================================
+
+ENABLE_GSTREAMER=""
+
+if test  "$build_gstreamer" = "yes"; then
+
+    AC_MSG_CHECKING([whether to enable the GStreamer avmedia backend])
+    if test "x$enable_gstreamer" != "xno" ; then
+        ENABLE_GSTREAMER="TRUE"
+    AC_MSG_RESULT([yes])
+    PKG_CHECK_MODULES( GSTREAMER, gstreamer-0.10 gstreamer-plugins-base-0.10 )
+    else
+         AC_MSG_RESULT([no])
+    fi
+fi
+
+AC_SUBST(ENABLE_GSTREAMER)
+
+dnl ===================================================================
 dnl Check whether the OpenGL libraries are available
 dnl ===================================================================
 
 AC_MSG_CHECKING([whether to build the OpenGL Transitions component])
+
+if test "$_os" = "Darwin" ; then
+   # We use frameworks on Mac OS X
+    ENABLE_OPENGL=TRUE
+   AC_MSG_RESULT([yes])
+else
 ENABLE_OPENGL=
 
 if test "x$enable_opengl" != "xno" ; then
@@ -5628,9 +5673,19 @@ if test "x$enable_opengl" != "xno" ; then
 else
    AC_MSG_RESULT([no])
 fi
-
+fi
 AC_SUBST(ENABLE_OPENGL)
 
+AC_MSG_CHECKING([whether to build extra presenter ui])
+if test -n "$enable_presenter_extra_ui" -a "$enable_presenter_extra_ui" != "no"; then
+   AC_MSG_RESULT([yes])
+   ENABLE_PRESENTER_EXTRA_UI=YES
+else
+   AC_MSG_RESULT([no])
+   ENABLE_PRESENTER_EXTRA_UI=NO
+fi
+AC_SUBST(ENABLE_PRESENTER_EXTRA_UI)
+
 AC_MSG_CHECKING([whether to build the Presentation Minimizer extension])
 if test -n "$enable_minimizer" -a "$enable_minimizer" != "no"; then
    AC_MSG_RESULT([yes])
@@ -6635,6 +6690,28 @@ else
 fi
 AC_SUBST(OOO_VENDOR)
 
+# Set the OOo4Kids variable. (Activate --with-ooo4kids)
+OOo4Kids=
+AC_MSG_CHECKING([whether to enable OOo4Kids build])
+if test -z "$with_OOo4Kids" -o "$with_OOo4Kids" = "no" ; then
+   AC_MSG_RESULT([not set])
+else
+   OOo4Kids="YES"
+   AC_MSG_RESULT([yes, build OOo4Kids])
+fi
+AC_SUBST(OOo4Kids)
+
+# Set the XO_INTEL variable. (Activate --with-xo-intel-build)
+XO_INTEL=
+AC_MSG_CHECKING([whether to enable OOo4Kids build on a XO])
+if test -z "$with_xo_intel_build" -o "$with_xo_intel_build" = "no" ; then
+   AC_MSG_RESULT([not set])
+else
+   XO_INTEL="YES"
+   AC_MSG_RESULT([yes, build OOo4Kids on XO Intel])
+fi
+AC_SUBST(XO_INTEL)
+
 UNIXWRAPPERNAME=
 AC_MSG_CHECKING([for UNIX wrapper name])
 if test -z "$with_unix_wrapper" -o "$with_unix_wrapper" = "no"  -o "$with_unix_wrapper" = "yes" ; then
diff --git connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk
index 3977a48..29834a9 100644
--- connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk
+++ connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk
@@ -36,6 +36,12 @@ TARGET  = sdbc_hsqldb
 SECONDARY_PACKAGE = org$/hsqldb$/lib
 
 # --- Settings ----------------------------------------------------- 
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE: settings.mk  
 
 # --- Files --------------------------------------------------------  
diff --git connectivity/source/commontools/CommonTools.cxx connectivity/source/commontools/CommonTools.cxx
index 63d8594..db1bc0a 100644
--- connectivity/source/commontools/CommonTools.cxx
+++ connectivity/source/commontools/CommonTools.cxx
@@ -278,7 +278,7 @@ namespace connectivity
     sal_Bool existsJavaClassByName( const ::rtl::Reference< jvmaccess::VirtualMachine >& _pJVM,const ::rtl::OUString& _sClassName )
     {
         sal_Bool bRet = sal_False;
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
         if ( _pJVM.is() )
         {
             jvmaccess::VirtualMachine::AttachGuard aGuard(_pJVM);
diff --git connectivity/source/drivers/adabas/makefile.mk connectivity/source/drivers/adabas/makefile.mk
index 5b3483e..8ff2307 100644
--- connectivity/source/drivers/adabas/makefile.mk
+++ connectivity/source/drivers/adabas/makefile.mk
@@ -38,6 +38,12 @@ ENABLE_EXCEPTIONS=TRUE
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(DBGUTIL_OJ)"!=""
 ENVCFLAGS+=/FR$(SLO)$/
 .ENDIF
diff --git connectivity/source/drivers/dbase/makefile.mk connectivity/source/drivers/dbase/makefile.mk
index 37a88ef..11be735 100644
--- connectivity/source/drivers/dbase/makefile.mk
+++ connectivity/source/drivers/dbase/makefile.mk
@@ -37,6 +37,12 @@ TARGET=dbase
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(DBGUTIL_OJ)"!=""
 ENVCFLAGS+=/FR$(SLO)$/
 .ENDIF
diff --git connectivity/source/drivers/evoab2/makefile.mk connectivity/source/drivers/evoab2/makefile.mk
index e9bb9fd..a65c1cd 100644
--- connectivity/source/drivers/evoab2/makefile.mk
+++ connectivity/source/drivers/evoab2/makefile.mk
@@ -32,7 +32,7 @@ TARGET=evoab2
 ENABLE_EXCEPTIONS=TRUE
 VISIBILITY_HIDDEN=TRUE
 
-.IF "$(ENABLE_EVOAB2)"!="TRUE"
+.IF "$(ENABLE_EVOAB2)"!="TRUE" || "$(OOo4Kids)"=="YES"
 dummy:
     @echo "Evolution 2.x Addressbook build disabled"
 .ELSE
diff --git connectivity/source/drivers/hsqldb/makefile.mk connectivity/source/drivers/hsqldb/makefile.mk
index c61e4b2..eca52d7 100644
--- connectivity/source/drivers/hsqldb/makefile.mk
+++ connectivity/source/drivers/hsqldb/makefile.mk
@@ -42,7 +42,7 @@ USE_DEFFILE=TRUE
 .INCLUDE : $(PRJ)$/makefile.pmk
 .INCLUDE :  $(PRJ)$/version.mk
 
-.IF "$(SOLAR_JAVA)"==""
+.IF "$(SOLAR_JAVA)"=="" || "$(OOo4Kids)"=="YES"
 nojava:
     @echo "Not building jurt because Java is disabled"
 .ENDIF
diff --git connectivity/source/drivers/jdbc/makefile.mk connectivity/source/drivers/jdbc/makefile.mk
index 831a675..b056335 100644
--- connectivity/source/drivers/jdbc/makefile.mk
+++ connectivity/source/drivers/jdbc/makefile.mk
@@ -38,6 +38,12 @@ ENABLE_EXCEPTIONS=TRUE
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build" 
+.ENDIF
+
 .IF "$(DBGUTIL_OJ)"!=""
 ENVCFLAGS+=/FR$(SLO)$/
 .ENDIF
diff --git connectivity/source/drivers/mozab/bootstrap/makefile.mk connectivity/source/drivers/mozab/bootstrap/makefile.mk
index 9b4b058..29f62eb 100644
--- connectivity/source/drivers/mozab/bootstrap/makefile.mk
+++ connectivity/source/drivers/mozab/bootstrap/makefile.mk
@@ -50,11 +50,16 @@ all:
 .ENDIF
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(DBGUTIL_OJ)"!=""
 ENVCFLAGS+=/FR$(SLO)$/
 .ENDIF
 
-
 .INCLUDE : settings.mk
 
 .INCLUDE :  $(PRJ)$/version.mk
@@ -95,6 +100,8 @@ SLOFILES += \
 
 CDEFS     += -DMOZILLA_INTERNAL_API
 
+CDEFS     += -DMOZILLA_INTERNAL_API
+
 .IF "$(GUI)"=="UNX"
 .IF "$(COMNAME)"=="sunpro5"
 CFLAGS += -features=tmplife
diff --git connectivity/source/drivers/mozab/makefile.mk connectivity/source/drivers/mozab/makefile.mk
index 677e605..b81e890 100644
--- connectivity/source/drivers/mozab/makefile.mk
+++ connectivity/source/drivers/mozab/makefile.mk
@@ -35,7 +35,7 @@ TARGET=mozab
 TARGET2=$(TARGET)drv
 VISIBILITY_HIDDEN=TRUE
 
-.IF ( "$(SYSTEM_MOZILLA)" == "YES" && "$(WITH_MOZILLA)" == "YES") || "$(WITH_MOZILLA)" == "NO" || ( "$(OS)" == "MACOSX" ) || ( "$(OS)" == "OS2" )
+.IF ( "$(SYSTEM_MOZILLA)" == "YES" && "$(WITH_MOZILLA)" == "YES") || "$(WITH_MOZILLA)" == "NO" || ( "$(OS)" == "MACOSX" ) || "$(OOo4Kids)" == "YES"
 all: 
     @echo "    Not building the mozilla address book driver"
     @echo "    dependency to Mozilla developer snapshots not feasable at the moment"
diff --git connectivity/source/drivers/mozab/mozillasrc/makefile.mk connectivity/source/drivers/mozab/mozillasrc/makefile.mk
index e31d4c7..88aeb93 100644
--- connectivity/source/drivers/mozab/mozillasrc/makefile.mk
+++ connectivity/source/drivers/mozab/mozillasrc/makefile.mk
@@ -52,7 +52,7 @@ ENVCFLAGS+=/FR$(SLO)$/
 
 .INCLUDE : settings.mk
 
-.IF  ("$(SYSTEM_MOZILLA)" == "YES" && "$(WITH_MOZILLA)" == "YES") || "$(WITH_MOZILLA)" == "NO" || "$(OS)" == "OS2"
+.IF  ("$(SYSTEM_MOZILLA)" == "YES" && "$(WITH_MOZILLA)" == "YES") || "$(WITH_MOZILLA)" == "NO" || "$(OOo4Kids)"=="YES"
 dummy:
     @echo "		Not building the mozillasrc stuff in OpenOffice.org build"
     @echo "		dependency to Mozilla developer snapshots not feasable at the moment"
@@ -78,6 +78,8 @@ SLOFILES = \
 
 CDEFS     += -DMOZILLA_INTERNAL_API
 
+CDEFS     += -DMOZILLA_INTERNAL_API
+
 .IF "$(GUI)"=="UNX"
 .IF "$(COMNAME)"=="sunpro5"
 CFLAGS += -features=tmplife
diff --git connectivity/source/drivers/mysql/makefile.mk connectivity/source/drivers/mysql/makefile.mk
index 0d46f0c..e0bcdfb 100644
--- connectivity/source/drivers/mysql/makefile.mk
+++ connectivity/source/drivers/mysql/makefile.mk
@@ -38,6 +38,12 @@ ENABLE_EXCEPTIONS=TRUE
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(DBGUTIL_OJ)"!=""
 ENVCFLAGS+=/FR$(SLO)$/
 .ENDIF
diff --git connectivity/source/drivers/odbc/makefile.mk connectivity/source/drivers/odbc/makefile.mk
index 8f37b61..21cf26d 100644
--- connectivity/source/drivers/odbc/makefile.mk
+++ connectivity/source/drivers/odbc/makefile.mk
@@ -41,6 +41,11 @@ LDUMP=ldump2.exe
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(DBGUTIL_OJ)"!=""
 ENVCFLAGS+=/FR$(SLO)$/
 .ENDIF
diff --git connectivity/source/drivers/odbcbase/makefile.mk connectivity/source/drivers/odbcbase/makefile.mk
index 64ffd1f..9976ecd 100644
--- connectivity/source/drivers/odbcbase/makefile.mk
+++ connectivity/source/drivers/odbcbase/makefile.mk
@@ -42,6 +42,11 @@ VISIBILITY_HIDDEN=TRUE
 .INCLUDE : settings.mk
 .INCLUDE :  $(PRJ)$/version.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 CDEFS += -DOOO_DLLIMPLEMENTATION_ODBCBASE
 
 .IF "$(SYSTEM_ODBC_HEADERS)" == "YES"
diff --git cppcanvas/inc/cppcanvas/color.hxx cppcanvas/inc/cppcanvas/color.hxx
index fb4ed47..b5899bd 100644
--- cppcanvas/inc/cppcanvas/color.hxx
+++ cppcanvas/inc/cppcanvas/color.hxx
@@ -83,6 +83,16 @@ namespace cppcanvas
         return (nRed << 24U)|(nGreen << 16U)|(nBlue << 8U)|(nAlpha);
     }
 
+    inline sal_Int32 unMakeColor( sal_uInt8 nAlpha, sal_uInt8 nRed, sal_uInt8 nGreen, sal_uInt8 nBlue)
+    {
+        return (nAlpha << 24U)|(nRed << 16U)|(nGreen << 8U)|(nBlue);
+    }
+
+    inline sal_Int32 makeColorARGB( sal_uInt8 nAlpha, sal_uInt8 nRed, sal_uInt8 nGreen, sal_uInt8 nBlue)
+    {
+        return (nAlpha << 24U)|(nRed << 16U)|(nGreen << 8U)|(nBlue);
+    }
+
 }
 
 #endif /* _CPPCANVAS_COLOR_HXX */
diff --git cppuhelper/source/findsofficepath.c cppuhelper/source/findsofficepath.c
index 63adaf1..6463fa8 100644
--- cppuhelper/source/findsofficepath.c
+++ cppuhelper/source/findsofficepath.c
@@ -93,8 +93,11 @@ static char* getPathFromRegistryKey( HKEY hroot, const char* subKeyName )
  */
 static char* platformSpecific()
 {
+#ifdef OOo4Kids
+    const char* SUBKEYNAME = "Software\\OOo4Kids\\UNO\\InstallPath";
+#else
     const char* SUBKEYNAME = "Software\\OpenOffice.org\\UNO\\InstallPath";
-
+#endif
     char* path = NULL;
     
     /* read the key's default value from HKEY_CURRENT_USER */
diff --git dbaccess/source/core/api/makefile.mk dbaccess/source/core/api/makefile.mk
index 59d89fb..f708da4 100644
--- dbaccess/source/core/api/makefile.mk
+++ dbaccess/source/core/api/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/dba.pmk
 
diff --git dbaccess/source/core/dataaccess/makefile.mk dbaccess/source/core/dataaccess/makefile.mk
index 580d62c..2202e7c 100644
--- dbaccess/source/core/dataaccess/makefile.mk
+++ dbaccess/source/core/dataaccess/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/dba.pmk
 
diff --git dbaccess/source/core/misc/makefile.mk dbaccess/source/core/misc/makefile.mk
index 3cc6acb..492f738 100644
--- dbaccess/source/core/misc/makefile.mk
+++ dbaccess/source/core/misc/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/dba.pmk
 
diff --git dbaccess/source/core/resource/makefile.mk dbaccess/source/core/resource/makefile.mk
index cf81a6f..6e3810b 100644
--- dbaccess/source/core/resource/makefile.mk
+++ dbaccess/source/core/resource/makefile.mk
@@ -36,6 +36,11 @@ TARGET=core_resource
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/dba.pmk
 
diff --git dbaccess/source/ext/adabas/makefile.mk dbaccess/source/ext/adabas/makefile.mk
index 973c11a..2c5a727 100644
--- dbaccess/source/ext/adabas/makefile.mk
+++ dbaccess/source/ext/adabas/makefile.mk
@@ -37,6 +37,12 @@ ENABLE_EXCEPTIONS=TRUE
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :	settings.mk
 
 # --- resource -----------------------------------------------------
diff --git dbaccess/source/ext/macromigration/makefile.mk dbaccess/source/ext/macromigration/makefile.mk
index b108cac..ae5d3ad 100644
--- dbaccess/source/ext/macromigration/makefile.mk
+++ dbaccess/source/ext/macromigration/makefile.mk
@@ -40,6 +40,11 @@ VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 
 # --- Files -------------------------------------
diff --git dbaccess/source/filter/migration/makefile.mk dbaccess/source/filter/migration/makefile.mk
index 62fb6a5..05ddbc5 100644
--- dbaccess/source/filter/migration/makefile.mk
+++ dbaccess/source/filter/migration/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  	settings.mk
 
 # --- Files -------------------------------------
diff --git dbaccess/source/filter/xml/makefile.mk dbaccess/source/filter/xml/makefile.mk
index 8b6d4df..b20e99c 100644
--- dbaccess/source/filter/xml/makefile.mk
+++ dbaccess/source/filter/xml/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  	settings.mk
 
 # --- Files -------------------------------------
diff --git dbaccess/source/filter/xml/xmlJavaClassPath.cxx dbaccess/source/filter/xml/xmlJavaClassPath.cxx
new file mode 100644
index 0000000..472a661
--- /dev/null
+++ dbaccess/source/filter/xml/xmlJavaClassPath.cxx
@@ -0,0 +1,113 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: xmlJavaClassPath.cxx,v $
+ * $Revision: 1.3 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_dbaccess.hxx"
+#ifndef DBA_XMLJAVACLASSPATH_HXX_INCLUDED
+#include "xmlJavaClassPath.hxx"
+#endif
+#ifndef DBA_XMLFILTER_HXX
+#include "xmlfilter.hxx"
+#endif
+#ifndef _XMLOFF_XMLTOKEN_HXX
+#include <xmloff/xmltoken.hxx>
+#endif
+#ifndef _XMLOFF_XMLNMSPE_HXX
+#include <xmloff/xmlnmspe.hxx>
+#endif
+#ifndef _XMLOFF_NMSPMAP_HXX
+#include <xmloff/nmspmap.hxx>
+#endif
+#ifndef DBA_XMLENUMS_HXX
+#include "xmlEnums.hxx"
+#endif
+#ifndef DBACCESS_SHARED_XMLSTRINGS_HRC
+#include "xmlstrings.hrc"
+#endif
+#ifndef _TOOLS_DEBUG_HXX
+#include <tools/debug.hxx>
+#endif
+#ifndef TOOLS_DIAGNOSE_EX_H
+#include <tools/diagnose_ex.h>
+#endif
+
+namespace dbaxml
+{
+    using namespace ::com::sun::star::uno;
+    using namespace ::com::sun::star::xml::sax;
+DBG_NAME(OXMLJavaClassPath)
+
+OXMLJavaClassPath::OXMLJavaClassPath( ODBFilter& rImport,
+                sal_uInt16 nPrfx, const ::rtl::OUString& _sLocalName,
+                const Reference< XAttributeList > & _xAttrList ) :
+    SvXMLImportContext( rImport, nPrfx, _sLocalName )
+{
+    DBG_CTOR(OXMLJavaClassPath,NULL);
+
+    OSL_ENSURE(_xAttrList.is(),"Attribute list is NULL!");
+    const SvXMLNamespaceMap& rMap = rImport.GetNamespaceMap();
+    const SvXMLTokenMap& rTokenMap = rImport.GetComponentElemTokenMap();
+
+    ::rtl::OUString sJavaClassPath;
+    const sal_Int16 nLength = (_xAttrList.is()) ? _xAttrList->getLength() : 0;
+    for(sal_Int16 i = 0; i < nLength; ++i)
+    {
+        ::rtl::OUString sLocalName;
+        const rtl::OUString sAttrName = _xAttrList->getNameByIndex( i );
+        const sal_uInt16 nPrefix = rMap.GetKeyByAttrName( sAttrName,&sLocalName );
+        const rtl::OUString sValue = _xAttrList->getValueByIndex( i );
+        switch( rTokenMap.Get( nPrefix, sLocalName ) )
+        {
+            case XML_TOK_HREF:
+                sJavaClassPath += sValue;
+                break;
+        }
+        if ( sJavaClassPath.getLength() )
+            sJavaClassPath += ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(" "));
+    }
+    if ( sJavaClassPath.getLength() )
+    {
+        PropertyValue aProperty;
+        aProperty.Name = ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("JavaDriverClassPath"));
+        aProperty.Value <<= sJavaClassPath;
+        rImport.addInfo(aProperty);
+    }
+}
+// -----------------------------------------------------------------------------
+
+OXMLJavaClassPath::~OXMLJavaClassPath()
+{
+    DBG_DTOR(OXMLJavaClassPath,NULL);
+}
+// -----------------------------------------------------------------------------
+
+//----------------------------------------------------------------------------
+} // namespace dbaxml
+// -----------------------------------------------------------------------------
diff --git dbaccess/source/filter/xml/xmlJavaClassPath.hxx dbaccess/source/filter/xml/xmlJavaClassPath.hxx
new file mode 100644
index 0000000..3d4256b
--- /dev/null
+++ dbaccess/source/filter/xml/xmlJavaClassPath.hxx
@@ -0,0 +1,58 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: xmlJavaClassPath.hxx,v $
+ * $Revision: 1.3 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef DBA_XMLJAVACLASSPATH_HXX_INCLUDED
+#define DBA_XMLJAVACLASSPATH_HXX_INCLUDED
+
+#ifndef _XMLOFF_XMLICTXT_HXX
+#include <xmloff/xmlictxt.hxx>
+#endif
+#ifndef _COM_SUN_STAR_BEANS_PROPERTYVALUE_HPP_
+#include <com/sun/star/beans/PropertyValue.hpp>
+#endif
+#include <vector>
+
+namespace dbaxml
+{
+    class ODBFilter;
+    class OXMLJavaClassPath : public SvXMLImportContext
+    {
+    public:
+
+        OXMLJavaClassPath( ODBFilter& rImport, sal_uInt16 nPrfx,
+                    const ::rtl::OUString& rLName,
+                    const ::com::sun::star::uno::Reference< ::com::sun::star::xml::sax::XAttributeList > & xAttrList );
+        virtual ~OXMLJavaClassPath();
+    };
+// -----------------------------------------------------------------------------
+} // namespace dbaxml
+// -----------------------------------------------------------------------------
+
+#endif // DBA_XMLJAVACLASSPATH_HXX_INCLUDED
+
diff --git dbaccess/source/sdbtools/connection/makefile.mk dbaccess/source/sdbtools/connection/makefile.mk
index 62660b2..80b0b94 100644
--- dbaccess/source/sdbtools/connection/makefile.mk
+++ dbaccess/source/sdbtools/connection/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 
 # --- Files -------------------------------------
diff --git dbaccess/source/sdbtools/misc/makefile.mk dbaccess/source/sdbtools/misc/makefile.mk
index c5d7126..393f626 100644
--- dbaccess/source/sdbtools/misc/makefile.mk
+++ dbaccess/source/sdbtools/misc/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 
 # --- Files -------------------------------------
diff --git dbaccess/source/sdbtools/resource/makefile.mk dbaccess/source/sdbtools/resource/makefile.mk
index b9d16c4..2a559c2 100644
--- dbaccess/source/sdbtools/resource/makefile.mk
+++ dbaccess/source/sdbtools/resource/makefile.mk
@@ -36,6 +36,11 @@ TARGET=sdbt_resource
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 
 # --- Files --------------------------------------------------------
diff --git dbaccess/source/shared/makefile.mk dbaccess/source/shared/makefile.mk
index 0215794..aa1e085 100644
--- dbaccess/source/shared/makefile.mk
+++ dbaccess/source/shared/makefile.mk
@@ -43,6 +43,11 @@ LIB4TARGET=$(SLB)$/sdbtshared.lib
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 
 # --- Types -------------------------------------
diff --git dbaccess/source/ui/app/makefile.mk dbaccess/source/ui/app/makefile.mk
index b132816..010afa3 100644
--- dbaccess/source/ui/app/makefile.mk
+++ dbaccess/source/ui/app/makefile.mk
@@ -38,6 +38,11 @@ TARGET=app
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 # IMGLST_SRS=$(SRS)$/$(TARGET).srs
diff --git dbaccess/source/ui/browser/makefile.mk dbaccess/source/ui/browser/makefile.mk
index 28c889c..1bab549 100644
--- dbaccess/source/ui/browser/makefile.mk
+++ dbaccess/source/ui/browser/makefile.mk
@@ -36,6 +36,11 @@ TARGET=browser
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 # --- Files --------------------------------------------------------
diff --git dbaccess/source/ui/control/makefile.mk dbaccess/source/ui/control/makefile.mk
index 655cc26..6416763 100644
--- dbaccess/source/ui/control/makefile.mk
+++ dbaccess/source/ui/control/makefile.mk
@@ -36,6 +36,11 @@ TARGET=uicontrols
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/source/ui/dlg/makefile.mk dbaccess/source/ui/dlg/makefile.mk
index ca20987..bb22a50 100644
--- dbaccess/source/ui/dlg/makefile.mk
+++ dbaccess/source/ui/dlg/makefile.mk
@@ -36,6 +36,11 @@ TARGET=uidlg
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/source/ui/misc/makefile.mk dbaccess/source/ui/misc/makefile.mk
index e5db695..1dcec2c 100644
--- dbaccess/source/ui/misc/makefile.mk
+++ dbaccess/source/ui/misc/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/source/ui/querydesign/makefile.mk dbaccess/source/ui/querydesign/makefile.mk
index 03e4dcc..78ba797 100644
--- dbaccess/source/ui/querydesign/makefile.mk
+++ dbaccess/source/ui/querydesign/makefile.mk
@@ -36,6 +36,11 @@ TARGET=querydesign
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/source/ui/relationdesign/makefile.mk dbaccess/source/ui/relationdesign/makefile.mk
index f5857b4..16fcc75 100644
--- dbaccess/source/ui/relationdesign/makefile.mk
+++ dbaccess/source/ui/relationdesign/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/source/ui/tabledesign/makefile.mk dbaccess/source/ui/tabledesign/makefile.mk
index 3652a4d..2531e18 100644
--- dbaccess/source/ui/tabledesign/makefile.mk
+++ dbaccess/source/ui/tabledesign/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/source/ui/uno/makefile.mk dbaccess/source/ui/uno/makefile.mk
index 11a1c7c..232b2a3 100644
--- dbaccess/source/ui/uno/makefile.mk
+++ dbaccess/source/ui/uno/makefile.mk
@@ -38,6 +38,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git dbaccess/util/makefile.mk dbaccess/util/makefile.mk
index 7b69099..84a3866 100644
--- dbaccess/util/makefile.mk
+++ dbaccess/util/makefile.mk
@@ -40,6 +40,11 @@ GEN_HID_OTHER=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :	settings.mk
 
 LDUMP=ldump2.exe
diff --git desktop/scripts/soffice.sh desktop/scripts/soffice.sh
index 63df07f..c9a848a 100644
--- desktop/scripts/soffice.sh
+++ desktop/scripts/soffice.sh
@@ -62,7 +62,7 @@ fi
 sd_prog=`pwd`
 cd "$sd_cwd"
 
-sd_binary=`basename "$0"`.bin
+sd_binary=soffice.bin
 
 #collect all bootstrap variables specified on the command line
 #so that they can be passed as arguments to javaldx later on
diff --git desktop/source/app/app.cxx desktop/source/app/app.cxx
index 2686626..81f207c 100644
--- desktop/source/app/app.cxx
+++ desktop/source/app/app.cxx
@@ -360,6 +360,8 @@ namespace
         : public rtl::Static< String, Version > {};
     struct AboutBoxVersion
         : public rtl::Static< String, AboutBoxVersion > {};
+    struct LicenseBoxVersion
+        : public rtl::Static< String, LicenseBoxVersion > {};
     struct Extension
         : public rtl::Static< String, Extension > {};
     struct XMLFileFormatName
@@ -379,7 +381,7 @@ void ReplaceStringHookProc( UniString& rStr )
     {
         String &rBrandName = BrandName::get();
         String &rVersion = Version::get();
-        String &rAboutBoxVersion = AboutBoxVersion::get();
+        String &rLicenseBoxVersion = LicenseBoxVersion::get();
         String &rExtension = Extension::get();
         String &rXMLFileFormatName = XMLFileFormatName::get();
         String &rXMLFileFormatVersion = XMLFileFormatVersion::get();
@@ -403,9 +405,9 @@ void ReplaceStringHookProc( UniString& rStr )
             aRet >>= aTmp;
             rVersion = aTmp;
 
-            aRet = ::utl::ConfigManager::GetDirectConfigProperty( ::utl::ConfigManager::ABOUTBOXPRODUCTVERSION );
+            aRet = ::utl::ConfigManager::GetDirectConfigProperty( ::utl::ConfigManager::LICENSEBOXVERSION );
             aRet >>= aTmp;
-            rAboutBoxVersion = aTmp;
+            rLicenseBoxVersion = aTmp;
 
             if ( !rExtension.Len() )
             {
@@ -418,7 +420,7 @@ void ReplaceStringHookProc( UniString& rStr )
         nPro++;
         rStr.SearchAndReplaceAllAscii( "%PRODUCTNAME", rBrandName );
         rStr.SearchAndReplaceAllAscii( "%PRODUCTVERSION", rVersion );
-        rStr.SearchAndReplaceAllAscii( "%ABOUTBOXPRODUCTVERSION", rAboutBoxVersion );
+        rStr.SearchAndReplaceAllAscii( "%LICENSEBOXVERSION", rLicenseBoxVersion );
         rStr.SearchAndReplaceAllAscii( "%PRODUCTEXTENSION", rExtension );
         rStr.SearchAndReplaceAllAscii( "%PRODUCTXMLFILEFORMATNAME", rXMLFileFormatName );
         rStr.SearchAndReplaceAllAscii( "%PRODUCTXMLFILEFORMATVERSION", rXMLFileFormatVersion );
@@ -1628,7 +1630,6 @@ void Desktop::Main()
 
     // call Application::Execute to process messages in vcl message loop
     RTL_LOGFILE_PRODUCT_TRACE( "PERFORMANCE - enter Application::Execute()" );
-
     try
     {
         // The JavaContext contains an interaction handler which is used when
@@ -2316,15 +2317,31 @@ void Desktop::OpenClients()
         } else if (pArgs->IsHelpImpress()) {
             bShowHelp = sal_True;
             aHelpURLBuffer.appendAscii("vnd.sun.star.help://simpress/start");
-        } else if (pArgs->IsHelpBase()) {
+    } 
+    else if (pArgs->IsHelpBase()) {
+#ifdef OOo4Kids
+            bShowHelp = sal_False;
+#else
             bShowHelp = sal_True;
             aHelpURLBuffer.appendAscii("vnd.sun.star.help://sdatabase/start");
-        } else if (pArgs->IsHelpBasic()) {
+#endif
+        } 
+    else if (pArgs->IsHelpBasic()) {
+#ifdef OOo4Kids
+            bShowHelp = sal_False;
+#else
             bShowHelp = sal_True;
             aHelpURLBuffer.appendAscii("vnd.sun.star.help://sbasic/start");
-        } else if (pArgs->IsHelpMath()) {
+#endif
+        }
+    else if (pArgs->IsHelpMath())
+    {
+#ifdef OOo4Kids
+            bShowHelp = sal_False;
+#else
             bShowHelp = sal_True;
             aHelpURLBuffer.appendAscii("vnd.sun.star.help://smath/start");
+#endif
         }
         if (bShowHelp) {
             Help *pHelp = Application::GetHelp();
@@ -2618,8 +2635,10 @@ void Desktop::OpenDefault()
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_CALC );
         else if ( pArgs->IsImpress() && aOpt.IsModuleInstalled( SvtModuleOptions::E_SIMPRESS ) )
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_IMPRESS );
+#ifndef OOo4Kids
         else if ( pArgs->IsBase() && aOpt.IsModuleInstalled( SvtModuleOptions::E_SDATABASE ) )
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_DATABASE );
+#endif
         else if ( pArgs->IsDraw() && aOpt.IsModuleInstalled( SvtModuleOptions::E_SDRAW ) )
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_DRAW );
         else if ( pArgs->IsMath() && aOpt.IsModuleInstalled( SvtModuleOptions::E_SMATH ) )
@@ -2639,8 +2658,10 @@ void Desktop::OpenDefault()
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_CALC );
         else if ( aOpt.IsModuleInstalled( SvtModuleOptions::E_SIMPRESS ) )
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_IMPRESS );
+#ifndef OOo4Kids
         else if ( aOpt.IsModuleInstalled( SvtModuleOptions::E_SDATABASE ) )
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_DATABASE );
+#endif
         else if ( aOpt.IsModuleInstalled( SvtModuleOptions::E_SDRAW ) )
             aName = aOpt.GetFactoryEmptyDocumentURL( SvtModuleOptions::E_DRAW );
         else
@@ -2843,6 +2864,12 @@ void Desktop::HandleAppEvent( const ApplicationEvent& rAppEvent )
         displayCmdlineHelp();
     }
 #endif
+    // On Mac OS X Aqua, the SHOWDIALOG event type is defined in cmdevt.hxx. 
+    // For the e.g. "License ...",  this event type is sent from
+    // salmenu.cxx (line around 79) and does contain the string ".uno:ShowLicense"
+    // FIXME : this seems to not work. the workaround is in framework: an eventlistener is 
+    // activated at launch, to catch the event, turn it into command, and dispatch it
+    // see windowcommanddispatch.hxx (in framework/source/inc/dispatch )
     else if ( rAppEvent.GetEvent() == "SHOWDIALOG" )
     {
         // ignore all errors here. It's clicking a menu entry only ...
@@ -2861,10 +2888,16 @@ void Desktop::HandleAppEvent( const ApplicationEvent& rAppEvent )
             
             css::uno::Reference< css::util::XURLTransformer > xParser(xSMGR->createInstance(rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.util.URLTransformer"))), css::uno::UNO_QUERY_THROW);
             css::util::URL aCommand;
+
+        // On Mac OS X Aqua, those strings are generated by the Aqua menu. See : vcl/aqua/source/window/salmenu.cxx:72
+        // FIXME : looks like it does not work, because a breakpoint in Desktop::HandleAppEvent() 
+        // does never reach the line below (so, how to come there ?) 
             if( rAppEvent.GetData().EqualsAscii( "PREFERENCES" ) )
                 aCommand.Complete = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( ".uno:OptionsTreeDialog" ) );
             else if( rAppEvent.GetData().EqualsAscii( "ABOUT" ) )
                 aCommand.Complete = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( ".uno:About" ) );
+            else if( rAppEvent.GetData().EqualsAscii( "LICENSE" ) )
+                aCommand.Complete = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( ".uno:ShowLicense" ) );
             if( aCommand.Complete.getLength() )
             {
                 xParser->parseStrict(aCommand);
@@ -2903,8 +2936,10 @@ void Desktop::OpenSplashScreen()
             aAppName = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "draw" ));
         else if ( pCmdLine->IsImpress() )
             aAppName = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "impress" ));
+#ifndef OOo4Kids
         else if ( pCmdLine->IsBase() )
             aAppName = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "base" ));
+#endif
         else if ( pCmdLine->IsGlobal() )
             aAppName = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "global" ));
         else if ( pCmdLine->IsMath() )
diff --git desktop/source/app/appfirststart.cxx desktop/source/app/appfirststart.cxx
index 1c8a1ed..9038eb9 100644
--- desktop/source/app/appfirststart.cxx
+++ desktop/source/app/appfirststart.cxx
@@ -145,11 +145,15 @@ static sal_Bool impl_isFirstStart()
                 theConfigProvider->createInstanceWithArguments(sAccessSrvc, theArgs), UNO_QUERY_THROW);
 
         Any result = pset->getPropertyValue(OUString::createFromAscii("FirstStartWizardCompleted"));
+#ifdef OOo4Kids
+    return sal_False;
+#else
         sal_Bool bCompleted = sal_False;
         if ((result >>= bCompleted) && bCompleted)
             return sal_False;  // wizard was already completed
         else
             return sal_True;
+#endif
     } catch (const Exception&)
     {
         return sal_True;
diff --git desktop/source/app/cmdlineargs.cxx desktop/source/app/cmdlineargs.cxx
index 84bb6cd..e0763eb 100644
--- desktop/source/app/cmdlineargs.cxx
+++ desktop/source/app/cmdlineargs.cxx
@@ -536,6 +536,7 @@ sal_Bool CommandLineArgs::InterpretCommandLineParameter( const ::rtl::OUString&
             SetBoolParam_Impl( CMD_BOOLPARAM_IMPRESS, sal_True );
         return sal_True;
     }
+#ifndef OOo4Kids
     else if ( aArg.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "-base" )) == sal_True )
     {
         sal_Bool bAlreadySet = CheckGroupMembers( CMD_GRPID_MODULE, CMD_BOOLPARAM_BASE );
@@ -543,6 +544,7 @@ sal_Bool CommandLineArgs::InterpretCommandLineParameter( const ::rtl::OUString&
             SetBoolParam_Impl( CMD_BOOLPARAM_BASE, sal_True );
         return sal_True;
     }
+#endif
     else if ( aArg.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "-global" )) == sal_True )
     {
         sal_Bool bAlreadySet = CheckGroupMembers( CMD_GRPID_MODULE, CMD_BOOLPARAM_GLOBAL );
@@ -740,25 +742,23 @@ sal_Bool CommandLineArgs::IsImpress() const
     osl::MutexGuard  aMutexGuard( m_aMutex );
     return m_aBoolParams[ CMD_BOOLPARAM_IMPRESS ];
 }
-
+#ifndef OOo4Kids
 sal_Bool CommandLineArgs::IsBase() const
 {
     osl::MutexGuard  aMutexGuard( m_aMutex );
     return m_aBoolParams[ CMD_BOOLPARAM_BASE ];
 }
-
+#endif
 sal_Bool CommandLineArgs::IsGlobal() const
 {
     osl::MutexGuard  aMutexGuard( m_aMutex );
     return m_aBoolParams[ CMD_BOOLPARAM_GLOBAL ];
 }
-
 sal_Bool CommandLineArgs::IsMath() const
 {
     osl::MutexGuard  aMutexGuard( m_aMutex );
     return m_aBoolParams[ CMD_BOOLPARAM_MATH ];
 }
-
 sal_Bool CommandLineArgs::IsWeb() const
 {
     osl::MutexGuard  aMutexGuard( m_aMutex );
diff --git desktop/source/app/cmdlineargs.hxx desktop/source/app/cmdlineargs.hxx
index db46191..6aeb10c 100644
--- desktop/source/app/cmdlineargs.hxx
+++ desktop/source/app/cmdlineargs.hxx
@@ -150,7 +150,9 @@ class CommandLineArgs
         sal_Bool				IsCalc() const;
         sal_Bool				IsDraw() const;
         sal_Bool				IsImpress() const;
+#ifndef OOo4Kids
         sal_Bool				IsBase() const;
+#endif
         sal_Bool				IsGlobal() const;
         sal_Bool				IsMath() const;
         sal_Bool				IsWeb() const;
diff --git desktop/source/app/cmdlinehelp.cxx desktop/source/app/cmdlinehelp.cxx
index c5069d1..934cb27 100644
--- desktop/source/app/cmdlinehelp.cxx
+++ desktop/source/app/cmdlinehelp.cxx
@@ -76,8 +76,6 @@ namespace desktop
         "-calc         \n"\
         "-draw         \n"\
         "-impress      \n"\
-        "-base         \n"\
-        "-math         \n"\
         "-global       \n"\
         "-web          \n"\
         "-o            \n"\
@@ -96,8 +94,6 @@ namespace desktop
         "create new spreadsheet document.\n"\
         "create new drawing.\n"\
         "create new presentation.\n"\
-        "create new database.\n"\
-        "create new formula.\n"\
         "create new global document.\n"\
         "create new HTML document.\n"\
         "open documents regardless whether they are templates or not.\n"\
diff --git desktop/source/app/copyright_ascii_ooo.c desktop/source/app/copyright_ascii_ooo.c
index 8d9d821..15a2545 100644
--- desktop/source/app/copyright_ascii_ooo.c
+++ desktop/source/app/copyright_ascii_ooo.c
@@ -9,8 +9,14 @@ extern const char copyright_text_2[];
 extern const char copyright_text_21[];
 extern const char copyright_text_22[];
 
-const char copyright_text_1[] = "Copyright  2010 Sun Microsystems, Inc., All rights reserved.";
+#ifdef OOo4Kids
+const char copyright_text_1[] = "Copyright  2008 Sun Microsystems, Inc., All rights reserved.";
 const char copyright_text_2[] = "Sun Microsystems, Inc. has intellectual property rights relating to technology embodied in the product that is described in this document. In particular, and without limitation, these intellectual property rights may include one or more of the U.S. patents listed at http://www.sun.com/patents and one or more additional patents or pending patent applications in the U.S. and in other countries.";
-const char copyright_text_21[] = "Copyright  2010 Sun Microsystems, Tous droits rservs.";
+const char copyright_text_21[] = "Copyright  2008 Sun Microsystems, Tous droits rservs.";
 const char copyright_text_22[] = "Sun Microsystems, Inc. a les droits de proprit intellectuels relatants  la technologie incorpore dans ce produit. En particulier, et sans la limitation, ces droits de proprit intellectuels peuvent inclure un ou plus des brevets amricains numrs  http://www.sun.com/patents et un ou les brevets plus supplmentaires ou les applications de brevet en attente dans les tats - Unis et les autres pays.";
-
+#else
+const char copyright_text_1[] = "empty string";
+const char copyright_text_2[] = "Soon on your screens";
+const char copyright_text_21[] = "Copyright ericb, Tous droits rservs.";
+const char copyright_text_22[] = "Bientot sur vos ecrans";
+#endif
diff --git desktop/source/app/copyright_ascii_sun.c desktop/source/app/copyright_ascii_sun.c
index 3d437af..e5ad3a6 100644
--- desktop/source/app/copyright_ascii_sun.c
+++ desktop/source/app/copyright_ascii_sun.c
@@ -3,13 +3,13 @@
   * copyright text to see as text in the soffice binary
   *
   */
- 
-const char copyright_text_1[] = "Copyright  2010 Sun Microsystems, Inc., All rights reserved.";
+#ifndef OOo4Kids 
+const char copyright_text_1[] = "Copyright  2008 Sun Microsystems, Inc., All rights reserved.";
 const char copyright_text_2[] = "Sun Microsystems, Inc. has intellectual property rights relating to technology embodied in the product that is described in this document. In particular, and without limitation, these intellectual property rights may include one or more of the U.S. patents listed at http://www.sun.com/patents and one or more additional patents or pending patent applications in the U.S. and in other countries.";
 const char copyright_text_3[] = "U.S. Government Rights - Commercial software. Government users are subject to the Sun Microsystems, Inc. standard license agreement and applicable provisions of the FAR and its supplements.  Use is subject to license terms.";
 const char copyright_text_4[] = "This distribution may include materials developed by third parties.Sun, Sun Microsystems, the Sun logo, Java, Solaris and StarOffice are trademarks or registered trademarks of Sun Microsystems, Inc. in the U.S. and other countries. All SPARC trademarks are used under license and are trademarks or registered trademarks of SPARC International, Inc. in the U.S. and other countries.";
 const char copyright_text_5[] = "UNIX is a registered trademark in the U.S. and other countries, exclusively licensed through X/Open Company, Ltd.";
-const char copyright_text_21[] = "Copyright  2010 Sun Microsystems, Tous droits rservs.";
+const char copyright_text_21[] = "Copyright  2008 Sun Microsystems, Tous droits rservs.";
 const char copyright_text_22[] = "Sun Microsystems, Inc. a les droits de proprit intellectuels relatants  la technologie incorpore dans ce produit. En particulier, et sans la limitation, ces droits de proprit intellectuels peuvent inclure un ou plus des brevets amricains numrs  http://www.sun.com/patents et un ou les brevets plus supplmentaires ou les applications de brevet en attente dans les tats - Unis et les autres pays.";
 const char copyright_text_23[] = "Ce produit ou document est protg par un copyright et distribu avec des licences qui en restreignent l'utilisation, la copie, la distribution, et la dcompilation. Aucune partie de ce produit ou document ne peut tre reproduite sous aucune forme, par quelque moyen que ce soit, sans l'autorisation pralable et crite de Sun et de ses bailleurs de licence, s'il y ena.";
 const char copyright_text_24[] = "L'utilisation est soumise aux termes du contrat de licence.";
@@ -17,4 +17,18 @@ const char copyright_text_25[] = "Cette distribution peut comprendre des composa
 const char copyright_text_26[] = "Sun, Sun Microsystems, le logo Sun, Java, Solaris et StarOffice sont des marques de fabrique ou des marques dposes de Sun Microsystems, Inc. aux Etats-Unis et dans d'autres pay";
 const char copyright_text_27[] = "Toutes les marques SPARC sont utilises sous licence et sont des marques de fabrique ou des marques dposes de SPARC International, Inc. aux Etats-Unis et dans d'autres pay";
 const char copyright_text_28[] = "UNIX est une marque dpose aux Etats-Unis et dans d'autres pays et licencie exlusivement par X/Open Company, Ltd.";
-
+#else
+const char copyright_text_1[] = "empty string";
+const char copyright_text_2[] = "empty string";
+const char copyright_text_3[] = "empty string";
+const char copyright_text_4[] = "empty string";
+const char copyright_text_5[] = "empty string";
+const char copyright_text_21[] = "empty string";
+const char copyright_text_22[] = "empty string";
+const char copyright_text_23[] = "empty string";
+const char copyright_text_24[] = "empty string";
+const char copyright_text_25[] = "empty string";
+const char copyright_text_26[] = "empty string";
+const char copyright_text_27[] = "empty string";
+const char copyright_text_28[] = "empty string";
+#endif
\ No newline at end of file
diff --git desktop/source/app/officeipcthread.cxx desktop/source/app/officeipcthread.cxx
index 9e158b7..210184b 100644
--- desktop/source/app/officeipcthread.cxx
+++ desktop/source/app/officeipcthread.cxx
@@ -798,8 +798,10 @@ void SAL_CALL OfficeIPCThread::run()
                         eFactory = SvtModuleOptions::E_DRAW;
                     else if ( aCmdLineArgs->IsImpress() )
                         eFactory = SvtModuleOptions::E_IMPRESS;
+#ifndef OOo4Kids
                     else if ( aCmdLineArgs->IsBase() )
                         eFactory = SvtModuleOptions::E_DATABASE;
+#endif
                     else if ( aCmdLineArgs->IsMath() )
                         eFactory = SvtModuleOptions::E_MATH;
                     else if ( aCmdLineArgs->IsGlobal() )
diff --git desktop/source/deployment/gui/dp_gui_service.cxx desktop/source/deployment/gui/dp_gui_service.cxx
index 7425c14..bb322d4 100644
--- desktop/source/deployment/gui/dp_gui_service.cxx
+++ desktop/source/deployment/gui/dp_gui_service.cxx
@@ -95,6 +95,8 @@ namespace
         : public rtl::Static< String, Version > {};
     struct AboutBoxVersion
         : public rtl::Static< String, AboutBoxVersion > {};
+    struct LicenseBoxVersion
+        : public rtl::Static< String, LicenseBoxVersion > {};
     struct Extension
         : public rtl::Static< String, Extension > {};
 }
@@ -110,6 +112,7 @@ void ReplaceProductNameHookProc( String& rStr )
         String &rVersion = Version::get();
         String &rAboutBoxVersion = AboutBoxVersion::get();
         String &rExtension = Extension::get();
+        String &rLicenseBoxVersion = LicenseBoxVersion::get();
 
         if ( !rProductName.Len() )
         {
@@ -132,6 +135,10 @@ void ReplaceProductNameHookProc( String& rStr )
                 aRet >>= aTmp;
                 rExtension = aTmp;
             }
+
+            aRet = ::utl::ConfigManager::GetDirectConfigProperty( ::utl::ConfigManager::LICENSEBOXVERSION );
+            aRet >>= aTmp;
+            rLicenseBoxVersion = aTmp;
         }
 
         nPro++;
@@ -139,6 +146,7 @@ void ReplaceProductNameHookProc( String& rStr )
         rStr.SearchAndReplaceAllAscii( "%PRODUCTVERSION", rVersion );
         rStr.SearchAndReplaceAllAscii( "%ABOUTBOXPRODUCTVERSION", rAboutBoxVersion );
         rStr.SearchAndReplaceAllAscii( "%PRODUCTEXTENSION", rExtension );
+        rStr.SearchAndReplaceAllAscii( "%LICENSEBOXVERSION", rLicenseBoxVersion );
     }
 }
 
diff --git desktop/source/migration/pages.cxx desktop/source/migration/pages.cxx
index 544ea04..d2725f2 100644
--- desktop/source/migration/pages.cxx
+++ desktop/source/migration/pages.cxx
@@ -585,7 +585,11 @@ sal_Bool RegistrationPage::commitPage( CommitPageReason _eReason )
 
 RegistrationPage::RegistrationMode RegistrationPage::getRegistrationMode() const
 {
+#ifdef OOo4Kids
+    RegistrationPage::RegistrationMode eMode = rmNever;
+#else
     RegistrationPage::RegistrationMode eMode = rmNow;
+#endif
     if ( m_rbLater.IsChecked() )
         eMode = rmLater;
     else if ( m_rbNever.IsChecked() )
@@ -610,6 +614,9 @@ bool RegistrationPage::hasReminderDateCome()
 
 void RegistrationPage::executeSingleMode()
 {
+#ifdef OOo4Kids
+    return;
+#endif
     // opens the page in a single tabdialog
     SfxSingleTabDialog aSingleDlg( NULL, TP_REGISTRATION );
     RegistrationPage* pPage = new RegistrationPage( &aSingleDlg, WizardResId( TP_REGISTRATION ) );
diff --git desktop/source/migration/services/makefile.mk desktop/source/migration/services/makefile.mk
index 22d28ee..a84f9b6 100644
--- desktop/source/migration/services/makefile.mk
+++ desktop/source/migration/services/makefile.mk
@@ -37,6 +37,12 @@ ENABLE_EXCEPTIONS=TRUE
 COMP1TYPELIST = migrationoo2
 
 # --- Settings -----------------------------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ..$/..$/deployment/inc/dp_misc.mk
 .INCLUDE :  settings.mk
 DLLPRE =
diff --git desktop/source/splash/makefile.mk desktop/source/splash/makefile.mk
index 3ca3187..c4d7625 100644
--- desktop/source/splash/makefile.mk
+++ desktop/source/splash/makefile.mk
@@ -43,7 +43,13 @@ ENABLE_EXCEPTIONS=TRUE
 
 # --- Files --------------------------------------------------------
 
-SLOFILES =	$(SLO)$/splash.obj \
+.IF "$(OOo4Kids)"=="YES"
+SLOFILES = $(SLO)$/splash_png.obj
+.ELSE
+SLOFILES = $(SLO)$/splash.obj
+.ENDIF
+
+SLOFILES += \
             $(SLO)$/firststart.obj \
             $(SLO)$/services_spl.obj
 
@@ -80,7 +86,12 @@ SHL1STDLIBS= \
 
 .INCLUDE :  target.mk
 
+.IF "$(OOo4Kids)"=="YES"
+$(SLO)$/splash_png.obj : $(INCCOM)$/introbmpnames.hxx
+.ELSE
 $(SLO)$/splash.obj : $(INCCOM)$/introbmpnames.hxx
+.ENDIF
+
 
 .INCLUDE .IGNORE : $(MISC)$/intro_bmp_names.mk
 
diff --git desktop/source/splash/splash_png.cxx desktop/source/splash/splash_png.cxx
new file mode 100644
index 0000000..2530919
--- /dev/null
+++ desktop/source/splash/splash_png.cxx
@@ -0,0 +1,750 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: splash_png.cxx,v $
+ * $Revision: 1 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_desktop.hxx"
+
+#include "splash_png.hxx"
+#include <stdio.h>
+#include <unotools/bootstrap.hxx>
+#include <vos/process.hxx>
+#include <tools/urlobj.hxx>
+#include <tools/stream.hxx>
+#include <sfx2/sfx.hrc>
+#include <vcl/svapp.hxx>
+#include <vcl/salnativewidgets.hxx>
+
+#include <com/sun/star/registry/XRegistryKey.hpp>
+#include <rtl/bootstrap.hxx>
+#include <rtl/logfile.hxx>
+#include <rtl/ustrbuf.hxx>
+#include <rtl/math.hxx>
+
+#include <stdlib.h>
+#include <rtl/strbuf.hxx>
+#include <rtl/ustring.hxx>
+
+#include "vcl/bitmapex.hxx"
+#include "vcl/pngread.hxx"
+
+
+#ifdef DEBUG
+const sal_Char *dbg_dump(const rtl::OString &rStr)
+{
+    static rtl::OStringBuffer aStr;
+    aStr = rtl::OStringBuffer(rStr);
+    aStr.append(static_cast<char>(0));
+    return aStr.getStr();
+}
+
+const sal_Char *dbg_dump(const rtl::OUString &rStr)
+{
+    return dbg_dump(rtl::OUStringToOString(rStr, RTL_TEXTENCODING_UTF8));
+}
+
+const sal_Char *dbg_dump(rtl_String *pStr)
+{
+    return dbg_dump(rtl::OString(pStr));
+}
+
+const sal_Char *dbg_dump(rtl_uString *pStr)
+{
+    return dbg_dump(rtl::OUString(pStr));
+}
+#endif
+
+#define NOT_LOADED  ((long)-1)
+
+using namespace ::rtl;
+using namespace ::com::sun::star::registry;
+
+namespace desktop
+{
+
+// Ctor.
+// TODO : verify the parameters are OK for .png too
+SplashScreen::SplashScreen(const Reference< XMultiServiceFactory >& rSMgr)
+    : IntroWindow()
+    , _vdev(*((IntroWindow*)this))
+    , _cProgressFrameColor(sal::static_int_cast< ColorData >(NOT_LOADED))
+    , _cProgressBarColor(sal::static_int_cast< ColorData >(NOT_LOADED))
+    , _iMax(100)
+    , _iProgress(0)
+    , _eBitmapMode(BM_DEFAULTMODE)
+    , _bPaintBitmap(sal_True)
+    , _bPaintProgress(sal_False)
+    , _bShowLogo(sal_True)
+    , _bFullScreenSplash(sal_False)
+    , _bProgressEnd(sal_False)
+    , _tlx(NOT_LOADED)
+    , _tly(NOT_LOADED)
+    , _barwidth(NOT_LOADED)
+    , _barheight(NOT_LOADED)
+    , _barspace(2)
+    , _fXPos(-1.0)
+    , _fYPos(-1.0)
+    , _fWidth(-1.0)
+    , _fHeight(-1.0)
+    , _xoffset(12)
+    , _yoffset(18)
+{
+    _rFactory = rSMgr;
+
+    loadConfig();
+}
+
+SplashScreen::~SplashScreen()
+{
+    // Dtor.
+    // OK, nothing to add
+    Application::RemoveEventListener(
+        LINK( this, SplashScreen, AppEventListenerHdl ) );
+    Hide();
+
+}
+
+// TODO : external call -> find from where
+void SAL_CALL SplashScreen::start(const OUString&, sal_Int32 nRange)
+    throw (RuntimeException)
+{
+    _iMax = nRange;
+    if (_bVisible) {
+        _bProgressEnd = sal_False;
+        ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+        if ( _eBitmapMode == BM_FULLSCREEN )
+            ShowFullScreenMode( TRUE );
+        Show();
+        Paint(Rectangle());
+        Flush();
+    }
+}
+
+// TODO : external call -> find from where
+void SAL_CALL SplashScreen::end()
+    throw (RuntimeException)
+{
+    _iProgress = _iMax;
+    if (_bVisible )
+    {
+        if ( _eBitmapMode == BM_FULLSCREEN )
+            EndFullScreenMode();
+        Hide();
+    }
+    _bProgressEnd = sal_True;
+}
+
+// TODO : external call -> find from where
+void SAL_CALL SplashScreen::reset()
+    throw (RuntimeException)
+{
+    _iProgress = 0;
+    if (_bVisible && !_bProgressEnd )
+    {
+        if ( _eBitmapMode == BM_FULLSCREEN )
+            ShowFullScreenMode( TRUE );
+        Show();
+        updateStatus();
+    }
+}
+
+void SAL_CALL SplashScreen::setText(const OUString&)
+    throw (RuntimeException)
+{
+    if (_bVisible && !_bProgressEnd) {
+        if ( _eBitmapMode == BM_FULLSCREEN )
+            ShowFullScreenMode( TRUE );
+        Show();
+        Flush();
+    }
+}
+
+void SAL_CALL SplashScreen::setValue(sal_Int32 nValue)
+    throw (RuntimeException)
+{
+    RTL_LOGFILE_CONTEXT( aLog, "::SplashScreen::setValue (lo119109)" );
+    RTL_LOGFILE_CONTEXT_TRACE1( aLog, "value=%d", nValue );
+
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    if (_bVisible && !_bProgressEnd) {
+        if ( _eBitmapMode == BM_FULLSCREEN )
+            ShowFullScreenMode( TRUE );
+        Show();
+        if (nValue >= _iMax) _iProgress = _iMax;
+    else _iProgress = nValue;
+    updateStatus();
+    }
+}
+
+// XInitialize
+void SAL_CALL
+SplashScreen::initialize( const ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Any>& aArguments )
+    throw (RuntimeException)
+{
+    ::osl::ClearableMutexGuard	aGuard(	_aMutex );
+    if (aArguments.getLength() > 0)
+    {
+        aArguments[0] >>= _bVisible;
+        if (aArguments.getLength() > 1 )
+            aArguments[1] >>= _sAppName;
+
+        // Real process: initPng() -> findPng() -> loadBitmap()
+        initPng();
+
+#ifdef DEBUG
+        fprintf( stderr, " We are in %s\n", __func__ );
+//        fprintf( stderr, " _aIntroPng contains: %s \n",dbg_dump(rtl::OUString(_aIntroPng)));
+#endif
+        // if aSize is NULL, it means the previous initPng failed ...
+        Size aSize = _aIntroPng.GetSizePixel();
+        SetOutputSizePixel( aSize );
+        _vdev.SetOutputSizePixel( aSize );
+        _height = aSize.Height();
+        _width = aSize.Width();
+        if (_width > 500)
+        {
+            // hmmm .. 
+            Point xtopleft(212,216);
+            if ( NOT_LOADED == _tlx || NOT_LOADED == _tly )
+            {
+                _tlx = xtopleft.X();    // top-left x
+                _tly = xtopleft.Y();    // top-left y
+            }
+            if ( NOT_LOADED == _barwidth )
+                _barwidth = 263;
+            if ( NOT_LOADED == _barheight )
+                _barheight = 8;
+            if (( _eBitmapMode == BM_FULLSCREEN ) && 
+                _bFullScreenSplash )
+            {
+                if( ( _fXPos >= 0.0 ) && ( _fYPos >= 0.0 ))
+                {
+                    _tlx = sal_Int32( double( aSize.Width() ) * _fXPos );
+                    _tly = sal_Int32( double( aSize.Height() ) * _fYPos );
+                }
+                if ( _fWidth >= 0.0 )
+                    _barwidth  = sal_Int32( double( aSize.Width() ) * _fWidth );
+                if ( _fHeight >= 0.0 )
+                    _barheight = sal_Int32( double( aSize.Width() ) * _fHeight );
+            }   
+        }
+        else
+        {
+            if ( NOT_LOADED == _barwidth )
+                _barwidth  = _width - (2 * _xoffset);
+            if ( NOT_LOADED == _barheight )
+                _barheight = 6;
+            if ( NOT_LOADED == _tlx || NOT_LOADED == _tly )
+            {
+                _tlx = _xoffset;           // top-left x
+                _tly = _height - _yoffset; // top-left y
+            }
+        }
+
+        if ( sal::static_int_cast< ColorData >(NOT_LOADED) ==
+             _cProgressFrameColor.GetColor() )
+            _cProgressFrameColor = Color( COL_LIGHTGRAY );
+
+        if ( sal::static_int_cast< ColorData >(NOT_LOADED) ==
+             _cProgressBarColor.GetColor() )
+        {
+            // progress bar: new color only for big bitmap format
+            if ( _width > 500 )
+                _cProgressBarColor = Color( 157, 202, 18 );
+            else
+                _cProgressBarColor = Color( COL_BLUE );
+        }
+
+        Application::AddEventListener(
+            LINK( this, SplashScreen, AppEventListenerHdl ) );
+
+        Point xtopleft(0,0);
+        OutputDevice::DrawBitmapEx (xtopleft, _aIntroPng);
+    }
+}
+
+void SplashScreen::updateStatus()
+{
+    if (!_bVisible || _bProgressEnd) return;
+    if (!_bPaintProgress) _bPaintProgress = sal_True;
+    //_bPaintBitmap=sal_False;
+    Paint(Rectangle());
+    //_bPaintBitmap=sal_True;
+    Flush();
+}
+
+// internal private methods
+IMPL_LINK( SplashScreen, AppEventListenerHdl, VclWindowEvent *, inEvent )
+{
+    if ( inEvent != 0 )
+    {
+        // Paint( Rectangle() );
+        switch ( inEvent->GetId() )
+        {
+            case VCLEVENT_WINDOW_SHOW:
+                Paint( Rectangle() );
+                break;
+            default:
+                break;
+        }
+    }
+    return 0;
+}
+
+// useless in OOo (and OOo4Kids)
+// Read keys from edition/edition.ini or soffice{.ini|rc}:
+OUString implReadBootstrapKey( const OUString& _rKey )
+{
+    OUString sValue(
+        rtl::OUString(
+            RTL_CONSTASCII_USTRINGPARAM(
+                "${.override:${BRAND_BASE_DIR}/program/edition/edition.ini:")) +
+        _rKey + rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("}")));
+    rtl::Bootstrap::expandMacros(sValue);
+    return sValue;
+}
+
+void SplashScreen::loadConfig()
+{
+    _bShowLogo = !implReadBootstrapKey(
+        rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("Logo"))).
+        equalsAsciiL(RTL_CONSTASCII_STRINGPARAM("0"));
+
+    OUString sProgressFrameColor = implReadBootstrapKey(
+        OUString( RTL_CONSTASCII_USTRINGPARAM( "ProgressFrameColor" ) ) );
+    OUString sProgressBarColor = implReadBootstrapKey(
+        OUString( RTL_CONSTASCII_USTRINGPARAM( "ProgressBarColor" ) ) );
+    OUString sSize = implReadBootstrapKey(
+        OUString( RTL_CONSTASCII_USTRINGPARAM( "ProgressSize" ) ) );
+    OUString sPosition = implReadBootstrapKey(
+        OUString( RTL_CONSTASCII_USTRINGPARAM( "ProgressPosition" ) ) );
+    OUString sFullScreenSplash = implReadBootstrapKey(
+        OUString( RTL_CONSTASCII_USTRINGPARAM( "FullScreenSplash" ) ) );
+
+    // Determine full screen splash mode
+    _bFullScreenSplash = (( sFullScreenSplash.getLength() > 0 ) && 
+                          ( !sFullScreenSplash.equalsAsciiL( "0", 1 )));
+
+    // Try to retrieve the relative values for the progress bar. The current
+    // schema uses the screen ratio to retrieve the associated values.
+    if ( _bFullScreenSplash )
+        determineProgressRatioValues( _fXPos, _fYPos, _fWidth, _fHeight );
+
+    if ( sProgressFrameColor.getLength() )
+    {
+        UINT8 nRed = 0;
+        UINT8 nGreen = 0;
+        UINT8 nBlue = 0;
+        sal_Int32 idx = 0;
+        sal_Int32 temp = sProgressFrameColor.getToken( 0, ',', idx ).toInt32();
+        if ( idx != -1 )
+        {
+            nRed = static_cast< UINT8 >( temp );
+            temp = sProgressFrameColor.getToken( 0, ',', idx ).toInt32();
+        }
+        if ( idx != -1 )
+        {
+            nGreen = static_cast< UINT8 >( temp );
+            nBlue = static_cast< UINT8 >( sProgressFrameColor.getToken( 0, ',', idx ).toInt32() );
+            _cProgressFrameColor = Color( nRed, nGreen, nBlue );
+        }
+    }
+
+    if ( sProgressBarColor.getLength() )
+    {
+        UINT8 nRed = 0;
+        UINT8 nGreen = 0;
+        UINT8 nBlue = 0;
+        sal_Int32 idx = 0;
+        sal_Int32 temp = sProgressBarColor.getToken( 0, ',', idx ).toInt32();
+        if ( idx != -1 )
+        {
+            nRed = static_cast< UINT8 >( temp );
+            temp = sProgressBarColor.getToken( 0, ',', idx ).toInt32();
+        }
+        if ( idx != -1 )
+        {
+            nGreen = static_cast< UINT8 >( temp );
+            nBlue = static_cast< UINT8 >( sProgressBarColor.getToken( 0, ',', idx ).toInt32() );
+            _cProgressBarColor = Color( nRed, nGreen, nBlue );
+        }
+    }
+
+    if ( sSize.getLength() )
+    {
+        sal_Int32 idx = 0;
+        sal_Int32 temp = sSize.getToken( 0, ',', idx ).toInt32();
+        if ( idx != -1 )
+        {
+            _barwidth = temp;
+            _barheight = sSize.getToken( 0, ',', idx ).toInt32();
+        }
+    }
+
+    if ( _barheight >= 10 )
+        _barspace = 3;  // more space between frame and bar
+
+    if ( sPosition.getLength() )
+    {
+        sal_Int32 idx = 0;
+        sal_Int32 temp = sPosition.getToken( 0, ',', idx ).toInt32();
+        if ( idx != -1 )
+        {
+            _tlx = temp;
+            _tly = sPosition.getToken( 0, ',', idx ).toInt32();
+        }
+    }
+}
+
+void SplashScreen::initPng()
+{
+    if ( _bShowLogo )
+    {
+        // we define a string containing the path
+        OUString sExecutePath;
+        // the method returns the expected path, matching with BRAND_BASE_DIR environment variable
+        ::rtl::Bootstrap::get(
+            OUString( RTL_CONSTASCII_USTRINGPARAM( "BRAND_BASE_DIR" ) ),
+            sExecutePath );
+        // in fact, the intro bitmap is located in $BRAND_BASE_DIR/program subdir
+        sExecutePath += OUString( RTL_CONSTASCII_USTRINGPARAM( "/program/" ) );
+#ifdef DEBUG
+        fprintf( stderr, " We are in %s\n", __func__ );
+        fprintf( stderr, " sExecutePath contains: %s \n",dbg_dump(rtl::OUString(sExecutePath)));
+#endif
+        // let's continue with the real .png
+        findPng(sExecutePath);
+    }
+}
+
+bool SplashScreen::loadPng( rtl::OUString const & path, const rtl::OUString &rBmpFileName )
+{
+    if ( rBmpFileName.getLength() == 0 )
+        return false;
+
+    INetURLObject aObj( path, INET_PROT_FILE );
+    aObj.insertName( rBmpFileName );
+
+#ifdef DEBUG
+    fprintf( stderr, " We are in %s\n", __func__ );
+    fprintf( stderr, " rBmpFileName contains: %s \n",dbg_dump(rtl::OUString(rBmpFileName)) );
+    fprintf( stderr, " aObj.PathToFileName() contains: %s \n",dbg_dump(rtl::OUString(aObj.PathToFileName())));
+#endif
+
+    if (aObj.PathToFileName().endsWithAsciiL(RTL_CONSTASCII_STRINGPARAM(".png")))
+    {
+        SvFileStream pStream( aObj.PathToFileName(), STREAM_STD_READ );
+        pStream.Open( aObj.PathToFileName(), STREAM_STD_READ  );
+        _aIntroPng = vcl::PNGReader(pStream).Read();
+
+        if ( _aIntroPng.IsTransparent() ) // else nothing to do there, i.e. the .png has no transparent region
+        {
+            Bitmap _aIntroPngMask = _aIntroPng.GetBitmap();
+            Color aMaskColor = COL_BLACK;
+            Color aClippedColor = COL_WHITE;
+            unsigned short nToleranceLevel = 128;
+            _aIntroPngMask = _aIntroPng.GetMask();
+
+            Bitmap _rRegionPngMask = _aIntroPngMask.CreateMask( aMaskColor, nToleranceLevel );
+            const Size aSize (_rRegionPngMask.GetSizePixel());
+            Point xtopleft(0,0);
+
+            // first, retrieve the screen size
+            Rectangle aScreenArea = Application::GetScreenPosSizePixel((unsigned int)0);
+            sal_Int32 width  = aScreenArea.GetWidth();
+            sal_Int32 height = aScreenArea.GetHeight();
+
+            // then set the location of the splashscreen
+            Point aPos( (width - aSize.Width())/2,(height - aSize.Height())/2 );
+
+            const Rectangle aRect( xtopleft, aSize );
+            SetPosSizePixel( aPos, aSize );
+            Region	aOpaqueRegion = _rRegionPngMask.CreateRegion( aClippedColor, Rectangle(xtopleft, aSize) );
+            SetWindowRegionPixel( aOpaqueRegion );
+    
+            // avoid leaks at launch ...
+            if ( STREAM_STD_READ == pStream.GetStreamMode() )
+                pStream.Close();
+        }
+        return true;
+    }
+    else
+        return false;
+}
+
+bool SplashScreen::findPng(rtl::OUString const & path)
+{
+    bool havePng = false;
+    if ( _bFullScreenSplash )
+    {
+        havePng = findScreenPng(path);
+        if ( havePng )
+            _eBitmapMode = BM_FULLSCREEN;
+        else
+            havePng = findAppBitmap(path);
+    }
+#ifdef DEBUG
+    fprintf( stderr, " We are in %s\n", __func__ );
+    fprintf( stderr, " path contains: %s \n",dbg_dump(rtl::OUString(path)));
+#endif
+    // in OOo4Kids, we always go there, and there we load the .png
+    havePng = loadPng(path, rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("intro.png")));
+#ifdef DEBUG
+    fprintf( stderr, "loadPng() done (0 for false, 1 for true). Result : %d \n", havePng);
+#endif
+    return havePng;
+}
+
+// Called when either in multi screen configuration, or in fullscreen mode (needs investigation) 
+bool SplashScreen::findScreenPng(rtl::OUString const & path)
+{
+    sal_Int32 nWidth( 0 );
+    sal_Int32 nHeight( 0 );
+
+    // determine desktop resolution
+    sal_uInt32 nCount = Application::GetScreenCount();
+    if ( nCount > 0 )
+    {
+        // retrieve size from first screen
+        Rectangle aScreenArea = Application::GetScreenPosSizePixel((unsigned int)0);
+        nWidth  = aScreenArea.GetWidth();
+        nHeight = aScreenArea.GetHeight();
+    }
+    
+    // create file name from screen resolution information
+    OUStringBuffer aStrBuf( 128 );
+    aStrBuf.appendAscii( "intro_" );
+    if ( _sAppName.getLength() > 0 )
+    {
+        aStrBuf.append( _sAppName );
+        aStrBuf.appendAscii( "_" );
+    }
+    aStrBuf.append( OUString::valueOf( nWidth ));
+    aStrBuf.appendAscii( "x" );
+    aStrBuf.append( OUString::valueOf( nHeight ));
+    aStrBuf.appendAscii( ".png" );
+    OUString aBmpFileName = aStrBuf.makeStringAndClear();
+
+    bool havePng = loadPng( path, aBmpFileName );
+    if ( !havePng )
+    {
+        aStrBuf.appendAscii( "intro_" );
+        aStrBuf.appendAscii( "_" );
+        aStrBuf.append( OUString::valueOf( nWidth ));
+        aStrBuf.appendAscii( "x" );
+        aStrBuf.append( OUString::valueOf( nHeight ));
+        aStrBuf.appendAscii( ".png" );
+        aBmpFileName = aStrBuf.makeStringAndClear();
+
+        havePng = loadPng( path, aBmpFileName );
+    }
+    return havePng;
+}
+
+// Called when either in multi screen configuration, or fullscreen (needs investigation) 
+// TODO : understand well all cases
+bool SplashScreen::findAppBitmap(rtl::OUString const & path)
+{
+    bool havePng = false;
+
+    if ( _sAppName.getLength() > 0 )
+    {
+        OUStringBuffer aStrBuf( 128 );
+        aStrBuf.appendAscii( "intro_" );
+        aStrBuf.appendAscii( "_" );
+        aStrBuf.append( _sAppName );
+        aStrBuf.appendAscii( ".png" );
+        OUString aBmpFileName = aStrBuf.makeStringAndClear();
+        havePng = loadPng( path, aBmpFileName );
+    }
+    return havePng;
+}
+
+void SplashScreen::determineProgressRatioValues( 
+    double& rXRelPos, double& rYRelPos, 
+    double& rRelWidth, double& rRelHeight )
+{
+    sal_Int32 nWidth( 0 );
+    sal_Int32 nHeight( 0 );
+    sal_Int32 nScreenRatio( 0 );
+
+    // determine desktop resolution
+    sal_uInt32 nCount = Application::GetScreenCount();
+    if ( nCount > 0 )
+    {
+        // retrieve size from first screen
+        Rectangle aScreenArea = Application::GetScreenPosSizePixel((unsigned int)0);
+        nWidth  = aScreenArea.GetWidth();
+        nHeight = aScreenArea.GetHeight();
+        nScreenRatio  = sal_Int32( math::round( double( nWidth ) / double( nHeight ), 2 ) * 100 );
+    }
+
+    char szFullScreenProgressRatio[] = "FullScreenProgressRatio0";
+    char szFullScreenProgressPos[]   = "FullScreenProgressPos0";
+    char szFullScreenProgressSize[]  = "FullScreenProgressSize0";
+    for ( sal_Int32 i = 0; i <= 9; i++ )
+    {
+        char cNum = '0' + char( i );
+        szFullScreenProgressRatio[23] = cNum;
+        szFullScreenProgressPos[21]   = cNum;
+        szFullScreenProgressSize[22]  = cNum;
+
+        OUString sFullScreenProgressRatio = implReadBootstrapKey(
+            OUString::createFromAscii( szFullScreenProgressRatio ) );
+
+        if ( sFullScreenProgressRatio.getLength() > 0 )
+        {
+            double fRatio = sFullScreenProgressRatio.toDouble();
+            sal_Int32 nRatio = sal_Int32( math::round( fRatio, 2 ) * 100 );
+            if ( nRatio == nScreenRatio )
+            {
+                OUString sFullScreenProgressPos = implReadBootstrapKey(
+                    OUString::createFromAscii( szFullScreenProgressPos ) );
+                OUString sFullScreenProgressSize = implReadBootstrapKey(
+                    OUString::createFromAscii( szFullScreenProgressSize ) );
+                
+                if ( sFullScreenProgressPos.getLength() )
+                {
+                    sal_Int32 idx = 0;
+                    double temp = sFullScreenProgressPos.getToken( 0, ',', idx ).toDouble();
+                    if ( idx != -1 )
+                    {
+                        rXRelPos = temp;
+                        rYRelPos = sFullScreenProgressPos.getToken( 0, ',', idx ).toDouble();
+                    }
+                }
+
+                if ( sFullScreenProgressSize.getLength() )
+                {
+                    sal_Int32 idx = 0;
+                    double temp = sFullScreenProgressSize.getToken( 0, ',', idx ).toDouble();
+                    if ( idx != -1 )
+                    {
+                        rRelWidth  = temp;
+                        rRelHeight = sFullScreenProgressSize.getToken( 0, ',', idx ).toDouble();
+                    }
+                }
+            }
+        }
+        else
+            break;
+    }
+}
+
+void SplashScreen::Paint( const Rectangle&)
+{
+    if(!_bVisible) return;
+
+    //native drawing
+    BOOL bNativeOK = FALSE;
+    
+    // in case of native controls we need to draw directly to the window
+    if( IsNativeControlSupported( CTRL_INTROPROGRESS, PART_ENTIRE_CONTROL ) )
+    {
+        DrawBitmapEx( Point(), _aIntroPng );
+        
+        ImplControlValue aValue( _iProgress * _barwidth / _iMax);
+        Rectangle aDrawRect( Point(_tlx, _tly), Size( _barwidth, _barheight ) );
+        Region aControlRegion( aDrawRect );
+        Region aNativeControlRegion, aNativeContentRegion;
+
+        if( GetNativeControlRegion( CTRL_INTROPROGRESS, PART_ENTIRE_CONTROL, aControlRegion,
+                                             CTRL_STATE_ENABLED, aValue, rtl::OUString(),
+                                             aNativeControlRegion, aNativeContentRegion ) ) 
+        {
+              long nProgressHeight = aNativeControlRegion.GetBoundRect().GetHeight();
+              aDrawRect.Top() -= (nProgressHeight - _barheight)/2;
+              aDrawRect.Bottom() += (nProgressHeight - _barheight)/2;
+              aControlRegion = Region( aDrawRect );
+        }
+        
+        if( (bNativeOK = DrawNativeControl( CTRL_INTROPROGRESS, PART_ENTIRE_CONTROL, aControlRegion,
+                                                     CTRL_STATE_ENABLED, aValue, rtl::OUString() )) != FALSE ) 
+        {
+            return;
+        }
+    }
+    //non native drawing
+    // draw bitmap
+    if (_bPaintBitmap)
+        _vdev.DrawBitmapEx( Point(), _aIntroPng );
+
+    if (_bPaintProgress) {
+        // draw progress...
+        long length = (_iProgress * _barwidth / _iMax) - (2 * _barspace);
+        if (length < 0) length = 0;
+        
+        // border
+        _vdev.SetFillColor();
+        _vdev.SetLineColor( _cProgressFrameColor );
+        _vdev.DrawRect(Rectangle(_tlx, _tly, _tlx+_barwidth, _tly+_barheight));
+        _vdev.SetFillColor( _cProgressBarColor );
+        _vdev.SetLineColor();
+        Rectangle aRect(_tlx+_barspace, _tly+_barspace, _tlx+_barspace+length, _tly+_barheight-_barspace);
+        _vdev.DrawRect(Rectangle(_tlx+_barspace, _tly+_barspace,
+            _tlx+_barspace+length, _tly+_barheight-_barspace));
+
+    }
+    Size aSize =  GetOutputSizePixel();
+    Size bSize =  _vdev.GetOutputSizePixel();
+    //_vdev.Flush();
+    //_vdev.DrawOutDev(Point(), GetOutputSize(), Point(), GetOutputSize(), *((IntroWindow*)this) );
+    DrawOutDev(Point(), GetOutputSizePixel(), Point(), _vdev.GetOutputSizePixel(), _vdev );
+    //Flush();
+}
+
+
+// get service instance...
+SplashScreen *SplashScreen::_pINSTANCE = NULL;
+osl::Mutex SplashScreen::_aMutex;
+
+Reference< XInterface > SplashScreen::getInstance(const Reference< XMultiServiceFactory >& rSMgr)
+{
+    if ( _pINSTANCE == 0 )
+    {
+        osl::MutexGuard guard(_aMutex);
+        if (_pINSTANCE == 0)
+            return (XComponent*)new SplashScreen(rSMgr);
+    }
+
+    return (XComponent*)0;
+}
+
+// static service info...
+const char* SplashScreen::interfaces[] =
+{
+    "com.sun.star.task.XStartusIndicator",
+    "com.sun.star.lang.XInitialization",
+    NULL,
+};
+const sal_Char *SplashScreen::serviceName = "com.sun.star.office.SplashScreen";
+const sal_Char *SplashScreen::implementationName = "com.sun.star.office.comp.SplashScreen";
+const sal_Char *SplashScreen::supportedServiceNames[] = {"com.sun.star.office.SplashScreen", NULL};
+
+}
diff --git desktop/source/splash/splash_png.hxx desktop/source/splash/splash_png.hxx
new file mode 100644
index 0000000..2cccff1
--- /dev/null
+++ desktop/source/splash/splash_png.hxx
@@ -0,0 +1,143 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: splash_png.hxx,v $
+ * $Revision: 1 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include <com/sun/star/lang/XServiceInfo.hpp>
+#include <com/sun/star/uno/Exception.hpp>
+#include <com/sun/star/uno/Reference.h>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/task/XStatusIndicator.hpp>
+#include <com/sun/star/lang/XInitialization.hpp>
+#include <cppuhelper/implbase2.hxx>
+#include <cppuhelper/interfacecontainer.h>
+#include <vcl/introwin.hxx>
+#include <vcl/bitmap.hxx>
+#include <vcl/pngread.hxx>
+#include <com/sun/star/lang/XSingleServiceFactory.hpp>
+#include <osl/mutex.hxx>
+#include <vcl/virdev.hxx>
+//#include <vcl/impimagetree.hxx>
+
+
+using namespace ::rtl;
+using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star::lang;
+using namespace ::com::sun::star::task;
+
+namespace desktop {
+
+class  SplashScreen
+    : public ::cppu::WeakImplHelper2< XStatusIndicator, XInitialization >
+    , public IntroWindow
+{
+private:
+    struct FullScreenProgressRatioValue
+    {
+        double _fXRelPos;
+        double _fYRelPos;
+        double _fRelWidth;
+        double _fRelHeight;
+    };
+    enum BitmapMode { BM_FULLSCREEN, BM_DEFAULTMODE };
+
+    // don't allow anybody but ourselves to create instances of this class
+    SplashScreen(const SplashScreen&);
+    SplashScreen(void);
+    SplashScreen operator =(const SplashScreen&);
+
+    SplashScreen(const Reference< XMultiServiceFactory >& xFactory);
+
+    DECL_LINK( AppEventListenerHdl, VclWindowEvent * );
+    virtual ~SplashScreen();
+    void loadConfig();
+    void initPng();
+    void updateStatus();
+    bool findScreenPng(rtl::OUString const & path);
+    bool findAppBitmap(rtl::OUString const & path);
+    bool findPng(rtl::OUString const & path);
+    bool loadPng(
+        rtl::OUString const & path, const rtl::OUString &rBmpFileName );
+/*
+    bool loadBitmap(
+        rtl::OUString const & path, const rtl::OUString &rBmpFileName );
+*/
+    void determineProgressRatioValues( double& rXRelPos, double& rYRelPos, double& rRelWidth, double& rRelHeight );
+
+    static  SplashScreen *_pINSTANCE;
+
+    static osl::Mutex _aMutex;
+    Reference< XMultiServiceFactory > _rFactory;
+
+    VirtualDevice   _vdev;
+    BitmapEx          _aIntroPng;
+    Color           _cProgressFrameColor;
+    Color           _cProgressBarColor;
+    OUString        _sAppName;
+    std::vector< FullScreenProgressRatioValue > _sFullScreenProgressRatioValues;
+
+    sal_Int32   _iMax;
+    sal_Int32   _iProgress;
+    BitmapMode  _eBitmapMode;
+    sal_Bool    _bPaintBitmap;
+    sal_Bool    _bPaintProgress;
+    sal_Bool    _bVisible;
+    sal_Bool    _bShowLogo;
+    sal_Bool    _bFullScreenSplash;
+    sal_Bool    _bProgressEnd;
+    long _height, _width, _tlx, _tly, _barwidth;
+    long _barheight, _barspace;
+    double _fXPos, _fYPos;
+    double _fWidth, _fHeight;
+    const long _xoffset, _yoffset;
+
+public:
+    static const char* interfaces[];
+    static const sal_Char *serviceName;
+    static const sal_Char *implementationName;
+    static const sal_Char *supportedServiceNames[];
+
+    static Reference< XInterface > getInstance(const Reference < XMultiServiceFactory >& xFactory);
+
+    // XStatusIndicator
+    virtual void SAL_CALL end() throw ( RuntimeException );
+    virtual void SAL_CALL reset() throw ( RuntimeException );
+    virtual void SAL_CALL setText(const OUString& aText) throw ( RuntimeException );
+    virtual void SAL_CALL setValue(sal_Int32 nValue) throw ( RuntimeException );
+    virtual void SAL_CALL start(const OUString& aText, sal_Int32 nRange) throw ( RuntimeException );
+
+    // XInitialize
+    virtual void SAL_CALL initialize( const ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Any>& aArguments )
+        throw ( RuntimeException );
+
+    // workwindow
+    virtual void Paint( const Rectangle& );
+
+};
+
+}
diff --git desktop/util/ooverinfo.rc desktop/util/ooverinfo.rc
index 0e9f01d..71e3e89 100644
--- desktop/util/ooverinfo.rc
+++ desktop/util/ooverinfo.rc
@@ -63,25 +63,25 @@ VS_VERSION_INFO versioninfo
 			block "040704E4"
 			{
 				// German StringTable
-				value "CompanyName",		"OpenOffice.org\0"
+                value "CompanyName",		"OOo4Kids\0"
 				value "FileDescription", "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "ProductVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	"SOFFICE.EXE\0"
 				value "InternalName",		"SOFFICE\0"
-				value "LegalCopyright",		S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "LegalCopyright",		S_CRIGHT " EducOO.org.\0"
 			}
 #else
 			block "040904E4"
 			{
 				// International StringTable
-				value "CompanyName", 		"OpenOffice.org\0"
+                value "CompanyName", 		"OOo4Kids\0"
 				value "FileDescription",	"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "ProductVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	"SOFFICE.EXE\0"
 				value "InternalName", 		"SOFFICE\0"
-				value "LegalCopyright", 	S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "LegalCopyright", 	S_CRIGHT " EducOO.org.\0"
 			}
 #endif
 		}
@@ -109,7 +109,6 @@ VS_VERSION_INFO versioninfo
 11 ICON "icons\\ooo3_global_doc.ico"
 12 ICON "icons\\ooo3_html_doc.ico"
 13 ICON "icons\\ooo3_chart_doc.ico"
-14 ICON "icons\\ooo3_base_doc.ico"
 15 ICON "icons\\ooo3_math_doc.ico"
 16 ICON "icons\\ooo3_empty_tem.ico"
 17 ICON "icons\\ooo3_macro_doc.ico"
@@ -121,7 +120,6 @@ VS_VERSION_INFO versioninfo
 23 ICON "icons\\ooo3_draw_app.ico"
 24 ICON "icons\\ooo3_impress_app.ico"
 25 ICON "icons\\ooo3_math_app.ico"
-26 ICON "icons\\ooo3_base_app.ico"
 27 ICON "icons\\ooo3_empty_doc.ico"
 28 ICON "icons\\ooo11-writer-doc.ico"
 29 ICON "icons\\ooo11-writer-tem.ico"
@@ -133,7 +131,6 @@ VS_VERSION_INFO versioninfo
 35 ICON "icons\\ooo11-impress-tem.ico"
 36 ICON "icons\\ooo11-master-doc.ico"
 37 ICON "icons\\ooo11-chart-doc.ico"
-38 ICON "icons\\ooo11-base-doc.ico"
 39 ICON "icons\\ooo11-math-doc.ico"
 40 ICON "icons\\oxt-extension.ico"
 
diff --git desktop/util/ooverinfo2.rc desktop/util/ooverinfo2.rc
index 27fb7ae..05f86f6 100644
--- desktop/util/ooverinfo2.rc
+++ desktop/util/ooverinfo2.rc
@@ -25,8 +25,8 @@
  *
  *************************************************************************/
 
-#define VERSION			3
-#define SUBVERSION		2
+#define VERSION			0
+#define SUBVERSION		8
 //#define VERVARIANT		0
 // .0 + VER_CONCEPT
 // .100 + VER_ALPHA
diff --git desktop/util/template.manifest desktop/util/template.manifest
index dbed81c..d05f337 100644
--- desktop/util/template.manifest
+++ desktop/util/template.manifest
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8" standalone="yes"?>
 <assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
-<assemblyIdentity version="1.0.0.0" processorArchitecture="x86" name="OpenOffice" type="win32" />
+<assemblyIdentity version="1.0.0.0" processorArchitecture="x86" name="OOo4Kids" type="win32" />
 <description>http://www.openoffice.org</description>
 <dependency>
 <dependentAssembly>
diff --git desktop/util/verinfo.rc desktop/util/verinfo.rc
index 105933f..27743c6 100644
--- desktop/util/verinfo.rc
+++ desktop/util/verinfo.rc
@@ -68,25 +68,25 @@ VS_VERSION_INFO versioninfo
 			block "040704E4"
 			{
 				// German StringTable
-				value "CompanyName",		"Sun Microsystems, Inc.\0"
+                value "CompanyName",		"EducOO.org\0"
 				value "FileDescription", "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "ProductVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	"SOFFICE.EXE\0"
 				value "InternalName",		"SOFFICE\0"
-				value "LegalCopyright",		S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "LegalCopyright",		S_CRIGHT " EducOO.org\0"
 			}
 #else
 			block "040904E4"
 			{
 				// International StringTable
-				value "CompanyName", 		"Sun Microsystems, Inc.\0"
+                value "CompanyName", 		"EducOO.org\0"
 				value "FileDescription",	"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "ProductVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	"SOFFICE.EXE\0"
 				value "InternalName", 		"SOFFICE\0"
-				value "LegalCopyright", 	S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "LegalCopyright", 	S_CRIGHT " EducOO.org\0"
 			}
 #endif
 		}
diff --git desktop/win32/source/applauncher/ooo/makefile.mk desktop/win32/source/applauncher/ooo/makefile.mk
index ad4c7c9..0b0c345 100644
--- desktop/win32/source/applauncher/ooo/makefile.mk
+++ desktop/win32/source/applauncher/ooo/makefile.mk
@@ -103,6 +103,7 @@ APP5OBJS = \
 APP5STDLIBS = $(SHELL32LIB)
 APP5PRODUCTDEF+=-DRES_APP_NAME=$(APP5TARGET)
 
+.IF "$(OOo4Kids)" != "YES"
 APP6TARGET=sbase
 APP6DEPN=verinfo.rc
 APP6VERINFO=verinfo.rc
@@ -114,6 +115,7 @@ APP6OBJS = \
        $(OBJ)$/sbase.obj
 APP6STDLIBS = $(SHELL32LIB)
 APP6PRODUCTDEF+=-DRES_APP_NAME=$(APP6TARGET)
+.ENDIF
 
 APP7TARGET=sweb
 APP7DEPN=verinfo.rc
diff --git desktop/zipintro/makefile.mk desktop/zipintro/makefile.mk
index 70e5c80..1419ced 100644
--- desktop/zipintro/makefile.mk
+++ desktop/zipintro/makefile.mk
@@ -39,6 +39,32 @@ TARGET=zipintro
 
 DEFAULT_FLAVOURS=dev dev_nologo nologo broffice dev_broffice nologo_broffice nologo_dev_broffice intro
 
+.IF "$(OOo4Kids)"=="YES"
+ZIP1LIST= \
+    $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/intro.png $(INTRO_BITMAPS)) \
+    $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/about.png $(ABOUT_BITMAPS))
+ZIP2LIST= \
+    $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/intro.png $(INTRO_BITMAPS)) \
+    $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/about.png $(ABOUT_BITMAPS))
+ZIP3LIST= \
+    $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/intro.png $(INTRO_BITMAPS)) \
+    $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/about.png $(ABOUT_BITMAPS))
+ZIP4LIST= \
+    $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/intro.png $(INTRO_BITMAPS)) \
+    $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/OOo4Kids$/introabout$/about.png $(ABOUT_BITMAPS))
+ZIP5LIST= \
+    $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/dev_broffice$/introabout$/intro.bmp $(INTRO_BITMAPS)) \
+    $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/broffice$/introabout$/about.bmp $(ABOUT_BITMAPS))
+ZIP6LIST= \
+    $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/broffice$/introabout$/intro.bmp $(INTRO_BITMAPS)) \
+    $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/broffice$/introabout$/about.bmp $(ABOUT_BITMAPS))
+ZIP7LIST= \
+        $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/nologo_broffice$/introabout$/intro.bmp $(INTRO_BITMAPS)) \
+        $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/broffice$/introabout$/about.bmp $(ABOUT_BITMAPS))
+ZIP8LIST= \
+        $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/dev_nologo_broffice$/introabout$/intro.bmp $(INTRO_BITMAPS)) \
+        $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/broffice$/introabout$/about.bmp $(ABOUT_BITMAPS))
+.ELSE
 ZIP1LIST= \
     $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/dev$/introabout$/intro.bmp $(INTRO_BITMAPS)) \
     $(null,$(ABOUT_BITMAPS) $(MISC)$/$(RSCDEFIMG)$/introabout$/about.bmp $(ABOUT_BITMAPS))
@@ -63,6 +89,7 @@ ZIP7LIST= \
 ZIP8LIST= \
         $(null,$(INTRO_BITMAPS) $(MISC)$/ooo_custom_images$/dev_nologo_broffice$/introabout$/intro.bmp $(INTRO_BITMAPS)) \
         $(null,$(ABOUT_BITMAPS) $(MISC)$/ooo_custom_images$/broffice$/introabout$/about.bmp $(ABOUT_BITMAPS))
+.ENDIF
 
 ZIP1TARGET=dev_intro
 ZIP1DEPS=$(ZIP1LIST)
@@ -105,9 +132,6 @@ $(COMMONBIN)$/dev_nologo$/intro.zip : $(COMMONBIN)$/dev_nologo_intro.zip
     @@-$(MKDIR) $(@:d)
     @$(COPY) $< $@
 
-$(COMMONBIN)$/nologo$/intro.zip : $(COMMONBIN)$/nologo_intro.zip
-    @@-$(MKDIR) $(@:d)
-    @$(COPY) $< $@
 
 $(COMMONBIN)$/broffice$/intro.zip : $(COMMONBIN)$/broffice_intro.zip
     @@-$(MKDIR) $(@:d)
@@ -125,11 +149,21 @@ $(COMMONBIN)$/nologo_dev_broffice$/intro.zip : $(COMMONBIN)$/nologo_dev_broffice
         @@-$(MKDIR) $(@:d)
         @$(COPY) $< $@
 
+$(COMMONBIN)$/nologo$/intro.zip : $(COMMONBIN)$/nologo_intro.zip
+    @@-$(MKDIR) $(@:d)
+    @$(COPY) $< $@
+
 $(COMMONBIN)$/intro$/intro.zip : $(COMMONBIN)$/intro_intro.zip
     @@-$(MKDIR) $(@:d)
     @$(COPY) $< $@
 
+
 $(MISC)$/%.bmp : $(SOLARSRC)$/%.bmp
     @@-$(MKDIRHIER) $(@:d)
     $(COPY) $< $@
 
+.IF "$(OOo4Kids)"=="YES"
+$(MISC)$/%.png : $(SOLARSRC)$/%.png
+    @@-$(MKDIRHIER) $(@:d)
+    $(COPY) $< $@
+.ENDIF
diff --git dictionaries/de_CH/VERSION dictionaries/de_CH/VERSION
new file mode 100644
index 0000000..d06d68e
--- /dev/null
+++ dictionaries/de_CH/VERSION
@@ -0,0 +1 @@
+20051213
diff --git dictionaries/de_DE/VERSION dictionaries/de_DE/VERSION
new file mode 100644
index 0000000..d06d68e
--- /dev/null
+++ dictionaries/de_DE/VERSION
@@ -0,0 +1 @@
+20051213
diff --git dictionaries/zu_ZA/dictionary.lst dictionaries/zu_ZA/dictionary.lst
new file mode 100644
index 0000000..9110ae6
--- /dev/null
+++ dictionaries/zu_ZA/dictionary.lst
@@ -0,0 +1 @@
+HYPH zu ZA hyph_zu_ZA
diff --git epm/epm-3.7.patch epm/epm-3.7.patch
index 116aa28..aee53b9 100644
--- epm/epm-3.7.patch
+++ epm/epm-3.7.patch
@@ -1,8 +1,6 @@
-*** misc/epm-3.7/bsd.c	Tue Jan 14 18:05:01 2003
---- misc/build/epm-3.7/bsd.c	Mon Nov 20 14:54:51 2006
-***************
-*** 26,31 ****
---- 26,38 ----
+--- misc/epm-3.7/bsd.c	2003-01-14 18:05:01.000000000 +0100
++++ misc/build/epm-3.7/bsd.c	2009-12-04 14:40:28.000000000 +0100
+@@ -26,6 +26,13 @@
   
   #include "epm.h"
   
@@ -16,9 +14,7 @@
   
   /*
    * 'make_bsd()' - Make a FreeBSD software distribution package.
-***************
-*** 149,156 ****
---- 156,172 ----
+@@ -149,8 +156,17 @@
   
     for (i = dist->num_depends, d = dist->depends; i > 0; i --, d ++)
     {
@@ -36,9 +32,7 @@
       else
   #ifdef __FreeBSD__
        /*
-***************
-*** 179,187 ****
---- 195,205 ----
+@@ -179,9 +195,11 @@
   	        "         by the BSD packager.\n", stderr);
             break;
         case COMMAND_POST_INSTALL :
@@ -50,56 +44,35 @@
             fprintf(fp, "@unexec %s\n", c->command);
   	  break;
         case COMMAND_POST_REMOVE :
-***************
-*** 199,205 ****
+@@ -199,7 +217,7 @@
         */
   
         fprintf(fp, "@exec /bin/mkdir -p %s\n", file->dst);
-!       fprintf(fp, "@exec /bin/chown %s:%s %s\n", file->user, file->group,
+-      fprintf(fp, "@exec /bin/chown %s:%s %s\n", file->user, file->group,
++      fprintf(fp, "@exec /usr/sbin/chown %s:%s %s\n", file->user, file->group,
                 file->dst);
         fprintf(fp, "@exec /bin/chmod %04o %s\n", file->mode, file->dst);
       }
---- 217,223 ----
-        */
-  
-        fprintf(fp, "@exec /bin/mkdir -p %s\n", file->dst);
-!       fprintf(fp, "@exec /usr/sbin/chown %s:%s %s\n", file->user, file->group,
-                file->dst);
-        fprintf(fp, "@exec /bin/chmod %04o %s\n", file->mode, file->dst);
-      }
-***************
-*** 326,337 ****
-    if (Verbosity)
-      puts("Building FreeBSD pkg binary distribution...");
-  
-!   if (run_command(NULL, "pkg_create -p / -s %s -c %s -d %s -f %s %s",
-                    current, commentname, descrname, plistname, name))
-      return (1);
-  
-!   if (run_command(NULL, "mv %s.tgz %s", name, directory))
-!     return (1);
-  
-   /*
-    * Remove temporary files...
---- 344,356 ----
+@@ -326,12 +344,13 @@
     if (Verbosity)
       puts("Building FreeBSD pkg binary distribution...");
   
-!   if (run_command(NULL, "/usr/sbin/pkg_create -p / -s %s -c %s -d %s -f %s %s",
+-  if (run_command(NULL, "pkg_create -p / -s %s -c %s -d %s -f %s %s",
++  if (run_command(NULL, "/usr/sbin/pkg_create -p / -s %s -c %s -d %s -f %s %s",
                     current, commentname, descrname, plistname, name))
       return (1);
   
-!   if (run_command(NULL, "mv %s.tbz %s", name, directory))
-!     if (run_command(NULL, "mv %s.tgz %s", name, directory))
-!       return (1);
+-  if (run_command(NULL, "mv %s.tgz %s", name, directory))
+-    return (1);
++  if (run_command(NULL, "mv %s.tbz %s", name, directory))
++    if (run_command(NULL, "mv %s.tgz %s", name, directory))
++      return (1);
   
    /*
     * Remove temporary files...
-*** misc/epm-3.7/configure	Thu Jul 24 03:20:54 2003
---- misc/build/epm-3.7/configure	Mon Nov 20 15:01:11 2006
-***************
-*** 1238,1244 ****
---- 1238,1249 ----
+--- misc/epm-3.7/configure	2003-07-24 03:20:54.000000000 +0200
++++ misc/build/epm-3.7/configure	2009-12-04 14:40:28.000000000 +0100
+@@ -1238,6 +1238,11 @@
   fi
   fi;
   
@@ -107,91 +80,78 @@
 + if test "${enable_fltk+set}" = set; then
 +   enableval="$enable_fltk"
 + fi;
-  
 + 
+ 
   # Check whether --with-docdir or --without-docdir was given.
   if test "${with_docdir+set}" = set; then
-    withval="$with_docdir"
-***************
-*** 4904,4939 ****
+@@ -4904,36 +4909,38 @@
   fi
   
   
-! # Extract the first word of "fltk-config", so it can be a program name with args.
-! set dummy fltk-config; ac_word=$2
-! echo "$as_me:$LINENO: checking for $ac_word" >&5
-! echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-! if test "${ac_cv_path_FLTKCONFIG+set}" = set; then
-!   echo $ECHO_N "(cached) $ECHO_C" >&6
-! else
-!   case $FLTKCONFIG in
-!   [\\/]* | ?:[\\/]*)
-!   ac_cv_path_FLTKCONFIG="$FLTKCONFIG" # Let the user override the test with a path.
-!   ;;
-!   *)
-!   as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-! for as_dir in $PATH
-! do
-!   IFS=$as_save_IFS
-!   test -z "$as_dir" && as_dir=.
-!   for ac_exec_ext in '' $ac_executable_extensions; do
-!   if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-!     ac_cv_path_FLTKCONFIG="$as_dir/$ac_word$ac_exec_ext"
-!     echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-!     break 2
+-# Extract the first word of "fltk-config", so it can be a program name with args.
+-set dummy fltk-config; ac_word=$2
+-echo "$as_me:$LINENO: checking for $ac_word" >&5
+-echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+-if test "${ac_cv_path_FLTKCONFIG+set}" = set; then
+-  echo $ECHO_N "(cached) $ECHO_C" >&6
+-else
+-  case $FLTKCONFIG in
+-  [\\/]* | ?:[\\/]*)
+-  ac_cv_path_FLTKCONFIG="$FLTKCONFIG" # Let the user override the test with a path.
+-  ;;
+-  *)
+-  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+-for as_dir in $PATH
+-do
+-  IFS=$as_save_IFS
+-  test -z "$as_dir" && as_dir=.
+-  for ac_exec_ext in '' $ac_executable_extensions; do
+-  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+-    ac_cv_path_FLTKCONFIG="$as_dir/$ac_word$ac_exec_ext"
+-    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+-    break 2
++if eval "test x$enable_fltk = xyes"; then
++  # Extract the first word of "fltk-config", so it can be a program name with args.
++  set dummy fltk-config; ac_word=$2
++  echo "$as_me:$LINENO: checking for $ac_word" >&5
++  echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
++  if test "${ac_cv_path_FLTKCONFIG+set}" = set; then
++    echo $ECHO_N "(cached) $ECHO_C" >&6
++  else
++    case $FLTKCONFIG in
++    [\\/]* | ?:[\\/]*)
++    ac_cv_path_FLTKCONFIG="$FLTKCONFIG" # Let the user override the test with a path.
++    ;;
++    *)
++    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
++  for as_dir in $PATH
++  do
++    IFS=$as_save_IFS
++    test -z "$as_dir" && as_dir=.
++    for ac_exec_ext in '' $ac_executable_extensions; do
++    if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
++      ac_cv_path_FLTKCONFIG="$as_dir/$ac_word$ac_exec_ext"
++      echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
++      break 2
++    fi
++  done
++  done
++  
++    ;;
++  esac
     fi
-! done
-! done
-! 
-!   ;;
-! esac
+-done
+-done
+-
+-  ;;
+-esac
++  FLTKCONFIG=$ac_cv_path_FLTKCONFIG
   fi
 - FLTKCONFIG=$ac_cv_path_FLTKCONFIG
   
   if test -n "$FLTKCONFIG"; then
     echo "$as_me:$LINENO: result: $FLTKCONFIG" >&5
---- 4909,4946 ----
-  fi
-  
-  
-! if eval "test x$enable_fltk = xyes"; then
-!   # Extract the first word of "fltk-config", so it can be a program name with args.
-!   set dummy fltk-config; ac_word=$2
-!   echo "$as_me:$LINENO: checking for $ac_word" >&5
-!   echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
-!   if test "${ac_cv_path_FLTKCONFIG+set}" = set; then
-!     echo $ECHO_N "(cached) $ECHO_C" >&6
-!   else
-!     case $FLTKCONFIG in
-!     [\\/]* | ?:[\\/]*)
-!     ac_cv_path_FLTKCONFIG="$FLTKCONFIG" # Let the user override the test with a path.
-!     ;;
-!     *)
-!     as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
-!   for as_dir in $PATH
-!   do
-!     IFS=$as_save_IFS
-!     test -z "$as_dir" && as_dir=.
-!     for ac_exec_ext in '' $ac_executable_extensions; do
-!     if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
-!       ac_cv_path_FLTKCONFIG="$as_dir/$ac_word$ac_exec_ext"
-!       echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
-!       break 2
-!     fi
-!   done
-!   done
-!   
-!     ;;
-!   esac
-    fi
-!   FLTKCONFIG=$ac_cv_path_FLTKCONFIG
-  fi
-  
-  if test -n "$FLTKCONFIG"; then
-    echo "$as_me:$LINENO: result: $FLTKCONFIG" >&5
-***************
-*** 4950,4957 ****
---- 4957,4966 ----
+@@ -4950,8 +4957,10 @@
   	INSTALL_GUIS=""
   	INSTALL_OSX=""
   
@@ -202,11 +162,9 @@
   else
   	CXXFLAGS="`$FLTKCONFIG --cflags` ${CXXFLAGS}"
   	GUIS="setup uninst"
-*** misc/epm-3.7/deb.c	Wed Jan 15 15:29:24 2003
---- misc/build/epm-3.7/deb.c	Mon Nov 20 14:54:51 2006
-***************
-*** 26,31 ****
---- 26,53 ----
+--- misc/epm-3.7/deb.c	2003-01-15 15:29:24.000000000 +0100
++++ misc/build/epm-3.7/deb.c	2009-12-04 14:40:28.000000000 +0100
+@@ -26,6 +26,28 @@
   
   #include "epm.h"
   
@@ -235,27 +193,7 @@
   
   /*
    * 'make_deb()' - Make a Debian software distribution package.
-***************
-*** 61,78 ****
-    if (Verbosity)
-      puts("Creating Debian distribution...");
-  
-    if (dist->relnumber)
-    {
-      if (platname[0])
-!       snprintf(name, sizeof(name), "%s-%s-%d-%s", prodname, dist->version, dist->relnumber,
-                platname);
-      else
-!       snprintf(name, sizeof(name), "%s-%s-%d", prodname, dist->version, dist->relnumber);
-    }
-    else if (platname[0])
-!     snprintf(name, sizeof(name), "%s-%s-%s", prodname, dist->version, platname);
-    else
-!     snprintf(name, sizeof(name), "%s-%s", prodname, dist->version);
-  
-   /*
-    * Write the control file for DPKG...
---- 83,111 ----
+@@ -61,18 +83,29 @@
     if (Verbosity)
       puts("Creating Debian distribution...");
   
@@ -273,33 +211,28 @@
     if (dist->relnumber)
     {
       if (platname[0])
-!       snprintf(name, sizeof(name), "%s_%s-%d_%s", prodname, dist->version, dist->relnumber,
+-      snprintf(name, sizeof(name), "%s-%s-%d-%s", prodname, dist->version, dist->relnumber,
++      snprintf(name, sizeof(name), "%s_%s-%d_%s", prodname, dist->version, dist->relnumber,
                 platname);
       else
-!       snprintf(name, sizeof(name), "%s_%s-%d", prodname, dist->version, dist->relnumber);
+-      snprintf(name, sizeof(name), "%s-%s-%d", prodname, dist->version, dist->relnumber);
++      snprintf(name, sizeof(name), "%s_%s-%d", prodname, dist->version, dist->relnumber);
     }
     else if (platname[0])
-!     snprintf(name, sizeof(name), "%s_%s_%s", prodname, dist->version, platname);
+-    snprintf(name, sizeof(name), "%s-%s-%s", prodname, dist->version, platname);
++    snprintf(name, sizeof(name), "%s_%s_%s", prodname, dist->version, platname);
     else
-!     snprintf(name, sizeof(name), "%s_%s", prodname, dist->version);
+-    snprintf(name, sizeof(name), "%s-%s", prodname, dist->version);
++    snprintf(name, sizeof(name), "%s_%s", prodname, dist->version);
   
    /*
     * Write the control file for DPKG...
-***************
-*** 108,115 ****
-    * (which we change in get_platform to a common name)
-    */
-  
-!   if (strcmp(platform->machine, "intel") == 0)
-      fputs("Architecture: i386\n", fp);
-    else
-      fprintf(fp, "Architecture: %s\n", platform->machine);
-  
---- 141,152 ----
+@@ -108,8 +141,12 @@
     * (which we change in get_platform to a common name)
     */
   
-!   if (!strcmp(platform->machine, "intel"))
+-  if (strcmp(platform->machine, "intel") == 0)
++  if (!strcmp(platform->machine, "intel"))
       fputs("Architecture: i386\n", fp);
 +   else if (!strcmp(platform->machine, "x86_64"))
 +     fputs("Architecture: amd64\n", fp);
@@ -308,30 +241,19 @@
     else
       fprintf(fp, "Architecture: %s\n", platform->machine);
   
-***************
-*** 148,156 ****
+@@ -148,9 +185,9 @@
         putc('\n', fp);
       }
     }
-! 
-    fclose(fp);
-! 
-   /*
-    * Write the preinst file for DPKG...
-    */
---- 185,193 ----
-        putc('\n', fp);
-      }
-    }
-!   
+-
++  
     fclose(fp);
-!   
+-
++  
    /*
     * Write the preinst file for DPKG...
     */
-***************
-*** 417,422 ****
---- 454,480 ----
+@@ -417,6 +454,27 @@
       }
     }
   
@@ -359,23 +281,14 @@
    /*
     * Build the distribution from the spec file...
     */
-*** misc/epm-3.7/dist.c	Thu Aug  7 16:14:40 2003
---- misc/build/epm-3.7/dist.c	Mon Nov 20 14:54:51 2006
-***************
-*** 394,401 ****
-    strcpy(platform->machine, "mips");
-  #elif defined(__hpux)
-    strcpy(platform->machine, "hppa");
-! #elif defined(_AIX) || defined(__APPLE__)
-    strcpy(platform->machine, "powerpc");
-  #else
-    for (temp = platform->machine; *temp != '\0'; temp ++)
-      if (*temp == '-' || *temp == '_')
---- 394,406 ----
+--- misc/epm-3.7/dist.c	2003-08-07 16:14:40.000000000 +0200
++++ misc/build/epm-3.7/dist.c	2009-12-04 14:40:28.000000000 +0100
+@@ -394,8 +394,13 @@
     strcpy(platform->machine, "mips");
   #elif defined(__hpux)
     strcpy(platform->machine, "hppa");
-! #elif defined(_AIX)
+-#elif defined(_AIX) || defined(__APPLE__)
++#elif defined(_AIX)
     strcpy(platform->machine, "powerpc");
 + #elif defined(__APPLE__)
 +   if (strstr(platform->machine, "86") != NULL)
@@ -385,44 +298,33 @@
   #else
     for (temp = platform->machine; *temp != '\0'; temp ++)
       if (*temp == '-' || *temp == '_')
-***************
-*** 407,413 ****
-        *temp = tolower(*temp);
-  
-    if (strstr(platform->machine, "86") != NULL)
-!     strcpy(platform->machine, "intel");
-    else if (strncmp(platform->machine, "sun", 3) == 0)
-      strcpy(platform->machine, "sparc");
-  #endif /* __sgi */
---- 412,423 ----
+@@ -407,7 +412,12 @@
         *temp = tolower(*temp);
   
     if (strstr(platform->machine, "86") != NULL)
-!   {
-!     if (strstr(platform->machine, "64") != NULL)
-!       strcpy(platform->machine, "x86_64");
-!     else
-!       strcpy(platform->machine, "intel");
-!   }
+-    strcpy(platform->machine, "intel");
++  {
++    if (strstr(platform->machine, "64") != NULL)
++      strcpy(platform->machine, "x86_64");
++    else
++      strcpy(platform->machine, "intel");
++  }
     else if (strncmp(platform->machine, "sun", 3) == 0)
       strcpy(platform->machine, "sparc");
   #endif /* __sgi */
-*** misc/epm-3.7/epm.c	Tue Oct 28 15:48:30 2003
---- misc/build/epm-3.7/epm.c	Mon Nov 20 14:54:51 2006
-***************
-*** 547,552 ****
---- 547,553 ----
+--- misc/epm-3.7/epm.c	2003-10-28 15:48:30.000000000 +0100
++++ misc/build/epm-3.7/epm.c	2009-12-04 14:41:01.000000000 +0100
+@@ -547,6 +547,7 @@
   {
     puts(EPM_VERSION);
     puts("Copyright 1999-2003 by Easy Software Products.");
-+   puts("Patched for OpenOffice.org");
++  puts("Patched for OpenOffice.org and OOo4Kids");
     puts("");
     puts("EPM is free software and comes with ABSOLUTELY NO WARRANTY; for details");
     puts("see the GNU General Public License in the file COPYING or at");
-*** misc/epm-3.7/file.c	Wed Jul 23 23:41:08 2003
---- misc/build/epm-3.7/file.c	Mon Nov 20 14:54:51 2006
-***************
-*** 108,114 ****
+--- misc/epm-3.7/file.c	2003-07-23 23:41:08.000000000 +0200
++++ misc/build/epm-3.7/file.c	2009-12-04 14:40:28.000000000 +0100
+@@ -108,7 +108,6 @@
     fclose(dstfile);
   
     chmod(dst, mode);
@@ -430,9 +332,7 @@
   
     return (0);
   }
---- 108,113 ----
-***************
-*** 138,144 ****
+@@ -138,7 +137,6 @@
         {
   	mkdir(buffer, 0777);
   	chmod(buffer, mode | 0700);
@@ -440,9 +340,7 @@
         }
       }
   
---- 137,142 ----
-***************
-*** 151,157 ****
+@@ -151,7 +149,6 @@
     {
       mkdir(buffer, 0777);
       chmod(buffer, mode | 0700);
@@ -450,30 +348,20 @@
     }
   
     return (0);
---- 149,154 ----
-*** misc/epm-3.7/osx.c	Wed Jul 23 23:41:08 2003
---- misc/build/epm-3.7/osx.c	Mon Nov 20 14:54:51 2006
-***************
-*** 373,379 ****
-    else
-      snprintf(filename, sizeof(filename), "%s/%s", current, directory);
-  
-!   run_command(NULL, "/Developer/Applications/PackageMaker.app/"
-                      "Contents/MacOS/PackageMaker -build "
-  		    "-p %s/%s.pkg -f %s/Package -r %s/Resources -d %s/%s-desc.plist -i %s/%s-info.plist",
-  	      filename, prodname, filename, filename, filename, prodname, filename, prodname);
---- 373,379 ----
+--- misc/epm-3.7/osx.c	2003-07-23 23:41:08.000000000 +0200
++++ misc/build/epm-3.7/osx.c	2009-12-04 14:40:28.000000000 +0100
+@@ -373,7 +373,7 @@
     else
       snprintf(filename, sizeof(filename), "%s/%s", current, directory);
   
-!   run_command(NULL, "/Developer/Applications/Utilities/PackageMaker.app/"
+-  run_command(NULL, "/Developer/Applications/PackageMaker.app/"
++  run_command(NULL, "/Developer/Applications/Utilities/PackageMaker.app/"
                       "Contents/MacOS/PackageMaker -build "
   		    "-p %s/%s.pkg -f %s/Package -r %s/Resources -d %s/%s-desc.plist -i %s/%s-info.plist",
   	      filename, prodname, filename, filename, filename, prodname, filename, prodname);
-*** misc/epm-3.7/pkg.c	Tue Dec 17 19:57:56 2002
---- misc/build/epm-3.7/pkg.c	Mon Nov 20 14:54:51 2006
-***************
-*** 429,503 ****
+--- misc/epm-3.7/pkg.c	2002-12-17 19:57:56.000000000 +0100
++++ misc/build/epm-3.7/pkg.c	2009-12-04 14:40:29.000000000 +0100
+@@ -429,75 +429,6 @@
   
     fclose(fp);
   
@@ -549,24 +437,9 @@
     return (0);
   }
   
---- 429,434 ----
-*** misc/epm-3.7/qprintf.c	Mon Jan 27 22:48:03 2003
---- misc/build/epm-3.7/qprintf.c	Mon Nov 20 14:54:51 2006
-***************
-*** 181,192 ****
-  
-              for (i = slen; i > 0; i --, s ++, bytes ++)
-  	    {
-  	      if (strchr("`~!#$%^&*()[{]}\\|;\'\"<>? ", *s))
-  	      {
-  	        putc('\\', fp);
-  		bytes ++;
-  	      }
-! 
-  	      putc(*s, fp);
-  	    }
-  
---- 181,199 ----
+--- misc/epm-3.7/qprintf.c	2003-01-27 22:48:03.000000000 +0100
++++ misc/build/epm-3.7/qprintf.c	2009-12-04 14:40:29.000000000 +0100
+@@ -181,12 +181,19 @@
   
               for (i = slen; i > 0; i --, s ++, bytes ++)
   	    {
@@ -582,32 +455,23 @@
   	        putc('\\', fp);
   		bytes ++;
   	      }
-! #endif
+-
++#endif
   	      putc(*s, fp);
   	    }
   
-*** misc/epm-3.7/rpm.c	Wed Oct  1 21:27:15 2003
---- misc/build/epm-3.7/rpm.c	Mon Nov 20 14:54:51 2006
-***************
-*** 38,44 ****
+--- misc/epm-3.7/rpm.c	2003-10-01 21:27:15.000000000 +0200
++++ misc/build/epm-3.7/rpm.c	2009-12-04 14:40:29.000000000 +0100
+@@ -38,7 +38,7 @@
            dist_t         *dist,		/* I - Distribution information */
   	 struct utsname *platform)	/* I - Platform information */
   {
-!   int		i;			/* Looping var */
+-  int		i;			/* Looping var */
++  int		i,n;			/* Looping vars */
     FILE		*fp;			/* Spec file */
     char		name[1024];		/* Full product name */
     char		specname[1024];		/* Spec filename */
---- 38,44 ----
-           dist_t         *dist,		/* I - Distribution information */
-  	 struct utsname *platform)	/* I - Platform information */
-  {
-!   int		i,n;			/* Looping vars */
-    FILE		*fp;			/* Spec file */
-    char		name[1024];		/* Full product name */
-    char		specname[1024];		/* Spec filename */
-***************
-*** 160,165 ****
---- 160,167 ----
+@@ -160,6 +160,8 @@
         fprintf(fp, "Requires: %s", dname);
       else if (d->type == DEPEND_PROVIDES)
         fprintf(fp, "Provides: %s", dname);
@@ -616,31 +480,15 @@
       else
         fprintf(fp, "Conflicts: %s", dname);
   
-***************
-*** 186,200 ****
+@@ -186,15 +188,33 @@
     for (i = 0; i < dist->num_descriptions; i ++)
       fprintf(fp, "%s\n", dist->descriptions[i]);
   
-!   fputs("%pre\n", fp);
-    for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
-      if (c->type == COMMAND_PRE_INSTALL)
-        fprintf(fp, "%s\n", c->command);
-  
-!   fputs("%post\n", fp);
-    for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
-      if (c->type == COMMAND_POST_INSTALL)
-        fprintf(fp, "%s\n", c->command);
-  
-    for (i = dist->num_files, file = dist->files; i > 0; i --, file ++)
-      if (tolower(file->type) == 'i')
---- 188,220 ----
-    for (i = 0; i < dist->num_descriptions; i ++)
-      fprintf(fp, "%s\n", dist->descriptions[i]);
-  
-!   /*
-!    * %pre
-!    */
-!   n = 0;
+-  fputs("%pre\n", fp);
++  /*
++   * %pre
++   */
++  n = 0;
     for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
 +   {
       if (c->type == COMMAND_PRE_INSTALL)
@@ -651,10 +499,11 @@
 +     }
 +   }
   
-!   /*
-!    * %post
-!    */
-!   n = 0;
+-  fputs("%post\n", fp);
++  /*
++   * %post
++   */
++  n = 0;
     for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
 +   {
       if (c->type == COMMAND_POST_INSTALL)
@@ -667,9 +516,7 @@
   
     for (i = dist->num_files, file = dist->files; i > 0; i --, file ++)
       if (tolower(file->type) == 'i')
-***************
-*** 202,207 ****
---- 222,229 ----
+@@ -202,6 +222,8 @@
   
     if (i)
     {
@@ -678,29 +525,18 @@
       fputs("if test \"x$1\" = x1; then\n", fp);
       fputs("	echo Setting up init scripts...\n", fp);
   
-***************
-*** 259,265 ****
-      fputs("fi\n", fp);
-    }
-  
-!   fputs("%preun\n", fp);
-    for (i = dist->num_files, file = dist->files; i > 0; i --, file ++)
-      if (tolower(file->type) == 'i')
-        break;
---- 281,290 ----
+@@ -259,13 +281,17 @@
       fputs("fi\n", fp);
     }
   
-!   /*
-!    * %preun
-!    */
-!   n = 0;
+-  fputs("%preun\n", fp);
++  /*
++   * %preun
++   */
++  n = 0;
     for (i = dist->num_files, file = dist->files; i > 0; i --, file ++)
       if (tolower(file->type) == 'i')
         break;
-***************
-*** 266,271 ****
---- 291,297 ----
   
     if (i)
     {
@@ -708,22 +544,7 @@
       fputs("if test \"x$1\" = x0; then\n", fp);
       fputs("	echo Cleaning up init scripts...\n", fp);
   
-***************
-*** 315,327 ****
-    }
-  
-    for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
-      if (c->type == COMMAND_PRE_REMOVE)
-        fprintf(fp, "%s\n", c->command);
-  
-!   fputs("%postun\n", fp);
-    for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
-      if (c->type == COMMAND_POST_REMOVE)
-        fprintf(fp, "%s\n", c->command);
-  
-    fputs("%files\n", fp);
-    for (i = dist->num_files, file = dist->files; i > 0; i --, file ++)
---- 341,369 ----
+@@ -315,13 +341,29 @@
     }
   
     for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
@@ -737,10 +558,11 @@
 +     }
 +   }
   
-!   /*
-!    * %post
-!    */
-!   n = 0;
+-  fputs("%postun\n", fp);
++  /*
++   * %post
++   */
++  n = 0;
     for (i = dist->num_commands, c = dist->commands; i > 0; i --, c ++)
 +   {
       if (c->type == COMMAND_POST_REMOVE)
@@ -753,8 +575,7 @@
   
     fputs("%files\n", fp);
     for (i = dist->num_files, file = dist->files; i > 0; i --, file ++)
-***************
-*** 415,467 ****
+@@ -415,53 +457,6 @@
       }
     }
   
@@ -808,4 +629,3 @@
     return (0);
   }
   
---- 457,462 ----
diff --git filter/source/config/fragments/makefile.mk filter/source/config/fragments/makefile.mk
index 6503062..0d08292 100644
--- filter/source/config/fragments/makefile.mk
+++ filter/source/config/fragments/makefile.mk
@@ -183,7 +183,7 @@ ALLTAR : $(ALL_FLAGS)
 
 $(ALL_FLAGS) : $(INCLUDE_FRAGMENTS)
 
-.IF "$(SOLAR_JAVA)"==""
+.IF "$(SOLAR_JAVA)"=="" || "$(OOo4Kids)"=="YES"
 #cmc, hack to workaround the java build requirement
 .IF "$(SYSTEM_PYTHON)" == "YES"
 MERGE:=python ../tools/merge/pyAltFCFGMerge
@@ -257,3 +257,4 @@ $(INTERNALFILTERPACKAGES_FILTERS_FLAG) : $$(FILTERS_4$$(@:b))
      -$(MKDIRHIER) $(DIR_MODPACKS)
      $(MERGE) fragmentsdir=. tempdir=$(TEMP) outdir=$(DIR_MODPACKS) pkg=$(DIR_MODPACKS)$/$(@:b)_filters.xcu xmlpackage=GraphicFilter fcfg=$(mktmp items=$(FILTERS_4$(@:b):b:t",":s/.xcu//)) subdir_filters=internalgraphicfilters && $(TOUCH) $@
 
+# end
diff --git filter/source/config/tools/merge/FCFGMerge.cfg filter/source/config/tools/merge/FCFGMerge.cfg
new file mode 100644
index 0000000..46fccca
--- /dev/null
+++ filter/source/config/tools/merge/FCFGMerge.cfg
@@ -0,0 +1,125 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: FCFGMerge.cfg,v $
+#
+# $Revision: 1.5 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+#************************************************
+# Specify the verbose mode of this tool.
+# 1 = show errors only
+# 2 = show errors/warnings (default)
+# 3 = show errors/warnings and some generic infos
+# 4 = show anything (including detailed infos)
+#
+# [OPTIONAL]
+#************************************************
+
+loglevel = 2
+
+#************************************************
+# This extension is used for all XML files. It doesnt
+# matter if its used for reading fragments or writing
+# XML packages.
+# Must be given without any additional signes like "."
+# or "*."!
+#
+# [REQUIRED]
+#************************************************
+
+extension_xcu=xcu
+
+#************************************************
+# This extension is used for all Package files. It doesnt
+# matter if its used for reading such files or writing
+# it.
+# Must be given without any additional signes like "."
+# or "*."!
+#
+# [REQUIRED]
+#************************************************
+
+extension_pkg=pkg
+
+#************************************************
+# These values are used to generate a correct XML
+# header.
+# Note: The property "xmlpackage" must be specified
+#       via command line. There exists more then one
+#      	possible value.
+#
+# [REQUIRED]
+#************************************************
+
+xmlversion	=	1.0
+xmlencoding	=	UTF-8
+xmlpath		=	org.openoffice.TypeDetection
+#xmlpackage	=
+
+#************************************************
+# These values are used to name the configuration
+# sets inside the generated XCM file for different
+# item groups like e.g. types, filters etcpp.
+#
+# [REQUIRED]
+#************************************************
+
+setname_types 			    = Types
+setname_filters 			  = Filters
+setname_frameloaders 	  = FrameLoaders
+setname_contenthandlers = ContentHandlers
+
+subdir_types 			    	= types
+subdir_filters 			  	= filters
+subdir_frameloaders 	  = frameloaders
+subdir_contenthandlers 	= contenthandlers
+
+#************************************************
+# This delimiter is used to split every
+# item list of the package configuration files
+# (which are temp. created  by the make proccess)
+# into its tokens.
+#
+# [REQUIRED]
+#************************************************
+delimiter=,
+
+#************************************************
+# Enable/disable removing of leading/trailing withespaces
+# during splitting stringlists.
+#
+# [REQUIRED]
+#************************************************
+trim=true
+
+#************************************************
+# Enable/disable removing of leading/trailing "-signs
+# during splitting stringlists.
+#
+# [REQUIRED]
+#************************************************
+decode=false
diff --git filter/source/config/tools/merge/FCFGMerge.java filter/source/config/tools/merge/FCFGMerge.java
new file mode 100644
index 0000000..a936035
--- /dev/null
+++ filter/source/config/tools/merge/FCFGMerge.java
@@ -0,0 +1,128 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: FCFGMerge.java,v $
+ * $Revision: 1.5 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+package com.sun.star.filter.config.tools.merge;
+
+//_______________________________________________
+
+import com.sun.star.filter.config.tools.utils.*;
+
+//_______________________________________________
+
+/**
+ *  Its a simple command line tool, which can merge different XML fragments
+ *  together. Such fragments must exist as files on disk, will be moved into
+ *  one file together on disk.
+ *
+ *
+ */
+public class FCFGMerge
+{
+    //___________________________________________
+    // const
+
+    private static final java.lang.String CFGFILE = "com/sun/star/filter/config/tools/merge/FCFGMerge.cfg";
+    private static final java.lang.String PROP_LOGLEVEL = "loglevel";
+
+    //___________________________________________
+    // main
+
+    public static void main(java.lang.String[] sCmdLine)
+    {
+        FCFGMerge.printCopyright();
+
+        // create log object in default mode "WARNINGS"
+        // If a command line parameter indicates another
+        // level - change it!
+        Logger aLog = new Logger();
+
+        try
+        {
+            // merge config file and overwrite properties
+            // via command line
+            ConfigHelper aCfg = null;
+            aCfg = new ConfigHelper(CFGFILE, sCmdLine);
+
+            // update log level
+            int nLogLevel = aCfg.getInt(PROP_LOGLEVEL, Logger.LEVEL_WARNINGS);
+            aLog = new Logger(nLogLevel);
+
+            // help requested?
+            if (aCfg.isHelp())
+            {
+                FCFGMerge.printHelp();
+                System.exit(-1);
+            }
+
+            // create new merge object and start operation
+            Merger aMerger = new Merger(aCfg, aLog);
+            aMerger.merge();
+        }
+        catch(java.lang.Throwable ex)
+        {
+            aLog.setException(ex);
+            System.exit(-1);
+        }
+
+        System.exit(0);
+    }
+
+    //___________________________________________
+
+    /** prints out a copyright message on stdout.
+     */
+    private static void printCopyright()
+    {
+        java.lang.StringBuffer sOut = new java.lang.StringBuffer(256);
+        sOut.append("FCFGMerge\n");
+        sOut.append("Copyright: 2003 by Sun Microsystems, Inc.\n");
+        sOut.append("All Rights Reserved.\n");
+        System.out.println(sOut.toString());
+    }
+
+    //___________________________________________
+
+    /** prints out a help message on stdout.
+     */
+    private static void printHelp()
+    {
+        java.lang.StringBuffer sOut = new java.lang.StringBuffer(256);
+        sOut.append("____________________________________________________________\n");
+        sOut.append("usage: FCFGMerge cfg=<file name>\n"                            );
+        sOut.append("parameters:\n"                                                 );
+        sOut.append("\tcfg=<file name>\n"                                           );
+        sOut.append("\t\tmust point to a system file, which contains\n"             );
+        sOut.append("\t\tall neccessary configuration data for the merge process.\n");
+        sOut.append("\n\tFurther cou can specify every parameter allowed in the\n"  );
+        sOut.append("\n\tconfig file as command line parameter too, to overwrite\n" );
+        sOut.append("\n\tthe value from the file.\n"                                );
+        System.out.println(sOut.toString());
+    }
+}
diff --git filter/source/config/tools/merge/Manifest.mf filter/source/config/tools/merge/Manifest.mf
new file mode 100644
index 0000000..1337eaf
--- /dev/null
+++ filter/source/config/tools/merge/Manifest.mf
@@ -0,0 +1 @@
+Main-Class: com.sun.star.filter.config.tools.merge.FCFGMerge
diff --git filter/source/config/tools/merge/Merger.java filter/source/config/tools/merge/Merger.java
new file mode 100644
index 0000000..198f829
--- /dev/null
+++ filter/source/config/tools/merge/Merger.java
@@ -0,0 +1,362 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: Merger.java,v $
+ * $Revision: 1.8 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+package com.sun.star.filter.config.tools.merge;
+
+//_______________________________________________
+
+import java.io.*;
+import com.sun.star.filter.config.tools.utils.*;
+
+//_______________________________________________
+
+/** can merge different xml fragments together.
+ *
+ *
+ */
+public class Merger
+{
+    //___________________________________________
+    // const
+
+    private static final java.lang.String PROP_XMLVERSION      = "xmlversion"               ; // <= global cfg file
+    private static final java.lang.String PROP_XMLENCODING     = "xmlencoding"              ; // <= global cfg file
+    private static final java.lang.String PROP_XMLPATH         = "xmlpath"                  ; // <= global cfg file
+    private static final java.lang.String PROP_XMLPACKAGE      = "xmlpackage"               ; // <= global cfg file
+
+    private static final java.lang.String PROP_SETNAME_TYPES    = "setname_types"           ; // <= global cfg file
+    private static final java.lang.String PROP_SETNAME_FILTERS  = "setname_filters"         ; // <= global cfg file
+    private static final java.lang.String PROP_SETNAME_LOADERS  = "setname_frameloaders"    ; // <= global cfg file
+    private static final java.lang.String PROP_SETNAME_HANDLERS = "setname_contenthandlers" ; // <= global cfg file
+
+    private static final java.lang.String PROP_SUBDIR_TYPES    = "subdir_types"             ; // <= global cfg file
+    private static final java.lang.String PROP_SUBDIR_FILTERS  = "subdir_filters"           ; // <= global cfg file
+    private static final java.lang.String PROP_SUBDIR_LOADERS  = "subdir_frameloaders"      ; // <= global cfg file
+    private static final java.lang.String PROP_SUBDIR_HANDLERS = "subdir_contenthandlers"   ; // <= global cfg file
+
+    private static final java.lang.String PROP_EXTENSION_XCU   = "extension_xcu"            ; // <= global cfg file
+    private static final java.lang.String PROP_EXTENSION_PKG   = "extension_pkg"            ; // <= global cfg file
+
+    private static final java.lang.String PROP_DELIMITER       = "delimiter"                ; // <= global cfg file
+    private static final java.lang.String PROP_TRIM            = "trim"                     ; // <= global cfg file
+    private static final java.lang.String PROP_DECODE          = "decode"                   ; // <= global cfg file
+
+    private static final java.lang.String PROP_FRAGMENTSDIR    = "fragmentsdir"             ; // <= cmdline
+    private static final java.lang.String PROP_TEMPDIR         = "tempdir"                  ; // <= cmdline
+    private static final java.lang.String PROP_OUTDIR          = "outdir"                   ; // <= cmdline
+    private static final java.lang.String PROP_PKG             = "pkg"                      ; // <= cmdline
+    private static final java.lang.String PROP_DEBUG           = "debug"                    ; // <= cmdline
+
+    private static final java.lang.String PROP_TCFG            = "tcfg"                     ; // <= cmdline
+    private static final java.lang.String PROP_FCFG            = "fcfg"                     ; // <= cmdline
+    private static final java.lang.String PROP_LCFG            = "lcfg"                     ; // <= cmdline
+    private static final java.lang.String PROP_CCFG            = "ccfg"                     ; // <= cmdline
+    private static final java.lang.String PROP_LANGUAGEPACK    = "languagepack"             ; // <= cmdline
+
+    private static final java.lang.String PROP_ITEMS           = "items"                    ; // <= pkg cfg files!
+    
+    //___________________________________________
+    // member
+
+    //-------------------------------------------
+    /** TODO */
+    private ConfigHelper m_aCfg;
+
+    //-------------------------------------------
+    /** TODO */
+    private Logger m_aLog;
+
+    //-------------------------------------------
+    /** TODO */
+    private java.io.File m_aFragmentsDir;
+
+    //-------------------------------------------
+    /** TODO */
+    private java.io.File m_aTempDir;
+
+    //-------------------------------------------
+    /** TODO */
+    private java.io.File m_aOutDir;
+
+    //-------------------------------------------
+    /** TODO */
+    private java.util.Vector m_lTypes;
+    private java.util.Vector m_lFilters;
+    private java.util.Vector m_lLoaders;
+    private java.util.Vector m_lHandlers;
+    
+    //___________________________________________
+    // interface
+
+    //-------------------------------------------
+    /** initialize a new instance of this class and
+     *  try to get all needed resources from the config module.
+     *
+     *  @param  aCfg
+     *          provides access to all values of the global
+     *          config file and to the command line.
+     *
+     *  @param  aLog
+     *          can be used to print out log informations.
+     */
+    public Merger(ConfigHelper aCfg,
+                  Logger       aLog)
+        throws java.lang.Exception
+    {
+        m_aCfg = aCfg;
+        m_aLog = aLog;
+
+        m_aFragmentsDir = new java.io.File(m_aCfg.getString(PROP_FRAGMENTSDIR));
+        m_aTempDir      = new java.io.File(m_aCfg.getString(PROP_TEMPDIR     ));
+//        m_aOutDir       = new java.io.File(m_aCfg.getString(PROP_OUTDIR      ));
+
+        java.lang.String sDelimiter = m_aCfg.getString(PROP_DELIMITER);
+        boolean          bTrim      = m_aCfg.getBoolean(PROP_TRIM);
+        boolean          bDecode    = m_aCfg.getBoolean(PROP_DECODE);
+
+        try
+        {
+            ConfigHelper aFcfg = new ConfigHelper(m_aCfg.getString(PROP_TCFG), null);
+            m_lTypes = aFcfg.getStringList(PROP_ITEMS, sDelimiter, bTrim, bDecode);
+        }
+        catch(java.util.NoSuchElementException ex1)
+        {
+            m_lTypes = new java.util.Vector();
+            //m_aLog.setWarning("Fragment list of types is missing. Parameter \"items\" seems to be invalid.");
+        }
+        
+        try
+        {
+            ConfigHelper aFcfg = new ConfigHelper(m_aCfg.getString(PROP_FCFG), null);
+            m_lFilters = aFcfg.getStringList(PROP_ITEMS, sDelimiter, bTrim, bDecode);
+        }
+        catch(java.util.NoSuchElementException ex1)
+        {
+            m_lFilters = new java.util.Vector();
+            //m_aLog.setWarning("Fragment list of filters is missing. Parameter \"items\" seems to be invalid.");
+        }
+
+        try
+        {
+            ConfigHelper aFcfg = new ConfigHelper(m_aCfg.getString(PROP_LCFG), null);
+            m_lLoaders = aFcfg.getStringList(PROP_ITEMS, sDelimiter, bTrim, bDecode);
+        }
+        catch(java.util.NoSuchElementException ex1)
+        {
+            m_lLoaders = new java.util.Vector();
+            //m_aLog.setWarning("Fragment list of frame loader objects is missing. Parameter \"items\" seems to be invalid.");
+        }
+
+        try
+        {
+            ConfigHelper aFcfg = new ConfigHelper(m_aCfg.getString(PROP_CCFG), null);
+            m_lHandlers = aFcfg.getStringList(PROP_ITEMS, sDelimiter, bTrim, bDecode);
+        }
+        catch(java.util.NoSuchElementException ex1)
+        {
+            m_lHandlers = new java.util.Vector();
+            //m_aLog.setWarning("Fragment list of content handler objects is missing. Parameter \"items\" seems to be invalid.");
+        }
+    }
+
+    //-------------------------------------------
+    /** TODO */
+    public synchronized void merge()
+        throws java.lang.Exception
+    {
+        java.lang.StringBuffer sBuffer  = new java.lang.StringBuffer(1000000);
+        java.lang.String       sPackage = m_aCfg.getString(PROP_PKG);
+
+        m_aLog.setGlobalInfo("create package \""+sPackage+"\" ...");
+        m_aLog.setDetailedInfo("generate package header ... ");
+
+        sBuffer.append(
+            XMLHelper.generateHeader(
+                m_aCfg.getString (PROP_XMLVERSION         ),
+                m_aCfg.getString (PROP_XMLENCODING        ),
+                m_aCfg.getString (PROP_XMLPATH            ),
+                m_aCfg.getString (PROP_XMLPACKAGE         ),
+                m_aCfg.getBoolean(PROP_LANGUAGEPACK, false)));
+
+        // counts all transfered fragments
+        // Can be used later to decide, if a generated package file
+        // contains "nothing"!
+        int nItemCount = 0;
+
+        for (int i=0; i<4; ++i)
+        {
+            java.lang.String sSetName   = null;
+            java.lang.String sSubDir    = null;
+            java.util.Vector lFragments = null;
+
+            try
+            {
+                switch(i)
+                {
+                    case 0: // types
+                    {
+                        m_aLog.setDetailedInfo("generate set for types ... ");
+                        sSetName   = m_aCfg.getString(PROP_SETNAME_TYPES);
+                        sSubDir    = m_aCfg.getString(PROP_SUBDIR_TYPES );
+                        lFragments = m_lTypes;
+                    }
+                    break;
+
+                    case 1: // filters
+                    {
+                        m_aLog.setDetailedInfo("generate set for filter ... ");
+                        sSetName   = m_aCfg.getString(PROP_SETNAME_FILTERS);
+                        sSubDir    = m_aCfg.getString(PROP_SUBDIR_FILTERS );
+                        lFragments = m_lFilters;
+                    }
+                    break;
+
+                    case 2: // loaders
+                    {
+                        m_aLog.setDetailedInfo("generate set for frame loader ... ");
+                        sSetName   = m_aCfg.getString(PROP_SETNAME_LOADERS);
+                        sSubDir    = m_aCfg.getString(PROP_SUBDIR_LOADERS );
+                        lFragments = m_lLoaders;
+                    }
+                    break;
+
+                    case 3: // handlers
+                    {
+                        m_aLog.setDetailedInfo("generate set for content handler ... ");
+                        sSetName   = m_aCfg.getString(PROP_SETNAME_HANDLERS);
+                        sSubDir    = m_aCfg.getString(PROP_SUBDIR_HANDLERS );
+                        lFragments = m_lHandlers;
+                    }
+                    break;
+                }
+
+                nItemCount += lFragments.size();
+
+                getFragments(
+                    new java.io.File(m_aFragmentsDir, sSubDir),
+                    sSetName,
+                    lFragments,
+                    1,
+                    sBuffer);
+            }
+            catch(java.util.NoSuchElementException exIgnore)
+                { continue; }
+        }
+
+        m_aLog.setDetailedInfo("generate package footer ... ");
+        sBuffer.append(XMLHelper.generateFooter());
+
+        // Attention!
+        // If the package seem to be empty, it make no sense to generate a corresponding
+        // xml file. We should suppress writing of this file on disk completly ...
+        if (nItemCount < 1)
+        {
+            m_aLog.setWarning("Package is empty and will not result into a xml file on disk!? Please check configuration file.");
+            return;
+        }
+        m_aLog.setGlobalInfo("package contains "+nItemCount+" items");
+
+        java.io.File aPackage = new File(sPackage);
+        m_aLog.setGlobalInfo("write temp package \""+aPackage.getPath()); // TODO encoding must be readed from the configuration
+        FileHelper.writeEncodedBufferToFile(aPackage, "UTF-8", false, sBuffer); // check for success is done inside this method!
+    }
+
+    //-------------------------------------------
+    /** TODO */
+    private void getFragments(java.io.File           aDir       ,
+                              java.lang.String       sSetName   ,
+                              java.util.Vector       lFragments ,
+                              int                    nPrettyTabs,
+                              java.lang.StringBuffer sBuffer    )
+        throws java.lang.Exception
+    {
+        if (lFragments.size()<1)
+        {
+            m_aLog.setWarning("List of fragments is empty!? Will be ignored ...");
+            return;
+        }
+        
+        java.util.Enumeration  pFragments = lFragments.elements();
+        java.lang.String       sExtXcu    = m_aCfg.getString(PROP_EXTENSION_XCU);
+        
+        for (int tabs=0; tabs<nPrettyTabs; ++tabs)
+            sBuffer.append("\t");
+        sBuffer.append("<node oor:name=\""+sSetName+"\">\n");
+        ++nPrettyTabs;
+
+        // special mode for generating language packs.
+        // In such case we must live with some missing fragment files.
+        // Reason behind; Not all filters are realy localized.
+        // But we dont use a different fragment list. We try to locate
+        // any fragment file in its language-pack version ...
+        boolean bHandleLanguagePacks = m_aCfg.getBoolean(PROP_LANGUAGEPACK, false);
+        boolean bDebug               = m_aCfg.getBoolean(PROP_DEBUG       , false);
+        java.lang.String sEncoding   = "UTF-8";
+        if (bDebug)
+            sEncoding = "UTF-8Special";
+        
+        while(pFragments.hasMoreElements())
+        {
+            java.lang.String sFragment = (java.lang.String)pFragments.nextElement();
+            java.io.File     aFragment = new java.io.File(aDir, sFragment+"."+sExtXcu);
+
+            // handle simple files only and check for existence!
+            if (!aFragment.exists())
+            {
+                if (bHandleLanguagePacks)
+                {
+                    m_aLog.setWarning("language fragment \""+aFragment.getPath()+"\" does not exist. Will be ignored.");
+                    continue;
+                }
+                else
+                    throw new java.io.IOException("fragment \""+aFragment.getPath()+"\" does not exists.");
+            }
+
+            if (!aFragment.isFile())
+            {
+                m_aLog.setWarning("fragment \""+aFragment.getPath()+"\" seem to be not a valid file.");
+                continue;
+            }
+
+            // copy file content of original fragment
+            // Note: A FileNotFoundException will be thrown automaticly by the
+            // used reader objects. Let it break this method too. Our calli is interested
+            // on such errors :-)
+            m_aLog.setDetailedInfo("merge fragment \""+aFragment.getPath()+"\" ...");
+            FileHelper.readEncodedBufferFromFile(aFragment, sEncoding, sBuffer);
+            
+            sBuffer.append("\n");
+        }
+
+        --nPrettyTabs;
+        for (int tabs=0; tabs<nPrettyTabs; ++tabs)
+            sBuffer.append("\t");
+        sBuffer.append("</node>\n");
+    }
+}
diff --git filter/source/config/tools/merge/makefile.mk filter/source/config/tools/merge/makefile.mk
new file mode 100644
index 0000000..7bc2de9
--- /dev/null
+++ filter/source/config/tools/merge/makefile.mk
@@ -0,0 +1,95 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile.mk,v $
+#
+# $Revision: 1.9.102.1 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+PRJ     = ..$/..$/..$/..
+TARGET  = FCFGMerge
+PRJNAME = filter
+PACKAGE = com$/sun$/star$/filter$/config$/tools$/merge
+
+# --- Settings -----------------------------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+.INCLUDE: settings.mk
+
+#----- compile .java files -----------------------------------------
+
+OWNCOPY         =   \
+                    $(MISC)$/$(TARGET)_copied.done
+
+JARFILES        =   \
+                    ridl.jar        \
+                    unoil.jar       \
+                    jurt.jar        \
+                    juh.jar         \
+                    java_uno.jar
+
+CFGFILES        =   \
+                    FCFGMerge.cfg
+
+JAVACLASSFILES  =   \
+                    $(CLASSDIR)$/$(PACKAGE)$/Merger.class     \
+                    $(CLASSDIR)$/$(PACKAGE)$/FCFGMerge.class
+
+CUSTOMMANIFESTFILE     =   \
+                    Manifest.mf
+
+MAXLINELENGTH   =   100000
+
+#----- make a jar from compiled files ------------------------------
+
+JARCLASSDIRS    =   \
+                    com$/sun$/star$/filter$/config$/tools$/utils    \
+                    com$/sun$/star$/filter$/config$/tools$/merge
+
+JARTARGET       =   $(TARGET).jar
+
+JARCOMPRESS     =   TRUE
+
+# --- targets -----------------------------------------------------
+
+.INCLUDE :  target.mk
+
+.IF "$(SOLAR_JAVA)" != "" || "$(GUI)"=="OS2"
+ALLTAR : $(OWNCOPY)
+
+.IF "$(JARTARGETN)" != ""
+$(JARTARGETN) : $(OWNCOPY)
+.ENDIF
+
+$(OWNCOPY) : $(CFGFILES)
+    -$(MKDIR) $(CLASSDIR)$/$(PACKAGE)
+    $(COPY) $? $(CLASSDIR)$/$(PACKAGE) && $(TOUCH) $@
+
+.ENDIF # "$(SOLAR_JAVA)" != ""
\ No newline at end of file
diff --git filter/source/config/tools/utils/AnalyzeStartupLog.java filter/source/config/tools/utils/AnalyzeStartupLog.java
new file mode 100644
index 0000000..97583d7
--- /dev/null
+++ filter/source/config/tools/utils/AnalyzeStartupLog.java
@@ -0,0 +1,324 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: AnalyzeStartupLog.java,v $
+ * $Revision: 1.4 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+package com.sun.star.filter.config.tools.utils;
+
+
+//_______________________________________________
+// implementation
+public class AnalyzeStartupLog
+{
+    private class OperationTime
+    {
+        /** name the measured operation. */
+        public java.lang.String sOperation;
+
+        /** contains the time value, when this operation was started. */
+        public long nStartTime;
+
+        /** contains the time value, when this operation was finished. */
+        public long nEndTime;
+
+        /** text inside log file, which identifies the start time value. */
+        public java.lang.String sStartMsg;
+
+        /** text inside log file, which identifies the end time value. */
+        public java.lang.String sEndMsg;
+    }
+
+    //_________________________________
+    // main
+
+    public static void main(java.lang.String[] lCmdLine)
+    {
+        int nExit = 0;
+        try
+        {
+            // analyze command line
+            ConfigHelper aCmdLine  = new ConfigHelper("", lCmdLine);
+            java.lang.String        sLogDir   = aCmdLine.getString("logdir"  );
+            java.lang.String        sDataFile = aCmdLine.getString("datafile");
+
+            if (sLogDir == null || sDataFile == null)
+            {
+                System.err.println("AnalyzeStartupLog lodir=<dir> datafile=<file>");
+                System.err.println("E.g.: AnalyzeStartupLog lodir=c:\\temp\\logs datafile=c:\\temp\\data.csv");
+                System.exit(--nExit);
+            }
+
+            // get list of all log files
+            boolean bRecursive = true;
+            java.util.Vector lLogs = FileHelper.getSystemFilesFromDir(new java.io.File(sLogDir), bRecursive);
+            if (lLogs == null || lLogs.isEmpty())
+            {
+                System.err.println("log dir is empty");
+                System.exit(--nExit);
+            }
+
+            // analyze it
+            java.lang.StringBuffer sOut = new java.lang.StringBuffer(1000);
+            sOut.append("log;t_cfg_start;t_cfg_end;t_fwk_start;t_fwk_end;t_sfx_start;t_sfx_end;t_types_start;t_types_end;t_filters_start;t_filters_end;");
+            sOut.append("t_filters_swriter_start;t_filters_swriter_end;t_filters_sweb_start;t_filters_sweb_end;t_filters_sglobal_start;t_filters_sglobal_end;t_filters_scalc_start;t_filters_scalc_end;t_filters_sdraw_start;t_filters_sdraw_end;t_filters_simpress_start;t_filters_simpress_end;t_filters_schart_start;t_filters_schart_end;t_filters_smath_start;t_filters_smath_end;");
+            sOut.append("t_others_start;t_others_end;d_cfg;d_fwk;d_sfx;d_types;d_filters;d_others;d_complete\n");
+
+            java.util.Enumeration aIt = lLogs.elements();
+            while (aIt.hasMoreElements())
+            {
+                java.io.File           aLog    = (java.io.File)aIt.nextElement();
+                java.io.FileReader     aReader = new java.io.FileReader(aLog);
+                java.io.BufferedReader aBuffer = new java.io.BufferedReader(aReader);
+
+                long t_cfg_start                = 0;
+                long t_cfg_end                  = 0;
+
+                long t_fwk_start                = 0;
+                long t_fwk_end                  = 0;
+
+                long t_sfx_start                = 0;
+                long t_sfx_end                  = 0;
+
+                long t_types_start              = 0;
+                long t_types_end                = 0;
+
+                long t_filters_start            = 0;
+                long t_filters_end              = 0;
+
+                long t_filters_swriter_start    = 0;
+                long t_filters_swriter_end      = 0;
+
+                long t_filters_sweb_start       = 0;
+                long t_filters_sweb_end         = 0;
+
+                long t_filters_sglobal_start    = 0;
+                long t_filters_sglobal_end      = 0;
+
+                long t_filters_scalc_start      = 0;
+                long t_filters_scalc_end        = 0;
+
+                long t_filters_sdraw_start      = 0;
+                long t_filters_sdraw_end        = 0;
+
+                long t_filters_simpress_start   = 0;
+                long t_filters_simpress_end     = 0;
+
+                long t_filters_schart_start     = 0;
+                long t_filters_schart_end       = 0;
+
+                long t_filters_smath_start      = 0;
+                long t_filters_smath_end        = 0;
+
+                long t_others_start             = 0;
+                long t_others_end               = 0;
+
+                while (true)
+                {
+                    java.lang.String sLine = aBuffer.readLine();
+                    if (sLine == null)
+                        break;
+
+                    if (sLine.endsWith("| framework (as96863) ::FilterCache::FilterCache : { creation ConfigItem [file=standard, version=6, mode=3]"))
+                        t_cfg_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("| framework (as96863) ::FilterCache::FilterCache : } creation ConfigItem"))
+                        t_cfg_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("| framework (as96863) ::FilterCache::FilterCache : { reading TypeDetection.xml"))
+                        t_fwk_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("| framework (as96863) ::FilterCache::FilterCache : } reading TypeDetection.xml"))
+                        t_fwk_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ framework (as96863) ::FilterCFGAccess::impl_loadTypes"))
+                        t_types_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} framework (as96863) ::FilterCFGAccess::impl_loadTypes"))
+                        t_types_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ framework (as96863) ::FilterCFGAccess::impl_loadFilters"))
+                        t_filters_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} framework (as96863) ::FilterCFGAccess::impl_loadFilters"))
+                        t_filters_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [swriter]"))
+                        t_filters_swriter_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [swriter]"))
+                        t_filters_swriter_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [sweb]"))
+                        t_filters_sweb_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [sweb]"))
+                        t_filters_sweb_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [sglobal]"))
+                        t_filters_sglobal_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [sglobal]"))
+                        t_filters_sglobal_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [scalc]"))
+                        t_filters_scalc_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [scalc]"))
+                        t_filters_scalc_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [sdraw]"))
+                        t_filters_sdraw_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [sdraw]"))
+                        t_filters_sdraw_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [simpress]"))
+                        t_filters_simpress_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [simpress]"))
+                        t_filters_simpress_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [schart]"))
+                        t_filters_schart_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [schart]"))
+                        t_filters_schart_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ reading FilterGroup [smath]"))
+                        t_filters_smath_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} reading FilterGroup [smath]"))
+                        t_filters_smath_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("{ framework (as96863) ::FilterCFGAccess::impl_loadDetectors"))
+                        t_others_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} framework (as96863) ::FilterCFGAccess::impl_loadContentHandlers"))
+                        t_others_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} framework (as96863) ::FilterCache::FilterCache"))
+                        t_sfx_start = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                    else
+                    if (sLine.endsWith("} desktop (lo119109) OfficeWrapper::OfficeWrapper"))
+                        t_sfx_end = new java.lang.Long(sLine.substring(0, 6)).longValue();
+                }
+
+                sOut.append(aLog.getName()               );
+                sOut.append(";"                          );
+                sOut.append(t_cfg_start                  );
+                sOut.append(";"                          );
+                sOut.append(t_cfg_end                    );
+                sOut.append(";"                          );
+                sOut.append(t_fwk_start                  );
+                sOut.append(";"                          );
+                sOut.append(t_fwk_end                    );
+                sOut.append(";"                          );
+                sOut.append(t_sfx_start                  );
+                sOut.append(";"                          );
+                sOut.append(t_sfx_end                    );
+                sOut.append(";"                          );
+                sOut.append(t_types_start                );
+                sOut.append(";"                          );
+                sOut.append(t_types_end                  );
+                sOut.append(";"                          );
+                sOut.append(t_filters_start              );
+                sOut.append(";"                          );
+                sOut.append(t_filters_end                );
+                sOut.append(";"                          );
+
+                sOut.append(t_filters_swriter_start      );
+                sOut.append(";"                          );
+                sOut.append(t_filters_swriter_end        );
+                sOut.append(";"                          );
+                sOut.append(t_filters_sweb_start         );
+                sOut.append(";"                          );
+                sOut.append(t_filters_sweb_end           );
+                sOut.append(";"                          );
+                sOut.append(t_filters_sglobal_start      );
+                sOut.append(";"                          );
+                sOut.append(t_filters_sglobal_end        );
+                sOut.append(";"                          );
+                sOut.append(t_filters_scalc_start        );
+                sOut.append(";"                          );
+                sOut.append(t_filters_scalc_end          );
+                sOut.append(";"                          );
+                sOut.append(t_filters_sdraw_start        );
+                sOut.append(";"                          );
+                sOut.append(t_filters_sdraw_end          );
+                sOut.append(";"                          );
+                sOut.append(t_filters_simpress_start     );
+                sOut.append(";"                          );
+                sOut.append(t_filters_simpress_end       );
+                sOut.append(";"                          );
+                sOut.append(t_filters_schart_start       );
+                sOut.append(";"                          );
+                sOut.append(t_filters_schart_end         );
+                sOut.append(";"                          );
+                sOut.append(t_filters_smath_start        );
+                sOut.append(";"                          );
+                sOut.append(t_filters_smath_end          );
+                sOut.append(";"                          );
+
+                sOut.append(t_others_start               );
+                sOut.append(";"                          );
+                sOut.append(t_others_end                 );
+                sOut.append(";"                          );
+                sOut.append(t_cfg_end    -t_cfg_start    );
+                sOut.append(";"                          );
+                sOut.append(t_fwk_end    -t_fwk_start    );
+                sOut.append(";"                          );
+                sOut.append(t_sfx_end    -t_sfx_start    );
+                sOut.append(";"                          );
+                sOut.append(t_types_end  -t_types_start  );
+                sOut.append(";"                          );
+                sOut.append(t_filters_end-t_filters_start);
+                sOut.append(";"                          );
+                sOut.append(t_others_end -t_others_start );
+                sOut.append(";"                          );
+                sOut.append(t_others_end -t_cfg_start    );
+                sOut.append("\n"                         );
+
+                aBuffer.close();
+            }
+
+            java.io.FileWriter aCSV  = new java.io.FileWriter(sDataFile);
+            java.lang.String   sData = sOut.toString();
+            aCSV.write(sData, 0, sData.length());
+            aCSV.flush();
+            aCSV.close();
+        }
+        catch(java.lang.Throwable exAny)
+        {
+            System.err.println(exAny.getMessage());
+            exAny.printStackTrace();
+            System.exit(--nExit);
+        }
+
+        System.exit(0);
+    }
+}
diff --git filter/source/config/tools/utils/Cache.java filter/source/config/tools/utils/Cache.java
new file mode 100644
index 0000000..ab0723c
--- /dev/null
+++ filter/source/config/tools/utils/Cache.java
@@ -0,0 +1,2444 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: Cache.java,v $
+ * $Revision: 1.7 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+package com.sun.star.filter.config.tools.utils;
+
+
+//_______________________________________________
+
+/**
+ *  It implements a container for all possible entries which are part of the type
+ *  and filter mechanism of an office - means all items of the configuration file
+ *  "TypeDetection". How these entries will be readed or written can be switch
+ *  in different modes. That would make it possible to edit an xml directly or
+ *  to contact a running office instance.
+ *
+ *
+ */
+public class Cache
+{
+    //___________________________________________
+    // public const
+
+    /** identifies a file type item of this cache. */
+    public static final int E_TYPE = 0;
+
+    /** identifies a filter item of this cache. */
+    public static final int E_FILTER = 1;
+
+    /** identifies a detect service item of this cache. */
+    public static final int E_DETECTSERVICE = 2;
+
+    /** identifies a frame loader item of this cache. */
+    public static final int E_FRAMELOADER = 3;
+
+    /** identifies a content handler item of this cache. */
+    public static final int E_CONTENTHANDLER = 4;
+
+    /** indicates an unsupported xml format => error! */
+    public static final int FORMAT_UNSUPPORTED = -1;
+
+    /** identify the configuration format of an office 6.0.
+     *  The own formated data string is used. */
+    public static final int FORMAT_60 = 0;
+
+    /** identify the configuration format of an office 6.y.
+     *  Properties are realy xml tags again. */
+    public static final int FORMAT_6Y = 1;
+
+    /** identify the configuration format which is used inside
+     *  this tooling project. */
+    public static final int FORMAT_INTERNAL = 2;
+
+    /** right value for a command line parameter to define a 6.0 version. */
+    public static final java.lang.String CMDVAL_FORMAT_60 = "6.0";
+
+    /** right value for a command line parameter to define a 6.Y version. */
+    public static final java.lang.String CMDVAL_FORMAT_6Y = "6.Y";
+
+    /** right value for a command line parameter to define an internal xml version! */
+    public static final java.lang.String CMDVAL_FORMAT_INTERNAL = "internal";
+
+    // general
+    public static final java.lang.String PROPNAME_DATA = "Data";
+    public static final java.lang.String PROPNAME_NAME = "Name";
+    public static final java.lang.String PROPNAME_UINAME = "UIName";
+    public static final java.lang.String PROPNAME_UINAMES = "UINames";
+
+    // type 6.0 ...
+    public static final java.lang.String PROPNAME_MEDIATYPE = "MediaType";
+    public static final java.lang.String PROPNAME_PREFERRED = "Preferred";
+    public static final java.lang.String PROPNAME_CLIPBOARDFORMAT = "ClipboardFormat";
+    public static final java.lang.String PROPNAME_DOCUMENTICONID = "DocumentIconID";
+    public static final java.lang.String PROPNAME_URLPATTERN = "URLPattern";
+    public static final java.lang.String PROPNAME_EXTENSIONS = "Extensions";
+    // ... +6.y
+    public static final java.lang.String PROPNAME_UIORDER = "UIOrder";
+    public static final java.lang.String PROPNAME_PREFERREDFILTER = "PreferredFilter";
+    public static final java.lang.String PROPNAME_DETECTSERVICE = "DetectService";
+    public static final java.lang.String PROPNAME_FRAMELOADER = "FrameLoader";
+    public static final java.lang.String PROPNAME_CONTENTHANDLER = "ContentHandler";
+
+    // filter
+    public static final java.lang.String PROPNAME_DOCUMENTSERVICE = "DocumentService";
+    public static final java.lang.String PROPNAME_FILEFORMATVERSION = "FileFormatVersion";
+    public static final java.lang.String PROPNAME_FILTERSERVICE = "FilterService";
+    public static final java.lang.String PROPNAME_FLAGS = "Flags";
+    public static final java.lang.String PROPNAME_ORDER = "Order"; // -6.y
+    public static final java.lang.String PROPNAME_TEMPLATENAME = "TemplateName";
+    public static final java.lang.String PROPNAME_TYPE = "Type";
+    public static final java.lang.String PROPNAME_UICOMPONENT = "UIComponent";
+    public static final java.lang.String PROPNAME_USERDATA = "UserData";
+
+    // frame loader / detect services / content handler
+    public static final java.lang.String PROPNAME_TYPES = "Types";
+
+    //___________________________________________
+    // private const
+
+    private static final java.lang.String FILTERSERVICE_NATIVEWARPPER = "com.sun.star.filter.NativeFilterWrapper";
+    private static final java.lang.String GENERIC_DETECTSERVICE = "com.sun.star.comp.office.FrameLoader";
+
+    /** its the name of the cfg set, which contains all types. */
+    private static final java.lang.String CFGNODE_TYPES = "Types";
+
+    /** its the name of the cfg set, which contains all filters. */
+    private static final java.lang.String CFGNODE_FILTERS = "Filters";
+
+    /** its the name of the cfg set, which contains all detect services. */
+    private static final java.lang.String CFGNODE_DETECTSERVICES = "DetectServices";
+
+    /** its the name of the cfg set, which contains all frame loaders. */
+    private static final java.lang.String CFGNODE_FRAMELOADERS = "FrameLoaders";
+
+    /** its the name of the cfg set, which contains all content handlers. */
+    private static final java.lang.String CFGNODE_CONTENTHANDLERS = "ContentHandlers";
+
+    // names for filter flags
+    private static final java.lang.String FLAGNAME_3RDPARTYFILTER   = "3RDPARTYFILTER";
+    private static final java.lang.String FLAGNAME_ALIEN            = "ALIEN";
+    private static final java.lang.String FLAGNAME_ASYNCHRON        = "ASYNCHRON";
+    private static final java.lang.String FLAGNAME_BROWSERPREFERRED = "BROWSERPREFERRED";
+    private static final java.lang.String FLAGNAME_CONSULTSERVICE   = "CONSULTSERVICE";
+    private static final java.lang.String FLAGNAME_DEFAULT          = "DEFAULT";
+    private static final java.lang.String FLAGNAME_EXPORT           = "EXPORT";
+    private static final java.lang.String FLAGNAME_IMPORT           = "IMPORT";
+    private static final java.lang.String FLAGNAME_INTERNAL         = "INTERNAL";
+    private static final java.lang.String FLAGNAME_NOTINCHOOSER     = "NOTINCHOOSER";
+    private static final java.lang.String FLAGNAME_NOTINFILEDIALOG  = "NOTINFILEDIALOG";
+    private static final java.lang.String FLAGNAME_NOTINSTALLED     = "NOTINSTALLED";
+    private static final java.lang.String FLAGNAME_OWN              = "OWN";
+    private static final java.lang.String FLAGNAME_PACKED           = "PACKED";
+    private static final java.lang.String FLAGNAME_PREFERRED        = "PREFERRED";
+    private static final java.lang.String FLAGNAME_READONLY         = "READONLY";
+    private static final java.lang.String FLAGNAME_SILENTEXPORT     = "SILENTEXPORT";
+    private static final java.lang.String FLAGNAME_TEMPLATE         = "TEMPLATE";
+    private static final java.lang.String FLAGNAME_TEMPLATEPATH     = "TEMPLATEPATH";
+    private static final java.lang.String FLAGNAME_USESOPTIONS      = "USESOPTIONS";
+
+    private static final java.lang.String FLAGNAME_COMBINED         = "COMBINED";
+    private static final java.lang.String FLAGNAME_SUPPORTSSELECTION= "SUPPORTSSELECTION";
+
+    // values for filter flags
+    private static final int FLAGVAL_3RDPARTYFILTER    = 0x00080000; // 524288
+    private static final int FLAGVAL_ALIEN             = 0x00000040; // 64
+    private static final int FLAGVAL_ALL               = 0xffffffff; // 4294967295
+    private static final int FLAGVAL_ASYNCHRON         = 0x00004000; // 16384
+    private static final int FLAGVAL_BROWSERPREFERRED  = 0x00400000; // 4194304
+    private static final int FLAGVAL_CONSULTSERVICE    = 0x00040000; // 262144
+    private static final int FLAGVAL_DEFAULT           = 0x00000100; // 256
+    private static final int FLAGVAL_EXPORT            = 0x00000002; // 2
+    private static final int FLAGVAL_IMPORT            = 0x00000001; // 1
+    private static final int FLAGVAL_INTERNAL          = 0x00000008; // 8
+    private static final int FLAGVAL_NOTINCHOOSER      = 0x00002000; // 8192
+    private static final int FLAGVAL_NOTINFILEDIALOG   = 0x00001000; // 4096
+    private static final int FLAGVAL_NOTINSTALLED      = 0x00020000; // 131072
+    private static final int FLAGVAL_OWN               = 0x00000020; // 32
+    private static final int FLAGVAL_PACKED            = 0x00100000; // 1048576
+    private static final int FLAGVAL_PREFERRED         = 0x10000000; // 268435456
+    private static final int FLAGVAL_READONLY          = 0x00010000; // 65536
+    private static final int FLAGVAL_SILENTEXPORT      = 0x00200000; // 2097152
+    private static final int FLAGVAL_TEMPLATE          = 0x00000004; // 4
+    private static final int FLAGVAL_TEMPLATEPATH      = 0x00000010; // 16
+    private static final int FLAGVAL_USESOPTIONS       = 0x00000080; // 128
+
+    private static final int FLAGVAL_COMBINED          = 0x00800000; // ...
+    private static final int FLAGVAL_SUPPORTSSELECTION = 0x00000400; // 1024
+
+    //___________________________________________
+    // member
+
+    /** list of all located types.
+     *  Format: [string,HashMap]
+     */
+    private java.util.HashMap m_lTypes;
+
+    /** list of all located filters.
+     *  Format: [string,HashMap]
+     */
+    private java.util.HashMap m_lFilters;
+
+    /** list of all located detect services.
+     *  Format: [string,HashMap]
+     */
+    private java.util.HashMap m_lDetectServices;
+
+    /** list of all located frame loader.
+     *  Format: [string,HashMap]
+     */
+    private java.util.HashMap m_lFrameLoaders;
+
+    /** list of all located content handler.
+     *  Format: [string,HashMap]
+     */
+    private java.util.HashMap m_lContentHandlers;
+
+    /** contains all analyzed relations between
+     *  filters and types. The key is an internal
+     *  type name (can be used as reference into the
+     *  list m_lTypes) and the value is a Vector of all
+     *  internal filter names, which are registered for
+     *  this type.
+     *  Format: [string, Vector]
+     */
+    private java.util.HashMap m_lFilterToTypeRegistrations;
+
+    private int m_nDoubleRegisteredFilters;
+    private int m_nTypesForFilters;
+    private int m_nTypesForDetectServices;
+    private int m_nTypesForFrameLoaders;
+    private int m_nTypesForContentHandlers;
+
+    /** can be used to log different informations. */
+    private Logger m_aDebug;
+
+    //___________________________________________
+    // interface
+
+    /** standard ctor.
+     *
+     *  Initialize an empty cache instance. You have to use
+     *  on of the fromXXX() methods to fill it from different
+     *  sources with content.
+     */
+    public Cache(Logger aDebug)
+    {
+        reset();
+        m_aDebug = aDebug;
+    }
+
+    //___________________________________________
+
+    /** free memory and set default values on all members.
+     */
+    public synchronized void reset()
+    {
+        m_lTypes                     = new java.util.HashMap();
+        m_lFilters                   = new java.util.HashMap();
+        m_lFrameLoaders              = new java.util.HashMap();
+        m_lDetectServices            = new java.util.HashMap();
+        m_lContentHandlers           = new java.util.HashMap();
+        m_lFilterToTypeRegistrations = new java.util.HashMap();
+        m_aDebug                     = new Logger();
+        m_nDoubleRegisteredFilters   = 0;
+        m_nTypesForFilters           = 0;
+        m_nTypesForDetectServices    = 0;
+        m_nTypesForFrameLoaders      = 0;
+        m_nTypesForContentHandlers   = 0;
+    }
+
+    //___________________________________________
+
+    /** converts a string representation of an xml format
+     *  to its int value, which must be used at some interface
+     *  methods of this cache.
+     *
+     *  If the given string does not match to any well known format,
+     *  the return value will be FORMAT_UNSUPPORTED. The calli have to
+     *  check that. Otherwhise a called interface method at this cache
+     *  instance will be rejected by an exception!
+     *
+     *  @param  sFormat
+     *          the string representation
+     *          Must be one of our public const values from type CMDVAL_FORMAT_xxx.
+     *
+     *  @return [int]
+     *          the int representation.
+     *          Will be one of our public const values from type FORMAT_xxx.
+     */
+    public static int mapFormatString2Format(java.lang.String sFormat)
+    {
+        int nFormat = FORMAT_UNSUPPORTED;
+        if (sFormat.equalsIgnoreCase(CMDVAL_FORMAT_60))
+            nFormat = FORMAT_60;
+        else
+        if (sFormat.equalsIgnoreCase(CMDVAL_FORMAT_6Y))
+            nFormat = FORMAT_6Y;
+        else
+        if (sFormat.equalsIgnoreCase(CMDVAL_FORMAT_INTERNAL))
+            nFormat = FORMAT_INTERNAL;
+        return nFormat;
+    }
+
+    //___________________________________________
+
+    /** return some statistic values.
+     *
+     *  Such values can be: - count of container items,
+     *                      - ...
+     *
+     *  @return [java.lang.String]
+     *          a formated string, which contains al statistic data.
+     */
+    public synchronized java.lang.String getStatistics()
+    {
+        java.lang.StringBuffer sBuffer = new java.lang.StringBuffer(256);
+
+        sBuffer.append("types                          = "+m_lTypes.size()           +"\n");
+        sBuffer.append("filters                        = "+m_lFilters.size()         +"\n");
+        sBuffer.append("detect services                = "+m_lDetectServices.size()  +"\n");
+        sBuffer.append("frame loaders                  = "+m_lFrameLoaders.size()    +"\n");
+        sBuffer.append("content handler                = "+m_lContentHandlers.size() +"\n");
+        sBuffer.append("double registered filters      = "+m_nDoubleRegisteredFilters+"\n");
+        sBuffer.append("types used by filters          = "+m_nTypesForFilters        +"\n");
+        sBuffer.append("types used by detect services  = "+m_nTypesForDetectServices +"\n");
+        sBuffer.append("types used by frame loaders    = "+m_nTypesForFrameLoaders   +"\n");
+        sBuffer.append("types used by content handlers = "+m_nTypesForContentHandlers+"\n");
+
+        return sBuffer.toString();
+    }
+
+    //___________________________________________
+
+    /** reset this cache and fill it with new values using the given XML file.
+     *
+     *  @param  aXML
+     *          must be a system file of a suitable XML file, which
+     *          include all neccessary type/filter items.
+     *
+     *  @param  nFormat
+     *          identifies the format of the specified xml file,
+     *          which must be interpreted.
+     */
+    public synchronized void fromXML(java.io.File aXML   ,
+                                     int          nFormat)
+        throws java.lang.Exception
+    {
+        // clear this cache
+        reset();
+
+        // parse it
+        javax.xml.parsers.DocumentBuilderFactory aFactory = javax.xml.parsers.DocumentBuilderFactory.newInstance();
+        /* Attention:
+         *  This call is important. It force right handling of entities during parsing and(!)
+         *  writing. It let all possible signs for entities or it's quoted representations
+         *  untouched. So this class don't change the original signs of the original file.
+         *  Means:
+         *      <ul>
+         *          <li>(') => (')</li>
+         *          <li>(") => (")</li>
+         *          <li>(>) => (&gt;)</li>
+         *          <li>(<) => (&lt;)</li>
+         *          <li>(&gt;) => (&gt;)</li>
+         *          <li>(&amp;) => (&amp;)</li>
+         *          <li>...</li>
+         *      </ul>
+         */
+         
+        System.out.println("TODO: must be adapted to java 1.3 :-(");
+        System.exit(-1);
+//TODO_JAVA        aFactory.setExpandEntityReferences(false);
+
+        javax.xml.parsers.DocumentBuilder aBuilder = aFactory.newDocumentBuilder();
+        org.w3c.dom.Document              aDOM     = aBuilder.parse(aXML);
+        org.w3c.dom.Element               aRoot    = aDOM.getDocumentElement();
+
+        // step over all sets
+        java.util.Vector      lSetNodes = XMLHelper.extractChildNodesByTagName(aRoot, XMLHelper.XMLTAG_NODE);
+        java.util.Enumeration it1       = lSetNodes.elements();
+        while (it1.hasMoreElements())
+        {
+            // try to find out, which set should be read
+            org.w3c.dom.Node aSetNode = (org.w3c.dom.Node)it1.nextElement();
+            java.lang.String sSetName = XMLHelper.extractNodeAttribByName(aSetNode, XMLHelper.XMLATTRIB_OOR_NAME);
+            if (sSetName == null)
+                throw new java.io.IOException("unsupported format: could not extract set name on node ...\n"+aSetNode);
+
+            // map some generic interfaces to the right members!
+            int               eType = -1  ;
+            java.util.HashMap rMap  = null;
+
+            if (sSetName.equals(CFGNODE_TYPES))
+            {
+                eType = E_TYPE;
+                rMap  = m_lTypes;
+            }
+            else
+            if (sSetName.equals(CFGNODE_FILTERS))
+            {
+                eType = E_FILTER;
+                rMap  = m_lFilters;
+            }
+            else
+            if (sSetName.equals(CFGNODE_FRAMELOADERS))
+            {
+                eType = E_FRAMELOADER;
+                rMap  = m_lFrameLoaders;
+            }
+            else
+            if (sSetName.equals(CFGNODE_DETECTSERVICES))
+            {
+                eType = E_DETECTSERVICE;
+                rMap  = m_lDetectServices;
+            }
+            else
+            if (sSetName.equals(CFGNODE_CONTENTHANDLERS))
+            {
+                eType = E_CONTENTHANDLER;
+                rMap  = m_lContentHandlers;
+            }
+            else
+                throw new java.io.IOException("unsupported format: unknown set name [\""+sSetName+"\"] detected on node ...\n"+aSetNode);
+
+            // load all set entries
+            java.util.Vector      lChildNodes = XMLHelper.extractChildNodesByTagName(aSetNode, XMLHelper.XMLTAG_NODE);
+            java.util.Enumeration it2         = lChildNodes.elements();
+            while (it2.hasMoreElements())
+            {
+                org.w3c.dom.Node aChildNode = (org.w3c.dom.Node)it2.nextElement();
+                java.lang.String sChildName = XMLHelper.extractNodeAttribByName(aChildNode, XMLHelper.XMLATTRIB_OOR_NAME);
+                if (sChildName == null)
+                    throw new java.io.IOException("unsupported format: could not extract child node name on node ...\n"+aChildNode);
+                java.util.HashMap aPropSet = null;
+
+                // Note: Our internal format is different from the source format!
+                java.util.HashMap aTempSet = XMLHelper.convertNodeToPropSet(aChildNode);
+                switch(eType)
+                {
+                    case E_TYPE :
+                    {
+                        aPropSet = Cache.convertTypePropsToInternal(aTempSet, nFormat);
+                        m_aDebug.setDetailedInfo("type [\""+sChildName+"\"] converted to internal format");
+                    }
+                    break;
+
+                    case E_FILTER :
+                    {
+                        aPropSet = Cache.convertFilterPropsToInternal(aTempSet, nFormat);
+                        m_aDebug.setDetailedInfo("filter [\""+sChildName+"\"] converted to internal format");
+                    }
+                    break;
+
+                    case E_DETECTSERVICE :
+                    {
+                        aPropSet = Cache.convertDetectServicePropsToInternal(aTempSet, nFormat);
+                        m_aDebug.setDetailedInfo("detect service [\""+sChildName+"\"] converted to internal format");
+                    }
+                    break;
+
+                    case E_FRAMELOADER :
+                    {
+                        aPropSet = Cache.convertFrameLoaderPropsToInternal(aTempSet, nFormat);
+                        m_aDebug.setDetailedInfo("frame loader [\""+sChildName+"\"] converted to internal format");
+                    }
+                    break;
+
+                    case E_CONTENTHANDLER :
+                    {
+                        aPropSet = Cache.convertContentHandlerPropsToInternal(aTempSet, nFormat);
+                        m_aDebug.setDetailedInfo("content handler [\""+sChildName+"\"] converted to internal format");
+                    }
+                    break;
+                }
+                m_aDebug.setDetailedInfo("props = "+aTempSet);
+                rMap.put(sChildName, aPropSet);
+            }
+        }
+    }
+
+    //___________________________________________
+
+    /** create some hml views of the current content of this cache.
+     *
+     *  The given directory is used to create different html files
+     *  there. Every of them show another aspect of this cache.
+     *  E.g.: - all type/filter properties
+     *        - relation ships between types/filters/loaders etc.
+     *
+     *  @param  aDirectory
+     *          points to a system directory, which
+     *          can be used completely(!) to generate
+     *          the results there.
+     *
+     *  @param  nFormat
+     *          specify in which context the cache items should be
+     *          interpreted.
+     */
+    public synchronized void toHTML(java.io.File     aDirectory,
+                                    int              nFormat   ,
+                                    java.lang.String sEncoding )
+        throws java.lang.Exception
+    {
+        if (nFormat != FORMAT_6Y)
+            throw new java.lang.Exception("HTML views are supported for the new 6.y format only yet.");
+
+        java.lang.StringBuffer sRelationView = new java.lang.StringBuffer(1000);
+        sRelationView.append("<html><header><title>Relation View</title></header><body>");
+        sRelationView.append("<table border=1>");
+        sRelationView.append("<tr><td><b>type</b></td><td><b>detect service</b></td><td><b>preferred filter</b></td><td><b>frame loader</b></td><td><b>content handler</b></td></tr>");
+
+        java.util.Iterator aIt = m_lTypes.keySet().iterator();
+        while (aIt.hasNext())
+        {
+            java.lang.String  sType = (java.lang.String)aIt.next();
+            java.util.HashMap aType = (java.util.HashMap)m_lTypes.get(sType);
+
+            sRelationView.append("<tr>");
+            sRelationView.append("<td>"+sType+"</td>");
+
+            java.lang.String sVal = (java.lang.String)aType.get(PROPNAME_DETECTSERVICE);
+            if (sVal == null || sVal.length()<1)
+                sRelationView.append("<td> - </td>");
+            else
+                sRelationView.append("<td>"+sVal+"</td>");
+
+            sVal = (java.lang.String)aType.get(PROPNAME_PREFERREDFILTER);
+            if (sVal == null || sVal.length()<1)
+                sRelationView.append("<td> - </td>");
+            else
+                sRelationView.append("<td>"+sVal+"</td>");
+
+            sVal = (java.lang.String)aType.get(PROPNAME_FRAMELOADER);
+            if (sVal == null || sVal.length()<1)
+                sRelationView.append("<td> - </td>");
+            else
+                sRelationView.append("<td>"+sVal+"</td>");
+
+            sVal = (java.lang.String)aType.get(PROPNAME_CONTENTHANDLER);
+            if (sVal == null || sVal.length()<1)
+                sRelationView.append("<td> - </td>");
+            else
+                sRelationView.append("<td>"+sVal+"</td>");
+
+            sRelationView.append("</tr>");
+        }
+
+        sRelationView.append("</table>");
+        sRelationView.append("</body>");
+
+        FileHelper.writeEncodedBufferToFile(new java.io.File(aDirectory, "relation_view.html"), sEncoding, false, sRelationView);
+
+        java.util.HashMap lFilters2TypeRegistration = new java.util.HashMap();
+        aIt = m_lFilters.keySet().iterator();
+        while (aIt.hasNext())
+        {
+            java.lang.String  sFilter = (java.lang.String)aIt.next();
+            java.util.HashMap aFilter = (java.util.HashMap)m_lFilters.get(sFilter);
+            java.lang.String  sType   = (java.lang.String)aFilter.get(PROPNAME_TYPE);
+
+            java.util.Vector lFilters = (java.util.Vector)lFilters2TypeRegistration.get(sType);
+            if (lFilters == null)
+                lFilters = new java.util.Vector();
+            lFilters.add(sFilter);
+            lFilters2TypeRegistration.put(sType, lFilters);
+        }
+
+        java.lang.StringBuffer sType2FiltersView = new java.lang.StringBuffer(1000);
+        sType2FiltersView.append("<html><header><title>Type2Filters View</title></header><body>");
+        sType2FiltersView.append("<table border=1>");
+        sType2FiltersView.append("<tr><td><b>type</b></td><td><b>filters</b></td></tr>");
+
+        aIt = lFilters2TypeRegistration.keySet().iterator();
+        while (aIt.hasNext())
+        {
+            java.lang.String sType    = (java.lang.String)aIt.next();
+            java.util.Vector lFilters = (java.util.Vector)lFilters2TypeRegistration.get(sType);
+
+            sType2FiltersView.append("<tr><td>"+sType+"</td><td>");
+            java.util.Enumeration aEn = lFilters.elements();
+            while(aEn.hasMoreElements())
+                sType2FiltersView.append(aEn.nextElement()+"<br>");
+            sType2FiltersView.append("</td></tr>");
+        }
+
+        sType2FiltersView.append("</table>");
+        sType2FiltersView.append("</body>");
+
+        FileHelper.writeEncodedBufferToFile(new java.io.File(aDirectory, "type2filters_view.html"), sEncoding, false, sType2FiltersView);
+    }
+
+    //___________________________________________
+
+    /** converts all items of this cache to its xml representation
+     *  and write it to the given file.
+     *
+     *  @param  aXML
+     *          the target file for output.
+     *
+     *  @param  nFormat
+     *          the requested xml format.
+     *          see const values FORMAT_xxx too.
+     *
+     *  @param  sEncoding
+     *          specify the file encoding for the generated xml file.
+     *
+     *  @throws [java.lang.Exception]
+     *          if something fail during convertion.
+     */
+    public synchronized void toXML(java.io.File     aXML     ,
+                                   int              nFormat  ,
+                                   java.lang.String sEncoding)
+        throws java.lang.Exception
+    {
+        java.lang.StringBuffer sXML = new java.lang.StringBuffer(500000);
+
+        for (int i=0; i<5; ++i)
+        {
+            // define right sub container
+            java.lang.String  sSetName = null;
+            java.util.HashMap rMap     = null;
+            int               eType    = -1;
+
+            switch(i)
+            {
+                case 0 :
+                {
+                    sSetName = CFGNODE_TYPES;
+                    rMap     = m_lTypes;
+                    eType    = E_TYPE;
+                }
+                break;
+
+                case 1 :
+                {
+                    sSetName = CFGNODE_FILTERS;
+                    rMap     = m_lFilters;
+                    eType    = E_FILTER;
+                }
+                break;
+
+                case 2 :
+                {
+                    sSetName = CFGNODE_DETECTSERVICES;
+                    rMap     = m_lDetectServices;
+                    eType    = E_DETECTSERVICE;
+                }
+                break;
+
+                case 3 :
+                {
+                    sSetName = CFGNODE_FRAMELOADERS;
+                    rMap     = m_lFrameLoaders;
+                    eType    = E_FRAMELOADER;
+                }
+                break;
+
+                case 4 :
+                {
+                    sSetName = CFGNODE_CONTENTHANDLERS;
+                    rMap     = m_lContentHandlers;
+                    eType    = E_CONTENTHANDLER;
+                }
+                break;
+            }
+
+            // generate set
+            sXML.append("<node oor:name=\""+sSetName+"\" oor:op=\"replace\">\n");
+            java.util.Iterator it = rMap.keySet().iterator();
+            while(it.hasNext())
+            {
+                java.lang.String sItem = (java.lang.String)it.next();
+                sXML.append("<node oor:name=\""+sItem+"\" oor:op=\"replace\">\n");
+                sXML.append(getItemAsXML(eType, sItem, nFormat));
+                sXML.append("</node>\n");
+            }
+            sXML.append("</node>\n");
+        }
+
+        java.io.FileOutputStream   aStream = new java.io.FileOutputStream(aXML.getAbsolutePath(), false);
+        java.io.OutputStreamWriter aWriter = new java.io.OutputStreamWriter(aStream, sEncoding);
+        java.lang.String           sOut    = sXML.toString();
+        aWriter.write(sOut, 0, sOut.length());
+        aWriter.flush();
+        aWriter.close();
+    }
+
+    //___________________________________________
+
+    /** converts a type property set from internal format
+     *  to an external one.
+     *
+     *  @param  aMap
+     *          points to the item, which should be converted.
+     *
+     *  @param  nFormat
+     *          specify the requested output format.
+     *
+     *  @return [java.util.HashMap]
+     *          contains the properties in the requested format.
+     *
+     *  @throws [java.lang.Exception
+     *          if something fail during convertion.
+     */
+    private static java.util.HashMap convertTypePropsToExternal(java.util.HashMap aMap   ,
+                                                                int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = new java.util.HashMap();
+        // copy Name property ... if it exists!
+        if (aMap.containsKey(PROPNAME_NAME))
+            aResultMap.put(PROPNAME_NAME, aMap.get(PROPNAME_NAME));
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // copy UIName property unchanged
+                aResultMap.put(PROPNAME_UINAME, aMap.get(PROPNAME_UINAME));
+
+                // ignore properties "UIOrder", "PreferredFilter", "DetectService"
+                // They are not supported for 6.0 types.
+
+                // pack all other properties to one "Data" string value
+                java.lang.StringBuffer sData = new java.lang.StringBuffer(256);
+
+                sData.append(aMap.get(PROPNAME_PREFERRED));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_MEDIATYPE));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_CLIPBOARDFORMAT));
+                sData.append(",");
+
+                java.util.Vector lList = (java.util.Vector)aMap.get(PROPNAME_URLPATTERN);
+                int              c     = lList.size();
+                int              i     = 0;
+                for (i=0; i<c; ++i)
+                {
+                    sData.append(lList.elementAt(i));
+                    if (i<(c-1))
+                        sData.append(";");
+                }
+
+                lList = (java.util.Vector)aMap.get(PROPNAME_EXTENSIONS);
+                c     = lList.size();
+                for (i=0; i<c; ++i)
+                {
+                    sData.append(lList.elementAt(i));
+                    if (i<(c-1))
+                        sData.append(";");
+                }
+
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_DOCUMENTICONID));
+                sData.append(",");
+
+                aResultMap.put(PROPNAME_DATA, sData.toString());
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // copy all supported properties directly
+                aResultMap.put(PROPNAME_PREFERRED      , aMap.get(PROPNAME_PREFERRED      ));
+                aResultMap.put(PROPNAME_MEDIATYPE      , aMap.get(PROPNAME_MEDIATYPE      ));
+                aResultMap.put(PROPNAME_URLPATTERN     , aMap.get(PROPNAME_URLPATTERN     ));
+                aResultMap.put(PROPNAME_EXTENSIONS     , aMap.get(PROPNAME_EXTENSIONS     ));
+                aResultMap.put(PROPNAME_UINAME         , aMap.get(PROPNAME_UINAME         ));
+                aResultMap.put(PROPNAME_PREFERREDFILTER, aMap.get(PROPNAME_PREFERREDFILTER));
+                aResultMap.put(PROPNAME_DETECTSERVICE  , aMap.get(PROPNAME_DETECTSERVICE  ));
+                aResultMap.put(PROPNAME_CLIPBOARDFORMAT, aMap.get(PROPNAME_CLIPBOARDFORMAT));
+                aResultMap.put(PROPNAME_UIORDER        , aMap.get(PROPNAME_UIORDER        ));
+                /* REMOVED!
+                aResultMap.put(PROPNAME_DOCUMENTICONID , aMap.get(PROPNAME_DOCUMENTICONID ));
+                 */
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    //___________________________________________
+
+    /** converts a filter property set from internal format
+     *  to an external one.
+     *
+     *  @param  aMap
+     *          points to the item, which should be converted.
+     *
+     *  @param  nFormat
+     *          specify the requested output format.
+     *
+     *  @return [java.util.HashMap]
+     *          contains the properties in the requested format.
+     *
+     *  @throws [java.lang.Exception
+     *          if something fail during convertion.
+     */
+    private static java.util.HashMap convertFilterPropsToExternal(java.util.HashMap aMap   ,
+                                                                  int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = new java.util.HashMap();
+        // copy Name property ... if it exists!
+        if (aMap.containsKey(PROPNAME_NAME))
+            aResultMap.put(PROPNAME_NAME, aMap.get(PROPNAME_NAME));
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // copy UIName property unchanged!
+                aResultMap.put(PROPNAME_UINAME, aMap.get(PROPNAME_UINAME));
+
+                // but pack all other properties
+                java.lang.StringBuffer sData = new java.lang.StringBuffer(256);
+
+                sData.append(aMap.get(PROPNAME_ORDER));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_TYPE));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_DOCUMENTSERVICE));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_FILTERSERVICE));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_FLAGS));
+                sData.append(",");
+                java.util.Vector lList = (java.util.Vector)aMap.get(PROPNAME_USERDATA);
+                int              c     = lList.size();
+                int              i     = 0;
+                for (i=0; i<c; ++i)
+                {
+                    sData.append(lList.elementAt(i));
+                    if (i<(c-1))
+                        sData.append(";");
+                }
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_FILEFORMATVERSION));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_TEMPLATENAME));
+                sData.append(",");
+                sData.append(aMap.get(PROPNAME_UICOMPONENT));
+                sData.append(",");
+
+                aResultMap.put(PROPNAME_DATA, sData.toString());
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // supress "Order" property.
+                // Will be moved to type entries in 6.y version!
+
+                // supress "UIName" property.
+                // Only type entries will be localized in 6.y version!
+                /* TODO make it configurable :-) */
+                aResultMap.put(PROPNAME_UINAME           , aMap.get(PROPNAME_UINAME           ));
+
+                // copy all supported properties directly
+                aResultMap.put(PROPNAME_TYPE             , aMap.get(PROPNAME_TYPE             ));
+                aResultMap.put(PROPNAME_DOCUMENTSERVICE  , aMap.get(PROPNAME_DOCUMENTSERVICE  ));
+                aResultMap.put(PROPNAME_FILTERSERVICE    , aMap.get(PROPNAME_FILTERSERVICE    ));
+                aResultMap.put(PROPNAME_USERDATA         , aMap.get(PROPNAME_USERDATA         ));
+                aResultMap.put(PROPNAME_FILEFORMATVERSION, aMap.get(PROPNAME_FILEFORMATVERSION));
+                aResultMap.put(PROPNAME_TEMPLATENAME     , aMap.get(PROPNAME_TEMPLATENAME     ));
+                aResultMap.put(PROPNAME_UICOMPONENT      , aMap.get(PROPNAME_UICOMPONENT      ));
+
+                // "Flags" will be converted from internal format [int] to
+                // the 6.y format [string-list]!
+                java.lang.Integer nFlags = (java.lang.Integer)aMap.get(PROPNAME_FLAGS);
+                java.util.Vector  lFlags = Cache.convertFilterFlagValues2Names(nFlags);
+                aResultMap.put(PROPNAME_FLAGS, lFlags);
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    //___________________________________________
+
+    /** converts a detect service property set from internal format
+     *  to an external one.
+     *
+     *  @param  aMap
+     *          points to the item, which should be converted.
+     *
+     *  @param  nFormat
+     *          specify the requested output format.
+     *
+     *  @return [java.util.HashMap]
+     *          contains the properties in the requested format.
+     *
+     *  @throws [java.lang.Exception
+     *          if something fail during convertion.
+     */
+    private static java.util.HashMap convertDetectServicePropsToExternal(java.util.HashMap aMap   ,
+                                                                         int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = null;
+
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // no changes!
+                aResultMap = aMap;
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // remove localized name
+                aResultMap = aMap;
+                aResultMap.remove(PROPNAME_UINAME);
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    private static java.util.HashMap convertFrameLoaderPropsToExternal(java.util.HashMap aMap   ,
+                                                                       int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = null;
+
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // no changes!
+                aResultMap = aMap;
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // remove localized name
+                aResultMap = aMap;
+                aResultMap.remove(PROPNAME_UINAME);
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    private static java.util.HashMap convertContentHandlerPropsToExternal(java.util.HashMap aMap   ,
+                                                                          int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = null;
+
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // no changes!
+                aResultMap = aMap;
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // remove localized name
+                aResultMap = aMap;
+                aResultMap.remove(PROPNAME_UINAME);
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    //___________________________________________
+
+    /** converts a type property set (using an external format) to
+     *  our internal cache format.
+     *
+     *  Especialy the data format string will be expanded
+     *  to its real properties.
+     *
+     *  Schema:
+     *      aMap["UIName"] => aExpandedMap["UIName"]
+     *      aMap["Data"  ] => aExpandedMap["Preferred" ], aExpandedMap["MediaType"] etc. ...
+     *
+     *  @param  aMap
+     *          points to the item, which should be converted.
+
+     *  @param  nFormat
+     *          specify the external format.
+     *
+     *  @return [java.util.HashMap]
+     *          The new map in internal format.
+     */
+    private static java.util.HashMap convertTypePropsToInternal(java.util.HashMap aMap   ,
+                                                                int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = new java.util.HashMap();
+        // copy Name property ... if it exists!
+        if (aMap.containsKey(PROPNAME_NAME))
+            aResultMap.put(PROPNAME_NAME, aMap.get(PROPNAME_NAME));
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // copy UIName property unchanged!
+                aResultMap.put(PROPNAME_UINAME, aMap.get(PROPNAME_UINAME));
+
+                // generate new property "UIOrder"
+                // Its the moved property "Order" of filters for versions >= 6.y!
+                aResultMap.put(PROPNAME_UIORDER, new java.lang.Integer(0));
+
+                // generate new property "PreferredFilter"
+                // Its a the moved filter flag "Preferred" for versions >= 6.y!
+                aResultMap.put(PROPNAME_PREFERREDFILTER, new java.lang.String());
+
+                // generate new property "DetectService"
+                // Every type know its detector diretcly from now. No search
+                // will be neccessary any longer.
+                aResultMap.put(PROPNAME_DETECTSERVICE, new java.lang.String());
+
+                // analyze the Data property of the original map
+                // and copy its results (means all expanded properties)
+                // to the result map.
+                java.lang.String sDataVal = (java.lang.String)aMap.get(PROPNAME_DATA);
+                java.util.Vector lTokens  = Cache.splitTokenString(sDataVal, ",");
+
+                int t = 0;
+                java.util.Enumeration it = lTokens.elements();
+                while (it.hasMoreElements())
+                {
+                    java.lang.String sToken = (java.lang.String)it.nextElement();
+                    switch(t)
+                    {
+                        case 0 :
+                            aResultMap.put(PROPNAME_PREFERRED, new java.lang.Boolean(sToken));
+                            break;
+                        case 1 :
+                            aResultMap.put(PROPNAME_MEDIATYPE, sToken);
+                            break;
+                        case 2 :
+                        {
+                            /*HACK ersetze %20 mit " " ...*/
+                            int ni = sToken.indexOf("%20");
+                            if (ni!=-1)
+                            {
+                                java.lang.String sPatch = sToken.substring(0,ni) + " " + sToken.substring(ni+3);
+                                sToken = sPatch;
+                            }
+                            aResultMap.put(PROPNAME_CLIPBOARDFORMAT, sToken);
+                        }
+                            break;
+                        case 3 :
+                            aResultMap.put(PROPNAME_URLPATTERN, Cache.splitTokenString(sToken, ";"));
+                            break;
+                        case 4 :
+                            aResultMap.put(PROPNAME_EXTENSIONS, Cache.splitTokenString(sToken, ";"));
+                            break;
+                        case 5 :
+                            aResultMap.put(PROPNAME_DOCUMENTICONID, new java.lang.Integer(sToken));
+                            break;
+                        default :
+                            throw new java.lang.Exception("unsupported format for data value of a type \""+aMap.get(PROPNAME_NAME)+"\" detected.");
+                    }
+                    ++t;
+                }
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // copy all supported properties directly
+                aResultMap.put(PROPNAME_PREFERRED      , aMap.get(PROPNAME_PREFERRED      ));
+                aResultMap.put(PROPNAME_MEDIATYPE      , aMap.get(PROPNAME_MEDIATYPE      ));
+                aResultMap.put(PROPNAME_CLIPBOARDFORMAT, aMap.get(PROPNAME_CLIPBOARDFORMAT));
+                aResultMap.put(PROPNAME_URLPATTERN     , aMap.get(PROPNAME_URLPATTERN     ));
+                aResultMap.put(PROPNAME_EXTENSIONS     , aMap.get(PROPNAME_EXTENSIONS     ));
+                aResultMap.put(PROPNAME_DOCUMENTICONID , aMap.get(PROPNAME_DOCUMENTICONID ));
+                aResultMap.put(PROPNAME_UINAME         , aMap.get(PROPNAME_UINAME         ));
+                aResultMap.put(PROPNAME_UIORDER        , aMap.get(PROPNAME_UIORDER        ));
+                aResultMap.put(PROPNAME_PREFERREDFILTER, aMap.get(PROPNAME_PREFERREDFILTER));
+                aResultMap.put(PROPNAME_DETECTSERVICE  , aMap.get(PROPNAME_DETECTSERVICE  ));
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    //___________________________________________
+
+    /** converts a filter property set (using an external format) to
+     *  our internal cache format.
+     *
+     *  Especialy the data format string will be expanded
+     *  to its real properties.
+     *
+     *  Schema:
+     *      aMap["UIName"] => aExpandedMap["UIName"]
+     *      aMap["Data"  ] => aExpandedMap["Order" ], aExpandedMap["Flags"] etc. ...
+     *
+     *  @param  aMap
+     *          points to the item, which should be converted.
+     *
+     *  @param  nFormat
+     *          specify the external format.
+     *
+     *  @return [java.util.HashMap]
+     *          The new map in internal format.
+     */
+    private static java.util.HashMap convertFilterPropsToInternal(java.util.HashMap aMap   ,
+                                                                  int               nFormat)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aResultMap = new java.util.HashMap();
+        // copy Name property ... if it exists!
+        if (aMap.containsKey(PROPNAME_NAME))
+            aResultMap.put(PROPNAME_NAME, aMap.get(PROPNAME_NAME));
+        switch(nFormat)
+        {
+            //-----------------------------------
+            case FORMAT_60 :
+            {
+                // copy UIName property
+                aResultMap.put(PROPNAME_UINAME, aMap.get(PROPNAME_UINAME));
+
+                // analyze the Data property of the original map
+                // and copy its results (means all expanded properties)
+                // to the result map.
+                java.lang.String sDataVal = (java.lang.String)aMap.get(PROPNAME_DATA);
+                java.util.Vector lTokens  = Cache.splitTokenString(sDataVal, ",");
+
+                int t = 0;
+                java.util.Enumeration it = lTokens.elements();
+                while (it.hasMoreElements())
+                {
+                    java.lang.String sToken = (java.lang.String)it.nextElement();
+                    switch(t)
+                    {
+                        case 0 :
+                            aResultMap.put(PROPNAME_ORDER, new java.lang.Integer(sToken));
+                            break;
+                        case 1 :
+                            aResultMap.put(PROPNAME_TYPE, sToken);
+                            break;
+                        case 2 :
+                            aResultMap.put(PROPNAME_DOCUMENTSERVICE, sToken);
+                            break;
+                        case 3 :
+                            aResultMap.put(PROPNAME_FILTERSERVICE, sToken);
+                            break;
+                        case 4 :
+                            aResultMap.put(PROPNAME_FLAGS, new java.lang.Integer(sToken));
+                            break;
+                        case 5 :
+                            aResultMap.put(PROPNAME_USERDATA, Cache.splitTokenString(sToken, ";"));
+                            break;
+                        case 6 :
+                            aResultMap.put(PROPNAME_FILEFORMATVERSION, new java.lang.Integer(sToken));
+                            break;
+                        case 7 :
+                            aResultMap.put(PROPNAME_TEMPLATENAME, sToken);
+                            break;
+                        case 8 :
+                            aResultMap.put(PROPNAME_UICOMPONENT, sToken);
+                            break;
+                        default :
+                            throw new java.lang.Exception("unsupported format for data value of a filter detected.");
+                    }
+                    ++t;
+                }
+
+                // its an optional property :-)
+                if (!aResultMap.containsKey(PROPNAME_TEMPLATENAME))
+                    aResultMap.put(PROPNAME_TEMPLATENAME, new java.lang.String(""));
+
+                // its an optional property :-)
+                if (!aResultMap.containsKey(PROPNAME_UICOMPONENT))
+                    aResultMap.put(PROPNAME_UICOMPONENT, new java.lang.String(""));
+            }
+            break;
+
+            //-----------------------------------
+            case FORMAT_6Y :
+            {
+                // "Order" does not exist for 6.y versions! Use default.
+                aResultMap.put(PROPNAME_ORDER, new java.lang.Integer(0));
+
+                // "UIName" property does not exist for 6.y versions! use default.
+                /* TODO make it configurable :-) */
+                aResultMap.put(PROPNAME_UINAME, aMap.get(PROPNAME_UINAME));
+                //aResultMap.put(PROPNAME_UINAME, new java.util.HashMap());
+
+                // "Flags" must be converted from names to its values
+                java.util.Vector  lFlags = (java.util.Vector)aMap.get(PROPNAME_FLAGS);
+                java.lang.Integer nFlags = Cache.convertFilterFlagNames2Values(lFlags);
+                aResultMap.put(PROPNAME_FLAGS, nFlags);
+
+                // copy all direct supported properties
+                aResultMap.put(PROPNAME_TYPE             , aMap.get(PROPNAME_TYPE             ));
+                aResultMap.put(PROPNAME_DOCUMENTSERVICE  , aMap.get(PROPNAME_DOCUMENTSERVICE  ));
+                aResultMap.put(PROPNAME_FILTERSERVICE    , aMap.get(PROPNAME_ORDER            ));
+                aResultMap.put(PROPNAME_USERDATA         , aMap.get(PROPNAME_USERDATA         ));
+                aResultMap.put(PROPNAME_FILEFORMATVERSION, aMap.get(PROPNAME_FILEFORMATVERSION));
+                aResultMap.put(PROPNAME_TEMPLATENAME     , aMap.get(PROPNAME_TEMPLATENAME     ));
+                aResultMap.put(PROPNAME_UICOMPONENT      , aMap.get(PROPNAME_UICOMPONENT      ));
+            }
+            break;
+
+            //-----------------------------------
+            default :
+                throw new java.lang.Exception("unknown format");
+        }
+
+        return aResultMap;
+    }
+
+    private static java.util.HashMap convertDetectServicePropsToInternal(java.util.HashMap aMap   ,
+                                                                         int               nFormat)
+        throws java.lang.Exception
+    {
+        /*FIXME*/
+        java.util.HashMap aResultMap = aMap;
+        return aResultMap;
+    }
+
+    private static java.util.HashMap convertFrameLoaderPropsToInternal(java.util.HashMap aMap   ,
+                                                                       int               nFormat)
+        throws java.lang.Exception
+    {
+        /*FIXME*/
+        java.util.HashMap aResultMap = aMap;
+        return aResultMap;
+    }
+
+    private static java.util.HashMap convertContentHandlerPropsToInternal(java.util.HashMap aMap   ,
+                                                                          int               nFormat)
+        throws java.lang.Exception
+    {
+        /*FIXME*/
+        java.util.HashMap aResultMap = aMap;
+        return aResultMap;
+    }
+
+    //___________________________________________
+
+    /** converts filter flag names to its int representation.
+     *
+     *  @param  lFlags
+     *          a list of flag names.
+     *
+     *  @return [java.lang.Integer]
+     *          an integer field of all set flags.
+     *
+     *  @throws [java.lang.Exception]
+     *          for unsupported flags or empty flag fields!
+     */
+    private static java.lang.Integer convertFilterFlagNames2Values(java.util.Vector lFlags)
+        throws java.lang.Exception
+    {
+        int                   nFlags = 0;
+        java.util.Enumeration it     = lFlags.elements();
+        while(it.hasMoreElements())
+        {
+            java.lang.String sFlagName = (java.lang.String)it.nextElement();
+
+            if (sFlagName.equals(FLAGNAME_3RDPARTYFILTER))
+                nFlags |= FLAGVAL_3RDPARTYFILTER;
+            else
+            if (sFlagName.equals(FLAGNAME_ALIEN))
+                nFlags |= FLAGVAL_ALIEN;
+            else
+            if (sFlagName.equals(FLAGNAME_ASYNCHRON))
+                nFlags |= FLAGVAL_ASYNCHRON;
+            else
+            if (sFlagName.equals(FLAGNAME_BROWSERPREFERRED))
+                nFlags |= FLAGVAL_BROWSERPREFERRED;
+            else
+            if (sFlagName.equals(FLAGNAME_CONSULTSERVICE))
+                nFlags |= FLAGVAL_CONSULTSERVICE;
+            else
+            if (sFlagName.equals(FLAGNAME_DEFAULT))
+                nFlags |= FLAGVAL_DEFAULT;
+            else
+            if (sFlagName.equals(FLAGNAME_EXPORT))
+                nFlags |= FLAGVAL_EXPORT;
+            else
+            if (sFlagName.equals(FLAGNAME_IMPORT))
+                nFlags |= FLAGVAL_IMPORT;
+            else
+            if (sFlagName.equals(FLAGNAME_INTERNAL))
+                nFlags |= FLAGVAL_INTERNAL;
+            else
+            if (sFlagName.equals(FLAGNAME_NOTINCHOOSER))
+                nFlags |= FLAGVAL_NOTINCHOOSER;
+            else
+            if (sFlagName.equals(FLAGNAME_NOTINFILEDIALOG))
+                nFlags |= FLAGVAL_NOTINFILEDIALOG;
+            else
+            if (sFlagName.equals(FLAGNAME_NOTINSTALLED))
+                nFlags |= FLAGVAL_NOTINSTALLED;
+            else
+            if (sFlagName.equals(FLAGNAME_OWN))
+                nFlags |= FLAGVAL_OWN;
+            else
+            if (sFlagName.equals(FLAGNAME_PACKED))
+                nFlags |= FLAGVAL_PACKED;
+            else
+            if (sFlagName.equals(FLAGNAME_PREFERRED))
+                nFlags |= FLAGVAL_PREFERRED;
+            else
+            if (sFlagName.equals(FLAGNAME_READONLY))
+                nFlags |= FLAGVAL_READONLY;
+            else
+            if (sFlagName.equals(FLAGNAME_SILENTEXPORT))
+                nFlags |= FLAGVAL_SILENTEXPORT;
+            else
+            if (sFlagName.equals(FLAGNAME_TEMPLATE))
+                nFlags |= FLAGVAL_TEMPLATE;
+            else
+            if (sFlagName.equals(FLAGNAME_TEMPLATEPATH))
+                nFlags |= FLAGVAL_TEMPLATEPATH;
+            else
+            if (sFlagName.equals(FLAGNAME_USESOPTIONS))
+                nFlags |= FLAGVAL_USESOPTIONS;
+            else
+            if (sFlagName.equals(FLAGNAME_COMBINED))
+                nFlags |= FLAGVAL_COMBINED;
+            else
+                throw new java.lang.Exception("unsupported filter flag detected: \""+sFlagName+"\"");
+        }
+
+        if (nFlags == 0)
+            throw new java.lang.Exception("no filter flags?");
+
+        return new java.lang.Integer(nFlags);
+    }
+
+    //___________________________________________
+
+    /** converts filter flag values to its string representation.
+     *
+     *  @param  nFlags
+     *          the flag field as int value.
+     *
+     *  @return [java.util.Vector]
+     *          a list of flag names.
+     *
+     *  @throws [java.lang.Exception]
+     *          for unsupported flags or empty flag fields!
+     */
+    private static java.util.Vector convertFilterFlagValues2Names(java.lang.Integer nFlags)
+        throws java.lang.Exception
+    {
+        java.util.Vector lFlags = new java.util.Vector();
+        int              field  = nFlags.intValue();
+
+        if (field == 0)
+            throw new java.lang.Exception("no filter flags?");
+
+        if((field & FLAGVAL_IMPORT) == FLAGVAL_IMPORT)
+            lFlags.add(FLAGNAME_IMPORT);
+
+        if((field & FLAGVAL_EXPORT) == FLAGVAL_EXPORT)
+            lFlags.add(FLAGNAME_EXPORT);
+
+        if((field & FLAGVAL_TEMPLATE) == FLAGVAL_TEMPLATE)
+            lFlags.add(FLAGNAME_TEMPLATE);
+
+        if((field & FLAGVAL_INTERNAL) == FLAGVAL_INTERNAL)
+            lFlags.add(FLAGNAME_INTERNAL);
+
+        if((field & FLAGVAL_TEMPLATEPATH) == FLAGVAL_TEMPLATEPATH)
+            lFlags.add(FLAGNAME_TEMPLATEPATH);
+
+        if((field & FLAGVAL_OWN) == FLAGVAL_OWN)
+            lFlags.add(FLAGNAME_OWN);
+
+        if((field & FLAGVAL_ALIEN) == FLAGVAL_ALIEN)
+            lFlags.add(FLAGNAME_ALIEN);
+
+        if((field & FLAGVAL_USESOPTIONS) == FLAGVAL_USESOPTIONS)
+            lFlags.add(FLAGNAME_USESOPTIONS);
+
+        if((field & FLAGVAL_DEFAULT) == FLAGVAL_DEFAULT)
+            lFlags.add(FLAGNAME_DEFAULT);
+
+        if((field & FLAGVAL_NOTINFILEDIALOG) == FLAGVAL_NOTINFILEDIALOG)
+            lFlags.add(FLAGNAME_NOTINFILEDIALOG);
+
+        if((field & FLAGVAL_NOTINCHOOSER) == FLAGVAL_NOTINCHOOSER)
+            lFlags.add(FLAGNAME_NOTINCHOOSER);
+
+        if((field & FLAGVAL_ASYNCHRON) == FLAGVAL_ASYNCHRON)
+            lFlags.add(FLAGNAME_ASYNCHRON);
+
+        if((field & FLAGVAL_READONLY) == FLAGVAL_READONLY)
+            lFlags.add(FLAGNAME_READONLY);
+
+        if((field & FLAGVAL_NOTINSTALLED) == FLAGVAL_NOTINSTALLED)
+            lFlags.add(FLAGNAME_NOTINSTALLED);
+
+        if((field & FLAGVAL_CONSULTSERVICE) == FLAGVAL_CONSULTSERVICE)
+            lFlags.add(FLAGNAME_CONSULTSERVICE);
+
+        if((field & FLAGVAL_3RDPARTYFILTER) == FLAGVAL_3RDPARTYFILTER)
+            lFlags.add(FLAGNAME_3RDPARTYFILTER);
+
+        if((field & FLAGVAL_PACKED) == FLAGVAL_PACKED)
+            lFlags.add(FLAGNAME_PACKED);
+
+        if((field & FLAGVAL_SILENTEXPORT) == FLAGVAL_SILENTEXPORT)
+            lFlags.add(FLAGNAME_SILENTEXPORT);
+
+        if((field & FLAGVAL_BROWSERPREFERRED) == FLAGVAL_BROWSERPREFERRED)
+            lFlags.add(FLAGNAME_BROWSERPREFERRED);
+
+        if((field & FLAGVAL_PREFERRED) == FLAGVAL_PREFERRED)
+            lFlags.add(FLAGNAME_PREFERRED);
+
+        if((field & FLAGVAL_COMBINED) == FLAGVAL_COMBINED)
+            lFlags.add(FLAGNAME_COMBINED);
+
+        if((field & FLAGVAL_COMBINED) == FLAGVAL_SUPPORTSSELECTION)
+            lFlags.add(FLAGNAME_SUPPORTSSELECTION);
+
+        return lFlags;
+    }
+
+    //___________________________________________
+
+    /** return a reference to one of our member
+     *  lists for types/filters etc ...
+     *
+     *  @param  eItemType
+     *          specify, which item map is required.
+     *
+     *  @return [java.util.HashMap]
+     *          a reference(!) to the right member.
+     *
+     *  @throws [java.lang.Exception]
+     *          if the specified map does not exist.
+     */
+    private java.util.HashMap getItemMap(int eItemType)
+        throws java.lang.Exception
+    {
+        java.util.HashMap rMap = null;
+        switch(eItemType)
+        {
+            case E_TYPE :
+                rMap = m_lTypes;
+                break;
+
+            case E_FILTER :
+                rMap = m_lFilters;
+                break;
+
+            case E_DETECTSERVICE :
+                rMap = m_lDetectServices;
+                break;
+
+            case E_FRAMELOADER :
+                rMap = m_lFrameLoaders;
+                break;
+
+            case E_CONTENTHANDLER :
+                rMap = m_lContentHandlers;
+                break;
+
+            default:
+                throw new java.lang.Exception("Invalid item map specified.");
+        }
+        return rMap;
+    }
+
+    //___________________________________________
+
+    /** return the count of items inside a sub container
+     *  of this cache.
+     *
+     *  @param  eItemType
+     *          specify, which item map is required.
+     *
+     *  @throws [java.lang.Exception]
+     *          if the specified map does not exist.
+     */
+    public synchronized int getItemCount(int eItemType)
+        throws java.lang.Exception
+    {
+        java.util.HashMap rMap = getItemMap(eItemType);
+        return rMap.size();
+    }
+
+    //___________________________________________
+
+    /** get a list of all item names of the specified
+     *  sub container.
+     *
+     *  @param  eItemType
+     *          specify, which item map is required.
+     *
+     *  @throws [java.lang.Exception]
+     *          if the specified map does not exist.
+     */
+    public synchronized java.util.Vector getItemNames(int eItemType)
+        throws java.lang.Exception
+    {
+        java.util.Vector   lNames = new java.util.Vector();
+        java.util.HashMap  rMap   = getItemMap(eItemType);
+        java.util.Iterator it     = rMap.keySet().iterator();
+        while(it.hasNext())
+            lNames.add(it.next());
+        return lNames;
+    }
+
+    //___________________________________________
+
+    /** get a list of all item names of the specified
+     *  sub coontainer, where items match to given property set.
+     *
+     *  Note: The given property set must exist at all
+     *  returned items as minimum and every checked property
+     *  value must be equals! Using of reg expressions or
+     *  similar mechanism will not be supported here.
+     *
+     *  @param  eItemType
+     *          specify, which item map is required.
+     *
+     *  @param  aPropSet
+     *          the set of properties, which must
+     *          exist at the returned item as minimum.
+     *
+     *  @throws [java.lang.Exception]
+     *          if the specified map does not exist.
+     */
+    public synchronized java.util.Vector getMatchedItemNames(int               eItemType,
+                                                             java.util.HashMap aPropSet )
+        throws java.lang.Exception
+    {
+        java.util.Vector   lNames = new java.util.Vector();
+        java.util.HashMap  rMap   = getItemMap(eItemType);
+        java.util.Iterator it     = rMap.keySet().iterator();
+        while(it.hasNext())
+        {
+            java.lang.String  sItemName  = (java.lang.String)it.next();
+            java.util.HashMap rItemProps = (java.util.HashMap)rMap.get(sItemName);
+
+            boolean bMatch = Cache.matchPropSet(rItemProps, aPropSet);
+            if (bMatch)
+                lNames.add(sItemName);
+            else
+            {
+                java.lang.StringBuffer sBuffer = new java.lang.StringBuffer(1000);
+                sBuffer.append("entry ["+eItemType+"] \""+sItemName+"\" does not match.\n");
+                sBuffer.append("\torg items = {"+rItemProps+"}\n");
+                sBuffer.append("\treq items = {"+aPropSet+"}\n");
+
+                m_aDebug.setDetailedInfo(sBuffer.toString());
+            }
+        }
+        return lNames;
+    }
+
+    //___________________________________________
+
+    /** check if two property sets are equals in its
+     *  shared properties.
+     *
+     *  Note: Only set properties of the match set will be searched
+     *  inside the original set. And its values must be equals.
+     *  Using of reg expressions or similar mechanism will not
+     *  be supported here.
+     *
+     *  @param  rOrgProps
+     *          the original property set, which should be checked.
+     *
+     *  @param  rMatchProps
+     *          contains the properties, which must be searched
+     *          inside rOrgProps.
+     *
+     *  @return TRUE if all properties of rMatchProps could be located
+     *          inside rOrgProps.
+     */
+    private static boolean matchPropSet(java.util.HashMap rOrgProps  ,
+                                        java.util.HashMap rMatchProps)
+    {
+        java.util.Iterator it = rMatchProps.keySet().iterator();
+        while(it.hasNext())
+        {
+            java.lang.String sMatchName  = (java.lang.String)it.next();
+            java.lang.Object aMatchValue = rMatchProps.get(sMatchName);
+
+            if (
+                (!rOrgProps.containsKey(sMatchName)            ) ||
+                (!rOrgProps.get(sMatchName).equals(aMatchValue))
+               )
+            {
+                return false;
+            }
+        }
+        return true;
+    }
+
+    //___________________________________________
+
+    /** return a property set for the queried container item.
+     *
+     *  @param  eItemType
+     *          specify, which item map is required.
+     *
+     *  @param  sItemName
+     *          must be a valid item name of the specified item map.
+     *
+     *  @return [java.util.HashMap]
+     *          the property set of the queried item.
+     *          Always different from null!
+     *
+     *  @throws [java.lang.Exception]
+     *          if the specified item does not exists or
+     *          seems to be invalid in general (means null!).
+     */
+    public synchronized java.util.HashMap getItem(int              eItemType,
+                                                  java.lang.String sItemName)
+        throws java.lang.Exception
+    {
+        java.util.HashMap rMap  = getItemMap(eItemType);
+        java.util.HashMap rItem = (java.util.HashMap)rMap.get(sItemName);
+        if (rItem == null)
+            throw new java.lang.Exception("Queried item \""+sItemName+"\" does not exist inside this cache.");
+        return rItem;
+    }
+
+    //___________________________________________
+
+    /** return a requested item in XML format.
+     *
+     *  @param  eItemType
+     *          identify the right sub set of this cache
+     *          inside which the requested item should exist.
+     *          e.g. E_TYPE, E_FILTER, ...
+     *
+     *  @param  sItemName
+     *          the name of the request item
+     *
+     *  @param  nXMLFormat
+     *          means the format of the generated xml source.
+     *
+     *  @return [java.lang.String]
+     *          a xml formated string, which contains all properties
+     *          for this container item.
+     */
+    public synchronized java.lang.String getItemAsXML(int              eItemType ,
+                                                      java.lang.String sItemName ,
+                                                      int              nXMLFormat)
+        throws java.lang.Exception
+    {
+        // Note: Our internal format must be converted to the target format!
+        java.util.HashMap rItem         = getItem(eItemType, sItemName);
+        java.util.HashMap rFormatedItem = null;
+        switch(eItemType)
+        {
+            case E_TYPE :
+                {
+                    rFormatedItem = Cache.convertTypePropsToExternal(rItem, nXMLFormat);
+                    m_aDebug.setGlobalInfo("type to external \""+sItemName+"\"");
+                }
+                break;
+
+            case E_FILTER :
+                {
+                    rFormatedItem = Cache.convertFilterPropsToExternal(rItem, nXMLFormat);
+                    m_aDebug.setGlobalInfo("filter to external \""+sItemName+"\"");
+                }
+                break;
+
+            case E_DETECTSERVICE :
+                {
+                    rFormatedItem = Cache.convertDetectServicePropsToExternal(rItem, nXMLFormat);
+                    m_aDebug.setGlobalInfo("detect service to external \""+sItemName+"\"");
+                }
+                break;
+
+            case E_FRAMELOADER :
+                {
+                    rFormatedItem = Cache.convertFrameLoaderPropsToExternal(rItem, nXMLFormat);
+                    m_aDebug.setGlobalInfo("frame loader to external \""+sItemName+"\"");
+                }
+                break;
+
+            case E_CONTENTHANDLER :
+                {
+                    rFormatedItem = Cache.convertContentHandlerPropsToExternal(rItem, nXMLFormat);
+                    m_aDebug.setGlobalInfo("content handler to external \""+sItemName+"\"");
+                }
+                break;
+        }
+
+        java.lang.StringBuffer sXML        = new java.lang.StringBuffer(1000);
+        int                    nPrettyTabs = 1;
+        for (int t=0; t<nPrettyTabs; ++t)
+            sXML.append("\t");
+        sXML.append("<"+XMLHelper.XMLTAG_NODE+" "+XMLHelper.XMLATTRIB_OOR_NAME+"=\""+XMLHelper.encodeHTMLSigns(sItemName)+"\" "+XMLHelper.XMLATTRIB_OOR_OP+"=\""+XMLHelper.XMLATTRIB_OP_REPLACE+"\">\n");
+        sXML.append(XMLHelper.convertPropSetToXML(rFormatedItem, nPrettyTabs+1));
+        for (int t=0; t<nPrettyTabs; ++t)
+            sXML.append("\t");
+        sXML.append("</"+XMLHelper.XMLTAG_NODE+">\n");
+
+        return sXML.toString();
+    }
+
+    //___________________________________________
+
+    /** split the given string (using the specified delimiter)
+     *  and return alist of found string tokens.
+     *
+     *  Note: Against the normal behaviour of the StringTokenizer class
+     *  this method returns empty tokens too.
+     *  E.g: "0,,1" will return "0" - "" - "1"
+     *
+     *  @param  sTokenString
+     *          the string value, which should be analyzed.
+     *
+     *  @param  sDelim
+     *          the delimiter, which will be used to differe between tokens.
+     *
+     *  @return [java.util.Vector]
+     *          a list of string tokens. Can be empty - but not null!
+     */
+    private static java.util.Vector splitTokenString(java.lang.String sTokenString,
+                                                     java.lang.String sDelim      )
+    {
+        java.util.Vector          lTokens       = new java.util.Vector();
+        java.util.StringTokenizer aTokenizer    = new java.util.StringTokenizer(sTokenString, sDelim, true);
+        boolean                   bLastWasDelim = false;
+
+        while (aTokenizer.hasMoreTokens())
+        {
+            java.lang.String sToken = aTokenizer.nextToken();
+            if (sToken.equals(sDelim))
+            {
+                if (bLastWasDelim)
+                {
+                    // last token was a delimiter - new one too
+                    // => an empty token must be placed between these
+                    //    two delimiters! Add this empty value to the return list.
+                    lTokens.add("");
+                }
+                else
+                {
+                    // last token was not a delimiter - new one is such delim
+                    // => ignore this delimiter - but save the information, that
+                    //    it occured
+                    bLastWasDelim = true;
+                }
+            }
+            else
+            {
+                // new token is no delim
+                // => Add it to the return list.
+                lTokens.add(sToken);
+                // Dont forget to reset this information - so next loop
+                // will do the right things!
+                bLastWasDelim = false;
+            }
+        }
+
+        return lTokens;
+    }
+
+    //___________________________________________
+
+    /**
+     */
+    public synchronized void analyze()
+    {
+        m_nDoubleRegisteredFilters = 0;
+        m_nTypesForFilters         = 0;
+        m_nTypesForDetectServices  = 0;
+        m_nTypesForFrameLoaders    = 0;
+        m_nTypesForContentHandlers = 0;
+
+        // create table of types and all registered filters for such types
+        // By the way: count all double registrations, where a filter
+        // uses the same type then another filter.
+        m_lFilterToTypeRegistrations = new java.util.HashMap();
+        java.util.Iterator aIt1 = m_lFilters.keySet().iterator();
+        while (aIt1.hasNext())
+        {
+            java.lang.String  sFilter = (java.lang.String)aIt1.next();
+            java.util.HashMap aFilter = (java.util.HashMap)m_lFilters.get(sFilter);
+            java.lang.String  sType   = (java.lang.String)aFilter.get(PROPNAME_TYPE);
+
+            java.util.Vector lFilters = (java.util.Vector)m_lFilterToTypeRegistrations.get(sType);
+            if (lFilters == null)
+                lFilters = new java.util.Vector();
+            else
+                ++m_nDoubleRegisteredFilters;
+            lFilters.add(sFilter);
+            m_lFilterToTypeRegistrations.put(sType, lFilters);
+        }
+
+        // count, how many types are used by filters, frame loaders or content handlers
+        aIt1 = m_lTypes.keySet().iterator();
+        while (aIt1.hasNext())
+        {
+            java.lang.String sType = (java.lang.String)aIt1.next();
+
+            java.util.Iterator aIt2 = m_lFilters.keySet().iterator();
+            while (aIt2.hasNext())
+            {
+                java.lang.String  sItem    = (java.lang.String)aIt2.next();
+                java.util.HashMap aItem    = (java.util.HashMap)m_lFilters.get(sItem);
+                java.lang.String  sTypeReg = (java.lang.String)aItem.get(PROPNAME_TYPE);
+
+                if (sTypeReg.equals(sType))
+                {
+                    ++m_nTypesForFilters;
+                    break;
+                }
+            }
+
+            aIt2 = m_lDetectServices.keySet().iterator();
+            while (aIt2.hasNext())
+            {
+                java.lang.String  sItem    = (java.lang.String)aIt2.next();
+                java.util.HashMap aItem    = (java.util.HashMap)m_lDetectServices.get(sItem);
+                java.util.Vector  lTypeReg = (java.util.Vector)aItem.get(PROPNAME_TYPES);
+
+                if (lTypeReg.contains(sType))
+                {
+                    ++m_nTypesForDetectServices;
+                    break;
+                }
+            }
+
+            aIt2 = m_lFrameLoaders.keySet().iterator();
+            while (aIt2.hasNext())
+            {
+                java.lang.String  sItem    = (java.lang.String)aIt2.next();
+                java.util.HashMap aItem    = (java.util.HashMap)m_lFrameLoaders.get(sItem);
+                java.util.Vector  lTypeReg = (java.util.Vector)aItem.get(PROPNAME_TYPES);
+
+                if (lTypeReg.contains(sType))
+                {
+                    ++m_nTypesForFrameLoaders;
+                    break;
+                }
+            }
+
+            aIt2 = m_lContentHandlers.keySet().iterator();
+            while (aIt2.hasNext())
+            {
+                java.lang.String  sItem    = (java.lang.String)aIt2.next();
+                java.util.HashMap aItem    = (java.util.HashMap)m_lContentHandlers.get(sItem);
+                java.util.Vector  lTypeReg = (java.util.Vector)aItem.get(PROPNAME_TYPES);
+
+                if (lTypeReg.contains(sType))
+                {
+                    ++m_nTypesForContentHandlers;
+                    break;
+                }
+            }
+        }
+    }
+
+    //___________________________________________
+
+    /** validate all cache entries.
+     *
+     *  It checks if all made registrations are valid;
+     *  try to repair some simple problems;
+     *  create missing informations on demand ...
+     *
+     *  @param  nFormat
+     *          specify, which configuration format
+     *          must be checked.
+     *
+     *  @throws [java.lang.Exception]
+     *          if an unrecoverable problem occure.
+     */
+    public synchronized void validate(int nFormat)
+        throws java.lang.Exception
+    {
+        validateTypes(nFormat);
+        validateFilters(nFormat);
+    }
+
+    //___________________________________________
+
+    /** validate all type entries of this cache.
+     *
+     *  @param  nFormat
+     *          specify, which configuration format
+     *          must be checked.
+     *
+     *  @throws [java.lang.Exception]
+     *          if an unrecoverable problem occure.
+     */
+    private void validateTypes(int nFormat)
+        throws java.lang.Exception
+    {
+        java.util.Iterator aIt1 = m_lTypes.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            java.lang.String  sType = (java.lang.String)aIt1.next();
+            java.util.HashMap aType = (java.util.HashMap)m_lTypes.get(sType);
+            if (aType == null)
+                throw new java.lang.Exception("type ["+sType+"] dos not exist realy?!");
+
+            if (
+                (!aType.containsKey(PROPNAME_MEDIATYPE      )) ||
+                (!aType.containsKey(PROPNAME_PREFERRED      )) ||
+                (!aType.containsKey(PROPNAME_CLIPBOARDFORMAT)) ||
+                (!aType.containsKey(PROPNAME_DOCUMENTICONID )) ||
+                (!aType.containsKey(PROPNAME_URLPATTERN     )) ||
+                (!aType.containsKey(PROPNAME_EXTENSIONS     )) ||
+                (!aType.containsKey(PROPNAME_UINAME         ))
+               )
+            {
+                throw new java.lang.Exception("Type \""+sType+"\" does not contain all neccessary properties for a 6.0/6.Y format.");
+            }
+
+            if (
+                (((java.util.Vector)aType.get(PROPNAME_EXTENSIONS)).isEmpty()) &&
+                (((java.util.Vector)aType.get(PROPNAME_URLPATTERN)).isEmpty())
+               )
+            {
+                throw new java.lang.Exception("Type \""+sType+"\" does not contain any extension nor an url pattern.");
+            }
+
+            if (((java.util.HashMap)aType.get(PROPNAME_UINAME)).isEmpty())
+                throw new java.lang.Exception("Type \""+sType+"\" is not localized.");
+
+            if (nFormat == FORMAT_6Y)
+            {
+                if (
+                    (!aType.containsKey(PROPNAME_UIORDER        )) ||
+                    (!aType.containsKey(PROPNAME_PREFERREDFILTER)) ||
+                    (!aType.containsKey(PROPNAME_DETECTSERVICE  ))
+                   )
+                {
+                    throw new java.lang.Exception("Type \""+sType+"\" does not contain all neccessary properties for a 6.Y format.");
+                }
+
+                if (((java.lang.Integer)aType.get(PROPNAME_UIORDER)).intValue() < 0)
+                    throw new java.lang.Exception("Type \""+sType+"\" has invalid value for prop UIOrder.");
+
+                if (((java.lang.String)aType.get(PROPNAME_DETECTSERVICE)).length() < 1)
+                    m_aDebug.setWarning("Type \""+sType+"\" has no detect service registered.");
+
+                java.lang.String sPreferredReg = (java.lang.String)aType.get(PROPNAME_PREFERREDFILTER);
+                if (
+                    (sPreferredReg          == null) ||
+                    (sPreferredReg.length() <  1   )
+                   )
+                {
+                    m_aDebug.setWarning("Type \""+sType+"\" has no preferred filter ...");
+                    /*FIXME
+                     *  OK - not every type has a filter registered .. but the
+                     *  a frame loader MUST(!) exist! Check it.
+                     */
+                }
+                else
+                {
+                    if (!m_lFilters.containsKey(sPreferredReg))
+                        throw new java.lang.Exception("Type \""+sType+"\" has no valid preferred filter registration [\""+sPreferredReg+"\"].");
+                }
+            }
+        }
+    }
+
+    //___________________________________________
+
+    /** validate all filter entries of this cache.
+     *
+     *  @param  nFormat
+     *          specify, which configuration format
+     *          must be checked.
+     *
+     *  @throws [java.lang.Exception]
+     *          if an unrecoverable problem occure.
+     */
+    public synchronized void validateFilters(int nFormat)
+        throws java.lang.Exception
+    {
+        java.util.Iterator aIt1 = m_lFilters.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            java.lang.String  sFilter = (java.lang.String)aIt1.next();
+            java.util.HashMap aFilter = (java.util.HashMap)m_lFilters.get(sFilter);
+            if (aFilter == null)
+                throw new java.lang.Exception("filter ["+sFilter+"] dos not exist realy?!");
+
+            if (
+                (!aFilter.containsKey(PROPNAME_DOCUMENTSERVICE  )) ||
+                (!aFilter.containsKey(PROPNAME_FILEFORMATVERSION)) ||
+                (!aFilter.containsKey(PROPNAME_FILTERSERVICE    )) ||
+                (!aFilter.containsKey(PROPNAME_FLAGS            )) ||
+                (!aFilter.containsKey(PROPNAME_TEMPLATENAME     )) ||
+                (!aFilter.containsKey(PROPNAME_TYPE             )) ||
+                (!aFilter.containsKey(PROPNAME_UICOMPONENT      )) ||
+                (!aFilter.containsKey(PROPNAME_USERDATA         ))
+               )
+            {
+                throw new java.lang.Exception("Filter \""+sFilter+"\" does not contain all neccessary properties for a 6.0/6.Y format.");
+            }
+
+            if (((java.lang.Integer)aFilter.get(PROPNAME_FLAGS)).intValue() < 1)
+                throw new java.lang.Exception("Filter \""+sFilter+"\" does not have a valid flag field.");
+
+            if (!m_lTypes.containsKey(aFilter.get(PROPNAME_TYPE)))
+                throw new java.lang.Exception("Filter \""+sFilter+"\" is not registered for a well known type.");
+
+            if (nFormat == FORMAT_60)
+            {
+                if (
+                    (!aFilter.containsKey(PROPNAME_ORDER )) ||
+                    (!aFilter.containsKey(PROPNAME_UINAME))
+                   )
+                {
+                    throw new java.lang.Exception("Filter \""+sFilter+"\" does not contain all neccessary properties for a 6.0 format.");
+                }
+
+                if (((java.lang.Integer)aFilter.get(PROPNAME_ORDER)).intValue() < 0)
+                    throw new java.lang.Exception("Filter \""+sFilter+"\" does not have a valid Order value.");
+
+                if (((java.util.HashMap)aFilter.get(PROPNAME_UINAME)).isEmpty())
+                    throw new java.lang.Exception("Filter \""+sFilter+"\" is not localized.");
+            }
+/*TODO
+    depends from the configuration item "remove_filter_flag_preferred" ...
+
+            if (nFormat == FORMAT_6Y)
+            {
+                int flags = ((java.lang.Integer)aFilter.get(PROPNAME_FLAGS)).intValue();
+                if ((flags & FLAGVAL_PREFERRED) == FLAGVAL_PREFERRED)
+                    throw new java.lang.Exception("Filter \""+sFilter+"\" has superflous Preferred flag set. Please remove this flag. ["+flags+"]");
+            }
+*/
+        }
+    }
+
+    /*TODO
+     * - remove graphic filters!
+     * - move detect services to types
+     */
+
+    public synchronized void transform60to6Y(boolean bCreateCombineFilterFlag         ,
+                                             boolean bRemoveFilterFlagBrowserPreferred,
+                                             boolean bRemoveFilterFlagPreferred       ,
+                                             boolean bRemoveFilterFlag3rdparty        ,
+                                             boolean bRemoveFilterUINames             ,
+                                             boolean bRemoveGraphicFilters            ,
+                                             boolean bSetDefaultDetector              )
+        throws java.lang.Exception
+    {
+        // remove some superflous cache entries ...
+        // everything related to "load macros"
+        // Macros should be dispatched instead of loaded!
+        if (m_lTypes.containsKey("macro"))
+        {
+            m_lTypes.remove("macro");
+            m_aDebug.setDetailedInfo("superflous type \"macro\" was removed");
+        }
+        if (m_lFrameLoaders.containsKey("com.sun.star.comp.sfx2.SfxMacroLoader"))
+        {
+            m_lFrameLoaders.remove("com.sun.star.comp.sfx2.SfxMacroLoader");
+            m_aDebug.setDetailedInfo("superflous frame loader \"com.sun.star.comp.sfx2.SfxMacroLoader\" was removed");
+        }
+
+        // step over all filters and check her properties and references
+        java.util.Vector   lPreferredFilters = new java.util.Vector();
+        java.util.Vector   lNoRealFilters    = new java.util.Vector();
+        java.util.Iterator aIt1              = m_lFilters.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            java.lang.String  sFilter  = (java.lang.String)aIt1.next();
+            java.util.HashMap aFilter  = (java.util.HashMap)m_lFilters.get(sFilter);
+
+            // remove the "graphic helper filters" used by draw and impress
+            // They dont have any valid document service name set and cant be handled
+            // by our generic FrameLoader!
+            // They must be moved to her own configuration ...
+
+            if (
+                (bRemoveGraphicFilters                                                 ) &&
+                (((java.lang.String)aFilter.get(PROPNAME_DOCUMENTSERVICE)).length() < 1)
+               )
+            {
+                lNoRealFilters.add(sFilter);
+                continue;
+            }
+
+            java.lang.String  sTypeReg = (java.lang.String)aFilter.get(PROPNAME_TYPE);
+            java.util.HashMap aType    = (java.util.HashMap)m_lTypes.get(sTypeReg);
+
+            // move UINames of filters to types
+            java.util.HashMap  lFilterUINames = (java.util.HashMap)aFilter.get(PROPNAME_UINAME);
+            java.util.HashMap  lTypeUINames   = (java.util.HashMap)aType.get(PROPNAME_UINAME);
+            java.util.HashMap  lPatchUINames  = new java.util.HashMap();
+            
+            java.util.Iterator pUINames = lTypeUINames.keySet().iterator();
+            while(pUINames.hasNext())
+            {
+                java.lang.String sLocale = (java.lang.String)pUINames.next();
+                java.lang.String sValue  = (java.lang.String)lTypeUINames.get(sLocale);
+                lPatchUINames.put(sLocale, sValue);
+            }
+            
+            pUINames = lFilterUINames.keySet().iterator();
+            while(pUINames.hasNext())
+            {
+                java.lang.String sLocale = (java.lang.String)pUINames.next();
+                java.lang.String sValue  = (java.lang.String)lFilterUINames.get(sLocale);
+                lPatchUINames.put(sFilter+":"+sLocale, sValue);
+            }
+            aType.put(PROPNAME_UINAME, lPatchUINames);
+            
+            // set generic filter service wrapper for our own native filters!
+            // By the way: The format types of such filters can be detected by our
+            // generic detector too.
+            if (
+                (bSetDefaultDetector                                                 ) &&
+                (((java.lang.String)aFilter.get(PROPNAME_FILTERSERVICE)).length() < 1)
+               )
+            {
+ /*ME_THINKING               aFilter.put(PROPNAME_FILTERSERVICE, FILTERSERVICE_NATIVEWARPPER);*/
+                aType.put(PROPNAME_DETECTSERVICE, GENERIC_DETECTSERVICE);
+            }
+
+            // move the preferred filter information to any type
+            // Set the filter name to the type for which the filter is registered.
+            // If this type already have a set PreferredFilter value, check if the current filter
+            // has the preferred flag set. If not ignore it - otherwhise overwrite the
+            // current information at the type. But look for multiple preferred filter relations ...
+            // means: look if more the one filter has set the preferred flag for the same type!
+
+            /* Attention!
+             *
+             * Dont remove the preferred flag from any filter! ... not here.
+             * Otherwhise next loop can't detect ambigous preferred registrations!
+             * Add filter to a temp. list, which can be used later to remove the preferred
+             * flag ...
+             */
+
+            int     flags1     = ((java.lang.Integer)aFilter.get(PROPNAME_FLAGS)).intValue();
+            java.lang.String sDocSrv = (java.lang.String)aFilter.get(PROPNAME_DOCUMENTSERVICE);
+            if (sDocSrv.length()>0)// without a doc service its not a real filter - its a graphic filter!
+            {    
+                boolean preferred1 = ((flags1 & FLAGVAL_PREFERRED) == FLAGVAL_PREFERRED);
+                if (preferred1)
+                    lPreferredFilters.add(aFilter);
+    
+                java.lang.String sAlreadyRegisteredFilter = (java.lang.String)aType.get(PROPNAME_PREFERREDFILTER);
+                // no registration => set this filter as "any possible one"!
+                if (sAlreadyRegisteredFilter.length() < 1)
+                    aType.put(PROPNAME_PREFERREDFILTER, sFilter);
+                else
+                {
+                    java.util.HashMap aAlreadyRegisteredFilter = (java.util.HashMap)m_lFilters.get(sAlreadyRegisteredFilter);
+                    int               flags2                   = ((java.lang.Integer)aAlreadyRegisteredFilter.get(PROPNAME_FLAGS)).intValue();
+                    boolean           preferred2               = ((flags2 & FLAGVAL_PREFERRED) == FLAGVAL_PREFERRED);
+    
+                    // two preferred filters for the same type! => error
+                    if (preferred1 && preferred2)
+                    {
+                        java.lang.StringBuffer sMsg = new java.lang.StringBuffer(256);
+                        sMsg.append("More the one preferred filter detected for the same type.\n");
+                        sMsg.append("\ttype      = \""+sTypeReg+"\"\n");
+                        sMsg.append("\tfilter[1] = \""+sAlreadyRegisteredFilter+"\"\n");
+                        sMsg.append("\tfilter[2] = \""+sFilter+"\"\n");
+                        throw new java.lang.Exception(sMsg.toString());
+                    }
+                    else
+                    // overwrite the "any possible" filter with a real preferred one
+                    if (preferred1 && !preferred2)
+                        aType.put(PROPNAME_PREFERREDFILTER, sFilter);
+                }
+            }
+            
+            // create the new combined filter flag if required
+            if (bCreateCombineFilterFlag)
+            {
+                if (
+                    ((flags1 & FLAGVAL_IMPORT) == FLAGVAL_IMPORT) &&
+                    ((flags1 & FLAGVAL_EXPORT) == FLAGVAL_EXPORT)
+                   )
+                {
+                    flags1 |=  FLAGVAL_COMBINED;
+                    flags1 &= ~FLAGVAL_IMPORT  ;
+                    flags1 &= ~FLAGVAL_EXPORT  ;
+                    aFilter.put(PROPNAME_FLAGS, new java.lang.Integer(flags1));
+                }
+            }
+
+            // remove some obsolete filter flags
+            if (bRemoveFilterFlagBrowserPreferred)
+            {
+                flags1 &= ~FLAGVAL_BROWSERPREFERRED;
+                aFilter.put(PROPNAME_FLAGS, new java.lang.Integer(flags1));
+            }
+
+            if (bRemoveFilterFlag3rdparty)
+            {
+                flags1 &= ~FLAGVAL_3RDPARTYFILTER;
+                aFilter.put(PROPNAME_FLAGS, new java.lang.Integer(flags1));
+            }
+
+            // if its a filter with an UI order ...
+            // move this information to the registered type.
+            // Note: Because more then one filter can be registered for the same type.
+            // Handle it as an error ... till we find a better transformation!
+            java.lang.Integer nOrder   = (java.lang.Integer)aFilter.get(PROPNAME_ORDER);
+            java.lang.Integer nUIOrder = (java.lang.Integer)aType.get(PROPNAME_UIORDER);
+            int               order    = nOrder.intValue();
+            int               uiorder  = nUIOrder.intValue();
+
+            if (order > 0)
+            {
+                if (
+                    (uiorder < 1    ) ||
+                    (uiorder > order)
+                   )
+                {
+                    aType.put(PROPNAME_UIORDER, nOrder);
+                    m_aDebug.setDetailedInfo("moved order value "+nOrder+" from filter \""+sFilter+"\" to type \""+sTypeReg+"\"");
+                }
+                else
+                    m_aDebug.setDetailedInfo("ignore order value [order="+nOrder+",uiorder="+nUIOrder+"] for filter \""+sFilter+"\" and type \""+sTypeReg+"\"");
+            }
+        }
+
+        // NOW ... remove the preferred flags from every filter, which it has set.
+        java.util.Enumeration aIt2 = null;
+        if (bRemoveFilterFlagPreferred)
+        {
+            aIt2 = lPreferredFilters.elements();
+            while (aIt2.hasMoreElements())
+            {
+                java.util.HashMap aFilter = (java.util.HashMap)aIt2.nextElement();
+                int               flags   = ((java.lang.Integer)aFilter.get(PROPNAME_FLAGS)).intValue();
+                flags &= ~FLAGVAL_PREFERRED;
+                aFilter.put(PROPNAME_FLAGS, new java.lang.Integer(flags));
+            }
+        }
+
+        // NOW ... remove all "no real filters" like the graphich helper filters of
+        // draw and impress!
+        aIt2 = lNoRealFilters.elements();
+        while (aIt2.hasMoreElements())
+            m_lFilters.remove(aIt2.nextElement());
+
+        // step over all detect services and move this information directly to
+        // the corresponding types
+        // Overwrite possibel default registrations with a real existing one!
+        aIt1 = m_lDetectServices.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            java.lang.String      sDetector = (java.lang.String)aIt1.next();
+            java.util.HashMap     aDetector = (java.util.HashMap)m_lDetectServices.get(sDetector);
+            java.util.Vector      lTypeReg  = (java.util.Vector)aDetector.get(PROPNAME_TYPES);
+            aIt2 = lTypeReg.elements();
+            while(aIt2.hasMoreElements())
+            {
+                java.lang.String  sTypeReg                   = (java.lang.String)aIt2.nextElement();
+                java.util.HashMap aType                      = (java.util.HashMap)m_lTypes.get(sTypeReg);
+
+                if (aType == null)
+                {
+                    m_aDebug.setWarning("Detector \""+sDetector+"\" seem to be registered for unknown type \""+sTypeReg+"\"");
+                    continue;
+                }
+
+                java.lang.Object  aAlreadyRegisteredDetector = aType.get(PROPNAME_DETECTSERVICE);
+                if (aAlreadyRegisteredDetector != null && ((java.lang.String)aAlreadyRegisteredDetector).length() > 0)
+                {
+                    java.lang.StringBuffer sMsg = new java.lang.StringBuffer(256);
+                    sMsg.append("type \""+sTypeReg+"\" has ambigous registrations of a detect service\n");
+                    sMsg.append("\tdetect service[1] = \""+(java.lang.String)aAlreadyRegisteredDetector+"\"\n");
+                    sMsg.append("\tdetect service[2] = \""+sDetector+"\"\n");
+                    m_aDebug.setWarning(sMsg.toString());
+                }
+                aType.put(PROPNAME_DETECTSERVICE, sDetector);
+                m_aDebug.setGlobalInfo("move detector \""+sDetector+"\" to type \""+sTypeReg+"\"");
+            }
+        }
+
+        // because all detect service was registered as type properties directly ...
+        // remove all detect service objects of this cache!
+        m_lDetectServices.clear();
+
+        // step over all frame loader and move this information directly to
+        // the corresponding types
+        // Overwrite possibel default registrations with a real existing one!
+        aIt1 = m_lFrameLoaders.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            java.lang.String      sLoader  = (java.lang.String)aIt1.next();
+            java.util.HashMap     aLoader  = (java.util.HashMap)m_lFrameLoaders.get(sLoader);
+            java.util.Vector      lTypeReg = (java.util.Vector)aLoader.get(PROPNAME_TYPES);
+            aIt2 = lTypeReg.elements();
+            while(aIt2.hasMoreElements())
+            {
+                java.lang.String  sTypeReg                 = (java.lang.String)aIt2.nextElement();
+                java.util.HashMap aType                    = (java.util.HashMap)m_lTypes.get(sTypeReg);
+                java.lang.String  sAlreadyRegisteredLoader = (java.lang.String)aType.get(PROPNAME_FRAMELOADER);
+                if (sAlreadyRegisteredLoader != null && sAlreadyRegisteredLoader.length() > 0)
+                {
+                    java.lang.StringBuffer sMsg = new java.lang.StringBuffer(256);
+                    sMsg.append("type \""+sTypeReg+"\" has ambigous registrations of a frame loader\n");
+                    sMsg.append("\tframe loader[1] = \""+sAlreadyRegisteredLoader+"\"\n");
+                    sMsg.append("\tframe loader[2] = \""+sLoader+"\"\n");
+                    m_aDebug.setWarning(sMsg.toString());
+                }
+                aType.put(PROPNAME_FRAMELOADER, sLoader);
+                System.out.println("move loader \""+sLoader+"\" to type \""+sTypeReg+"\"");
+            }
+        }
+
+        m_lFrameLoaders.clear();
+
+        // step over all content handler and move this information directly to
+        // the corresponding types
+        // Overwrite possibel default registrations with a real existing one!
+        aIt1 = m_lContentHandlers.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            java.lang.String      sHandler = (java.lang.String)aIt1.next();
+            java.util.HashMap     aHandler = (java.util.HashMap)m_lContentHandlers.get(sHandler);
+            java.util.Vector      lTypeReg = (java.util.Vector)aHandler.get(PROPNAME_TYPES);
+            aIt2 = lTypeReg.elements();
+            while(aIt2.hasMoreElements())
+            {
+                java.lang.String  sTypeReg                  = (java.lang.String)aIt2.nextElement();
+                java.util.HashMap aType                     = (java.util.HashMap)m_lTypes.get(sTypeReg);
+                java.lang.String  sAlreadyRegisteredHandler = (java.lang.String)aType.get(PROPNAME_CONTENTHANDLER);
+                if (sAlreadyRegisteredHandler != null && sAlreadyRegisteredHandler.length() > 0)
+                {
+                    java.lang.StringBuffer sMsg = new java.lang.StringBuffer(256);
+                    sMsg.append("type \""+sTypeReg+"\" has ambigous registrations of a content handler\n");
+                    sMsg.append("\tcontent handler[1] = \""+sAlreadyRegisteredHandler+"\"\n");
+                    sMsg.append("\tcontent handler[2] = \""+sHandler+"\"\n");
+                    m_aDebug.setWarning(sMsg.toString());
+                }
+                aType.put(PROPNAME_CONTENTHANDLER, sHandler);
+                System.out.println("move handler \""+sHandler+"\" to type \""+sTypeReg+"\"");
+            }
+        }
+
+        m_lContentHandlers.clear();
+
+/*
+        int c = m_lTypes.size();
+        java.lang.String[] lT1 = new java.lang.String[c];
+        java.lang.String[] lT2 = new java.lang.String[c];
+        long nUPS = 0;
+
+        int i = 0;
+        aIt1 = m_lTypes.keySet().iterator();
+        while(aIt1.hasNext())
+        {
+            lT1[i] = (java.lang.String)aIt1.next();
+            lT2[i] = lT1[i];
+            ++i;
+        }
+
+        for (int i1=0; i1<c; ++i1)
+        {
+            java.lang.String  sT1 = lT1[i1];
+            java.util.HashMap aT1 = (java.util.HashMap)m_lTypes.get(sT1);
+
+            for (int i2=i1; i2<c; ++i2)
+            {
+                java.lang.String  sT2 = lT1[i2];
+                java.util.HashMap aT2 = (java.util.HashMap)m_lTypes.get(sT2);
+
+                if (!sT1.equals(sT2))
+                {
+                    if (
+                        aT1.get(PROPNAME_MEDIATYPE).equals(aT2.get(PROPNAME_MEDIATYPE)) &&
+                        aT1.get(PROPNAME_CLIPBOARDFORMAT).equals(aT2.get(PROPNAME_CLIPBOARDFORMAT)) &&
+                        aT1.get(PROPNAME_URLPATTERN).equals(aT2.get(PROPNAME_URLPATTERN)) &&
+                        aT1.get(PROPNAME_EXTENSIONS).equals(aT2.get(PROPNAME_EXTENSIONS))
+                       )
+                    {
+                        System.err.println("UUPPSS----------------------------------------------------------------------------");
+                        System.err.println("[1]\""+sT1+"\" equals [2]\""+sT2+"\"");
+                        System.err.println("\tprops 1: "+aT1);
+                        System.err.println("\tprops 2: "+aT2);
+                        System.err.println("----------------------------------------------------------------------------------\n");
+                        ++nUPS;
+//                        throw new java.lang.Exception("UUPPS :-)");
+                    }
+                }
+            }
+        }
+        System.err.println("count of UPS = "+nUPS);
+*/
+    }
+}
diff --git filter/source/config/tools/utils/ConfigHelper.java filter/source/config/tools/utils/ConfigHelper.java
new file mode 100644
index 0000000..52a3275
--- /dev/null
+++ filter/source/config/tools/utils/ConfigHelper.java
@@ -0,0 +1,297 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: ConfigHelper.java,v $
+ * $Revision: 1.7 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ **********************************************************************_*/
+
+package com.sun.star.filter.config.tools.utils;
+
+
+//_______________________________________________
+// definition
+
+/** can be used to analyze command line parameters
+ *  and merge it together with might existing config
+ *  files. That provides the possibility to overwrite
+ *  config values via command line parameter.
+ *
+ *
+ */
+public class ConfigHelper extends java.util.Properties
+{
+    //___________________________________________
+    // member
+
+    /** indicates an empty command line. */
+    private boolean m_bEmpty = true;
+
+    //___________________________________________
+    // ctor
+
+    //-------------------------------------------
+    /** initialize a new helper with the list of
+     *  command line parameters and bind this new instance
+     *  to a property file on disk.
+     *
+     *  @param  sPropFile
+     *          name of the property file.
+     *          If its set to null or an empty value
+     *          it will be ignored.
+     *
+     *  @param  lCommandLineArgs
+     *          the list of original command line arguments.
+     *
+     *  @throws [Exception]
+     *          in case the command line contains an unknown
+     *          schema for specifiying parameters or the
+     *          specified property file does not exists
+     *          or seem to be corrupted.
+     */
+    public ConfigHelper(java.lang.String   sPropFile       ,
+                        java.lang.String[] lCommandLineArgs)
+        throws java.lang.Exception
+    {
+        // first load prop file, so its values can be overwritten
+        // by command line args later
+        // Do it only, if a valid file name was given.
+        // But in case this file name is wrong, throw an exception.
+        // So the outside code can react!
+        if (
+            (sPropFile          != null) &&
+            (sPropFile.length() >  0   )
+           )
+        {
+            java.lang.ClassLoader aLoader = getClass().getClassLoader();
+            java.io.InputStream   aStream = aLoader.getResourceAsStream(sPropFile);
+            if (aStream == null)
+                aStream = new java.io.FileInputStream(sPropFile);
+            load(aStream);
+        }
+
+        int count = 0;
+        if (lCommandLineArgs != null)
+            count = lCommandLineArgs.length;
+        m_bEmpty = (count < 1);
+
+        for (int arg=0; arg<count; ++arg)
+        {
+            // is it a named-value argument?
+            // Note: We ignores double "=" signs! => search from left to right
+            int len = lCommandLineArgs[arg].length();
+            int pos = lCommandLineArgs[arg].indexOf('=');
+            if (pos != -1)
+            {
+                java.lang.String sArg   = lCommandLineArgs[arg].substring(0,pos);
+                java.lang.String sValue = lCommandLineArgs[arg].substring(pos+1);
+                setProperty(sArg, sValue);
+                continue;
+            }
+
+            // is it a boolean argument?
+            // Note: Because "--" and "-" will be interpreted as the same
+            // we search from right to left!
+            pos = lCommandLineArgs[arg].lastIndexOf('-');
+            if (pos == -1)
+                pos = lCommandLineArgs[arg].lastIndexOf('/');
+            if (pos != -1)
+            {
+                java.lang.String sArg = lCommandLineArgs[arg].substring(pos+1);
+                setProperty(sArg, java.lang.String.valueOf(true));
+                continue;
+            }
+
+            // There is an unknown format used by this argument ...
+            throw new MalformedCommandLineException("Invalid command line detected. The argument \""+lCommandLineArgs[arg]+"\" use an unsupported format.");
+        }
+    }
+
+    //-------------------------------------------
+    /** indicates if the given command line includes
+     *  a help request.
+     *
+     *  @return True if there was an explicit help request.
+     */
+    public synchronized boolean isHelp()
+    {
+        return (
+                (containsKey("help")) ||
+                (containsKey("?")   ) ||
+                (containsKey("h")   )
+               );
+    }
+
+    //-------------------------------------------
+    /** indicates if the gioven command line was empty.
+     *
+     *  @return True if there was an empty command line.
+     */
+    public synchronized boolean isEmpty()
+    {
+        return m_bEmpty;
+    }
+
+    //-------------------------------------------
+    /** returns the value of sProp as boolean value.
+     *
+     *  @param  sProp
+     *          the name of the parameter.
+     *
+     *  @return The boolean value of the requested property.
+     *
+     *  @throw  [NoSuchElementException]
+     *          if the requested property does not exists.
+     */
+    public synchronized boolean getBoolean(java.lang.String sProp)
+        throws java.util.NoSuchElementException
+    {
+        java.lang.String sValue = getProperty(sProp);
+        if (sValue == null)
+            throw new java.util.NoSuchElementException("The requested config value \""+sProp+"\" does not exists!");
+        return new java.lang.Boolean(sValue).booleanValue();
+    }
+    
+    public synchronized boolean getBoolean(java.lang.String sProp   ,
+                                           boolean          bDefault)
+    {
+        java.lang.String sDefault = java.lang.String.valueOf(bDefault);
+        java.lang.String sValue   = getProperty(sProp, sDefault);
+        return new java.lang.Boolean(sValue).booleanValue();
+    }
+
+    //-------------------------------------------
+    /** returns the value of sProp as int value.
+     *
+     *  @param  sProp
+     *          the name of the parameter.
+     *
+     *  @return The int value of the requested property.
+     *
+     *  @throw  [NoSuchElementException]
+     *          if the requested property does not exists.
+     */
+    public synchronized int getInt(java.lang.String sProp)
+        throws java.util.NoSuchElementException
+    {
+        java.lang.String sValue = getProperty(sProp);
+        if (sValue == null)
+            throw new java.util.NoSuchElementException("The requested config value \""+sProp+"\" does not exists!");
+        return new java.lang.Integer(sValue).intValue();
+    }
+
+    public synchronized int getInt(java.lang.String sProp   ,
+                                   int              nDefault)
+    {
+        java.lang.String sDefault = java.lang.String.valueOf(nDefault);
+        java.lang.String sValue   = getProperty(sProp, sDefault);
+        return new java.lang.Integer(sValue).intValue();
+    }
+
+    //-------------------------------------------
+    /** returns the value of sProp as string value.
+     *
+     *  @param  sProp
+     *          the name of the parameter.
+     *
+     *  @return The string value of the requested property.
+     *
+     *  @throw  [NoSuchElementException]
+     *          if the requested property does not exists.
+     */
+    public synchronized java.lang.String getString(java.lang.String sProp)
+        throws java.util.NoSuchElementException
+    {
+        java.lang.String sValue = getProperty(sProp);
+        if (sValue == null)
+            throw new java.util.NoSuchElementException("The requested config value \""+sProp+"\" does not exists!");
+        return sValue;
+    }
+
+    //-------------------------------------------
+    /** returns the value of sProp as string list value!
+     *
+     *  @descr  The delimiter must be well known and
+     *          it must be clear if trailing/leading
+     *          whitespaces must be ignored or not.
+     *
+     *  @param  sProp
+     *          the name of the parameter.
+     *
+     *  @param  sDelim
+     *          the delimiter, which must be used to split
+     *          the config string value into an array.
+     *
+     *  @param  bTrim
+     *          if its set to true, trailing and leading whitespace
+     *          characters will be ommited.
+     *
+     *  @param  bDecode
+     *          if its set to TRUE all liste items will be
+     *          interpreted as "<xxx>" and converted to <xxx>!
+     *
+     *  @return The string list value of the requested property.
+     *
+     *  @throw  [NoSuchElementException]
+     *          if the requested property does not exists.
+     */
+    public synchronized java.util.Vector getStringList(java.lang.String sProp     ,
+                                                       java.lang.String sDelimiter,
+                                                       boolean          bTrim     ,
+                                                       boolean          bDecode   )
+        throws java.util.NoSuchElementException
+    {
+        java.lang.String sValue = getProperty(sProp);
+        if (sValue == null)
+            throw new java.util.NoSuchElementException("The requested config value \""+sProp+"\" does not exists!");
+
+        java.util.Vector lValue = new java.util.Vector();
+        try
+        {
+            java.util.StringTokenizer lTokens = new java.util.StringTokenizer(sValue, sDelimiter);
+            while(lTokens.hasMoreTokens())
+            {
+                java.lang.String sToken = lTokens.nextToken();
+                // remove trailing/leading whitespaces
+                if (bTrim)
+                    sToken = sToken.trim();
+                // remove ""
+                if (
+                    (bDecode                                      ) &&
+                    (sToken.indexOf("\"")     == 0                ) &&
+                    (sToken.lastIndexOf("\"") == sToken.length()-1)
+                   )
+                {
+                    sToken = sToken.substring(1, sToken.length()-1);
+                }
+                lValue.add(sToken);
+            }
+        }
+        catch(java.lang.Throwable ex)
+            { lValue.clear(); }
+
+        return lValue;
+    }
+}
diff --git filter/source/config/tools/utils/FileHelper.java filter/source/config/tools/utils/FileHelper.java
new file mode 100644
index 0000000..71922a2
--- /dev/null
+++ filter/source/config/tools/utils/FileHelper.java
@@ -0,0 +1,760 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: FileHelper.java,v $
+ * $Revision: 1.13 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+package com.sun.star.filter.config.tools.utils;
+
+
+// __________ Implementation __________
+
+/**
+ * It collects some static helper functons to handle file system specific problems.
+ * Sometimes it's neccessary to convert URL from/to system pathes;
+ * or from string notation to structural versions (e.g. com.sun.star.util.URL).
+ * And sometimes java had another notation then the office it has.
+ * Further it provides functionality to work easiear with the java.io.File class of java.
+ *
+ *
+ */
+public class FileHelper
+{
+    // ____________________
+
+    /**
+     * Because the office need URLs for loading/saving documents
+     * we must convert used system pathes.
+     * And java use another notation for file URLs ... correct it.
+     *
+     * @param aSystemPath
+     *          represent the file in system notation
+     *
+     * @return [String]
+     *          a file url which represent the given system path
+     */
+    public static java.lang.String getFileURLFromSystemPath(java.io.File aSystemPath)
+    {
+        System.out.println("TODO: must be adapted to java 1.3 :-(");
+        System.exit(-1);
+/*TODO_JAVA        
+        try
+        {
+            sFileURL = aSystemPath.toURI().toURL().toString();
+        }
+        catch( MalformedURLException exWrong )
+        {
+            sFileURL = null;
+        }
+*/        
+        java.lang.String sFileURL = null;
+
+        // problem of java: file URL's are coded with 1 slash instead of 2 or 3 ones!
+        // => correct this problem first, otherwise office can't use these URL's
+        if(
+            (sFileURL                       != null ) &&
+            (sFileURL.startsWith("file:/")  == true ) &&
+            (sFileURL.startsWith("file://") == false)
+          )
+        {
+            java.lang.StringBuffer sWorkBuffer = new java.lang.StringBuffer(sFileURL);
+            sWorkBuffer.insert(6,"//");
+            sFileURL = sWorkBuffer.toString();
+        }
+
+        return sFileURL;
+    }
+
+    // ____________________
+
+    /**
+     * The same as getFileURLFromSystemPath() before but uses string parameter instead
+     * of a java.io.File type. It exist to supress converting of neccessary parameters in the
+     * outside code. But of course getFileURLFromSystemPath(File) will be a little bit faster
+     * then this method ...
+     *
+     * @param sSystemPath
+     *          represent the file in system notation
+     *
+     * @return [String]
+     *          a file url which represent the given system path
+     */
+    public static java.lang.String getFileURLFromSystemPath(java.lang.String sSystemPath)
+    {
+        return getFileURLFromSystemPath(new java.io.File(sSystemPath));
+    }
+
+    // ____________________
+
+    /**
+     * Does the same as getFileURLFromSystemPath() before ... but uses
+     * the given protocol string (e.g."http://") insted of "file:///".
+     *
+     * @param aSystemPath
+     *          represent the file in system notation
+     *
+     * @param aBasePath
+     *          define the base path of the aSystemPath value,
+     *          which must be replaced with the value of "sServerPath".
+     *
+     * @param sServerURL
+     *          Will be used to replace sBasePath.
+     *
+     * @example
+     *          System Path = "d:\test\file.txt"
+     *          Base Path   = "d:\test"
+     *          Server Path = "http://alaska:8000"
+     *          => "http://alaska:8000/file.txt"
+     *
+     * @return [String]
+     *          an url which represent the given system path
+     *          and uses the given protocol
+     */
+    public static java.lang.String getURLWithProtocolFromSystemPath(java.io.File     aSystemPath,
+                                                                    java.io.File     aBasePath  ,
+                                                                    java.lang.String sServerURL )
+    {
+        System.out.println("TODO: must be adapted to java 1.3 :-(");
+        System.exit(-1);
+        
+        java.lang.String sFileURL = FileHelper.getFileURLFromSystemPath(aSystemPath);
+        java.lang.String sBaseURL = FileHelper.getFileURLFromSystemPath(aBasePath  );
+
+        // cut last '/'!
+        if (sBaseURL.lastIndexOf('/')==(sBaseURL.length()-1))
+            sBaseURL = sBaseURL.substring(0,sBaseURL.length()-1);
+
+        // cut last '/'!
+        if (sServerURL.lastIndexOf('/')==(sServerURL.length()-1))
+            sServerURL = sServerURL.substring(0,sServerURL.length()-1);
+
+//TODO_JAVA        java.lang.String sURL = sFileURL.replaceFirst(sBaseURL,sServerURL);
+        java.lang.String sURL = null;
+        return sURL;
+    }
+
+    // ____________________
+
+    /**
+     * The same as getURLWithProtocolFromSystemPath() before but uses string parameter instead
+     * of a java.io.File types. It exist to supress converting of neccessary parameters in the
+     * outside code. But of course getURLWithProtocolFromSystemPath(File,File,String) will be
+     * a little bit faster then this method ...
+     *
+     * @param sSystemPath
+     *          represent the file in system notation
+     *
+     * @param sBasePath
+     *          define the base path of the aSystemPath value,
+     *          which must be replaced with the value of "sServerPath".
+     *
+     * @param sServerPath
+     *          Will be used to replace sBasePath.
+     *
+     * @example
+     *          System Path = "d:\test\file.txt"
+     *          Base Path   = "d:\test"
+     *          Server Path = "http://alaska:8000"
+     *          => "http://alaska:8000/file.txt"
+     *
+     * @return [String]
+     *          an url which represent the given system path
+     *          and uses the given protocol
+     */
+    public static java.lang.String getURLWithProtocolFromSystemPath(java.lang.String sSystemPath,
+                                                                    java.lang.String sBasePath  ,
+                                                                    java.lang.String sServerPath)
+    {
+        return getURLWithProtocolFromSystemPath(new java.io.File(sSystemPath), new java.io.File(sBasePath), sServerPath);
+    }
+
+    //_________________________________
+
+    /**
+     * Return a list of all available files of a directory.
+     * We filter sub directories. All other files
+     * are returned. So they can be used for further purposes.
+     * One parameter define the start directory,
+     * another one enable/disable recursive search into sub directories.
+     *
+     * @param   aRoot
+     *          the start directory, which should be analyzed.
+     *
+     * @param   bRecursive
+     *          enable/disable search in sub directories.
+     *
+     * @return  [Vector]
+     *          a filtered list of java java.io.File objects of all available files
+     *          of the start dir (and may of its sub directories).
+     */
+    public static java.util.Vector getSystemFilesFromDir(java.io.File aRoot     ,
+                                                         boolean      bRecursive)
+    {
+        java.io.File[] lAllFiles = aRoot.listFiles();
+        if (lAllFiles == null)
+            return null;
+
+        int              c              = lAllFiles.length;
+        java.util.Vector lFilteredFiles = new java.util.Vector(c);
+        for (int i=0; i<c; ++i)
+        {
+            // simple files!
+            if (lAllFiles[i].isFile())
+                lFilteredFiles.add(lAllFiles[i]);
+            else
+            // recursion?
+            if (bRecursive && lAllFiles[i].isDirectory())
+            {
+                java.util.Vector lSubFiles = FileHelper.getSystemFilesFromDir(lAllFiles[i],bRecursive);
+                if (lSubFiles != null)
+                {
+                    java.util.Enumeration aSnapshot = lSubFiles.elements();
+                    while (aSnapshot.hasMoreElements())
+                        lFilteredFiles.add(aSnapshot.nextElement());
+                }
+            }
+        }
+
+        return lFilteredFiles;
+    }
+
+    //_________________________________
+    /** it converts the given name (e.g. an internal type name) to
+     *  an usable system file name.
+     *
+     *  Do so some special characters (e.g. "/") must be replaced with other ones.
+     *
+     *  @param  sName
+     *              the name, which should be analyzed and converted.
+     *
+     *  @return A valid system file name, which should be similar to the
+     *          given name, but does not contain special characters any longer.
+     */
+    public static java.lang.String convertName2FileName(String sName)
+    {
+        int    i       = 0;
+        int    nLength = sName.length(); 
+        char[] lBuffer = sName.toCharArray();
+
+        java.lang.StringBuffer sNewName = new java.lang.StringBuffer(nLength);
+        for (i=0; i<nLength; ++i)
+        {
+            char c = lBuffer[i];
+            if (
+                c>=48 && c<=57      // 0-9
+                &&
+                c>=97 && c<=122     // a-z
+                &&
+                c>=65 && c<=90      // A-Z
+               )
+            {
+                sNewName.append(c);
+            }
+            else
+            {
+                sNewName.append("_");
+            }
+        }
+
+        return sNewName.toString();
+    }
+
+    //___________________________________________
+
+    /** it removes all child nodes of a file system directory.
+     *
+     *  @param  aDirectory
+     *          points to the directory, which should be made empty.
+     *
+     *  @param  bFilesOnly
+     *          force deletion of files only. If its set to TRUE,
+     *          no subdirectory will be removed.
+     *
+     *  @throw  [java.io.IOException]
+     *          if some of the child nodes couldn't be removed.
+     */
+    public static void makeDirectoryEmpty(java.io.File aDirectory,
+                                          boolean      bFilesOnly)
+        throws java.io.IOException
+    {
+        if (!aDirectory.isDirectory())
+            throw new java.io.FileNotFoundException("\""+aDirectory.toString()+"\" is not a directory.");
+
+        java.io.File[] lChilds = aDirectory.listFiles();
+        for (int f=0; f<lChilds.length; ++f)
+        {
+            if (lChilds[f].isDirectory())
+            {
+                FileHelper.makeDirectoryEmpty(lChilds[f], bFilesOnly);
+                if (!bFilesOnly)
+                {
+                    if (!lChilds[f].delete())
+                        throw new java.io.IOException("\""+lChilds[f].toString()+"\" could not be deleted.");
+                }
+            }
+            else
+            {
+                if (!lChilds[f].delete())
+                    throw new java.io.IOException("\""+lChilds[f].toString()+"\" could not be deleted.");
+            }
+        }
+    }
+
+    //___________________________________________
+
+    /** it try to generate a new file with a unique ID
+     *  inside given directory.
+     *
+     *  Call this method with a directory and a base name for
+     *  a file. It will be used to generate a new files inside
+     *  the directory. Existing files will be checked and new file
+     *  name will be tested till a non existing file name would be found.
+     *
+     *  @param  aBaseDir
+     *          must be a system path
+     *          e.g.: "c:\temp"
+     *
+     *  @param  sBaseName
+     *          must be a system file name without extensions.
+     *          e.g.: "myfile_"
+     *
+     *  @param  sExtension
+     *          the whished extension.
+     *          e.g.: "dat"
+     *
+     *  @return A valid file object, if an unique file could be created -
+     *          Null otherwhise.
+     *          e.g.: "c:\temp\myfile_1.dat"
+     */
+    public static java.io.File createUniqueFile(java.io.File     aBaseDir  ,
+                                                java.lang.String sBaseName ,
+                                                java.lang.String sExtension)
+    {
+        java.io.File aBaseFile = new java.io.File(aBaseDir, sBaseName);
+        java.io.File aFile     = null;
+        long         nr        = 0;
+        while (aFile == null && nr < java.lang.Long.MAX_VALUE)
+        {
+            java.lang.String sFileName = aBaseFile.getPath() + java.lang.String.valueOf(nr) + "." + sExtension;
+            aFile = new java.io.File(sFileName);
+            if (aFile.exists())
+                aFile=null;
+            ++nr;
+        }
+        return aFile;
+    }
+
+    //___________________________________________
+
+    /** reads the complete file, using the right encoding,
+     *  into the given string buffer.
+     *
+     *  @param  aFile
+     *          must point to a system file, which must exist.
+     *          e.g.: "c:\temp\test.txt"
+     *                "/tmp/test.txt"
+     *
+     *  @param  sEncoding
+     *          will be used to encode the string content
+     *          inside the file.
+     *          e.g.: "UTF8"
+     *
+     *  @param  sBuffer
+     *          used to return the file content.
+     *
+     *  @throw  [IOException]
+     *          - if the file couldnt be opened
+     *          - if the file does not use the right encoding
+     */
+    public static void readEncodedBufferFromFile(java.io.File           aFile    ,
+                                                 java.lang.String       sEncoding,
+                                                 java.lang.StringBuffer sBuffer  )
+        throws java.io.IOException
+    {
+        if (sEncoding.equals("UTF-8Special"))
+        {
+            FileHelper.readAndCheckUTF8File(aFile,sBuffer);
+            return;
+        }
+        
+        java.io.FileInputStream   aByteStream    = new java.io.FileInputStream(aFile.getAbsolutePath());
+        java.io.InputStreamReader aEncodedReader = new java.io.InputStreamReader(aByteStream, sEncoding);
+        char[]                    aEncodedBuffer = new char[4096];
+        int                       nReadCount     = 0;
+
+        while((nReadCount=aEncodedReader.read(aEncodedBuffer))>0)
+            sBuffer.append(aEncodedBuffer, 0, nReadCount);
+
+        aEncodedReader.close();
+    }
+
+    //___________________________________________
+    private static void logEncodingData(java.lang.StringBuffer sLog         ,
+                                        int                    nUTF8        ,
+                                        int                    nByteOrg1    ,
+                                        int                    nByteOrg2    ,
+                                        int                    nByteOrg3    ,
+                                        int                    nByteOrg4    ,
+                                        int                    nByte1       ,
+                                        int                    nByte2       ,
+                                        int                    nByte3       ,
+                                        int                    nByte4       ,
+                                        int                    nEncodingType)
+    {
+        sLog.append("["+nEncodingType+"]\t");
+        sLog.append((int)nUTF8+"\t=");
+        sLog.append("\t"+nByteOrg1+"/"+nByte1);
+        sLog.append("\t"+nByteOrg2+"/"+nByte2);
+        sLog.append("\t"+nByteOrg3+"/"+nByte3);
+        sLog.append("\t"+nByteOrg4+"/"+nByte4);
+        sLog.append("\n");
+    }
+
+    //___________________________________________
+    private static char impl_convertBytesToChar(int nByte1, int nByte2, int nByte3, int nByte4)
+    {
+        return (char)((nByte1*0x40000)+(nByte2*0x1000)+(nByte3*0x40)+nByte4);
+    }
+                    
+    //___________________________________________
+    private static int impl_readAndCheckNextByte(byte[] aBuffer    ,
+                                                 int    nBufPos    ,
+                                                 int    nBufLength ,
+                                                 int    nMinRange  ,
+                                                 int    nMaxRange  )
+        throws java.lang.Exception                                                     
+    {
+        if (nBufPos>=nBufLength)
+            throw new java.lang.Exception("impl_readAndCheckNextByte()\nEnd of buffer reached.");
+            
+        int nByte = aBuffer[nBufPos] & 0xFF;
+        if (
+            (nByte < nMinRange) ||
+            (nByte > nMaxRange)
+           )
+        {
+            throw new java.lang.Exception("impl_readAndCheckNextByte()\nByte does not fit the specified range.");
+        }
+        
+        return nByte;
+    }
+    
+    //___________________________________________
+    public static void readAndCheckUTF8File(java.io.File           aFile  ,
+                                            java.lang.StringBuffer sBuffer)
+        throws java.io.IOException                                    
+    {
+        java.io.FileInputStream aByteStream     = new java.io.FileInputStream(aFile.getAbsolutePath());
+        byte[]                  aBuffer         = new byte[4096];
+        int                     nReadCount      = 0;
+        int                     nByteOrg_1      = 0;
+        int                     nByteOrg_2      = 0;
+        int                     nByteOrg_3      = 0;
+        int                     nByteOrg_4      = 0;
+        int                     nByte_1         = 0;
+        int                     nByte_2         = 0;
+        int                     nByte_3         = 0;
+        int                     nByte_4         = 0;
+        char                    nUTF8           = 0;
+        int                     i               = 0;
+        int                     nEncodingType   = 0;
+        java.lang.StringBuffer  sLog            = new java.lang.StringBuffer();
+
+        try
+        {
+
+        while((nReadCount=aByteStream.read(aBuffer))>0)
+        {
+            i=0;
+            while (i<nReadCount)
+            {
+                nByteOrg_1    = 0;
+                nByteOrg_2    = 0;
+                nByteOrg_3    = 0;
+                nByteOrg_4    = 0;
+                nByte_1       = 0;
+                nByte_2       = 0;
+                nByte_3       = 0;
+                nByte_4       = 0;
+                nUTF8         = 0;
+                nEncodingType = 0;
+
+                nByteOrg_1 = aBuffer[i++] & 0xFF;
+                nByte_1    = nByteOrg_1;
+                /*
+                    Table 3-6. Well-Formed UTF-8 Byte Sequences
+                    
+                    ============================================================================
+                    Nr.     Code Points             1st Byte    2nd Byte    3rd Byte    4th Byte
+                    ============================================================================
+                    01      U+     0..U+    7F      00..7F
+                    02      U+    80..U+   7FF      C2..DF      80..BF
+                    03      U+   800..U+   FFF      E0          A0..BF      80..BF
+                    04      U+  1000..U+  CFFF      E1..EC      80..BF      80..BF
+                    05      U+  D000..U+  D7FF      ED          80..9F      80..BF
+                    06      U+  E000..U+  FFFF      EE..EF      80..BF      80..BF
+                    07      U+ 10000..U+ 3FFFF      F0          90..BF      80..BF      80..BF
+                    08      U+ 40000..U+ FFFFF      F1..F3      80..BF      80..BF      80..BF
+                    09      U+100000..U+10FFFF      F4          80..8F      80..BF      80..BF
+                */
+                // ------------------------------------------------------------
+                // 01
+                // 1 byte: 0xxxxxxx
+                // ------------------------------------------------------------
+                if (
+                    (nByteOrg_1 >= 0x00) &&
+                    (nByteOrg_1 <= 0x7F)
+                   )
+                {
+                    nEncodingType = 1;
+                    nUTF8         = (char)nByte_1;
+                }
+                // ------------------------------------------------------------
+                // 02
+                // 1 byte: 110xxxxx
+                // 2 byte: 101xxxxx
+                // ------------------------------------------------------------
+                else
+                if (
+                    (nByteOrg_1 >= 0xC2) &&
+                    (nByteOrg_1 <= 0xDF)
+                   )
+                {
+                    nEncodingType = 2;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_1       = nByteOrg_1-0xC2;
+                    nByte_2       = nByteOrg_2-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0,0,nByte_1, nByte_2);
+                }
+                // ------------------------------------------------------------
+                // 03
+                // 1 byte: 11100000
+                // 2 byte: 101xxxxx
+                // 3 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (nByteOrg_1 == 0xE0)
+                {
+                    nEncodingType = 3;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0xA0, 0xBF);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_2       = nByteOrg_2-0xA0;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0,0,nByte_2, nByte_3);
+                }
+                // ------------------------------------------------------------
+                // 04
+                // 1 byte: 111xxxxx
+                // 2 byte: 10xxxxxx
+                // 3 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (
+                    (nByteOrg_1 >= 0xE1) &&
+                    (nByteOrg_1 <= 0xEC)
+                   )
+                {
+                    nEncodingType = 4;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_1       = nByteOrg_1-0xE1;
+                    nByte_2       = nByteOrg_2-0x80;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0,nByte_1, nByte_2, nByte_3);
+                }
+                // ------------------------------------------------------------
+                // 05
+                // 1 byte: 11101101
+                // 2 byte: 10xxxxxx
+                // 3 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (nByteOrg_1 == 0xED)
+                {
+                    nEncodingType = 5;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0x9F);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_2       = nByteOrg_2-0x80;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0,0, nByte_2, nByte_3);
+                }
+                // ------------------------------------------------------------
+                // 06
+                // 1 byte: 1110111x
+                // 2 byte: 10xxxxxx
+                // 3 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (
+                    (nByteOrg_1 >= 0xEE) &&
+                    (nByteOrg_1 <= 0xEF)
+                   )
+                {
+                    nEncodingType = 6;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_1       = nByteOrg_1-0xEE;
+                    nByte_2       = nByteOrg_2-0x80;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0,nByte_1, nByte_2, nByte_3);
+                }
+                // ------------------------------------------------------------
+                // 07
+                // 1 byte: 11110000
+                // 2 byte: 1001xxxx
+                // 3 byte: 10xxxxxx
+                // 4 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (nByteOrg_1 == 0xF0)
+                {
+                    nEncodingType = 7;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x90, 0xBF);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_4    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_2       = nByteOrg_2-0x90;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nByte_4       = nByteOrg_4-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0, nByte_2, nByte_3, nByte_4);
+                }
+                // ------------------------------------------------------------
+                // 08
+                // 1 byte: 111100xx
+                // 2 byte: 10xxxxxx
+                // 3 byte: 10xxxxxx
+                // 3 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (
+                    (nByteOrg_1 >= 0xF1) &&
+                    (nByteOrg_1 <= 0xF3)
+                   )
+                {
+                    nEncodingType = 8;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_4    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_1       = nByteOrg_1-0xF1;
+                    nByte_2       = nByteOrg_2-0x80;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nByte_4       = nByteOrg_4-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(nByte_1, nByte_2, nByte_3, nByte_4);
+                }
+                // ------------------------------------------------------------
+                // 09
+                // 1 byte: 11110100
+                // 2 byte: 10xxxxxx
+                // 3 byte: 10xxxxxx
+                // 4 byte: 10xxxxxx
+                // ------------------------------------------------------------
+                else
+                if (nByteOrg_1 == 0xF0)
+                {
+                    nEncodingType = 9;
+                    nByteOrg_2    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_3    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByteOrg_4    = FileHelper.impl_readAndCheckNextByte(aBuffer, i++, nReadCount, 0x80, 0xBF);
+                    nByte_2       = nByteOrg_2-0x80;
+                    nByte_3       = nByteOrg_3-0x80;
+                    nByte_4       = nByteOrg_4-0x80;
+                    nUTF8         = FileHelper.impl_convertBytesToChar(0, nByte_2, nByte_3, nByte_4);
+                }
+                // wrong encoding ?
+                else
+                {
+                    throw new java.lang.Exception("Non well formed UTF-8 encoding.");
+                }
+
+                sBuffer.append(nUTF8);
+                // -> DEBUG !
+                FileHelper.logEncodingData(sLog, nUTF8, nByteOrg_1, nByteOrg_2, nByteOrg_3, nByteOrg_4, nByte_1, nByte_2, nByte_3, nByte_4, nEncodingType);
+                // <- DEBUG !
+            }
+        }
+        
+        }
+        catch(java.lang.Throwable ex)
+        {
+            // -> DEBUG !
+            FileHelper.logEncodingData(sLog, nUTF8, nByteOrg_1, nByteOrg_2, nByteOrg_3, nByteOrg_4, nByte_1, nByte_2, nByte_3, nByte_4, nEncodingType);
+    
+            java.io.File     aDir  = new java.io.File(aFile.getParent());
+            java.lang.String sDump = aFile.getName();
+            java.io.File     aDump = FileHelper.createUniqueFile(aDir, sDump, "dump");
+            FileHelper.writeEncodedBufferToFile(aDump, "UTF-8", false, sLog);
+            // <- DEBUG !
+            
+            java.lang.String sMsg = "File '"+aFile.getPath()+"' is not encoded right as UTF-8.";
+            throw new java.io.IOException(sMsg);
+        }
+        
+        aByteStream.close();
+    }
+    
+    //___________________________________________
+
+    /** writes the given string buffer into the specified file
+     *  using the specified encoding.
+     *
+     *  Further it can be set, if the file should be expanded
+     *  or replaced by this new string buffer.
+     *
+     *  @param  aFile
+     *          must point to a system file. It can already exist!
+     *          e.g.: "c:\temp\test.txt"
+     *                "/tmp/test.txt"
+     *
+     *  @param  sEncoding
+     *          will be used to encode the string content inside the file.
+     *          e.g.: "UTF8"
+     *
+     *  @param  bAppend
+     *          specify if an already existing file will be
+     *          expanded or replaced.
+     *
+     *  @param  sBuffer
+     *          the new string content for this file.
+     */
+    public static void writeEncodedBufferToFile(java.io.File           aFile    ,
+                                                java.lang.String       sEncoding,
+                                                boolean                bAppend  ,
+                                                java.lang.StringBuffer sBuffer  )
+        throws java.io.IOException
+    {
+        java.io.FileOutputStream   aByteStream    = new java.io.FileOutputStream(aFile.getAbsolutePath(), bAppend);
+        java.io.OutputStreamWriter aEncodedWriter = new java.io.OutputStreamWriter(aByteStream, sEncoding);
+
+        java.lang.String sTemp = sBuffer.toString();
+        aEncodedWriter.write(sTemp, 0, sTemp.length());
+        
+        aEncodedWriter.flush();
+        aEncodedWriter.close();
+        
+        if (!aFile.exists())
+            throw new java.io.IOException("File \""+aFile.getAbsolutePath()+"\" not written correctly.");
+    }
+}
diff --git filter/source/config/tools/utils/Logger.java filter/source/config/tools/utils/Logger.java
new file mode 100644
index 0000000..192d358
--- /dev/null
+++ filter/source/config/tools/utils/Logger.java
@@ -0,0 +1,172 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: Logger.java,v $
+ * $Revision: 1.8 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+package com.sun.star.filter.config.tools.utils;
+
+
+//_______________________________________________
+// definition
+
+/** can be used to print out some debug messages
+ *  and group it into warnings/errors or info statements.
+ *
+ *
+ */
+public class Logger
+{
+    //___________________________________________
+    // const
+
+    /** only error message will be shown. */
+    public static final int LEVEL_ERRORS = 1;
+
+    /** only errors and warnings will be shown. */
+    public static final int LEVEL_WARNINGS = 2;
+
+    /** enable errors/warnings and some global info
+     *  message. */
+    public static final int LEVEL_GLOBALINFOS = 3;
+
+    /** enable anything! */
+    public static final int LEVEL_DETAILEDINFOS = 4;
+
+    //___________________________________________
+    // member
+
+    /** enable/disable different output level.
+     *  e.g. warnings/errors/infos */
+    private int m_nLevel;
+
+    //___________________________________________
+    // ctor
+
+    /** initialize new debug object with the specified
+     *  debug level.
+     *
+     *  @param  nLevel
+     *          the new debug level.
+     *          See const values LEVEL_xxx too.
+     */
+    public Logger(int nLevel)
+    {
+        m_nLevel = nLevel;
+    }
+
+    //___________________________________________
+    // interface
+
+    /** initialize new debug object with a default
+     *  debug level.
+     */
+    public Logger()
+    {
+        m_nLevel = LEVEL_DETAILEDINFOS;
+    }
+
+    //___________________________________________
+    // interface
+
+    /** prints out an exception ... if the right level is set.
+     *
+     *  @param  ex
+     *          the exception object
+     */
+    public synchronized void setException(java.lang.Throwable ex)
+    {
+        if (m_nLevel >= LEVEL_ERRORS)
+        {
+            System.err.println("Exception:\n");
+            ex.printStackTrace();
+        }
+    }
+
+    //___________________________________________
+    // interface
+
+    /** prints out an error ... if the right level is set.
+     *
+     *  @param  sError
+     *          the error message.
+     */
+    public synchronized void setError(java.lang.String sError)
+    {
+        if (m_nLevel >= LEVEL_ERRORS)
+            System.err.println("Error    :\t\""+sError+"\"");
+    }
+
+    //___________________________________________
+    // interface
+
+    /** prints out a warning ... if the right level is set.
+     *
+     *  @param  sWarning
+     *          the warning message.
+     */
+    public synchronized void setWarning(java.lang.String sWarning)
+    {
+        if (m_nLevel >= LEVEL_WARNINGS)
+            System.err.println("Warning  :\t\""+sWarning+"\"");
+    }
+
+    //___________________________________________
+    // interface
+
+    /** prints out a global info message ... if the right level is set.
+     *
+     *  Global infos should be used to describe a complex operation.
+     *  E.g.: loading of a document.
+     *  But not for every sub operation like e.g. analyzing lines
+     *  during loading the document!
+     *
+     *  @param  sInfo
+     *          the info message.
+     */
+    public synchronized void setGlobalInfo(java.lang.String sInfo)
+    {
+        if (m_nLevel >= LEVEL_GLOBALINFOS)
+            System.out.println("Info     :\t\""+sInfo+"\"");
+    }
+
+    //___________________________________________
+    // interface
+
+    /** prints out a mode detailed info message ... if the right level is set.
+     *
+     *  Such detailed message are e.g. "analyze line [n] of file ...".
+     *
+     *  @param  sInfo
+     *          the info message.
+     */
+    public synchronized void setDetailedInfo(java.lang.String sInfo)
+    {
+        if (m_nLevel >= LEVEL_DETAILEDINFOS)
+            System.out.println("Detail   :\t\""+sInfo+"\"");
+    }
+}
diff --git filter/source/config/tools/utils/MalformedCommandLineException.java filter/source/config/tools/utils/MalformedCommandLineException.java
new file mode 100644
index 0000000..8ff64b8
--- /dev/null
+++ filter/source/config/tools/utils/MalformedCommandLineException.java
@@ -0,0 +1,46 @@
+/*_***********************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: MalformedCommandLineException.java,v $
+ * $Revision: 1.4 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ **********************************************************************_*/
+
+package com.sun.star.filter.config.tools.utils;
+
+
+//___________________________________________
+// types
+
+/** indicates a malformed command line.
+ *
+ *  E.g. it must be thrown if the command line contains one item more then once,
+ *  or use unsupported format.
+ */
+public class MalformedCommandLineException extends java.lang.Exception
+{
+    public MalformedCommandLineException() {}
+    public MalformedCommandLineException(java.lang.String sMsg) { super(sMsg); }
+}
diff --git filter/source/config/tools/utils/XMLHelper.java filter/source/config/tools/utils/XMLHelper.java
new file mode 100644
index 0000000..cae531b
--- /dev/null
+++ filter/source/config/tools/utils/XMLHelper.java
@@ -0,0 +1,820 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: XMLHelper.java,v $
+ * $Revision: 1.7 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+package com.sun.star.filter.config.tools.utils;
+
+
+//_______________________________________________
+
+/**
+ *  It provides some constant values and some static helper routines
+ *  which are neccessary to work with a xml file - especialy
+ *  the filter configuration.
+ *
+ *
+ */
+public class XMLHelper
+{
+    //___________________________________________
+    // public const
+
+    /** its a possible value of the xml attribute "oor:type" and identify an integer type. */
+    public static final java.lang.String XMLTYPE_INTEGER = "xs:int";
+
+    /** its a possible value of the xml attribute "oor:type" and identify an boolean type. */
+    public static final java.lang.String XMLTYPE_BOOLEAN = "xs:boolean";
+
+    /** its a possible value of the xml attribute "oor:type" and identify an string type. */
+    public static final java.lang.String XMLTYPE_STRING = "xs:string";
+
+    /** its a possible value of the xml attribute "oor:type" and identify an string list type. */
+    public static final java.lang.String XMLTYPE_STRINGLIST = "oor:string-list";
+
+    /** its a xml attribute, which specify a property name. */
+    public static final java.lang.String XMLATTRIB_OOR_NAME = "oor:name";
+
+    /** its a xml attribute, which specify a property type. */
+    public static final java.lang.String XMLATTRIB_OOR_TYPE = "oor:type";
+
+    /** its a xml attribute, which specify a list separator. */
+    public static final java.lang.String XMLATTRIB_OOR_SEPARATOR = "oor:separator";
+
+    /** its a xml attribute, which specify a localized value. */
+    public static final java.lang.String XMLATTRIB_OOR_LOCALIZED = "oor:localized";
+
+    /** its a xml attribute, which specify a merge operation for cfg layering. */
+    public static final java.lang.String XMLATTRIB_OOR_OP = "oor:op";
+
+    /** can be used as value for XMLATTRIB_OOR_OP. */
+    public static final java.lang.String XMLATTRIB_OP_REPLACE = "replace";
+
+    /** its a xml attribute, which specify a locale value. */
+    public static final java.lang.String XMLATTRIB_XML_LANG = "xml:lang";
+
+    /** its the tag name of a <value ...> entry. */
+    public static final java.lang.String XMLTAG_VALUE = "value";
+
+    /** its the tag name of a <prop ...> entry. */
+    public static final java.lang.String XMLTAG_PROP = "prop";
+
+    /** its the tag name of a <node ...> entry. */
+    public static final java.lang.String XMLTAG_NODE = "node";
+
+    //___________________________________________
+    // private const
+
+    /** a static list of all possible separators, which can be used for configuration type string-list. */
+    private static final java.lang.String[] DELIMS = {" ", ",", ";", ".", ":", "-", "_", "#", "'", "+", "*", "~", "=", "?"};
+
+    /** index of the default separator inside list DELIMS.
+     *  Its neccessary to know such default separator; because it can
+     *  be supressed as xml attribute of the corresponding value tag. */
+    private static final int DEFAULT_SEPARATOR = 0;
+
+    //___________________________________________
+
+    /** analyze the structures of the given XML node and
+     *  return a property set of all found sub nodes.
+     *
+     *  Such properties are organized as [name, value] pairs.
+     *  The type of a xml node will be detected automaticly.
+     *  Following types are supported:
+     *      xs:int          => java.lang.Integer
+     *      xs:bool         => java.lang.Boolean
+     *      xs:string       => java.lang.String
+     *      oor:string-list => java.util.LinkedList[java.lang.String]
+     *      oor:set         => java.util.Vector[java.lang.Object]
+     *      oor:localized   => java.util.HashMap[java.lang.Object]
+     *
+     *  @param  aNode
+     *          points directly to the xml node, where we should analyze
+     *          the children nodes.
+     *
+     *  @return [java.util.HashMap]
+     *          contains every node name as key and its string(!) as value.
+     */
+    public static java.util.HashMap convertNodeToPropSet(org.w3c.dom.Node aNode)
+        throws java.lang.Exception
+    {
+        java.util.HashMap aPropSet = new java.util.HashMap();
+
+        // get all child nodes, which seems to be properties
+        java.util.Vector      lChildNodes = XMLHelper.extractChildNodesByTagName(aNode, XMLTAG_PROP);
+        java.util.Enumeration en1         = lChildNodes.elements();
+        while(en1.hasMoreElements())
+        {
+            org.w3c.dom.Node aChildNode = (org.w3c.dom.Node)en1.nextElement();
+
+            // read its name
+            java.lang.String sChildName = XMLHelper.extractNodeAttribByName(aChildNode, XMLATTRIB_OOR_NAME);
+            if (sChildName == null)
+                throw new java.io.IOException("unsupported format: could not extract child node name");
+
+            // read its type info
+            java.lang.String sChildType = XMLHelper.extractNodeAttribByName(aChildNode, XMLATTRIB_OOR_TYPE);
+            if (sChildType == null)
+            {
+                /** Special patch:
+                 *      If an xml tag has no type information set ... we can restore it
+                 *      by analyzing the already readed tag name :-)
+                 *      Not very nice - but it can help to read stripped xml files too. */
+                sChildType = XMLHelper.getTypeForTag(sChildName);
+                if (sChildType == null)
+                    throw new java.io.IOException("unsupported format: could not extract child node type");
+            }
+
+            // read its value(s?)
+            java.util.Vector      lChildValues = XMLHelper.extractChildNodesByTagName(aChildNode, XMLTAG_VALUE);
+            java.util.Enumeration en2          = lChildValues.elements();
+            int                   nValue       = 0;
+            java.lang.Object      aValue       = null;
+            while(en2.hasMoreElements())
+            {
+                org.w3c.dom.Node aValueNode   = (org.w3c.dom.Node)en2.nextElement();
+                java.lang.String sChildLocale = XMLHelper.extractNodeAttribByName(aValueNode, XMLATTRIB_XML_LANG);
+                boolean          bLocalized   = (sChildLocale != null);
+
+                ++nValue;
+
+                if (sChildType.equals(XMLTYPE_INTEGER))
+                {
+                    if (!bLocalized && nValue > 1)
+                        throw new java.io.IOException("unsupported format: more then one value for non localized but atomic type detected");
+                    java.lang.String sData = ((org.w3c.dom.CharacterData)aValueNode.getFirstChild()).getData();
+                    aValue = new java.lang.Integer(sData);
+                }
+                else
+                if (sChildType.equals(XMLTYPE_BOOLEAN))
+                {
+                    if (!bLocalized && nValue > 1)
+                        throw new java.io.IOException("unsupported format: more then one value for non localized but atomic type detected");
+                    java.lang.String sData = ((org.w3c.dom.CharacterData)aValueNode.getFirstChild()).getData();
+                    aValue = new java.lang.Boolean(sData);
+                }
+                else
+                if (sChildType.equals(XMLTYPE_STRING))
+                {
+                    if (!bLocalized && nValue > 1)
+                        throw new java.io.IOException("unsupported format: more then one value for non localized but atomic type detected");
+
+                    java.lang.String sData = ((org.w3c.dom.CharacterData)aValueNode.getFirstChild()).getData();
+
+                    java.util.HashMap lLocalized = null;
+                    if (bLocalized)
+                    {
+                        if (aValue == null)
+                            aValue = new java.util.HashMap();
+                        lLocalized = (java.util.HashMap)aValue;
+                        lLocalized.put(sChildLocale, sData);
+                    }
+                    else
+                        aValue = sData;
+                }
+                else
+                if (sChildType.equals(XMLTYPE_STRINGLIST))
+                {
+                    if (!bLocalized && nValue > 1)
+                        throw new java.io.IOException("unsupported format: more then one value for non localized but atomic type detected");
+
+                    java.lang.String sSeparator = XMLHelper.extractNodeAttribByName(aChildNode, XMLATTRIB_OOR_SEPARATOR);
+                    if (sSeparator == null)
+                        sSeparator = " ";
+
+                    java.lang.String          sData      = ((org.w3c.dom.CharacterData)aValueNode.getFirstChild()).getData();
+                    sData = sData.replace('\t', ' ');
+                    sData = sData.replace('\n', ' ');
+                    java.util.StringTokenizer aTokenizer = new java.util.StringTokenizer(sData, sSeparator);
+                    java.util.Vector          lList      = new java.util.Vector();
+                    while(aTokenizer.hasMoreTokens())
+                    {
+                        java.lang.String sToken = (java.lang.String)aTokenizer.nextToken();
+                        sToken.trim();
+                        if (sToken.length() < 1)
+                            continue;
+                        lList.add(sToken);
+                    }
+                    aValue = lList;
+                }
+
+                aPropSet.put(sChildName, aValue);
+            }
+        }
+
+        return aPropSet;
+    }
+
+    //___________________________________________
+
+    private static java.lang.String getTypeForTag(java.lang.String sTag)
+    {
+        java.lang.String sType = null;
+
+        if (
+            (sTag.equals(Cache.PROPNAME_DATA            )) ||
+            (sTag.equals(Cache.PROPNAME_NAME            )) ||
+            (sTag.equals(Cache.PROPNAME_UINAME          )) ||
+            (sTag.equals(Cache.PROPNAME_MEDIATYPE       )) ||
+            (sTag.equals(Cache.PROPNAME_CLIPBOARDFORMAT )) ||
+            (sTag.equals(Cache.PROPNAME_PREFERREDFILTER )) ||
+            (sTag.equals(Cache.PROPNAME_DETECTSERVICE   )) ||
+            (sTag.equals(Cache.PROPNAME_FRAMELOADER     )) ||
+            (sTag.equals(Cache.PROPNAME_CONTENTHANDLER  )) ||
+            (sTag.equals(Cache.PROPNAME_DOCUMENTSERVICE )) ||
+            (sTag.equals(Cache.PROPNAME_FILTERSERVICE   )) ||
+            (sTag.equals(Cache.PROPNAME_TEMPLATENAME    )) ||
+            (sTag.equals(Cache.PROPNAME_TYPE            )) ||
+            (sTag.equals(Cache.PROPNAME_UICOMPONENT     ))
+           )
+            sType = XMLTYPE_STRING;
+        else
+        if (
+            (sTag.equals(Cache.PROPNAME_PREFERRED   )) ||
+            (sTag.equals("Installed"                ))
+           )
+            sType = XMLTYPE_BOOLEAN;
+        else
+        if (
+            (sTag.equals(Cache.PROPNAME_UIORDER          )) ||
+            (sTag.equals(Cache.PROPNAME_DOCUMENTICONID   )) ||
+            (sTag.equals(Cache.PROPNAME_FILEFORMATVERSION))
+           )
+            sType = XMLTYPE_INTEGER;
+        else
+        if (
+            (sTag.equals(Cache.PROPNAME_URLPATTERN  )) ||
+            (sTag.equals(Cache.PROPNAME_EXTENSIONS  )) ||
+            (sTag.equals(Cache.PROPNAME_USERDATA    )) ||
+            (sTag.equals(Cache.PROPNAME_FLAGS       )) ||
+            (sTag.equals(Cache.PROPNAME_TYPES       ))
+           )
+            sType = XMLTYPE_STRINGLIST;
+
+        if (sType == null)
+            System.err.println("getTypeForTag("+sTag+") = "+sType);
+
+        return sType;
+    }
+
+    //___________________________________________
+
+    /** return a xml representation of the given property set.
+     *
+     *  @param  aPropSet
+     *          a set of <name,value> pairs, which should be translated to xml
+     *
+     *  @return [java.lang.String]
+     *          the xml string representation.
+     *
+     *  @throws [java.lang.Exception]
+     *          if anything during convertion fill fail.
+     */
+    public static java.lang.String convertPropSetToXML(java.util.HashMap aPropSet   ,
+                                                       int               nPrettyTabs)
+        throws java.lang.Exception
+    {
+        java.lang.StringBuffer sXML = new java.lang.StringBuffer(256);
+
+        java.util.Iterator it1 = aPropSet.keySet().iterator();
+        while(it1.hasNext())
+        {
+            java.lang.String sProp = (java.lang.String)it1.next();
+            java.lang.Object aVal  = aPropSet.get(sProp);
+
+            sProp = encodeHTMLSigns(sProp);
+
+            // is it a simple type?
+            if (
+                (aVal instanceof java.lang.Integer) ||
+                (aVal instanceof java.lang.Boolean) ||
+                (aVal instanceof java.lang.String )
+               )
+            {
+                sXML.append(XMLHelper.convertSimpleObjectToXML(sProp, aVal, nPrettyTabs));
+                continue;
+            }
+
+            // no!
+            // is it a list value?
+            if (aVal instanceof java.util.Vector)
+            {
+                java.util.Vector lVal = (java.util.Vector)aVal;
+                sXML.append(XMLHelper.convertListToXML(sProp, lVal, nPrettyTabs));
+                continue;
+            }
+
+            // its a localized value?
+            if (aVal instanceof java.util.HashMap)
+            {
+                java.util.HashMap lVal = (java.util.HashMap)aVal;
+                sXML.append(XMLHelper.convertLocalizedValueToXML(sProp, lVal, nPrettyTabs));
+                continue;
+            }
+
+            // unknown type!
+            java.lang.StringBuffer sMsg = new java.lang.StringBuffer(256);
+            sMsg.append("unsupported object type detected.");
+            sMsg.append("\ttype ?  : \""+sProp+"\" = "+aVal);
+            sMsg.append("\tprop set: \""+aPropSet          );
+            throw new java.lang.Exception(sMsg.toString());
+        }
+
+        return sXML.toString();
+    }
+
+    public static java.lang.String encodeHTMLSigns(java.lang.String sValue)
+    {
+        java.lang.StringBuffer sSource      = new java.lang.StringBuffer(sValue);
+        java.lang.StringBuffer sDestination = new java.lang.StringBuffer(1000  );
+
+        for (int i=0; i<sSource.length(); ++i)
+        {
+            char c = sSource.charAt(i);
+            if (c == '&')
+                sDestination.append("&amp;");
+            else
+                sDestination.append(c);
+        }
+
+        java.lang.String sReturn = sDestination.toString();
+        if (!sReturn.equals(sValue))
+            System.out.println("encode \""+sValue+"\" => \""+sReturn+"\"");
+
+        return sReturn;
+    }
+
+    //___________________________________________
+
+    /** return a xml representation of an atomic property.
+     *
+     *  Atomic property types are e.g. Integer, Boolean, String.
+     *
+     *  @param  sName
+     *          the name of the property.
+
+     *  @param  aValue
+     *          the value of the property.
+     *
+     *  @param  nPrettyTabs
+     *          count of tab signs for pretty format the xml code :-)
+     *
+     *  @return [java.lang.String]
+     *          the xml string representation.
+     *
+     *  @throws [java.lang.Exception]
+     *          if anything during convertion fill fail.
+     */
+    private static java.lang.String convertSimpleObjectToXML(java.lang.String sName      ,
+                                                             java.lang.Object aValue     ,
+                                                             int              nPrettyTabs)
+        throws java.lang.Exception
+    {
+        java.lang.StringBuffer sXML = new java.lang.StringBuffer(256);
+        for (int t=0; t<nPrettyTabs; ++t)
+            sXML.append("\t");
+
+        if (aValue instanceof java.lang.Integer)
+        {
+            sXML.append("<prop "+XMLATTRIB_OOR_NAME+"=\""+sName+"\">");
+            sXML.append("<value>"+aValue.toString()+"</value>");
+            sXML.append("</prop>\n");
+        }
+        else
+        if (aValue instanceof java.lang.Boolean)
+        {
+            sXML.append("<prop "+XMLATTRIB_OOR_NAME+"=\""+sName+"\">");
+            sXML.append("<value>"+aValue.toString()+"</value>");
+            sXML.append("</prop>\n");
+        }
+        else
+        if (aValue instanceof java.lang.String)
+        {
+            sXML.append("<prop "+XMLATTRIB_OOR_NAME+"=\""+sName+"\"");
+            java.lang.String sValue = (java.lang.String)aValue;
+
+            sValue = encodeHTMLSigns(sValue);
+
+            if (sValue.length() < 1)
+                sXML.append("/>\n");
+            else
+            {
+                sXML.append("><value>"+sValue+"</value>");
+                sXML.append("</prop>\n");
+            }
+        }
+        else
+        {
+            System.err.println("name  = "+sName);
+            System.err.println("value = "+aValue);
+            // ! can be used outside to detect - that it was not a simple type :-)
+            throw new java.lang.Exception("not an atomic type.");
+        }
+
+        return sXML.toString();
+    }
+
+    //___________________________________________
+
+    /** return a xml representation of a string-list property.
+     *
+     *  @param  sName
+     *          the name of the property.
+
+     *  @param  aValue
+     *          the value of the property.
+     *
+     *  @param  nPrettyTabs
+     *          count of tab signs for pretty format the xml code :-)
+     *
+     *  @return [java.lang.String]
+     *          the xml string representation.
+     *
+     *  @throws [java.lang.Exception]
+     *          if anything during convertion fill fail.
+     */
+    private static java.lang.String convertListToXML(java.lang.String sName      ,
+                                                     java.util.Vector aValue     ,
+                                                     int              nPrettyTabs)
+        throws java.lang.Exception
+    {
+        java.lang.StringBuffer sXML = new java.lang.StringBuffer(256);
+
+        for (int t=0; t<nPrettyTabs; ++t)
+            sXML.append("\t");
+
+        int c = aValue.size();
+        if (c < 1)
+        {
+            sXML.append("<prop "+XMLATTRIB_OOR_NAME+"=\""+sName+"\"/>\n");
+            return sXML.toString();
+        }
+
+        // step over all list items and add it to a string buffer
+        // Every item will be separated by a default separator "\n" first.
+        // Because "\n" is not a valid separator at all and can`t occure inside
+        // our list items. During we step over all items, we check if our current separator
+        // (we use a list of possible ones!) clash with an item.
+        // If it clash - we step to the next possible separator.
+        // If our list of possible separator values runs out of range we throw
+        // an exception :-) Its better then generating of wrong values
+        // If we found a valid seperator - we use it to replace our "\n" place holder
+        // at the end of the following loop ...
+
+        int                    d        = 0;
+        java.lang.StringBuffer sValBuff = new java.lang.StringBuffer(256);
+        for (int i=0; i<c; ++i)
+        {
+            // get the next list item
+            java.lang.Object aItem = aValue.get(i);
+            if (!(aItem instanceof java.lang.String))
+                throw new java.lang.Exception("Current implementation supports string-list only!");
+
+            java.lang.String sValue = (java.lang.String)aItem;
+
+            sValue = encodeHTMLSigns(sValue);
+
+            // append item with default separator, which isn a valid separator at all
+            // But supress adding of the separator if last element is reached.
+            sValBuff.append(sValue);
+            if (i<(c-1))
+                sValBuff.append("\n");
+
+            // check for delim clash
+            // Attention: An empty (means default) element forbid using
+            // of a whitespace character as separator!
+            while(true)
+            {
+                if (d >= DELIMS.length)
+                    throw new java.lang.Exception("No valid separator found for a string list item.");
+                if (sValue.length() < 1 && DELIMS[d].equals(" "))
+                {
+                    ++d;
+                    continue;
+                }
+                if (sValue.indexOf(DELIMS[d]) != -1)
+                {
+                    ++d;
+                    continue;
+                }
+                break;
+            }
+        }
+
+        // replace default separator with right one
+        System.out.println("TODO: must be adapted to java 1.3 :-(");
+        System.exit(-1);
+//TODO_JAVA        java.lang.String sListVal = sValBuff.toString().replaceAll("\n", DELIMS[d]);
+        java.lang.String sListVal = null;
+
+        sXML.append("<prop "+XMLATTRIB_OOR_NAME+"=\""+sName+"\">");
+        if (d == DEFAULT_SEPARATOR)
+            sXML.append("<value>");
+        else
+            sXML.append("<value "+XMLATTRIB_OOR_SEPARATOR+"=\""+DELIMS[d]+"\">");
+        sXML.append(sListVal);
+        sXML.append("</value>");
+        sXML.append("</prop>\n");
+
+        return sXML.toString();
+    }
+
+    //___________________________________________
+
+    /** return a xml representation of a localized property.
+     *
+     *  @param  sName
+     *          the name of the property.
+
+     *  @param  aValue
+     *          the value of the property.
+     *
+     *  @param  nPrettyTabs
+     *          count of tab signs for pretty format the xml code :-)
+     *
+     *  @return [java.lang.String]
+     *          the xml string representation.
+     *
+     *  @throws [java.lang.Exception]
+     *          if anything during convertion fill fail.
+     */
+    private static java.lang.String convertLocalizedValueToXML(java.lang.String  sName      ,
+                                                               java.util.HashMap aValue     ,
+                                                               int               nPrettyTabs)
+        throws java.lang.Exception
+    {
+        java.lang.StringBuffer sXML = new java.lang.StringBuffer(256);
+
+        int c = aValue.size();
+        if (c < 1)
+            throw new java.lang.Exception("Cant detect type of localized values. Because the given list is empty.");
+
+        for (int t=0; t<nPrettyTabs; ++t)
+            sXML.append("\t");
+        // !Our localized values must be formated at a deeper coloum
+        // then its property name!
+        ++nPrettyTabs;
+
+        sXML.append("<prop "+XMLATTRIB_OOR_NAME+"=\""+sName+"\">\n");
+        java.util.Iterator it = aValue.keySet().iterator();
+//        boolean bTypeKnown = false;
+        while(it.hasNext())
+        {
+            java.lang.String sLocale = (java.lang.String)it.next();
+            java.lang.Object aLocalizedValue = aValue.get(sLocale);
+/*
+            if (!bTypeKnown)
+            {
+                bTypeKnown = true;
+                if (aLocalizedValue instanceof java.lang.Integer)
+                    sXML.append(" "+XMLATTRIB_OOR_TYPE+"=\""+XMLTYPE_INTEGER+"\">\n");
+                else
+                if (aLocalizedValue instanceof java.lang.Boolean)
+                    sXML.append(" "+XMLATTRIB_OOR_TYPE+"=\""+XMLTYPE_BOOLEAN+"\">\n");
+                else
+                if (aLocalizedValue instanceof java.lang.String)
+                    sXML.append(" "+XMLATTRIB_OOR_TYPE+"=\""+XMLTYPE_STRING+"\">\n");
+                else
+                    throw new java.lang.Exception("Unsupported type for localized value detected.");
+            }
+*/
+            java.lang.String sLocValue = aLocalizedValue.toString();
+            java.lang.String sValue    = encodeHTMLSigns(sLocValue);
+
+            for (int t=0; t<nPrettyTabs; ++t)
+                sXML.append("\t");
+            sXML.append("<value "+XMLATTRIB_XML_LANG+"=\""+sLocale+"\">"+sValue+"</value>\n");
+        }
+        --nPrettyTabs;
+        for (int t=0; t<nPrettyTabs; ++t)
+            sXML.append("\t");
+        sXML.append("</prop>\n");
+
+        return sXML.toString();
+    }
+
+    //___________________________________________
+
+    /** returns the value of an attribute of the given node.
+     *
+     *  If the given node represent an lement node, may it supports some attributes.
+     *  Then this method search for an attribute with the specified name and return it's value.
+     *  If nothing could be found ... or the given node isn't a suitable node ... it returns null.
+     *
+     *  @param  aNode
+     *          the node, which should be analyzed.
+     *
+     *  @param  sAttrib
+     *          name of the attribute, which should be searched.
+     *
+     *  @return The value of the specified attribute if it could be found at the given node.
+     *          Can be null if node doesn't support attributes or the searched one does not exist there.
+     */
+    public static java.lang.String extractNodeAttribByName(org.w3c.dom.Node aNode  ,
+                                                           java.lang.String sAttrib)
+        throws java.lang.Exception
+    {
+        // We can get valid attributes for element nodes only!
+        if (aNode.getNodeType() != org.w3c.dom.Node.ELEMENT_NODE)
+        {
+//            System.err.println("not an element node");
+            return null;
+        }
+
+        // may it supports attributes in general ... but doesn't have anyone realy.
+        org.w3c.dom.NamedNodeMap lAttribs = aNode.getAttributes();
+        if (lAttribs==null)
+        {
+//            System.err.println("no attributes at all");
+            return null;
+        }
+
+        // step over the attribute list and search for the requested one
+        for (int i=0; i<lAttribs.getLength(); ++i)
+        {
+            org.w3c.dom.Attr aAttrib = (org.w3c.dom.Attr)lAttribs.item(i);
+            if (aAttrib.getName().equals(sAttrib))
+            {
+                java.lang.String sValue = aAttrib.getValue();
+                return sValue;
+            }
+        }
+
+        // the searched attribute was not found!
+//        System.err.println("required attribute \""+sAttrib+"\" does not exist for node ["+aNode.toString()+"]");
+        return null;
+    }
+
+    //___________________________________________
+
+    /** returns a list of childs, which are ELEMENT_NODES and have the right tag name.
+     *
+     *  It analyze the list of all possible child nodes. Only ELEMENT_NODES are candidates.
+     *  All other ones will be ignored. Further these element nodes are compared by it's tag
+     *  names. If it match with the specified value it's added to the return list.
+     *  So the return list includes references to the DOM tree nodes only, which are child
+     *  element nodes with the right tag name.
+     *
+     *  @param  aNode
+     *          provides access to the child nodes, which should be analyzed
+     *
+     *  @param  sTag
+     *          the searched tag name.
+     *
+     * @return  A list of child nodes, which are element nodes and have the right tag name.
+     */
+    public static java.util.Vector extractChildNodesByTagName(org.w3c.dom.Node aNode,
+                                                               java.lang.String sTag )
+    {
+        // extract first all ELEMENT_NODES of he given parent
+        // Such nodes only provide tag names.
+        java.util.Vector lChilds          = XMLHelper.extractChildNodesByType(aNode,org.w3c.dom.Node.ELEMENT_NODE);
+        java.util.Vector lExtractedChilds = new java.util.Vector(lChilds.size());
+
+        // step over the list and search for the right tags using the specified name
+        java.util.Enumeration en = lChilds.elements();
+        while (en.hasMoreElements())
+        {
+            org.w3c.dom.Node aChild = (org.w3c.dom.Node)en.nextElement();
+            if (aChild.getNodeName().equals(sTag))
+                lExtractedChilds.add(aChild);
+        }
+
+        // pack(!) and return the list
+        lExtractedChilds.trimToSize();
+        return lExtractedChilds;
+    }
+
+    //___________________________________________
+
+    /** returns a list of childs, which supports the right node type.
+     *
+     *  It analyze the list of all possible child nodes. If a node represent the right node type
+     *  it is added to the return list. Otherwhise it will be ignored.
+     *
+     *  @param  aNode
+     *          provides access to the list of possible children nodes.
+     *
+     *  @param  nType
+     *          represent the searched node type.
+     *          Possible values are constant fields of a org.w3c.dom.Node - e.g. org.w3c.dom.Node.ELEMENT_NODE.
+     *
+     * @return A list of child nodes, which provides the right node type.
+     */
+    public static java.util.Vector extractChildNodesByType(org.w3c.dom.Node aNode,
+                                                           short            nType)
+    {
+        // get list of all possibe childs and reserve enough space for our return list
+        // Attention: A null pointer is not allowed for return! (means lExtractedChilds)
+        org.w3c.dom.NodeList lChilds          = aNode.getChildNodes();
+        int                  c                = lChilds.getLength();
+        java.util.Vector     lExtractedChilds = new java.util.Vector(c);
+
+        // step of these childs and select only needed ones
+        for (int i=0; i<c; ++i)
+        {
+            org.w3c.dom.Node aChild = lChilds.item(i);
+            if (aChild.getNodeType() == nType)
+                lExtractedChilds.add(aChild);
+        }
+
+        // pack(!) and return the list
+        lExtractedChilds.trimToSize();
+        return lExtractedChilds;
+    }
+
+    //___________________________________________
+
+    /** generates an xml header, using parameters.
+     *
+     *  @param  sVersion
+     *          number of the xml version.
+     *
+     *  @param  sEncoding
+     *          used file encoding.
+     *
+     *  @param  sPath
+     *          name of the configuration root.
+     *
+     *  @param  sPackage
+     *          name of the configuration package.
+     *
+     *  @param  bLanguagepack     
+     *          force creation of a special header,
+     *          which is needed for language packs only.
+     *
+     *  @return [java.lang.String]
+     *          the generated xml header.
+
+*/
+    public static java.lang.String generateHeader(java.lang.String sVersion     ,
+                                                  java.lang.String sEncoding    ,
+                                                  java.lang.String sPath        ,
+                                                  java.lang.String sPackage     ,
+                                                  boolean          bLanguagePack)
+    {
+        java.lang.StringBuffer sHeader = new java.lang.StringBuffer(256);
+
+        if (bLanguagePack)
+        {
+            sHeader.append("<?xml version=\"");
+            sHeader.append(sVersion);
+            sHeader.append("\" encoding=\"");
+            sHeader.append(sEncoding);
+            sHeader.append("\"?>\n");
+            sHeader.append("<oor:component-data oor:package=\"");
+            sHeader.append(sPath);
+            sHeader.append("\" oor:name=\"");
+            sHeader.append(sPackage);
+            sHeader.append("\" xmlns:install=\"http://openoffice.org/2004/installation\"");
+            sHeader.append(" xmlns:oor=\"http://openoffice.org/2001/registry\"");
+            sHeader.append(" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\"");
+            sHeader.append(" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n");
+        }
+        else
+        {
+            sHeader.append("<?xml version=\"");
+            sHeader.append(sVersion);
+            sHeader.append("\" encoding=\"");
+            sHeader.append(sEncoding);
+            sHeader.append("\"?>\n<!DOCTYPE oor:component-data SYSTEM \"../../../../component-update.dtd\">\n");
+            sHeader.append("<oor:component-data xmlns:oor=\"http://openoffice.org/2001/registry\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" oor:package=\"");
+            sHeader.append(sPath);
+            sHeader.append("\" oor:name=\"");
+            sHeader.append(sPackage);
+            sHeader.append("\">\n");
+        }
+        
+        return sHeader.toString();
+    }
+
+    public static java.lang.String generateFooter()
+    {
+        return "</oor:component-data>\n";
+    }
+}
diff --git filter/source/config/tools/utils/makefile.mk filter/source/config/tools/utils/makefile.mk
new file mode 100644
index 0000000..2963996
--- /dev/null
+++ filter/source/config/tools/utils/makefile.mk
@@ -0,0 +1,68 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile.mk,v $
+#
+# $Revision: 1.9.98.2 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+PRJ = ..$/..$/..$/..
+TARGET  = FCFGUtils
+PRJNAME = filter
+PACKAGE = com$/sun$/star$/filter$/config$/tools$/utils
+
+# --- Settings -----------------------------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+.INCLUDE: settings.mk
+
+#----- compile .java files -----------------------------------------
+
+JARFILES        =   \
+                    ridl.jar        \
+                    unoil.jar       \
+                    jurt.jar        \
+                    juh.jar         \
+                    java_uno.jar
+
+JAVACLASSFILES  =   \
+                    $(CLASSDIR)$/$(PACKAGE)$/AnalyzeStartupLog.class              \
+                    $(CLASSDIR)$/$(PACKAGE)$/ConfigHelper.class                   \
+                    $(CLASSDIR)$/$(PACKAGE)$/Logger.class                         \
+                    $(CLASSDIR)$/$(PACKAGE)$/FileHelper.class                     \
+                    $(CLASSDIR)$/$(PACKAGE)$/MalformedCommandLineException.class  \
+                    $(CLASSDIR)$/$(PACKAGE)$/Cache.class                          \
+                    $(CLASSDIR)$/$(PACKAGE)$/XMLHelper.class
+
+MAXLINELENGTH   =   100000
+
+# --- targets -----------------------------------------------------
+
+.INCLUDE :  target.mk
diff --git filter/source/svg/makefile.mk filter/source/svg/makefile.mk
index 17b999c..e08dc07 100644
--- filter/source/svg/makefile.mk
+++ filter/source/svg/makefile.mk
@@ -47,7 +47,8 @@ SLOFILES=	$(SLO)$/svguno.obj			\
             $(SLO)$/svgexport.obj		\
             $(SLO)$/svgfontexport.obj	\
             $(SLO)$/svgwriter.obj	
-.IF "$(SOLAR_JAVA)"!=""
+
+.IF "$(SOLAR_JAVA)"!="" && "$(OOo4Kids)"!="YES"
 SLOFILES+=		$(SLO)$/svgimport.obj
 .ENDIF
 
@@ -67,7 +68,7 @@ SHL1STDLIBS=\
     $(CPPULIB)			\
     $(SALLIB) 
 
-.IF "$(SOLAR_JAVA)"!=""
+.IF "$(SOLAR_JAVA)"!="" && "$(OOo4Kids)"!="YES"
 SHL1STDLIBS+=\
     $(JVMACCESSLIB)
 .ENDIF
diff --git filter/source/svg/svgfilter.cxx filter/source/svg/svgfilter.cxx
index 2a42569..84b2773 100644
--- filter/source/svg/svgfilter.cxx
+++ filter/source/svg/svgfilter.cxx
@@ -83,7 +83,7 @@ sal_Bool SAL_CALL SVGFilter::filter( const Sequence< PropertyValue >& rDescripto
     if( pFocusWindow )
         pFocusWindow->EnterWait();
 
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     if( mxDstDoc.is() )
         bRet = implImport( rDescriptor );
     else
@@ -156,7 +156,7 @@ void SAL_CALL SVGFilter::setSourceDocument( const Reference< XComponent >& xDoc
 
 // -----------------------------------------------------------------------------
 
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 void SAL_CALL SVGFilter::setTargetDocument( const Reference< XComponent >& xDoc ) 
     throw (::com::sun::star::lang::IllegalArgumentException, RuntimeException)
 {
diff --git filter/source/svg/svgfilter.hxx filter/source/svg/svgfilter.hxx
index 7a338b3..7f41011 100644
--- filter/source/svg/svgfilter.hxx
+++ filter/source/svg/svgfilter.hxx
@@ -38,7 +38,7 @@
 #include <com/sun/star/drawing/XMasterPagesSupplier.hpp>
 #include <com/sun/star/presentation/XPresentationSupplier.hpp>
 #include <com/sun/star/document/XFilter.hpp>
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
 #include <com/sun/star/document/XImporter.hpp>
 #endif // SOLAR_JAVA
 #include <com/sun/star/document/XExporter.hpp>
@@ -47,7 +47,7 @@
 #include <com/sun/star/beans/XPropertySet.hpp>
 #include <com/sun/star/lang/XComponent.hpp>
 #include <cppuhelper/implbase1.hxx>
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
 #include <cppuhelper/implbase5.hxx>
 #else // !SOLAR_JAVA
 #include <cppuhelper/implbase4.hxx>
@@ -178,7 +178,7 @@ class SVGFontExport;
 class SVGActionWriter;
 class EditFieldInfo;
 
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
 class SVGFilter : public cppu::WeakImplHelper5 < XFilter,
                                                  XImporter,
                                                  XExporter,
@@ -206,13 +206,13 @@ private:
 
     ObjectMap*							mpObjects;
     Reference< XComponent >				mxSrcDoc;
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
     Reference< XComponent >				mxDstDoc;
 #endif
     Reference< XDrawPage > 				mxDefaultPage;
     Link								maOldFieldHdl;
 
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
     sal_Bool                            implImport( const Sequence< PropertyValue >& rDescriptor ) throw (RuntimeException);
 #endif
 
@@ -253,7 +253,7 @@ protected:
     virtual sal_Bool SAL_CALL filter( const Sequence< PropertyValue >& rDescriptor ) throw(RuntimeException);
     virtual void SAL_CALL cancel( ) throw (RuntimeException);
 
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
     // XImporter
     virtual void SAL_CALL setTargetDocument( const Reference< XComponent >& xDoc ) throw(IllegalArgumentException, RuntimeException);
 #endif
diff --git filter/source/xsltfilter/makefile.mk filter/source/xsltfilter/makefile.mk
index 1746abe..4fc920c 100644
--- filter/source/xsltfilter/makefile.mk
+++ filter/source/xsltfilter/makefile.mk
@@ -59,7 +59,7 @@ SHL1STDLIBS= \
     $(XMLOFFLIB) \
     $(SALLIB)
 
-.IF "$(SOLAR_JAVA)"!=""
+.IF "$(SOLAR_JAVA)"!="" && "$(OOo4Kids)"!="YES"
 
 #USE_UDK_EXTENDED_MANIFESTFILE=TRUE
 #USE_EXTENDED_MANIFESTFILE=TRUE
@@ -78,7 +78,7 @@ JAVACLASSFILES=$(CLASSDIR)$/XSLTransformer.class  $(CLASSDIR)$/XSLTFilterOLEExtr
 
 # --- Targets ------------------------------------------------------
 .INCLUDE :  target.mk
-.IF "$(SOLAR_JAVA)"!=""
+.IF "$(SOLAR_JAVA)"!="" && "$(OOo4Kids)"!="YES"
 $(JAVACLASSFILES) : $(CLASSDIR)
 
 $(CLASSDIR) :
diff --git filter/source/xsltvalidate/makefile.mk filter/source/xsltvalidate/makefile.mk
index 1388386..f39d493 100644
--- filter/source/xsltvalidate/makefile.mk
+++ filter/source/xsltvalidate/makefile.mk
@@ -68,7 +68,7 @@ JAVACLASSFILES=$(CLASSDIR)$/XSLTValidate.class
 #$(OUT)$/class$/$(TARGET)$/META-INF: META-INF
 #        + $(COPY) $(COPYRECURSE) META-INF $(OUT)$/class$/META-INF
 # --- Targets ------------------------------------------------------  
-.IF "$(SOLAR_JAVA)"!=""
+.IF "$(SOLAR_JAVA)"!="" && "$(OOo4Kids)"!="YES"
 .INCLUDE :  target.mk 
 $(JAVACLASSFILES) : $(CLASSDIR)
 .IF "$(JARMANIFEST)"!=""
diff --git fpicker/source/aqua/FilterHelper.cxx fpicker/source/aqua/FilterHelper.cxx
index 75996f2..e14f1a3 100644
--- fpicker/source/aqua/FilterHelper.cxx
+++ fpicker/source/aqua/FilterHelper.cxx
@@ -392,6 +392,9 @@ throw (::com::sun::star::lang::IllegalArgumentException, ::com::sun::star::uno::
 
 sal_Bool FilterHelper::filenameMatchesFilter(NSString* sFilename)
 {
+    if( !sFilename ) 
+    return false;
+
     DBG_PRINT_ENTRY(CLASS_NAME, __func__);
 
 //    OSL_TRACE("filter event handler called");
diff --git fpicker/source/aqua/makefile.mk fpicker/source/aqua/makefile.mk
index e6a8247..3ff2598 100644
--- fpicker/source/aqua/makefile.mk
+++ fpicker/source/aqua/makefile.mk
@@ -51,6 +51,7 @@ dummy:
     @echo "Nothing to build. GUIBASE == $(GUIBASE)"
 
 .ELSE # we build for aqua
+
 CFLAGSCXX+=$(OBJCXXFLAGS)
 
 # --- Files --------------------------------------------------------
diff --git fpicker/util/makefile.pmk fpicker/util/makefile.pmk
new file mode 100644
index 0000000..15e00b8
--- /dev/null
+++ fpicker/util/makefile.pmk
@@ -0,0 +1,35 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile.pmk,v $
+#
+# $Revision: 1.3 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+.IF "$(GUIBASE)"=="aqua"
+OBJCXXFLAGS=-x objective-c++ -fobjc-exceptions
+CFLAGSCXX+=$(OBJCXXFLAGS)
+.ENDIF  # "$(GUIBASE)"=="aqua"
diff --git framework/inc/framework.hrc framework/inc/framework.hrc
index 068bdd0..1929a2e 100644
--- framework/inc/framework.hrc
+++ framework/inc/framework.hrc
@@ -54,22 +54,26 @@
 #define STR_BACKING_CREATE                  3
 #define STR_BACKING_TEMPLATE                4
 #define STR_BACKING_FILE                    5
-#define BMP_BACKING_WRITER                  6
-#define BMP_BACKING_CALC                    7
-#define BMP_BACKING_IMPRESS                 8
-#define BMP_BACKING_DRAW                    9
-#define BMP_BACKING_DATABASE                10
-#define BMP_BACKING_FORMULA                 11
-#define BMP_BACKING_OPENFILE                12
-#define BMP_BACKING_OPENTEMPLATE            13
-#define BMP_BACKING_EXT                     14
-#define STR_BACKING_EXTHELP                 15
-#define BMP_BACKING_REG                     16
-#define STR_BACKING_REGHELP                 17
-#define BMP_BACKING_INFO                    18
-#define STR_BACKING_INFOHELP                19
-#define BMP_BACKING_TPLREP                  20
-#define STR_BACKING_TPLREP                  21
+#define STR_BACKING_CALC                    6
+#define STR_BACKING_DRAW                    7
+#define STR_BACKING_IMPRESS                 8
+#define STR_BACKING_WRITER                  9
+#define BMP_BACKING_WRITER                  10
+#define BMP_BACKING_CALC                    11
+#define BMP_BACKING_IMPRESS                 12
+#define BMP_BACKING_DRAW                    13
+#define BMP_BACKING_DATABASE                14
+#define BMP_BACKING_FORMULA                 15
+#define BMP_BACKING_OPENFILE                16
+#define BMP_BACKING_OPENTEMPLATE            17
+#define BMP_BACKING_EXT                     18
+#define STR_BACKING_EXTHELP                 19
+#define BMP_BACKING_REG                     20
+#define STR_BACKING_REGHELP                 21
+#define BMP_BACKING_INFO                    22
+#define STR_BACKING_INFOHELP                23
+#define BMP_BACKING_TPLREP                  24
+#define STR_BACKING_TPLREP                  25
 
 #define RES_BACKING_IMAGES                  (DLG_BACKING+1)
 #define RES_BACKING_IMAGES_HC               (DLG_BACKING+2)
@@ -79,6 +83,7 @@
 #define BMP_BACKING_BACKGROUND_RIGHT        3
 #define BMP_BACKING_BACKGROUND_RTL_LEFT     4
 #define BMP_BACKING_BACKGROUND_RTL_RIGHT    5
+#define BMP_BACKING_BACKGROUND_MONOBLOCK    6
 
 // Ids of TabWindow
 #define WIN_TABWINDOW                       (RID_FWK_DIALOG_START+101)
diff --git framework/source/dispatch/windowcommanddispatch.cxx framework/source/dispatch/windowcommanddispatch.cxx
index 531d680..54c8707 100755
--- framework/source/dispatch/windowcommanddispatch.cxx
+++ framework/source/dispatch/windowcommanddispatch.cxx
@@ -69,6 +69,7 @@ namespace css = ::com::sun::star;
 
 const ::rtl::OUString WindowCommandDispatch::COMMAND_PREFERENCES = ::rtl::OUString::createFromAscii(".uno:OptionsTreeDialog");
 const ::rtl::OUString WindowCommandDispatch::COMMAND_ABOUTBOX    = ::rtl::OUString::createFromAscii(".uno:About");
+const ::rtl::OUString WindowCommandDispatch::COMMAND_LICENSEBOX    = ::rtl::OUString::createFromAscii(".uno:ShowLicense");
 
 //-----------------------------------------------
 WindowCommandDispatch::WindowCommandDispatch(const css::uno::Reference< css::lang::XMultiServiceFactory >& xSMGR ,
@@ -151,6 +152,9 @@ IMPL_LINK(WindowCommandDispatch, impl_notifyCommand, void*, pParam)
                 sCommand = WindowCommandDispatch::COMMAND_ABOUTBOX;
                 break;
         
+        case SHOWDIALOG_ID_LICENSE :
+                sCommand = WindowCommandDispatch::COMMAND_LICENSEBOX;
+                break;
         default :
                 return 0L;
     }
diff --git framework/source/inc/dispatch/windowcommanddispatch.hxx framework/source/inc/dispatch/windowcommanddispatch.hxx
index c986c7e..32acfd6 100755
--- framework/source/inc/dispatch/windowcommanddispatch.hxx
+++ framework/source/inc/dispatch/windowcommanddispatch.hxx
@@ -66,7 +66,7 @@ namespace css = ::com::sun::star;
 /** @short  internal helper to bind e.g. MAC-Menu events to our internal dispatch API.
 
     @descr  On e.g. MAC platform system menus are merged together with some fix entries as
-            e.g. "Pereferences" or "About". These menu entries trigger hard coded commands.
+            e.g. "Preferences" or "About". These menu entries trigger hard coded commands.
             Here we map these commands to the right URLs and dispatch them.
 
             This helper knows a frame and it's container window (where VCL provide the hard coded
@@ -88,6 +88,9 @@ class WindowCommandDispatch : private ThreadHelpBase
         /// dispatch URL to trigger our About box
         static const ::rtl::OUString COMMAND_ABOUTBOX;
 
+        /// dispatch URL to trigger our License box
+        static const ::rtl::OUString COMMAND_LICENSEBOX;
+
     //___________________________________________
     // member
 
diff --git framework/source/services/backingwindow-OOo4Kids.cxx framework/source/services/backingwindow-OOo4Kids.cxx
new file mode 100644
index 0000000..257663f
--- /dev/null
+++ framework/source/services/backingwindow-OOo4Kids.cxx
@@ -0,0 +1,662 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2010 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: backingwindow-OOo4Kids.cxx,v $
+ * $Revision: 1 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// autogen include statement, do not remove
+#include "precompiled_framework.hxx"
+
+#include "backingwindow.hxx"
+#include "framework.hrc"
+#include "classes/fwkresid.hxx"
+#include <services.h>
+
+#include "vcl/metric.hxx"
+#include "vcl/mnemonic.hxx"
+#include "vcl/menu.hxx"
+#include "vcl/svapp.hxx"
+
+#include "tools/urlobj.hxx"
+
+#include "svtools/dynamicmenuoptions.hxx"
+#include "svtools/imagemgr.hxx"
+#include "svtools/svtools.hrc"
+
+#include "comphelper/processfactory.hxx"
+#include "comphelper/sequenceashashmap.hxx"
+
+#include "rtl/strbuf.hxx"
+#include "rtl/ustrbuf.hxx"
+
+#include "com/sun/star/lang/XMultiServiceFactory.hpp"
+#include "com/sun/star/container/XNameAccess.hpp"
+#include "com/sun/star/system/XSystemShellExecute.hpp"
+#include "com/sun/star/system/SystemShellExecuteFlags.hpp"
+#include "com/sun/star/task/XJobExecutor.hpp"
+
+
+using namespace ::com::sun::star::beans;
+using namespace ::com::sun::star::frame;
+using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star;
+using namespace framework;
+
+#define WRITER_URL      "private:factory/swriter"
+#define CALC_URL        "private:factory/scalc"
+#define IMPRESS_WIZARD_URL     "private:factory/simpress?slot=6686"
+#define DRAW_URL        "private:factory/sdraw"
+
+#define TEMPLATE_URL    "slot:5500"
+#define OPEN_URL        ".uno:Open"
+
+#ifdef DEBUG
+#include <stdio.h>
+const sal_Char *dbg_dump(const rtl::OString &rStr)
+{
+    static rtl::OStringBuffer aStr;
+    aStr = rtl::OStringBuffer(rStr);
+    aStr.append(static_cast<char>(0));
+    return aStr.getStr();
+}
+
+const sal_Char *dbg_dump(const rtl::OUString &rStr)
+{
+    return dbg_dump(rtl::OUStringToOString(rStr, RTL_TEXTENCODING_UTF8));
+}
+
+const sal_Char *dbg_dump(rtl_String *pStr)
+{
+    return dbg_dump(rtl::OString(pStr));
+}
+
+const sal_Char *dbg_dump(rtl_uString *pStr)
+{
+    return dbg_dump(rtl::OUString(pStr));
+}
+#endif
+
+DecoToolBox::DecoToolBox( Window* pParent, WinBits nStyle ) :
+    ToolBox( pParent, nStyle )
+{
+        SetBackground();
+        SetPaintTransparent( TRUE );
+}
+
+void DecoToolBox::DataChanged( const DataChangedEvent& rDCEvt )
+{
+    Window::DataChanged( rDCEvt );
+
+    if ( rDCEvt.GetFlags() & SETTINGS_STYLE )
+    {
+        calcMinSize();
+        SetBackground();
+        SetPaintTransparent( TRUE );
+    }
+}
+
+void DecoToolBox::calcMinSize()
+{
+    ToolBox aTbx( GetParent() );
+    USHORT nItems = GetItemCount();
+    for( USHORT i = 0; i < nItems; i++ )
+    {
+        USHORT nId = GetItemId( i );
+        aTbx.InsertItem( nId, GetItemImage( nId ) );
+    }
+    aTbx.SetOutStyle( TOOLBOX_STYLE_FLAT );
+    maMinSize = aTbx.CalcWindowSizePixel(); 
+}
+
+Size DecoToolBox::getMinSize()
+{
+    return maMinSize;
+}
+
+
+BackingWindow::BackingWindow( Window* i_pParent ) :
+    Window( i_pParent, FwkResId( DLG_BACKING ) ),
+    maWelcome( this, WB_LEFT ),
+    maProduct( this, WB_LEFT ),
+    maCreateText( this, WB_LEFT ),
+    maToolbox( this, WB_DIALOGCONTROL ),
+    maWelcomeString( FwkResId( STR_BACKING_WELCOME ) ),
+    maProductString( FwkResId( STR_BACKING_WELCOMEPRODUCT ) ),
+    maCreateString( FwkResId( STR_BACKING_CREATE ) ),
+    maOpenString( FwkResId( STR_BACKING_FILE ) ),
+    mbInitControls( false ),
+    mpAccExec( NULL )
+{
+    mnColumnWidth[0] = mnColumnWidth[1] = 0;
+    
+    // Writer
+    BitmapEx aWriterHelpImage( FwkResId( BMP_BACKING_WRITER ) );
+    String aWriterHelpText( FwkResId( STR_BACKING_WRITER ) );
+    // Draw
+    BitmapEx aDrawHelpImage( FwkResId( BMP_BACKING_DRAW ) );
+    String aDrawHelpText( FwkResId( STR_BACKING_DRAW ) );
+    // Calc
+    BitmapEx aCalcHelpImage( FwkResId( BMP_BACKING_CALC ) );
+    String aCalcHelpText( FwkResId( STR_BACKING_CALC ) );
+    // Impress
+    BitmapEx aImpressHelpImage( FwkResId( BMP_BACKING_IMPRESS ) );
+    String aImpressHelpText( FwkResId( STR_BACKING_IMPRESS ) );
+    // Open a file
+    BitmapEx aInfoImage( FwkResId( BMP_BACKING_OPENFILE ) );
+    String aInfoHelpText( FwkResId( STR_BACKING_FILE ) );
+
+    // clean up resource stack
+    FreeResource();
+    
+    maWelcome.SetPaintTransparent( TRUE );
+    maProduct.SetPaintTransparent( TRUE );
+    EnableChildTransparentMode();
+    
+    SetStyle( GetStyle() | WB_DIALOGCONTROL );
+    
+    // add some breathing space for the images
+    maButtonImageSize.Width() += IMAGES_BREATHING_SPACE;
+    maButtonImageSize.Height() += IMAGES_BREATHING_SPACE;
+    
+    // force tab cycling in toolbox
+    maToolbox.SetStyle( maToolbox.GetStyle() | WB_FORCETABCYCLE );
+
+    // Writer item
+    maToolbox.InsertItem( nItemId_Writer, Image( aWriterHelpImage ) );
+    maToolbox.SetItemText( nItemId_Writer, aWriterHelpText );
+    maToolbox.ShowItem( nItemId_Writer );
+    // add some space between buttons
+    maToolbox.InsertSpace();
+    
+    // Draw item
+    maToolbox.InsertItem( nItemId_Draw, Image( aDrawHelpImage ) );
+    maToolbox.SetItemText( nItemId_Draw, aDrawHelpText );
+    maToolbox.ShowItem( nItemId_Draw );
+    maToolbox.InsertSpace();
+
+    // Impresse item
+    maToolbox.InsertItem( nItemId_Impress, Image( aImpressHelpImage ) );
+    maToolbox.SetItemText( nItemId_Impress, aImpressHelpText );
+    maToolbox.ShowItem( nItemId_Impress );
+    maToolbox.InsertSpace();
+
+    // Calc item
+    maToolbox.InsertItem( nItemId_Calc, Image( aCalcHelpImage ) );
+    maToolbox.SetItemText( nItemId_Calc, aCalcHelpText );
+    maToolbox.ShowItem( nItemId_Calc );
+    maToolbox.InsertSpace();
+
+    // Open file item
+    maToolbox.InsertItem( nItemId_Info, Image( aInfoImage ) );
+    maToolbox.SetItemText( nItemId_Info, aInfoHelpText );
+    maToolbox.ShowItem( nItemId_Info );
+
+    // get dispatch provider
+    mxDesktop = Reference<XDesktop>( comphelper::getProcessServiceFactory()->createInstance(SERVICENAME_DESKTOP ),UNO_QUERY );
+    if( mxDesktop.is() )
+        mxDesktopDispatchProvider = Reference< XDispatchProvider >( mxDesktop, UNO_QUERY );
+
+    // init background
+    initBackground();
+}
+
+BackingWindow::~BackingWindow()
+{
+    delete mpAccExec;
+}
+
+class ImageContainerRes : public Resource
+{
+    public:
+    ImageContainerRes( const ResId& i_rId ) : Resource( i_rId ) {}
+    ~ImageContainerRes() { FreeResource(); }
+};
+
+void BackingWindow::DataChanged( const DataChangedEvent& rDCEvt )
+{
+    Window::DataChanged( rDCEvt );
+
+    if ( rDCEvt.GetFlags() & SETTINGS_STYLE )
+    {
+        initBackground();
+        Invalidate();
+    }
+}
+
+void BackingWindow::initBackground()
+{
+    SetBackground( GetSettings().GetStyleSettings().GetWorkspaceGradient() );
+    
+    bool bDark = GetSettings().GetStyleSettings().GetHighContrastMode();
+    maWelcomeTextColor = maLabelTextColor =  bDark ? Color( COL_WHITE ) : Color( 0x58, 0x2c, 0x0f /* Orig. value: 0x26, 0x35, 0x42 */);
+    Color aTextBGColor( bDark ? COL_BLACK : COL_WHITE );
+
+    // select image set
+    ImageContainerRes aRes( FwkResId( bDark ? RES_BACKING_IMAGES_HC : RES_BACKING_IMAGES ) );
+
+    // scale middle segment
+    Size aFullSize;
+    if( !! maBackgroundMiddle )
+        aFullSize = maBackgroundMiddle.GetSizePixel();
+
+    // load middle segment == the new background
+    maBackgroundMiddle = BitmapEx( FwkResId( BMP_BACKING_BACKGROUND_MONOBLOCK ) );
+    
+    // and scale it to previous size
+    if( aFullSize.Width() && aFullSize.Height() )
+        maBackgroundMiddle.Scale( aFullSize );
+
+    // we first draw the background of the welcome
+    maWelcome.SetControlForeground( maWelcomeTextColor );
+    maWelcome.SetBackground();
+ 
+    // then the product fore and background
+    // kept for information
+    // maProduct.SetControlForeground( maWelcomeTextColor );
+    // maProduct.SetBackground();
+
+    // ...text
+    maCreateText.SetControlForeground( maLabelTextColor );
+    // was buggy : maCreateText.SetControlBackground( aTextBGColor );
+    maCreateText.SetBackground();
+}
+
+void BackingWindow::initControls()
+{
+    if( mbInitControls )
+        return;
+    
+    mbInitControls = true;
+    
+    // calculate dialog size
+    // begin with background bitmap
+    maControlRect = Rectangle( Point(), maBackgroundMiddle.GetSizePixel() );
+    maControlRect.Left() += nShadowLeft;
+    maControlRect.Right() -= nShadowRight;
+    maControlRect.Top() += nShadowTop;
+    maControlRect.Bottom() -= nShadowBottom;
+
+#ifdef DEBUG
+    fprintf( stdout, "I'm in %s \n", __func__ );
+    fprintf( stdout, "At line %d \n", __LINE__ );
+    fprintf(stdout, "maControlRect.Top() : %ld \n", maControlRect.Top() );
+    fprintf(stdout, "maControlRect.Bottom() : %ld \n", maControlRect.Bottom() );
+    fprintf(stdout, "maControlRect.Left() : %ld \n", maControlRect.Left() );
+    fprintf(stdout, "maControlRect.Right() : %ld \n", maControlRect.Right() );
+#endif
+    long nYPos = 0;
+    // set bigger welcome string
+    maWelcome.SetText( maWelcomeString );
+
+    maTextFont = GetSettings().GetStyleSettings().GetLabelFont();
+    maTextFont.SetSize( Size( 0, 22) );
+    maTextFont.SetWeight( WEIGHT_BOLD );
+    maWelcome.SetFont( maTextFont );
+
+    // get metric to get correct width factor and adjust
+    long nW = (maWelcome.GetFontMetric().GetWidth()*95)/100;
+
+    maTextFont.SetSize( Size( nW, 20 ) );
+
+    maWelcome.SetFont( maTextFont );
+    maWelcome.SetControlFont( maTextFont );
+    maWelcomeSize = Size( maWelcome.GetTextWidth( maWelcomeString ), maWelcome.GetTextHeight() );
+    maWelcomeSize.Width() = (maWelcomeSize.Width() * 20)/19;
+
+    if( maControlRect.GetWidth() < nBtnPos + maWelcomeSize.Width() + 20 )
+        maControlRect.Right() = maControlRect.Left() + maWelcomeSize.Width() + nBtnPos + 20;
+
+    maWelcome.Show();
+    
+    nYPos += 40;// FIXME : calculate a correct value
+
+    // set a slighly larger font than normal labels on the texts
+    maTextFont.SetSize( Size( 0, 16 ) );
+    maTextFont.SetWeight( WEIGHT_NORMAL );
+    maCreateText.SetFont( maTextFont );
+    maCreateText.SetControlFont( maTextFont );
+    maCreateText.SetText( maCreateString );
+    maCreateSize = Size( maCreateText.GetTextWidth( maCreateString ), maCreateText.GetTextHeight() );
+    maCreateText.Show();
+
+    nYPos += 40;// FIXME : calculate a correct value
+
+    // collect the URLs of the entries in the File/New menu
+    SvtModuleOptions	aModuleOptions;
+    std::set< rtl::OUString > aFileNewAppsAvailable;
+    SvtDynamicMenuOptions aOpt;
+    Sequence < Sequence < PropertyValue > > aNewMenu = aOpt.GetMenu( E_NEWMENU );
+    const rtl::OUString sURLKey( RTL_CONSTASCII_USTRINGPARAM( "URL" ) );
+
+    const Sequence< PropertyValue >* pNewMenu = aNewMenu.getConstArray();
+    const Sequence< PropertyValue >* pNewMenuEnd = aNewMenu.getConstArray() + aNewMenu.getLength();
+    for ( ; pNewMenu != pNewMenuEnd; ++pNewMenu )
+    {
+        comphelper::SequenceAsHashMap aEntryItems( *pNewMenu );
+        rtl::OUString sURL( aEntryItems.getUnpackedValueOrDefault( sURLKey, rtl::OUString() ) );
+        if ( sURL.getLength() )
+            aFileNewAppsAvailable.insert( sURL );
+    }
+    
+    // create mnemonics on the fly, preregister the mnemonics of the menu
+    MnemonicGenerator aMnemns;
+
+    maOpenString = MnemonicGenerator::EraseAllMnemonicChars( maOpenString );
+
+    SystemWindow* pSysWin = GetSystemWindow();
+    if( pSysWin )
+    {
+        MenuBar* pMBar = pSysWin->GetMenuBar();
+        if( pMBar )
+        {
+            for( USHORT i = 0; i < pMBar->GetItemCount(); i++ )
+            {
+                USHORT nItemId = pMBar->GetItemId( i );
+                String aItemText( pMBar->GetItemText( nItemId ) );
+                if( aItemText.Len() )
+                    aMnemns.RegisterMnemonic( aItemText );
+            }
+        }
+    }			 
+
+#ifdef DEBUG
+    fprintf( stdout, "I'm in %s \n", __func__ );
+    fprintf( stdout, "At line %d \n", __LINE__ );
+    fprintf(stdout, "maControlRect.Top() : %ld \n", maControlRect.Top() );
+    fprintf(stdout, "maControlRect.Bottom() : %ld \n", maControlRect.Bottom() );
+    fprintf(stdout, "maControlRect.Left() : %ld \n", maControlRect.Left() );
+    fprintf(stdout, "maControlRect.Right() : %ld \n", maControlRect.Right() );
+#endif
+    
+    maToolbox.SetSelectHdl( LINK( this, BackingWindow, ToolboxHdl ) );
+    maToolbox.Show();
+    // scale middle map to formatted width
+    Size aMiddleSegmentSize( maControlRect.GetSize().Width() + nShadowLeft + nShadowRight,
+                             maBackgroundMiddle.GetSizePixel().Height() );
+    long nLW = maBackgroundMiddle.GetSizePixel().Width();
+
+    if( aMiddleSegmentSize.Width() > nLW )
+    {
+        aMiddleSegmentSize.Width() -= nLW;
+        maBackgroundMiddle.Scale( aMiddleSegmentSize );
+    }
+    else
+        maBackgroundMiddle = BitmapEx();
+
+    Resize();
+}
+
+void BackingWindow::loadImage( const ResId& i_rId, ImageButton& i_rButton )
+{
+    BitmapEx aBmp( i_rId );
+    Size aImgSize( aBmp.GetSizePixel() );
+    if( aImgSize.Width() > maButtonImageSize.Width() )
+        maButtonImageSize.Width() = aImgSize.Width();
+    if( aImgSize.Height() > maButtonImageSize.Height() )
+        maButtonImageSize.Height() = aImgSize.Height();
+    i_rButton.SetModeImage( aBmp );
+}
+
+void BackingWindow::Paint( const Rectangle& )
+{
+    bool bDark = GetSettings().GetStyleSettings().GetHighContrastMode();
+    
+    Color aBackColor( bDark ? COL_BLACK : COL_WHITE );
+
+    // Wild fix for the redraw. Needs more love, because probably costly on slow machines
+    initBackground();
+
+   // draw bitmap
+    if( GetSettings().GetLayoutRTL() )
+    {
+        Point aTL( maControlRect.TopLeft() );
+        aTL.X() -= nShadowRight;
+        aTL.Y() -= nShadowTop;
+        DrawBitmapEx( aTL, maBackgroundMiddle );
+        aTL.X() += maBackgroundMiddle.GetSizePixel().Width();
+    }
+    else
+    {
+        Point aTL( maControlRect.TopLeft() );
+        aTL.X() -= nShadowLeft;
+        aTL.Y() -= nShadowTop;
+        DrawBitmapEx( aTL, maBackgroundMiddle );
+        aTL.X() += maBackgroundMiddle.GetSizePixel().Width();
+    }
+}
+
+long BackingWindow::Notify( NotifyEvent& rNEvt )
+{
+#ifdef DEBUG
+    fprintf( stdout, "I'm in %s \n", __func__ );
+#endif
+    if( rNEvt.GetType() == EVENT_KEYINPUT )
+    {
+        if( ! mpAccExec )
+        {
+            mpAccExec = svt::AcceleratorExecute::createAcceleratorHelper();
+            mpAccExec->init( comphelper::getProcessServiceFactory(), mxFrame);
+        }
+        const KeyEvent* pEvt = rNEvt.GetKeyEvent();
+        if( pEvt && mpAccExec->execute(pEvt->GetKeyCode()) )
+            return 1;
+    }
+    return Window::Notify( rNEvt );
+}
+
+void BackingWindow::setOwningFrame( const com::sun::star::uno::Reference< com::sun::star::frame::XFrame >& xFrame )
+{
+    mxFrame = xFrame;
+    if( ! mbInitControls )
+        initControls();
+}
+
+void BackingWindow::Resize()
+{
+    Size aWindowSize( GetSizePixel() );
+    Size aControlSize = maControlRect.GetSize();
+    maControlRect = Rectangle( Point(   (aWindowSize.Width() - aControlSize.Width()) / 2 ,
+                                        (aWindowSize.Height() - aControlSize.Height()) / 2 ),
+                                aControlSize );
+
+    maToolbox.calcMinSize();
+    Size aTBSize( maToolbox.getMinSize() );
+    Point aTBPos( maControlRect.Right() - aTBSize.Width() - TOOLBOX_OFFSET_X,
+                  maControlRect.Bottom() - aTBSize.Height() - TOOLBOX_OFFSET_Y );
+    maToolbox.SetPosSizePixel( aTBPos, aTBSize );
+
+    long nYPos = maControlRect.Top();
+
+    nYPos += 35;// FIXME: better method ...
+
+    maWelcome.SetPosSizePixel( Point( maControlRect.Left() + nBtnPos - STRING_OFFSET_X, nYPos ),
+                                Size( maControlRect.GetWidth() - nBtnPos - 5, (maWelcomeSize.Height()*20)/19 ) );
+
+    // defines the location of the Create text
+    nYPos += 210;// FIXME: better method ...
+    maCreateText.SetPosSizePixel( Point( maControlRect.Left() + nBtnPos - ( (maCreateSize.Width() - maWelcomeSize.Width() ) / 2 ) -  STRING_OFFSET_X , nYPos ),
+                                  Size( maControlRect.GetWidth() - nBtnPos - 5, maCreateSize.Height() ) );
+}
+
+IMPL_LINK( BackingWindow, ToolboxHdl, void*, EMPTYARG )
+{
+    const char* pNodePath = NULL;
+    const char* pNode = NULL;
+    
+    switch( maToolbox.GetCurItemId() )
+    {
+        case nItemId_Writer:
+            dispatchURL( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(WRITER_URL) ) );
+            break;
+        case nItemId_Calc:
+            dispatchURL( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(CALC_URL) ) );
+            break;
+        case nItemId_Draw:
+            dispatchURL( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(DRAW_URL) ) );
+            break;
+        case nItemId_Impress:
+            dispatchURL( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(IMPRESS_WIZARD_URL) ) );
+            break;
+        case nItemId_Info:
+        {
+            Reference< XDispatchProvider > xFrame( mxFrame, UNO_QUERY );
+            Sequence< com::sun::star::beans::PropertyValue > aArgs(1);
+            PropertyValue* pArg = aArgs.getArray();
+            pArg[0].Name = rtl::OUString::createFromAscii("Referer");
+            pArg[0].Value <<= rtl::OUString::createFromAscii("private:user");
+            dispatchURL( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(OPEN_URL) ), rtl::OUString(), xFrame, aArgs );
+        }
+            break;
+        case nItemId_Extensions:
+        case nItemId_Reg:
+        case nItemId_TplRep:
+        default:
+            break;
+    }
+    if( pNodePath && pNode )
+    {
+        try
+        {
+            Reference<lang::XMultiServiceFactory> xConfig( comphelper::getProcessServiceFactory()->createInstance(SERVICENAME_CFGPROVIDER),UNO_QUERY);
+            if( xConfig.is() )
+            {
+                Sequence<Any> args(1);
+                PropertyValue val(
+                    rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("nodepath") ),
+                    0,
+                    Any(rtl::OUString::createFromAscii(pNodePath)),
+                    PropertyState_DIRECT_VALUE);
+                args.getArray()[0] <<= val;
+                Reference<container::XNameAccess> xNameAccess(xConfig->createInstanceWithArguments(SERVICENAME_CFGREADACCESS,args), UNO_QUERY);
+                if( xNameAccess.is() )
+                {
+                    rtl::OUString sURL;
+                    //throws css::container::NoSuchElementException, css::lang::WrappedTargetException
+                    Any value( xNameAccess->getByName(rtl::OUString::createFromAscii(pNode)) );
+                    sURL = value.get<rtl::OUString> ();
+                    
+                    Reference< com::sun::star::system::XSystemShellExecute > xSystemShellExecute(
+                        comphelper::getProcessServiceFactory()->createInstance(
+                            rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.system.SystemShellExecute" ) ) ),
+                        UNO_QUERY_THROW);
+                    //throws css::lang::IllegalArgumentException, css::system::SystemShellExecuteException
+                    xSystemShellExecute->execute( sURL, rtl::OUString(), com::sun::star::system::SystemShellExecuteFlags::DEFAULTS);
+                }
+            }
+        }
+        catch (Exception& )
+        {
+        }
+    }
+                    
+    return 0;
+}
+
+struct ImplDelayedDispatch
+{
+    /* this structure contains all the information to be dispatched */
+    Reference< XDispatch >      xDispatch;
+    com::sun::star::util::URL   aDispatchURL;
+    Sequence< PropertyValue >   aArgs;
+    
+    ImplDelayedDispatch( const Reference< XDispatch >& i_xDispatch,
+                         const com::sun::star::util::URL& i_rURL,
+                         const Sequence< PropertyValue >& i_rArgs )
+    : xDispatch( i_xDispatch ),
+      aDispatchURL( i_rURL ),
+      aArgs( i_rArgs )
+    {
+    }
+    ~ImplDelayedDispatch() {}
+};
+
+static long implDispatchDelayed( void*, void* pArg )
+{
+    /* implemented call */
+    struct ImplDelayedDispatch* pDispatch = reinterpret_cast<ImplDelayedDispatch*>(pArg);
+    try
+    {
+        pDispatch->xDispatch->dispatch( pDispatch->aDispatchURL, pDispatch->aArgs );
+    }
+    catch( Exception )
+    {
+    }
+    
+    // clean up
+    delete pDispatch;
+    
+    return 0;
+}
+
+void BackingWindow::dispatchURL( const rtl::OUString& i_rURL,
+                                 const rtl::OUString& rTarget,
+                                 const Reference< XDispatchProvider >& i_xProv,
+                                 const Sequence< PropertyValue >& i_rArgs )
+{
+    // if no special dispatch provider is given, get the desktop
+    Reference< XDispatchProvider > xProvider( i_xProv.is() ? i_xProv : mxDesktopDispatchProvider );
+
+    // check for dispatch provider
+    if( !xProvider.is())
+        return;
+    
+    // get an URL transformer to clean up the URL
+    com::sun::star::util::URL aDispatchURL;
+    aDispatchURL.Complete = i_rURL;
+
+    Reference < com::sun::star::util::XURLTransformer > xURLTransformer(
+        comphelper::getProcessServiceFactory()->createInstance( rtl::OUString::createFromAscii("com.sun.star.util.URLTransformer") ),
+        com::sun::star::uno::UNO_QUERY );
+    if ( xURLTransformer.is() )
+    {
+        try
+        {
+            // clean up the URL
+            xURLTransformer->parseStrict( aDispatchURL );
+            // get a Dispatch for the URL and target
+            Reference< XDispatch > xDispatch(
+                xProvider->queryDispatch( aDispatchURL, rTarget, 0 )
+                );
+            // dispatch the URL
+            if ( xDispatch.is() )
+            {
+                ImplDelayedDispatch* pDisp = new ImplDelayedDispatch( xDispatch, aDispatchURL, i_rArgs );
+                ULONG nEventId = 0;
+                if( ! Application::PostUserEvent( nEventId, Link( NULL, implDispatchDelayed ), pDisp ) )
+                    delete pDisp; // event could not be posted for unknown reason, at least don't leak
+            }
+        }
+        catch ( com::sun::star::uno::RuntimeException& )
+        {
+            throw;
+        }
+        catch ( com::sun::star::uno::Exception& )
+        {
+        }
+    }
+}
+
diff --git framework/source/services/backingwindow.hxx framework/source/services/backingwindow.hxx
index 9722ddf..a8209a0 100644
--- framework/source/services/backingwindow.hxx
+++ framework/source/services/backingwindow.hxx
@@ -57,6 +57,11 @@
 
 #include <set>
 
+#define IMAGES_BREATHING_SPACE 30
+#define TOOLBOX_OFFSET_X 70
+#define TOOLBOX_OFFSET_Y 50
+#define STRING_OFFSET_X 10
+
 class MnemonicGenerator;
 
 namespace framework
@@ -91,6 +96,7 @@ namespace framework
         Size                            maProductSize;
         FixedText                       maCreateText;
         Size                            maCreateSize;
+#ifndef OOo4Kids
         FixedText                       maWriterText;
         ImageButton                     maWriterButton;
         FixedText                       maCalcText;
@@ -107,7 +113,7 @@ namespace framework
         ImageButton                     maTemplateButton;
         FixedText                       maOpenText;
         ImageButton                     maOpenButton;
-        
+#endif
         DecoToolBox                     maToolbox;
         
         BitmapEx                        maBackgroundLeft;
@@ -132,12 +138,21 @@ namespace framework
         bool                            mbInitControls;
         svt::AcceleratorExecute*        mpAccExec;
 
-                
-        static const long nBtnPos = 240;
+#ifdef OOo4Kids 
+    static const long nOOo4KidsControlWidth = 700;
+#endif
+        static const long nBtnPos = 220;
         static const int nItemId_Extensions = 1;
         static const int nItemId_Reg = 2;
         static const int nItemId_Info = 3;
         static const int nItemId_TplRep = 4;
+#ifdef OOo4Kids
+        static const int nItemId_Calc = 5;
+        static const int nItemId_Draw = 6;
+        static const int nItemId_Impress = 7;
+        static const int nItemId_Writer = 8;
+        static const int nItemId_File = 8;
+#endif
         static const int nShadowTop = 32;
         static const int nShadowLeft = 35;
         static const int nShadowRight = 45;
@@ -157,8 +172,9 @@ namespace framework
                           const com::sun::star::uno::Reference< com::sun::star::frame::XDispatchProvider >& i_xProv = com::sun::star::uno::Reference< com::sun::star::frame::XDispatchProvider >(),
                           const com::sun::star::uno::Sequence< com::sun::star::beans::PropertyValue >& = com::sun::star::uno::Sequence< com::sun::star::beans::PropertyValue >()
                           );
-        
+#ifndef OOo4Kids
         DECL_LINK( ClickHdl, Button* );
+#endif
         DECL_LINK( ToolboxHdl, void* );
         
         void initControls();
@@ -171,9 +187,10 @@ namespace framework
         virtual void        Resize();
         virtual long        Notify( NotifyEvent& rNEvt );
         virtual void        DataChanged( const DataChangedEvent& rDCEvt );
+#ifndef OOo4Kids
         virtual Window*     GetParentLabelFor( const Window* pLabel ) const;
         virtual Window*     GetParentLabeledBy( const Window* pLabeled ) const;
-
+#endif
         void setOwningFrame( const com::sun::star::uno::Reference< com::sun::star::frame::XFrame >& xFrame );
     };
 
diff --git framework/source/services/fwk_services.src framework/source/services/fwk_services.src
index b3916da..d2de9c0 100644
--- framework/source/services/fwk_services.src
+++ framework/source/services/fwk_services.src
@@ -2,28 +2,31 @@
  *
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
- * Copyright 2008 by Sun Microsystems, Inc.
  *
- * OpenOffice.org - a multi-platform office productivity suite
+ * Author ericb
+ *
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
  *
  * $RCSfile: fwk_services.src,v $
  * $Revision: 1.8 $
  *
- * This file is part of OpenOffice.org.
+ * This file is part of OOo4Kids.
  *
- * OpenOffice.org is free software: you can redistribute it and/or modify
+ * OOo4Kids is free software: you can redistribute it and/or modify
  * it under the terms of the GNU Lesser General Public License version 3
  * only, as published by the Free Software Foundation.
  *
- * OpenOffice.org is distributed in the hope that it will be useful,
+ * OOo4Kids is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU Lesser General Public License version 3 for more details
  * (a copy is included in the LICENSE file that accompanied this code).
  *
  * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
  * for a copy of the LGPLv3 License.
  *
  ************************************************************************/
@@ -39,6 +42,14 @@ Window DLG_BACKING
     String STR_BACKING_WELCOME
     {
         Text [ en-US ] = "Welcome to";
+        Text [ fr ] = "Bienvenue dans";
+        Text [ es ] = "Bienvenidos a";
+        Text [ pt ] = "Bem vindo ao";
+        Text [ it ] = "Benvenuto su";
+        Text [ de ] = "Willkommen bei";
+        Text [ nl ] = "Welkom bij";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Nyt alkaa";
     };
     String STR_BACKING_WELCOMEPRODUCT
     {
@@ -47,6 +58,14 @@ Window DLG_BACKING
     String STR_BACKING_CREATE
     {
         Text [ en-US ] = "Create a new document";
+        Text [ fr ] = "Crer un nouveau document";
+        Text [ es ] = "Crea un nuevo documento";
+        Text [ pt ] = "Criar um novo documento";
+        Text [ it ] = "Creare un nuovo documento";
+        Text [ de ] = "Erstelle ein neues Dokument";
+        Text [ nl ] = "Maak een nieuw document";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Laadi uusi asiakirja";
     };
     String STR_BACKING_TEMPLATE
     {
@@ -56,29 +75,65 @@ Window DLG_BACKING
     {
         Text [ en-US ] = "~Open a document...";
     };
+    String STR_BACKING_WRITER
+    {
+        Text [ en-US ] = "Create a text with Writer";
+        Text [ fr ] = "Crer un texte avec Writer";
+        Text [ de ] = "Erstelle einen Text mit Writer";
+        Text [ es ] = "Crea un texto en Writer";
+        Text [ it ] = "Creare un testo con Writer";
+        Text [ nl ] = "Een tekst maken met Writer";
+        Text [ pt ] = "Cria um texto com o Writer";
+        Text [ fi ] = "Kirjoita Writerilla";
+    };
+    String STR_BACKING_DRAW
+    {
+        Text [ en-US ] = "Draw something";
+        Text [ fr ] = "Dessiner quelque chose";
+        Text [ de ] = "Zeichne etwas";
+        Text [ es ] = "Dibuja lo que quieras";
+        Text [ it ] = "Disegnare qualche cosa";
+        Text [ nl ] = "Iets tekenen";
+        Text [ pt ] = "Desenha alguma coisa";
+        Text [ fi ] = "Piirr Draw'lla";
+    };
+    String STR_BACKING_CALC
+    {
+        Text [ en-US ] = "Create a Calc sheet";
+        Text [ fr ] = "Crer une feuille de calcul avec Calc";
+        Text [ de ] = "Erstelle eine Rechentabelle mit Calc";
+        Text [ es ] = "Crea una hoja de Calc";
+        Text [ it ] ="Creare un foglio di calcolo con Calc";
+        Text [ nl ] ="Een werkblad met Calc maken";
+        Text [ pt ] = "Cria uma folha de clculo com o Calc";
+        Text [ fi ] = "Laske Calcilla";
+    };
+    String STR_BACKING_IMPRESS
+    {
+        Text [ en-US ] = "Create a presentation with Impress";
+        Text [ fr ] = "Crer une prsentation avec Impress";
+        Text [ de ] = "Erstelle eine Prsentation mit Impress";
+        Text [ es ] = "Crea una presentacin con Impress";
+        Text [ it ] = "Creare una presentazione con Impress";
+        Text [ nl ] = "Een presentatie met Impress maken";
+        Text [ pt ] = "Cria uma apresentao com o Impress";
+        Text [ fi ] = "Laadi esitys Impressill";
+    };
     Bitmap BMP_BACKING_WRITER
     {
         File = "odt_32.png";
     };
-    Bitmap BMP_BACKING_CALC
-    {
-        File = "ods_32.png";
-    };
-    Bitmap BMP_BACKING_IMPRESS
-    {
-        File = "odp_32.png";
-    };
     Bitmap BMP_BACKING_DRAW
     {
         File = "odg_32.png";
     };
-    Bitmap BMP_BACKING_DATABASE
+    Bitmap BMP_BACKING_IMPRESS
     {
-        File = "odb_32.png";
+        File = "odp_32.png";
     };
-    Bitmap BMP_BACKING_FORMULA
+    Bitmap BMP_BACKING_CALC
     {
-        File = "odf_32.png";
+        File = "ods_32.png";
     };
     Bitmap BMP_BACKING_OPENFILE
     {
@@ -88,38 +143,6 @@ Window DLG_BACKING
     {
         File = "template_32.png";
     };
-    Bitmap BMP_BACKING_EXT
-    {
-        File = "extension_plus_26.png";
-    };
-    String STR_BACKING_EXTHELP
-    {
-        Text [ en-US ] = "Add new features to %PRODUCTNAME";
-    };
-    Bitmap BMP_BACKING_REG
-    {
-        File = "register_32.png";
-    };
-    String STR_BACKING_REGHELP
-    {
-        Text [ en-US ] = "Register your %PRODUCTNAME";
-    };
-    Bitmap BMP_BACKING_INFO
-    {
-        File = "info_26.png";
-    };
-    String STR_BACKING_INFOHELP
-    {
-        Text [ en-US ] = "Get more information about %PRODUCTNAME";
-    };
-    Bitmap BMP_BACKING_TPLREP
-    {
-        File = "addtemplate_32.png";
-    };
-    String STR_BACKING_TPLREP
-    {
-        Text [ en-US ] = "Get more templates for %PRODUCTNAME";
-    };
 };
 
 Resource RES_BACKING_IMAGES
@@ -144,6 +167,10 @@ Resource RES_BACKING_IMAGES
     {
         File = "backing_rtl_right.png";
     };
+    Bitmap BMP_BACKING_BACKGROUND_MONOBLOCK
+    {
+        File = "startcenter_monoblock1.png";
+    };
 };
 
 Resource RES_BACKING_IMAGES_HC
@@ -168,6 +195,11 @@ Resource RES_BACKING_IMAGES_HC
     {
         File = "backing_rtl_right_hc.png";
     };
+    Bitmap BMP_BACKING_BACKGROUND_MONOBLOCK
+    {
+        File = "startcenter_monoblock1.png";
+    };
+
 };
 
 Window WIN_TABWINDOW
@@ -179,4 +211,3 @@ Window WIN_TABWINDOW
         OutputSize = TRUE ;
     };
 };
-
diff --git framework/source/services/makefile.mk framework/source/services/makefile.mk
index a7360e8..474aae7 100644
--- framework/source/services/makefile.mk
+++ framework/source/services/makefile.mk
@@ -39,6 +39,10 @@ ENABLE_EXCEPTIONS=	TRUE
 
 .INCLUDE :  		settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+BUILD_CASE=-OOo4Kids
+.ENDIF
+
 # --- Generate -----------------------------------------------------
 
 SLOFILES=\
@@ -49,7 +53,7 @@ SLOFILES=\
         $(SLO)$/substitutepathvars.obj \
         $(SLO)$/pathsettings.obj \
         $(SLO)$/backingcomp.obj \
-        $(SLO)$/backingwindow.obj \
+        $(SLO)$/backingwindow$(BUILD_CASE).obj \
         $(SLO)$/dispatchhelper.obj \
         $(SLO)$/license.obj \
         $(SLO)$/modulemanager.obj \
@@ -60,6 +64,7 @@ SLOFILES=\
         $(SLO)$/tabwindowservice.obj
 
 SRS1NAME=$(TARGET)
+
 SRC1FILES= fwk_services.src
 
 # --- Targets ------------------------------------------------------
diff --git framework/uiconfig/startmodule/menubar/menubar.xml framework/uiconfig/startmodule/menubar/menubar.xml
index b5e52e7..56c7240 100644
--- framework/uiconfig/startmodule/menubar/menubar.xml
+++ framework/uiconfig/startmodule/menubar/menubar.xml
@@ -1,34 +1,12 @@
-<?xml version="1.0" encoding="UTF-8"?>
+<?xml version="1.0"?>
 <menu:menubar xmlns:menu="http://openoffice.org/2001/menu" menu:id="menubar">
     <menu:menu menu:id=".uno:PickList">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:AddDirect"/>
             <menu:menuitem menu:id=".uno:Open"/>
             <menu:menuitem menu:id=".uno:RecentFileList"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:AutoPilotMenu"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:CloseDoc"/>
-            <menu:menuitem menu:id=".uno:Save"/>
-            <menu:menuitem menu:id=".uno:SaveAs"/>
-            <menu:menuitem menu:id=".uno:SaveAll"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SendMail"/>
-            <menu:menu menu:id=".uno:TemplateMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:Organizer"/>
-                    <menu:menuitem menu:id=".uno:AddressBookSource"/>
-                    <menu:menuitem menu:id=".uno:SaveAsTemplate"/>
-                    <menu:menuitem menu:id=".uno:OpenTemplate"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SetDocumentProperties"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:Print"/>
-            <menu:menuitem menu:id=".uno:PrinterSetup"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Quit"/>
+            
         </menu:menupopup>
     </menu:menu>
     <menu:menu menu:id=".uno:EditMenu">
@@ -49,13 +27,6 @@
     <menu:menu menu:id=".uno:ToolsMenu">
         <menu:menupopup>
             <menu:menu menu:id=".uno:MacrosMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:MacroRecorder"/>
-                    <menu:menuitem menu:id=".uno:RunMacro"/>
-                    <menu:menu menu:id=".uno:ScriptOrganizer"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MacroOrganizer?TabId:short=1"/>
-                </menu:menupopup>
             </menu:menu>
             <menu:menuitem menu:id="service:com.sun.star.deployment.ui.PackageManagerDialog"/>
             <menu:menuitem menu:id=".uno:ConfigureDialog"/>
@@ -73,11 +44,8 @@
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:HelpIndex"/>
             <menu:menuitem menu:id=".uno:ExtendedHelp"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:HelpSupport"/>
-            <menu:menuitem menu:id=".uno:OnlineRegistrationDlg"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:About"/>
+            <menu:menuitem menu:id=".uno:ShowLicense"/>
         </menu:menupopup>
     </menu:menu>
 </menu:menubar>
diff --git framework/util/makefile.mk framework/util/makefile.mk
index 0a07f3c..be777fb 100644
--- framework/util/makefile.mk
+++ framework/util/makefile.mk
@@ -43,6 +43,10 @@ GEN_HID_OTHER=      TRUE
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+BUILD_CASE=-OOo4Kids
+.ENDIF
+
 # --- internal import -------------------------------------------------
 
 LIB1TARGET=     $(SLB)$/fwiobj.lib
@@ -241,7 +245,7 @@ SHL4OBJS=       \
                 $(SLO)$/addonstoolboxfactory.obj    \
                 $(SLO)$/autorecovery.obj            \
                 $(SLO)$/backingcomp.obj             \
-                $(SLO)$/backingwindow.obj           \
+                $(SLO)$/backingwindow$(BUILD_CASE).obj \
                 $(SLO)$/buttontoolbarcontroller.obj       \
                 $(SLO)$/closedispatcher.obj         \
                 $(SLO)$/comboboxtoolbarcontroller.obj     \
diff --git graphite/graphite-2.3.1.patch.mingw graphite/graphite-2.3.1.patch.mingw
deleted file mode 100755
index ecec00d..0000000
--- graphite/graphite-2.3.1.patch.mingw
+++ /dev/null
@@ -1,168 +0,0 @@
---- misc/silgraphite-2.3.1/engine/config/ltmain.sh	2009-01-28 11:21:59.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/engine/config/ltmain.sh	2009-08-23 20:59:13.180125000 +0900
-@@ -3963,7 +3963,7 @@
- 	case $dir in
- 	[\\/]* | [A-Za-z]:[\\/]*) ;;
- 	*)
--	  absdir=`cd "$dir" && pwd`
-+	  absdir=`cygpath -m -a "$dir"`
- 	  test -z "$absdir" && \
- 	    func_fatal_error "cannot determine absolute directory name of \`$dir'"
- 	  dir="$absdir"
---- misc/silgraphite-2.3.1/engine/src/Makefile.in	2009-01-28 11:25:00.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/engine/src/Makefile.in	2009-08-23 20:59:13.742625000 +0900
-@@ -62,7 +62,8 @@
- 	GrFSM.lo GrGlyphTable.lo GrPassActionCode.lo GrPass.lo \
- 	GrSlotState.lo GrSlotStream.lo GrTableManager.lo \
- 	MemoryUsage.lo Platform.lo SegmentAux.lo Segment.lo TestFSM.lo \
--	TestPasses.lo TransductionLog.lo SegmentPainter.lo
-+	TestPasses.lo TransductionLog.lo SegmentPainter.lo WinFont.lo \
-+	WinSegmentPainter.lo
- libgraphite_la_OBJECTS = $(am_libgraphite_la_OBJECTS)
- libgraphite_la_LINK = $(LIBTOOL) --tag=CXX $(AM_LIBTOOLFLAGS) \
- 	$(LIBTOOLFLAGS) --mode=link $(CXXLD) $(AM_CXXFLAGS) \
-@@ -257,11 +258,14 @@
- 	$(segmentdir)/Platform.cpp $(segmentdir)/SegmentAux.cpp \
- 	$(segmentdir)/Segment.cpp $(segmentdir)/TestFSM.cpp \
- 	$(segmentdir)/TestPasses.cpp $(segmentdir)/TransductionLog.cpp \
--	$(painterdir)/SegmentPainter.cpp
-+	$(painterdir)/SegmentPainter.cpp \
-+	$(winwrapperdir)/WinFont.cpp \
-+	$(winwrapperdir)/WinSegmentPainter.cpp
- genericdir = $(top_srcdir)/src/generic
- fontdir = $(top_srcdir)/src/font
- segmentdir = $(top_srcdir)/src/segment
- painterdir = $(top_srcdir)/src/painter
-+winwrapperdir = $(top_srcdir)/../wrappers/win32
- all: all-am
- 
- .SUFFIXES:
-@@ -358,6 +362,8 @@
- @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/TransductionLog.Plo@am__quote@
- @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/TtfUtil.Plo@am__quote@
- @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/Util.Plo@am__quote@
-+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/WinFont.Plo@am__quote@
-+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/WinSegmentPainter.Plo@am__quote@
- 
- .cpp.o:
- @am__fastdepCXX_TRUE@	$(CXXCOMPILE) -MT $@ -MD -MP -MF $(DEPDIR)/$*.Tpo -c -o $@ $<
-@@ -569,6 +575,20 @@
- @AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
- @am__fastdepCXX_FALSE@	$(LIBTOOL) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o SegmentPainter.lo `test -f '$(painterdir)/SegmentPainter.cpp' || echo '$(srcdir)/'`$(painterdir)/SegmentPainter.cpp
- 
-+WinFont.lo: $(winwrapperdir)/WinFont.cpp
-+@am__fastdepCXX_TRUE@	$(LIBTOOL) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -MT WinFont.lo -MD -MP -MF $(DEPDIR)/WinFont.Tpo -c -o WinFont.lo `test -f '$(winwrapperdir)/WinFont.cpp' || echo '$(srcdir)/'`$(winwrapperdir)/WinFont.cpp
-+@am__fastdepCXX_TRUE@	mv -f $(DEPDIR)/WinFont.Tpo $(DEPDIR)/WinFont.Plo
-+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	source='$(winwrapperdir)/WinFont.cpp' object='WinFont.lo' libtool=yes @AMDEPBACKSLASH@
-+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-+@am__fastdepCXX_FALSE@	$(LIBTOOL) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o WinFont.lo `test -f '$(winwrapperdir)/WinFont.cpp' || echo '$(srcdir)/'`$(winwrapperdir)/WinFont.cpp
-+
-+WinSegmentPainter.lo: $(winwrapperdir)/WinSegmentPainter.cpp
-+@am__fastdepCXX_TRUE@	$(LIBTOOL) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -MT WinSegmentPainter.lo -MD -MP -MF $(DEPDIR)/WinSegmentPainter.Tpo -c -o WinSegmentPainter.lo `test -f '$(winwrapperdir)/WinSegmentPainter.cpp' || echo '$(srcdir)/'`$(winwrapperdir)/WinSegmentPainter.cpp
-+@am__fastdepCXX_TRUE@	mv -f $(DEPDIR)/WinSegmentPainter.Tpo $(DEPDIR)/WinSegmentPainter.Plo
-+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	source='$(winwrapperdir)/WinSegmentPainter.cpp' object='WinSegmentPainter.lo' libtool=yes @AMDEPBACKSLASH@
-+@AMDEP_TRUE@@am__fastdepCXX_FALSE@	DEPDIR=$(DEPDIR) $(CXXDEPMODE) $(depcomp) @AMDEPBACKSLASH@
-+@am__fastdepCXX_FALSE@	$(LIBTOOL) --tag=CXX $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) --mode=compile $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS) -c -o WinSegmentPainter.lo `test -f '$(winwrapperdir)/WinSegmentPainter.cpp' || echo '$(srcdir)/'`$(winwrapperdir)/WinSegmentPainter.cpp
-+
- mostlyclean-libtool:
- 	-rm -f *.lo
- 
---- misc/silgraphite-2.3.1/engine/src/font/FileFont.cpp	2009-01-22 07:36:42.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/engine/src/font/FileFont.cpp	2009-08-23 20:59:14.148875000 +0900
-@@ -208,7 +208,11 @@
- 			}
- //		}
- #elif 1
-+#ifdef __MINGW32__
-+		m_stuFaceName.assign(reinterpret_cast<wchar_t*>(rgchwFace));
-+#else
- 		m_stuFaceName.assign(rgchwFace);
-+#endif
- #else	// VS 2005 needs this:
- 		for (int cch16 = 0; cch16 < cchw; cch16++)
- 			m_stuFaceName.push_back(rgchwFace[cch16]);
---- misc/silgraphite-2.3.1/engine/test/RegressionTest/GrJustifier.cpp	2009-01-22 07:36:42.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/engine/test/RegressionTest/GrJustifier.cpp	2009-08-23 20:59:15.445750000 +0900
-@@ -375,7 +375,7 @@
- 		_itow(dxDesiredWidth, rgchw, 10);
- 		strTmp += rgchw;
- 		strTmp += L")\n";
--		OutputDebugString(strTmp.c_str());
-+		OutputDebugStringW(strTmp.c_str());
- #else
- 		Assert(fprintf(stderr,
- 			   "justification failed by %d units (width needed = %d)\n",
---- misc/silgraphite-2.3.1/engine/test/RegressionTest/RegressionTest.cpp	2009-01-22 07:36:42.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/engine/test/RegressionTest/RegressionTest.cpp	2009-08-23 20:59:15.711375000 +0900
-@@ -56,7 +56,7 @@
- 
- int main(int argc, char* argv[])
- {
--#ifdef _WIN32
-+#if defined(_WIN32) && !defined(__MINGW32__)
- 	_CrtSetDbgFlag(_CrtSetDbgFlag(_CRTDBG_REPORT_FLAG) | _CRTDBG_LEAK_CHECK_DF);
- #endif // WIN32
- 
---- misc/silgraphite-2.3.1/engine/test/RegressionTest/main.h	2009-01-29 17:33:19.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/engine/test/RegressionTest/main.h	2009-08-23 20:59:15.945750000 +0900
-@@ -36,7 +36,7 @@
- ////#include <algorithm>
- #include <string>
- #include <cstring>
--#ifdef _WIN32
-+#if defined(_WIN32) && !defined(__MINGW32__)
- #include <crtdbg.h>
- #endif // _WIN32
- #include <assert.h>
---- misc/silgraphite-2.3.1/wrappers/win32/WinFont.cpp	2009-01-29 17:33:19.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/wrappers/win32/WinFont.cpp	2009-08-23 20:59:16.211375000 +0900
-@@ -408,7 +408,7 @@
- 					if (pPolyCurve->wType == TT_PRIM_QSPLINE &&
- 						// test if this is the last curve
- 						pPolyHdr->cb - (int)((byte *)(&pPolyCurve->apfx[j]) - (byte *)(pPolyHdr))
--							== sizeof POINTFX &&
-+							== sizeof(POINTFX) &&
- 						// and the two points are identical
- 						CompareFixed(pPolyCurve->apfx[j].x, pPolyHdr->pfxStart.x) &&
- 						CompareFixed(pPolyCurve->apfx[j].y, pPolyHdr->pfxStart.y))
-@@ -846,7 +846,7 @@
- 
- } // namespace gr
- 
--template stdext::hash_map<
-+template class stdext::hash_map<
- 	gr::WinFont::LogFontWrapper,
- 	gr::WinFont::FontHandleCache::FontCacheValue,
- 	gr::WinFont::LogFontHashFuncs>;
---- misc/silgraphite-2.3.1/wrappers/win32/WinFont.h	2009-01-29 17:33:19.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/wrappers/win32/WinFont.h	2009-08-23 20:59:16.367625000 +0900
-@@ -17,6 +17,9 @@
- #endif
- #ifndef WINFONT_INCLUDED
- #define WINFONT_INCLUDED
-+#if __GNUC__ >=3
-+#pragma GCC system_header
-+#endif
- 
- //:End Ignore
- 
-@@ -27,6 +30,8 @@
- #include "GrClient.h"
- #include "Font.h"
- 
-+namespace stdext = std;
-+
- #ifdef _STLPORT_VERSION
- namespace stdext = _STLP_STD;
- #endif
---- misc/silgraphite-2.3.1/wrappers/win32/WinSegmentPainter.h	2008-05-09 20:10:30.000000000 +0900
-+++ misc/build/silgraphite-2.3.1/wrappers/win32/WinSegmentPainter.h	2009-08-23 21:14:38.961375000 +0900
-@@ -82,7 +82,7 @@
- 	//	return ::SetBkColor(hdc, PALETTERGB(GetRValue(clr), GetGValue(clr), GetBValue(clr)));
- 	//}
- 
--	void WinSegmentPainter::paintAux();
-+	void paintAux();
- 
- protected:
- 	// member variables:
diff --git helpcontent2/prj/d.lst helpcontent2/prj/d.lst
index 7f3f478..862d969 100644
--- helpcontent2/prj/d.lst
+++ helpcontent2/prj/d.lst
@@ -4,14 +4,11 @@ mkdir: %COMMON_DEST%\bin%_EXT%
 ..\helpers\hid.lst %COMMON_DEST%\bin%_EXT%\hid.lst
 ..\%__SRC%\bin\helpimg.ilst %COMMON_DEST%\res%_EXT%\img\helpimg.ilst
 
-..\%__SRC%\bin\sbasic_*.zip %_DEST%\pck%_EXT%
 ..\%__SRC%\bin\scalc_*.zip %_DEST%\pck%_EXT%
 ..\%__SRC%\bin\schart_*.zip %_DEST%\pck%_EXT%
-..\%__SRC%\bin\sdatabase_*.zip %_DEST%\pck%_EXT%
 ..\%__SRC%\bin\sdraw_*.zip %_DEST%\pck%_EXT%
 ..\%__SRC%\bin\shared_*.zip %_DEST%\pck%_EXT%
 ..\%__SRC%\bin\simpress_*.zip %_DEST%\pck%_EXT%
-..\%__SRC%\bin\smath_*.zip %_DEST%\pck%_EXT%
 ..\%__SRC%\bin\swriter_*.zip %_DEST%\pck%_EXT%
 
 ..\%__SRC%\bin\helpxsl.zip %_DEST%\pck%_EXT%\helpxsl.zip
diff --git helpcontent2/settings.pmk helpcontent2/settings.pmk
index 296f7b7..614768d 100755
--- helpcontent2/settings.pmk
+++ helpcontent2/settings.pmk
@@ -1,5 +1,7 @@
 .INCLUDE : $(INCCOM)$/aux_langs.mk
 
+.IF "$(OOo4Kids)" != "YES"
+
 my_cp:=$(CLASSPATH)$(PATH_SEPERATOR)$(SOLARBINDIR)$/jaxp.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/juh.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/parser.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/unoil.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/ridl.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jurt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlsearch.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/LuceneHelpWrapper.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/HelpIndexerTool.jar$
 
 .IF "$(SYSTEM_LUCENE)" == "YES"
@@ -12,4 +14,7 @@ my_cp!:=$(my_cp)$(PATH_SEPERATOR)$(SOLARBINDIR)/lucene-core-2.3.jar$(PATH_SEPERA
 JAVA_LIBRARY_PATH= -Djava.library.path=$(SOLARSHAREDBIN)
 .ENDIF 
 
+.ENDIF 
+
 aux_alllangiso:=$(foreach,i,$(alllangiso) $(foreach,j,$(aux_langdirs) $(eq,$i,$j  $i $(NULL))))
+
diff --git helpcontent2/source/auxiliary/makefile.mk helpcontent2/source/auxiliary/makefile.mk
index 1155e80..b5af4a4 100644
--- helpcontent2/source/auxiliary/makefile.mk
+++ helpcontent2/source/auxiliary/makefile.mk
@@ -22,10 +22,8 @@ TARGET  = auxiliary
 .INCLUDE : settings.mk
 
 TREEFILES  = \
-    sbasic.tree \
     simpress.tree \
     scalc.tree \
-    smath.tree \
     schart.tree \
     swriter.tree \
     shared.tree
diff --git helpcontent2/util/sbasic/makefile.mk helpcontent2/util/sbasic/makefile.mk
index 33b97ab..c4873a4 100644
--- helpcontent2/util/sbasic/makefile.mk
+++ helpcontent2/util/sbasic/makefile.mk
@@ -17,6 +17,12 @@
 PRJ		= ..$/..
 # same for all makefiles in "helpcontent2"
 PRJNAME = helpcontent2
+
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 # uniqe name (module wide);
 # using a modified form of package should do here
 TARGET  = util_sbasic
diff --git helpcontent2/util/sdatabase/makefile.mk helpcontent2/util/sdatabase/makefile.mk
index fd99bb2..5f1fe8b 100644
--- helpcontent2/util/sdatabase/makefile.mk
+++ helpcontent2/util/sdatabase/makefile.mk
@@ -23,6 +23,11 @@ TARGET  = util_sdatabase
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
diff --git helpcontent2/util/smath/makefile.mk helpcontent2/util/smath/makefile.mk
index 51d8baf..ae3df0d 100644
--- helpcontent2/util/smath/makefile.mk
+++ helpcontent2/util/smath/makefile.mk
@@ -17,6 +17,12 @@
 PRJ		= ..$/..
 # same for all makefiles in "helpcontent2"
 PRJNAME = helpcontent2
+
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 # uniqe name (module wide);
 # using a modified form of package should do here
 TARGET  = util_smath
diff --git helpcontent2/util/target.pmk helpcontent2/util/target.pmk
index 58d9de8..624bfd4 100755
--- helpcontent2/util/target.pmk
+++ helpcontent2/util/target.pmk
@@ -39,9 +39,9 @@ JAVA_LIBRARY_PATH= -Djava.library.path=$(SOLARSHAREDBIN)
 .ENDIF
  
 $(LINKALLTARGETS) : $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/$$(@:b:s/_/./:e:s/.//)/$i) $(subst,LANGUAGE,$$(@:b:s/_/./:e:s/.//) $(LINKADDEDDEPS)) $(COMMONMISC)$/xhp_changed.flag $(PRJ)$/helpers$/hid.lst
-    $(HELPLINKER) @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers$/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -zipdir $(MISC)$/ziptmp$(@:b) -idxcaption $(PRJ)$/source$/auxiliary$/idxcaption.xsl -idxcontent $(PRJ)$/source$/auxiliary$/idxcontent.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
-.IF "$(SOLAR_JAVA)" == "TRUE"
-    $(JAVAI) $(JAVA_LIBRARY_PATH) -cp "$(my_cp)" com.sun.star.help.HelpIndexerTool -lang $(@:b:s/_/./:e:s/.//) -mod $(LINKNAME) -zipdir $(MISC)$/ziptmp$(@:b) -o $@ -checkcfsname _0
+    $(HELPLINKER) @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -zipdir $(MISC)$/ziptmp$(@:b) -idxcaption $(PRJ)$/source$/auxiliary$/idxcaption.xsl -idxcontent $(PRJ)$/source$/auxiliary$/idxcontent.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
+.IF "$(SOLAR_JAVA)" == "TRUE" && "$(OOo4Kids)" != "YES"
+    $(JAVAI) $(JAVA_LIBRARY_PATH) -cp "$(my_cp)" com.sun.star.help.HelpIndexer -lang $(@:b:s/_/./:e:s/.//) -mod $(LINKNAME) -zipdir $(MISC)$/ziptmp$(@:b) -o $@ -checkcfsname _0
 .ELSE
     -$(RM) $(MISC)$/ziptmp$(@:b)$/content/*.*
     -$(RM) $(MISC)$/ziptmp$(@:b)$/caption/*.*
diff --git hsqldb/makefile.mk hsqldb/makefile.mk
index b38dea0..db6bb92 100755
--- hsqldb/makefile.mk
+++ hsqldb/makefile.mk
@@ -43,6 +43,11 @@ ANT_BUILDFILE=build$/build.xml
 
 .INCLUDE : antsettings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
+
 .INCLUDE :  version.mk
 
 .IF "$(SOLAR_JAVA)" != ""
diff --git hsqldb/patches/i103528.patch hsqldb/patches/i103528.patch
deleted file mode 100644
index 3cc7d2f..0000000
--- hsqldb/patches/i103528.patch
+++ /dev/null
@@ -1,11 +0,0 @@
---- misc/hsqldb/src/org/hsqldb/Library.java
-+++ misc/build/hsqldb/src/org/hsqldb/Library.java
-@@ -1957,7 +1957,7 @@
-         functionMap.put("bitand", bitand);
-         functionMap.put("bitlength", bitLength);
-         functionMap.put("bitor", bitor);
--        functionMap.put("bitxor", bitor);
-+        functionMap.put("bitxor", bitxor);
-         functionMap.put("character", character);
-         functionMap.put("concat", concat);
-         functionMap.put("cot", cot);
diff --git hsqldb/patches/i104901.patch hsqldb/patches/i104901.patch
deleted file mode 100644
index a38773f..0000000
--- hsqldb/patches/i104901.patch
+++ /dev/null
@@ -1,27 +0,0 @@
---- misc/hsqldb/src/org/hsqldb/Table.java	2007-10-19 23:59:07.000000000 +0200
-+++ misc/build/hsqldb/src/org/hsqldb/Table.java	2009-09-11 13:45:42.939231519 +0200
-@@ -149,10 +149,10 @@
-     Constraint[]      constraintList;                 // constrainst for the table
-     HsqlArrayList[]   triggerLists;                   // array of trigger lists
-     private int[]     colTypes;                       // fredt - types of columns
--    private int[]     colSizes;                       // fredt - copy of SIZE values for columns
-+    int[]     	      colSizes;                       // fredt - copy of SIZE values for columns
-     private int[]     colScales;                      // fredt - copy of SCALE values for columns
-     private boolean[] colNullable;                    // fredt - modified copy of isNullable() values
--    private Expression[] colDefaults;                 // fredt - expressions of DEFAULT values
-+    Expression[] 	  colDefaults;                 // fredt - expressions of DEFAULT values
-     private int[]        defaultColumnMap;            // fred - holding 0,1,2,3,...
-     private boolean      hasDefaultValues;            //fredt - shortcut for above
-     boolean              sqlEnforceSize;              // inherited from the database -
---- misc/hsqldb/src/org/hsqldb/TableWorks.java	2007-01-14 06:48:16.000000000 +0100
-+++ misc/build/hsqldb/src/org/hsqldb/TableWorks.java	2009-09-11 13:47:50.328667463 +0200
-@@ -670,7 +670,8 @@
-             // default expressions can change
-             oldCol.setType(newCol);
-             oldCol.setDefaultExpression(newCol.getDefaultExpression());
--            table.setColumnTypeVars(colIndex);
-+			table.colSizes[colIndex]    = oldCol.getSize();
-+            table.colDefaults[colIndex] = oldCol.getDefaultExpression();
-             table.resetDefaultsFlag();
- 
-             return;
diff --git hsqldb/patches/i96823.patch hsqldb/patches/i96823.patch
deleted file mode 100644
index 9803bc6..0000000
--- hsqldb/patches/i96823.patch
+++ /dev/null
@@ -1,94 +0,0 @@
---- misc/hsqldb/src/org/hsqldb/Expression.java	2008-05-27 17:15:05.000000000 +0200
-+++ misc/build/hsqldb/src/org/hsqldb/Expression.java	2009-01-27 11:42:16.890625000 +0100
-@@ -803,61 +803,62 @@
- 
-             case EXISTS :
-                 buf.append(' ').append(Token.T_EXISTS).append(' ');
--                break;
-+
-+                return buf.toString();
- 
-             case COUNT :
-                 buf.append(' ').append(Token.T_COUNT).append('(');
--                break;
-+                return buf.toString();
- 
-             case SUM :
-                 buf.append(' ').append(Token.T_SUM).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case MIN :
-                 buf.append(' ').append(Token.T_MIN).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case MAX :
-                 buf.append(' ').append(Token.T_MAX).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case AVG :
-                 buf.append(' ').append(Token.T_AVG).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case EVERY :
-                 buf.append(' ').append(Token.T_EVERY).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case SOME :
-                 buf.append(' ').append(Token.T_SOME).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case STDDEV_POP :
-                 buf.append(' ').append(Token.T_STDDEV_POP).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case STDDEV_SAMP :
-                 buf.append(' ').append(Token.T_STDDEV_SAMP).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case VAR_POP :
-                 buf.append(' ').append(Token.T_VAR_POP).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
- 
-             case VAR_SAMP :
-                 buf.append(' ').append(Token.T_VAR_SAMP).append('(');
-                 buf.append(left).append(')');
--                break;
-+                return buf.toString();
-         }
- 
-         throw Trace.error(Trace.EXPRESSION_NOT_SUPPORTED);
-@@ -1522,6 +1523,16 @@
-         if (exprType == COLUMN) {
-             return columnName;
-         }
-+        if ( isAggregate(exprType) )
-+        {
-+            try
-+            {
-+                return getDDL();
-+            }
-+            catch(Exception e)
-+            {
-+            }
-+        }
- 
-         return "";
-     }
diff --git hsqldb/patches/i97032.patch hsqldb/patches/i97032.patch
deleted file mode 100644
index 9703b89..0000000
--- hsqldb/patches/i97032.patch
+++ /dev/null
@@ -1,10 +0,0 @@
---- misc/hsqldb/src/org/hsqldb/persist/HsqlDatabaseProperties.java	2008-03-17 17:05:41.000000000 +0100
-+++ misc/build/hsqldb/src/org/hsqldb/persist/HsqlDatabaseProperties.java	2009-01-21 13:09:24.493470142 +0100
-@@ -429,6 +429,7 @@
-             setProperty(hsqldb_log_size, 10);
-             setProperty(sql_enforce_strict_size, true);
-             setProperty(hsqldb_nio_data_file, false);
-+			setProperty(hsqldb_lock_file, true);
-         }
- 
-         // OOo end
diff --git hsqldb/patches/index.txt hsqldb/patches/index.txt
new file mode 100644
index 0000000..a7a06fc
--- /dev/null
+++ hsqldb/patches/index.txt
@@ -0,0 +1,17 @@
+====================================================================================
+File name
+---------
+  patch_file.patch
+
+Description
+-----------
+  patches HSQL so that ....
+
+Issue
+-----
+  http://www.openoffice.org/issues/show_bug.cgi?id=?????
+  http://www.openoffice.org/issues/show_bug.cgi?id=85087
+  http://www.openoffice.org/issues/show_bug.cgi?id=97032
+  <summary>
+
+
diff --git instsetoo_native/inc_ooolangpack/windows/msi_templates/Binary.idt instsetoo_native/inc_ooolangpack/windows/msi_templates/Binary.idt
index 0b638cb..4eb0781 100644
--- instsetoo_native/inc_ooolangpack/windows/msi_templates/Binary.idt
+++ instsetoo_native/inc_ooolangpack/windows/msi_templates/Binary.idt
@@ -1,8 +1,8 @@
 Name	Data
 s72	v0
 Binary	Name
-ImageBmp	Image.bmp
-BannerBmp	Banner.bmp
+ImageBmp	Image2.bmp
+BannerBmp	Banner2.bmp
 CautionIco	caution.ico
 DontInstallIco	dontinstall.ico
 OpenFolderIco	openfolder.ico
diff --git instsetoo_native/inc_openoffice/windows/msi_languages/Control.ulf instsetoo_native/inc_openoffice/windows/msi_languages/Control.ulf
index 5468076..c691aaf 100644
--- instsetoo_native/inc_openoffice/windows/msi_languages/Control.ulf
+++ instsetoo_native/inc_openoffice/windows/msi_languages/Control.ulf
@@ -1,5 +1,5 @@
 [OOO_CONTROL_3]
-en-US = "Cancel"
+en-US = "{&MSSansBold12}Cancel"
 
 [OOO_CONTROL_5]
 en-US = "&Look in:"
@@ -89,7 +89,7 @@ en-US = "Please enter your information."
 en-US = "Install this application for:"
 
 [OOO_CONTROL_40]
-en-US = "{&MSSansBold8}Customer Information"
+en-US = "User Information"
 
 [OOO_CONTROL_41]
 en-US = "{\Tahoma8}{50}"
@@ -122,7 +122,7 @@ en-US = "Select the program features you want installed."
 en-US = "Click on an icon in the list below to change how a feature is installed."
 
 [OOO_CONTROL_54]
-en-US = "{&MSSansBold8}Custom Setup"
+en-US = "Custom Setup"
 
 [OOO_CONTROL_55]
 en-US = "Feature Description:"
@@ -212,7 +212,7 @@ en-US = "&Change..."
 en-US = "Click Next to install to this folder, or click Change to install to a different folder."
 
 [OOO_CONTROL_90]
-en-US = "{&MSSansBold8}Destination Folder"
+en-US = "Destination Folder"
 
 [OOO_CONTROL_91]
 en-US = "[INSTALLDIR]"
@@ -263,7 +263,7 @@ en-US = "&Look in:"
 en-US = "Browse to the destination folder."
 
 [OOO_CONTROL_115]
-en-US = "{&MSSansBold8}Change Current Destination Folder"
+en-US = "Change Current Destination Folder"
 
 [OOO_CONTROL_117]
 en-US = "Create New Folder|"
@@ -284,7 +284,15 @@ en-US = "< &Back"
 en-US = "Cancel"
 
 [OOO_CONTROL_124]
-en-US = "Build contributed in collaboration with the community by Sun Microsystems, Inc. For credits, see: http://www.openoffice.org/welcome/credits.html"
+de = "{&MSSansBold10}Dies ist OOo4Kids, eine neue Office Suite fr 7 bis 12-jhrige , basierend auf dem Quelltext von OpenOffice.org. Siehe auch http://wiki.ooo4Kids.org"
+en-US = "{&MSSansBold10}This is OOo4Kids, a new 7-12 Office Suite, based on OpenOffice.org sources. See http://wiki.ooo4Kids.org"
+es = "{&MSSansBold10}OOo4Kids es una nueva suite ofimtica para edades de 7-12 aos, basada en el cdigo fuente de OpenOffice.org. Ver http://wiki.ooo4kids.org"
+fr = "{&MSSansBold10}OOo4Kids est une suite bureautique pour les 7-12 ans, base sur le code source d'OpenOffice.org. Voir http://wiki.ooo4kids.org"
+it = " {&MSSansBold10}OOo4kids  una suite d'ufficio per bambini dai 7 ai 12 anni basata sul codice sorgente di OpenOffice.org. Vedi http://wiki.ooo4kids.org"
+nl = "{&MSSansBold10}Dit is OOo4Kids, een nieuw Kantoorpakket voor 7 tot 12 jarigen , gebaseerd op de code van OpenOffice.org. Zie ook http://wiki.ooo4Kids.org"
+pt = "{&MSSansBold10}Este  o OOo4Kids, um novo pacote de ferramentas de escritrio para idades entre os 7 e os 12 anos, baseado no cdigo fonte do OpenOffice.org. Ver http://wiki.ooo4Kids.org"
+zh-CN = "{&MSSansBold10}OOo4Kids7-12OpenOffice.orghttp://wiki.ooo4Kids.org"
+fi = "{&MSSansBold10}Tm on OOo4Kids, uusi, OpenOffice.org-lhdekoodiin pohjautuva toimisto-ohjelmisto 7...12-vuotiaille. Katso http://wiki.ooo4Kids.org"
 
 [OOO_CONTROL_125]
 en-US = "&Next >"
@@ -401,7 +409,7 @@ en-US = "{&MSSansBold8}Ready to Modify the Program"
 en-US = "{&MSSansBold8}Ready to Repair the Program"
 
 [OOO_CONTROL_172]
-en-US = "{&MSSansBold8}Ready to Install the Program"
+en-US = "Ready to Install the Program"
 
 [OOO_CONTROL_173]
 en-US = "&Install"
diff --git instsetoo_native/inc_openoffice/windows/msi_languages/Nsis.ulf instsetoo_native/inc_openoffice/windows/msi_languages/Nsis.ulf
index 349200a..55ffd43 100644
--- instsetoo_native/inc_openoffice/windows/msi_languages/Nsis.ulf
+++ instsetoo_native/inc_openoffice/windows/msi_languages/Nsis.ulf
@@ -5,7 +5,7 @@ en-US = "%PRODUCTNAME %PRODUCTVERSION Installation Preparation"
 en-US = "Thank you for downloading %PRODUCTNAME %PRODUCTVERSION."
 
 [MUI_TEXT_WELCOME_INFO_TEXT]
-en-US = "The installation files must be unpacked and copied to your hard disk in preparation for the installation. After that, the %PRODUCTNAME installation will start automatically.\r\n\r\nClick \'Next\' to continue."
+en-US = "Welcome in %PRODUCTNAME.\r\n\r\nFollow the \' --> \' to proceed the installation."
 
 [MUI_TEXT_DIRECTORY_TITLE]
 en-US = "Select Folder"
@@ -17,7 +17,7 @@ en-US = "Select the folder in which to save the unpacked files."
 en-US = "&Unpack"
 
 [DirText]
-en-US = "The %PRODUCTNAME %PRODUCTVERSION installation files will be unpacked and saved in the folder shown below. If you would like to save %PRODUCTNAME to a different folder, click \'Browse\' to select another folder."
+en-US = "\r\n\r\n%PRODUCTNAME %PRODUCTVERSION will be installed in c:\Windows\Program Files\OOo4Kids 0.5 \r\n\r\nIf you would like to install %PRODUCTNAME to a different folder, click \'Browse\' to select another folder."
 
 [DirSubText]
 en-US = "Destination Folder"
diff --git instsetoo_native/inc_openoffice/windows/msi_templates/Binary.idt instsetoo_native/inc_openoffice/windows/msi_templates/Binary.idt
index 0b638cb..4eb0781 100644
--- instsetoo_native/inc_openoffice/windows/msi_templates/Binary.idt
+++ instsetoo_native/inc_openoffice/windows/msi_templates/Binary.idt
@@ -1,8 +1,8 @@
 Name	Data
 s72	v0
 Binary	Name
-ImageBmp	Image.bmp
-BannerBmp	Banner.bmp
+ImageBmp	Image2.bmp
+BannerBmp	Banner2.bmp
 CautionIco	caution.ico
 DontInstallIco	dontinstall.ico
 OpenFolderIco	openfolder.ico
diff --git instsetoo_native/inc_openoffice/windows/msi_templates/RegLocat.idt instsetoo_native/inc_openoffice/windows/msi_templates/RegLocat.idt
index 349aa06..b45a4df 100644
--- instsetoo_native/inc_openoffice/windows/msi_templates/RegLocat.idt
+++ instsetoo_native/inc_openoffice/windows/msi_templates/RegLocat.idt
@@ -1,11 +1,11 @@
 Signature_	Root	Key	Name	Type
 s72	i2	s255	S255	I2
 RegLocator	Signature_
-ureuninstalluser	1	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	UREINSTALLLOCATION	2
-ureuninstallmachine	2	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	UREINSTALLLOCATION	2
-basisuninstalluser	1	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	BASISINSTALLLOCATION	2
-basisuninstallmachine	2	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	BASISINSTALLLOCATION	2
-officeuninstalluser	1	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	OFFICEINSTALLLOCATION	2
-officeuninstallmachine	2	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	OFFICEINSTALLLOCATION	2
-installuser	1	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	INSTALLLOCATION	2
-installmachine	2	Software\OpenOffice.org\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	INSTALLLOCATION	2
+ureuninstalluser	1	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	UREINSTALLLOCATION	2
+ureuninstallmachine	2	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	UREINSTALLLOCATION	2
+basisuninstalluser	1	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	BASISINSTALLLOCATION	2
+basisuninstallmachine	2	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	BASISINSTALLLOCATION	2
+officeuninstalluser	1	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	OFFICEINSTALLLOCATION	2
+officeuninstallmachine	2	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	OFFICEINSTALLLOCATION	2
+installuser	1	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	INSTALLLOCATION	2
+installmachine	2	Software\OOo4Kids\LAYERNAMETEMPLATE\[DEFINEDPRODUCT]\[BRANDPACKAGEVERSION]	INSTALLLOCATION	2
diff --git instsetoo_native/inc_openoffice/windows/msi_templates/TextStyl.idt instsetoo_native/inc_openoffice/windows/msi_templates/TextStyl.idt
index b4575c1..a5dc84c 100644
--- instsetoo_native/inc_openoffice/windows/msi_templates/TextStyl.idt
+++ instsetoo_native/inc_openoffice/windows/msi_templates/TextStyl.idt
@@ -9,6 +9,8 @@ CourierNew8	Courier New	8
 CourierNew9	Courier New	9		
 MSGothic9	MS Gothic	9		
 MSSansBold8	Tahoma	8		1
+MSSansBold12	Tahoma	12		1
+MSSansBold14	Tahoma	14		1
 MSSansSerif8	MS Sans Serif	8		
 MSSansSerif9	MS Sans Serif	9		
 MSSGreySerif8	MS Sans Serif	8	8421504	
diff --git instsetoo_native/inc_openoffice/windows/msi_templates/codes.txt instsetoo_native/inc_openoffice/windows/msi_templates/codes.txt
index ed60bf7..704a31f 100644
--- instsetoo_native/inc_openoffice/windows/msi_templates/codes.txt
+++ instsetoo_native/inc_openoffice/windows/msi_templates/codes.txt
@@ -34,4 +34,4 @@ multiwestern = "{6D8FE0C8-000D-4486-9814-135AE44A44BD}"
 multiasia = "{0AA645C9-1281-4C48-B8B8-BB424A8AF709}"
 
 [UPGRADECODE]
-en-US = "{7C35B9AB-2CE3-4C18-BE7C-5B97EA089EB3}"
+en-US = "{076D000B-1960-42B4-A4DF-C3BF36470329}"
diff --git instsetoo_native/inc_sdkoo/windows/msi_templates/RegLocat.idt instsetoo_native/inc_sdkoo/windows/msi_templates/RegLocat.idt
index 5121f78..b5c29ad 100644
--- instsetoo_native/inc_sdkoo/windows/msi_templates/RegLocat.idt
+++ instsetoo_native/inc_sdkoo/windows/msi_templates/RegLocat.idt
@@ -1,5 +1,5 @@
 Signature_	Root	Key	Name	Type
 s72	i2	s255	S255	I2
 RegLocator	Signature_
-basisinstalluser	1	Software\OpenOffice.org\LAYERNAMETEMPLATE\Basis\[OOOBASEVERSION]	BASISINSTALLLOCATION	2
-basisinstallmachine	2	Software\OpenOffice.org\LAYERNAMETEMPLATE\Basis\[OOOBASEVERSION]	BASISINSTALLLOCATION	2
+basisinstalluser	1	Software\OOo4Kids\LAYERNAMETEMPLATE\Basis\[OOOBASEVERSION]	BASISINSTALLLOCATION	2
+basisinstallmachine	2	Software\OOo4Kids\LAYERNAMETEMPLATE\Basis\[OOOBASEVERSION]	BASISINSTALLLOCATION	2
diff --git instsetoo_native/macosx/make_versioned.sh instsetoo_native/macosx/make_versioned.sh
index 2879614..9d9b354 100755
--- instsetoo_native/macosx/make_versioned.sh
+++ instsetoo_native/macosx/make_versioned.sh
@@ -36,10 +36,15 @@
 #
 
 # version commands, similar to other OOo code
-MAJOR=`sed -n '/^OpenOffice$/,/^}$/ s/.*USERDIRPRODUCTVERSION //p' ../util/openoffice.lst`
-MAJOR_MINOR=`sed -n '/^OpenOffice$/,/PRODUCTVERSION/ s/.*PRODUCTVERSION //p' ../util/openoffice.lst`
-MAJOR_MINOR_STEP=`sed -n '/^OpenOffice$/,/^}$/ s/.*ABOUTBOXPRODUCTVERSION //p' ../util/openoffice.lst`
-
+.IF "$(OOo4Kids)"=="YES"
+MAJOR=`sed -n '/^OOo4Kids$/,/^}$/ s/.*USERDIRPRODUCTVERSION //p' ../util/OOo4Kids.lst`
+MAJOR_MINOR=`sed -n '/^OOo4Kids$/,/PRODUCTVERSION/ s/.*PRODUCTVERSION //p' ../util/OOo4Kids.lst`
+MAJOR_MINOR_STEP=`sed -n '/^OOo4Kids$/,/^}$/ s/.*ABOUTBOXPRODUCTVERSION //p' ../util/OOo4Kids.lst`
+.ELSE
+MAJOR=`sed -n '/^OpenOffice.org$/,/^}$/ s/.*USERDIRPRODUCTVERSION //p' ../util/openoffice.lst`
+MAJOR_MINOR=`sed -n '/^OpenOffice.org$/,/PRODUCTVERSION/ s/.*PRODUCTVERSION //p' ../util/openoffice.lst`
+MAJOR_MINOR_STEP=`sed -n '/^OpenOffice.org$/,/^}$/ s/.*ABOUTBOXPRODUCTVERSION //p' ../util/openoffice.lst`
+.ENDIF
 
 if [ -z "$1" -o -z "$2" ]; then
   echo "ERROR: missing argument(s):";
diff --git instsetoo_native/macosx/makefile.mk instsetoo_native/macosx/makefile.mk
index 0fc0a13..0922e28 100644
--- instsetoo_native/macosx/makefile.mk
+++ instsetoo_native/macosx/makefile.mk
@@ -45,7 +45,12 @@ dummy:
 
 .ELSE           # "$(OS)"!="MACOSX"
 
+.IF "$(OOo4Kids)"=="YES"
+BUNDLE = $(MISC)$/OOo4Kids.app
+.ELSE
 BUNDLE = $(MISC)$/OpenOffice.org.app
+.ENDIF
+
 CONTENTS = $(BUNDLE)$/Contents
 VERSIONED = $(MISC)$/versioned
 
diff --git instsetoo_native/util/OOo4Kids.lst instsetoo_native/util/OOo4Kids.lst
new file mode 100644
index 0000000..f1ac1f7
--- /dev/null
+++ instsetoo_native/util/OOo4Kids.lst
@@ -0,0 +1,526 @@
+Globals
+{
+    Settings
+    {
+        variables
+        {
+            OOOBASEVERSION 0.9
+            OOOPACKAGEVERSION 3.0.0
+            OOOPACKAGEVERSION_LINUX 0.9
+            UREPACKAGEVERSION 1.5.0
+            URELAYERVERSION 1
+            BASISROOTNAME OOo4Kids
+            UNIXBASISROOTNAME ooo4kids0.9
+            UNIXBASISROOTNAME_XO OOo4Kids.activity
+            SERVICETAG_PRODUCTNAME OOo4Kids 0.9 
+            SERVICETAG_PRODUCTVERSION 0.9
+            SERVICETAG_PARENTNAME OOo4Kids 0.9 
+            SERVICETAG_SOURCE {buildsource}{minor}(Build:{buildid})
+            SERVICETAG_URN urn:uuid:77776666-5555-4444-3333-222211110000
+            HIDELICENSEDIALOG 1
+            PACKAGEPREFIX 
+            BASISPACKAGEPREFIX OOo4Kids
+            UREPACKAGEPREFIX OOo4Kids
+            SOLSUREPACKAGEPREFIX OOo4Kids
+            USE_FILEVERSION 1
+            LIBRARYVERSION 9.0.0
+                REGISTRATION_HOST http://null
+            REGISTRATIONURL http://null
+            PROGRESSBARCOLOR 4,68,155
+            PROGRESSSIZE 412,7
+            PROGRESSPOSITION 14,230
+            PROGRESSFRAMECOLOR 58,159,232
+            REGISTRYLAYERNAME Layers
+            SERVICEPACK 1
+            UPDATE_DATABASE 1
+            CREATE_MSP_INSTALLSET 0
+            UPDATE_DATABASE_LISTNAME finals_instsetoo.txt
+ 			PACKAGEMAP package_names.txt,package_names_ext.txt
+            WINDOWSPATCHLEVEL 2
+        }
+    }
+}
+
+OOo4Kids
+{
+    Settings
+    {
+        variables
+        {
+            PRODUCTNAME OOo4Kids
+            PRODUCTVERSION 0.9
+            PRODUCTEXTENSION 
+            LONG_PRODUCTEXTENSION 
+            SHORT_PRODUCTEXTENSION 
+            POSTVERSIONEXTENSION
+            POSTVERSIONEXTENSIONUNIX
+            BRANDPACKAGEVERSION 0.9
+            USERDIRPRODUCTVERSION 0.9
+            ABOUTBOXPRODUCTVERSION 0.9
+            BASEPRODUCTVERSION 0.9
+            UPDATEURL http://null
+            ODFNOTIFYURL http://null
+            REMOVE_UPGRADE_CODE_FILE upgradecode_remove_ooo.txt
+            ADDSYSTEMINTEGRATION 1
+            EVAL
+            FILEFORMATNAME OpenOffice.org
+            FILEFORMATVERSION 1.0
+            WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+            PACKAGEVERSION 0.9
+            PACKAGEREVISION {milestone}
+            LICENSENAME unknown
+            SERVICESPROJEKT 1
+            GLOBALFILEGID gid_File_Lib_Vcl
+            GLOBALPATCHFILEGID gid_File_Txt_Patchfiles
+            SPELLCHECKERFILE spellchecker_selection.txt
+            OPENSOURCE 1
+            SETSTATICPATH 1
+            OOODOWNLOADNAME 1
+            PROGRAMFILESROOT 1
+            XPDINSTALLER 0
+            BETAUPGRADECODE
+            STUBUPGRADECODE {0E7B27B8-D658-4BF9-98D6-EC361582EB4A}
+            CHANGETARGETDIR 1
+            USE_FILEVERSION 1
+            LIBRARYVERSION 9.0.0
+            PATCHCODEFILE ooo_patchcodes.txt
+            DOWNLOADBANNER	Banner2.bmp
+            DOWNLOADBITMAP	Image2.bmp
+            DOWNLOADSETUPICO	ooo4kids_setup.ico
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://null
+            STARTCENTER_INFO_URL http://null
+            STARTCENTER_TEMPLREP_URL http://null
+            REGISTRATION_PRODUCT OOo4Kids
+            REGISTRATION_CID 000000
+        }
+        active			1
+        compression		5
+        script			setup_osl
+        downloadname	OOo4Kids_{productversion}_{os}_install_{languages}
+        langpackdownloadname	OOo4Kids_{productversion}_languagepack_{os}_install_{languages}
+        include			{solarenvpath}/{os}/loader2,.,{localcommonpath}/bin,{localpath}/bin,{solarpath}/bin.{minor}/ooowoure,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor}/desktop-integration/{pkgtype},{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarpath}/pck.{minor}/openoffice,{solarpath}/pck.{minor},{solarpath}/xml.{minor}/office/instance,{solarpath}/xml.{minor},{solarcommonpath}/bin.{minor}/osl,{solarcommonpath}/bin.{minor},{solarcommonpath}/pck.{minor}/openoffice,{solarcommonpath}/pck.{minor},../../external/common,{solarenvpath}/{os}/OOo4Kids_external
+    }
+}
+
+OOo4Kids_wJRE
+{
+    Settings
+    {
+        variables
+        {
+            PRODUCTNAME OOo4Kids
+            PRODUCTVERSION 0.9
+            PRODUCTEXTENSION 
+            LONG_PRODUCTEXTENSION 
+            SHORT_PRODUCTEXTENSION 
+            POSTVERSIONEXTENSION
+            POSTVERSIONEXTENSIONUNIX
+            BRANDPACKAGEVERSION 0.9
+            USERDIRPRODUCTVERSION 0.9
+            ABOUTBOXPRODUCTVERSION 0.9
+            BASEPRODUCTVERSION 0.9
+            UPDATEURL http://null
+            ODFNOTIFYURL http://null
+            REMOVE_UPGRADE_CODE_FILE upgradecode_remove_ooo.txt
+            ADDSYSTEMINTEGRATION 1
+            EVAL
+            FILEFORMATNAME OpenOffice.org
+            FILEFORMATVERSION 1.0
+            WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+            PACKAGEVERSION 3.0.0
+            PACKAGEREVISION {milestone}
+            LICENSENAME LGPL
+            SERVICESPROJEKT 1
+            GLOBALFILEGID gid_File_Lib_Vcl
+            GLOBALPATCHFILEGID gid_File_Txt_Patchfiles
+            SPELLCHECKERFILE spellchecker_selection.txt
+            OPENSOURCE 1
+            SETSTATICPATH 1
+            OOODOWNLOADNAME 1
+            PROGRAMFILESROOT 1
+            XPDINSTALLER 1
+            BETAUPGRADECODE
+            STUBUPGRADECODE {0E7B27B8-D658-4BF9-98D6-EC361582EB4A}
+            CHANGETARGETDIR 1
+            USE_FILEVERSION 1
+            LIBRARYVERSION 9.0.0
+            PATCHCODEFILE ooo_patchcodes.txt
+            JAVAPRODUCT 1
+            DOWNLOADBANNER	Banner2.bmp
+            DOWNLOADBITMAP	Image2.bmp
+            DOWNLOADSETUPICO	ooo4kids_setup.ico
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://null
+            STARTCENTER_INFO_URL http://null
+            STARTCENTER_TEMPLREP_URL http://null
+            REGISTRATION_PRODUCT OOo4Kids
+            REGISTRATION_CID 000000
+        }
+        active			1
+        compression		5
+        script			setup_osljre
+        downloadname	OOo4Kids_{productversion}_{os}_installwjre_{languages}
+        include			{solarenvpath}/{os}/loader2,.,{localcommonpath}/bin,{localpath}/bin,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor}/desktop-integration/{pkgtype},{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarpath}/pck.{minor}/openoffice,{solarpath}/pck.{minor},{solarpath}/xml.{minor}/office/instance,{solarpath}/xml.{minor},{solarcommonpath}/bin.{minor}/osl,{solarcommonpath}/bin.{minor},{solarcommonpath}/pck.{minor}/openoffice,{solarcommonpath}/pck.{minor},../../external/common,{solarenvpath}/{os}/OOo4Kids_external
+    }
+}
+
+OOo4Kids_Dev
+{
+    Settings
+    {
+        variables
+        {
+            PRODUCTNAME OOo4Kids-dev
+            PRODUCTVERSION 0.9
+            PRODUCTEXTENSION 
+            LONG_PRODUCTEXTENSION 
+            SHORT_PRODUCTEXTENSION 
+            BASISROOTNAME OOo4Kids-dev
+            UNIXBASISROOTNAME OOo4kids-dev
+            POSTVERSIONEXTENSION
+            POSTVERSIONEXTENSIONUNIX
+            BRANDPACKAGEVERSION 0.9
+            USERDIRPRODUCTVERSION 0.9
+            ABOUTBOXPRODUCTVERSION 0.9
+            BASEPRODUCTVERSION 0.9
+            DEVELOPMENTPRODUCT 1
+            BASISPACKAGEPREFIX OOo4Kids
+            UREPACKAGEPREFIX ooodev
+            SOLSUREPACKAGEPREFIX ooodev
+            REGISTRYLAYERNAME LayerDev
+            UPDATEURL http://null
+            ODFNOTIFYURL http://null
+            ADD_INCLUDE_FILES cliureversion.mk,clioootypesversion.mk,javaversion2.dat,userland.txt
+            EVAL
+            FILEFORMATNAME OpenOffice.org
+            FILEFORMATVERSION 1.0
+            WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+            PACKAGEVERSION 3.0.0
+            PACKAGEREVISION {milestone}
+            LICENSENAME LGPL
+            SERVICESPROJEKT 1
+            GLOBALFILEGID gid_File_Lib_Vcl
+            GLOBALPATCHFILEGID gid_File_Txt_Patchfiles
+            SPELLCHECKERFILE spellchecker_selection.txt
+            OPENSOURCE 1
+            SETSTATICPATH 1
+            OOODOWNLOADNAME 1
+            PROGRAMFILESROOT 1
+            XPDINSTALLER 1
+            BETAUPGRADECODE
+            STUBUPGRADECODE {0E7B27B8-D658-4BF9-98D6-EC361582EB4A}
+            CHANGETARGETDIR 1
+            USE_FILEVERSION 1
+            JAVAPRODUCT 1
+            LIBRARYVERSION 9.0.0
+            PATCHCODEFILE ooodev_patchcodes.txt
+            CODEFILENAME codes_ooodev.txt
+            DOWNLOADBANNER	Banner2.bmp
+            DOWNLOADBITMAP	Image2.bmp
+            DOWNLOADSETUPICO	ooo4kids_setup.ico
+            LOCALUSERDIR $ORIGIN/..
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://null
+            STARTCENTER_INFO_URL http://null
+            STARTCENTER_TEMPLREP_URL http://null
+            REGISTRATION_PRODUCT OOo4Kids
+            REGISTRATION_CID 926117
+        }
+        active			1
+        compression		5
+        script			setup_osljre
+        downloadname	OOo4Kids-dev_{productversion}_{os}_install_{languages}
+        langpackdownloadname	OOo4Kids_{productversion}_languagepack_{os}_install_{languages}
+        include			{solarenvpath}/{os}/loader2,.,{localpath}/bin/dev,{localcommonpath}/bin,{localpath}/bin,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarpath}/pck.{minor}/openoffice,{solarpath}/pck.{minor},{solarpath}/xml.{minor}/office/instance,{solarpath}/xml.{minor},{solarcommonpath}/bin.{minor}/osl,{solarcommonpath}/bin.{minor},{solarcommonpath}/pck.{minor}/openoffice_dev,{solarcommonpath}/pck.{minor}/openoffice,{solarcommonpath}/pck.{minor},../../external/common,{solarenvpath}/{os}/OOo4Kids_external
+    }
+}
+
+URE
+{
+    Settings
+    {
+        downloadname URE_{productversion}_{os}_install_{languages}
+        variables
+        {
+            PRODUCTNAME URE
+            PRODUCTVERSION 1.5
+            PACKAGEVERSION 1.5
+            PACKAGEREVISION 1
+            PRODUCTEXTENSION
+            LONG_PRODUCTEXTENSION
+            SHORT_PRODUCTEXTENSION
+            LICENSENAME LGPL
+            SERVICESPROJEKT 1
+            SETSTATICPATH 1
+            NOVERSIONINDIRNAME 1
+            PROGRAMFILESROOT 1
+            GLOBALFILEGID gid_File_Dl_Cppu
+            DOWNLOADBANNER Banner2.bmp
+            DOWNLOADBITMAP Image2.bmp
+            DOWNLOADSETUPICO ooo4kids_setup.ico
+            DONTUSESTARTMENUFOLDER 1
+            SERVICESPROJEKT 1
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://null
+            STARTCENTER_INFO_URL http://www.openoffice.org
+            STARTCENTER_TEMPLREP_URL http://null
+            ADD_INCLUDE_FILES cliureversion.mk,clioootypesversion.mk
+            PACKAGEMAP package_names_ext.txt
+        }
+        active 1
+        compression 5
+        script ure
+        include {solarenvpath}/{os}/loader2,{solarenvpath}/{os}/gcc3.4.1_glibc2.2.4_bits,{solarpath}/bin.{minor}/ure,{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarenvpath}/{os}/MS
+    }
+}
+
+OOo4Kids_SDK
+{
+    Settings
+    {
+        downloadname OOo4Kids_{productversion}_{os}_install_{languages}
+        variables
+        {
+            PRODUCTNAME OOo4Kids
+            PRODUCTVERSION 0.9
+            PRODUCTEXTENSION
+            LONG_PRODUCTEXTENSION
+            SHORT_PRODUCTEXTENSION
+            POSTVERSIONEXTENSION SDK
+            POSTVERSIONEXTENSIONUNIX sdk
+            BRANDPACKAGEVERSION 3
+            PACKAGEVERSION 3.0.0
+            PACKAGEREVISION {milestone}
+            PACK_INSTALLED 1
+            DMG_VOLUMEEXTENSION SDK
+        DATABASENAME openofficeorg30sdk
+            NO_README_IN_ROOTDIR 1
+            LICENSENAME LGPL
+            IGNOREDIRECTORYLAYER 1
+            NOVERSIONINDIRNAME 0
+            NOSPACEINDIRECTORYNAME 1
+            CHANGETARGETDIR 1
+            DOWNLOADBANNER Banner2.bmp
+            DOWNLOADBITMAP Bitmap2.bmp
+            DOWNLOADSETUPICO ooo4kids_setup.ico
+            DONTUSESTARTMENUFOLDER 1
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://null
+            STARTCENTER_INFO_URL http://null
+            STARTCENTER_TEMPLREP_URL http://null
+        }
+        active 1
+        compression 5
+        script sdkoo
+        include {solarenvpath}/{os}/loader2,{solarpath}/bin.{minor}/sdkoo,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarcommonpath}/bin.{minor},{solarenvpath}/{os}/MS
+    }
+}
+
+BrOffice
+{
+    Settings
+    {
+        variables
+        {
+            PRODUCTNAME BrOffice.org
+            PRODUCTVERSION 3.0
+            PRODUCTEXTENSION 
+            LONG_PRODUCTEXTENSION 
+            SHORT_PRODUCTEXTENSION 
+            POSTVERSIONEXTENSION
+            POSTVERSIONEXTENSIONUNIX
+            BRANDPACKAGEVERSION 3
+            USERDIRPRODUCTVERSION 3
+            ABOUTBOXPRODUCTVERSION 3.0.0
+            PROGRESSBARCOLOR 
+            PROGRESSSIZE 
+            PROGRESSPOSITION 
+            PROGRESSFRAMECOLOR 
+            UPDATEURL http://update30.services.openoffice.org/ProductUpdateService/check.Update
+            ODFNOTIFYURL http://odfnotify.services.openoffice.org/OOo3.0/notification.jsp?version=ODF
+            ADD_INCLUDE_FILES cliureversion.mk,clioootypesversion.mk,userland.txt
+            REMOVE_UPGRADE_CODE_FILE upgradecode_remove_ooo.txt
+            ADDSYSTEMINTEGRATION 1
+            EVAL
+            FILEFORMATNAME OpenOffice.org
+            FILEFORMATVERSION 1.0
+            WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+            PACKAGEVERSION 3.0.0
+            PACKAGEREVISION {milestone}
+            LICENSENAME LGPL
+            SERVICESPROJEKT 1
+            SETSTATICPATH 1
+            GLOBALFILEGID gid_File_Lib_Vcl
+            GLOBALPATCHFILEGID gid_File_Txt_Patchfiles
+            SPELLCHECKERFILE spellchecker_selection.txt
+            OPENSOURCE 1
+            OOODOWNLOADNAME 1
+            PROGRAMFILESROOT 1
+            XPDINSTALLER 0
+            BETAUPGRADECODE
+            STUBUPGRADECODE {0E7B27B8-D658-4BF9-98D6-EC361582EB4A}
+            CHANGETARGETDIR 1
+            USE_FILEVERSION 1
+            LIBRARYVERSION 9.0.0
+            CODEFILENAME codes_broo.txt
+            PATCHCODEFILE ooo_patchcodes.txt
+            DOWNLOADBANNER	Banner2.bmp
+            DOWNLOADBITMAP	Image2.bmp
+            DOWNLOADSETUPICO	ooo4kids_setup.ico
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://extensions.services.openoffice.org/getmore?cid=920794
+            STARTCENTER_INFO_URL http://www.openoffice.org
+            STARTCENTER_TEMPLREP_URL http://extensions.services.openoffice.org/taxonomy/term/36
+            REGISTRATION_PRODUCT OOo4Kids
+            REGISTRATION_CID 926117
+        }
+        active			1
+        compression		5
+        script			setup_osl
+        downloadname	BrOo_{productversion}_{os}_install_{languages}
+        langpackdownloadname	BrOo_{productversion}_languagepack_{os}_install_{languages}
+        include			{solarenvpath}/{os}/loader2,.,{localpath}/bin/broffice,{localcommonpath}/bin,{localpath}/bin,{solarpath}/bin.{minor}/broffice,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor}/desktop-integration/{pkgtype},{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarpath}/pck.{minor}/broffice,{solarpath}/pck.{minor}/openoffice,{solarpath}/pck.{minor},{solarpath}/xml.{minor}/office/instance,{solarpath}/xml.{minor},{solarcommonpath}/bin.{minor}/osl,{solarcommonpath}/bin.{minor},{solarcommonpath}/pck.{minor}/broffice,{solarcommonpath}/pck.{minor}/openoffice,{solarcommonpath}/pck.{minor},../../external/common,{solarenvpath}/{os}/OOo4Kids_external
+    }
+}
+
+BrOffice_wJRE
+{
+    Settings
+    {
+        variables
+        {
+            PRODUCTNAME BrOffice.org
+            PRODUCTVERSION 3.0
+            PRODUCTEXTENSION 
+            LONG_PRODUCTEXTENSION 
+            SHORT_PRODUCTEXTENSION 
+            POSTVERSIONEXTENSION
+            POSTVERSIONEXTENSIONUNIX
+            BRANDPACKAGEVERSION 3
+            USERDIRPRODUCTVERSION 3
+            ABOUTBOXPRODUCTVERSION 3.0.0
+            PROGRESSBARCOLOR 
+            PROGRESSSIZE 
+            PROGRESSPOSITION 
+            PROGRESSFRAMECOLOR 
+            UPDATEURL http://update30.services.openoffice.org/ProductUpdateService/check.Update
+            ODFNOTIFYURL http://odfnotify.services.openoffice.org/OOo3.0/notification.jsp?version=ODF
+            ADD_INCLUDE_FILES cliureversion.mk,clioootypesversion.mk,javaversion2.dat,userland.txt
+            REMOVE_UPGRADE_CODE_FILE upgradecode_remove_ooo.txt
+            ADDSYSTEMINTEGRATION 1
+            EVAL
+            FILEFORMATNAME OpenOffice.org
+            FILEFORMATVERSION 1.0
+            WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+            PACKAGEVERSION 3.0.0
+            PACKAGEREVISION {milestone}
+            LICENSENAME LGPL
+            SERVICESPROJEKT 1
+            SETSTATICPATH 1
+            GLOBALFILEGID gid_File_Lib_Vcl
+            GLOBALPATCHFILEGID gid_File_Txt_Patchfiles
+            SPELLCHECKERFILE spellchecker_selection.txt
+            OPENSOURCE 1
+            OOODOWNLOADNAME 1
+            PROGRAMFILESROOT 1
+            XPDINSTALLER 1
+            BETAUPGRADECODE
+            STUBUPGRADECODE {0E7B27B8-D658-4BF9-98D6-EC361582EB4A}
+            CHANGETARGETDIR 1
+            USE_FILEVERSION 1
+            LIBRARYVERSION 9.0.0
+            CODEFILENAME codes_broo.txt
+            PATCHCODEFILE ooo_patchcodes.txt
+            JAVAPRODUCT 1
+            DOWNLOADBANNER	Banner2.bmp
+            DOWNLOADBITMAP	Image2.bmp
+            DOWNLOADSETUPICO	ooo4kids_setup.ico
+            RELATIVE_PATHES_IN_DDF 1
+                STARTCENTER_ADDFEATURE_URL http://extensions.services.openoffice.org/getmore?cid=920794
+                STARTCENTER_INFO_URL http://www.openoffice.org
+                STARTCENTER_TEMPLREP_URL http://extensions.services.openoffice.org/taxonomy/term/36
+                REGISTRATION_PRODUCT OpenOffice.org
+                    REGISTRATION_CID 926117
+        }
+        active			1
+        compression		5
+        script			setup_osljre
+        downloadname	BrOo_{productversion}_{os}_installwjre_{languages}
+        include			{solarenvpath}/{os}/loader2,.,{localpath}/bin/broffice,{localcommonpath}/bin,{localpath}/bin,{solarpath}/bin.{minor}/broffice,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor}/desktop-integration/{pkgtype},{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarpath}/pck.{minor}/broffice,{solarpath}/pck.{minor}/openoffice,{solarpath}/pck.{minor},{solarpath}/xml.{minor}/office/instance,{solarpath}/xml.{minor},{solarcommonpath}/bin.{minor}/osl,{solarcommonpath}/bin.{minor},{solarcommonpath}/pck.{minor}/broffice,{solarcommonpath}/pck.{minor}/openoffice,{solarcommonpath}/pck.{minor},../../external/common,{solarenvpath}/{os}/OOo4Kids_external
+    }
+}
+
+BrOffice_Dev
+{
+    Settings
+    {
+        variables
+        {
+            PRODUCTNAME BrOo-dev
+            PRODUCTVERSION 3.0
+            PRODUCTEXTENSION 
+            LONG_PRODUCTEXTENSION 
+            SHORT_PRODUCTEXTENSION 
+            BASISROOTNAME OOo-dev
+            UNIXBASISROOTNAME ooo-dev
+            POSTVERSIONEXTENSION
+            POSTVERSIONEXTENSIONUNIX
+            BRANDPACKAGEVERSION 3
+            USERDIRPRODUCTVERSION 3
+            ABOUTBOXPRODUCTVERSION 3.0.0
+            DEVELOPMENTPRODUCT 1
+            PROGRESSBARCOLOR 
+            PROGRESSSIZE 
+            PROGRESSPOSITION 
+            PROGRESSFRAMECOLOR 
+            BASISPACKAGEPREFIX ooobasis-dev
+            UREPACKAGEPREFIX ooodev
+            SOLSUREPACKAGEPREFIX ooodev
+            REGISTRYLAYERNAME LayerDevBroffice
+            UPDATEURL http://update30.services.openoffice.org/ProductUpdateService/check.Update
+            ODFNOTIFYURL http://odfnotify.services.openoffice.org/OOo3.0/notification.jsp?version=ODF
+            ADD_INCLUDE_FILES cliureversion.mk,clioootypesversion.mk,javaversion2.dat,userland.txt
+            EVAL
+            FILEFORMATNAME OpenOffice.org
+            FILEFORMATVERSION 1.0
+            WRITERCOMPATIBILITYVERSIONOOO11 OpenOffice.org 1.1
+            PACKAGEVERSION 3.0.0
+            PACKAGEREVISION {milestone}
+            LICENSENAME LGPL
+            SERVICESPROJEKT 1
+            SETSTATICPATH 1
+            GLOBALFILEGID gid_File_Lib_Vcl
+            GLOBALPATCHFILEGID gid_File_Txt_Patchfiles
+            SPELLCHECKERFILE spellchecker_selection.txt
+            OPENSOURCE 1
+            OOODOWNLOADNAME 1
+            PROGRAMFILESROOT 1
+            XPDINSTALLER 1
+            BETAUPGRADECODE
+            STUBUPGRADECODE {0E7B27B8-D658-4BF9-98D6-EC361582EB4A}
+            CHANGETARGETDIR 1
+            USE_FILEVERSION 1
+            JAVAPRODUCT 1
+            LIBRARYVERSION 9.0.0
+            PATCHCODEFILE ooo_patchcodes.txt
+            CODEFILENAME codes_broodev.txt
+            DOWNLOADBANNER	Banner2.bmp
+            DOWNLOADBITMAP	Image2.bmp
+            DOWNLOADSETUPICO	ooo4kids_setup.ico
+            LOCALUSERDIR $ORIGIN/..
+            RELATIVE_PATHES_IN_DDF 1
+            STARTCENTER_ADDFEATURE_URL http://extensions.services.openoffice.org/getmore?cid=920794
+            STARTCENTER_INFO_URL http://www.openoffice.org
+            STARTCENTER_TEMPLREP_URL http://extensions.services.openoffice.org/taxonomy/term/36
+            REGISTRATION_PRODUCT OOo4Kids
+                    REGISTRATION_CID 926117
+        }
+        active			1
+        compression		5
+        script			setup_osljre
+        downloadname	BrOo-dev_{productversion}_{os}_install_{languages}
+        langpackdownloadname	BrOo_{productversion}_languagepack_{os}_install_{languages}
+        include			{solarenvpath}/{os}/loader2,.,{localpath}/bin/broffice_dev,{localcommonpath}/bin,{localpath}/bin,{solarpath}/bin.{minor}/broffice,{solarpath}/bin.{minor}/osl,{solarpath}/bin.{minor},{solarpath}/lib.{minor},{solarpath}/pck.{minor}/broffice,{solarpath}/pck.{minor}/openoffice,{solarpath}/pck.{minor},{solarpath}/xml.{minor}/office/instance,{solarpath}/xml.{minor},{solarcommonpath}/bin.{minor}/osl,{solarcommonpath}/bin.{minor},{solarcommonpath}/pck.{minor}/broffice_dev,{solarcommonpath}/pck.{minor}/broffice,{solarcommonpath}/pck.{minor}/openoffice_dev,{solarcommonpath}/pck.{minor}/openoffice,{solarcommonpath}/pck.{minor},../../external/common,{solarenvpath}/{os}/OOo4Kids_external
+    }
+}
diff --git instsetoo_native/util/makefile.mk instsetoo_native/util/makefile.mk
index f16b7de..36cacf8 100644
--- instsetoo_native/util/makefile.mk
+++ instsetoo_native/util/makefile.mk
@@ -37,6 +37,16 @@ GEN_HID2=TRUE
 .INCLUDE:  settings.mk
 .INCLUDE: $(SOLARINCDIR)$/rtlbootstrap.mk
 
+.IF "$(OOo4Kids)"=="YES"
+APPLICATION_NAME=OOo4Kids
+MY_OPENOFFICE_LIST=OOo4Kids.lst
+MY_DND_PNG=ooo4kids_dnd.png
+.ELSE
+APPLICATION_NAME=OpenOffice
+MY_OPENOFFICE_LIST=openoffice.lst
+MY_DND_PNG=osxdndinstall.png
+.ENDIF
+
 # PERL:=@echo
 
 # watch for the path delimiter
@@ -96,7 +106,7 @@ LOCALPYFILES= \
 # native - "Native" software distribution for the platform
 # portable - Portable software distribution
 xxxx:
-    echo $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/openoffice.lst --product OpenOffice --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml
+    echo $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) --product OpenOffice --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml
 
 .IF "$(GUI)"!="WNT" && "$(EPM)"=="NO" && "$(USE_PACKAGER)"==""
 ALLTAR : $(LOCALPYFILES)
@@ -217,7 +227,8 @@ $(MAKETARGETS) : $(ADDDEPS)
 .ENDIF			# "$(BUILD_SPECIAL)"!=""
 
 .IF "$(OS)" == "MACOSX"
-DMGDEPS=$(BIN)$/{osxdndinstall.png DS_Store DS_Store_Langpack}
+#DMGDEPS=$(BIN)$/{$(MY_DND_PNG) DS_Store}
+DMGDEPS=$(BIN)$/{$(MY_DND_PNG) DS_Store DS_Store_Langpack}
 $(foreach,i,$(alllangiso) {openoffice openofficedev openofficewithjre ooolanguagepack broffice brofficedev brofficewithjre}_$i) : $(DMGDEPS)
 .ENDIF # "$(OS)" == "MACOSX"
 
@@ -233,8 +244,8 @@ openoffice_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 openoffice_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
-    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/openoffice.lst --product OpenOffice --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p $(APPLICATION_NAME) -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) --product $(APPLICATION_NAME) --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) openofficewithjre_$i) : $$@{$(PKGFORMAT:^".")}
@@ -242,7 +253,7 @@ openofficewithjre_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 openofficewithjre_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice_wJRE -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice_wJRE -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) openofficedev_$i) : $$@{$(PKGFORMAT:^".")}
@@ -250,8 +261,8 @@ openofficedev_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 openofficedev_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice_Dev -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
-    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/openoffice.lst --product OpenOffice_Dev --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p $(APPLICATION_NAME) -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) --product OpenOffice_Dev --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) ooolanguagepack_$i) : $$@{$(PKGFORMAT:^".")}
@@ -259,7 +270,7 @@ ooolanguagepack_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 ooolanguagepack_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice -u $(OUT) -buildid $(BUILD) -msitemplate $(MSILANGPACKTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles -languagepack $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p $(APPLICATION_NAME) -u $(OUT) -buildid $(BUILD) -msitemplate $(MSILANGPACKTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles -languagepack $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) ooodevlanguagepack_$i) : $$@{$(PKGFORMAT:^".")}
@@ -267,7 +278,7 @@ ooodevlanguagepack_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 ooodevlanguagepack_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice_Dev -u $(OUT) -buildid $(BUILD) -msitemplate $(MSILANGPACKTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles -languagepack $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p $(APPLICATION_NAME) -u $(OUT) -buildid $(BUILD) -msitemplate $(MSILANGPACKTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles -languagepack $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) sdkoo_$i) : $$@{$(PKGFORMAT:^".")}
@@ -275,7 +286,7 @@ sdkoo_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 sdkoo_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p OpenOffice_SDK -u $(OUT) -buildid $(BUILD) -msitemplate $(MSISDKOOTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) -dontstrip $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p $(APPLICATION_NAME)_SDK -u $(OUT) -buildid $(BUILD) -msitemplate $(MSISDKOOTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) -dontstrip $(PKGFORMATSWITCH) $(VERBOSESWITCH))
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) sdkoodev_$i) : $$@{$(PKGFORMAT:^".")}
@@ -294,7 +305,7 @@ ure_% :
 .IF "$(OS)" == "MACOSX"
     @echo 'for now, there is no standalone URE for Mac OS X'
 .ELSE
-    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst \
+    $(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) \
         -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p URE -u $(OUT) -buildid $(BUILD) $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH)) \
         -msitemplate $(MSIURETEMPLATEDIR) \
         -msilanguage $(COMMONMISC)$/win_ulffiles
@@ -312,8 +323,8 @@ broffice_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 broffice_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
-    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/openoffice.lst --product BrOffice --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
+    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) --product BrOffice --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) brofficewithjre_$i) : $$@{$(PKGFORMAT:^".")}
@@ -321,7 +332,7 @@ brofficewithjre_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 brofficewithjre_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice_wJRE -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice_wJRE -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) brofficedev_$i) : $$@{$(PKGFORMAT:^".")}
@@ -329,8 +340,8 @@ brofficedev_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 brofficedev_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice_Dev -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
-    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/openoffice.lst --product BrOffice_Dev --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
+    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice_Dev -u $(OUT) -buildid $(BUILD) -msitemplate $(MSIOFFICETEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    $(PERL) -w $(SOLARENV)$/bin$/gen_update_info.pl --buildid $(BUILD) --arch "$(RTL_ARCH)" --os "$(RTL_OS)" --lstfile $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) --product BrOffice_Dev --languages $(subst,$(@:s/_/ /:1)_, $(@:b)) $(PRJ)$/util$/update.xml > $(MISC)/$(@:b)_$(RTL_OS)_$(RTL_ARCH)$(@:e).update.xml
 
 .IF "$(PKGFORMAT)"!=""
 $(foreach,i,$(alllangiso) broolanguagepack_$i) : $$@{$(PKGFORMAT:^".")}
@@ -338,7 +349,7 @@ broolanguagepack_%{$(PKGFORMAT:^".")} :
 .ELSE			# "$(PKGFORMAT)"!=""
 broolanguagepack_% :
 .ENDIF			# "$(PKGFORMAT)"!=""
-    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/openoffice.lst -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice -u $(OUT) -buildid $(BUILD) -msitemplate $(MSILANGPACKTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles -languagepack $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
+    +$(PERL) -w $(SOLARENV)$/bin$/make_installer.pl -f $(PRJ)$/util$/$(MY_OPENOFFICE_LIST) -l $(subst,$(@:s/_/ /:1)_, $(@:b)) -p BrOffice -u $(OUT) -buildid $(BUILD) -msitemplate $(MSILANGPACKTEMPLATEDIR) -msilanguage $(COMMONMISC)$/win_ulffiles -languagepack $(subst,xxx,$(@:e:s/.//) $(PKGFORMATSWITCH) $(VERBOSESWITCH))
 
 .ELSE			# "$(alllangiso)"!=""
 openoffice:
@@ -384,7 +395,8 @@ $(BIN)$/broffice$/intro.zip : $(SOLARCOMMONPCKDIR)$/broffice_nologo$/intro.zip
     @-$(MKDIR) $(@:d)
     $(COPY) $< $@
 
-$(BIN)$/{osxdndinstall.png DS_Store DS_Store_Langpack} : $(PRJ)$/res$/$$(@:f)
+#$(BIN)$/{$(MY_DND_PNG) DS_Store} : $(PRJ)$/res$/$$(@:f)
+$(BIN)$/{$(MY_DND_PNG) DS_Store DS_Store_Langpack} : $(PRJ)$/res$/$$(@:f)
     @$(COPY) $< $@
 
 hack_msitemplates .PHONY:
diff --git instsetoo_native/util/pack-OOo4Kids.lst instsetoo_native/util/pack-OOo4Kids.lst
new file mode 100644
index 0000000..7e07181
--- /dev/null
+++ instsetoo_native/util/pack-OOo4Kids.lst
@@ -0,0 +1,23 @@
+# Comment line
+# Pack.lst: Contains the packaging information for the update packaging process.
+# Syntax: Product, list of platforms, list of languages, target	(Separator: spaces)
+# Syntax for list of languages: One multilingual installation set uses separator ","
+# (Example: "en-US,de" creates english-german multilingual installation set)  
+# Different installation sets use the "|" as separator
+
+# Product       List_of_platforms                                                   List_of_languages   Target
+
+OOo4Kids      unxlngi6.pro,unxmacxi.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxlngx6.pro    en-US   openoffice
+#OpenOffice      unxlngi6,unxmacxi,unxsoli4,unxsols4,wntmsci12                                     en-US   openoffice
+#BrOffice                                                                                          pt-BR   broffice
+#OpenOffice_wJRE unxlngi6.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,wntmsci12                    en-US   openofficewithjre
+#BrOffice_wJRE                                                                                     pt-BR   brofficewithjre
+OOo4Kids_dev  unxlngi6.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxmacxi.pro,unxlngx6.pro    en-US|ar   openofficedev
+#BrOffice_Dev                                                                                      pt-BR   brofficedev
+OpenOffice_SDK  unxlngi6.pro,unxmacxi.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxlngx6.pro,unxlngi6,unxmacxi,unxsoli4,unxsols4,wntmsci12  en-US   sdkoo
+#URE             unxlngi6.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxlngi6,unxsoli4,unxsols4,wntmsci12  en-US   ure
+OpenOfficeLanguagepack   unxlngi6.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxlngx6.pro        de      ooolanguagepack
+OpenOfficeLanguagepack   unxlngi6,unxsoli4,unxsols4,wntmsci12                                     de      ooolanguagepack
+OpenOfficeDevLanguagepack   unxlngi6.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxlngx6.pro     de|fr|ja|ar   ooodevlanguagepack
+#BrOfficeLanguagepack     unxlngi6.pro,unxsoli4.pro,unxsols4.pro,wntmsci12.pro,unxlngx6.pro        pt-BR   broolanguagepack
+
diff --git javaunohelper/com/sun/star/comp/helper/makefile.mk javaunohelper/com/sun/star/comp/helper/makefile.mk
index b4d5dd9..1fbc3fa 100644
--- javaunohelper/com/sun/star/comp/helper/makefile.mk
+++ javaunohelper/com/sun/star/comp/helper/makefile.mk
@@ -40,6 +40,11 @@ TARGET  = com_sun_star_comp_helper
 .INCLUDE :  settings.mk
 .INCLUDE: $(PRJ)$/util$/settings.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES=	\
diff --git javaunohelper/com/sun/star/comp/juhtest/makefile.mk javaunohelper/com/sun/star/comp/juhtest/makefile.mk
index 89b6f50..85ae556 100644
--- javaunohelper/com/sun/star/comp/juhtest/makefile.mk
+++ javaunohelper/com/sun/star/comp/juhtest/makefile.mk
@@ -40,6 +40,11 @@ TARGET  = com_sun_star_comp_juhtest
 .INCLUDE :  settings.mk
 .INCLUDE: $(PRJ)$/util$/settings.pmk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 #todo: we do not want include juh.jar here but use the output tree.
 JARFILES = unoil.jar ridl.jar jurt.jar
diff --git javaunohelper/com/sun/star/comp/makefile.mk javaunohelper/com/sun/star/comp/makefile.mk
index 2f799f9..de670cb 100644
--- javaunohelper/com/sun/star/comp/makefile.mk
+++ javaunohelper/com/sun/star/comp/makefile.mk
@@ -40,6 +40,11 @@ TARGET  = com_sun_star_comp
 .INCLUDE :  settings.mk
 .INCLUDE: $(PRJ)$/util$/settings.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 JARFILES = ridl.jar jurt.jar unoil.jar
 JAVAFILES=	\
diff --git javaunohelper/com/sun/star/lib/uno/adapter/makefile.mk javaunohelper/com/sun/star/lib/uno/adapter/makefile.mk
index 12bc6e0..42321f1 100644
--- javaunohelper/com/sun/star/lib/uno/adapter/makefile.mk
+++ javaunohelper/com/sun/star/lib/uno/adapter/makefile.mk
@@ -40,6 +40,11 @@ TARGET  = com_sun_star_lib_uno_adapter
 .INCLUDE :  settings.mk
 .INCLUDE: $(PRJ)$/util$/settings.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES=	\
diff --git javaunohelper/com/sun/star/lib/uno/helper/makefile.mk javaunohelper/com/sun/star/lib/uno/helper/makefile.mk
index ee2535f..f2945de 100644
--- javaunohelper/com/sun/star/lib/uno/helper/makefile.mk
+++ javaunohelper/com/sun/star/lib/uno/helper/makefile.mk
@@ -38,6 +38,11 @@ TARGET  = com_sun_star_lib_uno_helper
 .INCLUDE : settings.mk
 .INCLUDE: $(PRJ)$/util$/settings.pmk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     ComponentBase.java \
     Factory.java \
diff --git javaunohelper/source/makefile.mk javaunohelper/source/makefile.mk
index 4898c6a..e563939 100644
--- javaunohelper/source/makefile.mk
+++ javaunohelper/source/makefile.mk
@@ -41,7 +41,7 @@ LIBTARGET=NO
 
 .INCLUDE :  settings.mk
 
-.IF "$(SOLAR_JAVA)"==""
+.IF "$(SOLAR_JAVA)"=="" || "$(OOo4Kids)"=="YES"
 nojava:
     @echo "Not building javaunohelper because Java is disabled"
 .ENDIF
diff --git javaunohelper/util/makefile.mk javaunohelper/util/makefile.mk
index 071d1f8..d984004 100644
--- javaunohelper/util/makefile.mk
+++ javaunohelper/util/makefile.mk
@@ -36,6 +36,11 @@ TARGET  = juh
 .INCLUDE : settings.mk
 .INCLUDE: settings.pmk
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 JARCLASSDIRS = com
 JARTARGET		= $(TARGET).jar
 JARCOMPRESS		= TRUE
diff --git jurt/com/sun/star/comp/bridgefactory/makefile.mk jurt/com/sun/star/comp/bridgefactory/makefile.mk
index 6691c83..293dbef 100644
--- jurt/com/sun/star/comp/bridgefactory/makefile.mk
+++ jurt/com/sun/star/comp/bridgefactory/makefile.mk
@@ -38,6 +38,11 @@ TARGET  = com_sun_star_comp_bridgefactory
 
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES = BridgeFactory.java
diff --git jurt/com/sun/star/comp/connections/makefile.mk jurt/com/sun/star/comp/connections/makefile.mk
index 02f536a..7de1929 100644
--- jurt/com/sun/star/comp/connections/makefile.mk
+++ jurt/com/sun/star/comp/connections/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE = com$/sun$/star$/comp$/connections
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     Acceptor.java \
     Connector.java \
diff --git jurt/com/sun/star/comp/loader/makefile.mk jurt/com/sun/star/comp/loader/makefile.mk
index df74442..aca5b16 100644
--- jurt/com/sun/star/comp/loader/makefile.mk
+++ jurt/com/sun/star/comp/loader/makefile.mk
@@ -38,6 +38,11 @@ TARGET  = com_sun_star_comp_loader
 
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES = \
diff --git jurt/com/sun/star/comp/servicemanager/makefile.mk jurt/com/sun/star/comp/servicemanager/makefile.mk
index 7b03ad8..a133be0 100644
--- jurt/com/sun/star/comp/servicemanager/makefile.mk
+++ jurt/com/sun/star/comp/servicemanager/makefile.mk
@@ -38,6 +38,11 @@ TARGET  = com_sun_star_comp_servicemanager
 
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES = ServiceManager.java
diff --git jurt/com/sun/star/comp/urlresolver/makefile.mk jurt/com/sun/star/comp/urlresolver/makefile.mk
index c386491..e5764c5 100644
--- jurt/com/sun/star/comp/urlresolver/makefile.mk
+++ jurt/com/sun/star/comp/urlresolver/makefile.mk
@@ -36,6 +36,11 @@ TARGET  = com_sun_star_comp_urlresolver
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
 # Files --------------------------------------------------------
diff --git jurt/com/sun/star/lib/connections/pipe/makefile.mk jurt/com/sun/star/lib/connections/pipe/makefile.mk
index 4548ba3..d3f6561 100644
--- jurt/com/sun/star/lib/connections/pipe/makefile.mk
+++ jurt/com/sun/star/lib/connections/pipe/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE = com$/sun$/star$/lib$/connections$/pipe
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     PipeConnection.java \
     pipeAcceptor.java \
diff --git jurt/com/sun/star/lib/connections/socket/makefile.mk jurt/com/sun/star/lib/connections/socket/makefile.mk
index c167678..146cd4a 100644
--- jurt/com/sun/star/lib/connections/socket/makefile.mk
+++ jurt/com/sun/star/lib/connections/socket/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE = com$/sun$/star$/lib$/connections$/socket
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     ConnectionDescriptor.java \
     SocketConnection.java \
diff --git jurt/com/sun/star/lib/uno/bridges/java_remote/makefile.mk jurt/com/sun/star/lib/uno/bridges/java_remote/makefile.mk
index 738869f..2a16d50 100644
--- jurt/com/sun/star/lib/uno/bridges/java_remote/makefile.mk
+++ jurt/com/sun/star/lib/uno/bridges/java_remote/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE = com$/sun$/star$/lib$/uno$/bridges$/java_remote
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     BridgedObject.java \
     ProxyFactory.java \
diff --git jurt/com/sun/star/lib/uno/environments/java/makefile.mk jurt/com/sun/star/lib/uno/environments/java/makefile.mk
index 627aa5b..229ae19 100644
--- jurt/com/sun/star/lib/uno/environments/java/makefile.mk
+++ jurt/com/sun/star/lib/uno/environments/java/makefile.mk
@@ -38,6 +38,11 @@ TARGET  = com_sun_star_lib_uno_environments_java
 
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES = java_environment.java
diff --git jurt/com/sun/star/lib/uno/environments/remote/makefile.mk jurt/com/sun/star/lib/uno/environments/remote/makefile.mk
index d2729c7..b49bf3c 100644
--- jurt/com/sun/star/lib/uno/environments/remote/makefile.mk
+++ jurt/com/sun/star/lib/uno/environments/remote/makefile.mk
@@ -37,6 +37,12 @@ PACKAGE := com$/sun$/star$/lib$/uno$/environments$/remote
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+
 JAVAFILES = \
     IProtocol.java \
     IReceiver.java \
diff --git jurt/com/sun/star/lib/uno/makefile.mk jurt/com/sun/star/lib/uno/makefile.mk
index 64d8703..45d9ded 100644
--- jurt/com/sun/star/lib/uno/makefile.mk
+++ jurt/com/sun/star/lib/uno/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/lib$/uno
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = Proxy.java
 
 .INCLUDE: target.mk
diff --git jurt/com/sun/star/lib/uno/protocols/urp/makefile.mk jurt/com/sun/star/lib/uno/protocols/urp/makefile.mk
index e0be9e6..09abaf7 100644
--- jurt/com/sun/star/lib/uno/protocols/urp/makefile.mk
+++ jurt/com/sun/star/lib/uno/protocols/urp/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE := com$/sun$/star$/lib$/uno$/protocols$/urp
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     Cache.java \
     Marshal.java \
diff --git jurt/com/sun/star/lib/util/makefile.mk jurt/com/sun/star/lib/util/makefile.mk
index b417e83..cd58bdb 100644
--- jurt/com/sun/star/lib/util/makefile.mk
+++ jurt/com/sun/star/lib/util/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE := com$/sun$/star$/lib$/util
 
 .INCLUDE: $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 JAVAFILES = \
     AsynchronousFinalizer.java \
     NativeLibraryLoader.java \
diff --git jurt/com/sun/star/uno/makefile.mk jurt/com/sun/star/uno/makefile.mk
index 13b81bf..ade75bc 100644
--- jurt/com/sun/star/uno/makefile.mk
+++ jurt/com/sun/star/uno/makefile.mk
@@ -38,6 +38,11 @@ TARGET  = com_sun_star_uno
 
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 JAVAFILES = \
diff --git jurt/source/pipe/makefile.mk jurt/source/pipe/makefile.mk
index e56ece7..cc6a0b4 100644
--- jurt/source/pipe/makefile.mk
+++ jurt/source/pipe/makefile.mk
@@ -13,7 +13,7 @@ USE_DEFFILE=TRUE
 
 .INCLUDE :  settings.mk
 
-.IF "$(SOLAR_JAVA)"==""
+.IF "$(SOLAR_JAVA)"=="" || "$(OOo4Kids)" !! "YES"
 nojava:
     @echo "Not building jurt because Java is disabled"
 .ENDIF
diff --git jvmaccess/inc/jvmaccess/classpath.hxx jvmaccess/inc/jvmaccess/classpath.hxx
index fc25e12..33bc633 100644
--- jvmaccess/inc/jvmaccess/classpath.hxx
+++ jvmaccess/inc/jvmaccess/classpath.hxx
@@ -34,7 +34,7 @@
 #include "sal/config.h"
 #include "com/sun/star/uno/Reference.hxx"
 
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 #include "jni.h"
 #else
 struct JNIEnv;
diff --git jvmaccess/inc/jvmaccess/virtualmachine.hxx jvmaccess/inc/jvmaccess/virtualmachine.hxx
index 5aa8009..2481116 100644
--- jvmaccess/inc/jvmaccess/virtualmachine.hxx
+++ jvmaccess/inc/jvmaccess/virtualmachine.hxx
@@ -34,7 +34,7 @@
 #include "rtl/ref.hxx"
 #include "salhelper/simplereferenceobject.hxx"
 
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 #include "jni.h"
 #else
 struct JNIEnv;
@@ -143,7 +143,6 @@ public:
      */
     VirtualMachine(JavaVM * pVm, int nVersion, bool bDestroy,
                    JNIEnv * pMainThreadEnv);
-
 private:
     VirtualMachine(VirtualMachine &); // not implemented
     void operator =(VirtualMachine); // not implemented
diff --git jvmaccess/source/classpath.cxx jvmaccess/source/classpath.cxx
index 2561946..e20cce0 100644
--- jvmaccess/source/classpath.cxx
+++ jvmaccess/source/classpath.cxx
@@ -47,7 +47,7 @@
 #include "rtl/ustring.hxx"
 #include "sal/types.h"
 
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 #include "jni.h"
 #endif
 
@@ -62,7 +62,7 @@ void * ::jvmaccess::ClassPath::doTranslateToUrls(
     void * environment, ::rtl::OUString const & classPath)
 {
     OSL_ASSERT(context.is() && environment != 0);
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     ::JNIEnv * const env = static_cast< ::JNIEnv * >(environment);
     jclass classUrl(env->FindClass("java/net/URL"));
     if (classUrl == 0) {
@@ -138,7 +138,7 @@ void * ::jvmaccess::ClassPath::doLoadClass(
     ::rtl::OUString const & name)
 {
     OSL_ASSERT(context.is() && environment != 0);
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids ) 
     ::JNIEnv * const env = static_cast< ::JNIEnv * >(environment);
     jclass classLoader(env->FindClass("java/net/URLClassLoader"));
     if (classLoader == 0) {
diff --git jvmaccess/source/unovirtualmachine.cxx jvmaccess/source/unovirtualmachine.cxx
index f239cce..702340b 100644
--- jvmaccess/source/unovirtualmachine.cxx
+++ jvmaccess/source/unovirtualmachine.cxx
@@ -36,7 +36,7 @@
 
 #include "jvmaccess/virtualmachine.hxx"
 
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 #include "jni.h"
 #endif
 
@@ -61,7 +61,7 @@ UnoVirtualMachine::UnoVirtualMachine(
     m_virtualMachine(virtualMachine),
     m_classLoader(0)
 {
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     try {
         m_classLoader =
             jvmaccess::VirtualMachine::AttachGuard(m_virtualMachine).
@@ -83,7 +83,7 @@ void * UnoVirtualMachine::getClassLoader() const {
 }
 
 UnoVirtualMachine::~UnoVirtualMachine() {
-#if defined SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     try {
         jvmaccess::VirtualMachine::AttachGuard(m_virtualMachine).
             getEnvironment()->DeleteGlobalRef(
diff --git jvmaccess/source/virtualmachine.cxx jvmaccess/source/virtualmachine.cxx
index 536b681..e2a3649 100644
--- jvmaccess/source/virtualmachine.cxx
+++ jvmaccess/source/virtualmachine.cxx
@@ -72,7 +72,7 @@ VirtualMachine::VirtualMachine(JavaVM * pVm, int nVersion, bool bDestroy,
     m_pVm(pVm), m_nVersion(nVersion), m_bDestroy(bDestroy)
 {
     (void) pMainThreadEnv; // avoid warnings
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     OSL_ENSURE(pVm != 0 && nVersion >= JNI_VERSION_1_2 && pMainThreadEnv != 0,
                "bad parameter");
 #endif
@@ -95,7 +95,7 @@ VirtualMachine::~VirtualMachine()
 
 JNIEnv * VirtualMachine::attachThread(bool * pAttached) const
 {
-#ifndef SOLAR_JAVA
+#if !defined( SOLAR_JAVA ) || defined( OOo4Kids )
     return 0;
 #else
     OSL_ENSURE(pAttached != 0, "bad parameter");
@@ -119,7 +119,7 @@ JNIEnv * VirtualMachine::attachThread(bool * pAttached) const
 
 void VirtualMachine::detachThread() const
 {
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     if (m_pVm->DetachCurrentThread() != JNI_OK) {
         OSL_ENSURE(false, "JNI: DetachCurrentThread failed");
     }
diff --git jvmaccess/util/gcc3.map jvmaccess/util/gcc3.map
index 23101f3..814206b 100644
--- jvmaccess/util/gcc3.map
+++ jvmaccess/util/gcc3.map
@@ -42,7 +42,7 @@ UDK_3.1 {
         _ZN9jvmaccess14VirtualMachine11AttachGuardC2ERKN3rtl9ReferenceIS0_EE; # jvmaccess::VirtualMachine::AttachGuard::AttachGuard(rtl::Reference< VirtualMachine > const &)
         _ZN9jvmaccess14VirtualMachine11AttachGuardD1Ev; # jvmaccess::VirtualMachine::AttachGuard::~AttachGuard()
         _ZN9jvmaccess14VirtualMachine11AttachGuardD2Ev; # jvmaccess::VirtualMachine::AttachGuard::~AttachGuard()
-        _ZN9jvmaccess14VirtualMachineC1EP7JavaVM_ibP7JNIEnv_; # jvmaccess::VirtualMachine::VirtualMachine(JavaVM *, int, bool, JNIEnv *)
+#        _ZN9jvmaccess14VirtualMachineC1EP7JavaVM_ibP7JNIEnv_; # jvmaccess::VirtualMachine::VirtualMachine(JavaVM *, int, bool, JNIEnv *)
 
     local:
         *;
@@ -55,7 +55,7 @@ UDK_3.2 {
         _ZN9jvmaccess14VirtualMachine11AttachGuard17CreationExceptionC2ERKS2_; # jvmaccess::VirtualMachine::AttachGuard::CreationException::CreationException(CreationException const &)
         _ZN9jvmaccess14VirtualMachine11AttachGuard17CreationExceptionD1Ev; # jvmaccess::VirtualMachine::AttachGuard::CreationException::~CreationException()
         _ZN9jvmaccess14VirtualMachine11AttachGuard17CreationExceptionD2Ev; # jvmaccess::VirtualMachine::AttachGuard::CreationException::~CreationException()
-        _ZN9jvmaccess14VirtualMachineC2EP7JavaVM_ibP7JNIEnv_; # jvmaccess::VirtualMachine::VirtualMachine(JavaVM *, int, bool, JNIEnv *)
+#        _ZN9jvmaccess14VirtualMachineC2EP7JavaVM_ibP7JNIEnv_; # jvmaccess::VirtualMachine::VirtualMachine(JavaVM *, int, bool, JNIEnv *)
 
     # We prefix the next two symbols with a wildcard sign because they will only be generated by gcj. The Mac OS X linker doesn't support
     # "Treat not existing symbols as warning" under certain circumstances and thus ends with an error when trying to find these symbols
diff --git jvmaccess/util/msvc_win32_intel.map jvmaccess/util/msvc_win32_intel.map
index fd148b1..19883ba 100644
--- jvmaccess/util/msvc_win32_intel.map
+++ jvmaccess/util/msvc_win32_intel.map
@@ -7,7 +7,6 @@ UDK_3.1 {
         ??4CreationException@AttachGuard@VirtualMachine@jvmaccess@@QAEAAV0123@ABV0123@@Z; # jvmaccess::VirtualMachine::AttachGuard::CreationException::operator =(CreationException const &)
         ??0AttachGuard@VirtualMachine@jvmaccess@@QAE@ABV?$Reference@VVirtualMachine@jvmaccess@@@rtl@@@Z; # jvmaccess::VirtualMachine::AttachGuard::AttachGuard(rtl::Reference< VirtualMachine > const &)
         ??1AttachGuard@VirtualMachine@jvmaccess@@QAE@XZ; # jvmaccess::VirtualMachine::AttachGuard::~AttachGuard()
-    ??0VirtualMachine@jvmaccess@@QAE@PAUJavaVM_@@H_NPAUJNIEnv_@@@Z; # jvmaccess::VirtualMachine::VirtualMachine(JavaVM *, int, bool, JNIEnv *)
 
     local:
         *;
diff --git jvmfwk/inc/jvmfwk/framework.h jvmfwk/inc/jvmfwk/framework.h
index abf1d9d..ebcbe52 100644
--- jvmfwk/inc/jvmfwk/framework.h
+++ jvmfwk/inc/jvmfwk/framework.h
@@ -35,7 +35,7 @@
 
 #include "rtl/ustring.h"
 #include "osl/mutex.h"
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 #include "jni.h"
 #else
 struct JavaVMOption;
diff --git jvmfwk/inc/jvmfwk/vendorplugin.h jvmfwk/inc/jvmfwk/vendorplugin.h
index 903b22c..4c5009c 100644
--- jvmfwk/inc/jvmfwk/vendorplugin.h
+++ jvmfwk/inc/jvmfwk/vendorplugin.h
@@ -34,7 +34,7 @@
 
 #include "jvmfwk/framework.h"
 #include "rtl/ustring.h"
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
 #include "jni.h"
 #endif
 
diff --git jvmfwk/plugins/sunmajor/pluginlib/makefile.mk jvmfwk/plugins/sunmajor/pluginlib/makefile.mk
index 8a14a72..ebdaefb 100644
--- jvmfwk/plugins/sunmajor/pluginlib/makefile.mk
+++ jvmfwk/plugins/sunmajor/pluginlib/makefile.mk
@@ -48,7 +48,7 @@ DLLPRE =
 # ------------------------------------------------------------------
 
 #.INCLUDE :  ..$/cppumaker.mk
-.IF "$(SOLAR_JAVA)"!=""
+.IF "$(SOLAR_JAVA)"!="" && "$(OOo4Kids)" != "YES"
 
 SLOFILES= \
     $(SLO)$/sunversion.obj \
diff --git jvmfwk/plugins/sunmajor/pluginlib/sunjavaplugin.cxx jvmfwk/plugins/sunmajor/pluginlib/sunjavaplugin.cxx
index a4c7f4f..4f57daf 100644
--- jvmfwk/plugins/sunmajor/pluginlib/sunjavaplugin.cxx
+++ jvmfwk/plugins/sunmajor/pluginlib/sunjavaplugin.cxx
@@ -49,7 +49,9 @@
 #include <signal.h>
 #include <stack>
 
+#if !defined( OOo4Kids )
 #include "jni.h"
+#endif
 #include "rtl/byteseq.hxx"
 #include "jvmfwk/vendorplugin.h"
 #include "util.hxx"
@@ -128,9 +130,11 @@ OString getPluginJarPath(
 }
 #endif // UNX
 
-
 JavaInfo* createJavaInfo(const rtl::Reference<VendorBase> & info)
 {
+#if defined( OOo4Kids)
+        return NULL;
+#else
     JavaInfo* pInfo = (JavaInfo*) rtl_allocateMemory(sizeof(JavaInfo));
     if (pInfo == NULL)
         return NULL;
@@ -161,6 +165,7 @@ JavaInfo* createJavaInfo(const rtl::Reference<VendorBase> & info)
     rtl_byte_sequence_acquire(pInfo->arVendorData);
 
     return pInfo;
+#endif
 }   
 
 rtl::OUString getRuntimeLib(const rtl::ByteSequence & data)
@@ -180,12 +185,16 @@ sig_atomic_t g_bInGetJavaVM = 0;
 
 void abort_handler()
 {
+#ifdef OOo4Kids
+    return;
+#else
     // If we are within JNI_CreateJavaVM then we jump back into getJavaVM
     if( g_bInGetJavaVM != 0 )
     {
         fprintf( stderr, "JavaVM: JNI_CreateJavaVM called _exit, caught by abort_handler in javavm.cxx\n");
         longjmp( jmp_jvm_abort, 0);
     }
+#endif
 }
 
 }
@@ -446,6 +455,9 @@ javaPluginError jfw_plugin_startJavaVirtualMachine(
     JavaVM ** ppVm,
     JNIEnv ** ppEnv)
 {
+#ifdef OOo4Kids
+    return JFW_PLUGIN_E_VM_CREATION_FAILED;
+#else
     // unless guard is volatile the following warning occurs on gcc:
     // warning: variable 't' might be clobbered by `longjmp' or `vfork'
     volatile osl::MutexGuard guard(PluginMutex::get());
@@ -629,6 +641,7 @@ javaPluginError jfw_plugin_startJavaVirtualMachine(
         
         
    return errcode;
+#endif // ifdef OOo4Kids
 }
 
 
diff --git jvmfwk/source/elements.cxx jvmfwk/source/elements.cxx
index 38b91db..df68ae5 100644
--- jvmfwk/source/elements.cxx
+++ jvmfwk/source/elements.cxx
@@ -409,6 +409,10 @@ void NodeJava::prepareSettingsDocument() const
         " (elements.cxx).");
     createSettingsDocument();
     rtl::OString sSettings = getSettingsPath();
+#if defined( OOo4Kids )
+    throw FrameworkException(JFW_E_ERROR, sExcMsg);
+    return;
+#else
     CXmlDocPtr doc(xmlParseFile(sSettings.getStr()));
     if (!doc)
         throw FrameworkException(JFW_E_ERROR, sExcMsg);
@@ -421,6 +425,7 @@ void NodeJava::prepareSettingsDocument() const
                 sSettings.getStr(), doc,"UTF-8", 1) == -1)
             throw FrameworkException(JFW_E_ERROR, sExcMsg);
     }
+#endif    
 }
 
 void NodeJava::write() const
diff --git jvmfwk/source/framework.cxx jvmfwk/source/framework.cxx
index d271a66..fa3919b 100644
--- jvmfwk/source/framework.cxx
+++ jvmfwk/source/framework.cxx
@@ -37,7 +37,9 @@
 #include "osl/file.hxx"
 #include "osl/module.hxx"
 #include "jvmfwk/framework.h"
+//#ifndef OOo4Kids
 #include "jvmfwk/vendorplugin.h"
+//#endif
 #include <vector>
 #include <functional>
 #include <algorithm>
@@ -252,7 +254,7 @@ javaFrameworkError SAL_CALL jfw_findAllJREs(JavaInfo ***pparInfo, sal_Int32 *pSi
 javaFrameworkError SAL_CALL jfw_startVM(JavaVMOption *arOptions, sal_Int32 cOptions,
                                  JavaVM **ppVM, JNIEnv **ppEnv)
 {
-#ifndef SOLAR_JAVA
+#if !defined( SOLAR_JAVA ) || defined( OOo4Kids )
     return JFW_E_ERROR;
 #else
     javaFrameworkError errcode = JFW_E_NONE;
@@ -674,6 +676,9 @@ void SAL_CALL jfw_freeJavaInfo(JavaInfo *pInfo)
 javaFrameworkError SAL_CALL jfw_getSelectedJRE(JavaInfo **ppInfo)
 {
     javaFrameworkError errcode = JFW_E_NONE;
+#ifdef OOo4Kids
+    return errcode;
+#else
     try
     {
         osl::MutexGuard guard(jfw::FwkMutex::get());
@@ -723,10 +728,14 @@ javaFrameworkError SAL_CALL jfw_getSelectedJRE(JavaInfo **ppInfo)
         OSL_ENSURE(0, e.message.getStr());
     }
     return errcode;
+#endif
 }
 
 javaFrameworkError SAL_CALL jfw_isVMRunning(sal_Bool *bRunning)
 {
+#if defined( OOo4Kids )
+    return JFW_E_NONE;
+#else
     osl::MutexGuard guard(jfw::FwkMutex::get());
     if (bRunning == NULL)
         return JFW_E_INVALID_ARG;
@@ -735,6 +744,7 @@ javaFrameworkError SAL_CALL jfw_isVMRunning(sal_Bool *bRunning)
     else
         *bRunning = sal_True;
     return JFW_E_NONE;
+#endif
 }
 
 javaFrameworkError SAL_CALL jfw_getJavaInfoByPath(
diff --git jvmfwk/source/javasettings_template.xml jvmfwk/source/javasettings_template.xml
index 5cb41c9..59e60a2 100644
--- jvmfwk/source/javasettings_template.xml
+++ jvmfwk/source/javasettings_template.xml
@@ -13,15 +13,15 @@ When extending the javavendors.xml then use the schema to verify it.
   xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
   xsi:schemaLocation='http://openoffice.org/2004/java/framework/1.0 file:/D:/cws-jl6/jvmfwk/source/javasettings.xsd'>
  <classesDirectory>program/classes</classesDirectory>
- <enabled xsi:nil="true"></enabled>
+ <enabled xsi:nil="false"></enabled>
  <userClassPath xsi:nil="true"></userClassPath>
  <vmParameters xsi:nil="true"/>
   <!--param>-Xdebug</param-->
  <!--</vmParameters>-->
- <jreLocations xsi:nil="true"/>
+ <jreLocations xsi:nil="false"/>
   <!--location></location-->
  <!--</jreLocations>-->
- <javaInfo xsi:nil="true"/>
+ <javaInfo xsi:nil="false"/>
  <!--javaInfo vendorUpdate="2004-03-27" xsi:nil="false"-->
   <!--vendor></vendor>
   <location></location>
diff --git libtextcat/libtextcat-2.2-gdium-mips-workaround.patch libtextcat/libtextcat-2.2-gdium-mips-workaround.patch
new file mode 100644
index 0000000..31ce90d
--- /dev/null
+++ libtextcat/libtextcat-2.2-gdium-mips-workaround.patch
@@ -0,0 +1,22 @@
+--- misc/libtextcat-2.2/config.guess	2003-05-22 13:39:36.000000000 +0200
++++ misc/build/libtextcat-2.2/config.guess	2009-05-10 14:46:46.000000000 +0200
+@@ -801,7 +801,7 @@
+     m68*:Linux:*:*)
+ 	echo ${UNAME_MACHINE}-unknown-linux-gnu
+ 	exit 0 ;;
+-    mips:Linux:*:*)
++    mips:Linux:*:* | mips64:Linux:*.*)
+ 	eval $set_cc_for_build
+ 	sed 's/^	//' << EOF >$dummy.c
+ 	#undef CPU
+--- misc/libtextcat-2.2/configure	2009-08-28 23:40:14.000000000 +0200
++++ misc/build/libtextcat-2.2/configure	2009-08-28 23:40:04.000000000 +0200
+@@ -3453,7 +3453,7 @@
+ # This must be Linux ELF.
+ linux-gnu*)
+   case $host_cpu in
+-  alpha* | hppa* | i*86 | mips | mipsel | powerpc* | sparc* | ia64*)
++  alpha* | hppa* | i*86 | mips | mipsel | mips64 | powerpc* | sparc* | ia64*)
+     lt_cv_deplibs_check_method=pass_all ;;
+   *)
+     # glibc up to 2.1.1 does not perform some relocations on ARM
diff --git libtextcat/makefile.mk libtextcat/makefile.mk
index c7d66e5..2fdde61 100644
--- libtextcat/makefile.mk
+++ libtextcat/makefile.mk
@@ -45,6 +45,9 @@ TARFILE_ROOTDIR=libtextcat-2.2
 
 PATCH_FILES=libtextcat-2.2.patch
 
+.IF "$(CPUNAME)"=="GODSON" && "$(OS)"=="LINUX"
+PATCH_FILES += libtextcat-2.2-gdium-mips-workaround.patch
+.ENDIF
 
 ADDITIONAL_FILES= \
                 src$/utf8misc.h \
diff --git lucene/makefile.mk lucene/makefile.mk
index 2d87f23..5668ca9 100644
--- lucene/makefile.mk
+++ lucene/makefile.mk
@@ -34,6 +34,10 @@ PRJ=.
 PRJNAME=so_lucene
 TARGET=so_lucene
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
 
 # --- Settings -----------------------------------------------------
 
diff --git offapi/com/sun/star/awt/SystemPointer.idl offapi/com/sun/star/awt/SystemPointer.idl
index 865e72c..baeb3e1 100644
--- offapi/com/sun/star/awt/SystemPointer.idl
+++ offapi/com/sun/star/awt/SystemPointer.idl
@@ -486,6 +486,11 @@ published constants SystemPointer
      */
     const long CHAIN_NOTALLOWED = 71; 
  
+    //------------------------------------------------------------------------- 
+        
+    /** specifies a mouse pointer which symbolizes an eraser.
+     */
+    const long ERASER = 94; 
 }; 
  
 //============================================================================= 
diff --git offapi/com/sun/star/presentation/XSlideShow.idl offapi/com/sun/star/presentation/XSlideShow.idl
index 91681e3..c726ced 100644
--- offapi/com/sun/star/presentation/XSlideShow.idl
+++ offapi/com/sun/star/presentation/XSlideShow.idl
@@ -46,9 +46,15 @@
 #ifndef __com_sun_star_animations_XAnimationNode_idl__ 
 #include <com/sun/star/animations/XAnimationNode.idl> 
 #endif 
+#endif
+#ifndef __com_sun_star_lang_XMultiServiceFactory_idl__
+#include <com/sun/star/lang/XMultiServiceFactory.idl>
 #ifndef __com_sun_star_drawing_XDrawPage_idl__ 
 #include <com/sun/star/drawing/XDrawPage.idl> 
 #endif 
+#ifndef __com_sun_star_drawing_XDrawPagesSupplier_idl__
+#include <com/sun/star/drawing/XDrawPagesSupplier.idl>
+#endif
 #ifndef __com_sun_star_drawing_XShape_idl__ 
 #include <com/sun/star/drawing/XShape.idl> 
 #endif 
@@ -130,6 +136,10 @@ interface XSlideShow : ::com::sun::star::uno::XInterface
         @param xPage
         The slide to display.
 
+        @param xDrawPages
+    FIXME : add further information. 
+    This parameter can be NULL when the ENABLE_PRESENTER_EXTRA_UI feature is disabled.
+
         @param xAnimationNode
         The animation node determine the animations to display.
 
@@ -150,6 +160,7 @@ interface XSlideShow : ::com::sun::star::uno::XInterface
     */
     void displaySlide(
         [in] ::com::sun::star::drawing::XDrawPage xSlide,
+        [in] ::com::sun::star::drawing::XDrawPagesSupplier xDrawPages,
         [in] ::com::sun::star::animations::XAnimationNode aAnimationNode,
         [in] sequence< ::com::sun::star::beans::PropertyValue > aProperties );
 
@@ -176,6 +187,14 @@ interface XSlideShow : ::com::sun::star::uno::XInterface
      */
     ::com::sun::star::drawing::XDrawPage getCurrentSlide();
 
+    /** Register drawn polygons in presentation mode
+
+     @param xDocFactory
+
+     */
+
+    void registerUserPaintPolygons([in] ::com::sun::star::lang::XMultiServiceFactory xDocFactory);
+
     /** Change a property of the slideshow.<p>
 
         @param aShowProperty
diff --git offapi/util/makefile.mk offapi/util/makefile.mk
index b0fa7a3..3f38c23 100644
--- offapi/util/makefile.mk
+++ offapi/util/makefile.mk
@@ -40,6 +40,10 @@ TARGET=offapi_db
 
 .INCLUDE :  makefile.pmk
 
+.IF "$(ENABLE_PRESENTER_EXTRA_UI)"=="YES"
+ADDCDEFS += -DENABLE_PRESENTER_EXTRA_UI
+.ENDIF
+
 # ------------------------------------------------------------------
 UNOIDLDBFILES= \
     $(UCR)$/cssauth.db \
diff --git officecfg/registry/data/org/openoffice/Office/Common.xcu officecfg/registry/data/org/openoffice/Office/Common.xcu
index c9747dc..6690d40 100644
--- officecfg/registry/data/org/openoffice/Office/Common.xcu
+++ officecfg/registry/data/org/openoffice/Office/Common.xcu
@@ -31,6 +31,9 @@
 <!DOCTYPE oor:component-data SYSTEM "../../../../component-update.dtd">
 <oor:component-data oor:name="Common" oor:package="org.openoffice.Office" xmlns:oor="http://openoffice.org/2001/registry" xmlns:install="http://openoffice.org/2004/installation" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
   <node oor:name="View">
+      <prop oor:name="FontScaling" oor:type="xs:short">
+        <value>115</value>
+      </prop>
     <node oor:name="Dialog">
       <prop oor:name="MiddleMouseButton">
         <value install:module="unx">2</value>
@@ -547,6 +550,18 @@
     <prop oor:name="UseSystemPrintDialog"  install:module="macosx">
       <value>true</value>
     </prop>
+    <prop oor:name="UserLevel" oor:type="xs:short">
+      <value>1</value>
+    </prop>
+    <prop oor:name="UserPrefsPasswordFeatureEnabled" oor:type="xs:boolean"> 
+      <value>false</value>
+    </prop>
+    <prop oor:name="UserPrefsPasswordNeverModified" oor:type="xs:boolean"> 
+      <value>true</value>
+    </prop>
+    <prop oor:name="UserPrefsPassword" oor:type="xs:string">
+      <value>prof</value>
+    </prop>
   </node>
   <node oor:name="Save">
     <node oor:name="Document">
diff --git officecfg/registry/data/org/openoffice/Office/Jobs.xcu officecfg/registry/data/org/openoffice/Office/Jobs.xcu
index 6a1fe6a..13d47dc 100644
--- officecfg/registry/data/org/openoffice/Office/Jobs.xcu
+++ officecfg/registry/data/org/openoffice/Office/Jobs.xcu
@@ -8,7 +8,8 @@
  * OpenOffice.org - a multi-platform office productivity suite
  *
  * $RCSfile: Jobs.xcu,v $
- * $Revision: 1.10 $
+ *
+ * $Revision: 1.5 $
  *
  * This file is part of OpenOffice.org.
  *
@@ -28,23 +29,49 @@
  * for a copy of the LGPLv3 License.
  *
  ************************************************************************ -->
-<!DOCTYPE oor:component-data SYSTEM "../../../../component-update.dtd">
 <oor:component-data oor:name="Jobs" oor:package="org.openoffice.Office" xmlns:oor="http://openoffice.org/2001/registry" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
   <node oor:name="Jobs">
-    <node oor:name="RegistrationRequest" oor:op="replace">
+    <node oor:name="ProductRegistration" oor:op="replace">
       <prop oor:name="Service">
-        <value>com.sun.star.setup.ProductRegistration</value>
+        <value>com.sun.star.comp.framework.DoRegistrationJob</value>
+      </prop>
+      <node oor:name="Arguments">
+        <prop oor:name="ProductName" oor:op="replace" oor:type="xs:string">
+          <value>${SERVICETAG_PRODUCTNAME}</value>
+        </prop>
+        <prop oor:name="ProductVersion" oor:op="replace" oor:type="xs:string">
+          <value>${SERVICETAG_PRODUCTVERSION}</value>
+        </prop>
+        <prop oor:name="ProductURN" oor:op="replace" oor:type="xs:string">
+          <value>${SERVICETAG_URN}</value>
+        </prop>
+        <prop oor:name="ProductSource" oor:op="replace" oor:type="xs:string">
+          <value>${SERVICETAG_SOURCE}</value>
+        </prop>
+        <prop oor:name="ProductParent" oor:op="replace" oor:type="xs:string">
+          <value>${SERVICETAG_PARENTNAME}</value>
+        </prop>
+        <prop oor:name="Vendor" oor:op="replace" oor:type="xs:string">
+          <value>Sun Microsystems, Inc.</value>
       </prop>
+        <prop oor:name="RegistrationData" oor:op="replace" oor:type="xs:string">
+          <value>$(user)/registration.xml</value>
+        </prop>
+        <prop oor:name="RegistrationURL" oor:op="replace" oor:type="xs:string">
+          <value>${REGISTRATION_HOST}/register/${registry_urn}?product=${REGISTRATION_PRODUCT}&amp;locale=${locale}&amp;cid=${REGISTRATION_CID}</value>
+        </prop>
+      </node>
     </node>
   </node>
   <node oor:name="Events">
-    <node oor:name="onFirstVisibleTask" oor:op="fuse">
+    <node oor:name="onRegisterNow" oor:op="fuse">
       <node oor:name="JobList">
-        <node oor:name="RegistrationRequest" oor:op="replace">
-            <prop oor:name="UserTime">
-                <value>2003-01-01T00:00:00+00:01</value>
-            </prop>
+        <node oor:name="ProductRegistration" oor:op="replace"/>
+      </node>
         </node>
+    <node oor:name="onRegisterLater" oor:op="fuse">
+      <node oor:name="JobList">
+        <node oor:name="ProductRegistration" oor:op="replace"/>
       </node>
     </node>
   </node>
diff --git officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu
index 4cf86e6..8e07207 100644
--- officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu
+++ officecfg/registry/data/org/openoffice/Office/UI/CalcWindowState.xcu
@@ -143,7 +143,7 @@
                     <value>false</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>true</value>
@@ -232,8 +232,17 @@
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/formatobjectbar" oor:op="replace">
+    <prop oor:name="ContextActive" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
                 <prop oor:name="DockPos" oor:type="xs:string">
-                    <value>0,2</value>
+     <value>856,0</value>
+    </prop>
+    <prop oor:name="DockSize" oor:type="xs:string">
+     <value xsi:nil="true"/>
                 </prop>
                 <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
@@ -241,14 +250,32 @@
                 <prop oor:name="DockingArea" oor:type="xs:int">
                     <value>0</value>
                 </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
-                </prop>
-                <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Formatting</value>
-                </prop>
-                <prop oor:name="ContextSensitive" oor:type="xs:boolean">
-                    <value>true</value>
+    <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+     <value>false</value>
+                </prop>
+    <prop oor:name="InternalState" oor:type="xs:int">
+     <value xsi:nil="true"/>
+                </prop>
+    <prop oor:name="Locked" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="NoClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Pos" oor:type="xs:string">
+     <value>2147483647,2147483647</value>
+    </prop>
+    <prop oor:name="Size" oor:type="xs:string">
+     <value>0,0</value>
+    </prop>
+    <prop oor:name="SoftClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Style" oor:type="xs:int">
+     <value>0</value>
+    </prop>
+    <prop oor:name="Visible" oor:type="xs:boolean">
+     <value>false</value>
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/insertbar" oor:op="replace">
@@ -274,6 +301,58 @@
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/standardbar" oor:op="replace">
+    <prop oor:name="ContextActive" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="DockPos" oor:type="xs:string">
+     <value>0,0</value>
+    </prop>
+    <prop oor:name="DockSize" oor:type="xs:string">
+     <value xsi:nil="true"/>
+    </prop>
+    <prop oor:name="Docked" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="DockingArea" oor:type="xs:int">
+     <value>2</value>
+    </prop>
+    <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="InternalState" oor:type="xs:int">
+     <value xsi:nil="true"/>
+    </prop>
+    <prop oor:name="Locked" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="NoClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Pos" oor:type="xs:string">
+     <value>2147483647,2147483647</value>
+    </prop>
+    <prop oor:name="Size" oor:type="xs:string">
+     <value>0,0</value>
+    </prop>
+    <prop oor:name="SoftClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Style" oor:type="xs:int">
+     <value>0</value>
+    </prop>
+    <prop oor:name="UIName" oor:type="xs:string">
+     <value xml:lang="en-US"/>
+    </prop>
+    <prop oor:name="Visible" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+   </node>
+
+<!--
+            <node oor:name="private:resource/toolbar/standardbar" oor:op="replace">
                 <prop oor:name="DockPos" oor:type="xs:string">
                     <value>0,0</value>
                 </prop>
@@ -296,6 +375,7 @@
                     <value>true</value>
                 </prop>
             </node>
+-->
             <node oor:name="private:resource/toolbar/textobjectbar" oor:op="replace">
                 <prop oor:name="DockPos" oor:type="xs:string">
                     <value>0,1</value>
diff --git officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu
index 0e029ad..2c16477 100644
--- officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu
+++ officecfg/registry/data/org/openoffice/Office/UI/DrawWindowState.xcu
@@ -87,62 +87,152 @@
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/standardbar" oor:op="replace">
+    <prop oor:name="ContextActive" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
                 <prop oor:name="DockPos" oor:type="xs:string">
-                    <value>0,0</value>
+     <value>0,27</value>
+    </prop>
+    <prop oor:name="DockSize" oor:type="xs:string">
+     <value xsi:nil="true"/>
                 </prop>
                 <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
                 <prop oor:name="DockingArea" oor:type="xs:int">
-                    <value>0</value>
+     <value>2</value>
                 </prop>
-                <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Standard</value>
+    <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+     <value>false</value>
                 </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
+    <prop oor:name="InternalState" oor:type="xs:int">
+     <value xsi:nil="true"/>
+    </prop>
+    <prop oor:name="Locked" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
-                <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+    <prop oor:name="NoClose" oor:type="xs:boolean">
                     <value>false</value>
                 </prop>
-                <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+    <prop oor:name="Pos" oor:type="xs:string">
+     <value>2147483647,2147483647</value>
+    </prop>
+    <prop oor:name="Size" oor:type="xs:string">
+     <value>0,0</value>
+    </prop>
+    <prop oor:name="SoftClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Style" oor:type="xs:int">
+     <value>0</value>
+    </prop>
+    <prop oor:name="UIName" oor:type="xs:string">
+     <value xml:lang="fr"/>
+    </prop>
+    <prop oor:name="Visible" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/drawingobjectbar" oor:op="replace">
+    <prop oor:name="ContextActive" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
                 <prop oor:name="DockPos" oor:type="xs:string">
-                    <value>0,1</value>
+     <value>0,402</value>
+    </prop>
+    <prop oor:name="DockSize" oor:type="xs:string">
+     <value xsi:nil="true"/>
                 </prop>
                 <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
                 <prop oor:name="DockingArea" oor:type="xs:int">
-                    <value>0</value>
-                </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
-                </prop>
-                <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Line and Filling</value>
-                </prop>
-                <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+     <value>2</value>
+                </prop>
+    <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="InternalState" oor:type="xs:int">
+     <value xsi:nil="true"/>
+    </prop>
+    <prop oor:name="Locked" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="NoClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Pos" oor:type="xs:string">
+     <value>109,235</value>
+    </prop>
+    <prop oor:name="Size" oor:type="xs:string">
+     <value>694,56</value>
+    </prop>
+    <prop oor:name="SoftClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Style" oor:type="xs:int">
+     <value>0</value>
+                </prop>
+                <prop oor:name="UIName" oor:type="xs:string">
+     <value xml:lang="fr"/>
+                </prop>
+    <prop oor:name="Visible" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/toolbar" oor:op="replace">
+    <prop oor:name="ContextActive" oor:type="xs:boolean">
+     <value>true</value>
+    </prop>
+    <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="DockPos" oor:type="xs:string">
+     <value>97,0</value>
+    </prop>
+    <prop oor:name="DockSize" oor:type="xs:string">
+     <value xsi:nil="true"/>
+    </prop>
                 <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
                 <prop oor:name="DockingArea" oor:type="xs:int">
                     <value>1</value>
                 </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
-                </prop>
-                <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Drawing</value>
-                </prop>
-                <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+    <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="InternalState" oor:type="xs:int">
+     <value xsi:nil="true"/>
+    </prop>
+    <prop oor:name="Locked" oor:type="xs:boolean">
+                    <value>true</value>
+                </prop>
+    <prop oor:name="NoClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Pos" oor:type="xs:string">
+     <value>51,629</value>
+    </prop>
+    <prop oor:name="Size" oor:type="xs:string">
+     <value>909,56</value>
+    </prop>
+    <prop oor:name="SoftClose" oor:type="xs:boolean">
+     <value>false</value>
+    </prop>
+    <prop oor:name="Style" oor:type="xs:int">
+     <value>0</value>
+    </prop>
+                <prop oor:name="UIName" oor:type="xs:string">
+     <value xml:lang="fr"/>
+                </prop>
+    <prop oor:name="Visible" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
             </node>
diff --git officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
index fa69145..2d43885 100644
--- officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
+++ officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
@@ -4564,6 +4564,19 @@
                     <value xml:lang="en-US">A~bout %PRODUCTNAME</value>
                 </prop>
             </node>
+            <node oor:name=".uno:ShowLicense" oor:op="replace">
+                <prop oor:name="Label" oor:type="xs:string">
+                <value xml:lang="en-US">L~icense...</value>
+                <value xml:lang="de">L~izenz...</value>
+                <value xml:lang="fr">L~icence...</value>
+                <value xml:lang="es">L~icencia...</value>
+                <value xml:lang="pt">L~icena ...</value>
+                <value xml:lang="it">L~icenza...</value>
+                <value xml:lang="nl">L~icentie...</value>
+                <value xml:lang="zh-CN"></value>
+                <value xml:lang="fi">Kytto~ikeus...</value>
+                </prop>
+            </node>
             <node oor:name=".uno:PrinterSetup" oor:op="replace">
                 <prop oor:name="Label" oor:type="xs:string">
                     <value xml:lang="en-US">P~rinter Settings...</value>
diff --git officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu
index 12cc7a9..a5e6169 100644
--- officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu
+++ officecfg/registry/data/org/openoffice/Office/UI/WriterWindowState.xcu
@@ -42,6 +42,9 @@
                 <prop oor:name="DockingArea" oor:type="xs:int">
                     <value>0</value>
                 </prop>
+        <prop oor:name="Size" oor:type="xs:string">
+            <value>1010,56</value>
+                </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">Standard</value>
                 </prop>
@@ -55,9 +58,68 @@
                     <value>true</value>
                 </prop>
             </node>
-            <node oor:name="private:resource/toolbar/textobjectbar" oor:op="replace">
+        <node oor:name="private:resource/toolbar/beginner" oor:op="replace">
+        <prop oor:name="ContextActive" oor:type="xs:boolean">
+        <value>true</value>
+        </prop>
+        <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
                 <prop oor:name="DockPos" oor:type="xs:string">
-                    <value>0,1</value>
+        <value>210,1</value>
+        </prop>	
+        <prop oor:name="DockSize" oor:type="xs:string">
+        <value xsi:nil="true"/>
+        </prop>
+        <prop oor:name="Docked" oor:type="xs:boolean">
+        <value>true</value>
+        </prop>
+        <prop oor:name="DockingArea" oor:type="xs:int">
+        <value>0</value>
+        </prop>
+        <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="InternalState" oor:type="xs:int">
+        <value xsi:nil="true"/>
+        </prop>
+        <prop oor:name="Locked" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="NoClose" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="Pos" oor:type="xs:string">
+        <value>2147483647,2147483647</value>
+        </prop>
+        <prop oor:name="Size" oor:type="xs:string">
+        <value>0,0</value>
+        </prop>
+        <prop oor:name="SoftClose" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="Style" oor:type="xs:int">
+        <value>0</value>
+        </prop>
+        <prop oor:name="UIName" oor:type="xs:string">
+        <value xml:lang="en-US"/>
+        </prop>
+        <prop oor:name="Visible" oor:type="xs:boolean">
+        <value>true</value>
+        </prop>
+    </node>
+    <node oor:name="private:resource/toolbar/average" oor:op="replace">
+        <prop oor:name="ContextActive" oor:type="xs:boolean">
+        <value>true</value>
+        </prop>
+        <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="DockPos" oor:type="xs:string">
+        <value>67,1</value>
+        </prop>
+        <prop oor:name="DockSize" oor:type="xs:string">
+        <value xsi:nil="true"/>
                 </prop>
                 <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
@@ -65,15 +127,87 @@
                 <prop oor:name="DockingArea" oor:type="xs:int">
                     <value>0</value>
                 </prop>
-                <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Formatting</value>
-                </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
+        <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="InternalState" oor:type="xs:int">
+        <value xsi:nil="true"/>
+        </prop>
+        <prop oor:name="Locked" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="NoClose" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="Pos" oor:type="xs:string">
+        <value>2147483647,2147483647</value>
+        </prop>
+        <prop oor:name="Size" oor:type="xs:string">
+        <value>0,0</value>
+        </prop>
+        <prop oor:name="SoftClose" oor:type="xs:boolean">
+        <value>false</value>
+        </prop>
+        <prop oor:name="Style" oor:type="xs:int">
+        <value>0</value>
+        </prop>
+                <prop oor:name="UIName" oor:type="xs:string">
+        <value xml:lang="en-US">average</value>
+                </prop>
+                <prop oor:name="Visible" oor:type="xs:boolean">
+                    <value>true</value>
+                </prop>
+        </node>
+
+            <node oor:name="private:resource/toolbar/textobjectbar" oor:op="replace">
+                <prop oor:name="ContextActive" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
                 <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="DockPos" oor:type="xs:string">
+                    <value>601,0</value>
+                </prop>
+                <prop oor:name="DockSize" oor:type="xs:string">
+                    <value xsi:nil="true"/>
+                </prop>
+                <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
+                <prop oor:name="DockingArea" oor:type="xs:int">
+                    <value>0</value>
+                </prop>
+                <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="InternalState" oor:type="xs:int">
+                    <value xsi:nil="true"/>
+                </prop>
+                <prop oor:name="Locked" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="NoClose" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="Pos" oor:type="xs:string">
+                    <value>2147483647,2147483647</value>
+                </prop>
+                <prop oor:name="Size" oor:type="xs:string">
+                    <value>0,0</value>
+                </prop>
+                <prop oor:name="SoftClose" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="Style" oor:type="xs:int">
+                    <value>0</value>
+                </prop>
+                <prop oor:name="UIName" oor:type="xs:string">
+                    <value xml:lang="en-US">beginner</value>
+                </prop>
+                <prop oor:name="Visible" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
             </node>
             <node oor:name="private:resource/toolbar/toolbar" oor:op="replace">
                 <prop oor:name="Docked" oor:type="xs:boolean">
@@ -94,7 +228,7 @@
                     <value>false</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">Table</value>
@@ -111,7 +245,7 @@
                     <value xml:lang="en-US">Bullets and Numbering</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="ContextSensitive" oor:type="xs:boolean">
                     <value>true</value>
@@ -131,7 +265,7 @@
                     <value xml:lang="en-US">Drawing Object Properties</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>false</value>
@@ -159,7 +293,7 @@
                     <value xml:lang="en-US">Edit Points</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>true</value>
@@ -176,7 +310,7 @@
                     <value>false</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">3D-Settings</value>
@@ -196,7 +330,7 @@
                     <value>false</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>true</value>
@@ -213,7 +347,7 @@
                     <value>false</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>true</value>
@@ -242,7 +376,7 @@
                     <value>false</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="ContextSensitive" oor:type="xs:boolean">
                     <value>true</value>
@@ -298,7 +432,7 @@
                     <value>true</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="ContextSensitive" oor:type="xs:boolean">
                     <value>true</value>
@@ -315,7 +449,7 @@
                     <value xml:lang="en-US">Full Screen</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>true</value>
@@ -341,18 +475,18 @@
                     <value>true</value>
                 </prop>
             </node>
-            <node oor:name="private:resource/toolbar/graphicobjectbar" oor:op="replace">
-                <prop oor:name="Docked" oor:type="xs:boolean">
-                    <value>false</value>
+            <node oor:name="private:resource/toolbar/graphicobjectbar">
+                <prop oor:name="DockPos" oor:type="xs:string">
+                    <value>2147483647,2147483647</value>
                 </prop>
-                <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Picture</value>
+                <prop oor:name="DockingArea" oor:type="xs:int">
+                    <value>0</value>
                 </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                <prop oor:name="Pos" oor:type="xs:string">
+                    <value>82,71</value>
                 </prop>
-                <prop oor:name="ContextSensitive" oor:type="xs:boolean">
-                    <value>true</value>
+                <prop oor:name="Size" oor:type="xs:string">
+                    <value>0,0</value>
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/insertbar" oor:op="replace">
@@ -377,7 +511,7 @@
                     <value>true</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">OLE-Object</value>
@@ -414,7 +548,7 @@
                     <value>true</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">Page Preview</value>
@@ -440,7 +574,7 @@
                     <value>true</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">Text Object</value>
@@ -460,7 +594,7 @@
                     <value>true</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
                     <value xml:lang="en-US">Standard (Viewing Mode)</value>
@@ -476,17 +610,53 @@
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/drawbar" oor:op="replace">
-                <prop oor:name="DockingArea" oor:type="xs:int">
-                    <value>1</value>
+                <prop oor:name="ContextActive" oor:type="xs:boolean">
+                    <value>true</value>
+                </prop>
+                <prop oor:name="ContextSensitive" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="DockPos" oor:type="xs:string">
+                    <value>0,39</value>
+                </prop>
+                <prop oor:name="DockSize" oor:type="xs:string">
+                    <value xsi:nil="true"/>
                 </prop>
                 <prop oor:name="Docked" oor:type="xs:boolean">
                     <value>true</value>
                 </prop>
-                <prop oor:name="Visible" oor:type="xs:boolean">
+                <prop oor:name="DockingArea" oor:type="xs:int">
+                    <value>2</value>
+                </prop>
+                <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="InternalState" oor:type="xs:int">
+                    <value xsi:nil="true"/>
+                </prop>
+                <prop oor:name="Locked" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="NoClose" oor:type="xs:boolean">
+                    <value>false</value>
+                </prop>
+                <prop oor:name="Pos" oor:type="xs:string">
+                    <value>2147483647,2147483647</value>
+                </prop>
+                <prop oor:name="Size" oor:type="xs:string">
+                    <value>0,0</value>
+                </prop>
+                <prop oor:name="SoftClose" oor:type="xs:boolean">
                     <value>false</value>
                 </prop>
+                <prop oor:name="Style" oor:type="xs:int">
+                    <value>0</value>
+                </prop>
                 <prop oor:name="UIName" oor:type="xs:string">
-                    <value xml:lang="en-US">Drawing</value>
+                    <value xml:lang="en-US"/>
+                </prop>
+                <prop oor:name="Visible" oor:type="xs:boolean">
+                    <value>false</value>
                 </prop>
             </node>
             <node oor:name="private:resource/toolbar/mediaobjectbar" oor:op="replace">
@@ -503,7 +673,7 @@
                     <value xml:lang="en-US">Media Playback</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="ContextSensitive" oor:type="xs:boolean">
                     <value>true</value>
@@ -615,7 +785,7 @@
                     <value xml:lang="en-US">Fontwork</value>
                 </prop>
                 <prop oor:name="Visible" oor:type="xs:boolean">
-                    <value>true</value>
+                    <value>false</value>
                 </prop>
                 <prop oor:name="HideFromToolbarMenu" oor:type="xs:boolean">
                     <value>false</value>
diff --git officecfg/registry/data/org/openoffice/Office/Views.xcu officecfg/registry/data/org/openoffice/Office/Views.xcu
index 9cff446..b59c2e6 100644
--- officecfg/registry/data/org/openoffice/Office/Views.xcu
+++ officecfg/registry/data/org/openoffice/Office/Views.xcu
@@ -36,5 +36,44 @@
     <value>false</value>
    </prop>
   </node>
+  <node oor:name="SplitWindow0" oor:op="replace">
+   <prop oor:name="Visible" oor:type="xs:boolean">
+    <value xsi:nil="true"/>
+   </prop>
+   <prop oor:name="WindowState" oor:type="xs:string">
+    <value xsi:nil="true"/>
+   </prop>
+   <node oor:name="UserData">
+    <prop oor:name="UserItem" oor:op="replace" oor:type="xs:string">
+     <value>V1,2,0</value>
+    </prop>
+   </node>
+  </node>
+  <node oor:name="27415" oor:op="replace">
+   <prop oor:name="Visible" oor:type="xs:boolean">
+    <value xsi:nil="true"/>
+   </prop>
+   <prop oor:name="WindowState" oor:type="xs:string">
+    <value/>
+   </prop>
+   <node oor:name="UserData">
+    <prop oor:name="Data" oor:op="replace" oor:type="xs:string">
+     <value>V2,V,0,AL:(5,16,0/0/150/400,150;591)</value>
+    </prop>
+   </node>
+  </node>
+  <node oor:name="SplitWindow2" oor:op="replace">
+   <prop oor:name="Visible" oor:type="xs:boolean">
+    <value xsi:nil="true"/>
+   </prop>
+   <prop oor:name="WindowState" oor:type="xs:string">
+    <value xsi:nil="true"/>
+   </prop>
+   <node oor:name="UserData">
+    <prop oor:name="UserItem" oor:op="replace" oor:type="xs:string">
+     <value>V1,2,1,0,27415</value>
+    </prop>
+   </node>
+  </node>
  </node>
 </oor:component-data>
diff --git officecfg/registry/data/org/openoffice/Setup.xcu officecfg/registry/data/org/openoffice/Setup.xcu
index 75d67f0..ff2aed2 100644
--- officecfg/registry/data/org/openoffice/Setup.xcu
+++ officecfg/registry/data/org/openoffice/Setup.xcu
@@ -838,6 +838,10 @@
             org.openoffice.Office.Common/Misc/SymbolSet
             org.openoffice.Office.Common/Misc/UseSystemFileDialog
             org.openoffice.Office.Common/Misc/UseSystemPrintDialog
+            org.openoffice.Office.Common/Misc/UserLevel
+            org.openoffice.Office.Common/Misc/UserPrefsPasswordFeatureEnabled
+            org.openoffice.Office.Common/Misc/UserPrefsPasswordNeverModified
+            org.openoffice.Office.Common/Misc/UserPrefsPassword
             org.openoffice.Office.Common/Misc/SymbolStyle
             org.openoffice.Office.Common/Passwords
             org.openoffice.Office.Common/Print/PrintingModifiesDocument
diff --git officecfg/registry/schema/org/openoffice/Office/Common.xcs officecfg/registry/schema/org/openoffice/Office/Common.xcs
index f816a55..7bc94ce 100644
--- officecfg/registry/schema/org/openoffice/Office/Common.xcs
+++ officecfg/registry/schema/org/openoffice/Office/Common.xcs
@@ -1320,6 +1320,17 @@ Dymamic border coloring means that when the mouse is hovered over a control, and
 				</info>
 				<value>true</value>
 			</prop>
+            <prop oor:name="AddNonBreakingSpace" oor:type="xs:boolean">
+                <!-- OldPath: AutoCorrect/Options/All -->
+                <!-- OldLocation: Soffice.cfg -->
+                <!-- UIHints: Tools  AutoCorrect/AutoFormat  Options - Add non-breaking space -->
+                <info>
+                    <author>cedricbosdo</author>
+                    <desc>Adds a non-breaking space before the characters :;!? in french.</desc>
+                    <label>Add non-breaking space</label>
+                </info>
+                <value>true</value>
+            </prop>
 			<prop oor:name="RemoveDoubleSpaces" oor:type="xs:boolean">
 				<!-- OldPath: AutoCorrect/Options/All -->
 				<!-- OldLocation: Soffice.cfg -->
@@ -5722,6 +5733,34 @@ Dymamic border coloring means that when the mouse is hovered over a control, and
 				</info>
 				<value>false</value>
 			</prop>
+            <prop oor:name="UserLevel" oor:type="xs:short">
+                <info>
+                    <author>ericb</author>
+                    <desc> Determines the level of difficulty of the features presented to the user</desc>
+                </info>
+                <value>1</value>
+            </prop>
+            <prop oor:name="UserPrefsPasswordFeatureEnabled" oor:type="xs:boolean">
+                <info>
+                    <author>ericb</author>
+                    <desc> If true, modify the preferences will need a password (prof is the default password). Default value is false</desc>
+                </info>
+                <value>false</value>
+            </prop>
+            <prop oor:name="UserPrefsPasswordNeverModified" oor:type="xs:boolean">
+                <info>
+                    <author>ericb</author>
+                    <desc>Used only once. If true, means password contains the initial value : prof. Default value is true</desc>
+                </info>
+                <value>true</value>
+            </prop>
+            <prop oor:name="UserPrefsPassword" oor:type="xs:string">
+                <info>
+                    <author>ericb</author>
+                    <desc> Contains the preferences password, to avoid children doing mistakes. Default value is "prof"</desc>
+                </info>
+                <value>prof</value>
+            </prop>
 			<prop oor:name="SymbolSet" oor:type="xs:short">
 				<!-- UIHints: Tools  Options General View -->
 				<info>
@@ -5754,36 +5793,11 @@ Dymamic border coloring means that when the mouse is hovered over a control, and
 							<desc>Automatic, chosen according to the desktop</desc>
 						</info>
 					</enumeration>
-					<enumeration oor:value="default">
-						<info>
-							<desc>Default - the OpenOffice.org default theme</desc>
-						</info>
-					</enumeration>
-					<enumeration oor:value="hicontrast">
-						<info>
-							<desc>HiContrast</desc>
-						</info>
-					</enumeration>
-					<enumeration oor:value="industrial">
-						<info>
-							<desc>Industrial</desc>
-						</info>
-					</enumeration>
 					<enumeration oor:value="crystal">
 						<info>
 							<desc>Crystal - the KDE default theme</desc>
 						</info>
 					</enumeration>
-					<enumeration oor:value="tango">
-						<info>
-							<desc>Tango - the Gnome default theme</desc>
-						</info>
-					</enumeration>
-					<enumeration oor:value="classic">
-						<info>
-							<desc>Classic - the OpenOffice.org 2.0 default theme</desc>
-						</info>
-					</enumeration>
 				</constraints>
 				<value>auto</value>
 			</prop>
diff --git officecfg/registry/schema/org/openoffice/Office/Impress.xcs officecfg/registry/schema/org/openoffice/Office/Impress.xcs
index bfa2e7d..e3ee78b 100644
--- officecfg/registry/schema/org/openoffice/Office/Impress.xcs
+++ officecfg/registry/schema/org/openoffice/Office/Impress.xcs
@@ -471,7 +471,7 @@
 					is allowed. </desc>
 					<label>List of files containing transition effects</label>
 				</info>
-                <value oor:separator=";">vnd.sun.star.expand:$OOO_BASE_DIR/share/config/soffice.cfg/simpress/transitions.xml</value>
+                <value oor:separator=";">vnd.sun.star.expand:$OOO_BASE_DIR/share/config/soffice.cfg/simpress/transitions.xml;vnd.sun.star.expand:$OOO_BASE_DIR/share/config/soffice.cfg/simpress/transitions-ogl.xml</value>
 			</prop>
 			<prop oor:name="EffectFiles" oor:type="oor:string-list">
 				<!-- OldPath: -->
diff --git officecfg/registry/schema/org/openoffice/Office/Writer.xcs officecfg/registry/schema/org/openoffice/Office/Writer.xcs
index cb22883..a8e8519 100644
--- officecfg/registry/schema/org/openoffice/Office/Writer.xcs
+++ officecfg/registry/schema/org/openoffice/Office/Writer.xcs
@@ -4414,6 +4414,17 @@
 						</info>
 						<value>true</value>
 					</prop>
+                    <prop oor:name="AddNonBreakingSpace" oor:type="xs:boolean">
+                        <!-- OldPath: Writer/AutoFormat/Options -->
+                        <!-- OldLocation: Soffice.cfg -->
+                        <!-- UIHints: Tools  AutoCorrect/AutoFormat  Options - Add non-breaking space -->
+                        <info>
+                            <author>cedricbosdo</author>
+                            <desc>Adds a non-breaking space before the characters :!;? in french.</desc>
+                            <label>Add non-breaking space</label>
+                        </info>
+                        <value>true</value>
+                    </prop>
 					<prop oor:name="DelEmptyParagraphs" oor:type="xs:boolean">
 						<!-- OldPath: Writer/AutoFormat/Options -->
 						<!-- OldLocation: Soffice.cfg -->
@@ -4590,6 +4601,17 @@
 						</info>
 						<value>true</value>
 					</prop>
+                    <prop oor:name="AddNonBreakingSpace" oor:type="xs:boolean">
+                        <!-- OldPath: Writer/AutoFormat/Options -->
+                        <!-- OldLocation: Soffice.cfg -->
+                        <!-- UIHints: Tools  AutoCorrect/AutoFormat  Options - Add non-breaking space -->
+                        <info>
+                            <author>cedricbosdo</author>
+                            <desc>Adds a non-breaking space before the characters :!;? in french.</desc>
+                            <label>Add non-breaking space</label>
+                        </info>
+                        <value>true</value>
+                    </prop>
 					<prop oor:name="ChangeToBorders" oor:type="xs:boolean">
 						<!-- OldPath: Writer/AutoFormat/ByInput -->
 						<!-- OldLocation: Soffice.cfg -->
diff --git openssl/makefile.mk openssl/makefile.mk
index 6fb48b7..c5687bd 100644
--- openssl/makefile.mk
+++ openssl/makefile.mk
@@ -70,13 +70,19 @@ OUT2INC += include/openssl/*
     ADDITIONAL_FILES:= \
         libcrypto_OOo_0_9_8l.map \
         libssl_OOo_0_9_8l.map
+    .IF "$(CPUNAME)" != "GODSON"
     .IF "$(CPU)" == "I"
         CONFIGURE_ACTION=Configure linux-elf
+    .ELIF "$(CPU)" == "P"
+        CONFIGURE_ACTION=Configure linux-ppc
     .ELIF "$(BUILD64)" == "1"
         CONFIGURE_ACTION=Configure linux-generic64
     .ELSE
         CONFIGURE_ACTION=Configure linux-generic32
     .ENDIF
+    .ELSE
+        CONFIGURE_ACTION=Configure linux-generic32
+    .ENDIF
     # if you build openssl as shared library you have to patch the Makefile.Shared "LD_LIBRARY_PATH=$$LD_LIBRARY_PATH \"
     #BUILD_ACTION=make 'SHARED_LDFLAGS=-Wl,--version-script=./lib$$(SHLIBDIRS)_OOo_0_9_8e.map'
 .ENDIF
diff --git packimages/pack/image-OOo4Kids-sort.lst packimages/pack/image-OOo4Kids-sort.lst
new file mode 100644
index 0000000..b0770a4
--- /dev/null
+++ packimages/pack/image-OOo4Kids-sort.lst
@@ -0,0 +1,314 @@
+#
+# This file exists to help improve the ordering of
+# icons inside the OOo4kids theme / images.zip file.
+#
+# Sections are processed together, and are delimited
+# by '-- <tag> [small]' a 'group' tage denotes equal
+# importance: icons must be interleaved, 'ordered'
+# denotes a simple best-fit order. 'literal' denotes
+# a list of explicit image loads
+#
+
+res/mainapp_16.png
+res/mainapp_32.png
+sw/res/punkt.png
+sw/res/punkt_h.png
+res/sx03251.png
+res/lx03251.png
+
+-- literal
+
+# 'standard' toolbars
+uiconfig/modules/swriter/toolbar/standardbar.xml
+uiconfig/modules/scalc/toolbar/standardbar.xml
+uiconfig/modules/simpress/toolbar/standardbar.xml
+uiconfig/modules/sdraw/toolbar/standardbar.xml
+-- group
+
+# default / startup toolbars
+uiconfig/modules/swriter/toolbar/textobjectbar.xml
+uiconfig/modules/scalc/toolbar/formatobjectbar.xml
+-- group
+
+uiconfig/modules/simpress/toolbar/drawingobjectbar.xml
+uiconfig/modules/sdraw/toolbar/drawingobjectbar.xml
+-- group
+
+uiconfig/modules/simpress/toolbar/toolbar.xml
+uiconfig/modules/sdraw/toolbar/toolbar.xml
+-- group
+
+uiconfig/modules/simpress/toolbar/commontaskbar.xml
+-- ordered
+
+svtools/res/prnfont.png
+svtools/res/bmpfont.png
+svtools/res/scalfont.png
+svx/res/signet_11x16.png
+svx/res/caution_11x16.png
+svx/res/notcertificate_16.png
+res/sc10223.png
+res/sc10224.png
+res/sx03250.png
+res/sx03249.png
+res/sx03246.png
+res/sx03245.png
+res/sx03139.png
+res/sx03248.png
+res/sx03247.png
+res/sx03255.png
+res/sx03242.png
+-- literal
+
+# default / startup menus:
+uiconfig/modules/swriter/menubar/menubar.xml
+uiconfig/modules/scalc/menubar/menubar.xml
+uiconfig/modules/simpress/menubar/menubar.xml
+uiconfig/modules/sdraw/menubar/menubar.xml
+-- group small
+
+#
+# complete list of other toolbars / menus
+# FIXME: should auto-generate this.
+#
+uiconfig/modules/BasicIDE/toolbar/fullscreenbar.xml
+uiconfig/modules/BasicIDE/toolbar/insertcontrolsbar.xml
+uiconfig/modules/BasicIDE/toolbar/macrobar.xml
+uiconfig/modules/BasicIDE/toolbar/standardbar.xml
+uiconfig/modules/StartModule/toolbar/standardbar.xml
+uiconfig/modules/schart/toolbar/standardbar.xml
+uiconfig/modules/schart/toolbar/toolbar.xml
+uiconfig/modules/scalc/toolbar/alignmentbar.xml
+uiconfig/modules/scalc/toolbar/arrowshapes.xml
+uiconfig/modules/scalc/toolbar/basicshapes.xml
+uiconfig/modules/scalc/toolbar/calloutshapes.xml
+uiconfig/modules/scalc/toolbar/colorbar.xml
+uiconfig/modules/scalc/toolbar/drawbar.xml
+uiconfig/modules/scalc/toolbar/drawobjectbar.xml
+uiconfig/modules/scalc/toolbar/extrusionobjectbar.xml
+uiconfig/modules/scalc/toolbar/flowchartshapes.xml
+uiconfig/modules/scalc/toolbar/fontworkobjectbar.xml
+uiconfig/modules/scalc/toolbar/fontworkshapetype.xml
+uiconfig/modules/scalc/toolbar/formatobjectbar.xml
+uiconfig/modules/scalc/toolbar/formcontrols.xml
+uiconfig/modules/scalc/toolbar/formdesign.xml
+uiconfig/modules/scalc/toolbar/formsfilterbar.xml
+uiconfig/modules/scalc/toolbar/formsnavigationbar.xml
+uiconfig/modules/scalc/toolbar/formtextobjectbar.xml
+uiconfig/modules/scalc/toolbar/fullscreenbar.xml
+uiconfig/modules/scalc/toolbar/graffilterbar.xml
+uiconfig/modules/scalc/toolbar/graphicobjectbar.xml
+uiconfig/modules/scalc/toolbar/insertbar.xml
+uiconfig/modules/scalc/toolbar/insertcellsbar.xml
+uiconfig/modules/scalc/toolbar/mediaobjectbar.xml
+uiconfig/modules/scalc/toolbar/moreformcontrols.xml
+uiconfig/modules/scalc/toolbar/previewbar.xml
+uiconfig/modules/scalc/toolbar/standardbar.xml
+uiconfig/modules/scalc/toolbar/starshapes.xml
+uiconfig/modules/scalc/toolbar/symbolshapes.xml
+uiconfig/modules/scalc/toolbar/textobjectbar.xml
+uiconfig/modules/scalc/toolbar/toolbar.xml
+uiconfig/modules/scalc/toolbar/viewerbar.xml
+uiconfig/modules/sdraw/toolbar/3dobjectsbar.xml
+uiconfig/modules/sdraw/toolbar/alignmentbar.xml
+uiconfig/modules/sdraw/toolbar/arrowsbar.xml
+uiconfig/modules/sdraw/toolbar/arrowshapes.xml
+uiconfig/modules/sdraw/toolbar/basicshapes.xml
+uiconfig/modules/sdraw/toolbar/bezierobjectbar.xml
+uiconfig/modules/sdraw/toolbar/calloutshapes.xml
+uiconfig/modules/sdraw/toolbar/choosemodebar.xml
+uiconfig/modules/sdraw/toolbar/colorbar.xml
+uiconfig/modules/sdraw/toolbar/connectorsbar.xml
+uiconfig/modules/sdraw/toolbar/drawingobjectbar.xml
+uiconfig/modules/sdraw/toolbar/ellipsesbar.xml
+uiconfig/modules/sdraw/toolbar/extrusionobjectbar.xml
+uiconfig/modules/sdraw/toolbar/flowchartshapes.xml
+uiconfig/modules/sdraw/toolbar/fontworkobjectbar.xml
+uiconfig/modules/sdraw/toolbar/fontworkshapetype.xml
+uiconfig/modules/sdraw/toolbar/formcontrols.xml
+uiconfig/modules/sdraw/toolbar/formdesign.xml
+uiconfig/modules/sdraw/toolbar/formsfilterbar.xml
+uiconfig/modules/sdraw/toolbar/formsnavigationbar.xml
+uiconfig/modules/sdraw/toolbar/formtextobjectbar.xml
+uiconfig/modules/sdraw/toolbar/fullscreenbar.xml
+uiconfig/modules/sdraw/toolbar/gluepointsobjectbar.xml
+uiconfig/modules/sdraw/toolbar/graffilterbar.xml
+uiconfig/modules/sdraw/toolbar/graphicobjectbar.xml
+uiconfig/modules/sdraw/toolbar/insertbar.xml
+uiconfig/modules/sdraw/toolbar/linesbar.xml
+uiconfig/modules/sdraw/toolbar/masterviewtoolbar.xml
+uiconfig/modules/sdraw/toolbar/mediaobjectbar.xml
+uiconfig/modules/sdraw/toolbar/moreformcontrols.xml
+uiconfig/modules/sdraw/toolbar/optionsbar.xml
+uiconfig/modules/sdraw/toolbar/positionbar.xml
+uiconfig/modules/sdraw/toolbar/standardbar.xml
+uiconfig/modules/sdraw/toolbar/starshapes.xml
+uiconfig/modules/sdraw/toolbar/symbolshapes.xml
+uiconfig/modules/sdraw/toolbar/textbar.xml
+uiconfig/modules/sdraw/toolbar/textobjectbar.xml
+uiconfig/modules/sdraw/toolbar/toolbar.xml
+uiconfig/modules/sdraw/toolbar/viewerbar.xml
+uiconfig/modules/sdraw/toolbar/zoombar.xml
+uiconfig/modules/simpress/toolbar/3dobjectsbar.xml
+uiconfig/modules/simpress/toolbar/alignmentbar.xml
+uiconfig/modules/simpress/toolbar/arrowsbar.xml
+uiconfig/modules/simpress/toolbar/arrowshapes.xml
+uiconfig/modules/simpress/toolbar/basicshapes.xml
+uiconfig/modules/simpress/toolbar/bezierobjectbar.xml
+uiconfig/modules/simpress/toolbar/calloutshapes.xml
+uiconfig/modules/simpress/toolbar/choosemodebar.xml
+uiconfig/modules/simpress/toolbar/colorbar.xml
+uiconfig/modules/simpress/toolbar/commontaskbar.xml
+uiconfig/modules/simpress/toolbar/connectorsbar.xml
+uiconfig/modules/simpress/toolbar/drawingobjectbar.xml
+uiconfig/modules/simpress/toolbar/ellipsesbar.xml
+uiconfig/modules/simpress/toolbar/extrusionobjectbar.xml
+uiconfig/modules/simpress/toolbar/flowchartshapes.xml
+uiconfig/modules/simpress/toolbar/fontworkobjectbar.xml
+uiconfig/modules/simpress/toolbar/fontworkshapetype.xml
+uiconfig/modules/simpress/toolbar/formcontrols.xml
+uiconfig/modules/simpress/toolbar/formdesign.xml
+uiconfig/modules/simpress/toolbar/formsfilterbar.xml
+uiconfig/modules/simpress/toolbar/formsnavigationbar.xml
+uiconfig/modules/simpress/toolbar/formtextobjectbar.xml
+uiconfig/modules/simpress/toolbar/fullscreenbar.xml
+uiconfig/modules/simpress/toolbar/gluepointsobjectbar.xml
+uiconfig/modules/simpress/toolbar/graffilterbar.xml
+uiconfig/modules/simpress/toolbar/graphicobjectbar.xml
+uiconfig/modules/simpress/toolbar/insertbar.xml
+uiconfig/modules/simpress/toolbar/linesbar.xml
+uiconfig/modules/simpress/toolbar/masterviewtoolbar.xml
+uiconfig/modules/simpress/toolbar/mediaobjectbar.xml
+uiconfig/modules/simpress/toolbar/moreformcontrols.xml
+uiconfig/modules/simpress/toolbar/optionsbar.xml
+uiconfig/modules/simpress/toolbar/outlinetoolbar.xml
+uiconfig/modules/simpress/toolbar/positionbar.xml
+uiconfig/modules/simpress/toolbar/slideviewobjectbar.xml
+uiconfig/modules/simpress/toolbar/slideviewtoolbar.xml
+uiconfig/modules/simpress/toolbar/standardbar.xml
+uiconfig/modules/simpress/toolbar/starshapes.xml
+uiconfig/modules/simpress/toolbar/symbolshapes.xml
+uiconfig/modules/simpress/toolbar/textbar.xml
+uiconfig/modules/simpress/toolbar/textobjectbar.xml
+uiconfig/modules/simpress/toolbar/toolbar.xml
+uiconfig/modules/simpress/toolbar/viewerbar.xml
+uiconfig/modules/simpress/toolbar/zoombar.xml
+uiconfig/modules/sglobal/toolbar/alignmentbar.xml
+uiconfig/modules/sglobal/toolbar/arrowshapes.xml
+uiconfig/modules/sglobal/toolbar/basicshapes.xml
+uiconfig/modules/sglobal/toolbar/bezierobjectbar.xml
+uiconfig/modules/sglobal/toolbar/calloutshapes.xml
+uiconfig/modules/sglobal/toolbar/colorbar.xml
+uiconfig/modules/sglobal/toolbar/drawbar.xml
+uiconfig/modules/sglobal/toolbar/drawingobjectbar.xml
+uiconfig/modules/sglobal/toolbar/drawtextobjectbar.xml
+uiconfig/modules/sglobal/toolbar/extrusionobjectbar.xml
+uiconfig/modules/sglobal/toolbar/flowchartshapes.xml
+uiconfig/modules/sglobal/toolbar/fontworkobjectbar.xml
+uiconfig/modules/sglobal/toolbar/fontworkshapetype.xml
+uiconfig/modules/sglobal/toolbar/formcontrols.xml
+uiconfig/modules/sglobal/toolbar/formdesign.xml
+uiconfig/modules/sglobal/toolbar/formsfilterbar.xml
+uiconfig/modules/sglobal/toolbar/formsnavigationbar.xml
+uiconfig/modules/sglobal/toolbar/formtextobjectbar.xml
+uiconfig/modules/sglobal/toolbar/frameobjectbar.xml
+uiconfig/modules/sglobal/toolbar/fullscreenbar.xml
+uiconfig/modules/sglobal/toolbar/graffilterbar.xml
+uiconfig/modules/sglobal/toolbar/graphicobjectbar.xml
+uiconfig/modules/sglobal/toolbar/insertbar.xml
+uiconfig/modules/sglobal/toolbar/mediaobjectbar.xml
+uiconfig/modules/sglobal/toolbar/moreformcontrols.xml
+uiconfig/modules/sglobal/toolbar/numobjectbar.xml
+uiconfig/modules/sglobal/toolbar/oleobjectbar.xml
+uiconfig/modules/sglobal/toolbar/optimizetablebar.xml
+uiconfig/modules/sglobal/toolbar/previewobjectbar.xml
+uiconfig/modules/sglobal/toolbar/standardbar.xml
+uiconfig/modules/sglobal/toolbar/starshapes.xml
+uiconfig/modules/sglobal/toolbar/symbolshapes.xml
+uiconfig/modules/sglobal/toolbar/tableobjectbar.xml
+uiconfig/modules/sglobal/toolbar/textobjectbar.xml
+uiconfig/modules/sglobal/toolbar/toolbar.xml
+uiconfig/modules/sglobal/toolbar/viewerbar.xml
+uiconfig/modules/sweb/toolbar/arrowshapes.xml
+uiconfig/modules/sweb/toolbar/basicshapes.xml
+uiconfig/modules/sweb/toolbar/bezierobjectbar.xml
+uiconfig/modules/sweb/toolbar/calloutshapes.xml
+uiconfig/modules/sweb/toolbar/colorbar.xml
+uiconfig/modules/sweb/toolbar/drawingobjectbar.xml
+uiconfig/modules/sweb/toolbar/drawtextobjectbar.xml
+uiconfig/modules/sweb/toolbar/extrusionobjectbar.xml
+uiconfig/modules/sweb/toolbar/flowchartshapes.xml
+uiconfig/modules/sweb/toolbar/fontworkobjectbar.xml
+uiconfig/modules/sweb/toolbar/fontworkshapetype.xml
+uiconfig/modules/sweb/toolbar/formcontrols.xml
+uiconfig/modules/sweb/toolbar/formdesign.xml
+uiconfig/modules/sweb/toolbar/formsfilterbar.xml
+uiconfig/modules/sweb/toolbar/formsnavigationbar.xml
+uiconfig/modules/sweb/toolbar/formtextobjectbar.xml
+uiconfig/modules/sweb/toolbar/frameobjectbar.xml
+uiconfig/modules/sweb/toolbar/fullscreenbar.xml
+uiconfig/modules/sweb/toolbar/graffilterbar.xml
+uiconfig/modules/sweb/toolbar/graphicobjectbar.xml
+uiconfig/modules/sweb/toolbar/insertbar.xml
+uiconfig/modules/sweb/toolbar/mediaobjectbar.xml
+uiconfig/modules/sweb/toolbar/numobjectbar.xml
+uiconfig/modules/sweb/toolbar/oleobjectbar.xml
+uiconfig/modules/sweb/toolbar/optimizetablebar.xml
+uiconfig/modules/sweb/toolbar/previewobjectbar.xml
+uiconfig/modules/sweb/toolbar/standardbar.xml
+uiconfig/modules/sweb/toolbar/starshapes.xml
+uiconfig/modules/sweb/toolbar/symbolshapes.xml
+uiconfig/modules/sweb/toolbar/tableobjectbar.xml
+uiconfig/modules/sweb/toolbar/textobjectbar.xml
+uiconfig/modules/sweb/toolbar/toolbar.xml
+uiconfig/modules/sweb/toolbar/viewerbar.xml
+uiconfig/modules/swriter/toolbar/alignmentbar.xml
+uiconfig/modules/swriter/toolbar/arrowshapes.xml
+uiconfig/modules/swriter/toolbar/basicshapes.xml
+uiconfig/modules/swriter/toolbar/bezierobjectbar.xml
+uiconfig/modules/swriter/toolbar/calloutshapes.xml
+uiconfig/modules/swriter/toolbar/colorbar.xml
+uiconfig/modules/swriter/toolbar/drawbar.xml
+uiconfig/modules/swriter/toolbar/drawingobjectbar.xml
+uiconfig/modules/swriter/toolbar/drawtextobjectbar.xml
+uiconfig/modules/swriter/toolbar/extrusionobjectbar.xml
+uiconfig/modules/swriter/toolbar/flowchartshapes.xml
+uiconfig/modules/swriter/toolbar/fontworkobjectbar.xml
+uiconfig/modules/swriter/toolbar/fontworkshapetype.xml
+uiconfig/modules/swriter/toolbar/formcontrols.xml
+uiconfig/modules/swriter/toolbar/formdesign.xml
+uiconfig/modules/swriter/toolbar/formsfilterbar.xml
+uiconfig/modules/swriter/toolbar/formsnavigationbar.xml
+uiconfig/modules/swriter/toolbar/formtextobjectbar.xml
+uiconfig/modules/swriter/toolbar/frameobjectbar.xml
+uiconfig/modules/swriter/toolbar/fullscreenbar.xml
+uiconfig/modules/swriter/toolbar/graffilterbar.xml
+uiconfig/modules/swriter/toolbar/graphicobjectbar.xml
+uiconfig/modules/swriter/toolbar/insertbar.xml
+uiconfig/modules/swriter/toolbar/mediaobjectbar.xml
+uiconfig/modules/swriter/toolbar/moreformcontrols.xml
+uiconfig/modules/swriter/toolbar/numobjectbar.xml
+uiconfig/modules/swriter/toolbar/oleobjectbar.xml
+uiconfig/modules/swriter/toolbar/optimizetablebar.xml
+uiconfig/modules/swriter/toolbar/previewobjectbar.xml
+uiconfig/modules/swriter/toolbar/standardbar.xml
+uiconfig/modules/swriter/toolbar/starshapes.xml
+uiconfig/modules/swriter/toolbar/symbolshapes.xml
+uiconfig/modules/swriter/toolbar/tableobjectbar.xml
+uiconfig/modules/swriter/toolbar/textobjectbar.xml
+uiconfig/modules/swriter/toolbar/toolbar.xml
+uiconfig/modules/swriter/toolbar/viewerbar.xml
+
+-- ordered
+
+uiconfig/modules/BasicIDE/menubar/menubar.xml
+uiconfig/modules/StartModule/menubar/menubar.xml
+uiconfig/modules/schart/menubar/menubar.xml
+uiconfig/modules/scalc/menubar/menubar.xml
+uiconfig/modules/sdraw/menubar/menubar.xml
+uiconfig/modules/simpress/menubar/menubar.xml
+uiconfig/modules/sglobal/menubar/menubar.xml
+uiconfig/modules/sweb/menubar/menubar.xml
+uiconfig/modules/swriter/menubar/menubar.xml
+
+-- ordered small
diff --git packimages/pack/makefile.mk packimages/pack/makefile.mk
index c58900d..86a828d 100644
--- packimages/pack/makefile.mk
+++ packimages/pack/makefile.mk
@@ -41,21 +41,34 @@ RSCCUSTOMIMG*=$(PRJ)
 IMAGES := $(COMMONBIN)$/images.zip
 SORTED_LIST=$(RES)$/img$/sorted.lst
 # Custom sets, at 24x24 & 16x16 fall-back to industrial preferentially
+.IF "$(OOo4Kids)"!="YES"
+IMAGE_SORT_LIST=image-sort.lst
 CUSTOM_IMAGE_SETS=hicontrast industrial crystal tango classic
+.ELSE
+IMAGE_SORT_LIST=image-OOo4Kids-sort.lst
+CUSTOM_IMAGE_SETS=crystal
+.ENDIF
+
 CUSTOM_IMAGES+=$(foreach,i,$(CUSTOM_IMAGE_SETS) images_$i)
+
+.IF "$(OOo4Kids)"!="YES"
 CUSTOM_PREFERRED_FALLBACK_1*=-c $(SOLARSRC)$/ooo_custom_images$/tango
 CUSTOM_PREFERRED_FALLBACK_2*=-c $(SOLARSRC)$/ooo_custom_images$/industrial
+.ENDIF
 
 CRYSTAL_TARBALL=$(SOLARSRC)$/external_images$/ooo_crystal_images-1.tar.gz
+
+.IF "$(OOo4Kids)"!="YES"
 CLASSIC_TARBALL=$(SOLARSRC)$/ooo_custom_images$/classic/classic_images.tar.gz
+.ENDIF
 
 ALLTAR : $(IMAGES) $(CUSTOM_IMAGES) $(COMMONBIN)$/images_brand.zip
 
 $(IMAGES) $(CUSTOM_IMAGES) : $(SORTED_LIST)
 
-$(SORTED_LIST) : image-sort.lst
+$(SORTED_LIST) : $(IMAGE_SORT_LIST)
     +-$(MKDIR) $(RES)$/img
-    +$(PERL) $(SOLARENV)$/bin$/image-sort.pl image-sort.lst $(SOLARXMLDIR) $@
+    +$(PERL) $(SOLARENV)$/bin$/image-sort.pl $(IMAGE_SORT_LIST) $(SOLARXMLDIR) $@
 
 $(RES)$/img$/commandimagelist.ilst .PHONY : $(SORTED_LIST)
     @@-$(MKDIR) $(RES)$/img
@@ -89,18 +102,21 @@ $(MISC)$/crystal.flag : $(CRYSTAL_TARBALL)
 .ENDIF
     @$(TYPE) $@ || echo "ERROR: unpacking $(CRYSTAL_TARBALL) failed"
 
-# unpack the classic icon set
+.IF "$(OOo4Kids)"!="YES"
+ unpack the classic icon set
 $(MISC)$/classic.flag : $(CLASSIC_TARBALL)
     cd $(MISC) && gunzip -c $(CLASSIC_TARBALL) | ( tar -xf - ) && $(TOUCH) $(@:f)
 .IF "$(GUI)"=="UNX"
     chmod -R g+w $(MISC)$/classic
 .ENDIF
     @$(TYPE) $@ || echo "ERROR: unpacking $(CLASSIC_TARBALL) failed"
+.ENDIF
 
 # dependencies
-images_hicontrast : $(MISC)$/hicontrast.flag $(RES)$/img$/commandimagelist.ilst
 
 images_crystal : $(MISC)$/crystal.flag $(RES)$/img$/commandimagelist.ilst
 
+.IF "$(OOo4Kids)"!="YES"
+images_hicontrast : $(MISC)$/hicontrast.flag $(RES)$/img$/commandimagelist.ilst
 images_classic : $(MISC)$/classic.flag $(RES)$/img$/commandimagelist.ilst
-
+.ENDIF
diff --git postprocess/packconfig/macosx/macosx_menubar_modification.xsl postprocess/packconfig/macosx/macosx_menubar_modification.xsl
index 91c1d6f..951f75d 100644
--- postprocess/packconfig/macosx/macosx_menubar_modification.xsl
+++ postprocess/packconfig/macosx/macosx_menubar_modification.xsl
@@ -23,4 +23,7 @@
   <!-- suppression of the OptionsTreeDialog item -->
   <xsl:template match="menu:menuitem[@menu:id='.uno:OptionsTreeDialog']"/>
 
+  <!-- suppression of the ShowLicense item -->
+  <xsl:template match="menu:menuitem[@menu:id='.uno:ShowLicense']"/>
+
 </xsl:stylesheet>
diff --git postprocess/rebase/makefile.mk postprocess/rebase/makefile.mk
index 84c8ce8..7f535da 100755
--- postprocess/rebase/makefile.mk
+++ postprocess/rebase/makefile.mk
@@ -49,7 +49,9 @@ ALLTAR : REBASE
 
 REBASE .PHONY : $(BASEADDRESSES)
 .IF "$(GUI)"=="WNT"
-.IF "$(product)"=="full"
+
+# hack to allow OOo4Kids packaging
+.IF "$(product)"=="OOo4Kids_full"
     $(PERL) rebase.pl -C $(BASEADDRESSES) -b $(STARTADDRESS) -d -e 10000 -l $(LOGFILE) -m $(MISC) -v -R $(SOLARBINDIR) -N $(EXCLUDELIST) $(IMAGENAMES)
 .ELSE	# "$(product)"=="full"
     @echo Doing nothing on non product builds ...
diff --git qadevOOo/makefile.mk qadevOOo/makefile.mk
index b6f816f..dd58bfc 100755
--- qadevOOo/makefile.mk
+++ qadevOOo/makefile.mk
@@ -41,7 +41,14 @@ PRJ=.
 debug=true
 # ------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
+
 .INCLUDE : ant.mk
+
+
 TST:
     echo $(SOLAR_JAVA)
 
diff --git qadevOOo/runner/makefile.mk qadevOOo/runner/makefile.mk
index 986111b..08ff21f 100644
--- qadevOOo/runner/makefile.mk
+++ qadevOOo/runner/makefile.mk
@@ -34,6 +34,11 @@ TARGET  = $(PRJNAME)
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummmy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE: settings.mk
 
 SUBDIRS_TESTS = mod ifc complex
diff --git readlicense_oo/docs/readme/makefile.mk readlicense_oo/docs/readme/makefile.mk
index d55f1cb..c57ca90 100755
--- readlicense_oo/docs/readme/makefile.mk
+++ readlicense_oo/docs/readme/makefile.mk
@@ -40,9 +40,14 @@ TARGET  = ooo
 #SOLAR_JAVA=
 # --- Files --------------------------------------------------------
 
+#.IF "$(OOo4Kids)"=="YES"
+#READMEFILES = \
+#    $(MISC)$/readme_OOo4Kids.html \
+#    $(MISC)$/readme_OOo4Kids.txt
+#.ELSE
 READMEFILES = \
     $(MISC)$/readme.html \
     $(MISC)$/readme.txt
-
+#.ENDIF
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git readlicense_oo/docs/readme/readme_OOo4Kids.xrm readlicense_oo/docs/readme/readme_OOo4Kids.xrm
new file mode 100644
index 0000000..6bd285b
--- /dev/null
+++ readlicense_oo/docs/readme/readme_OOo4Kids.xrm
@@ -0,0 +1,300 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE Readme SYSTEM "../readme.dtd"><!-- A paragraph id has to be unique within one section -->
+<Readme name="ooo_readme" col-span="0">
+
+    <Section id="Welcome"> <!-- ALL PLATFORMS -->
+    
+        <Paragraph id="Welcome" style="H1">
+            <Text id="a" xml:lang="en-US">Welcome</Text>
+        </Paragraph>
+
+        <Paragraph id="ReadMeTitle" style="H1">
+            <Text id="a" xml:lang="en-US">${PRODUCTNAME} ${PRODUCTVERSION} ReadMe</Text>
+        </Paragraph>
+
+        <Paragraph id="LaterstUpdates">
+            <Text id="a" xml:lang="en-US" url="ahead">For latest updates to this readme file, see </Text>
+            <Text id="b" xml:lang="en-US" url="true">http://wiki.OOo4Kids.org/welcome/readme.html</Text>
+        </Paragraph>
+
+        <Paragraph id="A5">
+            <Text id="c" xml:lang="en-US">Dear User</Text>
+        </Paragraph>
+
+        <Paragraph id="A6">
+            <Text id="d" xml:lang="en-US">This file contains important information about this program. Please read this information very carefully before starting work.</Text>
+        </Paragraph>
+
+        <Paragraph id="A7">
+            <Text id="a" xml:lang="en-US" url="ahead">The OOo4Kids.org Community, responsible for the development of this product, would like to invite you to participate as a community member. As a new user, you can check out the ${PRODUCTNAME} site with helpful user information at </Text>
+        </Paragraph>
+
+        <Paragraph id="A9">
+            <Text id="empty" xml:lang="en-US"/>
+            <Text id="c" xml:lang="en-US">Also read the sections below about getting involved in the OOo4Kids.org project. </Text>
+        </Paragraph>
+
+        <Paragraph id="A10" style="H3">
+            <Text id="c" xml:lang="en-US">Is ${PRODUCTNAME} really free for any user? </Text>
+        </Paragraph>
+
+        <Paragraph id="A11">
+            <Text id="empty" xml:lang="en-US"/>
+            <Text id="a" xml:lang="en-US" url="ahead">${PRODUCTNAME} is free for use by everybody. You may take this copy of ${PRODUCTNAME} and install it on as many computers as you like, and use it for any purpose you like (including commercial, government, public administration and educational use). For further details see the license text delivered together with ${PRODUCTNAME} or </Text>
+            <Text id="b" xml:lang="en-US" url="true">http://www.OOo4Kids.org/license.html </Text>
+            <Text id="d" xml:lang="en-US"></Text>
+        </Paragraph>
+    
+        <Paragraph id="A12" style="H3">
+            <Text id="A12a" xml:lang="en-US">Why is ${PRODUCTNAME} free for any user?</Text> 
+        </Paragraph>
+        
+        <Paragraph id="A13">
+          <Text id="empty" xml:lang="en-US"/>
+            <Text id="A13a" xml:lang="en-US">
+            You can use this copy of ${PRODUCTNAME} today free of charge because individual contributors and corporate sponsors have designed, developed, tested, translated, documented, supported, marketed, and helped in many other ways to make ${PRODUCTNAME} what it is today - the world's leading open-source office software.</Text>
+            <Text id="A13b" xml:lang="en-US" url="ahead">If you appreciate their efforts, and would like to ensure OOo4Kids.org continues into the future, please consider contributing to the project - see </Text>
+            <Text id="A13c" xml:lang="en-US" url="true">http://contributing.OOo4Kids.org</Text>
+            <Text id="A13d" xml:lang="en-US"> for details. Everyone has a contribution to make.</Text>
+        </Paragraph> 
+        
+    </Section>
+
+    <Section id="Installation">
+
+        <Paragraph id="Header" style="H2">
+            <Text id="rr3fgf42r" xml:lang="en-US">Notes on Installation</Text>
+        </Paragraph>
+
+        <Paragraph id="All">
+            <Text id="sdfsdfgf42r" xml:lang="en-US">System Requirements:</Text>
+        </Paragraph>
+
+            <Paragraph id="MacX_INTEL" os="MACOSX" cpuname="INTEL"><!-- MAC -->
+            <List>
+                <Text id="macxiOSX" xml:lang="en-US">MacOSX 10.4 (Tiger) or higher</Text>
+                <Text id="macxicpu" xml:lang="en-US">Intel processor</Text>
+                <Text id="macxiRAM" xml:lang="en-US">256 MB RAM</Text>
+                <Text id="macxHardDiksSpace" xml:lang="en-US">300 MB available hard disk space</Text>
+                <Text id="macxivideo" xml:lang="en-US">1024 x 768 graphic device with 256 colors (higher resolution recommended)</Text>
+            </List>
+        </Paragraph>
+        
+        <Paragraph id="WNT2" os="WNT"><!-- WINDOWS -->
+            <List>
+                <Text id="s2s3sdf2" xml:lang="en-US">Microsoft Windows 2000 (Service Pack 4 or higher), XP, or Vista</Text>
+                <Text id="utzu6" xml:lang="en-US">Pentium compatible PC (Pentium III or Athlon recommended)</Text>
+                <Text id="ghuj67" xml:lang="en-US">256 MB RAM (512 MB RAM recommended)</Text>
+                <Text id="jzjtzu6" xml:lang="en-US">300 MB available hard disk space</Text>
+                <Text id="jtzu56" xml:lang="en-US">1024x768 resolution (higher resolution recommended), at least 256 colors</Text>
+            </List>
+        </Paragraph>
+        <Paragraph id="Linuxi2" os="LINUX" cpuname="INTEL"><!-- LINUX -->
+            <List>
+                <Text id="s2we35" xml:lang="en-US">Linux Kernel version 2.4 or higher</Text>
+                <Text id="s253we" xml:lang="en-US">glibc2 version 2.3.2 or higher</Text>
+                <Text id="s256we" xml:lang="en-US">gtk version 2.2.0 or higher</Text>
+                <Text id="s2etfseg" xml:lang="en-US">Pentium compatible PC (Pentium III or Athlon recommended)</Text>
+                <Text id="s2ssdfe" xml:lang="en-US">256 MB RAM (512 MB RAM recommended)</Text>
+                <Text id="n42dfgf" xml:lang="en-US">300 MB available hard disk space</Text>
+                <Text id="ghjhhr" xml:lang="en-US">X Server with 1024x768 resolution (higher resolution recommended), with at least 256 colors</Text>
+                <Text id="fhrtz5" xml:lang="en-US">Window Manager</Text>
+            </List>
+        </Paragraph>
+        
+        <Paragraph id="Linuxi3" os="LINUX">
+            <Text id="Linuxi3a" xml:lang="en-US">There is a wide variety of Linux distributions, and even within the same distribution there may be different installation options (KDE vs Gnome, etc.). Some distributions ship with their own native version of ${PRODUCTNAME}, which may have different features from this Community ${PRODUCTNAME}. Sometimes you can install the Community ${PRODUCTNAME} alongside the native version. However, its usually safer to remove the native version before installing this Community version. Consult the documentation for your distribution for details of how to do this. </Text>
+        </Paragraph>
+        
+        <Paragraph id="Linuxi4" os="LINUX">
+            <Text id="Linuxi4a" xml:lang="en-US">It is recommended that you always backup your system before you remove or install software.</Text>
+        </Paragraph>
+        
+        
+        <Paragraph id="DLLA" os="WNT">
+            <Text id="DLLA1" xml:lang="en-US" url="ahead">If you perform an administrative installation using setup /a, you need to make sure that the file msvc90.dll is installed on the system. This file is required for ${PRODUCTNAME} to start after an administrative installation. You can get the file from </Text>
+            <Text id="DLLA2" xml:lang="en-US" url="true">http://www.microsoft.com/downloads/details.aspx?familyid=9B2DA534-3E03-4391-8A4D-074B9F2BC1BF </Text>
+            <Text id="DLLA3" xml:lang="en-US"></Text>
+        </Paragraph>
+        
+        <Paragraph id="StartupProblemsHeader" style="H3" os="all">
+            <Text id="naso" xml:lang="en-US">Problems During Program Startup</Text>
+        </Paragraph>
+
+        <Paragraph id="GnomeStartupProblems" os="LINUX">
+            <Text id="naso2" xml:lang="en-US">If you experience ${PRODUCTNAME} startup problems (most notably while using Gnome) please &apos;unset&apos; the SESSION_MANAGER environment variable inside the shell you use to start ${PRODUCTNAME}. This can be done by adding the line &quot;unset SESSION_MANAGER&quot; to the beginning of the soffice shell script found in the &quot;[office folder]/program&quot; directory.</Text>
+        </Paragraph>
+
+        <Paragraph id="GraphicsCardDriverWIN" os="WNT">
+            <Text id="abcdef" xml:lang="en-US">Difficulties starting ${PRODUCTNAME} (e.g. applications hang) as well as problems with the screen display are often caused by the graphics card driver. If these problems occur, please update your graphics card driver or try using the graphics driver delivered with your operating system. Difficulties displaying 3D objects can often be solved by deactivating the option &quot;Use OpenGL&quot; under &apos;Tools - Options - ${PRODUCTNAME} - View - 3D view&apos;.</Text>
+        </Paragraph>
+
+        <Paragraph id="GraphicsCardDriver" os="LINUX">
+            <Text id="abcdef" xml:lang="en-US">Difficulties starting ${PRODUCTNAME} (e.g. applications hang) as well as problems with the screen display are often caused by the graphics card driver. If these problems occur, please update your graphics card driver or try using the graphics driver delivered with your operating system. Difficulties displaying 3D objects can often be solved by deactivating the option &quot;Use OpenGL&quot; under &apos;Tools - Options - ${PRODUCTNAME} - View - 3D view&apos;.</Text>
+        </Paragraph>
+        
+        <Paragraph id="CopyProblem">
+            <Text id="CopyProblemsV1toV2" xml:lang="en-US">Please note that copy and paste via clipboard between ${PRODUCTNAME} 1.x and ${PRODUCTNAME} ${PRODUCTVERSION} might not work in OOo4Kids.org format. If that happens, choose &apos;Edit - Paste Special&apos; and choose a format other than ${PRODUCTNAME}, or open the document in ${PRODUCTNAME} ${PRODUCTVERSION} directly.</Text>
+        </Paragraph>
+
+        <Paragraph id="GlobalPrecautions">
+            <Text id="Precautions" xml:lang="en-US">Please make sure you have enough free memory in the temporary directory on your system and that read, write and run access rights have been granted. Close all other programs before starting the installation.</Text>
+        </Paragraph>
+
+        <Paragraph id="AdminNeededWIN" os="WNT">
+            <Text id="AdminNeeded" xml:lang="en-US">Note: Please be aware that administrator rights are needed for the installation process.</Text>
+        </Paragraph>
+    
+        </Section>
+
+    <Section id="Scroll">
+
+        <Paragraph id="F1a" style="H3" gui="WNT">
+            <Text id="naso" xml:lang="en-US">ALPS/Synaptics notebook touchpads in Windows</Text>
+        </Paragraph>
+
+        <Paragraph id="F1b" gui="WNT">
+            <Text id="naso2" xml:lang="en-US">Due to a Windows driver issue, you cannot scroll through ${PRODUCTNAME} documents when you slide your finger across an ALPS/Synaptics touchpad.</Text>
+        </Paragraph>
+
+        <Paragraph id="F1c" gui="WNT">
+            <Text id="naso2" xml:lang="en-US">To enable touchpad scrolling, add the following lines to the &quot;C:\Program Files\Synaptics\SynTP\SynTPEnh.ini&quot; configuration file, and restart your computer:</Text>
+        </Paragraph>
+
+        <Paragraph id="F1d" gui="WNT">
+            <Text id="naso2" xml:lang="en-US">[${PRODUCTNAME}]</Text>
+            <Text id="naso3" xml:lang="en-US">FC = &quot;SALFRAME&quot;</Text>
+            <Text id="naso4" xml:lang="en-US">SF = 0x10000000</Text>
+            <Text id="naso5" xml:lang="en-US">SF |= 0x00004000</Text>
+        </Paragraph>
+
+        <Paragraph id="F1e" gui="WNT">
+            <Text id="naso2" xml:lang="en-US">Note: The location of the configuration file might vary on different versions of Windows.</Text>
+        </Paragraph>
+    </Section>
+
+    <Section id="Keyboard">
+
+        <Paragraph id="abc2" style="H3">
+            <Text id="awe1" xml:lang="en-US">Shortcut Keys</Text>
+        </Paragraph>
+
+        <Paragraph id="abc12">
+            <Text id="w32e1" xml:lang="en-US">Only shortcut keys (key combinations) not used by the operating system can be used in ${PRODUCTNAME}. If a key combination in ${PRODUCTNAME} does not work as described in the ${PRODUCTNAME} Help, check if that shortcut is already used by the operating system. To rectify such conflicts, you can change the keys assigned by your operating system. Alternatively, you can change almost any key assignment in ${PRODUCTNAME}. For more information on this topic, refer to the ${PRODUCTNAME} Help or the Help documentation of your operating system.</Text>
+        </Paragraph>
+
+        <Paragraph id="MACKeysBETA" os="MACOSX">
+            <Text id="mackeys1" xml:lang="en-US">The application help of ${PRODUCTNAME} may use shortcut combinations for PC keyboards only.</Text>
+        </Paragraph>
+        
+        <Paragraph id="KeysChanged">
+            <Text id="KeysChanged1" xml:lang="en-US">Due to a conflict with input method switching on multiple platforms, the following shortcut keys required to be changed at last minute:</Text>
+        </Paragraph>
+        
+        <Paragraph id="KeysChangedMAC" os="MACOSX">
+            <List>
+                <Text id="KeysChangedMAC2" xml:lang="en-US">Cmd-Space is now Cmd-Shift-Space</Text>
+                <Text id="KeysChangedMAC3" xml:lang="en-US">Cmd-Shift-Space is now Cmd-M</Text>
+            </List>
+        </Paragraph>
+        
+        <Paragraph id="KeysChangedWNT" os="WNT">
+            <List>
+                <Text id="KeysChangedWNT2" xml:lang="en-US">Ctrl-Space is now Ctrl-Shift-Space</Text>
+                <Text id="KeysChangedWNT3" xml:lang="en-US">Ctrl-Shift-Space is now Ctrl-M</Text>
+            </List>
+        </Paragraph>
+        
+        <Paragraph id="KeysChangedLIN" os="LINUX">
+            <List>
+                <Text id="KeysChangedLIN2" xml:lang="en-US">Ctrl-Space is now Ctrl-Shift-Space</Text>
+                <Text id="KeysChangedLIN" xml:lang="en-US">Ctrl-Shift-Space is now Ctrl-M</Text>
+            </List>
+        </Paragraph>
+        
+        <Paragraph id="KeysChangedSOL" os="SOLARIS">
+            <List>
+                <Text id="KeysChangedSOL2" xml:lang="en-US">Ctrl-Space is now Ctrl-Shift-Space</Text>
+                <Text id="KeysChangedSOL3" xml:lang="en-US">Ctrl-Shift-Space is now Ctrl-M</Text>
+            </List>
+        </Paragraph>
+        
+    </Section>
+
+    <Section id="FileLocking">
+
+        <Paragraph id="G1" style="H3" gui="UNX">
+            <Text id="gfh6w" xml:lang="en-US">File Locking</Text>
+        </Paragraph>
+
+        <Paragraph id="G2" gui="UNX">
+            <Text id="pji76w" xml:lang="en-US">In the default setting, file locking is turned on in ${PRODUCTNAME}. To deactivate it, you have to set the appropriate environment variables SAL_ENABLE_FILE_LOCKING=0 and export SAL_ENABLE_FILE_LOCKING. These entries are already in enabled form in the soffice script file.</Text>
+        </Paragraph>
+
+        <Paragraph id="G3" gui="UNX">
+            <Text id="pji76wsdf" xml:lang="en-US">Warning: The activated file locking feature can cause problems with Solaris 2.5.1 and 2.7 used in conjunction with Linux NFS 2.0. If your system environment has these parameters, we strongly recommend that you avoid using the file locking feature. Otherwise, ${PRODUCTNAME} will hang when you try to open a file from a NFS mounted directory from a Linux computer.</Text>
+        </Paragraph>
+    </Section>
+
+    <Section id="Mapi">
+
+        <Paragraph id="G1a" style="H3" gui="WNT">
+            <Text id="gfh6w" xml:lang="en-US">Problems When Sending Documents as E-mails From ${PRODUCTNAME}</Text>
+        </Paragraph>
+
+        <Paragraph id="G2a" gui="WNT">
+            <Text id="pji76w" xml:lang="en-US">When sending a document via &apos;File - Send - Document as E-mail&apos; or &apos;Document as PDF Attachment&apos; problems might occur (program crashes or hangs). This is due to the Windows system file &quot;Mapi&quot; (Messaging Application Programming Interface) which causes problems in some file versions. Unfortunately, the problem cannot be narrowed down to a certain version number. For more information visit http://www.microsoft.com to search the Microsoft Knowledge Base for &quot;mapi dll&quot;.</Text>
+        </Paragraph>
+    </Section>
+
+    <Section id="UserSupport"> <!-- ALL PLATFORMS -->
+
+        <Paragraph id="A1" style="H2">
+            <Text id="a" xml:lang="en-US">User Support</Text>
+        </Paragraph>
+
+        <Paragraph id="A2">
+            <Text id="a" xml:lang="en-US" url="ahead">The main support page </Text>
+            <Text id="b" xml:lang="en-US" url="true">http://wiki.OOo4Kids.org/</Text>
+            <Text id="c" xml:lang="en-US" url="ahead">offers various possibilities for help with ${PRODUCTNAME}. Your question may have already been answered - check the Community Forum.</Text>
+            <Text id="d" xml:lang="en-US" url="true">http://wiki.OOo4Kids.org</Text>
+            <Text id="k" xml:lang="en-US">.</Text>
+        </Paragraph>
+
+        <Paragraph id="A3">
+            <Text id="a" xml:lang="en-US" url="ahead">Also check the FAQ section at </Text>
+            <Text id="b" xml:lang="en-US" url="true">http://wiki.OOo4Kids.org/FAQ</Text>
+            <Text id="c" xml:lang="en-US">.</Text>
+        </Paragraph>
+    </Section>
+
+    
+    <Section id="Credits"> <!-- ALL PLATFORMS -->
+
+        <Paragraph id="emptyparagraph" localized="false" />
+
+        <Paragraph id="A1">
+            <Text id="a" xml:lang="en-US">We hope you enjoy working with the new ${PRODUCTNAME} ${PRODUCTVERSION} and will join us online.</Text>
+        </Paragraph>
+
+        <Paragraph id="A2">
+            <Text id="a" xml:lang="en-US">The OOo4Kids.org Community</Text>
+        </Paragraph>
+
+        <Paragraph id="A3" localized="false">
+            <Text id="a" xml:lang="en-US" />
+            <Text id="b" xml:lang="en-US" />
+        </Paragraph>
+    </Section>
+
+    <Section id="ModifiedSourceCode"> <!-- ALL PLATFORMS -->
+
+        <Paragraph id="HH1" style="H2">
+            <Text id="sdffd23r3cefwefew" xml:lang="en-US">Used / Modified Source Code</Text>
+        </Paragraph>
+
+        <Paragraph id="HH2">
+            <Text id="sdffd23red32efew" xml:lang="en-US">Portions Copyright 1998, 1999 James Clark. Portions Copyright 1996, 1998 Netscape Communications Corporation.</Text>
+        </Paragraph>
+    </Section>
+</Readme>
diff --git readlicense_oo/html/THIRDPARTYLICENSEREADME.html readlicense_oo/html/THIRDPARTYLICENSEREADME.html
index 9e141af..8af62a4 100644
--- readlicense_oo/html/THIRDPARTYLICENSEREADME.html
+++ readlicense_oo/html/THIRDPARTYLICENSEREADME.html
@@ -4364,6 +4364,34 @@ is governed by the terms of the license below:<br>
   </html>
 <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
 <html>
+<body>
+<hr style="width: 100%; height: 2px;">The following software may be
+included in this product: NeoLight 1.1.x; Use of any of this software
+is governed by the terms of the license below:<br>
+<h2>Planamesa, Inc.<br>
+</h2>
+<h3>NeoLight<br>
+</h3>
+<br>
+<a href="#lgpl">jump to GNU Lesser General Public License</a><br>
+  </body>
+  </html>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
+<html>
+<body>
+<hr style="width: 100%; height: 2px;">The following software may be
+included in this product: NeoLight 1.1.x; Use of any of this software
+is governed by the terms of the license below:<br>
+<h2>Planamesa, Inc.<br>
+</h2>
+<h3>NeoLight<br>
+</h3>
+<br>
+<a href="#lgpl">jump to GNU Lesser General Public License</a><br>
+  </body>
+  </html>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
+<html>
 <head>
 </head>
 <body>
diff --git readlicense_oo/source/license/license_en-US.html readlicense_oo/source/license/license_en-US.html
index 58ff877..bbb4165 100644
--- readlicense_oo/source/license/license_en-US.html
+++ readlicense_oo/source/license/license_en-US.html
@@ -1,37 +1,36 @@
-<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
-<html>
-<head>
-  <meta http-equiv="CONTENT-TYPE"
- content="text/html; charset=iso-8859-1">
-  <title></title>
-</head>
-<body lang="en-US">
-<h1>(License text)</h1>
-<p>This product is made available subject to the terms of GNU Lesser
-General Public License Version 3. A copy of the LGPL license can be
-found at http://www.openoffice.org/license.html<br>
-</p>
-<hr>
-<p>Third Party Code Additional copyright notices and license
-terms applicable to portions of the Software are set forth
-in the THIRDPARTYLICENSEREADME.html file.</p>
-<hr>
-<p>All trademarks and registered trademarks mentioned herein are the
-property of their respective owners.</p>
-<hr>
-<p>Copyright 2002-2008 Sun Microsystems, Inc.</p>
-<p>This product has been created with contributions from the
-OpenOffice.org community, of which Sun Microsystems Inc. is the
-founding member. OpenOffice.org acknowledges all community members,
-especially those mentioned at
-http://www.openoffice.org/welcome/credits.html.</p>
-<hr>
-<pre>
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
+<HTML>
+<HEAD>
+    <META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
+    <TITLE></TITLE>
+    <META NAME="GENERATOR" CONTENT="OOo4Kids 0.5  (Unix)">
+    <META NAME="CREATED" CONTENT="0;0">
+    <META NAME="CHANGED" CONTENT="0;0">
+    <STYLE TYPE="text/css">
+    <!--
+        @page { margin: 2cm }
+        P { margin-bottom: 0.21cm }
+    -->
+    </STYLE>
+</HEAD>
+<BODY LANG="fr-FR" DIR="LTR">
+<PRE>This product is made available subject to the terms of GNU Lesser General Public License Version 3. A copy of the LGPL license can be found at http://www.ooo4kids.org/license.html
+
+------------------------------------
+
+All trademarks and registered trademarks mentioned herein are the property of their respective owners.  
+
+------------------------------------
+Copyright 2009 EducOOo  ( http://www.educoo.org )
+
+This product has been created with contributions from the OOo4Kids community
+
+------------------------------------
 
 		   GNU LESSER GENERAL PUBLIC LICENSE
                        Version 3, 29 June 2007
 
- Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>
+ Copyright (C) 2007 Free Software Foundation, Inc. &lt;http://fsf.org/&gt;
  Everyone is permitted to copy and distribute verbatim copies
  of this license document, but changing it is not allowed.
 
@@ -42,29 +41,29 @@ License, supplemented by the additional permissions listed below.
 
   0. Additional Definitions. 
 
-  As used herein, "this License" refers to version 3 of the GNU Lesser
-General Public License, and the "GNU GPL" refers to version 3 of the GNU
+  As used herein, &quot;this License&quot; refers to version 3 of the GNU Lesser
+General Public License, and the &quot;GNU GPL&quot; refers to version 3 of the GNU
 General Public License.
 
-  "The Library" refers to a covered work governed by this License,
+  &quot;The Library&quot; refers to a covered work governed by this License,
 other than an Application or a Combined Work as defined below.
 
-  An "Application" is any work that makes use of an interface provided
+  An &quot;Application&quot; is any work that makes use of an interface provided
 by the Library, but which is not otherwise based on the Library.
 Defining a subclass of a class defined by the Library is deemed a mode
 of using an interface provided by the Library.
 
-  A "Combined Work" is a work produced by combining or linking an
+  A &quot;Combined Work&quot; is a work produced by combining or linking an
 Application with the Library.  The particular version of the Library
-with which the Combined Work was made is also called the "Linked
-Version".
+with which the Combined Work was made is also called the &quot;Linked
+Version&quot;.
 
-  The "Minimal Corresponding Source" for a Combined Work means the
+  The &quot;Minimal Corresponding Source&quot; for a Combined Work means the
 Corresponding Source for the Combined Work, excluding any source code
 for portions of the Combined Work that, considered in isolation, are
 based on the Application, and not on the Linked Version.
 
-  The "Corresponding Application Code" for a Combined Work means the
+  The &quot;Corresponding Application Code&quot; for a Combined Work means the
 object code and/or source code for the Application, including any data
 and utility programs needed for reproducing the Combined Work from the
 Application, but excluding the System Libraries of the Combined Work.
@@ -180,7 +179,7 @@ differ in detail to address new problems or concerns.
 
   Each version is given a distinguishing version number. If the
 Library as you received it specifies that a certain numbered version
-of the GNU Lesser General Public License "or any later version"
+of the GNU Lesser General Public License &quot;or any later version&quot;
 applies to it, you have the option of following the terms and
 conditions either of that published version or of any later version
 published by the Free Software Foundation. If the Library as you
@@ -195,10 +194,11 @@ permanent authorization for you to choose that version for the
 Library.
 
 
+
                     GNU GENERAL PUBLIC LICENSE
                        Version 3, 29 June 2007
 
- Copyright (C) 2007 Free Software Foundation, Inc. <http://fsf.org/>
+ Copyright (C) 2007 Free Software Foundation, Inc. &lt;http://fsf.org/&gt;
  Everyone is permitted to copy and distribute verbatim copies
  of this license document, but changing it is not allowed.
 
@@ -269,35 +269,35 @@ modification follow.
 
   0. Definitions.
 
-  "This License" refers to version 3 of the GNU General Public License.
+  &quot;This License&quot; refers to version 3 of the GNU General Public License.
 
-  "Copyright" also means copyright-like laws that apply to other kinds of
+  &quot;Copyright&quot; also means copyright-like laws that apply to other kinds of
 works, such as semiconductor masks.
 
-  "The Program" refers to any copyrightable work licensed under this
-License.  Each licensee is addressed as "you".  "Licensees" and
-"recipients" may be individuals or organizations.
+  &quot;The Program&quot; refers to any copyrightable work licensed under this
+License.  Each licensee is addressed as &quot;you&quot;.  &quot;Licensees&quot; and
+&quot;recipients&quot; may be individuals or organizations.
 
-  To "modify" a work means to copy from or adapt all or part of the work
+  To &quot;modify&quot; a work means to copy from or adapt all or part of the work
 in a fashion requiring copyright permission, other than the making of an
-exact copy.  The resulting work is called a "modified version" of the
-earlier work or a work "based on" the earlier work.
+exact copy.  The resulting work is called a &quot;modified version&quot; of the
+earlier work or a work &quot;based on&quot; the earlier work.
 
-  A "covered work" means either the unmodified Program or a work based
+  A &quot;covered work&quot; means either the unmodified Program or a work based
 on the Program.
 
-  To "propagate" a work means to do anything with it that, without
+  To &quot;propagate&quot; a work means to do anything with it that, without
 permission, would make you directly or secondarily liable for
 infringement under applicable copyright law, except executing it on a
 computer or modifying a private copy.  Propagation includes copying,
 distribution (with or without modification), making available to the
 public, and in some countries other activities as well.
 
-  To "convey" a work means any kind of propagation that enables other
+  To &quot;convey&quot; a work means any kind of propagation that enables other
 parties to make or receive copies.  Mere interaction with a user through
 a computer network, with no transfer of a copy, is not conveying.
 
-  An interactive user interface displays "Appropriate Legal Notices"
+  An interactive user interface displays &quot;Appropriate Legal Notices&quot;
 to the extent that it includes a convenient and prominently visible
 feature that (1) displays an appropriate copyright notice, and (2)
 tells the user that there is no warranty for the work (except to the
@@ -308,27 +308,27 @@ menu, a prominent item in the list meets this criterion.
 
   1. Source Code.
 
-  The "source code" for a work means the preferred form of the work
-for making modifications to it.  "Object code" means any non-source
+  The &quot;source code&quot; for a work means the preferred form of the work
+for making modifications to it.  &quot;Object code&quot; means any non-source
 form of a work.
 
-  A "Standard Interface" means an interface that either is an official
+  A &quot;Standard Interface&quot; means an interface that either is an official
 standard defined by a recognized standards body, or, in the case of
 interfaces specified for a particular programming language, one that
 is widely used among developers working in that language.
 
-  The "System Libraries" of an executable work include anything, other
+  The &quot;System Libraries&quot; of an executable work include anything, other
 than the work as a whole, that (a) is included in the normal form of
 packaging a Major Component, but which is not part of that Major
 Component, and (b) serves only to enable use of the work with that
 Major Component, or to implement a Standard Interface for which an
 implementation is available to the public in source code form.  A
-"Major Component", in this context, means a major essential component
+&quot;Major Component&quot;, in this context, means a major essential component
 (kernel, window system, and so on) of the specific operating system
 (if any) on which the executable work runs, or a compiler used to
 produce the work, or an object code interpreter used to run it.
 
-  The "Corresponding Source" for a work in object code form means all
+  The &quot;Corresponding Source&quot; for a work in object code form means all
 the source code needed to generate, install, and (for an executable
 work) run the object code and to modify the work, including scripts to
 control those activities.  However, it does not include the work's
@@ -414,7 +414,7 @@ terms of section 4, provided that you also meet all of these conditions:
     b) The work must carry prominent notices stating that it is
     released under this License and any conditions added under section
     7.  This requirement modifies the requirement in section 4 to
-    "keep intact all notices".
+    &quot;keep intact all notices&quot;.
 
     c) You must license the entire work, as a whole, under this
     License to anyone who comes into possession of a copy.  This
@@ -433,7 +433,7 @@ terms of section 4, provided that you also meet all of these conditions:
 works, which are not by their nature extensions of the covered work,
 and which are not combined with it such as to form a larger program,
 in or on a volume of a storage or distribution medium, is called an
-"aggregate" if the compilation and its resulting copyright are not
+&quot;aggregate&quot; if the compilation and its resulting copyright are not
 used to limit the access or legal rights of the compilation's users
 beyond what the individual works permit.  Inclusion of a covered work
 in an aggregate does not cause this License to apply to the other
@@ -491,12 +491,12 @@ in one of these ways:
 from the Corresponding Source as a System Library, need not be
 included in conveying the object code work.
 
-  A "User Product" is either (1) a "consumer product", which means any
+  A &quot;User Product&quot; is either (1) a &quot;consumer product&quot;, which means any
 tangible personal property which is normally used for personal, family,
 or household purposes, or (2) anything designed or sold for incorporation
 into a dwelling.  In determining whether a product is a consumer product,
 doubtful cases shall be resolved in favor of coverage.  For a particular
-product received by a particular user, "normally used" refers to a
+product received by a particular user, &quot;normally used&quot; refers to a
 typical or common use of that class of product, regardless of the status
 of the particular user or of the way in which the particular user
 actually uses, or expects or is expected to use, the product.  A product
@@ -504,7 +504,7 @@ is a consumer product regardless of whether the product has substantial
 commercial, industrial or non-consumer uses, unless such uses represent
 the only significant mode of use of the product.
 
-  "Installation Information" for a User Product means any methods,
+  &quot;Installation Information&quot; for a User Product means any methods,
 procedures, authorization keys, or other information required to install
 and execute modified versions of a covered work in that User Product from
 a modified version of its Corresponding Source.  The information must
@@ -539,7 +539,7 @@ unpacking, reading or copying.
 
   7. Additional Terms.
 
-  "Additional permissions" are terms that supplement the terms of this
+  &quot;Additional permissions&quot; are terms that supplement the terms of this
 License by making exceptions from one or more of its conditions.
 Additional permissions that are applicable to the entire Program shall
 be treated as though they were included in this License, to the extent
@@ -582,8 +582,8 @@ that material) supplement the terms of this License with terms:
     any liability that these contractual assumptions directly impose on
     those licensors and authors.
 
-  All other non-permissive additional terms are considered "further
-restrictions" within the meaning of section 10.  If the Program as you
+  All other non-permissive additional terms are considered &quot;further
+restrictions&quot; within the meaning of section 10.  If the Program as you
 received it, or any part of it, contains a notice stating that it is
 governed by this License along with a term that is a further
 restriction, you may remove that term.  If a license document contains
@@ -647,7 +647,7 @@ receives a license from the original licensors, to run, modify and
 propagate that work, subject to this License.  You are not responsible
 for enforcing compliance by third parties with this License.
 
-  An "entity transaction" is a transaction transferring control of an
+  An &quot;entity transaction&quot; is a transaction transferring control of an
 organization, or substantially all assets of one, or subdividing an
 organization, or merging organizations.  If propagation of a covered
 work results from an entity transaction, each party to that
@@ -667,17 +667,17 @@ sale, or importing the Program or any portion of it.
 
   11. Patents.
 
-  A "contributor" is a copyright holder who authorizes use under this
+  A &quot;contributor&quot; is a copyright holder who authorizes use under this
 License of the Program or a work on which the Program is based.  The
-work thus licensed is called the contributor's "contributor version".
+work thus licensed is called the contributor's &quot;contributor version&quot;.
 
-  A contributor's "essential patent claims" are all patent claims
+  A contributor's &quot;essential patent claims&quot; are all patent claims
 owned or controlled by the contributor, whether already acquired or
 hereafter acquired, that would be infringed by some manner, permitted
 by this License, of making, using, or selling its contributor version,
 but do not include claims that would be infringed only as a
 consequence of further modification of the contributor version.  For
-purposes of this definition, "control" includes the right to grant
+purposes of this definition, &quot;control&quot; includes the right to grant
 patent sublicenses in a manner consistent with the requirements of
 this License.
 
@@ -686,10 +686,10 @@ patent license under the contributor's essential patent claims, to
 make, use, sell, offer for sale, import and otherwise run, modify and
 propagate the contents of its contributor version.
 
-  In the following three paragraphs, a "patent license" is any express
+  In the following three paragraphs, a &quot;patent license&quot; is any express
 agreement or commitment, however denominated, not to enforce a patent
 (such as an express permission to practice a patent or covenant not to
-sue for patent infringement).  To "grant" such a patent license to a
+sue for patent infringement).  To &quot;grant&quot; such a patent license to a
 party means to make such an agreement or commitment not to enforce a
 patent against the party.
 
@@ -701,7 +701,7 @@ then you must either (1) cause the Corresponding Source to be so
 available, or (2) arrange to deprive yourself of the benefit of the
 patent license for this particular work, or (3) arrange, in a manner
 consistent with the requirements of this License, to extend the patent
-license to downstream recipients.  "Knowingly relying" means you have
+license to downstream recipients.  &quot;Knowingly relying&quot; means you have
 actual knowledge that, but for the patent license, your conveying the
 covered work in a country, or your recipient's use of the covered work
 in a country, would infringe one or more identifiable patents in that
@@ -715,7 +715,7 @@ or convey a specific copy of the covered work, then the patent license
 you grant is automatically extended to all recipients of the covered
 work and works based on it.
 
-  A patent license is "discriminatory" if it does not include within
+  A patent license is &quot;discriminatory&quot; if it does not include within
 the scope of its coverage, prohibits the exercise of, or is
 conditioned on the non-exercise of one or more of the rights that are
 specifically granted under this License.  You may not convey a covered
@@ -766,7 +766,7 @@ address new problems or concerns.
 
   Each version is given a distinguishing version number.  If the
 Program specifies that a certain numbered version of the GNU General
-Public License "or any later version" applies to it, you have the
+Public License &quot;or any later version&quot; applies to it, you have the
 option of following the terms and conditions either of that numbered
 version or of any later version published by the Free Software
 Foundation.  If the Program does not specify a version number of the
@@ -787,7 +787,7 @@ later version.
 
   THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
 APPLICABLE LAW.  EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
-HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT WARRANTY
+HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM &quot;AS IS&quot; WITHOUT WARRANTY
 OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO,
 THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 PURPOSE.  THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE PROGRAM
@@ -826,10 +826,10 @@ free software which everyone can redistribute and change under these terms.
   To do so, attach the following notices to the program.  It is safest
 to attach them to the start of each source file to most effectively
 state the exclusion of warranty; and each file should have at least
-the "copyright" line and a pointer to where the full notice is found.
+the &quot;copyright&quot; line and a pointer to where the full notice is found.
 
-    <one line to give the program's name and a brief idea of what it does.>
-    Copyright (C) <year>  <name of author>
+    &lt;one line to give the program's name and a brief idea of what it does.&gt;
+    Copyright (C) &lt;year&gt;  &lt;name of author&gt;
 
     This program is free software: you can redistribute it and/or modify
     it under the terms of the GNU General Public License as published by
@@ -842,34 +842,32 @@ the "copyright" line and a pointer to where the full notice is found.
     GNU General Public License for more details.
 
     You should have received a copy of the GNU General Public License
-    along with this program.  If not, see <http://www.gnu.org/licenses/>.
+    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 
 Also add information on how to contact you by electronic and paper mail.
 
   If the program does terminal interaction, make it output a short
 notice like this when it starts in an interactive mode:
 
-    <program>  Copyright (C) <year>  <name of author>
+    &lt;program&gt;  Copyright (C) &lt;year&gt;  &lt;name of author&gt;
     This program comes with ABSOLUTELY NO WARRANTY; for details type `show w'.
     This is free software, and you are welcome to redistribute it
     under certain conditions; type `show c' for details.
 
 The hypothetical commands `show w' and `show c' should show the appropriate
 parts of the General Public License.  Of course, your program's commands
-might be different; for a GUI interface, you would use an "about box".
+might be different; for a GUI interface, you would use an &quot;about box&quot;.
 
   You should also get your employer (if you work as a programmer) or school,
-if any, to sign a "copyright disclaimer" for the program, if necessary.
+if any, to sign a &quot;copyright disclaimer&quot; for the program, if necessary.
 For more information on this, and how to apply and follow the GNU GPL, see
-<http://www.gnu.org/licenses/>.
+&lt;http://www.gnu.org/licenses/&gt;.
 
   The GNU General Public License does not permit incorporating your program
 into proprietary programs.  If your program is a subroutine library, you
 may consider it more useful to permit linking proprietary applications with
 the library.  If this is what you want to do, use the GNU Lesser General
 Public License instead of this License.  But first, please read
-<http://www.gnu.org/philosophy/why-not-lgpl.html>.
-
-</pre>
-</body>
-</html>
+&lt;http://www.gnu.org/philosophy/why-not-lgpl.html&gt;.</PRE>
+</BODY>
+</HTML>
\ No newline at end of file
diff --git readlicense_oo/source/license/license_en-US.txt readlicense_oo/source/license/license_en-US.txt
index 6e80610..13ee858 100644
--- readlicense_oo/source/license/license_en-US.txt
+++ readlicense_oo/source/license/license_en-US.txt
@@ -1,19 +1,16 @@
-This product is made available subject to the terms of GNU Lesser General Public License Version 3. A copy of the LGPL license can be found at http://www.openoffice.org/license.html
+This product is made available subject to the terms of GNU Lesser General Public License Version 3. A copy of the LGPL license can be found at http://www.ooo4kids.org/license.html
 
 ------------------------------------
-Third Party Code. Additional copyright notices and license terms applicable to portions of the Software are set forth in the THIRDPARTYLICENSEREADME.html file.
 
-------------------------------------
 All trademarks and registered trademarks mentioned herein are the property of their respective owners.  
 
 ------------------------------------
-Copyright 2002,2008 Sun Microsystems, Inc.
+Copyright 2009 EducOOo  ( http://www.educoo.org )
 
-This product has been created with contributions from the OpenOffice.org community, of which Sun Microsystems Inc. is the founding member. OpenOffice.org acknowledges all community members, especially those mentioned at http://www.openoffice.org/welcome/credits.html.
+This product has been created with contributions from the OOo4Kids community
 
 ------------------------------------
 
-
 		   GNU LESSER GENERAL PUBLIC LICENSE
                        Version 3, 29 June 2007
 
diff --git readlicense_oo/util/makefile.pmk readlicense_oo/util/makefile.pmk
index b5c9099..5dd77f0 100755
--- readlicense_oo/util/makefile.pmk
+++ readlicense_oo/util/makefile.pmk
@@ -29,6 +29,12 @@
 
 # --- Targets ------------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+A_README_XRM=readme_OOo4Kids.xrm
+.ELSE
+A_README_XRM=readme.xrm
+.ENDIF
+
 .IF "$(GUI)"=="UNX"
 # uppercase and no filename extension for txt
 SYSTEXTDOCS=$(foreach,i,$(alllangiso) $(MISC)$/$(GUI)$/README_$i)
@@ -39,9 +45,9 @@ SYSHTMLDOCS=$(SYSTEXTDOCS:s/.txt/.html/)
 .ENDIF		# "$(GUI)"=="UNX"
 
 .IF "$(WITH_LANG)"!=""
-MERGEDXRM=$(COMMONMISC)$/$(TARGET)$/readme.xrm
+MERGEDXRM=$(COMMONMISC)$/$(TARGET)$/$(A_README_XRM)
 .ELSE		# "$(WITH_LANG)"!=""
-MERGEDXRM=.$/readme.xrm
+MERGEDXRM=.$/$(A_README_XRM)
 .ENDIF		# "$(WITH_LANG)"!=""
 
 .INCLUDE : target.mk
diff --git reportdesign/source/core/api/makefile.mk reportdesign/source/core/api/makefile.mk
index 342f12a..82f7f10 100644
--- reportdesign/source/core/api/makefile.mk
+++ reportdesign/source/core/api/makefile.mk
@@ -37,6 +37,13 @@ TARGET=api
 ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/dll.pmk
 
diff --git reportdesign/source/core/misc/makefile.mk reportdesign/source/core/misc/makefile.mk
index 18369fd..cf2e09b 100644
--- reportdesign/source/core/misc/makefile.mk
+++ reportdesign/source/core/misc/makefile.mk
@@ -36,6 +36,12 @@ TARGET=core_misc
 ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings -----------------------------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/dll.pmk
 
diff --git reportdesign/source/core/resource/makefile.mk reportdesign/source/core/resource/makefile.mk
index 6d1803b..18a3d6b 100644
--- reportdesign/source/core/resource/makefile.mk
+++ reportdesign/source/core/resource/makefile.mk
@@ -36,6 +36,11 @@ TARGET=core_resource
 ENABLE_EXCEPTIONS=TRUE
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/dll.pmk
 
diff --git reportdesign/source/core/sdr/makefile.mk reportdesign/source/core/sdr/makefile.mk
index 0e65a59..c673ca0 100644
--- reportdesign/source/core/sdr/makefile.mk
+++ reportdesign/source/core/sdr/makefile.mk
@@ -35,6 +35,12 @@ PRJNAME=reportdesign
 TARGET=core_sdr
 ENABLE_EXCEPTIONS=TRUE
 # --- Settings -----------------------------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 .INCLUDE : $(PRJ)$/util$/dll.pmk
 
diff --git reportdesign/source/filter/xml/makefile.mk reportdesign/source/filter/xml/makefile.mk
index b8fb6a7..ec8c667 100644
--- reportdesign/source/filter/xml/makefile.mk
+++ reportdesign/source/filter/xml/makefile.mk
@@ -37,6 +37,12 @@ TARGET=rptxml
 ENABLE_EXCEPTIONS=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  	settings.mk
 
 # --- Files -------------------------------------
diff --git reportdesign/source/ui/dlg/makefile.mk reportdesign/source/ui/dlg/makefile.mk
index 80b8e87..ee499a5 100644
--- reportdesign/source/ui/dlg/makefile.mk
+++ reportdesign/source/ui/dlg/makefile.mk
@@ -39,6 +39,10 @@ BMP_IN=$(PRJ)$/res
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
 
 .INCLUDE : settings.mk
 # .INCLUDE : $(PRJ)$/util$/dll.pmk
diff --git reportdesign/source/ui/inspection/makefile.mk reportdesign/source/ui/inspection/makefile.mk
index c392fed..0ac1f7a 100644
--- reportdesign/source/ui/inspection/makefile.mk
+++ reportdesign/source/ui/inspection/makefile.mk
@@ -37,6 +37,10 @@ ENABLE_EXCEPTIONS=TRUE
 VISIBILITY_HIDDEN=TRUE
 
 # --- Settings -----------------------------------------------------
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
 
 .INCLUDE :  settings.mk
 
diff --git reportdesign/source/ui/misc/makefile.mk reportdesign/source/ui/misc/makefile.mk
index 19dbc76..48fb413 100644
--- reportdesign/source/ui/misc/makefile.mk
+++ reportdesign/source/ui/misc/makefile.mk
@@ -38,6 +38,11 @@ VISIBILITY_HIDDEN=TRUE
 
 # --- Settings ----------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 # .INCLUDE : $(PRJ)$/util$/dll.pmk
 
diff --git reportdesign/source/ui/report/makefile.mk reportdesign/source/ui/report/makefile.mk
index f1739f1..d8249b9 100644
--- reportdesign/source/ui/report/makefile.mk
+++ reportdesign/source/ui/report/makefile.mk
@@ -39,6 +39,11 @@ VISIBILITY_HIDDEN=TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 # .INCLUDE : $(PRJ)$/util$/dll.pmk
 
diff --git reportdesign/util/makefile.mk reportdesign/util/makefile.mk
index 82f22e3..4b82fc3 100644
--- reportdesign/util/makefile.mk
+++ reportdesign/util/makefile.mk
@@ -38,6 +38,12 @@ GEN_HID=TRUE
 GEN_HID_OTHER=TRUE
 
 # --- Settings ----------------------------------
+
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 
 .IF "$(L10N_framework)"==""
diff --git ridljar/com/makefile.mk ridljar/com/makefile.mk
index 0174f11..ff3a668 100644
--- ridljar/com/makefile.mk
+++ ridljar/com/makefile.mk
@@ -37,6 +37,12 @@ PACKAGE := com
 
 .INCLUDE: settings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+.IF "$(OOo4Kids)" != "YES"
 JAVAFILES = \
     sun$/star$/lib$/uno$/typedesc$/FieldDescription.java \
     sun$/star$/lib$/uno$/typedesc$/MemberDescriptionHelper.java \
@@ -66,3 +72,6 @@ JAVAFILES = \
     sun$/star$/uno$/UnoRuntime.java
 
 .INCLUDE: target.mk
+
+.ENDIF # .IF "$(OOo4Kids)" != "YES"
+
diff --git ridljar/javamaker/makefile.mk ridljar/javamaker/makefile.mk
index af254bc..f38be95 100644
--- ridljar/javamaker/makefile.mk
+++ ridljar/javamaker/makefile.mk
@@ -35,6 +35,11 @@ TARGET := javamaker
 
 .INCLUDE: settings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 RDB = $(SOLARBINDIR)$/udkapi.rdb
 
 .INCLUDE: target.mk
diff --git ridljar/source/unoloader/com/sun/star/lib/unoloader/makefile.mk ridljar/source/unoloader/com/sun/star/lib/unoloader/makefile.mk
index 81e04f8..c575341 100644
--- ridljar/source/unoloader/com/sun/star/lib/unoloader/makefile.mk
+++ ridljar/source/unoloader/com/sun/star/lib/unoloader/makefile.mk
@@ -37,6 +37,11 @@ PACKAGE := com$/sun$/star$/lib$/unoloader
 
 .INCLUDE: settings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # Use a non-default CLASSDIR, so that the util/makefile.mk can use
 # JARCLASSDIRS=com and nevertheless not include this package in ridl.jar:
 CLASSDIR != $(OUT)$/class$/unoloader
diff --git ridljar/source/unoloader/makefile.mk ridljar/source/unoloader/makefile.mk
index 56cc2d9..d215fd1 100644
--- ridljar/source/unoloader/makefile.mk
+++ ridljar/source/unoloader/makefile.mk
@@ -36,6 +36,11 @@ TARGET := unoloader
 
 .INCLUDE: settings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 ZIP1TARGET = $(TARGET)_src
 ZIP1FLAGS = -r
 ZIP1LIST = com -x '*makefile.mk' -x '*manifest'
diff --git ridljar/util/makefile.mk ridljar/util/makefile.mk
index 7179f42..ebd2283 100644
--- ridljar/util/makefile.mk
+++ ridljar/util/makefile.mk
@@ -35,6 +35,11 @@ TARGET	= ridl
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 
 MAXLINELENGTH = 100000
diff --git sandbox/com/sun/star/lib/sandbox/makefile.mk sandbox/com/sun/star/lib/sandbox/makefile.mk
index 81e7fdc..8d0c997 100644
--- sandbox/com/sun/star/lib/sandbox/makefile.mk
+++ sandbox/com/sun/star/lib/sandbox/makefile.mk
@@ -36,6 +36,10 @@ PACKAGE = com$/sun$/star$/lib$/sandbox
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)" == "YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
 .INCLUDE :  settings.mk
 .IF "$(L10N_framework)"==""
 
diff --git sandbox/util/makefile.mk sandbox/util/makefile.mk
index ac5684e..399d49d 100644
--- sandbox/util/makefile.mk
+++ sandbox/util/makefile.mk
@@ -34,6 +34,12 @@ PRJNAME = sandbox
 TARGET  = lib_sandbox_util
 
 # --- Settings -----------------------------------------------------
+
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(L10N_framework)"==""
 .INCLUDE :  settings.mk
 
diff --git saxon/makefile.mk saxon/makefile.mk
index 03c873f..46267a2 100644
--- saxon/makefile.mk
+++ saxon/makefile.mk
@@ -39,6 +39,11 @@ TARGET=saxon
 .INCLUDE :	settings.mk
 .INCLUDE : antsettings.mk
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(SOLAR_JAVA)" != ""
 .IF "$(SYSTEM_SAXON)" == "YES"
 all:
diff --git sc/inc/address.hxx sc/inc/address.hxx
index 001a0d1..a253325 100644
--- sc/inc/address.hxx
+++ sc/inc/address.hxx
@@ -83,17 +83,32 @@ const SCCOLROW SCCOLROW_MAX = ::std::numeric_limits<SCCOLROW>::max();
 const SCSIZE   SCSIZE_MAX   = ::std::numeric_limits<SCSIZE>::max();
 
 // A define to handle critical sections we hopefully don't need very often.
+#ifdef OOo4Kids
+#define SC_ROWLIMIT_MORE_THAN_32K 0     /* set to 1 if we throw the switch */
+#else
 #define SC_ROWLIMIT_MORE_THAN_32K 1     /* set to 1 if we throw the switch */
-
+#endif
 // The maximum values. Defines are needed for preprocessor checks in
 // bcaslot.cxx, otherwise type safe constants are preferred.
+
+#ifdef OOo4Kids
+// multiple of 128
+#define MAXROWCOUNT_DEFINE 128
+// multiple of 16
+#define MAXCOLCOUNT_DEFINE 64
+#else
 #define MAXROWCOUNT_DEFINE 65536
 #define MAXCOLCOUNT_DEFINE 1024
+#endif
 
 // Count values
 const SCROW       MAXROWCOUNT    = MAXROWCOUNT_DEFINE;
 const SCCOL       MAXCOLCOUNT    = MAXCOLCOUNT_DEFINE;
+#ifdef OOo4Kids
+const SCTAB       MAXTABCOUNT    = 64;
+#else
 const SCTAB       MAXTABCOUNT    = 256;
+#endif
 const SCCOLROW    MAXCOLROWCOUNT = MAXROWCOUNT;
 // Maximum values
 const SCROW       MAXROW         = MAXROWCOUNT - 1;
diff --git sc/source/core/data/global.cxx sc/source/core/data/global.cxx
index 4a7e086..f4b6ae9 100644
--- sc/source/core/data/global.cxx
+++ sc/source/core/data/global.cxx
@@ -70,6 +70,7 @@
 #include <svtools/syslocale.hxx>
 #include <unotools/transliterationwrapper.hxx>
 
+
 #include "global.hxx"
 #include "scresid.hxx"
 #include "autoform.hxx"
@@ -91,13 +92,27 @@
 #include "scmod.hxx"
 #include "appoptio.hxx"
 
+#ifdef OOo4Kids
+#include "vcl/unohelp.hxx"
+#include <com/sun/star/container/XContentEnumerationAccess.hpp>
+#include <com/sun/star/container/XNameAccess.hpp>
+#include <com/sun/star/container/XNameReplace.hpp>
+#include <com/sun/star/uno/Any.hxx>
+#include <com/sun/star/lang/XComponent.hpp>
+
 // -----------------------------------------------------------------------
 
+#define SC_USER_LEVEL_BEGINNER      1
+#define SC_USER_LEVEL_AVERAGE       2
+#define SC_USER_LEVEL_EXPERT        3
+#endif
+
 #define CLIPST_AVAILABLE	0
 #define CLIPST_CAPTURED		1
 #define CLIPST_DELETE		2
 #define CLIPST_DRAW			3
 
+
 ScDocShellRef*	ScGlobal::pDrawClipDocShellRef = NULL;
 SvxSearchItem*	ScGlobal::pSearchItem = NULL;
 ScAutoFormat*	ScGlobal::pAutoFormat = NULL;
@@ -147,6 +162,75 @@ long			ScGlobal::nLastColWidthExtra	= STD_EXTRA_WIDTH;
 static USHORT nPPTZoom = 0;		// ScreenZoom used to determine nScreenPPTX/Y
 
 
+#ifdef OOo4Kids
+using namespace ::com::sun::star::uno; // Reference
+using namespace ::com::sun::star::lang; // XMultiServiceFactory
+using namespace ::com::sun::star::beans; // PropertyValue
+using namespace ::com::sun::star::container; // XNameAccess
+using ::rtl::OUString;
+
+static const OUString sULConfigSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationProvider" ) );
+static const OUString sULAccessSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationUpdateAccess" ) );
+
+static short getUserLevel()
+{
+    short dUserLevel = 1; // default is beginner 
+    try
+    {
+    // get service provider
+        Reference< XMultiServiceFactory > xSMgr( vcl::unohelper::GetMultiServiceFactory() );
+        // create configuration hierachical access name
+        if( xSMgr.is() )
+    {
+        try
+            {
+                Reference< XMultiServiceFactory > xConfigProvider(
+                    Reference< XMultiServiceFactory >(
+                        xSMgr->createInstance( sULConfigSrvc ),
+                        UNO_QUERY )
+                    );
+                if( xConfigProvider.is() )
+                {
+                    Sequence< Any > aArgs(1);
+                    PropertyValue aVal;
+                    aVal.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "nodepath" ) );
+                    aVal.Value <<= OUString( RTL_CONSTASCII_USTRINGPARAM( "/org.openoffice.Office.Common/Misc" ) );
+                    aArgs.getArray()[0] <<= aVal;
+                    Reference< XNameAccess > xConfigAccess(
+                        Reference< XNameAccess >(
+                            xConfigProvider->createInstanceWithArguments( sULAccessSrvc, aArgs ), UNO_QUERY )
+                        );
+                    if( xConfigAccess.is() )
+                    {
+                        try
+                        {
+                            short bValue = 1;
+                            Any aAny = xConfigAccess->getByName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserLevel" ) ) );
+                            if( aAny >>= bValue )
+                                dUserLevel = bValue;
+                        }
+                        catch( NoSuchElementException& )
+                        {
+                        }
+                        catch( WrappedTargetException& )
+                        {
+                        }
+                    }
+                }
+            }
+            catch( Exception& )
+            {
+            }
+        }
+    }
+    catch( WrappedTargetException& )
+    {
+    }
+    return dUserLevel;
+}
+#endif
+
+
 // ... oder so?
 
 BOOL bOderSo;
@@ -763,7 +847,11 @@ bool ScGlobal::HasStarCalcFunctionList()
 
 ScFunctionList* ScGlobal::GetStarCalcFunctionList()
 {
+#ifdef OOo4Kids
+    ResetFunctionList();
+#else
     if ( !pStarCalcFunctionList )
+#endif
         pStarCalcFunctionList = new	ScFunctionList;
 
     return pStarCalcFunctionList;
@@ -1235,6 +1323,9 @@ ScFunctionList::ScFunctionList() :
     ScFuncDesc*		pDesc	= NULL;
     xub_StrLen		nStrLen = 0;
     FuncCollection*	pFuncColl;
+#ifdef OOo4Kids
+    short   nLevel = getUserLevel();
+#endif
     USHORT i,j;
     USHORT nDescBlock[] =
     {
@@ -1262,10 +1353,70 @@ ScFunctionList::ScFunctionList() :
                 pDesc = new ScFuncDesc;
                 bool bSuppressed = false;
                 ScFuncRes aSubRes( aRes, pDesc, bSuppressed);
+#ifdef OOo4Kids
+                bool bIsNotForThisLevel = false;
+
+                if ( nLevel != SC_USER_LEVEL_EXPERT )
+                {
+                    if ( SC_USER_LEVEL_BEGINNER == nLevel )
+                    {
+                        switch ( aRes.GetId() )
+                        {
+                            // FIXME : define the right list for Beginner
+                            case SC_OPCODE_MAX:
+                            case SC_OPCODE_MIN:
+                            case SC_OPCODE_AVERAGE:
+                            case SC_OPCODE_PI:
+                            case SC_OPCODE_MOD:
+                            case SC_OPCODE_SUM:
+                            case SC_OPCODE_PRODUCT:
+                                break;
+                            default:
+                                bIsNotForThisLevel = true;
+                                break;
+                        }
+                    }
+                    else if (  SC_USER_LEVEL_AVERAGE == nLevel )
+                    {
+                        switch ( aRes.GetId() )
+                        {
+                            // FIXME : define the right list for Average
+                            case SC_OPCODE_RANDOM:
+                            case SC_OPCODE_MAX:
+                            case SC_OPCODE_MIN:
+                            case SC_OPCODE_AVERAGE:
+                            case SC_OPCODE_PI:
+                            case SC_OPCODE_MOD:
+                            case SC_OPCODE_SUM:
+                            case SC_OPCODE_PRODUCT:
+                            case SC_OPCODE_SIN: 
+                            case SC_OPCODE_COS: 
+                            case SC_OPCODE_DEG: 
+                            case SC_OPCODE_RAD: 
+                            case SC_OPCODE_ABS: 
+                            case SC_OPCODE_SQRT: 
+                            case SC_OPCODE_NOT: 
+                            case SC_OPCODE_AND:
+                            case SC_OPCODE_OR:
+                            case SC_OPCODE_PLUS_MINUS:
+                            case SC_OPCODE_GGT:
+                            case SC_OPCODE_KGV:
+                            case SC_OPCODE_POWER:
+                                break;
+                            default:
+                                bIsNotForThisLevel = true;
+                                break;
+                        }
+                    }
+                }
+
+                if ( bSuppressed || bIsNotForThisLevel )
+#else
                 // Instead of dealing with this exceptional case at 1001 places
                 // we simply don't add an entirely suppressed function to the
                 // list and delete it.
                 if (bSuppressed)
+#endif
                     delete pDesc;
                 else
                 {
@@ -1387,6 +1538,10 @@ ScFunctionList::ScFunctionList() :
 
     //	StarOne AddIns
 
+#ifdef OOo4Kids
+        if ( SC_USER_LEVEL_EXPERT == nLevel )
+    {
+#endif
     ScUnoAddInCollection* pUnoAddIns = ScGlobal::GetAddInCollection();
     long nUnoCount = pUnoAddIns->GetFuncCount();
     for (long nFunc=0; nFunc<nUnoCount; nFunc++)
@@ -1404,6 +1559,9 @@ ScFunctionList::ScFunctionList() :
         else
             delete pDesc;
     }
+#ifdef OOo4Kids
+    }
+#endif
 }
 
 //------------------------------------------------------------------------
diff --git sc/source/ui/view/tabvwsh4.cxx sc/source/ui/view/tabvwsh4.cxx
index 46e25c1..dabfa95 100644
--- sc/source/ui/view/tabvwsh4.cxx
+++ sc/source/ui/view/tabvwsh4.cxx
@@ -1804,7 +1804,11 @@ void ScTabViewShell::Construct( BYTE nForceDesignMode )
             // append additional sheets (not for OLE object)
             if ( pDocSh->GetCreateMode() != SFX_CREATE_MODE_EMBEDDED )
             {
+#ifdef OOo4Kids
+                SCTAB nInitTabCount = 1;							//!	konfigurierbar !!!
+#else
                 SCTAB nInitTabCount = 3;							//!	konfigurierbar !!!
+#endif
                 for (SCTAB i=1; i<nInitTabCount; i++)
                     pDoc->MakeTable(i,false);
             }
diff --git sc/uiconfig/scalc/menubar/menubar.xml sc/uiconfig/scalc/menubar/menubar.xml
index ab3f121..f07f5ab 100644
--- sc/uiconfig/scalc/menubar/menubar.xml
+++ sc/uiconfig/scalc/menubar/menubar.xml
@@ -1,53 +1,26 @@
 <?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE menu:menubar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "menubar.dtd">
 <menu:menubar xmlns:menu="http://openoffice.org/2001/menu" menu:id="menubar">
-    <menu:menu menu:id=".uno:PickList">
+ <menu:menu menu:id=".uno:PickList" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:AddDirect"/>
             <menu:menuitem menu:id=".uno:Open"/>
             <menu:menuitem menu:id=".uno:RecentFileList"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:AutoPilotMenu"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:CloseDoc"/>
-            <menu:menuitem menu:id=".uno:Save"/>
             <menu:menuitem menu:id=".uno:SaveAs"/>
-            <menu:menuitem menu:id=".uno:SaveAll"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Reload"/>
-            <menu:menuitem menu:id=".uno:VersionDialog"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:ExportTo"/>
             <menu:menuitem menu:id=".uno:ExportToPDF"/>
-            <menu:menu menu:id=".uno:SendTo">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:SendMail"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsOOo"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsMS"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsPDF"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SetDocumentProperties"/>
-            <menu:menuitem menu:id=".uno:Signature"/>
-            <menu:menu menu:id=".uno:TemplateMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:Organizer"/>
-                    <menu:menuitem menu:id=".uno:AddressBookSource"/>
-                    <menu:menuitem menu:id=".uno:SaveAsTemplate"/>
-                    <menu:menuitem menu:id=".uno:OpenTemplate"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:WebHtml"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:PrintPreview"/>
             <menu:menuitem menu:id=".uno:Print"/>
-            <menu:menuitem menu:id=".uno:PrinterSetup"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Quit"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:EditMenu">
+ <menu:menu menu:id=".uno:EditMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:Undo"/>
             <menu:menuitem menu:id=".uno:Redo"/>
@@ -59,55 +32,23 @@
             <menu:menuitem menu:id=".uno:PasteSpecial"/>
             <menu:menuitem menu:id=".uno:SelectAll"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:ChangesMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:TraceChangeMode"/>
-                    <menu:menuitem menu:id=".uno:ProtectTraceChangeMode"/>
-                    <menu:menuitem menu:id=".uno:ShowChanges"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:AcceptChanges"/>
-                    <menu:menuitem menu:id=".uno:CommentChange"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MergeDocuments"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:CompareDocuments"/>
-            <menu:menuitem menu:id=".uno:SearchDialog"/>
             <menu:menuitem menu:id=".uno:EditHeaderAndFooter"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:FillCellsMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:FillDown"/>
-                    <menu:menuitem menu:id=".uno:FillRight"/>
-                    <menu:menuitem menu:id=".uno:FillUp"/>
-                    <menu:menuitem menu:id=".uno:FillLeft"/>
-                    <menu:menuitem menu:id=".uno:FillTable"/>
-                    <menu:menuitem menu:id=".uno:FillSeries"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuitem menu:id=".uno:Delete"/>
             <menu:menuitem menu:id=".uno:DeleteCell"/>
-            <menu:menu menu:id=".uno:EditSheetMenu">
+   <menu:menu menu:id=".uno:EditSheetMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:Move"/>
                     <menu:menuitem menu:id=".uno:SelectTables"/>
                     <menu:menuitem menu:id=".uno:Remove"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:DelBreakMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:DeleteRowbreak"/>
-                    <menu:menuitem menu:id=".uno:DeleteColumnbreak"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:EditLinks"/>
-            <menu:menuitem menu:id=".uno:PlugInsActive"/>
             <menu:menuitem menu:id=".uno:ImageMapDialog"/>
             <menu:menuitem menu:id=".uno:ObjectMenue"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:ViewMenu">
+ <menu:menu menu:id=".uno:ViewMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:NormalViewMode"/>
             <menu:menuitem menu:id=".uno:PagebreakMode"/>
@@ -118,18 +59,11 @@
             <menu:menuitem menu:id=".uno:ShowImeStatusWindow"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:ViewRowColumnHeaders"/>
-            <menu:menuitem menu:id=".uno:ViewValueHighlighting"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:ViewDataSourceBrowser"/>
-            <menu:menuitem menu:id=".uno:Navigator"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:FullScreen"/>
-            <menu:menuitem menu:id=".uno:Zoom"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:InsertMenu">
+ <menu:menu menu:id=".uno:InsertMenu" menu:label="">
         <menu:menupopup>
-            <menu:menu menu:id=".uno:InsertBreakMenu">
+   <menu:menu menu:id=".uno:InsertBreakMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertRowBreak"/>
                     <menu:menuitem menu:id=".uno:InsertColumnBreak"/>
@@ -139,60 +73,20 @@
             <menu:menuitem menu:id=".uno:InsertRows"/>
             <menu:menuitem menu:id=".uno:InsertColumns"/>
             <menu:menuitem menu:id=".uno:Insert"/>
-            <menu:menuitem menu:id=".uno:InsertSheetFromFile"/>
-            <menu:menuitem menu:id=".uno:InsertExternalDataSource"/>
             <menu:menuitem menu:id=".uno:InsertSymbol"/>
-            <menu:menu menu:id=".uno:FormattingMarkMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertNonBreakingSpace"/>
-                    <menu:menuitem menu:id=".uno:InsertHardHyphen"/>
-                    <menu:menuitem menu:id=".uno:InsertSoftHyphen"/>
-                    <menu:menuitem menu:id=".uno:InsertZWSP"/>
-                    <menu:menuitem menu:id=".uno:InsertZWNBSP"/>
-                    <menu:menuitem menu:id=".uno:InsertLRM"/>
-                    <menu:menuitem menu:id=".uno:InsertRLM"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:HyperlinkDialog"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:FunctionDialog"/>
             <menu:menuitem menu:id=".uno:FunctionBox"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:NamesMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:DefineName"/>
-                    <menu:menuitem menu:id=".uno:InsertName"/>
-                    <menu:menuitem menu:id=".uno:CreateNames"/>
-                    <menu:menuitem menu:id=".uno:DefineLabelRange"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuitem menu:id=".uno:InsertAnnotation"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:GraphicMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertGraphic"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:InsertAVMedia"/>
-            <menu:menu menu:id=".uno:ObjectMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertObject"/>
-                    <menu:menuitem menu:id=".uno:InsertPlugin"/>
-                    <menu:menuitem menu:id=".uno:InsertSound"/>
-                    <menu:menuitem menu:id=".uno:InsertVideo"/>
-                    <menu:menuitem menu:id=".uno:InsertObjectStarMath"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuitem menu:id=".uno:InsertObjectChart"/>
-            <menu:menuitem menu:id=".uno:InsertObjectFloatingFrame"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:FormatMenu">
+ <menu:menu menu:id=".uno:FormatMenu" menu:label="">
         <menu:menupopup>
-            <menu:menuitem menu:id=".uno:ResetAttributes"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:FormatCellDialog"/>
-            <menu:menu menu:id=".uno:RowMenu">
+   <menu:menu menu:id=".uno:RowMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:RowHeight"/>
                     <menu:menuitem menu:id=".uno:SetOptimalRowHeight"/>
@@ -200,7 +94,7 @@
                     <menu:menuitem menu:id=".uno:ShowRow"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:ColumnMenu">
+   <menu:menu menu:id=".uno:ColumnMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:ColumnWidth"/>
                     <menu:menuitem menu:id=".uno:SetOptimalColumnWidth"/>
@@ -208,7 +102,7 @@
                     <menu:menuitem menu:id=".uno:ShowColumn"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:SheetMenu">
+   <menu:menu menu:id=".uno:SheetMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:RenameTable"/>
                     <menu:menuitem menu:id=".uno:Hide"/>
@@ -219,19 +113,8 @@
             <menu:menuitem menu:id=".uno:ToggleMergeCells"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:PageFormatDialog"/>
-            <menu:menu menu:id=".uno:PrintRangesMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:DefinePrintArea"/>
-                    <menu:menuitem menu:id=".uno:AddPrintArea"/>
-                    <menu:menuitem menu:id=".uno:DeletePrintArea"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:EditPrintArea"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:FontDialog"/>
-            <menu:menuitem menu:id=".uno:ParagraphDialog"/>
-            <menu:menu menu:id=".uno:TransliterateMenu">
+   <menu:menu menu:id=".uno:TransliterateMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:ChangeCaseToUpper"/>
                     <menu:menuitem menu:id=".uno:ChangeCaseToLower"/>
@@ -241,17 +124,7 @@
                     <menu:menuitem menu:id=".uno:ChangeCaseToKatakana"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menuitem menu:id=".uno:DesignerDialog"/>
-            <menu:menuitem menu:id=".uno:AutoFormat"/>
-            <menu:menuitem menu:id=".uno:ConditionalFormatDialog"/>
-            <menu:menuseparator/>
-            <menu:menu menu:id=".uno:AnchorMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:SetAnchorToPage"/>
-                    <menu:menuitem menu:id=".uno:SetAnchorToCell"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:ObjectAlign">
+   <menu:menu menu:id=".uno:ObjectAlign" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:CommonAlignHorizontalDefault"/>
                     <menu:menuitem menu:id=".uno:CommonAlignLeft"/>
@@ -264,87 +137,12 @@
                     <menu:menuitem menu:id=".uno:CommonAlignBottom"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:ArrangeMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:BringToFront"/>
-                    <menu:menuitem menu:id=".uno:ObjectForwardOne"/>
-                    <menu:menuitem menu:id=".uno:ObjectBackOne"/>
-                    <menu:menuitem menu:id=".uno:SendToBack"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:SetObjectToForeground"/>
-                    <menu:menuitem menu:id=".uno:SetObjectToBackground"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:FlipMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:ObjectMirrorVertical"/>
-                    <menu:menuitem menu:id=".uno:ObjectMirrorHorizontal"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:GroupMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:FormatGroup"/>
-                    <menu:menuitem menu:id=".uno:FormatUngroup"/>
-                    <menu:menuitem menu:id=".uno:EnterGroup"/>
-                    <menu:menuitem menu:id=".uno:LeaveGroup"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:DrawGraphicMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:TransformDialog"/>
-                    <menu:menuitem menu:id=".uno:FormatLine"/>
-                    <menu:menuitem menu:id=".uno:FormatArea"/>
-                    <menu:menuitem menu:id=".uno:TextAttributes"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:ToggleObjectBezierMode"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:ControlProperties"/>
-            <menu:menuitem menu:id=".uno:FormProperties"/>
-        </menu:menupopup>
-    </menu:menu>
-    <menu:menu menu:id=".uno:ToolsMenu">
-        <menu:menupopup>
-            <menu:menuitem menu:id=".uno:SpellDialog"/>
-            <menu:menu menu:id=".uno:LanguageMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:HangulHanjaConversion"/>
-                    <menu:menuitem menu:id=".uno:ChineseConversion"/>
-                    <menu:menuitem menu:id=".uno:Thesaurus"/>
-                    <menu:menuitem menu:id=".uno:Hyphenate"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MoreDictionaries"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:AuditMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:ShowPrecedents"/>
-                    <menu:menuitem menu:id=".uno:ClearArrowPrecedents"/>
-                    <menu:menuitem menu:id=".uno:ShowDependents"/>
-                    <menu:menuitem menu:id=".uno:ClearArrowDependents"/>
-                    <menu:menuitem menu:id=".uno:ClearArrows"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:ShowErrors"/>
-                    <menu:menuitem menu:id=".uno:ShowInvalid"/>
-                    <menu:menuitem menu:id=".uno:RefreshArrows"/>
-                    <menu:menuitem menu:id=".uno:AutoRefreshArrows"/>
-                    <menu:menuitem menu:id=".uno:AuditingFillMode"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menuitem menu:id=".uno:GoalSeekDialog"/>
-            <menu:menuitem menu:id=".uno:SolverDialog"/>
-            <menu:menuitem menu:id=".uno:ScenarioManager"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:ShareDocument"/>
-            <menu:menuitem menu:id=".uno:MergeDocuments"/>
-            <menu:menu menu:id=".uno:ProtectMenu">
+ <menu:menu menu:id=".uno:ToolsMenu" menu:label="">
                 <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:Protect"/>
-                    <menu:menuitem menu:id=".uno:ToolProtectionDocument"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:CellContentsMenu">
+   <menu:menu menu:id=".uno:CellContentsMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:Calculate"/>
                     <menu:menuitem menu:id=".uno:AutomaticCalculation"/>
@@ -353,73 +151,22 @@
                 </menu:menupopup>
             </menu:menu>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:Gallery"/>
-            <menu:menuitem menu:id=".uno:AVMediaPlayer"/>
-            <menu:menuseparator/>
-            <menu:menu menu:id=".uno:MacrosMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:MacroRecorder"/>
-                    <menu:menuitem menu:id=".uno:RunMacro"/>
-                    <menu:menu menu:id=".uno:ScriptOrganizer"/>
-                    <menu:menuitem menu:id=".uno:MacroSignature"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MacroOrganizer?TabId:short=1"/>
-                </menu:menupopup>
-            </menu:menu>
-
-            <menu:menuitem menu:id="service:com.sun.star.deployment.ui.PackageManagerDialog"/>
-
-            <menu:menuitem menu:id=".uno:OpenXMLFilterSettings"/>
-            <menu:menuitem menu:id=".uno:AutoCorrectDlg"/>
             <menu:menuitem menu:id=".uno:ConfigureDialog"/>
             <menu:menuitem menu:id=".uno:OptionsTreeDialog"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:DataMenu">
+ <menu:menu menu:id=".uno:DataMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:DefineDBName"/>
             <menu:menuitem menu:id=".uno:SelectDB"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:DataSort"/>
-            <menu:menu menu:id=".uno:FilterMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:DataFilterAutoFilter"/>
-                    <menu:menuitem menu:id=".uno:DataFilterStandardFilter"/>
-                    <menu:menuitem menu:id=".uno:DataFilterSpecialFilter"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:DataFilterRemoveFilter"/>
-                    <menu:menuitem menu:id=".uno:DataFilterHideAutoFilter"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:DataSubTotals"/>
-            <menu:menuitem menu:id=".uno:Validation"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:TableOperationDialog"/>
             <menu:menuitem menu:id=".uno:TextToColumns"/>
-            <menu:menuitem menu:id=".uno:DataConsolidate"/>
-            <menu:menu menu:id=".uno:GroupOutlineMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:HideDetail"/>
-                    <menu:menuitem menu:id=".uno:ShowDetail"/>
-                    <menu:menuitem menu:id=".uno:Group"/>
-                    <menu:menuitem menu:id=".uno:Ungroup"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:AutoOutline"/>
-                    <menu:menuitem menu:id=".uno:ClearOutline"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:DataPilotMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:DataDataPilotRun"/>
-                    <menu:menuitem menu:id=".uno:RecalcPivotTable"/>
-                    <menu:menuitem menu:id=".uno:DeletePivotTable"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:DataAreaRefresh"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:WindowList">
+ <menu:menu menu:id=".uno:WindowList" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:NewWindow"/>
             <menu:menuitem menu:id=".uno:CloseWin"/>
@@ -428,15 +175,12 @@
             <menu:menuitem menu:id=".uno:FreezePanes"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:HelpMenu">
+ <menu:menu menu:id=".uno:HelpMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:HelpIndex"/>
             <menu:menuitem menu:id=".uno:ExtendedHelp"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:HelpSupport"/>
-            <menu:menuitem menu:id=".uno:OnlineRegistrationDlg"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:About"/>
+   <menu:menuitem menu:id=".uno:ShowLicense"/>
         </menu:menupopup>
     </menu:menu>
 </menu:menubar>
diff --git sc/uiconfig/scalc/toolbar/average.xml sc/uiconfig/scalc/toolbar/average.xml
new file mode 100644
index 0000000..d466b29
--- /dev/null
+++ sc/uiconfig/scalc/toolbar/average.xml
@@ -0,0 +1,49 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="helpid:5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="helpid:5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="helpid:5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="helpid:6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:text="Styles et formatage" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid=".uno:FontHeight"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:visible="false" toolbar:helpid="helpid:5325"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="helpid:20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="helpid:12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatIncDecimals" toolbar:helpid=".uno:NumberFormatIncDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatDecDecimals" toolbar:helpid=".uno:NumberFormatDecDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="helpid:5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortAscending" toolbar:helpid="helpid:26344"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortDescending" toolbar:helpid="helpid:26343"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="helpid:26155"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:visible="false" toolbar:helpid="helpid:10244"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:visible="false" toolbar:helpid="helpid:5961"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="helpid:10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:visible="false" toolbar:helpid="helpid:5960"/>
+ <toolbar:toolbaritem xlink:href=".uno:ViewDataSourceBrowser" toolbar:helpid="helpid:6660"/>
+ <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:visible="false" toolbar:helpid="helpid:10000"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sc/uiconfig/scalc/toolbar/beginner.xml sc/uiconfig/scalc/toolbar/beginner.xml
new file mode 100644
index 0000000..d466b29
--- /dev/null
+++ sc/uiconfig/scalc/toolbar/beginner.xml
@@ -0,0 +1,49 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="helpid:5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="helpid:5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="helpid:5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="helpid:6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:text="Styles et formatage" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid=".uno:FontHeight"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:visible="false" toolbar:helpid="helpid:5325"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="helpid:20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="helpid:12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatIncDecimals" toolbar:helpid=".uno:NumberFormatIncDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatDecDecimals" toolbar:helpid=".uno:NumberFormatDecDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="helpid:5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortAscending" toolbar:helpid="helpid:26344"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortDescending" toolbar:helpid="helpid:26343"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="helpid:26155"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:visible="false" toolbar:helpid="helpid:10244"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:visible="false" toolbar:helpid="helpid:5961"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="helpid:10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:visible="false" toolbar:helpid="helpid:5960"/>
+ <toolbar:toolbaritem xlink:href=".uno:ViewDataSourceBrowser" toolbar:helpid="helpid:6660"/>
+ <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:visible="false" toolbar:helpid="helpid:10000"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sc/uiconfig/scalc/toolbar/calc_average.xml sc/uiconfig/scalc/toolbar/calc_average.xml
new file mode 100644
index 0000000..d466b29
--- /dev/null
+++ sc/uiconfig/scalc/toolbar/calc_average.xml
@@ -0,0 +1,49 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="helpid:5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="helpid:5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="helpid:5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="helpid:6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:text="Styles et formatage" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid=".uno:FontHeight"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:visible="false" toolbar:helpid="helpid:5325"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="helpid:20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="helpid:12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatIncDecimals" toolbar:helpid=".uno:NumberFormatIncDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatDecDecimals" toolbar:helpid=".uno:NumberFormatDecDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="helpid:5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortAscending" toolbar:helpid="helpid:26344"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortDescending" toolbar:helpid="helpid:26343"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="helpid:26155"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:visible="false" toolbar:helpid="helpid:10244"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:visible="false" toolbar:helpid="helpid:5961"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="helpid:10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:visible="false" toolbar:helpid="helpid:5960"/>
+ <toolbar:toolbaritem xlink:href=".uno:ViewDataSourceBrowser" toolbar:helpid="helpid:6660"/>
+ <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:visible="false" toolbar:helpid="helpid:10000"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sc/uiconfig/scalc/toolbar/calc_beginner.xml sc/uiconfig/scalc/toolbar/calc_beginner.xml
new file mode 100644
index 0000000..d466b29
--- /dev/null
+++ sc/uiconfig/scalc/toolbar/calc_beginner.xml
@@ -0,0 +1,49 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="helpid:5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="helpid:5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="helpid:5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="helpid:6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:text="Styles et formatage" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid=".uno:FontHeight"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:visible="false" toolbar:helpid="helpid:5325"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="helpid:20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="helpid:12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatIncDecimals" toolbar:helpid=".uno:NumberFormatIncDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatDecDecimals" toolbar:helpid=".uno:NumberFormatDecDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="helpid:5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortAscending" toolbar:helpid="helpid:26344"/>
+ <toolbar:toolbaritem xlink:href=".uno:SortDescending" toolbar:helpid="helpid:26343"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="helpid:26155"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:visible="false" toolbar:helpid="helpid:10244"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:visible="false" toolbar:helpid="helpid:5961"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="helpid:10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:visible="false" toolbar:helpid="helpid:5960"/>
+ <toolbar:toolbaritem xlink:href=".uno:ViewDataSourceBrowser" toolbar:helpid="helpid:6660"/>
+ <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:visible="false" toolbar:helpid="helpid:10000"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sc/uiconfig/scalc/toolbar/formatobjectbar.xml sc/uiconfig/scalc/toolbar/formatobjectbar.xml
index 13b6abc..c1d0cba 100644
--- sc/uiconfig/scalc/toolbar/formatobjectbar.xml
+++ sc/uiconfig/scalc/toolbar/formatobjectbar.xml
@@ -1,53 +1,53 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
  <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:helpid="helpid:5539"  />
- <toolbar:toolbaritem xlink:href=".uno:StyleApply" toolbar:helpid="helpid:5552"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:StyleApply" toolbar:visible="false" toolbar:helpid="helpid:5552"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid="helpid:10007"  />
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid="helpid:10015"  />
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid="helpid:10009"  />
- <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid="helpid:10008"  />
- <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid="helpid:10014"  />
- <toolbar:toolbaritem xlink:href=".uno:UnderlineDouble" toolbar:helpid="helpid:26648"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:visible="false" toolbar:helpid="helpid:10009"/>
+ <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:visible="false" toolbar:helpid="helpid:10008"/>
+ <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:visible="false" toolbar:helpid="helpid:10014"/>
+ <toolbar:toolbaritem xlink:href=".uno:UnderlineDouble" toolbar:visible="false" toolbar:helpid="helpid:26648"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:AlignLeft" toolbar:helpid="helpid:26371"  toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:AlignHorizontalCenter" toolbar:helpid="helpid:26373"  toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:AlignRight" toolbar:helpid="helpid:26372"  toolbar:style="radio auto" />
- <toolbar:toolbaritem xlink:href=".uno:AlignBlock" toolbar:helpid="helpid:26374"  toolbar:style="radio auto" />
+ <toolbar:toolbaritem xlink:href=".uno:AlignLeft" toolbar:visible="false" toolbar:helpid="helpid:26371"/>
+ <toolbar:toolbaritem xlink:href=".uno:AlignHorizontalCenter" toolbar:visible="false" toolbar:helpid="helpid:26373"/>
+ <toolbar:toolbaritem xlink:href=".uno:AlignRight" toolbar:visible="false" toolbar:helpid="helpid:26372"/>
+ <toolbar:toolbaritem xlink:href=".uno:AlignBlock" toolbar:visible="false" toolbar:helpid="helpid:26374"/>
  <toolbar:toolbaritem xlink:href=".uno:ToggleMergeCells" toolbar:helpid="helpid:26581"  />
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ParaLeftToRight" toolbar:helpid="helpid:10950"  toolbar:style="radio" />
- <toolbar:toolbaritem xlink:href=".uno:ParaRightToLeft" toolbar:helpid="helpid:10951"  toolbar:style="radio" />
+ <toolbar:toolbaritem xlink:href=".uno:ParaLeftToRight" toolbar:helpid="helpid:10950"/>
+ <toolbar:toolbaritem xlink:href=".uno:ParaRightToLeft" toolbar:helpid="helpid:10951"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:TextdirectionLeftToRight" toolbar:helpid="helpid:10907"  />
  <toolbar:toolbaritem xlink:href=".uno:TextdirectionTopToBottom" toolbar:helpid="helpid:10908"  />
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:AlignTop" toolbar:helpid="helpid:26375"  toolbar:style="radio auto" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:AlignVCenter" toolbar:helpid="helpid:26377"  toolbar:style="radio auto" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:AlignBottom" toolbar:helpid="helpid:26376"  toolbar:style="radio auto" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:AlignTop" toolbar:visible="false" toolbar:helpid="helpid:26375"/>
+ <toolbar:toolbaritem xlink:href=".uno:AlignVCenter" toolbar:visible="false" toolbar:helpid="helpid:26377"/>
+ <toolbar:toolbaritem xlink:href=".uno:AlignBottom" toolbar:visible="false" toolbar:helpid="helpid:26376"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:NumberFormatCurrency" toolbar:helpid="helpid:26045"  />
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatCurrency" toolbar:visible="false" toolbar:helpid="helpid:26045"/>
  <toolbar:toolbaritem xlink:href=".uno:NumberFormatPercent" toolbar:helpid="helpid:26046"  />
- <toolbar:toolbaritem xlink:href=".uno:NumberFormatDate" toolbar:helpid="helpid:26053"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:NumberFormatScientific" toolbar:helpid="helpid:26055"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:NumberFormatStandard" toolbar:helpid="helpid:26052"  />
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatDate" toolbar:visible="false" toolbar:helpid="helpid:26053"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatScientific" toolbar:visible="false" toolbar:helpid="helpid:26055"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatStandard" toolbar:visible="false" toolbar:helpid="helpid:26052"/>
  <toolbar:toolbaritem xlink:href=".uno:NumberFormatIncDecimals" toolbar:helpid="helpid:26057"  />
  <toolbar:toolbaritem xlink:href=".uno:NumberFormatDecDecimals" toolbar:helpid="helpid:26058"  />
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:DecrementIndent" toolbar:helpid="helpid:10461"  />
- <toolbar:toolbaritem xlink:href=".uno:IncrementIndent" toolbar:helpid="helpid:10462"  />
+ <toolbar:toolbaritem xlink:href=".uno:DecrementIndent" toolbar:visible="false" toolbar:helpid="helpid:10461"/>
+ <toolbar:toolbaritem xlink:href=".uno:IncrementIndent" toolbar:visible="false" toolbar:helpid="helpid:10462"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SetBorderStyle" toolbar:helpid="helpid:10187"  />
- <toolbar:toolbaritem xlink:href=".uno:BackgroundColor" toolbar:helpid="helpid:10185"  toolbar:style="dropdown" />
- <toolbar:toolbaritem xlink:href=".uno:Color" toolbar:helpid="helpid:10017"  toolbar:style="dropdown" />
- <toolbar:toolbaritem xlink:href=".uno:LineStyle" toolbar:helpid="helpid:10200"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:FrameLineColor" toolbar:helpid="helpid:10201"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SetBorderStyle" toolbar:visible="false" toolbar:helpid="helpid:10187"/>
+ <toolbar:toolbaritem xlink:href=".uno:BackgroundColor" toolbar:visible="false" toolbar:helpid="helpid:10185"/>
+ <toolbar:toolbaritem xlink:href=".uno:Color" toolbar:visible="false" toolbar:helpid="helpid:10017"/>
+ <toolbar:toolbaritem xlink:href=".uno:LineStyle" toolbar:visible="false" toolbar:helpid="helpid:10200"/>
+ <toolbar:toolbaritem xlink:href=".uno:FrameLineColor" toolbar:visible="false" toolbar:helpid="helpid:10201"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:InsertRows" toolbar:helpid="helpid:26267"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:InsertColumns" toolbar:helpid="helpid:26268"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:DeleteRows" toolbar:helpid="helpid:26236"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:DeleteColumns" toolbar:helpid="helpid:26237"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:InsertRows" toolbar:visible="false" toolbar:helpid="helpid:26267"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertColumns" toolbar:visible="false" toolbar:helpid="helpid:26268"/>
+ <toolbar:toolbaritem xlink:href=".uno:DeleteRows" toolbar:visible="false" toolbar:helpid="helpid:26236"/>
+ <toolbar:toolbaritem xlink:href=".uno:DeleteColumns" toolbar:visible="false" toolbar:helpid="helpid:26237"/>
 </toolbar:toolbar>
diff --git sc/uiconfig/scalc/toolbar/standardbar.xml sc/uiconfig/scalc/toolbar/standardbar.xml
index a52ed00..acf9c80 100644
--- sc/uiconfig/scalc/toolbar/standardbar.xml
+++ sc/uiconfig/scalc/toolbar/standardbar.xml
@@ -5,18 +5,21 @@
  <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"/>
  <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="helpid:5500"/>
  <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"/>
- <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505"/>
- <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:visible="false" toolbar:helpid="helpid:5502"/>
- <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="helpid:5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="helpid:5331"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312"/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="helpid:6312"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674"/>
- <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509"/>
- <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:helpid="helpid:5325"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:text="Styles et formatage" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid=".uno:FontHeight"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:visible="false" toolbar:helpid="helpid:5325"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:helpid="helpid:20622"/>
- <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid="helpid:12021"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="helpid:20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="helpid:12021"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"/>
  <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"/>
@@ -26,19 +29,21 @@
  <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"/>
  <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="helpid:5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatIncDecimals" toolbar:helpid=".uno:NumberFormatIncDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:NumberFormatDecDecimals" toolbar:helpid=".uno:NumberFormatDecDecimals"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="helpid:5678"/>
  <toolbar:toolbaritem xlink:href=".uno:SortAscending" toolbar:helpid="helpid:26344"/>
  <toolbar:toolbaritem xlink:href=".uno:SortDescending" toolbar:helpid="helpid:26343"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="helpid:26155"/>
- <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:helpid="helpid:10244"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:visible="false" toolbar:helpid="helpid:10244"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:helpid="helpid:5961"  />
- <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="helpid:10366"/>
- <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:helpid="helpid:5960"/>
+ <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:visible="false" toolbar:helpid="helpid:5961"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="helpid:10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:visible="false" toolbar:helpid="helpid:5960"/>
  <toolbar:toolbaritem xlink:href=".uno:ViewDataSourceBrowser" toolbar:helpid="helpid:6660"/>
- <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:helpid="helpid:10000"/>
+ <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:visible="false" toolbar:helpid="helpid:10000"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:HelpIndex"/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
  <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
 </toolbar:toolbar>
diff --git scp2/source/base/file_base.scp scp2/source/base/file_base.scp
index fa6c1cf..25a1c1e 100644
--- scp2/source/base/file_base.scp
+++ scp2/source/base/file_base.scp
@@ -74,13 +74,14 @@ STD_UNO_LIB_FILE( gid_File_Lib_Rptui, rptui )
 STD_RES_FILE( gid_File_Res_Rptui, rptui)
 
 STD_UNO_LIB_FILE( gid_File_Lib_Rptxml, rptxml )
-
+#ifndef OOo4Kids
 File gid_File_Help_Sdatabase_Zip
     Dir = gid_Dir_Help_Isolanguage;
     ARCHIVE_TXT_FILE_BODY;
     EXTRA_ALL_GOOD_HELP_LOCALIZATIONS_LANG(sdatabase);
     Patchfiles = (); 
 End
+#endif
 
 File gid_File_Registry_Spool_Oo_Setup_Base_Xcu
     TXT_FILE_BODY;
diff --git scp2/source/base/makefile.mk scp2/source/base/makefile.mk
index 53d1f0a..628b3e2 100644
--- scp2/source/base/makefile.mk
+++ scp2/source/base/makefile.mk
@@ -41,6 +41,11 @@ TARGETTYPE=CUI
 
 .INCLUDE :	settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .IF "$(ENABLE_REPORTBUILDER)" == "YES"
 SCPDEFS += -DENABLE_REPORTBUILDER
 .ENDIF
diff --git scp2/source/binfilter/makefile.mk scp2/source/binfilter/makefile.mk
index 09d88c4..2bc406e 100644
--- scp2/source/binfilter/makefile.mk
+++ scp2/source/binfilter/makefile.mk
@@ -41,6 +41,11 @@ TARGETTYPE=CUI
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 SCP_PRODUCT_TYPE=osl
 
 PARFILES= \
diff --git scp2/source/impress/makefile.mk scp2/source/impress/makefile.mk
index a2036f5..9b7da6c 100644
--- scp2/source/impress/makefile.mk
+++ scp2/source/impress/makefile.mk
@@ -43,6 +43,10 @@ TARGETTYPE=CUI
 
 SCP_PRODUCT_TYPE=osl
 
+.IF "$(ENABLE_OPENGL)"=="TRUE"
+SCPDEFS+=-DENABLE_OPENGL
+.ENDIF
+
 PARFILES= \
         module_impress.par              \
         file_impress.par 
diff --git scp2/source/impress/module_impress.scp scp2/source/impress/module_impress.scp
index dce65fe..e0e2166 100644
--- scp2/source/impress/module_impress.scp
+++ scp2/source/impress/module_impress.scp
@@ -49,6 +49,9 @@ Module gid_Module_Prg_Impress_Bin
     gid_File_Registry_Spool_Oo_Common_Impress_Xcu,gid_File_Registry_Spool_Oo_Setup_Impress_Xcu,
     gid_File_Oo_Office_Ui_Impresswindowstate_Xcs,gid_File_Oo_Office_Ui_Impresswindowstate_Xcu,
 	gid_File_Lib_Animcore,gid_File_Share_Config_Sofficecfg_Impress_Effects_Xml, gid_File_Share_Config_Sofficecfg_Impress_Transitions_Xml,
+#if defined ENABLE_OPENGL
+    gid_File_Share_Config_Sofficecfg_Impress_Transitions_OGL_Xml,
+#endif
 	gid_File_Oo_Office_Ui_Effects_Xcs, gid_File_Oo_Office_Ui_Effects_Xcu, gid_File_Registry_Spool_Oo_Office_Embedding_Impress_Xcu,
     gid_File_Registry_Spool_Oo_TypeDetection_Impress_Filters_Xcu,gid_File_Registry_Spool_Oo_TypeDetection_Impress_Types_Xcu, gid_File_Tmp_Userinstall_Impress_Inf);
 End
diff --git scp2/source/impress/module_ogltrans.scp scp2/source/impress/module_ogltrans.scp
index 18425e8..9d3791f 100644
--- scp2/source/impress/module_ogltrans.scp
+++ scp2/source/impress/module_ogltrans.scp
@@ -45,7 +45,11 @@ File gid_File_Lib_OpenGLTransitions
     RegistryID = gid_Starregistry_Services_Rdb;
     Dir = SCP2_OOO_BIN_DIR;
   #ifdef UNX
+    #ifdef QUARTZ
+    Name = STRING(CONCAT2(libOGLTrans.uno,UNXSUFFIX));
+    #else
     Name = STRING(CONCAT2(OGLTrans.uno,UNXSUFFIX));
+    #endif
   #else
     Name = "OGLTrans.uno.dll";
   #endif
diff --git scp2/source/javafilter/makefile.mk scp2/source/javafilter/makefile.mk
index 3e34a40..9c59c9c 100644
--- scp2/source/javafilter/makefile.mk
+++ scp2/source/javafilter/makefile.mk
@@ -41,14 +41,19 @@ TARGETTYPE=CUI
 
 .INCLUDE :	settings.mk
 
-.IF "$(SOLAR_JAVA)"=="TRUE"
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+.IF "$(SOLAR_JAVA)"=="TRUE" && "$(OOo4Kids)"!="YES"
 SCP_PRODUCT_TYPE=osl
 PARFILES= \
         module_javafilter.par              \
         file_javafilter.par
 .ENDIF
 
-.IF "$(SOLAR_JAVA)"=="TRUE"
+.IF "$(SOLAR_JAVA)"=="TRUE" && "$(OOo4Kids)"!="YES"
 .IF "$(GUI)"=="WNT"
 PARFILES += \
         registryitem_javafilter.par
diff --git scp2/source/math/file_math.scp scp2/source/math/file_math.scp
index 43436a7..0e00e50 100644
--- scp2/source/math/file_math.scp
+++ scp2/source/math/file_math.scp
@@ -53,12 +53,14 @@ File gid_File_Registry_Spool_Oo_Office_Embedding_Math_Xcu
     Name = "/registry/spool/org/openoffice/Office/Embedding-math.xcu";
 End
 
+#ifndef OOo4Kids
 File gid_File_Help_Smath_Zip
     Dir = gid_Dir_Help_Isolanguage;
     ARCHIVE_TXT_FILE_BODY;
     EXTRA_ALL_GOOD_HELP_LOCALIZATIONS_LANG(smath);
     Patchfiles = ();
 End
+#endif
 
 File gid_File_Exe_Smath
     BIN_FILE_BODY;
diff --git scp2/source/math/makefile.mk scp2/source/math/makefile.mk
index 6237dc6..0a244bf 100644
--- scp2/source/math/makefile.mk
+++ scp2/source/math/makefile.mk
@@ -41,6 +41,10 @@ TARGETTYPE=CUI
 
 .INCLUDE :	settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+SCPDEFS+=-DOOo4Kids
+.ENDIF
+
 SCP_PRODUCT_TYPE=osl
 PARFILES= \
         module_math.par              \
diff --git scp2/source/ooo/common_brand.scp scp2/source/ooo/common_brand.scp
index 8a3b0b4..f1365c0 100644
--- scp2/source/ooo/common_brand.scp
+++ scp2/source/ooo/common_brand.scp
@@ -40,6 +40,8 @@ Module gid_Module_Root_Brand
     Styles = (HIDDEN_ROOT,ROOT_BRAND_PACKAGE,ISUPDATEPACKAGE);
     PackageInfo = "packinfo_brand.txt";
     Dirs = (gid_Brand_Dir_Program,
+        gid_Brand_Dir_Xo_Activity,
+        gid_Brand_Dir_Xo_Bin,
             gid_Brand_Dir_Share,
             gid_Brand_Dir_Share_C05,
             gid_Brand_Dir_Share_C05_Rgt,
@@ -143,7 +145,9 @@ Module gid_Module_Langpack_Brand_Template
     Files = (gid_Brand_File_Res_Iso,
              gid_Brand_File_Res_Ooo,
              gid_Brand_File_Entitlement,
+#ifndef OOo4Kids
              gid_Brand_File_Help_C05_Sdatabase_Zip,
+#endif
              gid_Brand_File_Help_C05_Scalc_Zip,
              gid_Brand_File_Help_C05_Sdraw_Zip,
              gid_Brand_File_Help_C05_Swriter_Zip,
@@ -176,7 +180,6 @@ Directory gid_Brand_Dir_Resource
     ParentID = gid_Brand_Dir_Program;
     DosName = "resource";
 End
-
 Directory gid_Brand_Dir_Readme
 #if defined MACOSX
     ParentID = gid_Brand_Dir_BasisLink;
@@ -342,6 +345,11 @@ Directory gid_Brand_Dir_BasisLink
     ParentID = gid_Dir_Bundle_Contents;
     DosName = "basis-link";
 End
+#elif defined XO_INTEL
+Directory gid_Brand_Dir_BasisLink
+    ParentID = gid_Dir_Brand_Root;
+    DosName = "basis-link";
+End
 #else
 Unixlink gid_Brand_Unixlink_BasisLink
     BIN_FILE_BODY;
@@ -355,6 +363,14 @@ End
 
 // UnixLinks
 
+#ifdef XO_INTEL
+Unixlink gid_Brand_Unixlink_Xo_Soffice
+    Dir = gid_Brand_Dir_Xo_Bin;
+    Name = "soffice";
+    Target = "../resources/program/soffice";
+End
+#endif
+
 #if defined MACOSX
 Unixlink gid_Brand_Unixlink_Urelibs
     Dir = gid_Brand_Dir_Program;
@@ -613,12 +629,21 @@ File gid_Brand_File_Registry_Spool_Oo_Setup_Brand_Xcu
 End
 
 #if defined UNX && ! defined MACOSX
+#if !defined( OOo4Kids )
 File gid_Brand_File_Share_Xdg_Base
     TXT_FILE_BODY;
     Dir = gid_Brand_Dir_Share_Xdg;
     Styles = (PACKED,SCPZIP_REPLACE);
     Name = "base.desktop";
 End
+#else
+File gid_Brand_File_Share_Xdg_OOo4Kids
+    TXT_FILE_BODY;
+    Dir = gid_Brand_Dir_Share_Xdg;
+    Styles = (PACKED,SCPZIP_REPLACE);
+    Name = "ooo4kids.desktop";
+End
+#endif
 #endif
 
 #if defined UNX && ! defined MACOSX
@@ -881,12 +906,37 @@ ProfileItem gid_Brand_Profileitem_Bootstrap_Userinstall
     Value = "$SYSUSERCONFIG/%ONEWORDPRODUCTNAME/%USERDIRPRODUCTVERSION";
   #elif defined MACOSX
     Value = "$SYSUSERCONFIG/%ONEWORDPRODUCTNAME/%USERDIRPRODUCTVERSION";
+  #elif defined( LINUX ) && defined( OOo4Kids )
+    Value = "$SYSUSERCONFIG/.%LCONEWORDPRODUCTNAME/%USERDIRPRODUCTVERSION";
   #else
     Value = "$SYSUSERCONFIG/.%LCONEWORDPRODUCTNAME/%USERDIRPRODUCTVERSION";
   #endif
+
     StandaloneValue = "$ORIGIN/..";
 End
 
+#if defined( OOo4Kids ) && defined( LINUX )
+
+ProfileItem gid_ProfileItem_Soffice_OOo4Kidsrc
+    ProfileID = gid_Brand_Profile_Bootstrap_Ini;
+    ModuleID = gid_Module_Root_Brand;
+    Section = "Bootstrap";
+    Order = 6;
+    Key = "OOo4KidsIntegrationUserFile";
+    Value = "$UserInstallation/user/ooo4kidsrc.txt";
+End
+
+ProfileItem gid_ProfileItem_Soffice_OOo4Kidsrc2
+    ProfileID = gid_Brand_Profile_Bootstrap_Ini;
+    ModuleID = gid_Module_Root_Brand;
+    Section = "Bootstrap";
+    Order = 7;
+    Key = "OOo4KidsIntegrationDefaultFile";
+    Value = "${OOO_BASE_DIR}/presets/ooo4kidsrc.txt";
+End
+
+#endif
+
 ProfileItem gid_Brand_Profileitem_Soffice_UreBootstrap
     ModuleID = gid_Module_Root_Brand;
     ProfileID = gid_Brand_Profile_Soffice_Ini;
@@ -1359,3 +1409,6 @@ File gid_Brand_File_Bin_Python
     Styles = (PACKED);
 End
 #endif
+
+
+
diff --git scp2/source/ooo/directory_ooo.scp scp2/source/ooo/directory_ooo.scp
index 62b569e..837667f 100644
--- scp2/source/ooo/directory_ooo.scp
+++ scp2/source/ooo/directory_ooo.scp
@@ -78,8 +78,27 @@ Directory gid_Dir_Ooo_Openofficeorg
   #ifdef WNT
     HostName = "${BASISROOTNAME}";
   #else
+    #ifdef XO_INTEL
+    HostName = "${UNIXBASISROOTNAME_XO}/resources";
+    #else
     HostName = "${UNIXBASISROOTNAME}";
   #endif
+  #endif
+End
+#endif
+
+#ifdef XO_INTEL
+Directory gid_Brand_Dir_Xo
+    ParentID = PREDEFINED_PROGDIR;
+    HostName = "${UNIXBASISROOTNAME_XO}";
+End
+Directory gid_Brand_Dir_Xo_Activity
+    ParentID = gid_Brand_Dir_Xo;
+    DosName = "activity";
+End
+Directory gid_Brand_Dir_Xo_Bin
+    ParentID = gid_Brand_Dir_Xo;
+    DosName = "bin";
 End
 #endif
 
@@ -92,6 +111,8 @@ Directory gid_Dir_Ooo_Basis
   #endif
   #ifdef WNT
     HostName = "Basis";
+  #elif defined XO_INTEL
+    HostName = "basis-link";
   #else
     HostName = "basis${OOOBASEVERSION}";
   #endif
diff --git scp2/source/ooo/file_extra_ooo.scp scp2/source/ooo/file_extra_ooo.scp
index b2789c3..4732d1d 100644
--- scp2/source/ooo/file_extra_ooo.scp
+++ scp2/source/ooo/file_extra_ooo.scp
@@ -381,18 +381,19 @@ File gid_File_Extra_Tplwizdesktop_Lang
     EXTRA_ALL_LANG(tplwizdesktop);
 End
 
-File gid_File_Extra_Tplwizletter
-    Dir = gid_Dir_Share_Template_Wizard_Letter;
-    ARCHIVE_TXT_FILE_BODY;
-    Name = "tplwizletter.zip";
-End
-
 File gid_File_Extra_Tplwizletter_Lang
     Dir = gid_Dir_Template_Wizard_Letter;
     ARCHIVE_TXT_FILE_BODY;
     EXTRA_ALL_LANG(tplwizletter);
 End
 
+#ifndef OOo4Kids
+File gid_File_Extra_Tplwizletter
+    Dir = gid_Dir_Share_Template_Wizard_Letter;
+    ARCHIVE_TXT_FILE_BODY;
+    Name = "tplwizletter.zip";
+End
+
 File gid_File_Extra_Tplwizfax_Lang
     Dir = gid_Dir_Template_Wizard_Fax;
     TXT_FILE_BODY;
@@ -420,6 +421,7 @@ File gid_File_Extra_Tplwizstyles_Lang
     Styles = (ARCHIVE, DONT_OVERWRITE);
     EXTRA_ALL_LANG(tplwizstyles);
 End
+#endif
 
 File gid_File_Extra_Webcast_Asp
     Dir = gid_Dir_Config_Webcast;
diff --git scp2/source/ooo/file_library_ooo.scp scp2/source/ooo/file_library_ooo.scp
index d4a0dde..cef259f 100644
--- scp2/source/ooo/file_library_ooo.scp
+++ scp2/source/ooo/file_library_ooo.scp
@@ -28,7 +28,7 @@
 ************************************************************************/
 #include "macros.inc"
 
-#ifdef WNT
+#if defined WNT && !defined OOo4Kids
 File gid_File_Lib_Accessbridge
     BIN_FILE_BODY;
     Styles = (PACKED);
@@ -36,6 +36,7 @@ File gid_File_Lib_Accessbridge
     Name = "java_uno_accessbridge.dll";
 End
 #endif
+#ifndef OOo4Kids
 #if ((defined(WNT)) || (defined(LINUX)) || ((defined(SOLARIS)) && (defined(SPARC)))|| defined(NETBSD) )
 STD_UNO_LIB_FILE( gid_File_Lib_Adabas, adabas)
 File gid_File_Oo_Office_Dataaccess_Adabas_Xcu
@@ -45,6 +46,7 @@ File gid_File_Oo_Office_Dataaccess_Adabas_Xcu
     Name = "/registry/spool/DataAccess/adabas.xcu";
 End
 #endif
+#endif
 
 #if defined(WNT)
 STD_UNO_LIB_FILE( gid_File_Lib_Ado, ado)
@@ -58,6 +60,7 @@ End
 
 STD_UNO_LIB_FILE( gid_File_Lib_Basctl, basctl)
 
+#ifndef OOo4Kids
 File gid_File_Lib_Basprov
     TXT_FILE_BODY;
     Styles = (PACKED,UNO_COMPONENT);
@@ -69,6 +72,7 @@ File gid_File_Lib_Basprov
     Name = STRING(CONCAT4(basprov,DLLPOSTFIX,.uno,.dll));
   #endif
 End
+#endif
 
 STD_UNO_LIB_FILE( gid_File_Lib_Bib , bib)
 
@@ -140,7 +144,7 @@ STD_UNO_LIB_FILE(gid_File_Lib_Charttools, charttools)
 STD_UNO_LIB_FILE(gid_File_Lib_Chartview, chartview)
 
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Lib_Cli_Oootypes_Assembly
     TXT_FILE_BODY;
@@ -159,7 +163,7 @@ End
 
 #endif
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 File gid_File_Lib_Policy_Cli_Oootypes_Assembly
     TXT_FILE_BODY;
     Styles = (PACKED, ASSEMBLY, DONTRENAMEINPATCH);
@@ -177,7 +181,7 @@ End
 
 #endif
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Lib_Policy_Cli_Oootypes_Config
     TXT_FILE_BODY;
@@ -269,6 +273,7 @@ End
 #endif
 #endif
 
+#ifndef OOo4Kids
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Dba, dba)
 
 STD_UNO_LIB_FILE( gid_File_Lib_Sdbt, sdbt)
@@ -288,7 +293,6 @@ End
 STD_LIB_FILE( gid_File_Lib_Dbfile , file)
 STD_LIB_FILE( gid_File_Lib_Odbcbase,odbcbase)
 
-
 File gid_File_Lib_Dbpool
     TXT_FILE_BODY;
     Styles = (PACKED,UNO_COMPONENT);
@@ -300,9 +304,11 @@ File gid_File_Lib_Dbpool
     Name = "dbpool2.dll";
   #endif
 End
+#endif
 
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Dbt, dbtools )
 
+#ifndef OOo4Kids
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Dbaxml, dbaxml )
 
 File gid_File_Lib_Dict_Ja
@@ -326,6 +332,7 @@ File gid_File_Lib_Dict_Zh
     Dir = SCP2_OOO_BIN_DIR;
     Styles = (PACKED);
 End
+#endif
 
 File gid_File_Lib_Collator_Data
     TXT_FILE_BODY;
@@ -360,6 +367,7 @@ File gid_File_Lib_Textconv_Dict
     Styles = (PACKED);
 End
 
+#ifndef OOo4Kids
 File gid_File_Lib_Dlgprov
     TXT_FILE_BODY;
     Styles = (PACKED,UNO_COMPONENT,PATCH);
@@ -371,7 +379,7 @@ File gid_File_Lib_Dlgprov
     Name = STRING(CONCAT4(dlgprov,DLLPOSTFIX,.uno,.dll));
   #endif
 End
-
+#endif
 File gid_File_Lib_Stringresource
     TXT_FILE_BODY;
     Styles = (PACKED,UNO_COMPONENT);
@@ -448,6 +456,7 @@ End
 
 #endif
 
+#ifndef OOo4Kids
 #ifdef UNX
 
 #ifdef ENABLE_KAB
@@ -511,6 +520,7 @@ STD_UNO_LIB_FILE( gid_File_Lib_Evoab , evoab)
 #endif  // #ifdef ENABLE_EVOAB2
 
 #endif  // #ifdef UNX
+#endif  // #ifndef OOo4Kids
 
 File gid_File_Lib_Evtatt
     TXT_FILE_BODY;
@@ -603,7 +613,6 @@ End
 #endif
 #endif
 
-#ifdef MACOSX
 #ifdef QUARTZ
 File gid_File_Lib_Fps_Aqua
     TXT_FILE_BODY;
@@ -630,7 +639,6 @@ File gid_File_Lib_avmediaQuickTime
 	Dir = SCP2_OOO_BIN_DIR;
 End
 #endif
-#endif
 
 SPECIAL_UNO_COMPONENT_LIB_FILE( gid_File_Lib_Fps_Office, fps_office.uno )
 SPECIAL_UNO_COMPONENT_LIB_FILE( gid_File_Lib_Fpicker, fpicker.uno )
@@ -819,6 +827,7 @@ End
 
 #ifdef SOLAR_JAVA
 
+#ifndef OOo4Kids
 STD_UNO_LIB_FILE( gid_File_Lib_Jdbc, jdbc)
 File gid_File_Oo_Office_Dataaccess_Jdbc_Xcu
     TXT_FILE_BODY;
@@ -826,9 +835,11 @@ File gid_File_Oo_Office_Dataaccess_Jdbc_Xcu
     Dir = gid_Dir_Share_Registry_Modules_Oo_Office_DataAccess_Drivers;
     Name = "/registry/spool/DataAccess/jdbc.xcu";
 End
+#endif
 
 #endif
 
+#ifndef OOo4Kids
 #ifdef SOLAR_JAVA
 File gid_File_Oo_Office_Dataaccess_Hsqldb_Xcu
     TXT_FILE_BODY;
@@ -849,6 +860,7 @@ File gid_File_Lib_Hsqldb_2
 End
 
 #endif
+#endif
 
 #ifdef WNT
 
@@ -963,6 +975,7 @@ File gid_File_Lib_Mcnttype
   #endif
 End
 
+#ifndef OOo4Kids
 #if !defined(SYSTEM_MOZILLA) && !defined(WITHOUT_MOZILLA) && !defined(MACOSX)
                                                                 // #i91209#
 File gid_File_Oo_Office_Dataaccess_Mozab_Xcu
@@ -994,6 +1007,8 @@ File gid_File_Lib_Mozbootstrap
 End
 
 #endif
+#endif
+
 
 STD_UNO_LIB_FILE(gid_File_Lib_Wpft,wpft)
 
@@ -1108,6 +1123,8 @@ End
 #endif
 #endif
 
+#ifndef OOo4Kids
+
 STD_UNO_LIB_FILE(gid_File_Lib_Mysql,mysql)
 File gid_File_Oo_Office_Dataaccess_Mysql_Xcu
     TXT_FILE_BODY;
@@ -1122,6 +1139,7 @@ File gid_File_Oo_Office_Dataaccess_Odbc_Xcu
     Dir = gid_Dir_Share_Registry_Modules_Oo_Office_DataAccess_Drivers;
     Name = "/registry/spool/DataAccess/odbc.xcu";
 End
+#endif
 
 File gid_File_Registry_Drivers_Zip
     Dir = gid_Dir_Share_Registry_Res_Lang;
@@ -1133,7 +1151,7 @@ End
 
 STD_UNO_LIB_FILE( gid_File_Lib_Offacc, offacc)
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 #ifndef MACOSX
 
 File gid_File_Lib_Officebean
@@ -1456,7 +1474,9 @@ STD_UNO_LIB_FILE( gid_File_Lib_Spl, spl)
 
 SPECIAL_UNO_LIB_FILE(gid_File_Lib_Srtrs1,srtrs1)
 
+#ifndef OOo4Kids
 STD_LIB_FILE( gid_File_Lib_Sts , sts)
+#endif
 
 STD_LIB_FILE_PATCH( gid_File_Lib_Svl, svl )
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Svtools, svt )
@@ -1626,7 +1646,7 @@ STD_UNO_LIB_FILE( gid_File_Lib_Xsltfilter, xsltfilter )
 STD_UNO_LIB_FILE( gid_File_Lib_Xmlfa, xmlfa )
 STD_UNO_LIB_FILE( gid_File_Lib_Xmlfd, xmlfd )
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 UNO_JAR_FILE( gid_File_Jar_Xsltfilter, XSLTFilter )
 UNO_JAR_FILE( gid_File_Jar_Xsltvalidate, XSLTValidate )
 #endif
@@ -1652,12 +1672,14 @@ File gid_File_Lib_Xslt
 End
 #endif
 
-
 STD_UNO_LIB_FILE( gid_File_Lib_Unoxml, unoxml )
 
 // AVMedia
 STD_UNO_LIB_FILE( gid_File_Lib_AVMedia, avmedia )
 
+#ifdef GSTREAMER
+SPECIAL_UNO_LIB_FILE_PATCH( gid_File_Lib_AVMediaGStreamer, avmediagst )
+#else
 #if defined UNX
 #ifdef SOLAR_JAVA
 UNO_JAR_FILE( gid_File_Jar_AVmedia, avmedia )
@@ -1667,6 +1689,7 @@ UNO_JAR_FILE( gid_File_Jar_AVmedia, avmedia )
 SPECIAL_UNO_LIB_FILE( gid_File_Lib_AVMediaWin, avmediawin )
 #endif
 #endif
+#endif
 
 #ifndef WITHOUT_MOZILLA
 File gid_File_Lib_XSec_Framework
@@ -1732,6 +1755,7 @@ End
 //i20156 - end
 #endif
 
+#ifndef OOo4Kids
 File gid_File_Lib_Migrationoo2
     TXT_FILE_BODY;
     Styles = (PACKED,UNO_COMPONENT);
@@ -1743,6 +1767,7 @@ File gid_File_Lib_Migrationoo2
     Name = "migrationoo2.uno.dll";
   #endif
 End
+#endif
 
 File gid_File_Lib_Libtextcat
     TXT_FILE_BODY;
@@ -1759,7 +1784,9 @@ STD_UNO_LIB_FILE( gid_File_Lib_Guesslang, guesslang )
 
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Updchkui , updchk )
 
+//#if !defined( OOo4Kids)
 SPECIAL_UNO_COMPONENT_LIB_FILE_PATCH( gid_File_Lib_Updatefeed , updatefeed.uno )
+//#endif
 
 #ifdef WNT
 File gid_File_Lib_Onlinecheck
@@ -1807,7 +1834,9 @@ File gid_File_Lib_Unopkgapp
     Styles = (PACKED);
 End
 
+//#if !defined( OOo4Kids)
 STD_UNO_LIB_FILE_PATCH( gid_File_Lib_Oooimprovecore , oooimprovecore)
+//#endif
 
 #if defined WNT && !defined _gcc3 && !defined SYSTEM_MOZILLA && !defined WITHOUT_MOZILLA && \
     !(defined M1400 && defined PROF_EDITION && !defined _STLP_DEBUG)
@@ -1827,6 +1856,8 @@ File gid_File_Moz_Msvcr80
 End
 #endif
 
+
+#ifndef OOo4Kids
 #ifndef SYSTEM_REDLAND
 File gid_File_Lib_Raptor
     TXT_FILE_BODY;
@@ -1887,7 +1918,7 @@ End
 #endif // SYSTEM_REDLAND
 
 STD_UNO_LIB_FILE(gid_File_Lib_Unordf, unordf)
+#endif // OOo4Kids
 
 STD_UNO_LIB_FILE( gid_File_Lib_For, for)
 STD_LIB_FILE( gid_File_Lib_Forui, forui)
-
diff --git scp2/source/ooo/file_ooo.scp scp2/source/ooo/file_ooo.scp
index 26b6bda..23564dd 100644
--- scp2/source/ooo/file_ooo.scp
+++ scp2/source/ooo/file_ooo.scp
@@ -412,21 +412,21 @@ File gid_File_Help_Help_Zip
     ARCHIVE_TXT_FILE_BODY;
     Name = "helpxsl.zip";
 End
-
+#ifndef OOo4Kids 
 File gid_File_Help_Sbasic_Zip
     Dir = gid_Dir_Help_Isolanguage;
     ARCHIVE_TXT_FILE_BODY;
     EXTRA_ALL_GOOD_HELP_LOCALIZATIONS_LANG(sbasic);
     Patchfiles = ();
 End
-
+#endif
 File gid_File_Help_Schart_Zip
     Dir = gid_Dir_Help_Isolanguage;
     ARCHIVE_TXT_FILE_BODY;
     EXTRA_ALL_GOOD_HELP_LOCALIZATIONS_LANG(schart);
 End
 
-#if defined INCLUDE_JAVA_ACCESSBRIDGE && defined WNT
+#if defined INCLUDE_JAVA_ACCESSBRIDGE && defined WNT && !defined OOo4Kids
 
 File gid_File_Jar_Accessbridge
     TXT_FILE_BODY;
@@ -438,12 +438,15 @@ End
 
 #endif
 
+#ifndef OOo4Kids
 #ifdef SOLAR_JAVA
 #ifndef SYSTEM_BSH
 STD_JAR_FILE( gid_File_Jar_Bsh, bsh )
 #endif
 #endif
+#endif 
 
+#ifndef OOo4Kids
 #ifdef SOLAR_JAVA
 #ifndef SYSTEM_LUCENE
 STD_JAR_FILE( gid_File_Jar_Lucene_Core, lucene-core-2.3 )
@@ -458,8 +461,9 @@ UNO_JAR_FILE( gid_File_Jar_Lucenehelpwrapper, LuceneHelpWrapper )
 #ifdef SOLAR_JAVA
 STD_JAR_FILE( gid_File_Jar_Js, js )
 #endif
+#endif
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 
 #ifndef MACOSX
 
@@ -474,8 +478,7 @@ End
 
 #endif
 
-
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 UNO_JAR_FILE( gid_File_Jar_Report, report )
 UNO_JAR_FILE( gid_File_Jar_Table, table )
 UNO_JAR_FILE( gid_File_Jar_Letter, letter )
@@ -486,14 +489,14 @@ UNO_JAR_FILE( gid_File_Jar_Query, query )
 UNO_JAR_FILE( gid_File_Jar_Web, web )
 #endif
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 #ifndef SYSTEM_HSQLDB
 STD_JAR_FILE( gid_File_Jar_Hsqldb, hsqldb )
 #endif
 STD_JAR_FILE( gid_File_Jar_Hsqldb_Sdbc, sdbc_hsqldb )
 #endif
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Jar_Commonwizards
     TXT_FILE_BODY;
     Name = JARFILENAME(commonwizards);
@@ -502,7 +505,7 @@ File gid_File_Jar_Commonwizards
 End
 #endif
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 #ifndef GCJ
 File gid_File_Jar_Sandbox
     TXT_FILE_BODY;
@@ -513,14 +516,16 @@ End
 #endif
 #endif
 
+#ifndef OOo4Kids
 #ifdef SOLAR_JAVA
 UNO_JAR_FILE( gid_File_Jar_Scriptframework, ScriptFramework )
 UNO_JAR_FILE( gid_File_Jar_Scriptproviderforbeanshell, ScriptProviderForBeanShell )
 UNO_JAR_FILE( gid_File_Jar_Scriptproviderforjava, ScriptProviderForJava )
 UNO_JAR_FILE( gid_File_Jar_Scriptproviderforjavascript, ScriptProviderForJavaScript )
 #endif
+#endif
 
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 
 File gid_File_Jar_Unoil
     TXT_FILE_BODY;
@@ -531,11 +536,13 @@ End
 
 #endif
 
+#ifndef OOo4Kids
 #ifdef SOLAR_JAVA
 #ifndef SYSTEM_SAXON
 STD_JAR_FILE( gid_File_Jar_Saxon, saxon9 )
 #endif
 #endif
+#endif
 
 // fingerprint files (lm)
 
@@ -2286,6 +2293,7 @@ File gid_File_Registry_Spool_Oo_Office_Writer_PyMailMerge_Xcu
     Styles = (PACKED);
 End
 
+#ifndef OOo4Kids
 File gid_File_Scripts_Beanshell
     Dir = gid_Dir_Share_Scripts;
     ARCHIVE_TXT_FILE_BODY;
@@ -2305,6 +2313,7 @@ File gid_File_Scripts_Javascript
     ARCHIVE_TXT_FILE_BODY;
     Name = "ScriptsJavaScript.zip";
 End
+#endif
 
 // new user interface configuration files
 File gid_File_Share_Config_Sofficecfg_uiconfig_Zip
@@ -2889,12 +2898,14 @@ File gid_File_Jar_Productregistration
 End
 #endif
 
+#ifndef OOo4Kids
 File gid_File_Images_Zip
     TXT_FILE_BODY;
     Dir = gid_Dir_Share_Config;
     Name = "images.zip";
     Styles = (PACKED,PATCH);
 End
+#endif
 
 File gid_File_ImagesCrystal_Zip
     TXT_FILE_BODY;
@@ -2903,6 +2914,7 @@ File gid_File_ImagesCrystal_Zip
     Styles = (PACKED);
 End
 
+#ifndef OOo4Kids
 File gid_File_ImagesHicontrast_Zip
     TXT_FILE_BODY;
     Dir = gid_Dir_Share_Config;
@@ -2923,13 +2935,16 @@ File gid_File_ImagesTango_Zip
     Name = "images_tango.zip";
     Styles = (PACKED);
 End
+#endif
 
+#ifndef OOo4Kids
 File gid_File_ImagesClassic8_Zip
     TXT_FILE_BODY;
     Dir = gid_Dir_Share_Config;
     Name = "images_classic.zip";
     Styles = (PACKED);
 End
+#endif
 
 File gid_File_Registry_Spool_Oo_Office_Linguistic_Lingucomponent_Spellchecker_Xcu
     TXT_FILE_BODY;
@@ -3026,6 +3041,7 @@ File gid_File_Extension_Dictionary_En
 End
 #endif
 
+#ifndef OOo4Kids
 #ifndef WITHOUT_MYSPELL_DICTS
 File gid_File_Extension_Dictionary_Es
 	Dir = gid_Brand_Dir_Share_Extension_Install;
@@ -3034,6 +3050,7 @@ File gid_File_Extension_Dictionary_Es
 	UnixRights = 444;
 End
 #endif
+#endif
 
 #ifndef WITHOUT_MYSPELL_DICTS
 File gid_File_Extension_Dictionary_Et
@@ -3241,3 +3258,47 @@ End
 //    UnixRights = 444;
 // End
 // #endif
+
+
+#if defined( LINUX ) && defined( OOo4Kids )
+File gid_File_Bin_OOo4Kidsrc
+    TXT_FILE_BODY;
+    Dir = gid_Dir_User;
+    Name = "ooo4kidsrc.txt";
+    Styles = (PACKED, WORKSTATION);
+End
+#endif
+
+#ifdef XO_INTEL
+File gid_File_Bin_MANIFEST
+    TXT_FILE_BODY;
+    Dir = gid_Brand_Dir_Xo;
+    Name = "MANIFEST";
+    Styles = (PACKED, WORKSTATION);
+End
+File gid_File_Bin_setup.py
+    TXT_FILE_BODY;
+    Dir = gid_Brand_Dir_Xo;
+    Name = "setup.py";
+    Styles = (PACKED, WORKSTATION);
+End
+File gid_File_Bin_Activity_Info
+    TXT_FILE_BODY;
+    Dir = gid_Brand_Dir_Xo_Activity;
+    Name = "activity.info";
+    Styles = (PACKED, WORKSTATION);
+End
+File gid_File_Bin_Activity_Svg
+    TXT_FILE_BODY;
+    Dir = gid_Brand_Dir_Xo_Activity;
+    Name = "activity-ooo4kids.svg";
+    Styles = (PACKED, WORKSTATION);
+End
+
+File gid_File_Bin_Xo_Activity_Bin_SugarOOo4Kids
+    TXT_FILE_BODY;
+    Dir = gid_Brand_Dir_Xo_Bin;
+    Name = "sugarOOo4Kids";
+    Styles = (PACKED, WORKSTATION);
+End
+#endif
diff --git scp2/source/ooo/file_resource_ooo.scp scp2/source/ooo/file_resource_ooo.scp
index 14b02d2..712d505 100644
--- scp2/source/ooo/file_resource_ooo.scp
+++ scp2/source/ooo/file_resource_ooo.scp
@@ -38,11 +38,13 @@ STD_RES_FILE( gid_File_Res_Cal, cal )
 
 STD_RES_FILE( gid_File_Res_Chartcontroller, chartcontroller )
 
+#ifndef OOo4Kids
 STD_RES_FILE( gid_File_Res_Dba, dba)
 
 STD_RES_FILE( gid_File_Res_Sdbt, sdbt)
 
 STD_RES_FILE( gid_File_Res_Dbmm, dbmm)
+#endif
 
 STD_RES_FILE( gid_File_Res_Dbw, dbw )
 
diff --git scp2/source/ooo/folderitem_ooo.ulf scp2/source/ooo/folderitem_ooo.ulf
index dfa22d0..35a62bd 100644
--- scp2/source/ooo/folderitem_ooo.ulf
+++ scp2/source/ooo/folderitem_ooo.ulf
@@ -35,4 +35,4 @@ en-US = "From Template"
 en-US = "Open Document"
 
 [STR_FI_TOOLTIP_SOFFICE]
-en-US = "The office productivity suite compatible to the open and standardized ODF document format. Supported by Sun Microsystems."
+en-US = "OOo4Kids, the office productivity suite provided by EducOOo. See http://www.educoo.org"
diff --git scp2/source/ooo/makefile.mk scp2/source/ooo/makefile.mk
index 345f28a..4adb0a8 100644
--- scp2/source/ooo/makefile.mk
+++ scp2/source/ooo/makefile.mk
@@ -41,10 +41,21 @@ TARGETTYPE=CUI
 .INCLUDE :  settings.mk
 .INCLUDE :  i18npool/version.mk
 
+.IF "$(OOo4Kids)"=="YES"
+SCPDEFS+=-DOOo4Kids
+.IF "$(XO_INTEL)"=="YES"
+ADDCDEFS+=-DXO_INTEL
+.ENDIF
+.ENDIF
+
 .IF "$(COM)" == "MSC"
 SCPDEFS+=-D_MSC
 .ENDIF
 
+.IF "$(ENABLE_OPENGL)"=="TRUE"
+SCPDEFS+=-DENABLE_OPENGL
+.ENDIF
+
 .IF "$(ENABLE_CRASHDUMP)"!=""
 SCPDEFS+=-DENABLE_CRASHDUMP
 .ENDIF
diff --git scp2/source/ooo/module_hidden_ooo.scp scp2/source/ooo/module_hidden_ooo.scp
index 73bdc5d..edc5bad 100644
--- scp2/source/ooo/module_hidden_ooo.scp
+++ scp2/source/ooo/module_hidden_ooo.scp
@@ -107,9 +107,11 @@ Module gid_Module_Root_Files_3
 	gid_File_Jar_Commonwizards,
 	gid_File_Jar_Sandbox,
 	gid_File_Jar_Scriptframework,
+#ifndef OOo4Kids
 	gid_File_Jar_Scriptproviderforbeanshell,
 	gid_File_Jar_Scriptproviderforjava,
 	gid_File_Jar_Scriptproviderforjavascript,
+#endif
 	gid_File_Jar_Xml_Apis,
 	gid_File_Jar_Bsh,
 	gid_File_Jar_Classes,
@@ -121,9 +123,11 @@ Module gid_Module_Root_Files_3
 	gid_File_Jar_Xflatxml,
 	gid_File_Jar_Xmerge,
 	gid_File_Jar_Xmergebridge,
+#ifndef OOo4Kids
 	gid_File_Jar_Lucene_Core,
 	gid_File_Jar_Lucene_Analyzers,
 	gid_File_Jar_Lucenehelpwrapper,
+#endif
 	gid_File_Rdb_Offapi,
 	gid_Starregistry_Services_Rdb);
 End
@@ -218,6 +222,7 @@ Module gid_Module_Root_Files_4
 	gid_File_Lib_Svx,
 	gid_File_Lib_AVMedia,
 	gid_File_Lib_AVMediaWin,
+    gid_File_Lib_AVMediaGStreamer,
 	gid_File_Lib_BaseGfx,
 	gid_File_Lib_Sysdtrans,
 	gid_File_Lib_Sw,
diff --git scp2/source/ooo/ooo_brand.scp scp2/source/ooo/ooo_brand.scp
index cc5780b..e16fda8 100644
--- scp2/source/ooo/ooo_brand.scp
+++ scp2/source/ooo/ooo_brand.scp
@@ -36,8 +36,13 @@ Directory gid_Dir_Brand_Root
   #ifdef WNT
     HostName = "${PRODUCTNAME} ${BRANDPACKAGEVERSION}";
   #else
+    #ifdef XO_INTEL
+//	HostName = "${UNIXBASISROOTNAME_XO}";
+    HostName = "${UNIXBASISROOTNAME_XO}/resources";
+    #else
     HostName = "${UNIXPRODUCTNAME}${BRANDPACKAGEVERSION}";
   #endif
+  #endif
     Styles = (OFFICEDIRECTORY);
 End
 #endif
diff --git scp2/source/ooo/profileitem_ooo.scp scp2/source/ooo/profileitem_ooo.scp
index 69c771c..0fd2935 100644
--- scp2/source/ooo/profileitem_ooo.scp
+++ scp2/source/ooo/profileitem_ooo.scp
@@ -561,6 +561,8 @@ ProfileItem gid_Profileitem_Fundamentalbasis_Ure_Bin_Dir
     Key = "URE_BIN_DIR";
 #if defined WNT
     Value = "${.link:$ORIGIN/../ure-link}/bin";
+#elif defined XO_INTEL
+    Value = "$ORIGIN/../../ure/bin";
 #else
     Value = "$ORIGIN/../ure-link/bin";
 #endif
@@ -573,6 +575,8 @@ ProfileItem gid_Profileitem_Fundamentalbasis_Ure_Lib_Dir
     Key = "URE_LIB_DIR";
 #if defined WNT
     Value = "${.link:$ORIGIN/../ure-link}/bin";
+#elif defined XO_INTEL
+    Value = "$ORIGIN/../../ure/lib";
 #else
     Value = "$ORIGIN/../ure-link/lib";
 #endif
diff --git scp2/source/ooo/registryitem_ooo.scp scp2/source/ooo/registryitem_ooo.scp
index d06c4bd..34e55ce 100644
--- scp2/source/ooo/registryitem_ooo.scp
+++ scp2/source/ooo/registryitem_ooo.scp
@@ -209,7 +209,11 @@ RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Sta
     ModuleID = gid_Module_Root;
     Subkey = "Software\Microsoft\Windows\CurrentVersion\Uninstall\%PRODUCTNAME %PRODUCTVERSION";
     Name = "HelpLink";
+#if defined OOo4Kids
+    Value = "http://wiki.ooo4kids.org";
+#else
     Value = "http://www.openoffice.org/servlets/HelpTOC";
+#endif
 End
 
 RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Staroffice_Modifypath
@@ -225,7 +229,7 @@ RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Sta
     ModuleID = gid_Module_Root;
     Subkey = "Software\Microsoft\Windows\CurrentVersion\Uninstall\%PRODUCTNAME %PRODUCTVERSION";
     Name = "Publisher";
-    Value = "Sun Microsystems, Inc. for the OpenOffice.org-Community";
+    Value = "The OOo4Kids and the OpenOffice.org-Community";
 End
 
 RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Staroffice_Uninstallstring
@@ -241,7 +245,7 @@ RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Sta
     ModuleID = gid_Module_Root;
     Subkey = "Software\Microsoft\Windows\CurrentVersion\Uninstall\%PRODUCTNAME %PRODUCTVERSION";
     Name = "URLInfoAbout";
-    Value = "http://www.openoffice.org/";
+    Value = "http://wiki.ooo4kids.org/";
 End
 
 RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Staroffice_Urlupdateinfo
@@ -249,12 +253,20 @@ RegistryItem gid_Regitem_Software_Microsoft_Windows_Currentversion_Uninstall_Sta
     ModuleID = gid_Module_Root;
     Subkey = "Software\Microsoft\Windows\CurrentVersion\Uninstall\%PRODUCTNAME %PRODUCTVERSION";
     Name = "URLUpdateInfo";
+#ifdef OOo4Kids
+    Value = "http://download.ooo4kids.org";
+#else
     Value = "http://www.openoffice.org/dev_docs/source/download.html#newsoftware";
+#endif
 End
 
 RegistryItem gid_Regitem_Software_Openoffice_Productname_Productversion_Path
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\%PRODUCTNAME\%PRODUCTVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\%PRODUCTNAME\%PRODUCTVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "Path";
 	Value = "<progpath>\program\soffice.exe";
@@ -280,7 +292,11 @@ End
 
 RegistryItem gid_Regitem_Software_OpenOfficeorg_Ooobaseversion_Install
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "INSTALLLOCATION";
 	Value = "[INSTALLLOCATION]";
@@ -325,7 +341,11 @@ End
 
 RegistryItem gid_Regitem_Software_OpenOfficeorg_Ooobaseversion_Officeinstall
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "OFFICEINSTALLLOCATION";
 	Value = "[OFFICEINSTALLLOCATION]";
@@ -352,7 +372,11 @@ End
 
 RegistryItem gid_Regitem_Software_OpenOfficeorg_Ooobaseversion_Basisinstall
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\${REGISTRYLAYERNAME}\Basis\%OOOBASEVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\${REGISTRYLAYERNAME}\Basis\%OOOBASEVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "BASISINSTALLLOCATION";
 	Value = "[BASISINSTALLLOCATION]";
@@ -361,7 +385,11 @@ End
 
 RegistryItem gid_Regitem_Software_OpenOfficeorg_Ooobaseversion_Layer_Basisinstall
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "BASISINSTALLLOCATION";
 	Value = "[BASISINSTALLLOCATION]";
@@ -388,7 +416,11 @@ End
 
 RegistryItem gid_Regitem_Software_OpenOfficeorg_Ooobaseversion_Ureinstall
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4kids\${REGISTRYLAYERNAME}\URE\%URELAYERVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\${REGISTRYLAYERNAME}\URE\%URELAYERVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "UREINSTALLLOCATION";
 	Value = "[UREINSTALLLOCATION]";
@@ -397,7 +429,11 @@ End
 
 RegistryItem gid_Regitem_Software_OpenOfficeorg_Ooobaseversion_Layer_Ureinstall
 	ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#else
 	Subkey = "Software\OpenOffice.org\${REGISTRYLAYERNAME}\%PRODUCTNAME\%BRANDPACKAGEVERSION";
+#endif
 	ModuleID = gid_Module_Root;
 	Name = "UREINSTALLLOCATION";
 	Value = "[UREINSTALLLOCATION]";
@@ -520,14 +556,22 @@ End
 
 RegistryItem gid_Regitem_Software_Openofficeorg_Uno_Installpath
     ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\UNO\InstallPath";
+#else
     Subkey = "Software\OpenOffice.org\UNO\InstallPath";
+#endif
     ModuleID = gid_Module_Root;
     Value  = "<progpath>\program";
 End
 
 RegistryItem gid_Regitem_Software_Openofficeorg_Uno_Installpath_Branded
     ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids\UNO\InstallPath";
+#else
     Subkey = "Software\OpenOffice.org\UNO\InstallPath";
+#endif
     ModuleID = gid_Module_Root;
     Name = "%PRODUCTNAME %PRODUCTVERSION";
     Value  = "<progpath>\program";
diff --git scp2/source/ooo/registryitem_ooo.ulf scp2/source/ooo/registryitem_ooo.ulf
index cbcf513..370fc6e 100644
--- scp2/source/ooo/registryitem_ooo.ulf
+++ scp2/source/ooo/registryitem_ooo.ulf
@@ -41,4 +41,4 @@ en-US = "%PRODUCTNAME %SXWFORMATVERSION Configuration File"
 en-US = "StarOffice 5.0 Template"
 
 [STR_REG_VAL_APPCAPABILITY_DESCRIPTION_OOO]
-en-US = "OpenOffice.org"
+en-US = "OOo4Kids"
diff --git scp2/source/ooo/scpaction_ooo.scp scp2/source/ooo/scpaction_ooo.scp
index f887374..a6e2694 100644
--- scp2/source/ooo/scpaction_ooo.scp
+++ scp2/source/ooo/scpaction_ooo.scp
@@ -30,6 +30,8 @@
 
 #include "macros.inc"
 
+#ifndef OOo4Kids
+
 ScpAction scp_Copy_License_Html
   #ifdef UNX
     README_TXT_ALL_LANG(Copy, LICENSE, html);
@@ -102,6 +104,8 @@ ScpAction scp_Copy_Readme_Txt
   #endif
 End
 
+#endif
+
 #if defined(WNT) && defined(_gcc3)
 ScpAction SCP_COPY_MINGWM10
     Copy = "mingwm10.dll";
@@ -168,6 +172,7 @@ End
 
 // Setup help files
 
+#ifndef OOo4Kids
 ScpAction scp_Copy_Xpd_Help_Html_Acceptlicense
     README_TXT_ALL_LANG(Copy, AcceptLicense, html);
     README_TXT_ALL_LANG(Name, AcceptLicense, html);
@@ -350,6 +355,8 @@ ScpAction scp_Copy_Xpd_Help_Html_Uninstallationprologue_En_Us
     Subdir = "installdata/html";
 End
 
+#endif
+
 #if defined LINUX || defined SOLARIS
 ScpAction scp_Copy_Update_Script
     Copy = "update";
@@ -359,9 +366,13 @@ ScpAction scp_Copy_Update_Script
 End
 #endif
 
-#ifdef MACOSX
+#if defined(MACOSX )
 ScpAction scp_Copy_Dmg_Background_Image
+#if defined( OOo4Kids )
+    Copy = "ooo4kids_dnd.png";
+#else
     Copy = "osxdndinstall.png";
+#endif
     Name = "background.png";
     UnixRights = 444;
     Styles = ();
diff --git scp2/source/ooo/shortcut_ooo.scp scp2/source/ooo/shortcut_ooo.scp
index 3824fe3..4b1fb99 100644
--- scp2/source/ooo/shortcut_ooo.scp
+++ scp2/source/ooo/shortcut_ooo.scp
@@ -86,6 +86,8 @@ End
 
 #endif
 
+#ifndef OOo4Kids
+
 #ifdef MACOSX
 
 Shortcut gid_Shortcut_Lib_Hsqldb_2
@@ -96,5 +98,5 @@ Shortcut gid_Shortcut_Lib_Hsqldb_2
 End
 
 #endif
-
+#endif // OOo4Kids
 //i44154 -end-
diff --git scp2/source/ooo/ure.scp scp2/source/ooo/ure.scp
index 1c260e2..abc0883 100755
--- scp2/source/ooo/ure.scp
+++ scp2/source/ooo/ure.scp
@@ -331,7 +331,7 @@ File gid_File_Dl_Jvmfwk
     // CompID = "4E128F82-FA30-4077-88DC-F745C3330093";
 End
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA  && !defined OOo4Kids
 File gid_File_Dl_Sunjavaplugin
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -341,7 +341,7 @@ File gid_File_Dl_Sunjavaplugin
 End
 #endif
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Dl_JrepropertiesClass
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -367,7 +367,7 @@ File gid_File_Dl_ComnameUno
     // CompID = "3FAFBDCB-96FE-4D9E-B655-CA86FE674711";
 End
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Dl_JavaUno
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -377,7 +377,7 @@ File gid_File_Dl_JavaUno
 End
 #endif
 
-#if defined SOLAR_JAVA && defined MACOSX
+#if defined SOLAR_JAVA && defined MACOSX && !defined OOo4Kids
 Shortcut gid_Shortcut_Dl_JavaUno
     FileID = gid_File_Dl_JavaUno;
     Dir = SCP2_URE_DL_DIR;
@@ -417,7 +417,7 @@ File gid_File_Dl_LogUnoUno
     Styles = (PACKED, VERSION_INDEPENDENT_COMP_ID);
 End
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 File gid_File_Dl_Cli_Uno
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -427,7 +427,7 @@ File gid_File_Dl_Cli_Uno
 End
 #endif
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Dl_Cli_Ure_Assembly
     TXT_FILE_BODY;
@@ -446,7 +446,7 @@ End
 
 #endif
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Dl_Policy_Cli_Ure_Assembly
     TXT_FILE_BODY;
@@ -465,7 +465,7 @@ End
 
 #endif
 
-#if defined WNT && defined _MSC 
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Dl_Policy_Cli_Ure_Config
     TXT_FILE_BODY;
@@ -477,6 +477,7 @@ End
 
 #endif
 
+#if !defined OOo4Kids
 #if defined WNT && defined _MSC
 
 File gid_File_Dl_Cli_Basetypes_Assembly
@@ -577,7 +578,7 @@ End
 
 #endif
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Lib_Cli_Cppuhelper_Assembly
     TXT_FILE_BODY;
@@ -615,7 +616,7 @@ End
 
 #endif
 
-#if defined WNT && defined _MSC
+#if defined WNT && defined _MSC && !defined OOo4Kids
 
 File gid_File_Lib_Policy_Cli_Cppuhelper_Config
     TXT_FILE_BODY;
@@ -627,7 +628,9 @@ End
 
 #endif
 
-#if defined SOLAR_JAVA
+#endif // !defined OOo4Kids
+
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Dl_Jpipe
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -637,7 +640,7 @@ File gid_File_Dl_Jpipe
 End
 #endif
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Dl_Juh
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -647,7 +650,7 @@ File gid_File_Dl_Juh
 End
 #endif
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Dl_Juhx
     TXT_FILE_BODY;
     Dir = SCP2_URE_DL_DIR;
@@ -720,7 +723,7 @@ File gid_File_Dl_Invocation
     // CompID = "A79ACB80-DA65-47CA-81BA-7CD9E191C84C";
 End
 
-
+#ifndef OOo4Kids
 #if defined SOLAR_JAVA
 File gid_File_Dl_Javaloader
     TXT_FILE_BODY;
@@ -742,6 +745,7 @@ File gid_File_Dl_Javavm
     // CompID = "F1266B2B-80AD-4248-A921-9161759FA4DA";
 End
 #endif
+#endif
 
 File gid_File_Dl_Namingservice
     TXT_FILE_BODY;
@@ -997,7 +1001,7 @@ End
 
 // Public JARs:
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA  && !defined OOo4Kids
 File gid_File_Java_UnoloaderJar
     TXT_FILE_BODY;
     Dir = gid_Dir_Ure_Java;
@@ -1007,7 +1011,7 @@ File gid_File_Java_UnoloaderJar
 End
 #endif
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Java_JuhJar
     TXT_FILE_BODY;
     Dir = gid_Dir_Ure_Java;
@@ -1028,7 +1032,7 @@ File gid_File_Java_JurtJar
 End
 #endif
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids
 File gid_File_Java_RidlJar
     TXT_FILE_BODY;
     Dir = gid_Dir_Ure_Java;
@@ -1040,7 +1044,7 @@ End
 
 // Private JARs:
 
-#if defined SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined OOo4Kids 
 File gid_File_Java_JavaUnoJar
     TXT_FILE_BODY;
     Dir = gid_Dir_Ure_Java;
@@ -1073,15 +1077,16 @@ End
 #endif
 
 // StarRegistry File
-
 File gid_Starregistry_Services_Rdb_Ure
     TXT_FILE_BODY;
     Name = "services.rdb";
     Dir = gid_Dir_Ure_Misc;
     Styles = (PACKED, STARREGISTRY, VERSION_INDEPENDENT_COMP_ID);
     NativeServicesURLPrefix = "vnd.sun.star.expand:$URE_INTERNAL_LIB_DIR/";
+#if !defined OOo4Kids
     JavaServicesURLPrefix = "vnd.sun.star.expand:$URE_INTERNAL_JAVA_DIR/";
     // CompID = "F4BD7B0A-5A20-4167-9D10-18597C5F85AF";
+#endif
 End
 
 #if defined MACOSX
@@ -1108,9 +1113,12 @@ Module gid_Module_Root_Ure_Hidden
             gid_Dir_Ure_Share,
             gid_Dir_Ure_Java,
             gid_Dir_Ure_Misc);
-    Files = (gid_File_ThirdpartylicensereadmeHtml_Ure,
+    Files = (
+#ifndef OOo4Kids
+    gid_File_ThirdpartylicensereadmeHtml_Ure,
             gid_File_Readme_Ure,
             gid_File_License_Ure,
+#endif
             gid_File_Exe_Uno,
             gid_File_Exe_Regcomp,
             gid_File_Exe_Regmerge,
@@ -1155,9 +1163,11 @@ Module gid_Module_Root_Ure_Hidden
             gid_File_Dl_UnsafeUnoUno,
             gid_File_Dl_AffineUnoUno,
             gid_File_Dl_LogUnoUno,
+#ifndef OOo4Kids
             gid_File_Dl_Jpipe,
             gid_File_Dl_Juh,
             gid_File_Dl_Juhx,
+#endif
             gid_File_Dl_Acceptor,
             gid_File_Dl_Bootstrap,
             gid_File_Dl_Bridgefac,
@@ -1165,8 +1175,10 @@ Module gid_Module_Root_Ure_Hidden
             gid_File_Dl_Introspection,
             gid_File_Dl_Invocadapt,
             gid_File_Dl_Invocation,
+#ifndef OOo4Kids
             gid_File_Dl_Javaloader,
             gid_File_Dl_Javavm,
+#endif
             gid_File_Dl_Namingservice,
             gid_File_Dl_Proxyfac,
             gid_File_Dl_Reflection,
@@ -1192,7 +1204,9 @@ Module gid_Module_Root_Ure_Hidden
             gid_File_Lib_Msvcm80_Ure,
             gid_File_Msvcm80crt_Manifest_Ure,
             gid_File_Java_UnoloaderJar,
+#ifndef OOo4Kids
             gid_File_Java_JuhJar,
+#endif
             gid_File_Java_JurtJar,
             gid_File_Java_RidlJar,
             gid_File_Java_JavaUnoJar,
@@ -1264,7 +1278,11 @@ End
 RegistryItem gid_Regitem_Path
     ModuleID = gid_Module_Root;
     ParentID = PREDEFINED_HKEY_CLASSES_ROOT;
+#ifdef OOo4Kids
+    Subkey = "Software\OOo4Kids\%PRODUCTNAME";
+#else
     Subkey = "Software\OpenOffice.org\%PRODUCTNAME";
+#endif
     Name = "Path";
     Value = "[UREINSTALLLOCATION]";
 End
diff --git scp2/source/ooo/ure_standalone.scp scp2/source/ooo/ure_standalone.scp
index d4fd951..d160fee 100755
--- scp2/source/ooo/ure_standalone.scp
+++ scp2/source/ooo/ure_standalone.scp
@@ -45,10 +45,18 @@ End
 Directory gid_Dir_Ooo_Openofficeorg
     ParentID = PREDEFINED_PROGDIR;
   #ifdef WNT
+    #ifdef OOo4Kids
+    HostName = "OOo4Kids";
+    #else
     HostName = "OpenOffice.org";
+    #endif
+  #else
+    #ifdef OOo4Kids
+    HostName = "OOo4Kids";
   #else
     HostName = "openoffice.org";
   #endif
+  #endif
 End
 
 Directory gid_Dir_Common_Ure
@@ -60,7 +68,7 @@ Directory gid_Dir_Common_Ure
   #endif
     Styles = (UREDIRECTORY);
 End
-
+#ifndef OOo4Kids
 File gid_File_License_Ure
     TXT_FILE_BODY;
     Dir = gid_Dir_Common_Ure;
@@ -82,6 +90,8 @@ File gid_File_Readme_Ure
     Styles = (PACKED);
 End
 
+#endif
+
 // Module
 
 Module gid_Module_Root
diff --git scp2/source/quickstart/registryitem_quickstart.scp scp2/source/quickstart/registryitem_quickstart.scp
index 3a10ff7..91489c8 100644
--- scp2/source/quickstart/registryitem_quickstart.scp
+++ scp2/source/quickstart/registryitem_quickstart.scp
@@ -32,7 +32,11 @@
 
 RegistryItem gid_Regitem_Software_OpenOffice_Quickstarterinstalled
     ParentID = PREDEFINED_HKEY_LOCAL_MACHINE;
+#if defined OOo4Kids
+    Subkey = "Software\OOo4Kids";
+#else
     Subkey = "Software\OpenOffice.org";
+#endif
     ModuleID = gid_Module_Optional_Quickstart;
     Name = "QuickStarterInstalled";
     Value = "1";
diff --git scp2/source/sdkoo/makefile.mk scp2/source/sdkoo/makefile.mk
index 5a4fdf7..6fed3cf 100644
--- scp2/source/sdkoo/makefile.mk
+++ scp2/source/sdkoo/makefile.mk
@@ -35,6 +35,11 @@ TARGET=sdkoo
 
 .INCLUDE: settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 SCP_PRODUCT_TYPE=osl
 
 PARFILES= \
diff --git scp2/source/sdkoo/sdkoo.scp scp2/source/sdkoo/sdkoo.scp
index b8dd4e5..6240047 100644
--- scp2/source/sdkoo/sdkoo.scp
+++ scp2/source/sdkoo/sdkoo.scp
@@ -77,7 +77,11 @@ End
 Directory gid_Dir_Basis_Sdk
 #if defined MACOSX
     ParentID = PREDEFINED_PROGDIR;
+    #ifdef OOo4Kids
+    DosName = "OOo4Kids${OOOBASEVERSION}_SDK";
+    #else
     DosName = "OpenOffice.org${OOOBASEVERSION}_SDK";
+    #endif
 #else
   #if defined WNT
     ParentID = PREDEFINED_PROGDIR;
diff --git scp2/source/testtool/makefile.mk scp2/source/testtool/makefile.mk
index 036cd14..95ebc4c 100644
--- scp2/source/testtool/makefile.mk
+++ scp2/source/testtool/makefile.mk
@@ -41,6 +41,11 @@ TARGETTYPE=CUI
 
 .INCLUDE :	settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 SCP_PRODUCT_TYPE=osl
 
 PARFILES= \
diff --git scp2/source/writer/makefile.mk scp2/source/writer/makefile.mk
index 09d48fc..2aff098 100644
--- scp2/source/writer/makefile.mk
+++ scp2/source/writer/makefile.mk
@@ -41,6 +41,10 @@ TARGETTYPE=CUI
 
 .INCLUDE :	settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+SCPDEFS+=-DOOo4Kids
+.ENDIF
+
 SCP_PRODUCT_TYPE=osl
 
 PARFILES= \
diff --git scp2/util/makefile.mk scp2/util/makefile.mk
index 9ba398e..a8bb25a 100644
--- scp2/util/makefile.mk
+++ scp2/util/makefile.mk
@@ -69,16 +69,12 @@ SCP1FILES  = installation_ooo.par          \
              file_draw.par                 \
              module_impress.par            \
              file_impress.par              \
-             module_base.par               \
-             file_base.par                 \
              canvascommons.par             \
              module_math.par               \
              file_math.par                 \
              module_systemint.par          \
              module_graphicfilter.par      \
              file_graphicfilter.par        \
-             module_testtool.par           \
-             file_testtool.par             \
              module_xsltfilter.par         \
              file_xsltfilter.par           \
              module_python.par             \
@@ -93,6 +89,7 @@ SCP1FILES  = installation_ooo.par          \
              common_brand_readme.par       \
              ooo_brand.par
 
+
 .IF "$(OS)"=="MACOSX" 
 SCP1FILES +=                               \
              directory_ooo_macosx.par      
@@ -110,7 +107,9 @@ SCP1FILES +=                               \
              module_ogltrans.par
 .ENDIF
 
+.IF "$(OOo4Kids)"!="YES"
 .IF "$(SOLAR_JAVA)"!=""
+
 SCP1FILES +=                               \
              module_javafilter.par         \
              file_javafilter.par
@@ -122,6 +121,7 @@ SCP1FILES +=                               \
              registryitem_javafilter.par
 .ENDIF
 .ENDIF
+.ENDIF # "$(OOo4Kids)"!="YES" 
 
 .IF "$(GUI)"=="WNT"
 SCP1FILES +=                           \
@@ -139,17 +139,20 @@ SCP1FILES +=                           \
              folderitem_draw.par       \
              registryitem_impress.par  \
              folderitem_impress.par    \
-             registryitem_base.par     \
-             folderitem_base.par       \
-             registryitem_math.par     \
-             folderitem_math.par       \
              module_quickstart.par     \
              file_quickstart.par       \
              registryitem_quickstart.par \
+             registryitem_math.par     \
+             folderitem_math.par	\
              module_winexplorerext.par \
              file_winexplorerext.par   \
              registryitem_winexplorerext.par
 
+.IF "$(OOo4Kids)"!="YES" 
+SCP1FILES+= registryitem_base.par     \
+        folderitem_base.par
+.ENDIF # "$(OOo4Kids)"!="YES" 
+
 .IF "$(ENABLE_DIRECTX)"!=""
 SCP1FILES += directxcanvas.par
 .ENDIF
@@ -215,8 +218,14 @@ SCP2FILES  = installation_ooo.par          \
              module_ooo.par                \
              module_hidden_ooo.par         \
              module_langpack.par           \
-             module_lang_template.par      \
-             module_java.par               \
+             module_lang_template.par
+
+.IF "$(OOo4Kids)"!="YES"
+SCP2FILES +=	\
+             module_java.par
+.ENDIF # "$(OOo4Kids)"!="YES" 
+
+SCP2FILES +=	\
              profile_ooo.par               \
              profileitem_ooo.par           \
              module_writer.par             \
@@ -227,16 +236,10 @@ SCP2FILES  = installation_ooo.par          \
              file_draw.par                 \
              module_impress.par            \
              file_impress.par              \
-             module_base.par               \
-             file_base.par                 \
              canvascommons.par             \
-             module_math.par               \
-             file_math.par                 \
              module_systemint.par          \
              module_graphicfilter.par      \
              file_graphicfilter.par        \
-             module_testtool.par           \
-             file_testtool.par             \
              module_xsltfilter.par         \
              file_xsltfilter.par           \
              module_python.par             \
@@ -247,10 +250,20 @@ SCP2FILES  = installation_ooo.par          \
              ure.par                       \
              module_improvement.par        \
              file_improvement.par          \
+            module_math.par               \
+        file_math.par                 \
              common_brand.par              \
              common_brand_readme.par       \
              ooo_brand.par
 
+.IF "$(OOo4Kids)"!="YES" 
+SCP2FILES+= module_base.par               \
+        file_base.par                 \
+        module_testtool.par           \
+        file_testtool.par
+.ENDIF # "$(OOo4Kids)"!="YES" 
+
+
 .IF "$(OS)"=="MACOSX" 
 SCP2FILES +=                               \
              directory_ooo_macosx.par      
@@ -263,6 +276,8 @@ SCP2FILES +=                               \
              file_binfilter.par
 .ENDIF
 
+.IF "$(OOo4Kids)"!="YES" 
+
 .IF "$(SOLAR_JAVA)"!=""
 SCP2FILES +=                               \
              module_javafilter.par         \
@@ -276,6 +291,9 @@ SCP2FILES +=                               \
 .ENDIF
 .ENDIF
 
+.ENDIF # "$(OOo4Kids)"!="YES" 
+
+
 .IF "$(GUI)"=="WNT"
 SCP2FILES +=                           \
              file_jre_ooo.par          \
@@ -293,17 +311,21 @@ SCP2FILES +=                           \
              folderitem_draw.par       \
              registryitem_impress.par  \
              folderitem_impress.par    \
-             registryitem_base.par     \
-             folderitem_base.par       \
-             registryitem_math.par     \
-             folderitem_math.par       \
              module_quickstart.par     \
              file_quickstart.par       \
              registryitem_quickstart.par \
+             registryitem_math.par     \
+             folderitem_math.par       \
              module_winexplorerext.par \
              file_winexplorerext.par   \
              registryitem_winexplorerext.par
 
+.IF "$(OOo4Kids)"!="YES"
+SCP2FILES +=	\
+             folderitem_base.par       \
+             registryitem_base.par
+.ENDIF
+
 .IF "$(ENABLE_DIRECTX)"!=""
 SCP2FILES += directxcanvas.par
 .ENDIF
@@ -360,9 +382,11 @@ SCP3FILES = ure_standalone.par  \
 # ------------------------------------------------------------------------
 # SDK
 
+.IF "$(OOo4Kids)"!="YES" 
 SCP4LINK_PRODUCT_TYPE = osl
 SCP4TARGET = sdkoo
 SCP4FILES = sdkoo.par
+.ENDIF
 
 # --- target -------------------------------------------------------------
 .INCLUDE :  target.mk
diff --git scripting/examples/java/makefile.mk scripting/examples/java/makefile.mk
index b8138c7..042b6ed 100755
--- scripting/examples/java/makefile.mk
+++ scripting/examples/java/makefile.mk
@@ -33,6 +33,11 @@ PRJ=..$/..
 PRJNAME=scripting
 TARGET=javaexamples
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 
 .IF "$(SOLAR_JAVA)"!=""
diff --git scripting/examples/makefile.mk scripting/examples/makefile.mk
index f071060..5093600 100755
--- scripting/examples/makefile.mk
+++ scripting/examples/makefile.mk
@@ -35,13 +35,6 @@ no_common_build_zip=true
 
 .INCLUDE : settings.mk
 .IF "$(L10N_framework)"==""
-.IF "$(SOLAR_JAVA)"!=""
-ZIP1FLAGS=-r
-ZIP1TARGET=ScriptsJava
-ZIP1DIR=$(OUT)$/class$/examples
-ZIP1LIST=java
-.ENDIF
-
 ZIP2FLAGS=-r
 ZIP2TARGET=ScriptsBeanShell
 ZIP2LIST=beanshell/HelloWorld beanshell/Highlight beanshell/WordCount beanshell/Capitalise beanshell/MemoryUsage 
diff --git scripting/java/makefile.mk scripting/java/makefile.mk
index 9b3255e..12d6867 100755
--- scripting/java/makefile.mk
+++ scripting/java/makefile.mk
@@ -33,8 +33,14 @@ PRJ=..
 PRJNAME=scripting
 TARGET=scriptruntimeforjava
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 
+
 .IF "$(L10N_framework)"==""
 .IF "$(SOLAR_JAVA)"!=""
 ALLTAR : ANTBUILD
diff --git scripting/source/basprov/makefile.mk scripting/source/basprov/makefile.mk
index 2b6fe7f..0d6e69f 100644
--- scripting/source/basprov/makefile.mk
+++ scripting/source/basprov/makefile.mk
@@ -39,6 +39,11 @@ COMP1TYPELIST=$(TARGET)
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 DLLPRE =
 
diff --git scripting/source/dlgprov/makefile.mk scripting/source/dlgprov/makefile.mk
index da1c88f..6349aba 100644
--- scripting/source/dlgprov/makefile.mk
+++ scripting/source/dlgprov/makefile.mk
@@ -38,6 +38,11 @@ COMP1TYPELIST=$(TARGET)
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build."
+.ENDIF
+
 .INCLUDE :  settings.mk
 DLLPRE =
 
diff --git sd/source/ui/inc/docprev.hxx sd/source/ui/inc/docprev.hxx
index e1379ff..7d674f6 100644
--- sd/source/ui/inc/docprev.hxx
+++ sd/source/ui/inc/docprev.hxx
@@ -79,13 +79,13 @@ public:
     void            SetGDIFile( GDIMetaFile* pFile );
     virtual void    Resize();
     void			startPreview();
-
     virtual	long	Notify( NotifyEvent& rNEvt );
 
     void			SetClickHdl( const Link& rLink ) { aClickHdl = rLink; }
     const Link& 	GetClickHdl() const { return aClickHdl; }
 
     virtual void DataChanged( const DataChangedEvent& rDCEvt );
+    BOOL  isEffectActive() { return bInEffect;/*mxSlideShow.is();*/ }
 
 };
 
diff --git sd/source/ui/slideshow/makefile.mk sd/source/ui/slideshow/makefile.mk
index e157ba9..7055d72 100644
--- sd/source/ui/slideshow/makefile.mk
+++ sd/source/ui/slideshow/makefile.mk
@@ -43,6 +43,11 @@ AUTOSEG=true
 .INCLUDE :  settings.mk
 .INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
+.IF "$(ENABLE_PRESENTER_EXTRA_UI)"=="YES"
+RSCDEFS+=-DENABLE_PRESENTER_EXTRA_UI
+ADDCDEFS+=-DENABLE_PRESENTER_EXTRA_UI
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 
diff --git sd/source/ui/slideshow/slideshow.cxx sd/source/ui/slideshow/slideshow.cxx
index 78a6c6d..d73eb75 100644
--- sd/source/ui/slideshow/slideshow.cxx
+++ sd/source/ui/slideshow/slideshow.cxx
@@ -87,7 +87,7 @@ extern String getUiNameFromPageApiNameImpl( const ::rtl::OUString& rApiName );
 
 namespace {
     /** This local version of the work window overloads DataChanged() so that it
-        can restart the slide show when a displau is added or removed.
+        can restart the slide show when a display is added or removed.
     */
     class FullScreenWorkWindow : public WorkWindow
     {
diff --git sd/source/ui/slideshow/slideshow.hrc sd/source/ui/slideshow/slideshow.hrc
index fa7f103..38510e2 100644
--- sd/source/ui/slideshow/slideshow.hrc
+++ sd/source/ui/slideshow/slideshow.hrc
@@ -41,5 +41,25 @@
 #define CM_FIRST_SLIDE	8
 #define CM_LAST_SLIDE	9
 #define CM_SLIDES		10
-
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+//CM for extra presenter UI
+#define CM_ERASE_ALLINK	11
+#define CM_ERASE_INK	12
+#define CM_ERASE_INK_PEN	13
+#define CM_ERASE_INK_PEN_VERY_THIN	14
+#define CM_ERASE_INK_PEN_THIN	15
+#define CM_ERASE_INK_PEN_NORMAL	16
+#define CM_ERASE_INK_PEN_THICK	17
+#define CM_ERASE_INK_PEN_VERY_THICK	18
+#define CM_COLOR_PEN	19
+#define CM_WIDTH_PEN	20
+#define CM_WIDTH_PEN_VERY_THIN	21
+#define CM_WIDTH_PEN_THIN	22
+#define CM_WIDTH_PEN_NORMAL	23
+#define CM_WIDTH_PEN_THICK	24
+#define CM_WIDTH_PEN_VERY_THICK	25
+#define CM_PEN_MODE 26
+#define CM_ERASE_MODE 27
+#define CM_POINTER_OPTION 28
+#endif //ENABLE_PRESENTER_EXTRA_UI
 #endif
diff --git sd/source/ui/slideshow/slideshow.src sd/source/ui/slideshow/slideshow.src
index 4e30d3a..cf589e8 100644
--- sd/source/ui/slideshow/slideshow.src
+++ sd/source/ui/slideshow/slideshow.src
@@ -74,6 +74,130 @@ Menu RID_SLIDESHOW_CONTEXTMENU
         {
             Separator = TRUE;
         };
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+        MenuItem
+        {
+            Identifier = CM_PEN_MODE;
+            Text [ en-US ] = "~Pen Mode";
+        };
+        MenuItem
+        {
+            Identifier = CM_ERASE_MODE;
+            Text [ en-US ] = "~Eraser Mode";
+        };
+        MenuItem
+        {
+            Separator = TRUE;
+        };
+        MenuItem
+        {
+            Identifier = CM_WIDTH_PEN;
+            Text [ en-US ] = "~Pen Width" ;
+            SubMenu = Menu
+            {
+                ItemList =
+                {
+                    MenuItem
+                    {
+                        Identifier =  CM_WIDTH_PEN_VERY_THIN;
+                        Text [ en-US ] = "~Very thin";
+                    };
+                    MenuItem
+                    {
+                        Identifier =  CM_WIDTH_PEN_THIN;
+                        Text [ en-US ] = "~Thin";
+                    };
+                    MenuItem
+                    {
+                        Identifier =  CM_WIDTH_PEN_NORMAL;
+                        Text [ en-US ] = "~Normal";
+                    };
+                    MenuItem
+                    {
+                        Identifier =  CM_WIDTH_PEN_THICK;
+                        Text [ en-US ] = "~Thick";
+                    };
+                    MenuItem
+                    {
+                        Identifier =  CM_WIDTH_PEN_VERY_THICK;
+                        Text [ en-US ] = "~Very Thick";
+                    };
+                };
+            };
+        };
+        MenuItem
+        {
+            Separator = TRUE;
+        };
+        MenuItem
+        {
+            Identifier = CM_COLOR_PEN ;
+            Text [ en-US ] = "~Change Pen Color" ;
+        };
+        MenuItem
+        {
+            Separator = TRUE;
+        };
+        MenuItem
+        {
+            Separator = TRUE;
+        };
+        MenuItem
+        {
+            Identifier = CM_ERASE_ALLINK ;
+            Text [ en-US ] = "~Erase All Ink On Slide" ;
+        };
+        // MenuItem
+        // {
+        //     Identifier = CM_ERASE_INK ;
+        //     Text [ en-US ] = "~Erase Ink Mode ON/OFF" ;
+        // };
+        MenuItem
+        {
+            Separator = TRUE;
+        };
+        MenuItem
+        {
+            Identifier = CM_ERASE_INK_PEN;
+            Text [ en-US ] = "~Eraser Width" ;
+
+        SubMenu = Menu
+                    {
+                ItemList =
+                {
+                    MenuItem
+                    {
+                        Identifier =  CM_ERASE_INK_PEN_VERY_THIN;
+                        Text [ en-US ] = "~Very thin";
+                    };			
+                    MenuItem
+                    {
+                        Identifier =  CM_ERASE_INK_PEN_THIN;
+                        Text [ en-US ] = "~Thin";
+                    };
+                    MenuItem
+                    {
+                        Identifier =  CM_ERASE_INK_PEN_NORMAL;
+                        Text [ en-US ] = "~Normal";
+                    };			
+                    MenuItem
+                    {
+                        Identifier =  CM_ERASE_INK_PEN_THICK;
+                        Text [ en-US ] = "~Thick";
+                    };
+                    MenuItem
+                    {
+                        Identifier =  CM_ERASE_INK_PEN_VERY_THICK;
+                        Text [ en-US ] = "~Very Thick";
+                    };			
+                };
+            };
+        };
+#endif
+    MenuItem
+    {
+        Separator = TRUE;
+    };
         MenuItem
         {
             Identifier = CM_SCREEN;
@@ -98,10 +222,6 @@ Menu RID_SLIDESHOW_CONTEXTMENU
         };
         MenuItem
         {
-            Separator = TRUE;
-        };
-        MenuItem
-        {
             Identifier = CM_ENDSHOW ;
             Text [ en-US ] = "~End Show" ;
         };
diff --git sd/source/ui/slideshow/slideshowimpl.cxx sd/source/ui/slideshow/slideshowimpl.cxx
index 6bbb771..079357e 100644
--- sd/source/ui/slideshow/slideshowimpl.cxx
+++ sd/source/ui/slideshow/slideshowimpl.cxx
@@ -34,6 +34,7 @@
 
 #include <boost/scoped_ptr.hpp>
 
+#include "com/sun/star/frame/XComponentLoader.hpp"
 #include <com/sun/star/lang/XInitialization.hpp>
 #include <com/sun/star/document/XEventsSupplier.hpp>
 #include <com/sun/star/drawing/XMasterPageTarget.hpp>
@@ -86,10 +87,16 @@
 #include "canvas/elapsedtime.hxx"
 #include "canvas/prioritybooster.hxx"
 #include "avmedia/mediawindow.hxx"
+#include  "svtools/colrdlg.hxx"
 
 #include <boost/noncopyable.hpp>
 #include <boost/bind.hpp>
 
+#ifdef GSTREAMER
+#     define AVMEDIA_MANAGER_SERVICE_NAME "com.sun.star.media.Manager_GStreamer"
+#endif
+
+
 using ::rtl::OUString;
 using ::rtl::OString;
 using ::cppu::OInterfaceContainerHelper;
@@ -169,7 +176,7 @@ public:
     bool nextSlide();
     bool previousSlide();
 
-    void displayCurrentSlide( const Reference< XSlideShow >& xShow );
+    void displayCurrentSlide( const Reference< XSlideShow >& xShow, const Reference< XDrawPagesSupplier>& xDrawPages);
 
     sal_Int32 getNextSlideIndex() const;
     sal_Int32 getPreviousSlideIndex() const;
@@ -466,7 +473,9 @@ bool AnimationSlideController::previousSlide()
     return jumpToSlideIndex( getPreviousSlideIndex() );
 }
 
-void AnimationSlideController::displayCurrentSlide( const Reference< XSlideShow >& xShow )
+
+
+void AnimationSlideController::displayCurrentSlide( const Reference< XSlideShow >& xShow, const Reference< XDrawPagesSupplier>& xDrawPages )
 {
     const sal_Int32 nCurrentSlideNumber = getCurrentSlideNumber();
 
@@ -488,7 +497,7 @@ void AnimationSlideController::displayCurrentSlide( const Reference< XSlideShow
         }
 
         if( getSlideAPI( nCurrentSlideNumber, xSlide, xAnimNode ) )
-            xShow->displaySlide( xSlide, xAnimNode, aProperties );
+            xShow->displaySlide( xSlide, xDrawPages, xAnimNode, aProperties );
     }
 }
 
@@ -523,7 +532,16 @@ SlideshowImpl::SlideshowImpl( const Reference< XPresentation2 >& xPresentation,
 , mbInputFreeze(false)
 , mbActive(sal_False)
 , maPresSettings( pDoc->getPresentationSettings() )
-, mnUserPaintColor( 0x0000FF00L )
+//User paint color is Black by default
+, mnUserPaintColor( 0x00000000L )
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+, mbSwitchPenMode(true)
+, mbSwitchEraserMode(false)
+, mdUserPaintStrokeWidth ( 4.0 )
+, mbEraseAllInk(false)
+//, mbEraseInk(false)
+, mnEraseInkSize(100)
+#endif
 , mnEntryCounter(0)
 , mnLastSlideNumber(-1)
 , msOnClick( RTL_CONSTASCII_USTRINGPARAM("OnClick") )
@@ -1087,7 +1105,8 @@ bool SlideshowImpl::startShow( PresentationSettingsEx* pPresSettings )
                 aProperties.push_back(
                     beans::PropertyValue(
                         OUString( RTL_CONSTASCII_USTRINGPARAM("UserPaintColor") ),
-                        -1, Any( static_cast<sal_Int32>(0x0000FF00L) ),
+                        // User paint color is black by default.
+                        -1, Any( static_cast<sal_Int32>(0x00000000L) ),
                         beans::PropertyState_DIRECT_VALUE ) );
             }
             
@@ -1394,7 +1413,8 @@ void SlideshowImpl::displayCurrentSlide()
 
     if( mpSlideController.get() && mxShow.is() )
     {
-        mpSlideController->displayCurrentSlide( mxShow );
+        Reference< XDrawPagesSupplier > xDrawPages( mpDoc->getUnoModel(), UNO_QUERY_THROW );
+        mpSlideController->displayCurrentSlide( mxShow, xDrawPages );
         registerShapeEvents(mpSlideController->getCurrentSlideNumber());
         update();
 
@@ -1411,6 +1431,14 @@ void SlideshowImpl::displayCurrentSlide()
 
 void SlideshowImpl::endPresentation()
 {
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+    if( maPresSettings.mbMouseAsPen)
+    {
+        Reference< XMultiServiceFactory > xDocFactory(mpDoc->getUnoModel(), UNO_QUERY );
+        if( xDocFactory.is() )
+            mxShow->registerUserPaintPolygons(xDocFactory);
+    }
+#endif
     if( !mnEndShowEvent )
         mnEndShowEvent = Application::PostUserEvent( LINK(this, SlideshowImpl, endPresentationHdl) );
 }
@@ -2112,6 +2140,17 @@ IMPL_LINK( SlideshowImpl, ContextMenuHdl, void*, EMPTYARG )
 
     PopupMenu* pMenu = new PopupMenu( SdResId( RID_SLIDESHOW_CONTEXTMENU ) );
 
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+    //adding button to contextual menu for erasing functionnalities for UserPaintOverlay
+    pMenu->EnableItem( CM_ERASE_ALLINK, (maPresSettings.mbMouseAsPen));
+    // Adding button to contextual menu for changing pen color
+    pMenu->EnableItem( CM_COLOR_PEN, (maPresSettings.mbMouseAsPen));
+    // Adding button to display if in Pen  mode
+    pMenu->EnableItem( CM_PEN_MODE, (maPresSettings.mbMouseAsPen));
+    // Adding button to displau if in Erase Mode
+    pMenu->EnableItem( CM_ERASE_MODE, (maPresSettings.mbMouseAsPen));
+#endif	
+
     const ShowWindowMode eMode = mpShowWindow->GetShowWindowMode();
     pMenu->EnableItem( CM_NEXT_SLIDE, ( mpSlideController->getNextSlideIndex() != -1 ) );
     pMenu->EnableItem( CM_PREV_SLIDE, ( mpSlideController->getPreviousSlideIndex() != -1 ) || (eMode == SHOWWINDOWMODE_END) || (eMode == SHOWWINDOWMODE_PAUSE) || (eMode == SHOWWINDOWMODE_BLANK) );
@@ -2178,6 +2217,105 @@ IMPL_LINK( SlideshowImpl, ContextMenuHdl, void*, EMPTYARG )
             pBlankMenu->CheckItem( ( mpShowWindow->GetBlankColor() == Color( COL_WHITE ) ) ? CM_SCREEN_WHITE : CM_SCREEN_BLACK  );
         }
     }
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+
+    PopupMenu* pWidthMenu = pMenu->GetPopupMenu( CM_WIDTH_PEN);
+    
+    // populate color width list
+    if( pWidthMenu )
+    {
+        if(! maPresSettings.mbMouseAsPen)
+        {
+            pMenu->EnableItem( CM_WIDTH_PEN, FALSE );
+        }
+        else
+        {
+            sal_Int32 nIterator;
+            double nWidth;
+                
+            nWidth = 4.0;
+            for( nIterator = 1; nIterator < 6; nIterator++)
+            {
+                switch(nIterator)
+                {
+                    case 1:
+                        nWidth = 4.0;
+                        break;
+                    case 2:
+                        nWidth = 100.0;
+                        break;
+                    case 3:
+                        nWidth = 150.0;
+                        break;
+                    case 4:
+                        nWidth = 200.0;
+                        break;
+                    case 5:
+                        nWidth = 400.0;
+                        break;
+                    default:
+                        break;
+                }
+                    
+                pWidthMenu->EnableItem( (USHORT)(CM_WIDTH_PEN + nIterator), TRUE);
+                if( nWidth ==  mdUserPaintStrokeWidth)
+                    pWidthMenu->CheckItem( (USHORT)(CM_WIDTH_PEN + nIterator) );
+                
+            }
+        }
+    }
+
+
+    PopupMenu* pEraseWidthMenu = pMenu->GetPopupMenu( CM_ERASE_INK_PEN);
+        
+    // populate eraser width list
+    if( pEraseWidthMenu )
+    {
+        if(! maPresSettings.mbMouseAsPen)
+        {
+            pMenu->EnableItem( CM_ERASE_INK_PEN, FALSE );
+        }
+        else
+        {
+            sal_Int32 nEIterator;
+            double nEWidth;
+            
+            nEWidth = 100.0;
+            for( nEIterator = 1; nEIterator < 6; nEIterator++)
+            {
+                switch(nEIterator)
+                {
+                    case 1:
+                        nEWidth = 100.0;
+                        break;
+                    case 2:
+                        nEWidth = 200.0;
+                        break;
+                    case 3:
+                        nEWidth = 300.0;
+                        break;
+                    case 4:
+                        nEWidth = 400.0;
+                        break;
+                    case 5:
+                        nEWidth = 500.0;
+                        break;
+                    default:
+                        break;
+                }
+                
+                pEraseWidthMenu->EnableItem( (USHORT)(CM_ERASE_INK_PEN + nEIterator), TRUE);
+                if( nEWidth ==  mnEraseInkSize)
+                    pEraseWidthMenu->CheckItem( (USHORT)(CM_ERASE_INK_PEN + nEIterator) );
+        if( mbSwitchPenMode )
+           pMenu->CheckItem( (USHORT)(CM_PEN_MODE));           		
+        if( mbSwitchEraserMode )
+           pMenu->CheckItem( (USHORT)(CM_ERASE_MODE));             
+  
+            }
+        }
+    }
+#endif
 
     pMenu->SetSelectHdl( LINK( this, SlideshowImpl, ContextMenuSelectHdl ) );
     pMenu->Execute( mpShowWindow, maPopupMousePos );
@@ -2241,6 +2379,111 @@ IMPL_LINK( SlideshowImpl, ContextMenuSelectHdl, Menu *, pMenu )
             }
         }
         break;
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+        if( maPresSettings.mbMouseAsPen )
+        {
+            case CM_COLOR_PEN:
+                {
+                    //Open a color picker based on SvColorDialog
+                    ::Color aColor( mnUserPaintColor );
+                    SvColorDialog aColorDlg( mpShowWindow);
+                    aColorDlg.SetColor( aColor );
+                    
+                    if (aColorDlg.Execute() )
+                    {
+                        aColor = aColorDlg.GetColor();
+                        mnUserPaintColor = aColor.GetColor();
+                        setPenColor(mnUserPaintColor);
+                    }
+                    mbWasPaused = false;
+                }
+                break;
+                        
+            case CM_WIDTH_PEN_VERY_THIN:
+                {
+                    setPenWidth(4.0);
+                    mbWasPaused = false;
+                }
+                break;
+                            
+            case CM_WIDTH_PEN_THIN:
+                {
+                    setPenWidth(100.0);
+                    mbWasPaused = false;
+                }
+                break;
+                            
+            case CM_WIDTH_PEN_NORMAL:
+                {
+                    setPenWidth(150.0);
+                    mbWasPaused = false;
+                }
+                break;
+                       
+            case CM_WIDTH_PEN_THICK:
+                {
+                    setPenWidth(200.0);
+                    mbWasPaused = false;
+                }
+                break;
+                        
+            case CM_WIDTH_PEN_VERY_THICK:
+                {
+                    setPenWidth(400.0);
+                    mbWasPaused = false;
+                }
+                break;
+            case CM_ERASE_ALLINK:
+                {
+                    setEraseAllInk(true);
+                    mbWasPaused = false;	
+                }
+                break;
+            case CM_PEN_MODE:
+                {
+                    setPenMode(true);
+                    mbWasPaused = false;
+                }
+                break;
+            case CM_ERASE_MODE:
+                {
+                    setEraserMode(true);
+                    mbWasPaused = false;
+                }
+            break;
+            case CM_ERASE_INK_PEN_VERY_THIN:
+                {
+                    setEraseInk(100);
+                    mbWasPaused = false;
+                }
+                break;
+            case CM_ERASE_INK_PEN_THIN:
+                {
+                    setEraseInk(200);
+                    mbWasPaused = false;
+                }
+                break;
+            case CM_ERASE_INK_PEN_NORMAL:
+                {
+                    setEraseInk(300);
+                    mbWasPaused = false;
+                }
+                break;
+                     
+            case CM_ERASE_INK_PEN_THICK:
+                {
+                    setEraseInk(400);
+                    mbWasPaused = false;
+                }
+                break;
+            case CM_ERASE_INK_PEN_VERY_THICK:
+                {
+                    setEraseInk(500);
+                    mbWasPaused = false;
+                }
+                break;  
+        }
+#endif
         
         case CM_ENDSHOW:
             // in case the user cancels the presentation, switch to current slide
@@ -2849,16 +3092,46 @@ void SAL_CALL SlideshowImpl::setUsePen( sal_Bool bMouseAsPen ) throw (RuntimeExc
     maPresSettings.mbMouseAsPen = bMouseAsPen;
     if( mxShow.is() ) try
     {
+    // For Pencolor;
         Any aValue;
         if( maPresSettings.mbMouseAsPen )
-            // todo: take color from configuration
+        // TODO: take color from configuration
             aValue <<= mnUserPaintColor;
-
         beans::PropertyValue aPenProp;
         aPenProp.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPaintColor" ));
         aPenProp.Value = aValue;
-
         mxShow->setProperty( aPenProp );
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+        //for StrokeWidth :
+        Any aValueWidth;
+        if( maPresSettings.mbMouseAsPen )
+            aValueWidth <<= mdUserPaintStrokeWidth;
+         
+        beans::PropertyValue aPenPropWidth;
+        aPenPropWidth.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPaintStrokeWidth" ));
+        aPenPropWidth.Value = aValueWidth;
+         
+        mxShow->setProperty( aPenPropWidth );
+
+    // for Pen Mode
+        Any aValueSwitchPenMode;
+        if( maPresSettings.mbMouseAsPen )
+            aValueSwitchPenMode <<= mbSwitchPenMode;
+        beans::PropertyValue aPenPropSwitchPenMode;
+        aPenPropSwitchPenMode.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "SwitchPenMode" ));
+        aPenPropSwitchPenMode.Value = aValueSwitchPenMode;         
+        mxShow->setProperty( aPenPropSwitchPenMode );
+
+    //for EraseAllInk :
+    Any aValueEraseAllInk;
+    if( maPresSettings.mbMouseAsPen )
+        aValueEraseAllInk <<= mbEraseAllInk;
+    beans::PropertyValue aPenPropEraseAllInk;
+    aPenPropEraseAllInk.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "EraseAllInk" ));
+    aPenPropEraseAllInk.Value = aValueEraseAllInk;
+    mxShow->setProperty( aPenPropEraseAllInk );
+    mbEraseAllInk = false; // sets to false so not to have it applied again
+#endif
     }
     catch( Exception& e )
     {
@@ -2872,6 +3145,64 @@ void SAL_CALL SlideshowImpl::setUsePen( sal_Bool bMouseAsPen ) throw (RuntimeExc
     }
 }
 
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+void SAL_CALL SlideshowImpl::setUseEraser( sal_Bool bMouseAsPen ) throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    maPresSettings.mbMouseAsPen = bMouseAsPen;
+    if( mxShow.is() ) try
+    {
+
+    //for EraseInk :
+    Any aValueEraseInk;
+    if( maPresSettings.mbMouseAsPen )
+        aValueEraseInk <<= mnEraseInkSize;
+    beans::PropertyValue aPenPropEraseInk;
+    aPenPropEraseInk.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "EraseInk" ));
+    aPenPropEraseInk.Value = aValueEraseInk;
+    mxShow->setProperty( aPenPropEraseInk );
+
+    // for Erase Mode
+    Any aValueSwitchEraserMode;
+        if( maPresSettings.mbMouseAsPen )
+            aValueSwitchEraserMode <<= mbSwitchEraserMode;
+        beans::PropertyValue aPenPropSwitchEraserMode;
+        aPenPropSwitchEraserMode.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "SwitchEraserMode" ));
+        aPenPropSwitchEraserMode.Value = aValueSwitchEraserMode;         
+        mxShow->setProperty( aPenPropSwitchEraserMode );
+    }
+    catch( Exception& e )
+    {
+        static_cast<void>(e);
+        DBG_ERROR(
+            (OString("sd::SlideshowImpl::setUseEraser(), "
+                    "exception caught: ") +
+            rtl::OUStringToOString(
+                comphelper::anyToString( cppu::getCaughtException() ),
+                RTL_TEXTENCODING_UTF8 )).getStr() );
+    }
+}
+
+// --------------------------------------------------------------------
+
+double SAL_CALL SlideshowImpl::getPenWidth() throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    return mdUserPaintStrokeWidth;
+}
+
+// --------------------------------------------------------------------
+
+void SAL_CALL SlideshowImpl::setPenWidth( double dStrokeWidth ) throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    mdUserPaintStrokeWidth = dStrokeWidth;
+    mbSwitchPenMode =  true;
+    mbSwitchEraserMode = !mbSwitchPenMode;
+    if( maPresSettings.mbMouseAsPen )
+        setUsePen( sal_True ); // update color and width
+}
+#endif
 // --------------------------------------------------------------------
 
 sal_Int32 SAL_CALL SlideshowImpl::getPenColor() throw (RuntimeException)
@@ -2886,10 +3217,72 @@ void SAL_CALL SlideshowImpl::setPenColor( sal_Int32 nColor ) throw (RuntimeExcep
 {
     ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
     mnUserPaintColor = nColor;
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+    mbSwitchPenMode = true;
+    mbSwitchEraserMode = !mbSwitchPenMode;
+#endif
     if( maPresSettings.mbMouseAsPen )
         setUsePen( sal_True ); // update color
 }
 
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+// --------------------------------------------------------------------
+
+void SAL_CALL SlideshowImpl::setPenMode( bool bSwitchPenMode ) throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    mbSwitchPenMode = bSwitchPenMode;
+    
+    if(mbSwitchPenMode == true){
+        mbSwitchEraserMode = false;
+    }else{
+        mbSwitchEraserMode = true;
+    }
+    if( maPresSettings.mbMouseAsPen )
+        setUsePen( sal_True ); // Switch to Pen Mode
+    
+}
+
+void SAL_CALL SlideshowImpl::setEraserMode(bool bSwitchEraserMode ) throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    mbSwitchEraserMode = bSwitchEraserMode;	
+    if(mbSwitchEraserMode = true){
+        mbSwitchPenMode = false;
+    }else{
+        mbSwitchPenMode = true;
+    }
+
+    if( maPresSettings.mbMouseAsPen )
+        setUseEraser( sal_True ); // Switch to EraseMode
+    
+}
+
+
+// --------------------------------------------------------------------
+
+void SAL_CALL SlideshowImpl::setEraseAllInk( bool bEraseAllInk ) throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    mbEraseAllInk=bEraseAllInk;
+    mbSwitchPenMode = true;
+    mbSwitchEraserMode = false;
+    if( maPresSettings.mbMouseAsPen )
+        setUsePen( sal_True ); // update erase all ink bool
+}
+
+
+    
+void SAL_CALL SlideshowImpl::setEraseInk( sal_Int32 nEraseInkSize ) throw (RuntimeException)
+{
+    ::vos::OGuard aSolarGuard( Application::GetSolarMutex() );
+    mnEraseInkSize = nEraseInkSize;
+    mbSwitchPenMode = false;
+    mbSwitchEraserMode = true;
+    if( maPresSettings.mbMouseAsPen )			
+        setUseEraser( sal_True ); // update erase ink size
+}
+#endif
 // --------------------------------------------------------------------
 // XSlideShowController Methods
 // --------------------------------------------------------------------
diff --git sd/source/ui/slideshow/slideshowimpl.hxx sd/source/ui/slideshow/slideshowimpl.hxx
index f904d11..888d18d 100644
--- sd/source/ui/slideshow/slideshowimpl.hxx
+++ sd/source/ui/slideshow/slideshowimpl.hxx
@@ -202,6 +202,15 @@ public:
     virtual void SAL_CALL setUsePen( ::sal_Bool _usepen ) throw (css::uno::RuntimeException);
     virtual ::sal_Int32 SAL_CALL getPenColor() throw (css::uno::RuntimeException);
     virtual void SAL_CALL setPenColor( ::sal_Int32 _pencolor ) throw (css::uno::RuntimeException);
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+    virtual void SAL_CALL setUseEraser( ::sal_Bool _usepen ) throw (css::uno::RuntimeException);
+    virtual double SAL_CALL getPenWidth() throw (css::uno::RuntimeException);
+    virtual void SAL_CALL setPenWidth( double dStrokeWidth ) throw (css::uno::RuntimeException);
+    virtual void SAL_CALL setEraseAllInk( bool bEraseAllInk ) throw (css::uno::RuntimeException);
+    virtual void SAL_CALL setEraseInk( sal_Int32 nEraseInkSize ) throw (css::uno::RuntimeException);
+    virtual void SAL_CALL setPenMode( bool bSwitchPenMode) throw (css::uno::RuntimeException);
+    virtual void SAL_CALL setEraserMode( bool bSwitchEraserMode ) throw (css::uno::RuntimeException);
+#endif
     virtual ::sal_Bool SAL_CALL isRunning(  ) throw (css::uno::RuntimeException);
     virtual ::sal_Int32 SAL_CALL getSlideCount(  ) throw (css::uno::RuntimeException);
     virtual css::uno::Reference< css::drawing::XDrawPage > SAL_CALL getSlideByIndex( ::sal_Int32 Index ) throw (css::lang::IndexOutOfBoundsException, css::uno::RuntimeException);
@@ -381,6 +390,14 @@ private:
     PresentationSettings maPresSettings;
     sal_Int32		mnUserPaintColor;
 
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+    bool			mbSwitchPenMode;
+    bool			mbSwitchEraserMode;
+    double			mdUserPaintStrokeWidth;
+    bool			mbEraseAllInk;
+//    bool			mbEraseInk;
+    sal_Int32		mnEraseInkSize;
+#endif
     /// used in updateHdl to prevent recursive calls
     sal_Int32		mnEntryCounter;
  
diff --git sd/uiconfig/sdraw/accelerator/de/default.xml sd/uiconfig/sdraw/accelerator/de/default.xml
new file mode 100644
index 0000000..9212879
--- /dev/null
+++ sd/uiconfig/sdraw/accelerator/de/default.xml
@@ -0,0 +1,63 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_Q" accel:mod1="true" xlink:href=".uno:Quit"/>
+    <accel:item accel:code="KEY_N" accel:shift="true" accel:mod1="true" xlink:href=".uno:NewDoc"/>
+    <accel:item accel:code="KEY_O" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_OPEN" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_P" accel:mod1="true" xlink:href=".uno:Print"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_F11" xlink:href=".uno:DesignerDialog"/>
+    <accel:item accel:code="KEY_F11" accel:mod1="true" xlink:href=".uno:StyleCatalog"/>
+    <accel:item accel:code="KEY_Y" accel:mod1="true" xlink:href=".uno:Redo"/>
+    <accel:item accel:code="KEY_Z" accel:mod1="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_BACKSPACE" accel:mod2="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_UNDO" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_REPEAT" xlink:href=".uno:Repeat"/>
+    <accel:item accel:code="KEY_X" accel:mod1="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_DELETE" accel:shift="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_CUT" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_C" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_INSERT" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_COPY" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_V" accel:mod1="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_INSERT" accel:shift="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_PASTE" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_DELETE" xlink:href=".uno:Delete"/>
+    <accel:item accel:code="KEY_F2" xlink:href=".uno:Text"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_F" accel:shift="true" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_U" accel:shift="true" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_L" accel:mod1="true" xlink:href=".uno:LeftPara"/>
+    <accel:item accel:code="KEY_R" accel:mod1="true" xlink:href=".uno:RightPara"/>
+    <accel:item accel:code="KEY_E" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+    <accel:item accel:code="KEY_B" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_1" accel:mod1="true" xlink:href=".uno:SpacePara1"/>
+    <accel:item accel:code="KEY_5" accel:mod1="true" xlink:href=".uno:SpacePara15"/>
+    <accel:item accel:code="KEY_2" accel:mod1="true" xlink:href=".uno:SpacePara2"/>
+    <accel:item accel:code="KEY_F4" xlink:href=".uno:TransformDialog"/>
+    <accel:item accel:code="KEY_F8" xlink:href=".uno:ToggleObjectBezierMode"/>
+    <accel:item accel:code="KEY_F7" xlink:href=".uno:SpellDialog"/>
+    <accel:item accel:code="KEY_F7" accel:mod1="true" xlink:href=".uno:Thesaurus"/>
+    <accel:item accel:code="KEY_ADD" accel:shift="true" accel:mod1="true" xlink:href=".uno:BringToFront"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:shift="true" accel:mod1="true" xlink:href=".uno:SendToBack"/>
+    <accel:item accel:code="KEY_H" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_T" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_F5" xlink:href=".uno:Navigator"/>
+    <accel:item accel:code="KEY_F8" accel:shift="true" accel:mod1="true" xlink:href=".uno:TextFitToSize"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" xlink:href=".uno:FormatGroup"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:FormatUngroup"/>
+    <accel:item accel:code="KEY_9" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:ShowItemBrowser"/>
+    <accel:item accel:code="KEY_V" accel:shift="true" accel:mod1="true" xlink:href=".uno:PasteClipboard"/>
+    <accel:item accel:code="KEY_F3" accel:shift="true" xlink:href=".uno:CopyObjects"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:PixelMode"/>
+    <accel:item accel:code="KEY_C" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_ADD" accel:mod1="true" xlink:href=".uno:Forward"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:mod1="true" xlink:href=".uno:Backward"/>
+    <accel:item accel:code="KEY_A" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:AnimationMode"/>
+    <accel:item accel:code="KEY_C" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+    <accel:item accel:code="KEY_F3" xlink:href=".uno:EnterGroup"/>
+    <accel:item accel:code="KEY_F3" accel:mod1="true" xlink:href=".uno:LeaveGroup"/>
+    <accel:item accel:code="KEY_M" accel:mod1="true" xlink:href=".uno:ResetAttributes"/>
+    <accel:item accel:code="KEY_SPACE" accel:shift="true" accel:mod1="true" xlink:href=".uno:InsertNonBreakingSpace"/>
+    <accel:item accel:code="KEY_DIVIDE" accel:mod1="true" xlink:href=".uno:InsertZWSP"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/sdraw/accelerator/en-GB/default.xml sd/uiconfig/sdraw/accelerator/en-GB/default.xml
new file mode 100644
index 0000000..b456bd7
--- /dev/null
+++ sd/uiconfig/sdraw/accelerator/en-GB/default.xml
@@ -0,0 +1,63 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_Q" accel:mod1="true" xlink:href=".uno:Quit"/>
+    <accel:item accel:code="KEY_N" accel:shift="true" accel:mod1="true" xlink:href=".uno:NewDoc"/>
+    <accel:item accel:code="KEY_O" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_OPEN" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_P" accel:mod1="true" xlink:href=".uno:Print"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_F11" xlink:href=".uno:DesignerDialog"/>
+    <accel:item accel:code="KEY_F11" accel:mod1="true" xlink:href=".uno:StyleCatalog"/>
+    <accel:item accel:code="KEY_Y" accel:mod1="true" xlink:href=".uno:Redo"/>
+    <accel:item accel:code="KEY_Z" accel:mod1="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_BACKSPACE" accel:mod2="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_UNDO" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_REPEAT" xlink:href=".uno:Repeat"/>
+    <accel:item accel:code="KEY_X" accel:mod1="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_DELETE" accel:shift="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_CUT" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_C" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_INSERT" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_COPY" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_V" accel:mod1="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_INSERT" accel:shift="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_PASTE" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_DELETE" xlink:href=".uno:Delete"/>
+    <accel:item accel:code="KEY_F2" xlink:href=".uno:Text"/>
+    <accel:item accel:code="KEY_I" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_B" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_U" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_L" accel:mod1="true" xlink:href=".uno:LeftPara"/>
+    <accel:item accel:code="KEY_R" accel:mod1="true" xlink:href=".uno:RightPara"/>
+    <accel:item accel:code="KEY_E" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+    <accel:item accel:code="KEY_J" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_1" accel:mod1="true" xlink:href=".uno:SpacePara1"/>
+    <accel:item accel:code="KEY_5" accel:mod1="true" xlink:href=".uno:SpacePara15"/>
+    <accel:item accel:code="KEY_2" accel:mod1="true" xlink:href=".uno:SpacePara2"/>
+    <accel:item accel:code="KEY_F4" xlink:href=".uno:TransformDialog"/>
+    <accel:item accel:code="KEY_F8" xlink:href=".uno:ToggleObjectBezierMode"/>
+    <accel:item accel:code="KEY_F7" xlink:href=".uno:SpellDialog"/>
+    <accel:item accel:code="KEY_F7" accel:mod1="true" xlink:href=".uno:Thesaurus"/>
+    <accel:item accel:code="KEY_ADD" accel:shift="true" accel:mod1="true" xlink:href=".uno:BringToFront"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:shift="true" accel:mod1="true" xlink:href=".uno:SendToBack"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_B" accel:shift="true" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_F5" xlink:href=".uno:Navigator"/>
+    <accel:item accel:code="KEY_F8" accel:shift="true" accel:mod1="true" xlink:href=".uno:TextFitToSize"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" xlink:href=".uno:FormatGroup"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:FormatUngroup"/>
+    <accel:item accel:code="KEY_9" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:ShowItemBrowser"/>
+    <accel:item accel:code="KEY_V" accel:shift="true" accel:mod1="true" xlink:href=".uno:PasteClipboard"/>
+    <accel:item accel:code="KEY_F3" accel:shift="true" xlink:href=".uno:CopyObjects"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:PixelMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_ADD" accel:mod1="true" xlink:href=".uno:Forward"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:mod1="true" xlink:href=".uno:Backward"/>
+    <accel:item accel:code="KEY_A" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:AnimationMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+    <accel:item accel:code="KEY_F3" xlink:href=".uno:EnterGroup"/>
+    <accel:item accel:code="KEY_F3" accel:mod1="true" xlink:href=".uno:LeaveGroup"/>
+    <accel:item accel:code="KEY_M" accel:mod1="true" xlink:href=".uno:ResetAttributes"/>
+    <accel:item accel:code="KEY_SPACE" accel:shift="true" accel:mod1="true" xlink:href=".uno:InsertNonBreakingSpace"/>
+    <accel:item accel:code="KEY_DIVIDE" accel:mod1="true" xlink:href=".uno:InsertZWSP"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/sdraw/accelerator/en-US/default.xml sd/uiconfig/sdraw/accelerator/en-US/default.xml
new file mode 100644
index 0000000..b456bd7
--- /dev/null
+++ sd/uiconfig/sdraw/accelerator/en-US/default.xml
@@ -0,0 +1,63 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_Q" accel:mod1="true" xlink:href=".uno:Quit"/>
+    <accel:item accel:code="KEY_N" accel:shift="true" accel:mod1="true" xlink:href=".uno:NewDoc"/>
+    <accel:item accel:code="KEY_O" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_OPEN" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_P" accel:mod1="true" xlink:href=".uno:Print"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_F11" xlink:href=".uno:DesignerDialog"/>
+    <accel:item accel:code="KEY_F11" accel:mod1="true" xlink:href=".uno:StyleCatalog"/>
+    <accel:item accel:code="KEY_Y" accel:mod1="true" xlink:href=".uno:Redo"/>
+    <accel:item accel:code="KEY_Z" accel:mod1="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_BACKSPACE" accel:mod2="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_UNDO" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_REPEAT" xlink:href=".uno:Repeat"/>
+    <accel:item accel:code="KEY_X" accel:mod1="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_DELETE" accel:shift="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_CUT" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_C" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_INSERT" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_COPY" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_V" accel:mod1="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_INSERT" accel:shift="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_PASTE" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_DELETE" xlink:href=".uno:Delete"/>
+    <accel:item accel:code="KEY_F2" xlink:href=".uno:Text"/>
+    <accel:item accel:code="KEY_I" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_B" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_U" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_L" accel:mod1="true" xlink:href=".uno:LeftPara"/>
+    <accel:item accel:code="KEY_R" accel:mod1="true" xlink:href=".uno:RightPara"/>
+    <accel:item accel:code="KEY_E" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+    <accel:item accel:code="KEY_J" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_1" accel:mod1="true" xlink:href=".uno:SpacePara1"/>
+    <accel:item accel:code="KEY_5" accel:mod1="true" xlink:href=".uno:SpacePara15"/>
+    <accel:item accel:code="KEY_2" accel:mod1="true" xlink:href=".uno:SpacePara2"/>
+    <accel:item accel:code="KEY_F4" xlink:href=".uno:TransformDialog"/>
+    <accel:item accel:code="KEY_F8" xlink:href=".uno:ToggleObjectBezierMode"/>
+    <accel:item accel:code="KEY_F7" xlink:href=".uno:SpellDialog"/>
+    <accel:item accel:code="KEY_F7" accel:mod1="true" xlink:href=".uno:Thesaurus"/>
+    <accel:item accel:code="KEY_ADD" accel:shift="true" accel:mod1="true" xlink:href=".uno:BringToFront"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:shift="true" accel:mod1="true" xlink:href=".uno:SendToBack"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_B" accel:shift="true" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_F5" xlink:href=".uno:Navigator"/>
+    <accel:item accel:code="KEY_F8" accel:shift="true" accel:mod1="true" xlink:href=".uno:TextFitToSize"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" xlink:href=".uno:FormatGroup"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:FormatUngroup"/>
+    <accel:item accel:code="KEY_9" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:ShowItemBrowser"/>
+    <accel:item accel:code="KEY_V" accel:shift="true" accel:mod1="true" xlink:href=".uno:PasteClipboard"/>
+    <accel:item accel:code="KEY_F3" accel:shift="true" xlink:href=".uno:CopyObjects"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:PixelMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_ADD" accel:mod1="true" xlink:href=".uno:Forward"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:mod1="true" xlink:href=".uno:Backward"/>
+    <accel:item accel:code="KEY_A" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:AnimationMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+    <accel:item accel:code="KEY_F3" xlink:href=".uno:EnterGroup"/>
+    <accel:item accel:code="KEY_F3" accel:mod1="true" xlink:href=".uno:LeaveGroup"/>
+    <accel:item accel:code="KEY_M" accel:mod1="true" xlink:href=".uno:ResetAttributes"/>
+    <accel:item accel:code="KEY_SPACE" accel:shift="true" accel:mod1="true" xlink:href=".uno:InsertNonBreakingSpace"/>
+    <accel:item accel:code="KEY_DIVIDE" accel:mod1="true" xlink:href=".uno:InsertZWSP"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/sdraw/accelerator/es/default.xml sd/uiconfig/sdraw/accelerator/es/default.xml
new file mode 100644
index 0000000..21232d0
--- /dev/null
+++ sd/uiconfig/sdraw/accelerator/es/default.xml
@@ -0,0 +1,63 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_Q" accel:mod1="true" xlink:href=".uno:Quit"/>
+    <accel:item accel:code="KEY_N" accel:shift="true" accel:mod1="true" xlink:href=".uno:NewDoc"/>
+    <accel:item accel:code="KEY_A" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_OPEN" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_P" accel:mod1="true" xlink:href=".uno:Print"/>
+    <accel:item accel:code="KEY_G" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_F11" xlink:href=".uno:DesignerDialog"/>
+    <accel:item accel:code="KEY_F11" accel:mod1="true" xlink:href=".uno:StyleCatalog"/>
+    <accel:item accel:code="KEY_Y" accel:mod1="true" xlink:href=".uno:Redo"/>
+    <accel:item accel:code="KEY_Z" accel:mod1="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_BACKSPACE" accel:mod2="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_UNDO" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_REPEAT" xlink:href=".uno:Repeat"/>
+    <accel:item accel:code="KEY_X" accel:mod1="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_DELETE" accel:shift="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_CUT" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_C" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_INSERT" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_COPY" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_V" accel:mod1="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_INSERT" accel:shift="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_PASTE" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_DELETE" xlink:href=".uno:Delete"/>
+    <accel:item accel:code="KEY_F2" xlink:href=".uno:Text"/>
+    <accel:item accel:code="KEY_K" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_N" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_L" accel:mod1="true" xlink:href=".uno:LeftPara"/>
+    <accel:item accel:code="KEY_R" accel:mod1="true" xlink:href=".uno:RightPara"/>
+    <accel:item accel:code="KEY_T" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+    <accel:item accel:code="KEY_J" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_1" accel:mod1="true" xlink:href=".uno:SpacePara1"/>
+    <accel:item accel:code="KEY_5" accel:mod1="true" xlink:href=".uno:SpacePara15"/>
+    <accel:item accel:code="KEY_2" accel:mod1="true" xlink:href=".uno:SpacePara2"/>
+    <accel:item accel:code="KEY_F4" xlink:href=".uno:TransformDialog"/>
+    <accel:item accel:code="KEY_F8" xlink:href=".uno:ToggleObjectBezierMode"/>
+    <accel:item accel:code="KEY_F7" xlink:href=".uno:SpellDialog"/>
+    <accel:item accel:code="KEY_F7" accel:mod1="true" xlink:href=".uno:Thesaurus"/>
+    <accel:item accel:code="KEY_ADD" accel:shift="true" accel:mod1="true" xlink:href=".uno:BringToFront"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:shift="true" accel:mod1="true" xlink:href=".uno:SendToBack"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_B" accel:shift="true" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_F5" xlink:href=".uno:Navigator"/>
+    <accel:item accel:code="KEY_F8" accel:shift="true" accel:mod1="true" xlink:href=".uno:TextFitToSize"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" xlink:href=".uno:FormatGroup"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:FormatUngroup"/>
+    <accel:item accel:code="KEY_9" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:ShowItemBrowser"/>
+    <accel:item accel:code="KEY_V" accel:shift="true" accel:mod1="true" xlink:href=".uno:PasteClipboard"/>
+    <accel:item accel:code="KEY_F3" accel:shift="true" xlink:href=".uno:CopyObjects"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:PixelMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_ADD" accel:mod1="true" xlink:href=".uno:Forward"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:mod1="true" xlink:href=".uno:Backward"/>
+    <accel:item accel:code="KEY_A" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:AnimationMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+    <accel:item accel:code="KEY_F3" xlink:href=".uno:EnterGroup"/>
+    <accel:item accel:code="KEY_F3" accel:mod1="true" xlink:href=".uno:LeaveGroup"/>
+    <accel:item accel:code="KEY_M" accel:mod1="true" xlink:href=".uno:ResetAttributes"/>
+    <accel:item accel:code="KEY_SPACE" accel:shift="true" accel:mod1="true" xlink:href=".uno:InsertNonBreakingSpace"/>
+    <accel:item accel:code="KEY_DIVIDE" accel:mod1="true" xlink:href=".uno:InsertZWSP"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/sdraw/accelerator/fr/default.xml sd/uiconfig/sdraw/accelerator/fr/default.xml
new file mode 100644
index 0000000..a982586
--- /dev/null
+++ sd/uiconfig/sdraw/accelerator/fr/default.xml
@@ -0,0 +1,63 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_Q" accel:mod1="true" xlink:href=".uno:Quit"/>
+    <accel:item accel:code="KEY_N" accel:shift="true" accel:mod1="true" xlink:href=".uno:NewDoc"/>
+    <accel:item accel:code="KEY_O" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_OPEN" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_P" accel:mod1="true" xlink:href=".uno:Print"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_F11" xlink:href=".uno:DesignerDialog"/>
+    <accel:item accel:code="KEY_F11" accel:mod1="true" xlink:href=".uno:StyleCatalog"/>
+    <accel:item accel:code="KEY_Y" accel:mod1="true" xlink:href=".uno:Redo"/>
+    <accel:item accel:code="KEY_Z" accel:mod1="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_BACKSPACE" accel:mod2="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_UNDO" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_REPEAT" xlink:href=".uno:Repeat"/>
+    <accel:item accel:code="KEY_X" accel:mod1="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_DELETE" accel:shift="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_CUT" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_C" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_INSERT" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_COPY" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_V" accel:mod1="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_INSERT" accel:shift="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_PASTE" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_DELETE" xlink:href=".uno:Delete"/>
+    <accel:item accel:code="KEY_F2" xlink:href=".uno:Text"/>
+    <accel:item accel:code="KEY_I" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_G" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_U" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_L" accel:mod1="true" xlink:href=".uno:LeftPara"/>
+    <accel:item accel:code="KEY_R" accel:mod1="true" xlink:href=".uno:RightPara"/>
+    <accel:item accel:code="KEY_E" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+    <accel:item accel:code="KEY_J" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_1" accel:mod1="true" xlink:href=".uno:SpacePara1"/>
+    <accel:item accel:code="KEY_5" accel:mod1="true" xlink:href=".uno:SpacePara15"/>
+    <accel:item accel:code="KEY_2" accel:mod1="true" xlink:href=".uno:SpacePara2"/>
+    <accel:item accel:code="KEY_F4" xlink:href=".uno:TransformDialog"/>
+    <accel:item accel:code="KEY_F8" xlink:href=".uno:ToggleObjectBezierMode"/>
+    <accel:item accel:code="KEY_F7" xlink:href=".uno:SpellDialog"/>
+    <accel:item accel:code="KEY_F7" accel:mod1="true" xlink:href=".uno:Thesaurus"/>
+    <accel:item accel:code="KEY_ADD" accel:shift="true" accel:mod1="true" xlink:href=".uno:BringToFront"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:shift="true" accel:mod1="true" xlink:href=".uno:SendToBack"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_B" accel:shift="true" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_F5" xlink:href=".uno:Navigator"/>
+    <accel:item accel:code="KEY_F8" accel:shift="true" accel:mod1="true" xlink:href=".uno:TextFitToSize"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" xlink:href=".uno:FormatGroup"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:FormatUngroup"/>
+    <accel:item accel:code="KEY_9" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:ShowItemBrowser"/>
+    <accel:item accel:code="KEY_V" accel:shift="true" accel:mod1="true" xlink:href=".uno:PasteClipboard"/>
+    <accel:item accel:code="KEY_F3" accel:shift="true" xlink:href=".uno:CopyObjects"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:PixelMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_ADD" accel:mod1="true" xlink:href=".uno:Forward"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:mod1="true" xlink:href=".uno:Backward"/>
+    <accel:item accel:code="KEY_A" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:AnimationMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+    <accel:item accel:code="KEY_F3" xlink:href=".uno:EnterGroup"/>
+    <accel:item accel:code="KEY_F3" accel:mod1="true" xlink:href=".uno:LeaveGroup"/>
+    <accel:item accel:code="KEY_M" accel:mod1="true" xlink:href=".uno:ResetAttributes"/>
+    <accel:item accel:code="KEY_SPACE" accel:shift="true" accel:mod1="true" xlink:href=".uno:InsertNonBreakingSpace"/>
+    <accel:item accel:code="KEY_DIVIDE" accel:mod1="true" xlink:href=".uno:InsertZWSP"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/sdraw/menubar/menubar.xml sd/uiconfig/sdraw/menubar/menubar.xml
index 9e5d927..77aedd9 100644
--- sd/uiconfig/sdraw/menubar/menubar.xml
+++ sd/uiconfig/sdraw/menubar/menubar.xml
@@ -1,50 +1,39 @@
 <?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE menu:menubar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "menubar.dtd">
 <menu:menubar xmlns:menu="http://openoffice.org/2001/menu" menu:id="menubar">
-    <menu:menu menu:id=".uno:PickList">
+ <menu:menu menu:id=".uno:PickList" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:AddDirect"/>
             <menu:menuitem menu:id=".uno:Open"/>
             <menu:menuitem menu:id=".uno:RecentFileList"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:AutoPilotMenu"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:CloseDoc"/>
             <menu:menuitem menu:id=".uno:Save"/>
             <menu:menuitem menu:id=".uno:SaveAs"/>
-            <menu:menuitem menu:id=".uno:SaveAll"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Reload"/>
             <menu:menuitem menu:id=".uno:VersionDialog"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:ExportTo"/>
             <menu:menuitem menu:id=".uno:ExportToPDF"/>
-            <menu:menu menu:id=".uno:SendMenu">
+   <menu:menu menu:id=".uno:SendMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:SendMail"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsPDF"/>
                 </menu:menupopup>
             </menu:menu>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SetDocumentProperties"/>
-            <menu:menuitem menu:id=".uno:Signature"/>
-            <menu:menu menu:id=".uno:TemplateMenu">
+   <menu:menu menu:id=".uno:TemplateMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:Organizer"/>
-                    <menu:menuitem menu:id=".uno:AddressBookSource"/>
                     <menu:menuitem menu:id=".uno:SaveAsTemplate"/>
                     <menu:menuitem menu:id=".uno:OpenTemplate"/>
                 </menu:menupopup>
             </menu:menu>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:WebHtml"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Print"/>
-            <menu:menuitem menu:id=".uno:PrinterSetup"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:Quit"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:EditMenu">
+ <menu:menu menu:id=".uno:EditMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:Undo"/>
             <menu:menuitem menu:id=".uno:Redo"/>
@@ -55,8 +44,6 @@
                         <menu:menuitem menu:id=".uno:PasteSpecial"/>
             <menu:menuitem menu:id=".uno:SelectAll"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SearchDialog"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:CopyObjects"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:ToggleObjectBezierMode"/>
@@ -73,12 +60,12 @@
             <menu:menuitem menu:id=".uno:EditHyperlink"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:ViewMenu">
+ <menu:menu menu:id=".uno:ViewMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:PageMode"/>
             <menu:menuitem menu:id=".uno:MasterPage"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:DisplayQualityMenu">
+   <menu:menu menu:id=".uno:DisplayQualityMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:OutputQualityColor"/>
                     <menu:menuitem menu:id=".uno:OutputQualityGrayscale"/>
@@ -91,14 +78,14 @@
             <menu:menuitem menu:id=".uno:StatusBarVisible"/>
             <menu:menuitem menu:id=".uno:ShowImeStatusWindow"/>
             <menu:menuitem menu:id=".uno:ShowRuler"/>
-            <menu:menu menu:id=".uno:GridMenu">
+   <menu:menu menu:id=".uno:GridMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:GridVisible"/>
                     <menu:menuitem menu:id=".uno:GridUse"/>
                     <menu:menuitem menu:id=".uno:GridFront"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:SnapLinesMenu">
+   <menu:menu menu:id=".uno:SnapLinesMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:HelplinesVisible"/>
                     <menu:menuitem menu:id=".uno:HelplinesUse"/>
@@ -112,13 +99,13 @@
             <menu:menuitem menu:id=".uno:Zoom"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:InsertMenu">
+  <menu:menu menu:id=".uno:InsertMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:InsertPage"/>
             <menu:menuitem menu:id=".uno:DuplicatePage"/>
             <menu:menuitem menu:id=".uno:InsertLayer"/>
             <menu:menuitem menu:id=".uno:CapturePoint"/>
-            <menu:menu menu:id=".uno:FieldMenu">
+   <menu:menu menu:id=".uno:FieldMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertDateFieldFix"/>
                     <menu:menuitem menu:id=".uno:InsertDateFieldVar"/>
@@ -131,25 +118,13 @@
           <menu:menuitem menu:id=".uno:InsertFileField"/>
                 </menu:menupopup>
             </menu:menu>
-      <menu:menuitem menu:id=".uno:InsertAnnotation"/>
       <menu:menuitem menu:id=".uno:InsertSymbol"/>
-      <menu:menu menu:id=".uno:FormattingMarkMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertNonBreakingSpace"/>
-                    <menu:menuitem menu:id=".uno:InsertHardHyphen"/>
-                    <menu:menuitem menu:id=".uno:InsertSoftHyphen"/>
-                    <menu:menuitem menu:id=".uno:InsertZWSP"/>
-                    <menu:menuitem menu:id=".uno:InsertZWNBSP"/>
-                    <menu:menuitem menu:id=".uno:InsertLRM"/>
-                    <menu:menuitem menu:id=".uno:InsertRLM"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuitem menu:id=".uno:HyperlinkDialog"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:GraphicMenu">
+   <menu:menu menu:id=".uno:GraphicMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertGraphic"/>
-                    <menu:menu menu:id=".uno:Scan">
+     <menu:menu menu:id=".uno:Scan" menu:label="">
                         <menu:menupopup>
                             <menu:menuitem menu:id=".uno:TwainSelect"/>
                             <menu:menuitem menu:id=".uno:TwainTransfer"/>
@@ -159,7 +134,7 @@
             </menu:menu>
             <menu:menuitem menu:id=".uno:InsertTable"/>
             <menu:menuitem menu:id=".uno:InsertAVMedia"/>
-            <menu:menu menu:id=".uno:ObjectMenu">
+   <menu:menu menu:id=".uno:ObjectMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertObject"/>
                     <menu:menuitem menu:id=".uno:InsertPlugin"/>
@@ -174,26 +149,10 @@
             <menu:menuitem menu:id=".uno:ImportFromFile"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:FormatMenu">
+ <menu:menu menu:id=".uno:FormatMenu" menu:label="">
         <menu:menupopup>
-            <menu:menuitem menu:id=".uno:SetDefault"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:FontDialog"/>
-            <menu:menuitem menu:id=".uno:ParagraphDialog"/>
-            <menu:menuitem menu:id=".uno:OutlineBullet"/>
             <menu:menuitem menu:id=".uno:PageSetup"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:TransliterateMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToUpper"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToLower"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToHalfWidth"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToFullWidth"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToHiragana"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToKatakana"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:TransformDialog"/>
             <menu:menuitem menu:id=".uno:FormatLine"/>
             <menu:menuitem menu:id=".uno:FormatArea"/>
@@ -204,52 +163,27 @@
             <menu:menuitem menu:id=".uno:DesignerDialog"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:ToolsMenu">
-        <menu:menupopup>
-            <menu:menuitem menu:id=".uno:SpellDialog"/>
-            <menu:menu menu:id=".uno:LanguageMenu">
+ <menu:menu menu:id=".uno:ToolsMenu" menu:label="">
                 <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:HangulHanjaConversion"/>
-                    <menu:menuitem menu:id=".uno:ChineseConversion"/>
-                    <menu:menuitem menu:id=".uno:Thesaurus"/>
-                    <menu:menuitem menu:id=".uno:Hyphenation"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MoreDictionaries"/>
-                </menu:menupopup>
-            </menu:menu>
       <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Gallery"/>
             <menu:menuitem menu:id=".uno:BmpMask"/>
             <menu:menuitem menu:id=".uno:AVMediaPlayer"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:MacrosMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:MacroRecorder"/>
-                    <menu:menuitem menu:id=".uno:RunMacro"/>
-                    <menu:menu menu:id=".uno:ScriptOrganizer"/>
-                    <menu:menuitem menu:id=".uno:MacroSignature"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MacroOrganizer?TabId:short=1"/>
-                </menu:menupopup>
-            </menu:menu>
-
-            <menu:menuitem menu:id="service:com.sun.star.deployment.ui.PackageManagerDialog"/>
-            <menu:menuitem menu:id=".uno:OpenXMLFilterSettings"/>
-            <menu:menuitem menu:id=".uno:AutoCorrectDlg"/>
             <menu:menuitem menu:id=".uno:ConfigureDialog"/>
             <menu:menuitem menu:id=".uno:OptionsTreeDialog"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:ModifyMenu">
+ <menu:menu menu:id=".uno:ModifyMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:ToggleObjectRotateMode"/>
-            <menu:menu menu:id=".uno:MirrorMenu">
+   <menu:menu menu:id=".uno:MirrorMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:MirrorVert"/>
                     <menu:menuitem menu:id=".uno:MirrorHorz"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:ConvertMenu">
+   <menu:menu menu:id=".uno:ConvertMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:ChangeBezier"/>
                     <menu:menuitem menu:id=".uno:ChangePolygon"/>
@@ -261,7 +195,7 @@
                 </menu:menupopup>
             </menu:menu>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:ArrangeMenu">
+   <menu:menu menu:id=".uno:ArrangeMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:BringToFront"/>
                     <menu:menuitem menu:id=".uno:Forward"/>
@@ -274,7 +208,7 @@
                     <menu:menuitem menu:id=".uno:ReverseOrder"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:ObjectAlign">
+   <menu:menu menu:id=".uno:ObjectAlign" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:ObjectAlignLeft"/>
                     <menu:menuitem menu:id=".uno:AlignCenter"/>
@@ -297,7 +231,7 @@
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Combine"/>
             <menu:menuitem menu:id=".uno:Dismantle"/>
-            <menu:menu menu:id=".uno:PolyFormen">
+   <menu:menu menu:id=".uno:PolyFormen" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:Merge"/>
                     <menu:menuitem menu:id=".uno:Substract"/>
@@ -309,22 +243,20 @@
             <menu:menuitem menu:id=".uno:Break"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:WindowList">
+ <menu:menu menu:id=".uno:WindowList" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:NewWindow"/>
             <menu:menuitem menu:id=".uno:CloseWin"/>
             <menu:menuseparator/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:HelpMenu">
+ <menu:menu menu:id=".uno:HelpMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:HelpIndex"/>
             <menu:menuitem menu:id=".uno:ExtendedHelp"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:HelpSupport"/>
-            <menu:menuitem menu:id=".uno:OnlineRegistrationDlg"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:About"/>
+   <menu:menuitem menu:id=".uno:ShowLicense"/>
         </menu:menupopup>
     </menu:menu>
 </menu:menubar>
diff --git sd/uiconfig/sdraw/toolbar/average.xml sd/uiconfig/sdraw/toolbar/average.xml
new file mode 100644
index 0000000..c5eeca2
--- /dev/null
+++ sd/uiconfig/sdraw/toolbar/average.xml
@@ -0,0 +1,37 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:visible="false" toolbar:helpid="10140"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="5678"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Window3D" toolbar:visible="false" toolbar:helpid="helpid:10644"/>
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:visible="false" toolbar:helpid="10096"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sd/uiconfig/sdraw/toolbar/beginner.xml sd/uiconfig/sdraw/toolbar/beginner.xml
new file mode 100644
index 0000000..c5eeca2
--- /dev/null
+++ sd/uiconfig/sdraw/toolbar/beginner.xml
@@ -0,0 +1,37 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:visible="false" toolbar:helpid="10140"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="5678"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Window3D" toolbar:visible="false" toolbar:helpid="helpid:10644"/>
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:visible="false" toolbar:helpid="10096"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sd/uiconfig/sdraw/toolbar/draw_average.xml sd/uiconfig/sdraw/toolbar/draw_average.xml
new file mode 100644
index 0000000..c5eeca2
--- /dev/null
+++ sd/uiconfig/sdraw/toolbar/draw_average.xml
@@ -0,0 +1,37 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:visible="false" toolbar:helpid="10140"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="5678"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Window3D" toolbar:visible="false" toolbar:helpid="helpid:10644"/>
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:visible="false" toolbar:helpid="10096"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sd/uiconfig/sdraw/toolbar/draw_beginner.xml sd/uiconfig/sdraw/toolbar/draw_beginner.xml
new file mode 100644
index 0000000..c5eeca2
--- /dev/null
+++ sd/uiconfig/sdraw/toolbar/draw_beginner.xml
@@ -0,0 +1,37 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="5537"/>
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="5500"/>
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="5501"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="6312"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="12021"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="5710"/>
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="5711"/>
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="5712"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="5715"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="5701"/>
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="5700"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:visible="false" toolbar:helpid="10140"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="5678"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Window3D" toolbar:visible="false" toolbar:helpid="helpid:10644"/>
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:visible="false" toolbar:helpid="10096"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sd/uiconfig/sdraw/toolbar/drawingobjectbar.xml sd/uiconfig/sdraw/toolbar/drawingobjectbar.xml
index 4c322a9..619c1cd 100644
--- sd/uiconfig/sdraw/toolbar/drawingobjectbar.xml
+++ sd/uiconfig/sdraw/toolbar/drawingobjectbar.xml
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
 <toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
- <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:helpid="5539"/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:visible="false" toolbar:helpid="5539"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:FormatLine" toolbar:helpid="10143"/>
  <toolbar:toolbaritem xlink:href=".uno:LineEndStyle" toolbar:helpid="10301"/>
diff --git sd/uiconfig/sdraw/toolbar/standardbar.xml sd/uiconfig/sdraw/toolbar/standardbar.xml
index a53982f..f989485 100644
--- sd/uiconfig/sdraw/toolbar/standardbar.xml
+++ sd/uiconfig/sdraw/toolbar/standardbar.xml
@@ -5,17 +5,17 @@
  <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="5537"/>
  <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="5500"/>
  <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="5501"/>
- <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="5505"/>
- <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:visible="false" toolbar:helpid="5502"/>
- <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="5331"/>
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:visible="false" toolbar:helpid="5505"/>
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="5331"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="6312"/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="6312"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
- <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:helpid="20622"/>
- <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid="12021"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:visible="false" toolbar:helpid="20622"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:visible="false" toolbar:helpid="12021"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="5710"/>
  <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="5711"/>
@@ -25,13 +25,13 @@
  <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="5701"/>
  <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="5700"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="10140"/>
- <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:visible="false" toolbar:helpid="10140"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="5678"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="10366"/>
- <toolbar:toolbaritem xlink:href=".uno:Window3D" toolbar:helpid="helpid:10644" toolbar:style="auto" toolbar:visible="false"/>
- <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:helpid="10096"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Window3D" toolbar:visible="false" toolbar:helpid="helpid:10644"/>
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:visible="false" toolbar:helpid="10096"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:HelpIndex"/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:visible="false"/>
  <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false"/>
 </toolbar:toolbar>
diff --git sd/uiconfig/simpress/accelerator/de/default.xml sd/uiconfig/simpress/accelerator/de/default.xml
new file mode 100644
index 0000000..0e181fc
--- /dev/null
+++ sd/uiconfig/simpress/accelerator/de/default.xml
@@ -0,0 +1,11 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_F" accel:shift="true" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_U" accel:shift="true" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_B" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_H" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_T" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_C" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_C" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/simpress/accelerator/default.xml sd/uiconfig/simpress/accelerator/default.xml
new file mode 100644
index 0000000..daa158c
--- /dev/null
+++ sd/uiconfig/simpress/accelerator/default.xml
@@ -0,0 +1,71 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_Q" accel:mod1="true" xlink:href=".uno:Quit"/>
+    <accel:item accel:code="KEY_N" accel:shift="true" accel:mod1="true" xlink:href=".uno:NewDoc"/>
+    <accel:item accel:code="KEY_O" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_OPEN" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_P" accel:mod1="true" xlink:href=".uno:Print"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_F11" xlink:href=".uno:DesignerDialog"/>
+    <accel:item accel:code="KEY_F11" accel:mod1="true" xlink:href=".uno:StyleCatalog"/>
+    <accel:item accel:code="KEY_Y" accel:mod1="true" xlink:href=".uno:Redo"/>
+    <accel:item accel:code="KEY_Z" accel:mod1="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_BACKSPACE" accel:mod2="true" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_UNDO" xlink:href=".uno:Undo"/>
+    <accel:item accel:code="KEY_REPEAT" xlink:href=".uno:Repeat"/>
+    <accel:item accel:code="KEY_X" accel:mod1="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_DELETE" accel:shift="true" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_CUT" xlink:href=".uno:Cut"/>
+    <accel:item accel:code="KEY_C" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_INSERT" accel:mod1="true" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_COPY" xlink:href=".uno:Copy"/>
+    <accel:item accel:code="KEY_V" accel:mod1="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_INSERT" accel:shift="true" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_PASTE" xlink:href=".uno:Paste"/>
+    <accel:item accel:code="KEY_DELETE" xlink:href=".uno:Delete"/>
+    <accel:item accel:code="KEY_F2" xlink:href=".uno:Text"/>
+    <accel:item accel:code="KEY_I" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_B" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_U" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_L" accel:mod1="true" xlink:href=".uno:LeftPara"/>
+    <accel:item accel:code="KEY_R" accel:mod1="true" xlink:href=".uno:RightPara"/>
+    <accel:item accel:code="KEY_E" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+    <accel:item accel:code="KEY_J" accel:mod1="true" xlink:href=".uno:JustifyPara"/>
+    <accel:item accel:code="KEY_1" accel:mod1="true" xlink:href=".uno:SpacePara1"/>
+    <accel:item accel:code="KEY_5" accel:mod1="true" xlink:href=".uno:SpacePara15"/>
+    <accel:item accel:code="KEY_2" accel:mod1="true" xlink:href=".uno:SpacePara2"/>
+    <accel:item accel:code="KEY_F4" xlink:href=".uno:TransformDialog"/>
+    <accel:item accel:code="KEY_F8" xlink:href=".uno:ToggleObjectBezierMode"/>
+    <accel:item accel:code="KEY_F7" xlink:href=".uno:SpellDialog"/>
+    <accel:item accel:code="KEY_F7" accel:mod1="true" xlink:href=".uno:Thesaurus"/>
+    <accel:item accel:code="KEY_ADD" accel:shift="true" accel:mod1="true" xlink:href=".uno:BringToFront"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:shift="true" accel:mod1="true" xlink:href=".uno:SendToBack"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" xlink:href=".uno:SuperScript"/>
+    <accel:item accel:code="KEY_B" accel:shift="true" accel:mod1="true" xlink:href=".uno:SubScript"/>
+    <accel:item accel:code="KEY_F5" accel:shift="true" accel:mod1="true" xlink:href=".uno:Navigator"/>
+    <accel:item accel:code="KEY_F5" accel:shift="true" xlink:href=".uno:RestoreEditingView"/>
+    <accel:item accel:code="KEY_F5" xlink:href=".uno:Presentation"/>
+    <accel:item accel:code="KEY_F2" accel:mod1="true" xlink:href=".uno:Presentation"/>
+    <accel:item accel:code="KEY_F9" xlink:href=".uno:Presentation"/>
+    <accel:item accel:code="KEY_F8" accel:shift="true" accel:mod1="true" xlink:href=".uno:TextFitToSize"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" xlink:href=".uno:FormatGroup"/>
+    <accel:item accel:code="KEY_G" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:FormatUngroup"/>
+    <accel:item accel:code="KEY_9" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:ShowItemBrowser"/>
+    <accel:item accel:code="KEY_V" accel:shift="true" accel:mod1="true" xlink:href=".uno:PasteClipboard"/>
+    <accel:item accel:code="KEY_F3" accel:shift="true" xlink:href=".uno:CopyObjects"/>
+    <accel:item accel:code="KEY_P" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:PixelMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" xlink:href=".uno:Combine"/>
+    <accel:item accel:code="KEY_ADD" accel:mod1="true" xlink:href=".uno:Forward"/>
+    <accel:item accel:code="KEY_SUBTRACT" accel:mod1="true" xlink:href=".uno:Backward"/>
+    <accel:item accel:code="KEY_A" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:AnimationMode"/>
+    <accel:item accel:code="KEY_K" accel:shift="true" accel:mod1="true" accel:mod2="true" xlink:href=".uno:Dismantle"/>
+    <accel:item accel:code="KEY_F3" xlink:href=".uno:EnterGroup"/>
+    <accel:item accel:code="KEY_F3" accel:mod1="true" xlink:href=".uno:LeaveGroup"/>
+    <accel:item accel:code="KEY_M" accel:mod1="true" xlink:href=".uno:ResetAttributes"/>
+    <accel:item accel:code="KEY_SPACE" accel:shift="true" accel:mod1="true" xlink:href=".uno:InsertNonBreakingSpace"/>
+    <accel:item accel:code="KEY_DIVIDE" accel:mod1="true" xlink:href=".uno:InsertZWSP"/>
+    <accel:item accel:code="KEY_UP" accel:shift="true" accel:mod2="true" xlink:href=".uno:OutlineUp"/>
+    <accel:item accel:code="KEY_DOWN" accel:shift="true" accel:mod2="true" xlink:href=".uno:OutlineDown"/>
+    <accel:item accel:code="KEY_LEFT" accel:shift="true" accel:mod2="true" xlink:href=".uno:OutlineLeft"/>
+    <accel:item accel:code="KEY_RIGHT" accel:shift="true" accel:mod2="true" xlink:href=".uno:OutlineRight"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/simpress/accelerator/es/default.xml sd/uiconfig/simpress/accelerator/es/default.xml
new file mode 100644
index 0000000..bb358a1
--- /dev/null
+++ sd/uiconfig/simpress/accelerator/es/default.xml
@@ -0,0 +1,9 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_A" accel:mod1="true" xlink:href=".uno:Open"/>
+    <accel:item accel:code="KEY_G" accel:mod1="true" xlink:href=".uno:Save"/>
+    <accel:item accel:code="KEY_K" accel:mod1="true" xlink:href=".uno:Italic"/>
+    <accel:item accel:code="KEY_N" accel:mod1="true" xlink:href=".uno:Bold"/>
+    <accel:item accel:code="KEY_S" accel:mod1="true" xlink:href=".uno:Underline"/>
+    <accel:item accel:code="KEY_T" accel:mod1="true" xlink:href=".uno:CenterPara"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/simpress/accelerator/fr/default.xml sd/uiconfig/simpress/accelerator/fr/default.xml
new file mode 100644
index 0000000..9c2c54a
--- /dev/null
+++ sd/uiconfig/simpress/accelerator/fr/default.xml
@@ -0,0 +1,4 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<accel:acceleratorlist xmlns:accel="http://openoffice.org/2001/accel" xmlns:xlink="http://www.w3.org/1999/xlink">
+    <accel:item accel:code="KEY_G" accel:mod1="true" xlink:href=".uno:Bold"/>
+</accel:acceleratorlist>
diff --git sd/uiconfig/simpress/menubar/menubar.xml sd/uiconfig/simpress/menubar/menubar.xml
index c1dacd3..09104f7 100644
--- sd/uiconfig/simpress/menubar/menubar.xml
+++ sd/uiconfig/simpress/menubar/menubar.xml
@@ -296,10 +296,8 @@
             <menu:menuitem menu:id=".uno:HelpIndex"/>
             <menu:menuitem menu:id=".uno:ExtendedHelp"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:HelpSupport"/>
-            <menu:menuitem menu:id=".uno:OnlineRegistrationDlg"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:About"/>
+            <menu:menuitem menu:id=".uno:ShowLicense"/>
         </menu:menupopup>
     </menu:menu>
 </menu:menubar>
diff --git sd/uiconfig/simpress/toolbar/average.xml sd/uiconfig/simpress/toolbar/average.xml
new file mode 100644
index 0000000..e1d7147
--- /dev/null
+++ sd/uiconfig/simpress/toolbar/average.xml
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"  />
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"  toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"  />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505"  />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674"  />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:helpid="helpid:20622"  />
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid="12021"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"  />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"  />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"  />
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"  />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="10140"  />
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid="helpid:10141"  />
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="5678"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322"  toolbar:style="auto" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="helpid:10366"  />
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:helpid="helpid:10096"  toolbar:style="dropdown" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex"  />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false" />
+</toolbar:toolbar>
diff --git sd/uiconfig/simpress/toolbar/beginner.xml sd/uiconfig/simpress/toolbar/beginner.xml
new file mode 100644
index 0000000..e1d7147
--- /dev/null
+++ sd/uiconfig/simpress/toolbar/beginner.xml
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"  />
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"  toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"  />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505"  />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674"  />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:helpid="helpid:20622"  />
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid="12021"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"  />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"  />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"  />
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"  />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="10140"  />
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid="helpid:10141"  />
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="5678"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322"  toolbar:style="auto" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="helpid:10366"  />
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:helpid="helpid:10096"  toolbar:style="dropdown" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex"  />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false" />
+</toolbar:toolbar>
diff --git sd/uiconfig/simpress/toolbar/impress_average.xml sd/uiconfig/simpress/toolbar/impress_average.xml
new file mode 100644
index 0000000..e1d7147
--- /dev/null
+++ sd/uiconfig/simpress/toolbar/impress_average.xml
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"  />
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"  toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"  />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505"  />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674"  />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:helpid="helpid:20622"  />
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid="12021"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"  />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"  />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"  />
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"  />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="10140"  />
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid="helpid:10141"  />
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="5678"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322"  toolbar:style="auto" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="helpid:10366"  />
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:helpid="helpid:10096"  toolbar:style="dropdown" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex"  />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false" />
+</toolbar:toolbar>
diff --git sd/uiconfig/simpress/toolbar/impress_beginner.xml sd/uiconfig/simpress/toolbar/impress_beginner.xml
new file mode 100644
index 0000000..e1d7147
--- /dev/null
+++ sd/uiconfig/simpress/toolbar/impress_beginner.xml
@@ -0,0 +1,39 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"  />
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537"  toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501"  />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505"  />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674"  />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellDialog" toolbar:helpid="helpid:20622"  />
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid="12021"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710"  />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"  />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712"  />
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="helpid:5715"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701"  />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertObjectChart" toolbar:helpid="10140"  />
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid="helpid:10141"  />
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="5678"  />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:GridVisible" toolbar:helpid="helpid:27322"  toolbar:style="auto" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="helpid:10366"  />
+ <toolbar:toolbaritem xlink:href=".uno:ZoomToolBox" toolbar:helpid="helpid:10096"  toolbar:style="dropdown" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex"  />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false" />
+</toolbar:toolbar>
diff --git set_soenv.in set_soenv.in
index 591347f..f12630e 100644
--- set_soenv.in
+++ set_soenv.in
@@ -9,7 +9,7 @@
 #---------------------------------------------------------------------------
 # Description:
 # set_soenv generates a file that contains all necessary 
-# environment variables for the build proces of OpenOffice
+# environment variables for the build proces of OOo4Kids
 # on Linux, NetBSD, Solaris, Windows NT and Mac OS X/Darwin.
 #
 # Program steps.
@@ -1605,6 +1605,8 @@ ToFile( "WITH_LANG",         "@WITH_LANG@",      "e" );
 ToFile( "INTRO_BITMAPS",     "@INTRO_BITMAPS@",  "e" );
 ToFile( "ABOUT_BITMAPS",     "@ABOUT_BITMAPS@",  "e" );
 ToFile( "OOO_VENDOR",        "@OOO_VENDOR@",     "e" );
+ToFile( "OOo4Kids",          "@OOo4Kids@",     "e" );
+ToFile( "XO_INTEL",          "@XO_INTEL@",     "e" );
 ToFile( "OOODMAKEMODE",      "YES",              "e" );
 ToFile( "WITH_POOR_HELP_LOCALIZATIONS", "@WITH_POOR_HELP_LOCALIZATIONS@", "e" );
 
@@ -1654,6 +1656,7 @@ ToFile( "ENABLE_STATIC_GTK", "@ENABLE_STATIC_GTK@", "e" );
 ToFile( "ENABLE_CAIRO",      "@ENABLE_CAIRO@",     "e" );
 ToFile( "ENABLE_OPENGL",     "@ENABLE_OPENGL@",    "e" );
 ToFile( "ENABLE_PDFIMPORT",  "@ENABLE_PDFIMPORT@", "e" );
+ToFile( "ENABLE_PRESENTER_EXTRA_UI","@ENABLE_PRESENTER_EXTRA_UI@","e" );
 ToFile( "ENABLE_MINIMIZER",   "@ENABLE_MINIMIZER@","e" );
 ToFile( "ENABLE_PRESENTER_SCREEN","@ENABLE_PRESENTER_SCREEN@","e" );
 ToFile( "ENABLE_REPORTBUILDER","@ENABLE_REPORTBUILDER@","e" );
@@ -1680,6 +1683,7 @@ ToFile( "SERVLETAPI_JAR",    "@SERVLETAPI_JAR@",   "e" );
 ToFile( "ENABLE_DBUS",       "@ENABLE_DBUS@",      "e" );
 ToFile( "ENABLE_GCONF",      "@ENABLE_GCONF@",     "e" );
 ToFile( "ENABLE_GNOMEVFS",   "@ENABLE_GNOMEVFS@",  "e" );
+ToFile( "ENABLE_GSTREAMER",  "@ENABLE_GSTREAMER@", "e" );
 ToFile( "ENABLE_GIO",        "@ENABLE_GIO@",       "e" );
 ToFile( "ENABLE_KDE",        "@ENABLE_KDE@",       "e" );
 ToFile( "KDE_CFLAGS",        "@KDE_CFLAGS@",       "e" );
@@ -2129,12 +2133,12 @@ if(defined($outfile_bat))
 #
 print "*********************************************************".
       "******************* $newline"."*"."$newline";
-print "* OpenOffice.org $UPD configuration. $newline";
+print "* OOo4Kids $UPD configuration. $newline";
 for ( $tmp = 0; $tmp < 2; $tmp++ ) 
 {  print "* $newline";
 }
-print "* Configuration part of OpenOffice.org $UPD build is finished. $newline* $newline";
-print "* NB! Be aware that you might not be able to build OpenOffice.org if you $newline".
+print "* Configuration part of OOo4Kids $UPD build is finished. $newline* $newline";
+print "* NB! Be aware that you might not be able to build OOo4Kids if you $newline".
       "* ignore any warning message that were generated during this configuration $newline".
       "* process. $newline* $newline";
 
diff --git setup_native/scripts/update.sh setup_native/scripts/update.sh
index 176352d..43d285e 100644
--- setup_native/scripts/update.sh
+++ setup_native/scripts/update.sh
@@ -99,7 +99,7 @@ elevate() {
 
 
 update_pkg() {
-  ADMINFILE=`make_tempfile 'OpenOffice.org-Online-Update-admin'`
+  ADMINFILE=`make_tempfile 'OOo4Kids-Online-Update-admin'`
   
 cat >> $ADMINFILE << EOF
 action=nocheck
diff --git setup_native/scripts/userland.txt setup_native/scripts/userland.txt
index 7c7ef86..f127166 100644
--- setup_native/scripts/userland.txt
+++ setup_native/scripts/userland.txt
@@ -29,4 +29,4 @@
 #
 #*************************************************************************
 
-USERLANDPACKAGENAME=openoffice.org-userland-1.0-0.noarch.rpm
+USERLANDPACKAGENAME=ooo4kids-userland-1.0-0.noarch.rpm
diff --git setup_native/source/packinfo/package_names.txt setup_native/source/packinfo/package_names.txt
index cb453b2..b019136 100644
--- setup_native/source/packinfo/package_names.txt
+++ setup_native/source/packinfo/package_names.txt
@@ -1,46 +1,44 @@
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING	Language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-base	Base language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-binfilter	Legacy filters (e.g. StarOffice 5.2) for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-calc	Calc language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-draw	Draw language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-fonts	Language fonts module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-help	Language help module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-impress	Impress language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-math	Math language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-onlineupd	Online update language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-res	Language resource module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-writer	Writer language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-activex	ActiveX control for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-base	Base module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-binfilter	Legacy filters (e.g. StarOffice 5.2) for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-calc	Calc module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01	Core module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core02	Office core module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core03	Office core module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core04	Office core module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core05	Office core module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core06	Office core module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core07	Office core module for OpenOffice.org %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING	Language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-binfilter	Legacy filters (e.g. StarOffice 5.2) for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-calc	Calc language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-draw	Draw language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-fonts	Language fonts module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-help	Language help module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-impress	Impress language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-math	Math language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-onlineupd	Online update language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-res	Language resource module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-writer	Writer language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-activex	ActiveX control for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-binfilter	Legacy filters (e.g. StarOffice 5.2) for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-calc	Calc module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01	Core module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core02	Office core module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core03	Office core module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core04	Office core module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core05	Office core module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core06	Office core module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core07	Office core module for OOo4Kids %OOOBASEVERSION
 %BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-dict-gl	Gl dictionary for %PRODUCTNAME %PRODUCTVERSION
 %BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-dict-vi	Vietnamese dictionary for %PRODUCTNAME %PRODUCTVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-draw	Draw module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-emailmerge	Email mailmerge module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-gnome-integratn	Gnome integration module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-graphicfilter	Graphic filter module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-headless	Headless display module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-images	Images module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-impress	Impress module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-javafilter	Java filter module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-kde-integration	KDE integration module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-math	Math module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-onlineupdate	Online update modul for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-ooofonts	Mailcap module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-ooolinguistic	Linguistic module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-pyuno	Pyuno module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-spellcheck	English spellchecker module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-testtool	Testtool module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-writer	Writer module for OpenOffice.org %OOOBASEVERSION
-%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-xsltfilter	XSLT filter samples module for OpenOffice.org %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-draw	Draw module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-emailmerge	Email mailmerge module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-gnome-integration	Gnome integration module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-graphicfilter	Graphic filter module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-headless	Headless display module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-images	Images module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-impress	Impress module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-javafilter	Java filter module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-kde-integration	KDE integration module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-math	Math module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-onlineupdate	Online update modul for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-ooofonts	Mailcap module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-ooolinguistic	Linguistic module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-pyuno	Pyuno module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-spellcheck	English spellchecker module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-testtool	Testtool module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-writer	Writer module for OOo4Kids %OOOBASEVERSION
+%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-xsltfilter	XSLT filter samples module for OOo4Kids %OOOBASEVERSION
 %PACKAGEPREFIX%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-dict-af	Af dictionary for %PRODUCTNAME %PRODUCTVERSION
 %PACKAGEPREFIX%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-dict-cs	Cs dictionary for %PRODUCTNAME %PRODUCTVERSION
 %PACKAGEPREFIX%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-dict-da	Da dictionary for %PRODUCTNAME %PRODUCTVERSION
@@ -65,9 +63,8 @@
 %PACKAGEPREFIX%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-dict-zu	Zu dictionary for %PRODUCTNAME %PRODUCTVERSION
 %WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION	Brand module for %PRODUCTNAME %PRODUCTVERSION
 %WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-%LANGUAGESTRING	Brand language module for %PRODUCTNAME %PRODUCTVERSION
-%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-base	Base brand module for %PRODUCTNAME %PRODUCTVERSION
-%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-calc	Calc brand module for %PRODUCTNAME %PRODUCTVERSION
-%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-draw	Draw brand module for %PRODUCTNAME %PRODUCTVERSION
-%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-impress	Impress brand module for %PRODUCTNAME %PRODUCTVERSION
-%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-math	Math brand module for %PRODUCTNAME %PRODUCTVERSION
-%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-writer	Writer brand module for %PRODUCTNAME %PRODUCTVERSION
+%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-calc-brand	Calc brand module for %PRODUCTNAME %PRODUCTVERSION
+%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-draw-brand	Draw brand module for %PRODUCTNAME %PRODUCTVERSION
+%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-impress-brand	Impress brand module for %PRODUCTNAME %PRODUCTVERSION
+%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-math-brand	Math brand module for %PRODUCTNAME %PRODUCTVERSION
+%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-writer-brand	Writer brand module for %PRODUCTNAME %PRODUCTVERSION
diff --git setup_native/source/packinfo/packinfo_brand.txt setup_native/source/packinfo/packinfo_brand.txt
index 0185227..c437e99 100644
--- setup_native/source/packinfo/packinfo_brand.txt
+++ setup_native/source/packinfo/packinfo_brand.txt
@@ -47,7 +47,7 @@ End
 Start
 module = "gid_Module_Brand_Prg_Wrt"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-writer"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-writer"
+packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-writer-brand"
 requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-writer"
 solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-writer"
 copyright = "1999-2009 by %PRODUCTNAME"
@@ -61,7 +61,7 @@ End
 Start
 module = "gid_Module_Brand_Prg_Calc"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-calc"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-calc"
+packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-calc-brand"
 requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-calc"
 solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-calc"
 copyright = "1999-2009 by %PRODUCTNAME"
@@ -75,7 +75,7 @@ End
 Start
 module = "gid_Module_Brand_Prg_Impress"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-impress"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-impress"
+packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-impress-brand"
 requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-impress"
 solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-impress"
 copyright = "1999-2009 by %PRODUCTNAME"
@@ -89,7 +89,7 @@ End
 Start
 module = "gid_Module_Brand_Prg_Draw"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-draw"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-draw"
+packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-draw-brand"
 requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-draw"
 solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-draw"
 copyright = "1999-2009 by %PRODUCTNAME"
@@ -103,7 +103,7 @@ End
 Start
 module = "gid_Module_Brand_Prg_Math"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-math"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-math"
+packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-math-brand"
 requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-math"
 solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-math"
 copyright = "1999-2009 by %PRODUCTNAME"
@@ -115,25 +115,11 @@ packageversion = "%PACKAGEVERSION"
 End
 
 Start
-module = "gid_Module_Brand_Prg_Base"
-solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-base"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-base"
-requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-base"
-solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-base"
-copyright = "1999-2009 by %PRODUCTNAME"
-solariscopyright = "solariscopyrightfile"
-vendor = "%PRODUCTNAME"
-description = "Base brand module for %PRODUCTNAME %PRODUCTVERSION"
-destpath = "/opt"
-packageversion = "%PACKAGEVERSION"
-End
-
-Start
 module = "gid_Module_Langpack_Brand"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION-%LANGUAGESTRING"
-packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-%LANGUAGESTRING"
-requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-base,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-calc,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-draw,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-help,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-impress,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-math,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-res,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-writer"
-solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING (Name="Language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-base (Name="Base language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-calc (Name="Calc language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-draw (Name="Draw language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-help (Name="Help language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-impress (Name="Impress language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-math (Name="Math language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-res (Name="Resource language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-writer (Name="Writer language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING")"
+packagename = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION-%LANGUAGESTRING-brand"
+requires = "%UNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-calc,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-draw,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-help,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-impress,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-math,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-res,%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-writer"
+solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME%BRANDPACKAGEVERSION,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING (Name="Language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-calc (Name="Calc language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-draw (Name="Draw language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-help (Name="Help language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-impress (Name="Impress language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-math (Name="Math language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-res (Name="Resource language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING"),%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-writer (Name="Writer language module for %PRODUCTNAME %PRODUCTVERSION\, language %LANGUAGESTRING")"
 copyright = "1999-2009 by %PRODUCTNAME"
 solariscopyright = "solariscopyrightfile"
 vendor = "%PRODUCTNAME"
diff --git setup_native/source/packinfo/packinfo_office.txt setup_native/source/packinfo/packinfo_office.txt
index d4ba6e1..97c6cdc 100755
--- setup_native/source/packinfo/packinfo_office.txt
+++ setup_native/source/packinfo/packinfo_office.txt
@@ -24,12 +24,12 @@ packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-gnome-integration"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 findrequires = "find-requires-gnome.sh"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Gnome integration module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Gnome integration module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -39,12 +39,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-kde-integration"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "KDE integration module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "KDE integration module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -55,12 +55,12 @@ packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%UREPACKAGEPREFIX-ure"
 solarisrequires = "SUNWcar, SUNWkvm, SUNWcsr, SUNWcsu, SUNWcsd, SUNWcsl, SUNWxwrtl, SUNWxwplt, SUNWlibC, %SOLSUREPACKAGEPREFIX-ure"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core02,%BASISPACKAGEPREFIX%OOOBASEVERSION-core03,%BASISPACKAGEPREFIX%OOOBASEVERSION-core04,%BASISPACKAGEPREFIX%OOOBASEVERSION-core05,%BASISPACKAGEPREFIX%OOOBASEVERSION-core06,%BASISPACKAGEPREFIX%OOOBASEVERSION-core07"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -71,12 +71,12 @@ packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-writer"
 solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core02,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core03,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core04,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core05,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core06,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core07, SUNWlibC"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Writer module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Writer module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -87,12 +87,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-calc"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Calc module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Calc module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -103,12 +103,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-draw"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Draw module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Draw module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -119,28 +119,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-impress"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Impress module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Impress module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
-End
-
-Start
-module = "gid_Module_Prg_Base_Bin"
-script = "shellscripts_module.txt"
-solarispackagename = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-base"
-solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core02,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core03,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core04,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core05,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core06,%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core07, SUNWlibC"
-packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-base"
-freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSIONg-core01"
-requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
-solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Base module for OpenOffice.org %OOOBASEVERSION"
-destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -151,12 +135,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-math"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Math module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Math module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -166,12 +150,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-binfilter"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01" 
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Legacy filters (e.g. StarOffice 5.2) for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Legacy filters (e.g. StarOffice 5.2) for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -181,12 +165,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-graphicfilter"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Graphic filter module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Graphic filter module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -196,12 +180,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-oooimprovement"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Usage tracking module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Usage tracking module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -211,12 +195,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01,%BASISPAC
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-testtool"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Testtool module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Testtool module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -226,12 +210,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-spellcheck"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "English spellchecker module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "English spellchecker module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -241,12 +225,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-xsltfilter"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "XSLT filter samples module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "XSLT filter samples module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -256,12 +240,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-javafilter"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Java filter module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Java filter module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -271,12 +255,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-activex"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "ActiveX control for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "ActiveX control for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -288,9 +272,9 @@ requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 copyright = "1999-2005 by Sun Microsystems"
 solariscopyright = "solariscopyrightfile"
 vendor = "Sun Microsystems, Inc."
-description = "Online update modul for OpenOffice.org %OOOBASEVERSION"
+description = "Online update modul for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -300,12 +284,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01, SUNWPyth
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-pyuno"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Pyuno module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Pyuno module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -315,12 +299,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-pyuno"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-emailmerge"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-pyuno"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Email mailmerge module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Email mailmerge module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -330,12 +314,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-headless"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Headless display module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Headless display module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -345,12 +329,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-images"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Images module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Images module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -360,12 +344,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-ooofonts"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Mailcap module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Mailcap module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -375,12 +359,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01, %BASISPA
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-ooolinguistic"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Linguistic module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Linguistic module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -391,12 +375,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01, %BASISPA
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core02"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 freebsdrequires = ""
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Office core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Office core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -406,12 +390,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01, %BASISPA
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core03"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 freebsdrequires = ""
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Office core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Office core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -422,12 +406,12 @@ packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core04"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 findrequires = "find-requires-x11.sh"
 freebsdrequires = ""
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Office core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Office core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -437,12 +421,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01, SUNWgnom
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core05"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 freebsdrequires = ""
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Office core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Office core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -452,12 +436,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core06"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 freebsdrequires = ""
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Office core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Office core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -467,12 +451,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core07"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 freebsdrequires = ""
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "1999-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Office core module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Office core module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -680,7 +664,7 @@ solariscopyright = "solariscopyrightfile"
 vendor = "Sun Microsystems, Inc."
 description = "Gl dictionary for %PRODUCTNAME %PRODUCTVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -968,7 +952,7 @@ solariscopyright = "solariscopyrightfile"
 vendor = "Sun Microsystems, Inc."
 description = "Vietnamese dictionary for %PRODUCTNAME %PRODUCTVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
 
 Start
@@ -995,10 +979,10 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-impress"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-ogltrans"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-impress"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-impress"
-copyright = "1999-2007 by OpenOffice.org"
+copyright = "1999-2007 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "OpenGL slide transitions module for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "OpenGL slide transitions module for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
diff --git setup_native/source/packinfo/packinfo_office_lang.txt setup_native/source/packinfo/packinfo_office_lang.txt
index 8f3f6dd..2ffec9d 100755
--- setup_native/source/packinfo/packinfo_office_lang.txt
+++ setup_native/source/packinfo/packinfo_office_lang.txt
@@ -23,12 +23,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 End
 
@@ -39,12 +39,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-fonts"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-fonts"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Language fonts module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Language fonts module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 End
 
@@ -55,12 +55,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-res"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-res"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Language resource module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Language resource module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 End
 
@@ -71,12 +71,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-help"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-help"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Language help module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Language help module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01"
 End
 
@@ -87,12 +87,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-writer"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-writer"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Writer language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Writer language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-writer"
 End
 
@@ -103,12 +103,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-calc"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-calc"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Calc language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Calc language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-calc"
 End
 
@@ -119,12 +119,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-impress"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-impress"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Impress language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Impress language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-impress"
 End
 
@@ -135,12 +135,12 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-draw"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-draw"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Draw language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Draw language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-draw"
 End
 
@@ -151,44 +151,28 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-math"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-math"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Math language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Math language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-math"
 End
 
 Start
-module = "gid_Module_Langpack_Base"
-solarispackagename = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-base"
-solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
-packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-base"
-provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-base"
-requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
-solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Base language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
-destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
-pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-base"
-End
-
-Start
 module = "gid_Module_Langpack_Binfilter"
 solarispackagename = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-binfilter"
 solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-binfilter"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-binfilter"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Legacy filters (e.g. StarOffice 5.2) for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Legacy filters (e.g. StarOffice 5.2) for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-binfilter"
 End
 
@@ -199,11 +183,11 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING"
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING-onlineupd"
 provides = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-%LANGUAGESTRING-onlineupd"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-%LANGUAGESTRING"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Online update language module for OpenOffice.org %OOOBASEVERSION, language %LANGUAGESTRING"
+vendor = "OOo4Kids"
+description = "Online update language module for OOo4Kids %OOOBASEVERSION, language %LANGUAGESTRING"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 pkg_list_entry = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-onlineupdate"
 End
diff --git setup_native/source/packinfo/packinfo_sdkoo.txt setup_native/source/packinfo/packinfo_sdkoo.txt
index 18c11b9..3d6afb6 100755
--- setup_native/source/packinfo/packinfo_sdkoo.txt
+++ setup_native/source/packinfo/packinfo_sdkoo.txt
@@ -36,10 +36,10 @@ solarisrequires = "%BASISPACKAGEPREFIX%WITHOUTDOTOOOBASEVERSION-core01, SUNWbtoo
 packagename = "%BASISPACKAGEPREFIX%OOOBASEVERSION-sdk"
 freebsdrequires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
 requires = "%BASISPACKAGEPREFIX%OOOBASEVERSION-core01"
-copyright = "1999-2009 by OpenOffice.org"
+copyright = "2009 by EducOOo"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
-description = "Software Development Kit for OpenOffice.org %OOOBASEVERSION"
+vendor = "OOo4Kids"
+description = "Software Development Kit for OOo4Kids %OOOBASEVERSION"
 destpath = "/opt"
-packageversion = "%OOOPACKAGEVERSION"
+packageversion = "%OOOPACKAGEVERSION_LINUX"
 End
diff --git setup_native/source/packinfo/packinfo_ure.txt setup_native/source/packinfo/packinfo_ure.txt
index 425243e..d839af4 100755
--- setup_native/source/packinfo/packinfo_ure.txt
+++ setup_native/source/packinfo/packinfo_ure.txt
@@ -34,9 +34,9 @@ module = "gid_Module_Root"
 solarispackagename = "%SOLSUREPACKAGEPREFIX-ure"
 solarisrequires = "SUNWzlibr"
 packagename = "%UREPACKAGEPREFIX-ure"
-copyright = "2005-2009 by OpenOffice.org"
+copyright = "2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
+vendor = "OOo4Kids"
 description = "UNO Runtime Environment"
 destpath = "/opt"
 packageversion = "%UREPACKAGEVERSION"
@@ -47,9 +47,9 @@ module = "gid_Module_Root_Ure_Hidden"
 solarispackagename = "%SOLSUREPACKAGEPREFIX-ure"
 solarisrequires = "SUNWzlibr"
 packagename = "%UREPACKAGEPREFIX-ure"
-copyright = "2005-2009 by OpenOffice.org"
+copyright = "2005-2009 by OOo4Kids"
 solariscopyright = "solariscopyrightfile"
-vendor = "OpenOffice.org"
+vendor = "OOo4Kids"
 description = "UNO Runtime Environment"
 destpath = "/opt"
 packageversion = "%UREPACKAGEVERSION"
diff --git setup_native/source/packinfo/shellscripts_brand.txt setup_native/source/packinfo/shellscripts_brand.txt
index 62039f5..536ca64 100644
--- setup_native/source/packinfo/shellscripts_brand.txt
+++ setup_native/source/packinfo/shellscripts_brand.txt
@@ -13,7 +13,7 @@ SunOS)
   PRODUCTINSTALLLOCATION="$$BASEDIR"
   ;;
 Linux)
-  BASISPACKAGE=openoffice.org-core01
+  BASISPACKAGE=OOo4Kids-core01
   BASISDIR=`rpm -q --queryformat "%{INSTALLPREFIX}" $$BASISPACKAGE`
   PRODUCTINSTALLLOCATION="$$RPM_INSTALL_PREFIX"
   ;;
@@ -23,11 +23,11 @@ Linux)
 esac
 
 # creating link to basis layer
-if [ -d $$BASISDIR/openoffice.org/basisBASISDIRECTORYVERSION ]
+if [ -d $$BASISDIR/OOo4Kids/basisBASISDIRECTORYVERSION ]
 then
-      ln -s $$BASISDIR/openoffice.org/basisBASISDIRECTORYVERSION $$PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/basis-link >/dev/null 2>&1
+      ln -s $$BASISDIR/OOo4Kids/basisBASISDIRECTORYVERSION $$PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/basis-link >/dev/null 2>&1
 else
-      ln -s ../openoffice.org/basisBASISDIRECTORYVERSION $$PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/basis-link >/dev/null 2>&1
+      ln -s ../OOo4Kids/basisBASISDIRECTORYVERSION $$PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/basis-link >/dev/null 2>&1
 fi
 
 exit 0
diff --git setup_native/source/packinfo/shellscripts_core01.txt setup_native/source/packinfo/shellscripts_core01.txt
index 623e5e9..43b25f7 100644
--- setup_native/source/packinfo/shellscripts_core01.txt
+++ setup_native/source/packinfo/shellscripts_core01.txt
@@ -23,11 +23,11 @@ Linux)
 esac
 
 # creating link to ure
-if [ -d $$UREDIR/openoffice.org/ure ]
+if [ -d $$UREDIR/OOo4Kids/ure ]
 then
-      ln -s $$UREDIR/openoffice.org/ure $$PRODUCTINSTALLLOCATION/openoffice.org/basisBASISDIRECTORYVERSION/ure-link >/dev/null 2>&1
+      ln -s $$UREDIR/OOo4Kids/ure $$PRODUCTINSTALLLOCATION/OOo4Kids/basisBASISDIRECTORYVERSION/ure-link >/dev/null 2>&1
 else
-      ln -s ../ure $$PRODUCTINSTALLLOCATION/openoffice.org/basisBASISDIRECTORYVERSION/ure-link >/dev/null 2>&1
+      ln -s ../ure $$PRODUCTINSTALLLOCATION/OOo4Kids/basisBASISDIRECTORYVERSION/ure-link >/dev/null 2>&1
 fi
 
 exit 0
@@ -59,11 +59,11 @@ Linux)
   ;;
 esac
 
-if [ -h $$PRODUCTINSTALLLOCATION/openoffice.org/basisBASISDIRECTORYVERSION/ure-link -a $$LASTUNINSTALL -eq 1 ]
+if [ -h $$PRODUCTINSTALLLOCATION/OOo4Kids/basisBASISDIRECTORYVERSION/ure-link -a $$LASTUNINSTALL -eq 1 ]
 then
-  rm -f $$PRODUCTINSTALLLOCATION/openoffice.org/basisBASISDIRECTORYVERSION/ure-link 2>/dev/null
-  rmdir $$PRODUCTINSTALLLOCATION/openoffice.org/basisBASISDIRECTORYVERSION 2>/dev/null
-  rmdir $$PRODUCTINSTALLLOCATION/openoffice.org 2>/dev/null
+  rm -f $$PRODUCTINSTALLLOCATION/OOo4Kids/basisBASISDIRECTORYVERSION/ure-link 2>/dev/null
+  rmdir $$PRODUCTINSTALLLOCATION/OOo4Kids/basisBASISDIRECTORYVERSION 2>/dev/null
+  rmdir $$PRODUCTINSTALLLOCATION/OOo4Kids 2>/dev/null
 fi
 
 exit 0
diff --git setup_native/source/packinfo/spellchecker_selection.txt setup_native/source/packinfo/spellchecker_selection.txt
index 03d741b..c4f5ea3 100644
--- setup_native/source/packinfo/spellchecker_selection.txt
+++ setup_native/source/packinfo/spellchecker_selection.txt
@@ -9,25 +9,25 @@ ca = "ca,es,en-US,fr"
 cs = "cs,en-US"
 da = "da,de-DE,en-US"
 de = "de-AT,de-CH,de-DE,en-US,fr,it"
-en-US = "en-US,es,fr"
+en-US = "en-US,es"
 en-GB = "en-US,es,fr"
 es = "en-US,es,fr,pt"
 et = "en-US,et"
-fr = "en-US,es,fr"
+fr = "fr"
 gl = "en-US,pt,es,gl"
 he = "en-US,he"
 hu = "de-DE,en-US,hu"
-it = "de-DE,en-US,fr,it"
+it = "it"
 ja = "en-US"
 ko = "en-US"
 lt = "en-US,lt"
 nb = "no,en-US,fr,de-DE,es"
 ne = "en-US,ne"
-nl = "en-US,fr,de-DE,nl"
+nl = "en-US,nl"
 nn = "no,en-US,fr,de-DE,es"
 pl = "de-DE,en-US,pl,ru"
-pt-BR = "en-US,es,pt"
-pt = "en-US,es,pt"
+pt-BR = "pt"
+pt = "es,pt"
 ro = "ro,en-US,de-DE,hu"
 ru = "de-DE,en-US,ru"
 sk = "en-US,sk"
diff --git setup_native/source/win32/customactions/relnotes/makefile.mk setup_native/source/win32/customactions/relnotes/makefile.mk
index b83d584..1063579 100644
--- setup_native/source/win32/customactions/relnotes/makefile.mk
+++ setup_native/source/win32/customactions/relnotes/makefile.mk
@@ -36,6 +36,11 @@ TARGET=relnotes
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)" == "YES
+dummy:
+    @all "Nothing to build"
+.ENDIF
+
 ENABLE_EXCEPTIONS=TRUE
 NO_DEFAULT_STL=TRUE
 DYNAMIC_CRT=
diff --git setup_native/source/win32/customactions/relnotes/relnotes.cxx setup_native/source/win32/customactions/relnotes/relnotes.cxx
index 110df55..9d540fa 100644
--- setup_native/source/win32/customactions/relnotes/relnotes.cxx
+++ setup_native/source/win32/customactions/relnotes/relnotes.cxx
@@ -140,6 +140,7 @@ extern "C" UINT __stdcall ShowReleaseNotesAfter( MSIHANDLE )
 //----------------------------------------------------------
 extern "C" UINT __stdcall ShowSurveyAfter( MSIHANDLE )
 {
+#ifndef OOo4Kids
     OutputDebugString( TEXT("DEBUG: ShowSurveyAfter called") );
 
     SHELLEXECUTEINFOW aExecInf;
@@ -154,7 +155,7 @@ extern "C" UINT __stdcall ShowSurveyAfter( MSIHANDLE )
 
     SetLastError( 0 );
     ShellExecuteEx( &aExecInf );
-
+#endif
     return ERROR_SUCCESS;
 }
 
diff --git setup_native/source/win32/stwrapper/resource.rc setup_native/source/win32/stwrapper/resource.rc
index 7951547..5c97519 100644
--- setup_native/source/win32/stwrapper/resource.rc
+++ setup_native/source/win32/stwrapper/resource.rc
@@ -76,25 +76,25 @@ VS_VERSION_INFO versioninfo
 			block "040704E4"
 			{
 				// German StringTable
-				value "CompanyName",		"Sun Microsystems, Inc.\0"
+                value "CompanyName",		"OOo4Kids\0"
 				value "FileDescription",    "Service Tags Wrapper\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "ProductVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	"STCLIENT_WRAPPER.EXE\0"
-				value "InternalName",		"stclient_wrapper\0"
-				value "LegalCopyright",		S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "InternalName",		"not avalaible\0"
+                value "LegalCopyright",		S_CRIGHT " EducOO.org\0"
 			}
 #else
 			block "040904E4"
 			{
 				// International StringTable
-				value "CompanyName", 		"Sun Microsystems, Inc.\0"
-				value "FileDescription",    "Service Tags Wrapper\0"
+                value "CompanyName", 		"EducOO.org\0"
+                value "FileDescription",    "Not a service\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "ProductVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	"STCLIENT_WRAPPER.EXE\0"
-				value "InternalName", 		"stclient_wrapper\0"
-				value "LegalCopyright", 	S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "InternalName", 		"not available\0"
+                value "LegalCopyright", 	S_CRIGHT " EducOO.org\0"
 			}
 #endif
 		}
diff --git setup_native/source/win32/stwrapper/stwrapper.cxx setup_native/source/win32/stwrapper/stwrapper.cxx
index 85992b9..e59fa51 100644
--- setup_native/source/win32/stwrapper/stwrapper.cxx
+++ setup_native/source/win32/stwrapper/stwrapper.cxx
@@ -424,7 +424,7 @@ int WINAPI _tWinMain( HINSTANCE /*hInstance*/, HINSTANCE, LPTSTR, int )
                     _tcscat( lpCommandLine, TEXT( "\"" ));
                     _tcscat( lpCommandLine, szParentProductName );
                     _tcscat( lpCommandLine, TEXT( "\"" ));
-                    _tcscat( lpCommandLine, TEXT( " -m \"Sun Microsystems, Inc.\"" ));
+                    _tcscat( lpCommandLine, TEXT( " -m \"EducOO.org\"" ));
                     _tcscat( lpCommandLine, TEXT( " -A " ));
                     _tcscat( lpCommandLine, TEXT( "\"" ));
                     _tcscat( lpCommandLine, GetOperatingSystemString() );
diff --git sfx2/inc/sfx2/passwd.hxx sfx2/inc/sfx2/passwd.hxx
index 2cc5ba1..22ccdf3 100644
--- sfx2/inc/sfx2/passwd.hxx
+++ sfx2/inc/sfx2/passwd.hxx
@@ -43,8 +43,11 @@
 // defines ---------------------------------------------------------------
 
 #define SHOWEXTRAS_NONE		((USHORT)0x0000)
-#define SHOWEXTRAS_USER		((USHORT)0x0001)
-#define SHOWEXTRAS_CONFIRM	((USHORT)0x0002)
+#define SHOWEXTRAS_NONE_OOO4KIDS         ((USHORT)0x0001)
+#define SHOWEXTRAS_CURRENT_PASSWD	((USHORT)0x0002)
+#define SHOWEXTRAS_CONFIRM_OOO4KIDS      ((USHORT)0x0004)
+#define SHOWEXTRAS_USER         ((USHORT)0x0008)
+#define SHOWEXTRAS_CONFIRM      ((USHORT)0x0016)
 #define SHOWEXTRAS_ALL		((USHORT)(SHOWEXTRAS_USER | SHOWEXTRAS_CONFIRM))
 
 // class SfxPasswordDialog -----------------------------------------------
@@ -54,17 +57,20 @@ class SFX2_DLLPUBLIC SfxPasswordDialog : public ModalDialog
 private:
     FixedText		maUserFT;
     Edit			maUserED;
+    FixedText		maCurrentPasswordFT;
+    Edit			maCurrentPasswordED;
+  FixedLine       maChangePasswordBox;
     FixedText		maPasswordFT;
     Edit			maPasswordED;
     FixedText		maConfirmFT;
     Edit			maConfirmED;
     FixedLine       maPasswordBox;
-
     OKButton		maOKBtn;
     CancelButton	maCancelBtn;
     HelpButton		maHelpBtn;
 
     String			maConfirmStr;
+//	String			maErrorCurrentStr;
     USHORT			mnMinLen;
     USHORT			mnExtras;
 
@@ -77,14 +83,20 @@ public:
     SfxPasswordDialog( Window* pParent, const String* pGroupText = NULL );
 
     String			GetUser() const	{ return maUserED.GetText(); }
+
+//	String			GetPassword() const { return maPasswordED.GetText().Len() = 0 ? String(a): maPasswordED.GetText() ; }
+//	String			GetConfirm() const { return maConfirmED.GetText().Len()= 0 ? (String)b: maPasswordED.GetText() ; }
     String			GetPassword() const { return maPasswordED.GetText(); }
     String			GetConfirm() const { return maConfirmED.GetText(); }
+    String			GetCurrentPassword() const { return maCurrentPasswordED.GetText(); }
 
     void 			SetMinLen( USHORT Len );
     void            SetMaxLen( USHORT Len );
     void			SetEditHelpId( ULONG nId ) { maPasswordED.SetHelpId( nId ); }
     void			ShowExtras( USHORT nExtras ) { mnExtras = nExtras; }
-
+    void            setUserPrefsPassword( ::rtl::OUString aPassword );
+    ::rtl::OUString        getUserPrefsPassword();
+    bool            bPasswordEntryFailed;
     virtual short	Execute();
 };
 
diff --git sfx2/inc/sfx2/sfx.hrc sfx2/inc/sfx2/sfx.hrc
index ce6b09a..01c6792 100644
--- sfx2/inc/sfx2/sfx.hrc
+++ sfx2/inc/sfx2/sfx.hrc
@@ -220,6 +220,17 @@
 #define ABOUT_STR_FRENCH_COPYRIGHT          2
 #define ABOUT_STR_ACCEL                     3
 
+#define RID_DEFAULTLICENSE					(RID_SFX_START+20)
+
+#define LICENSE_BTN_OK                        6
+
+#define LICENSE_FTXT_VERSION                  6
+#define LICENSE_FTXT_COPYRIGHT                7
+
+#define LICENSE_STR_DEVELOPER_ARY             6
+#define LICENSE_STR_FRENCH_COPYRIGHT          7
+#define LICENSE_STR_ACCEL                     8
+
 #define RID_APPTITLE                        (RID_SFX_START+4)
 #define RID_BUILDVERSION                    (RID_SFX_START+5)
 
diff --git sfx2/inc/sfx2/sfxsids.hrc sfx2/inc/sfx2/sfxsids.hrc
index 09a9849..8d0d657 100644
--- sfx2/inc/sfx2/sfxsids.hrc
+++ sfx2/inc/sfx2/sfxsids.hrc
@@ -135,6 +135,7 @@
 #define SID_ABOUT                           (SID_SFX_START + 301)
 #define SID_SETUPPRINTER                    (SID_SFX_START + 302)
 #define SID_EXITANDRETURN                   (SID_SFX_START + 303)
+#define SID_LICENSE                         (SID_SFX_START + 304)
 
 // SID_TITLE steht unter diesem Wert in chaos/cntids.hrc!!
 //#define SID_TITLE			    (SID_SFX_START + 307)
@@ -575,7 +576,11 @@
 #define SID_ACTIVATE_STYLE_APPLY            (SID_SFX_START + 1715)
 #define SID_FONT_NAME						(SID_SFX_START + 1716)
 #define SID_DEFAULTFILENAME                 (SID_SFX_START + 1717)
+#if defined( OOo4Kids )
+#define SID_SFX_free_START                  (SID_SFX_START + 1719)
+#else
 #define SID_SFX_free_START                  (SID_SFX_START + 1718)
+#endif
 #define SID_SFX_free_END  					(SID_SFX_START + 3999)
 
 #define SID_OPEN_NEW_VIEW                   (SID_SFX_START + 520)
@@ -1182,6 +1187,7 @@
 #define SID_SW_FAX_WIZZARD                  (SID_SVX_START + 427)
 #define SID_SW_LETTER_WIZZARD               (SID_SVX_START + 428)
 #define SID_SW_MEMO_WIZZARD                 (SID_SVX_START + 429)
+#define SID_SW_AUTOPILOT                    (SID_SVX_START + 430)
 #define SID_ATTR_CHAR_COLOR_EXT             (SID_SVX_START + 488)
 #define SID_ATTR_CHAR_COLOR_BACKGROUND      (SID_SVX_START + 489)
 #define SID_ATTR_CHAR_COLOR_BACKGROUND_EXT  (SID_SVX_START + 490)
@@ -1318,6 +1324,10 @@
 #define MID_SCRIPT_ORGANIZER_LANGUAGE       1 // Don't use zero for MID's. It's forbidden to do it!
 
 #define SID_NEWSD							(SID_SFX_START + 1686)
+#ifdef OOo4Kids
+#define SID_NEWSW							(SID_SFX_START + 1718)
+#endif
+#define SID_NEWSD							(SID_SFX_START + 1686)
 #define FN_LABEL							(SID_SW_START + 1051 )
 #define FN_BUSINESS_CARD					(SID_SW_START + 1052)
 #define FN_XFORMS_INIT						(SID_SW_START + 1053)
diff --git sfx2/inc/showlicense.hxx sfx2/inc/showlicense.hxx
new file mode 100644
index 0000000..372eef7
--- /dev/null
+++ sfx2/inc/showlicense.hxx
@@ -0,0 +1,85 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ *
+ * Author : ericb
+ *
+ * Copyright 2009 EducOO.org  http://www.educoo.org
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify                                               
+ * it under the terms of the GNU General Public License version 3                                                 
+ * only, as published by the Free Software Foundation, or under the GPL V2
+ *                                        
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,                                                    
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of                                                 
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                                                  
+ * GNU General Public License version 2 for more details                                                          
+ * (a copy is included in the LICENSE file that accompanied this code).                                           
+ *
+ *
+ ************************************************************************/
+#ifndef _SHOWLICENSE_HXX
+#define _SHOWLICENSE_HXX
+
+// include ---------------------------------------------------------------
+
+#ifndef _RESARY_HXX //autogen
+#include <tools/resary.hxx>
+#endif
+#ifndef _BUTTON_HXX //autogen
+#include <vcl/button.hxx>
+#endif
+#ifndef _ACCEL_HXX //autogen
+#include <vcl/accel.hxx>
+#endif
+#include <tools/list.hxx>
+#include <svtools/stdctrl.hxx>
+#include <sfx2/basedlgs.hxx>		// SfxModalDialog
+
+
+// class ShowLicenseDialog -----------------------------------------------------
+
+class ShowLicenseDialog : public SfxModalDialog
+{
+private:
+    OKButton    	aOKButton;
+    Image			aAppLogo;
+    BitmapEx        aPng;
+    FixedInfo   	aVersionText;
+    FixedInfo   	aCopyrightText;
+    FixedInfo   	aBuildData;
+
+    ResStringArray	aDeveloperAry;
+    String			aDevVersionStr;
+    String 			aAccelStr;
+    String			aVersionData;
+
+    AccelList 		aAccelList;
+
+    AutoTimer       aTimer;
+    long            nOff;
+    long            m_nDeltaWidth;
+    int				m_nPendingScrolls;
+
+    BOOL            bNormal;
+
+protected:
+    virtual BOOL 	Close();
+    virtual void 	Paint( const Rectangle& );
+
+public:
+    ShowLicenseDialog( Window* pParent, const ResId& rId, const String& rVerStr );
+    ~ShowLicenseDialog();
+
+    DECL_LINK( TimerHdl, Timer * );
+    DECL_LINK( AccelSelectHdl, Accelerator * );
+};
+
+#endif // #ifndef _SHOWLICENSE_HXX
+
+
diff --git sfx2/sdi/appslots.sdi sfx2/sdi/appslots.sdi
index 5da69fa..b1a8f2b 100644
--- sfx2/sdi/appslots.sdi
+++ sfx2/sdi/appslots.sdi
@@ -52,6 +52,10 @@ interface Application
     [
         ExecMethod = MiscExec_Impl ;
     ]
+    SID_LICENSE // ole(no) api(final/play/rec)
+    [
+        ExecMethod = MiscExec_Impl ;
+    ]
     SID_SETOPTIONS
     [
         ExecMethod = MiscExec_Impl ;
diff --git sfx2/sdi/sfx.sdi sfx2/sdi/sfx.sdi
index 26f55cc..49dfb41 100644
--- sfx2/sdi/sfx.sdi
+++ sfx2/sdi/sfx.sdi
@@ -190,6 +190,31 @@ SfxVoidItem About SID_ABOUT
 ]
 
 //--------------------------------------------------------------------------
+SfxVoidItem ShowLicense SID_LICENSE
+()
+[
+    /* flags: */
+    AutoUpdate = FALSE,
+    Cachable = Cachable,
+    FastCall = FALSE,
+    HasCoreId = FALSE,
+    HasDialog = TRUE,
+    ReadOnlyDoc = TRUE,
+    Toggle = FALSE,
+    Container = FALSE,
+    RecordAbsolute = FALSE,
+    RecordPerSet;
+    Synchron;
+
+    /* config: */
+    AccelConfig = TRUE,
+    MenuConfig = TRUE,
+    StatusBarConfig = FALSE,
+    ToolBoxConfig = TRUE,
+    GroupId = GID_APPLICATION;
+]
+
+//--------------------------------------------------------------------------
 SfxObjectItem Activate SID_ACTIVATE
 ()
 [
diff --git sfx2/source/appl/appserv.cxx sfx2/source/appl/appserv.cxx
index 7a70f6f..b60e6e9 100644
--- sfx2/source/appl/appserv.cxx
+++ sfx2/source/appl/appserv.cxx
@@ -99,6 +99,7 @@
 #include <com/sun/star/beans/XPropertySet.hpp>
 
 #include "about.hxx"
+#include "showlicense.hxx"
 #include "referers.hxx"
 #include <sfx2/app.hxx>
 #include <sfx2/request.hxx>
@@ -193,6 +194,7 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
                         continue;
 
                     SfxViewFrame* pFrame = SfxViewFrame::GetFirst( pObjSh );
+
                     if ( !pFrame || !pFrame->GetWindow().IsReallyVisible() )
                         continue;
 
@@ -230,6 +232,7 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
 
             // if terminate() failed, pAppData_Impl->bInQuit will now be FALSE, allowing further calls of SID_QUITAPP
             BOOL bTerminated = xDesktop->terminate();
+
             if (!bTerminated)
                 // if terminate() was successful, SfxApplication is now dead!
                 pAppData_Impl->bInQuit = FALSE;
@@ -246,8 +249,7 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
         case SID_CONFIGACCEL:
         case SID_CONFIGEVENT:
         {
-            SfxAbstractDialogFactory* pFact =
-                SfxAbstractDialogFactory::Create();
+        SfxAbstractDialogFactory* pFact = SfxAbstractDialogFactory::Create();
 
             if ( pFact )
             {
@@ -258,14 +260,12 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
                     GetPool(), SID_CONFIG, SID_CONFIG );
 
                 if ( pStringItem )
-                {
-                    aSet.Put( SfxStringItem(
-                        SID_CONFIG, pStringItem->GetValue() ) );
-                }
+            aSet.Put( SfxStringItem( SID_CONFIG, pStringItem->GetValue() ) );
 
                 Reference< XFrame > xFrame;
                 const SfxItemSet* pIntSet = rReq.GetInternalArgs_Impl();
                 SFX_ITEMSET_ARG( pIntSet, pFrame, SfxUnoAnyItem, SID_FILLFRAME, FALSE );
+
                 if (pFrame)
                     pFrame->GetValue() >>= xFrame;
 
@@ -292,10 +292,12 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
 
             Reference < XFramesSupplier > xDesktop ( ::comphelper::getProcessServiceFactory()->createInstance( DEFINE_CONST_UNICODE("com.sun.star.frame.Desktop") ), UNO_QUERY );
             Reference< XIndexAccess > xTasks( xDesktop->getFrames(), UNO_QUERY );
+
             if ( !xTasks.is() )
                 break;
 
             sal_Int32 n=0;
+
             do
             {
                 if ( xTasks->getCount() <= n )
@@ -325,16 +327,19 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
         {
             BOOL bOK = TRUE;
             BOOL bTmpDone = TRUE;
+
             for ( SfxObjectShell *pObjSh = SfxObjectShell::GetFirst();
                   pObjSh;
                   pObjSh = SfxObjectShell::GetNext( *pObjSh ) )
             {
                 SfxRequest aReq( SID_SAVEDOC, 0, pObjSh->GetPool() );
+
                 if ( pObjSh->IsModified() )
                 {
                     pObjSh->ExecuteSlot( aReq );
                     SfxBoolItem *pItem = PTR_CAST( SfxBoolItem, aReq.GetReturnValue() );
                     bTmpDone = aReq.IsDone();
+
                     if ( !pItem || !pItem->GetValue() )
                         bOK = FALSE;
                 }
@@ -378,12 +383,12 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
             bool bOn = pOnItem
                             ? ((SfxBoolItem*)pOnItem)->GetValue()
                             : !Help::IsQuickHelpEnabled();
-
             // ausf"uhren
             if ( bOn )
                 Help::EnableQuickHelp();
             else
                 Help::DisableQuickHelp();
+
             SvtHelpOptions().SetHelpTips( bOn );
             Invalidate(SID_HELPTIPS);
             bDone = TRUE;
@@ -399,6 +404,7 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
             Help::StartExtHelp();
             break;
         }
+
         case SID_HELPBALLOONS:
         {
             // Parameter auswerten
@@ -406,12 +412,12 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
             bool bOn = pOnItem
                             ? ((SfxBoolItem*)pOnItem)->GetValue()
                             : !Help::IsBalloonHelpEnabled();
-
             // ausf"uhren
             if ( bOn )
                 Help::EnableBalloonHelp();
             else
                 Help::DisableBalloonHelp();
+
             SvtHelpOptions().SetExtendedHelp( bOn );
             Invalidate(SID_HELPBALLOONS);
             bDone = TRUE;
@@ -522,11 +528,42 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
             break;
         }
 
+    case SID_LICENSE:
+    {
+
+        String sBuildId( String::CreateFromAscii( "OOo4Kids is released under LGPL v3 License" ) );
+
+        rtl::OUString aLicenseContent( DEFINE_CONST_OUSTRING(
+                 "SHOW_LICENSE" ) );
+        // FIXME ... reuse that later
+            String sTemp( '-' );
+        sTemp += String( aLicenseContent );
+
+            // search for the resource of the license box
+            ResId aDialogResId( RID_DEFAULTLICENSE, *pAppData_Impl->pLabelResMgr );
+            ResMgr* pResMgr = pAppData_Impl->pLabelResMgr;
+            if( ! pResMgr->IsAvailable( aDialogResId.SetRT( RSC_MODALDIALOG ) ) )
+                pResMgr = GetOffResManager_Impl();
+
+            aDialogResId.SetResMgr( pResMgr );
+            if ( !pResMgr->IsAvailable( aDialogResId ) )
+            {
+                DBG_ERRORFILE( "No RID_DEFAULTLICENSE in label-resource-dll" );
+            }
+
+            // then show the license box
+            ShowLicenseDialog* pDlg = new ShowLicenseDialog( 0, aDialogResId, sBuildId );
+            pDlg->Execute();
+            delete pDlg;
+            bDone = TRUE;
+        break;
+    }
+
         // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         case SID_ORGANIZER:
         {
-            SfxTemplateOrganizeDlg  *pDlg =
-                new SfxTemplateOrganizeDlg(NULL);
+        SfxTemplateOrganizeDlg  *pDlg = new SfxTemplateOrganizeDlg(NULL);
+
             pDlg->Execute();
             delete pDlg;
             bDone = TRUE;
@@ -1135,7 +1172,43 @@ void SfxApplication::OfaExec_Impl( SfxRequest& rReq )
             }
         }
         break;
-
+/*
+        case SID_SW_AUTOPILOT :
+        case SID_NEWSW :
+        {
+            SvtModuleOptions aModuleOpt;
+            if ( !aModuleOpt.Writer() )
+            {
+                ErrorBox( 0, ResId( RID_ERRBOX_MODULENOTINSTALLED, *GetOffResManager_Impl() )).Execute();
+                return;
+            }
+
+            Reference< com::sun::star::lang::XMultiServiceFactory > xORB = ::comphelper::getProcessServiceFactory();
+            Reference< com::sun::star::frame::XDispatchProvider > xProv(
+                xORB->createInstance( ::rtl::OUString::createFromAscii("com.sun.star.drawing.ModuleDispatcher")), UNO_QUERY );
+
+            if ( xProv.is() )
+            {
+                ::rtl::OUString aCmd = ::rtl::OUString::createFromAscii( GetInterface()->GetSlot( rReq.GetSlot() )->GetUnoName() );
+                Reference< com::sun::star::frame::XDispatchHelper > xHelper(
+                    xORB->createInstance( ::rtl::OUString::createFromAscii("com.sun.star.frame.DispatchHelper")), UNO_QUERY );
+                if ( xHelper.is() )
+                {
+                    Sequence < com::sun::star::beans::PropertyValue > aSeq;
+                    if ( rReq.GetArgs() )
+                        TransformItems( rReq.GetSlot(), *rReq.GetArgs(), aSeq );
+                    Any aResult = xHelper->executeDispatch( xProv, aCmd, ::rtl::OUString(), 0, aSeq );
+                    ::com::sun::star::frame::DispatchResultEvent aEvent;
+                    sal_Bool bSuccess = (
+                                         (aResult >>= aEvent) &&
+                                         (aEvent.State == ::com::sun::star::frame::DispatchResultState::SUCCESS)
+                                        );
+                    rReq.SetReturnValue( SfxBoolItem( rReq.GetSlot(), bSuccess ) );
+                }
+            }
+        }
+        break;
+*/
         case FN_LABEL :
         case FN_BUSINESS_CARD :
         case FN_XFORMS_INIT :
diff --git sfx2/source/appl/appuno.cxx sfx2/source/appl/appuno.cxx
index 81d1984..e766daf 100644
--- sfx2/source/appl/appuno.cxx
+++ sfx2/source/appl/appuno.cxx
@@ -1732,6 +1732,10 @@ void SAL_CALL SfxMacroLoader::removeStatusListener(
 ErrCode SfxMacroLoader::loadMacro( const ::rtl::OUString& rURL, com::sun::star::uno::Any& rRetval, SfxObjectShell* pSh )
     throw ( ::com::sun::star::uno::RuntimeException )
 {
+    ErrCode nErr = ERRCODE_NONE;
+#ifdef OOo4Kids
+    return nErr = ERRCODE_BASIC_PROC_UNDEFINED;
+#endif
     SfxApplication* pApp = SFX_APP();
     pApp->EnterBasicCall();
     SfxObjectShell* pCurrent = pSh;
@@ -1747,7 +1751,6 @@ ErrCode SfxMacroLoader::loadMacro( const ::rtl::OUString& rURL, com::sun::star::
     sal_uInt16 nArgsPos = aMacro.Search( '(' );
     BasicManager *pAppMgr = SFX_APP()->GetBasicManager();
     BasicManager *pBasMgr = 0;
-    ErrCode nErr = ERRCODE_NONE;
 
     // should a macro function be executed ( no direct API call)?
     if ( STRING_NOTFOUND != nHashPos && nHashPos < nArgsPos )
diff --git sfx2/source/appl/newhelp.cxx sfx2/source/appl/newhelp.cxx
index 9e0c8a1..cdb60fa 100644
--- sfx2/source/appl/newhelp.cxx
+++ sfx2/source/appl/newhelp.cxx
@@ -661,7 +661,8 @@ void IndexTabPage_Impl::InitializeIndex()
 
         Content aCnt( aURL, Reference< ::com::sun::star::ucb::XCommandEnvironment > () );
         ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySetInfo > xInfo = aCnt.getProperties();
-        if ( xInfo->hasPropertyByName( PROPERTY_ANCHORREF ) )
+        
+        if ( aURL && xInfo->hasPropertyByName( PROPERTY_ANCHORREF ) )
         {
             ::com::sun::star::uno::Sequence< ::rtl::OUString > aPropSeq( 4 );
             aPropSeq[0] = PROPERTY_KEYWORDLIST;
diff --git sfx2/source/appl/sfxhelp.cxx sfx2/source/appl/sfxhelp.cxx
index f9b2777..e84225f 100644
--- sfx2/source/appl/sfxhelp.cxx
+++ sfx2/source/appl/sfxhelp.cxx
@@ -475,8 +475,10 @@ SfxHelp::~SfxHelp()
         sDefaultModule = DEFINE_CONST_UNICODE("schart");
     else if ( aModOpt.IsModuleInstalled( SvtModuleOptions::E_SBASIC ) )
         sDefaultModule = DEFINE_CONST_UNICODE("sbasic");
+#if !defined( OOo4Kids )
     else if ( aModOpt.IsModuleInstalled( SvtModuleOptions::E_SDATABASE ) )
         sDefaultModule = DEFINE_CONST_UNICODE("sdatabase");
+#endif
     else
     {
         DBG_ERRORFILE( "getDefaultModule_Impl(): no module installed" );
@@ -558,6 +560,7 @@ String SfxHelp::GetHelpModuleName_Impl()
                 || aFactoryShortName.equalsAscii( "sglobal" )
                 || aFactoryShortName.equalsAscii( "swxform" ) )
             aFactoryShortName = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "swriter" ) );
+#if !defined( OOo4Kids )
         else if ( aFactoryShortName.equalsAscii( "dbquery" )
                 || aFactoryShortName.equalsAscii( "dbbrowser" )
                 || aFactoryShortName.equalsAscii( "dbrelation" )
@@ -568,6 +571,7 @@ String SfxHelp::GetHelpModuleName_Impl()
                 || aFactoryShortName.equalsAscii( "dbbrowser" )
                 || aFactoryShortName.equalsAscii( "swform" ) )
             aFactoryShortName = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "sdatabase" ) );
+#endif
         else if ( aFactoryShortName.equalsAscii( "sbibliography" )
                 || aFactoryShortName.equalsAscii( "StartModule" ) )
             aFactoryShortName = sDefaultModule;
diff --git sfx2/source/appl/shutdownicon.hxx sfx2/source/appl/shutdownicon.hxx
index a1c836c..f641e21 100644
--- sfx2/source/appl/shutdownicon.hxx
+++ sfx2/source/appl/shutdownicon.hxx
@@ -42,8 +42,10 @@ typedef ::cppu::WeakComponentImplHelper4<
 #define IMPRESS_URL     "private:factory/simpress"
 #define IMPRESS_WIZARD_URL     "private:factory/simpress?slot=6686"
 #define DRAW_URL        "private:factory/sdraw"
+#ifndef OOo4Kids
 #define MATH_URL        "private:factory/smath"
 #define BASE_URL        "private:factory/sdatabase?Interactive"
+#endif
 #define STARTMODULE_URL ".uno:ShowStartModule"
 #endif
 
diff --git sfx2/source/appl/shutdowniconaqua.mm sfx2/source/appl/shutdowniconaqua.mm
index e9326b4..47cd92a 100644
--- sfx2/source/appl/shutdowniconaqua.mm
+++ sfx2/source/appl/shutdowniconaqua.mm
@@ -99,12 +99,14 @@ using namespace ::com::sun::star::util;
     case MI_DRAW:
         ShutdownIcon::OpenURL( OUString( RTL_CONSTASCII_USTRINGPARAM( DRAW_URL ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "_default" ) ) );
         break;
+#ifndef OOo4Kids
     case MI_BASE:
         ShutdownIcon::OpenURL( OUString( RTL_CONSTASCII_USTRINGPARAM( BASE_URL ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "_default" ) ) );
         break;
     case MI_MATH:
         ShutdownIcon::OpenURL( OUString( RTL_CONSTASCII_USTRINGPARAM( MATH_URL ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "_default" ) ) );
         break;
+#endif
     case MI_TEMPLATE:
         ShutdownIcon::FromTemplate();
         break;
@@ -440,9 +442,12 @@ void aqua_init_systray()
                 { SvtModuleOptions::E_SWRITER,    MI_WRITER,  WRITER_URL },
                 { SvtModuleOptions::E_SCALC,      MI_CALC,    CALC_URL },
                 { SvtModuleOptions::E_SIMPRESS,   MI_IMPRESS, IMPRESS_WIZARD_URL },
-                { SvtModuleOptions::E_SDRAW,      MI_DRAW,    DRAW_URL },
+                { SvtModuleOptions::E_SDRAW,      MI_DRAW,    DRAW_URL }
+#ifndef OOo4Kids
+        ,
                 { SvtModuleOptions::E_SDATABASE,  MI_BASE,    BASE_URL },
                 { SvtModuleOptions::E_SMATH,      MI_MATH,    MATH_URL }
+#endif
             };
 
             // insert entry for startcenter
diff --git sfx2/source/appl/shutdowniconunx.cxx sfx2/source/appl/shutdowniconunx.cxx
index 44df4b4..fa7b2c4 100644
--- sfx2/source/appl/shutdowniconunx.cxx
+++ sfx2/source/appl/shutdowniconunx.cxx
@@ -188,11 +188,13 @@ static void add_ugly_db_item( GtkMenuShell *pMenuShell, const char *pAsciiURL,
                 aEntry[m].Value >>= aDescription;
         }
 
+#ifndef OOo4Kids
         if ( aURL.equalsAscii( BASE_URL ) && aDescription.getLength() )
         {
             add_item (pMenuShell, pAsciiURL, &aDescription, nResId, pFnCallback);
             break;
         }
+#endif
     }
 }
 
@@ -239,6 +241,7 @@ static void populate_menu( GtkWidget *pMenu )
         add_item (pMenuShell, DRAW_URL, NULL,
                   SV_ICON_ID_DRAWING, G_CALLBACK( open_url_cb ));
 
+#ifndef OOo4Kids
     if ( aModuleOptions.IsDataBase() )
         add_ugly_db_item (pMenuShell, BASE_URL,
                           SV_ICON_ID_DATABASE, G_CALLBACK( open_url_cb ));
@@ -247,6 +250,7 @@ static void populate_menu( GtkWidget *pMenu )
         add_item (pMenuShell, MATH_URL, NULL,
                   SV_ICON_ID_FORMULA, G_CALLBACK( open_url_cb ));
 
+#endif
     OUString aULabel = pShutdownIcon->GetResString( STR_QUICKSTART_FROMTEMPLATE );
     add_item (pMenuShell, "dummy", &aULabel,
               SV_ICON_ID_TEMPLATE, G_CALLBACK( open_template_cb ));
diff --git sfx2/source/appl/shutdowniconw32.cxx sfx2/source/appl/shutdowniconw32.cxx
index 53bbc38..644da73 100644
--- sfx2/source/appl/shutdowniconw32.cxx
+++ sfx2/source/appl/shutdowniconw32.cxx
@@ -244,8 +244,10 @@ static HMENU createSystrayMenu( )
         { SvtModuleOptions::E_SCALC,      IDM_CALC,   ICON_SPREADSHEET_DOCUMENT,  CALC_URL },
         { SvtModuleOptions::E_SIMPRESS,   IDM_IMPRESS,ICON_PRESENTATION_DOCUMENT, IMPRESS_WIZARD_URL },
         { SvtModuleOptions::E_SDRAW,      IDM_DRAW,   ICON_DRAWING_DOCUMENT,      DRAW_URL },
+#ifndef OOo4Kids
         { SvtModuleOptions::E_SDATABASE,  IDM_BASE,   ICON_DATABASE_DOCUMENT,     BASE_URL },
         { SvtModuleOptions::E_SMATH,      IDM_MATH,   ICON_MATH_DOCUMENT,	      MATH_URL },
+#endif
     };
 
     // insert the menu entries for launching the applications
@@ -535,6 +537,7 @@ LRESULT CALLBACK executerWndProc( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lP
                     if (checkOEM())
                     ShutdownIcon::OpenURL( OUString( RTL_CONSTASCII_USTRINGPARAM( DRAW_URL ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "_default" ) ) );
                 break;
+#ifndef OOo4Kids
                 case IDM_BASE:
                     if (checkOEM())
                     ShutdownIcon::OpenURL( OUString( RTL_CONSTASCII_USTRINGPARAM( BASE_URL ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "_default" ) ) );
@@ -543,6 +546,7 @@ LRESULT CALLBACK executerWndProc( HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lP
                     if (checkOEM())
                     ShutdownIcon::OpenURL( OUString( RTL_CONSTASCII_USTRINGPARAM( MATH_URL ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "_default" ) ) );
                 break;
+#endif
                 case IDM_TEMPLATE:
                     if ( !ShutdownIcon::bModalMode && checkOEM())
                         ShutdownIcon::FromTemplate();
diff --git sfx2/source/appl/workwin.cxx sfx2/source/appl/workwin.cxx
index 5e2bb23..e521a95 100644
--- sfx2/source/appl/workwin.cxx
+++ sfx2/source/appl/workwin.cxx
@@ -72,10 +72,98 @@
 #include <com/sun/star/awt/XWindow.hpp>
 #include <com/sun/star/lang/DisposedException.hpp>
 
+#ifdef OOo4Kids
+#include "vcl/unohelp.hxx"
+#include <com/sun/star/container/XContentEnumerationAccess.hpp>
+#include <com/sun/star/container/XNameAccess.hpp>
+#include <com/sun/star/container/XNameReplace.hpp>
+#include <com/sun/star/uno/Any.hxx>
+#include <com/sun/star/lang/XComponent.hpp>
+#define USER_LEVEL_BEGINNER      1
+#define USER_LEVEL_AVERAGE       2
+#define USER_LEVEL_EXPERT        3
+#endif
+
+
 using namespace ::com::sun::star;
-using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star::uno; // Reference
 namespace css = ::com::sun::star;
 
+#ifdef OOo4Kids
+
+using namespace css::lang; // XMultiServiceFactory
+using namespace css::beans; // PropertyValue
+using namespace css::container; // XNameAccess
+using ::rtl::OUString;
+
+// The standard toolbar
+static const OUString sStandardbarToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/standardbar" ) );
+// The beginner toolbar (every application has its own)
+static const OUString sBeginnerbarToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/beginner" ) );
+// The average toolbar (every application has its own)
+static const OUString sAveragebarToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/average" ) );
+// Generic constants
+static const OUString sULConfigSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationProvider" ) );
+static const OUString sULAccessSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationUpdateAccess" ) );
+
+static short getUserLevel()
+{
+    short dUserLevel = 1; // default is beginner 
+    try
+    {
+    // get service provider
+        Reference< XMultiServiceFactory > xSMgr( vcl::unohelper::GetMultiServiceFactory() );
+        // create configuration hierachical access name
+        if( xSMgr.is() )
+        {
+            try
+            {
+                Reference< XMultiServiceFactory > xConfigProvider(
+                    Reference< XMultiServiceFactory >(
+                        xSMgr->createInstance( sULConfigSrvc ),
+                        UNO_QUERY )
+                    );
+                if( xConfigProvider.is() )
+                {
+                    Sequence< Any > aArgs(1);
+                    PropertyValue aVal;
+                    aVal.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "nodepath" ) );
+                    aVal.Value <<= OUString( RTL_CONSTASCII_USTRINGPARAM( "/org.openoffice.Office.Common/Misc" ) );
+                    aArgs.getArray()[0] <<= aVal;
+                    Reference< XNameAccess > xConfigAccess(
+                        Reference< XNameAccess >(
+                            xConfigProvider->createInstanceWithArguments( sULAccessSrvc, aArgs ), UNO_QUERY )
+                        );
+                    if( xConfigAccess.is() )
+                    {
+                        try
+                        {
+                            short bValue = 1;
+                            Any aAny = xConfigAccess->getByName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserLevel" ) ) );
+                            if( aAny >>= bValue )
+                                dUserLevel = bValue;
+                        }
+                        catch( NoSuchElementException& )
+                        {
+                        }
+                        catch( WrappedTargetException& )
+                        {
+                        }
+                    }
+                }
+            }
+            catch( Exception& )
+            {
+            }
+        }
+    }
+    catch( WrappedTargetException& )
+    {
+    }
+    return dUserLevel;
+}
+#endif
+
 struct ResIdToResName
 {
     USHORT      nId;
@@ -143,6 +231,10 @@ static const ResIdToResName pToolBarResToName[] =
     { 23031,    "mediaobjectbar"       },      //draw/impress
     { 25060,    "mediaobjectbar"       },      //calc
     { 23311,    "mediaobjectbar"       },      //writer
+#ifdef OOo4Kids
+    { 20001,    "beginner"      },      //writer
+    { 20002,    "average"       },      //writer
+#endif
     { 0,        ""                     }
 };
 
@@ -1496,6 +1588,61 @@ void SfxWorkWindow::UpdateObjectBars_Impl()
 
         // wird in diesem Kontext eine ToolBox gefordert?
         FASTBOOL bModesMatching = ( nUpdateMode && ( nTbxMode & nUpdateMode) == nUpdateMode );
+
+#ifdef OOo4Kids
+        short int nUserLevel = getUserLevel();
+        rtl::OUString aTbxId( m_aTbxTypeName );
+        aTbxId += GetResourceURLFromResId( aObjBarList[n].nId );
+
+        switch ( nUserLevel ) 
+        {
+            // FIXME : requestElement() is synchronous, but adds ghosts
+            // oppositely, showElement() is clean, but not synchronous :/
+            case USER_LEVEL_BEGINNER:
+              {
+#ifdef DEBUG
+                fprintf(stdout, " %s : User level beginner \n", __func__);
+                fprintf(stdout, "nId = %d \n", nId );
+                fprintf(stdout, "aTbxId = %s \n", dbg_dump( aTbxId) );
+#endif
+                //xLayoutManager->showElement( sBeginnerbarToolbarTypeName );
+                xLayoutManager->requestElement( sBeginnerbarToolbarTypeName );
+                xLayoutManager->destroyElement( sAveragebarToolbarTypeName );
+                xLayoutManager->destroyElement( sStandardbarToolbarTypeName );
+              }
+                break;
+
+            case USER_LEVEL_AVERAGE:
+              {
+#ifdef DEBUG
+                fprintf(stdout, " %s : User level average \n", __func__);
+                fprintf(stdout, " nId = %d \n", nId );
+#endif
+                //xLayoutManager->showElement( sAveragebarToolbarTypeName );
+                xLayoutManager->requestElement( sAveragebarToolbarTypeName );
+                xLayoutManager->destroyElement( sBeginnerbarToolbarTypeName );
+                xLayoutManager->destroyElement( sStandardbarToolbarTypeName );
+              }
+                break;
+
+            case USER_LEVEL_EXPERT:
+              {
+#ifdef DEBUG
+                fprintf(stdout, " %s : User level expert \n", __func__);
+                fprintf(stdout, " nId = %d \n", nId );
+#endif
+                //xLayoutManager->showElement( sStandardbarToolbarTypeName );
+                xLayoutManager->requestElement( sStandardbarToolbarTypeName );
+                xLayoutManager->destroyElement( sBeginnerbarToolbarTypeName );
+                xLayoutManager->destroyElement( sAveragebarToolbarTypeName );
+              }
+                break;
+
+            default:
+                break;        
+        }
+#endif // OOo4Kids
+
         if ( bDestroy )
         {
             rtl::OUString aTbxId( m_aTbxTypeName );
diff --git sfx2/source/control/bindings.cxx sfx2/source/control/bindings.cxx
index 02efe0a..c0687da 100644
--- sfx2/source/control/bindings.cxx
+++ sfx2/source/control/bindings.cxx
@@ -277,9 +277,11 @@ SfxBindings::~SfxBindings()
     for ( sal_uInt16 nCache = 0; nCache < nCount; ++nCache )
         delete pImp->pCaches->GetObject(nCache);
 
+    if ( pImp->pWorkWin );
     DELETEZ( pImp->pWorkWin );
-
+    if ( pImp-> pCaches )
     delete pImp->pCaches;
+    if ( pImp )
     delete pImp;
 }
 
diff --git sfx2/source/dialog/about.cxx sfx2/source/dialog/about.cxx
index bae0b9c..be6b7a6 100644
--- sfx2/source/dialog/about.cxx
+++ sfx2/source/dialog/about.cxx
@@ -56,6 +56,10 @@
 #include "sfxresid.hxx"
 #include <sfx2/sfxdefs.hxx>
 #include <sfx2/app.hxx>
+#include <vcl/bitmap.hxx>
+#include <vcl/pngread.hxx>
+#include <rtl/strbuf.hxx>
+#include <vcl/salnativewidgets.hxx>
 
 #include "dialog.hrc"
 
@@ -67,6 +71,34 @@
 
 #define WELCOME_URL     DEFINE_CONST_UNICODE( "http://www.openoffice.org/welcome/credits.html" )
 
+// redefined in showlicense.cxx
+#if 0  
+//#ifdef DEBUG  
+const sal_Char *dbg_dump(const rtl::OString &rStr)
+{
+    static rtl::OStringBuffer aStr;
+    aStr = rtl::OStringBuffer(rStr);
+    aStr.append(static_cast<char>(0));
+    return aStr.getStr();
+}
+
+const sal_Char *dbg_dump(const rtl::OUString &rStr)
+{
+    return dbg_dump(rtl::OUStringToOString(rStr, RTL_TEXTENCODING_UTF8));
+}
+
+const sal_Char *dbg_dump(rtl_String *pStr)
+{
+    return dbg_dump(rtl::OString(pStr));
+}
+
+const sal_Char *dbg_dump(rtl_uString *pStr)
+{
+    return dbg_dump(rtl::OUString(pStr));
+}
+#endif
+
+
 // class AboutDialog -----------------------------------------------------
 static void layoutText( FixedInfo &rText, long &nY, long nTextWidth, Size a6Size )
 {
@@ -84,25 +116,39 @@ static void layoutText( FixedInfo &rText, long &nY, long nTextWidth, Size a6Size
     nY += aTxtSiz.Height();
 }
 
-static bool impl_loadBitmap(
-    const rtl::OUString &rPath, const rtl::OUString &rBmpFileName,
-    Image &rLogo )
+static bool impl_loadPng(
+    const rtl::OUString &rPath, const rtl::OUString &rBmpFileName
+    , Image &rLogo )
 {
+
+    if ( rBmpFileName.getLength() == 0 )
+        return false;
+
     rtl::OUString uri( rPath );
     rtl::Bootstrap::expandMacros( uri );
     INetURLObject aObj( uri );
     aObj.insertName( rBmpFileName );
-    SvFileStream aStrm( aObj.PathToFileName(), STREAM_STD_READ );
-    if ( !aStrm.GetError() )
+
+    if (aObj.PathToFileName().endsWithAsciiL(RTL_CONSTASCII_STRINGPARAM(".png")))
     {
-        Bitmap aBmp;
-        aStrm >> aBmp;
-        rLogo = Image( aBmp );
+        SvFileStream pStream( aObj.PathToFileName(), STREAM_STD_READ );
+        pStream.Open( aObj.PathToFileName(), STREAM_STD_READ  );
+        if ( pStream.GetError() )
+            return false;
+        else
+        {
+            BitmapEx aPng = vcl::PNGReader(pStream).Read();
+            rLogo = Image( aPng );
+            // avoid leaks ...
+            pStream.Close();
+        }
         return true;
     }
+    else
     return false;
 }
 
+
 AboutDialog::AboutDialog( Window* pParent, const ResId& rId, const String& rVerStr ) :
 
     SfxModalDialog	( pParent, 	rId ),
@@ -137,31 +183,32 @@ AboutDialog::AboutDialog( Window* pParent, const ResId& rId, const String& rVerS
         // <--
     }
 
+    bool bLoaded = false;
+
     // load image from module path
     rtl::OUString aAbouts( RTL_CONSTASCII_USTRINGPARAM( ABOUT_BITMAP_STRINGLIST ) );
-    bool bLoaded = false;
     sal_Int32 nIndex = 0;
+
     do
     {
-        bLoaded = impl_loadBitmap(
+        bLoaded = impl_loadPng(
             rtl::OUString::createFromAscii( "$BRAND_BASE_DIR/program" ),
             aAbouts.getToken( 0, ',', nIndex ), aAppLogo );
     }
     while ( !bLoaded && ( nIndex >= 0 ) );
 
-    // fallback to "about.bmp"
+    // fallback to "about.png"
     if ( !bLoaded )
     {
-        bLoaded = impl_loadBitmap(
+        bLoaded = impl_loadPng(
             rtl::OUString::createFromAscii( "$BRAND_BASE_DIR/program/edition" ),
-            rtl::OUString::createFromAscii( "about.bmp" ), aAppLogo );
+            rtl::OUString::createFromAscii( "about.png" ), aAppLogo);
     }
-
     if ( !bLoaded )
     {
-        bLoaded = impl_loadBitmap(
+        bLoaded = impl_loadPng(
             rtl::OUString::createFromAscii( "$BRAND_BASE_DIR/program" ),
-            rtl::OUString::createFromAscii( "about.bmp" ), aAppLogo );
+            rtl::OUString::createFromAscii( "about.png" ), aAppLogo);
     }
 
     // Transparenter Font
@@ -369,7 +416,10 @@ void AboutDialog::Paint( const Rectangle& rRect )
 
     if ( bNormal ) // not in scroll mode
     {
+ 	    Size aSize = aAppLogo.GetBitmapEx().GetSizePixel();
         Point aPos( m_nDeltaWidth / 2, 0 );
+        // other possibility: 
+        //OutputDevice::DrawBitmapEx( aPos, aAppLogo.GetBitmapEx() );
         DrawImage( aPos, aAppLogo );
         return;
     }
diff --git sfx2/source/dialog/dialog.hrc sfx2/source/dialog/dialog.hrc
index e41fbc0..77e19ad 100644
--- sfx2/source/dialog/dialog.hrc
+++ sfx2/source/dialog/dialog.hrc
@@ -49,6 +49,7 @@
 #define BTN_MANAGER                 	( RC_DIALOG_BEGIN + 4)
 #define BTN_STANDARD                	( RC_DIALOG_BEGIN + 5)
 #define DLG_PASSWD						( RC_DIALOG_BEGIN + 8)
+#define DLG_PREFS_PASSWD		( RC_DIALOG_BEGIN + 9)
 #define STR_FILEDLG_INSERT          	( RC_DIALOG_BEGIN + 10)
 #define STR_TABPAGE_MANAGESTYLES    	( RC_DIALOG_BEGIN + 12)
 #define MSG_TABPAGE_INVALIDNAME     	( RC_DIALOG_BEGIN + 13)
diff --git sfx2/source/dialog/makefile.mk sfx2/source/dialog/makefile.mk
index 230bbe4..ec815c3 100644
--- sfx2/source/dialog/makefile.mk
+++ sfx2/source/dialog/makefile.mk
@@ -33,6 +33,12 @@ PRJ=..$/..
 PRJNAME=sfx2
 TARGET=dialog
 
+.IF "$(OOo4Kids)"=="YES"
+OOo4Kids_EXT+=_OOo4Kids
+RSCDEFS+=-DOOo4Kids
+#ADDCDEFS+=-DOOo4Kids
+.ENDIF
+
 # --- Settings -----------------------------------------------------------
 
 .INCLUDE :  settings.mk
@@ -49,11 +55,13 @@ EXCEPTIONSFILES=\
         $(SLO)$/recfloat.obj        \
         $(SLO)$/templdlg.obj        \
         $(SLO)$/dinfdlg.obj         \
-        $(SLO)$/dockwin.obj
+        $(SLO)$/dockwin.obj	\
+        $(SLO)$/passwd${OOo4Kids_EXT}.obj
 
 SLOFILES =\
         $(EXCEPTIONSFILES)			\
         $(SLO)$/about.obj           \
+        $(SLO)$/showlicense.obj           \
         $(SLO)$/alienwarn.obj       \
         $(SLO)$/basedlgs.obj		\
         $(SLO)$/dinfedt.obj			\
@@ -61,7 +69,6 @@ SLOFILES =\
         $(SLO)$/mgetempl.obj		\
         $(SLO)$/navigat.obj			\
         $(SLO)$/newstyle.obj		\
-        $(SLO)$/passwd.obj			\
         $(SLO)$/printopt.obj		\
         $(SLO)$/sfxdlg.obj          \
         $(SLO)$/sfxurl.obj			\
diff --git sfx2/source/dialog/passwd.cxx sfx2/source/dialog/passwd.cxx
index 628258e..a4f2461 100644
--- sfx2/source/dialog/passwd.cxx
+++ sfx2/source/dialog/passwd.cxx
@@ -43,10 +43,54 @@
 #include "dialog.hrc"
 #include "passwd.hrc"
 
+#ifdef OOo4Kids
+#include <com/sun/star/container/XContentEnumerationAccess.hpp>
+#include <com/sun/star/container/XNameAccess.hpp>
+#include <com/sun/star/container/XNameReplace.hpp>
+#include <com/sun/star/container/XHierarchicalNameAccess.hpp>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/lang/XInitialization.hpp>
+#include <com/sun/star/beans/NamedValue.hpp>
+#include <com/sun/star/beans/XPropertySet.hpp>
+#include <com/sun/star/util/XChangesBatch.hpp>
+#include <com/sun/star/uno/Any.hxx>
+#include <com/sun/star/container/XSet.hpp>
+
+
+#include <comphelper/processfactory.hxx>
+
+#include <vcl/unohelp.hxx>
+#include <com/sun/star/frame/XLayoutManager.hpp>
+#include <com/sun/star/frame/XLayoutManagerListener.hpp>
+#include <com/sun/star/frame/XLayoutManagerEventBroadcaster.hpp>
+#include <sfx2/childwin.hxx>
+#include <sfx2/viewfrm.hxx>
+
+using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star::frame;
+using namespace ::com::sun::star::lang;
+using namespace ::com::sun::star::beans;
+using namespace ::com::sun::star::container;
+using namespace ::com::sun::star::util;
+using ::rtl::OString;
+using ::rtl::OUString;
+
+// static 
+
+static const OUString sULConfigSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationProvider" ) );
+static const OUString sULAccessSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationUpdateAccess" ) );
+static const OUString sULaNode( RTL_CONSTASCII_USTRINGPARAM( "/org.openoffice.Office.Common/Misc" ) );
+static const OUString sULPropertyName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserLevel" ) ) );
+static const OUString sPrefsPasswordPropertyName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPrefsPassword" ) ) );
+#endif
+
 // -----------------------------------------------------------------------
 
 IMPL_LINK_INLINE_START( SfxPasswordDialog, EditModifyHdl, Edit *, EMPTYARG )
 {
+    if ( ( SHOWEXTRAS_CURRENT_PASSWD == mnExtras ) || ( SHOWEXTRAS_NONE_OOO4KIDS == mnExtras ) )
+        maOKBtn.Enable( maCurrentPasswordED.GetText().Len() >= mnMinLen );
+    else
     maOKBtn.Enable( maPasswordED.GetText().Len() >= mnMinLen );
     return 0;
 }
@@ -56,15 +100,58 @@ IMPL_LINK_INLINE_END( SfxPasswordDialog, EditModifyHdl, Edit *, EMPTYARG )
 
 IMPL_LINK( SfxPasswordDialog, OKHdl, OKButton *, EMPTYARG )
 {
+    bPasswordEntryFailed = false;
+
+    if  ( ( ( mnExtras & SHOWEXTRAS_CURRENT_PASSWD ) == SHOWEXTRAS_CURRENT_PASSWD ) &&
+          ( ( (OUString)getUserPrefsPassword() != (OUString)GetCurrentPassword() ) )
+        )
+    {
+        bPasswordEntryFailed = true;
+        ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM /*STR_CURRENT_PASSWD_ERROR*/ ) );
+        aBox.Execute();
+        maCurrentPasswordED.SetText( String() );
+        maCurrentPasswordED.GrabFocus();
+        return 0;
+    }
+
+    if  ( ( ( mnExtras & SHOWEXTRAS_CURRENT_PASSWD ) == SHOWEXTRAS_CURRENT_PASSWD ) &&
+          ( (OUString)GetConfirm() != (OUString)GetPassword() )
+        )
+    {
+        bPasswordEntryFailed = true;
+        ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM ) );
+        aBox.Execute();
+        maConfirmED.SetText( String() );
+        maConfirmED.GrabFocus();
+        EndDialog( RET_CANCEL );
+        return 0;
+    }
+
     if ( ( ( mnExtras & SHOWEXTRAS_CONFIRM ) == SHOWEXTRAS_CONFIRM ) &&
          ( GetConfirm() != GetPassword() ) )
     {
+        bPasswordEntryFailed = true;
         ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM ) );
         aBox.Execute();
         maConfirmED.SetText( String() );
         maConfirmED.GrabFocus();
     }
-    else
+    if ( ( ( mnExtras & SHOWEXTRAS_NONE_OOO4KIDS ) == SHOWEXTRAS_NONE_OOO4KIDS ) &&
+        ( getUserPrefsPassword() != (OUString)GetPassword() ) )
+    {
+        bPasswordEntryFailed = true;
+        ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM ) );
+        aBox.Execute();
+        maCurrentPasswordED.SetText( String() );
+        maCurrentPasswordED.GrabFocus();
+        return 0;
+    }
+
+    if  ( ( ( mnExtras & SHOWEXTRAS_CURRENT_PASSWD ) == SHOWEXTRAS_CURRENT_PASSWD ) &&
+            ( GetConfirm() == GetPassword() ) )
+    {
+        setUserPrefsPassword( (OUString)GetConfirm() );
+    }
         EndDialog( RET_OK );
     return 0;
 }
@@ -77,6 +164,11 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
 
     maUserFT		( this, SfxResId( FT_PASSWD_USER ) ),
     maUserED		( this, SfxResId( ED_PASSWD_USER ) ),
+#ifdef OOo4Kids
+    maCurrentPasswordFT	( this, SfxResId( FT_PREFS_CURRENT_PASSWD ) ),
+    maCurrentPasswordED	( this, SfxResId( ED_PREFS_CURRENT_PASSWD ) ),
+    maChangePasswordBox	( this, SfxResId( GB_PASSWD_CHANGE_PASSWORD ) ),
+#endif
     maPasswordFT	( this, SfxResId( FT_PASSWD_PASSWORD ) ),
     maPasswordED	( this, SfxResId( ED_PASSWD_PASSWORD ) ),
     maConfirmFT		( this, SfxResId( FT_PASSWD_CONFIRM ) ),
@@ -86,14 +178,18 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
     maCancelBtn		( this, SfxResId( BTN_PASSWD_CANCEL ) ),
     maHelpBtn		( this, SfxResId( BTN_PASSWD_HELP ) ),
     maConfirmStr	( 		SfxResId( STR_PASSWD_CONFIRM ) ),
+//	maErrorCurrentStr	( 		SfxResId( STR_CURRENT_PASSWD_ERROR ) ),
+
+    mnMinLen		( 4 ),
 
-    mnMinLen		( 5 ),
     mnExtras		( 0 )
 
+    bPasswordEntryFailed = false;
 {
     FreeResource();
 
     Link aLink = LINK( this, SfxPasswordDialog, EditModifyHdl );
+    maCurrentPasswordED.SetModifyHdl( aLink );
     maPasswordED.SetModifyHdl( aLink );
     aLink = LINK( this, SfxPasswordDialog, OKHdl );
     maOKBtn.SetClickHdl( aLink );
@@ -104,6 +200,101 @@ SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText
 
 // -----------------------------------------------------------------------
 
+OUString SfxPasswordDialog::getUserPrefsPassword()
+{
+    OUString sPrefsPasswordContent = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "prof" ) ); // default is prof 
+    try
+    {
+        // get service provider
+        Reference< XMultiServiceFactory > xSMgr( vcl::unohelper::GetMultiServiceFactory() );
+        // create configuration hierachical access name
+        if( xSMgr.is() )
+        {
+            try
+            {
+                Reference< XMultiServiceFactory > xConfigProvider(
+                    Reference< XMultiServiceFactory >(
+                        xSMgr->createInstance( sULConfigSrvc ),
+                        UNO_QUERY )
+                    );
+                if( xConfigProvider.is() )
+                {
+                    Sequence< Any > aArgs(1);
+                    PropertyValue aVal;
+                    aVal.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "nodepath" ) );
+                    aVal.Value <<= sULaNode;
+
+                    aArgs.getArray()[0] <<= aVal;
+                    Reference< XNameAccess > xConfigAccess(
+                        Reference< XNameAccess >(
+                            xConfigProvider->createInstanceWithArguments( sULAccessSrvc, aArgs ), UNO_QUERY )
+                        );
+                    if( xConfigAccess.is() )
+                    {
+                        try
+                        {
+                            OUString bValue;// = OUString( RTL_CONSTASCII_USTRINGPARAM( "prof" ) ); //initial value
+                            Any aAny = xConfigAccess->getByName( sPrefsPasswordPropertyName );
+                            if( aAny >>= bValue )
+                                sPrefsPasswordContent = bValue;
+                        }
+                        catch( NoSuchElementException& )
+                        {
+                        }
+                        catch( WrappedTargetException& )
+                        {
+                        }
+                    }
+                }
+            }
+            catch( Exception& )
+            {
+            }
+        }
+    }
+    catch( WrappedTargetException& )
+    {
+    }
+    return sPrefsPasswordContent;
+}
+
+// -----------------------------------------------------------------------
+
+void SfxPasswordDialog::setUserPrefsPassword( OUString aPassword )
+{
+    try
+    {
+        Reference < XMultiServiceFactory > xFactory = ::comphelper::getProcessServiceFactory();
+
+        // get configuration provider
+        // use UNO_QUERY_THROW means that the current file *must* be compiled with exception support enabled
+        // and use UNO_QUERY instead, who builds without exception support enabled, will lead to crashes if 
+        // if some uno code called thrown.
+        Reference< XMultiServiceFactory > theConfigProvider = Reference< XMultiServiceFactory >(
+        xFactory->createInstance(sULConfigSrvc), UNO_QUERY_THROW /*UNO_QUERY*/ );
+
+        Sequence< Any > theArgs(1);
+        NamedValue v(OUString::createFromAscii("NodePath"),
+            makeAny(OUString::createFromAscii("org.openoffice.Office.Common/Misc")));
+        theArgs[0] <<= v;
+ 
+        Reference< XPropertySet > pset = Reference< XPropertySet >(
+            theConfigProvider->createInstanceWithArguments(sULAccessSrvc, theArgs), UNO_QUERY_THROW /*UNO_QUERY*/);
+
+        Any result = pset->getPropertyValue(OUString::createFromAscii("UserPrefsPassword"));
+
+        pset->setPropertyValue(OUString::createFromAscii("UserPrefsPassword"), makeAny(aPassword));
+        Reference< XChangesBatch >(pset, UNO_QUERY_THROW /*UNO_QUERY*/)->commitChanges();
+
+    }
+    catch( Exception& )
+    {
+    }
+}
+
+
+// -----------------------------------------------------------------------
+
 void SfxPasswordDialog::SetMinLen( USHORT nLen )
 {
     mnMinLen = nLen;
@@ -114,6 +305,7 @@ void SfxPasswordDialog::SetMinLen( USHORT nLen )
 
 void SfxPasswordDialog::SetMaxLen( USHORT nLen )
 {
+    maCurrentPasswordED.SetMaxTextLen( nLen );
     maPasswordED.SetMaxTextLen( nLen );
     maConfirmED.SetMaxTextLen( nLen );
     EditModifyHdl( NULL );
@@ -131,6 +323,28 @@ short SfxPasswordDialog::Execute()
                           maHelpBtn.GetSizePixel().Height() + a6Size.Height();
         USHORT nRowHided = 1;
 
+        if ( SHOWEXTRAS_NONE_OOO4KIDS == mnExtras )
+        {
+            maUserFT.Hide();
+            maUserED.Hide();
+            maConfirmFT.Hide();
+            maConfirmED.Hide();
+            maCurrentPasswordFT.Hide();
+            maCurrentPasswordED.Hide();
+
+            maChangePasswordBox.Hide();
+            
+            Point aPos = maPasswordFT.GetPosPixel();
+            long nEnd = maCurrentPasswordFT.GetPosPixel().X() + maCurrentPasswordFT.GetSizePixel().Width() + maCurrentPasswordED.GetSizePixel().Width();
+            maPasswordFT.SetPosPixel( aPos );
+            Size aSize = maPasswordED.GetSizePixel();
+            aPos = maPasswordED.GetPosPixel();
+            aSize.Width() = nEnd - aPos.X();
+            maPasswordED.SetSizePixel( aSize );
+
+            nRowHided = 3;
+        }
+
         if ( SHOWEXTRAS_NONE == mnExtras )
         {
             maUserFT.Hide();
@@ -148,6 +362,54 @@ short SfxPasswordDialog::Execute()
 
             nRowHided = 2;
         }
+        else if ( SHOWEXTRAS_CURRENT_PASSWD == mnExtras )
+        {
+            // we need to improve the heigth, because we add one entry
+            nMinHeight += maHelpBtn.GetSizePixel().Height() + a6Size.Height();
+
+            // hide the (useless) user entry
+            maUserFT.Hide();
+            maUserED.Hide();
+
+            // the current password entry will replace the user one, so we need its location
+            Point aPos = maCurrentPasswordFT.GetPosPixel();
+
+            // define its width
+            long nEnd = maCurrentPasswordFT.GetPosPixel().X() + maCurrentPasswordFT.GetSizePixel().Width() + maCurrentPasswordED.GetSizePixel().Width();
+            
+            // set the current password entry position 
+            maCurrentPasswordFT.SetPosPixel( aPos );
+
+            // define its size
+            Size aSize = maCurrentPasswordED.GetSizePixel();
+
+            // define its length
+            aSize.Width() = nEnd - aPos.X();
+
+            // Fixed Text position ( the string "enter current password" )
+            Point aCurrentPwdPos1 = maPasswordFT.GetPosPixel();
+
+            // The location of the Current Password Editor
+            Point aCurrentPwdPos2 = maPasswordED.GetPosPixel();
+
+            maPasswordFT.SetPosPixel( aCurrentPwdPos1 );
+            maPasswordED.SetPosPixel( aCurrentPwdPos2 );
+
+            // Get position for maPasswordFT and maPasswordED
+            aCurrentPwdPos1 = maPasswordFT.GetPosPixel();
+            aCurrentPwdPos2 = maPasswordED.GetPosPixel();
+
+            maPasswordFT.SetPosPixel( aCurrentPwdPos1 );
+            maPasswordED.SetPosPixel( aCurrentPwdPos2 );
+
+            // Get position for maConfirmFT and maConfirmED
+            aCurrentPwdPos1 = maConfirmFT.GetPosPixel();
+            aCurrentPwdPos2 = maConfirmED.GetPosPixel();
+
+            maConfirmFT.SetPosPixel( aCurrentPwdPos1 );
+            maConfirmED.SetPosPixel( aCurrentPwdPos2 );
+
+        }
         else if ( SHOWEXTRAS_USER == mnExtras )
         {
             maConfirmFT.Hide();
@@ -169,8 +431,27 @@ short SfxPasswordDialog::Execute()
             maConfirmFT.SetPosPixel( aPwdPos1 );
             maConfirmED.SetPosPixel( aPwdPos2 );
         }
+        else if ( SHOWEXTRAS_CONFIRM_OOO4KIDS == mnExtras )
+        {
+//			maUserFT.Hide();
+//			maUserED.Hide();
+
+            Point aPwdPos1 = maPasswordFT.GetPosPixel();
+            Point aPwdPos2 = maPasswordED.GetPosPixel();
+
+            Point aPos = maCurrentPasswordFT.GetPosPixel();
+            maPasswordFT.SetPosPixel( aPos );
+            aPos = maCurrentPasswordED.GetPosPixel();
+            maPasswordED.SetPosPixel( aPos );
+
+            maConfirmFT.SetPosPixel( aPwdPos1 );
+            maConfirmED.SetPosPixel( aPwdPos2 );
+        }
 
         Size aBoxSize = maPasswordBox.GetSizePixel();
+        if ( ( SHOWEXTRAS_CURRENT_PASSWD == mnExtras ) || ( SHOWEXTRAS_NONE_OOO4KIDS == mnExtras ) )
+            aBoxSize.Height() -= ( nRowHided * maCurrentPasswordED.GetSizePixel().Height() );
+        else
         aBoxSize.Height() -= ( nRowHided * maUserED.GetSizePixel().Height() );
         aBoxSize.Height() -= ( nRowHided * a3Size.Height() );
         maPasswordBox.SetSizePixel( aBoxSize );
diff --git sfx2/source/dialog/passwd.hrc sfx2/source/dialog/passwd.hrc
index 112695a..2b2f553 100644
--- sfx2/source/dialog/passwd.hrc
+++ sfx2/source/dialog/passwd.hrc
@@ -32,19 +32,25 @@
 
 // defines ---------------------------------------------------------------
 
+#define GB_PASSWD_CHANGE_PASSWORD 9
 #define GB_PASSWD_PASSWORD 10
 #define FT_PASSWD_USER 11
 #define ED_PASSWD_USER 12
-#define FT_PASSWD_PASSWORD 13
-#define ED_PASSWD_PASSWORD 14
-#define FT_PASSWD_CONFIRM 15
-#define ED_PASSWD_CONFIRM 16
+#define FT_PREFS_CURRENT_PASSWD 13
+#define ED_PREFS_CURRENT_PASSWD 14
+#define FT_PASSWD_PASSWORD 15
+#define ED_PASSWD_PASSWORD 16
+#define FT_PASSWD_CONFIRM 17
+#define ED_PASSWD_CONFIRM 18
 
 #define BTN_PASSWD_OK 20
 #define BTN_PASSWD_CANCEL 21
 #define BTN_PASSWD_HELP 22
 
 #define STR_PASSWD_CONFIRM 30
+#define STR_CURRENT_PASSWD_ERROR 31
+
+#define PUSHBUTTON_X_POS 184
 
 #endif
 
diff --git sfx2/source/dialog/passwd.src sfx2/source/dialog/passwd.src
index c7fbaaf..b1b6ccd 100644
--- sfx2/source/dialog/passwd.src
+++ sfx2/source/dialog/passwd.src
@@ -39,9 +39,10 @@ ModalDialog DLG_PASSWD
     HelpId = HID_PASSWD ;
     OutputSize = TRUE ;
     SVLook = TRUE ;
-    Size = MAP_APPFONT( 200, 68 );
+    Size = MAP_APPFONT( 250, 100 );
     Text [ en-US ] = "Enter Password" ;
     Moveable = TRUE ;
+
     FixedText FT_PASSWD_USER
     {
         Pos = MAP_APPFONT( 12, 15 );
@@ -54,59 +55,109 @@ ModalDialog DLG_PASSWD
         Pos = MAP_APPFONT( 57, 14 );
         Size = MAP_APPFONT( 75, 12 );
     };
+
+    FixedText FT_PREFS_CURRENT_PASSWD
+    {
+        Pos = MAP_APPFONT( 12, 15 );
+        Size = MAP_APPFONT( 82, 10 );
+        Text [ en-US ] = "~Enter current password";
+        Text [ fr ] = "~Mot de passe actuel";
+        Text [ de ] = "Aktuelles Password";
+        Text [ es ] = "Contrasea actual";
+        Text [ it ] ="Password attuale";
+        Text [ nl ] ="Huidig wachtwoord";
+        Text [ zh-CN ] = "";
+        Text [ pt ] = "Senha actual";
+        Text [ fi ] = "Nykyinen salasana";
+    };
+    Edit ED_PREFS_CURRENT_PASSWD
+    {
+        Border = TRUE;
+        PassWord = TRUE;
+        Pos = MAP_APPFONT( 97, 14 );
+        Size = MAP_APPFONT( 75, 12 );
+    };
     FixedText FT_PASSWD_PASSWORD
     {
         Pos = MAP_APPFONT( 12, 30 );
-        Size = MAP_APPFONT( 42, 10 );
+        Size = MAP_APPFONT( 82, 10 );
         Text [ en-US ] = "~Password";
     };
     Edit ED_PASSWD_PASSWORD
     {
         Border = TRUE;
         PassWord = TRUE;
-        Pos = MAP_APPFONT( 57, 29 );
+        Pos = MAP_APPFONT( 97, 29 );
         Size = MAP_APPFONT( 75, 12 );
     };
     FixedText FT_PASSWD_CONFIRM
     {
         Pos = MAP_APPFONT( 12, 45 );
-        Size = MAP_APPFONT( 42, 10 );
+        Size = MAP_APPFONT( 82, 10 );
         Text [ en-US ] = "~Confirm";
     };
     Edit ED_PASSWD_CONFIRM
     {
         Border = TRUE;
         PassWord = TRUE;
-        Pos = MAP_APPFONT( 57, 44 );
+        Pos = MAP_APPFONT( 97, 44 );
         Size = MAP_APPFONT( 75, 12 );
     };
+    FixedLine GB_PASSWD_CHANGE_PASSWORD
+    {
+        Pos = MAP_APPFONT( 6, 3 );
+        Size = MAP_APPFONT( 132, 8 );
+        Text [ en-US ] = "Change the password" ;
+        Text [ fr ] = "Changer le mot de passe" ;
+        Text [ de ] = "Passwort ndern";
+        Text [ es ] = "Cambiar Contrasea";
+        Text [ it ] = "Cambia password";
+        Text [ nl ] = "Wachtwoord wijzigen";
+        Text [ zh-CN ] = "";
+        Text [ pt ] = "Alterar Senha";
+        Text [ fi ] = "Vaihda salasana";
+    };
+
     FixedLine GB_PASSWD_PASSWORD
     {
         Pos = MAP_APPFONT( 6, 3 );
         Size = MAP_APPFONT( 132, 8 );
         Text [ en-US ] = "Password" ;
     };
+
     OKButton BTN_PASSWD_OK
     {
         Disable = TRUE;
-        Pos = MAP_APPFONT( 144, 6 );
+        Pos = MAP_APPFONT( PUSHBUTTON_X_POS , 6 );
         Size = MAP_APPFONT( 50, 14 );
         DefButton = TRUE;
     };
     CancelButton BTN_PASSWD_CANCEL
     {
-        Pos = MAP_APPFONT( 144, 23 );
+        Pos = MAP_APPFONT( PUSHBUTTON_X_POS, 23 );
         Size = MAP_APPFONT( 50, 14 );
     };
+
     HelpButton BTN_PASSWD_HELP
     {
-        Pos = MAP_APPFONT( 144, 43 );
+        Pos = MAP_APPFONT( PUSHBUTTON_X_POS, 43 );
         Size = MAP_APPFONT( 50, 14 );
     };
+
     String STR_PASSWD_CONFIRM
     {
         Text [ en-US ] = "Confirm password" ;
     };
+    String STR_CURRENT_PASSWD_ERROR
+    {
+
+        Text [ en-US ] = "NO" ;
+
+/*
+        Text [ en-US ] = "Wrong password" ;
+        Text [ fr ] = "Mauvais mot de passe" ;
+*/
+    };
 };
 
 // ********************************************************************** EOF
diff --git sfx2/source/dialog/passwd_OOo4Kids.cxx sfx2/source/dialog/passwd_OOo4Kids.cxx
new file mode 100644
index 0000000..09438e7
--- /dev/null
+++ sfx2/source/dialog/passwd_OOo4Kids.cxx
@@ -0,0 +1,468 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2010 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: passwd_OOo4Kids.cxx,v $
+ * $Revision: 1 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_sfx2.hxx"
+
+// Include ---------------------------------------------------------------
+#include <vcl/msgbox.hxx>
+#ifndef GCC
+#endif
+
+#include <sfx2/passwd.hxx>
+#include "sfxtypes.hxx"
+#include "sfxresid.hxx"
+
+#include "dialog.hrc"
+#include "passwd.hrc"
+
+#ifdef OOo4Kids
+#include <com/sun/star/container/XContentEnumerationAccess.hpp>
+#include <com/sun/star/container/XNameAccess.hpp>
+#include <com/sun/star/container/XNameReplace.hpp>
+#include <com/sun/star/container/XHierarchicalNameAccess.hpp>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/lang/XInitialization.hpp>
+#include <com/sun/star/beans/NamedValue.hpp>
+#include <com/sun/star/beans/XPropertySet.hpp>
+#include <com/sun/star/util/XChangesBatch.hpp>
+#include <com/sun/star/uno/Any.hxx>
+#include <com/sun/star/container/XSet.hpp>
+
+
+#include <comphelper/processfactory.hxx>
+
+#include <vcl/unohelp.hxx>
+#include <com/sun/star/frame/XLayoutManager.hpp>
+#include <com/sun/star/frame/XLayoutManagerListener.hpp>
+#include <com/sun/star/frame/XLayoutManagerEventBroadcaster.hpp>
+#include <sfx2/childwin.hxx>
+#include <sfx2/viewfrm.hxx>
+
+using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star::frame;
+using namespace ::com::sun::star::lang;
+using namespace ::com::sun::star::beans;
+using namespace ::com::sun::star::container;
+using namespace ::com::sun::star::util;
+using ::rtl::OString;
+using ::rtl::OUString;
+
+// static 
+
+static const OUString sULConfigSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationProvider" ) );
+static const OUString sULAccessSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationUpdateAccess" ) );
+static const OUString sULaNode( RTL_CONSTASCII_USTRINGPARAM( "/org.openoffice.Office.Common/Misc" ) );
+static const OUString sULPropertyName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserLevel" ) ) );
+static const OUString sPrefsPasswordPropertyName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPrefsPassword" ) ) );
+#endif
+
+// -----------------------------------------------------------------------
+
+IMPL_LINK_INLINE_START( SfxPasswordDialog, EditModifyHdl, Edit *, EMPTYARG )
+{
+    if ( ( SHOWEXTRAS_CURRENT_PASSWD == mnExtras ) || ( SHOWEXTRAS_NONE_OOO4KIDS == mnExtras ) )
+        maOKBtn.Enable( maCurrentPasswordED.GetText().Len() >= mnMinLen );
+    else
+        maOKBtn.Enable( maPasswordED.GetText().Len() >= mnMinLen );
+
+    return 0;
+}
+IMPL_LINK_INLINE_END( SfxPasswordDialog, EditModifyHdl, Edit *, EMPTYARG )
+
+// -----------------------------------------------------------------------
+
+IMPL_LINK( SfxPasswordDialog, OKHdl, OKButton *, EMPTYARG )
+{
+    bPasswordEntryFailed = false;
+
+    if  ( ( ( mnExtras & SHOWEXTRAS_CURRENT_PASSWD ) == SHOWEXTRAS_CURRENT_PASSWD ) &&
+          ( ( (OUString)getUserPrefsPassword() != (OUString)GetCurrentPassword() ) )
+        )
+    {
+    bPasswordEntryFailed = true;
+    ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM /*STR_CURRENT_PASSWD_ERROR*/ ) );
+    aBox.Execute();
+    maCurrentPasswordED.SetText( String() );
+    maCurrentPasswordED.GrabFocus();
+    return 0;
+    }
+
+    if  ( ( ( mnExtras & SHOWEXTRAS_CURRENT_PASSWD ) == SHOWEXTRAS_CURRENT_PASSWD ) &&
+          ( (OUString)GetConfirm() != (OUString)GetPassword() )
+        )
+    {
+    bPasswordEntryFailed = true;
+    ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM ) );
+    aBox.Execute();
+    maConfirmED.SetText( String() );
+    maConfirmED.GrabFocus();
+    return 0;
+    }
+
+    if ( ( ( mnExtras & SHOWEXTRAS_CONFIRM ) == SHOWEXTRAS_CONFIRM ) &&
+    ( GetConfirm() != GetPassword() ) )
+    {
+    bPasswordEntryFailed = true;
+    ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM ) );
+    aBox.Execute();
+    maConfirmED.SetText( String() );
+    maConfirmED.GrabFocus();
+    }
+    if ( ( ( mnExtras & SHOWEXTRAS_NONE_OOO4KIDS ) == SHOWEXTRAS_NONE_OOO4KIDS ) &&
+        ( getUserPrefsPassword() != (OUString)GetPassword() ) )
+    {
+        bPasswordEntryFailed = true;
+        ErrorBox aBox( this, SfxResId( MSG_ERROR_WRONG_CONFIRM ) );
+        aBox.Execute();
+        maCurrentPasswordED.SetText( String() );
+        maCurrentPasswordED.GrabFocus();
+        return 0;
+    }
+
+    if  ( ( ( mnExtras & SHOWEXTRAS_CURRENT_PASSWD ) == SHOWEXTRAS_CURRENT_PASSWD ) &&
+            ( GetConfirm() == GetPassword() ) )
+    {
+        setUserPrefsPassword( (OUString)GetConfirm() );
+    }
+    EndDialog( RET_OK );
+    return 0;
+}
+
+// CTOR / DTOR -----------------------------------------------------------
+
+SfxPasswordDialog::SfxPasswordDialog( Window* pParent, const String* pGroupText ) :
+
+    ModalDialog( pParent, SfxResId ( DLG_PASSWD ) ),
+
+    maUserFT		( this, SfxResId( FT_PASSWD_USER ) ),
+    maUserED		( this, SfxResId( ED_PASSWD_USER ) ),
+#ifdef OOo4Kids
+    maCurrentPasswordFT	( this, SfxResId( FT_PREFS_CURRENT_PASSWD ) ),
+    maCurrentPasswordED	( this, SfxResId( ED_PREFS_CURRENT_PASSWD ) ),
+    maChangePasswordBox	( this, SfxResId( GB_PASSWD_CHANGE_PASSWORD ) ),
+#endif
+    maPasswordFT	( this, SfxResId( FT_PASSWD_PASSWORD ) ),
+    maPasswordED	( this, SfxResId( ED_PASSWD_PASSWORD ) ),
+    maConfirmFT		( this, SfxResId( FT_PASSWD_CONFIRM ) ),
+    maConfirmED		( this, SfxResId( ED_PASSWD_CONFIRM ) ),
+    maPasswordBox	( this, SfxResId( GB_PASSWD_PASSWORD ) ),
+    maOKBtn			( this, SfxResId( BTN_PASSWD_OK ) ),
+    maCancelBtn		( this, SfxResId( BTN_PASSWD_CANCEL ) ),
+    maHelpBtn		( this, SfxResId( BTN_PASSWD_HELP ) ),
+    maConfirmStr	( 		SfxResId( STR_PASSWD_CONFIRM ) ),
+//	maErrorCurrentStr	( 		SfxResId( STR_CURRENT_PASSWD_ERROR ) ),
+
+    mnMinLen		( 4 ),
+
+    mnExtras		( 0 )
+{
+    FreeResource();
+
+    Link aLink = LINK( this, SfxPasswordDialog, EditModifyHdl );
+    maCurrentPasswordED.SetModifyHdl( aLink );
+    maPasswordED.SetModifyHdl( aLink );
+    aLink = LINK( this, SfxPasswordDialog, OKHdl );
+    maOKBtn.SetClickHdl( aLink );
+
+    if ( pGroupText )
+    maPasswordBox.SetText( *pGroupText );
+}
+
+// -----------------------------------------------------------------------
+
+OUString SfxPasswordDialog::getUserPrefsPassword()
+{
+    OUString sPrefsPasswordContent = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "prof" ) ); // default is prof 
+    try
+    {
+        // get service provider
+        Reference< XMultiServiceFactory > xSMgr( vcl::unohelper::GetMultiServiceFactory() );
+        // create configuration hierachical access name
+        if( xSMgr.is() )
+        {
+            try
+            {
+                Reference< XMultiServiceFactory > xConfigProvider(
+                    Reference< XMultiServiceFactory >(
+                        xSMgr->createInstance( sULConfigSrvc ),
+                        UNO_QUERY )
+                    );
+                if( xConfigProvider.is() )
+                {
+                    Sequence< Any > aArgs(1);
+                    PropertyValue aVal;
+                    aVal.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "nodepath" ) );
+                    aVal.Value <<= sULaNode;
+
+                    aArgs.getArray()[0] <<= aVal;
+                    Reference< XNameAccess > xConfigAccess(
+                        Reference< XNameAccess >(
+                            xConfigProvider->createInstanceWithArguments( sULAccessSrvc, aArgs ), UNO_QUERY )
+                        );
+                    if( xConfigAccess.is() )
+                    {
+                        try
+                        {
+                            OUString bValue;// = OUString( RTL_CONSTASCII_USTRINGPARAM( "prof" ) ); //initial value
+                            Any aAny = xConfigAccess->getByName( sPrefsPasswordPropertyName );
+                            if( aAny >>= bValue )
+                                sPrefsPasswordContent = bValue;
+                        }
+                        catch( NoSuchElementException& )
+                        {
+                        }
+                        catch( WrappedTargetException& )
+                        {
+                        }
+                    }
+                }
+            }
+            catch( Exception& )
+            {
+            }
+        }
+    }
+    catch( WrappedTargetException& )
+    {
+    }
+    return sPrefsPasswordContent;
+}
+
+// -----------------------------------------------------------------------
+
+void SfxPasswordDialog::setUserPrefsPassword( OUString aPassword )
+{
+    try
+    {
+        Reference < XMultiServiceFactory > xFactory = ::comphelper::getProcessServiceFactory();
+
+        // get configuration provider
+        // use UNO_QUERY_THROW means that the current file *must* be compiled with exception support enabled
+        // and use UNO_QUERY instead, who builds without exception support enabled, will lead to crashes if 
+        // if some uno code called thrown.
+        Reference< XMultiServiceFactory > theConfigProvider = Reference< XMultiServiceFactory >(
+        xFactory->createInstance(sULConfigSrvc), UNO_QUERY_THROW /*UNO_QUERY*/ );
+
+        Sequence< Any > theArgs(1);
+        NamedValue v(OUString::createFromAscii("NodePath"),
+            makeAny(OUString::createFromAscii("org.openoffice.Office.Common/Misc")));
+        theArgs[0] <<= v;
+ 
+        Reference< XPropertySet > pset = Reference< XPropertySet >(
+            theConfigProvider->createInstanceWithArguments(sULAccessSrvc, theArgs), UNO_QUERY_THROW /*UNO_QUERY*/);
+
+        Any result = pset->getPropertyValue(OUString::createFromAscii("UserPrefsPassword"));
+
+        pset->setPropertyValue(OUString::createFromAscii("UserPrefsPassword"), makeAny(aPassword));
+        Reference< XChangesBatch >(pset, UNO_QUERY_THROW /*UNO_QUERY*/)->commitChanges();
+
+    }
+    catch( Exception& )
+    {
+    }
+}
+
+
+// -----------------------------------------------------------------------
+
+void SfxPasswordDialog::SetMinLen( USHORT nLen )
+{
+    mnMinLen = nLen;
+    EditModifyHdl( NULL );
+}
+
+// -----------------------------------------------------------------------
+
+void SfxPasswordDialog::SetMaxLen( USHORT nLen )
+{
+    maCurrentPasswordED.SetMaxTextLen( nLen );
+    maPasswordED.SetMaxTextLen( nLen );
+    maConfirmED.SetMaxTextLen( nLen );
+    EditModifyHdl( NULL );
+}
+
+// -----------------------------------------------------------------------
+
+short SfxPasswordDialog::Execute()
+{
+    if ( mnExtras < SHOWEXTRAS_ALL )
+    {
+    Size a3Size = LogicToPixel( Size( 3, 3 ), MAP_APPFONT );
+    Size a6Size = LogicToPixel( Size( 6, 6 ), MAP_APPFONT );
+    long nMinHeight = maHelpBtn.GetPosPixel().Y() + maHelpBtn.GetSizePixel().Height() + a6Size.Height();
+
+    USHORT nRowHided = 1;
+
+    if ( SHOWEXTRAS_NONE_OOO4KIDS == mnExtras )
+    {
+        maUserFT.Hide();
+        maUserED.Hide();
+        maConfirmFT.Hide();
+        maConfirmED.Hide();
+            maCurrentPasswordFT.Hide();
+            maCurrentPasswordED.Hide();
+            maChangePasswordBox.Hide();
+            
+        Point aPos = maPasswordFT.GetPosPixel();
+        long nEnd = maCurrentPasswordFT.GetPosPixel().X() + maCurrentPasswordFT.GetSizePixel().Width() + maCurrentPasswordED.GetSizePixel().Width();
+        maPasswordFT.SetPosPixel( aPos );
+        Size aSize = maPasswordED.GetSizePixel();
+        aPos = maPasswordED.GetPosPixel();
+            aSize.Width() = nEnd - aPos.X();
+        maPasswordED.SetSizePixel( aSize );
+
+        nRowHided = 3;
+    }
+
+    if ( SHOWEXTRAS_NONE == mnExtras )
+    {
+        maUserFT.Hide();
+        maUserED.Hide();
+        maConfirmFT.Hide();
+        maConfirmED.Hide();
+        maPasswordFT.Hide();
+
+        Point aPos = maUserFT.GetPosPixel();
+        long nEnd = maUserED.GetPosPixel().X() + maUserED.GetSizePixel().Width();
+        maPasswordED.SetPosPixel( aPos );
+        Size aSize = maPasswordED.GetSizePixel();
+        aSize.Width() = nEnd - aPos.X();
+        maPasswordED.SetSizePixel( aSize );
+
+        nRowHided = 2;
+    }
+    else if ( SHOWEXTRAS_CURRENT_PASSWD == mnExtras )
+    {
+        // we need to improve the heigth, because we add one entry
+            nMinHeight += maHelpBtn.GetSizePixel().Height() + a6Size.Height();
+
+            // hide the (useless) user entry
+        maUserFT.Hide();
+        maUserED.Hide();
+
+            // the current password entry will replace the user one, so we need its location
+        Point aPos = maCurrentPasswordFT.GetPosPixel();
+
+            // define its width
+        long nEnd = maCurrentPasswordFT.GetPosPixel().X() + maCurrentPasswordFT.GetSizePixel().Width() + maCurrentPasswordED.GetSizePixel().Width();
+            
+            // set the current password entry position 
+        maCurrentPasswordFT.SetPosPixel( aPos );
+
+            // define its size
+        Size aSize = maCurrentPasswordED.GetSizePixel();
+
+            // define its length
+        aSize.Width() = nEnd - aPos.X();
+
+            // Fixed Text position ( the string "enter current password" )
+        Point aCurrentPwdPos1 = maPasswordFT.GetPosPixel();
+
+            // The location of the Current Password Editor
+        Point aCurrentPwdPos2 = maPasswordED.GetPosPixel();
+
+            maPasswordFT.SetPosPixel( aCurrentPwdPos1 );
+            maPasswordED.SetPosPixel( aCurrentPwdPos2 );
+
+            // Get position for maPasswordFT and maPasswordED
+        aCurrentPwdPos1 = maPasswordFT.GetPosPixel();
+        aCurrentPwdPos2 = maPasswordED.GetPosPixel();
+
+        maPasswordFT.SetPosPixel( aCurrentPwdPos1 );
+        maPasswordED.SetPosPixel( aCurrentPwdPos2 );
+
+            // Get position for maConfirmFT and maConfirmED
+        aCurrentPwdPos1 = maConfirmFT.GetPosPixel();
+        aCurrentPwdPos2 = maConfirmED.GetPosPixel();
+
+        maConfirmFT.SetPosPixel( aCurrentPwdPos1 );
+        maConfirmED.SetPosPixel( aCurrentPwdPos2 );
+    }
+    else if ( SHOWEXTRAS_USER == mnExtras )
+    {
+        maConfirmFT.Hide();
+        maConfirmED.Hide();
+    }
+    else if ( SHOWEXTRAS_CONFIRM == mnExtras )
+    {
+        maUserFT.Hide();
+        maUserED.Hide();
+
+        Point aPwdPos1 = maPasswordFT.GetPosPixel();
+        Point aPwdPos2 = maPasswordED.GetPosPixel();
+
+        Point aPos = maUserFT.GetPosPixel();
+        maPasswordFT.SetPosPixel( aPos );
+        aPos = maUserED.GetPosPixel();
+        maPasswordED.SetPosPixel( aPos );
+
+        maConfirmFT.SetPosPixel( aPwdPos1 );
+        maConfirmED.SetPosPixel( aPwdPos2 );
+    }
+    else if ( SHOWEXTRAS_CONFIRM_OOO4KIDS == mnExtras )
+    {
+//		maUserFT.Hide();
+//		maUserED.Hide();
+
+        Point aPwdPos1 = maPasswordFT.GetPosPixel();
+        Point aPwdPos2 = maPasswordED.GetPosPixel();
+
+        Point aPos = maCurrentPasswordFT.GetPosPixel();
+        maPasswordFT.SetPosPixel( aPos );
+        aPos = maCurrentPasswordED.GetPosPixel();
+        maPasswordED.SetPosPixel( aPos );
+
+        maConfirmFT.SetPosPixel( aPwdPos1 );
+        maConfirmED.SetPosPixel( aPwdPos2 );
+    }
+
+    Size aBoxSize = maPasswordBox.GetSizePixel();
+
+        if ( ( SHOWEXTRAS_CURRENT_PASSWD == mnExtras ) || ( SHOWEXTRAS_NONE_OOO4KIDS == mnExtras ) )
+            aBoxSize.Height() -= ( nRowHided * maCurrentPasswordED.GetSizePixel().Height() );
+        else
+            aBoxSize.Height() -= ( nRowHided * maUserED.GetSizePixel().Height() );
+
+    aBoxSize.Height() -= ( nRowHided * a3Size.Height() );
+    maPasswordBox.SetSizePixel( aBoxSize );
+
+    long nDlgHeight = maPasswordBox.GetPosPixel().Y() + aBoxSize.Height() + a6Size.Height();
+
+    if ( nDlgHeight < nMinHeight )
+        nDlgHeight = nMinHeight;
+
+    Size aDlgSize = GetOutputSizePixel();
+    aDlgSize.Height() = nDlgHeight;
+    SetOutputSizePixel( aDlgSize );
+    }
+
+    return ModalDialog::Execute();
+}
diff --git sfx2/source/dialog/showlicense.cxx sfx2/source/dialog/showlicense.cxx
new file mode 100644
index 0000000..cc6290c
--- /dev/null
+++ sfx2/source/dialog/showlicense.cxx
@@ -0,0 +1,436 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ *
+ *
+ * Author : ericb 2009
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ *
+ * This file is part of OOo4Kids.
+ *
+ * Original author of the file : Eric Bachard  12 august 2009  
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 3
+ * only, as published by the Free Software Foundation, or under the GPL V2 
+ * 
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License version 2 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_sfx2.hxx"
+
+// include ---------------------------------------------------------------
+#include <aboutbmpnames.hxx>
+
+#ifndef _SV_APP_HXX
+#include <vcl/svapp.hxx>
+#endif
+#ifndef _MSGBOX_HXX //autogen
+#include <vcl/msgbox.hxx>
+#endif
+#ifndef GCC
+#endif
+
+#include <tools/stream.hxx>
+#include <tools/urlobj.hxx>
+#include <rtl/bootstrap.hxx>
+#include <unotools/configmgr.hxx>
+#include <unotools/bootstrap.hxx>
+#include <com/sun/star/uno/Any.h>
+#include <unotools/configmgr.hxx>
+
+#include <sfx2/sfxuno.hxx>
+#include "about.hxx"
+#include "showlicense.hxx"
+#include "sfxresid.hxx"
+#include <sfx2/sfxdefs.hxx>
+#include <sfx2/app.hxx>
+#include <vcl/bitmap.hxx>
+#include <vcl/pngread.hxx>
+#include <rtl/strbuf.hxx>
+#include <vcl/salnativewidgets.hxx>
+
+#include "dialog.hrc"
+
+// defines ---------------------------------------------------------------
+
+#define SCROLL_OFFSET	1
+#define SPACE_OFFSET	5
+#define SCROLL_TIMER	30
+
+#define WELCOME_URL     DEFINE_CONST_UNICODE( "http://wiki.ooo4kids.org/index.php/Teams" )
+
+#ifdef DEBUG
+const sal_Char *dbg_dump(const rtl::OString &rStr)
+{
+    static rtl::OStringBuffer aStr;
+    aStr = rtl::OStringBuffer(rStr);
+    aStr.append(static_cast<char>(0));
+    return aStr.getStr();
+}
+
+const sal_Char *dbg_dump(const rtl::OUString &rStr)
+{
+    return dbg_dump(rtl::OUStringToOString(rStr, RTL_TEXTENCODING_UTF8));
+}
+
+const sal_Char *dbg_dump(rtl_String *pStr)
+{
+    return dbg_dump(rtl::OString(pStr));
+}
+
+const sal_Char *dbg_dump(rtl_uString *pStr)
+{
+    return dbg_dump(rtl::OUString(pStr));
+}
+#endif
+
+
+// class ShowLicenseDialog -----------------------------------------------------
+static void layoutText( FixedInfo &rText, long &nY, long nTextWidth, Size a6Size )
+{
+    Point aTextPos = rText.GetPosPixel();
+    aTextPos.X() = a6Size.Width() * 2;
+    aTextPos.Y() = nY;
+    rText.SetPosPixel( aTextPos );
+
+    Size aTxtSiz = rText.GetSizePixel();
+    aTxtSiz.Width() = nTextWidth;
+    Size aCalcSize = rText.CalcMinimumSize( nTextWidth );
+    aTxtSiz.Height() = aCalcSize.Height();
+    rText.SetSizePixel( aTxtSiz );
+
+    nY += aTxtSiz.Height();
+}
+
+static bool impl_loadPng(
+    const rtl::OUString &rPath, const rtl::OUString &rBmpFileName
+    , Image &rLogo )
+{
+
+    if ( rBmpFileName.getLength() == 0 )
+        return false;
+
+    rtl::OUString uri( rPath );
+    rtl::Bootstrap::expandMacros( uri );
+    INetURLObject aObj( uri );
+    aObj.insertName( rBmpFileName );
+
+    if (aObj.PathToFileName().endsWithAsciiL(RTL_CONSTASCII_STRINGPARAM(".png")))
+    {
+        SvFileStream pStream( aObj.PathToFileName(), STREAM_STD_READ );
+        pStream.Open( aObj.PathToFileName(), STREAM_STD_READ  );
+        if ( pStream.GetError() )
+            return false;
+        else
+        {
+            BitmapEx aPng = vcl::PNGReader(pStream).Read();
+            rLogo = Image( aPng );
+            // avoid leaks ...
+            pStream.Close();
+        }
+        return true;
+    }
+    else
+        return false;
+}
+
+
+ShowLicenseDialog::ShowLicenseDialog( Window* pParent, const ResId& rId, const String& rVerStr ) :
+
+    SfxModalDialog	( pParent, 	rId ),
+
+    aOKButton      	( this,		ResId( LICENSE_BTN_OK, *rId.GetResMgr() ) ),
+    aVersionText 	( this, 	ResId( LICENSE_FTXT_VERSION, *rId.GetResMgr() ) ),
+    aCopyrightText	( this, 	ResId( LICENSE_FTXT_COPYRIGHT, *rId.GetResMgr() ) ),
+    aBuildData      ( this ),
+        aDeveloperAry   (                       ResId( LICENSE_STR_DEVELOPER_ARY, *rId.GetResMgr() ) ),
+    aDevVersionStr	( rVerStr ),
+    aAccelStr		( 			ResId( LICENSE_STR_ACCEL, *rId.GetResMgr() ) ),
+    aTimer          (),
+    nOff            ( 0 ),
+    m_nDeltaWidth   ( 0 ),
+    m_nPendingScrolls( 0 ),
+    bNormal         ( TRUE )
+{
+    rtl::OUString sProduct;
+    utl::ConfigManager::GetDirectConfigProperty(utl::ConfigManager::PRODUCTNAME) >>= sProduct;
+
+    bool bLoaded = false;
+
+    // load image from module path
+    rtl::OUString aAbouts( RTL_CONSTASCII_USTRINGPARAM( ABOUT_BITMAP_STRINGLIST ) );
+//    sal_Int32 nIndex = 0;
+
+    if ( !bLoaded )
+    {
+    bLoaded = impl_loadPng(
+    rtl::OUString::createFromAscii( "$BRAND_BASE_DIR/program" ),
+    rtl::OUString::createFromAscii( "about.png" ), aAppLogo);
+    }
+
+    // Transparenter Font
+    Font aFont = GetFont();
+    aFont.SetTransparent( TRUE );
+    SetFont( aFont );
+
+    // if necessary more info
+    String sVersion = aVersionText.GetText();
+    sVersion.SearchAndReplaceAscii( "$(VER)", Application::GetDisplayName() );
+    sVersion += '\n';
+    sVersion += rVerStr;
+    aVersionText.SetText( sVersion );
+
+    // Initialisierung fuer Aufruf Entwickler
+    if ( aAccelStr.Len() && ByteString(U2S(aAccelStr)).IsAlphaAscii() )
+    {
+        Accelerator	*pAccel = 0, *pPrevAccel = 0, *pFirstAccel = 0;
+        aAccelStr.ToUpperAscii();
+
+        for ( USHORT i = 0; i < aAccelStr.Len(); ++i )
+        {
+            pPrevAccel = pAccel;
+            pAccel = new Accelerator;
+            aAccelList.Insert( pAccel, LIST_APPEND );
+            USHORT nKey = aAccelStr.GetChar(i) - 'A' + KEY_A;
+            pAccel->InsertItem( 1, KeyCode( nKey, KEY_MOD1 ) );
+            if ( i > 0 )
+                pPrevAccel->SetAccel( 1, pAccel );
+            if ( i == 0 )
+                pFirstAccel = pAccel;
+        }
+        pAccel->SetSelectHdl( LINK( this, ShowLicenseDialog, AccelSelectHdl ) );
+        GetpApp()->InsertAccel( pFirstAccel );
+    }
+
+    // set for background and text the correct system color
+    const StyleSettings& rSettings = GetSettings().GetStyleSettings();
+    Color aWhiteCol( rSettings.GetWindowColor() );
+    Wallpaper aWall( aWhiteCol );
+    SetBackground( aWall );
+    Font aNewFont( aCopyrightText.GetFont() );
+    aNewFont.SetTransparent( TRUE );
+
+    aVersionText.SetFont( aNewFont );
+    aCopyrightText.SetFont( aNewFont );
+
+    aVersionText.SetBackground();
+    aCopyrightText.SetBackground();
+
+    Color aTextColor( rSettings.GetWindowTextColor() );
+    aVersionText.SetControlForeground( aTextColor );
+    aCopyrightText.SetControlForeground( aTextColor );
+    aBuildData.SetBackground( aWall );
+
+    Font aSmallFont = rSettings.GetInfoFont();
+    Size aSmaller = aNewFont.GetSize();
+    aSmaller.Width() = (long) (aSmaller.Width() * 0.75);
+    aSmaller.Height() = (long) (aSmaller.Height() * 0.75);
+    aNewFont.SetSize( aSmaller );
+    aBuildData.SetFont( aNewFont );
+    aBuildData.SetBackground( aWall );
+#ifdef BUILD_VER_STRING
+    String aBuildString( DEFINE_CONST_UNICODE( BUILD_VER_STRING ) );
+#else
+    String aBuildString;
+#endif
+    aBuildData.SetText( aBuildString );
+    aBuildData.Show();
+
+    // determine size and position of the dialog & elements
+    Size aAppLogoSiz = aAppLogo.GetSizePixel();
+    Size aOutSiz = GetOutputSizePixel();
+    aOutSiz.Width() = aAppLogoSiz.Width();
+
+    // spacing to the margin
+    Size a6Size = aVersionText.LogicToPixel( Size( 6, 6 ), MAP_APPFONT );
+    long nDlgMargin = a6Size.Width() * 4 ;
+
+    // The URL (if found in copyright text) should not be line-wrapped
+    if ( aCopyrightText.GetText().Search( WELCOME_URL ) != STRING_NOTFOUND )
+    {
+        long nURLWidth = GetTextWidth( WELCOME_URL ) + nDlgMargin + (2*SPACE_OFFSET);
+        if ( nURLWidth > aAppLogoSiz.Width() )
+        {
+            // pb: can be used to align the position of the logo
+            // m_nDeltaWidth = nURLWidth - aOutSiz.Width();
+
+            aOutSiz.Width() = nURLWidth;
+        }
+    }
+
+    // layout the text-elements
+    long nTextWidth = aOutSiz.Width() - nDlgMargin;
+    long nY = aAppLogoSiz.Height() + ( a6Size.Height() * 2 );
+
+    layoutText( aVersionText, nY, nTextWidth, a6Size );
+    nY += ( a6Size.Height() / 3 );
+    layoutText( aCopyrightText, nY, nTextWidth, a6Size );
+    nY += ( a6Size.Height() / 3 );
+    if( aBuildString.Len() > 0 )
+    {
+        layoutText( aBuildData, nY, nTextWidth, a6Size );
+        nY += ( a6Size.Height() / 2 );
+    }
+
+    // OK-Button-Position (at the bottom and centered)
+    Size aOKSiz = aOKButton.GetSizePixel();
+    Point aOKPnt = aOKButton.GetPosPixel();
+    aOKPnt.X() = ( aOutSiz.Width() - aOKSiz.Width() ) / 2;
+    aOKPnt.Y() = nY + 8;
+    aOKButton.SetPosPixel( aOKPnt );
+    nY = aOKPnt.Y() + aOKSiz.Height() + a6Size.Height();
+    aOutSiz.Height() = nY;
+    SetOutputSizePixel( aOutSiz );
+
+    FreeResource();
+
+    // explizite Help-Id
+    SetHelpId( SID_LICENSE );
+
+}
+
+// -----------------------------------------------------------------------
+
+ShowLicenseDialog::~ShowLicenseDialog()
+{
+    // L"oschen des Entwickleraufrufs
+    if ( aAccelList.Count() )
+    {
+        GetpApp()->RemoveAccel( aAccelList.First() );
+        Accelerator* pAccel = aAccelList.Last();
+
+        while ( pAccel )
+        {
+            delete pAccel;
+            pAccel = aAccelList.Prev();
+        }
+    }
+}
+
+// -----------------------------------------------------------------------
+
+IMPL_LINK( ShowLicenseDialog, TimerHdl, Timer *, pTimer )
+{
+    (void)pTimer; //unused
+    ++m_nPendingScrolls;
+    Invalidate( INVALIDATE_NOERASE | INVALIDATE_NOCHILDREN );
+    return 0;
+}
+
+// -----------------------------------------------------------------------
+
+IMPL_LINK( ShowLicenseDialog, AccelSelectHdl, Accelerator *, pAccelerator )
+{
+    (void)pAccelerator; //unused
+    // init Timer
+    aTimer.SetTimeoutHdl( LINK( this, ShowLicenseDialog, TimerHdl ) );
+
+    // init scroll mode
+    nOff = GetOutputSizePixel().Height();
+    MapMode aMapMode( MAP_PIXEL );
+    SetMapMode( aMapMode );
+    bNormal = FALSE;
+
+    // start scroll Timer
+    aTimer.SetTimeout( SCROLL_TIMER );
+    aTimer.Start();
+    return 0;
+}
+
+// -----------------------------------------------------------------------
+
+BOOL ShowLicenseDialog::Close()
+{
+    // stop Timer and finish the dialog
+    aTimer.Stop();
+    EndDialog( RET_OK );
+    return( FALSE );
+}
+
+// -----------------------------------------------------------------------
+
+void ShowLicenseDialog::Paint( const Rectangle& rRect )
+{
+    SetClipRegion( rRect );
+
+    if ( bNormal ) // not in scroll mode
+    {
+ 	    Size aSize = aAppLogo.GetBitmapEx().GetSizePixel();
+        Point aPos( m_nDeltaWidth / 2, 0 );
+        // other possibility: 
+        //OutputDevice::DrawBitmapEx( aPos, aAppLogo.GetBitmapEx() );
+        DrawImage( aPos, aAppLogo );
+        return;
+    }
+
+    // scroll the content
+    const int nDeltaY = -SCROLL_OFFSET * m_nPendingScrolls;
+    if( !nDeltaY )
+        return;
+    nOff += nDeltaY;
+    Scroll( 0, nDeltaY, SCROLL_NOERASE );
+    m_nPendingScrolls = 0;
+
+    // draw the credits text
+    const Font aOrigFont = GetFont();
+    const int nFullWidth = GetOutputSizePixel().Width();
+
+    int nY = nOff;
+    const int nDevCnt = static_cast<int>( aDeveloperAry.Count() );
+    for( int i = 0; i < nDevCnt; ++i )
+    {
+        if( nY >= rRect.Bottom() )
+            break;
+
+        int nPos2 = nY + GetTextHeight() + 3;
+        if( nPos2 >= rRect.Top() + nDeltaY )
+        {
+            const String aStr = aDeveloperAry.GetString(i);
+            const long nVal = aDeveloperAry.GetValue(i);
+
+            if ( nVal )
+            {
+                // emphasize the headers
+                Font aFont = aOrigFont;
+                aFont.SetWeight( (FontWeight)nVal );
+                SetFont( aFont );
+                nPos2 = nY + GetTextHeight() + 3;
+            }
+
+            // clear text background
+            Rectangle aEraseRect( Point(0,nY), Size( nFullWidth, nPos2-nY));
+            Erase( aEraseRect );
+
+            // draw centered text
+            const long nTextWidth = GetTextWidth( aStr );
+            long nX = (nFullWidth - 5 - nTextWidth) / 2;
+            if( nX < 0 )
+                nX = SPACE_OFFSET;
+            const Point aPnt( nX, nY );
+            DrawText( aPnt, aStr );
+
+            // restore the font if needed
+            if( nVal )
+                SetFont( aOrigFont );
+        }
+        nY = nPos2;
+    }
+
+    // close dialog if the whole text has been scrolled
+    if ( nY <= 0 )
+    {
+        bNormal = TRUE;
+        Close();
+    }
+}
diff --git sfx2/source/doc/sfxbasemodel.cxx sfx2/source/doc/sfxbasemodel.cxx
index 25d2d96..ba64f5b 100644
--- sfx2/source/doc/sfxbasemodel.cxx
+++ sfx2/source/doc/sfxbasemodel.cxx
@@ -1879,8 +1879,18 @@ void SAL_CALL SfxBaseModel::load(   const uno::Sequence< beans::PropertyValue >&
         if ( !nError )
             nError = pMedium->GetError();
 
-        m_pData->m_pObjectShell->ResetError();
-
+        m_pData->m_pObjectShell->ResetError(); // void SfxObjectShell::ResetError() objmisc.cxx:295
+#ifdef OOo4Kids
+    // FIXME
+    // I don't have figured out yet why SfxObjectShell::ResetError(),
+    // itself calling SvStream::ResetError(), means nError should become SVStreamOK == 0,
+    // does not really reset nError.
+    // Instead, nError == 2147942472 value (equals 0x80070048 in hexa) is returned, what
+    // causes a "General Error" without a real error (loading and saving the doc)
+    // to avoid hidding other error values, we only protected the well known one
+    if (nError == 0x80070048 ) // see tools/inc/tools/errcode.hxx for the value computation
+            nError = SVSTREAM_OK;
+#endif
         if ( nError )
         {
             BOOL bSilent = FALSE;
@@ -2837,7 +2847,17 @@ void SfxBaseModel::impl_store(  const   ::rtl::OUString&                   sURL
             nErrCode = ERRCODE_IO_CANTWRITE;
         }
         m_pData->m_pObjectShell->ResetError();
-
+#ifdef OOo4Kids
+    // FIXME
+    // I don't have figured out yet why SfxObjectShell::ResetError(),
+    // itself calling SvStream::ResetError(), means nError should become SVStreamOK == 0,
+    // does not really reset nErrCode.
+    // Instead, nErrCode == 2147942472 value (equals 0x80070048 in hexa) is returned, what
+    // causes a "General Error" without a real error (loading and saving the doc)
+    // to avoid hidding other error values, we only protected the well known one
+    if (nErrCode == 0x80070048 ) // see tools/inc/tools/errcode.hxx for the value computation
+            nErrCode = SVSTREAM_OK;
+#endif
         if ( bRet )
         {
             if ( nErrCode )
@@ -3583,6 +3603,17 @@ void SAL_CALL SfxBaseModel::storeToStorage( const uno::Reference< XSTORAGE >& xS
 
     sal_uInt32 nError = m_pData->m_pObjectShell->GetErrorCode();
     m_pData->m_pObjectShell->ResetError();
+#ifdef OOo4Kids
+    // FIXME
+    // I don't have figured out yet why SfxObjectShell::ResetError(),
+    // itself calling SvStream::ResetError(), means nError should become SVStreamOK == 0,
+    // does not really reset nError.
+    // Instead, nError == 2147942472 value (equals 0x80070048 in hexa) is returned, what
+    // causes a "General Error" without a real error (loading and saving the doc)
+    // to avoid hidding other error values, we only protected the well known one
+    if (nError == 0x80070048 ) // see tools/inc/tools/errcode.hxx for the value computation
+            nError = SVSTREAM_OK;
+#endif
 
     // the warnings are currently not transported
     if ( !bSuccess )
diff --git sfx2/util/makefile.mk sfx2/util/makefile.mk
index 10b70b1..7861cfb 100644
--- sfx2/util/makefile.mk
+++ sfx2/util/makefile.mk
@@ -44,6 +44,10 @@ USE_DEFFILE=TRUE
 .INCLUDE :  settings.mk
 .INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
+.IF "$(OOo4Kids)"=="YES"
+RSCDEFS+=-DOOo4Kids
+.ENDIF
+
 # --- Allgemein ----------------------------------------------------
 
 LIB1TARGET= $(SLB)$/$(TARGET).lib
diff --git shell/source/unix/misc/senddoc.sh shell/source/unix/misc/senddoc.sh
index 83724d3..f5df0b9 100644
--- shell/source/unix/misc/senddoc.sh
+++ shell/source/unix/misc/senddoc.sh
@@ -327,7 +327,38 @@ case `basename "$MAILER" | sed 's/-.*$//'` in
          ${MAILER} ${TO:+--compose} "${TO:-}" ${ATTACH:+--attach} "${ATTACH:-}"
         ;;
 
-    Mail | Thunderbird | *.app )
+    Thunderbird )
+
+        # special case for Thunderbird, who must be found before *.app
+
+        while [ "$1" != "" ]; do
+            case $1 in
+            --attach)
+                #i95688# fix filenames containing accented chars, whatever alien
+                ATTACH="${ATTACH:-}${ATTACH:+ }"`echo "attachment=file://$2" | ${URI_ENCODE}`
+                shift
+                ;;
+            *)
+                ;;
+            esac
+            shift;
+        done
+
+        # Thunderbird is not able to compose a new mail when there is a session already
+        # see : https://bugzilla.mozilla.org/show_bug.cgi?id=287345 
+        # and : https://bugzilla.mozilla.org/show_bug.cgi?id=424155
+        # uggly hack :remove the .parentlock 
+        # DISCLAIMER : remove the .parentlock is not a good idea .. you are warned :)
+        # MY_USERPREFS_DIR="`echo /Users/\`whoami\`/Library/Thunderbird/Profiles/*.default`"
+        # MY_LOCK_FILE="${MY_USERPREFS_DIR}/.parentlock"
+        # rm -f ${MY_LOCK_FILE}
+        # echo -e ".parentlock is : ${MY_LOCK_FILE} \n"
+
+        # yet another hack : we suppose Thunderbird is in /Applications (should be the case normally)
+        /Applications/Thunderbird.app/Contents/MacOS/thunderbird-bin -compose ${ATTACH} &
+        ;;
+
+    Mail | *.app )
 
         while [ "$1" != "" ]; do
             case $1 in
diff --git shell/source/unix/sysshell/systemshell.cxx shell/source/unix/sysshell/systemshell.cxx
new file mode 100644
index 0000000..3698d04
--- /dev/null
+++ shell/source/unix/sysshell/systemshell.cxx
@@ -0,0 +1,151 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: systemshell.cxx,v $
+ * $Revision: 1.9 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_shell.hxx"
+#include "systemshell.hxx"
+
+#include <comphelper/processfactory.hxx>
+
+#ifndef _COM_SUN_STAR_BEANS_XPROPERTYSET_Hpp_
+#include <com/sun/star/beans/XPropertySet.hpp>
+#endif
+#include <com/sun/star/lang/XMultiServiceFactory.hpp>
+#include <com/sun/star/uri/XExternalUriReferenceTranslator.hpp>
+#include <com/sun/star/uri/ExternalUriReferenceTranslator.hpp>
+#include <com/sun/star/uno/XComponentContext.hpp>
+
+#include "osl/module.hxx"
+
+using namespace ::com::sun::star;
+
+#define UNISTRING(s) rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(s))
+
+const rtl::OUString SYM_ADD_TO_RECENTLY_USED_FILE_LIST = UNISTRING("add_to_recently_used_file_list");
+const rtl::OUString LIB_RECENT_FILE = UNISTRING("librecentfile.so");
+const rtl::OUString DEFAULT_CONTEXT = UNISTRING("DefaultContext");
+
+void * (* sym_gtk_recent_manager_get_default) () = NULL;
+void   (* sym_gtk_recent_manager_add_item) (void *, const char *) = NULL;
+
+// We need to re-encode file urls because osl_getFileURLFromSystemPath converts
+// to UTF-8 before encoding non ascii characters, which is not what other apps expect.
+static rtl::OUString translateToExternalUrl(const rtl::OUString& internalUrl)
+{
+    rtl::OUString extUrl;
+        
+    uno::Reference< lang::XMultiServiceFactory > sm = comphelper::getProcessServiceFactory();
+    if (sm.is())
+    {
+        uno::Reference< beans::XPropertySet > pset;
+        sm->queryInterface( getCppuType( &pset )) >>= pset;
+        if (pset.is())
+        {
+            uno::Reference< uno::XComponentContext > context;
+            pset->getPropertyValue(DEFAULT_CONTEXT) >>= context;
+            if (context.is())
+                extUrl = uri::ExternalUriReferenceTranslator::create(context)->translateToExternal(internalUrl);
+        }
+    }
+    return extUrl;
+}
+
+namespace SystemShell {
+    
+    typedef void (*PFUNC_ADD_TO_RECENTLY_USED_LIST)(const rtl::OUString&, const rtl::OUString&);
+        
+    //##############################
+    rtl::OUString get_absolute_library_url(const rtl::OUString& /*lib_name*/)
+    {
+        rtl::OUString url;
+        if (osl::Module::getUrlFromAddress(reinterpret_cast<oslGenericFunction>(AddToRecentDocumentList), url))
+        {        
+            sal_Int32 index = url.lastIndexOf('/');
+            url = url.copy(0, index + 1);
+            url += LIB_RECENT_FILE;
+        }
+        return url;
+    }
+    
+    bool init_recent_manager_api()
+    {
+        oslModule hDefault;
+        if( osl_getModuleHandle( NULL, &hDefault ) )
+        {
+            sym_gtk_recent_manager_get_default = (void * (*)())
+                osl_getAsciiFunctionSymbol(hDefault, "gtk_recent_manager_get_default");
+            sym_gtk_recent_manager_add_item = (void (*)(void *, const char *)) 
+                osl_getAsciiFunctionSymbol(hDefault, "gtk_recent_manager_add_item");
+            
+        }
+        bool ret = (NULL != sym_gtk_recent_manager_get_default) && (NULL != sym_gtk_recent_manager_add_item);
+        return ret;
+    }
+            
+    
+    //##############################
+    void AddToRecentDocumentList(const rtl::OUString& aFileUrl, const rtl::OUString& aMimeType)
+    {
+        static bool bIsRecentManagerPresent = init_recent_manager_api();
+        
+        // Convert file URL for external use (see above)
+        rtl::OUString externalUrl = translateToExternalUrl(aFileUrl);
+        if( 0 == externalUrl.getLength() )
+            externalUrl = aFileUrl;
+        
+        if( bIsRecentManagerPresent )
+        {
+            void * recent_manager = sym_gtk_recent_manager_get_default();
+            sym_gtk_recent_manager_add_item(recent_manager, rtl::OUStringToOString(aFileUrl, RTL_TEXTENCODING_UTF8).getStr());
+        }
+        else
+        {
+            rtl::OUString librecentfile_url = get_absolute_library_url(LIB_RECENT_FILE);
+        
+            if (librecentfile_url.getLength())
+            {
+                osl::Module module(librecentfile_url);
+
+                if (module.is())
+                {
+                    // convert from reinterpret_cast<PFUNC_ADD_TO_RECENTLY_USED_LIST>
+                    // not allowed in gcc 3.3 without permissive.
+                    PFUNC_ADD_TO_RECENTLY_USED_LIST add_to_recently_used_file_list = 
+                        reinterpret_cast<PFUNC_ADD_TO_RECENTLY_USED_LIST>(module.getFunctionSymbol(SYM_ADD_TO_RECENTLY_USED_FILE_LIST));
+                
+                    if (add_to_recently_used_file_list)
+                        add_to_recently_used_file_list(aFileUrl, aMimeType);
+                }
+            }
+        }        
+    }
+    
+} // namespace SystemShell
+
diff --git slideshow/prj/build.lst slideshow/prj/build.lst
index ec0cf8c..83d902a 100644
--- slideshow/prj/build.lst
+++ slideshow/prj/build.lst
@@ -4,7 +4,9 @@ pe	slideshow\inc							nmake	-	all	pe_inc NULL
 pe	slideshow\source\engine					nmake	-	all	pe_engine pe_inc NULL
 pe	slideshow\source\engine\slide			nmake	-	all	pe_slide pe_inc NULL
 pe	slideshow\source\engine\shapes			nmake	-	all	pe_shapes pe_inc NULL
-pe  slideshow\source\engine\OGLTrans        nmake   -   u pe_ogltrans pe_inc NULL
+pe	slideshow\source\engine\OGLTrans\unx        nmake   -   u pe_ogltrans_unx pe_inc NULL
+pe	slideshow\source\engine\OGLTrans\win        nmake   -   w pe_ogltrans_win pe_inc NULL
+pe	slideshow\source\engine\OGLTrans\mac        nmake   -   u pe_ogltrans_mac pe_inc NULL
 pe	slideshow\source\engine\transitions		nmake	-	all	pe_transitions pe_inc NULL
 pe	slideshow\source\engine\animationnodes	nmake	-	all	pe_animationnodes pe_inc NULL
 pe	slideshow\source\engine\activities		nmake	-	all	pe_activities pe_inc NULL
diff --git slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.cxx slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.cxx
deleted file mode 100644
index de63a1b..0000000
--- slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.cxx
+++ /dev/null
@@ -1,1318 +0,0 @@
-/*************************************************************************
- *
- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
- * 
- * Copyright 2008 by Sun Microsystems, Inc.
- *
- * OpenOffice.org - a multi-platform office productivity suite
- *
- * $RCSfile: OGLTrans_TransitionImpl.cxx,v $
- * $Revision: 1.5 $
- *
- * This file is part of OpenOffice.org.
- *
- * OpenOffice.org is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Lesser General Public License version 3
- * only, as published by the Free Software Foundation.
- *
- * OpenOffice.org is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Lesser General Public License version 3 for more details
- * (a copy is included in the LICENSE file that accompanied this code).
- *
- * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
- * for a copy of the LGPLv3 License.
- *
- ************************************************************************/
-
-#include "OGLTrans_TransitionImpl.hxx"
-#include "OGLTrans_Shaders.hxx"
-#include <GL/gl.h>
-#include <math.h>
-
-
-void OGLTransitionImpl::clear()
-{
-    for(unsigned int i( 0 ); i < OverallOperations.size(); ++i)
-        delete OverallOperations[i];
-    OverallOperations.clear();
-    maLeavingSlidePrimitives.clear();
-    maEnteringSlidePrimitives.clear();
-    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
-        delete maSceneObjects[i];
-    maSceneObjects.clear();
-
-    mbReflectSlides = false;
-
-#ifdef GL_VERSION_2_0
-    if( mProgramObject ) {
-        OGLShaders::glDeleteProgram( mProgramObject );
-        mProgramObject = 0;
-    }
-
-    if( mVertexObject ) {
-        OGLShaders::glDeleteShader( mVertexObject );
-        mVertexObject = 0;
-    }
-
-    if( mFragmentObject ) {
-        OGLShaders::glDeleteShader( mFragmentObject );
-        mFragmentObject = 0;
-    }
-#endif
-
-    if( maHelperTexture ) {
-        glDeleteTextures( 1, &maHelperTexture );
-        maHelperTexture = 0;
-    }
-
-    if( mmClearTransition )
-        (this->*mmClearTransition)();
-}
-
-OGLTransitionImpl::~OGLTransitionImpl()
-{
-    clear();
-}
-
-void OGLTransitionImpl::prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex )
-{
-    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
-        maSceneObjects[i]->prepare();
-    }
-
-    if( mmPrepareTransition )
-        (this->*mmPrepareTransition)( glLeavingSlideTex, glEnteringSlideTex );
-}
-
-void OGLTransitionImpl::finish()
-{
-    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
-        maSceneObjects[i]->finish();
-    }
-}
-
-static void blendSlide( double depth )
-{
-    double showHeight = -1 + depth*2;
-    GLfloat reflectionColor[] = {0, 0, 0, 0.25};
-
-    glDisable( GL_DEPTH_TEST );
-    glBegin( GL_QUADS );
-    glColor4fv( reflectionColor );
-    glVertex3f( -1, -1, 0 );
-    glColor4f( 0, 0, 0, 1 );
-    glVertex3f(-1,  showHeight, 0 );
-    glVertex3f( 1,  showHeight, 0 );
-    glColor4fv( reflectionColor );
-    glVertex3f( 1, -1, 0 );
-    glEnd();
-
-    glBegin( GL_QUADS );
-    glColor4f( 0, 0, 0, 1 );
-    glVertex3f( -1, showHeight, 0 );
-    glVertex3f( -1,  1, 0 );
-    glVertex3f(  1,  1, 0 );
-    glVertex3f(  1, showHeight, 0 );
-    glEnd();
-    glEnable( GL_DEPTH_TEST );
-}
-
-static void slideShadow( double nTime, Primitive& primitive, double sw, double sh )
-{
-    double reflectionDepth = 0.3;
-
-    glEnable(GL_BLEND);
-    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-    glDisable(GL_LIGHTING);
-
-    glPushMatrix();
-    primitive.applyOperations( nTime, sw, sh );
-    blendSlide( reflectionDepth );
-    glPopMatrix();
-
-    glDisable(GL_BLEND);
-    glEnable(GL_LIGHTING);
-}
-
-void OGLTransitionImpl::display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
-                                 double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
-{
-    double SlideWidthScale, SlideHeightScale;
-
-    SlideWidthScale = SlideWidth/DispWidth;
-    SlideHeightScale = SlideHeight/DispHeight;
-
-    if( mmPrepare ) {
-        clear();
-        (this->*mmPrepare)( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
-    }
-
-    glPushMatrix();
-    displaySlides( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
-    displayScene( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
-    glPopMatrix();
-}
-
-void OGLTransitionImpl::applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale )
-{
-    for(unsigned int i(0); i < OverallOperations.size(); ++i)
-        OverallOperations[i]->interpolate(nTime,SlideWidthScale,SlideHeightScale);
-}
-
-void OGLTransitionImpl::displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives,
-                                      double SlideWidthScale, double SlideHeightScale )
-{
-   //TODO change to foreach
-    glBindTexture(GL_TEXTURE_2D, glSlideTex);
-
-    // display slide reflection
-    // note that depth test is turned off while blending the shadow
-    // so the slides has to be rendered in right order, see rochade as example
-    if( mbReflectSlides ) {
-        double surfaceLevel = -0.04;
-
-        /* reflected slides */
-        glPushMatrix();
-
-        glScaled( 1, -1, 1 );
-        glTranslated( 0, 2 - surfaceLevel, 0 );
-
-        glCullFace(GL_FRONT);
-    for(unsigned int i(0); i < primitives.size(); ++i)
-        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
-        glCullFace(GL_BACK);
-
-    slideShadow( nTime, primitives[0], SlideWidthScale, SlideHeightScale );
-
-        glPopMatrix();
-    }
-
-    for(unsigned int i(0); i < primitives.size(); ++i)
-        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
-}
-
-void OGLTransitionImpl::displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
-                                       double SlideWidthScale, double SlideHeightScale )
-{
-    if( mmDisplaySlides )
-        (this->*mmDisplaySlides)( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
-    else {
-        applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
-
-        glEnable(GL_TEXTURE_2D);
-        displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
-        displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    }
-}
-
-void OGLTransitionImpl::displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
-{
-    glEnable(GL_TEXTURE_2D);
-    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
-        maSceneObjects[i]->display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
-}
-
-void Primitive::display(double nTime, double WidthScale, double HeightScale)
-{
-    glPushMatrix();
-
-    applyOperations( nTime, WidthScale, HeightScale );
-
-    glEnableClientState( GL_VERTEX_ARRAY );
-    if(!Normals.empty())
-    {
-        glNormalPointer( GL_DOUBLE , 0 , &Normals[0] );
-        glEnableClientState( GL_NORMAL_ARRAY );
-    }
-    glEnableClientState( GL_TEXTURE_COORD_ARRAY );
-    glTexCoordPointer( 2, GL_DOUBLE, 0, &TexCoords[0] );
-    glVertexPointer( 3, GL_DOUBLE, 0, &Vertices[0] );
-    glDrawArrays( GL_TRIANGLES, 0, Vertices.size() );
-    glPopMatrix();
-}
-
-void Primitive::applyOperations(double nTime, double WidthScale, double HeightScale)
-{
-    for(unsigned int i(0); i < Operations.size(); ++i)
-        Operations[i]->interpolate( nTime ,WidthScale,HeightScale);
-    glScaled(WidthScale,HeightScale,1);
-}
-
-Primitive::~Primitive()
-{
-    for(unsigned int i( 0 ); i < Operations.size(); ++i)
-        delete Operations[i];
-}
-
-
-void SceneObject::display(double nTime, double /* SlideWidth */, double /* SlideHeight */, double DispWidth, double DispHeight )
-{
-    for(unsigned int i(0); i < maPrimitives.size(); ++i) {
-        // fixme: allow various model spaces, now we make it so that
-        // it is regular -1,-1 to 1,1, where the whole display fits in
-        glPushMatrix();
-        if (DispHeight > DispWidth)
-            glScaled(DispHeight/DispWidth, 1, 1);
-        else
-            glScaled(1, DispWidth/DispHeight, 1);
-        maPrimitives[i].display(nTime, 1, 1);
-        glPopMatrix();
-    }
-}
-
-void SceneObject::pushPrimitive(const Primitive &p)
-{
-    maPrimitives.push_back(p);
-}
-
-SceneObject::SceneObject()
-    : maPrimitives()
-{
-}
-
-Iris::Iris()
-    : SceneObject ()
-{
-}
-
-void Iris::display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
-{
-    glBindTexture(GL_TEXTURE_2D, maTexture);
-    SceneObject::display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
-}
-
-void Iris::prepare()
-{
-    static GLubyte img[3] = { 80, 80, 80 };
-    
-    glGenTextures(1, &maTexture);
-    glBindTexture(GL_TEXTURE_2D, maTexture);
-    glTexImage2D(GL_TEXTURE_2D, 0, 3, 1, 1, 0, GL_RGB, GL_UNSIGNED_BYTE, img);
-    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
-    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
-    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
-    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
-}
-
-void Iris::finish()
-{
-    glDeleteTextures(1, &maTexture);
-}
-
-void OGLTransitionImpl::makeOutsideCubeFaceToLeft()
-{
-    clear();
-    Primitive Slide;
-    
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),90,false,0.0,1.0));
-
-    maEnteringSlidePrimitives.push_back(Slide);
-
-    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),-90,true,0.0,1.0));
-}
-
-void OGLTransitionImpl::makeInsideCubeFaceToLeft()
-{
-    clear();
-    Primitive Slide;
-    
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),-90,false,0.0,1.0));
-
-    maEnteringSlidePrimitives.push_back(Slide);
-    
-    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),90,true,0.0,1.0));
-}
-
-void OGLTransitionImpl::makeFallLeaving()
-{
-    clear();
-    Primitive Slide;
-    
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-    maEnteringSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(1,0,0),basegfx::B3DVector(0,-1,0), 90,true,0.0,1.0));
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    mbUseMipMapEntering = false;
-}
-
-void OGLTransitionImpl::makeTurnAround()
-{
-    clear();
-    Primitive Slide;
-
-    mbReflectSlides = true;
-    
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0),-180,false,0.0,1.0));
-    maEnteringSlidePrimitives.push_back(Slide);
-
-    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, -1.5),true, 0, 0.5));
-    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1.5), true, 0.5, 1));
-    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0),basegfx::B3DVector(0, 0, 0), -180, true, 0.0, 1.0));
-}
-
-void OGLTransitionImpl::makeTurnDown()
-{
-    clear();
-    Primitive Slide;
-    
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 0.0001), false, -1.0, 0.0));
-    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), -90, true, 0.0, 1.0));
-    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), 90, false, -1.0, 0.0));
-    maEnteringSlidePrimitives.push_back(Slide);
-
-    mbUseMipMapLeaving = false;
-}
-
-void OGLTransitionImpl::makeIris()
-{
-    clear();
-    Primitive Slide;
-    
-    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
-    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
-    maEnteringSlidePrimitives.push_back (Slide);
-
-    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0,  0.000001), false, -1, 0));
-    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, -0.000002), false, 0.5, 1));
-    maLeavingSlidePrimitives.push_back (Slide);
-
-
-    Primitive irisPart, part;
-    int i, nSteps = 24, nParts = 7;
-    double lt = 0, t = 1.0/nSteps, cx, cy, lcx, lcy, lx = 1, ly = 0, x, y, cxo, cyo, lcxo, lcyo, of=2.2, f=1.42;
-
-    for (i=1; i<=nSteps; i++) {
-        x = cos ((3*2*M_PI*t)/nParts);
-        y = -sin ((3*2*M_PI*t)/nParts);
-        cx = (f*x + 1)/2;
-        cy = (f*y + 1)/2;
-        lcx = (f*lx + 1)/2;
-        lcy = (f*ly + 1)/2;
-        cxo = (of*x + 1)/2;
-        cyo = (of*y + 1)/2;
-        lcxo = (of*lx + 1)/2;
-        lcyo = (of*ly + 1)/2;
-        irisPart.pushTriangle (basegfx::B2DVector (lcx, lcy),
-                               basegfx::B2DVector (lcxo, lcyo),
-                               basegfx::B2DVector (cx, cy));
-        irisPart.pushTriangle (basegfx::B2DVector (cx, cy),
-                               basegfx::B2DVector (lcxo, lcyo),
-                               basegfx::B2DVector (cxo, cyo));
-        lx = x;
-        ly = y;
-        lt = t;
-        t += 1.0/nSteps;
-    }
-
-    Iris* pIris = new Iris();
-    double angle = 87;
-
-    for (i = 0; i < nParts; i++) {
-        irisPart.Operations.clear ();
-        double rx, ry;
-
-        rx = cos ((2*M_PI*i)/nParts);
-        ry = sin ((2*M_PI*i)/nParts);
-        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0),  angle, true, 0.0, 0.5));
-        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0), -angle, true, 0.5, 1));
-        if (i > 0) {
-            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(rx, ry, 0),  false, -1, 0));
-            irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(0, 0, 0), i*360.0/nParts, false, -1, 0));
-            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(-1, 0, 0),  false, -1, 0));
-        }
-        irisPart.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1), false, -2, 0.0));
-        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(1, .5, 0), basegfx::B3DVector(1, 0, 0), -30, false, -1, 0));
-        pIris->pushPrimitive (irisPart);
-    }
-
-    maSceneObjects.push_back (pIris);
-
-    mbUseMipMapLeaving = mbUseMipMapEntering = false;
-}
-
-void OGLTransitionImpl::displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
-                          double SlideWidthScale, double SlideHeightScale )
-{
-    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
-
-    glEnable(GL_TEXTURE_2D);
-
-    if( nTime > .5) {
-    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    } else {
-    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    }
-}
-
-void OGLTransitionImpl::makeRochade()
-{
-    clear();
-    Primitive Slide;
-    
-    mbReflectSlides = true;
-    mmDisplaySlides = &OGLTransitionImpl::displaySlidesRochade;
-
-    double w, h;
-
-    w = 2.2;
-    h = 10;
-
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-
-    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.25, -0.25, true, 0, 1));
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.clear();
-    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.75, 0.25, true, 0, 1));
-    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, -h), false, -1, 0));
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
-    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), 45, false, -1, 0));
-    maEnteringSlidePrimitives.push_back(Slide);
-
-    //     OverallOperations.push_back(new SEllipseTranslate(0.5, 2, 0, 1, true, 0, 1));
-//      push_back(new STranslate(basegfx::B3DVector(0, 0, -2), true, 0, 0.5));
-//      OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 2), true, 0.5, 1));
-}
-
-// TODO(Q3): extract to basegfx
-inline basegfx::B2DVector clamp(const basegfx::B2DVector& v)
-{
-    return basegfx::B2DVector(min(max(v.getX(),-1.0),1.0),
-                              min(max(v.getY(),-1.0),1.0));
-}
-
-// TODO(Q3): extract to basegfx
-inline basegfx::B3DVector clamp(const basegfx::B3DVector& v)
-{
-    return basegfx::B3DVector(min(max(v.getX(),-1.0),1.0),
-                              min(max(v.getY(),-1.0),1.0),
-                              min(max(v.getZ(),-1.0),1.0));
-}
-
-inline double randFromNeg1to1()
-{
-    return ( ( static_cast<double>( rand() ) / static_cast<double>( RAND_MAX ) ) * 2.0 ) - 1.0;
-}
-
-// TODO(Q3): extract to basegfx
-inline basegfx::B3DVector randNormVectorInXYPlane()
-{
-    basegfx::B3DVector toReturn(randFromNeg1to1(),randFromNeg1to1(),0.0);
-    return toReturn/toReturn.getLength();
-}
-
-void OGLTransitionImpl::makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles )
-{
-    clear();
-    double dAngle(2*3.1415926/static_cast<double>( nPointsOnCircles ));
-    if(nCircles < 2 || nPointsOnCircles < 4)
-    {
-        makeNByMTileFlip(1,1);
-        return;
-    }
-    double Radius(1.0/static_cast<double>( nCircles ));
-    double dRadius(Radius);
-    double LastRadius(0.0);
-    double NextRadius(2*Radius);
-
-    /// now we know there is at least two circles
-    /// the first will always be a full circle
-    /// the last will always be the outer shell of the slide with a circle hole
-
-    //add the full circle
-    vector<basegfx::B2DVector> unScaledTexCoords;
-    double TempAngle(0.0);
-    for(unsigned int Point(0); Point < nPointsOnCircles; ++Point)
-    {
-        unScaledTexCoords.push_back( basegfx::B2DVector( cos(TempAngle - 3.1415926/2.0) , sin(TempAngle- 3.1415926/2.0) ) );
-
-        TempAngle += dAngle;
-    }
-    
-    {
-        //double angle(0.0);
-        Primitive EnteringSlide;
-        Primitive LeavingSlide;
-        for(int Point(0); Point + 1 < nPointsOnCircles; ++Point)
-        {
-            EnteringSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
-            LeavingSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5, 0.5) );
-        }
-        EnteringSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius * unScaledTexCoords[ 0 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ nPointsOnCircles - 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
-        LeavingSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-    
-        basegfx::B3DVector axis(randNormVectorInXYPlane());
-        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
-        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
-        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
-    
-        maEnteringSlidePrimitives.push_back(EnteringSlide);
-        maLeavingSlidePrimitives.push_back(LeavingSlide);
-        LastRadius = Radius;
-        Radius = NextRadius;
-        NextRadius += dRadius;
-    }    
-    
-    for(int i(1); i < nCircles - 1; ++i)
-    {
-        Primitive LeavingSlide;
-        Primitive EnteringSlide;
-        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
-        {            
-            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-            
-            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        }
-        
-        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        
-        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        
-        basegfx::B3DVector axis(randNormVectorInXYPlane());
-        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
-        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
-        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
-        
-        maEnteringSlidePrimitives.push_back(EnteringSlide);
-        maLeavingSlidePrimitives.push_back(LeavingSlide);
-        
-        LastRadius = Radius;
-        Radius = NextRadius;
-        NextRadius += dRadius;
-    }
-    {
-        Radius = sqrt(2.0);
-        Primitive LeavingSlide;
-        Primitive EnteringSlide;
-        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
-        {
-            
-            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
-            
-            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
-            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
-        }
-        
-        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
-        
-        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
-        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
-        
-        basegfx::B3DVector axis(randNormVectorInXYPlane());
-        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
-        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
-        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
-        
-        maEnteringSlidePrimitives.push_back(EnteringSlide);
-        maLeavingSlidePrimitives.push_back(LeavingSlide);
-    }
-}
-
-void OGLTransitionImpl::makeHelix( ::sal_uInt16 nRows )
-{
-    clear();
-    double invN(1.0/static_cast<double>(nRows));
-    double iDn = 0.0;
-    double iPDn = invN;
-    for(unsigned int i(0); i < nRows; ++i)
-    {
-        Primitive Tile;
-        
-        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
-            
-        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iPDn ) , basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
-        
-        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , 
-                                                true,min(max(static_cast<double>(i - nRows/2.0)*invN/2.0,0.0),1.0),
-                                                min(max(static_cast<double>(i + nRows/2.0)*invN/2.0,0.0),1.0) ) );
-        
-        maLeavingSlidePrimitives.push_back(Tile);
-        
-        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180 , false,0.0,1.0) );
-        
-        maEnteringSlidePrimitives.push_back(Tile);
-            
-        iDn += invN;
-        iPDn += invN;
-    }
-}
-
-void OGLTransitionImpl::makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m )
-{
-    clear();
-    double invN(1.0/static_cast<double>(n));
-    double invM(1.0/static_cast<double>(m));
-    double iDn = 0.0;
-    double iPDn = invN;
-    for(unsigned int i(0); i < n; ++i)
-    {
-        double jDm = 0.0;
-        double jPDm = invM;
-        for(unsigned int j(0); j < m; ++j)
-        {
-            Primitive Tile;
-
-            Tile.pushTriangle(basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));
-
-            Tile.pushTriangle(basegfx::B2DVector( iPDn , jPDm ) , basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));//bottom left corner of tile            
-
-            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , true, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
-            maLeavingSlidePrimitives.push_back(Tile);
-            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180, false, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
-
-            maEnteringSlidePrimitives.push_back(Tile);
-
-            jDm += invM;
-            jPDm += invM;
-        }
-        iDn += invN;
-        iPDn += invN;
-    }
-}
-
-SRotate::SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
-{
-    nT0 = T0;
-    nT1 = T1;
-    bInterpolate = bInter;
-}
-
-SScale::SScale(const basegfx::B3DVector& Scale,const basegfx::B3DVector& Origin, bool bInter, double T0, double T1):scale(Scale),origin(Origin)
-{
-    nT0 = T0;
-    nT1 = T1;
-    bInterpolate = bInter;
-}
-
-RotateAndScaleDepthByWidth::RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
-{
-    nT0 = T0;
-    nT1 = T1;
-    bInterpolate = bInter;
-}
-
-RotateAndScaleDepthByHeight::RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
-{
-    nT0 = T0;
-    nT1 = T1;
-    bInterpolate = bInter;
-}
-
-
-STranslate::STranslate(const basegfx::B3DVector& Vector, bool bInter, double T0, double T1):vector(Vector)
-{
-    nT0 = T0;
-    nT1 = T1;
-    bInterpolate = bInter;
-}
-
-inline double intervalInter(double t, double T0, double T1)
-{
-    return ( t - T0 ) / ( T1 - T0 );
-}
-
-void STranslate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
-{
-    if(t <= nT0)
-        return;
-    if(!bInterpolate || t > nT1)
-        t = nT1;
-    t = intervalInter(t,nT0,nT1);
-    glTranslated(SlideWidthScale*t*vector.getX(),SlideHeightScale*t*vector.getY(),t*vector.getZ());
-}
-
-void SRotate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
-{
-    if(t <= nT0)
-        return;
-    if(!bInterpolate || t > nT1)
-        t = nT1;
-    t = intervalInter(t,nT0,nT1);
-    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
-    glScaled(SlideWidthScale,SlideHeightScale,1);
-    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
-    glScaled(1/SlideWidthScale,1/SlideHeightScale,1);
-    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
-}
-
-void SScale::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
-{
-    if(t <= nT0)
-        return;
-    if(!bInterpolate || t > nT1)
-        t = nT1;
-    t = intervalInter(t,nT0,nT1);
-    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
-    glScaled((1-t) + t*scale.getX(),(1-t) + t*scale.getY(),(1-t) + t*scale.getZ());
-    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
-}
-
-void RotateAndScaleDepthByWidth::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
-{
-    if(t <= nT0)
-        return;
-    if(!bInterpolate || t > nT1)
-        t = nT1;
-    t = intervalInter(t,nT0,nT1);
-    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideWidthScale*origin.getZ());
-    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
-    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideWidthScale*origin.getZ());
-}
-
-void RotateAndScaleDepthByHeight::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
-{
-    if(t <= nT0)
-        return;
-    if(!bInterpolate || t > nT1)
-        t = nT1;
-    t = intervalInter(t,nT0,nT1);
-    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideHeightScale*origin.getZ());
-    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
-    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideHeightScale*origin.getZ());
-}
-
-SEllipseTranslate::SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1)
-{
-    nT0 = T0;
-    nT1 = T1;
-    bInterpolate = bInter;
-    width = dWidth;
-    height = dHeight;
-    startPosition = dStartPosition;
-    endPosition = dEndPosition;
-}
-
-void SEllipseTranslate::interpolate(double t,double /* SlideWidthScale */,double /* SlideHeightScale */)
-{
-    if(t <= nT0)
-        return;
-    if(!bInterpolate || t > nT1)
-        t = nT1;
-    t = intervalInter(t,nT0,nT1);
-
-    double a1, a2, x, y;
-    a1 = startPosition*2*M_PI;
-    a2 = (startPosition + t*(endPosition - startPosition))*2*M_PI;
-    x = width*(cos (a2) - cos (a1))/2;
-    y = height*(sin (a2) - sin (a1))/2;
-
-    glTranslated(x, 0, y);
-}
-
-STranslate* STranslate::clone()
-{
-    return new STranslate(*this);
-}
-SRotate* SRotate::clone()
-{
-    return new SRotate(*this);
-}
-
-SScale* SScale::clone()
-{
-    return new SScale(*this);
-}
-
-SEllipseTranslate* SEllipseTranslate::clone()
-{
-    return new SEllipseTranslate(*this);
-}
-
-RotateAndScaleDepthByWidth* RotateAndScaleDepthByWidth::clone()
-{
-    return new RotateAndScaleDepthByWidth(*this);
-}
-
-RotateAndScaleDepthByHeight* RotateAndScaleDepthByHeight::clone()
-{
-    return new RotateAndScaleDepthByHeight(*this);
-}
-
-const Primitive& Primitive::operator=(const Primitive& rvalue)
-{
-    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
-        Operations.push_back(rvalue.Operations[i]->clone());
-    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
-        Vertices.push_back(rvalue.Vertices[i]);
-    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
-        TexCoords.push_back(rvalue.TexCoords[i]);
-    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
-        Normals.push_back(rvalue.Normals[i]);    
-    return *this;   
-}
-    
-Primitive::Primitive(const Primitive& rvalue)
-{
-    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
-        Operations.push_back(rvalue.Operations[i]->clone());
-    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
-        Vertices.push_back(rvalue.Vertices[i]);
-    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
-        TexCoords.push_back(rvalue.TexCoords[i]);
-    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
-        Normals.push_back(rvalue.Normals[i]);
-}
-
-void Primitive::pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2)
-{
-    vector<basegfx::B3DVector> Verts;
-    vector<basegfx::B2DVector> Texs;
-    Verts.reserve(3);
-    Texs.reserve(3);
-
-    Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
-    Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
-    Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
-
-    //figure out if they're facing the correct way, and make them face the correct way.
-    basegfx::B3DVector Normal( basegfx::cross( Verts[0] - Verts[1] , Verts[1] - Verts[2] ) );
-    if(Normal.getZ() >= 0.0)//if the normal is facing us
-    {
-        Texs.push_back(SlideLocation0);
-        Texs.push_back(SlideLocation1);
-        Texs.push_back(SlideLocation2);
-    }
-    else // if the normal is facing away from us, make it face us
-    {
-        Texs.push_back(SlideLocation0);
-        Texs.push_back(SlideLocation2);
-        Texs.push_back(SlideLocation1);
-        Verts.clear();
-        Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
-        Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
-        Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
-    }
-
-    Vertices.push_back(Verts[0]);
-    Vertices.push_back(Verts[1]);
-    Vertices.push_back(Verts[2]);
-
-    TexCoords.push_back(Texs[0]);
-    TexCoords.push_back(Texs[1]);
-    TexCoords.push_back(Texs[2]);
-    
-    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
-    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
-    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
-}
-
-void OGLTransitionImpl::makeDiamond()
-{
-    mmPrepare = &OGLTransitionImpl::prepareDiamond;
-    mbUseMipMapLeaving = mbUseMipMapEntering = false;
-}
-
-void OGLTransitionImpl::prepareDiamond( double nTime, double /* SlideWidth */, double /* SlideHeight */, double /* DispWidth */, double /* DispHeight */ )
-{
-    Primitive Slide1, Slide2;
-
-    Slide1.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
-    Slide1.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
-    maEnteringSlidePrimitives.push_back (Slide1);
-
-    
-    if( nTime >= 0.5 ) {
-        double m = 1 - nTime;
-
-        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (m,0), basegfx::B2DVector (0,m));
-        Slide2.pushTriangle (basegfx::B2DVector (nTime,0), basegfx::B2DVector (1,0), basegfx::B2DVector (1,m));
-        Slide2.pushTriangle (basegfx::B2DVector (1,nTime), basegfx::B2DVector (1,1), basegfx::B2DVector (nTime,1));
-        Slide2.pushTriangle (basegfx::B2DVector (0,nTime), basegfx::B2DVector (m,1), basegfx::B2DVector (0,1));
-    } else {
-        double l = 0.5 - nTime;
-        double h = 0.5 + nTime;
-
-        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0.5,l));
-        Slide2.pushTriangle (basegfx::B2DVector (0.5,l), basegfx::B2DVector (1,0), basegfx::B2DVector (h,0.5));
-        Slide2.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (1,1), basegfx::B2DVector (h,0.5));
-        Slide2.pushTriangle (basegfx::B2DVector (h,0.5), basegfx::B2DVector (1,1), basegfx::B2DVector (0.5,h));
-        Slide2.pushTriangle (basegfx::B2DVector (0.5,h), basegfx::B2DVector (1,1), basegfx::B2DVector (0,1));
-        Slide2.pushTriangle (basegfx::B2DVector (l,0.5), basegfx::B2DVector (0.5,h), basegfx::B2DVector (0,1));
-        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (l,0.5), basegfx::B2DVector (0,1));
-        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (0.5,l), basegfx::B2DVector (l,0.5));
-    }
-    Slide2.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, 0.00000001), false, -1, 0));
-    maLeavingSlidePrimitives.push_back (Slide2);
-}
-
-void OGLTransitionImpl::makeVenetianBlinds( bool vertical, int parts )
-{
-    static double t30 = tan( M_PI/6.0 );
-    double n, ln = 0;
-    double p = 1.0/parts;
-
-    for( int i=0; i<parts; i++ ) {
-        Primitive Slide;
-        n = (i + 1)/(double)parts;
-        if( vertical ) {
-            Slide.pushTriangle (basegfx::B2DVector (ln,0), basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1));
-            Slide.pushTriangle (basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1), basegfx::B2DVector (n,1));
-            Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, -t30*p), -120, true, 0.0, 1.0));
-        } else {
-            Slide.pushTriangle (basegfx::B2DVector (0,ln), basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n));
-            Slide.pushTriangle (basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n), basegfx::B2DVector (1,n));
-            Slide.Operations.push_back(new RotateAndScaleDepthByHeight(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, -t30*p), -120, true, 0.0, 1.0));
-        }
-        maLeavingSlidePrimitives.push_back (Slide);
-
-        if( vertical ) {
-            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(2*n - 1, 0, 0), -60, false, -1, 0));
-            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, 0), 180, false, -1, 0));
-        } else {
-            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - 2*n, 0), -60, false, -1, 0));
-            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, 0), 180, false, -1, 0));
-        }
-        maEnteringSlidePrimitives.push_back (Slide);
-        ln = n;
-    }
-}
-
-void OGLTransitionImpl::displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
-{
-    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
-
-    glDisable(GL_DEPTH_TEST);
-
-    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
-
-    glDisable(GL_LIGHTING);
-    glEnable(GL_BLEND);
-    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
-    glColor4f( 1, 1, 1, nTime );
-    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    glDisable(GL_BLEND);
-    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
-    glEnable(GL_LIGHTING);
-
-    glEnable(GL_DEPTH_TEST);
-}
-
-void OGLTransitionImpl::makeFadeSmoothly()
-{ 
-    Primitive Slide;
-
-    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
-    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
-    maLeavingSlidePrimitives.push_back (Slide);
-    maEnteringSlidePrimitives.push_back (Slide);
-
-    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeSmoothly;
-    mbUseMipMapLeaving = mbUseMipMapEntering = false;
-}
-
-void OGLTransitionImpl::displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
-{
-    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
-
-    glDisable(GL_DEPTH_TEST);
-
-    glDisable(GL_LIGHTING);
-    glEnable(GL_BLEND);
-    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
-    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
-    if( nTime < 0.5 ) {
-    glColor4f( 1, 1, 1, 1 - nTime*2 );
-    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    } else {
-    glColor4f( 1, 1, 1, (nTime - 0.5)*2 );
-    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
-    }
-    glDisable(GL_BLEND);
-    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
-    glEnable(GL_LIGHTING);
-
-    glEnable(GL_DEPTH_TEST);
-}
-
-void OGLTransitionImpl::makeFadeThroughBlack()
-{ 
-    Primitive Slide;
-
-    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
-    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
-    maLeavingSlidePrimitives.push_back (Slide);
-    maEnteringSlidePrimitives.push_back (Slide);
-
-    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeThroughBlack;
-    mbUseMipMapLeaving = mbUseMipMapEntering = false;
-}
-
-static const char* basicVertexShader = "\n\
-varying vec2 v_texturePosition;\n\
-\n\
-void main( void )\n\
-{\n\
-    gl_Position = ftransform();\n\
-    v_texturePosition = gl_MultiTexCoord0.xy;\n\
-}\n\
-";
-
-static const char* staticFragmentShader = "\n\
-uniform sampler2D leavingSlideTexture;\n\
-uniform sampler2D enteringSlideTexture;\n\
-uniform sampler2D permTexture;\n\
-uniform float time;\n\
-varying vec2 v_texturePosition;\n\
-\n\
-float snoise(vec2 P) {\n\
-\n\
-  return texture2D(permTexture, P).r;\n\
-}\n\
-\n\
-\n\
-#define PART 0.5\n\
-#define START 0.4\n\
-#define END 0.9\n\
-\n\
-void main() {\n\
-    float sn = snoise(10.0*v_texturePosition+time*0.07);\n\
-    if( time < PART ) {\n\
-        float sn1 = snoise(vec2(time*15.0, 20.0*v_texturePosition.y));\n\
-        float sn2 = snoise(v_texturePosition);\n\
-        if (sn1 > 1.0 - time*time && sn2 < 2.0*time+0.1)\n\
-            gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
-        else if (time > START )\n\
-            gl_FragColor = ((time-START)/(PART - START))*vec4(sn, sn, sn, 1.0) + (1.0 - (time - START)/(PART - START))*texture2D(leavingSlideTexture, v_texturePosition);\n\
-        else\n\
-            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
-    } else if ( time < PART ) {\n\
-            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
-    } else if ( time > END ) {\n\
-        gl_FragColor = ((1.0 - time)/(1.0 - END))*vec4(sn, sn, sn, 1.0) + ((time - END)/(1.0 - END))*texture2D(enteringSlideTexture, v_texturePosition);\n\
-    } else \n\
-        gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
-}\n\
-";
-
-static const char* dissolveFragmentShader = "\n\
-uniform sampler2D leavingSlideTexture;\n\
-uniform sampler2D enteringSlideTexture;\n\
-uniform sampler2D permTexture;\n\
-uniform float time;\n\
-varying vec2 v_texturePosition;\n\
-\n\
-float snoise(vec2 P) {\n\
-\n\
-  return texture2D(permTexture, P).r;\n\
-}\n\
-\n\
-void main() {\n\
-     float sn = snoise(10.0*v_texturePosition);\n\
-     if( sn < time)\n\
-         gl_FragColor = texture2D(enteringSlideTexture, v_texturePosition);\n\
-     else\n\
-         gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
-}\n\
-";
-
-int permutation256 [256]= {
-215, 100, 200, 204, 233,  50,  85, 196, 
- 71, 141, 122, 160,  93, 131, 243, 234, 
-162, 183,  36, 155,   4,  62,  35, 205, 
- 40, 102,  33,  27, 255,  55, 214, 156, 
- 75, 163, 134, 126, 249,  74, 197, 228, 
- 72,  90, 206, 235,  17,  22,  49, 169, 
-227,  89,  16,   5, 117,  60, 248, 230, 
-217,  68, 138,  96, 194, 170, 136,  10, 
-112, 238, 184, 189, 176,  42, 225, 212, 
- 84,  58, 175, 244, 150, 168, 219, 236, 
-101, 208, 123,  37, 164, 110, 158, 201, 
- 78, 114,  57,  48,  70, 142, 106,  43, 
-232,  26,  32, 252, 239,  98, 191,  94, 
- 59, 149,  39, 187, 203, 190,  19,  13, 
-133,  45,  61, 247,  23,  34,  20,  52, 
-118, 209, 146, 193, 222,  18,   1, 152, 
- 46,  41,  91, 148, 115,  25, 135,  77, 
-254, 147, 224, 161,   9, 213, 223, 250, 
-231, 251, 127, 166,  63, 179,  81, 130, 
-139,  28, 120, 151, 241,  86, 111,   0, 
- 88, 153, 172, 182, 159, 105, 178,  47, 
- 51, 167,  65,  66,  92,  73, 198, 211, 
-245, 195,  31, 220, 140,  76, 221, 186, 
-154, 185,  56,  83,  38, 165, 109,  67, 
-124, 226, 132,  53, 229,  29,  12, 181, 
-121,  24, 207, 199, 177, 113,  30,  80, 
-  3,  97, 188,  79, 216, 173,   8, 145, 
- 87, 128, 180, 237, 240, 137, 125, 104, 
- 15, 242, 119, 246, 103, 143,  95, 144, 
-  2,  44,  69, 157, 192, 174,  14,  54, 
-218,  82,  64, 210,  11,   6, 129,  21, 
-116, 171,  99, 202,   7, 107, 253, 108
-};
-
-void initPermTexture(GLuint *texID)
-{
-  glGenTextures(1, texID);
-  glBindTexture(GL_TEXTURE_2D, *texID);
-
-  static bool initialized = false;
-  static unsigned char permutation2D[256*256*4];
-  if( !initialized ) {
-      int x, y;
-
-      for( y=0; y < 256; y++ )
-          for( x=0; x < 256; x++ )
-              permutation2D[x*4 + y*1024] = permutation256[(y + permutation256[x]) & 0xff];
-
-      initialized = true;
-  }
-
-  glTexImage2D( GL_TEXTURE_2D, 0, GL_RGBA, 256, 256, 0, GL_RGBA, GL_UNSIGNED_BYTE, permutation2D );
-  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST );
-  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST );
-}
-
-void OGLTransitionImpl::preparePermShader()
-{
-#ifdef GL_VERSION_2_0
-    if( mProgramObject ) {
-        OGLShaders::glUseProgram( mProgramObject );
-
-        GLint location = OGLShaders::glGetUniformLocation( mProgramObject, "leavingSlideTexture" );
-        if( location != -1 ) {
-            OGLShaders::glUniform1i( location, 0 );  // texture unit 0
-        }
-
-        glActiveTexture(GL_TEXTURE1);
-        if( !maHelperTexture )
-            initPermTexture( &maHelperTexture );
-        glActiveTexture(GL_TEXTURE0);
-
-        location = OGLShaders::glGetUniformLocation( mProgramObject, "permTexture" );
-        if( location != -1 ) {
-            OGLShaders::glUniform1i( location, 1 );  // texture unit 1
-        }
-
-        location = OGLShaders::glGetUniformLocation( mProgramObject, "enteringSlideTexture" );
-        if( location != -1 ) {
-            OGLShaders::glUniform1i( location, 2 );  // texture unit 2
-        }
-    }
-#endif
-}
-
-void OGLTransitionImpl::prepareStatic( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
-{
-    mProgramObject = OGLShaders::LinkProgram( basicVertexShader, staticFragmentShader );
-
-    preparePermShader();
-}
-
-void OGLTransitionImpl::displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
-                                              double SlideWidthScale, double SlideHeightScale )
-{
-    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
-
-#ifdef GL_VERSION_2_0
-    if( mProgramObject ) {
-        GLint location = OGLShaders::glGetUniformLocation( mProgramObject, "time" );
-        if( location != -1 ) {
-            OGLShaders::glUniform1f( location, nTime );
-        }
-    }
-
-    glActiveTexture( GL_TEXTURE2 );
-    glBindTexture( GL_TEXTURE_2D, glEnteringSlideTex );
-    glActiveTexture( GL_TEXTURE0 );
-#endif
-
-    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
-}
-
-void OGLTransitionImpl::makeStatic()
-{
-    Primitive Slide;
-
-    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
-    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
-    maLeavingSlidePrimitives.push_back (Slide);
-    maEnteringSlidePrimitives.push_back (Slide);
-
-    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
-    mmPrepareTransition = &OGLTransitionImpl::prepareStatic;
-    mbUseMipMapLeaving = mbUseMipMapEntering = false;
-
-    mnRequiredGLVersion = 2.0;
-}
-
-void OGLTransitionImpl::prepareDissolve( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
-{
-    mProgramObject = OGLShaders::LinkProgram( basicVertexShader, dissolveFragmentShader );
-
-    preparePermShader();
-}
-
-void OGLTransitionImpl::makeDissolve()
-{
-    Primitive Slide;
-
-    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
-    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
-    maLeavingSlidePrimitives.push_back (Slide);
-    maEnteringSlidePrimitives.push_back (Slide);
-
-    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
-    mmPrepareTransition = &OGLTransitionImpl::prepareDissolve;
-    mbUseMipMapLeaving = mbUseMipMapEntering = false;
-
-    mnRequiredGLVersion = 2.0;
-}
-
-void OGLTransitionImpl::makeNewsflash()
-{
-    Primitive Slide;
-    
-    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
-    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
-    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),3000,true,0,0.5));
-    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),true,0,0.5));
-    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-10000, 0, 0),false, 0.5, 2));
-    maLeavingSlidePrimitives.push_back(Slide);
-
-    Slide.Operations.clear();
-    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),-3000,true,0.5,1));
-    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-100, 0, 0),false, -1, 1));
-    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(100, 0, 0),false, 0.5, 1));
-    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),false,-1,1));
-    Slide.Operations.push_back(new SScale(basegfx::B3DVector(100,100,100),basegfx::B3DVector(0,0,0),true,0.5,1));
-    maEnteringSlidePrimitives.push_back(Slide);
-
-    OverallOperations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0.2,0.2,0),1080,true,0,1));
-}
-
diff --git slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.hxx slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.hxx
deleted file mode 100644
index 2aa0529..0000000
--- slideshow/source/engine/OGLTrans/OGLTrans_TransitionImpl.hxx
+++ /dev/null
@@ -1,509 +0,0 @@
-/*************************************************************************
- *
- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
- * 
- * Copyright 2008 by Sun Microsystems, Inc.
- *
- * OpenOffice.org - a multi-platform office productivity suite
- *
- * $RCSfile: OGLTrans_TransitionImpl.hxx,v $
- * $Revision: 1.5 $
- *
- * This file is part of OpenOffice.org.
- *
- * OpenOffice.org is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Lesser General Public License version 3
- * only, as published by the Free Software Foundation.
- *
- * OpenOffice.org is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Lesser General Public License version 3 for more details
- * (a copy is included in the LICENSE file that accompanied this code).
- *
- * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
- * for a copy of the LGPLv3 License.
- *
- ************************************************************************/
-#ifndef INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
-#define INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
-
-#include <basegfx/vector/b2dvector.hxx>
-#include <basegfx/vector/b3dvector.hxx>
-
-#include <tools/prewin.h>
-#include <tools/postwin.h>
-
-#if defined( WNT ) 
-#include <tools/prewin.h>
-#include <tools/postwin.h>
-#elif defined( OS2 )
-#elif defined( QUARTZ )
-#elif defined( UNX )
-#endif    	
-
-#include <vector>
-#include <GL/gl.h>
-
-using namespace std;
-
-class Primitive;
-class Operation;
-class SceneObject;
-
-
-/** OpenGL 3D Transition class. It implicitly is constructed from XOGLTransition
-
-    This class is capable of making itself into many difference transitions. It holds Primitives and Operations on those primitives.
-*/
-class OGLTransitionImpl
-{
-public:
-    OGLTransitionImpl() :
-        mbUseMipMapLeaving( true ),
-        mbUseMipMapEntering( true ),
-        mnRequiredGLVersion( 1.0 ),
-        maLeavingSlidePrimitives(),
-        maEnteringSlidePrimitives(),
-        maSceneObjects(),
-        mbReflectSlides( false ),
-        mVertexObject( 0 ),
-        mFragmentObject( 0 ),
-        mProgramObject( 0 ),
-        maHelperTexture( 0 ),
-        mmPrepare( NULL ),
-        mmPrepareTransition( NULL ),
-        mmClearTransition( NULL ),
-        mmDisplaySlides( NULL )
-    {}
-
-    ~OGLTransitionImpl();
-    
-    void prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
-    void display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
-    void finish();
-
-    void makeOutsideCubeFaceToLeft();
-    void makeInsideCubeFaceToLeft();
-    void makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m );
-    void makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles );
-    void makeHelix( ::sal_uInt16 nRows );
-    void makeFallLeaving();
-    void makeTurnAround();
-    void makeTurnDown();
-    void makeIris();
-    void makeRochade();
-    void makeVenetianBlinds( bool vertical, int parts );
-    void makeStatic();
-    void makeDissolve();
-    void makeNewsflash();
-
-    /** 2D replacements
-     */
-    void makeDiamond();
-    void makeFadeSmoothly();
-    void makeFadeThroughBlack();
-
-    /** Whether to use mipmaping for slides textures
-     */
-    bool mbUseMipMapLeaving;
-    bool mbUseMipMapEntering;
-
-    /** which GL version does the transition require
-     */
-    float mnRequiredGLVersion;
-
-private:
-    /** clears all the primitives and operations
-    */
-    void clear();
-    
-    /** All the primitives that use the leaving slide texture
-    */
-    vector<Primitive> maLeavingSlidePrimitives;
-    
-    /** All the primitives that use the leaving slide texture
-    */
-    vector<Primitive> maEnteringSlidePrimitives;
-    
-    /** All the surrounding scene objects
-    */
-    vector<SceneObject*> maSceneObjects;
-
-    /** All the operations that should be applied to both leaving and entering slide primitives. These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
-    */
-    vector<Operation*> OverallOperations;
-
-    /** Whether to reflect slides, the reflection happens on flat surface beneath the slides.
-     ** Now it only works with slides which keep their rectangular shape together.
-     */
-    bool mbReflectSlides;
-
-    /** GLSL objects, shaders and program
-     */
-    GLuint mVertexObject, mFragmentObject, mProgramObject;
-
-    /** various data */
-    GLuint maHelperTexture;
-
-    /** When this method is not NULL, it is called in display method to prepare the slides, scene, etc.
-     ** We might later replace this by cleaner derived class.
-     */
-    void (OGLTransitionImpl::*mmPrepare)( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
-
-    /** When this method is not NULL, it is called after glx context is ready to let the transition prepare GL related things, like GLSL program.
-     ** We might later replace this by cleaner derived class.
-     */
-    void (OGLTransitionImpl::*mmPrepareTransition)( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
-
-    /** When this method is not NULL, it is called when the transition needs to clear after itself, like delete own textures etc.
-     ** We might later replace this by cleaner derived class.
-     */
-    void (OGLTransitionImpl::*mmClearTransition)();
-
-    /** When this method is not NULL, it is called in display method to display the slides.
-     ** We might later replace this by cleaner derived class.
-     */
-    void (OGLTransitionImpl::*mmDisplaySlides)( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
-
-    void displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
-    void displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives, double SlideWidthScale, double SlideHeightScale );
-    void displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
-    void applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale );
-
-    /** various transitions helper methods
-     */
-    void prepareDiamond( double nTime, double SlideWidth, double SlideHeight,double DispWidth, double DispHeight );
-    void displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
-        void displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
-        void displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
-    void displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
-    void prepareStatic( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
-    void prepareDissolve( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
-    void preparePermShader();
-};
-
-class SceneObject
-{
-public:
-    SceneObject();
-
-    virtual void prepare() {};
-    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
-    virtual void finish() {};
-
-    void pushPrimitive (const Primitive &p);
-
-protected:
-    /** All the surrounding scene primitives
-    */
-    vector<Primitive> maPrimitives;
-};
-
-class Iris : public SceneObject
-{
-public:
-    Iris ();
-
-    virtual void prepare();
-    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
-    virtual void finish();
-
-private:
-
-    GLuint maTexture;
-};
-
-/** This class is a list of Triangles that will share Operations, and could possibly share  
-*/
-class Primitive
-{
-public:
-    Primitive() {}
-    // making copy constructor explicit makes the class un-suitable for use with stl containers
-    Primitive(const Primitive& rvalue);
-    ~Primitive();
-
-    void applyOperations(double nTime, double SlideWidthScale, double SlideHeightScale);
-    void display(double nTime, double SlideWidthScale, double SlideHeightScale);
-    const Primitive& operator=(const Primitive& rvalue);
-    
-    /** PushBack a vertex,normal, and tex coord. Each SlideLocation is where on the slide is mapped to this location ( from (0,0) to (1,1)  ). This will make sure the correct aspect ratio is used, and helps to make slides begin and end at the correct position. (0,0) is the top left of the slide, and (1,1) is the bottom right.
-    
-    @param SlideLocation0
-    Location of first Vertex on slide
-    
-    @param SlideLocation1
-    Location of second Vertex on slide
-    
-    @param SlideLocation2
-    Location of third Vertex on slide
-    
-    */
-    void pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2);
-    
-    /** clear all the vertices, normals, tex coordinates, and normals
-    */
-    void clearTriangles();
-    
-    /** guards against directly changing the vertices
-        
-        @return        
-        the list of vertices
-    */
-    const vector<basegfx::B3DVector>& getVertices() const {return Vertices;}
-    
-    /** guards against directly changing the vertices
-    */
-    const vector<basegfx::B3DVector>& getNormals() const {return Normals;}
-    
-    /** guards against directly changing the vertices
-    
-        @return        
-        the list of Texture Coordinates
-    
-    */
-    const vector<basegfx::B2DVector>& getTexCoords() const {return TexCoords;}
-
-    /** list of Operations to be performed on this primitive.These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
-    
-        @return        
-        the list of Operations
-    
-    */    
-    vector<Operation*> Operations;
-
-private:
-    /** list of vertices
-    */
-    vector<basegfx::B3DVector> Vertices;
-    
-    /** list of Normals
-    */
-    vector<basegfx::B3DVector> Normals;
-    
-    /** list of Texture Coordinates
-    */
-    vector<basegfx::B2DVector> TexCoords;
-};
-
-/** This class is to be derived to make any operation (tranform) you may need in order to construct your transitions
-*/
-class Operation
-{
-public:
-    Operation(){}
-    virtual ~Operation(){}
-    
-    /** Should this operation be interpolated . If TRUE, the transform will smoothly move from making no difference from t = 0.0 to nT0 to being completely transformed from t = nT1 to 1. If FALSE, the transform will be inneffectual from t = 0 to nT0, and completely transformed from t = nT0 to 1. 
-    */
-    bool bInterpolate;
-    
-    /** time to begin the transformation
-    */
-    double nT0;
-    
-    /** time to finish the transformation
-    */
-    double nT1;
-public:
-    /** this is the function that is called to give the Operation to OpenGL.
-        
-        @param t
-        time from t = 0 to t = 1
-        
-        @param SlideWidthScale
-        width of slide divided by width of window
-        
-        @param SlideHeightScale
-        height of slide divided by height of window
-    
-    */
-    virtual void interpolate(double t,double SlideWidthScale,double SlideHeightScale) = 0;
-    
-    /** return a copy of this operation
-    */
-    virtual Operation* clone() = 0;
-};
-
-/** this class is a generic CounterClockWise(CCW) rotation with an axis angle
-*/
-class SRotate: public Operation
-{
-public:
-    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
-    virtual SRotate* clone();
-    
-    /** Constructor
-        
-        @param Axis
-        axis to rotate about
-        
-        @param Origin
-        position that rotation axis runs through
-        
-        @param Angle
-        angle in radians of CCW rotation
-        
-        @param bInter
-        see Operation
-        
-        @param T0
-        transformation starting time
-        
-        @param T1
-        transformation ending time
-    
-    */
-    SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
-    ~SRotate(){}
-private:
-    /** axis to rotate CCW about
-    */
-    basegfx::B3DVector axis;
-    
-    /** position that rotation axis runs through
-    */
-    basegfx::B3DVector origin;
-    
-    /** angle in radians of CCW rotation
-    */
-    double angle;
-};
-
-/** scaling transformation
-*/
-class SScale: public Operation
-{
-public:
-    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
-    SScale* clone();
-    
-    /** Constructor
-        
-        @param Scale
-        amount to scale by 
-        
-        @param Origin
-        position that rotation axis runs through
-        
-        @param bInter
-        see Operation
-        
-        @param T0
-        transformation starting time
-        
-        @param T1
-        transformation ending time
-    
-    */
-    SScale(const basegfx::B3DVector& Scale, const basegfx::B3DVector& Origin,bool bInter, double T0, double T1);
-    ~SScale(){}
-private:
-    basegfx::B3DVector scale;
-    basegfx::B3DVector origin;
-};
-
-/** translation transformation
-*/
-class STranslate: public Operation
-{
-public:
-    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
-    STranslate* clone();
-    
-    /** Constructor
-        
-        @param Vector
-        vector to translate
-        
-        @param bInter
-        see Operation
-        
-        @param T0
-        transformation starting time
-        
-        @param T1
-        transformation ending time
-    
-    */
-    STranslate(const basegfx::B3DVector& Vector,bool bInter, double T0, double T1);
-    ~STranslate(){}
-private:
-    /** vector to translate by
-    */
-    basegfx::B3DVector vector;
-};
-
-/** translation transformation
-*/
-class SEllipseTranslate: public Operation
-{
-public:
-    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
-    SEllipseTranslate* clone();
-    
-    /** Constructor
-        
-        @param Vector
-        vector to translate
-        
-        @param bInter
-        see Operation
-        
-        @param T0
-        transformation starting time
-        
-        @param T1
-        transformation ending time
-    
-    */
-    SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1);
-    ~SEllipseTranslate(){}
-private:
-    /** width and length of the ellipse
-     */
-    double width, height;
-
-    /** start and end position on the ellipse <0,1>
-     */
-    double startPosition;
-    double endPosition;
-};
-
-/** Same as SRotate, except the depth is scaled by the width of the slide divided by the width of the window.
-*/
-class RotateAndScaleDepthByWidth: public Operation
-{
-public:
-    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
-    RotateAndScaleDepthByWidth* clone();
-
-    RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
-    ~RotateAndScaleDepthByWidth(){}
-private:
-    basegfx::B3DVector axis;
-    basegfx::B3DVector origin;
-    double angle;
-};
-
-/** Same as SRotate, except the depth is scaled by the width of the slide divided by the height of the window.
-*/
-class RotateAndScaleDepthByHeight: public Operation
-{
-public:
-    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
-    RotateAndScaleDepthByHeight* clone();
-
-    RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
-    ~RotateAndScaleDepthByHeight(){}
-private:
-    basegfx::B3DVector axis;
-    basegfx::B3DVector origin;
-    double angle;
-};
-
-#endif // INCLUDED_SLIDESHOW_TRANSITION_HXX_
-
diff --git slideshow/source/engine/OGLTrans/OGLTrans_TransitionerImpl.cxx slideshow/source/engine/OGLTrans/OGLTrans_TransitionerImpl.cxx
deleted file mode 100644
index 01d513c..0000000
--- slideshow/source/engine/OGLTrans/OGLTrans_TransitionerImpl.cxx
+++ /dev/null
@@ -1,1487 +0,0 @@
-/*************************************************************************
- *
- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
- * 
- * Copyright 2008 by Sun Microsystems, Inc.
- *
- * OpenOffice.org - a multi-platform office productivity suite
- *
- * $RCSfile: OGLTrans_TransitionerImpl.cxx,v $
- * $Revision: 1.6 $
- *
- * This file is part of OpenOffice.org.
- *
- * OpenOffice.org is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Lesser General Public License version 3
- * only, as published by the Free Software Foundation.
- *
- * OpenOffice.org is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Lesser General Public License version 3 for more details
- * (a copy is included in the LICENSE file that accompanied this code).
- *
- * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
- * for a copy of the LGPLv3 License.
- *
- ************************************************************************/
-
-#define GLX_GLXEXT_PROTOTYPES 1
-#include "OGLTrans_TransitionImpl.hxx"
-
-#include <com/sun/star/beans/XFastPropertySet.hpp>
-#include <com/sun/star/rendering/IntegerBitmapLayout.hpp>
-#include <com/sun/star/rendering/ColorComponentTag.hpp>
-#include <com/sun/star/rendering/ColorSpaceType.hpp>
-#include <com/sun/star/animations/TransitionType.hpp>
-#include <com/sun/star/animations/TransitionSubType.hpp>
-#include <com/sun/star/presentation/XTransitionFactory.hpp>
-#include <com/sun/star/presentation/XTransition.hpp>
-#include <com/sun/star/presentation/XSlideShowView.hpp>
-#include <com/sun/star/uno/XComponentContext.hpp>
-#include <com/sun/star/rendering/XIntegerBitmap.hpp>
-#include <com/sun/star/geometry/IntegerSize2D.hpp>
-
-#include <cppuhelper/compbase1.hxx>
-#include <cppuhelper/basemutex.hxx>
-#include <cppuhelper/factory.hxx>
-#include <rtl/ref.hxx>
-
-#include <comphelper/servicedecl.hxx>
-
-#include <canvas/canvastools.hxx>
-#include <tools/gen.hxx>
-#include <vcl/window.hxx>
-#include <vcl/syschild.hxx>
-
-#include <boost/noncopyable.hpp>
-
-#include <GL/gl.h>
-#include <GL/glu.h>
-
-
-#if defined( WNT ) 
-    #include <tools/prewin.h>
-    #include <windows.h>
-    #include <tools/postwin.h>
-    #define GL_TEXTURE_MAX_ANISOTROPY_EXT 0x84FE
-    #define GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT 0x84FF
-#elif defined( OS2 )
-#elif defined( QUARTZ )
-    #include "premac.h"
-    #include <Cocoa/Cocoa.h>
-    #include "postmac.h"
-#elif defined( UNX )
-namespace unx
-{
-#include <X11/keysym.h>
-#include <X11/X.h>
-#include <GL/glx.h>
-#include <GL/glxext.h>
-}
-#endif
-#include <vcl/sysdata.hxx>
-
-#ifdef DEBUG
-#include <boost/date_time/posix_time/posix_time.hpp>
-using namespace ::boost::posix_time;
-
-static ptime t1;
-static ptime t2;
-
-#define DBG(x) x
-#else
-#define DBG(x)
-#endif
-
-using namespace ::com::sun::star;
-using ::com::sun::star::beans::XFastPropertySet;
-using ::com::sun::star::uno::Any;
-using ::com::sun::star::uno::Reference;
-using ::com::sun::star::uno::Sequence;
-using ::com::sun::star::uno::UNO_QUERY;
-using ::com::sun::star::uno::UNO_QUERY_THROW;
-
-namespace
-{
-
-typedef cppu::WeakComponentImplHelper1<presentation::XTransition> OGLTransitionerImplBase;
-
-namespace
-{
-    struct OGLFormat
-    {
-        GLint  nInternalFormat;
-        GLenum eFormat;
-        GLenum eType;
-    };
-
-    /* channel ordering: (0:rgba, 1:bgra, 2:argb, 3:abgr)  
-    */
-    int calcComponentOrderIndex(const uno::Sequence<sal_Int8>& rTags)
-    {
-        using namespace rendering::ColorComponentTag;
-
-        static const sal_Int8 aOrderTable[] =
-        {
-            RGB_RED, RGB_GREEN, RGB_BLUE, ALPHA,
-            RGB_BLUE, RGB_GREEN, RGB_RED, ALPHA,
-            ALPHA, RGB_RED, RGB_GREEN, RGB_BLUE,
-            ALPHA, RGB_BLUE, RGB_GREEN, RGB_RED, 
-        };
-
-        const sal_Int32 nNumComps(rTags.getLength());
-        const sal_Int8* pLine=aOrderTable;
-        for(int i=0; i<4; ++i)
-        {
-            int j=0;
-            while( j<4 && j<nNumComps && pLine[j] == rTags[j] )
-                ++j;
-
-            // all of the line passed, this is a match!
-            if( j==nNumComps )
-                return i;
-
-            pLine+=4;
-        }
-
-        return -1;
-    }
-}
-
-// not thread safe
-static bool errorTriggered;
-int oglErrorHandler( unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/ )
-{
-    errorTriggered = true;
-
-    return 0;
-}
-
-/** This is the Transitioner class for OpenGL 3D transitions in
- * slideshow. At the moment, it's Linux only. This class is implicitly
- * constructed from XTransitionFactory.
-*/
-class OGLTransitionerImpl : private cppu::BaseMutex, private boost::noncopyable, public OGLTransitionerImplBase
-{
-public:
-    explicit OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition);
-    bool initWindowFromSlideShowView( const uno::Reference< presentation::XSlideShowView >& xView );
-    void setSlides( const Reference< rendering::XBitmap >& xLeavingSlide , const uno::Reference< rendering::XBitmap >& xEnteringSlide );
-    static bool initialize( const Reference< presentation::XSlideShowView >& xView );
-
-    // XTransition
-    virtual void SAL_CALL update( double nTime )
-    throw (uno::RuntimeException);
-    virtual void SAL_CALL viewChanged( const Reference< presentation::XSlideShowView >& rView,
-                       const Reference< rendering::XBitmap >& rLeavingBitmap,
-                       const Reference< rendering::XBitmap >& rEnteringBitmap )
-    throw (uno::RuntimeException);
-    
-protected:
-    void disposeContextAndWindow();
-    void disposeTextures();
-
-    // WeakComponentImplHelperBase
-    virtual void SAL_CALL disposing();
-    
-    bool isDisposed() const
-    {
-        return (rBHelper.bDisposed || rBHelper.bInDispose);
-    }
-
-    bool createWindow( Window* pPWindow );
-    void createTexture( unsigned int* texID,
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-            unx::GLXPixmap pixmap,
-            bool usePixmap,
-#endif
-            bool useMipmap,
-            uno::Sequence<sal_Int8>& data,
-            const OGLFormat* pFormat );
-    void prepareEnvironment ();
-    const OGLFormat* chooseFormats();
-
-private:    
-    /** After the window has been created, and the slides have been set, we'll initialize the slides with OpenGL.
-    */
-    void GLInitSlides();
-
-
-    /// Holds the information of our new child window
-    struct GLWindow
-    {
-#if defined( WNT ) 
-    HWND					hWnd;
-    HDC						hDC;
-    HGLRC					hRC;
-#elif defined( OS2 )
-#elif defined( QUARTZ )
-#elif defined( UNX )
-    unx::Display*           dpy;
-    int                     screen;
-    unx::Window             win;
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    unx::GLXFBConfig        fbc;
-#endif
-    unx::XVisualInfo*       vi;
-    unx::GLXContext         ctx;
-#endif
-        unsigned int            bpp;
-        unsigned int            Width;
-        unsigned int            Height;
-        const char*             GLXExtensions;
-    const GLubyte*          GLExtensions;
-
-        bool HasGLXExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, (const GLubyte*) GLXExtensions ); }
-    bool HasGLExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, GLExtensions ); }
-    } GLWin;
-    
-    /** OpenGL handle to the leaving slide's texture
-    */
-    unsigned int GLleavingSlide;
-    /** OpenGL handle to the entering slide's texture
-    */
-    unsigned int GLenteringSlide;
-    
-    /** pointer to our window which we MIGHT create.
-    */
-    class SystemChildWindow* pWindow;
-
-    Reference< presentation::XSlideShowView > mxView;
-    Reference< rendering::XIntegerBitmap > mxLeavingBitmap;
-    Reference< rendering::XIntegerBitmap > mxEnteringBitmap;
-    
-    /** raw bytes of the entering bitmap
-    */
-    uno::Sequence<sal_Int8> EnteringBytes;
-    
-    /** raw bytes of the leaving bitmap
-    */
-    uno::Sequence<sal_Int8> LeavingBytes;
-
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    unx::GLXPixmap LeavingPixmap;
-    unx::GLXPixmap EnteringPixmap;
-#endif
-    bool mbRestoreSync;
-    bool mbUseLeavingPixmap;
-    bool mbUseEnteringPixmap;
-    bool mbFreeLeavingPixmap;
-    bool mbFreeEnteringPixmap;
-    unx::Pixmap maLeavingPixmap;
-    unx::Pixmap maEnteringPixmap;
-    
-    /** the form the raw bytes are in for the bitmaps
-    */
-    rendering::IntegerBitmapLayout SlideBitmapLayout; 
-    
-    /** the size of the slides
-    */    
-    geometry::IntegerSize2D SlideSize;
-    
-    /** Our Transition to be used.
-    */    
-    OGLTransitionImpl* pTransition;
-
-public:
-    /** whether we are running on ATI fglrx with bug related to textures
-     */
-    static bool cbBrokenTexturesATI;
-
-    /** GL version
-     */
-    static float cnGLVersion;
-    float mnGLXVersion;
-
-    /** Whether Mesa is the OpenGL vendor
-     */
-    static bool cbMesa;
-
-    /**
-       whether the display has GLX extension
-     */
-    static bool cbGLXPresent;
-
-    /**
-       whether texture from pixmap extension is available
-    */
-    bool mbTextureFromPixmap;
-
-    /**
-       whether to generate mipmaped textures
-    */
-    bool mbGenerateMipmap;
-
-    /**
-       whether we have visual which can be used for texture_from_pixmap extension
-    */
-    bool mbHasTFPVisual;
-
-#ifdef DEBUG
-    ptime t3;
-    ptime t4;
-    ptime t5;
-    ptime t6;
-    time_duration total_update;
-    int frame_count;
-#endif
-};
-
-// declare the static variables as some gcc versions have problems declaring them automaticaly
-bool OGLTransitionerImpl::cbBrokenTexturesATI;
-float OGLTransitionerImpl::cnGLVersion;
-bool OGLTransitionerImpl::cbMesa;
-bool OGLTransitionerImpl::cbGLXPresent;
-
-bool OGLTransitionerImpl::initialize( const Reference< presentation::XSlideShowView >& xView )
-{
-    // not thread safe
-    static bool initialized = false;
-
-    if( !initialized ) {
-        OGLTransitionerImpl *instance;
-
-        instance = new OGLTransitionerImpl( NULL );
-        if( instance->initWindowFromSlideShowView( xView ) ) {
-
-            const GLubyte* version = glGetString( GL_VERSION );
-            if( version && version[0] ) {
-                cnGLVersion = version[0] - '0';
-                if( version[1] == '.' && version[2] )
-                    cnGLVersion += (version[2] - '0')/10.0;
-            } else
-                cnGLVersion = 1.0;
-            OSL_TRACE("GL version: %s parsed: %f", version, cnGLVersion );
-
-            const GLubyte* vendor = glGetString( GL_VENDOR );
-            cbMesa = ( vendor && strstr( (const char *) vendor, "Mesa" ) );
-            OSL_TRACE("GL vendor: %s identified as Mesa: %d", vendor, cbMesa );
-
-            /* TODO: check for version once the bug in fglrx driver is fixed */
-            cbBrokenTexturesATI = (vendor && strcmp( (const char *) vendor, "ATI Technologies Inc." ) == 0 );
-
-            instance->disposing();
-            cbGLXPresent = true;
-        } else
-            cbGLXPresent = false;
-
-        delete instance;
-        initialized = true;
-    }
-
-    return cbGLXPresent;
-}
-
-bool OGLTransitionerImpl::createWindow( Window* pPWindow )
-{
-    const SystemEnvData* sysData(pPWindow->GetSystemData());
-#if defined( WNT ) 
-    GLWin.hWnd = sysData->hWnd;
-#elif defined( UNX )
-    GLWin.dpy = reinterpret_cast<unx::Display*>(sysData->pDisplay);
-
-    if( unx::glXQueryExtension( GLWin.dpy, NULL, NULL ) == false )
-        return false;
-
-    GLWin.win = sysData->aWindow;
-
-    OSL_TRACE("parent window: %d", GLWin.win);
-
-    unx::XWindowAttributes xattr;
-    unx::XGetWindowAttributes( GLWin.dpy, GLWin.win, &xattr );
-
-    GLWin.screen = XScreenNumberOfScreen( xattr.screen );
-
-    unx::XVisualInfo* vi( NULL );
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    unx::XVisualInfo* visinfo;
-    unx::XVisualInfo* firstVisual( NULL );
-#endif
-    static int attrList3[] =
-        {
-        GLX_RGBA,//only TrueColor or DirectColor
-            //single buffered
-            GLX_RED_SIZE,4,//use the maximum red bits, with a minimum of 4 bits
-            GLX_GREEN_SIZE,4,//use the maximum green bits, with a minimum of 4 bits
-            GLX_BLUE_SIZE,4,//use the maximum blue bits, with a minimum of 4 bits
-            GLX_DEPTH_SIZE,0,//no depth buffer
-            None
-        };
-    static int attrList2[] = 
-    {
-        GLX_RGBA,//only TrueColor or DirectColor
-            /// single buffered
-            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
-            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
-            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
-            GLX_DEPTH_SIZE,1,/// use the maximum depth bits, making sure there is a depth buffer
-            None
-        };
-    static int attrList1[] =
-        {
-        GLX_RGBA,//only TrueColor or DirectColor
-            GLX_DOUBLEBUFFER,/// only double buffer
-            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
-            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
-            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
-            GLX_DEPTH_SIZE,0,/// no depth buffer
-            None
-        };
-    static int attrList0[] =
-        {
-        GLX_RGBA,//only TrueColor or DirectColor
-            GLX_DOUBLEBUFFER,/// only double buffer
-            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
-            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
-            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
-            GLX_DEPTH_SIZE,1,/// use the maximum depth bits, making sure there is a depth buffer
-            None
-       }; 
-    static int* attrTable[] = 
-        {
-            attrList0,
-            attrList1,
-            attrList2,
-            attrList3,
-            NULL
-        };
-    int** pAttributeTable = attrTable;
-    const SystemEnvData* pChildSysData = NULL;
-    delete pWindow;
-    pWindow=NULL;
-
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    unx::GLXFBConfig* fbconfigs = NULL;
-    int nfbconfigs, value, i = 0;
-#endif
-
-    while( *pAttributeTable )
-    {
-        // try to find a visual for the current set of attributes
-        vi = unx::glXChooseVisual( GLWin.dpy,
-                                   GLWin.screen,
-                                   *pAttributeTable );
-
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-      if( vi ) {
-      if( !firstVisual )
-          firstVisual = vi;
-      OSL_TRACE("trying VisualID %08X", vi->visualid);
-          fbconfigs = glXGetFBConfigs (GLWin.dpy, GLWin.screen, &nfbconfigs);
-          for ( ; i < nfbconfigs; i++)
-          {
-              visinfo = glXGetVisualFromFBConfig (GLWin.dpy, fbconfigs[i]);
-              if( !visinfo || visinfo->visualid != vi->visualid )
-                  continue;
-
-              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i], GLX_DRAWABLE_TYPE, &value);
-              if (!(value & GLX_PIXMAP_BIT))
-                  continue;
-
-              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
-                                    GLX_BIND_TO_TEXTURE_TARGETS_EXT,
-                                    &value);
-              if (!(value & GLX_TEXTURE_2D_BIT_EXT))
-                  continue;
-
-              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
-                                    GLX_BIND_TO_TEXTURE_RGB_EXT,
-                                    &value);
-              if (value == FALSE)
-                  continue;
-
-              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
-                                    GLX_BIND_TO_MIPMAP_TEXTURE_EXT,
-                                    &value);
-              if (value == FALSE)
-                  continue;
-
-              /* TODO: handle non Y inverted cases */
-              break;
-          }
-
-          if( i != nfbconfigs || ( firstVisual && pAttributeTable[1] == NULL ) ) {
-          if( i != nfbconfigs ) {
-          vi = glXGetVisualFromFBConfig( GLWin.dpy, fbconfigs[i] );
-          mbHasTFPVisual = true;
-          OSL_TRACE("found visual suitable for texture_from_pixmap");
-          } else {
-          vi = firstVisual;
-          mbHasTFPVisual = false;
-          OSL_TRACE("did not find visual suitable for texture_from_pixmap, using %08X", vi->visualid);
-          }
-#else
-      if( vi ) {
-#endif
-              SystemWindowData winData;
-              winData.nSize = sizeof(winData);
-          OSL_TRACE("using VisualID %08X", vi->visualid);
-              winData.pVisual = (void*)(vi->visual);
-              pWindow=new SystemChildWindow(pPWindow, 0, &winData, FALSE);
-              pChildSysData = pWindow->GetSystemData();
-              if( pChildSysData ) {
-                  break;
-              } else {
-                  delete pWindow, pWindow=NULL;
-              }
-          }
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-      }
-#endif
-
-        ++pAttributeTable;
-      }
-#endif
-
-#if defined( WNT ) 
-      const SystemEnvData* pChildSysData = NULL;
-      SystemWindowData winData;
-      winData.nSize = sizeof(winData);
-      pWindow=new SystemChildWindow(pPWindow, 0, &winData, FALSE);
-      pChildSysData = pWindow->GetSystemData();
-#endif            
-
-      if( pWindow )
-      {
-      pWindow->SetMouseTransparent( TRUE );
-      pWindow->SetParentClipMode( PARENTCLIPMODE_NOCLIP );
-      pWindow->EnableEraseBackground( FALSE );
-      pWindow->SetControlForeground();
-      pWindow->SetControlBackground();
-      pWindow->EnablePaint(FALSE);
-#if defined( WNT ) 
-        GLWin.hWnd = sysData->hWnd;
-#elif defined( UNX )
-        GLWin.dpy = reinterpret_cast<unx::Display*>(pChildSysData->pDisplay);
-        GLWin.win = pChildSysData->aWindow;
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    if( mbHasTFPVisual )
-        GLWin.fbc = fbconfigs[i];
-#endif
-    GLWin.vi = vi;
-    GLWin.GLXExtensions = unx::glXQueryExtensionsString( GLWin.dpy, GLWin.screen );
-    OSL_TRACE("available GLX extensions: %s", GLWin.GLXExtensions);
-#endif
-
-    return true;
-    }
-
-    return false;
-}
-
-bool OGLTransitionerImpl::initWindowFromSlideShowView( const Reference< presentation::XSlideShowView >& xView )
-{
-    osl::MutexGuard const guard( m_aMutex );
-
-    if (isDisposed())
-        return false;
-
-    mxView.set( xView, UNO_QUERY );
-    if( !mxView.is() )
-    return false;
-
-    /// take the XSlideShowView and extract the parent window from it. see viewmediashape.cxx
-    uno::Reference< rendering::XCanvas > xCanvas(mxView->getCanvas(), uno::UNO_QUERY_THROW);
-    uno::Sequence< uno::Any > aDeviceParams;
-    ::canvas::tools::getDeviceInfo( xCanvas, aDeviceParams );
-
-    ::rtl::OUString aImplName;
-    aDeviceParams[ 0 ] >>= aImplName;
-
-    sal_Int64 aVal = 0;
-    aDeviceParams[1] >>= aVal;
-    if( !createWindow( reinterpret_cast< Window* >( aVal ) ) )
-    return false;
-
-    awt::Rectangle aCanvasArea = mxView->getCanvasArea();
-    pWindow->SetPosSizePixel(aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
-    GLWin.Width = aCanvasArea.Width;
-    GLWin.Height = aCanvasArea.Height;
-    OSL_TRACE("canvas area: %d,%d - %dx%d", aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
-
-#if defined( WNT ) 
-        GLWin.hDC = GetDC(GLWin.hWnd);
-#elif defined( UNX )
-    GLWin.ctx = glXCreateContext(GLWin.dpy,
-                                 GLWin.vi,
-                                 0,
-                                 GL_TRUE);
-    if( GLWin.ctx == NULL ) {
-    OSL_TRACE("unable to create GLX context");
-    return false;
-    }
-#endif
-
-#if defined( WNT ) 
-    PIXELFORMATDESCRIPTOR PixelFormatFront =					// PixelFormat Tells Windows How We Want Things To Be
-    {
-        sizeof(PIXELFORMATDESCRIPTOR),
-        1,								// Version Number
-        PFD_DRAW_TO_WINDOW |
-        PFD_SUPPORT_OPENGL |
-        PFD_DOUBLEBUFFER,
-        PFD_TYPE_RGBA,					// Request An RGBA Format
-        (BYTE)32,						// Select Our Color Depth
-        0, 0, 0, 0, 0, 0,				// Color Bits Ignored
-        0,								// No Alpha Buffer
-        0,								// Shift Bit Ignored
-        0,								// No Accumulation Buffer
-        0, 0, 0, 0,						// Accumulation Bits Ignored
-        64,								// 32 bit Z-BUFFER
-        0,								// 0 bit stencil buffer
-        0,								// No Auxiliary Buffer
-        0,								// now ignored
-        0,								// Reserved
-        0, 0, 0							// Layer Masks Ignored
-    };
-    int WindowPix = ChoosePixelFormat(GLWin.hDC,&PixelFormatFront);
-    SetPixelFormat(GLWin.hDC,WindowPix,&PixelFormatFront);
-    GLWin.hRC  = wglCreateContext(GLWin.hDC);
-    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
-#elif defined( UNX )
-    if( !glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx ) ) {
-        OSL_TRACE("unable to select current GLX context");
-        return false;
-    }
-
-    int glxMinor, glxMajor;
-    mnGLXVersion = 0;
-    if( glXQueryVersion( GLWin.dpy, &glxMajor, &glxMinor ) )
-      mnGLXVersion = glxMajor + 0.1*glxMinor;
-    OSL_TRACE("available GLX version: %f", mnGLXVersion);
-
-    GLWin.GLExtensions = glGetString( GL_EXTENSIONS );
-    OSL_TRACE("available GL  extensions: %s", GLWin.GLExtensions);
-
-    mbTextureFromPixmap = GLWin.HasGLXExtension( "GLX_EXT_texture_from_pixmap" );
-    mbGenerateMipmap = GLWin.HasGLExtension( "GL_SGIS_generate_mipmap" );
-
-    if( GLWin.HasGLXExtension("GLX_SGI_swap_control" ) ) {
-        // enable vsync
-        typedef GLint (*glXSwapIntervalProc)(GLint);
-        glXSwapIntervalProc glXSwapInterval = (glXSwapIntervalProc) unx::glXGetProcAddress( (const GLubyte*) "glXSwapIntervalSGI" );
-        if( glXSwapInterval ) {
-        int (*oldHandler)(unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/);
-
-        // replace error handler temporarily
-        oldHandler = unx::XSetErrorHandler( oglErrorHandler );
-
-        errorTriggered = false;
-
-        glXSwapInterval( 1 );
-
-        // sync so that we possibly get an XError
-        unx::glXWaitGL();
-        XSync(GLWin.dpy, false);
-
-        if( errorTriggered )
-            OSL_TRACE("error when trying to set swap interval, NVIDIA or Mesa bug?");
-        else
-            OSL_TRACE("set swap interval to 1 (enable vsync)");
-
-        // restore the error handler
-        unx::XSetErrorHandler( oldHandler );
-        }
-    }
-#endif
-
-    glEnable(GL_CULL_FACE);
-    glCullFace(GL_BACK);
-    glClearColor (0, 0, 0, 0);
-    glClear(GL_COLOR_BUFFER_BIT);
-#if defined( WNT ) 
-    SwapBuffers(GLWin.hDC);
-#elif defined( UNX )
-    unx::glXSwapBuffers(GLWin.dpy, GLWin.win);
-#endif
-   
-    glEnable(GL_LIGHTING);
-    GLfloat light_direction[] = { 0.0 , 0.0 , 1.0 };
-    GLfloat materialDiffuse[] = { 1.0 , 1.0 , 1.0 , 1.0};
-    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, light_direction);
-    glMaterialfv(GL_FRONT,GL_DIFFUSE,materialDiffuse);
-    glEnable(GL_LIGHT0);
-    glEnable(GL_NORMALIZE);
-
-    if( LeavingBytes.hasElements() && EnteringBytes.hasElements())
-       GLInitSlides();//we already have uninitialized slides, let's initialize 
-
-    if( pTransition && pTransition->mnRequiredGLVersion <= cnGLVersion )
-        pTransition->prepare( GLleavingSlide, GLenteringSlide );
-
-    return true;
-}
-
-void OGLTransitionerImpl::setSlides( const uno::Reference< rendering::XBitmap >& xLeavingSlide, 
-                                     const uno::Reference< rendering::XBitmap >& xEnteringSlide )
-{
-    osl::MutexGuard const guard( m_aMutex );
-
-    if (isDisposed())
-        return;
-        
-    mxLeavingBitmap.set( xLeavingSlide , UNO_QUERY_THROW );
-    mxEnteringBitmap.set( xEnteringSlide , UNO_QUERY_THROW );
-    Reference< XFastPropertySet > xLeavingSet( xLeavingSlide , UNO_QUERY );
-    Reference< XFastPropertySet > xEnteringSet( xEnteringSlide , UNO_QUERY );
-
-    geometry::IntegerRectangle2D SlideRect;
-    SlideSize = mxLeavingBitmap->getSize();
-    SlideRect.X1 = 0;
-    SlideRect.X2 = SlideSize.Width;
-    SlideRect.Y1 = 0;
-    SlideRect.Y2 = SlideSize.Height;
-
-    OSL_TRACE("leaving bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
-    SlideSize = mxEnteringBitmap->getSize();
-    OSL_TRACE("entering bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
-
-#ifdef UNX
-    unx::glXWaitGL();
-    XSync(GLWin.dpy, false);
-#endif
-
-#ifdef DEBUG
-    t1 = microsec_clock::local_time();
-#endif
-
-    mbUseLeavingPixmap = false;
-    mbUseEnteringPixmap = false;
-
-#ifdef UNX
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-
-    if( mnGLXVersion >= 1.2999 && mbTextureFromPixmap && xLeavingSet.is() && xEnteringSet.is() && mbHasTFPVisual ) {
-    Sequence< Any > leaveArgs;
-    Sequence< Any > enterArgs;
-    if( (xLeavingSet->getFastPropertyValue( 1 ) >>= leaveArgs) &&
-        (xEnteringSet->getFastPropertyValue( 1 ) >>= enterArgs) ) {
-        OSL_TRACE ("pixmaps available");
-
-        sal_Int32 depth;
-
-        leaveArgs[0] >>= mbFreeLeavingPixmap;
-        enterArgs[0] >>= mbFreeEnteringPixmap;
-        leaveArgs[1] >>= maLeavingPixmap;
-        enterArgs[1] >>= maEnteringPixmap;
-        leaveArgs[2] >>= depth;
-
-        int pixmapAttribs[] = { GLX_TEXTURE_TARGET_EXT, GLX_TEXTURE_2D_EXT,
-                    GLX_TEXTURE_FORMAT_EXT, GLX_TEXTURE_FORMAT_RGB_EXT,
-                    GLX_MIPMAP_TEXTURE_EXT, True,
-                    None };
-
-
-        // sync so that we possibly get an pending XError, before we set our handler.
-        // this way we will not miss any error from other code
-        unx::glXWaitGL();
-        XSync(GLWin.dpy, false);
-
-        int (*oldHandler)(unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/);
-
-        // replace error handler temporarily
-        oldHandler = unx::XSetErrorHandler( oglErrorHandler );
-
-        errorTriggered = false;
-        LeavingPixmap = glXCreatePixmap( GLWin.dpy, GLWin.fbc, maLeavingPixmap, pixmapAttribs );
-
-        // sync so that we possibly get an XError
-        unx::glXWaitGL();
-        XSync(GLWin.dpy, false);
-
-        if( !errorTriggered )
-        mbUseLeavingPixmap = true;
-        else {
-        OSL_TRACE("XError triggered");
-        if( mbFreeLeavingPixmap ) {
-            unx::XFreePixmap( GLWin.dpy, maLeavingPixmap );
-            mbFreeLeavingPixmap = false;
-        }
-        errorTriggered = false;
-        }
-          
-        EnteringPixmap = glXCreatePixmap( GLWin.dpy, GLWin.fbc, maEnteringPixmap, pixmapAttribs );
-
-        // sync so that we possibly get an XError
-        unx::glXWaitGL();
-        XSync(GLWin.dpy, false);
-
-        OSL_TRACE("created glx pixmap %p and %p depth: %d", LeavingPixmap, EnteringPixmap, depth);
-        if( !errorTriggered )
-        mbUseEnteringPixmap = true;
-        else {
-        OSL_TRACE("XError triggered");
-        if( mbFreeEnteringPixmap ) {
-            unx::XFreePixmap( GLWin.dpy, maEnteringPixmap );
-            mbFreeEnteringPixmap = false;
-        }
-        }
-
-        // restore the error handler
-        unx::XSetErrorHandler( oldHandler );
-    }
-    }
-
-#endif
-#endif
-    if( !mbUseLeavingPixmap )
-    LeavingBytes = mxLeavingBitmap->getData(SlideBitmapLayout,SlideRect);
-    if( !mbUseEnteringPixmap )
-    EnteringBytes = mxEnteringBitmap->getData(SlideBitmapLayout,SlideRect);
-
-// TODO    
-#ifdef UNX
-    if(GLWin.ctx)//if we have a rendering context, let's init the slides
-#endif
-    GLInitSlides();
-
-    OSL_ENSURE(SlideBitmapLayout.PlaneStride == 0,"only handle no plane stride now");
-
-#ifdef UNX
-    /* flush & sync */
-    unx::glXWaitGL();
-    XSync( GLWin.dpy, false );
-
-    // synchronized X still gives us much smoother play
-    // I suspect some issues in above code in slideshow
-    // synchronize whole transition for now
-    XSynchronize( GLWin.dpy, true );
-    mbRestoreSync = true;
-#endif
-}
-
-void OGLTransitionerImpl::createTexture( unsigned int* texID,
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-                     unx::GLXPixmap pixmap,
-                     bool usePixmap,
-#endif
-                     bool useMipmap,
-                     uno::Sequence<sal_Int8>& data,
-                     const OGLFormat* pFormat )
-{
-    glDeleteTextures( 1, texID );
-    glGenTextures( 1, texID );
-    glBindTexture( GL_TEXTURE_2D, *texID );
-    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT );
-    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT );
-
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    unx::PFNGLXBINDTEXIMAGEEXTPROC myglXBindTexImageEXT = (unx::PFNGLXBINDTEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXBindTexImageEXT" );
-
-    if( usePixmap ) {
-      if( mbGenerateMipmap )
-          glTexParameteri( GL_TEXTURE_2D, GL_GENERATE_MIPMAP_SGIS, True);
-      myglXBindTexImageEXT (GLWin.dpy, pixmap, GLX_FRONT_LEFT_EXT, NULL);
-      if( mbGenerateMipmap && useMipmap ) {
-          OSL_TRACE("use mipmaps");
-          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
-          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
-      } else {
-          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
-          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
-      }
-    } else {
-#endif
-    if( !pFormat )
-    {
-        // force-convert color to ARGB8888 int color space  
-        uno::Sequence<sal_Int8> tempBytes(
-            SlideBitmapLayout.ColorSpace->convertToIntegerColorSpace(
-                data,
-                canvas::tools::getStdColorSpace()));
-        gluBuild2DMipmaps(GL_TEXTURE_2D, 
-                          4, 
-                          SlideSize.Width, 
-                          SlideSize.Height, 
-                          GL_RGBA, 
-                          GL_UNSIGNED_BYTE,
-                          &tempBytes[0]);
-    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
-    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
-
-        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
-    GLfloat largest_supported_anisotropy;
-    glGetFloatv(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy);
-    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy);
-    } else {
-    if( pTransition && !cbBrokenTexturesATI && !useMipmap) {
-        glTexImage2D( GL_TEXTURE_2D, 0, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, 0, pFormat->eFormat, pFormat->eType, &data[0] );
-        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
-        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
-    } else {
-        gluBuild2DMipmaps( GL_TEXTURE_2D, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, pFormat->eFormat, pFormat->eType, &data[0] );
-        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR );
-        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR ); //TRILINEAR FILTERING
-
-        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
-        GLfloat largest_supported_anisotropy;
-        glGetFloatv( GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy );
-        glTexParameterf( GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy );
-    }
-    }
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    }
-#endif
-    OSL_ENSURE(glIsTexture(*texID), "Can't generate Leaving slide textures in OpenGL");
-}
-
-void OGLTransitionerImpl::prepareEnvironment()
-{
-    glMatrixMode(GL_PROJECTION);
-    glLoadIdentity();
-    double EyePos(10.0);
-    double RealF(1.0);
-    double RealN(-1.0);
-    double RealL(-1.0);
-    double RealR(1.0);
-    double RealB(-1.0);
-    double RealT(1.0);
-    double ClipN(EyePos+5.0*RealN);
-    double ClipF(EyePos+15.0*RealF);
-    double ClipL(RealL*8.0);
-    double ClipR(RealR*8.0);
-    double ClipB(RealB*8.0);
-    double ClipT(RealT*8.0);
-    //This scaling is to take the plane with BottomLeftCorner(-1,-1,0) and TopRightCorner(1,1,0) and map it to the screen after the perspective division.
-    glScaled( 1.0 / ( ( ( RealR * 2.0 * ClipN ) / ( EyePos * ( ClipR - ClipL ) ) ) - ( ( ClipR + ClipL ) / ( ClipR - ClipL ) ) ),
-              1.0 / ( ( ( RealT * 2.0 * ClipN ) / ( EyePos * ( ClipT - ClipB ) ) ) - ( ( ClipT + ClipB ) / ( ClipT - ClipB ) ) ),
-              1.0 );
-    glFrustum(ClipL,ClipR,ClipB,ClipT,ClipN,ClipF);
-    glMatrixMode(GL_MODELVIEW);
-    glLoadIdentity();
-    glTranslated(0,0,-EyePos);
-}
-
-const OGLFormat* OGLTransitionerImpl::chooseFormats()
-{
-    const OGLFormat* pDetectedFormat=NULL;
-    uno::Reference<rendering::XIntegerBitmapColorSpace> xIntColorSpace(
-        SlideBitmapLayout.ColorSpace);
-
-    if( (xIntColorSpace->getType() == rendering::ColorSpaceType::RGB ||
-         xIntColorSpace->getType() == rendering::ColorSpaceType::SRGB) )
-    {
-        /* table for canvas->OGL format mapping. outer index is number
-           of color components (0:3, 1:4), then comes bits per pixel
-           (0:16, 1:24, 2:32), then channel ordering: (0:rgba, 1:bgra,
-           2:argb, 3:abgr)
-         */
-        static const OGLFormat lcl_RGB24[] = 
-        {
-            // 24 bit RGB
-            {3, GL_BGR, GL_UNSIGNED_BYTE},
-            {3, GL_RGB, GL_UNSIGNED_BYTE},
-            {3, GL_BGR, GL_UNSIGNED_BYTE},
-            {3, GL_RGB, GL_UNSIGNED_BYTE}
-        };
-
-#if defined(GL_VERSION_1_2) && defined(GLU_VERSION_1_3)
-        // more format constants available
-        static const OGLFormat lcl_RGB16[] = 
-        {
-            // 16 bit RGB
-            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
-            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5},
-            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
-            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5}
-        };
-
-        static const OGLFormat lcl_ARGB16_4[] = 
-        {
-            // 16 bit ARGB
-            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
-            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
-            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4},
-            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4}
-        };
-
-        static const OGLFormat lcl_ARGB16_5[] = 
-        {
-            // 16 bit ARGB
-            {4, GL_RGBA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
-            {4, GL_BGRA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
-            {4, GL_BGRA, GL_UNSIGNED_SHORT_5_5_5_1},
-            {4, GL_RGBA, GL_UNSIGNED_SHORT_5_5_5_1}
-        };
-
-        static const OGLFormat lcl_ARGB32[] = 
-        {
-            // 32 bit ARGB
-            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8_REV},
-            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV},
-            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8},
-            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8}
-        };
-
-        const uno::Sequence<sal_Int8> aComponentTags(
-            xIntColorSpace->getComponentTags());
-        const uno::Sequence<sal_Int32> aComponentBitcounts(
-            xIntColorSpace->getComponentBitCounts());
-        const sal_Int32 nNumComponents( aComponentBitcounts.getLength() );
-        const sal_Int32 nBitsPerPixel( xIntColorSpace->getBitsPerPixel() );
-
-        // supported component ordering?
-        const int nComponentOrderIndex(
-            calcComponentOrderIndex(aComponentTags));
-        if( nComponentOrderIndex != -1 ) 
-        {
-            switch( nBitsPerPixel )
-            {
-                case 16:
-                    if( nNumComponents == 3 )
-                    {
-                        pDetectedFormat = &lcl_RGB16[nComponentOrderIndex];
-                    }
-                    else if( nNumComponents == 4 )
-                    {
-                        if( aComponentBitcounts[1] == 4 )
-                        {
-                            pDetectedFormat = &lcl_ARGB16_4[nComponentOrderIndex];
-                        }
-                        else if( aComponentBitcounts[1] == 5 )
-                        {
-                            pDetectedFormat = &lcl_ARGB16_5[nComponentOrderIndex];
-                        }
-                    }
-                    break;
-                case 24:
-                    if( nNumComponents == 3 )
-                    {
-                        pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
-                    }
-                    break;
-                case 32:
-                    pDetectedFormat = &lcl_ARGB32[nComponentOrderIndex];
-                    break;
-            }
-        }
-#else
-        const uno::Sequence<sal_Int8> aComponentTags(
-            xIntColorSpace->getComponentTags());
-        const int nComponentOrderIndex(calcComponentOrderIndex(aComponentTags));
-        if( aComponentTags.getLength() == 3 && 
-            nComponentOrderIndex != -1 && 
-            xIntColorSpace->getBitsPerPixel() == 24 )
-        {
-            pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
-        }
-#endif
-    }
-
-    return pDetectedFormat;
-}
-
-void OGLTransitionerImpl::GLInitSlides()
-{
-    osl::MutexGuard const guard( m_aMutex );
-
-    if (isDisposed() || pTransition->mnRequiredGLVersion > cnGLVersion)
-        return;
-
-    prepareEnvironment();
-
-    const OGLFormat* pFormat = NULL;
-    if( !mbUseLeavingPixmap || !mbUseEnteringPixmap )
-    pFormat = chooseFormats();
-
-    createTexture( &GLleavingSlide,
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-           LeavingPixmap,
-           mbUseLeavingPixmap,
-#endif
-           pTransition->mbUseMipMapLeaving,
-           LeavingBytes,
-           pFormat );
-
-    createTexture( &GLenteringSlide,
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-           EnteringPixmap,
-           mbUseEnteringPixmap,
-#endif
-           pTransition->mbUseMipMapEntering,
-           EnteringBytes,
-           pFormat );
-
-#ifdef UNX
-    unx::glXWaitGL();
-    XSync(GLWin.dpy, false);
-#endif
-
-#ifdef DEBUG
-    t2 = microsec_clock::local_time();
-    OSL_TRACE("textures created in: %s", to_simple_string( t2 - t1 ).c_str());
-#endif
-}
-
-void SAL_CALL OGLTransitionerImpl::update( double nTime ) throw (uno::RuntimeException)
-{
-#ifdef DEBUG
-    frame_count ++;
-    t3 = microsec_clock::local_time();
-    if( frame_count == 1 ) {
-    t5 = t3;
-    total_update = seconds (0);
-    }
-#endif
-    osl::MutexGuard const guard( m_aMutex );
-
-    if (isDisposed() || !cbGLXPresent || pTransition->mnRequiredGLVersion > cnGLVersion)
-        return;
-
-#ifdef WNT
-    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
-#endif
-#ifdef UNX
-    glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx );
-#endif
-
-    glEnable(GL_DEPTH_TEST);
-    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
-
-    if(pTransition)
-    pTransition->display( nTime, GLleavingSlide, GLenteringSlide, 
-                              SlideSize.Width, SlideSize.Height,
-                              static_cast<double>(GLWin.Width),
-                              static_cast<double>(GLWin.Height) );
-
-#if defined( WNT ) 
-    SwapBuffers(GLWin.hDC);
-#elif defined( UNX )
-    unx::glXSwapBuffers(GLWin.dpy, GLWin.win);
-#endif
-    if( pWindow )
-        pWindow->Show();
-
-#ifdef UNX
-    /* flush & sync */
-    unx::glXWaitGL();
-    XSync( GLWin.dpy, false );
-#endif
-
-#ifdef DEBUG
-    t4 = microsec_clock::local_time();
-
-    OSL_TRACE("update time: %f", nTime);
-    OSL_TRACE("update took: %s", to_simple_string( t4 - t3 ).c_str());
-    total_update += (t4 - t3);
-#endif
-}
-
-void SAL_CALL OGLTransitionerImpl::viewChanged( const Reference< presentation::XSlideShowView >& rView,
-                        const Reference< rendering::XBitmap >& rLeavingBitmap,
-                        const Reference< rendering::XBitmap >& rEnteringBitmap )
-    throw (uno::RuntimeException)
-{
-    OSL_TRACE("transitioner: view changed");
-
-    disposeTextures();
-    disposeContextAndWindow();
-
-    initWindowFromSlideShowView( rView );
-    setSlides( rLeavingBitmap, rEnteringBitmap );
-}
-
-void OGLTransitionerImpl::disposeContextAndWindow()
-{
-#if defined( WNT )
-    if (GLWin.hRC)
-    {
-    wglMakeCurrent( GLWin.hDC, 0 );		// kill Device Context
-    wglDeleteContext( GLWin.hRC );		// Kill Render Context
-    ReleaseDC( GLWin.hWnd, GLWin.hDC );         // Release Window
-    }
-#elif defined( UNX )
-    if(GLWin.ctx)
-    {
-    glXMakeCurrent(GLWin.dpy, None, NULL);
-    if( glGetError() != GL_NO_ERROR ) {
-        OSL_TRACE("glError: %s", (char *)gluErrorString(glGetError()));
-    }
-    glXDestroyContext(GLWin.dpy, GLWin.ctx);
-    GLWin.ctx = NULL;
-    }
-#endif
-    if( pWindow ) {
-    delete pWindow;
-    pWindow = NULL;
-    GLWin.win = 0;
-    }
-}
-
-void OGLTransitionerImpl::disposeTextures()
-{
-#ifdef WNT
-    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
-#endif
-#ifdef UNX
-    glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx );
-#endif
-
-#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
-    unx::PFNGLXRELEASETEXIMAGEEXTPROC myglXReleaseTexImageEXT = (unx::PFNGLXRELEASETEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXReleaseTexImageEXT" );
-    if( mbUseLeavingPixmap ) {
-
-    myglXReleaseTexImageEXT( GLWin.dpy, LeavingPixmap, GLX_FRONT_LEFT_EXT );
-    glXDestroyGLXPixmap( GLWin.dpy, LeavingPixmap );
-    LeavingPixmap = 0;
-    if( mbFreeLeavingPixmap ) {
-        unx::XFreePixmap( GLWin.dpy, maLeavingPixmap );
-        mbFreeLeavingPixmap = false;
-        maLeavingPixmap = 0;
-    }
-    }
-    if( mbUseEnteringPixmap ) {
-    myglXReleaseTexImageEXT( GLWin.dpy, EnteringPixmap, GLX_FRONT_LEFT_EXT );
-    glXDestroyGLXPixmap( GLWin.dpy, EnteringPixmap );
-    EnteringPixmap = 0;
-    if( mbFreeEnteringPixmap ) {
-        unx::XFreePixmap( GLWin.dpy, maEnteringPixmap );
-        mbFreeEnteringPixmap = false;
-        maEnteringPixmap = 0;
-    }
-    }
-#endif
-
-    if( !mbUseLeavingPixmap ) {
-    glDeleteTextures(1,&GLleavingSlide);
-    GLleavingSlide = 0;
-    }
-    if( !mbUseEnteringPixmap ) {
-    glDeleteTextures(1,&GLenteringSlide);
-    GLleavingSlide = 0;
-    }
-
-    mbUseLeavingPixmap = false;
-    mbUseEnteringPixmap = false;
-}
-
-// we are about to be disposed (someone call dispose() on us)
-void OGLTransitionerImpl::disposing()
-{
-    osl::MutexGuard const guard( m_aMutex );
-
-#ifdef DEBUG
-    OSL_TRACE("dispose %p\n", this);
-    if( frame_count ) {
-    t6 = microsec_clock::local_time();
-    time_duration duration = t6 - t5;
-    OSL_TRACE("whole transition (frames: %d) took: %s fps: %f time spent in updates: %s percentage of transition time: %f%%",
-          frame_count, to_simple_string( duration ).c_str(),
-          ((double)frame_count*1000000000.0)/duration.total_nanoseconds(),
-          to_simple_string( total_update ).c_str(),
-          100*(((double)total_update.total_nanoseconds())/((double)duration.total_nanoseconds()))
-        );
-    }
-#endif
-
-    if( pWindow ) {
-
-    disposeTextures();
-
-    if (pTransition)
-        pTransition->finish();
-
-#ifdef UNX
-    if( mbRestoreSync ) {
-        // try to reestablish synchronize state
-        char* sal_synchronize = getenv("SAL_SYNCHRONIZE");
-        XSynchronize( GLWin.dpy, sal_synchronize && *sal_synchronize == '1' );
-    }
-#endif
-
-    disposeContextAndWindow();
-    }
-
-    if (pTransition)
-    delete pTransition;
-
-    mxLeavingBitmap.clear();
-    mxEnteringBitmap.clear();
-    mxView.clear();
-}
-
-OGLTransitionerImpl::OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition) : 
-    OGLTransitionerImplBase(m_aMutex), 
-    GLWin(),
-    GLleavingSlide( 0 ), 
-    GLenteringSlide( 0 ), 
-    pWindow( NULL ), 
-    mxView(),
-    EnteringBytes(),
-    LeavingBytes(),
-    mbRestoreSync( false ),
-    mbUseLeavingPixmap( false ),
-    mbUseEnteringPixmap( false ),
-    SlideBitmapLayout(),
-    SlideSize(),
-    pTransition(pOGLTransition)
-{
-#if defined( WNT )
-    GLWin.hWnd = 0;
-#elif defined( UNX )
-    GLWin.ctx = 0;
-#endif
-
-    DBG(frame_count = 0);
-}
-
-typedef cppu::WeakComponentImplHelper1<presentation::XTransitionFactory> OGLTransitionFactoryImplBase;
-
-class OGLTransitionFactoryImpl : private cppu::BaseMutex, public OGLTransitionFactoryImplBase
-{
-public:
-    explicit OGLTransitionFactoryImpl( const uno::Reference< uno::XComponentContext >& ) :
-        OGLTransitionFactoryImplBase(m_aMutex)
-    {}
-
-    // XTransitionFactory
-    virtual ::sal_Bool SAL_CALL hasTransition( ::sal_Int16 transitionType, ::sal_Int16 transitionSubType ) throw (uno::RuntimeException)
-    {
-        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
-            switch( transitionSubType )
-                {
-                case animations::TransitionSubType::ACROSS:
-                case animations::TransitionSubType::CORNERSOUT:
-                case animations::TransitionSubType::CIRCLE:
-                case animations::TransitionSubType::FANOUTHORIZONTAL:
-                case animations::TransitionSubType::CORNERSIN:  
-                case animations::TransitionSubType::LEFTTORIGHT:
-                case animations::TransitionSubType::TOPTOBOTTOM:
-                case animations::TransitionSubType::TOPRIGHT:
-                case animations::TransitionSubType::TOPLEFT:
-                case animations::TransitionSubType::BOTTOMRIGHT:
-                case animations::TransitionSubType::BOTTOMLEFT:
-                case animations::TransitionSubType::TOPCENTER:
-                case animations::TransitionSubType::RIGHTCENTER:
-                case animations::TransitionSubType::BOTTOMCENTER:
-                    return sal_True;
-
-                default:
-                    return sal_False;
-                }
-        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
-            return sal_True;
-        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
-            return sal_True;
-        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
-            return sal_True;
-        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
-            return sal_True;
-        } else
-            return sal_False;
-    }
-
-    virtual uno::Reference< presentation::XTransition > SAL_CALL createTransition( 
-        ::sal_Int16                                           transitionType, 
-        ::sal_Int16                                           transitionSubType, 
-        const uno::Reference< presentation::XSlideShowView >& view, 
-        const uno::Reference< rendering::XBitmap >&           leavingBitmap, 
-        const uno::Reference< rendering::XBitmap >&           enteringBitmap )
-    throw (uno::RuntimeException)
-    {
-        if( !hasTransition( transitionType, transitionSubType ) )
-            return uno::Reference< presentation::XTransition >();
-
-        bool bGLXPresent = OGLTransitionerImpl::initialize( view );
-
-        if( OGLTransitionerImpl::cbMesa && (
-            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) ||
-            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) ||
-            ( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) ) )
-            return uno::Reference< presentation::XTransition >();
-            
-
-        OGLTransitionImpl* pTransition = NULL;
-
-        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
-            pTransition = new OGLTransitionImpl();
-            switch( transitionSubType )
-                {
-                case animations::TransitionSubType::ACROSS:
-                    pTransition->makeNByMTileFlip(8,6);
-                    break;   
-                case animations::TransitionSubType::CORNERSOUT:
-                    pTransition->makeOutsideCubeFaceToLeft();
-                    break;            
-                case animations::TransitionSubType::CIRCLE:
-                    pTransition->makeRevolvingCircles(8,128);
-                    break;
-                case animations::TransitionSubType::FANOUTHORIZONTAL:
-                    pTransition->makeHelix(20);
-                    break;
-                case animations::TransitionSubType::CORNERSIN:  
-                    pTransition->makeInsideCubeFaceToLeft();
-                    break;
-                case animations::TransitionSubType::LEFTTORIGHT:
-                    pTransition->makeFallLeaving();
-                    break;
-                case animations::TransitionSubType::TOPTOBOTTOM:
-                    pTransition->makeTurnAround();
-                    break;
-                case animations::TransitionSubType::TOPRIGHT:
-                    pTransition->makeTurnDown();
-                    break;
-                case animations::TransitionSubType::TOPLEFT:
-                    pTransition->makeIris();
-                    break;
-                case animations::TransitionSubType::BOTTOMRIGHT:
-                    pTransition->makeRochade();
-                    break;
-                case animations::TransitionSubType::BOTTOMLEFT:
-                    pTransition->makeVenetianBlinds( true, 8 );
-                    break;
-                case animations::TransitionSubType::TOPCENTER:
-                    pTransition->makeVenetianBlinds( false, 6 );
-                    break;
-                case animations::TransitionSubType::RIGHTCENTER:
-                    pTransition->makeStatic();
-                    break;
-                case animations::TransitionSubType::BOTTOMCENTER:
-                    pTransition->makeDissolve();
-                    break;
-                }
-        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
-            pTransition = new OGLTransitionImpl();
-            pTransition->makeFadeSmoothly();
-        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
-            pTransition = new OGLTransitionImpl();
-            pTransition->makeFadeThroughBlack();
-        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
-            pTransition = new OGLTransitionImpl();
-            pTransition->makeDiamond();
-        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
-            pTransition = new OGLTransitionImpl();
-            pTransition->makeNewsflash();
-        }
-
-        rtl::Reference<OGLTransitionerImpl> xRes(
-            new OGLTransitionerImpl(pTransition) );
-        if( bGLXPresent ) {
-            if( !xRes->initWindowFromSlideShowView(view))
-                return uno::Reference< presentation::XTransition >();
-            xRes->setSlides(leavingBitmap,enteringBitmap);
-        }
-
-        return uno::Reference<presentation::XTransition>(xRes.get());
-    }
-};
-
-}
-
-namespace sdecl = comphelper::service_decl;
-#if defined (__GNUC__) && (__GNUC__ == 3 && __GNUC_MINOR__ <= 3)
- sdecl::class_<OGLTransitionFactoryImpl> serviceImpl;
- const sdecl::ServiceDecl OGLTransitionFactoryDecl(
-     serviceImpl,
-#else
- const sdecl::ServiceDecl OGLTransitionFactoryDecl(
-     sdecl::class_<OGLTransitionFactoryImpl>(),
-#endif
-    "com.sun.star.comp.presentation.OGLTransitionFactory",
-    "com.sun.star.presentation.TransitionFactory" );
-
-// The C shared lib entry points
-COMPHELPER_SERVICEDECL_EXPORTS1(OGLTransitionFactoryDecl)
diff --git slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.h slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.h
new file mode 100644
index 0000000..2ec5be5
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.h
@@ -0,0 +1,94 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: $
+ * $Revision: $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef INCLUDED_OGLTRANS_SHADERS_HXX_
+#define INCLUDED_OGLTRANS_SHADERS_HXX_
+
+/* FIXME : Really needed ? */
+#define GL_GLEXT_PROTOTYPES 1
+
+/* Required Includes */
+#import <Cocoa/Cocoa.h>
+#import <OpenGL/gl.h>
+#import <OpenGL/glext.h>
+#import <OpenGL/glu.h>
+#import <OpenGL/OpenGL.h>
+#import <GLUT/glut.h>
+
+/* Parameter */
+typedef struct _Parameter {
+    float current [4];
+    float min     [4];
+    float max     [4];
+    float delta   [4];
+    
+} Parameter;
+
+/* Macros */
+#define PARAMETER_CURRENT(p)    (p.current)
+#define PARAMETER_ANIMATE(p)    ({ int i; for (i = 0; i < 4; i ++) { \
+                                            p.current[i] += p.delta[i]; \
+                                            if ((p.current[i] < p.min[i]) || (p.current[i] > p.max[i])) \
+                                                p.delta[i] = -p.delta[i]; } } )
+                                                
+/* OGLShaders base class */
+@interface OGLShaders : NSObject 
+{
+    BOOL initialised;
+    GLhandleARB vertex_shader;
+    GLhandleARB fragment_shader;
+    GLhandleARB program_object;
+    GLUquadric *quadric;
+    BOOL gpuProcessingInit;
+    BOOL gpuProcessing;
+}
+- (id) init;
+- (void) initLazy;
+- (void) dealloc;
+- (NSString *) name;
+- (NSString *) descriptionFilename;
+- (unsigned int) loadVertexShader: (NSString *) vertexString fragmentShader: (NSString *) fragmentString;
+
+ /* if!initialized -> initLazy */
+- (void) renderFrame;
+
+/* Check whether software rasterization or software vertex processing will be used */
+- (BOOL) reflect;
+
+@end
+
+
+// Utility Functions
+
+int NextHighestPowerOf2(int n);
+void CopyFramebufferToTexture(GLuint texture);
+NSBitmapImageRep *LoadImage(NSString *path, int shouldFlipVertical);
+
+#endif
diff --git slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.m slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.m
new file mode 100644
index 0000000..73c76ce
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/OGLTrans_Shaders_MACOSX.m
@@ -0,0 +1,236 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: $
+ * $Revision: $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+//#include <osl/diagnose.hxx>
+
+#import "OGLTrans_Shaders_MACOSX.h"
+
+
+@implementation OGLShaders
+
+- (id) init
+{
+  [super init];
+  gpuProcessingInit = NO;
+  return self;
+}
+
+- (void) initLazy
+{
+  /* Subclass should put initialisation code that can be performaned
+     lazily (on first frame render) here */
+  initialised = TRUE;
+  
+  /* Create a GLU quadric, used for rendering certain geometry */
+  quadric = gluNewQuadric();
+  gluQuadricDrawStyle(quadric, GLU_FILL);
+  gluQuadricNormals(quadric, GL_SMOOTH);
+  gluQuadricTexture(quadric, GL_TRUE);
+
+}
+
+- (void) dealloc
+{
+  /* Free the GLU quadric */
+  if (quadric)
+    gluDeleteQuadric(quadric);
+
+  [super dealloc];
+}
+
+- (NSString *) name
+{
+  return @"Unnamed OGLShaders";
+}
+
+- (NSString *) descriptionFilename
+{
+  return NULL;
+}
+
+- (unsigned int) loadVertexShader: (NSString *) vertexString fragmentShader: (NSString *) fragmentString
+{
+  const GLcharARB *vertex_string;
+  const GLcharARB *fragment_string;
+  GLint vertex_compiled;
+  GLint fragment_compiled;
+  GLint linked;
+  
+  /* Delete any existing program object */
+  if (program_object) {
+    glDeleteObjectARB(program_object);
+    program_object = NULL;
+  }
+  
+  /* Load and compile both shaders */
+  if (vertexString) {
+    vertex_shader   = glCreateShaderObjectARB(GL_VERTEX_SHADER_ARB);
+    vertex_string   = (GLcharARB *) [vertexString cString];
+    glShaderSourceARB(vertex_shader, 1, &vertex_string, NULL);
+    glCompileShaderARB(vertex_shader);
+    glGetObjectParameterivARB(vertex_shader, GL_OBJECT_COMPILE_STATUS_ARB, &vertex_compiled);
+    /* TODO - Get info log */
+  } else {
+    vertex_shader   = NULL;
+    vertex_compiled = 1;
+  }
+    
+  if (fragmentString) {
+    fragment_shader   = glCreateShaderObjectARB(GL_FRAGMENT_SHADER_ARB);
+    fragment_string   = [fragmentString cString];
+    glShaderSourceARB(fragment_shader, 1, &fragment_string, NULL);
+    glCompileShaderARB(fragment_shader);
+    glGetObjectParameterivARB(fragment_shader, GL_OBJECT_COMPILE_STATUS_ARB, &fragment_compiled);
+    /* TODO - Get info log */
+  } else {
+    fragment_shader   = NULL;
+    fragment_compiled = 1;
+  }
+  
+  /* Ensure both shaders compiled */
+  if (!vertex_compiled || !fragment_compiled) {
+    if (vertex_shader) {
+      glDeleteObjectARB(vertex_shader);
+      vertex_shader   = NULL;
+    }
+    if (fragment_shader) {
+      glDeleteObjectARB(fragment_shader);
+      fragment_shader = NULL;
+    }
+    return 1;
+  }
+    
+  /* Create a program object and link both shaders */
+  program_object = glCreateProgramObjectARB();
+  if (vertex_shader != NULL)
+  {
+    glAttachObjectARB(program_object, vertex_shader);
+    glDeleteObjectARB(vertex_shader);   /* Release */
+  }
+  if (fragment_shader != NULL)
+  {
+    glAttachObjectARB(program_object, fragment_shader);
+    glDeleteObjectARB(fragment_shader); /* Release */
+  }
+  glLinkProgramARB(program_object);
+  glGetObjectParameterivARB(program_object, GL_OBJECT_LINK_STATUS_ARB, &linked);
+  /* TODO - Get info log */
+  
+  if (!linked) {
+    glDeleteObjectARB(program_object);
+    program_object = NULL;
+    return 1;
+  }
+  
+  return 0;
+}
+
+- (void) renderFrame
+{
+  if (!initialised)
+    [self initLazy];
+}
+
+- (BOOL) reflect
+{
+  if(!gpuProcessingInit)
+  {
+    /* Check if this will fall back to software rasterization or
+       software vertex processing and don't reflect if it is. */
+
+    GLint fragmentGPUProcessing, vertexGPUProcessing;
+    gpuProcessingInit = YES;
+
+    glPushAttrib(GL_VIEWPORT_BIT);
+    glViewport(0,0,0,0);
+    glPushMatrix();
+    [self renderFrame];
+    glPopMatrix();
+    CGLGetParameter(CGLGetCurrentContext(), kCGLCPGPUFragmentProcessing, &fragmentGPUProcessing);
+    CGLGetParameter(CGLGetCurrentContext(), kCGLCPGPUVertexProcessing, &vertexGPUProcessing);
+    gpuProcessing = (fragmentGPUProcessing && vertexGPUProcessing) ? YES : NO;
+    glPopAttrib();
+  }
+
+  return gpuProcessing;
+}
+
+@end
+
+
+// Utility Functions
+
+int NextHighestPowerOf2(int n)
+{
+  n--;
+  n |= n >> 1; 
+  n |= n >> 2;
+  n |= n >> 4;
+  n |= n >> 8;
+  n |= n >> 16;
+  n++;
+  return n;
+}
+
+void CopyFramebufferToTexture(GLuint texture)
+{
+  GLint viewport[4];
+  glGetIntegerv(GL_VIEWPORT, viewport);
+  glBindTexture(GL_TEXTURE_2D, texture);
+  glCopyTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, viewport[0], viewport[1], NextHighestPowerOf2(viewport[2]), NextHighestPowerOf2(viewport[3]), 0);
+}
+
+NSBitmapImageRep *LoadImage(NSString *path, int shouldFlipVertical)
+{
+  NSBitmapImageRep *bitmapimagerep;
+  NSImage *image;
+  image = [[[NSImage alloc] initWithContentsOfFile: path] autorelease];
+  bitmapimagerep = [[NSBitmapImageRep alloc] initWithData:[image TIFFRepresentation]];
+  
+  if (shouldFlipVertical)
+  {
+    int bytesPerRow, lowRow, highRow;
+    unsigned char *pixelData, *swapRow;
+    
+    bytesPerRow = [bitmapimagerep bytesPerRow];
+    pixelData = [bitmapimagerep bitmapData];
+
+    swapRow = (unsigned char *)malloc(bytesPerRow);
+    for (lowRow = 0, highRow = [bitmapimagerep pixelsHigh]-1; lowRow < highRow; lowRow++, highRow--)
+    {
+      memcpy(swapRow, &pixelData[lowRow*bytesPerRow], bytesPerRow);
+      memcpy(&pixelData[lowRow*bytesPerRow], &pixelData[highRow*bytesPerRow], bytesPerRow);
+      memcpy(&pixelData[highRow*bytesPerRow], swapRow, bytesPerRow);
+    }
+    free(swapRow);
+  }
+
+  return bitmapimagerep;
+}
diff --git slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl.hxx slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl.hxx
new file mode 100644
index 0000000..316f683
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl.hxx
@@ -0,0 +1,501 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionImpl.hxx,v $
+ * $Revision: 1.5.12.1 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
+#define INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
+
+#include <basegfx/vector/b2dvector.hxx>
+#include <basegfx/vector/b3dvector.hxx>
+
+#include <tools/prewin.h>
+#include <tools/postwin.h>
+
+#include <OpenGL/gl.h>
+#include <vector>
+
+using namespace std;
+
+class Primitive;
+class Operation;
+class SceneObject;
+
+
+/** OpenGL 3D Transition class. It implicitly is constructed from XOGLTransition
+
+    This class is capable of making itself into many difference transitions. It holds Primitives and Operations on those primitives.
+*/
+class OGLTransitionImpl
+{
+public:
+    OGLTransitionImpl() :
+        mbUseMipMapLeaving( true ),
+        mbUseMipMapEntering( true ),
+        mnRequiredGLVersion( 1.0 ),
+        maLeavingSlidePrimitives(),
+        maEnteringSlidePrimitives(),
+        maSceneObjects(),
+        mbReflectSlides( false ),
+        mVertexObject( 0 ),
+        mFragmentObject( 0 ),
+        mProgramObject( 0 ),
+        maHelperTexture( 0 ),
+        mmPrepare( NULL ),
+        mmPrepareTransition( NULL ),
+        mmClearTransition( NULL ),
+        mmDisplaySlides( NULL )
+    {}
+
+    ~OGLTransitionImpl();
+    
+    void prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
+    void finish();
+
+    void makeOutsideCubeFaceToLeft();
+    void makeInsideCubeFaceToLeft();
+    void makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m );
+    void makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles );
+    void makeHelix( ::sal_uInt16 nRows );
+    void makeFallLeaving();
+    void makeTurnAround();
+    void makeTurnDown();
+    void makeIris();
+    void makeRochade();
+    void makeVenetianBlinds( bool vertical, int parts );
+    void makeStatic();
+    void makeDissolve();
+    void makeNewsflash();
+
+    /** 2D replacements
+     */
+    void makeDiamond();
+    void makeFadeSmoothly();
+    void makeFadeThroughBlack();
+
+    /** Whether to use mipmaping for slides textures
+     */
+    bool mbUseMipMapLeaving;
+    bool mbUseMipMapEntering;
+
+    /** which GL version does the transition require
+     */
+    float mnRequiredGLVersion;
+
+private:
+    /** clears all the primitives and operations
+    */
+    void clear();
+    
+    /** All the primitives that use the leaving slide texture
+    */
+    vector<Primitive> maLeavingSlidePrimitives;
+    
+    /** All the primitives that use the leaving slide texture
+    */
+    vector<Primitive> maEnteringSlidePrimitives;
+    
+    /** All the surrounding scene objects
+    */
+    vector<SceneObject*> maSceneObjects;
+
+    /** All the operations that should be applied to both leaving and entering slide primitives. These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
+    */
+    vector<Operation*> OverallOperations;
+
+    /** Whether to reflect slides, the reflection happens on flat surface beneath the slides.
+     ** Now it only works with slides which keep their rectangular shape together.
+     */
+    bool mbReflectSlides;
+
+    /** GLSL objects, shaders and program
+     */
+    GLuint mVertexObject, mFragmentObject, mProgramObject;
+
+    /** various data */
+    GLuint maHelperTexture;
+
+    /** When this method is not NULL, it is called in display method to prepare the slides, scene, etc.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmPrepare)( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
+
+    /** When this method is not NULL, it is called after glx context is ready to let the transition prepare GL related things, like GLSL program.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmPrepareTransition)( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+
+    /** When this method is not NULL, it is called when the transition needs to clear after itself, like delete own textures etc.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmClearTransition)();
+
+    /** When this method is not NULL, it is called in display method to display the slides.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmDisplaySlides)( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+
+    void displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives, double SlideWidthScale, double SlideHeightScale );
+    void displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    void applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale );
+
+    /** various transitions helper methods
+     */
+    void prepareDiamond( double nTime, double SlideWidth, double SlideHeight,double DispWidth, double DispHeight );
+    void displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+        void displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+        void displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void prepareStatic( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void prepareDissolve( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void preparePermShader();
+};
+
+class SceneObject
+{
+public:
+    SceneObject();
+
+    virtual void prepare() {};
+    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    virtual void finish() {};
+
+    void pushPrimitive (const Primitive &p);
+
+protected:
+    /** All the surrounding scene primitives
+    */
+    vector<Primitive> maPrimitives;
+};
+
+class Iris : public SceneObject
+{
+public:
+    Iris ();
+
+    virtual void prepare();
+    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    virtual void finish();
+
+private:
+
+    GLuint maTexture;
+};
+
+/** This class is a list of Triangles that will share Operations, and could possibly share  
+*/
+class Primitive
+{
+public:
+    Primitive() {}
+    // making copy constructor explicit makes the class un-suitable for use with stl containers
+    Primitive(const Primitive& rvalue);
+    ~Primitive();
+
+    void applyOperations(double nTime, double SlideWidthScale, double SlideHeightScale);
+    void display(double nTime, double SlideWidthScale, double SlideHeightScale);
+    const Primitive& operator=(const Primitive& rvalue);
+    
+    /** PushBack a vertex,normal, and tex coord. Each SlideLocation is where on the slide is mapped to this location ( from (0,0) to (1,1)  ). This will make sure the correct aspect ratio is used, and helps to make slides begin and end at the correct position. (0,0) is the top left of the slide, and (1,1) is the bottom right.
+    
+    @param SlideLocation0
+    Location of first Vertex on slide
+    
+    @param SlideLocation1
+    Location of second Vertex on slide
+    
+    @param SlideLocation2
+    Location of third Vertex on slide
+    
+    */
+    void pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2);
+    
+    /** clear all the vertices, normals, tex coordinates, and normals
+    */
+    void clearTriangles();
+    
+    /** guards against directly changing the vertices
+        
+        @return        
+        the list of vertices
+    */
+    const vector<basegfx::B3DVector>& getVertices() const {return Vertices;}
+    
+    /** guards against directly changing the vertices
+    */
+    const vector<basegfx::B3DVector>& getNormals() const {return Normals;}
+    
+    /** guards against directly changing the vertices
+    
+        @return        
+        the list of Texture Coordinates
+    
+    */
+    const vector<basegfx::B2DVector>& getTexCoords() const {return TexCoords;}
+
+    /** list of Operations to be performed on this primitive.These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
+    
+        @return        
+        the list of Operations
+    
+    */    
+    vector<Operation*> Operations;
+
+private:
+    /** list of vertices
+    */
+    vector<basegfx::B3DVector> Vertices;
+    
+    /** list of Normals
+    */
+    vector<basegfx::B3DVector> Normals;
+    
+    /** list of Texture Coordinates
+    */
+    vector<basegfx::B2DVector> TexCoords;
+};
+
+/** This class is to be derived to make any operation (tranform) you may need in order to construct your transitions
+*/
+class Operation
+{
+public:
+    Operation(){}
+    virtual ~Operation(){}
+    
+    /** Should this operation be interpolated . If TRUE, the transform will smoothly move from making no difference from t = 0.0 to nT0 to being completely transformed from t = nT1 to 1. If FALSE, the transform will be inneffectual from t = 0 to nT0, and completely transformed from t = nT0 to 1. 
+    */
+    bool bInterpolate;
+    
+    /** time to begin the transformation
+    */
+    double nT0;
+    
+    /** time to finish the transformation
+    */
+    double nT1;
+public:
+    /** this is the function that is called to give the Operation to OpenGL.
+        
+        @param t
+        time from t = 0 to t = 1
+        
+        @param SlideWidthScale
+        width of slide divided by width of window
+        
+        @param SlideHeightScale
+        height of slide divided by height of window
+    
+    */
+    virtual void interpolate(double t,double SlideWidthScale,double SlideHeightScale) = 0;
+    
+    /** return a copy of this operation
+    */
+    virtual Operation* clone() = 0;
+};
+
+/** this class is a generic CounterClockWise(CCW) rotation with an axis angle
+*/
+class SRotate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    virtual SRotate* clone();
+    
+    /** Constructor
+        
+        @param Axis
+        axis to rotate about
+        
+        @param Origin
+        position that rotation axis runs through
+        
+        @param Angle
+        angle in radians of CCW rotation
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~SRotate(){}
+private:
+    /** axis to rotate CCW about
+    */
+    basegfx::B3DVector axis;
+    
+    /** position that rotation axis runs through
+    */
+    basegfx::B3DVector origin;
+    
+    /** angle in radians of CCW rotation
+    */
+    double angle;
+};
+
+/** scaling transformation
+*/
+class SScale: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    SScale* clone();
+    
+    /** Constructor
+        
+        @param Scale
+        amount to scale by 
+        
+        @param Origin
+        position that rotation axis runs through
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SScale(const basegfx::B3DVector& Scale, const basegfx::B3DVector& Origin,bool bInter, double T0, double T1);
+    ~SScale(){}
+private:
+    basegfx::B3DVector scale;
+    basegfx::B3DVector origin;
+};
+
+/** translation transformation
+*/
+class STranslate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    STranslate* clone();
+    
+    /** Constructor
+        
+        @param Vector
+        vector to translate
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    STranslate(const basegfx::B3DVector& Vector,bool bInter, double T0, double T1);
+    ~STranslate(){}
+private:
+    /** vector to translate by
+    */
+    basegfx::B3DVector vector;
+};
+
+/** translation transformation
+*/
+class SEllipseTranslate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    SEllipseTranslate* clone();
+    
+    /** Constructor
+        
+        @param Vector
+        vector to translate
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1);
+    ~SEllipseTranslate(){}
+private:
+    /** width and length of the ellipse
+     */
+    double width, height;
+
+    /** start and end position on the ellipse <0,1>
+     */
+    double startPosition;
+    double endPosition;
+};
+
+/** Same as SRotate, except the depth is scaled by the width of the slide divided by the width of the window.
+*/
+class RotateAndScaleDepthByWidth: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    RotateAndScaleDepthByWidth* clone();
+
+    RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~RotateAndScaleDepthByWidth(){}
+private:
+    basegfx::B3DVector axis;
+    basegfx::B3DVector origin;
+    double angle;
+};
+
+/** Same as SRotate, except the depth is scaled by the width of the slide divided by the height of the window.
+*/
+class RotateAndScaleDepthByHeight: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    RotateAndScaleDepthByHeight* clone();
+
+    RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~RotateAndScaleDepthByHeight(){}
+private:
+    basegfx::B3DVector axis;
+    basegfx::B3DVector origin;
+    double angle;
+};
+
+#endif // INCLUDED_SLIDESHOW_TRANSITION_HXX_
+
diff --git slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl_MACOSX.mm slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl_MACOSX.mm
new file mode 100644
index 0000000..9facac6
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionImpl_MACOSX.mm
@@ -0,0 +1,1329 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionImpl.cxx,v $
+ * $Revision: 1.5.12.1 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include "OGLTrans_TransitionImpl.hxx"
+#include "OGLTrans_Shaders_MACOSX.h"
+#ifdef QUARTZ
+#include <OpenGL/gl.h>
+#else
+#include <GL/gl.h>
+#endif
+#include <math.h>
+
+void OGLTransitionImpl::clear()
+{
+    for(unsigned int i( 0 ); i < OverallOperations.size(); ++i)
+        delete OverallOperations[i];
+    OverallOperations.clear();
+    maLeavingSlidePrimitives.clear();
+    maEnteringSlidePrimitives.clear();
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
+        delete maSceneObjects[i];
+    maSceneObjects.clear();
+
+    mbReflectSlides = false;
+
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        glDeleteProgram( mProgramObject );
+        mProgramObject = 0;
+    }
+
+    if( mVertexObject ) {
+        glDeleteShader( mVertexObject );
+        mVertexObject = 0;
+    }
+
+    if( mFragmentObject ) {
+        glDeleteShader( mFragmentObject );
+        mFragmentObject = 0;
+    }
+#endif
+
+    if( maHelperTexture ) {
+        glDeleteTextures( 1, &maHelperTexture );
+        maHelperTexture = 0;
+    }
+
+    if( mmClearTransition )
+        (this->*mmClearTransition)();
+}
+
+OGLTransitionImpl::~OGLTransitionImpl()
+{
+    clear();
+}
+
+void OGLTransitionImpl::prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex )
+{
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
+        maSceneObjects[i]->prepare();
+    }
+
+    if( mmPrepareTransition )
+        (this->*mmPrepareTransition)( glLeavingSlideTex, glEnteringSlideTex );
+}
+
+void OGLTransitionImpl::finish()
+{
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
+        maSceneObjects[i]->finish();
+    }
+}
+
+static void blendSlide( double depth )
+{
+    double showHeight = -1 + depth*2;
+    GLfloat reflectionColor[] = {0, 0, 0, 0.25};
+
+    glDisable( GL_DEPTH_TEST );
+    glBegin( GL_QUADS );
+    glColor4fv( reflectionColor );
+    glVertex3f( -1, -1, 0 );
+    glColor4f( 0, 0, 0, 1 );
+    glVertex3f(-1,  showHeight, 0 );
+    glVertex3f( 1,  showHeight, 0 );
+    glColor4fv( reflectionColor );
+    glVertex3f( 1, -1, 0 );
+    glEnd();
+
+    glBegin( GL_QUADS );
+    glColor4f( 0, 0, 0, 1 );
+    glVertex3f( -1, showHeight, 0 );
+    glVertex3f( -1,  1, 0 );
+    glVertex3f(  1,  1, 0 );
+    glVertex3f(  1, showHeight, 0 );
+    glEnd();
+    glEnable( GL_DEPTH_TEST );
+}
+
+static void slideShadow( double nTime, Primitive& primitive, double sw, double sh )
+{
+    double reflectionDepth = 0.3;
+
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glDisable(GL_LIGHTING);
+
+    glPushMatrix();
+    primitive.applyOperations( nTime, sw, sh );
+    blendSlide( reflectionDepth );
+    glPopMatrix();
+
+    glDisable(GL_BLEND);
+    glEnable(GL_LIGHTING);
+}
+
+void OGLTransitionImpl::display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                 double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    double SlideWidthScale, SlideHeightScale;
+
+    SlideWidthScale = SlideWidth/DispWidth;
+    SlideHeightScale = SlideHeight/DispHeight;
+
+    if( mmPrepare ) {
+        clear();
+        (this->*mmPrepare)( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
+    }
+
+    glPushMatrix();
+    displaySlides( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
+    displayScene( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
+    glPopMatrix();
+}
+
+void OGLTransitionImpl::applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale )
+{
+    for(unsigned int i(0); i < OverallOperations.size(); ++i)
+        OverallOperations[i]->interpolate(nTime,SlideWidthScale,SlideHeightScale);
+}
+
+void OGLTransitionImpl::displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives,
+                                      double SlideWidthScale, double SlideHeightScale )
+{
+   //TODO change to foreach
+    glBindTexture(GL_TEXTURE_2D, glSlideTex);
+
+    // display slide reflection
+    // note that depth test is turned off while blending the shadow
+    // so the slides has to be rendered in right order, see rochade as example
+    if( mbReflectSlides ) {
+        double surfaceLevel = -0.04;
+
+        /* reflected slides */
+        glPushMatrix();
+
+        glScaled( 1, -1, 1 );
+        glTranslated( 0, 2 - surfaceLevel, 0 );
+
+        glCullFace(GL_FRONT);
+    for(unsigned int i(0); i < primitives.size(); ++i)
+        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
+        glCullFace(GL_BACK);
+
+    slideShadow( nTime, primitives[0], SlideWidthScale, SlideHeightScale );
+
+        glPopMatrix();
+    }
+
+    for(unsigned int i(0); i < primitives.size(); ++i)
+        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
+}
+
+void OGLTransitionImpl::displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                       double SlideWidthScale, double SlideHeightScale )
+{
+    if( mmDisplaySlides )
+        (this->*mmDisplaySlides)( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
+    else {
+        applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+        glEnable(GL_TEXTURE_2D);
+        displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+        displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+}
+
+void OGLTransitionImpl::displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    glEnable(GL_TEXTURE_2D);
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
+        maSceneObjects[i]->display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
+}
+
+void Primitive::display(double nTime, double WidthScale, double HeightScale)
+{
+    glPushMatrix();
+
+    applyOperations( nTime, WidthScale, HeightScale );
+
+    glEnableClientState( GL_VERTEX_ARRAY );
+    if(!Normals.empty())
+    {
+        glNormalPointer( GL_DOUBLE , 0 , &Normals[0] );
+        glEnableClientState( GL_NORMAL_ARRAY );
+    }
+    glEnableClientState( GL_TEXTURE_COORD_ARRAY );
+    glTexCoordPointer( 2, GL_DOUBLE, 0, &TexCoords[0] );
+    glVertexPointer( 3, GL_DOUBLE, 0, &Vertices[0] );
+    glDrawArrays( GL_TRIANGLES, 0, Vertices.size() );
+    glPopMatrix();
+}
+
+void Primitive::applyOperations(double nTime, double WidthScale, double HeightScale)
+{
+    for(unsigned int i(0); i < Operations.size(); ++i)
+        Operations[i]->interpolate( nTime ,WidthScale,HeightScale);
+    glScaled(WidthScale,HeightScale,1);
+}
+
+Primitive::~Primitive()
+{
+    for(unsigned int i( 0 ); i < Operations.size(); ++i)
+        delete Operations[i];
+}
+
+
+void SceneObject::display(double nTime, double /* SlideWidth */, double /* SlideHeight */, double DispWidth, double DispHeight )
+{
+    for(unsigned int i(0); i < maPrimitives.size(); ++i) {
+        // fixme: allow various model spaces, now we make it so that
+        // it is regular -1,-1 to 1,1, where the whole display fits in
+        glPushMatrix();
+        if (DispHeight > DispWidth)
+            glScaled(DispHeight/DispWidth, 1, 1);
+        else
+            glScaled(1, DispWidth/DispHeight, 1);
+        maPrimitives[i].display(nTime, 1, 1);
+        glPopMatrix();
+    }
+}
+
+void SceneObject::pushPrimitive(const Primitive &p)
+{
+    maPrimitives.push_back(p);
+}
+
+SceneObject::SceneObject()
+    : maPrimitives()
+{
+}
+
+Iris::Iris()
+    : SceneObject ()
+{
+}
+
+void Iris::display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    glBindTexture(GL_TEXTURE_2D, maTexture);
+    SceneObject::display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
+}
+
+void Iris::prepare()
+{
+    static GLubyte img[3] = { 80, 80, 80 };
+    
+    glGenTextures(1, &maTexture);
+    glBindTexture(GL_TEXTURE_2D, maTexture);
+    glTexImage2D(GL_TEXTURE_2D, 0, 3, 1, 1, 0, GL_RGB, GL_UNSIGNED_BYTE, img);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
+}
+
+void Iris::finish()
+{
+    glDeleteTextures(1, &maTexture);
+}
+
+void OGLTransitionImpl::makeOutsideCubeFaceToLeft()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),90,false,0.0,1.0));
+
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),-90,true,0.0,1.0));
+}
+
+void OGLTransitionImpl::makeInsideCubeFaceToLeft()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),-90,false,0.0,1.0));
+
+    maEnteringSlidePrimitives.push_back(Slide);
+    
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),90,true,0.0,1.0));
+}
+
+void OGLTransitionImpl::makeFallLeaving()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(1,0,0),basegfx::B3DVector(0,-1,0), 90,true,0.0,1.0));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::makeTurnAround()
+{
+    clear();
+    Primitive Slide;
+
+    mbReflectSlides = true;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0),-180,false,0.0,1.0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, -1.5),true, 0, 0.5));
+    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1.5), true, 0.5, 1));
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0),basegfx::B3DVector(0, 0, 0), -180, true, 0.0, 1.0));
+}
+
+void OGLTransitionImpl::makeTurnDown()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 0.0001), false, -1.0, 0.0));
+    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), -90, true, 0.0, 1.0));
+    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), 90, false, -1.0, 0.0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    mbUseMipMapLeaving = false;
+}
+
+void OGLTransitionImpl::makeIris()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0,  0.000001), false, -1, 0));
+    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, -0.000002), false, 0.5, 1));
+    maLeavingSlidePrimitives.push_back (Slide);
+
+
+    Primitive irisPart, part;
+    int i, nSteps = 24, nParts = 7;
+    double lt = 0, t = 1.0/nSteps, cx, cy, lcx, lcy, lx = 1, ly = 0, x, y, cxo, cyo, lcxo, lcyo, of=2.2, f=1.42;
+
+    for (i=1; i<=nSteps; i++) {
+        x = cos ((3*2*M_PI*t)/nParts);
+        y = -sin ((3*2*M_PI*t)/nParts);
+        cx = (f*x + 1)/2;
+        cy = (f*y + 1)/2;
+        lcx = (f*lx + 1)/2;
+        lcy = (f*ly + 1)/2;
+        cxo = (of*x + 1)/2;
+        cyo = (of*y + 1)/2;
+        lcxo = (of*lx + 1)/2;
+        lcyo = (of*ly + 1)/2;
+        irisPart.pushTriangle (basegfx::B2DVector (lcx, lcy),
+                               basegfx::B2DVector (lcxo, lcyo),
+                               basegfx::B2DVector (cx, cy));
+        irisPart.pushTriangle (basegfx::B2DVector (cx, cy),
+                               basegfx::B2DVector (lcxo, lcyo),
+                               basegfx::B2DVector (cxo, cyo));
+        lx = x;
+        ly = y;
+        lt = t;
+        t += 1.0/nSteps;
+    }
+
+    Iris* pIris = new Iris();
+    double angle = 87;
+
+    for (i = 0; i < nParts; i++) {
+        irisPart.Operations.clear ();
+        double rx, ry;
+
+        rx = cos ((2*M_PI*i)/nParts);
+        ry = sin ((2*M_PI*i)/nParts);
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0),  angle, true, 0.0, 0.5));
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0), -angle, true, 0.5, 1));
+        if (i > 0) {
+            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(rx, ry, 0),  false, -1, 0));
+            irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(0, 0, 0), i*360.0/nParts, false, -1, 0));
+            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(-1, 0, 0),  false, -1, 0));
+        }
+        irisPart.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1), false, -2, 0.0));
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(1, .5, 0), basegfx::B3DVector(1, 0, 0), -30, false, -1, 0));
+        pIris->pushPrimitive (irisPart);
+    }
+
+    maSceneObjects.push_back (pIris);
+
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                          double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glEnable(GL_TEXTURE_2D);
+
+    if( nTime > .5) {
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    } else {
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+}
+
+void OGLTransitionImpl::makeRochade()
+{
+    clear();
+    Primitive Slide;
+    
+    mbReflectSlides = true;
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesRochade;
+
+    double w, h;
+
+    w = 2.2;
+    h = 10;
+
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.25, -0.25, true, 0, 1));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.clear();
+    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.75, 0.25, true, 0, 1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, -h), false, -1, 0));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), 45, false, -1, 0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    //     OverallOperations.push_back(new SEllipseTranslate(0.5, 2, 0, 1, true, 0, 1));
+//      push_back(new STranslate(basegfx::B3DVector(0, 0, -2), true, 0, 0.5));
+//      OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 2), true, 0.5, 1));
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B2DVector clamp(const basegfx::B2DVector& v)
+{
+    return basegfx::B2DVector(min(max(v.getX(),-1.0),1.0),
+                              min(max(v.getY(),-1.0),1.0));
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B3DVector clamp(const basegfx::B3DVector& v)
+{
+    return basegfx::B3DVector(min(max(v.getX(),-1.0),1.0),
+                              min(max(v.getY(),-1.0),1.0),
+                              min(max(v.getZ(),-1.0),1.0));
+}
+
+inline double randFromNeg1to1()
+{
+    return ( ( static_cast<double>( rand() ) / static_cast<double>( RAND_MAX ) ) * 2.0 ) - 1.0;
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B3DVector randNormVectorInXYPlane()
+{
+    basegfx::B3DVector toReturn(randFromNeg1to1(),randFromNeg1to1(),0.0);
+    return toReturn/toReturn.getLength();
+}
+
+void OGLTransitionImpl::makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles )
+{
+    clear();
+    double dAngle(2*3.1415926/static_cast<double>( nPointsOnCircles ));
+    if(nCircles < 2 || nPointsOnCircles < 4)
+    {
+        makeNByMTileFlip(1,1);
+        return;
+    }
+    double Radius(1.0/static_cast<double>( nCircles ));
+    double dRadius(Radius);
+    double LastRadius(0.0);
+    double NextRadius(2*Radius);
+
+    /// now we know there is at least two circles
+    /// the first will always be a full circle
+    /// the last will always be the outer shell of the slide with a circle hole
+
+    //add the full circle
+    vector<basegfx::B2DVector> unScaledTexCoords;
+    double TempAngle(0.0);
+    for(unsigned int Point(0); Point < nPointsOnCircles; ++Point)
+    {
+        unScaledTexCoords.push_back( basegfx::B2DVector( cos(TempAngle - 3.1415926/2.0) , sin(TempAngle- 3.1415926/2.0) ) );
+
+        TempAngle += dAngle;
+    }
+    
+    {
+        //double angle(0.0);
+        Primitive EnteringSlide;
+        Primitive LeavingSlide;
+        for(int Point(0); Point + 1 < nPointsOnCircles; ++Point)
+        {
+            EnteringSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
+            LeavingSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5, 0.5) );
+        }
+        EnteringSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius * unScaledTexCoords[ 0 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ nPointsOnCircles - 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
+        LeavingSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+    
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+    
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+        LastRadius = Radius;
+        Radius = NextRadius;
+        NextRadius += dRadius;
+    }    
+    
+    for(int i(1); i < nCircles - 1; ++i)
+    {
+        Primitive LeavingSlide;
+        Primitive EnteringSlide;
+        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
+        {            
+            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            
+            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        }
+        
+        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+        
+        LastRadius = Radius;
+        Radius = NextRadius;
+        NextRadius += dRadius;
+    }
+    {
+        Radius = sqrt(2.0);
+        Primitive LeavingSlide;
+        Primitive EnteringSlide;
+        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
+        {
+            
+            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
+            
+            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        }
+        
+        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+    }
+}
+
+void OGLTransitionImpl::makeHelix( ::sal_uInt16 nRows )
+{
+    clear();
+    double invN(1.0/static_cast<double>(nRows));
+    double iDn = 0.0;
+    double iPDn = invN;
+    for(unsigned int i(0); i < nRows; ++i)
+    {
+        Primitive Tile;
+        
+        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
+            
+        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iPDn ) , basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
+        
+        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , 
+                                                true,min(max(static_cast<double>(i - nRows/2.0)*invN/2.0,0.0),1.0),
+                                                min(max(static_cast<double>(i + nRows/2.0)*invN/2.0,0.0),1.0) ) );
+        
+        maLeavingSlidePrimitives.push_back(Tile);
+        
+        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180 , false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(Tile);
+            
+        iDn += invN;
+        iPDn += invN;
+    }
+}
+
+void OGLTransitionImpl::makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m )
+{
+    clear();
+    double invN(1.0/static_cast<double>(n));
+    double invM(1.0/static_cast<double>(m));
+    double iDn = 0.0;
+    double iPDn = invN;
+    for(unsigned int i(0); i < n; ++i)
+    {
+        double jDm = 0.0;
+        double jPDm = invM;
+        for(unsigned int j(0); j < m; ++j)
+        {
+            Primitive Tile;
+
+            Tile.pushTriangle(basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));
+
+            Tile.pushTriangle(basegfx::B2DVector( iPDn , jPDm ) , basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));//bottom left corner of tile            
+
+            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , true, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
+            maLeavingSlidePrimitives.push_back(Tile);
+            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180, false, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
+
+            maEnteringSlidePrimitives.push_back(Tile);
+
+            jDm += invM;
+            jPDm += invM;
+        }
+        iDn += invN;
+        iPDn += invN;
+    }
+}
+
+SRotate::SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+SScale::SScale(const basegfx::B3DVector& Scale,const basegfx::B3DVector& Origin, bool bInter, double T0, double T1):scale(Scale),origin(Origin)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+RotateAndScaleDepthByWidth::RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+RotateAndScaleDepthByHeight::RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+
+STranslate::STranslate(const basegfx::B3DVector& Vector, bool bInter, double T0, double T1):vector(Vector)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+inline double intervalInter(double t, double T0, double T1)
+{
+    return ( t - T0 ) / ( T1 - T0 );
+}
+
+void STranslate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*t*vector.getX(),SlideHeightScale*t*vector.getY(),t*vector.getZ());
+}
+
+void SRotate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
+    glScaled(SlideWidthScale,SlideHeightScale,1);
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glScaled(1/SlideWidthScale,1/SlideHeightScale,1);
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
+}
+
+void SScale::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
+    glScaled((1-t) + t*scale.getX(),(1-t) + t*scale.getY(),(1-t) + t*scale.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
+}
+
+void RotateAndScaleDepthByWidth::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideWidthScale*origin.getZ());
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideWidthScale*origin.getZ());
+}
+
+void RotateAndScaleDepthByHeight::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideHeightScale*origin.getZ());
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideHeightScale*origin.getZ());
+}
+
+SEllipseTranslate::SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+    width = dWidth;
+    height = dHeight;
+    startPosition = dStartPosition;
+    endPosition = dEndPosition;
+}
+
+void SEllipseTranslate::interpolate(double t,double /* SlideWidthScale */,double /* SlideHeightScale */)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+
+    double a1, a2, x, y;
+    a1 = startPosition*2*M_PI;
+    a2 = (startPosition + t*(endPosition - startPosition))*2*M_PI;
+    x = width*(cos (a2) - cos (a1))/2;
+    y = height*(sin (a2) - sin (a1))/2;
+
+    glTranslated(x, 0, y);
+}
+
+STranslate* STranslate::clone()
+{
+    return new STranslate(*this);
+}
+SRotate* SRotate::clone()
+{
+    return new SRotate(*this);
+}
+
+SScale* SScale::clone()
+{
+    return new SScale(*this);
+}
+
+SEllipseTranslate* SEllipseTranslate::clone()
+{
+    return new SEllipseTranslate(*this);
+}
+
+RotateAndScaleDepthByWidth* RotateAndScaleDepthByWidth::clone()
+{
+    return new RotateAndScaleDepthByWidth(*this);
+}
+
+RotateAndScaleDepthByHeight* RotateAndScaleDepthByHeight::clone()
+{
+    return new RotateAndScaleDepthByHeight(*this);
+}
+
+const Primitive& Primitive::operator=(const Primitive& rvalue)
+{
+    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
+        Operations.push_back(rvalue.Operations[i]->clone());
+    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
+        Vertices.push_back(rvalue.Vertices[i]);
+    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
+        TexCoords.push_back(rvalue.TexCoords[i]);
+    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
+        Normals.push_back(rvalue.Normals[i]);    
+    return *this;   
+}
+    
+Primitive::Primitive(const Primitive& rvalue)
+{
+    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
+        Operations.push_back(rvalue.Operations[i]->clone());
+    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
+        Vertices.push_back(rvalue.Vertices[i]);
+    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
+        TexCoords.push_back(rvalue.TexCoords[i]);
+    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
+        Normals.push_back(rvalue.Normals[i]);
+}
+
+void Primitive::pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2)
+{
+    vector<basegfx::B3DVector> Verts;
+    vector<basegfx::B2DVector> Texs;
+    Verts.reserve(3);
+    Texs.reserve(3);
+
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
+
+    //figure out if they're facing the correct way, and make them face the correct way.
+    basegfx::B3DVector Normal( basegfx::cross( Verts[0] - Verts[1] , Verts[1] - Verts[2] ) );
+    if(Normal.getZ() >= 0.0)//if the normal is facing us
+    {
+        Texs.push_back(SlideLocation0);
+        Texs.push_back(SlideLocation1);
+        Texs.push_back(SlideLocation2);
+    }
+    else // if the normal is facing away from us, make it face us
+    {
+        Texs.push_back(SlideLocation0);
+        Texs.push_back(SlideLocation2);
+        Texs.push_back(SlideLocation1);
+        Verts.clear();
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
+    }
+
+    Vertices.push_back(Verts[0]);
+    Vertices.push_back(Verts[1]);
+    Vertices.push_back(Verts[2]);
+
+    TexCoords.push_back(Texs[0]);
+    TexCoords.push_back(Texs[1]);
+    TexCoords.push_back(Texs[2]);
+    
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+}
+
+void OGLTransitionImpl::makeDiamond()
+{
+    mmPrepare = &OGLTransitionImpl::prepareDiamond;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::prepareDiamond( double nTime, double /* SlideWidth */, double /* SlideHeight */, double /* DispWidth */, double /* DispHeight */ )
+{
+    Primitive Slide1, Slide2;
+
+    Slide1.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide1.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maEnteringSlidePrimitives.push_back (Slide1);
+
+    
+    if( nTime >= 0.5 ) {
+        double m = 1 - nTime;
+
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (m,0), basegfx::B2DVector (0,m));
+        Slide2.pushTriangle (basegfx::B2DVector (nTime,0), basegfx::B2DVector (1,0), basegfx::B2DVector (1,m));
+        Slide2.pushTriangle (basegfx::B2DVector (1,nTime), basegfx::B2DVector (1,1), basegfx::B2DVector (nTime,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,nTime), basegfx::B2DVector (m,1), basegfx::B2DVector (0,1));
+    } else {
+        double l = 0.5 - nTime;
+        double h = 0.5 + nTime;
+
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0.5,l));
+        Slide2.pushTriangle (basegfx::B2DVector (0.5,l), basegfx::B2DVector (1,0), basegfx::B2DVector (h,0.5));
+        Slide2.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (1,1), basegfx::B2DVector (h,0.5));
+        Slide2.pushTriangle (basegfx::B2DVector (h,0.5), basegfx::B2DVector (1,1), basegfx::B2DVector (0.5,h));
+        Slide2.pushTriangle (basegfx::B2DVector (0.5,h), basegfx::B2DVector (1,1), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (l,0.5), basegfx::B2DVector (0.5,h), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (l,0.5), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (0.5,l), basegfx::B2DVector (l,0.5));
+    }
+    Slide2.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, 0.00000001), false, -1, 0));
+    maLeavingSlidePrimitives.push_back (Slide2);
+}
+
+void OGLTransitionImpl::makeVenetianBlinds( bool vertical, int parts )
+{
+    static double t30 = tan( M_PI/6.0 );
+    double n, ln = 0;
+    double p = 1.0/parts;
+
+    for( int i=0; i<parts; i++ ) {
+        Primitive Slide;
+        n = (i + 1)/(double)parts;
+        if( vertical ) {
+            Slide.pushTriangle (basegfx::B2DVector (ln,0), basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1));
+            Slide.pushTriangle (basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1), basegfx::B2DVector (n,1));
+            Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, -t30*p), -120, true, 0.0, 1.0));
+        } else {
+            Slide.pushTriangle (basegfx::B2DVector (0,ln), basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n));
+            Slide.pushTriangle (basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n), basegfx::B2DVector (1,n));
+            Slide.Operations.push_back(new RotateAndScaleDepthByHeight(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, -t30*p), -120, true, 0.0, 1.0));
+        }
+        maLeavingSlidePrimitives.push_back (Slide);
+
+        if( vertical ) {
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(2*n - 1, 0, 0), -60, false, -1, 0));
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, 0), 180, false, -1, 0));
+        } else {
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - 2*n, 0), -60, false, -1, 0));
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, 0), 180, false, -1, 0));
+        }
+        maEnteringSlidePrimitives.push_back (Slide);
+        ln = n;
+    }
+}
+
+void OGLTransitionImpl::displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_DEPTH_TEST);
+
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_LIGHTING);
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+    glColor4f( 1, 1, 1, nTime );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    glDisable(GL_BLEND);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
+    glEnable(GL_LIGHTING);
+
+    glEnable(GL_DEPTH_TEST);
+}
+
+void OGLTransitionImpl::makeFadeSmoothly()
+{ 
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeSmoothly;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_DEPTH_TEST);
+
+    glDisable(GL_LIGHTING);
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+    if( nTime < 0.5 ) {
+    glColor4f( 1, 1, 1, 1 - nTime*2 );
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    } else {
+    glColor4f( 1, 1, 1, (nTime - 0.5)*2 );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+    glDisable(GL_BLEND);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
+    glEnable(GL_LIGHTING);
+
+    glEnable(GL_DEPTH_TEST);
+}
+
+void OGLTransitionImpl::makeFadeThroughBlack()
+{ 
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeThroughBlack;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+static const char* basicVertexShader = "\n\
+varying vec2 v_texturePosition;\n\
+\n\
+void main( void )\n\
+{\n\
+    gl_Position = ftransform();\n\
+    v_texturePosition = gl_MultiTexCoord0.xy;\n\
+}\n\
+";
+
+static const char* staticFragmentShader = "\n\
+uniform sampler2D leavingSlideTexture;\n\
+uniform sampler2D enteringSlideTexture;\n\
+uniform sampler2D permTexture;\n\
+uniform float time;\n\
+varying vec2 v_texturePosition;\n\
+\n\
+float snoise(vec2 P) {\n\
+\n\
+  return texture2D(permTexture, P).r;\n\
+}\n\
+\n\
+\n\
+#define PART 0.5\n\
+#define START 0.4\n\
+#define END 0.9\n\
+\n\
+void main() {\n\
+    float sn = snoise(10.0*v_texturePosition+time*0.07);\n\
+    if( time < PART ) {\n\
+        float sn1 = snoise(vec2(time*15.0, 20.0*v_texturePosition.y));\n\
+        float sn2 = snoise(v_texturePosition);\n\
+        if (sn1 > 1.0 - time*time && sn2 < 2.0*time+0.1)\n\
+            gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
+        else if (time > START )\n\
+            gl_FragColor = ((time-START)/(PART - START))*vec4(sn, sn, sn, 1.0) + (1.0 - (time - START)/(PART - START))*texture2D(leavingSlideTexture, v_texturePosition);\n\
+        else\n\
+            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+    } else if ( time < PART ) {\n\
+            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+    } else if ( time > END ) {\n\
+        gl_FragColor = ((1.0 - time)/(1.0 - END))*vec4(sn, sn, sn, 1.0) + ((time - END)/(1.0 - END))*texture2D(enteringSlideTexture, v_texturePosition);\n\
+    } else \n\
+        gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
+}\n\
+";
+
+static const char* dissolveFragmentShader = "\n\
+uniform sampler2D leavingSlideTexture;\n\
+uniform sampler2D enteringSlideTexture;\n\
+uniform sampler2D permTexture;\n\
+uniform float time;\n\
+varying vec2 v_texturePosition;\n\
+\n\
+float snoise(vec2 P) {\n\
+\n\
+  return texture2D(permTexture, P).r;\n\
+}\n\
+\n\
+void main() {\n\
+     float sn = snoise(10.0*v_texturePosition);\n\
+     if( sn < time)\n\
+         gl_FragColor = texture2D(enteringSlideTexture, v_texturePosition);\n\
+     else\n\
+         gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+}\n\
+";
+
+int permutation256 [256]= {
+215, 100, 200, 204, 233,  50,  85, 196, 
+ 71, 141, 122, 160,  93, 131, 243, 234, 
+162, 183,  36, 155,   4,  62,  35, 205, 
+ 40, 102,  33,  27, 255,  55, 214, 156, 
+ 75, 163, 134, 126, 249,  74, 197, 228, 
+ 72,  90, 206, 235,  17,  22,  49, 169, 
+227,  89,  16,   5, 117,  60, 248, 230, 
+217,  68, 138,  96, 194, 170, 136,  10, 
+112, 238, 184, 189, 176,  42, 225, 212, 
+ 84,  58, 175, 244, 150, 168, 219, 236, 
+101, 208, 123,  37, 164, 110, 158, 201, 
+ 78, 114,  57,  48,  70, 142, 106,  43, 
+232,  26,  32, 252, 239,  98, 191,  94, 
+ 59, 149,  39, 187, 203, 190,  19,  13, 
+133,  45,  61, 247,  23,  34,  20,  52, 
+118, 209, 146, 193, 222,  18,   1, 152, 
+ 46,  41,  91, 148, 115,  25, 135,  77, 
+254, 147, 224, 161,   9, 213, 223, 250, 
+231, 251, 127, 166,  63, 179,  81, 130, 
+139,  28, 120, 151, 241,  86, 111,   0, 
+ 88, 153, 172, 182, 159, 105, 178,  47, 
+ 51, 167,  65,  66,  92,  73, 198, 211, 
+245, 195,  31, 220, 140,  76, 221, 186, 
+154, 185,  56,  83,  38, 165, 109,  67, 
+124, 226, 132,  53, 229,  29,  12, 181, 
+121,  24, 207, 199, 177, 113,  30,  80, 
+  3,  97, 188,  79, 216, 173,   8, 145, 
+ 87, 128, 180, 237, 240, 137, 125, 104, 
+ 15, 242, 119, 246, 103, 143,  95, 144, 
+  2,  44,  69, 157, 192, 174,  14,  54, 
+218,  82,  64, 210,  11,   6, 129,  21, 
+116, 171,  99, 202,   7, 107, 253, 108
+};
+
+void initPermTexture(GLuint *texID)
+{
+  glGenTextures(1, texID);
+  glBindTexture(GL_TEXTURE_2D, *texID);
+
+  static bool initialized = false;
+  static unsigned char permutation2D[256*256*4];
+  if( !initialized ) {
+      int x, y;
+
+      for( y=0; y < 256; y++ )
+          for( x=0; x < 256; x++ )
+              permutation2D[x*4 + y*1024] = permutation256[(y + permutation256[x]) & 0xff];
+
+      initialized = true;
+  }
+
+  glTexImage2D( GL_TEXTURE_2D, 0, GL_RGBA, 256, 256, 0, GL_RGBA, GL_UNSIGNED_BYTE, permutation2D );
+  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST );
+  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST );
+}
+
+void OGLTransitionImpl::preparePermShader()
+{
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        glUseProgram( mProgramObject );
+
+        GLint location = glGetUniformLocation( mProgramObject, "leavingSlideTexture" );
+        if( location != -1 ) {
+            glUniform1i( location, 0 );  // texture unit 0
+        }
+
+        glActiveTexture(GL_TEXTURE1);
+        if( !maHelperTexture )
+            initPermTexture( &maHelperTexture );
+        glActiveTexture(GL_TEXTURE0);
+
+        location = glGetUniformLocation( mProgramObject, "permTexture" );
+        if( location != -1 ) {
+            glUniform1i( location, 1 );  // texture unit 1
+        }
+
+        location = glGetUniformLocation( mProgramObject, "enteringSlideTexture" );
+        if( location != -1 ) {
+            glUniform1i( location, 2 );  // texture unit 2
+        }
+    }
+#endif
+}
+
+void OGLTransitionImpl::prepareStatic( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
+{
+    //mProgramObject = LinkProgram( basicVertexShader, staticFragmentShader );
+    NSString * _basicVertexShader = (NSString *) basicVertexShader;
+    NSString * _staticFragmentShader = (NSString *) staticFragmentShader;
+    OGLShaders * anOGLShader = NULL;
+    mProgramObject = [anOGLShader loadVertexShader: _basicVertexShader fragmentShader: _staticFragmentShader];
+
+    preparePermShader();
+}
+
+void OGLTransitionImpl::displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                              double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        GLint location = glGetUniformLocation( mProgramObject, "time" );
+        if( location != -1 ) {
+            glUniform1f( location, nTime );
+        }
+    }
+
+    glActiveTexture( GL_TEXTURE2 );
+    glBindTexture( GL_TEXTURE_2D, glEnteringSlideTex );
+    glActiveTexture( GL_TEXTURE0 );
+#endif
+
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+}
+
+void OGLTransitionImpl::makeStatic()
+{
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
+    mmPrepareTransition = &OGLTransitionImpl::prepareStatic;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+
+    mnRequiredGLVersion = 2.0;
+}
+
+void OGLTransitionImpl::prepareDissolve( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
+{
+    NSString * _basicVertexShader = (NSString *) basicVertexShader;
+    NSString * _dissolveFragmentShader = (NSString *) dissolveFragmentShader;
+//    mProgramObject = loadVertexShader( _basicVertexShader, _dissolveFragmentShader );
+    OGLShaders * anOGLShader = NULL;
+    mProgramObject = [anOGLShader loadVertexShader: _basicVertexShader fragmentShader: _dissolveFragmentShader];
+
+    preparePermShader();
+}
+
+void OGLTransitionImpl::makeDissolve()
+{
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
+    mmPrepareTransition = &OGLTransitionImpl::prepareDissolve;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+
+    mnRequiredGLVersion = 2.0;
+}
+
+void OGLTransitionImpl::makeNewsflash()
+{
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),3000,true,0,0.5));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),true,0,0.5));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-10000, 0, 0),false, 0.5, 2));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.clear();
+    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),-3000,true,0.5,1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-100, 0, 0),false, -1, 1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(100, 0, 0),false, 0.5, 1));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),false,-1,1));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(100,100,100),basegfx::B3DVector(0,0,0),true,0.5,1));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0.2,0.2,0),1080,true,0,1));
+}
+
diff --git slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionerImpl_MACOSX.mm slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionerImpl_MACOSX.mm
new file mode 100644
index 0000000..0a3e82f
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/OGLTrans_TransitionerImpl_MACOSX.mm
@@ -0,0 +1,1137 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionerImpl.cxx,v $
+ * $Revision: 1.6 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#define GLX_GLXEXT_PROTOTYPES 1
+#include "OGLTrans_TransitionImpl.hxx"
+
+#include <com/sun/star/beans/XFastPropertySet.hpp>
+#include <com/sun/star/rendering/IntegerBitmapLayout.hpp>
+#include <com/sun/star/rendering/ColorComponentTag.hpp>
+#include <com/sun/star/rendering/ColorSpaceType.hpp>
+#include <com/sun/star/animations/TransitionType.hpp>
+#include <com/sun/star/animations/TransitionSubType.hpp>
+#include <com/sun/star/presentation/XTransitionFactory.hpp>
+#include <com/sun/star/presentation/XTransition.hpp>
+#include <com/sun/star/presentation/XSlideShowView.hpp>
+#include <com/sun/star/uno/XComponentContext.hpp>
+#include <com/sun/star/rendering/XIntegerBitmap.hpp>
+#include <com/sun/star/geometry/IntegerSize2D.hpp>
+
+#include <cppuhelper/compbase1.hxx>
+#include <cppuhelper/basemutex.hxx>
+#include <cppuhelper/factory.hxx>
+#include <rtl/ref.hxx>
+
+#include <comphelper/servicedecl.hxx>
+
+#include <canvas/canvastools.hxx>
+#include <tools/gen.hxx>
+#include <vcl/window.hxx>
+#include <vcl/syschild.hxx>
+#include <vcl/sysdata.hxx>
+
+#include <boost/noncopyable.hpp>
+
+#include <premac.h>
+#include <Foundation/Foundation.h>
+#include <Cocoa/Cocoa.h>
+#include <OpenGL/gl.h>
+#include <OpenGL/glu.h>
+#include <OpenGL/glext.h>
+#include "aquaOpenGLView.h"
+#include <postmac.h>
+
+#define GL_TEXTURE_MAX_ANISOTROPY_EXT 0x84FE
+#define GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT 0x84FF
+
+#ifdef DEBUG
+#include <boost/date_time/posix_time/posix_time.hpp>
+using namespace ::boost::posix_time;
+
+static ptime t1;
+static ptime t2;
+
+#define DBG(x) x
+#else
+#define DBG(x)
+#endif
+
+using namespace ::com::sun::star;
+using ::com::sun::star::beans::XFastPropertySet;
+using ::com::sun::star::uno::Any;
+using ::com::sun::star::uno::Reference;
+using ::com::sun::star::uno::Sequence;
+using ::com::sun::star::uno::UNO_QUERY;
+using ::com::sun::star::uno::UNO_QUERY_THROW;
+
+namespace
+{
+
+typedef cppu::WeakComponentImplHelper1<presentation::XTransition> OGLTransitionerImplBase;
+
+namespace
+{
+    struct OGLFormat
+    {
+        GLint  nInternalFormat;
+        GLenum eFormat;
+        GLenum eType;
+    };
+
+    /* channel ordering: (0:rgba, 1:bgra, 2:argb, 3:abgr)  
+    */
+    int calcComponentOrderIndex(const uno::Sequence<sal_Int8>& rTags)
+    {
+        using namespace rendering::ColorComponentTag;
+
+        static const sal_Int8 aOrderTable[] =
+        {
+            RGB_RED, RGB_GREEN, RGB_BLUE, ALPHA,
+            RGB_BLUE, RGB_GREEN, RGB_RED, ALPHA,
+            ALPHA, RGB_RED, RGB_GREEN, RGB_BLUE,
+            ALPHA, RGB_BLUE, RGB_GREEN, RGB_RED, 
+        };
+
+        const sal_Int32 nNumComps(rTags.getLength());
+        const sal_Int8* pLine=aOrderTable;
+        for(int i=0; i<4; ++i)
+        {
+            int j=0;
+            while( j<4 && j<nNumComps && pLine[j] == rTags[j] )
+                ++j;
+
+            // all of the line passed, this is a match!
+            if( j==nNumComps )
+                return i;
+
+            pLine+=4;
+        }
+
+        return -1;
+    }
+}
+
+/** This is the Transitioner class for OpenGL 3D transitions in
+ * slideshow. This class is implicitly
+ * constructed from XTransitionFactory.
+*/
+class OGLTransitionerImpl : private cppu::BaseMutex, private boost::noncopyable, public OGLTransitionerImplBase
+{
+public:
+    explicit OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition);
+    bool initWindowFromSlideShowView( const uno::Reference< presentation::XSlideShowView >& xView );
+    void setSlides( const Reference< rendering::XBitmap >& xLeavingSlide , const uno::Reference< rendering::XBitmap >& xEnteringSlide );
+    static bool initialize( const Reference< presentation::XSlideShowView >& xView );
+
+    // XTransition
+    virtual void SAL_CALL update( double nTime )
+    throw (uno::RuntimeException);
+    virtual void SAL_CALL viewChanged( const Reference< presentation::XSlideShowView >& rView,
+                       const Reference< rendering::XBitmap >& rLeavingBitmap,
+                       const Reference< rendering::XBitmap >& rEnteringBitmap )
+    throw (uno::RuntimeException);
+    
+protected:
+    void disposeContextAndWindow();
+    void disposeTextures();
+
+    // WeakComponentImplHelperBase
+    virtual void SAL_CALL disposing();
+    
+    bool isDisposed() const
+    {
+        return (rBHelper.bDisposed || rBHelper.bInDispose);
+    }
+
+//   bool createWindow( Window* pPWindow );
+    void createTexture(GLuint* texID,
+            bool useMipmap,
+            uno::Sequence<sal_Int8>& data,
+            const OGLFormat* pFormat );
+    void prepareEnvironment ();
+    const OGLFormat* chooseFormats();
+
+private:    
+    /** After the window has been created, and the slides have been set, we'll initialize the slides with OpenGL.
+    */
+    void GLInitSlides();
+
+
+    /// Holds the information of our new child window
+    struct GLWindow
+    {
+        AquaOpenGLView*         pAquaOpenGLView; // Custom Cocoa NSOpenGLView
+        NSOpenGLContext*        pOpenGLContext; // our OpenGLContext
+        NSRect                  aInitFrame;
+        NSView*                 apView;
+        NSScreen*               screen;
+        unsigned int			bpp;
+        unsigned int            Width;
+        unsigned int            Height;
+        const char*             GLXExtensions;
+        const GLubyte*          GLExtensions;
+
+        bool HasGLXExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, (const GLubyte*) GLXExtensions ); }
+    bool HasGLExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, GLExtensions ); }
+    } GLWin;
+    
+    /** OpenGL handle to the leaving slide's texture
+    */
+#if defined(MAC_OS_X_VERSION_10_5) 
+//|| (MAC_OS_X_VERSION_MIN_REQUIRED >= MAC_OS_X_VERSION_10_5)
+    unsigned int GLleavingSlide;
+#else /* build target 10.4 */ 
+    unsigned long int GLleavingSlide;
+#endif
+
+    /** OpenGL handle to the entering slide's texture
+    */
+#if defined(MAC_OS_X_VERSION_10_5) 
+//|| (MAC_OS_X_VERSION_MIN_REQUIRED >= MAC_OS_X_VERSION_10_5)
+    unsigned int GLenteringSlide;
+#else /* build target 10.4 */ 
+    unsigned long int GLenteringSlide;
+#endif 
+    
+    /** pointer to our window which we MIGHT create.
+    */
+    class SystemChildWindow* pWindow;
+
+    Reference< presentation::XSlideShowView > mxView;
+    Reference< rendering::XIntegerBitmap > mxLeavingBitmap;
+    Reference< rendering::XIntegerBitmap > mxEnteringBitmap;
+    
+    /** raw bytes of the entering bitmap
+    */
+    uno::Sequence<sal_Int8> EnteringBytes;
+    
+    /** raw bytes of the leaving bitmap
+    */
+    uno::Sequence<sal_Int8> LeavingBytes;
+    bool mbRestoreSync;
+    bool mbUseLeavingPixmap;
+    bool mbUseEnteringPixmap;
+    bool mbFreeLeavingPixmap;
+    bool mbFreeEnteringPixmap;
+//    unx::Pixmap maLeavingPixmap;
+//    unx::Pixmap maEnteringPixmap;
+    
+    /** the form the raw bytes are in for the bitmaps
+    */
+    rendering::IntegerBitmapLayout SlideBitmapLayout; 
+    
+    /** the size of the slides
+    */    
+    geometry::IntegerSize2D SlideSize;
+    
+    /** Our Transition to be used.
+    */    
+    OGLTransitionImpl* pTransition;
+
+public:
+    /** whether we are running on ATI fglrx with bug related to textures
+     */
+    static bool cbBrokenTexturesATI;
+
+    /** GL version
+     */
+    static float cnGLVersion;
+
+    /** Whether Mesa is the OpenGL vendor
+     */
+     
+    static bool cbMesa;
+
+    /**
+       whether the display has GLX extension
+     */
+    static bool cbGLXPresent;
+
+    /**
+       whether texture from pixmap extension is available
+    */
+    bool mbTextureFromPixmap;
+
+    /**
+       whether to generate mipmaped textures
+    */
+    bool mbGenerateMipmap;
+
+    /**
+       whether we have visual which can be used for texture_from_pixmap extension
+    */
+//    bool mbHasTFPVisual;
+
+#ifdef DEBUG
+    ptime t3;
+    ptime t4;
+    ptime t5;
+    ptime t6;
+    time_duration total_update;
+    int frame_count;
+#endif
+};
+
+// declare the static variables as some gcc versions have problems declaring them automaticaly
+/**/
+bool OGLTransitionerImpl::cbBrokenTexturesATI;
+
+float OGLTransitionerImpl::cnGLVersion;
+/**/
+bool OGLTransitionerImpl::cbMesa;
+
+bool OGLTransitionerImpl::cbGLXPresent;
+
+
+bool OGLTransitionerImpl::initialize( const Reference< presentation::XSlideShowView >& xView )
+{
+    // not thread safe
+
+    // only once. This part is needed for the hardware identification 
+    // [FIXME]: is there a Mac way of doing that ?
+    static bool initialized = false;
+
+    if( !initialized ) {
+        OGLTransitionerImpl *instance;
+
+        instance = new OGLTransitionerImpl( NULL );
+        if( instance->initWindowFromSlideShowView( xView ) ) 
+    
+        {
+            const GLubyte* version = glGetString( GL_VERSION );
+            if( version && version[0] ) {
+                cnGLVersion = version[0] - '0';
+                if( version[1] == '.' && version[2] )
+                    cnGLVersion += (version[2] - '0')/10.0;
+            } else
+                cnGLVersion = 1.0;
+            OSL_TRACE("GL version: %s parsed: %f", version, cnGLVersion );
+
+            const GLubyte* vendor = glGetString( GL_VENDOR );
+            cbMesa = ( vendor && strstr( (const char *) vendor, "Mesa" ) );
+            OSL_TRACE("GL vendor: %s identified as Mesa: %d", vendor, cbMesa );
+
+            /* TODO: check for version once the bug in fglrx driver is fixed */
+            cbBrokenTexturesATI = (vendor && strcmp( (const char *) vendor, "ATI Technologies Inc." ) == 0 );
+
+            instance->disposing();
+            cbGLXPresent = true;
+        } else
+            cbGLXPresent = false;
+
+        delete instance;
+        initialized = true;
+    }
+
+    return cbGLXPresent;
+}
+
+/*bool OGLTransitionerImpl::createWindow( Window* pPWindow )
+{
+    const SystemEnvData* sysData(pPWindow->GetSystemData());
+
+    GLWin.apView = sysData->pView;
+
+    NSOpenGLPixelFormat* fmt = [AquaOpenGLView defaultPixelFormat];
+    Window *pFrameWindow = pPWindow->GetWindow(WINDOW_FRAME);
+    Size aFrameSize( pFrameWindow->GetSizePixel() );
+    Point aScreen( pPWindow->OutputToScreenPixel( Point() ) );
+    GLWin.aInitFrame = (NSRect){ { aScreen.X(), aFrameSize.Height() - GLWin.Height - aScreen.Y() }, { GLWin.Width, GLWin.Height } };
+
+    GLWin.pAquaOpenGLView = [[NSOpenGLView alloc]initWithFrame: GLWin.aInitFrame pixelFormat: fmt];
+    OSL_ENSURE(GLWin.pAquaOpenGLView, "Could not create NSOPenGLView");
+    if( !GLWin.pAquaOpenGLView )
+        return false;
+//
+    GLWin.pOpenGLContext = [GLWin.pAquaOpenGLView openGLContext];
+    [GLWin.pOpenGLContext retain];
+    [GLWin.pAquaOpenGLView setOpenGLContext:GLWin.pOpenGLContext];
+    [sysData->pView addSubview:GLWin.pAquaOpenGLView];
+//
+    if( pWindow )
+    {
+        pWindow->SetMouseTransparent( TRUE );
+        pWindow->SetParentClipMode( PARENTCLIPMODE_NOCLIP );
+        pWindow->EnableEraseBackground( FALSE );
+        pWindow->SetControlForeground();
+        pWindow->SetControlBackground();
+        pWindow->EnablePaint(FALSE);
+        pWindow->SetPosSizePixel(pPWindow->GetPosPixel(),pPWindow->GetSizePixel());
+ //       GLWin.dpy = reinterpret_cast<unx::Display*>(pChildSysData->pDisplay);
+//        GLWin.win = pChildSysData->aWindow;
+
+    return true;
+    }
+
+    return false;
+}
+*/
+
+bool OGLTransitionerImpl::initWindowFromSlideShowView( const Reference< presentation::XSlideShowView >& xView )
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed())
+        return false;
+
+    mxView.set( xView, UNO_QUERY );
+    if( !mxView.is() )
+        return false;
+
+    /// take the XSlideShowView and extract the parent window from it. see viewmediashape.cxx
+    uno::Reference< rendering::XCanvas > xCanvas(mxView->getCanvas(), uno::UNO_QUERY_THROW);
+    uno::Sequence< uno::Any > aDeviceParams;
+    ::canvas::tools::getDeviceInfo( xCanvas, aDeviceParams );
+
+    ::rtl::OUString aImplName;
+    aDeviceParams[ 0 ] >>= aImplName;
+
+    sal_Int64 aVal = 0;
+    aDeviceParams[1] >>= aVal;
+    Window* pPWindow = reinterpret_cast< Window* >( aVal );
+    GLWin.Width = pPWindow->GetSizePixel().Width();
+    GLWin.Height = pPWindow->GetSizePixel().Height();
+ 
+    const SystemEnvData* sysData(pPWindow->GetSystemData());
+
+    GLWin.apView = sysData->pView;
+
+    NSOpenGLPixelFormat* fmt = [AquaOpenGLView defaultPixelFormat];
+    Window *pFrameWindow = pPWindow->GetWindow(WINDOW_FRAME);
+    Size aFrameSize( pFrameWindow->GetSizePixel() );
+    Point aScreen( pPWindow->OutputToScreenPixel( Point() ) );
+    GLWin.aInitFrame = (NSRect){ { aScreen.X(), aFrameSize.Height() - GLWin.Height - aScreen.Y() }, { GLWin.Width, GLWin.Height } };
+
+    GLWin.pAquaOpenGLView = [[NSOpenGLView alloc]initWithFrame: GLWin.aInitFrame pixelFormat: fmt];
+    OSL_ENSURE(GLWin.pAquaOpenGLView, "Could not create NSOPenGLView");
+    if( !GLWin.pAquaOpenGLView )
+        return false;
+
+    GLWin.pOpenGLContext = [GLWin.pAquaOpenGLView openGLContext];
+    [GLWin.pOpenGLContext retain];
+    [GLWin.pAquaOpenGLView setOpenGLContext:GLWin.pOpenGLContext];
+
+    if( GLWin.pOpenGLContext == NULL ) {
+    OSL_TRACE("unable to create GLX context");
+    return false;
+    }
+
+    awt::Rectangle aCanvasArea = mxView->getCanvasArea();
+
+    // needed in windowed mode only ?
+    if( (aCanvasArea.X != 0) && (aCanvasArea.Y != 0) )
+        pWindow->SetPosSizePixel(aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
+
+    GLWin.Width = aCanvasArea.Width;
+    GLWin.Height = aCanvasArea.Height;
+    OSL_TRACE("canvas area: %d,%d - %dx%d", aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
+
+    mbTextureFromPixmap = GLWin.HasGLXExtension( "GLX_EXT_texture_from_pixmap" );
+    mbGenerateMipmap = GLWin.HasGLExtension( "GL_SGIS_generate_mipmap" );
+
+    [GLWin.apView addSubview:GLWin.pAquaOpenGLView];
+
+    if( pWindow )
+    {
+        pWindow->SetMouseTransparent( TRUE );
+        pWindow->SetParentClipMode( PARENTCLIPMODE_NOCLIP );
+        pWindow->EnableEraseBackground( FALSE );
+        pWindow->SetControlForeground();
+        pWindow->SetControlBackground();
+        pWindow->EnablePaint(FALSE);
+        pWindow->SetPosSizePixel(pPWindow->GetPosPixel(),pPWindow->GetSizePixel());
+
+    }
+
+
+    glShadeModel( GL_SMOOTH );
+    glEnable(GL_CULL_FACE);
+    glCullFace(GL_BACK);
+    glClearColor (0.0f, 0.0f, 0.0f, 0.0f);  // R G B A
+    glClear(GL_COLOR_BUFFER_BIT);
+    glClearDepth( 1.0f );
+    glEnable( GL_DEPTH_TEST );
+    glDepthFunc( GL_LEQUAL );
+    glHint( GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST );
+    glEnable(GL_TEXTURE_2D);
+   
+    glEnable(GL_LIGHTING);
+    GLfloat light_direction[] = { 0.0 , 0.0 , 1.0 };
+    GLfloat materialDiffuse[] = { 1.0 , 1.0 , 1.0 , 1.0};
+    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, light_direction);
+    glMaterialfv(GL_FRONT,GL_DIFFUSE,materialDiffuse);
+    glEnable(GL_LIGHT0);
+    glEnable(GL_NORMALIZE);
+
+    [[GLWin.pAquaOpenGLView openGLContext] flushBuffer];
+
+    if( LeavingBytes.hasElements() && EnteringBytes.hasElements())
+       GLInitSlides();//we already have uninitialized slides, let's initialize 
+
+    if( pTransition && pTransition->mnRequiredGLVersion <= cnGLVersion )
+        pTransition->prepare( GLleavingSlide, GLenteringSlide );
+
+    return true;
+}
+
+void OGLTransitionerImpl::setSlides( const uno::Reference< rendering::XBitmap >& xLeavingSlide, 
+                                     const uno::Reference< rendering::XBitmap >& xEnteringSlide )
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed())
+        return;
+        
+    mxLeavingBitmap.set( xLeavingSlide , UNO_QUERY_THROW );
+    mxEnteringBitmap.set( xEnteringSlide , UNO_QUERY_THROW );
+    Reference< XFastPropertySet > xLeavingSet( xLeavingSlide , UNO_QUERY );
+    Reference< XFastPropertySet > xEnteringSet( xEnteringSlide , UNO_QUERY );
+
+    geometry::IntegerRectangle2D SlideRect;
+    SlideSize = mxLeavingBitmap->getSize();
+    SlideRect.X1 = 0;
+    SlideRect.X2 = SlideSize.Width;
+    SlideRect.Y1 = 0;
+    SlideRect.Y2 = SlideSize.Height;
+
+    OSL_TRACE("leaving bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
+    SlideSize = mxEnteringBitmap->getSize();
+    OSL_TRACE("entering bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
+
+#ifdef DEBUG
+    t1 = microsec_clock::local_time();
+#endif
+
+    mbUseLeavingPixmap = false;
+    mbUseEnteringPixmap = false;
+
+    if( !mbUseLeavingPixmap )
+    LeavingBytes = mxLeavingBitmap->getData(SlideBitmapLayout,SlideRect);
+    if( !mbUseEnteringPixmap )
+    EnteringBytes = mxEnteringBitmap->getData(SlideBitmapLayout,SlideRect);
+
+    if(GLWin.pOpenGLContext)//if we have a rendering context, let's init the slides
+        GLInitSlides();
+
+    OSL_ENSURE(SlideBitmapLayout.PlaneStride == 0,"only handle no plane stride now");
+
+    /* flush & sync */
+    mbRestoreSync = true;
+}
+
+void OGLTransitionerImpl::createTexture( GLuint* texID,
+//#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+//					 unx::GLXPixmap pixmap,
+//					 bool usePixmap,
+//#endif
+                     bool useMipmap,
+                     uno::Sequence<sal_Int8>& data,
+                     const OGLFormat* pFormat )
+{
+    glDeleteTextures( 1, texID );
+    glGenTextures( 1, texID );
+    glBindTexture( GL_TEXTURE_2D, *texID );
+    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT );
+    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT );
+/*
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::PFNGLXBINDTEXIMAGEEXTPROC myglXBindTexImageEXT = (unx::PFNGLXBINDTEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXBindTexImageEXT" );
+
+    if( usePixmap ) {
+      if( mbGenerateMipmap )
+          glTexParameteri( GL_TEXTURE_2D, GL_GENERATE_MIPMAP_SGIS, True);
+      myglXBindTexImageEXT (GLWin.dpy, pixmap, GLX_FRONT_LEFT_EXT, NULL);
+      if( mbGenerateMipmap && useMipmap ) {
+          OSL_TRACE("use mipmaps");
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
+      } else {
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
+      }
+    } else {
+#endif
+*/
+    if( !pFormat )
+    {
+        // force-convert color to ARGB8888 int color space  
+        uno::Sequence<sal_Int8> tempBytes(
+            SlideBitmapLayout.ColorSpace->convertToIntegerColorSpace(
+                data,
+                canvas::tools::getStdColorSpace()));
+        gluBuild2DMipmaps(GL_TEXTURE_2D, 
+                          4, 
+                          SlideSize.Width, 
+                          SlideSize.Height, 
+                          GL_RGBA, 
+                          GL_UNSIGNED_BYTE,
+                          &tempBytes[0]);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
+
+    //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
+    GLfloat largest_supported_anisotropy;
+    glGetFloatv(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy);
+    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy);
+    } else {
+    if( pTransition && !cbBrokenTexturesATI && !useMipmap) {
+        glTexImage2D( GL_TEXTURE_2D, 0, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, 0, pFormat->eFormat, pFormat->eType, &data[0] );
+        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
+        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
+    } else {
+        gluBuild2DMipmaps( GL_TEXTURE_2D, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, pFormat->eFormat, pFormat->eType, &data[0] );
+        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR );
+        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR ); //TRILINEAR FILTERING
+
+        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
+        GLfloat largest_supported_anisotropy;
+        glGetFloatv( GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy );
+        glTexParameterf( GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy );
+    }
+    }
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    }
+#endif
+    OSL_ENSURE(glIsTexture(*texID), "Can't generate Leaving slide textures in OpenGL");
+}
+
+void OGLTransitionerImpl::prepareEnvironment()
+{
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    double EyePos(10.0);
+    double RealF(1.0);
+    double RealN(-1.0);
+    double RealL(-1.0);
+    double RealR(1.0);
+    double RealB(-1.0);
+    double RealT(1.0);
+    double ClipN(EyePos+5.0*RealN);
+    double ClipF(EyePos+15.0*RealF);
+    double ClipL(RealL*8.0);
+    double ClipR(RealR*8.0);
+    double ClipB(RealB*8.0);
+    double ClipT(RealT*8.0);
+    //This scaling is to take the plane with BottomLeftCorner(-1,-1,0) and TopRightCorner(1,1,0) and map it to the screen after the perspective division.
+    glScaled( 1.0 / ( ( ( RealR * 2.0 * ClipN ) / ( EyePos * ( ClipR - ClipL ) ) ) - ( ( ClipR + ClipL ) / ( ClipR - ClipL ) ) ),
+              1.0 / ( ( ( RealT * 2.0 * ClipN ) / ( EyePos * ( ClipT - ClipB ) ) ) - ( ( ClipT + ClipB ) / ( ClipT - ClipB ) ) ),
+              1.0 );
+    glFrustum(ClipL,ClipR,ClipB,ClipT,ClipN,ClipF);
+    glMatrixMode(GL_MODELVIEW);
+    glLoadIdentity();
+    glTranslated(0,0,-EyePos);
+}
+
+const OGLFormat* OGLTransitionerImpl::chooseFormats()
+{
+    const OGLFormat* pDetectedFormat=NULL;
+    uno::Reference<rendering::XIntegerBitmapColorSpace> xIntColorSpace(
+        SlideBitmapLayout.ColorSpace);
+
+    if( (xIntColorSpace->getType() == rendering::ColorSpaceType::RGB ||
+         xIntColorSpace->getType() == rendering::ColorSpaceType::SRGB) )
+    {
+        /* table for canvas->OGL format mapping. outer index is number
+           of color components (0:3, 1:4), then comes bits per pixel
+           (0:16, 1:24, 2:32), then channel ordering: (0:rgba, 1:bgra,
+           2:argb, 3:abgr)
+         */
+        static const OGLFormat lcl_RGB24[] = 
+        {
+            // 24 bit RGB
+            {3, GL_BGR, GL_UNSIGNED_BYTE},
+            {3, GL_RGB, GL_UNSIGNED_BYTE},
+            {3, GL_BGR, GL_UNSIGNED_BYTE},
+            {3, GL_RGB, GL_UNSIGNED_BYTE}
+        };
+
+#if defined(GL_VERSION_1_2) && defined(GLU_VERSION_1_3)
+        // more format constants available
+        static const OGLFormat lcl_RGB16[] = 
+        {
+            // 16 bit RGB
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5}
+        };
+
+        static const OGLFormat lcl_ARGB16_4[] = 
+        {
+            // 16 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4},
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4}
+        };
+
+        static const OGLFormat lcl_ARGB16_5[] = 
+        {
+            // 16 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_5_5_5_1},
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_5_5_5_1}
+        };
+
+        static const OGLFormat lcl_ARGB32[] = 
+        {
+            // 32 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8_REV},
+            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV},
+            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8},
+            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8}
+        };
+
+        const uno::Sequence<sal_Int8> aComponentTags(
+            xIntColorSpace->getComponentTags());
+        const uno::Sequence<sal_Int32> aComponentBitcounts(
+            xIntColorSpace->getComponentBitCounts());
+        const sal_Int32 nNumComponents( aComponentBitcounts.getLength() );
+        const sal_Int32 nBitsPerPixel( xIntColorSpace->getBitsPerPixel() );
+
+        // supported component ordering?
+        const int nComponentOrderIndex(
+            calcComponentOrderIndex(aComponentTags));
+        if( nComponentOrderIndex != -1 ) 
+        {
+            switch( nBitsPerPixel )
+            {
+                case 16:
+                    if( nNumComponents == 3 )
+                    {
+                        pDetectedFormat = &lcl_RGB16[nComponentOrderIndex];
+                    }
+                    else if( nNumComponents == 4 )
+                    {
+                        if( aComponentBitcounts[1] == 4 )
+                        {
+                            pDetectedFormat = &lcl_ARGB16_4[nComponentOrderIndex];
+                        }
+                        else if( aComponentBitcounts[1] == 5 )
+                        {
+                            pDetectedFormat = &lcl_ARGB16_5[nComponentOrderIndex];
+                        }
+                    }
+                    break;
+                case 24:
+                    if( nNumComponents == 3 )
+                    {
+                        pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
+                    }
+                    break;
+                case 32:
+                    pDetectedFormat = &lcl_ARGB32[nComponentOrderIndex];
+                    break;
+            }
+        }
+#else
+        const uno::Sequence<sal_Int8> aComponentTags(
+            xIntColorSpace->getComponentTags());
+        const int nComponentOrderIndex(calcComponentOrderIndex(aComponentTags));
+        if( aComponentTags.getLength() == 3 && 
+            nComponentOrderIndex != -1 && 
+            xIntColorSpace->getBitsPerPixel() == 24 )
+        {
+            pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
+        }
+#endif
+    }
+
+    return pDetectedFormat;
+}
+
+void OGLTransitionerImpl::GLInitSlides()
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed() || pTransition->mnRequiredGLVersion > cnGLVersion)
+        return;
+
+    prepareEnvironment();
+
+    const OGLFormat* pFormat = NULL;
+    if( !mbUseLeavingPixmap || !mbUseEnteringPixmap )
+    pFormat = chooseFormats();
+
+    createTexture( &GLleavingSlide,
+           pTransition->mbUseMipMapLeaving,
+           LeavingBytes,
+           pFormat );
+
+    createTexture( &GLenteringSlide,
+
+           pTransition->mbUseMipMapEntering,
+           EnteringBytes,
+           pFormat );
+
+#ifdef DEBUG
+    t2 = microsec_clock::local_time();
+    OSL_TRACE("textures created in: %s", to_simple_string( t2 - t1 ).c_str());
+#endif
+}
+
+void SAL_CALL OGLTransitionerImpl::update( double nTime ) throw (uno::RuntimeException)
+{
+#ifdef DEBUG
+    frame_count ++;
+    t3 = microsec_clock::local_time();
+    if( frame_count == 1 ) {
+    t5 = t3;
+    total_update = seconds (0);
+    }
+#endif
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed() || !cbGLXPresent || pTransition->mnRequiredGLVersion > cnGLVersion)
+        return;
+
+    if(GLWin.pOpenGLContext)
+        [GLWin.pOpenGLContext makeCurrentContext];
+
+    glEnable(GL_DEPTH_TEST);
+    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
+/*
+    if(pTransition)
+    pTransition->display( nTime, GLleavingSlide, GLenteringSlide, 
+                              SlideSize.Width, SlideSize.Height,
+                              static_cast<double>(GLWin.Width),
+                              static_cast<double>(GLWin.Height) );
+*/
+    // works but not mandatory
+#ifdef MAC_OS_X_VERSION_10_5
+    int swapInt = 1;
+#else /* build target 10.4 */ 
+    long swapInt = 1;
+#endif
+    [[GLWin.pAquaOpenGLView openGLContext] setValues:&swapInt forParameter:NSOpenGLCPSwapInterval]; // set to vbl sync
+
+    NSOpenGLContext* context = [GLWin.pAquaOpenGLView openGLContext];
+    [context makeCurrentContext];
+
+    if(pTransition)
+    pTransition->display( nTime, GLleavingSlide, GLenteringSlide, 
+                              SlideSize.Width, SlideSize.Height,
+                              static_cast<double>(GLWin.Width),
+                              static_cast<double>(GLWin.Height) );
+
+
+    [context flushBuffer];
+
+    if( pWindow )
+        pWindow->Show();
+
+#ifdef DEBUG
+    t4 = microsec_clock::local_time();
+
+    OSL_TRACE("update time: %f", nTime);
+    OSL_TRACE("update took: %s", to_simple_string( t4 - t3 ).c_str());
+    total_update += (t4 - t3);
+#endif
+}
+
+void SAL_CALL OGLTransitionerImpl::viewChanged( const Reference< presentation::XSlideShowView >& rView,
+                        const Reference< rendering::XBitmap >& rLeavingBitmap,
+                        const Reference< rendering::XBitmap >& rEnteringBitmap )
+    throw (uno::RuntimeException)
+{
+    OSL_TRACE("transitioner: view changed");
+
+    disposeTextures();
+    disposeContextAndWindow();
+
+    initWindowFromSlideShowView( rView );
+
+    setSlides( rLeavingBitmap, rEnteringBitmap );
+}
+
+void OGLTransitionerImpl::disposeContextAndWindow()
+{
+ /*
+    if(GLWin.pOpenGLContext)
+        [GLWin.pOpenGLContext makeCurrentContext];
+    if( glGetError() != GL_NO_ERROR )
+    {
+        OSL_TRACE("glError: %s", (char *)gluErrorString(glGetError()));
+        if(GLWin.pOpenGLContext)
+            [GLWin.pOpenGLContext clearGLContext];
+    }
+*/
+    if(GLWin.pAquaOpenGLView)
+    {
+        [GLWin.pAquaOpenGLView clearGLContext];// currentContext]; //clearCurrentContext];
+        [GLWin.pAquaOpenGLView willRemoveSubview:GLWin.apView];
+        [GLWin.pAquaOpenGLView removeFromSuperview];
+        [GLWin.pAquaOpenGLView release];
+    }
+
+    if( pWindow )
+    {
+        delete pWindow;
+        pWindow = NULL;
+        GLWin.pAquaOpenGLView = nil;
+    }
+}
+
+void OGLTransitionerImpl::disposeTextures()
+{
+    if(GLWin.pOpenGLContext)
+        [GLWin.pOpenGLContext makeCurrentContext];
+
+    if( !mbUseLeavingPixmap )
+    {
+        glDeleteTextures(1,&GLleavingSlide);
+        GLleavingSlide = 0;
+    }
+
+    if( !mbUseEnteringPixmap )
+    {
+        glDeleteTextures(1,&GLenteringSlide);
+        GLleavingSlide = 0;
+    }
+
+    mbUseLeavingPixmap = false;
+    mbUseEnteringPixmap = false;
+}
+
+// we are about to be disposed (someone call dispose() on us)
+void OGLTransitionerImpl::disposing()
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+#ifdef DEBUG
+    OSL_TRACE("dispose %p\n", this);
+    if( frame_count ) {
+    t6 = microsec_clock::local_time();
+    time_duration duration = t6 - t5;
+    OSL_TRACE("whole transition (frames: %d) took: %s fps: %f time spent in updates: %s percentage of transition time: %f%%",
+          frame_count, to_simple_string( duration ).c_str(),
+          ((double)frame_count*1000000000.0)/duration.total_nanoseconds(),
+          to_simple_string( total_update ).c_str(),
+          100*(((double)total_update.total_nanoseconds())/((double)duration.total_nanoseconds()))
+        );
+    }
+#endif
+
+    if( pWindow )
+    {
+        disposeTextures();
+
+        if (pTransition)
+            pTransition->finish();
+
+        disposeContextAndWindow();
+    }
+
+    if (pTransition)
+    delete pTransition;
+
+    mxLeavingBitmap.clear();
+    mxEnteringBitmap.clear();
+    mxView.clear();
+}
+
+OGLTransitionerImpl::OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition) : 
+    OGLTransitionerImplBase(m_aMutex), 
+    GLWin(),
+    GLleavingSlide( 0 ), 
+    GLenteringSlide( 0 ), 
+    pWindow( NULL ), 
+    mxView(),
+    EnteringBytes(),
+    LeavingBytes(),
+    mbRestoreSync( false ),
+    mbUseLeavingPixmap( false ),
+    mbUseEnteringPixmap( false ),
+    SlideBitmapLayout(),
+    SlideSize(),
+    pTransition(pOGLTransition)
+{
+    GLWin.pAquaOpenGLView = nil;
+    DBG(frame_count = 0);
+}
+
+typedef cppu::WeakComponentImplHelper1<presentation::XTransitionFactory> OGLTransitionFactoryImplBase;
+
+class OGLTransitionFactoryImpl : private cppu::BaseMutex, public OGLTransitionFactoryImplBase
+{
+public:
+    explicit OGLTransitionFactoryImpl( const uno::Reference< uno::XComponentContext >& ) :
+        OGLTransitionFactoryImplBase(m_aMutex)
+    {}
+
+    // XTransitionFactory
+    virtual ::sal_Bool SAL_CALL hasTransition( ::sal_Int16 transitionType, ::sal_Int16 transitionSubType ) throw (uno::RuntimeException)
+    {
+        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
+            switch( transitionSubType )
+                {
+                case animations::TransitionSubType::ACROSS:
+                case animations::TransitionSubType::CORNERSOUT:
+                case animations::TransitionSubType::CIRCLE:
+                case animations::TransitionSubType::FANOUTHORIZONTAL:
+                case animations::TransitionSubType::CORNERSIN:  
+                case animations::TransitionSubType::LEFTTORIGHT:
+                case animations::TransitionSubType::TOPTOBOTTOM:
+                case animations::TransitionSubType::TOPRIGHT:
+                case animations::TransitionSubType::TOPLEFT:
+                case animations::TransitionSubType::BOTTOMRIGHT:
+                case animations::TransitionSubType::BOTTOMLEFT:
+                case animations::TransitionSubType::TOPCENTER:
+                case animations::TransitionSubType::RIGHTCENTER:
+                case animations::TransitionSubType::BOTTOMCENTER:
+                    return sal_True;
+
+                default:
+                    return sal_False;
+                }
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
+            return sal_True;
+        } else
+            return sal_False;
+    }
+
+    virtual uno::Reference< presentation::XTransition > SAL_CALL createTransition( 
+        ::sal_Int16                                           transitionType, 
+        ::sal_Int16                                           transitionSubType, 
+        const uno::Reference< presentation::XSlideShowView >& view, 
+        const uno::Reference< rendering::XBitmap >&           leavingBitmap, 
+        const uno::Reference< rendering::XBitmap >&           enteringBitmap )
+    throw (uno::RuntimeException)
+    {
+        if( !hasTransition( transitionType, transitionSubType ) )
+            return uno::Reference< presentation::XTransition >();
+
+        bool bGLXPresent = OGLTransitionerImpl::initialize( view );
+
+        if( 
+            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) ||
+            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) ||
+            ( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) )
+            return uno::Reference< presentation::XTransition >();
+            
+
+        OGLTransitionImpl* pTransition = NULL;
+
+        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
+            pTransition = new OGLTransitionImpl();
+            switch( transitionSubType )
+                {
+                case animations::TransitionSubType::ACROSS:
+                    pTransition->makeNByMTileFlip(8,6);
+                    break;   
+                case animations::TransitionSubType::CORNERSOUT:
+                    pTransition->makeOutsideCubeFaceToLeft();
+                    break;            
+                case animations::TransitionSubType::CIRCLE:
+                    pTransition->makeRevolvingCircles(8,128);
+                    break;
+                case animations::TransitionSubType::FANOUTHORIZONTAL:
+                    pTransition->makeHelix(20);
+                    break;
+                case animations::TransitionSubType::CORNERSIN:  
+                    pTransition->makeInsideCubeFaceToLeft();
+                    break;
+                case animations::TransitionSubType::LEFTTORIGHT:
+                    pTransition->makeFallLeaving();
+                    break;
+                case animations::TransitionSubType::TOPTOBOTTOM:
+                    pTransition->makeTurnAround();
+                    break;
+                case animations::TransitionSubType::TOPRIGHT:
+                    pTransition->makeTurnDown();
+                    break;
+                case animations::TransitionSubType::TOPLEFT:
+                    pTransition->makeIris();
+                    break;
+                case animations::TransitionSubType::BOTTOMRIGHT:
+                    pTransition->makeRochade();
+                    break;
+                case animations::TransitionSubType::BOTTOMLEFT:
+                    pTransition->makeVenetianBlinds( true, 8 );
+                    break;
+                case animations::TransitionSubType::TOPCENTER:
+                    pTransition->makeVenetianBlinds( false, 6 );
+                    break;
+                case animations::TransitionSubType::RIGHTCENTER:
+                    pTransition->makeStatic();
+                    break;
+                case animations::TransitionSubType::BOTTOMCENTER:
+                    pTransition->makeDissolve();
+                    break;
+                }
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeFadeSmoothly();
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeFadeThroughBlack();
+        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeDiamond();
+        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeNewsflash();
+        }
+
+        rtl::Reference<OGLTransitionerImpl> xRes(
+            new OGLTransitionerImpl(pTransition) );
+        if( bGLXPresent ) {
+            if( !xRes->initWindowFromSlideShowView(view))
+                return uno::Reference< presentation::XTransition >();
+            xRes->setSlides(leavingBitmap,enteringBitmap);
+        }
+
+        return uno::Reference<presentation::XTransition>(xRes.get());
+    }
+};
+
+}
+
+namespace sdecl = comphelper::service_decl;
+#if defined (__GNUC__) && (__GNUC__ == 3 && __GNUC_MINOR__ <= 3)
+ sdecl::class_<OGLTransitionFactoryImpl> serviceImpl;
+ const sdecl::ServiceDecl OGLTransitionFactoryDecl(
+     serviceImpl,
+#else
+ const sdecl::ServiceDecl OGLTransitionFactoryDecl(
+     sdecl::class_<OGLTransitionFactoryImpl>(),
+#endif
+    "com.sun.star.comp.presentation.OGLTransitionFactory",
+    "com.sun.star.presentation.TransitionFactory" );
+
+// The C shared lib entry points
+COMPHELPER_SERVICEDECL_EXPORTS1(OGLTransitionFactoryDecl)
diff --git slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.h slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.h
new file mode 100644
index 0000000..9c43a0e
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.h
@@ -0,0 +1,36 @@
+/*
+ *  aquaOpenGLView.h
+ */
+
+@class NSOpenGLContext, NSOpenGLPixelFormat;
+
+// the most interesting is there : in OGLTrans, we use an NSView* 
+// and subclass the NSView to create an OpenGLView does the trick
+
+@interface AquaOpenGLView : NSView
+{
+  @private
+    NSOpenGLContext*     _openGLContext;
+    NSOpenGLPixelFormat* _pixelFormat;
+}
+
++ (NSOpenGLPixelFormat*)defaultPixelFormat;
+
+- (id)initWithFrame:(NSRect)frameRect pixelFormat:(NSOpenGLPixelFormat*)format;
+- (void)dealloc;
+- (void)setOpenGLContext:(NSOpenGLContext*)context;
+- (NSOpenGLContext*)openGLContext;
+- (void)clearGLContext;
+- (void)prepareOpenGL;
+- (BOOL)isOpaque;
+- (void)drawRect;
+- (void)lockFocus;
+- (void)update;		// moved or resized
+// reshape is not supported, update bounds in drawRect
+- (void) _surfaceNeedsUpdate:(NSNotification*)notification;
+- (void)setPixelFormat:(NSOpenGLPixelFormat*)pixelFormat;
+- (NSOpenGLPixelFormat*)pixelFormat;
+- (void)encodeWithCoder:(NSCoder *)coder;
+- (id)initWithCoder:(NSCoder *)coder;
+
+@end
diff --git slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.m slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.m
new file mode 100644
index 0000000..cb0d563
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/aquaOpenGLView.m
@@ -0,0 +1,195 @@
+/*
+ *  aquaOpenGLView.m
+ */
+
+#include <Cocoa/Cocoa.h>
+#include <OpenGL/OpenGL.h>
+#include <OpenGL/gl.h>
+
+#include "aquaOpenGLView.h"
+
+@implementation AquaOpenGLView
+
++ (NSOpenGLPixelFormat*)defaultPixelFormat
+{
+// first simple implementation (let's see later with more complex )
+    NSOpenGLPixelFormatAttribute attributes [] = 
+    {
+        NSOpenGLPFAWindow,
+        NSOpenGLPFADoubleBuffer,	// double buffered
+        NSOpenGLPFADepthSize, (NSOpenGLPixelFormatAttribute)16, // 16 bit depth buffer
+        (NSOpenGLPixelFormatAttribute)nil
+    };
+    return [[[NSOpenGLPixelFormat alloc] initWithAttributes:attributes] autorelease];
+}
+
+- (id)initWithFrame:(NSRect)frameRect pixelFormat:(NSOpenGLPixelFormat*)format
+{
+    self = [super initWithFrame:frameRect];
+    if (self != nil) {
+        _pixelFormat   = [format retain];
+    }
+    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(_surfaceNeedsUpdate:) name:NSViewGlobalFrameDidChangeNotification object:self];
+    return self;
+}
+
+- (void)dealloc
+{   // get rid of the context and pixel format
+    [[NSNotificationCenter defaultCenter] removeObserver:self name:NSViewGlobalFrameDidChangeNotification object:self];
+    [self clearGLContext];
+    if (_pixelFormat)
+        [_pixelFormat release];
+
+    [super dealloc];
+}
+
+- (void)setOpenGLContext:(NSOpenGLContext*)context
+{
+    [self clearGLContext];
+    _openGLContext = [context retain];
+}
+
+- (NSOpenGLContext*)openGLContext
+{   // create a context the first time through
+     if (_openGLContext == NULL) {
+        _openGLContext = [[NSOpenGLContext alloc] initWithFormat:_pixelFormat != nil ? _pixelFormat : [[self class] defaultPixelFormat] shareContext:nil];
+        [_openGLContext makeCurrentContext];
+        [self prepareOpenGL]; // call to initialize OpenGL state here
+    }
+    return _openGLContext;
+}
+
+- (void)clearGLContext
+{
+    if (_openGLContext != nil) {
+        if ([_openGLContext view] == self) {
+            [_openGLContext clearDrawable];
+        }
+        [_openGLContext release];
+        _openGLContext = nil;
+    }
+}
+
+- (void)prepareOpenGL
+{
+    // for overriding to initialize OpenGL state, occurs after context creation
+#ifdef MAC_OS_X_VERSION_10_4
+    long swapInt = 1;
+#else /* build target 10.5 */ 
+    int swapInt = 1;
+#endif
+
+    [[self openGLContext] setValues:&swapInt forParameter:NSOpenGLCPSwapInterval]; // set to vbl sync
+
+    // init GL stuff here
+    // FIXME: why is there garbage using prepareOpenGL ,
+    // but NOT, wen using the same content,
+    // directly in the OGLTrans instance ?
+    glShadeModel( GL_SMOOTH );
+    glEnable(GL_CULL_FACE);
+    glCullFace(GL_BACK);
+    glClearColor (0.0f, 0.0f, 0.0f, 0.0f);  // R G B A
+    glClear(GL_COLOR_BUFFER_BIT);
+    glClearDepth( 1.0f );
+    glEnable( GL_DEPTH_TEST );
+    glDepthFunc( GL_LEQUAL );
+    glHint( GL_PERSPECTIVE_CORRECTION_HINT, GL_NICEST );
+    glEnable(GL_TEXTURE_2D);
+
+
+    glEnable(GL_LIGHTING);
+    GLfloat light_direction[] = { 0.0 , 0.0 , 1.0 };
+    GLfloat materialDiffuse[] = { 1.0 , 1.0 , 1.0 , 1.0};
+    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, light_direction);
+    glMaterialfv(GL_FRONT,GL_DIFFUSE,materialDiffuse);
+    glEnable(GL_LIGHT0);
+    glEnable(GL_NORMALIZE);
+
+    [[self openGLContext] flushBuffer];
+}
+
+- (BOOL)isOpaque
+{
+    return YES;
+}
+
+- (void)drawRect
+{
+    // get context. will create if we don't have one yet
+    NSOpenGLContext* context = [self openGLContext];
+    [context makeCurrentContext];
+    //perform drawing here
+    [context flushBuffer];
+}
+
+- (void)lockFocus
+{
+    // get context. will create if we don't have one yet
+    NSOpenGLContext* context = [self openGLContext];
+    
+    // make sure we are ready to draw
+    [super lockFocus];
+
+    // when we are about to draw, make sure we are linked to the view
+    if ([context view] != self) {
+        [context setView:self];
+    }
+
+    // make us the current OpenGL context
+    [context makeCurrentContext];
+}
+
+// no reshape will be called since NSView does not export a specific reshape method
+
+- (void)update
+{
+    if ([_openGLContext view] == self) {
+        [_openGLContext update];
+    }
+}
+
+- (void) _surfaceNeedsUpdate:(NSNotification*)notification
+{
+    [self update];
+}
+
+- (void)setPixelFormat:(NSOpenGLPixelFormat*)pixelFormat
+{
+    [_pixelFormat release];
+    _pixelFormat = [pixelFormat retain];
+}
+
+- (NSOpenGLPixelFormat*)pixelFormat
+{
+    return _pixelFormat;
+}
+
+
+- (void)encodeWithCoder:(NSCoder *)coder 
+{
+
+    [super encodeWithCoder:coder];
+    if (![coder allowsKeyedCoding]) {
+        [coder encodeValuesOfObjCTypes:"@iii", &_pixelFormat];
+    } else {
+        [coder encodeObject:_pixelFormat forKey:@"NSPixelFormat"];
+    }
+}
+
+- (id)initWithCoder:(NSCoder *)coder 
+{
+
+    self = [super initWithCoder:coder];
+
+    if (![coder allowsKeyedCoding]) {
+        [coder decodeValuesOfObjCTypes:"@iii", &_pixelFormat];
+    } else {
+        _pixelFormat = [[coder decodeObjectForKey:@"NSPixelFormat"] retain];
+    }
+    
+    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(_surfaceNeedsUpdate:) name:NSViewGlobalFrameDidChangeNotification object:self];
+    
+    return self;
+}
+
+@end
diff --git slideshow/source/engine/OGLTrans/mac/makefile.mk slideshow/source/engine/OGLTrans/mac/makefile.mk
new file mode 100644
index 0000000..efcc66a
--- /dev/null
+++ slideshow/source/engine/OGLTrans/mac/makefile.mk
@@ -0,0 +1,92 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile.mk,v $
+#
+# $Revision: 1.5.12.1 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+PRJ=..$/..$/..$/..
+
+.IF "$(ENABLE_OPENGL)" != "TRUE" || "$(OS)" != "MACOSX"
+all:
+    @echo "Building without OpenGL transitions"
+.ENDIF
+
+PRJNAME=slideshow
+TARGET=OGLTrans
+ENABLE_EXCEPTIONS=TRUE
+
+# --- Settings -----------------------------------------------------------
+
+.INCLUDE :      settings.mk
+.INCLUDE : $(PRJ)$/util$/makefile.pmk
+
+# --- Common ----------------------------------------------------------
+
+.IF "$(OS)"=="WNT"
+IMPL_SUBDIR=win
+.ELIF "$(OS)"=="MACOSX"
+IMPL_SUBDIR=mac
+.ELSE
+IMPL_SUBDIR=unx
+.ENDIF
+
+
+SLOFILES = \
+    $(SLO)$/OGLTrans_TransitionImpl_$(OS).obj \
+    $(SLO)$/aquaOpenGLView.obj \
+    $(SLO)$/OGLTrans_TransitionerImpl_$(OS).obj
+
+.IF "$(OS)$(CPU)" != "MACOSXP"
+SLOFILES += \
+    $(SLO)$/OGLTrans_Shaders_$(OS).obj
+.ENDIF
+
+SHL1TARGET=$(TARGET).uno
+
+SHL1STDLIBS= $(SALLIB) $(VCLLIB) $(CPPULIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(CANVASTOOLSLIB)
+
+SHL1STDLIBS += \
+    -framework OpenGL \
+    -framework Cocoa \
+    -framework GLUT
+
+CFLAGSCXX+= -x objective-c++ -fobjc-exceptions
+
+
+SHL1IMPLIB=i$(TARGET)
+SHL1LIBS=$(SLB)$/$(TARGET).lib
+SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+
+SHL1VERSIONMAP=../exports.map
+
+DEF1NAME=$(SHL1TARGET)
+DEF1EXPORTFILE=../exports.dxp
+
+# ==========================================================================
+
+.INCLUDE :	target.mk
diff --git slideshow/source/engine/OGLTrans/makefile.mk slideshow/source/engine/OGLTrans/makefile.mk
deleted file mode 100644
index 6353b2d..0000000
--- slideshow/source/engine/OGLTrans/makefile.mk
+++ /dev/null
@@ -1,84 +0,0 @@
-#*************************************************************************
-#
-# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
-# 
-# Copyright 2008 by Sun Microsystems, Inc.
-#
-# OpenOffice.org - a multi-platform office productivity suite
-#
-# $RCSfile: makefile.mk,v $
-#
-# $Revision: 1.5 $
-#
-# This file is part of OpenOffice.org.
-#
-# OpenOffice.org is free software: you can redistribute it and/or modify
-# it under the terms of the GNU Lesser General Public License version 3
-# only, as published by the Free Software Foundation.
-#
-# OpenOffice.org is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU Lesser General Public License version 3 for more details
-# (a copy is included in the LICENSE file that accompanied this code).
-#
-# You should have received a copy of the GNU Lesser General Public License
-# version 3 along with OpenOffice.org.  If not, see
-# <http://www.openoffice.org/license.html>
-# for a copy of the LGPLv3 License.
-#
-#*************************************************************************
-
-PRJ=..$/..$/..
-
-PRJNAME=slideshow
-TARGET=OGLTrans
-TARGETTYPE=GUI
-ENABLE_EXCEPTIONS=TRUE
-
-# --- Settings -----------------------------------------------------------
-
-.INCLUDE :      settings.mk
-.INCLUDE : $(PRJ)$/util$/makefile.pmk
-
-# --- Nothing to do if we're compiling with --disable-opengl -----------
-.IF "$(ENABLE_OPENGL)" != "TRUE"
-@all:
-    @echo "Building without OpenGL Transitions..."
-.ENDIF
-
-# --- Common ----------------------------------------------------------
-#.IF "$(GUI)"=="UNX"
-
-SLOFILES = \
-        $(SLO)$/OGLTrans_TransitionImpl.obj \
-        $(SLO)$/OGLTrans_Shaders.obj \
-        $(SLO)$/OGLTrans_TransitionerImpl.obj
-
-DLLPRE=
-SHL1TARGET=$(TARGET).uno
-
-.IF "$(GUI)"=="UNX"
-.IF "$(GUIBASE)"=="aqua"
-    SHL1STDLIBS= $(SALLIB) $(VCLLIB) $(CPPULIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(CANVASTOOLSLIB)
-    CFLAGSCXX+=$(OBJCXXFLAGS)
-.ELSE
-    SHL1STDLIBS= $(SALLIB) $(VCLLIB) $(CPPULIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(CANVASTOOLSLIB) -lGL -lGLU -lX11
-.ENDIF
-.ELSE
-    SHL1STDLIBS= $(SALLIB) $(VCLLIB) $(CPPULIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(CANVASTOOLSLIB) opengl32.lib glu32.lib gdi32.lib
-.ENDIF
-SHL1IMPLIB=i$(TARGET)
-SHL1LIBS=$(SLB)$/$(TARGET).lib
-SHL1DEF=$(MISC)$/$(SHL1TARGET).def
-
-SHL1VERSIONMAP=exports.map
-
-DEF1NAME=$(SHL1TARGET)
-DEF1EXPORTFILE=exports.dxp
-
-#.ENDIF
-
-# ==========================================================================
-
-.INCLUDE :	target.mk
diff --git slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders.hxx slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders.hxx
new file mode 100644
index 0000000..049c71f
--- /dev/null
+++ slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders.hxx
@@ -0,0 +1,71 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: $
+ * $Revision: $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef INCLUDED_OGLTRANS_SHADERS_HXX_
+#define INCLUDED_OGLTRANS_SHADERS_HXX_
+
+#define GL_GLEXT_PROTOTYPES 1
+#include <GL/gl.h>
+#include <GL/glext.h>
+
+class OGLShaders {
+    static bool Initialize();
+    static bool cbInitialized;
+
+public:    
+
+    static GLuint LinkProgram( const char *vertexShader, const char *fragmentShader );
+
+    /** GL shader functions
+     */
+#ifdef GL_VERSION_2_0
+
+    static PFNGLCREATESHADERPROC glCreateShader;
+    static PFNGLSHADERSOURCEPROC glShaderSource;
+    static PFNGLCOMPILESHADERPROC glCompileShader;
+    static PFNGLGETSHADERIVPROC glGetShaderiv;
+    static PFNGLGETSHADERINFOLOGPROC glGetShaderInfoLog;
+    static PFNGLDELETESHADERPROC glDeleteShader;
+
+    static PFNGLCREATEPROGRAMPROC glCreateProgram;
+    static PFNGLATTACHSHADERPROC glAttachShader;
+    static PFNGLLINKPROGRAMPROC glLinkProgram;
+    static PFNGLGETPROGRAMIVPROC glGetProgramiv;
+    static PFNGLGETPROGRAMINFOLOGPROC glGetProgramInfoLog;
+    static PFNGLUSEPROGRAMPROC glUseProgram;
+    static PFNGLDELETEPROGRAMPROC glDeleteProgram;
+
+    static PFNGLGETUNIFORMLOCATIONPROC glGetUniformLocation;
+    static PFNGLUNIFORM1IPROC glUniform1i;
+    static PFNGLUNIFORM1FPROC glUniform1f;
+#endif
+};
+
+#endif
diff --git slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders_LINUX.cxx slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders_LINUX.cxx
new file mode 100644
index 0000000..a144790
--- /dev/null
+++ slideshow/source/engine/OGLTrans/unx/OGLTrans_Shaders_LINUX.cxx
@@ -0,0 +1,143 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: $
+ * $Revision: $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include <osl/diagnose.hxx>
+
+#include "OGLTrans_Shaders.hxx"
+
+namespace unx
+{
+#include <GL/glx.h>
+#include <GL/glxext.h>
+}
+
+bool OGLShaders::cbInitialized = false;
+
+#ifdef GL_VERSION_2_0
+
+PFNGLCREATESHADERPROC OGLShaders::glCreateShader = NULL;
+PFNGLSHADERSOURCEPROC OGLShaders::glShaderSource = NULL;
+PFNGLCOMPILESHADERPROC OGLShaders::glCompileShader = NULL;
+PFNGLGETSHADERIVPROC OGLShaders::glGetShaderiv = NULL;
+PFNGLGETSHADERINFOLOGPROC OGLShaders::glGetShaderInfoLog = NULL;
+PFNGLDELETESHADERPROC OGLShaders::glDeleteShader = NULL;
+PFNGLCREATEPROGRAMPROC OGLShaders::glCreateProgram = NULL;
+PFNGLATTACHSHADERPROC OGLShaders::glAttachShader = NULL;
+PFNGLLINKPROGRAMPROC OGLShaders::glLinkProgram = NULL;
+PFNGLGETPROGRAMIVPROC OGLShaders::glGetProgramiv = NULL;
+PFNGLGETPROGRAMINFOLOGPROC OGLShaders::glGetProgramInfoLog = NULL;
+PFNGLUSEPROGRAMPROC OGLShaders::glUseProgram = NULL;
+PFNGLDELETEPROGRAMPROC OGLShaders::glDeleteProgram = NULL;
+PFNGLGETUNIFORMLOCATIONPROC OGLShaders::glGetUniformLocation = NULL;
+PFNGLUNIFORM1IPROC OGLShaders::glUniform1i = NULL;
+PFNGLUNIFORM1FPROC OGLShaders::glUniform1f = NULL;
+#endif
+
+bool OGLShaders::Initialize()
+{
+#ifdef GL_VERSION_2_0
+    if( !cbInitialized ) {
+        glCreateShader = (PFNGLCREATESHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glCreateShader" );
+        glShaderSource = (PFNGLSHADERSOURCEPROC) unx::glXGetProcAddress( (unsigned char *) "glShaderSource" );
+        glCompileShader = (PFNGLCOMPILESHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glCompileShader" );
+        glGetShaderiv = (PFNGLGETSHADERIVPROC) unx::glXGetProcAddress( (unsigned char *) "glGetShaderiv" );
+        glGetShaderInfoLog = (PFNGLGETSHADERINFOLOGPROC) unx::glXGetProcAddress( (unsigned char *) "glGetShaderInfoLog" );
+        glDeleteShader = (PFNGLDELETESHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glDeleteShader" );
+        glCreateProgram = (PFNGLCREATEPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glCreateProgram" );
+        glAttachShader = (PFNGLATTACHSHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glAttachShader" );
+        glLinkProgram = (PFNGLLINKPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glLinkProgram" );
+        glGetProgramiv = (PFNGLGETPROGRAMIVPROC) unx::glXGetProcAddress( (unsigned char *) "glGetProgramiv" );
+        glGetProgramInfoLog = (PFNGLGETPROGRAMINFOLOGPROC) unx::glXGetProcAddress( (unsigned char *) "glGetProgramInfoLog" );
+        glUseProgram = (PFNGLUSEPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glUseProgram" );
+        glDeleteProgram = (PFNGLDELETEPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glDeleteProgram" );
+        glGetUniformLocation = (PFNGLGETUNIFORMLOCATIONPROC) unx::glXGetProcAddress( (unsigned char *) "glGetUniformLocation" );
+        glUniform1i = (PFNGLUNIFORM1IPROC) unx::glXGetProcAddress( (unsigned char *) "glUniform1i" );
+        glUniform1f = (PFNGLUNIFORM1FPROC) unx::glXGetProcAddress( (unsigned char *) "glUniform1f" );
+        cbInitialized = true;
+    }
+
+    return glCreateShader != NULL;
+#else
+    return false;
+#endif
+}
+
+GLuint OGLShaders::LinkProgram( const char *vertexShader, const char *fragmentShader )
+{
+#ifdef GL_VERSION_2_0
+    if( !Initialize() )
+        return 0;
+
+    GLhandleARB vertexObject, fragmentObject, programObject;
+    GLint vertexCompiled, fragmentCompiled, programLinked;
+    char log[1024];
+
+    vertexObject = glCreateShader( GL_VERTEX_SHADER );
+    fragmentObject = glCreateShader( GL_FRAGMENT_SHADER );
+    OSL_TRACE("checkpoint 1: shaders created (%d) vertex: %d fragment: %d", glGetError() == GL_NO_ERROR, vertexObject, fragmentObject );
+
+
+    glShaderSource( vertexObject, 1, &vertexShader, NULL );
+    glShaderSource( fragmentObject, 1, &fragmentShader, NULL );
+
+    glCompileShader( vertexObject );
+    glGetShaderInfoLog( vertexObject, sizeof( log ), NULL, log );
+    OSL_TRACE("vertex compile log: %s", log);
+    glGetShaderiv( vertexObject, GL_COMPILE_STATUS, &vertexCompiled );
+    glCompileShader( fragmentObject );
+    glGetShaderInfoLog( fragmentObject, sizeof( log ), NULL, log );
+    OSL_TRACE("fragment compile log: %s", log);
+    glGetShaderiv( fragmentObject, GL_COMPILE_STATUS, &fragmentCompiled );
+
+    if( !vertexCompiled || !fragmentCompiled )
+        return 0;
+
+    OSL_TRACE("checkpoint 2: shaders compiled (%d)", glGetError() == GL_NO_ERROR);
+
+    programObject = glCreateProgram();
+    glAttachShader( programObject, vertexObject );
+    glAttachShader( programObject, fragmentObject );
+
+    glLinkProgram( programObject );
+    glGetProgramInfoLog( programObject, sizeof( log ), NULL, log );
+    OSL_TRACE("program link log: %s", log);
+    glGetProgramiv( programObject, GL_LINK_STATUS, &programLinked );
+
+    if( !programLinked )
+        return 0;
+
+    OSL_TRACE("checkpoint 3: program linked (%d)", glGetError() == GL_NO_ERROR);
+
+    return programObject;
+#else
+    return 0;
+#endif
+}
+
diff --git slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.cxx slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.cxx
new file mode 100644
index 0000000..de63a1b
--- /dev/null
+++ slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.cxx
@@ -0,0 +1,1318 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionImpl.cxx,v $
+ * $Revision: 1.5 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include "OGLTrans_TransitionImpl.hxx"
+#include "OGLTrans_Shaders.hxx"
+#include <GL/gl.h>
+#include <math.h>
+
+
+void OGLTransitionImpl::clear()
+{
+    for(unsigned int i( 0 ); i < OverallOperations.size(); ++i)
+        delete OverallOperations[i];
+    OverallOperations.clear();
+    maLeavingSlidePrimitives.clear();
+    maEnteringSlidePrimitives.clear();
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
+        delete maSceneObjects[i];
+    maSceneObjects.clear();
+
+    mbReflectSlides = false;
+
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        OGLShaders::glDeleteProgram( mProgramObject );
+        mProgramObject = 0;
+    }
+
+    if( mVertexObject ) {
+        OGLShaders::glDeleteShader( mVertexObject );
+        mVertexObject = 0;
+    }
+
+    if( mFragmentObject ) {
+        OGLShaders::glDeleteShader( mFragmentObject );
+        mFragmentObject = 0;
+    }
+#endif
+
+    if( maHelperTexture ) {
+        glDeleteTextures( 1, &maHelperTexture );
+        maHelperTexture = 0;
+    }
+
+    if( mmClearTransition )
+        (this->*mmClearTransition)();
+}
+
+OGLTransitionImpl::~OGLTransitionImpl()
+{
+    clear();
+}
+
+void OGLTransitionImpl::prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex )
+{
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
+        maSceneObjects[i]->prepare();
+    }
+
+    if( mmPrepareTransition )
+        (this->*mmPrepareTransition)( glLeavingSlideTex, glEnteringSlideTex );
+}
+
+void OGLTransitionImpl::finish()
+{
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
+        maSceneObjects[i]->finish();
+    }
+}
+
+static void blendSlide( double depth )
+{
+    double showHeight = -1 + depth*2;
+    GLfloat reflectionColor[] = {0, 0, 0, 0.25};
+
+    glDisable( GL_DEPTH_TEST );
+    glBegin( GL_QUADS );
+    glColor4fv( reflectionColor );
+    glVertex3f( -1, -1, 0 );
+    glColor4f( 0, 0, 0, 1 );
+    glVertex3f(-1,  showHeight, 0 );
+    glVertex3f( 1,  showHeight, 0 );
+    glColor4fv( reflectionColor );
+    glVertex3f( 1, -1, 0 );
+    glEnd();
+
+    glBegin( GL_QUADS );
+    glColor4f( 0, 0, 0, 1 );
+    glVertex3f( -1, showHeight, 0 );
+    glVertex3f( -1,  1, 0 );
+    glVertex3f(  1,  1, 0 );
+    glVertex3f(  1, showHeight, 0 );
+    glEnd();
+    glEnable( GL_DEPTH_TEST );
+}
+
+static void slideShadow( double nTime, Primitive& primitive, double sw, double sh )
+{
+    double reflectionDepth = 0.3;
+
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glDisable(GL_LIGHTING);
+
+    glPushMatrix();
+    primitive.applyOperations( nTime, sw, sh );
+    blendSlide( reflectionDepth );
+    glPopMatrix();
+
+    glDisable(GL_BLEND);
+    glEnable(GL_LIGHTING);
+}
+
+void OGLTransitionImpl::display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                 double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    double SlideWidthScale, SlideHeightScale;
+
+    SlideWidthScale = SlideWidth/DispWidth;
+    SlideHeightScale = SlideHeight/DispHeight;
+
+    if( mmPrepare ) {
+        clear();
+        (this->*mmPrepare)( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
+    }
+
+    glPushMatrix();
+    displaySlides( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
+    displayScene( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
+    glPopMatrix();
+}
+
+void OGLTransitionImpl::applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale )
+{
+    for(unsigned int i(0); i < OverallOperations.size(); ++i)
+        OverallOperations[i]->interpolate(nTime,SlideWidthScale,SlideHeightScale);
+}
+
+void OGLTransitionImpl::displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives,
+                                      double SlideWidthScale, double SlideHeightScale )
+{
+   //TODO change to foreach
+    glBindTexture(GL_TEXTURE_2D, glSlideTex);
+
+    // display slide reflection
+    // note that depth test is turned off while blending the shadow
+    // so the slides has to be rendered in right order, see rochade as example
+    if( mbReflectSlides ) {
+        double surfaceLevel = -0.04;
+
+        /* reflected slides */
+        glPushMatrix();
+
+        glScaled( 1, -1, 1 );
+        glTranslated( 0, 2 - surfaceLevel, 0 );
+
+        glCullFace(GL_FRONT);
+    for(unsigned int i(0); i < primitives.size(); ++i)
+        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
+        glCullFace(GL_BACK);
+
+    slideShadow( nTime, primitives[0], SlideWidthScale, SlideHeightScale );
+
+        glPopMatrix();
+    }
+
+    for(unsigned int i(0); i < primitives.size(); ++i)
+        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
+}
+
+void OGLTransitionImpl::displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                       double SlideWidthScale, double SlideHeightScale )
+{
+    if( mmDisplaySlides )
+        (this->*mmDisplaySlides)( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
+    else {
+        applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+        glEnable(GL_TEXTURE_2D);
+        displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+        displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+}
+
+void OGLTransitionImpl::displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    glEnable(GL_TEXTURE_2D);
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
+        maSceneObjects[i]->display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
+}
+
+void Primitive::display(double nTime, double WidthScale, double HeightScale)
+{
+    glPushMatrix();
+
+    applyOperations( nTime, WidthScale, HeightScale );
+
+    glEnableClientState( GL_VERTEX_ARRAY );
+    if(!Normals.empty())
+    {
+        glNormalPointer( GL_DOUBLE , 0 , &Normals[0] );
+        glEnableClientState( GL_NORMAL_ARRAY );
+    }
+    glEnableClientState( GL_TEXTURE_COORD_ARRAY );
+    glTexCoordPointer( 2, GL_DOUBLE, 0, &TexCoords[0] );
+    glVertexPointer( 3, GL_DOUBLE, 0, &Vertices[0] );
+    glDrawArrays( GL_TRIANGLES, 0, Vertices.size() );
+    glPopMatrix();
+}
+
+void Primitive::applyOperations(double nTime, double WidthScale, double HeightScale)
+{
+    for(unsigned int i(0); i < Operations.size(); ++i)
+        Operations[i]->interpolate( nTime ,WidthScale,HeightScale);
+    glScaled(WidthScale,HeightScale,1);
+}
+
+Primitive::~Primitive()
+{
+    for(unsigned int i( 0 ); i < Operations.size(); ++i)
+        delete Operations[i];
+}
+
+
+void SceneObject::display(double nTime, double /* SlideWidth */, double /* SlideHeight */, double DispWidth, double DispHeight )
+{
+    for(unsigned int i(0); i < maPrimitives.size(); ++i) {
+        // fixme: allow various model spaces, now we make it so that
+        // it is regular -1,-1 to 1,1, where the whole display fits in
+        glPushMatrix();
+        if (DispHeight > DispWidth)
+            glScaled(DispHeight/DispWidth, 1, 1);
+        else
+            glScaled(1, DispWidth/DispHeight, 1);
+        maPrimitives[i].display(nTime, 1, 1);
+        glPopMatrix();
+    }
+}
+
+void SceneObject::pushPrimitive(const Primitive &p)
+{
+    maPrimitives.push_back(p);
+}
+
+SceneObject::SceneObject()
+    : maPrimitives()
+{
+}
+
+Iris::Iris()
+    : SceneObject ()
+{
+}
+
+void Iris::display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    glBindTexture(GL_TEXTURE_2D, maTexture);
+    SceneObject::display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
+}
+
+void Iris::prepare()
+{
+    static GLubyte img[3] = { 80, 80, 80 };
+    
+    glGenTextures(1, &maTexture);
+    glBindTexture(GL_TEXTURE_2D, maTexture);
+    glTexImage2D(GL_TEXTURE_2D, 0, 3, 1, 1, 0, GL_RGB, GL_UNSIGNED_BYTE, img);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
+}
+
+void Iris::finish()
+{
+    glDeleteTextures(1, &maTexture);
+}
+
+void OGLTransitionImpl::makeOutsideCubeFaceToLeft()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),90,false,0.0,1.0));
+
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),-90,true,0.0,1.0));
+}
+
+void OGLTransitionImpl::makeInsideCubeFaceToLeft()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),-90,false,0.0,1.0));
+
+    maEnteringSlidePrimitives.push_back(Slide);
+    
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),90,true,0.0,1.0));
+}
+
+void OGLTransitionImpl::makeFallLeaving()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(1,0,0),basegfx::B3DVector(0,-1,0), 90,true,0.0,1.0));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::makeTurnAround()
+{
+    clear();
+    Primitive Slide;
+
+    mbReflectSlides = true;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0),-180,false,0.0,1.0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, -1.5),true, 0, 0.5));
+    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1.5), true, 0.5, 1));
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0),basegfx::B3DVector(0, 0, 0), -180, true, 0.0, 1.0));
+}
+
+void OGLTransitionImpl::makeTurnDown()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 0.0001), false, -1.0, 0.0));
+    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), -90, true, 0.0, 1.0));
+    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), 90, false, -1.0, 0.0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    mbUseMipMapLeaving = false;
+}
+
+void OGLTransitionImpl::makeIris()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0,  0.000001), false, -1, 0));
+    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, -0.000002), false, 0.5, 1));
+    maLeavingSlidePrimitives.push_back (Slide);
+
+
+    Primitive irisPart, part;
+    int i, nSteps = 24, nParts = 7;
+    double lt = 0, t = 1.0/nSteps, cx, cy, lcx, lcy, lx = 1, ly = 0, x, y, cxo, cyo, lcxo, lcyo, of=2.2, f=1.42;
+
+    for (i=1; i<=nSteps; i++) {
+        x = cos ((3*2*M_PI*t)/nParts);
+        y = -sin ((3*2*M_PI*t)/nParts);
+        cx = (f*x + 1)/2;
+        cy = (f*y + 1)/2;
+        lcx = (f*lx + 1)/2;
+        lcy = (f*ly + 1)/2;
+        cxo = (of*x + 1)/2;
+        cyo = (of*y + 1)/2;
+        lcxo = (of*lx + 1)/2;
+        lcyo = (of*ly + 1)/2;
+        irisPart.pushTriangle (basegfx::B2DVector (lcx, lcy),
+                               basegfx::B2DVector (lcxo, lcyo),
+                               basegfx::B2DVector (cx, cy));
+        irisPart.pushTriangle (basegfx::B2DVector (cx, cy),
+                               basegfx::B2DVector (lcxo, lcyo),
+                               basegfx::B2DVector (cxo, cyo));
+        lx = x;
+        ly = y;
+        lt = t;
+        t += 1.0/nSteps;
+    }
+
+    Iris* pIris = new Iris();
+    double angle = 87;
+
+    for (i = 0; i < nParts; i++) {
+        irisPart.Operations.clear ();
+        double rx, ry;
+
+        rx = cos ((2*M_PI*i)/nParts);
+        ry = sin ((2*M_PI*i)/nParts);
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0),  angle, true, 0.0, 0.5));
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0), -angle, true, 0.5, 1));
+        if (i > 0) {
+            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(rx, ry, 0),  false, -1, 0));
+            irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(0, 0, 0), i*360.0/nParts, false, -1, 0));
+            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(-1, 0, 0),  false, -1, 0));
+        }
+        irisPart.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1), false, -2, 0.0));
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(1, .5, 0), basegfx::B3DVector(1, 0, 0), -30, false, -1, 0));
+        pIris->pushPrimitive (irisPart);
+    }
+
+    maSceneObjects.push_back (pIris);
+
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                          double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glEnable(GL_TEXTURE_2D);
+
+    if( nTime > .5) {
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    } else {
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+}
+
+void OGLTransitionImpl::makeRochade()
+{
+    clear();
+    Primitive Slide;
+    
+    mbReflectSlides = true;
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesRochade;
+
+    double w, h;
+
+    w = 2.2;
+    h = 10;
+
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.25, -0.25, true, 0, 1));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.clear();
+    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.75, 0.25, true, 0, 1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, -h), false, -1, 0));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), 45, false, -1, 0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    //     OverallOperations.push_back(new SEllipseTranslate(0.5, 2, 0, 1, true, 0, 1));
+//      push_back(new STranslate(basegfx::B3DVector(0, 0, -2), true, 0, 0.5));
+//      OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 2), true, 0.5, 1));
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B2DVector clamp(const basegfx::B2DVector& v)
+{
+    return basegfx::B2DVector(min(max(v.getX(),-1.0),1.0),
+                              min(max(v.getY(),-1.0),1.0));
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B3DVector clamp(const basegfx::B3DVector& v)
+{
+    return basegfx::B3DVector(min(max(v.getX(),-1.0),1.0),
+                              min(max(v.getY(),-1.0),1.0),
+                              min(max(v.getZ(),-1.0),1.0));
+}
+
+inline double randFromNeg1to1()
+{
+    return ( ( static_cast<double>( rand() ) / static_cast<double>( RAND_MAX ) ) * 2.0 ) - 1.0;
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B3DVector randNormVectorInXYPlane()
+{
+    basegfx::B3DVector toReturn(randFromNeg1to1(),randFromNeg1to1(),0.0);
+    return toReturn/toReturn.getLength();
+}
+
+void OGLTransitionImpl::makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles )
+{
+    clear();
+    double dAngle(2*3.1415926/static_cast<double>( nPointsOnCircles ));
+    if(nCircles < 2 || nPointsOnCircles < 4)
+    {
+        makeNByMTileFlip(1,1);
+        return;
+    }
+    double Radius(1.0/static_cast<double>( nCircles ));
+    double dRadius(Radius);
+    double LastRadius(0.0);
+    double NextRadius(2*Radius);
+
+    /// now we know there is at least two circles
+    /// the first will always be a full circle
+    /// the last will always be the outer shell of the slide with a circle hole
+
+    //add the full circle
+    vector<basegfx::B2DVector> unScaledTexCoords;
+    double TempAngle(0.0);
+    for(unsigned int Point(0); Point < nPointsOnCircles; ++Point)
+    {
+        unScaledTexCoords.push_back( basegfx::B2DVector( cos(TempAngle - 3.1415926/2.0) , sin(TempAngle- 3.1415926/2.0) ) );
+
+        TempAngle += dAngle;
+    }
+    
+    {
+        //double angle(0.0);
+        Primitive EnteringSlide;
+        Primitive LeavingSlide;
+        for(int Point(0); Point + 1 < nPointsOnCircles; ++Point)
+        {
+            EnteringSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
+            LeavingSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5, 0.5) );
+        }
+        EnteringSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius * unScaledTexCoords[ 0 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ nPointsOnCircles - 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
+        LeavingSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+    
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+    
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+        LastRadius = Radius;
+        Radius = NextRadius;
+        NextRadius += dRadius;
+    }    
+    
+    for(int i(1); i < nCircles - 1; ++i)
+    {
+        Primitive LeavingSlide;
+        Primitive EnteringSlide;
+        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
+        {            
+            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            
+            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        }
+        
+        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+        
+        LastRadius = Radius;
+        Radius = NextRadius;
+        NextRadius += dRadius;
+    }
+    {
+        Radius = sqrt(2.0);
+        Primitive LeavingSlide;
+        Primitive EnteringSlide;
+        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
+        {
+            
+            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
+            
+            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        }
+        
+        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+    }
+}
+
+void OGLTransitionImpl::makeHelix( ::sal_uInt16 nRows )
+{
+    clear();
+    double invN(1.0/static_cast<double>(nRows));
+    double iDn = 0.0;
+    double iPDn = invN;
+    for(unsigned int i(0); i < nRows; ++i)
+    {
+        Primitive Tile;
+        
+        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
+            
+        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iPDn ) , basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
+        
+        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , 
+                                                true,min(max(static_cast<double>(i - nRows/2.0)*invN/2.0,0.0),1.0),
+                                                min(max(static_cast<double>(i + nRows/2.0)*invN/2.0,0.0),1.0) ) );
+        
+        maLeavingSlidePrimitives.push_back(Tile);
+        
+        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180 , false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(Tile);
+            
+        iDn += invN;
+        iPDn += invN;
+    }
+}
+
+void OGLTransitionImpl::makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m )
+{
+    clear();
+    double invN(1.0/static_cast<double>(n));
+    double invM(1.0/static_cast<double>(m));
+    double iDn = 0.0;
+    double iPDn = invN;
+    for(unsigned int i(0); i < n; ++i)
+    {
+        double jDm = 0.0;
+        double jPDm = invM;
+        for(unsigned int j(0); j < m; ++j)
+        {
+            Primitive Tile;
+
+            Tile.pushTriangle(basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));
+
+            Tile.pushTriangle(basegfx::B2DVector( iPDn , jPDm ) , basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));//bottom left corner of tile            
+
+            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , true, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
+            maLeavingSlidePrimitives.push_back(Tile);
+            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180, false, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
+
+            maEnteringSlidePrimitives.push_back(Tile);
+
+            jDm += invM;
+            jPDm += invM;
+        }
+        iDn += invN;
+        iPDn += invN;
+    }
+}
+
+SRotate::SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+SScale::SScale(const basegfx::B3DVector& Scale,const basegfx::B3DVector& Origin, bool bInter, double T0, double T1):scale(Scale),origin(Origin)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+RotateAndScaleDepthByWidth::RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+RotateAndScaleDepthByHeight::RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+
+STranslate::STranslate(const basegfx::B3DVector& Vector, bool bInter, double T0, double T1):vector(Vector)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+inline double intervalInter(double t, double T0, double T1)
+{
+    return ( t - T0 ) / ( T1 - T0 );
+}
+
+void STranslate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*t*vector.getX(),SlideHeightScale*t*vector.getY(),t*vector.getZ());
+}
+
+void SRotate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
+    glScaled(SlideWidthScale,SlideHeightScale,1);
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glScaled(1/SlideWidthScale,1/SlideHeightScale,1);
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
+}
+
+void SScale::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
+    glScaled((1-t) + t*scale.getX(),(1-t) + t*scale.getY(),(1-t) + t*scale.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
+}
+
+void RotateAndScaleDepthByWidth::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideWidthScale*origin.getZ());
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideWidthScale*origin.getZ());
+}
+
+void RotateAndScaleDepthByHeight::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideHeightScale*origin.getZ());
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideHeightScale*origin.getZ());
+}
+
+SEllipseTranslate::SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+    width = dWidth;
+    height = dHeight;
+    startPosition = dStartPosition;
+    endPosition = dEndPosition;
+}
+
+void SEllipseTranslate::interpolate(double t,double /* SlideWidthScale */,double /* SlideHeightScale */)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+
+    double a1, a2, x, y;
+    a1 = startPosition*2*M_PI;
+    a2 = (startPosition + t*(endPosition - startPosition))*2*M_PI;
+    x = width*(cos (a2) - cos (a1))/2;
+    y = height*(sin (a2) - sin (a1))/2;
+
+    glTranslated(x, 0, y);
+}
+
+STranslate* STranslate::clone()
+{
+    return new STranslate(*this);
+}
+SRotate* SRotate::clone()
+{
+    return new SRotate(*this);
+}
+
+SScale* SScale::clone()
+{
+    return new SScale(*this);
+}
+
+SEllipseTranslate* SEllipseTranslate::clone()
+{
+    return new SEllipseTranslate(*this);
+}
+
+RotateAndScaleDepthByWidth* RotateAndScaleDepthByWidth::clone()
+{
+    return new RotateAndScaleDepthByWidth(*this);
+}
+
+RotateAndScaleDepthByHeight* RotateAndScaleDepthByHeight::clone()
+{
+    return new RotateAndScaleDepthByHeight(*this);
+}
+
+const Primitive& Primitive::operator=(const Primitive& rvalue)
+{
+    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
+        Operations.push_back(rvalue.Operations[i]->clone());
+    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
+        Vertices.push_back(rvalue.Vertices[i]);
+    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
+        TexCoords.push_back(rvalue.TexCoords[i]);
+    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
+        Normals.push_back(rvalue.Normals[i]);    
+    return *this;   
+}
+    
+Primitive::Primitive(const Primitive& rvalue)
+{
+    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
+        Operations.push_back(rvalue.Operations[i]->clone());
+    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
+        Vertices.push_back(rvalue.Vertices[i]);
+    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
+        TexCoords.push_back(rvalue.TexCoords[i]);
+    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
+        Normals.push_back(rvalue.Normals[i]);
+}
+
+void Primitive::pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2)
+{
+    vector<basegfx::B3DVector> Verts;
+    vector<basegfx::B2DVector> Texs;
+    Verts.reserve(3);
+    Texs.reserve(3);
+
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
+
+    //figure out if they're facing the correct way, and make them face the correct way.
+    basegfx::B3DVector Normal( basegfx::cross( Verts[0] - Verts[1] , Verts[1] - Verts[2] ) );
+    if(Normal.getZ() >= 0.0)//if the normal is facing us
+    {
+        Texs.push_back(SlideLocation0);
+        Texs.push_back(SlideLocation1);
+        Texs.push_back(SlideLocation2);
+    }
+    else // if the normal is facing away from us, make it face us
+    {
+        Texs.push_back(SlideLocation0);
+        Texs.push_back(SlideLocation2);
+        Texs.push_back(SlideLocation1);
+        Verts.clear();
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
+    }
+
+    Vertices.push_back(Verts[0]);
+    Vertices.push_back(Verts[1]);
+    Vertices.push_back(Verts[2]);
+
+    TexCoords.push_back(Texs[0]);
+    TexCoords.push_back(Texs[1]);
+    TexCoords.push_back(Texs[2]);
+    
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+}
+
+void OGLTransitionImpl::makeDiamond()
+{
+    mmPrepare = &OGLTransitionImpl::prepareDiamond;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::prepareDiamond( double nTime, double /* SlideWidth */, double /* SlideHeight */, double /* DispWidth */, double /* DispHeight */ )
+{
+    Primitive Slide1, Slide2;
+
+    Slide1.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide1.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maEnteringSlidePrimitives.push_back (Slide1);
+
+    
+    if( nTime >= 0.5 ) {
+        double m = 1 - nTime;
+
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (m,0), basegfx::B2DVector (0,m));
+        Slide2.pushTriangle (basegfx::B2DVector (nTime,0), basegfx::B2DVector (1,0), basegfx::B2DVector (1,m));
+        Slide2.pushTriangle (basegfx::B2DVector (1,nTime), basegfx::B2DVector (1,1), basegfx::B2DVector (nTime,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,nTime), basegfx::B2DVector (m,1), basegfx::B2DVector (0,1));
+    } else {
+        double l = 0.5 - nTime;
+        double h = 0.5 + nTime;
+
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0.5,l));
+        Slide2.pushTriangle (basegfx::B2DVector (0.5,l), basegfx::B2DVector (1,0), basegfx::B2DVector (h,0.5));
+        Slide2.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (1,1), basegfx::B2DVector (h,0.5));
+        Slide2.pushTriangle (basegfx::B2DVector (h,0.5), basegfx::B2DVector (1,1), basegfx::B2DVector (0.5,h));
+        Slide2.pushTriangle (basegfx::B2DVector (0.5,h), basegfx::B2DVector (1,1), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (l,0.5), basegfx::B2DVector (0.5,h), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (l,0.5), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (0.5,l), basegfx::B2DVector (l,0.5));
+    }
+    Slide2.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, 0.00000001), false, -1, 0));
+    maLeavingSlidePrimitives.push_back (Slide2);
+}
+
+void OGLTransitionImpl::makeVenetianBlinds( bool vertical, int parts )
+{
+    static double t30 = tan( M_PI/6.0 );
+    double n, ln = 0;
+    double p = 1.0/parts;
+
+    for( int i=0; i<parts; i++ ) {
+        Primitive Slide;
+        n = (i + 1)/(double)parts;
+        if( vertical ) {
+            Slide.pushTriangle (basegfx::B2DVector (ln,0), basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1));
+            Slide.pushTriangle (basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1), basegfx::B2DVector (n,1));
+            Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, -t30*p), -120, true, 0.0, 1.0));
+        } else {
+            Slide.pushTriangle (basegfx::B2DVector (0,ln), basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n));
+            Slide.pushTriangle (basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n), basegfx::B2DVector (1,n));
+            Slide.Operations.push_back(new RotateAndScaleDepthByHeight(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, -t30*p), -120, true, 0.0, 1.0));
+        }
+        maLeavingSlidePrimitives.push_back (Slide);
+
+        if( vertical ) {
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(2*n - 1, 0, 0), -60, false, -1, 0));
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, 0), 180, false, -1, 0));
+        } else {
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - 2*n, 0), -60, false, -1, 0));
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, 0), 180, false, -1, 0));
+        }
+        maEnteringSlidePrimitives.push_back (Slide);
+        ln = n;
+    }
+}
+
+void OGLTransitionImpl::displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_DEPTH_TEST);
+
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_LIGHTING);
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+    glColor4f( 1, 1, 1, nTime );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    glDisable(GL_BLEND);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
+    glEnable(GL_LIGHTING);
+
+    glEnable(GL_DEPTH_TEST);
+}
+
+void OGLTransitionImpl::makeFadeSmoothly()
+{ 
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeSmoothly;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_DEPTH_TEST);
+
+    glDisable(GL_LIGHTING);
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+    if( nTime < 0.5 ) {
+    glColor4f( 1, 1, 1, 1 - nTime*2 );
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    } else {
+    glColor4f( 1, 1, 1, (nTime - 0.5)*2 );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+    glDisable(GL_BLEND);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
+    glEnable(GL_LIGHTING);
+
+    glEnable(GL_DEPTH_TEST);
+}
+
+void OGLTransitionImpl::makeFadeThroughBlack()
+{ 
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeThroughBlack;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+static const char* basicVertexShader = "\n\
+varying vec2 v_texturePosition;\n\
+\n\
+void main( void )\n\
+{\n\
+    gl_Position = ftransform();\n\
+    v_texturePosition = gl_MultiTexCoord0.xy;\n\
+}\n\
+";
+
+static const char* staticFragmentShader = "\n\
+uniform sampler2D leavingSlideTexture;\n\
+uniform sampler2D enteringSlideTexture;\n\
+uniform sampler2D permTexture;\n\
+uniform float time;\n\
+varying vec2 v_texturePosition;\n\
+\n\
+float snoise(vec2 P) {\n\
+\n\
+  return texture2D(permTexture, P).r;\n\
+}\n\
+\n\
+\n\
+#define PART 0.5\n\
+#define START 0.4\n\
+#define END 0.9\n\
+\n\
+void main() {\n\
+    float sn = snoise(10.0*v_texturePosition+time*0.07);\n\
+    if( time < PART ) {\n\
+        float sn1 = snoise(vec2(time*15.0, 20.0*v_texturePosition.y));\n\
+        float sn2 = snoise(v_texturePosition);\n\
+        if (sn1 > 1.0 - time*time && sn2 < 2.0*time+0.1)\n\
+            gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
+        else if (time > START )\n\
+            gl_FragColor = ((time-START)/(PART - START))*vec4(sn, sn, sn, 1.0) + (1.0 - (time - START)/(PART - START))*texture2D(leavingSlideTexture, v_texturePosition);\n\
+        else\n\
+            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+    } else if ( time < PART ) {\n\
+            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+    } else if ( time > END ) {\n\
+        gl_FragColor = ((1.0 - time)/(1.0 - END))*vec4(sn, sn, sn, 1.0) + ((time - END)/(1.0 - END))*texture2D(enteringSlideTexture, v_texturePosition);\n\
+    } else \n\
+        gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
+}\n\
+";
+
+static const char* dissolveFragmentShader = "\n\
+uniform sampler2D leavingSlideTexture;\n\
+uniform sampler2D enteringSlideTexture;\n\
+uniform sampler2D permTexture;\n\
+uniform float time;\n\
+varying vec2 v_texturePosition;\n\
+\n\
+float snoise(vec2 P) {\n\
+\n\
+  return texture2D(permTexture, P).r;\n\
+}\n\
+\n\
+void main() {\n\
+     float sn = snoise(10.0*v_texturePosition);\n\
+     if( sn < time)\n\
+         gl_FragColor = texture2D(enteringSlideTexture, v_texturePosition);\n\
+     else\n\
+         gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+}\n\
+";
+
+int permutation256 [256]= {
+215, 100, 200, 204, 233,  50,  85, 196, 
+ 71, 141, 122, 160,  93, 131, 243, 234, 
+162, 183,  36, 155,   4,  62,  35, 205, 
+ 40, 102,  33,  27, 255,  55, 214, 156, 
+ 75, 163, 134, 126, 249,  74, 197, 228, 
+ 72,  90, 206, 235,  17,  22,  49, 169, 
+227,  89,  16,   5, 117,  60, 248, 230, 
+217,  68, 138,  96, 194, 170, 136,  10, 
+112, 238, 184, 189, 176,  42, 225, 212, 
+ 84,  58, 175, 244, 150, 168, 219, 236, 
+101, 208, 123,  37, 164, 110, 158, 201, 
+ 78, 114,  57,  48,  70, 142, 106,  43, 
+232,  26,  32, 252, 239,  98, 191,  94, 
+ 59, 149,  39, 187, 203, 190,  19,  13, 
+133,  45,  61, 247,  23,  34,  20,  52, 
+118, 209, 146, 193, 222,  18,   1, 152, 
+ 46,  41,  91, 148, 115,  25, 135,  77, 
+254, 147, 224, 161,   9, 213, 223, 250, 
+231, 251, 127, 166,  63, 179,  81, 130, 
+139,  28, 120, 151, 241,  86, 111,   0, 
+ 88, 153, 172, 182, 159, 105, 178,  47, 
+ 51, 167,  65,  66,  92,  73, 198, 211, 
+245, 195,  31, 220, 140,  76, 221, 186, 
+154, 185,  56,  83,  38, 165, 109,  67, 
+124, 226, 132,  53, 229,  29,  12, 181, 
+121,  24, 207, 199, 177, 113,  30,  80, 
+  3,  97, 188,  79, 216, 173,   8, 145, 
+ 87, 128, 180, 237, 240, 137, 125, 104, 
+ 15, 242, 119, 246, 103, 143,  95, 144, 
+  2,  44,  69, 157, 192, 174,  14,  54, 
+218,  82,  64, 210,  11,   6, 129,  21, 
+116, 171,  99, 202,   7, 107, 253, 108
+};
+
+void initPermTexture(GLuint *texID)
+{
+  glGenTextures(1, texID);
+  glBindTexture(GL_TEXTURE_2D, *texID);
+
+  static bool initialized = false;
+  static unsigned char permutation2D[256*256*4];
+  if( !initialized ) {
+      int x, y;
+
+      for( y=0; y < 256; y++ )
+          for( x=0; x < 256; x++ )
+              permutation2D[x*4 + y*1024] = permutation256[(y + permutation256[x]) & 0xff];
+
+      initialized = true;
+  }
+
+  glTexImage2D( GL_TEXTURE_2D, 0, GL_RGBA, 256, 256, 0, GL_RGBA, GL_UNSIGNED_BYTE, permutation2D );
+  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST );
+  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST );
+}
+
+void OGLTransitionImpl::preparePermShader()
+{
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        OGLShaders::glUseProgram( mProgramObject );
+
+        GLint location = OGLShaders::glGetUniformLocation( mProgramObject, "leavingSlideTexture" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1i( location, 0 );  // texture unit 0
+        }
+
+        glActiveTexture(GL_TEXTURE1);
+        if( !maHelperTexture )
+            initPermTexture( &maHelperTexture );
+        glActiveTexture(GL_TEXTURE0);
+
+        location = OGLShaders::glGetUniformLocation( mProgramObject, "permTexture" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1i( location, 1 );  // texture unit 1
+        }
+
+        location = OGLShaders::glGetUniformLocation( mProgramObject, "enteringSlideTexture" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1i( location, 2 );  // texture unit 2
+        }
+    }
+#endif
+}
+
+void OGLTransitionImpl::prepareStatic( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
+{
+    mProgramObject = OGLShaders::LinkProgram( basicVertexShader, staticFragmentShader );
+
+    preparePermShader();
+}
+
+void OGLTransitionImpl::displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                              double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        GLint location = OGLShaders::glGetUniformLocation( mProgramObject, "time" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1f( location, nTime );
+        }
+    }
+
+    glActiveTexture( GL_TEXTURE2 );
+    glBindTexture( GL_TEXTURE_2D, glEnteringSlideTex );
+    glActiveTexture( GL_TEXTURE0 );
+#endif
+
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+}
+
+void OGLTransitionImpl::makeStatic()
+{
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
+    mmPrepareTransition = &OGLTransitionImpl::prepareStatic;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+
+    mnRequiredGLVersion = 2.0;
+}
+
+void OGLTransitionImpl::prepareDissolve( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
+{
+    mProgramObject = OGLShaders::LinkProgram( basicVertexShader, dissolveFragmentShader );
+
+    preparePermShader();
+}
+
+void OGLTransitionImpl::makeDissolve()
+{
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
+    mmPrepareTransition = &OGLTransitionImpl::prepareDissolve;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+
+    mnRequiredGLVersion = 2.0;
+}
+
+void OGLTransitionImpl::makeNewsflash()
+{
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),3000,true,0,0.5));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),true,0,0.5));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-10000, 0, 0),false, 0.5, 2));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.clear();
+    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),-3000,true,0.5,1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-100, 0, 0),false, -1, 1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(100, 0, 0),false, 0.5, 1));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),false,-1,1));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(100,100,100),basegfx::B3DVector(0,0,0),true,0.5,1));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0.2,0.2,0),1080,true,0,1));
+}
+
diff --git slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.hxx slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.hxx
new file mode 100644
index 0000000..2aa0529
--- /dev/null
+++ slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionImpl.hxx
@@ -0,0 +1,509 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionImpl.hxx,v $
+ * $Revision: 1.5 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
+#define INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
+
+#include <basegfx/vector/b2dvector.hxx>
+#include <basegfx/vector/b3dvector.hxx>
+
+#include <tools/prewin.h>
+#include <tools/postwin.h>
+
+#if defined( WNT ) 
+#include <tools/prewin.h>
+#include <tools/postwin.h>
+#elif defined( OS2 )
+#elif defined( QUARTZ )
+#elif defined( UNX )
+#endif    	
+
+#include <vector>
+#include <GL/gl.h>
+
+using namespace std;
+
+class Primitive;
+class Operation;
+class SceneObject;
+
+
+/** OpenGL 3D Transition class. It implicitly is constructed from XOGLTransition
+
+    This class is capable of making itself into many difference transitions. It holds Primitives and Operations on those primitives.
+*/
+class OGLTransitionImpl
+{
+public:
+    OGLTransitionImpl() :
+        mbUseMipMapLeaving( true ),
+        mbUseMipMapEntering( true ),
+        mnRequiredGLVersion( 1.0 ),
+        maLeavingSlidePrimitives(),
+        maEnteringSlidePrimitives(),
+        maSceneObjects(),
+        mbReflectSlides( false ),
+        mVertexObject( 0 ),
+        mFragmentObject( 0 ),
+        mProgramObject( 0 ),
+        maHelperTexture( 0 ),
+        mmPrepare( NULL ),
+        mmPrepareTransition( NULL ),
+        mmClearTransition( NULL ),
+        mmDisplaySlides( NULL )
+    {}
+
+    ~OGLTransitionImpl();
+    
+    void prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
+    void finish();
+
+    void makeOutsideCubeFaceToLeft();
+    void makeInsideCubeFaceToLeft();
+    void makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m );
+    void makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles );
+    void makeHelix( ::sal_uInt16 nRows );
+    void makeFallLeaving();
+    void makeTurnAround();
+    void makeTurnDown();
+    void makeIris();
+    void makeRochade();
+    void makeVenetianBlinds( bool vertical, int parts );
+    void makeStatic();
+    void makeDissolve();
+    void makeNewsflash();
+
+    /** 2D replacements
+     */
+    void makeDiamond();
+    void makeFadeSmoothly();
+    void makeFadeThroughBlack();
+
+    /** Whether to use mipmaping for slides textures
+     */
+    bool mbUseMipMapLeaving;
+    bool mbUseMipMapEntering;
+
+    /** which GL version does the transition require
+     */
+    float mnRequiredGLVersion;
+
+private:
+    /** clears all the primitives and operations
+    */
+    void clear();
+    
+    /** All the primitives that use the leaving slide texture
+    */
+    vector<Primitive> maLeavingSlidePrimitives;
+    
+    /** All the primitives that use the leaving slide texture
+    */
+    vector<Primitive> maEnteringSlidePrimitives;
+    
+    /** All the surrounding scene objects
+    */
+    vector<SceneObject*> maSceneObjects;
+
+    /** All the operations that should be applied to both leaving and entering slide primitives. These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
+    */
+    vector<Operation*> OverallOperations;
+
+    /** Whether to reflect slides, the reflection happens on flat surface beneath the slides.
+     ** Now it only works with slides which keep their rectangular shape together.
+     */
+    bool mbReflectSlides;
+
+    /** GLSL objects, shaders and program
+     */
+    GLuint mVertexObject, mFragmentObject, mProgramObject;
+
+    /** various data */
+    GLuint maHelperTexture;
+
+    /** When this method is not NULL, it is called in display method to prepare the slides, scene, etc.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmPrepare)( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
+
+    /** When this method is not NULL, it is called after glx context is ready to let the transition prepare GL related things, like GLSL program.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmPrepareTransition)( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+
+    /** When this method is not NULL, it is called when the transition needs to clear after itself, like delete own textures etc.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmClearTransition)();
+
+    /** When this method is not NULL, it is called in display method to display the slides.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmDisplaySlides)( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+
+    void displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives, double SlideWidthScale, double SlideHeightScale );
+    void displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    void applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale );
+
+    /** various transitions helper methods
+     */
+    void prepareDiamond( double nTime, double SlideWidth, double SlideHeight,double DispWidth, double DispHeight );
+    void displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+        void displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+        void displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void prepareStatic( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void prepareDissolve( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void preparePermShader();
+};
+
+class SceneObject
+{
+public:
+    SceneObject();
+
+    virtual void prepare() {};
+    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    virtual void finish() {};
+
+    void pushPrimitive (const Primitive &p);
+
+protected:
+    /** All the surrounding scene primitives
+    */
+    vector<Primitive> maPrimitives;
+};
+
+class Iris : public SceneObject
+{
+public:
+    Iris ();
+
+    virtual void prepare();
+    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    virtual void finish();
+
+private:
+
+    GLuint maTexture;
+};
+
+/** This class is a list of Triangles that will share Operations, and could possibly share  
+*/
+class Primitive
+{
+public:
+    Primitive() {}
+    // making copy constructor explicit makes the class un-suitable for use with stl containers
+    Primitive(const Primitive& rvalue);
+    ~Primitive();
+
+    void applyOperations(double nTime, double SlideWidthScale, double SlideHeightScale);
+    void display(double nTime, double SlideWidthScale, double SlideHeightScale);
+    const Primitive& operator=(const Primitive& rvalue);
+    
+    /** PushBack a vertex,normal, and tex coord. Each SlideLocation is where on the slide is mapped to this location ( from (0,0) to (1,1)  ). This will make sure the correct aspect ratio is used, and helps to make slides begin and end at the correct position. (0,0) is the top left of the slide, and (1,1) is the bottom right.
+    
+    @param SlideLocation0
+    Location of first Vertex on slide
+    
+    @param SlideLocation1
+    Location of second Vertex on slide
+    
+    @param SlideLocation2
+    Location of third Vertex on slide
+    
+    */
+    void pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2);
+    
+    /** clear all the vertices, normals, tex coordinates, and normals
+    */
+    void clearTriangles();
+    
+    /** guards against directly changing the vertices
+        
+        @return        
+        the list of vertices
+    */
+    const vector<basegfx::B3DVector>& getVertices() const {return Vertices;}
+    
+    /** guards against directly changing the vertices
+    */
+    const vector<basegfx::B3DVector>& getNormals() const {return Normals;}
+    
+    /** guards against directly changing the vertices
+    
+        @return        
+        the list of Texture Coordinates
+    
+    */
+    const vector<basegfx::B2DVector>& getTexCoords() const {return TexCoords;}
+
+    /** list of Operations to be performed on this primitive.These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
+    
+        @return        
+        the list of Operations
+    
+    */    
+    vector<Operation*> Operations;
+
+private:
+    /** list of vertices
+    */
+    vector<basegfx::B3DVector> Vertices;
+    
+    /** list of Normals
+    */
+    vector<basegfx::B3DVector> Normals;
+    
+    /** list of Texture Coordinates
+    */
+    vector<basegfx::B2DVector> TexCoords;
+};
+
+/** This class is to be derived to make any operation (tranform) you may need in order to construct your transitions
+*/
+class Operation
+{
+public:
+    Operation(){}
+    virtual ~Operation(){}
+    
+    /** Should this operation be interpolated . If TRUE, the transform will smoothly move from making no difference from t = 0.0 to nT0 to being completely transformed from t = nT1 to 1. If FALSE, the transform will be inneffectual from t = 0 to nT0, and completely transformed from t = nT0 to 1. 
+    */
+    bool bInterpolate;
+    
+    /** time to begin the transformation
+    */
+    double nT0;
+    
+    /** time to finish the transformation
+    */
+    double nT1;
+public:
+    /** this is the function that is called to give the Operation to OpenGL.
+        
+        @param t
+        time from t = 0 to t = 1
+        
+        @param SlideWidthScale
+        width of slide divided by width of window
+        
+        @param SlideHeightScale
+        height of slide divided by height of window
+    
+    */
+    virtual void interpolate(double t,double SlideWidthScale,double SlideHeightScale) = 0;
+    
+    /** return a copy of this operation
+    */
+    virtual Operation* clone() = 0;
+};
+
+/** this class is a generic CounterClockWise(CCW) rotation with an axis angle
+*/
+class SRotate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    virtual SRotate* clone();
+    
+    /** Constructor
+        
+        @param Axis
+        axis to rotate about
+        
+        @param Origin
+        position that rotation axis runs through
+        
+        @param Angle
+        angle in radians of CCW rotation
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~SRotate(){}
+private:
+    /** axis to rotate CCW about
+    */
+    basegfx::B3DVector axis;
+    
+    /** position that rotation axis runs through
+    */
+    basegfx::B3DVector origin;
+    
+    /** angle in radians of CCW rotation
+    */
+    double angle;
+};
+
+/** scaling transformation
+*/
+class SScale: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    SScale* clone();
+    
+    /** Constructor
+        
+        @param Scale
+        amount to scale by 
+        
+        @param Origin
+        position that rotation axis runs through
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SScale(const basegfx::B3DVector& Scale, const basegfx::B3DVector& Origin,bool bInter, double T0, double T1);
+    ~SScale(){}
+private:
+    basegfx::B3DVector scale;
+    basegfx::B3DVector origin;
+};
+
+/** translation transformation
+*/
+class STranslate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    STranslate* clone();
+    
+    /** Constructor
+        
+        @param Vector
+        vector to translate
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    STranslate(const basegfx::B3DVector& Vector,bool bInter, double T0, double T1);
+    ~STranslate(){}
+private:
+    /** vector to translate by
+    */
+    basegfx::B3DVector vector;
+};
+
+/** translation transformation
+*/
+class SEllipseTranslate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    SEllipseTranslate* clone();
+    
+    /** Constructor
+        
+        @param Vector
+        vector to translate
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1);
+    ~SEllipseTranslate(){}
+private:
+    /** width and length of the ellipse
+     */
+    double width, height;
+
+    /** start and end position on the ellipse <0,1>
+     */
+    double startPosition;
+    double endPosition;
+};
+
+/** Same as SRotate, except the depth is scaled by the width of the slide divided by the width of the window.
+*/
+class RotateAndScaleDepthByWidth: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    RotateAndScaleDepthByWidth* clone();
+
+    RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~RotateAndScaleDepthByWidth(){}
+private:
+    basegfx::B3DVector axis;
+    basegfx::B3DVector origin;
+    double angle;
+};
+
+/** Same as SRotate, except the depth is scaled by the width of the slide divided by the height of the window.
+*/
+class RotateAndScaleDepthByHeight: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    RotateAndScaleDepthByHeight* clone();
+
+    RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~RotateAndScaleDepthByHeight(){}
+private:
+    basegfx::B3DVector axis;
+    basegfx::B3DVector origin;
+    double angle;
+};
+
+#endif // INCLUDED_SLIDESHOW_TRANSITION_HXX_
+
diff --git slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionerImpl_LINUX.cxx slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionerImpl_LINUX.cxx
new file mode 100644
index 0000000..01d513c
--- /dev/null
+++ slideshow/source/engine/OGLTrans/unx/OGLTrans_TransitionerImpl_LINUX.cxx
@@ -0,0 +1,1487 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionerImpl.cxx,v $
+ * $Revision: 1.6 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#define GLX_GLXEXT_PROTOTYPES 1
+#include "OGLTrans_TransitionImpl.hxx"
+
+#include <com/sun/star/beans/XFastPropertySet.hpp>
+#include <com/sun/star/rendering/IntegerBitmapLayout.hpp>
+#include <com/sun/star/rendering/ColorComponentTag.hpp>
+#include <com/sun/star/rendering/ColorSpaceType.hpp>
+#include <com/sun/star/animations/TransitionType.hpp>
+#include <com/sun/star/animations/TransitionSubType.hpp>
+#include <com/sun/star/presentation/XTransitionFactory.hpp>
+#include <com/sun/star/presentation/XTransition.hpp>
+#include <com/sun/star/presentation/XSlideShowView.hpp>
+#include <com/sun/star/uno/XComponentContext.hpp>
+#include <com/sun/star/rendering/XIntegerBitmap.hpp>
+#include <com/sun/star/geometry/IntegerSize2D.hpp>
+
+#include <cppuhelper/compbase1.hxx>
+#include <cppuhelper/basemutex.hxx>
+#include <cppuhelper/factory.hxx>
+#include <rtl/ref.hxx>
+
+#include <comphelper/servicedecl.hxx>
+
+#include <canvas/canvastools.hxx>
+#include <tools/gen.hxx>
+#include <vcl/window.hxx>
+#include <vcl/syschild.hxx>
+
+#include <boost/noncopyable.hpp>
+
+#include <GL/gl.h>
+#include <GL/glu.h>
+
+
+#if defined( WNT ) 
+    #include <tools/prewin.h>
+    #include <windows.h>
+    #include <tools/postwin.h>
+    #define GL_TEXTURE_MAX_ANISOTROPY_EXT 0x84FE
+    #define GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT 0x84FF
+#elif defined( OS2 )
+#elif defined( QUARTZ )
+    #include "premac.h"
+    #include <Cocoa/Cocoa.h>
+    #include "postmac.h"
+#elif defined( UNX )
+namespace unx
+{
+#include <X11/keysym.h>
+#include <X11/X.h>
+#include <GL/glx.h>
+#include <GL/glxext.h>
+}
+#endif
+#include <vcl/sysdata.hxx>
+
+#ifdef DEBUG
+#include <boost/date_time/posix_time/posix_time.hpp>
+using namespace ::boost::posix_time;
+
+static ptime t1;
+static ptime t2;
+
+#define DBG(x) x
+#else
+#define DBG(x)
+#endif
+
+using namespace ::com::sun::star;
+using ::com::sun::star::beans::XFastPropertySet;
+using ::com::sun::star::uno::Any;
+using ::com::sun::star::uno::Reference;
+using ::com::sun::star::uno::Sequence;
+using ::com::sun::star::uno::UNO_QUERY;
+using ::com::sun::star::uno::UNO_QUERY_THROW;
+
+namespace
+{
+
+typedef cppu::WeakComponentImplHelper1<presentation::XTransition> OGLTransitionerImplBase;
+
+namespace
+{
+    struct OGLFormat
+    {
+        GLint  nInternalFormat;
+        GLenum eFormat;
+        GLenum eType;
+    };
+
+    /* channel ordering: (0:rgba, 1:bgra, 2:argb, 3:abgr)  
+    */
+    int calcComponentOrderIndex(const uno::Sequence<sal_Int8>& rTags)
+    {
+        using namespace rendering::ColorComponentTag;
+
+        static const sal_Int8 aOrderTable[] =
+        {
+            RGB_RED, RGB_GREEN, RGB_BLUE, ALPHA,
+            RGB_BLUE, RGB_GREEN, RGB_RED, ALPHA,
+            ALPHA, RGB_RED, RGB_GREEN, RGB_BLUE,
+            ALPHA, RGB_BLUE, RGB_GREEN, RGB_RED, 
+        };
+
+        const sal_Int32 nNumComps(rTags.getLength());
+        const sal_Int8* pLine=aOrderTable;
+        for(int i=0; i<4; ++i)
+        {
+            int j=0;
+            while( j<4 && j<nNumComps && pLine[j] == rTags[j] )
+                ++j;
+
+            // all of the line passed, this is a match!
+            if( j==nNumComps )
+                return i;
+
+            pLine+=4;
+        }
+
+        return -1;
+    }
+}
+
+// not thread safe
+static bool errorTriggered;
+int oglErrorHandler( unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/ )
+{
+    errorTriggered = true;
+
+    return 0;
+}
+
+/** This is the Transitioner class for OpenGL 3D transitions in
+ * slideshow. At the moment, it's Linux only. This class is implicitly
+ * constructed from XTransitionFactory.
+*/
+class OGLTransitionerImpl : private cppu::BaseMutex, private boost::noncopyable, public OGLTransitionerImplBase
+{
+public:
+    explicit OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition);
+    bool initWindowFromSlideShowView( const uno::Reference< presentation::XSlideShowView >& xView );
+    void setSlides( const Reference< rendering::XBitmap >& xLeavingSlide , const uno::Reference< rendering::XBitmap >& xEnteringSlide );
+    static bool initialize( const Reference< presentation::XSlideShowView >& xView );
+
+    // XTransition
+    virtual void SAL_CALL update( double nTime )
+    throw (uno::RuntimeException);
+    virtual void SAL_CALL viewChanged( const Reference< presentation::XSlideShowView >& rView,
+                       const Reference< rendering::XBitmap >& rLeavingBitmap,
+                       const Reference< rendering::XBitmap >& rEnteringBitmap )
+    throw (uno::RuntimeException);
+    
+protected:
+    void disposeContextAndWindow();
+    void disposeTextures();
+
+    // WeakComponentImplHelperBase
+    virtual void SAL_CALL disposing();
+    
+    bool isDisposed() const
+    {
+        return (rBHelper.bDisposed || rBHelper.bInDispose);
+    }
+
+    bool createWindow( Window* pPWindow );
+    void createTexture( unsigned int* texID,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+            unx::GLXPixmap pixmap,
+            bool usePixmap,
+#endif
+            bool useMipmap,
+            uno::Sequence<sal_Int8>& data,
+            const OGLFormat* pFormat );
+    void prepareEnvironment ();
+    const OGLFormat* chooseFormats();
+
+private:    
+    /** After the window has been created, and the slides have been set, we'll initialize the slides with OpenGL.
+    */
+    void GLInitSlides();
+
+
+    /// Holds the information of our new child window
+    struct GLWindow
+    {
+#if defined( WNT ) 
+    HWND					hWnd;
+    HDC						hDC;
+    HGLRC					hRC;
+#elif defined( OS2 )
+#elif defined( QUARTZ )
+#elif defined( UNX )
+    unx::Display*           dpy;
+    int                     screen;
+    unx::Window             win;
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::GLXFBConfig        fbc;
+#endif
+    unx::XVisualInfo*       vi;
+    unx::GLXContext         ctx;
+#endif
+        unsigned int            bpp;
+        unsigned int            Width;
+        unsigned int            Height;
+        const char*             GLXExtensions;
+    const GLubyte*          GLExtensions;
+
+        bool HasGLXExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, (const GLubyte*) GLXExtensions ); }
+    bool HasGLExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, GLExtensions ); }
+    } GLWin;
+    
+    /** OpenGL handle to the leaving slide's texture
+    */
+    unsigned int GLleavingSlide;
+    /** OpenGL handle to the entering slide's texture
+    */
+    unsigned int GLenteringSlide;
+    
+    /** pointer to our window which we MIGHT create.
+    */
+    class SystemChildWindow* pWindow;
+
+    Reference< presentation::XSlideShowView > mxView;
+    Reference< rendering::XIntegerBitmap > mxLeavingBitmap;
+    Reference< rendering::XIntegerBitmap > mxEnteringBitmap;
+    
+    /** raw bytes of the entering bitmap
+    */
+    uno::Sequence<sal_Int8> EnteringBytes;
+    
+    /** raw bytes of the leaving bitmap
+    */
+    uno::Sequence<sal_Int8> LeavingBytes;
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::GLXPixmap LeavingPixmap;
+    unx::GLXPixmap EnteringPixmap;
+#endif
+    bool mbRestoreSync;
+    bool mbUseLeavingPixmap;
+    bool mbUseEnteringPixmap;
+    bool mbFreeLeavingPixmap;
+    bool mbFreeEnteringPixmap;
+    unx::Pixmap maLeavingPixmap;
+    unx::Pixmap maEnteringPixmap;
+    
+    /** the form the raw bytes are in for the bitmaps
+    */
+    rendering::IntegerBitmapLayout SlideBitmapLayout; 
+    
+    /** the size of the slides
+    */    
+    geometry::IntegerSize2D SlideSize;
+    
+    /** Our Transition to be used.
+    */    
+    OGLTransitionImpl* pTransition;
+
+public:
+    /** whether we are running on ATI fglrx with bug related to textures
+     */
+    static bool cbBrokenTexturesATI;
+
+    /** GL version
+     */
+    static float cnGLVersion;
+    float mnGLXVersion;
+
+    /** Whether Mesa is the OpenGL vendor
+     */
+    static bool cbMesa;
+
+    /**
+       whether the display has GLX extension
+     */
+    static bool cbGLXPresent;
+
+    /**
+       whether texture from pixmap extension is available
+    */
+    bool mbTextureFromPixmap;
+
+    /**
+       whether to generate mipmaped textures
+    */
+    bool mbGenerateMipmap;
+
+    /**
+       whether we have visual which can be used for texture_from_pixmap extension
+    */
+    bool mbHasTFPVisual;
+
+#ifdef DEBUG
+    ptime t3;
+    ptime t4;
+    ptime t5;
+    ptime t6;
+    time_duration total_update;
+    int frame_count;
+#endif
+};
+
+// declare the static variables as some gcc versions have problems declaring them automaticaly
+bool OGLTransitionerImpl::cbBrokenTexturesATI;
+float OGLTransitionerImpl::cnGLVersion;
+bool OGLTransitionerImpl::cbMesa;
+bool OGLTransitionerImpl::cbGLXPresent;
+
+bool OGLTransitionerImpl::initialize( const Reference< presentation::XSlideShowView >& xView )
+{
+    // not thread safe
+    static bool initialized = false;
+
+    if( !initialized ) {
+        OGLTransitionerImpl *instance;
+
+        instance = new OGLTransitionerImpl( NULL );
+        if( instance->initWindowFromSlideShowView( xView ) ) {
+
+            const GLubyte* version = glGetString( GL_VERSION );
+            if( version && version[0] ) {
+                cnGLVersion = version[0] - '0';
+                if( version[1] == '.' && version[2] )
+                    cnGLVersion += (version[2] - '0')/10.0;
+            } else
+                cnGLVersion = 1.0;
+            OSL_TRACE("GL version: %s parsed: %f", version, cnGLVersion );
+
+            const GLubyte* vendor = glGetString( GL_VENDOR );
+            cbMesa = ( vendor && strstr( (const char *) vendor, "Mesa" ) );
+            OSL_TRACE("GL vendor: %s identified as Mesa: %d", vendor, cbMesa );
+
+            /* TODO: check for version once the bug in fglrx driver is fixed */
+            cbBrokenTexturesATI = (vendor && strcmp( (const char *) vendor, "ATI Technologies Inc." ) == 0 );
+
+            instance->disposing();
+            cbGLXPresent = true;
+        } else
+            cbGLXPresent = false;
+
+        delete instance;
+        initialized = true;
+    }
+
+    return cbGLXPresent;
+}
+
+bool OGLTransitionerImpl::createWindow( Window* pPWindow )
+{
+    const SystemEnvData* sysData(pPWindow->GetSystemData());
+#if defined( WNT ) 
+    GLWin.hWnd = sysData->hWnd;
+#elif defined( UNX )
+    GLWin.dpy = reinterpret_cast<unx::Display*>(sysData->pDisplay);
+
+    if( unx::glXQueryExtension( GLWin.dpy, NULL, NULL ) == false )
+        return false;
+
+    GLWin.win = sysData->aWindow;
+
+    OSL_TRACE("parent window: %d", GLWin.win);
+
+    unx::XWindowAttributes xattr;
+    unx::XGetWindowAttributes( GLWin.dpy, GLWin.win, &xattr );
+
+    GLWin.screen = XScreenNumberOfScreen( xattr.screen );
+
+    unx::XVisualInfo* vi( NULL );
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::XVisualInfo* visinfo;
+    unx::XVisualInfo* firstVisual( NULL );
+#endif
+    static int attrList3[] =
+        {
+        GLX_RGBA,//only TrueColor or DirectColor
+            //single buffered
+            GLX_RED_SIZE,4,//use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,//use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,//use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,0,//no depth buffer
+            None
+        };
+    static int attrList2[] = 
+    {
+        GLX_RGBA,//only TrueColor or DirectColor
+            /// single buffered
+            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,1,/// use the maximum depth bits, making sure there is a depth buffer
+            None
+        };
+    static int attrList1[] =
+        {
+        GLX_RGBA,//only TrueColor or DirectColor
+            GLX_DOUBLEBUFFER,/// only double buffer
+            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,0,/// no depth buffer
+            None
+        };
+    static int attrList0[] =
+        {
+        GLX_RGBA,//only TrueColor or DirectColor
+            GLX_DOUBLEBUFFER,/// only double buffer
+            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,1,/// use the maximum depth bits, making sure there is a depth buffer
+            None
+       }; 
+    static int* attrTable[] = 
+        {
+            attrList0,
+            attrList1,
+            attrList2,
+            attrList3,
+            NULL
+        };
+    int** pAttributeTable = attrTable;
+    const SystemEnvData* pChildSysData = NULL;
+    delete pWindow;
+    pWindow=NULL;
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::GLXFBConfig* fbconfigs = NULL;
+    int nfbconfigs, value, i = 0;
+#endif
+
+    while( *pAttributeTable )
+    {
+        // try to find a visual for the current set of attributes
+        vi = unx::glXChooseVisual( GLWin.dpy,
+                                   GLWin.screen,
+                                   *pAttributeTable );
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+      if( vi ) {
+      if( !firstVisual )
+          firstVisual = vi;
+      OSL_TRACE("trying VisualID %08X", vi->visualid);
+          fbconfigs = glXGetFBConfigs (GLWin.dpy, GLWin.screen, &nfbconfigs);
+          for ( ; i < nfbconfigs; i++)
+          {
+              visinfo = glXGetVisualFromFBConfig (GLWin.dpy, fbconfigs[i]);
+              if( !visinfo || visinfo->visualid != vi->visualid )
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i], GLX_DRAWABLE_TYPE, &value);
+              if (!(value & GLX_PIXMAP_BIT))
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
+                                    GLX_BIND_TO_TEXTURE_TARGETS_EXT,
+                                    &value);
+              if (!(value & GLX_TEXTURE_2D_BIT_EXT))
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
+                                    GLX_BIND_TO_TEXTURE_RGB_EXT,
+                                    &value);
+              if (value == FALSE)
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
+                                    GLX_BIND_TO_MIPMAP_TEXTURE_EXT,
+                                    &value);
+              if (value == FALSE)
+                  continue;
+
+              /* TODO: handle non Y inverted cases */
+              break;
+          }
+
+          if( i != nfbconfigs || ( firstVisual && pAttributeTable[1] == NULL ) ) {
+          if( i != nfbconfigs ) {
+          vi = glXGetVisualFromFBConfig( GLWin.dpy, fbconfigs[i] );
+          mbHasTFPVisual = true;
+          OSL_TRACE("found visual suitable for texture_from_pixmap");
+          } else {
+          vi = firstVisual;
+          mbHasTFPVisual = false;
+          OSL_TRACE("did not find visual suitable for texture_from_pixmap, using %08X", vi->visualid);
+          }
+#else
+      if( vi ) {
+#endif
+              SystemWindowData winData;
+              winData.nSize = sizeof(winData);
+          OSL_TRACE("using VisualID %08X", vi->visualid);
+              winData.pVisual = (void*)(vi->visual);
+              pWindow=new SystemChildWindow(pPWindow, 0, &winData, FALSE);
+              pChildSysData = pWindow->GetSystemData();
+              if( pChildSysData ) {
+                  break;
+              } else {
+                  delete pWindow, pWindow=NULL;
+              }
+          }
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+      }
+#endif
+
+        ++pAttributeTable;
+      }
+#endif
+
+#if defined( WNT ) 
+      const SystemEnvData* pChildSysData = NULL;
+      SystemWindowData winData;
+      winData.nSize = sizeof(winData);
+      pWindow=new SystemChildWindow(pPWindow, 0, &winData, FALSE);
+      pChildSysData = pWindow->GetSystemData();
+#endif            
+
+      if( pWindow )
+      {
+      pWindow->SetMouseTransparent( TRUE );
+      pWindow->SetParentClipMode( PARENTCLIPMODE_NOCLIP );
+      pWindow->EnableEraseBackground( FALSE );
+      pWindow->SetControlForeground();
+      pWindow->SetControlBackground();
+      pWindow->EnablePaint(FALSE);
+#if defined( WNT ) 
+        GLWin.hWnd = sysData->hWnd;
+#elif defined( UNX )
+        GLWin.dpy = reinterpret_cast<unx::Display*>(pChildSysData->pDisplay);
+        GLWin.win = pChildSysData->aWindow;
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    if( mbHasTFPVisual )
+        GLWin.fbc = fbconfigs[i];
+#endif
+    GLWin.vi = vi;
+    GLWin.GLXExtensions = unx::glXQueryExtensionsString( GLWin.dpy, GLWin.screen );
+    OSL_TRACE("available GLX extensions: %s", GLWin.GLXExtensions);
+#endif
+
+    return true;
+    }
+
+    return false;
+}
+
+bool OGLTransitionerImpl::initWindowFromSlideShowView( const Reference< presentation::XSlideShowView >& xView )
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed())
+        return false;
+
+    mxView.set( xView, UNO_QUERY );
+    if( !mxView.is() )
+    return false;
+
+    /// take the XSlideShowView and extract the parent window from it. see viewmediashape.cxx
+    uno::Reference< rendering::XCanvas > xCanvas(mxView->getCanvas(), uno::UNO_QUERY_THROW);
+    uno::Sequence< uno::Any > aDeviceParams;
+    ::canvas::tools::getDeviceInfo( xCanvas, aDeviceParams );
+
+    ::rtl::OUString aImplName;
+    aDeviceParams[ 0 ] >>= aImplName;
+
+    sal_Int64 aVal = 0;
+    aDeviceParams[1] >>= aVal;
+    if( !createWindow( reinterpret_cast< Window* >( aVal ) ) )
+    return false;
+
+    awt::Rectangle aCanvasArea = mxView->getCanvasArea();
+    pWindow->SetPosSizePixel(aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
+    GLWin.Width = aCanvasArea.Width;
+    GLWin.Height = aCanvasArea.Height;
+    OSL_TRACE("canvas area: %d,%d - %dx%d", aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
+
+#if defined( WNT ) 
+        GLWin.hDC = GetDC(GLWin.hWnd);
+#elif defined( UNX )
+    GLWin.ctx = glXCreateContext(GLWin.dpy,
+                                 GLWin.vi,
+                                 0,
+                                 GL_TRUE);
+    if( GLWin.ctx == NULL ) {
+    OSL_TRACE("unable to create GLX context");
+    return false;
+    }
+#endif
+
+#if defined( WNT ) 
+    PIXELFORMATDESCRIPTOR PixelFormatFront =					// PixelFormat Tells Windows How We Want Things To Be
+    {
+        sizeof(PIXELFORMATDESCRIPTOR),
+        1,								// Version Number
+        PFD_DRAW_TO_WINDOW |
+        PFD_SUPPORT_OPENGL |
+        PFD_DOUBLEBUFFER,
+        PFD_TYPE_RGBA,					// Request An RGBA Format
+        (BYTE)32,						// Select Our Color Depth
+        0, 0, 0, 0, 0, 0,				// Color Bits Ignored
+        0,								// No Alpha Buffer
+        0,								// Shift Bit Ignored
+        0,								// No Accumulation Buffer
+        0, 0, 0, 0,						// Accumulation Bits Ignored
+        64,								// 32 bit Z-BUFFER
+        0,								// 0 bit stencil buffer
+        0,								// No Auxiliary Buffer
+        0,								// now ignored
+        0,								// Reserved
+        0, 0, 0							// Layer Masks Ignored
+    };
+    int WindowPix = ChoosePixelFormat(GLWin.hDC,&PixelFormatFront);
+    SetPixelFormat(GLWin.hDC,WindowPix,&PixelFormatFront);
+    GLWin.hRC  = wglCreateContext(GLWin.hDC);
+    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
+#elif defined( UNX )
+    if( !glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx ) ) {
+        OSL_TRACE("unable to select current GLX context");
+        return false;
+    }
+
+    int glxMinor, glxMajor;
+    mnGLXVersion = 0;
+    if( glXQueryVersion( GLWin.dpy, &glxMajor, &glxMinor ) )
+      mnGLXVersion = glxMajor + 0.1*glxMinor;
+    OSL_TRACE("available GLX version: %f", mnGLXVersion);
+
+    GLWin.GLExtensions = glGetString( GL_EXTENSIONS );
+    OSL_TRACE("available GL  extensions: %s", GLWin.GLExtensions);
+
+    mbTextureFromPixmap = GLWin.HasGLXExtension( "GLX_EXT_texture_from_pixmap" );
+    mbGenerateMipmap = GLWin.HasGLExtension( "GL_SGIS_generate_mipmap" );
+
+    if( GLWin.HasGLXExtension("GLX_SGI_swap_control" ) ) {
+        // enable vsync
+        typedef GLint (*glXSwapIntervalProc)(GLint);
+        glXSwapIntervalProc glXSwapInterval = (glXSwapIntervalProc) unx::glXGetProcAddress( (const GLubyte*) "glXSwapIntervalSGI" );
+        if( glXSwapInterval ) {
+        int (*oldHandler)(unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/);
+
+        // replace error handler temporarily
+        oldHandler = unx::XSetErrorHandler( oglErrorHandler );
+
+        errorTriggered = false;
+
+        glXSwapInterval( 1 );
+
+        // sync so that we possibly get an XError
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        if( errorTriggered )
+            OSL_TRACE("error when trying to set swap interval, NVIDIA or Mesa bug?");
+        else
+            OSL_TRACE("set swap interval to 1 (enable vsync)");
+
+        // restore the error handler
+        unx::XSetErrorHandler( oldHandler );
+        }
+    }
+#endif
+
+    glEnable(GL_CULL_FACE);
+    glCullFace(GL_BACK);
+    glClearColor (0, 0, 0, 0);
+    glClear(GL_COLOR_BUFFER_BIT);
+#if defined( WNT ) 
+    SwapBuffers(GLWin.hDC);
+#elif defined( UNX )
+    unx::glXSwapBuffers(GLWin.dpy, GLWin.win);
+#endif
+   
+    glEnable(GL_LIGHTING);
+    GLfloat light_direction[] = { 0.0 , 0.0 , 1.0 };
+    GLfloat materialDiffuse[] = { 1.0 , 1.0 , 1.0 , 1.0};
+    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, light_direction);
+    glMaterialfv(GL_FRONT,GL_DIFFUSE,materialDiffuse);
+    glEnable(GL_LIGHT0);
+    glEnable(GL_NORMALIZE);
+
+    if( LeavingBytes.hasElements() && EnteringBytes.hasElements())
+       GLInitSlides();//we already have uninitialized slides, let's initialize 
+
+    if( pTransition && pTransition->mnRequiredGLVersion <= cnGLVersion )
+        pTransition->prepare( GLleavingSlide, GLenteringSlide );
+
+    return true;
+}
+
+void OGLTransitionerImpl::setSlides( const uno::Reference< rendering::XBitmap >& xLeavingSlide, 
+                                     const uno::Reference< rendering::XBitmap >& xEnteringSlide )
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed())
+        return;
+        
+    mxLeavingBitmap.set( xLeavingSlide , UNO_QUERY_THROW );
+    mxEnteringBitmap.set( xEnteringSlide , UNO_QUERY_THROW );
+    Reference< XFastPropertySet > xLeavingSet( xLeavingSlide , UNO_QUERY );
+    Reference< XFastPropertySet > xEnteringSet( xEnteringSlide , UNO_QUERY );
+
+    geometry::IntegerRectangle2D SlideRect;
+    SlideSize = mxLeavingBitmap->getSize();
+    SlideRect.X1 = 0;
+    SlideRect.X2 = SlideSize.Width;
+    SlideRect.Y1 = 0;
+    SlideRect.Y2 = SlideSize.Height;
+
+    OSL_TRACE("leaving bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
+    SlideSize = mxEnteringBitmap->getSize();
+    OSL_TRACE("entering bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
+
+#ifdef UNX
+    unx::glXWaitGL();
+    XSync(GLWin.dpy, false);
+#endif
+
+#ifdef DEBUG
+    t1 = microsec_clock::local_time();
+#endif
+
+    mbUseLeavingPixmap = false;
+    mbUseEnteringPixmap = false;
+
+#ifdef UNX
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+
+    if( mnGLXVersion >= 1.2999 && mbTextureFromPixmap && xLeavingSet.is() && xEnteringSet.is() && mbHasTFPVisual ) {
+    Sequence< Any > leaveArgs;
+    Sequence< Any > enterArgs;
+    if( (xLeavingSet->getFastPropertyValue( 1 ) >>= leaveArgs) &&
+        (xEnteringSet->getFastPropertyValue( 1 ) >>= enterArgs) ) {
+        OSL_TRACE ("pixmaps available");
+
+        sal_Int32 depth;
+
+        leaveArgs[0] >>= mbFreeLeavingPixmap;
+        enterArgs[0] >>= mbFreeEnteringPixmap;
+        leaveArgs[1] >>= maLeavingPixmap;
+        enterArgs[1] >>= maEnteringPixmap;
+        leaveArgs[2] >>= depth;
+
+        int pixmapAttribs[] = { GLX_TEXTURE_TARGET_EXT, GLX_TEXTURE_2D_EXT,
+                    GLX_TEXTURE_FORMAT_EXT, GLX_TEXTURE_FORMAT_RGB_EXT,
+                    GLX_MIPMAP_TEXTURE_EXT, True,
+                    None };
+
+
+        // sync so that we possibly get an pending XError, before we set our handler.
+        // this way we will not miss any error from other code
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        int (*oldHandler)(unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/);
+
+        // replace error handler temporarily
+        oldHandler = unx::XSetErrorHandler( oglErrorHandler );
+
+        errorTriggered = false;
+        LeavingPixmap = glXCreatePixmap( GLWin.dpy, GLWin.fbc, maLeavingPixmap, pixmapAttribs );
+
+        // sync so that we possibly get an XError
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        if( !errorTriggered )
+        mbUseLeavingPixmap = true;
+        else {
+        OSL_TRACE("XError triggered");
+        if( mbFreeLeavingPixmap ) {
+            unx::XFreePixmap( GLWin.dpy, maLeavingPixmap );
+            mbFreeLeavingPixmap = false;
+        }
+        errorTriggered = false;
+        }
+          
+        EnteringPixmap = glXCreatePixmap( GLWin.dpy, GLWin.fbc, maEnteringPixmap, pixmapAttribs );
+
+        // sync so that we possibly get an XError
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        OSL_TRACE("created glx pixmap %p and %p depth: %d", LeavingPixmap, EnteringPixmap, depth);
+        if( !errorTriggered )
+        mbUseEnteringPixmap = true;
+        else {
+        OSL_TRACE("XError triggered");
+        if( mbFreeEnteringPixmap ) {
+            unx::XFreePixmap( GLWin.dpy, maEnteringPixmap );
+            mbFreeEnteringPixmap = false;
+        }
+        }
+
+        // restore the error handler
+        unx::XSetErrorHandler( oldHandler );
+    }
+    }
+
+#endif
+#endif
+    if( !mbUseLeavingPixmap )
+    LeavingBytes = mxLeavingBitmap->getData(SlideBitmapLayout,SlideRect);
+    if( !mbUseEnteringPixmap )
+    EnteringBytes = mxEnteringBitmap->getData(SlideBitmapLayout,SlideRect);
+
+// TODO    
+#ifdef UNX
+    if(GLWin.ctx)//if we have a rendering context, let's init the slides
+#endif
+    GLInitSlides();
+
+    OSL_ENSURE(SlideBitmapLayout.PlaneStride == 0,"only handle no plane stride now");
+
+#ifdef UNX
+    /* flush & sync */
+    unx::glXWaitGL();
+    XSync( GLWin.dpy, false );
+
+    // synchronized X still gives us much smoother play
+    // I suspect some issues in above code in slideshow
+    // synchronize whole transition for now
+    XSynchronize( GLWin.dpy, true );
+    mbRestoreSync = true;
+#endif
+}
+
+void OGLTransitionerImpl::createTexture( unsigned int* texID,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+                     unx::GLXPixmap pixmap,
+                     bool usePixmap,
+#endif
+                     bool useMipmap,
+                     uno::Sequence<sal_Int8>& data,
+                     const OGLFormat* pFormat )
+{
+    glDeleteTextures( 1, texID );
+    glGenTextures( 1, texID );
+    glBindTexture( GL_TEXTURE_2D, *texID );
+    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT );
+    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT );
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::PFNGLXBINDTEXIMAGEEXTPROC myglXBindTexImageEXT = (unx::PFNGLXBINDTEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXBindTexImageEXT" );
+
+    if( usePixmap ) {
+      if( mbGenerateMipmap )
+          glTexParameteri( GL_TEXTURE_2D, GL_GENERATE_MIPMAP_SGIS, True);
+      myglXBindTexImageEXT (GLWin.dpy, pixmap, GLX_FRONT_LEFT_EXT, NULL);
+      if( mbGenerateMipmap && useMipmap ) {
+          OSL_TRACE("use mipmaps");
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
+      } else {
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
+      }
+    } else {
+#endif
+    if( !pFormat )
+    {
+        // force-convert color to ARGB8888 int color space  
+        uno::Sequence<sal_Int8> tempBytes(
+            SlideBitmapLayout.ColorSpace->convertToIntegerColorSpace(
+                data,
+                canvas::tools::getStdColorSpace()));
+        gluBuild2DMipmaps(GL_TEXTURE_2D, 
+                          4, 
+                          SlideSize.Width, 
+                          SlideSize.Height, 
+                          GL_RGBA, 
+                          GL_UNSIGNED_BYTE,
+                          &tempBytes[0]);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
+
+        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
+    GLfloat largest_supported_anisotropy;
+    glGetFloatv(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy);
+    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy);
+    } else {
+    if( pTransition && !cbBrokenTexturesATI && !useMipmap) {
+        glTexImage2D( GL_TEXTURE_2D, 0, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, 0, pFormat->eFormat, pFormat->eType, &data[0] );
+        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
+        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
+    } else {
+        gluBuild2DMipmaps( GL_TEXTURE_2D, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, pFormat->eFormat, pFormat->eType, &data[0] );
+        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR );
+        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR ); //TRILINEAR FILTERING
+
+        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
+        GLfloat largest_supported_anisotropy;
+        glGetFloatv( GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy );
+        glTexParameterf( GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy );
+    }
+    }
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    }
+#endif
+    OSL_ENSURE(glIsTexture(*texID), "Can't generate Leaving slide textures in OpenGL");
+}
+
+void OGLTransitionerImpl::prepareEnvironment()
+{
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    double EyePos(10.0);
+    double RealF(1.0);
+    double RealN(-1.0);
+    double RealL(-1.0);
+    double RealR(1.0);
+    double RealB(-1.0);
+    double RealT(1.0);
+    double ClipN(EyePos+5.0*RealN);
+    double ClipF(EyePos+15.0*RealF);
+    double ClipL(RealL*8.0);
+    double ClipR(RealR*8.0);
+    double ClipB(RealB*8.0);
+    double ClipT(RealT*8.0);
+    //This scaling is to take the plane with BottomLeftCorner(-1,-1,0) and TopRightCorner(1,1,0) and map it to the screen after the perspective division.
+    glScaled( 1.0 / ( ( ( RealR * 2.0 * ClipN ) / ( EyePos * ( ClipR - ClipL ) ) ) - ( ( ClipR + ClipL ) / ( ClipR - ClipL ) ) ),
+              1.0 / ( ( ( RealT * 2.0 * ClipN ) / ( EyePos * ( ClipT - ClipB ) ) ) - ( ( ClipT + ClipB ) / ( ClipT - ClipB ) ) ),
+              1.0 );
+    glFrustum(ClipL,ClipR,ClipB,ClipT,ClipN,ClipF);
+    glMatrixMode(GL_MODELVIEW);
+    glLoadIdentity();
+    glTranslated(0,0,-EyePos);
+}
+
+const OGLFormat* OGLTransitionerImpl::chooseFormats()
+{
+    const OGLFormat* pDetectedFormat=NULL;
+    uno::Reference<rendering::XIntegerBitmapColorSpace> xIntColorSpace(
+        SlideBitmapLayout.ColorSpace);
+
+    if( (xIntColorSpace->getType() == rendering::ColorSpaceType::RGB ||
+         xIntColorSpace->getType() == rendering::ColorSpaceType::SRGB) )
+    {
+        /* table for canvas->OGL format mapping. outer index is number
+           of color components (0:3, 1:4), then comes bits per pixel
+           (0:16, 1:24, 2:32), then channel ordering: (0:rgba, 1:bgra,
+           2:argb, 3:abgr)
+         */
+        static const OGLFormat lcl_RGB24[] = 
+        {
+            // 24 bit RGB
+            {3, GL_BGR, GL_UNSIGNED_BYTE},
+            {3, GL_RGB, GL_UNSIGNED_BYTE},
+            {3, GL_BGR, GL_UNSIGNED_BYTE},
+            {3, GL_RGB, GL_UNSIGNED_BYTE}
+        };
+
+#if defined(GL_VERSION_1_2) && defined(GLU_VERSION_1_3)
+        // more format constants available
+        static const OGLFormat lcl_RGB16[] = 
+        {
+            // 16 bit RGB
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5}
+        };
+
+        static const OGLFormat lcl_ARGB16_4[] = 
+        {
+            // 16 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4},
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4}
+        };
+
+        static const OGLFormat lcl_ARGB16_5[] = 
+        {
+            // 16 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_5_5_5_1},
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_5_5_5_1}
+        };
+
+        static const OGLFormat lcl_ARGB32[] = 
+        {
+            // 32 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8_REV},
+            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV},
+            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8},
+            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8}
+        };
+
+        const uno::Sequence<sal_Int8> aComponentTags(
+            xIntColorSpace->getComponentTags());
+        const uno::Sequence<sal_Int32> aComponentBitcounts(
+            xIntColorSpace->getComponentBitCounts());
+        const sal_Int32 nNumComponents( aComponentBitcounts.getLength() );
+        const sal_Int32 nBitsPerPixel( xIntColorSpace->getBitsPerPixel() );
+
+        // supported component ordering?
+        const int nComponentOrderIndex(
+            calcComponentOrderIndex(aComponentTags));
+        if( nComponentOrderIndex != -1 ) 
+        {
+            switch( nBitsPerPixel )
+            {
+                case 16:
+                    if( nNumComponents == 3 )
+                    {
+                        pDetectedFormat = &lcl_RGB16[nComponentOrderIndex];
+                    }
+                    else if( nNumComponents == 4 )
+                    {
+                        if( aComponentBitcounts[1] == 4 )
+                        {
+                            pDetectedFormat = &lcl_ARGB16_4[nComponentOrderIndex];
+                        }
+                        else if( aComponentBitcounts[1] == 5 )
+                        {
+                            pDetectedFormat = &lcl_ARGB16_5[nComponentOrderIndex];
+                        }
+                    }
+                    break;
+                case 24:
+                    if( nNumComponents == 3 )
+                    {
+                        pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
+                    }
+                    break;
+                case 32:
+                    pDetectedFormat = &lcl_ARGB32[nComponentOrderIndex];
+                    break;
+            }
+        }
+#else
+        const uno::Sequence<sal_Int8> aComponentTags(
+            xIntColorSpace->getComponentTags());
+        const int nComponentOrderIndex(calcComponentOrderIndex(aComponentTags));
+        if( aComponentTags.getLength() == 3 && 
+            nComponentOrderIndex != -1 && 
+            xIntColorSpace->getBitsPerPixel() == 24 )
+        {
+            pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
+        }
+#endif
+    }
+
+    return pDetectedFormat;
+}
+
+void OGLTransitionerImpl::GLInitSlides()
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed() || pTransition->mnRequiredGLVersion > cnGLVersion)
+        return;
+
+    prepareEnvironment();
+
+    const OGLFormat* pFormat = NULL;
+    if( !mbUseLeavingPixmap || !mbUseEnteringPixmap )
+    pFormat = chooseFormats();
+
+    createTexture( &GLleavingSlide,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+           LeavingPixmap,
+           mbUseLeavingPixmap,
+#endif
+           pTransition->mbUseMipMapLeaving,
+           LeavingBytes,
+           pFormat );
+
+    createTexture( &GLenteringSlide,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+           EnteringPixmap,
+           mbUseEnteringPixmap,
+#endif
+           pTransition->mbUseMipMapEntering,
+           EnteringBytes,
+           pFormat );
+
+#ifdef UNX
+    unx::glXWaitGL();
+    XSync(GLWin.dpy, false);
+#endif
+
+#ifdef DEBUG
+    t2 = microsec_clock::local_time();
+    OSL_TRACE("textures created in: %s", to_simple_string( t2 - t1 ).c_str());
+#endif
+}
+
+void SAL_CALL OGLTransitionerImpl::update( double nTime ) throw (uno::RuntimeException)
+{
+#ifdef DEBUG
+    frame_count ++;
+    t3 = microsec_clock::local_time();
+    if( frame_count == 1 ) {
+    t5 = t3;
+    total_update = seconds (0);
+    }
+#endif
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed() || !cbGLXPresent || pTransition->mnRequiredGLVersion > cnGLVersion)
+        return;
+
+#ifdef WNT
+    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
+#endif
+#ifdef UNX
+    glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx );
+#endif
+
+    glEnable(GL_DEPTH_TEST);
+    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
+
+    if(pTransition)
+    pTransition->display( nTime, GLleavingSlide, GLenteringSlide, 
+                              SlideSize.Width, SlideSize.Height,
+                              static_cast<double>(GLWin.Width),
+                              static_cast<double>(GLWin.Height) );
+
+#if defined( WNT ) 
+    SwapBuffers(GLWin.hDC);
+#elif defined( UNX )
+    unx::glXSwapBuffers(GLWin.dpy, GLWin.win);
+#endif
+    if( pWindow )
+        pWindow->Show();
+
+#ifdef UNX
+    /* flush & sync */
+    unx::glXWaitGL();
+    XSync( GLWin.dpy, false );
+#endif
+
+#ifdef DEBUG
+    t4 = microsec_clock::local_time();
+
+    OSL_TRACE("update time: %f", nTime);
+    OSL_TRACE("update took: %s", to_simple_string( t4 - t3 ).c_str());
+    total_update += (t4 - t3);
+#endif
+}
+
+void SAL_CALL OGLTransitionerImpl::viewChanged( const Reference< presentation::XSlideShowView >& rView,
+                        const Reference< rendering::XBitmap >& rLeavingBitmap,
+                        const Reference< rendering::XBitmap >& rEnteringBitmap )
+    throw (uno::RuntimeException)
+{
+    OSL_TRACE("transitioner: view changed");
+
+    disposeTextures();
+    disposeContextAndWindow();
+
+    initWindowFromSlideShowView( rView );
+    setSlides( rLeavingBitmap, rEnteringBitmap );
+}
+
+void OGLTransitionerImpl::disposeContextAndWindow()
+{
+#if defined( WNT )
+    if (GLWin.hRC)
+    {
+    wglMakeCurrent( GLWin.hDC, 0 );		// kill Device Context
+    wglDeleteContext( GLWin.hRC );		// Kill Render Context
+    ReleaseDC( GLWin.hWnd, GLWin.hDC );         // Release Window
+    }
+#elif defined( UNX )
+    if(GLWin.ctx)
+    {
+    glXMakeCurrent(GLWin.dpy, None, NULL);
+    if( glGetError() != GL_NO_ERROR ) {
+        OSL_TRACE("glError: %s", (char *)gluErrorString(glGetError()));
+    }
+    glXDestroyContext(GLWin.dpy, GLWin.ctx);
+    GLWin.ctx = NULL;
+    }
+#endif
+    if( pWindow ) {
+    delete pWindow;
+    pWindow = NULL;
+    GLWin.win = 0;
+    }
+}
+
+void OGLTransitionerImpl::disposeTextures()
+{
+#ifdef WNT
+    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
+#endif
+#ifdef UNX
+    glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx );
+#endif
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::PFNGLXRELEASETEXIMAGEEXTPROC myglXReleaseTexImageEXT = (unx::PFNGLXRELEASETEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXReleaseTexImageEXT" );
+    if( mbUseLeavingPixmap ) {
+
+    myglXReleaseTexImageEXT( GLWin.dpy, LeavingPixmap, GLX_FRONT_LEFT_EXT );
+    glXDestroyGLXPixmap( GLWin.dpy, LeavingPixmap );
+    LeavingPixmap = 0;
+    if( mbFreeLeavingPixmap ) {
+        unx::XFreePixmap( GLWin.dpy, maLeavingPixmap );
+        mbFreeLeavingPixmap = false;
+        maLeavingPixmap = 0;
+    }
+    }
+    if( mbUseEnteringPixmap ) {
+    myglXReleaseTexImageEXT( GLWin.dpy, EnteringPixmap, GLX_FRONT_LEFT_EXT );
+    glXDestroyGLXPixmap( GLWin.dpy, EnteringPixmap );
+    EnteringPixmap = 0;
+    if( mbFreeEnteringPixmap ) {
+        unx::XFreePixmap( GLWin.dpy, maEnteringPixmap );
+        mbFreeEnteringPixmap = false;
+        maEnteringPixmap = 0;
+    }
+    }
+#endif
+
+    if( !mbUseLeavingPixmap ) {
+    glDeleteTextures(1,&GLleavingSlide);
+    GLleavingSlide = 0;
+    }
+    if( !mbUseEnteringPixmap ) {
+    glDeleteTextures(1,&GLenteringSlide);
+    GLleavingSlide = 0;
+    }
+
+    mbUseLeavingPixmap = false;
+    mbUseEnteringPixmap = false;
+}
+
+// we are about to be disposed (someone call dispose() on us)
+void OGLTransitionerImpl::disposing()
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+#ifdef DEBUG
+    OSL_TRACE("dispose %p\n", this);
+    if( frame_count ) {
+    t6 = microsec_clock::local_time();
+    time_duration duration = t6 - t5;
+    OSL_TRACE("whole transition (frames: %d) took: %s fps: %f time spent in updates: %s percentage of transition time: %f%%",
+          frame_count, to_simple_string( duration ).c_str(),
+          ((double)frame_count*1000000000.0)/duration.total_nanoseconds(),
+          to_simple_string( total_update ).c_str(),
+          100*(((double)total_update.total_nanoseconds())/((double)duration.total_nanoseconds()))
+        );
+    }
+#endif
+
+    if( pWindow ) {
+
+    disposeTextures();
+
+    if (pTransition)
+        pTransition->finish();
+
+#ifdef UNX
+    if( mbRestoreSync ) {
+        // try to reestablish synchronize state
+        char* sal_synchronize = getenv("SAL_SYNCHRONIZE");
+        XSynchronize( GLWin.dpy, sal_synchronize && *sal_synchronize == '1' );
+    }
+#endif
+
+    disposeContextAndWindow();
+    }
+
+    if (pTransition)
+    delete pTransition;
+
+    mxLeavingBitmap.clear();
+    mxEnteringBitmap.clear();
+    mxView.clear();
+}
+
+OGLTransitionerImpl::OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition) : 
+    OGLTransitionerImplBase(m_aMutex), 
+    GLWin(),
+    GLleavingSlide( 0 ), 
+    GLenteringSlide( 0 ), 
+    pWindow( NULL ), 
+    mxView(),
+    EnteringBytes(),
+    LeavingBytes(),
+    mbRestoreSync( false ),
+    mbUseLeavingPixmap( false ),
+    mbUseEnteringPixmap( false ),
+    SlideBitmapLayout(),
+    SlideSize(),
+    pTransition(pOGLTransition)
+{
+#if defined( WNT )
+    GLWin.hWnd = 0;
+#elif defined( UNX )
+    GLWin.ctx = 0;
+#endif
+
+    DBG(frame_count = 0);
+}
+
+typedef cppu::WeakComponentImplHelper1<presentation::XTransitionFactory> OGLTransitionFactoryImplBase;
+
+class OGLTransitionFactoryImpl : private cppu::BaseMutex, public OGLTransitionFactoryImplBase
+{
+public:
+    explicit OGLTransitionFactoryImpl( const uno::Reference< uno::XComponentContext >& ) :
+        OGLTransitionFactoryImplBase(m_aMutex)
+    {}
+
+    // XTransitionFactory
+    virtual ::sal_Bool SAL_CALL hasTransition( ::sal_Int16 transitionType, ::sal_Int16 transitionSubType ) throw (uno::RuntimeException)
+    {
+        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
+            switch( transitionSubType )
+                {
+                case animations::TransitionSubType::ACROSS:
+                case animations::TransitionSubType::CORNERSOUT:
+                case animations::TransitionSubType::CIRCLE:
+                case animations::TransitionSubType::FANOUTHORIZONTAL:
+                case animations::TransitionSubType::CORNERSIN:  
+                case animations::TransitionSubType::LEFTTORIGHT:
+                case animations::TransitionSubType::TOPTOBOTTOM:
+                case animations::TransitionSubType::TOPRIGHT:
+                case animations::TransitionSubType::TOPLEFT:
+                case animations::TransitionSubType::BOTTOMRIGHT:
+                case animations::TransitionSubType::BOTTOMLEFT:
+                case animations::TransitionSubType::TOPCENTER:
+                case animations::TransitionSubType::RIGHTCENTER:
+                case animations::TransitionSubType::BOTTOMCENTER:
+                    return sal_True;
+
+                default:
+                    return sal_False;
+                }
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
+            return sal_True;
+        } else
+            return sal_False;
+    }
+
+    virtual uno::Reference< presentation::XTransition > SAL_CALL createTransition( 
+        ::sal_Int16                                           transitionType, 
+        ::sal_Int16                                           transitionSubType, 
+        const uno::Reference< presentation::XSlideShowView >& view, 
+        const uno::Reference< rendering::XBitmap >&           leavingBitmap, 
+        const uno::Reference< rendering::XBitmap >&           enteringBitmap )
+    throw (uno::RuntimeException)
+    {
+        if( !hasTransition( transitionType, transitionSubType ) )
+            return uno::Reference< presentation::XTransition >();
+
+        bool bGLXPresent = OGLTransitionerImpl::initialize( view );
+
+        if( OGLTransitionerImpl::cbMesa && (
+            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) ||
+            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) ||
+            ( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) ) )
+            return uno::Reference< presentation::XTransition >();
+            
+
+        OGLTransitionImpl* pTransition = NULL;
+
+        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
+            pTransition = new OGLTransitionImpl();
+            switch( transitionSubType )
+                {
+                case animations::TransitionSubType::ACROSS:
+                    pTransition->makeNByMTileFlip(8,6);
+                    break;   
+                case animations::TransitionSubType::CORNERSOUT:
+                    pTransition->makeOutsideCubeFaceToLeft();
+                    break;            
+                case animations::TransitionSubType::CIRCLE:
+                    pTransition->makeRevolvingCircles(8,128);
+                    break;
+                case animations::TransitionSubType::FANOUTHORIZONTAL:
+                    pTransition->makeHelix(20);
+                    break;
+                case animations::TransitionSubType::CORNERSIN:  
+                    pTransition->makeInsideCubeFaceToLeft();
+                    break;
+                case animations::TransitionSubType::LEFTTORIGHT:
+                    pTransition->makeFallLeaving();
+                    break;
+                case animations::TransitionSubType::TOPTOBOTTOM:
+                    pTransition->makeTurnAround();
+                    break;
+                case animations::TransitionSubType::TOPRIGHT:
+                    pTransition->makeTurnDown();
+                    break;
+                case animations::TransitionSubType::TOPLEFT:
+                    pTransition->makeIris();
+                    break;
+                case animations::TransitionSubType::BOTTOMRIGHT:
+                    pTransition->makeRochade();
+                    break;
+                case animations::TransitionSubType::BOTTOMLEFT:
+                    pTransition->makeVenetianBlinds( true, 8 );
+                    break;
+                case animations::TransitionSubType::TOPCENTER:
+                    pTransition->makeVenetianBlinds( false, 6 );
+                    break;
+                case animations::TransitionSubType::RIGHTCENTER:
+                    pTransition->makeStatic();
+                    break;
+                case animations::TransitionSubType::BOTTOMCENTER:
+                    pTransition->makeDissolve();
+                    break;
+                }
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeFadeSmoothly();
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeFadeThroughBlack();
+        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeDiamond();
+        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeNewsflash();
+        }
+
+        rtl::Reference<OGLTransitionerImpl> xRes(
+            new OGLTransitionerImpl(pTransition) );
+        if( bGLXPresent ) {
+            if( !xRes->initWindowFromSlideShowView(view))
+                return uno::Reference< presentation::XTransition >();
+            xRes->setSlides(leavingBitmap,enteringBitmap);
+        }
+
+        return uno::Reference<presentation::XTransition>(xRes.get());
+    }
+};
+
+}
+
+namespace sdecl = comphelper::service_decl;
+#if defined (__GNUC__) && (__GNUC__ == 3 && __GNUC_MINOR__ <= 3)
+ sdecl::class_<OGLTransitionFactoryImpl> serviceImpl;
+ const sdecl::ServiceDecl OGLTransitionFactoryDecl(
+     serviceImpl,
+#else
+ const sdecl::ServiceDecl OGLTransitionFactoryDecl(
+     sdecl::class_<OGLTransitionFactoryImpl>(),
+#endif
+    "com.sun.star.comp.presentation.OGLTransitionFactory",
+    "com.sun.star.presentation.TransitionFactory" );
+
+// The C shared lib entry points
+COMPHELPER_SERVICEDECL_EXPORTS1(OGLTransitionFactoryDecl)
diff --git slideshow/source/engine/OGLTrans/unx/makefile.mk slideshow/source/engine/OGLTrans/unx/makefile.mk
new file mode 100644
index 0000000..6f75967
--- /dev/null
+++ slideshow/source/engine/OGLTrans/unx/makefile.mk
@@ -0,0 +1,76 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile.mk,v $
+#
+# $Revision: 1.5.12.1 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+PRJ=..$/..$/..$/..
+
+PRJNAME=slideshow
+TARGET=OGLTrans
+ENABLE_EXCEPTIONS=TRUE
+
+# --- Settings -----------------------------------------------------------
+
+.INCLUDE :      settings.mk
+.INCLUDE : $(PRJ)$/util$/makefile.pmk
+
+# --- Nothing to do if we're compiling with --disable-opengl or if nto the right OS  -----------
+.IF "$(ENABLE_OPENGL)" != "TRUE" && "$(GUI)"!="UNX || "$(OS)"=="MACOSX"
+@all:
+    @echo "Building without OpenGL Transitions..."
+.ENDIF
+
+# --- Common ----------------------------------------------------------
+
+SLOFILES = \
+    $(SLO)$/OGLTrans_TransitionImpl_$(OS).obj \
+    $(SLO)$/OGLTrans_Shaders_$(OS).obj \
+    $(SLO)$/OGLTrans_TransitionerImpl_$(OS).obj
+
+SHL1TARGET=$(TARGET).uno
+
+SHL1STDLIBS= $(SALLIB) $(VCLLIB) $(CPPULIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(CANVASTOOLSLIB)
+
+SHL1STDLIBS+= \
+    -lGL \
+    -lGLU \
+    -lX11
+
+SHL1IMPLIB=i$(TARGET)
+SHL1LIBS=$(SLB)$/$(TARGET).lib
+SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+
+SHL1VERSIONMAP=../exports.map
+
+DEF1NAME=$(SHL1TARGET)
+DEF1EXPORTFILE=../exports.dxp
+
+# ==========================================================================
+
+.INCLUDE :	target.mk
diff --git slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders.hxx slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders.hxx
new file mode 100644
index 0000000..049c71f
--- /dev/null
+++ slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders.hxx
@@ -0,0 +1,71 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: $
+ * $Revision: $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef INCLUDED_OGLTRANS_SHADERS_HXX_
+#define INCLUDED_OGLTRANS_SHADERS_HXX_
+
+#define GL_GLEXT_PROTOTYPES 1
+#include <GL/gl.h>
+#include <GL/glext.h>
+
+class OGLShaders {
+    static bool Initialize();
+    static bool cbInitialized;
+
+public:    
+
+    static GLuint LinkProgram( const char *vertexShader, const char *fragmentShader );
+
+    /** GL shader functions
+     */
+#ifdef GL_VERSION_2_0
+
+    static PFNGLCREATESHADERPROC glCreateShader;
+    static PFNGLSHADERSOURCEPROC glShaderSource;
+    static PFNGLCOMPILESHADERPROC glCompileShader;
+    static PFNGLGETSHADERIVPROC glGetShaderiv;
+    static PFNGLGETSHADERINFOLOGPROC glGetShaderInfoLog;
+    static PFNGLDELETESHADERPROC glDeleteShader;
+
+    static PFNGLCREATEPROGRAMPROC glCreateProgram;
+    static PFNGLATTACHSHADERPROC glAttachShader;
+    static PFNGLLINKPROGRAMPROC glLinkProgram;
+    static PFNGLGETPROGRAMIVPROC glGetProgramiv;
+    static PFNGLGETPROGRAMINFOLOGPROC glGetProgramInfoLog;
+    static PFNGLUSEPROGRAMPROC glUseProgram;
+    static PFNGLDELETEPROGRAMPROC glDeleteProgram;
+
+    static PFNGLGETUNIFORMLOCATIONPROC glGetUniformLocation;
+    static PFNGLUNIFORM1IPROC glUniform1i;
+    static PFNGLUNIFORM1FPROC glUniform1f;
+#endif
+};
+
+#endif
diff --git slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders_WNT.cxx slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders_WNT.cxx
new file mode 100644
index 0000000..a144790
--- /dev/null
+++ slideshow/source/engine/OGLTrans/win/OGLTrans_Shaders_WNT.cxx
@@ -0,0 +1,143 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: $
+ * $Revision: $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include <osl/diagnose.hxx>
+
+#include "OGLTrans_Shaders.hxx"
+
+namespace unx
+{
+#include <GL/glx.h>
+#include <GL/glxext.h>
+}
+
+bool OGLShaders::cbInitialized = false;
+
+#ifdef GL_VERSION_2_0
+
+PFNGLCREATESHADERPROC OGLShaders::glCreateShader = NULL;
+PFNGLSHADERSOURCEPROC OGLShaders::glShaderSource = NULL;
+PFNGLCOMPILESHADERPROC OGLShaders::glCompileShader = NULL;
+PFNGLGETSHADERIVPROC OGLShaders::glGetShaderiv = NULL;
+PFNGLGETSHADERINFOLOGPROC OGLShaders::glGetShaderInfoLog = NULL;
+PFNGLDELETESHADERPROC OGLShaders::glDeleteShader = NULL;
+PFNGLCREATEPROGRAMPROC OGLShaders::glCreateProgram = NULL;
+PFNGLATTACHSHADERPROC OGLShaders::glAttachShader = NULL;
+PFNGLLINKPROGRAMPROC OGLShaders::glLinkProgram = NULL;
+PFNGLGETPROGRAMIVPROC OGLShaders::glGetProgramiv = NULL;
+PFNGLGETPROGRAMINFOLOGPROC OGLShaders::glGetProgramInfoLog = NULL;
+PFNGLUSEPROGRAMPROC OGLShaders::glUseProgram = NULL;
+PFNGLDELETEPROGRAMPROC OGLShaders::glDeleteProgram = NULL;
+PFNGLGETUNIFORMLOCATIONPROC OGLShaders::glGetUniformLocation = NULL;
+PFNGLUNIFORM1IPROC OGLShaders::glUniform1i = NULL;
+PFNGLUNIFORM1FPROC OGLShaders::glUniform1f = NULL;
+#endif
+
+bool OGLShaders::Initialize()
+{
+#ifdef GL_VERSION_2_0
+    if( !cbInitialized ) {
+        glCreateShader = (PFNGLCREATESHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glCreateShader" );
+        glShaderSource = (PFNGLSHADERSOURCEPROC) unx::glXGetProcAddress( (unsigned char *) "glShaderSource" );
+        glCompileShader = (PFNGLCOMPILESHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glCompileShader" );
+        glGetShaderiv = (PFNGLGETSHADERIVPROC) unx::glXGetProcAddress( (unsigned char *) "glGetShaderiv" );
+        glGetShaderInfoLog = (PFNGLGETSHADERINFOLOGPROC) unx::glXGetProcAddress( (unsigned char *) "glGetShaderInfoLog" );
+        glDeleteShader = (PFNGLDELETESHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glDeleteShader" );
+        glCreateProgram = (PFNGLCREATEPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glCreateProgram" );
+        glAttachShader = (PFNGLATTACHSHADERPROC) unx::glXGetProcAddress( (unsigned char *) "glAttachShader" );
+        glLinkProgram = (PFNGLLINKPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glLinkProgram" );
+        glGetProgramiv = (PFNGLGETPROGRAMIVPROC) unx::glXGetProcAddress( (unsigned char *) "glGetProgramiv" );
+        glGetProgramInfoLog = (PFNGLGETPROGRAMINFOLOGPROC) unx::glXGetProcAddress( (unsigned char *) "glGetProgramInfoLog" );
+        glUseProgram = (PFNGLUSEPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glUseProgram" );
+        glDeleteProgram = (PFNGLDELETEPROGRAMPROC) unx::glXGetProcAddress( (unsigned char *) "glDeleteProgram" );
+        glGetUniformLocation = (PFNGLGETUNIFORMLOCATIONPROC) unx::glXGetProcAddress( (unsigned char *) "glGetUniformLocation" );
+        glUniform1i = (PFNGLUNIFORM1IPROC) unx::glXGetProcAddress( (unsigned char *) "glUniform1i" );
+        glUniform1f = (PFNGLUNIFORM1FPROC) unx::glXGetProcAddress( (unsigned char *) "glUniform1f" );
+        cbInitialized = true;
+    }
+
+    return glCreateShader != NULL;
+#else
+    return false;
+#endif
+}
+
+GLuint OGLShaders::LinkProgram( const char *vertexShader, const char *fragmentShader )
+{
+#ifdef GL_VERSION_2_0
+    if( !Initialize() )
+        return 0;
+
+    GLhandleARB vertexObject, fragmentObject, programObject;
+    GLint vertexCompiled, fragmentCompiled, programLinked;
+    char log[1024];
+
+    vertexObject = glCreateShader( GL_VERTEX_SHADER );
+    fragmentObject = glCreateShader( GL_FRAGMENT_SHADER );
+    OSL_TRACE("checkpoint 1: shaders created (%d) vertex: %d fragment: %d", glGetError() == GL_NO_ERROR, vertexObject, fragmentObject );
+
+
+    glShaderSource( vertexObject, 1, &vertexShader, NULL );
+    glShaderSource( fragmentObject, 1, &fragmentShader, NULL );
+
+    glCompileShader( vertexObject );
+    glGetShaderInfoLog( vertexObject, sizeof( log ), NULL, log );
+    OSL_TRACE("vertex compile log: %s", log);
+    glGetShaderiv( vertexObject, GL_COMPILE_STATUS, &vertexCompiled );
+    glCompileShader( fragmentObject );
+    glGetShaderInfoLog( fragmentObject, sizeof( log ), NULL, log );
+    OSL_TRACE("fragment compile log: %s", log);
+    glGetShaderiv( fragmentObject, GL_COMPILE_STATUS, &fragmentCompiled );
+
+    if( !vertexCompiled || !fragmentCompiled )
+        return 0;
+
+    OSL_TRACE("checkpoint 2: shaders compiled (%d)", glGetError() == GL_NO_ERROR);
+
+    programObject = glCreateProgram();
+    glAttachShader( programObject, vertexObject );
+    glAttachShader( programObject, fragmentObject );
+
+    glLinkProgram( programObject );
+    glGetProgramInfoLog( programObject, sizeof( log ), NULL, log );
+    OSL_TRACE("program link log: %s", log);
+    glGetProgramiv( programObject, GL_LINK_STATUS, &programLinked );
+
+    if( !programLinked )
+        return 0;
+
+    OSL_TRACE("checkpoint 3: program linked (%d)", glGetError() == GL_NO_ERROR);
+
+    return programObject;
+#else
+    return 0;
+#endif
+}
+
diff --git slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.cxx slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.cxx
new file mode 100644
index 0000000..277d7e0
--- /dev/null
+++ slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.cxx
@@ -0,0 +1,1321 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionImpl.cxx,v $
+ * $Revision: 1.5.12.1 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include "OGLTrans_TransitionImpl.hxx"
+#include "OGLTrans_Shaders.hxx"
+#ifdef QUARTZ
+#include <OpenGL/gl.h>
+#else
+#include <GL/gl.h>
+#include <math.h>
+#endif
+
+void OGLTransitionImpl::clear()
+{
+    for(unsigned int i( 0 ); i < OverallOperations.size(); ++i)
+        delete OverallOperations[i];
+    OverallOperations.clear();
+    maLeavingSlidePrimitives.clear();
+    maEnteringSlidePrimitives.clear();
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
+        delete maSceneObjects[i];
+    maSceneObjects.clear();
+
+    mbReflectSlides = false;
+
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        OGLShaders::glDeleteProgram( mProgramObject );
+        mProgramObject = 0;
+    }
+
+    if( mVertexObject ) {
+        OGLShaders::glDeleteShader( mVertexObject );
+        mVertexObject = 0;
+    }
+
+    if( mFragmentObject ) {
+        OGLShaders::glDeleteShader( mFragmentObject );
+        mFragmentObject = 0;
+    }
+#endif
+
+    if( maHelperTexture ) {
+        glDeleteTextures( 1, &maHelperTexture );
+        maHelperTexture = 0;
+    }
+
+    if( mmClearTransition )
+        (this->*mmClearTransition)();
+}
+
+OGLTransitionImpl::~OGLTransitionImpl()
+{
+    clear();
+}
+
+void OGLTransitionImpl::prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex )
+{
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
+        maSceneObjects[i]->prepare();
+    }
+
+    if( mmPrepareTransition )
+        (this->*mmPrepareTransition)( glLeavingSlideTex, glEnteringSlideTex );
+}
+
+void OGLTransitionImpl::finish()
+{
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i) {
+        maSceneObjects[i]->finish();
+    }
+}
+
+static void blendSlide( double depth )
+{
+    double showHeight = -1 + depth*2;
+    GLfloat reflectionColor[] = {0, 0, 0, 0.25};
+
+    glDisable( GL_DEPTH_TEST );
+    glBegin( GL_QUADS );
+    glColor4fv( reflectionColor );
+    glVertex3f( -1, -1, 0 );
+    glColor4f( 0, 0, 0, 1 );
+    glVertex3f(-1,  showHeight, 0 );
+    glVertex3f( 1,  showHeight, 0 );
+    glColor4fv( reflectionColor );
+    glVertex3f( 1, -1, 0 );
+    glEnd();
+
+    glBegin( GL_QUADS );
+    glColor4f( 0, 0, 0, 1 );
+    glVertex3f( -1, showHeight, 0 );
+    glVertex3f( -1,  1, 0 );
+    glVertex3f(  1,  1, 0 );
+    glVertex3f(  1, showHeight, 0 );
+    glEnd();
+    glEnable( GL_DEPTH_TEST );
+}
+
+static void slideShadow( double nTime, Primitive& primitive, double sw, double sh )
+{
+    double reflectionDepth = 0.3;
+
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glDisable(GL_LIGHTING);
+
+    glPushMatrix();
+    primitive.applyOperations( nTime, sw, sh );
+    blendSlide( reflectionDepth );
+    glPopMatrix();
+
+    glDisable(GL_BLEND);
+    glEnable(GL_LIGHTING);
+}
+
+void OGLTransitionImpl::display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                 double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    double SlideWidthScale, SlideHeightScale;
+
+    SlideWidthScale = SlideWidth/DispWidth;
+    SlideHeightScale = SlideHeight/DispHeight;
+
+    if( mmPrepare ) {
+        clear();
+        (this->*mmPrepare)( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
+    }
+
+    glPushMatrix();
+    displaySlides( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
+    displayScene( nTime, SlideWidth, SlideHeight, DispWidth, DispHeight );
+    glPopMatrix();
+}
+
+void OGLTransitionImpl::applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale )
+{
+    for(unsigned int i(0); i < OverallOperations.size(); ++i)
+        OverallOperations[i]->interpolate(nTime,SlideWidthScale,SlideHeightScale);
+}
+
+void OGLTransitionImpl::displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives,
+                                      double SlideWidthScale, double SlideHeightScale )
+{
+   //TODO change to foreach
+    glBindTexture(GL_TEXTURE_2D, glSlideTex);
+
+    // display slide reflection
+    // note that depth test is turned off while blending the shadow
+    // so the slides has to be rendered in right order, see rochade as example
+    if( mbReflectSlides ) {
+        double surfaceLevel = -0.04;
+
+        /* reflected slides */
+        glPushMatrix();
+
+        glScaled( 1, -1, 1 );
+        glTranslated( 0, 2 - surfaceLevel, 0 );
+
+        glCullFace(GL_FRONT);
+    for(unsigned int i(0); i < primitives.size(); ++i)
+        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
+        glCullFace(GL_BACK);
+
+    slideShadow( nTime, primitives[0], SlideWidthScale, SlideHeightScale );
+
+        glPopMatrix();
+    }
+
+    for(unsigned int i(0); i < primitives.size(); ++i)
+        primitives[i].display(nTime, SlideWidthScale, SlideHeightScale);
+}
+
+void OGLTransitionImpl::displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                       double SlideWidthScale, double SlideHeightScale )
+{
+    if( mmDisplaySlides )
+        (this->*mmDisplaySlides)( nTime, glLeavingSlideTex, glEnteringSlideTex, SlideWidthScale, SlideHeightScale );
+    else {
+        applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+        glEnable(GL_TEXTURE_2D);
+        displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+        displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+}
+
+void OGLTransitionImpl::displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    glEnable(GL_TEXTURE_2D);
+    for(unsigned int i(0); i < maSceneObjects.size(); ++i)
+        maSceneObjects[i]->display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
+}
+
+void Primitive::display(double nTime, double WidthScale, double HeightScale)
+{
+    glPushMatrix();
+
+    applyOperations( nTime, WidthScale, HeightScale );
+
+    glEnableClientState( GL_VERTEX_ARRAY );
+    if(!Normals.empty())
+    {
+        glNormalPointer( GL_DOUBLE , 0 , &Normals[0] );
+        glEnableClientState( GL_NORMAL_ARRAY );
+    }
+    glEnableClientState( GL_TEXTURE_COORD_ARRAY );
+    glTexCoordPointer( 2, GL_DOUBLE, 0, &TexCoords[0] );
+    glVertexPointer( 3, GL_DOUBLE, 0, &Vertices[0] );
+    glDrawArrays( GL_TRIANGLES, 0, Vertices.size() );
+    glPopMatrix();
+}
+
+void Primitive::applyOperations(double nTime, double WidthScale, double HeightScale)
+{
+    for(unsigned int i(0); i < Operations.size(); ++i)
+        Operations[i]->interpolate( nTime ,WidthScale,HeightScale);
+    glScaled(WidthScale,HeightScale,1);
+}
+
+Primitive::~Primitive()
+{
+    for(unsigned int i( 0 ); i < Operations.size(); ++i)
+        delete Operations[i];
+}
+
+
+void SceneObject::display(double nTime, double /* SlideWidth */, double /* SlideHeight */, double DispWidth, double DispHeight )
+{
+    for(unsigned int i(0); i < maPrimitives.size(); ++i) {
+        // fixme: allow various model spaces, now we make it so that
+        // it is regular -1,-1 to 1,1, where the whole display fits in
+        glPushMatrix();
+        if (DispHeight > DispWidth)
+            glScaled(DispHeight/DispWidth, 1, 1);
+        else
+            glScaled(1, DispWidth/DispHeight, 1);
+        maPrimitives[i].display(nTime, 1, 1);
+        glPopMatrix();
+    }
+}
+
+void SceneObject::pushPrimitive(const Primitive &p)
+{
+    maPrimitives.push_back(p);
+}
+
+SceneObject::SceneObject()
+    : maPrimitives()
+{
+}
+
+Iris::Iris()
+    : SceneObject ()
+{
+}
+
+void Iris::display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight )
+{
+    glBindTexture(GL_TEXTURE_2D, maTexture);
+    SceneObject::display(nTime, SlideWidth, SlideHeight, DispWidth, DispHeight);
+}
+
+void Iris::prepare()
+{
+    static GLubyte img[3] = { 80, 80, 80 };
+    
+    glGenTextures(1, &maTexture);
+    glBindTexture(GL_TEXTURE_2D, maTexture);
+    glTexImage2D(GL_TEXTURE_2D, 0, 3, 1, 1, 0, GL_RGB, GL_UNSIGNED_BYTE, img);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S,GL_REPEAT);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T,GL_REPEAT);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR);
+}
+
+void Iris::finish()
+{
+    glDeleteTextures(1, &maTexture);
+}
+
+void OGLTransitionImpl::makeOutsideCubeFaceToLeft()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),90,false,0.0,1.0));
+
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,-1),-90,true,0.0,1.0));
+}
+
+void OGLTransitionImpl::makeInsideCubeFaceToLeft()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),-90,false,0.0,1.0));
+
+    maEnteringSlidePrimitives.push_back(Slide);
+    
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,1),90,true,0.0,1.0));
+}
+
+void OGLTransitionImpl::makeFallLeaving()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(1,0,0),basegfx::B3DVector(0,-1,0), 90,true,0.0,1.0));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::makeTurnAround()
+{
+    clear();
+    Primitive Slide;
+
+    mbReflectSlides = true;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0),-180,false,0.0,1.0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, -1.5),true, 0, 0.5));
+    OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1.5), true, 0.5, 1));
+    OverallOperations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0),basegfx::B3DVector(0, 0, 0), -180, true, 0.0, 1.0));
+}
+
+void OGLTransitionImpl::makeTurnDown()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 0.0001), false, -1.0, 0.0));
+    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), -90, true, 0.0, 1.0));
+    Slide.Operations.push_back(new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(-1, 1, 0), 90, false, -1.0, 0.0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    mbUseMipMapLeaving = false;
+}
+
+void OGLTransitionImpl::makeIris()
+{
+    clear();
+    Primitive Slide;
+    
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0,  0.000001), false, -1, 0));
+    Slide.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, -0.000002), false, 0.5, 1));
+    maLeavingSlidePrimitives.push_back (Slide);
+
+
+    Primitive irisPart, part;
+    int i, nSteps = 24, nParts = 7;
+    double lt = 0, t = 1.0/nSteps, cx, cy, lcx, lcy, lx = 1, ly = 0, x, y, cxo, cyo, lcxo, lcyo, of=2.2, f=1.42;
+
+    for (i=1; i<=nSteps; i++) {
+        x = cos ((3*2*M_PI*t)/nParts);
+        y = -sin ((3*2*M_PI*t)/nParts);
+        cx = (f*x + 1)/2;
+        cy = (f*y + 1)/2;
+        lcx = (f*lx + 1)/2;
+        lcy = (f*ly + 1)/2;
+        cxo = (of*x + 1)/2;
+        cyo = (of*y + 1)/2;
+        lcxo = (of*lx + 1)/2;
+        lcyo = (of*ly + 1)/2;
+        irisPart.pushTriangle (basegfx::B2DVector (lcx, lcy),
+                               basegfx::B2DVector (lcxo, lcyo),
+                               basegfx::B2DVector (cx, cy));
+        irisPart.pushTriangle (basegfx::B2DVector (cx, cy),
+                               basegfx::B2DVector (lcxo, lcyo),
+                               basegfx::B2DVector (cxo, cyo));
+        lx = x;
+        ly = y;
+        lt = t;
+        t += 1.0/nSteps;
+    }
+
+    Iris* pIris = new Iris();
+    double angle = 87;
+
+    for (i = 0; i < nParts; i++) {
+        irisPart.Operations.clear ();
+        double rx, ry;
+
+        rx = cos ((2*M_PI*i)/nParts);
+        ry = sin ((2*M_PI*i)/nParts);
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0),  angle, true, 0.0, 0.5));
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(rx, ry, 0), -angle, true, 0.5, 1));
+        if (i > 0) {
+            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(rx, ry, 0),  false, -1, 0));
+            irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(0, 0, 1), basegfx::B3DVector(0, 0, 0), i*360.0/nParts, false, -1, 0));
+            irisPart.Operations.push_back (new STranslate (basegfx::B3DVector(-1, 0, 0),  false, -1, 0));
+        }
+        irisPart.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, 1), false, -2, 0.0));
+        irisPart.Operations.push_back (new SRotate (basegfx::B3DVector(1, .5, 0), basegfx::B3DVector(1, 0, 0), -30, false, -1, 0));
+        pIris->pushPrimitive (irisPart);
+    }
+
+    maSceneObjects.push_back (pIris);
+
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                          double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glEnable(GL_TEXTURE_2D);
+
+    if( nTime > .5) {
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    } else {
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+}
+
+void OGLTransitionImpl::makeRochade()
+{
+    clear();
+    Primitive Slide;
+    
+    mbReflectSlides = true;
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesRochade;
+
+    double w, h;
+
+    w = 2.2;
+    h = 10;
+
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+
+    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.25, -0.25, true, 0, 1));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.clear();
+    Slide.Operations.push_back(new SEllipseTranslate(w, h, 0.75, 0.25, true, 0, 1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(0, 0, -h), false, -1, 0));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), -45, true, 0, 1));
+    Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0,1,0),basegfx::B3DVector(0,0,0), 45, false, -1, 0));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    //     OverallOperations.push_back(new SEllipseTranslate(0.5, 2, 0, 1, true, 0, 1));
+//      push_back(new STranslate(basegfx::B3DVector(0, 0, -2), true, 0, 0.5));
+//      OverallOperations.push_back(new STranslate(basegfx::B3DVector(0, 0, 2), true, 0.5, 1));
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B2DVector clamp(const basegfx::B2DVector& v)
+{
+    return basegfx::B2DVector(min(max(v.getX(),-1.0),1.0),
+                              min(max(v.getY(),-1.0),1.0));
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B3DVector clamp(const basegfx::B3DVector& v)
+{
+    return basegfx::B3DVector(min(max(v.getX(),-1.0),1.0),
+                              min(max(v.getY(),-1.0),1.0),
+                              min(max(v.getZ(),-1.0),1.0));
+}
+
+inline double randFromNeg1to1()
+{
+    return ( ( static_cast<double>( rand() ) / static_cast<double>( RAND_MAX ) ) * 2.0 ) - 1.0;
+}
+
+// TODO(Q3): extract to basegfx
+inline basegfx::B3DVector randNormVectorInXYPlane()
+{
+    basegfx::B3DVector toReturn(randFromNeg1to1(),randFromNeg1to1(),0.0);
+    return toReturn/toReturn.getLength();
+}
+
+void OGLTransitionImpl::makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles )
+{
+    clear();
+    double dAngle(2*3.1415926/static_cast<double>( nPointsOnCircles ));
+    if(nCircles < 2 || nPointsOnCircles < 4)
+    {
+        makeNByMTileFlip(1,1);
+        return;
+    }
+    double Radius(1.0/static_cast<double>( nCircles ));
+    double dRadius(Radius);
+    double LastRadius(0.0);
+    double NextRadius(2*Radius);
+
+    /// now we know there is at least two circles
+    /// the first will always be a full circle
+    /// the last will always be the outer shell of the slide with a circle hole
+
+    //add the full circle
+    vector<basegfx::B2DVector> unScaledTexCoords;
+    double TempAngle(0.0);
+    for(unsigned int Point(0); Point < nPointsOnCircles; ++Point)
+    {
+        unScaledTexCoords.push_back( basegfx::B2DVector( cos(TempAngle - 3.1415926/2.0) , sin(TempAngle- 3.1415926/2.0) ) );
+
+        TempAngle += dAngle;
+    }
+    
+    {
+        //double angle(0.0);
+        Primitive EnteringSlide;
+        Primitive LeavingSlide;
+        for(int Point(0); Point + 1 < nPointsOnCircles; ++Point)
+        {
+            EnteringSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
+            LeavingSlide.pushTriangle( basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point + 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ Point ] / 2.0 + basegfx::B2DVector( 0.5, 0.5) );
+        }
+        EnteringSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius * unScaledTexCoords[ 0 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) , Radius * unScaledTexCoords[ nPointsOnCircles - 1 ] / 2.0 + basegfx::B2DVector( 0.5 , 0.5 ) );
+        LeavingSlide.pushTriangle( basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+    
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+    
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+        LastRadius = Radius;
+        Radius = NextRadius;
+        NextRadius += dRadius;
+    }    
+    
+    for(int i(1); i < nCircles - 1; ++i)
+    {
+        Primitive LeavingSlide;
+        Primitive EnteringSlide;
+        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
+        {            
+            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            EnteringSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            
+            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            LeavingSlide.pushTriangle(Radius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        }
+        
+        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        EnteringSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        LeavingSlide.pushTriangle(Radius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , Radius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, Radius/2.0 , (NextRadius + 1)/2.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+        
+        LastRadius = Radius;
+        Radius = NextRadius;
+        NextRadius += dRadius;
+    }
+    {
+        Radius = sqrt(2.0);
+        Primitive LeavingSlide;
+        Primitive EnteringSlide;
+        for(int Side(0); Side < nPointsOnCircles - 1; ++Side)
+        {
+            
+            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
+            
+            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) );
+            LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[Side])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[Side + 1]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[Side + 1])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        }
+        
+        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        EnteringSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[nPointsOnCircles - 1]/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) );
+        LeavingSlide.pushTriangle(clamp(Radius*unScaledTexCoords[nPointsOnCircles - 1])/2.0 + basegfx::B2DVector(0.5,0.5) , LastRadius*unScaledTexCoords[0]/2.0 + basegfx::B2DVector(0.5,0.5) , clamp(Radius*unScaledTexCoords[0])/2.0 + basegfx::B2DVector(0.5,0.5) );
+        
+        basegfx::B3DVector axis(randNormVectorInXYPlane());
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
+        LeavingSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , 180, true, (LastRadius + dRadius)/2.0 , 1.0 ) );
+        EnteringSlide.Operations.push_back( new SRotate( axis , basegfx::B3DVector(0,0,0) , -180, false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(EnteringSlide);
+        maLeavingSlidePrimitives.push_back(LeavingSlide);
+    }
+}
+
+void OGLTransitionImpl::makeHelix( ::sal_uInt16 nRows )
+{
+    clear();
+    double invN(1.0/static_cast<double>(nRows));
+    double iDn = 0.0;
+    double iPDn = invN;
+    for(unsigned int i(0); i < nRows; ++i)
+    {
+        Primitive Tile;
+        
+        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
+            
+        Tile.pushTriangle(basegfx::B2DVector( 1.0 , iPDn ) , basegfx::B2DVector( 1.0 , iDn ) , basegfx::B2DVector( 0.0 , iPDn ));
+        
+        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , 
+                                                true,min(max(static_cast<double>(i - nRows/2.0)*invN/2.0,0.0),1.0),
+                                                min(max(static_cast<double>(i + nRows/2.0)*invN/2.0,0.0),1.0) ) );
+        
+        maLeavingSlidePrimitives.push_back(Tile);
+        
+        Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 0 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180 , false,0.0,1.0) );
+        
+        maEnteringSlidePrimitives.push_back(Tile);
+            
+        iDn += invN;
+        iPDn += invN;
+    }
+}
+
+void OGLTransitionImpl::makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m )
+{
+    clear();
+    double invN(1.0/static_cast<double>(n));
+    double invM(1.0/static_cast<double>(m));
+    double iDn = 0.0;
+    double iPDn = invN;
+    for(unsigned int i(0); i < n; ++i)
+    {
+        double jDm = 0.0;
+        double jPDm = invM;
+        for(unsigned int j(0); j < m; ++j)
+        {
+            Primitive Tile;
+
+            Tile.pushTriangle(basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));
+
+            Tile.pushTriangle(basegfx::B2DVector( iPDn , jPDm ) , basegfx::B2DVector( iPDn , jDm ) , basegfx::B2DVector( iDn , jPDm ));//bottom left corner of tile            
+
+            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , 180 , true, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
+            maLeavingSlidePrimitives.push_back(Tile);
+            Tile.Operations.push_back( new SRotate( basegfx::B3DVector( 1 , 1 , 0 ) , ( Tile.getVertices()[1] + Tile.getVertices()[3] )/2.0 , -180, false, iDn*jDm/2.0 , ((iPDn*jPDm)+1.0)/2.0 ) );
+
+            maEnteringSlidePrimitives.push_back(Tile);
+
+            jDm += invM;
+            jPDm += invM;
+        }
+        iDn += invN;
+        iPDn += invN;
+    }
+}
+
+SRotate::SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+SScale::SScale(const basegfx::B3DVector& Scale,const basegfx::B3DVector& Origin, bool bInter, double T0, double T1):scale(Scale),origin(Origin)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+RotateAndScaleDepthByWidth::RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+RotateAndScaleDepthByHeight::RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle, bool bInter, double T0, double T1):axis(Axis),origin(Origin),angle(Angle)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+
+STranslate::STranslate(const basegfx::B3DVector& Vector, bool bInter, double T0, double T1):vector(Vector)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+}
+
+inline double intervalInter(double t, double T0, double T1)
+{
+    return ( t - T0 ) / ( T1 - T0 );
+}
+
+void STranslate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*t*vector.getX(),SlideHeightScale*t*vector.getY(),t*vector.getZ());
+}
+
+void SRotate::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
+    glScaled(SlideWidthScale,SlideHeightScale,1);
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glScaled(1/SlideWidthScale,1/SlideHeightScale,1);
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
+}
+
+void SScale::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),origin.getZ());
+    glScaled((1-t) + t*scale.getX(),(1-t) + t*scale.getY(),(1-t) + t*scale.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-origin.getZ());
+}
+
+void RotateAndScaleDepthByWidth::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideWidthScale*origin.getZ());
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideWidthScale*origin.getZ());
+}
+
+void RotateAndScaleDepthByHeight::interpolate(double t,double SlideWidthScale,double SlideHeightScale)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+    glTranslated(SlideWidthScale*origin.getX(),SlideHeightScale*origin.getY(),SlideHeightScale*origin.getZ());
+    glRotated(t*angle,axis.getX(),axis.getY(),axis.getZ());
+    glTranslated(-SlideWidthScale*origin.getX(),-SlideHeightScale*origin.getY(),-SlideHeightScale*origin.getZ());
+}
+
+SEllipseTranslate::SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1)
+{
+    nT0 = T0;
+    nT1 = T1;
+    bInterpolate = bInter;
+    width = dWidth;
+    height = dHeight;
+    startPosition = dStartPosition;
+    endPosition = dEndPosition;
+}
+
+void SEllipseTranslate::interpolate(double t,double /* SlideWidthScale */,double /* SlideHeightScale */)
+{
+    if(t <= nT0)
+        return;
+    if(!bInterpolate || t > nT1)
+        t = nT1;
+    t = intervalInter(t,nT0,nT1);
+
+    double a1, a2, x, y;
+    a1 = startPosition*2*M_PI;
+    a2 = (startPosition + t*(endPosition - startPosition))*2*M_PI;
+    x = width*(cos (a2) - cos (a1))/2;
+    y = height*(sin (a2) - sin (a1))/2;
+
+    glTranslated(x, 0, y);
+}
+
+STranslate* STranslate::clone()
+{
+    return new STranslate(*this);
+}
+SRotate* SRotate::clone()
+{
+    return new SRotate(*this);
+}
+
+SScale* SScale::clone()
+{
+    return new SScale(*this);
+}
+
+SEllipseTranslate* SEllipseTranslate::clone()
+{
+    return new SEllipseTranslate(*this);
+}
+
+RotateAndScaleDepthByWidth* RotateAndScaleDepthByWidth::clone()
+{
+    return new RotateAndScaleDepthByWidth(*this);
+}
+
+RotateAndScaleDepthByHeight* RotateAndScaleDepthByHeight::clone()
+{
+    return new RotateAndScaleDepthByHeight(*this);
+}
+
+const Primitive& Primitive::operator=(const Primitive& rvalue)
+{
+    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
+        Operations.push_back(rvalue.Operations[i]->clone());
+    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
+        Vertices.push_back(rvalue.Vertices[i]);
+    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
+        TexCoords.push_back(rvalue.TexCoords[i]);
+    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
+        Normals.push_back(rvalue.Normals[i]);    
+    return *this;   
+}
+    
+Primitive::Primitive(const Primitive& rvalue)
+{
+    for(unsigned int i( 0 ); i < rvalue.Operations.size(); ++i)
+        Operations.push_back(rvalue.Operations[i]->clone());
+    for(unsigned int i( 0 ); i < rvalue.Vertices.size(); ++i)//SPEED! use copy or something. this is slow.
+        Vertices.push_back(rvalue.Vertices[i]);
+    for(unsigned int i( 0 ); i < rvalue.TexCoords.size(); ++i)//SPEED! use copy or something. this is slow.
+        TexCoords.push_back(rvalue.TexCoords[i]);
+    for(unsigned int i( 0 ); i < rvalue.Normals.size(); ++i)//SPEED! use copy or something. this is slow.
+        Normals.push_back(rvalue.Normals[i]);
+}
+
+void Primitive::pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2)
+{
+    vector<basegfx::B3DVector> Verts;
+    vector<basegfx::B2DVector> Texs;
+    Verts.reserve(3);
+    Texs.reserve(3);
+
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
+    Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
+
+    //figure out if they're facing the correct way, and make them face the correct way.
+    basegfx::B3DVector Normal( basegfx::cross( Verts[0] - Verts[1] , Verts[1] - Verts[2] ) );
+    if(Normal.getZ() >= 0.0)//if the normal is facing us
+    {
+        Texs.push_back(SlideLocation0);
+        Texs.push_back(SlideLocation1);
+        Texs.push_back(SlideLocation2);
+    }
+    else // if the normal is facing away from us, make it face us
+    {
+        Texs.push_back(SlideLocation0);
+        Texs.push_back(SlideLocation2);
+        Texs.push_back(SlideLocation1);
+        Verts.clear();
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation0.getX() - 1, -2*SlideLocation0.getY() + 1 , 0.0 ));
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation2.getX() - 1, -2*SlideLocation2.getY() + 1 , 0.0 ));
+        Verts.push_back(basegfx::B3DVector( 2*SlideLocation1.getX() - 1, -2*SlideLocation1.getY() + 1 , 0.0 ));
+    }
+
+    Vertices.push_back(Verts[0]);
+    Vertices.push_back(Verts[1]);
+    Vertices.push_back(Verts[2]);
+
+    TexCoords.push_back(Texs[0]);
+    TexCoords.push_back(Texs[1]);
+    TexCoords.push_back(Texs[2]);
+    
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+    Normals.push_back(basegfx::B3DVector(0,0,1));//all normals always face the screen when untransformed.
+}
+
+void OGLTransitionImpl::makeDiamond()
+{
+    mmPrepare = &OGLTransitionImpl::prepareDiamond;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::prepareDiamond( double nTime, double /* SlideWidth */, double /* SlideHeight */, double /* DispWidth */, double /* DispHeight */ )
+{
+    Primitive Slide1, Slide2;
+
+    Slide1.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide1.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maEnteringSlidePrimitives.push_back (Slide1);
+
+    
+    if( nTime >= 0.5 ) {
+        double m = 1 - nTime;
+
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (m,0), basegfx::B2DVector (0,m));
+        Slide2.pushTriangle (basegfx::B2DVector (nTime,0), basegfx::B2DVector (1,0), basegfx::B2DVector (1,m));
+        Slide2.pushTriangle (basegfx::B2DVector (1,nTime), basegfx::B2DVector (1,1), basegfx::B2DVector (nTime,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,nTime), basegfx::B2DVector (m,1), basegfx::B2DVector (0,1));
+    } else {
+        double l = 0.5 - nTime;
+        double h = 0.5 + nTime;
+
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0.5,l));
+        Slide2.pushTriangle (basegfx::B2DVector (0.5,l), basegfx::B2DVector (1,0), basegfx::B2DVector (h,0.5));
+        Slide2.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (1,1), basegfx::B2DVector (h,0.5));
+        Slide2.pushTriangle (basegfx::B2DVector (h,0.5), basegfx::B2DVector (1,1), basegfx::B2DVector (0.5,h));
+        Slide2.pushTriangle (basegfx::B2DVector (0.5,h), basegfx::B2DVector (1,1), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (l,0.5), basegfx::B2DVector (0.5,h), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (l,0.5), basegfx::B2DVector (0,1));
+        Slide2.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (0.5,l), basegfx::B2DVector (l,0.5));
+    }
+    Slide2.Operations.push_back (new STranslate (basegfx::B3DVector (0, 0, 0.00000001), false, -1, 0));
+    maLeavingSlidePrimitives.push_back (Slide2);
+}
+
+void OGLTransitionImpl::makeVenetianBlinds( bool vertical, int parts )
+{
+    static double t30 = tan( M_PI/6.0 );
+    double n, ln = 0;
+    double p = 1.0/parts;
+
+    for( int i=0; i<parts; i++ ) {
+        Primitive Slide;
+        n = (i + 1)/(double)parts;
+        if( vertical ) {
+            Slide.pushTriangle (basegfx::B2DVector (ln,0), basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1));
+            Slide.pushTriangle (basegfx::B2DVector (n,0), basegfx::B2DVector (ln,1), basegfx::B2DVector (n,1));
+            Slide.Operations.push_back(new RotateAndScaleDepthByWidth(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, -t30*p), -120, true, 0.0, 1.0));
+        } else {
+            Slide.pushTriangle (basegfx::B2DVector (0,ln), basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n));
+            Slide.pushTriangle (basegfx::B2DVector (1,ln), basegfx::B2DVector (0,n), basegfx::B2DVector (1,n));
+            Slide.Operations.push_back(new RotateAndScaleDepthByHeight(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, -t30*p), -120, true, 0.0, 1.0));
+        }
+        maLeavingSlidePrimitives.push_back (Slide);
+
+        if( vertical ) {
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(2*n - 1, 0, 0), -60, false, -1, 0));
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0, 1, 0), basegfx::B3DVector(n + ln - 1, 0, 0), 180, false, -1, 0));
+        } else {
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - 2*n, 0), -60, false, -1, 0));
+            Slide.Operations.push_back(new SRotate(basegfx::B3DVector(1, 0, 0), basegfx::B3DVector(0, 1 - n - ln, 0), 180, false, -1, 0));
+        }
+        maEnteringSlidePrimitives.push_back (Slide);
+        ln = n;
+    }
+}
+
+void OGLTransitionImpl::displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_DEPTH_TEST);
+
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_LIGHTING);
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+    glColor4f( 1, 1, 1, nTime );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    glDisable(GL_BLEND);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
+    glEnable(GL_LIGHTING);
+
+    glEnable(GL_DEPTH_TEST);
+}
+
+void OGLTransitionImpl::makeFadeSmoothly()
+{ 
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeSmoothly;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+void OGLTransitionImpl::displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+    glDisable(GL_DEPTH_TEST);
+
+    glDisable(GL_LIGHTING);
+    glEnable(GL_BLEND);
+    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_MODULATE);
+    if( nTime < 0.5 ) {
+    glColor4f( 1, 1, 1, 1 - nTime*2 );
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    } else {
+    glColor4f( 1, 1, 1, (nTime - 0.5)*2 );
+    displaySlide( nTime, glEnteringSlideTex, maEnteringSlidePrimitives, SlideWidthScale, SlideHeightScale );
+    }
+    glDisable(GL_BLEND);
+    glTexEnvi(GL_TEXTURE_ENV, GL_TEXTURE_ENV_MODE, GL_REPLACE);
+    glEnable(GL_LIGHTING);
+
+    glEnable(GL_DEPTH_TEST);
+}
+
+void OGLTransitionImpl::makeFadeThroughBlack()
+{ 
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesFadeThroughBlack;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+}
+
+static const char* basicVertexShader = "\n\
+varying vec2 v_texturePosition;\n\
+\n\
+void main( void )\n\
+{\n\
+    gl_Position = ftransform();\n\
+    v_texturePosition = gl_MultiTexCoord0.xy;\n\
+}\n\
+";
+
+static const char* staticFragmentShader = "\n\
+uniform sampler2D leavingSlideTexture;\n\
+uniform sampler2D enteringSlideTexture;\n\
+uniform sampler2D permTexture;\n\
+uniform float time;\n\
+varying vec2 v_texturePosition;\n\
+\n\
+float snoise(vec2 P) {\n\
+\n\
+  return texture2D(permTexture, P).r;\n\
+}\n\
+\n\
+\n\
+#define PART 0.5\n\
+#define START 0.4\n\
+#define END 0.9\n\
+\n\
+void main() {\n\
+    float sn = snoise(10.0*v_texturePosition+time*0.07);\n\
+    if( time < PART ) {\n\
+        float sn1 = snoise(vec2(time*15.0, 20.0*v_texturePosition.y));\n\
+        float sn2 = snoise(v_texturePosition);\n\
+        if (sn1 > 1.0 - time*time && sn2 < 2.0*time+0.1)\n\
+            gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
+        else if (time > START )\n\
+            gl_FragColor = ((time-START)/(PART - START))*vec4(sn, sn, sn, 1.0) + (1.0 - (time - START)/(PART - START))*texture2D(leavingSlideTexture, v_texturePosition);\n\
+        else\n\
+            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+    } else if ( time < PART ) {\n\
+            gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+    } else if ( time > END ) {\n\
+        gl_FragColor = ((1.0 - time)/(1.0 - END))*vec4(sn, sn, sn, 1.0) + ((time - END)/(1.0 - END))*texture2D(enteringSlideTexture, v_texturePosition);\n\
+    } else \n\
+        gl_FragColor = vec4(sn, sn, sn, 1.0);\n\
+}\n\
+";
+
+static const char* dissolveFragmentShader = "\n\
+uniform sampler2D leavingSlideTexture;\n\
+uniform sampler2D enteringSlideTexture;\n\
+uniform sampler2D permTexture;\n\
+uniform float time;\n\
+varying vec2 v_texturePosition;\n\
+\n\
+float snoise(vec2 P) {\n\
+\n\
+  return texture2D(permTexture, P).r;\n\
+}\n\
+\n\
+void main() {\n\
+     float sn = snoise(10.0*v_texturePosition);\n\
+     if( sn < time)\n\
+         gl_FragColor = texture2D(enteringSlideTexture, v_texturePosition);\n\
+     else\n\
+         gl_FragColor = texture2D(leavingSlideTexture, v_texturePosition);\n\
+}\n\
+";
+
+int permutation256 [256]= {
+215, 100, 200, 204, 233,  50,  85, 196, 
+ 71, 141, 122, 160,  93, 131, 243, 234, 
+162, 183,  36, 155,   4,  62,  35, 205, 
+ 40, 102,  33,  27, 255,  55, 214, 156, 
+ 75, 163, 134, 126, 249,  74, 197, 228, 
+ 72,  90, 206, 235,  17,  22,  49, 169, 
+227,  89,  16,   5, 117,  60, 248, 230, 
+217,  68, 138,  96, 194, 170, 136,  10, 
+112, 238, 184, 189, 176,  42, 225, 212, 
+ 84,  58, 175, 244, 150, 168, 219, 236, 
+101, 208, 123,  37, 164, 110, 158, 201, 
+ 78, 114,  57,  48,  70, 142, 106,  43, 
+232,  26,  32, 252, 239,  98, 191,  94, 
+ 59, 149,  39, 187, 203, 190,  19,  13, 
+133,  45,  61, 247,  23,  34,  20,  52, 
+118, 209, 146, 193, 222,  18,   1, 152, 
+ 46,  41,  91, 148, 115,  25, 135,  77, 
+254, 147, 224, 161,   9, 213, 223, 250, 
+231, 251, 127, 166,  63, 179,  81, 130, 
+139,  28, 120, 151, 241,  86, 111,   0, 
+ 88, 153, 172, 182, 159, 105, 178,  47, 
+ 51, 167,  65,  66,  92,  73, 198, 211, 
+245, 195,  31, 220, 140,  76, 221, 186, 
+154, 185,  56,  83,  38, 165, 109,  67, 
+124, 226, 132,  53, 229,  29,  12, 181, 
+121,  24, 207, 199, 177, 113,  30,  80, 
+  3,  97, 188,  79, 216, 173,   8, 145, 
+ 87, 128, 180, 237, 240, 137, 125, 104, 
+ 15, 242, 119, 246, 103, 143,  95, 144, 
+  2,  44,  69, 157, 192, 174,  14,  54, 
+218,  82,  64, 210,  11,   6, 129,  21, 
+116, 171,  99, 202,   7, 107, 253, 108
+};
+
+void initPermTexture(GLuint *texID)
+{
+  glGenTextures(1, texID);
+  glBindTexture(GL_TEXTURE_2D, *texID);
+
+  static bool initialized = false;
+  static unsigned char permutation2D[256*256*4];
+  if( !initialized ) {
+      int x, y;
+
+      for( y=0; y < 256; y++ )
+          for( x=0; x < 256; x++ )
+              permutation2D[x*4 + y*1024] = permutation256[(y + permutation256[x]) & 0xff];
+
+      initialized = true;
+  }
+
+  glTexImage2D( GL_TEXTURE_2D, 0, GL_RGBA, 256, 256, 0, GL_RGBA, GL_UNSIGNED_BYTE, permutation2D );
+  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_NEAREST );
+  glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_NEAREST );
+}
+
+void OGLTransitionImpl::preparePermShader()
+{
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        OGLShaders::glUseProgram( mProgramObject );
+
+        GLint location = OGLShaders::glGetUniformLocation( mProgramObject, "leavingSlideTexture" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1i( location, 0 );  // texture unit 0
+        }
+
+        glActiveTexture(GL_TEXTURE1);
+        if( !maHelperTexture )
+            initPermTexture( &maHelperTexture );
+        glActiveTexture(GL_TEXTURE0);
+
+        location = OGLShaders::glGetUniformLocation( mProgramObject, "permTexture" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1i( location, 1 );  // texture unit 1
+        }
+
+        location = OGLShaders::glGetUniformLocation( mProgramObject, "enteringSlideTexture" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1i( location, 2 );  // texture unit 2
+        }
+    }
+#endif
+}
+
+void OGLTransitionImpl::prepareStatic( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
+{
+    mProgramObject = OGLShaders::LinkProgram( basicVertexShader, staticFragmentShader );
+
+    preparePermShader();
+}
+
+void OGLTransitionImpl::displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex,
+                                              double SlideWidthScale, double SlideHeightScale )
+{
+    applyOverallOperations( nTime, SlideWidthScale, SlideHeightScale );
+
+#ifdef GL_VERSION_2_0
+    if( mProgramObject ) {
+        GLint location = OGLShaders::glGetUniformLocation( mProgramObject, "time" );
+        if( location != -1 ) {
+            OGLShaders::glUniform1f( location, nTime );
+        }
+    }
+
+    glActiveTexture( GL_TEXTURE2 );
+    glBindTexture( GL_TEXTURE_2D, glEnteringSlideTex );
+    glActiveTexture( GL_TEXTURE0 );
+#endif
+
+    displaySlide( nTime, glLeavingSlideTex, maLeavingSlidePrimitives, SlideWidthScale, SlideHeightScale );
+}
+
+void OGLTransitionImpl::makeStatic()
+{
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
+    mmPrepareTransition = &OGLTransitionImpl::prepareStatic;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+
+    mnRequiredGLVersion = 2.0;
+}
+
+void OGLTransitionImpl::prepareDissolve( ::sal_Int32 /* glLeavingSlideTex */, ::sal_Int32 /* glEnteringSlideTex */ )
+{
+    mProgramObject = OGLShaders::LinkProgram( basicVertexShader, dissolveFragmentShader );
+
+    preparePermShader();
+}
+
+void OGLTransitionImpl::makeDissolve()
+{
+    Primitive Slide;
+
+    Slide.pushTriangle (basegfx::B2DVector (0,0), basegfx::B2DVector (1,0), basegfx::B2DVector (0,1));
+    Slide.pushTriangle (basegfx::B2DVector (1,0), basegfx::B2DVector (0,1), basegfx::B2DVector (1,1));
+    maLeavingSlidePrimitives.push_back (Slide);
+    maEnteringSlidePrimitives.push_back (Slide);
+
+    mmDisplaySlides = &OGLTransitionImpl::displaySlidesShaders;
+    mmPrepareTransition = &OGLTransitionImpl::prepareDissolve;
+    mbUseMipMapLeaving = mbUseMipMapEntering = false;
+
+    mnRequiredGLVersion = 2.0;
+}
+
+void OGLTransitionImpl::makeNewsflash()
+{
+    Primitive Slide;
+    
+    Slide.pushTriangle(basegfx::B2DVector(0,0),basegfx::B2DVector(1,0),basegfx::B2DVector(0,1));
+    Slide.pushTriangle(basegfx::B2DVector(1,0),basegfx::B2DVector(0,1),basegfx::B2DVector(1,1));
+    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),3000,true,0,0.5));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),true,0,0.5));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-10000, 0, 0),false, 0.5, 2));
+    maLeavingSlidePrimitives.push_back(Slide);
+
+    Slide.Operations.clear();
+    Slide.Operations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0,0,0),-3000,true,0.5,1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(-100, 0, 0),false, -1, 1));
+    Slide.Operations.push_back(new STranslate(basegfx::B3DVector(100, 0, 0),false, 0.5, 1));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(0.01,0.01,0.01),basegfx::B3DVector(0,0,0),false,-1,1));
+    Slide.Operations.push_back(new SScale(basegfx::B3DVector(100,100,100),basegfx::B3DVector(0,0,0),true,0.5,1));
+    maEnteringSlidePrimitives.push_back(Slide);
+
+    OverallOperations.push_back(new SRotate(basegfx::B3DVector(0,0,1),basegfx::B3DVector(0.2,0.2,0),1080,true,0,1));
+}
+
diff --git slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.hxx slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.hxx
new file mode 100644
index 0000000..a8080d5
--- /dev/null
+++ slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionImpl.hxx
@@ -0,0 +1,513 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionImpl.hxx,v $
+ * $Revision: 1.5.12.1 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
+#define INCLUDED_OGLTRANS_TRANSITIONIMPL_HXX_
+
+#include <basegfx/vector/b2dvector.hxx>
+#include <basegfx/vector/b3dvector.hxx>
+
+#include <tools/prewin.h>
+#include <tools/postwin.h>
+
+#if defined( WNT ) 
+#include <tools/prewin.h>
+#include <tools/postwin.h>
+#elif defined( OS2 )
+#elif defined( QUARTZ )
+#include <OpenGL/gl.h>
+#elif defined( UNX ) && !defined( QUARTZ )
+#endif
+
+#include <vector>
+
+#if !defined( QUARTZ )
+#include <GL/gl.h>
+#endif
+
+using namespace std;
+
+class Primitive;
+class Operation;
+class SceneObject;
+
+
+/** OpenGL 3D Transition class. It implicitly is constructed from XOGLTransition
+
+    This class is capable of making itself into many difference transitions. It holds Primitives and Operations on those primitives.
+*/
+class OGLTransitionImpl
+{
+public:
+    OGLTransitionImpl() :
+        mbUseMipMapLeaving( true ),
+        mbUseMipMapEntering( true ),
+        mnRequiredGLVersion( 1.0 ),
+        maLeavingSlidePrimitives(),
+        maEnteringSlidePrimitives(),
+        maSceneObjects(),
+        mbReflectSlides( false ),
+        mVertexObject( 0 ),
+        mFragmentObject( 0 ),
+        mProgramObject( 0 ),
+        maHelperTexture( 0 ),
+        mmPrepare( NULL ),
+        mmPrepareTransition( NULL ),
+        mmClearTransition( NULL ),
+        mmDisplaySlides( NULL )
+    {}
+
+    ~OGLTransitionImpl();
+    
+    void prepare( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void display( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
+    void finish();
+
+    void makeOutsideCubeFaceToLeft();
+    void makeInsideCubeFaceToLeft();
+    void makeNByMTileFlip( ::sal_uInt16 n, ::sal_uInt16 m );
+    void makeRevolvingCircles( ::sal_uInt16 nCircles , ::sal_uInt16 nPointsOnCircles );
+    void makeHelix( ::sal_uInt16 nRows );
+    void makeFallLeaving();
+    void makeTurnAround();
+    void makeTurnDown();
+    void makeIris();
+    void makeRochade();
+    void makeVenetianBlinds( bool vertical, int parts );
+    void makeStatic();
+    void makeDissolve();
+    void makeNewsflash();
+
+    /** 2D replacements
+     */
+    void makeDiamond();
+    void makeFadeSmoothly();
+    void makeFadeThroughBlack();
+
+    /** Whether to use mipmaping for slides textures
+     */
+    bool mbUseMipMapLeaving;
+    bool mbUseMipMapEntering;
+
+    /** which GL version does the transition require
+     */
+    float mnRequiredGLVersion;
+
+private:
+    /** clears all the primitives and operations
+    */
+    void clear();
+    
+    /** All the primitives that use the leaving slide texture
+    */
+    vector<Primitive> maLeavingSlidePrimitives;
+    
+    /** All the primitives that use the leaving slide texture
+    */
+    vector<Primitive> maEnteringSlidePrimitives;
+    
+    /** All the surrounding scene objects
+    */
+    vector<SceneObject*> maSceneObjects;
+
+    /** All the operations that should be applied to both leaving and entering slide primitives. These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
+    */
+    vector<Operation*> OverallOperations;
+
+    /** Whether to reflect slides, the reflection happens on flat surface beneath the slides.
+     ** Now it only works with slides which keep their rectangular shape together.
+     */
+    bool mbReflectSlides;
+
+    /** GLSL objects, shaders and program
+     */
+    GLuint mVertexObject, mFragmentObject, mProgramObject;
+
+    /** various data */
+    GLuint maHelperTexture;
+
+    /** When this method is not NULL, it is called in display method to prepare the slides, scene, etc.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmPrepare)( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight );
+
+    /** When this method is not NULL, it is called after glx context is ready to let the transition prepare GL related things, like GLSL program.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmPrepareTransition)( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+
+    /** When this method is not NULL, it is called when the transition needs to clear after itself, like delete own textures etc.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmClearTransition)();
+
+    /** When this method is not NULL, it is called in display method to display the slides.
+     ** We might later replace this by cleaner derived class.
+     */
+    void (OGLTransitionImpl::*mmDisplaySlides)( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+
+    void displaySlides( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void displaySlide( double nTime, ::sal_Int32 glSlideTex, std::vector<Primitive>& primitives, double SlideWidthScale, double SlideHeightScale );
+    void displayScene( double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    void applyOverallOperations( double nTime, double SlideWidthScale, double SlideHeightScale );
+
+    /** various transitions helper methods
+     */
+    void prepareDiamond( double nTime, double SlideWidth, double SlideHeight,double DispWidth, double DispHeight );
+    void displaySlidesFadeSmoothly( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+        void displaySlidesFadeThroughBlack( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+        void displaySlidesRochade( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void displaySlidesShaders( double nTime, ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex, double SlideWidthScale, double SlideHeightScale );
+    void prepareStatic( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void prepareDissolve( ::sal_Int32 glLeavingSlideTex, ::sal_Int32 glEnteringSlideTex );
+    void preparePermShader();
+};
+
+class SceneObject
+{
+public:
+    SceneObject();
+
+    virtual void prepare() {};
+    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    virtual void finish() {};
+
+    void pushPrimitive (const Primitive &p);
+
+protected:
+    /** All the surrounding scene primitives
+    */
+    vector<Primitive> maPrimitives;
+};
+
+class Iris : public SceneObject
+{
+public:
+    Iris ();
+
+    virtual void prepare();
+    virtual void display(double nTime, double SlideWidth, double SlideHeight, double DispWidth, double DispHeight);
+    virtual void finish();
+
+private:
+
+    GLuint maTexture;
+};
+
+/** This class is a list of Triangles that will share Operations, and could possibly share  
+*/
+class Primitive
+{
+public:
+    Primitive() {}
+    // making copy constructor explicit makes the class un-suitable for use with stl containers
+    Primitive(const Primitive& rvalue);
+    ~Primitive();
+
+    void applyOperations(double nTime, double SlideWidthScale, double SlideHeightScale);
+    void display(double nTime, double SlideWidthScale, double SlideHeightScale);
+    const Primitive& operator=(const Primitive& rvalue);
+    
+    /** PushBack a vertex,normal, and tex coord. Each SlideLocation is where on the slide is mapped to this location ( from (0,0) to (1,1)  ). This will make sure the correct aspect ratio is used, and helps to make slides begin and end at the correct position. (0,0) is the top left of the slide, and (1,1) is the bottom right.
+    
+    @param SlideLocation0
+    Location of first Vertex on slide
+    
+    @param SlideLocation1
+    Location of second Vertex on slide
+    
+    @param SlideLocation2
+    Location of third Vertex on slide
+    
+    */
+    void pushTriangle(const basegfx::B2DVector& SlideLocation0,const basegfx::B2DVector& SlideLocation1,const basegfx::B2DVector& SlideLocation2);
+    
+    /** clear all the vertices, normals, tex coordinates, and normals
+    */
+    void clearTriangles();
+    
+    /** guards against directly changing the vertices
+        
+        @return        
+        the list of vertices
+    */
+    const vector<basegfx::B3DVector>& getVertices() const {return Vertices;}
+    
+    /** guards against directly changing the vertices
+    */
+    const vector<basegfx::B3DVector>& getNormals() const {return Normals;}
+    
+    /** guards against directly changing the vertices
+    
+        @return        
+        the list of Texture Coordinates
+    
+    */
+    const vector<basegfx::B2DVector>& getTexCoords() const {return TexCoords;}
+
+    /** list of Operations to be performed on this primitive.These operations will be called in the order they were pushed back in. In OpenGL this effectively uses the operations in the opposite order they were pushed back.
+    
+        @return        
+        the list of Operations
+    
+    */    
+    vector<Operation*> Operations;
+
+private:
+    /** list of vertices
+    */
+    vector<basegfx::B3DVector> Vertices;
+    
+    /** list of Normals
+    */
+    vector<basegfx::B3DVector> Normals;
+    
+    /** list of Texture Coordinates
+    */
+    vector<basegfx::B2DVector> TexCoords;
+};
+
+/** This class is to be derived to make any operation (tranform) you may need in order to construct your transitions
+*/
+class Operation
+{
+public:
+    Operation(){}
+    virtual ~Operation(){}
+    
+    /** Should this operation be interpolated . If TRUE, the transform will smoothly move from making no difference from t = 0.0 to nT0 to being completely transformed from t = nT1 to 1. If FALSE, the transform will be inneffectual from t = 0 to nT0, and completely transformed from t = nT0 to 1. 
+    */
+    bool bInterpolate;
+    
+    /** time to begin the transformation
+    */
+    double nT0;
+    
+    /** time to finish the transformation
+    */
+    double nT1;
+public:
+    /** this is the function that is called to give the Operation to OpenGL.
+        
+        @param t
+        time from t = 0 to t = 1
+        
+        @param SlideWidthScale
+        width of slide divided by width of window
+        
+        @param SlideHeightScale
+        height of slide divided by height of window
+    
+    */
+    virtual void interpolate(double t,double SlideWidthScale,double SlideHeightScale) = 0;
+    
+    /** return a copy of this operation
+    */
+    virtual Operation* clone() = 0;
+};
+
+/** this class is a generic CounterClockWise(CCW) rotation with an axis angle
+*/
+class SRotate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    virtual SRotate* clone();
+    
+    /** Constructor
+        
+        @param Axis
+        axis to rotate about
+        
+        @param Origin
+        position that rotation axis runs through
+        
+        @param Angle
+        angle in radians of CCW rotation
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SRotate(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~SRotate(){}
+private:
+    /** axis to rotate CCW about
+    */
+    basegfx::B3DVector axis;
+    
+    /** position that rotation axis runs through
+    */
+    basegfx::B3DVector origin;
+    
+    /** angle in radians of CCW rotation
+    */
+    double angle;
+};
+
+/** scaling transformation
+*/
+class SScale: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    SScale* clone();
+    
+    /** Constructor
+        
+        @param Scale
+        amount to scale by 
+        
+        @param Origin
+        position that rotation axis runs through
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SScale(const basegfx::B3DVector& Scale, const basegfx::B3DVector& Origin,bool bInter, double T0, double T1);
+    ~SScale(){}
+private:
+    basegfx::B3DVector scale;
+    basegfx::B3DVector origin;
+};
+
+/** translation transformation
+*/
+class STranslate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    STranslate* clone();
+    
+    /** Constructor
+        
+        @param Vector
+        vector to translate
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    STranslate(const basegfx::B3DVector& Vector,bool bInter, double T0, double T1);
+    ~STranslate(){}
+private:
+    /** vector to translate by
+    */
+    basegfx::B3DVector vector;
+};
+
+/** translation transformation
+*/
+class SEllipseTranslate: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    SEllipseTranslate* clone();
+    
+    /** Constructor
+        
+        @param Vector
+        vector to translate
+        
+        @param bInter
+        see Operation
+        
+        @param T0
+        transformation starting time
+        
+        @param T1
+        transformation ending time
+    
+    */
+    SEllipseTranslate(double dWidth, double dHeight, double dStartPosition, double dEndPosition, bool bInter, double T0, double T1);
+    ~SEllipseTranslate(){}
+private:
+    /** width and length of the ellipse
+     */
+    double width, height;
+
+    /** start and end position on the ellipse <0,1>
+     */
+    double startPosition;
+    double endPosition;
+};
+
+/** Same as SRotate, except the depth is scaled by the width of the slide divided by the width of the window.
+*/
+class RotateAndScaleDepthByWidth: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    RotateAndScaleDepthByWidth* clone();
+
+    RotateAndScaleDepthByWidth(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~RotateAndScaleDepthByWidth(){}
+private:
+    basegfx::B3DVector axis;
+    basegfx::B3DVector origin;
+    double angle;
+};
+
+/** Same as SRotate, except the depth is scaled by the width of the slide divided by the height of the window.
+*/
+class RotateAndScaleDepthByHeight: public Operation
+{
+public:
+    void interpolate(double t,double SlideWidthScale,double SlideHeightScale);
+    RotateAndScaleDepthByHeight* clone();
+
+    RotateAndScaleDepthByHeight(const basegfx::B3DVector& Axis,const basegfx::B3DVector& Origin,double Angle,bool bInter, double T0, double T1);
+    ~RotateAndScaleDepthByHeight(){}
+private:
+    basegfx::B3DVector axis;
+    basegfx::B3DVector origin;
+    double angle;
+};
+
+#endif // INCLUDED_SLIDESHOW_TRANSITION_HXX_
+
diff --git slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionerImpl_WNT.cxx slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionerImpl_WNT.cxx
new file mode 100644
index 0000000..fc61624
--- /dev/null
+++ slideshow/source/engine/OGLTrans/win/OGLTrans_TransitionerImpl_WNT.cxx
@@ -0,0 +1,1455 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: OGLTrans_TransitionerImpl.cxx,v $
+ * $Revision: 1.6 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#define GLX_GLXEXT_PROTOTYPES 1
+#include "OGLTrans_TransitionImpl.hxx"
+
+#include <com/sun/star/beans/XFastPropertySet.hpp>
+#include <com/sun/star/rendering/IntegerBitmapLayout.hpp>
+#include <com/sun/star/rendering/ColorComponentTag.hpp>
+#include <com/sun/star/rendering/ColorSpaceType.hpp>
+#include <com/sun/star/animations/TransitionType.hpp>
+#include <com/sun/star/animations/TransitionSubType.hpp>
+#include <com/sun/star/presentation/XTransitionFactory.hpp>
+#include <com/sun/star/presentation/XTransition.hpp>
+#include <com/sun/star/presentation/XSlideShowView.hpp>
+#include <com/sun/star/uno/XComponentContext.hpp>
+#include <com/sun/star/rendering/XIntegerBitmap.hpp>
+#include <com/sun/star/geometry/IntegerSize2D.hpp>
+
+#include <cppuhelper/compbase1.hxx>
+#include <cppuhelper/basemutex.hxx>
+#include <cppuhelper/factory.hxx>
+#include <rtl/ref.hxx>
+
+#include <comphelper/servicedecl.hxx>
+
+#include <canvas/canvastools.hxx>
+#include <tools/gen.hxx>
+#include <vcl/window.hxx>
+#include <vcl/syschild.hxx>
+#include <vcl/sysdata.hxx>
+
+#include <boost/noncopyable.hpp>
+
+#include <GL/gl.h>
+#include <GL/glu.h>
+
+#define GL_TEXTURE_MAX_ANISOTROPY_EXT 0x84FE
+#define GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT 0x84FF
+
+#ifdef DEBUG
+#include <boost/date_time/posix_time/posix_time.hpp>
+using namespace ::boost::posix_time;
+
+static ptime t1;
+static ptime t2;
+
+#define DBG(x) x
+#else
+#define DBG(x)
+#endif
+
+using namespace ::com::sun::star;
+using ::com::sun::star::beans::XFastPropertySet;
+using ::com::sun::star::uno::Any;
+using ::com::sun::star::uno::Reference;
+using ::com::sun::star::uno::Sequence;
+using ::com::sun::star::uno::UNO_QUERY;
+using ::com::sun::star::uno::UNO_QUERY_THROW;
+
+namespace
+{
+
+typedef cppu::WeakComponentImplHelper1<presentation::XTransition> OGLTransitionerImplBase;
+
+namespace
+{
+    struct OGLFormat
+    {
+        GLint  nInternalFormat;
+        GLenum eFormat;
+        GLenum eType;
+    };
+
+    /* channel ordering: (0:rgba, 1:bgra, 2:argb, 3:abgr)  
+    */
+    int calcComponentOrderIndex(const uno::Sequence<sal_Int8>& rTags)
+    {
+        using namespace rendering::ColorComponentTag;
+
+        static const sal_Int8 aOrderTable[] =
+        {
+            RGB_RED, RGB_GREEN, RGB_BLUE, ALPHA,
+            RGB_BLUE, RGB_GREEN, RGB_RED, ALPHA,
+            ALPHA, RGB_RED, RGB_GREEN, RGB_BLUE,
+            ALPHA, RGB_BLUE, RGB_GREEN, RGB_RED, 
+        };
+
+        const sal_Int32 nNumComps(rTags.getLength());
+        const sal_Int8* pLine=aOrderTable;
+        for(int i=0; i<4; ++i)
+        {
+            int j=0;
+            while( j<4 && j<nNumComps && pLine[j] == rTags[j] )
+                ++j;
+
+            // all of the line passed, this is a match!
+            if( j==nNumComps )
+                return i;
+
+            pLine+=4;
+        }
+
+        return -1;
+    }
+}
+
+// not thread safe
+static bool errorTriggered;
+int oglErrorHandler( unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/ )
+{
+    errorTriggered = true;
+
+    return 0;
+}
+
+/** This is the Transitioner class for OpenGL 3D transitions in
+ * slideshow. At the moment, it's Linux only. This class is implicitly
+ * constructed from XTransitionFactory.
+*/
+class OGLTransitionerImpl : private cppu::BaseMutex, private boost::noncopyable, public OGLTransitionerImplBase
+{
+public:
+    explicit OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition);
+    bool initWindowFromSlideShowView( const uno::Reference< presentation::XSlideShowView >& xView );
+    void setSlides( const Reference< rendering::XBitmap >& xLeavingSlide , const uno::Reference< rendering::XBitmap >& xEnteringSlide );
+    static bool initialize( const Reference< presentation::XSlideShowView >& xView );
+
+    // XTransition
+    virtual void SAL_CALL update( double nTime )
+    throw (uno::RuntimeException);
+    virtual void SAL_CALL viewChanged( const Reference< presentation::XSlideShowView >& rView,
+                       const Reference< rendering::XBitmap >& rLeavingBitmap,
+                       const Reference< rendering::XBitmap >& rEnteringBitmap )
+    throw (uno::RuntimeException);
+    
+protected:
+    void disposeContextAndWindow();
+    void disposeTextures();
+
+    // WeakComponentImplHelperBase
+    virtual void SAL_CALL disposing();
+    
+    bool isDisposed() const
+    {
+        return (rBHelper.bDisposed || rBHelper.bInDispose);
+    }
+
+    bool createWindow( Window* pPWindow );
+    void createTexture( unsigned int* texID,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+            unx::GLXPixmap pixmap,
+            bool usePixmap,
+#endif
+            bool useMipmap,
+            uno::Sequence<sal_Int8>& data,
+            const OGLFormat* pFormat );
+    void prepareEnvironment ();
+    const OGLFormat* chooseFormats();
+
+private:    
+    /** After the window has been created, and the slides have been set, we'll initialize the slides with OpenGL.
+    */
+    void GLInitSlides();
+
+
+    /// Holds the information of our new child window
+    struct GLWindow
+    {
+    HWND					hWnd;
+    HDC						hDC;
+    HGLRC					hRC;
+        unsigned int            bpp;
+        unsigned int            Width;
+        unsigned int            Height;
+        const char*             GLXExtensions;
+    const GLubyte*          GLExtensions;
+
+        bool HasGLXExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, (const GLubyte*) GLXExtensions ); }
+    bool HasGLExtension( const char* name ) { return gluCheckExtension( (const GLubyte*) name, GLExtensions ); }
+    } GLWin;
+    
+    /** OpenGL handle to the leaving slide's texture
+    */
+    unsigned int GLleavingSlide;
+    /** OpenGL handle to the entering slide's texture
+    */
+    unsigned int GLenteringSlide;
+    
+    /** pointer to our window which we MIGHT create.
+    */
+    class SystemChildWindow* pWindow;
+
+    Reference< presentation::XSlideShowView > mxView;
+    Reference< rendering::XIntegerBitmap > mxLeavingBitmap;
+    Reference< rendering::XIntegerBitmap > mxEnteringBitmap;
+    
+    /** raw bytes of the entering bitmap
+    */
+    uno::Sequence<sal_Int8> EnteringBytes;
+    
+    /** raw bytes of the leaving bitmap
+    */
+    uno::Sequence<sal_Int8> LeavingBytes;
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::GLXPixmap LeavingPixmap;
+    unx::GLXPixmap EnteringPixmap;
+#endif
+    bool mbRestoreSync;
+    bool mbUseLeavingPixmap;
+    bool mbUseEnteringPixmap;
+    bool mbFreeLeavingPixmap;
+    bool mbFreeEnteringPixmap;
+    unx::Pixmap maLeavingPixmap;
+    unx::Pixmap maEnteringPixmap;
+    
+    /** the form the raw bytes are in for the bitmaps
+    */
+    rendering::IntegerBitmapLayout SlideBitmapLayout; 
+    
+    /** the size of the slides
+    */    
+    geometry::IntegerSize2D SlideSize;
+    
+    /** Our Transition to be used.
+    */    
+    OGLTransitionImpl* pTransition;
+
+public:
+    /** whether we are running on ATI fglrx with bug related to textures
+     */
+    static bool cbBrokenTexturesATI;
+
+    /** GL version
+     */
+    static float cnGLVersion;
+    float mnGLXVersion;
+
+    /** Whether Mesa is the OpenGL vendor
+     */
+    static bool cbMesa;
+
+    /**
+       whether the display has GLX extension
+     */
+    static bool cbGLXPresent;
+
+    /**
+       whether texture from pixmap extension is available
+    */
+    bool mbTextureFromPixmap;
+
+    /**
+       whether to generate mipmaped textures
+    */
+    bool mbGenerateMipmap;
+
+    /**
+       whether we have visual which can be used for texture_from_pixmap extension
+    */
+    bool mbHasTFPVisual;
+
+#ifdef DEBUG
+    ptime t3;
+    ptime t4;
+    ptime t5;
+    ptime t6;
+    time_duration total_update;
+    int frame_count;
+#endif
+};
+
+// declare the static variables as some gcc versions have problems declaring them automaticaly
+bool OGLTransitionerImpl::cbBrokenTexturesATI;
+float OGLTransitionerImpl::cnGLVersion;
+bool OGLTransitionerImpl::cbMesa;
+bool OGLTransitionerImpl::cbGLXPresent;
+
+bool OGLTransitionerImpl::initialize( const Reference< presentation::XSlideShowView >& xView )
+{
+    // not thread safe
+    static bool initialized = false;
+
+    if( !initialized ) {
+        OGLTransitionerImpl *instance;
+
+        instance = new OGLTransitionerImpl( NULL );
+        if( instance->initWindowFromSlideShowView( xView ) ) {
+
+            const GLubyte* version = glGetString( GL_VERSION );
+            if( version && version[0] ) {
+                cnGLVersion = version[0] - '0';
+                if( version[1] == '.' && version[2] )
+                    cnGLVersion += (version[2] - '0')/10.0;
+            } else
+                cnGLVersion = 1.0;
+            OSL_TRACE("GL version: %s parsed: %f", version, cnGLVersion );
+
+            const GLubyte* vendor = glGetString( GL_VENDOR );
+            cbMesa = ( vendor && strstr( (const char *) vendor, "Mesa" ) );
+            OSL_TRACE("GL vendor: %s identified as Mesa: %d", vendor, cbMesa );
+
+            /* TODO: check for version once the bug in fglrx driver is fixed */
+            cbBrokenTexturesATI = (vendor && strcmp( (const char *) vendor, "ATI Technologies Inc." ) == 0 );
+
+            instance->disposing();
+            cbGLXPresent = true;
+        } else
+            cbGLXPresent = false;
+
+        delete instance;
+        initialized = true;
+    }
+
+    return cbGLXPresent;
+}
+
+bool OGLTransitionerImpl::createWindow( Window* pPWindow )
+{
+    const SystemEnvData* sysData(pPWindow->GetSystemData());
+#if defined( WNT ) 
+    GLWin.hWnd = sysData->hWnd;
+#elif defined( UNX )
+    GLWin.dpy = reinterpret_cast<unx::Display*>(sysData->pDisplay);
+
+    if( unx::glXQueryExtension( GLWin.dpy, NULL, NULL ) == false )
+        return false;
+
+    GLWin.win = sysData->aWindow;
+
+    OSL_TRACE("parent window: %d", GLWin.win);
+
+    unx::XWindowAttributes xattr;
+    unx::XGetWindowAttributes( GLWin.dpy, GLWin.win, &xattr );
+
+    GLWin.screen = XScreenNumberOfScreen( xattr.screen );
+
+    unx::XVisualInfo* vi( NULL );
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::XVisualInfo* visinfo;
+    unx::XVisualInfo* firstVisual( NULL );
+#endif
+    static int attrList3[] =
+        {
+        GLX_RGBA,//only TrueColor or DirectColor
+            //single buffered
+            GLX_RED_SIZE,4,//use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,//use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,//use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,0,//no depth buffer
+            None
+        };
+    static int attrList2[] = 
+    {
+        GLX_RGBA,//only TrueColor or DirectColor
+            /// single buffered
+            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,1,/// use the maximum depth bits, making sure there is a depth buffer
+            None
+        };
+    static int attrList1[] =
+        {
+        GLX_RGBA,//only TrueColor or DirectColor
+            GLX_DOUBLEBUFFER,/// only double buffer
+            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,0,/// no depth buffer
+            None
+        };
+    static int attrList0[] =
+        {
+        GLX_RGBA,//only TrueColor or DirectColor
+            GLX_DOUBLEBUFFER,/// only double buffer
+            GLX_RED_SIZE,4,/// use the maximum red bits, with a minimum of 4 bits
+            GLX_GREEN_SIZE,4,/// use the maximum green bits, with a minimum of 4 bits
+            GLX_BLUE_SIZE,4,/// use the maximum blue bits, with a minimum of 4 bits
+            GLX_DEPTH_SIZE,1,/// use the maximum depth bits, making sure there is a depth buffer
+            None
+       }; 
+    static int* attrTable[] = 
+        {
+            attrList0,
+            attrList1,
+            attrList2,
+            attrList3,
+            NULL
+        };
+    int** pAttributeTable = attrTable;
+    const SystemEnvData* pChildSysData = NULL;
+    delete pWindow;
+    pWindow=NULL;
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::GLXFBConfig* fbconfigs = NULL;
+    int nfbconfigs, value, i = 0;
+#endif
+
+    while( *pAttributeTable )
+    {
+        // try to find a visual for the current set of attributes
+        vi = unx::glXChooseVisual( GLWin.dpy,
+                                   GLWin.screen,
+                                   *pAttributeTable );
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+      if( vi ) {
+      if( !firstVisual )
+          firstVisual = vi;
+      OSL_TRACE("trying VisualID %08X", vi->visualid);
+          fbconfigs = glXGetFBConfigs (GLWin.dpy, GLWin.screen, &nfbconfigs);
+          for ( ; i < nfbconfigs; i++)
+          {
+              visinfo = glXGetVisualFromFBConfig (GLWin.dpy, fbconfigs[i]);
+              if( !visinfo || visinfo->visualid != vi->visualid )
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i], GLX_DRAWABLE_TYPE, &value);
+              if (!(value & GLX_PIXMAP_BIT))
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
+                                    GLX_BIND_TO_TEXTURE_TARGETS_EXT,
+                                    &value);
+              if (!(value & GLX_TEXTURE_2D_BIT_EXT))
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
+                                    GLX_BIND_TO_TEXTURE_RGB_EXT,
+                                    &value);
+              if (value == FALSE)
+                  continue;
+
+              glXGetFBConfigAttrib (GLWin.dpy, fbconfigs[i],
+                                    GLX_BIND_TO_MIPMAP_TEXTURE_EXT,
+                                    &value);
+              if (value == FALSE)
+                  continue;
+
+              /* TODO: handle non Y inverted cases */
+              break;
+          }
+
+          if( i != nfbconfigs || ( firstVisual && pAttributeTable[1] == NULL ) ) {
+          if( i != nfbconfigs ) {
+          vi = glXGetVisualFromFBConfig( GLWin.dpy, fbconfigs[i] );
+          mbHasTFPVisual = true;
+          OSL_TRACE("found visual suitable for texture_from_pixmap");
+          } else {
+          vi = firstVisual;
+          mbHasTFPVisual = false;
+          OSL_TRACE("did not find visual suitable for texture_from_pixmap, using %08X", vi->visualid);
+          }
+#else
+      if( vi ) {
+#endif
+              SystemWindowData winData;
+              winData.nSize = sizeof(winData);
+          OSL_TRACE("using VisualID %08X", vi->visualid);
+              winData.pVisual = (void*)(vi->visual);
+              pWindow=new SystemChildWindow(pPWindow, 0, &winData, FALSE);
+              pChildSysData = pWindow->GetSystemData();
+              if( pChildSysData ) {
+                  break;
+              } else {
+                  delete pWindow, pWindow=NULL;
+              }
+          }
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+      }
+#endif
+
+        ++pAttributeTable;
+      }
+#endif
+
+#if defined( WNT ) 
+      const SystemEnvData* pChildSysData = NULL;
+      SystemWindowData winData;
+      winData.nSize = sizeof(winData);
+      pWindow=new SystemChildWindow(pPWindow, 0, &winData, FALSE);
+      pChildSysData = pWindow->GetSystemData();
+#endif            
+
+      if( pWindow )
+      {
+      pWindow->SetMouseTransparent( TRUE );
+      pWindow->SetParentClipMode( PARENTCLIPMODE_NOCLIP );
+      pWindow->EnableEraseBackground( FALSE );
+      pWindow->SetControlForeground();
+      pWindow->SetControlBackground();
+      pWindow->EnablePaint(FALSE);
+#if defined( WNT ) 
+        GLWin.hWnd = sysData->hWnd;
+#elif defined( UNX )
+        GLWin.dpy = reinterpret_cast<unx::Display*>(pChildSysData->pDisplay);
+        GLWin.win = pChildSysData->aWindow;
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    if( mbHasTFPVisual )
+        GLWin.fbc = fbconfigs[i];
+#endif
+    GLWin.vi = vi;
+    GLWin.GLXExtensions = unx::glXQueryExtensionsString( GLWin.dpy, GLWin.screen );
+    OSL_TRACE("available GLX extensions: %s", GLWin.GLXExtensions);
+#endif
+
+    return true;
+    }
+
+    return false;
+}
+
+bool OGLTransitionerImpl::initWindowFromSlideShowView( const Reference< presentation::XSlideShowView >& xView )
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed())
+        return false;
+
+    mxView.set( xView, UNO_QUERY );
+    if( !mxView.is() )
+    return false;
+
+    /// take the XSlideShowView and extract the parent window from it. see viewmediashape.cxx
+    uno::Reference< rendering::XCanvas > xCanvas(mxView->getCanvas(), uno::UNO_QUERY_THROW);
+    uno::Sequence< uno::Any > aDeviceParams;
+    ::canvas::tools::getDeviceInfo( xCanvas, aDeviceParams );
+
+    ::rtl::OUString aImplName;
+    aDeviceParams[ 0 ] >>= aImplName;
+
+    sal_Int64 aVal = 0;
+    aDeviceParams[1] >>= aVal;
+    if( !createWindow( reinterpret_cast< Window* >( aVal ) ) )
+    return false;
+
+    awt::Rectangle aCanvasArea = mxView->getCanvasArea();
+    pWindow->SetPosSizePixel(aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
+    GLWin.Width = aCanvasArea.Width;
+    GLWin.Height = aCanvasArea.Height;
+    OSL_TRACE("canvas area: %d,%d - %dx%d", aCanvasArea.X, aCanvasArea.Y, aCanvasArea.Width, aCanvasArea.Height);
+
+#if defined( WNT ) 
+        GLWin.hDC = GetDC(GLWin.hWnd);
+#elif defined( UNX )
+    GLWin.ctx = glXCreateContext(GLWin.dpy,
+                                 GLWin.vi,
+                                 0,
+                                 GL_TRUE);
+    if( GLWin.ctx == NULL ) {
+    OSL_TRACE("unable to create GLX context");
+    return false;
+    }
+#endif
+
+#if defined( WNT ) 
+    PIXELFORMATDESCRIPTOR PixelFormatFront =					// PixelFormat Tells Windows How We Want Things To Be
+    {
+        sizeof(PIXELFORMATDESCRIPTOR),
+        1,								// Version Number
+        PFD_DRAW_TO_WINDOW |
+        PFD_SUPPORT_OPENGL |
+        PFD_DOUBLEBUFFER,
+        PFD_TYPE_RGBA,					// Request An RGBA Format
+        (BYTE)32,						// Select Our Color Depth
+        0, 0, 0, 0, 0, 0,				// Color Bits Ignored
+        0,								// No Alpha Buffer
+        0,								// Shift Bit Ignored
+        0,								// No Accumulation Buffer
+        0, 0, 0, 0,						// Accumulation Bits Ignored
+        64,								// 32 bit Z-BUFFER
+        0,								// 0 bit stencil buffer
+        0,								// No Auxiliary Buffer
+        0,								// now ignored
+        0,								// Reserved
+        0, 0, 0							// Layer Masks Ignored
+    };
+    int WindowPix = ChoosePixelFormat(GLWin.hDC,&PixelFormatFront);
+    SetPixelFormat(GLWin.hDC,WindowPix,&PixelFormatFront);
+    GLWin.hRC  = wglCreateContext(GLWin.hDC);
+    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
+#elif defined( UNX )
+    if( !glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx ) ) {
+        OSL_TRACE("unable to select current GLX context");
+        return false;
+    }
+
+    int glxMinor, glxMajor;
+    mnGLXVersion = 0;
+    if( glXQueryVersion( GLWin.dpy, &glxMajor, &glxMinor ) )
+      mnGLXVersion = glxMajor + 0.1*glxMinor;
+    OSL_TRACE("available GLX version: %f", mnGLXVersion);
+
+    GLWin.GLExtensions = glGetString( GL_EXTENSIONS );
+    OSL_TRACE("available GL  extensions: %s", GLWin.GLExtensions);
+
+    mbTextureFromPixmap = GLWin.HasGLXExtension( "GLX_EXT_texture_from_pixmap" );
+    mbGenerateMipmap = GLWin.HasGLExtension( "GL_SGIS_generate_mipmap" );
+
+    if( GLWin.HasGLXExtension("GLX_SGI_swap_control" ) ) {
+        // enable vsync
+        typedef GLint (*glXSwapIntervalProc)(GLint);
+        glXSwapIntervalProc glXSwapInterval = (glXSwapIntervalProc) unx::glXGetProcAddress( (const GLubyte*) "glXSwapIntervalSGI" );
+        if( glXSwapInterval ) {
+        int (*oldHandler)(unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/);
+
+        // replace error handler temporarily
+        oldHandler = unx::XSetErrorHandler( oglErrorHandler );
+
+        errorTriggered = false;
+
+        glXSwapInterval( 1 );
+
+        // sync so that we possibly get an XError
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        if( errorTriggered )
+            OSL_TRACE("error when trying to set swap interval, NVIDIA or Mesa bug?");
+        else
+            OSL_TRACE("set swap interval to 1 (enable vsync)");
+
+        // restore the error handler
+        unx::XSetErrorHandler( oldHandler );
+        }
+    }
+#endif
+
+    glEnable(GL_CULL_FACE);
+    glCullFace(GL_BACK);
+    glClearColor (0, 0, 0, 0);
+    glClear(GL_COLOR_BUFFER_BIT);
+#if defined( WNT ) 
+    SwapBuffers(GLWin.hDC);
+#elif defined( UNX )
+    unx::glXSwapBuffers(GLWin.dpy, GLWin.win);
+#endif
+   
+    glEnable(GL_LIGHTING);
+    GLfloat light_direction[] = { 0.0 , 0.0 , 1.0 };
+    GLfloat materialDiffuse[] = { 1.0 , 1.0 , 1.0 , 1.0};
+    glLightfv(GL_LIGHT0, GL_SPOT_DIRECTION, light_direction);
+    glMaterialfv(GL_FRONT,GL_DIFFUSE,materialDiffuse);
+    glEnable(GL_LIGHT0);
+    glEnable(GL_NORMALIZE);
+
+    if( LeavingBytes.hasElements() && EnteringBytes.hasElements())
+       GLInitSlides();//we already have uninitialized slides, let's initialize 
+
+    if( pTransition && pTransition->mnRequiredGLVersion <= cnGLVersion )
+        pTransition->prepare( GLleavingSlide, GLenteringSlide );
+
+    return true;
+}
+
+void OGLTransitionerImpl::setSlides( const uno::Reference< rendering::XBitmap >& xLeavingSlide, 
+                                     const uno::Reference< rendering::XBitmap >& xEnteringSlide )
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed())
+        return;
+        
+    mxLeavingBitmap.set( xLeavingSlide , UNO_QUERY_THROW );
+    mxEnteringBitmap.set( xEnteringSlide , UNO_QUERY_THROW );
+    Reference< XFastPropertySet > xLeavingSet( xLeavingSlide , UNO_QUERY );
+    Reference< XFastPropertySet > xEnteringSet( xEnteringSlide , UNO_QUERY );
+
+    geometry::IntegerRectangle2D SlideRect;
+    SlideSize = mxLeavingBitmap->getSize();
+    SlideRect.X1 = 0;
+    SlideRect.X2 = SlideSize.Width;
+    SlideRect.Y1 = 0;
+    SlideRect.Y2 = SlideSize.Height;
+
+    OSL_TRACE("leaving bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
+    SlideSize = mxEnteringBitmap->getSize();
+    OSL_TRACE("entering bitmap area: %dx%d", SlideSize.Width, SlideSize.Height);
+
+#ifdef UNX
+    unx::glXWaitGL();
+    XSync(GLWin.dpy, false);
+#endif
+
+#ifdef DEBUG
+    t1 = microsec_clock::local_time();
+#endif
+
+    mbUseLeavingPixmap = false;
+    mbUseEnteringPixmap = false;
+
+#ifdef UNX
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+
+    if( mnGLXVersion >= 1.2999 && mbTextureFromPixmap && xLeavingSet.is() && xEnteringSet.is() && mbHasTFPVisual ) {
+    Sequence< Any > leaveArgs;
+    Sequence< Any > enterArgs;
+    if( (xLeavingSet->getFastPropertyValue( 1 ) >>= leaveArgs) &&
+        (xEnteringSet->getFastPropertyValue( 1 ) >>= enterArgs) ) {
+        OSL_TRACE ("pixmaps available");
+
+        sal_Int32 depth;
+
+        leaveArgs[0] >>= mbFreeLeavingPixmap;
+        enterArgs[0] >>= mbFreeEnteringPixmap;
+        leaveArgs[1] >>= maLeavingPixmap;
+        enterArgs[1] >>= maEnteringPixmap;
+        leaveArgs[2] >>= depth;
+
+        int pixmapAttribs[] = { GLX_TEXTURE_TARGET_EXT, GLX_TEXTURE_2D_EXT,
+                    GLX_TEXTURE_FORMAT_EXT, GLX_TEXTURE_FORMAT_RGB_EXT,
+                    GLX_MIPMAP_TEXTURE_EXT, True,
+                    None };
+
+
+        // sync so that we possibly get an pending XError, before we set our handler.
+        // this way we will not miss any error from other code
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        int (*oldHandler)(unx::Display* /*dpy*/, unx::XErrorEvent* /*evnt*/);
+
+        // replace error handler temporarily
+        oldHandler = unx::XSetErrorHandler( oglErrorHandler );
+
+        errorTriggered = false;
+        LeavingPixmap = glXCreatePixmap( GLWin.dpy, GLWin.fbc, maLeavingPixmap, pixmapAttribs );
+
+        // sync so that we possibly get an XError
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        if( !errorTriggered )
+        mbUseLeavingPixmap = true;
+        else {
+        OSL_TRACE("XError triggered");
+        if( mbFreeLeavingPixmap ) {
+            unx::XFreePixmap( GLWin.dpy, maLeavingPixmap );
+            mbFreeLeavingPixmap = false;
+        }
+        errorTriggered = false;
+        }
+          
+        EnteringPixmap = glXCreatePixmap( GLWin.dpy, GLWin.fbc, maEnteringPixmap, pixmapAttribs );
+
+        // sync so that we possibly get an XError
+        unx::glXWaitGL();
+        XSync(GLWin.dpy, false);
+
+        OSL_TRACE("created glx pixmap %p and %p depth: %d", LeavingPixmap, EnteringPixmap, depth);
+        if( !errorTriggered )
+        mbUseEnteringPixmap = true;
+        else {
+        OSL_TRACE("XError triggered");
+        if( mbFreeEnteringPixmap ) {
+            unx::XFreePixmap( GLWin.dpy, maEnteringPixmap );
+            mbFreeEnteringPixmap = false;
+        }
+        }
+
+        // restore the error handler
+        unx::XSetErrorHandler( oldHandler );
+    }
+    }
+
+#endif
+#endif
+    if( !mbUseLeavingPixmap )
+    LeavingBytes = mxLeavingBitmap->getData(SlideBitmapLayout,SlideRect);
+    if( !mbUseEnteringPixmap )
+    EnteringBytes = mxEnteringBitmap->getData(SlideBitmapLayout,SlideRect);
+
+// TODO    
+#ifdef UNX
+    if(GLWin.ctx)//if we have a rendering context, let's init the slides
+#endif
+    GLInitSlides();
+
+    OSL_ENSURE(SlideBitmapLayout.PlaneStride == 0,"only handle no plane stride now");
+
+#ifdef UNX
+    /* flush & sync */
+    unx::glXWaitGL();
+    XSync( GLWin.dpy, false );
+
+    // synchronized X still gives us much smoother play
+    // I suspect some issues in above code in slideshow
+    // synchronize whole transition for now
+    XSynchronize( GLWin.dpy, true );
+    mbRestoreSync = true;
+#endif
+}
+
+void OGLTransitionerImpl::createTexture( unsigned int* texID,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+                     unx::GLXPixmap pixmap,
+                     bool usePixmap,
+#endif
+                     bool useMipmap,
+                     uno::Sequence<sal_Int8>& data,
+                     const OGLFormat* pFormat )
+{
+    glDeleteTextures( 1, texID );
+    glGenTextures( 1, texID );
+    glBindTexture( GL_TEXTURE_2D, *texID );
+    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT );
+    glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT );
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::PFNGLXBINDTEXIMAGEEXTPROC myglXBindTexImageEXT = (unx::PFNGLXBINDTEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXBindTexImageEXT" );
+
+    if( usePixmap ) {
+      if( mbGenerateMipmap )
+          glTexParameteri( GL_TEXTURE_2D, GL_GENERATE_MIPMAP_SGIS, True);
+      myglXBindTexImageEXT (GLWin.dpy, pixmap, GLX_FRONT_LEFT_EXT, NULL);
+      if( mbGenerateMipmap && useMipmap ) {
+          OSL_TRACE("use mipmaps");
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
+      } else {
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
+          glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
+      }
+    } else {
+#endif
+    if( !pFormat )
+    {
+        // force-convert color to ARGB8888 int color space  
+        uno::Sequence<sal_Int8> tempBytes(
+            SlideBitmapLayout.ColorSpace->convertToIntegerColorSpace(
+                data,
+                canvas::tools::getStdColorSpace()));
+        gluBuild2DMipmaps(GL_TEXTURE_2D, 
+                          4, 
+                          SlideSize.Width, 
+                          SlideSize.Height, 
+                          GL_RGBA, 
+                          GL_UNSIGNED_BYTE,
+                          &tempBytes[0]);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_LINEAR);
+    glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_LINEAR_MIPMAP_LINEAR); //TRILINEAR FILTERING
+
+        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
+    GLfloat largest_supported_anisotropy;
+    glGetFloatv(GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy);
+    glTexParameterf(GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy);
+    } else {
+    if( pTransition && !cbBrokenTexturesATI && !useMipmap) {
+        glTexImage2D( GL_TEXTURE_2D, 0, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, 0, pFormat->eFormat, pFormat->eType, &data[0] );
+        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER,GL_NEAREST);
+        glTexParameteri(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER,GL_NEAREST);
+    } else {
+        gluBuild2DMipmaps( GL_TEXTURE_2D, pFormat->nInternalFormat, SlideSize.Width, SlideSize.Height, pFormat->eFormat, pFormat->eType, &data[0] );
+        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR );
+        glTexParameteri( GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR_MIPMAP_LINEAR ); //TRILINEAR FILTERING
+
+        //anistropic filtering (to make texturing not suck when looking at polygons from oblique angles)
+        GLfloat largest_supported_anisotropy;
+        glGetFloatv( GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT, &largest_supported_anisotropy );
+        glTexParameterf( GL_TEXTURE_2D, GL_TEXTURE_MAX_ANISOTROPY_EXT, largest_supported_anisotropy );
+    }
+    }
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    }
+#endif
+    OSL_ENSURE(glIsTexture(*texID), "Can't generate Leaving slide textures in OpenGL");
+}
+
+void OGLTransitionerImpl::prepareEnvironment()
+{
+    glMatrixMode(GL_PROJECTION);
+    glLoadIdentity();
+    double EyePos(10.0);
+    double RealF(1.0);
+    double RealN(-1.0);
+    double RealL(-1.0);
+    double RealR(1.0);
+    double RealB(-1.0);
+    double RealT(1.0);
+    double ClipN(EyePos+5.0*RealN);
+    double ClipF(EyePos+15.0*RealF);
+    double ClipL(RealL*8.0);
+    double ClipR(RealR*8.0);
+    double ClipB(RealB*8.0);
+    double ClipT(RealT*8.0);
+    //This scaling is to take the plane with BottomLeftCorner(-1,-1,0) and TopRightCorner(1,1,0) and map it to the screen after the perspective division.
+    glScaled( 1.0 / ( ( ( RealR * 2.0 * ClipN ) / ( EyePos * ( ClipR - ClipL ) ) ) - ( ( ClipR + ClipL ) / ( ClipR - ClipL ) ) ),
+              1.0 / ( ( ( RealT * 2.0 * ClipN ) / ( EyePos * ( ClipT - ClipB ) ) ) - ( ( ClipT + ClipB ) / ( ClipT - ClipB ) ) ),
+              1.0 );
+    glFrustum(ClipL,ClipR,ClipB,ClipT,ClipN,ClipF);
+    glMatrixMode(GL_MODELVIEW);
+    glLoadIdentity();
+    glTranslated(0,0,-EyePos);
+}
+
+const OGLFormat* OGLTransitionerImpl::chooseFormats()
+{
+    const OGLFormat* pDetectedFormat=NULL;
+    uno::Reference<rendering::XIntegerBitmapColorSpace> xIntColorSpace(
+        SlideBitmapLayout.ColorSpace);
+
+    if( (xIntColorSpace->getType() == rendering::ColorSpaceType::RGB ||
+         xIntColorSpace->getType() == rendering::ColorSpaceType::SRGB) )
+    {
+        /* table for canvas->OGL format mapping. outer index is number
+           of color components (0:3, 1:4), then comes bits per pixel
+           (0:16, 1:24, 2:32), then channel ordering: (0:rgba, 1:bgra,
+           2:argb, 3:abgr)
+         */
+        static const OGLFormat lcl_RGB24[] = 
+        {
+            // 24 bit RGB
+            {3, GL_BGR, GL_UNSIGNED_BYTE},
+            {3, GL_RGB, GL_UNSIGNED_BYTE},
+            {3, GL_BGR, GL_UNSIGNED_BYTE},
+            {3, GL_RGB, GL_UNSIGNED_BYTE}
+        };
+
+#if defined(GL_VERSION_1_2) && defined(GLU_VERSION_1_3)
+        // more format constants available
+        static const OGLFormat lcl_RGB16[] = 
+        {
+            // 16 bit RGB
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5_REV},
+            {3, GL_RGB, GL_UNSIGNED_SHORT_5_6_5}
+        };
+
+        static const OGLFormat lcl_ARGB16_4[] = 
+        {
+            // 16 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_4_4_4_4},
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_4_4_4_4}
+        };
+
+        static const OGLFormat lcl_ARGB16_5[] = 
+        {
+            // 16 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_1_5_5_5_REV},
+            {4, GL_BGRA, GL_UNSIGNED_SHORT_5_5_5_1},
+            {4, GL_RGBA, GL_UNSIGNED_SHORT_5_5_5_1}
+        };
+
+        static const OGLFormat lcl_ARGB32[] = 
+        {
+            // 32 bit ARGB
+            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8_REV},
+            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8_REV},
+            {4, GL_BGRA, GL_UNSIGNED_INT_8_8_8_8},
+            {4, GL_RGBA, GL_UNSIGNED_INT_8_8_8_8}
+        };
+
+        const uno::Sequence<sal_Int8> aComponentTags(
+            xIntColorSpace->getComponentTags());
+        const uno::Sequence<sal_Int32> aComponentBitcounts(
+            xIntColorSpace->getComponentBitCounts());
+        const sal_Int32 nNumComponents( aComponentBitcounts.getLength() );
+        const sal_Int32 nBitsPerPixel( xIntColorSpace->getBitsPerPixel() );
+
+        // supported component ordering?
+        const int nComponentOrderIndex(
+            calcComponentOrderIndex(aComponentTags));
+        if( nComponentOrderIndex != -1 ) 
+        {
+            switch( nBitsPerPixel )
+            {
+                case 16:
+                    if( nNumComponents == 3 )
+                    {
+                        pDetectedFormat = &lcl_RGB16[nComponentOrderIndex];
+                    }
+                    else if( nNumComponents == 4 )
+                    {
+                        if( aComponentBitcounts[1] == 4 )
+                        {
+                            pDetectedFormat = &lcl_ARGB16_4[nComponentOrderIndex];
+                        }
+                        else if( aComponentBitcounts[1] == 5 )
+                        {
+                            pDetectedFormat = &lcl_ARGB16_5[nComponentOrderIndex];
+                        }
+                    }
+                    break;
+                case 24:
+                    if( nNumComponents == 3 )
+                    {
+                        pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
+                    }
+                    break;
+                case 32:
+                    pDetectedFormat = &lcl_ARGB32[nComponentOrderIndex];
+                    break;
+            }
+        }
+#else
+        const uno::Sequence<sal_Int8> aComponentTags(
+            xIntColorSpace->getComponentTags());
+        const int nComponentOrderIndex(calcComponentOrderIndex(aComponentTags));
+        if( aComponentTags.getLength() == 3 && 
+            nComponentOrderIndex != -1 && 
+            xIntColorSpace->getBitsPerPixel() == 24 )
+        {
+            pDetectedFormat = &lcl_RGB24[nComponentOrderIndex];
+        }
+#endif
+    }
+
+    return pDetectedFormat;
+}
+
+void OGLTransitionerImpl::GLInitSlides()
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed() || pTransition->mnRequiredGLVersion > cnGLVersion)
+        return;
+
+    prepareEnvironment();
+
+    const OGLFormat* pFormat = NULL;
+    if( !mbUseLeavingPixmap || !mbUseEnteringPixmap )
+    pFormat = chooseFormats();
+
+    createTexture( &GLleavingSlide,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+           LeavingPixmap,
+           mbUseLeavingPixmap,
+#endif
+           pTransition->mbUseMipMapLeaving,
+           LeavingBytes,
+           pFormat );
+
+    createTexture( &GLenteringSlide,
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+           EnteringPixmap,
+           mbUseEnteringPixmap,
+#endif
+           pTransition->mbUseMipMapEntering,
+           EnteringBytes,
+           pFormat );
+
+#ifdef UNX
+    unx::glXWaitGL();
+    XSync(GLWin.dpy, false);
+#endif
+
+#ifdef DEBUG
+    t2 = microsec_clock::local_time();
+    OSL_TRACE("textures created in: %s", to_simple_string( t2 - t1 ).c_str());
+#endif
+}
+
+void SAL_CALL OGLTransitionerImpl::update( double nTime ) throw (uno::RuntimeException)
+{
+#ifdef DEBUG
+    frame_count ++;
+    t3 = microsec_clock::local_time();
+    if( frame_count == 1 ) {
+    t5 = t3;
+    total_update = seconds (0);
+    }
+#endif
+    osl::MutexGuard const guard( m_aMutex );
+
+    if (isDisposed() || !cbGLXPresent || pTransition->mnRequiredGLVersion > cnGLVersion)
+        return;
+
+#ifdef WNT
+    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
+#endif
+#ifdef UNX
+    glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx );
+#endif
+
+    glEnable(GL_DEPTH_TEST);
+    glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
+
+    if(pTransition)
+    pTransition->display( nTime, GLleavingSlide, GLenteringSlide, 
+                              SlideSize.Width, SlideSize.Height,
+                              static_cast<double>(GLWin.Width),
+                              static_cast<double>(GLWin.Height) );
+
+#if defined( WNT ) 
+    SwapBuffers(GLWin.hDC);
+#elif defined( UNX )
+    unx::glXSwapBuffers(GLWin.dpy, GLWin.win);
+#endif
+    if( pWindow )
+        pWindow->Show();
+
+#ifdef UNX
+    /* flush & sync */
+    unx::glXWaitGL();
+    XSync( GLWin.dpy, false );
+#endif
+
+#ifdef DEBUG
+    t4 = microsec_clock::local_time();
+
+    OSL_TRACE("update time: %f", nTime);
+    OSL_TRACE("update took: %s", to_simple_string( t4 - t3 ).c_str());
+    total_update += (t4 - t3);
+#endif
+}
+
+void SAL_CALL OGLTransitionerImpl::viewChanged( const Reference< presentation::XSlideShowView >& rView,
+                        const Reference< rendering::XBitmap >& rLeavingBitmap,
+                        const Reference< rendering::XBitmap >& rEnteringBitmap )
+    throw (uno::RuntimeException)
+{
+    OSL_TRACE("transitioner: view changed");
+
+    disposeTextures();
+    disposeContextAndWindow();
+
+    initWindowFromSlideShowView( rView );
+    setSlides( rLeavingBitmap, rEnteringBitmap );
+}
+
+void OGLTransitionerImpl::disposeContextAndWindow()
+{
+#if defined( WNT )
+    if (GLWin.hRC)
+    {
+    wglMakeCurrent( GLWin.hDC, 0 );		// kill Device Context
+    wglDeleteContext( GLWin.hRC );		// Kill Render Context
+    ReleaseDC( GLWin.hWnd, GLWin.hDC );         // Release Window
+    }
+#elif defined( UNX )
+    if(GLWin.ctx)
+    {
+    glXMakeCurrent(GLWin.dpy, None, NULL);
+    if( glGetError() != GL_NO_ERROR ) {
+        OSL_TRACE("glError: %s", (char *)gluErrorString(glGetError()));
+    }
+    glXDestroyContext(GLWin.dpy, GLWin.ctx);
+    GLWin.ctx = NULL;
+    }
+#endif
+    if( pWindow ) {
+    delete pWindow;
+    pWindow = NULL;
+    GLWin.win = 0;
+    }
+}
+
+void OGLTransitionerImpl::disposeTextures()
+{
+#ifdef WNT
+    wglMakeCurrent(GLWin.hDC,GLWin.hRC);
+#endif
+#ifdef UNX
+    glXMakeCurrent( GLWin.dpy, GLWin.win, GLWin.ctx );
+#endif
+
+#if defined( GLX_VERSION_1_3 ) && defined( GLX_EXT_texture_from_pixmap )
+    unx::PFNGLXRELEASETEXIMAGEEXTPROC myglXReleaseTexImageEXT = (unx::PFNGLXRELEASETEXIMAGEEXTPROC) unx::glXGetProcAddress( (const GLubyte*) "glXReleaseTexImageEXT" );
+    if( mbUseLeavingPixmap ) {
+
+    myglXReleaseTexImageEXT( GLWin.dpy, LeavingPixmap, GLX_FRONT_LEFT_EXT );
+    glXDestroyGLXPixmap( GLWin.dpy, LeavingPixmap );
+    LeavingPixmap = 0;
+    if( mbFreeLeavingPixmap ) {
+        unx::XFreePixmap( GLWin.dpy, maLeavingPixmap );
+        mbFreeLeavingPixmap = false;
+        maLeavingPixmap = 0;
+    }
+    }
+    if( mbUseEnteringPixmap ) {
+    myglXReleaseTexImageEXT( GLWin.dpy, EnteringPixmap, GLX_FRONT_LEFT_EXT );
+    glXDestroyGLXPixmap( GLWin.dpy, EnteringPixmap );
+    EnteringPixmap = 0;
+    if( mbFreeEnteringPixmap ) {
+        unx::XFreePixmap( GLWin.dpy, maEnteringPixmap );
+        mbFreeEnteringPixmap = false;
+        maEnteringPixmap = 0;
+    }
+    }
+#endif
+
+    if( !mbUseLeavingPixmap ) {
+    glDeleteTextures(1,&GLleavingSlide);
+    GLleavingSlide = 0;
+    }
+    if( !mbUseEnteringPixmap ) {
+    glDeleteTextures(1,&GLenteringSlide);
+    GLleavingSlide = 0;
+    }
+
+    mbUseLeavingPixmap = false;
+    mbUseEnteringPixmap = false;
+}
+
+// we are about to be disposed (someone call dispose() on us)
+void OGLTransitionerImpl::disposing()
+{
+    osl::MutexGuard const guard( m_aMutex );
+
+#ifdef DEBUG
+    OSL_TRACE("dispose %p\n", this);
+    if( frame_count ) {
+    t6 = microsec_clock::local_time();
+    time_duration duration = t6 - t5;
+    OSL_TRACE("whole transition (frames: %d) took: %s fps: %f time spent in updates: %s percentage of transition time: %f%%",
+          frame_count, to_simple_string( duration ).c_str(),
+          ((double)frame_count*1000000000.0)/duration.total_nanoseconds(),
+          to_simple_string( total_update ).c_str(),
+          100*(((double)total_update.total_nanoseconds())/((double)duration.total_nanoseconds()))
+        );
+    }
+#endif
+
+    if( pWindow ) {
+
+    disposeTextures();
+
+    if (pTransition)
+        pTransition->finish();
+
+#ifdef UNX
+    if( mbRestoreSync ) {
+        // try to reestablish synchronize state
+        char* sal_synchronize = getenv("SAL_SYNCHRONIZE");
+        XSynchronize( GLWin.dpy, sal_synchronize && *sal_synchronize == '1' );
+    }
+#endif
+
+    disposeContextAndWindow();
+    }
+
+    if (pTransition)
+    delete pTransition;
+
+    mxLeavingBitmap.clear();
+    mxEnteringBitmap.clear();
+    mxView.clear();
+}
+
+OGLTransitionerImpl::OGLTransitionerImpl(OGLTransitionImpl* pOGLTransition) : 
+    OGLTransitionerImplBase(m_aMutex), 
+    GLWin(),
+    GLleavingSlide( 0 ), 
+    GLenteringSlide( 0 ), 
+    pWindow( NULL ), 
+    mxView(),
+    EnteringBytes(),
+    LeavingBytes(),
+    mbRestoreSync( false ),
+    mbUseLeavingPixmap( false ),
+    mbUseEnteringPixmap( false ),
+    SlideBitmapLayout(),
+    SlideSize(),
+    pTransition(pOGLTransition)
+{
+#if defined( WNT )
+    GLWin.hWnd = 0;
+#elif defined( UNX )
+    GLWin.ctx = 0;
+#endif
+
+    DBG(frame_count = 0);
+}
+
+typedef cppu::WeakComponentImplHelper1<presentation::XTransitionFactory> OGLTransitionFactoryImplBase;
+
+class OGLTransitionFactoryImpl : private cppu::BaseMutex, public OGLTransitionFactoryImplBase
+{
+public:
+    explicit OGLTransitionFactoryImpl( const uno::Reference< uno::XComponentContext >& ) :
+        OGLTransitionFactoryImplBase(m_aMutex)
+    {}
+
+    // XTransitionFactory
+    virtual ::sal_Bool SAL_CALL hasTransition( ::sal_Int16 transitionType, ::sal_Int16 transitionSubType ) throw (uno::RuntimeException)
+    {
+        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
+            switch( transitionSubType )
+                {
+                case animations::TransitionSubType::ACROSS:
+                case animations::TransitionSubType::CORNERSOUT:
+                case animations::TransitionSubType::CIRCLE:
+                case animations::TransitionSubType::FANOUTHORIZONTAL:
+                case animations::TransitionSubType::CORNERSIN:  
+                case animations::TransitionSubType::LEFTTORIGHT:
+                case animations::TransitionSubType::TOPTOBOTTOM:
+                case animations::TransitionSubType::TOPRIGHT:
+                case animations::TransitionSubType::TOPLEFT:
+                case animations::TransitionSubType::BOTTOMRIGHT:
+                case animations::TransitionSubType::BOTTOMLEFT:
+                case animations::TransitionSubType::TOPCENTER:
+                case animations::TransitionSubType::RIGHTCENTER:
+                case animations::TransitionSubType::BOTTOMCENTER:
+                    return sal_True;
+
+                default:
+                    return sal_False;
+                }
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
+            return sal_True;
+        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
+            return sal_True;
+        } else
+            return sal_False;
+    }
+
+    virtual uno::Reference< presentation::XTransition > SAL_CALL createTransition( 
+        ::sal_Int16                                           transitionType, 
+        ::sal_Int16                                           transitionSubType, 
+        const uno::Reference< presentation::XSlideShowView >& view, 
+        const uno::Reference< rendering::XBitmap >&           leavingBitmap, 
+        const uno::Reference< rendering::XBitmap >&           enteringBitmap )
+    throw (uno::RuntimeException)
+    {
+        if( !hasTransition( transitionType, transitionSubType ) )
+            return uno::Reference< presentation::XTransition >();
+
+        bool bGLXPresent = OGLTransitionerImpl::initialize( view );
+
+        if( OGLTransitionerImpl::cbMesa && (
+            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) ||
+            ( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) ||
+            ( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) ) )
+            return uno::Reference< presentation::XTransition >();
+            
+
+        OGLTransitionImpl* pTransition = NULL;
+
+        if( transitionType == animations::TransitionType::MISCSHAPEWIPE ) {
+            pTransition = new OGLTransitionImpl();
+            switch( transitionSubType )
+                {
+                case animations::TransitionSubType::ACROSS:
+                    pTransition->makeNByMTileFlip(8,6);
+                    break;   
+                case animations::TransitionSubType::CORNERSOUT:
+                    pTransition->makeOutsideCubeFaceToLeft();
+                    break;            
+                case animations::TransitionSubType::CIRCLE:
+                    pTransition->makeRevolvingCircles(8,128);
+                    break;
+                case animations::TransitionSubType::FANOUTHORIZONTAL:
+                    pTransition->makeHelix(20);
+                    break;
+                case animations::TransitionSubType::CORNERSIN:  
+                    pTransition->makeInsideCubeFaceToLeft();
+                    break;
+                case animations::TransitionSubType::LEFTTORIGHT:
+                    pTransition->makeFallLeaving();
+                    break;
+                case animations::TransitionSubType::TOPTOBOTTOM:
+                    pTransition->makeTurnAround();
+                    break;
+                case animations::TransitionSubType::TOPRIGHT:
+                    pTransition->makeTurnDown();
+                    break;
+                case animations::TransitionSubType::TOPLEFT:
+                    pTransition->makeIris();
+                    break;
+                case animations::TransitionSubType::BOTTOMRIGHT:
+                    pTransition->makeRochade();
+                    break;
+                case animations::TransitionSubType::BOTTOMLEFT:
+                    pTransition->makeVenetianBlinds( true, 8 );
+                    break;
+                case animations::TransitionSubType::TOPCENTER:
+                    pTransition->makeVenetianBlinds( false, 6 );
+                    break;
+                case animations::TransitionSubType::RIGHTCENTER:
+                    pTransition->makeStatic();
+                    break;
+                case animations::TransitionSubType::BOTTOMCENTER:
+                    pTransition->makeDissolve();
+                    break;
+                }
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::CROSSFADE ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeFadeSmoothly();
+        } else if( transitionType == animations::TransitionType::FADE && transitionSubType == animations::TransitionSubType::FADEOVERCOLOR ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeFadeThroughBlack();
+        } else if( transitionType == animations::TransitionType::IRISWIPE && transitionSubType == animations::TransitionSubType::DIAMOND ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeDiamond();
+        } else if( transitionType == animations::TransitionType::ZOOM && transitionSubType == animations::TransitionSubType::ROTATEIN ) {
+            pTransition = new OGLTransitionImpl();
+            pTransition->makeNewsflash();
+        }
+
+        rtl::Reference<OGLTransitionerImpl> xRes(
+            new OGLTransitionerImpl(pTransition) );
+        if( bGLXPresent ) {
+            if( !xRes->initWindowFromSlideShowView(view))
+                return uno::Reference< presentation::XTransition >();
+            xRes->setSlides(leavingBitmap,enteringBitmap);
+        }
+
+        return uno::Reference<presentation::XTransition>(xRes.get());
+    }
+};
+
+}
+
+namespace sdecl = comphelper::service_decl;
+#if defined (__GNUC__) && (__GNUC__ == 3 && __GNUC_MINOR__ <= 3)
+ sdecl::class_<OGLTransitionFactoryImpl> serviceImpl;
+ const sdecl::ServiceDecl OGLTransitionFactoryDecl(
+     serviceImpl,
+#else
+ const sdecl::ServiceDecl OGLTransitionFactoryDecl(
+     sdecl::class_<OGLTransitionFactoryImpl>(),
+#endif
+    "com.sun.star.comp.presentation.OGLTransitionFactory",
+    "com.sun.star.presentation.TransitionFactory" );
+
+// The C shared lib entry points
+COMPHELPER_SERVICEDECL_EXPORTS1(OGLTransitionFactoryDecl)
diff --git slideshow/source/engine/OGLTrans/win/makefile.mk slideshow/source/engine/OGLTrans/win/makefile.mk
new file mode 100644
index 0000000..ad97afa
--- /dev/null
+++ slideshow/source/engine/OGLTrans/win/makefile.mk
@@ -0,0 +1,76 @@
+#*************************************************************************
+#
+# DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+# 
+# Copyright 2008 by Sun Microsystems, Inc.
+#
+# OpenOffice.org - a multi-platform office productivity suite
+#
+# $RCSfile: makefile.mk,v $
+#
+# $Revision: 1.5.12.1 $
+#
+# This file is part of OpenOffice.org.
+#
+# OpenOffice.org is free software: you can redistribute it and/or modify
+# it under the terms of the GNU Lesser General Public License version 3
+# only, as published by the Free Software Foundation.
+#
+# OpenOffice.org is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU Lesser General Public License version 3 for more details
+# (a copy is included in the LICENSE file that accompanied this code).
+#
+# You should have received a copy of the GNU Lesser General Public License
+# version 3 along with OpenOffice.org.  If not, see
+# <http://www.openoffice.org/license.html>
+# for a copy of the LGPLv3 License.
+#
+#*************************************************************************
+
+PRJ=..$/..$/..$/..
+
+PRJNAME=slideshow
+TARGET=OGLTrans
+ENABLE_EXCEPTIONS=TRUE
+
+# --- Settings -----------------------------------------------------------
+
+.INCLUDE :      settings.mk
+.INCLUDE : $(PRJ)$/util$/makefile.pmk
+
+# --- Nothing to do if we're compiling with --disable-opengl -----------
+.IF "$(ENABLE_OPENGL)" != "TRUE" || "$(OS)" != "WNT"
+@all:
+    @echo "Building without OpenGL Transitions..."
+.ENDIF
+
+# --- Common ----------------------------------------------------------
+
+SLOFILES = \
+    $(SLO)$/OGLTrans_TransitionImpl_$(OS).obj \
+    $(SLO)$/OGLTrans_Shaders_$(OS).obj \
+    $(SLO)$/OGLTrans_TransitionerImpl_$(OS).obj
+
+SHL1TARGET=$(TARGET).uno
+
+SHL1STDLIBS= $(SALLIB) $(VCLLIB) $(CPPULIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(CANVASTOOLSLIB)
+
+SHL1STDLIBS += \
+    opengl32.lib \
+    glu32.lib \
+    gdi32.lib
+
+SHL1IMPLIB=i$(TARGET)
+SHL1LIBS=$(SLB)$/$(TARGET).lib
+SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+
+SHL1VERSIONMAP=../exports.map
+
+DEF1NAME=$(SHL1TARGET)
+DEF1EXPORTFILE=../exports.dxp
+
+# ==========================================================================
+
+.INCLUDE :	target.mk
diff --git slideshow/source/engine/color.cxx slideshow/source/engine/color.cxx
index 83d030e..08e5fea 100644
--- slideshow/source/engine/color.cxx
+++ slideshow/source/engine/color.cxx
@@ -268,6 +268,19 @@ namespace slideshow
             return RGBColor( aColor.mnRed, aColor.mnGreen, aColor.mnBlue );
         }
 
+        RGBColor::RGBColor(const RGBColor& rLHS)
+        {
+            RGBColor(rLHS.getRed(), rLHS.getGreen(), rLHS.getBlue());		
+        }
+
+        RGBColor& RGBColor::operator=( const RGBColor& rLHS ){
+
+            maRGBTriple.mnRed = rLHS.getRed();
+            maRGBTriple.mnGreen = rLHS.getGreen();
+            maRGBTriple.mnBlue = rLHS.getBlue();
+            return *this;
+        }        
+
         HSLColor operator+( const HSLColor& rLHS, const HSLColor& rRHS )
         {
             return HSLColor( rLHS.getHue() + rRHS.getHue(),
diff --git slideshow/source/engine/eventmultiplexer.cxx slideshow/source/engine/eventmultiplexer.cxx
index 7c77568..2dbe4f5 100644
--- slideshow/source/engine/eventmultiplexer.cxx
+++ slideshow/source/engine/eventmultiplexer.cxx
@@ -262,8 +262,7 @@ struct EventMultiplexerImpl
         std::vector<ShapeCursorEventHandlerSharedPtr> >   ImplShapeCursorHandlers;
     typedef ThreadUnsafeListenerContainer<
         PrioritizedHandlerEntry<HyperlinkHandler>,
-        std::vector<
-            PrioritizedHandlerEntry<HyperlinkHandler> > > ImplHyperLinkHandlers;
+        std::vector<PrioritizedHandlerEntry<HyperlinkHandler> > > ImplHyperLinkHandlers;
     
     template <typename XSlideShowViewFunc>
     void forEachView( XSlideShowViewFunc pViewMethod );
@@ -1065,12 +1064,48 @@ bool EventMultiplexer::notifyUserPaintColor( RGBColor const& rUserColor )
                     boost::cref(rUserColor)));
 }
 
+bool EventMultiplexer::notifyUserPaintStrokeWidth( double rUserStrokeWidth )
+{
+    return mpImpl->maUserPaintEventHandlers.applyAll(
+        boost::bind(&UserPaintEventHandler::widthChanged,
+            _1,
+                    rUserStrokeWidth));
+}
+//NELLE a regarder de plus prs
 bool EventMultiplexer::notifyUserPaintDisabled()
 {
     return mpImpl->maUserPaintEventHandlers.applyAll(
         boost::mem_fn(&UserPaintEventHandler::disable));
 }
 
+bool EventMultiplexer::notifySwitchPenMode(){
+    return mpImpl->maUserPaintEventHandlers.applyAll(
+        boost::mem_fn(&UserPaintEventHandler::switchPenMode));
+}
+
+bool EventMultiplexer::notifySwitchEraserMode(){
+    return mpImpl->maUserPaintEventHandlers.applyAll(
+        boost::mem_fn(&UserPaintEventHandler::switchEraserMode));
+}
+
+//adding erasing all ink features with UserPaintOverlay
+bool EventMultiplexer::notifyEraseAllInk( bool const& rEraseAllInk )
+{
+    return mpImpl->maUserPaintEventHandlers.applyAll(
+        boost::bind(&UserPaintEventHandler::eraseAllInkChanged,
+                    _1,
+                    boost::cref(rEraseAllInk)));
+}
+
+//adding erasing features with UserPaintOverlay	
+bool EventMultiplexer::notifyEraseInkWidth( sal_Int32 rEraseInkSize )
+{
+    return mpImpl->maUserPaintEventHandlers.applyAll(
+        boost::bind(&UserPaintEventHandler::eraseInkWidthChanged,
+                    _1,
+                    boost::cref(rEraseInkSize)));
+}
+    
 bool EventMultiplexer::notifyNextEffect()
 {
     return mpImpl->notifyNextEffect();
diff --git slideshow/source/engine/makefile.mk slideshow/source/engine/makefile.mk
index b064ad7..8acab48 100644
--- slideshow/source/engine/makefile.mk
+++ slideshow/source/engine/makefile.mk
@@ -41,6 +41,10 @@ ENABLE_EXCEPTIONS=TRUE
 .INCLUDE :	settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
+.IF "$(ENABLE_PRESENTER_EXTRA_UI)"=="YES"
+CDEFS+=-DENABLE_PRESENTER_EXTRA_UI
+.ENDIF
+
 # --- Common ----------------------------------------------------------
 
 ENVCFLAGS += -DBOOST_SPIRIT_USE_OLD_NAMESPACE
diff --git slideshow/source/engine/shapes/shapeimporter.cxx slideshow/source/engine/shapes/shapeimporter.cxx
index 9a7be9f..3494c5e 100644
--- slideshow/source/engine/shapes/shapeimporter.cxx
+++ slideshow/source/engine/shapes/shapeimporter.cxx
@@ -39,9 +39,22 @@
 #include <goodies/grfmgr.hxx>
 #include <unotools/ucbstreamhelper.hxx>
 #include <unotools/streamwrap.hxx>
+#include <basegfx/point/b2dpoint.hxx>
+#include <basegfx/polygon/b2dpolygon.hxx>
+#include <cppcanvas/basegfxfactory.hxx>
+#include <cppcanvas/polypolygon.hxx>
 #include <com/sun/star/awt/Rectangle.hpp>
 #include <com/sun/star/drawing/ColorMode.hpp>
 #include <com/sun/star/text/GraphicCrop.hpp>
+#include <com/sun/star/container/XNameContainer.hpp>
+#include <com/sun/star/drawing/PointSequenceSequence.hpp>
+#include <com/sun/star/drawing/PointSequence.hpp>
+#include <com/sun/star/lang/XMultiComponentFactory.hpp>
+#include <com/sun/star/drawing/XLayerSupplier.hpp>
+#include <com/sun/star/drawing/XLayerManager.hpp>
+#include <com/sun/star/container/XNameAccess.hpp>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/drawing/XDrawPagesSupplier.hpp>
 
 #include "drawshapesubsetting.hxx"
 #include "drawshape.hxx"
@@ -52,11 +65,13 @@
 #include "slideshowexceptions.hxx"
 #include "gdimtftools.hxx"
 #include "tools.hxx"
+#include "slideshowcontext.hxx"
 
 #include <boost/shared_ptr.hpp>
 #include <boost/scoped_ptr.hpp>
 
 using namespace com::sun::star;
+using namespace ::comphelper;
 
 namespace slideshow {
 namespace internal {
@@ -436,7 +451,8 @@ ShapeSharedPtr ShapeImporter::createShape(
 
 bool ShapeImporter::isSkip(
     uno::Reference<beans::XPropertySet> const& xPropSet,
-    rtl::OUString const& shapeType ) const
+    rtl::OUString const& shapeType,
+    uno::Reference< drawing::XLayer> const& xLayer )
 {
     // skip empty presentation objects:
     bool bEmpty = false;
@@ -448,6 +464,26 @@ bool ShapeImporter::isSkip(
         return true;
     }
     
+    //skip shapes which corresponds to annotations
+    if(xLayer.is())
+    {
+        rtl::OUString layerName;
+        uno::Reference<beans::XPropertySet> xPropLayerSet(
+                                                          xLayer, uno::UNO_QUERY );
+        const uno::Any& a(xPropLayerSet->getPropertyValue(rtl::OUString::createFromAscii("Name")) );
+        bool const bRet = (a >>= layerName);
+        if(bRet)
+        {
+            if( layerName.equals(rtl::OUString::createFromAscii("DrawnInSlideshow")))
+            {
+                //Transform shapes into PolyPolygons	
+                importPolygons(xPropSet);
+                
+                return true;
+            }
+        }
+    }
+    
     // don't export presentation placeholders on masterpage
     // they can be non empty when user edits the default texts
     if(mbConvertingMasterPage) 
@@ -465,6 +501,46 @@ bool ShapeImporter::isSkip(
     return false;
 }
 
+    
+void ShapeImporter::importPolygons(uno::Reference<beans::XPropertySet> const& xPropSet) {
+
+    drawing::PointSequenceSequence aRetval;
+    sal_Int32			nLineColor=0;
+    double				fLineWidth;
+    getPropertyValue( aRetval, xPropSet, OUSTR("PolyPolygon") );
+    getPropertyValue( nLineColor, xPropSet, OUSTR("LineColor") );
+    getPropertyValue( fLineWidth, xPropSet, OUSTR("LineWidth") );
+
+    drawing::PointSequence* pOuterSequence = aRetval.getArray();
+    awt::Point* pInnerSequence = pOuterSequence->getArray();
+    
+    ::basegfx::B2DPolygon aPoly;
+    basegfx::B2DPoint aPoint;
+    for( sal_Int32 nCurrPoly=0; nCurrPoly<pOuterSequence->getLength(); ++nCurrPoly )
+    {
+        aPoint.setX((*pInnerSequence).X);
+        aPoint.setY((*pInnerSequence).Y);
+        aPoly.append( aPoint );
+        *pInnerSequence++;
+    }
+    UnoViewVector::const_iterator aIter=(mrContext.mrViewContainer).begin();
+    UnoViewVector::const_iterator aEnd=(mrContext.mrViewContainer).end();
+    while(aIter != aEnd)
+    {
+        ::cppcanvas::PolyPolygonSharedPtr pPolyPoly(
+            ::cppcanvas::BaseGfxFactory::getInstance().createPolyPolygon( (*aIter)->getCanvas(),
+                                                                          aPoly ) );
+        if( pPolyPoly )
+        {
+                pPolyPoly->setRGBALineColor( unoColor2RGBColor( nLineColor ).getIntegerColor() );
+                pPolyPoly->setStrokeWidth(fLineWidth);
+                pPolyPoly->draw();
+                maPolygons.push_back(pPolyPoly);
+        }
+        aIter++;
+    }
+}
+    
 ShapeSharedPtr ShapeImporter::importBackgroundShape() // throw (ShapeLoadFailedException)
 {
     if( maShapesStack.empty() )
@@ -506,10 +582,23 @@ ShapeSharedPtr ShapeImporter::importShape() // throw (ShapeLoadFailedException)
                 throw ShapeLoadFailedException();
             }
 
+            //Retrieve the layer for the current shape
+            uno::Reference< drawing::XLayer > xDrawnInSlideshow;
+
+            uno::Reference< drawing::XLayerSupplier > xLayerSupplier(mxPagesSupplier, uno::UNO_QUERY);
+            if(xLayerSupplier.is())
+            {
+                uno::Reference< container::XNameAccess > xNameAccess = xLayerSupplier->getLayerManager();
+                
+                uno::Reference< drawing::XLayerManager > xLayerManager(xNameAccess, uno::UNO_QUERY);
+    
+           	    xDrawnInSlideshow = xLayerManager->getLayerForShape(xCurrShape);
+            }
+
             rtl::OUString const shapeType( xCurrShape->getShapeType() );
             
             // is this shape presentation-invisible?
-            if( !isSkip(xPropSet, shapeType) )
+            if( !isSkip(xPropSet, shapeType, xDrawnInSlideshow) )
             {
                 bIsGroupShape = shapeType.equalsAsciiL(
                     RTL_CONSTASCII_STRINGPARAM(
@@ -549,17 +638,28 @@ bool ShapeImporter::isImportDone() const
     return maShapesStack.empty();
 }
 
+PolyPolygonVector ShapeImporter::getPolygons()
+{
+    return maPolygons;
+}
+    
 ShapeImporter::ShapeImporter( uno::Reference<drawing::XDrawPage> const& xPage, 
                               uno::Reference<drawing::XDrawPage> const& xActualPage,
+                              uno::Reference<drawing::XDrawPagesSupplier> const& xPagesSupplier,
                               const SlideShowContext&                   rContext,
                               sal_Int32                                 nOrdNumStart,
                               bool                                      bConvertingMasterPage ) :
     mxPage( xActualPage ),
+    mxPagesSupplier( xPagesSupplier ),
     mrContext( rContext ),
+    maPolygons(),
     maShapesStack(),
     mnAscendingPrio( nOrdNumStart ),
     mbConvertingMasterPage( bConvertingMasterPage )
 {
+#ifndef ENABLE_PRESENTER_EXTRA_UI
+    (void)xPagesSupplier;
+#endif
     uno::Reference<drawing::XShapes> const xShapes(
         xPage, uno::UNO_QUERY_THROW );
     maShapesStack.push( XShapesEntry(xShapes) );
diff --git slideshow/source/engine/shapes/viewmediashape.cxx slideshow/source/engine/shapes/viewmediashape.cxx
index d0876d2..84b48c5 100644
--- slideshow/source/engine/shapes/viewmediashape.cxx
+++ slideshow/source/engine/shapes/viewmediashape.cxx
@@ -44,6 +44,9 @@
 #include <vcl/window.hxx>
 #include <vcl/javachild.hxx>
 #include <vcl/salbtype.hxx>
+#ifdef GSTREAMER
+#include <vcl/sysdata.hxx>
+#endif
 
 #include <basegfx/tools/canvastools.hxx>
 #include <basegfx/numeric/ftools.hxx>
@@ -148,7 +151,11 @@ namespace slideshow
                 mxPlayerWindow.clear();
             }
 
+#ifdef GSTREAMER
+            mpMediaWindow = ::std::auto_ptr< SystemChildWindow >();
+#else
             mpMediaWindow = ::std::auto_ptr< JavaChildWindow >();
+#endif
                         
             // shutdown player
             if( mxPlayer.is() )
@@ -299,7 +306,8 @@ namespace slideshow
                             aDeviceParams[ 0 ] >>= aImplName;
                         
                             if( aImplName.endsWithIgnoreAsciiCaseAsciiL( 
-                                    RTL_CONSTASCII_STRINGPARAM("VCL") ))
+                                    RTL_CONSTASCII_STRINGPARAM("VCL") ) || aImplName.endsWithIgnoreAsciiCaseAsciiL( 
+                                    RTL_CONSTASCII_STRINGPARAM("Cairo") ) )
                             {
                                 implInitializeVCLBasedPlayerWindow( rBounds, aDeviceParams );
                             }
@@ -405,6 +413,7 @@ namespace slideshow
         bool ViewMediaShape::implInitializeVCLBasedPlayerWindow( const ::basegfx::B2DRectangle&   rBounds,
                                                                  const uno::Sequence< uno::Any >& rVCLDeviceParams)
         {
+                    OSL_TRACE( "ViewMediaShape::implInitializeVCLBasedPlayerWindow" );
             if( !mpMediaWindow.get() && !rBounds.isEmpty() )
             {
                 try
@@ -426,28 +435,46 @@ namespace slideshow
                                                                     
                         if( !rRangePix.isEmpty() )
                         {
-                            uno::Sequence< uno::Any > 	aArgs( 2 );
+                            uno::Sequence< uno::Any > 	aArgs( 3 );
                             awt::Rectangle				aAWTRect( rRangePix.getMinX(),
                                                                   rRangePix.getMinY(),
                                                                     rRangePix.getMaxX() - rRangePix.getMinX(),
                                                                     rRangePix.getMaxY() - rRangePix.getMinY() );
 
+#ifdef GSTREAMER
+                                                        OSL_TRACE( "created sys child window for viewmediashape" );
+                            mpMediaWindow = ::std::auto_ptr< SystemChildWindow >( new SystemChildWindow( pWindow, WB_CLIPCHILDREN ) );
+#else
                             mpMediaWindow = ::std::auto_ptr< JavaChildWindow >( new JavaChildWindow( pWindow, WB_CLIPCHILDREN ) );
+#endif
                             mpMediaWindow->SetBackground( Color( COL_BLACK ) );
                             mpMediaWindow->SetPosSizePixel( Point( aAWTRect.X, 
                                                                    aAWTRect.Y ),
                                                             Size( aAWTRect.Width, 
                                                                   aAWTRect.Height ));
+                            mpMediaWindow->SetParentClipMode( PARENTCLIPMODE_NOCLIP );
+                            mpMediaWindow->EnableEraseBackground( FALSE );
+                            mpMediaWindow->EnablePaint( FALSE );
+                            mpMediaWindow->SetForwardKey( TRUE );
+                            mpMediaWindow->SetMouseTransparent( TRUE );
                             mpMediaWindow->Show();
                             
                             if( mxPlayer.is() )
                             {
+#ifndef GSTREAMER
                                 aArgs[ 0 ] = uno::makeAny( 
                                     sal::static_int_cast<sal_IntPtr>(
                                         mpMediaWindow->getParentWindowHandleForJava()) );
-                                
+#else
+                                                                aArgs[ 0 ] = uno::makeAny ( (sal_Int32) 0 );
+#endif
                                 aAWTRect.X = aAWTRect.Y = 0;
                                 aArgs[ 1 ] = uno::makeAny( aAWTRect );
+#ifdef GSTREAMER
+                                                                const SystemEnvData *pSystemData = mpMediaWindow->GetSystemData();
+                                                                OSL_TRACE( "xwindow id: %ld", pSystemData->aWindow );
+                                aArgs[ 2 ] = uno::makeAny( pSystemData->aWindow );
+#endif
                                 
                                 mxPlayerWindow.set( mxPlayer->createPlayerWindow( aArgs ) );
                                 
diff --git slideshow/source/engine/shapes/viewmediashape.hxx slideshow/source/engine/shapes/viewmediashape.hxx
index 4b26359..72b8767 100644
--- slideshow/source/engine/shapes/viewmediashape.hxx
+++ slideshow/source/engine/shapes/viewmediashape.hxx
@@ -40,6 +40,7 @@
 #include "viewlayer.hxx"
 
 class JavaChildWindow;
+class SystemChildWindow;
 
 namespace com { namespace sun { namespace star { namespace drawing {
     class XShape;
@@ -158,7 +159,11 @@ namespace slideshow
                                                     const ::com::sun::star::uno::Sequence< ::com::sun::star::uno::Any >& rDXDeviceParams );
             
             ViewLayerSharedPtr					  mpViewLayer;
+#ifdef GSTREAMER
+            ::std::auto_ptr< SystemChildWindow >	mpMediaWindow;
+#else
             ::std::auto_ptr< JavaChildWindow >    mpMediaWindow;
+#endif
             mutable ::com::sun::star::awt::Point  maWindowOffset;
             mutable ::basegfx::B2DRectangle       maBounds;
         
diff --git slideshow/source/engine/slide/slideimpl.cxx slideshow/source/engine/slide/slideimpl.cxx
index 6da4ef2..eeab76a 100644
--- slideshow/source/engine/slide/slideimpl.cxx
+++ slideshow/source/engine/slide/slideimpl.cxx
@@ -81,7 +81,7 @@
 #include <iterator>
 #include <algorithm>
 #include <functional>
-
+#include <iostream>
 
 using namespace ::com::sun::star;
 
@@ -101,6 +101,7 @@ class SlideImpl : public Slide,
 {
 public:
     SlideImpl( const uno::Reference<drawing::XDrawPage>& 		 xDrawPage,
+               const uno::Reference<drawing::XDrawPagesSupplier>&	 xDrawPages,
                const uno::Reference<animations::XAnimationNode>& xRootNode,
                EventQueue&										 rEventQueue,
                EventMultiplexer&								 rEventMultiplexer,
@@ -112,7 +113,9 @@ public:
                const uno::Reference<uno::XComponentContext>&     xContext,
                const ShapeEventListenerMap&                      rShapeListenerMap,
                const ShapeCursorMap&                             rShapeCursorMap,
+               const PolyPolygonVector&                          rPolyPolygonVector,
                RGBColor const&                                   rUserPaintColor,
+               double                                            dUserPaintStrokeWidth,
                bool                                              bUserPaintEnabled,
                bool                                              bIntrinsicAnimationsAllowed,
                bool                                              bDisableAnimationZOrder );
@@ -136,6 +139,9 @@ public:
     virtual basegfx::B2ISize getSlideSize() const;            
     virtual uno::Reference<drawing::XDrawPage > getXDrawPage() const;
     virtual uno::Reference<animations::XAnimationNode> getXAnimationNode() const;
+    virtual PolyPolygonVector getPolygons();
+    virtual void drawPolygons() const;
+    virtual bool isPaintOverlayActive() const;
 
     // TODO(F2): Rework SlideBitmap to no longer be based on XBitmap,
     // but on canvas-independent basegfx bitmaps
@@ -201,6 +207,8 @@ private:
     /// End GIF and other intrinsic shape animations
     void startIntrinsicAnimations();
 
+    /// Add Polygons to the member maPolygons
+    void addPolygons(PolyPolygonVector aPolygons);
 
     // Types
     // =====
@@ -230,6 +238,7 @@ private:
 
     /// The page model object
     uno::Reference< drawing::XDrawPage >                mxDrawPage;
+    uno::Reference< drawing::XDrawPagesSupplier >       mxDrawPagesSupplier;    
     uno::Reference< animations::XAnimationNode >        mxRootNode;
 
     LayerManagerSharedPtr                               mpLayerManager;
@@ -244,8 +253,10 @@ private:
 
     /// Handles the animation and event generation for us
     SlideAnimations										maAnimations;
+    PolyPolygonVector                                   maPolygons;
         
     RGBColor                                            maUserPaintColor;
+    double                                              mdUserPaintStrokeWidth;
     UserPaintOverlaySharedPtr							mpPaintOverlay;
     
     /// Bitmaps with slide content at various states
@@ -287,6 +298,9 @@ private:
 
     /// When true, show() was called. Slide hidden oherwise.
     bool                                                mbActive;
+    
+    ///When true, enablePaintOverlay was called and mbUserPaintOverlay = true
+    bool                                                mbPaintOverlayActive;
 };
 
 
@@ -335,6 +349,7 @@ private:
 
 
 SlideImpl::SlideImpl( const uno::Reference< drawing::XDrawPage >&			xDrawPage,
+                      const uno::Reference<drawing::XDrawPagesSupplier>&    xDrawPages,
                       const uno::Reference< animations::XAnimationNode >& 	xRootNode,
                       EventQueue&											rEventQueue,
                       EventMultiplexer&										rEventMultiplexer,
@@ -346,11 +361,14 @@ SlideImpl::SlideImpl( const uno::Reference< drawing::XDrawPage >&			xDrawPage,
                       const uno::Reference< uno::XComponentContext >& 		xComponentContext,
                       const ShapeEventListenerMap&                          rShapeListenerMap,
                       const ShapeCursorMap&                                 rShapeCursorMap,
+                      const PolyPolygonVector&                              rPolyPolygonVector,
                       RGBColor const&                                       aUserPaintColor,
+                      double                                                dUserPaintStrokeWidth,
                       bool                                                  bUserPaintEnabled,
                       bool                                                  bIntrinsicAnimationsAllowed,
                       bool                                                  bDisableAnimationZOrder ) :
     mxDrawPage( xDrawPage ),
+    mxDrawPagesSupplier( xDrawPages ),
     mxRootNode( xRootNode ),
     mpLayerManager( new LayerManager( 
                         rViewContainer,
@@ -375,7 +393,9 @@ SlideImpl::SlideImpl( const uno::Reference< drawing::XDrawPage >&			xDrawPage,
     mrCursorManager( rCursorManager ),
     maAnimations( maContext,
                   getSlideSizeImpl() ),
+    maPolygons(rPolyPolygonVector),
     maUserPaintColor(aUserPaintColor),
+    mdUserPaintStrokeWidth(dUserPaintStrokeWidth),
     mpPaintOverlay(),
     maSlideBitmaps(),
     meAnimationState( CONSTRUCTING_STATE ),
@@ -387,7 +407,8 @@ SlideImpl::SlideImpl( const uno::Reference< drawing::XDrawPage >&			xDrawPage,
     mbShowLoaded( false ),
     mbHaveAnimations( false ),
     mbMainSequenceFound( false ),
-    mbActive( false )
+    mbActive( false ),
+    mbPaintOverlayActive( false )
 {
     // clone already existing views for slide bitmaps
     std::for_each( rViewContainer.begin(),
@@ -436,6 +457,9 @@ void SlideImpl::dispose()
     mpShapeManager.reset();
     mxRootNode.clear();
     mxDrawPage.clear();
+#ifndef ENABLE_PRESENTER_EXTRA_UI
+    mxDrawPagesSupplier.clear();
+#endif
 }
 
 bool SlideImpl::prefetch()
@@ -583,6 +607,12 @@ uno::Reference<animations::XAnimationNode> SlideImpl::getXAnimationNode() const
     return mxRootNode;
 }
 
+PolyPolygonVector SlideImpl::getPolygons()
+{
+    if(mbPaintOverlayActive)
+        maPolygons = mpPaintOverlay->getPolygons();
+    return maPolygons;
+}
 
 SlideBitmapSharedPtr SlideImpl::getCurrentSlideBitmap( const UnoViewSharedPtr& rView ) const
 {
@@ -862,14 +892,47 @@ bool SlideImpl::implPrefetchShow()
 void SlideImpl::enablePaintOverlay()
 {
     if( mbUserPaintOverlayEnabled )
+    {
         mpPaintOverlay = UserPaintOverlay::create( maUserPaintColor,
-                                                   2.0,
-                                                   maContext );
+                                                   mdUserPaintStrokeWidth,
+                                                   maContext,
+                                                   maPolygons );
+        mbPaintOverlayActive = true;
+    }
+}
+
+void SlideImpl::drawPolygons() const
+{
+    if( mbUserPaintOverlayEnabled )
+        mpPaintOverlay->drawPolygons();
+}
+    
+void SlideImpl::addPolygons(PolyPolygonVector aPolygons)
+{
+    if(!aPolygons.empty()) /* FIXME : was if(aPolygons.size() != 0) */
+    {
+        for( PolyPolygonVector::iterator aIter=aPolygons.begin(), 
+                 aEnd=aPolygons.end();
+             aIter!=aEnd;
+             ++aIter )
+        {
+            maPolygons.push_back(*aIter);
+        }
+    }
+}
+
+bool SlideImpl::isPaintOverlayActive() const
+{
+    return mbPaintOverlayActive;
 }
 
 void SlideImpl::disablePaintOverlay()
 {
+    if(mbPaintOverlayActive)
+        maPolygons = mpPaintOverlay->getPolygons();
+
     mpPaintOverlay.reset();
+    mbPaintOverlayActive = false;
 }
 
 ::basegfx::B2DRectangle SlideImpl::getSlideRect() const
@@ -1073,6 +1136,7 @@ bool SlideImpl::loadShapes()
                 // -------------------------------------------------------------------------
                 ShapeImporter aMPShapesFunctor( xMasterPage, 
                                                 mxDrawPage,
+                                                mxDrawPagesSupplier,
                                                 maContext,
                                                 0, /* shape num starts at 0 */
                                                 true );
@@ -1087,6 +1151,7 @@ bool SlideImpl::loadShapes()
                     if( rShape )
                         mpLayerManager->addShape( rShape );
                 }
+                addPolygons(aMPShapesFunctor.getPolygons());
 
                 nCurrCount = xMasterPageShapes->getCount() + 1;
             }
@@ -1121,6 +1186,7 @@ bool SlideImpl::loadShapes()
 
         ShapeImporter aShapesFunctor( mxDrawPage, 
                                       mxDrawPage,
+                                      mxDrawPagesSupplier,
                                       maContext,
                                       nCurrCount, 
                                       false );
@@ -1132,6 +1198,7 @@ bool SlideImpl::loadShapes()
             if( rShape )
                 mpLayerManager->addShape( rShape );
         }
+        addPolygons(aShapesFunctor.getPolygons());
     }
     catch( uno::RuntimeException& )
     {
@@ -1176,6 +1243,7 @@ basegfx::B2ISize SlideImpl::getSlideSizeImpl() const
 
 
 SlideSharedPtr createSlide( const uno::Reference< drawing::XDrawPage >&			xDrawPage,
+                            const uno::Reference<drawing::XDrawPagesSupplier>&  xDrawPages,
                             const uno::Reference< animations::XAnimationNode >& xRootNode,
                             EventQueue&											rEventQueue,
                             EventMultiplexer&									rEventMultiplexer,
@@ -1187,18 +1255,20 @@ SlideSharedPtr createSlide( const uno::Reference< drawing::XDrawPage >&			xDrawP
                             const uno::Reference< uno::XComponentContext >& 	xComponentContext,
                             const ShapeEventListenerMap&                        rShapeListenerMap,
                             const ShapeCursorMap&                               rShapeCursorMap,
+                            const PolyPolygonVector&                            rPolyPolygonVector,
                             RGBColor const&                                     rUserPaintColor,
+                            double                                              dUserPaintStrokeWidth,
                             bool                                                bUserPaintEnabled,
                             bool                                                bIntrinsicAnimationsAllowed,
                             bool                                                bDisableAnimationZOrder )
 {
-    boost::shared_ptr<SlideImpl> pRet( new SlideImpl( xDrawPage, xRootNode, rEventQueue, 
+    boost::shared_ptr<SlideImpl> pRet( new SlideImpl( xDrawPage, xDrawPages, xRootNode, rEventQueue,
                                                       rEventMultiplexer, rScreenUpdater,
                                                       rActivitiesQueue, rUserEventQueue, 
                                                       rCursorManager, rViewContainer,
                                                       xComponentContext, rShapeListenerMap,
-                                                      rShapeCursorMap, rUserPaintColor,
-                                                      bUserPaintEnabled, 
+                                                      rShapeCursorMap, rPolyPolygonVector, rUserPaintColor,
+                                                      dUserPaintStrokeWidth, bUserPaintEnabled,
                                                       bIntrinsicAnimationsAllowed,
                                                       bDisableAnimationZOrder ));
 
diff --git slideshow/source/engine/slide/userpaintoverlay.cxx slideshow/source/engine/slide/userpaintoverlay.cxx
index 17951a7..91b3a38 100644
--- slideshow/source/engine/slide/userpaintoverlay.cxx
+++ slideshow/source/engine/slide/userpaintoverlay.cxx
@@ -54,7 +54,8 @@
 
 #include <boost/bind.hpp>
 #include <boost/noncopyable.hpp>
-
+#include "slide.hxx"
+#include "cursormanager.hxx"
 
 using namespace ::com::sun::star;
 
@@ -63,29 +64,40 @@ namespace slideshow
     namespace internal
     {
         class PaintOverlayHandler : public MouseEventHandler,
-                                    public ViewEventHandler
+                                    public ViewEventHandler,
+                    public UserPaintEventHandler
         {
         public:
             PaintOverlayHandler( const RGBColor&         rStrokeColor,
                                  double                  nStrokeWidth,
                                  ActivitiesQueue&        rActivitiesQueue,
                                  ScreenUpdater&          rScreenUpdater,
-                                 const UnoViewContainer& rViews ) :
+                                 const UnoViewContainer&  rViews,
+                 Slide&		              rSlide,
+                                 const PolyPolygonVector& rPolygons ) :
                 mrActivitiesQueue( rActivitiesQueue ),
                 mrScreenUpdater( rScreenUpdater ),
                 maViews(),
+                maPolygons( rPolygons ),
                 maStrokeColor( rStrokeColor ),
                 mnStrokeWidth( nStrokeWidth ),
                 maLastPoint(),
                 maLastMouseDownPos(),
                 mbIsLastPointValid( false ),
-                mbIsLastMouseDownPosValid( false )
+                mbIsLastMouseDownPosValid( false ),
+        //handle the "remove all ink from slide" mode of erasing
+        mbIsEraseAllModeActivated( false ),
+        //handle the "remove stroke by stroke" mode of erasing
+        mbIsEraseModeActivated( false ),
+        mrSlide(rSlide),
+                mnSize(100)
             {
                 std::for_each( rViews.begin(),
                                rViews.end(),
                                boost::bind( &PaintOverlayHandler::viewAdded,
                                             this,
                                             _1 ));
+                drawPolygons();
             }
 
             virtual void dispose()
@@ -118,9 +130,118 @@ namespace slideshow
                 // polygon and repaint here.
             }
             
+        bool colorChanged( RGBColor const& rUserColor )
+            {
+            this->maStrokeColor = rUserColor;
+            this->mbIsEraseModeActivated = false;
+            return true;
+        }
+            
+            bool widthChanged( double nUserStrokeWidth )
+            {
+                this->mnStrokeWidth = nUserStrokeWidth;
+        mbIsEraseModeActivated = false ;
+                return true;
+            }
+           
+        bool eraseAllInkChanged( bool const& rEraseAllInk )
+            {
+            this->mbIsEraseAllModeActivated= rEraseAllInk;
+            // if the erase all mode is activated it will remove all ink from slide, 
+            // therefor destroy all the polygons stored
+            if(mbIsEraseAllModeActivated)
+            {
+            // The Erase Mode should be desactivated
+            mbIsEraseModeActivated = false;
+                // must get access to the instance to erase all polygon
+                for( UnoViewVector::iterator aIter=maViews.begin(), aEnd=maViews.end();
+                        aIter!=aEnd;
+                        ++aIter )
+                {
+                        // fully clear view content to background color
+                        (*aIter)->getCanvas()->clear();
+
+                        //get via SlideImpl instance the bitmap of the slide unmodified to redraw it
+                        SlideBitmapSharedPtr 		 pBitmap( mrSlide.getCurrentSlideBitmap( (*aIter) ) );
+                        ::cppcanvas::CanvasSharedPtr pCanvas( (*aIter)->getCanvas() );
+                        
+                        const ::basegfx::B2DHomMatrix 	aViewTransform( (*aIter)->getTransformation() );
+                        const ::basegfx::B2DPoint 		aOutPosPixel( aViewTransform * ::basegfx::B2DPoint() );
+                        
+                        // setup a canvas with device coordinate space, the slide
+                        // bitmap already has the correct dimension.
+                        ::cppcanvas::CanvasSharedPtr pDevicePixelCanvas( pCanvas->clone() );
+                        
+                        pDevicePixelCanvas->setTransformation( ::basegfx::B2DHomMatrix() );
+                        
+                        // render at given output position
+                        pBitmap->move( aOutPosPixel );
+                        
+                        // clear clip (might have been changed, e.g. from comb
+                        // transition)
+                        pBitmap->clip( ::basegfx::B2DPolyPolygon() ); 
+                        pBitmap->draw( pDevicePixelCanvas );
+                        
+                        mrScreenUpdater.notifyUpdate(*aIter,true);
+                }
+                maPolygons.clear();
+            }
+            mbIsEraseAllModeActivated=false;
+            return true;
+        }
+    
+        bool eraseInkWidthChanged( sal_Int32 rEraseInkSize )
+            {
+                // Change the size
+            this->mnSize=rEraseInkSize;
+            // Changed to mode Erase
+            this->mbIsEraseModeActivated = true;
+            return true;
+        }
+
+        bool switchPenMode(){
+         this->mbIsEraseModeActivated = false;
+         return true;
+        }
+
+        bool switchEraserMode(){
+        this->mbIsEraseModeActivated = true;
+        return true;
+        }
+
+        bool disable()
+            {
+        return true;
+        }
+            
+            //Draw all registered polygons.
+            void drawPolygons()
+            {		
+                for( PolyPolygonVector::iterator aIter=maPolygons.begin(), aEnd=maPolygons.end();
+                                     aIter!=aEnd;
+                                     ++aIter )
+                {
+                    (*aIter)->draw();
+                }
+                // screen update necessary to show painting
+                mrScreenUpdater.notifyUpdate();	
+            }
+                       
+            //Retrieve all registered polygons.
+            PolyPolygonVector getPolygons()
+            {
+                return maPolygons;	
+            }
+            
             // MouseEventHandler methods
             virtual bool handleMousePressed( const awt::MouseEvent& e )
             {
+                if (e.Buttons == awt::MouseButton::RIGHT)
+                {
+                    mbIsLastPointValid = false;
+                    return false;
+                }
+                
                 if (e.Buttons != awt::MouseButton::LEFT)
                     return false;
                 
@@ -135,6 +256,12 @@ namespace slideshow
 
             virtual bool handleMouseReleased( const awt::MouseEvent& e )
             {
+                if (e.Buttons == awt::MouseButton::RIGHT)
+                {
+                    mbIsLastPointValid = false;
+                    return false;
+                }
+                
                 if (e.Buttons != awt::MouseButton::LEFT)
                     return false;
                 
@@ -180,6 +307,72 @@ namespace slideshow
 
             virtual bool handleMouseDragged( const awt::MouseEvent& e )
             {
+        if(mbIsEraseModeActivated)
+                {
+                    //define the last point as an object
+                    //we suppose that there's no way this point could be valid
+                    ::basegfx::B2DPolygon aPoly;
+                    
+                    maLastPoint.setX( e.X-mnSize );
+                    maLastPoint.setY( e.Y-mnSize );
+                                        
+                    aPoly.append( maLastPoint );
+                                        
+                    maLastPoint.setX( e.X-mnSize );
+                    maLastPoint.setY( e.Y+mnSize );
+                    
+                    aPoly.append( maLastPoint );
+                    maLastPoint.setX( e.X+mnSize );
+                    maLastPoint.setY( e.Y+mnSize );
+                    
+                    aPoly.append( maLastPoint );
+                    maLastPoint.setX( e.X+mnSize );
+                    maLastPoint.setY( e.Y-mnSize );
+                    
+                    aPoly.append( maLastPoint );
+                    maLastPoint.setX( e.X-mnSize );
+                    maLastPoint.setY( e.Y-mnSize );
+                    
+                    aPoly.append( maLastPoint );
+                    
+                    //now we have defined a Polygon that is closed
+                    
+                    //The point is to redraw the LastPoint the way it was originally on the bitmap, 
+                    //of the slide
+            for( UnoViewVector::iterator aIter=maViews.begin(), aEnd=maViews.end();
+                        aIter!=aEnd;
+                        ++aIter )
+                    {
+                        
+                        //get via SlideImpl instance the bitmap of the slide unmodified to redraw it
+                        SlideBitmapSharedPtr 		 pBitmap( mrSlide.getCurrentSlideBitmap( (*aIter) ) );
+                        ::cppcanvas::CanvasSharedPtr pCanvas( (*aIter)->getCanvas() );
+                        
+                        ::basegfx::B2DHomMatrix 	aViewTransform( (*aIter)->getTransformation() );
+                        const ::basegfx::B2DPoint 		aOutPosPixel( aViewTransform * ::basegfx::B2DPoint() );
+                        
+                        // setup a canvas with device coordinate space, the slide
+                        // bitmap already has the correct dimension.
+                        ::cppcanvas::CanvasSharedPtr pDevicePixelCanvas( pCanvas->clone() );
+                        
+                        pDevicePixelCanvas->setTransformation( ::basegfx::B2DHomMatrix() );
+                        
+                        // render at given output position
+                        pBitmap->move( aOutPosPixel );
+                        
+                        ::basegfx::B2DPolyPolygon aPolyPoly=::basegfx::B2DPolyPolygon(aPoly);
+                        aViewTransform.translate(-aOutPosPixel.getX(), -aOutPosPixel.getY());
+                        aPolyPoly.transform(aViewTransform);
+                        // set clip so that we just redraw a part of the canvas
+                        pBitmap->clip(aPolyPoly); 
+                        pBitmap->draw( pDevicePixelCanvas );
+                        
+                        mrScreenUpdater.notifyUpdate(*aIter,true);
+                    }
+                    
+        } 
+                else 
+                {
                 if( !mbIsLastPointValid )
                 {
                     mbIsLastPointValid = true;
@@ -207,15 +400,17 @@ namespace slideshow
                         
                         if( pPolyPoly )
                         {
+                                pPolyPoly->setStrokeWidth(mnStrokeWidth);
                             pPolyPoly->setRGBALineColor( maStrokeColor.getIntegerColor() );
                             pPolyPoly->draw();
+                                maPolygons.push_back(pPolyPoly);
                         }
                     }
 
                     // screen update necessary to show painting
                     mrScreenUpdater.notifyUpdate();
                 }
-
+                }
                 // mouse events captured
                 return true;
             }
@@ -226,42 +421,67 @@ namespace slideshow
                 return false; // did not handle the event
             }
 
+            
+
         private:
             ActivitiesQueue&        mrActivitiesQueue;
             ScreenUpdater&          mrScreenUpdater;
             UnoViewVector           maViews;
+            PolyPolygonVector 	    maPolygons;
             RGBColor                maStrokeColor;
             double                  mnStrokeWidth;
             basegfx::B2DPoint       maLastPoint;
             basegfx::B2DPoint       maLastMouseDownPos;
             bool                    mbIsLastPointValid;
             bool                    mbIsLastMouseDownPosValid;
+        // added bool for erasing purpose :
+        bool		    mbIsEraseAllModeActivated;
+        bool		    mbIsEraseModeActivated;
+        Slide&		    mrSlide;
+            double               mnSize;
         };
 
         UserPaintOverlaySharedPtr UserPaintOverlay::create( const RGBColor&         rStrokeColor,
                                                             double                  nStrokeWidth,
-                                                            const SlideShowContext& rContext )
+                                                            const SlideShowContext&  rContext,
+                                                            const PolyPolygonVector& rPolygons )
         {
             UserPaintOverlaySharedPtr pRet( new UserPaintOverlay( rStrokeColor,
                                                                   nStrokeWidth,
-                                                                  rContext ));
+                                                                  rContext,
+                                                                  rPolygons ));
 
             return pRet;
         }
 
         UserPaintOverlay::UserPaintOverlay( const RGBColor&         rStrokeColor,
                                             double                  nStrokeWidth,
-                                            const SlideShowContext& rContext ) : 
+                                            const SlideShowContext&  rContext,
+                                            const PolyPolygonVector& rPolygons ) : 
             mpHandler( new PaintOverlayHandler( rStrokeColor, 
                                                 nStrokeWidth,
                                                 rContext.mrActivitiesQueue,
                                                 rContext.mrScreenUpdater,
-                                                rContext.mrViewContainer )),
+                                                rContext.mrViewContainer,
+                                                //adding a link to Slide
+                        dynamic_cast<Slide&>(rContext.mrCursorManager),
+                                                rPolygons )),
             mrMultiplexer( rContext.mrEventMultiplexer )
         {
             mrMultiplexer.addClickHandler( mpHandler, 3.0 );
             mrMultiplexer.addMouseMoveHandler( mpHandler, 3.0 );
             mrMultiplexer.addViewHandler( mpHandler );
+            mrMultiplexer.addUserPaintHandler(mpHandler);
+        }
+        
+        PolyPolygonVector UserPaintOverlay::getPolygons()
+        {
+            return mpHandler->getPolygons();
+        }
+                
+        void UserPaintOverlay::drawPolygons()
+        {
+            mpHandler->drawPolygons();
         }
         
         UserPaintOverlay::~UserPaintOverlay()
@@ -273,7 +493,8 @@ namespace slideshow
                 mrMultiplexer.removeViewHandler( mpHandler );
                 mpHandler->dispose();
             }
-            catch (uno::Exception &) {
+            catch (uno::Exception &) 
+            {
                 OSL_ENSURE( false, rtl::OUStringToOString(
                                 comphelper::anyToString(
                                     cppu::getCaughtException() ),
diff --git slideshow/source/engine/slide/userpaintoverlay.hxx slideshow/source/engine/slide/userpaintoverlay.hxx
index dbcdf6e..5f0f238 100644
--- slideshow/source/engine/slide/userpaintoverlay.hxx
+++ slideshow/source/engine/slide/userpaintoverlay.hxx
@@ -38,7 +38,7 @@
 
 #include <boost/utility.hpp>
 #include <boost/shared_ptr.hpp>
-
+#include <vector>
 
 /* Definition of UserPaintOverlay class */
 
@@ -51,7 +51,7 @@ namespace slideshow
 
         class PaintOverlayHandler;
         typedef ::boost::shared_ptr< class UserPaintOverlay > UserPaintOverlaySharedPtr;
-
+        typedef ::std::vector< ::cppcanvas::PolyPolygonSharedPtr> PolyPolygonVector;
         /** Slide overlay, which can be painted into by the user.
 
             This class registers itself at the EventMultiplexer,
@@ -71,13 +71,17 @@ namespace slideshow
              */
             static UserPaintOverlaySharedPtr create( const RGBColor&         rStrokeColor,
                                                      double                  nStrokeWidth,
-                                                     const SlideShowContext& rContext );
+                                                     const SlideShowContext&  rContext,
+                                                     const PolyPolygonVector& rPolygons );
             ~UserPaintOverlay();
+            PolyPolygonVector getPolygons();
+            void drawPolygons();
 
         private:
             UserPaintOverlay( const RGBColor&         rStrokeColor,
                               double                  nStrokeWidth,
-                              const SlideShowContext& rContext );
+                              const SlideShowContext&  rContext,
+                              const PolyPolygonVector& rPolygons );
 
             ::boost::shared_ptr<PaintOverlayHandler>	mpHandler;
             EventMultiplexer&							mrMultiplexer;
diff --git slideshow/source/engine/slideshowimpl.cxx slideshow/source/engine/slideshowimpl.cxx
index 6476992..e745553 100644
--- slideshow/source/engine/slideshowimpl.cxx
+++ slideshow/source/engine/slideshowimpl.cxx
@@ -47,6 +47,7 @@
 #include <comphelper/scopeguard.hxx>
 #include <comphelper/optional.hxx>
 #include <comphelper/servicedecl.hxx>
+#include <comphelper/namecontainer.hxx>
 
 #include <cppcanvas/spritecanvas.hxx>
 #include <cppcanvas/vclfactory.hxx>
@@ -62,6 +63,7 @@
 #include <basegfx/tools/canvastools.hxx>
 
 #include <vcl/font.hxx>
+#include "rtl/ref.hxx"
 
 #include <com/sun/star/beans/XPropertySet.hpp>
 #include <com/sun/star/util/XModifyListener.hpp>
@@ -73,6 +75,16 @@
 #include <com/sun/star/presentation/XSlideShow.hpp>
 #include <com/sun/star/lang/XServiceInfo.hpp>
 #include <com/sun/star/lang/XServiceName.hpp>
+#include <com/sun/star/lang/XComponent.hpp>
+#include <com/sun/star/lang/XMultiServiceFactory.hpp>
+#include <com/sun/star/drawing/PointSequenceSequence.hpp>
+#include <com/sun/star/drawing/PointSequence.hpp>
+#include <com/sun/star/drawing/XLayer.hpp>
+#include <com/sun/star/drawing/XLayerSupplier.hpp>
+#include <com/sun/star/drawing/XLayerManager.hpp>
+#include <com/sun/star/container/XNameAccess.hpp>
+
+#include "com/sun/star/uno/Reference.hxx"
 #include <com/sun/star/loader/CannotActivateFactoryException.hpp>
 
 #include "unoviewcontainer.hxx"
@@ -101,8 +113,10 @@
 #include <map>
 #include <vector>
 #include <iterator>
+#include <string>
 #include <algorithm>
 #include <stdio.h>
+#include <iostream>
 
 using namespace com::sun::star;
 using namespace ::slideshow::internal;
@@ -144,6 +158,13 @@ namespace {
 
 typedef cppu::WeakComponentImplHelper1<presentation::XSlideShow> SlideShowImplBase;
 
+typedef ::std::vector< ::cppcanvas::PolyPolygonSharedPtr> PolyPolygonVector;
+    
+/// Maps XDrawPage for annotations persistence
+typedef ::std::map< ::com::sun::star::uno::Reference<
+                                    ::com::sun::star::drawing::XDrawPage>,
+                                    PolyPolygonVector>  PolygonMap;
+    
 class SlideShowImpl : private cppu::BaseMutex,
                       public CursorManager,
                       public SlideShowImplBase
@@ -223,9 +244,11 @@ private:
         throw (uno::RuntimeException);
     virtual void SAL_CALL displaySlide(
         uno::Reference<drawing::XDrawPage> const& xSlide,
+        uno::Reference<drawing::XDrawPagesSupplier> const& xDrawPages,
         uno::Reference<animations::XAnimationNode> const& xRootNode,
         uno::Sequence<beans::PropertyValue> const& rProperties )
         throw (uno::RuntimeException);
+    virtual void SAL_CALL registerUserPaintPolygons( const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory >& xDocFactory ) throw (::com::sun::star::uno::RuntimeException);
     virtual sal_Bool SAL_CALL setProperty(
         beans::PropertyValue const& rProperty ) throw (uno::RuntimeException);
     virtual sal_Bool SAL_CALL addView(
@@ -278,9 +301,13 @@ private:
     /// Stop currently running show.
     void stopShow();
     
+    ///Find a polygons vector in maPolygons (map)
+    PolygonMap::iterator findPolygons( uno::Reference<drawing::XDrawPage> const& xDrawPage);
+    
     /// Creates a new slide.
     SlideSharedPtr makeSlide(
         uno::Reference<drawing::XDrawPage> const& xDrawPage,
+        uno::Reference<drawing::XDrawPagesSupplier> const& xDrawPages,
         uno::Reference<animations::XAnimationNode> const& xRootNode );
     
     /// Checks whether the given slide/animation node matches mpPrefetchSlide
@@ -333,8 +360,20 @@ private:
     /// map of sal_Int16 values, specifying the mouse cursor for every shape
     ShapeCursorMap                          maShapeCursors;
     
+    //map of vector of Polygons, containing polygons drawn on each slide.
+    PolygonMap                              maPolygons;
+    
     boost::optional<RGBColor>               maUserPaintColor;
 
+    boost::optional<double>                 maUserPaintStrokeWidth;
+    
+    //changed for the eraser project
+    boost::optional<bool>		    maEraseAllInk;
+    boost::optional<bool>		    maSwitchPenMode;
+    boost::optional<bool>		    maSwitchEraserMode;
+    boost::optional<sal_Int32>		    maEraseInk;
+    //end changed
+    
     boost::shared_ptr<canvas::tools::ElapsedTime> mpPresTimer;
     ScreenUpdater                           maScreenUpdater;
     EventQueue                              maEventQueue;
@@ -363,6 +402,8 @@ private:
     SlideSharedPtr                          mpPrefetchSlide;
     /// slide to be prefetched: best candidate for upcoming slide
     uno::Reference<drawing::XDrawPage>      mxPrefetchSlide;
+    ///  save the XDrawPagesSupplier to retieve polygons
+    uno::Reference<drawing::XDrawPagesSupplier>  mxDrawPagesSupplier;
     /// slide animation to be prefetched:
     uno::Reference<animations::XAnimationNode> mxPrefetchAnimationNode;
 
@@ -447,6 +488,7 @@ SlideShowImpl::SlideShowImpl(
       maShapeEventListeners(),
       maShapeCursors(),
       maUserPaintColor(),
+      maUserPaintStrokeWidth(4.0),
       mpPresTimer( new canvas::tools::ElapsedTime ),
       maScreenUpdater(maViewContainer),
       maEventQueue( mpPresTimer ),
@@ -466,6 +508,7 @@ SlideShowImpl::SlideShowImpl(
       mpCurrentSlide(),
       mpPrefetchSlide(),
       mxPrefetchSlide(),
+      mxDrawPagesSupplier(),
       mxPrefetchAnimationNode(),
       mnCurrentCursor(awt::SystemPointer::ARROW),
       mbWaitState(false),
@@ -756,14 +799,38 @@ ActivitySharedPtr SlideShowImpl::createSlideTransition(
             true ));
 }
 
+PolygonMap::iterator SlideShowImpl::findPolygons( uno::Reference<drawing::XDrawPage> const& xDrawPage)
+{
+    // TODO(P2) : Optimze research in the map.
+    bool bFound = false;
+    PolygonMap::iterator aIter=maPolygons.begin();
+        
+            
+    while(aIter!=maPolygons.end() && !bFound) 
+    {
+        if(aIter->first == xDrawPage)
+            bFound = true;
+        else
+            aIter++;
+    }
+
+    return aIter;
+}    
+
 SlideSharedPtr SlideShowImpl::makeSlide(
     uno::Reference<drawing::XDrawPage> const& xDrawPage,
+    uno::Reference<drawing::XDrawPagesSupplier> const& xDrawPages,
     uno::Reference<animations::XAnimationNode> const& xRootNode )
 {
     if (! xDrawPage.is())
         return SlideSharedPtr();
     
+    //Retrieve polygons for the current slide
+    PolygonMap::iterator aIter;
+    aIter = findPolygons(xDrawPage);
+    
     const SlideSharedPtr pSlide( createSlide(xDrawPage, 
+                                             xDrawPages,
                                              xRootNode,
                                              maEventQueue,
                                              maEventMultiplexer,
@@ -775,7 +842,9 @@ SlideSharedPtr SlideShowImpl::makeSlide(
                                              mxComponentContext,
                                              maShapeEventListeners,
                                              maShapeCursors,
+                                             (aIter != maPolygons.end()) ? aIter->second :  PolyPolygonVector(),
                                              maUserPaintColor ? *maUserPaintColor : RGBColor(),
+                                             *maUserPaintStrokeWidth,
                                              !!maUserPaintColor,
                                              mbImageAnimationsAllowed,
                                              mbDisableAnimationZOrder) );
@@ -817,7 +886,14 @@ void SlideShowImpl::stopShow()
     // Force-end running animation
     // ===========================
     if (mpCurrentSlide)
+    {
         mpCurrentSlide->hide();
+        //Register polygons in the map
+        if(findPolygons(mpCurrentSlide->getXDrawPage()) != maPolygons.end())
+            maPolygons.erase(mpCurrentSlide->getXDrawPage());
+        
+        maPolygons.insert(make_pair(mpCurrentSlide->getXDrawPage(),mpCurrentSlide->getPolygons()));        	
+    }
     
     // clear all queues
     maEventQueue.clear();
@@ -869,6 +945,7 @@ struct SlideShowImpl::PrefetchPropertiesFunc
 
 void SlideShowImpl::displaySlide(
     uno::Reference<drawing::XDrawPage> const& xSlide,
+    uno::Reference<drawing::XDrawPagesSupplier> const& xDrawPages,
     uno::Reference<animations::XAnimationNode> const& xRootNode,
     uno::Sequence<beans::PropertyValue> const& rProperties )
     throw (uno::RuntimeException)
@@ -881,6 +958,11 @@ void SlideShowImpl::displaySlide(
     // precondition: must only be called from the main thread!
     DBG_TESTSOLARMUTEX();
 
+#ifdef ENABLE_PRESENTER_EXTRA_UI
+    mxDrawPagesSupplier = xDrawPages;
+#else
+    mxDrawPagesSupplier = NULL;
+#endif    
     stopShow();  // MUST call that: results in
     // maUserEventQueue.clear(). What's more,
     // stopShow()'s currSlide->hide() call is
@@ -913,9 +995,7 @@ void SlideShowImpl::displaySlide(
             mpCurrentSlide = mpPrefetchSlide;
         }
         else 
-        {
-            mpCurrentSlide = makeSlide( xSlide, xRootNode );
-        }
+            mpCurrentSlide = makeSlide( xSlide, xDrawPages, xRootNode );
         
         OSL_ASSERT( mpCurrentSlide );
         if (mpCurrentSlide) 
@@ -1133,6 +1213,129 @@ sal_Bool SlideShowImpl::removeView(
     return true;
 }
 
+void SlideShowImpl::registerUserPaintPolygons( const uno::Reference< lang::XMultiServiceFactory >& xDocFactory ) throw (uno::RuntimeException)
+{	
+    //Retrieve Polygons if user ends presentation by context menu
+    if (mpCurrentSlide)
+    {
+        if(findPolygons(mpCurrentSlide->getXDrawPage()) != maPolygons.end())
+            maPolygons.erase(mpCurrentSlide->getXDrawPage());
+
+        maPolygons.insert(make_pair(mpCurrentSlide->getXDrawPage(),mpCurrentSlide->getPolygons()));
+    }
+     
+    //Creating the layer for shapes
+    // query for the XLayerManager
+    uno::Reference< drawing::XLayerSupplier > xLayerSupplier(xDocFactory, uno::UNO_QUERY);
+    uno::Reference< container::XNameAccess > xNameAccess = xLayerSupplier->getLayerManager();
+        
+    uno::Reference< drawing::XLayerManager > xLayerManager(xNameAccess, uno::UNO_QUERY);
+    // create a layer and set its properties
+    uno::Reference< drawing::XLayer > xDrawnInSlideshow = xLayerManager->insertNewByIndex(xLayerManager->getCount());
+    uno::Reference< beans::XPropertySet > xLayerPropSet(xDrawnInSlideshow, uno::UNO_QUERY);
+    
+    //Layer Name which enables to catch annotations
+    rtl::OUString layerName = rtl::OUString::createFromAscii("DrawnInSlideshow");
+    uno::Any aPropLayer;
+        
+    aPropLayer <<= layerName;
+    xLayerPropSet->setPropertyValue(rtl::OUString::createFromAscii("Name"), aPropLayer);
+    
+    aPropLayer <<= true;
+    xLayerPropSet->setPropertyValue(rtl::OUString::createFromAscii("IsVisible"), aPropLayer);
+    
+    aPropLayer <<= false;
+    xLayerPropSet->setPropertyValue(rtl::OUString::createFromAscii("IsLocked"), aPropLayer);
+
+    PolygonMap::iterator aIter=maPolygons.begin();
+        
+    PolyPolygonVector aPolygons;
+    ::cppcanvas::PolyPolygonSharedPtr pPolyPoly;
+    ::basegfx::B2DPolyPolygon b2DPolyPoly;
+    
+    //Register polygons for each slide
+    while(aIter!=maPolygons.end()) 
+    {
+        aPolygons = aIter->second;
+        //Get shapes for the slide
+        ::com::sun::star::uno::Reference< ::com::sun::star::drawing::XShapes > Shapes(aIter->first, ::com::sun::star::uno::UNO_QUERY);
+        //Retrieve polygons for one slide
+        for( PolyPolygonVector::iterator aIterPoly=aPolygons.begin(), 
+                 aEnd=aPolygons.end();
+             aIterPoly!=aEnd; ++aIterPoly )
+        {        					
+            pPolyPoly = (*aIterPoly);
+            b2DPolyPoly = ::basegfx::unotools::b2DPolyPolygonFromXPolyPolygon2D(pPolyPoly->getUNOPolyPolygon());			
+                            
+            //Normally there is only one polygon									
+            for(sal_uInt32 i=0; i< b2DPolyPoly.count();i++)
+            {
+                const ::basegfx::B2DPolygon& aPoly =  b2DPolyPoly.getB2DPolygon(i);
+                sal_uInt32 nPoints = aPoly.count();
+                                        
+                if( nPoints > 1)
+                {
+                    //create the PolyLineShape
+                    uno::Reference< uno::XInterface > polyshape(xDocFactory->createInstance(
+                                                                    rtl::OUString::createFromAscii("com.sun.star.drawing.PolyLineShape") ) );		
+                    uno::Reference< drawing::XShape > rPolyShape(polyshape, uno::UNO_QUERY);
+                                        
+                    //Add the shape to the slide
+                    Shapes->add(rPolyShape);
+                                
+                    //Retrieve shape properties 				
+                    uno::Reference< beans::XPropertySet > aXPropSet = uno::Reference< beans::XPropertySet >( rPolyShape, uno::UNO_QUERY );
+                    //Construct a sequence of points sequence
+                    drawing::PointSequenceSequence aRetval;
+                    //Create only one sequence for one polygon
+                    aRetval.realloc( 1 );
+                    // Retrieve the sequence of points from aRetval
+                    drawing::PointSequence* pOuterSequence = aRetval.getArray();
+                    // Create 2 points in this sequence
+                    pOuterSequence->realloc(nPoints);
+                    // Get these points which are in an array
+                    awt::Point* pInnerSequence = pOuterSequence->getArray();
+                    for( sal_uInt32 n = 0; n < nPoints; n++ )
+                    {
+                        //Create a point from the polygon
+                        *pInnerSequence++ = awt::Point( aPoly.getB2DPoint(n).getX(), aPoly.getB2DPoint(n).getY());
+                    }
+
+                    //Fill the properties
+                    //Give the built PointSequenceSequence.
+                    uno::Any aParam;
+                    aParam <<= aRetval;
+                    aXPropSet->setPropertyValue( rtl::OUString::createFromAscii("PolyPolygon"), aParam );                        				
+
+                    //LineStyle : SOLID by default
+                    uno::Any			aAny;
+                    drawing::LineStyle	eLS;
+                    eLS = drawing::LineStyle_SOLID;
+                    aAny <<= eLS;
+                    aXPropSet->setPropertyValue( rtl::OUString::createFromAscii("LineStyle"), aAny );
+
+                    //LineColor
+                    sal_uInt32			nLineColor;
+                    nLineColor = pPolyPoly->getRGBALineColor();
+                    //Transform polygon color from RRGGBBAA to AARRGGBB					
+                    aAny <<= RGBAColor2UnoColor(nLineColor);
+                    aXPropSet->setPropertyValue( rtl::OUString::createFromAscii("LineColor"), aAny );
+                        
+                    //LineWidth
+                    double				fLineWidth;
+                    fLineWidth = pPolyPoly->getStrokeWidth();
+                    aAny <<= (sal_Int32)fLineWidth;
+                    aXPropSet->setPropertyValue( rtl::OUString::createFromAscii("LineWidth"), aAny );			
+
+                    // make polygons special						
+                    xLayerManager->attachShapeToLayer(rPolyShape, xDrawnInSlideshow);
+                }
+            }			
+        }
+        ++aIter;
+    }
+}
+        
 sal_Bool SlideShowImpl::setProperty( beans::PropertyValue const& rProperty )
     throw (uno::RuntimeException)
 {
@@ -1183,6 +1386,126 @@ sal_Bool SlideShowImpl::setProperty( beans::PropertyValue const& rProperty )
         return true;
     }
     
+    //adding support for erasing features in UserPaintOverlay
+    if (rProperty.Name.equalsAsciiL(
+            RTL_CONSTASCII_STRINGPARAM("EraseAllInk") ))
+    {
+        bool nEraseAllInk(false);
+        if (rProperty.Value >>= nEraseAllInk) 
+        {
+            OSL_ENSURE( mbMouseVisible,
+                        "setProperty(): User paint overrides invisible mouse" );
+            
+            // enable user paint
+            maEraseAllInk.reset( nEraseAllInk );
+            maEventMultiplexer.notifyEraseAllInk( *maEraseAllInk );
+        }
+        else 
+        {
+        // disable user paint
+        maEraseAllInk.reset();
+        maEventMultiplexer.notifyUserPaintDisabled();
+        }
+        
+        if( mnCurrentCursor == awt::SystemPointer::ARROW )
+        resetCursor();
+        
+        return true;
+    }
+
+    if (rProperty.Name.equalsAsciiL(
+            RTL_CONSTASCII_STRINGPARAM("SwitchPenMode") ))
+    {
+        bool nSwitchPenMode(false);
+        if (rProperty.Value >>= nSwitchPenMode) 
+        {
+            OSL_ENSURE( mbMouseVisible,
+                        "setProperty(): User paint overrides invisible mouse" );
+
+            if(nSwitchPenMode == true){
+            // Switch to Pen Mode
+            maSwitchPenMode.reset( nSwitchPenMode );
+            maEventMultiplexer.notifySwitchPenMode();
+            }
+        }
+        
+        if( mnCurrentCursor == awt::SystemPointer::ARROW )
+            resetCursor();
+        return true;
+    }
+
+
+    if (rProperty.Name.equalsAsciiL(
+            RTL_CONSTASCII_STRINGPARAM("SwitchEraserMode") ))
+    {
+        bool nSwitchEraserMode(false);
+        if (rProperty.Value >>= nSwitchEraserMode) 
+        {
+            OSL_ENSURE( mbMouseVisible,
+                        "setProperty(): User paint overrides invisible mouse" );
+            if(nSwitchEraserMode == true){
+            // switch to Eraser mode
+            maSwitchEraserMode.reset( nSwitchEraserMode );
+            maEventMultiplexer.notifySwitchEraserMode();
+            }
+        }
+        
+        if( mnCurrentCursor == awt::SystemPointer::ARROW )
+            resetCursor();
+        return true;
+    }
+
+
+
+    if (rProperty.Name.equalsAsciiL(
+            RTL_CONSTASCII_STRINGPARAM("EraseInk") ))
+    {
+        sal_Int32 nEraseInk(100);
+        if (rProperty.Value >>= nEraseInk) 
+        {
+            OSL_ENSURE( mbMouseVisible,
+                        "setProperty(): User paint overrides invisible mouse" );
+            
+            // enable user paint
+            maEraseInk.reset( nEraseInk );
+            maEventMultiplexer.notifyEraseInkWidth( *maEraseInk );
+        }
+        else 
+        {	
+            // disable user paint
+            maEraseInk.reset();
+            maEventMultiplexer.notifyUserPaintDisabled();
+        }
+        
+        if( mnCurrentCursor == awt::SystemPointer::ARROW )
+            resetCursor();
+        
+        return true;
+    }
+    
+    // new Property for pen's width
+    if (rProperty.Name.equalsAsciiL(
+            RTL_CONSTASCII_STRINGPARAM("UserPaintStrokeWidth") ))
+    {
+        double nWidth(4.0);
+        if (rProperty.Value >>= nWidth)
+        {
+            OSL_ENSURE( mbMouseVisible,"setProperty(): User paint overrides invisible mouse" );
+            // enable user paint stroke width
+            maUserPaintStrokeWidth.reset( nWidth );
+            maEventMultiplexer.notifyUserPaintStrokeWidth( *maUserPaintStrokeWidth );
+        }
+        else
+        {
+            // disable user paint stroke width
+            maUserPaintStrokeWidth.reset();
+            maEventMultiplexer.notifyUserPaintDisabled();
+        }
+        if( mnCurrentCursor == awt::SystemPointer::ARROW )
+            resetCursor();
+        return true;
+    }
+    
     if (rProperty.Name.equalsAsciiL(
             RTL_CONSTASCII_STRINGPARAM("AdvanceOnClick") )) 
     {
@@ -1654,6 +1977,9 @@ void SlideShowImpl::notifySlideAnimationsEnded()
 {
     osl::MutexGuard const guard( m_aMutex );
 
+    //Draw polygons above animations
+    mpCurrentSlide->drawPolygons();
+    
     OSL_ENSURE( !isDisposed(), "### already disposed!" );
     
     // This struct will receive the (interruptable) event,
@@ -1738,7 +2064,7 @@ void SlideShowImpl::notifySlideAnimationsEnded()
         if (! matches( mpPrefetchSlide,
                        mxPrefetchSlide, mxPrefetchAnimationNode )) 
         {
-            mpPrefetchSlide = makeSlide( mxPrefetchSlide,
+            mpPrefetchSlide = makeSlide( mxPrefetchSlide, mxDrawPagesSupplier,
                                          mxPrefetchAnimationNode );
         }
         if (mpPrefetchSlide) 
@@ -1832,6 +2158,8 @@ bool SlideShowImpl::handleAnimationEvent( const AnimationNodeSharedPtr& rNode )
             boost::bind( &animations::XAnimationListener::endEvent,
                          _1, 
                          boost::cref(xNode) ));
+        if(mpCurrentSlide->isPaintOverlayActive())
+           mpCurrentSlide->drawPolygons();
         break;
     default:
         break;
diff --git slideshow/source/engine/tools.cxx slideshow/source/engine/tools.cxx
index 95f09d4..b7b8c6e 100644
--- slideshow/source/engine/tools.cxx
+++ slideshow/source/engine/tools.cxx
@@ -710,6 +710,38 @@ namespace slideshow
                     static_cast< sal_uInt8 >( nColor >> 24U ) ) );
         }
 
+        sal_Int32 RGBAColor2UnoColor( ::cppcanvas::Color::IntSRGBA aColor )
+        {
+            return ::cppcanvas::makeColorARGB(
+                // convert from IntSRGBA color to API color
+                // (0xRRGGBBAA -> 0xAARRGGBB)
+                static_cast< sal_uInt8 >(0),
+                ::cppcanvas::getRed(aColor),
+                ::cppcanvas::getGreen(aColor),
+                ::cppcanvas::getBlue(aColor));
+        }
+        
+        /*sal_Int32 RGBAColor2UnoColor( ::cppcanvas::Color::IntSRGBA aColor )
+        {
+            return ::cppcanvas::unMakeColor(
+                                                    // convert from IntSRGBA color to API color
+                                                    // (0xRRGGBBAA -> 0xAARRGGBB)
+                                                    static_cast< sal_uInt8 >(0),
+                                                    ::cppcanvas::getRed(aColor),
+                                                    ::cppcanvas::getGreen(aColor),
+                                                    ::cppcanvas::getBlue(aColor));
+        }*/
+
+        sal_Int8 unSignedToSigned(sal_Int8 nInt)
+        {	
+            if(nInt < 0 ){
+                sal_Int8 nInt2 = nInt >> 1U;
+                return nInt2;
+            }else{
+                return nInt;
+            }
+        }
+        
         void fillRect( const ::cppcanvas::CanvasSharedPtr& rCanvas,
                        const ::basegfx::B2DRectangle&	   rRect,
                        ::cppcanvas::Color::IntSRGBA        aFillColor )
diff --git slideshow/source/inc/eventmultiplexer.hxx slideshow/source/inc/eventmultiplexer.hxx
index 06e1ec0..e17b3f7 100644
--- slideshow/source/inc/eventmultiplexer.hxx
+++ slideshow/source/inc/eventmultiplexer.hxx
@@ -486,6 +486,33 @@ public:
     */
     bool notifyUserPaintColor( RGBColor const& rUserColor );
 
+    /** Notify a new user paint width
+         
+         Sending this notification also implies that user paint is
+         enabled. .
+         
+         @return true, if this event was processed by
+         anybody. If false is returned, no handler processed
+         this event (and probably, nothing will happen at all)
+         */
+    bool notifyUserPaintStrokeWidth( double rUserStrokeWidth );
+      
+    
+    /** Notify a new user paint erase all ink mode
+     
+     Sending this notification also implies that user paint is
+     enabled. User paint denotes the feature to draw colored lines
+     on top of the slide content.
+     
+     @return true, if this event was processed by
+     anybody. If false is returned, no handler processed
+     this event (and probably, nothing will happen at all)
+     */
+    bool notifyEraseAllInk( bool const& rEraseAllInk );
+    bool notifySwitchPenMode();
+    bool notifySwitchEraserMode();
+    bool notifyEraseInkWidth( sal_Int32 rEraseInkSize );
+    
     /** Notify that user paint is disabled
         
         User paint denotes the feature to draw colored lines on top of
diff --git slideshow/source/inc/rgbcolor.hxx slideshow/source/inc/rgbcolor.hxx
index 78cdce6..e838a59 100644
--- slideshow/source/inc/rgbcolor.hxx
+++ slideshow/source/inc/rgbcolor.hxx
@@ -90,6 +90,9 @@ namespace slideshow
              */
             ::cppcanvas::Color::IntSRGBA getIntegerColor() const;
 
+            RGBColor(const RGBColor& rLHS);
+            RGBColor& operator=( const RGBColor& rLHS); 
+
             struct RGBTriple
             {
                 RGBTriple();
diff --git slideshow/source/inc/shapeimporter.hxx slideshow/source/inc/shapeimporter.hxx
index a657fe7..7e09c4d 100644
--- slideshow/source/inc/shapeimporter.hxx
+++ slideshow/source/inc/shapeimporter.hxx
@@ -33,6 +33,9 @@
 #include <com/sun/star/drawing/XDrawPage.hpp>
 #include <com/sun/star/drawing/XShapes.hpp>
 #include <com/sun/star/beans/XPropertySet.hpp>
+#include <com/sun/star/drawing/XLayer.hpp>
+#include "unoviewcontainer.hxx"
+#include "unoview.hxx"
 
 #include "shape.hxx"
 
@@ -43,6 +46,10 @@ namespace internal {
 
 struct SlideShowContext;
 
+typedef ::std::vector< ::cppcanvas::PolyPolygonSharedPtr> PolyPolygonVector;
+typedef ::boost::shared_ptr< UnoView > 		UnoViewSharedPtr;
+typedef ::std::vector< UnoViewSharedPtr >	UnoViewVector;
+    
 /** This class imports all shapes from a given XShapes object
  */
 class ShapeImporter 
@@ -75,6 +82,8 @@ public:
                          ::com::sun::star::drawing::XDrawPage >& xPage, 
                    const ::com::sun::star::uno::Reference< 
                          ::com::sun::star::drawing::XDrawPage >& xActualPage, 
+                   const ::com::sun::star::uno::Reference< 
+                         ::com::sun::star::drawing::XDrawPagesSupplier>& xPagesSupplier, 
                    const SlideShowContext&                       rContext,
                    sal_Int32                                     nOrdNumStart,
                    bool                                          bConvertingMasterPage );
@@ -95,11 +104,13 @@ public:
         importShape() call.
     */
     bool isImportDone() const;
-    
+    PolyPolygonVector getPolygons();
 private:
     bool isSkip( ::com::sun::star::uno::Reference<
                  ::com::sun::star::beans::XPropertySet> const& xPropSet,
-                 ::rtl::OUString const& shapeType ) const;
+                 ::rtl::OUString const& shapeType,
+             ::com::sun::star::uno::Reference<
+             ::com::sun::star::drawing::XLayer> const& xLayer); 
     
     ShapeSharedPtr createShape(
         ::com::sun::star::uno::Reference<
@@ -108,6 +119,8 @@ private:
         ::com::sun::star::beans::XPropertySet> const& xPropSet,
         ::rtl::OUString const& shapeType ) const;
     
+    void importPolygons(::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet > const& xPropSet) ;
+  
     struct XShapesEntry 
     {
         ShapeSharedPtr const mpGroupShape;
@@ -130,10 +143,11 @@ private:
     
     ::com::sun::star::uno::Reference<
         ::com::sun::star::drawing::XDrawPage> mxPage;    
+    ::com::sun::star::uno::Reference<
+        ::com::sun::star::drawing::XDrawPagesSupplier> mxPagesSupplier; 
     const SlideShowContext&                   mrContext;
-
+    PolyPolygonVector                         maPolygons;
     XShapesStack                              maShapesStack;
-    
     double                                    mnAscendingPrio;
     bool                                      mbConvertingMasterPage;
 };
diff --git slideshow/source/inc/slide.hxx slideshow/source/inc/slide.hxx
index 346a988..dfd63cb 100644
--- slideshow/source/inc/slide.hxx
+++ slideshow/source/inc/slide.hxx
@@ -42,6 +42,7 @@
 namespace com {  namespace sun { namespace star {
     namespace drawing {
         class XDrawPage;
+        class XDrawPagesSupplier;
     }
     namespace uno { 
         class XComponentContext;
@@ -63,7 +64,7 @@ namespace slideshow
     {
         class RGBColor;
         class ScreenUpdater;
-
+        typedef ::std::vector< ::cppcanvas::PolyPolygonSharedPtr> PolyPolygonVector;    
         class Slide
         {
         public:
@@ -117,6 +118,14 @@ namespace slideshow
             virtual ::com::sun::star::uno::Reference< 
                 ::com::sun::star::animations::XAnimationNode > getXAnimationNode() const = 0;
 
+            ///Gets the slide Polygons
+            virtual PolyPolygonVector getPolygons() = 0;
+                
+            ///Draw the slide Polygons
+            virtual void drawPolygons() const = 0;
+                
+            ///Check if slide is already active
+            virtual bool isPaintOverlayActive() const = 0;
 
             // Slide bitmaps
             // -------------------------------------------------------------------
@@ -185,6 +194,8 @@ namespace slideshow
         SlideSharedPtr createSlide( const ::com::sun::star::uno::Reference< 
                                        ::com::sun::star::drawing::XDrawPage >& 		   xDrawPage,
                                     const ::com::sun::star::uno::Reference<
+                                       ::com::sun::star::drawing::XDrawPagesSupplier >& xDrawPages,
+                                    const ::com::sun::star::uno::Reference<
                                        ::com::sun::star::animations::XAnimationNode >& xRootNode,
                                     EventQueue&									       rEventQueue,
                                     EventMultiplexer&								   rEventMultiplexer,
@@ -197,7 +208,9 @@ namespace slideshow
                                        ::com::sun::star::uno::XComponentContext >&     xContext,
                                     const ShapeEventListenerMap&                       rShapeListenerMap,
                                     const ShapeCursorMap&                              rShapeCursorMap,
+                                    const PolyPolygonVector&                            rPolyPolygonVector,
                                     RGBColor const&                                    aUserPaintColor,
+                                    double                                              dUserPaintStrokeWidth,
                                     bool                                               bUserPaintEnabled,
                                     bool                                               bIntrinsicAnimationsAllowed,
                                     bool                                               bDisableAnimationZOrder );
diff --git slideshow/source/inc/tools.hxx slideshow/source/inc/tools.hxx
index a438216..8030002 100644
--- slideshow/source/inc/tools.hxx
+++ slideshow/source/inc/tools.hxx
@@ -289,6 +289,9 @@ namespace slideshow
         /** Convert a plain UNO API 32 bit int to RGBColor
          */
         RGBColor unoColor2RGBColor( sal_Int32 );
+        /** Convert an IntSRGBA to plain UNO API 32 bit int
+         */
+        sal_Int32 RGBAColor2UnoColor( cppcanvas::Color::IntSRGBA );
 
         /** Fill a plain rectangle on the given canvas with the given color
          */
diff --git slideshow/source/inc/userpainteventhandler.hxx slideshow/source/inc/userpainteventhandler.hxx
index e0eb959..67ce28b 100644
--- slideshow/source/inc/userpainteventhandler.hxx
+++ slideshow/source/inc/userpainteventhandler.hxx
@@ -51,8 +51,12 @@ namespace slideshow
         {
         public:
             virtual ~UserPaintEventHandler() {}
-
             virtual bool colorChanged( RGBColor const& rUserColor ) = 0;
+        virtual bool widthChanged( double nUserStrokeWidth ) = 0;
+        virtual bool eraseAllInkChanged(bool const& rEraseAllInk) =0;
+        virtual bool eraseInkWidthChanged(sal_Int32 rEraseInkSize) =0;
+        virtual bool switchEraserMode() = 0;
+        virtual bool switchPenMode() = 0;
             virtual bool disable() = 0;
         };
 
diff --git solenv/bin/deliver.pl solenv/bin/deliver.pl
index 3f22fa4..22ad62c 100755
--- solenv/bin/deliver.pl
+++ solenv/bin/deliver.pl
@@ -11,7 +11,7 @@ eval 'exec perl -wS $0 ${1+"$@"}'
 #
 # $RCSfile: deliver.pl,v $
 #
-# $Revision$
+# $Revision: 275594 $
 #
 # This file is part of OpenOffice.org.
 #
@@ -47,7 +47,7 @@ use File::Spec;
 
 ( $script_name = $0 ) =~ s/^.*\b(\w+)\.pl$/$1/; 
 
-$id_str = ' $Revision$ ';
+$id_str = ' $Revision: 275594 $ ';
 $id_str =~ /Revision:\s+(\S+)\s+\$/
   ? ($script_rev = $1) : ($script_rev = "-");
 
diff --git solenv/bin/modules/installer/download.pm solenv/bin/modules/installer/download.pm
index 16fd87d..b7f9d26 100644
--- solenv/bin/modules/installer/download.pm
+++ solenv/bin/modules/installer/download.pm
@@ -472,7 +472,8 @@ sub get_downloadname_start
 {
     my ($allvariables) = @_;
 
-    my $start = "OOo";
+        my $start = "OOo4Kids";
+
     if ( $allvariables->{'PRODUCTNAME'} eq "BrOffice.org" ) { $start = "BrOo"; }
 
     return $start;
diff --git solenv/bin/modules/installer/epmfile.pm solenv/bin/modules/installer/epmfile.pm
index ec3bbb7..f69a8bc 100644
--- solenv/bin/modules/installer/epmfile.pm
+++ solenv/bin/modules/installer/epmfile.pm
@@ -334,11 +334,11 @@ sub create_epm_header
     my $line = "";
     my $infoline = "";
         
-    # %product OpenOffice.org Software
+    # %product OOo4Kids Software
     # %version 2.0
     # %description A really great software
     # %copyright 1999-2003 by OOo
-    # %vendor OpenOffice.org
+    # %vendor OOo4Kids
     # %license /test/replace/01/LICENSE01
     # %readme /test/replace/01/README01
     # %requires foo
@@ -553,11 +553,11 @@ sub create_epm_header
                 }
             }
 
-            if ( $installer::globals::debian && $variableshashref->{'UNIXPRODUCTNAME'} eq 'openoffice.org' )
+            if ( $installer::globals::debian && $variableshashref->{'UNIXPRODUCTNAME'} eq 'OOo4Kids' )
             {
-                $line = "%provides" . " openoffice.org-unbundled\n";
+                $line = "%provides" . " OOo4Kids-unbundled\n";
                 push(@epmheader, $line);
-                $line = "%incompat" . " openoffice.org-bundled\n";
+                $line = "%incompat" . " OOo4Kids-bundled\n";
                 push(@epmheader, $line);
             }
         }
@@ -756,7 +756,7 @@ sub replace_many_variables_in_shellscripts
     {
         my $value = $variableshashref->{$key};
         if ( ! $value =~ /.oxt/ ) { $value = lc($value); } 	# lowercase !
-        if ( $installer::globals::issolarisbuild) { $value =~ s/\.org/org/g; }	# openofficeorg instead of openoffice.org
+        if ( $installer::globals::issolarisbuild) { $value =~ s/\.org/org/g; }	# openofficeorg instead of OOo4Kids
         replace_variable_in_shellscripts($scriptref, $value, $key);
     }
 }
@@ -880,7 +880,7 @@ sub set_patch_state
     while (<EPMPATCH>)
     {
         chop;
-        if ( $_ =~ /Patched for OpenOffice.org/ ) { $installer::globals::is_special_epm = 1; }
+        if ( $_ =~ /Patched / ) { $installer::globals::is_special_epm = 1; }
     }
             
     close (EPMPATCH);
@@ -2537,6 +2537,7 @@ sub create_packages_without_epm
 
         my $target = "";
         if ( $installer::globals::compiler =~ /unxlngi/) { $target = "i586"; }
+        elsif ( $installer::globals::compiler =~ /unxlngm/) {$target ="mipsel"; }
         elsif ( $installer::globals::compiler =~ /unxlng/) {$target = (POSIX::uname())[4]; }
         
         # rpm 4.6 ignores buildroot tag in spec file
@@ -2548,6 +2549,7 @@ sub create_packages_without_epm
             my $dir = getcwd;
             my $buildroot = $dir . "/" . $epmdir . "buildroot/";
             $buildrootstring = "--buildroot=$buildroot";
+            mkdir($buildroot = $dir . "/" . $epmdir . "BUILD/");
         } 
 
         my $systemcall = "$rpmcommand -bb --define \"_unpackaged_files_terminate_build  0\" $specfilename --target $target $buildrootstring 2\>\&1 |";
@@ -2723,6 +2725,15 @@ sub remove_temporary_epm_files
 
         my $returnvalue = system($systemcall);
 
+        $removedir = $epmdir . "BUILD";
+    
+        $systemcall = "rm -rf $removedir";
+        
+        installer::logger::print_message( "... $systemcall ...\n" );
+
+        $returnvalue = system($systemcall);
+
+
         my $infoline = "Systemcall: $systemcall\n";
         push( @installer::globals::logfileinfo, $infoline);
         
@@ -2781,6 +2792,9 @@ sub create_new_directory_structure
         if ( $installer::globals::compiler =~ /unxlngi/) { 
                     $rpmdir = "$installer::globals::epmoutpath/RPMS/i586";
                 }
+        elsif ( $installer::globals::compiler =~ /unxlngm/) { 
+                    $rpmdir = "$installer::globals::epmoutpath/RPMS/mipsel";
+        }
         elsif ( $installer::globals::compiler =~ /unxlng/) { 
                     $machine = (POSIX::uname())[4]; 
                     $rpmdir = "$installer::globals::epmoutpath/RPMS/$machine"; 
@@ -2814,6 +2828,7 @@ sub create_new_directory_structure
         installer::systemactions::remove_empty_directory("$installer::globals::epmoutpath/RPMS/x86_64");
         installer::systemactions::remove_empty_directory("$installer::globals::epmoutpath/RPMS/i586");
         installer::systemactions::remove_empty_directory("$installer::globals::epmoutpath/RPMS/i386");
+        installer::systemactions::remove_empty_directory("$installer::globals::epmoutpath/RPMS/mipsel");
         installer::systemactions::remove_empty_directory("$installer::globals::epmoutpath/RPMS");
 
     }
@@ -3099,7 +3114,8 @@ sub put_systemintegration_into_installset
         push( @installer::globals::logfileinfo, $infoline);
 
         my $sourcepathref = installer::scriptitems::get_sourcepath_from_filename_and_includepath(\$packagetarfilename, $includepatharrayref, 1);
-        if ( $$sourcepathref eq "" ) { installer::exiter::exit_program("ERROR: Source path not found for $packagetarfilename!", "copy_systemintegration_files"); }
+        
+#		if ( $$sourcepathref eq "" ) { installer::exiter::exit_program("ERROR: sourcepathref is $sourcepathref , and Source path not found for $packagetarfilename!", "copy_systemintegration_files"); }
 
         # Collecting all packages in directory "packages" or "RPMS"
         my $oldcontent = installer::systemactions::read_directory($destdir);
@@ -3189,7 +3205,7 @@ sub analyze_rootpath
     if ( $installer::globals::islinuxdebbuild )
     {
         $$relocatablepathref = "";
-        # $$staticpathref is already "/opt/openoffice.org3", no additional $rootpath required.
+        # $$staticpathref is already "/opt/OOo4Kids3", no additional $rootpath required.
         # $$staticpathref = $rootpath . $installer::globals::separator . $$staticpathref;  # no relocatibility for Debian
     }
         
@@ -3381,7 +3397,7 @@ sub finalize_linux_patch
     my $productname = $allvariables->{'PRODUCTNAME'};
     $productname = lc($productname);
     $productname =~ s/ /_/g;	# abc office -> abc_office
-#	$productname =~ s/\.//g;	# openoffice.org -> openofficeorg
+#	$productname =~ s/\.//g;	# OOo4Kids -> openofficeorg
 
     $infoline = "Adding productname $productname into Linux patch script\n";
     push( @installer::globals::logfileinfo, $infoline);
diff --git solenv/bin/modules/installer/globals.pm solenv/bin/modules/installer/globals.pm
index 2eba722..c765920 100644
--- solenv/bin/modules/installer/globals.pm
+++ solenv/bin/modules/installer/globals.pm
@@ -171,7 +171,7 @@ BEGIN
     $msilanguage = "";	# hash reference for msi languages LCID
     $sofficeiconadded = 0;
     $temppath = "";
-    $globaltempdirname = "ooopackaging";
+    $globaltempdirname = "ooo4kidspackaging";
     $cyg_temppath = "";
     $temppathdefined = 0;
     $jdstemppathdefined = 0;
@@ -201,7 +201,15 @@ BEGIN
     $upx_in_path = 0;
     $upxfile = "";
     $simple = 0;
+
+    if (( $ENV{OOo4Kids} eq "YES" ) && ( $ENV{OS} eq "LINUX" ))
+    {
+        $simpledefaultuserdir = "\$SYSUSERCONFIG";
+    }
+    else
+    {
     $simpledefaultuserdir = "\$ORIGIN/..";
+    }
     $call_epm = 1;
     $packageformat = "";
     $packagename = "";
diff --git solenv/bin/modules/installer/servicesfile.pm solenv/bin/modules/installer/servicesfile.pm
index 393802c..fff2ce6 100644
--- solenv/bin/modules/installer/servicesfile.pm
+++ solenv/bin/modules/installer/servicesfile.pm
@@ -199,6 +199,12 @@ sub call_regcomp
 
 sub register_javacomponents
 {
+    my $build_env = $ENV{OOo4Kids};
+
+    my $error_occured = 0;
+
+    if (!($build_env eq "YES"))
+    {
     my ($allvariableshashref, $javacomponents, $regcompfileref, $servicesfile, $regcomprdb, $javaservicesurlprefix) = @_;
 
     installer::logger::include_header_into_logfile("Registering Java components:");
@@ -208,7 +214,6 @@ sub register_javacomponents
     installer::pathanalyzer::get_path_from_fullqualifiedname($ure_internal_java_dir_ref);
     if ( $$ure_internal_java_dir_ref eq "" ) { installer::exiter::exit_program("Could not determine URE_INTERNAL_JAVA_DIR when registering Java components!", "register_javacomponents"); }
 
-    my $error_occured = 0;
 
     my $do_register = 1;
     if (!( $installer::globals::solarjava )) { $do_register = 0; }
@@ -260,7 +265,7 @@ sub register_javacomponents
             }
         }
     }
-    
+    }
     return $error_occured;
 }
 
diff --git solenv/bin/modules/installer/windows/msp.pm solenv/bin/modules/installer/windows/msp.pm
index 75846f9..6d9dd69 100644
--- solenv/bin/modules/installer/windows/msp.pm
+++ solenv/bin/modules/installer/windows/msp.pm
@@ -701,7 +701,20 @@ sub change_patchmetadata_table
     if ( $allvariables->{'PROPERTYTABLEPRODUCTNAME'} ) { $targetproductnamevalue = $allvariables->{'PROPERTYTABLEPRODUCTNAME'}; }
 
     my $manufacturerstring = "ManufacturerName";
+
+    # MUST be initialized
+    my $manufacturervalue = "OOo4Kids";
+
+    my $build_OOo4Kids = $ENV{OOo4Kids};
+
+    if( ( $build_OOo4Kids eq "YES" ) )
+    {
+        my $manufacturervalue = "OOo4Kids";
+    }
+    else
+    {
     my $manufacturervalue = "OpenOffice.org";
+    }
     if ( $installer::globals::longmanufacturer ) { $manufacturervalue = $installer::globals::longmanufacturer; }
 
     my $displaynamestring = "DisplayName";
diff --git solenv/bin/modules/installer/windows/sign.pm solenv/bin/modules/installer/windows/sign.pm
index 5d7209b..7f4f47c 100644
--- solenv/bin/modules/installer/windows/sign.pm
+++ solenv/bin/modules/installer/windows/sign.pm
@@ -120,9 +120,9 @@ sub check_system_path
 {
     # The following files have to be found in the environment variable PATH
     # Only, if \"-sign\" is used.
-    # Windows : "msicert.exe", "diff.exe", "msidb.exe", "signtool.exe"
+    # Windows : "msicert.exe", "msidb.exe", "signtool.exe"
 
-    my @needed_files_in_path = ("msicert.exe", "msidb.exe", "signtool.exe", "diff.exe");
+    my @needed_files_in_path = ("msicert.exe", "msidb.exe", "signtool.exe");
     if ( $installer::globals::internal_cabinet_signing )
     {
         push(@needed_files_in_path, "cabarc.exe");
@@ -307,34 +307,6 @@ sub get_hash_count
 }
 
 ############################################################
-# Collect all last files in a cabinet file. This is 
-# necessary to control, if the cabinet file was damaged
-# by calling signtool.exe.
-############################################################
-
-sub analyze_file_file
-{
-    my ($filecontent) = @_;
-
-    my %filenamehash = ();
-
-    for ( my $i = 0; $i <= $#{$filecontent}; $i++ )
-    {
-        if ( $i < 3 ) { next; }
-
-        if ( ${$filecontent}[$i] =~ /^\s*(.*?)\t(.*?)\t(.*?)\t(.*?)\t(.*?)\t(.*?)\t(.*?)\t(.*?)\s*$/ )
-        {
-            my $name = $1;
-            my $sequence = $8;
-
-            $filenamehash{$sequence} = $name;
-        }
-    }
-
-    return ( \%filenamehash );
-}
-
-############################################################
 # Collect all DiskIds to the corresponding cabinet files.
 ############################################################
 
@@ -343,7 +315,6 @@ sub analyze_media_file
     my ($filecontent) = @_;
     
     my %diskidhash = ();
-    my %lastsequencehash = ();
 
     for ( my $i = 0; $i <= $#{$filecontent}; $i++ )
     {
@@ -352,15 +323,13 @@ sub analyze_media_file
         if ( ${$filecontent}[$i] =~ /^\s*(.*?)\t(.*?)\t(.*?)\t(.*?)\t(.*?)\t(.*?)\s*$/ )
         {
             my $diskid = $1;
-            my $lastsequence = $2;
             my $cabfile = $4;
 
             $diskidhash{$cabfile} = $diskid;
-            $lastsequencehash{$cabfile} = $lastsequence;
         }
     }
 
-    return ( \%diskidhash, \%lastsequencehash );
+    return \%diskidhash;
 }
 
 ########################################################
@@ -373,20 +342,15 @@ sub collect_diskid_from_media_table
     
     # creating working directory
     my $workdir = installer::systemactions::create_directories("media", \$languagestring);
-    installer::windows::admin::extract_tables_from_pcpfile($msidatabase, $workdir, "Media File");
+    installer::windows::admin::extract_tables_from_pcpfile($msidatabase, $workdir, "Media");
 
     # Reading tables
     my $filename = $workdir . $installer::globals::separator . "Media.idt";
     if ( ! -f $filename ) { installer::exiter::exit_program("ERROR: Could not find required file: $filename !", "collect_diskid_from_media_table"); }
     my $filecontent = installer::files::read_file($filename);
-    my ( $diskidhash, $lastsequencehash ) = analyze_media_file($filecontent);
-
-    $filename = $workdir . $installer::globals::separator . "File.idt";
-    if ( ! -f $filename ) { installer::exiter::exit_program("ERROR: Could not find required file: $filename !", "collect_diskid_from_media_table"); }
-    $filecontent = installer::files::read_file($filename);
-    my $filenamehash = analyze_file_file($filecontent);
+    my $diskidhash = analyze_media_file($filecontent);
 
-    return ( $diskidhash, $filenamehash, $lastsequencehash );
+    return $diskidhash;
 }
 
 ########################################################
@@ -465,7 +429,7 @@ sub analyze_installset_content
 
     if ( $msidatabase ne "" ) { $contains_msidatabase = 1; }
 
-    return (\%allcabfileshash, \%allfileshash, $msidatabase, $contains_external_cabfiles, $contains_msidatabase, \@sourcefiles);
+    return (\%allcabfileshash, \%allfileshash, $msidatabase, $contains_external_cabfiles, $contains_msidatabase);
 }
 
 ########################################################
@@ -481,8 +445,6 @@ sub msicert_database
 
     foreach my $cabfile ( keys %{$allcabfiles} )
     {
-        my $origfilesize = -s $cabfile;
-        
         my $mediacabfilename = $cabfile;
         if ( $internalcabfile ) { $mediacabfilename = "\#" . $mediacabfilename; }
         if ( ! exists($cabfilehash->{$mediacabfilename}) ) { installer::exiter::exit_program("ERROR: Could not determine DiskId from media table for cabinet file \"$cabfile\" !", "msicert_database"); }
@@ -491,168 +453,18 @@ sub msicert_database
         my $systemcall = "msicert.exe -d $msidatabase -m $diskid -c $cabfile -h";
          $success = make_systemcall($systemcall, $systemcall);
         if ( ! $success ) { $fullsuccess = 0; }
-
-        # size of cabinet file must not change		
-        my $finalfilesize = -s $cabfile;
-        
-        if ( $origfilesize != $finalfilesize ) { installer::exiter::exit_program("ERROR: msicert.exe changed size of cabinet file !", "msicert_database"); }
     }
     
     return $fullsuccess;
 }
 
 ########################################################
-# Checking if cabinet file was broken by signtool.
-########################################################
-
-sub cabinet_cosistency_check
-{
-    my ( $onefile, $followmeinfohash, $filenamehash, $lastsequencehash, $temppath ) = @_;
-    
-    my $infoline = "Making consistency check of $onefile\n"; 
-    push( @installer::globals::logfileinfo, $infoline);
-    my $expandfile = "expand.exe";	# Has to be in the path
-
-    if ( $^O =~ /cygwin/i )
-    {
-        $expandfile = qx(cygpath -u "$ENV{WINDIR}"/System32/expand.exe);
-        chomp $expandfile;
-    }
-             
-    if ( $filenamehash == 0 )
-    {
-        $infoline = "Warning: Stopping consistency check: Important hash of filenames is empty!\n";
-        push( @installer::globals::logfileinfo, $infoline);
-    }
-    elsif  ( $lastsequencehash == 0 )
-    {
-        $infoline = "Warning: Stopping consistency check; Important hash of last sequences is empty!\n";
-        push( @installer::globals::logfileinfo, $infoline);	 			
-    }
-    else # both hashes are available
-    {
-        # $onefile contains only the name of the cabinet file without path
-         my $sequence = $lastsequencehash->{$onefile};
-         my $lastfile = $filenamehash->{$sequence};
-        $infoline = "Check of $onefile: Sequence: $sequence is file: $lastfile\n";
-        push( @installer::globals::logfileinfo, $infoline);
-                 
-         # Therefore the file $lastfile need to be binary compared.
-         # It has to be expanded from the cabinet file
-         # of the original installation set and from the
-         # newly signed cabinet file.
-         
-        # How about cabinet files extracted from msi database?
-        my $finalinstalldir = $followmeinfohash->{'finalinstalldir'};
-        
-        $finalinstalldir =~ s/\\\s*$//;
-        $finalinstalldir =~ s/\/\s*$//;
-        my $sourcecabfile = $finalinstalldir . $installer::globals::separator . $onefile;
-        my $currentpath = cwd();
-        my $destcabfile = $currentpath . $installer::globals::separator . $onefile;
-        # my $destcabfile = $onefile;
-        
-        if ( $^O =~ /cygwin/i )
-        {
-            chomp( $destcabfile = qx{cygpath -w "$destcabfile"} );
-            $destcabfile =~ s/\\/\//g;
-        }
-
-        if ( ! -f $sourcecabfile ) 
-        {
-            $infoline = "WARNING: Check of cab file cannot happen, because source cabinet file was not found: $sourcecabfile\n";
-            push( @installer::globals::logfileinfo, $infoline);	
-        }
-        elsif ( ! -f $destcabfile ) 
-        {
-            $infoline = "WARNING: Check of cab file cannot happen, because destination cabinet file was not found: $sourcecabfile\n";
-            push( @installer::globals::logfileinfo, $infoline);				
-        }
-        else # everything is okay for the check
-        {
-            my $diffpath = get_diff_path($temppath);
-        
-            my $origdiffpath = $diffpath . $installer::globals::separator . "orig";
-            my $newdiffpath = $diffpath . $installer::globals::separator . "new";
-        
-            if ( ! -d $origdiffpath ) { mkdir($origdiffpath); }
-            if ( ! -d $newdiffpath ) { mkdir($newdiffpath); }
-
-            my $systemcall = "$expandfile $sourcecabfile $origdiffpath -f:$lastfile ";
-            $infoline = $systemcall . "\n";
-            push( @installer::globals::logfileinfo, $infoline);
-
-            my $success = make_systemcall($systemcall, $systemcall);
-            if ( ! $success ) { installer::exiter::exit_program("ERROR: Could not successfully execute: $systemcall !", "cabinet_cosistency_check"); }
-                
-            $systemcall = "$expandfile $destcabfile $newdiffpath -f:$lastfile ";
-            $infoline = $systemcall . "\n";
-            push( @installer::globals::logfileinfo, $infoline);
-        
-            $success = make_systemcall($systemcall, $systemcall);
-            if ( ! $success ) { installer::exiter::exit_program("ERROR: Could not successfully execute: $systemcall !", "cabinet_cosistency_check"); }
-
-            # and finally the two files can be diffed.
-            my $origfile = $origdiffpath . $installer::globals::separator . $lastfile; 
-            my $newfile = $newdiffpath . $installer::globals::separator . $lastfile;
-        
-            if ( ! -f $origfile ) { installer::exiter::exit_program("ERROR: Unpacked original file not found: $origfile !", "cabinet_cosistency_check"); }
-            if ( ! -f $newfile ) { installer::exiter::exit_program("ERROR: Unpacked new file not found: $newfile !", "cabinet_cosistency_check"); }
-        
-            my $origsize = -s $origfile;
-            my $newsize = -s $newfile;
-        
-            if ( $origsize != $newsize ) # This shows an error!
-            {			
-                $infoline = "ERROR: Different filesize after signtool.exe was used. Original: $origsize Bytes, new: $newsize. File: $lastfile\n";
-                push( @installer::globals::logfileinfo, $infoline);
-                installer::exiter::exit_program("ERROR: The cabinet file $destcabfile is broken after signtool.exe signed this file !", "cabinet_cosistency_check");
-            }
-            else
-            {
-                $infoline = "Same size of last file in cabinet file after usage of signtool.exe: $newsize (File: $lastfile)\n";
-                push( @installer::globals::logfileinfo, $infoline);
-
-                # Also making a binary diff?
-
-                my $difffile = "diff.exe";  # has to be in the path
-                # $systemcall = "$difffile $sourcecabfile $destcabfile";  # Test for differences
-                $systemcall = "$difffile $origfile $newfile";
-                $infoline = $systemcall . "\n";
-                $returnvalue = make_systemcall($systemcall, $systemcall);
-
-                my $success = $?;
-
-                if ( $success == 0 )
-                {
-                    $infoline = "Last files are identical after signing cabinet file (File: $lastfile)\n";
-                    push( @installer::globals::logfileinfo, $infoline);
-                }
-                elsif ( $success == 1 )
-                {
-                    $infoline = "ERROR: Last files are different after signing cabinet file (File: $lastfile)\n";
-                    push( @installer::globals::logfileinfo, $infoline);				
-                    installer::exiter::exit_program("ERROR: Last files are different after signing cabinet file (File: $lastfile)!", "cabinet_cosistency_check");
-                }		
-                else
-                {
-                    $infoline = "ERROR: Problem occured calling diff.exe (File: $lastfile)\n";
-                    push( @installer::globals::logfileinfo, $infoline);								
-                    installer::exiter::exit_program("ERROR: Problem occured calling diff.exe (File: $lastfile) !", "cabinet_cosistency_check");
-                }
-            }
-        }		
-    }	
-
-}
-
-########################################################
 # Signing a list of files
 ########################################################
 
 sub sign_files
 {
-    my ( $followmeinfohash, $allfiles, $pw, $cabinternal, $filenamehash, $lastsequencehash, $temppath ) = @_;
+    my ( $followmeinfohash, $allfiles, $pw, $cabinternal ) = @_;
     
     my $infoline = "";
     my $fullsuccess = 1;
@@ -696,12 +508,6 @@ sub sign_files
              $counter++;
          }
          
-         # Special check for cabinet files, that sometimes get damaged by signtool.exe
-         if (( $success ) && ( $onefile =~ /\.cab\s*$/ ) && ( ! $cabinternal ))
-         {
-             cabinet_cosistency_check($onefile, $followmeinfohash, $filenamehash, $lastsequencehash, $temppath);
-        }
-
          if ( ! $success )
          {
              $fullsuccess = 0;
@@ -764,21 +570,6 @@ sub get_cab_path
 }
 
 #################################################################
-# Setting the path, where the diff can happen.
-#################################################################
-
-sub get_diff_path
-{
-    my ($temppath) = @_;
-
-    my $diffpath = "diff_" . $$;
-    $diffpath = $temppath . $installer::globals::separator . $diffpath;
-    if ( ! -d $diffpath ) { installer::systemactions::create_directory($diffpath); }
-
-    return $diffpath;	
-}
-
-#################################################################
 # Exclude all cab files from the msi database.
 #################################################################
 
@@ -1097,7 +888,7 @@ sub sign_files_in_cabinet_files
                 $allfileshash{$onefile} = 1;
             }
         }
-         $success = sign_files($followmeinfohash, \%allfileshash, $pw, 1, 0, 0, $temppath);
+ 		$success = sign_files($followmeinfohash, \%allfileshash, $pw, 1);
         if ( ! $success ) { $complete_success = 0; }
 
         chdir($from);
@@ -1110,44 +901,6 @@ sub sign_files_in_cabinet_files
 }
 
 ########################################################
-# Comparing the content of two directories.
-# Only filesize is compared.
-########################################################
-
-sub compare_directories
-{
-    my ( $dir1, $dir2, $files ) = @_;
-    
-    $dir1 =~ s/\\\s*//;
-    $dir2 =~ s/\\\s*//;
-    $dir1 =~ s/\/\s*//;
-    $dir2 =~ s/\/\s*//;
-
-    my $infoline = "Comparing directories: $dir1 and $dir2\n";
-    push( @installer::globals::logfileinfo, $infoline);
-    
-    foreach my $onefile ( @{$files} )
-    {
-        my $file1 = $dir1 . $installer::globals::separator . $onefile;
-        my $file2 = $dir2 . $installer::globals::separator . $onefile;
-        
-        if ( ! -f $file1 ) { installer::exiter::exit_program("ERROR: Missing file : $file1!", "compare_directories"); }
-        if ( ! -f $file2 ) { installer::exiter::exit_program("ERROR: Missing file : $file2!", "compare_directories"); }
-
-        my $size1 = -s $file1;
-        my $size2 = -s $file2;
-
-        $infoline = "Comparing files: $file1 ($size1) and $file2 ($size2)\n";
-        push( @installer::globals::logfileinfo, $infoline);
-        
-        if ( $size1 != $size2 )
-        {
-            installer::exiter::exit_program("ERROR: File defect after copy (different size) $file1 ($size1 bytes) and $file2 ($size2 bytes)!", "compare_directories");
-        }
-    }
-}
-
-########################################################
 # Signing an existing Windows installation set.
 ########################################################
 
@@ -1176,9 +929,7 @@ sub sign_install_set
     else { $installsetpath = rename_install_set($installsetpath); }
     
     # collecting all files in the installation set 
-    my ($allcabfiles, $allfiles, $msidatabase, $contains_external_cabfiles, $contains_msidatabase, $sourcefiles) = analyze_installset_content($installsetpath);
-
-    if ( $make_copy ) { compare_directories($installsetpath, $followmeinfohash->{'finalinstalldir'}, $sourcefiles); }
+    my ($allcabfiles, $allfiles, $msidatabase, $contains_external_cabfiles, $contains_msidatabase) = analyze_installset_content($installsetpath);
 
     # changing into installation set
     my $from = cwd();
@@ -1196,7 +947,7 @@ sub sign_install_set
     if ( $contains_msidatabase )
     {
         # exclude media table from msi database and get all diskids.
-        my ( $cabfilehash, $filenamehash, $lastsequencehash ) = collect_diskid_from_media_table($msidatabase, $followmeinfohash->{'languagestring'});
+        my $cabfilehash = collect_diskid_from_media_table($msidatabase, $followmeinfohash->{'languagestring'});
 
         # Check, if there are internal cab files 
         my ( $contains_internal_cabfiles, $all_internal_cab_files) = check_for_internal_cabfiles($cabfilehash);
@@ -1212,7 +963,7 @@ sub sign_install_set
 
             if ( $installer::globals::internal_cabinet_signing ) { sign_files_in_cabinet_files($followmeinfohash, $all_internal_cab_files, $pw, $temppath); }
 
-            $success = sign_files($followmeinfohash, $all_internal_cab_files, $pw, 0, $filenamehash, $lastsequencehash, $temppath);
+            $success = sign_files($followmeinfohash, $all_internal_cab_files, $pw, 0);
             if ( ! $success ) { $complete_success = 0; }
             $success = msicert_database($fullmsidatabase, $all_internal_cab_files, $cabfilehash, 1);
             if ( ! $success ) { $complete_success = 0; }
@@ -1229,7 +980,7 @@ sub sign_install_set
         {
             if ( $installer::globals::internal_cabinet_signing ) { sign_files_in_cabinet_files($followmeinfohash, $allcabfiles, $pw, $temppath); }
 
-            $success = sign_files($followmeinfohash, $allcabfiles, $pw, 0, $filenamehash, $lastsequencehash, $temppath);
+            $success = sign_files($followmeinfohash, $allcabfiles, $pw, 0);
             if ( ! $success ) { $complete_success = 0; }
             $success = msicert_database($msidatabase, $allcabfiles, $cabfilehash, 0);
             if ( ! $success ) { $complete_success = 0; }
@@ -1237,7 +988,7 @@ sub sign_install_set
     }
 
     # finally all other files can be signed
-    $success = sign_files($followmeinfohash, $allfiles, $pw, 0, 0, 0, $temppath);
+    $success = sign_files($followmeinfohash, $allfiles, $pw, 0);
     if ( ! $success ) { $complete_success = 0; }
     
     # and changing back
diff --git solenv/bin/modules/installer/ziplist.pm solenv/bin/modules/installer/ziplist.pm
index 31f439f..3151241 100644
--- solenv/bin/modules/installer/ziplist.pm
+++ solenv/bin/modules/installer/ziplist.pm
@@ -646,8 +646,9 @@ sub set_manufacturer
 {
     my ($allvariables) = @_;
     
-    my $openofficeproductname = "OpenOffice.org";
-    my $sunname = "Sun Microsystems";
+    # those values MUST be initialized
+    my $openofficeproductname = "OOo4Kids";
+    my $sunname = "";
     
     if ( $allvariables->{'OPENSOURCE'} && $allvariables->{'OPENSOURCE'} == 1 )
     {
diff --git solenv/bin/modules/packager/globals.pm solenv/bin/modules/packager/globals.pm
index 7a50453..ca9d406 100644
--- solenv/bin/modules/packager/globals.pm
+++ solenv/bin/modules/packager/globals.pm
@@ -38,8 +38,14 @@ package packager::globals;
 BEGIN
 {	
     $prog="packager";
-
+    if ( $ENV{'OOo4Kids'} eq "YES")
+    {
+        $packlistname = "pack-OOo4Kids.lst";
+    }
+    else
+    {
     $packlistname = "pack.lst";
+    }
     $compiler = "";
     $ignoreerrors = 0;
 
diff --git solenv/inc/minor.mk solenv/inc/minor.mk
index 4daaff9..a57837c 100644
--- solenv/inc/minor.mk
+++ solenv/inc/minor.mk
@@ -1,5 +1,5 @@
-RSCVERSION=320
-RSCREVISION=320m12(Build:9483)
-BUILD=9483
-LAST_MINOR=m12
-SOURCEVERSION=OOO320
+RSCVERSION=0.9
+RSCREVISION=0.9m12(Build:001)
+BUILD=07
+LAST_MINOR=r493
+SOURCEVERSION=O4K090
diff --git solenv/inc/settings.mk solenv/inc/settings.mk
index cefa580..1ae07eb 100644
--- solenv/inc/settings.mk
+++ solenv/inc/settings.mk
@@ -1167,6 +1167,10 @@ CDEFS+=-DENABLE_LAYOUT_EXPERIMENTAL=1
 CFLAGS+=-DENABLE_LAYOUT_EXPERIMENTAL=0
 .ENDIF # ENABLE_LAYOUT_EXPERIMENTAL != TRUE
 
+.IF "$(ENABLE_GSTREAMER)" == "TRUE"
+CDEFS+=-DGSTREAMER
+.ENDIF
+
 # compose flags and defines for GUI
 .IF "$(TARGETTYPE)"=="GUI"
 CDEFS+= $(CDEFSGUI)
diff --git solenv/inc/shlinfo.rc solenv/inc/shlinfo.rc
index c114458..e05d5db 100644
--- solenv/inc/shlinfo.rc
+++ solenv/inc/shlinfo.rc
@@ -75,11 +75,11 @@ VS_VERSION_INFO versioninfo
 			block "040704E4"
 			{
 				// German StringTable
-				value "CompanyName",		"OpenOffice.org\0"
+                value "CompanyName",		"OOo4Kids\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	PPS(ORG_NAME) "\0"
 				value "InternalName", 		PPS(INTERNAL_NAME) "\0"
-				value "LegalCopyright",		S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "LegalCopyright",		S_CRIGHT " EducOO.org\0"
 				ADDITIONAL_VERINFO1
 				ADDITIONAL_VERINFO2
 				ADDITIONAL_VERINFO3
@@ -88,11 +88,11 @@ VS_VERSION_INFO versioninfo
 			block "040904E4"
 			{
 				// International StringTable
-				value "CompanyName",		"OpenOffice.org\0"
+                value "CompanyName",		"OOo4Kids\0"
 				value "FileVersion",		PPS(VER_LEVEL) "\0"
 				value "OriginalFilename",	PPS(ORG_NAME) "\0"
 				value "InternalName", 		PPS(INTERNAL_NAME) "\0"
-				value "LegalCopyright", 	S_CRIGHT " Sun Microsystems, Inc.\0"
+                value "LegalCopyright", 	S_CRIGHT " EducOOo.org\0"
 				ADDITIONAL_VERINFO1
 				ADDITIONAL_VERINFO2
 				ADDITIONAL_VERINFO3
diff --git solenv/inc/unxlng.mk solenv/inc/unxlng.mk
index a79d3e4..25407bf 100644
--- solenv/inc/unxlng.mk
+++ solenv/inc/unxlng.mk
@@ -42,6 +42,11 @@ ARCH_FLAGS*=
 PICSWITCH*:=-fpic
 JAVAFLAGSDEBUG=-g
 
+# Building OOo4Kids 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS+=-DOOo4Kids
+.ENDIF
+
 # filter for supressing verbose messages from linker
 #not needed at the moment
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)/bin/msg_filter"
diff --git solenv/inc/unxlngi6.mk solenv/inc/unxlngi6.mk
index be55ef6..40f6ae0 100644
--- solenv/inc/unxlngi6.mk
+++ solenv/inc/unxlngi6.mk
@@ -48,6 +48,10 @@ CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D
 CDEFS += -DHAVE_GCC_VISIBILITY_FEATURE
 .ENDIF # "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS+=-DOOo4Kids
+.ENDIF
+
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
 JAVADEF=-DSOLAR_JAVA
@@ -135,7 +139,10 @@ CFLAGSWERRCC=-Werror
 # COMPILER_WARN_ERRORS=TRUE here instead of setting MODULES_WITH_WARNINGS (see
 # settings.mk):
 MODULES_WITH_WARNINGS := \
-    soldep
+    soldep \
+    jvmaccess \
+    soltools
+
 
 # switches for dynamic and static linking
 STATIC		= -Wl,-Bstatic
diff --git solenv/inc/unxlngmips.mk solenv/inc/unxlngmips.mk
index c4510ec..0cc9543 100644
--- solenv/inc/unxlngmips.mk
+++ solenv/inc/unxlngmips.mk
@@ -27,11 +27,12 @@
 # <http://www.openoffice.org/license.html>
 # for a copy of the LGPLv3 License.
 #
+#
 #*************************************************************************
-
 # mk file for Unix Linux Mips using GCC, please make generic modifications to unxlng.mk
 
-CDEFAULTOPT=-Os
+CDEFAULTOPT*=-Os
 .INCLUDE : unxlng.mk
 CDEFS+=-DMIPS
+ARCH_FLAGS+= -EL -march=mips2 -mtune=mips1
 DLLPOSTFIX=lm
diff --git solenv/inc/unxlngppc.mk solenv/inc/unxlngppc.mk
index 3a7a805..8df4222 100644
--- solenv/inc/unxlngppc.mk
+++ solenv/inc/unxlngppc.mk
@@ -29,7 +29,7 @@
 #
 #*************************************************************************
 
-# mk file for Unix Linux PowerPC using GCC, please make generic modifications to unxlng.mk
++ # mk file for Unix Linux PowerPC using GCC, please make generic modifications to unxlng.mk
 
 DEFAULTOPT=-Os
 PICSWITCH:=-fPIC
diff --git solenv/inc/unxlngppc4.mk solenv/inc/unxlngppc4.mk
index a9788c7..e68a3a1 100644
--- solenv/inc/unxlngppc4.mk
+++ solenv/inc/unxlngppc4.mk
@@ -47,6 +47,10 @@ CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_N
 CDEFS += -DHAVE_GCC_VISIBILITY_FEATURE
 .ENDIF # "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS += -DOOo4Kids
+.ENDIF
+
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
 JAVADEF=-DSOLAR_JAVA
diff --git solenv/inc/unxlngx6.mk solenv/inc/unxlngx6.mk
index c49e1c4..02bb404 100644
--- solenv/inc/unxlngx6.mk
+++ solenv/inc/unxlngx6.mk
@@ -48,6 +48,10 @@ CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DX86_64 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR
 CDEFS += -DHAVE_GCC_VISIBILITY_FEATURE
 .ENDIF # "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS+=-DOOo4Kids
+.ENDIF
+
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
 JAVADEF=-DSOLAR_JAVA
@@ -132,9 +136,20 @@ CFLAGSWERRCC=-Werror
 # COMPILER_WARN_ERRORS=TRUE here instead of setting MODULES_WITH_WARNINGS (see
 # settings.mk):
 
+.IF "$(OOo4kids)" != "YES"
 MODULES_WITH_WARNINGS := \
     soldep \
     svx
+.ELSE
+MODULES_WITH_WARNINGS := \
+    soldep \
+    svx \
+    vcl	\
+    jvmfwk \
+    jvmaccess \
+    connectivity \
+    xmloff
+.ENDIF
 
 # switches for dynamic and static linking
 STATIC		= -Wl,-Bstatic
diff --git solenv/inc/unxmacx.mk solenv/inc/unxmacx.mk
index 6cb113e..abb7850 100644
--- solenv/inc/unxmacx.mk
+++ solenv/inc/unxmacx.mk
@@ -52,10 +52,15 @@ CDEFS+=-DX_LOCALE
 # unless you want to do runtime checks for 10.5 api, you also want to use the 10.4 sdk
 # (safer/easier than dealing with the MAC_OS_X_VERSION_MAX_ALLOWED macro)
 # http://developer.apple.com/technotes/tn2002/tn2064.html
+
+.IF "$(OOo4Kids)" != "YES"
 MACOSX_DEPLOYMENT_TARGET=10.4
 .EXPORT: MACOSX_DEPLOYMENT_TARGET
 CDEFS+=-DQUARTZ 
 EXTRA_CDEFS*=-isysroot /Developer/SDKs/MacOSX10.4u.sdk
+.ELSE
+CDEFS+= -DQUARTZ -DOOo4Kids
+.ENDIF
 .ENDIF
 
 # Name of library where static data members are initialized
@@ -201,7 +206,11 @@ LINKC*=$(CC)
 
 LINKFLAGSDEFS*=-Wl,-multiply_defined,suppress
 # assure backwards-compatibility
+
+.IF "$(SYSTEM_LIBXML)" != "YES"
 EXTRA_LINKFLAGS*=-Wl,-syslibroot,/Developer/SDKs/MacOSX10.4u.sdk
+.ENDIF
+
 # Very long install_names are needed so that install_name_tool -change later on
 # does not complain that "larger updated load commands do not fit:"
 LINKFLAGSRUNPATH_URELIB=-install_name '@__________________________________________________URELIB/$(@:f)'
diff --git solenv/inc/version.hrc solenv/inc/version.hrc
index 5ddf2aa..65087c7 100644
--- solenv/inc/version.hrc
+++ solenv/inc/version.hrc
@@ -25,8 +25,8 @@
  *
  *************************************************************************/
 
-#define VERSION			3
-#define SUBVERSION		2
+#define VERSION			0
+#define SUBVERSION		8
 //#define VERVARIANT	0 // never define this one, will be provided by build environment (BUILD_ID)
 // .0 + VER_CONCEPT
 // .100 + VER_ALPHA
diff --git solenv/inc/wnt.mk solenv/inc/wnt.mk
index 6acab30..0814406 100644
--- solenv/inc/wnt.mk
+++ solenv/inc/wnt.mk
@@ -32,6 +32,9 @@
 # --- Windows-NT-Environment ---------------------------------------
 # Used if "$(GUI)" == "WNT"
 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS += -DOOo4Kids
+.ENDIF
 # --- Compiler ---
 
 .IF "$(OS)$(COM)$(CPU)" == "WNTMSCI"
diff --git solenv/inc/wntmsci10.mk solenv/inc/wntmsci10.mk
index 09ec567..4517696 100644
--- solenv/inc/wntmsci10.mk
+++ solenv/inc/wntmsci10.mk
@@ -31,6 +31,10 @@
 
 # mk file for $(OS)$(COM)$(CPU)$(COMEX) == WNTMSCI10
 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS += -DOOo4Kids
+.ENDIF
+
 SOLAR_JAVA*=TRUE
 FULL_DESK=TRUE
 JAVAFLAGSDEBUG=-g
diff --git solenv/inc/wntmsci11.mk solenv/inc/wntmsci11.mk
index 35fd293..e87fae2 100644
--- solenv/inc/wntmsci11.mk
+++ solenv/inc/wntmsci11.mk
@@ -31,6 +31,10 @@
 
 # mk file for $(OS)$(COM)$(CPU)$(COMEX) == WNTMSCI11 and WNTMSCI12
 
+.IF "$(OOo4Kids)"=="YES"
+CDEFS += -DOOo4Kids
+.ENDIF
+
 SOLAR_JAVA*=TRUE
 FULL_DESK=TRUE
 JAVAFLAGSDEBUG=-g
diff --git starmath/inc/rect.hxx starmath/inc/rect.hxx
index 472b03b..a7f3efe 100644
--- starmath/inc/rect.hxx
+++ starmath/inc/rect.hxx
@@ -39,6 +39,11 @@
 #include <vcl/metric.hxx>
 #include <tools/debug.hxx>
 
+#ifdef DEBUG
+// when defined, allows to draw rectangles for debugging
+#define SM_RECT_DEBUG
+#endif
+
 #include "format.hxx"
 
 
diff --git starmath/source/makefile.mk starmath/source/makefile.mk
index 53f6569..82e5888 100644
--- starmath/source/makefile.mk
+++ starmath/source/makefile.mk
@@ -40,6 +40,11 @@ LIBTARGET=NO
 
 # --- Settings -----------------------------------------------------
 
+#.IF "$(OOo4Kids)"=="YES"
+#dummy:
+#	@echo "Nothing to build"
+#.ENDIF
+
 .INCLUDE :  settings.mk
 
 # --- Files --------------------------------------------------------
diff --git starmath/source/node.cxx starmath/source/node.cxx
index 051542c..829e085 100644
--- starmath/source/node.cxx
+++ starmath/source/node.cxx
@@ -55,9 +55,6 @@
 #include <math.h>
 #include <float.h>
 
-// define this to draw rectangles for debugging
-//#define SM_RECT_DEBUG
-
 ////////////////////////////////////////
 // SmTmpDevice
 // Allows for font and color changes. The original settings will be restored
diff --git starmath/source/viewhdl.cxx starmath/source/viewhdl.cxx
new file mode 100644
index 0000000..bfd1394
--- /dev/null
+++ starmath/source/viewhdl.cxx
@@ -0,0 +1,170 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: viewhdl.cxx,v $
+ * $Revision: 1.10 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_starmath.hxx"
+
+
+#include <view.hxx>
+#include <comphelper/processfactory.hxx>
+#include <com/sun/star/lang/XMultiServiceFactory.hpp>
+#include <com/sun/star/datatransfer/clipboard/XClipboardListener.hpp>
+#include <com/sun/star/datatransfer/clipboard/XClipboardNotifier.hpp>
+#include <vos/mutex.hxx>
+#include <cppuhelper/implbase1.hxx>
+#include <svtools/transfer.hxx>
+#include <sfx2/bindings.hxx>
+#include <sfx2/sfxsids.hrc>
+
+using namespace ::com::sun::star;
+using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star::datatransfer::clipboard;
+
+// --------------------------- Clipboard EventListener ------------------
+
+class SmClipboardChangeListener : public ::cppu::WeakImplHelper1<
+    ::com::sun::star::datatransfer::clipboard::XClipboardListener >
+{
+    SmViewShell*	pView;
+
+    // XEventListener
+    virtual void SAL_CALL disposing(
+            const lang::EventObject& rEventObject ) throw ( ::com::sun::star::uno::RuntimeException)
+;//							throw( UNO_NMSPC::RuntimeException );
+
+    // XClipboardListener
+    virtual void SAL_CALL changedContents(
+            const datatransfer::clipboard::ClipboardEvent& rEventObject ) throw ( ::com::sun::star::uno::RuntimeException)
+;//										throw( UNO_NMSPC::RuntimeException );
+
+public:
+    SmClipboardChangeListener( SmViewShell& rView ) : pView( &rView ) {}
+    virtual	~SmClipboardChangeListener();
+
+    void ViewDestroyed() { pView = 0; }
+
+    void AddRemoveListener( BOOL bAdd );
+};
+
+
+
+// ------------------------- SmClipboardChangeListener ---------------------
+
+SmClipboardChangeListener::~SmClipboardChangeListener()
+{
+}
+
+void SAL_CALL SmClipboardChangeListener::disposing(
+                                    const lang::EventObject& /*rEventObject*/ ) throw ( ::com::sun::star::uno::RuntimeException)
+{
+}
+
+void SAL_CALL SmClipboardChangeListener::changedContents(
+                            const ClipboardEvent& rEventObject ) throw ( ::com::sun::star::uno::RuntimeException)
+{
+    const ::vos::OGuard aGuard( Application::GetSolarMutex() );
+
+    if( pView )
+    {
+        {
+            TransferableDataHelper aDataHelper( rEventObject.Contents );
+            sal_Bool bHasTransferable = aDataHelper.GetTransferable().is();
+            
+            //! according to CD the above call to GetTransferable may create a (new)
+            //! message loop and thus result in re-entrant code.
+            //! Thus it was suggested to check 'pView' here again.
+            if (pView)
+            {
+                pView->bPasteState = bHasTransferable &&
+                    ( aDataHelper.HasFormat( FORMAT_STRING ) ||
+                    aDataHelper.HasFormat( SOT_FORMATSTR_ID_EMBEDDED_OBJ ) ||
+                    (aDataHelper.HasFormat( SOT_FORMATSTR_ID_OBJECTDESCRIPTOR )
+                        && aDataHelper.HasFormat( SOT_FORMATSTR_ID_EMBED_SOURCE )));
+            }
+        }
+
+        if (pView)
+        {
+            SfxBindings& rBind = pView->GetViewFrame()->GetBindings();
+            rBind.Invalidate( SID_PASTE );
+        }
+    }
+}
+
+void SmClipboardChangeListener::AddRemoveListener( BOOL bAdd )
+{
+    try
+    {
+        do {
+            Window* pW;
+            Reference< XClipboard > xClipboard;
+            if( pView && 0 != ( pW = pView->GetEditWindow()) )
+                xClipboard = pW->GetClipboard();
+            if( !xClipboard.is() )
+                break;
+
+            Reference< XClipboardNotifier > xClpbrdNtfr( xClipboard, UNO_QUERY );
+            if( xClpbrdNtfr.is() )
+            {
+                Reference< XClipboardListener >	xClipEvtLstnr( this );
+                if( bAdd )
+                    xClpbrdNtfr->addClipboardListener( xClipEvtLstnr );
+                else
+                    xClpbrdNtfr->removeClipboardListener( xClipEvtLstnr );
+            }
+        }  while ( FALSE );
+    }
+    catch( const ::com::sun::star::uno::Exception& )
+    {
+    }
+}
+
+// ------------------------- SmViewShell ---------------------
+
+void SmViewShell::AddRemoveClipboardListener( BOOL bAdd )
+{
+    // AddRemoveListener and ViewDestroyed below should be an 
+    // atomic operation and must not be 'interrupted' by other code
+    const ::vos::OGuard aGuard( Application::GetSolarMutex() );
+
+    if( bAdd && !xClipEvtLstnr.is() )
+    {
+        xClipEvtLstnr = pClipEvtLstnr = new SmClipboardChangeListener( *this );
+        pClipEvtLstnr->AddRemoveListener( TRUE );
+    }
+    else if( !bAdd && xClipEvtLstnr.is() )
+    {
+        pClipEvtLstnr->AddRemoveListener( FALSE );
+        pClipEvtLstnr->ViewDestroyed();
+    }
+}
+
+
+
diff --git starmath/uiconfig/smath/menubar/menubar.xml starmath/uiconfig/smath/menubar/menubar.xml
index bc17f4e..646a6c0 100644
--- starmath/uiconfig/smath/menubar/menubar.xml
+++ starmath/uiconfig/smath/menubar/menubar.xml
@@ -114,6 +114,7 @@
             <menu:menuitem menu:id=".uno:OnlineRegistrationDlg"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:About"/>
+            <menu:menuitem menu:id=".uno:ShowLicense"/>
         </menu:menupopup>
     </menu:menu>
 </menu:menubar>
diff --git starmath/uiconfig/smath/toolbar/average.xml starmath/uiconfig/smath/toolbar/average.xml
new file mode 100644
index 0000000..1a00b34
--- /dev/null
+++ starmath/uiconfig/smath/toolbar/average.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SendFax" toolbar:helpid="helpid:20028" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:helpid="helpid:5401" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:text="" toolbar:visible="false" toolbar:helpid="5402"/>
+
+</toolbar:toolbar>
diff --git starmath/uiconfig/smath/toolbar/beginner.xml starmath/uiconfig/smath/toolbar/beginner.xml
new file mode 100644
index 0000000..1a00b34
--- /dev/null
+++ starmath/uiconfig/smath/toolbar/beginner.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SendFax" toolbar:helpid="helpid:20028" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:helpid="helpid:5401" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:text="" toolbar:visible="false" toolbar:helpid="5402"/>
+
+</toolbar:toolbar>
diff --git starmath/uiconfig/smath/toolbar/math_average.xml starmath/uiconfig/smath/toolbar/math_average.xml
new file mode 100644
index 0000000..1a00b34
--- /dev/null
+++ starmath/uiconfig/smath/toolbar/math_average.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SendFax" toolbar:helpid="helpid:20028" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:helpid="helpid:5401" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:text="" toolbar:visible="false" toolbar:helpid="5402"/>
+
+</toolbar:toolbar>
diff --git starmath/uiconfig/smath/toolbar/math_beginner.xml starmath/uiconfig/smath/toolbar/math_beginner.xml
new file mode 100644
index 0000000..1a00b34
--- /dev/null
+++ starmath/uiconfig/smath/toolbar/math_beginner.xml
@@ -0,0 +1,26 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="helpid:5537" toolbar:text="" toolbar:style="dropdown" />
+ <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:helpid="helpid:5500" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="helpid:5501" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="helpid:5505" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="5331"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:SendFax" toolbar:helpid="helpid:20028" toolbar:text="" toolbar:visible="false" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="helpid:5710" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="helpid:5712" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="helpid:5701" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="helpid:5700" toolbar:text="" />
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:HelpIndex" toolbar:helpid="helpid:5401" toolbar:text="" />
+ <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:text="" toolbar:visible="false" toolbar:helpid="5402"/>
+
+</toolbar:toolbar>
diff --git starmath/util/makefile.mk starmath/util/makefile.mk
index 978cb6c..4f82e05 100644
--- starmath/util/makefile.mk
+++ starmath/util/makefile.mk
@@ -41,6 +41,11 @@ GEN_HID_OTHER=TRUE
 
 .INCLUDE :  settings.mk
 
+#.IF "$(OOo4Kids)"=="YES"
+#all:
+#	@echo "Nothing to build"
+#.ENDIF
+
 # --- Files --------------------------------------------------------
 
 RESLIB1NAME=sm
diff --git stax/makefile.mk stax/makefile.mk
index 41d2a2b..31d6e3d 100644
--- stax/makefile.mk
+++ stax/makefile.mk
@@ -37,10 +37,15 @@ USE_JAVAVER=TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)" == "YES"
+dummy:
+    @echo "Not building $(PRJNAME) because Java is disabled"
+.ENDIF			# $(OOo4kids) == "YES"
+
 .INCLUDE :	settings.mk
 .INCLUDE : antsettings.mk
 
-.IF "$(SOLAR_JAVA)" != ""
+.IF "$(SOLAR_JAVA)" != "" || "$(OOo4Kids)" != "YES"
 .IF "$(JAVANUMVER:s/.//)" >= "000100060000" || "$(JDK)"=="gcj"
 all:
     @echo "Your java version already contains StAX"
diff --git svtools/inc/imgdef.hxx svtools/inc/imgdef.hxx
index 9f1d390..f4fd1e6 100644
--- svtools/inc/imgdef.hxx
+++ svtools/inc/imgdef.hxx
@@ -33,8 +33,14 @@
 
 enum SfxSymbolsSize
 {
+#ifndef OOo4Kids
     SFX_SYMBOLS_SIZE_SMALL,
     SFX_SYMBOLS_SIZE_LARGE,
+#else
+    SFX_SYMBOLS_SIZE_LARGE,
+    SFX_SYMBOLS_SIZE_SMALL,
+#endif
+
     SFX_SYMBOLS_SIZE_AUTO
 };
 
@@ -42,11 +48,15 @@ enum SfxSymbolsStyle
 {
     SFX_SYMBOLS_STYLE_AUTO,
     SFX_SYMBOLS_STYLE_DEFAULT,
+#ifndef OOo4Kids
     SFX_SYMBOLS_STYLE_HICONTRAST,
     SFX_SYMBOLS_STYLE_INDUSTRIAL,
     SFX_SYMBOLS_STYLE_CRYSTAL,
     SFX_SYMBOLS_STYLE_TANGO,
     SFX_SYMBOLS_STYLE_CLASSIC
+#else
+    SFX_SYMBOLS_STYLE_CRYSTAL,
+#endif
 };
 
 #define SFX_TOOLBOX_CHANGESYMBOLSET		0x0001
diff --git svtools/inc/svtools/inettype.hxx svtools/inc/svtools/inettype.hxx
index 526e9ff..5a4d249 100644
--- svtools/inc/svtools/inettype.hxx
+++ svtools/inc/svtools/inettype.hxx
@@ -93,6 +93,7 @@
 #define CONTENT_TYPE_STR_AUDIO_AIFF "audio/aiff"
 #define CONTENT_TYPE_STR_AUDIO_BASIC "audio/basic"
 #define CONTENT_TYPE_STR_AUDIO_MIDI "audio/midi"
+#define CONTENT_TYPE_STR_AUDIO_VORBIS "audio/vorbis"
 #define CONTENT_TYPE_STR_AUDIO_WAV "audio/wav"
 #define CONTENT_TYPE_STR_X_CNT_DOCUMENT ".chaos/document"
 #define CONTENT_TYPE_STR_X_CNT_FSYSBOX ".chaos/fsys-box"
@@ -158,6 +159,7 @@
 #define CONTENT_TYPE_STR_TEXT_URL "text/x-url"
 #define CONTENT_TYPE_STR_TEXT_VCALENDAR "text/x-vCalendar"
 #define CONTENT_TYPE_STR_TEXT_VCARD "text/x-vCard"
+#define CONTENT_TYPE_STR_VIDEO_THEORA "video/theora"
 #define CONTENT_TYPE_STR_VIDEO_VDO "video/vdo"
 #define CONTENT_TYPE_STR_VIDEO_MSVIDEO "video/x-msvideo"
 #define CONTENT_TYPE_STR_X_STARMAIL "x-starmail"
@@ -231,6 +233,7 @@ enum INetContentType
     CONTENT_TYPE_AUDIO_AIFF,
     CONTENT_TYPE_AUDIO_BASIC,
     CONTENT_TYPE_AUDIO_MIDI,
+    CONTENT_TYPE_AUDIO_VORBIS,
     CONTENT_TYPE_AUDIO_WAV,
     CONTENT_TYPE_IMAGE_GIF,
     CONTENT_TYPE_IMAGE_JPEG,
@@ -242,6 +245,7 @@ enum INetContentType
     CONTENT_TYPE_TEXT_PLAIN,
     CONTENT_TYPE_TEXT_URL,
     CONTENT_TYPE_TEXT_VCARD,
+    CONTENT_TYPE_VIDEO_THEORA,
     CONTENT_TYPE_VIDEO_VDO,
     CONTENT_TYPE_VIDEO_MSVIDEO,
     CONTENT_TYPE_X_CNT_MESSAGE,
diff --git svtools/inc/svtools/svtools.hrc svtools/inc/svtools/svtools.hrc
index ed4eb84..5b7e8cd 100644
--- svtools/inc/svtools/svtools.hrc
+++ svtools/inc/svtools/svtools.hrc
@@ -146,110 +146,112 @@
 #define STR_SVT_MIMETYPE_APP_ZIP			(STR_SVT_MIMETYPE_START+10)
 #define STR_SVT_MIMETYPE_AUDIO_AIFF 		(STR_SVT_MIMETYPE_START+11)
 #define STR_SVT_MIMETYPE_AUDIO_BASIC		(STR_SVT_MIMETYPE_START+12)
-#define STR_SVT_MIMETYPE_AUDIO_MIDI 		(STR_SVT_MIMETYPE_START+13)
-#define STR_SVT_MIMETYPE_AUDIO_WAV			(STR_SVT_MIMETYPE_START+14)
-#define STR_SVT_MIMETYPE_IMAGE_GIF			(STR_SVT_MIMETYPE_START+15)
-#define STR_SVT_MIMETYPE_IMAGE_JPEG 		(STR_SVT_MIMETYPE_START+16)
-#define STR_SVT_MIMETYPE_IMAGE_PCX			(STR_SVT_MIMETYPE_START+17)
-#define STR_SVT_MIMETYPE_IMAGE_BMP			(STR_SVT_MIMETYPE_START+18)
-#define STR_SVT_MIMETYPE_TEXT_HTML			(STR_SVT_MIMETYPE_START+19)
-#define STR_SVT_MIMETYPE_TEXT_PLAIN 		(STR_SVT_MIMETYPE_START+20)
-#define STR_SVT_MIMETYPE_TEXT_URL			(STR_SVT_MIMETYPE_START+21)
-#define STR_SVT_MIMETYPE_TEXT_VCARD 		(STR_SVT_MIMETYPE_START+22)
-#define STR_SVT_MIMETYPE_VIDEO_VDO			(STR_SVT_MIMETYPE_START+23)
-#define STR_SVT_MIMETYPE_VIDEO_MSVIDEO		(STR_SVT_MIMETYPE_START+24)
-#define STR_SVT_MIMETYPE_X_STARMAIL 		(STR_SVT_MIMETYPE_START+25)
-#define STR_SVT_MIMETYPE_X_VRML 			(STR_SVT_MIMETYPE_START+26)
-#define STR_SVT_MIMETYPE_APP_STARHELP		(STR_SVT_MIMETYPE_START+27)
-#define STR_SVT_MIMETYPE_APP_STARIMPRESS	(STR_SVT_MIMETYPE_START+28)
-#define STR_SVT_MIMETYPE_APP_SCHED_CMB		(STR_SVT_MIMETYPE_START+29)
-#define STR_SVT_MIMETYPE_APP_SCHED_EVT		(STR_SVT_MIMETYPE_START+30)
-#define STR_SVT_MIMETYPE_APP_SCHED_TASK 	(STR_SVT_MIMETYPE_START+31)
-#define STR_SVT_MIMETYPE_APP_SCHED_TVIEW	(STR_SVT_MIMETYPE_START+32)
-
-#define STR_SVT_MIMETYPE_CNT_MSG			(STR_SVT_MIMETYPE_START+33)
-#define STR_SVT_MIMETYPE_CNT_DOCUMENT		(STR_SVT_MIMETYPE_START+34)
-#define STR_SVT_MIMETYPE_CNT_POP3BOX		(STR_SVT_MIMETYPE_START+35)
-#define STR_SVT_MIMETYPE_CNT_IMAPBOX		(STR_SVT_MIMETYPE_START+36)
-#define STR_SVT_MIMETYPE_CNT_IMAPFLD		(STR_SVT_MIMETYPE_START+37)
-#define STR_SVT_MIMETYPE_CNT_VIMBOX 		(STR_SVT_MIMETYPE_START+38)
-#define STR_SVT_MIMETYPE_CNT_VIMINBOX		(STR_SVT_MIMETYPE_START+39)
-#define STR_SVT_MIMETYPE_CNT_BBBOX			(STR_SVT_MIMETYPE_START+40)
-#define STR_SVT_MIMETYPE_CNT_VIM_BB 		(STR_SVT_MIMETYPE_START+41)
-#define STR_SVT_MIMETYPE_CNT_NEWSBOX		(STR_SVT_MIMETYPE_START+42)
-#define STR_SVT_MIMETYPE_CNT_NEWSGRP		(STR_SVT_MIMETYPE_START+43)
-#define STR_SVT_MIMETYPE_CNT_OUTBOX 		(STR_SVT_MIMETYPE_START+44)
-#define STR_SVT_MIMETYPE_CNT_FTPBOX 		(STR_SVT_MIMETYPE_START+45)
-#define STR_SVT_MIMETYPE_CNT_FTPFLD 		(STR_SVT_MIMETYPE_START+46)
-#define STR_SVT_MIMETYPE_CNT_FTPFILE		(STR_SVT_MIMETYPE_START+47)
-#define STR_SVT_MIMETYPE_CNT_FTPLINK		(STR_SVT_MIMETYPE_START+48)
-#define STR_SVT_MIMETYPE_CNT_HTTPBOX		(STR_SVT_MIMETYPE_START+49)
-#define STR_SVT_MIMETYPE_CNT_FSYSBOX		(STR_SVT_MIMETYPE_START+50)
-#define STR_SVT_MIMETYPE_CNT_FSYSFLD		(STR_SVT_MIMETYPE_START+51)
-#define STR_SVT_MIMETYPE_CNT_FSYSFILE		(STR_SVT_MIMETYPE_START+52)
-#define STR_SVT_MIMETYPE_CNT_FSYSURLFILE	(STR_SVT_MIMETYPE_START+53)
-#define STR_SVT_MIMETYPE_CNT_PUBLBOX		(STR_SVT_MIMETYPE_START+54)
-#define STR_SVT_MIMETYPE_CNT_SRCHBOX		(STR_SVT_MIMETYPE_START+55)
-#define STR_SVT_MIMETYPE_CNT_SUBSCRBOX		(STR_SVT_MIMETYPE_START+56)
-#define STR_SVT_MIMETYPE_CNT_BOOKMARK		(STR_SVT_MIMETYPE_START+57)
-#define STR_SVT_MIMETYPE_CNT_CDF			(STR_SVT_MIMETYPE_START+58)
-#define STR_SVT_MIMETYPE_CNT_CDFSUB 		(STR_SVT_MIMETYPE_START+59)
-#define STR_SVT_MIMETYPE_CNT_CDFITEM		(STR_SVT_MIMETYPE_START+60)
-#define STR_SVT_MIMETYPE_CNT_STARCHANNEL	(STR_SVT_MIMETYPE_START+61)
-#define STR_SVT_MIMETYPE_CNT_TRASHBOX		(STR_SVT_MIMETYPE_START+62)
-#define STR_SVT_MIMETYPE_CNT_TRASH			(STR_SVT_MIMETYPE_START+63)
-#define STR_SVT_MIMETYPE_CNT_REMOV_VOL		(STR_SVT_MIMETYPE_START+64)
-#define STR_SVT_MIMETYPE_CNT_FIX_VOL		(STR_SVT_MIMETYPE_START+65)
-#define STR_SVT_MIMETYPE_CNT_REM_VOL		(STR_SVT_MIMETYPE_START+66)
-#define STR_SVT_MIMETYPE_CNT_RAM_VOL		(STR_SVT_MIMETYPE_START+67)
-#define STR_SVT_MIMETYPE_CNT_CDROM			(STR_SVT_MIMETYPE_START+68)
-#define STR_SVT_MIMETYPE_CNT_DISK_35		(STR_SVT_MIMETYPE_START+69)
-#define STR_SVT_MIMETYPE_CNT_DISK_525		(STR_SVT_MIMETYPE_START+70)
-#define STR_SVT_MIMETYPE_CNT_TAPEDRIVE		(STR_SVT_MIMETYPE_START+71)
-#define STR_SVT_MIMETYPE_APP_GAL			(STR_SVT_MIMETYPE_START+72)
-#define STR_SVT_MIMETYPE_APP_GAL_THEME		(STR_SVT_MIMETYPE_START+73)
-#define STR_SVT_MIMETYPE_CNT_SEPARATOR		(STR_SVT_MIMETYPE_START+74)
-#define STR_SVT_MIMETYPE_APP_STARW_GLOB 	(STR_SVT_MIMETYPE_START+75)
-#define STR_SVT_MIMETYPE_APP_SDM			(STR_SVT_MIMETYPE_START+76)
-#define STR_SVT_MIMETYPE_APP_SMD			(STR_SVT_MIMETYPE_START+77)
-#define STR_SVT_MIMETYPE_APP_STARW_WEB		(STR_SVT_MIMETYPE_START+78)
-#define STR_SVT_MIMETYPE_SCHEDULE			(STR_SVT_MIMETYPE_START+79)
-#define STR_SVT_MIMETYPE_SCHEDULE_EVT		(STR_SVT_MIMETYPE_START+80)
-#define STR_SVT_MIMETYPE_SCHEDULE_TASK		(STR_SVT_MIMETYPE_START+81)
-#define STR_SVT_MIMETYPE_SCHEDULE_FEVT		(STR_SVT_MIMETYPE_START+82)
-#define STR_SVT_MIMETYPE_SCHEDULE_FTASK 	(STR_SVT_MIMETYPE_START+83)
-#define STR_SVT_MIMETYPE_FRAMESET			(STR_SVT_MIMETYPE_START+84)
-#define STR_SVT_MIMETYPE_MACRO				(STR_SVT_MIMETYPE_START+85)
-#define STR_SVT_MIMETYPE_CNT_SFSYSFOLDER	(STR_SVT_MIMETYPE_START+86)
-#define STR_SVT_MIMETYPE_CNT_SFSYSFILE		(STR_SVT_MIMETYPE_START+87)
-#define STR_SVT_MIMETYPE_APP_TEMPLATE		(STR_SVT_MIMETYPE_START+88)
-#define STR_SVT_MIMETYPE_IMAGE_GENERIC		(STR_SVT_MIMETYPE_START+89)
-#define STR_SVT_MIMETYPE_APP_MSEXCEL		(STR_SVT_MIMETYPE_START+90)
-#define STR_SVT_MIMETYPE_APP_MSEXCEL_TEMPL	(STR_SVT_MIMETYPE_START+91)
-#define STR_SVT_MIMETYPE_APP_MSPPOINT		(STR_SVT_MIMETYPE_START+92)
-#define STR_SVT_MIMETYPE_TEXT_VCALENDAR 	(STR_SVT_MIMETYPE_START+93)
-#define STR_SVT_MIMETYPE_TEXT_ICALENDAR 	(STR_SVT_MIMETYPE_START+94)
-#define STR_SVT_MIMETYPE_TEXT_XMLICALENDAR 	(STR_SVT_MIMETYPE_START+95)
-#define STR_SVT_MIMETYPE_TEXT_CDE_CALENDAR_APP 	(STR_SVT_MIMETYPE_START+96)
-#define STR_SVT_MIMETYPE_INET_MSG_RFC822 		(STR_SVT_MIMETYPE_START+97)
-#define STR_SVT_MIMETYPE_INET_MULTI_ALTERNATIVE	(STR_SVT_MIMETYPE_START+98)
-#define STR_SVT_MIMETYPE_INET_MULTI_DIGEST 		(STR_SVT_MIMETYPE_START+99)
-#define STR_SVT_MIMETYPE_INET_MULTI_PARALLEL 	(STR_SVT_MIMETYPE_START+100)
-#define STR_SVT_MIMETYPE_INET_MULTI_RELATED		(STR_SVT_MIMETYPE_START+101)
-#define STR_SVT_MIMETYPE_INET_MULTI_MIXED 		(STR_SVT_MIMETYPE_START+102)
-#define STR_SVT_MIMETYPE_APP_IMPRESSPACKED		(STR_SVT_MIMETYPE_START+103)
-#define STR_SVT_MIMETYPE_APP_JAR				(STR_SVT_MIMETYPE_START+104)
-#define STR_SVT_MIMETYPE_IMAGE_PNG				(STR_SVT_MIMETYPE_START+105)
-#define STR_SVT_MIMETYPE_IMAGE_TIFF 			(STR_SVT_MIMETYPE_START+106)
-
-#define STR_SVT_MIMETYPE_APP_SXCALC			(STR_SVT_MIMETYPE_START+107)
-#define STR_SVT_MIMETYPE_APP_SXCHART		(STR_SVT_MIMETYPE_START+108)
-#define STR_SVT_MIMETYPE_APP_SXDRAW			(STR_SVT_MIMETYPE_START+109)
-#define STR_SVT_MIMETYPE_APP_SXMATH			(STR_SVT_MIMETYPE_START+110)
-#define STR_SVT_MIMETYPE_APP_SXWRITER		(STR_SVT_MIMETYPE_START+111)
-#define STR_SVT_MIMETYPE_APP_SXIMPRESS		(STR_SVT_MIMETYPE_START+112)
-#define STR_SVT_MIMETYPE_APP_SXGLOBAL		(STR_SVT_MIMETYPE_START+113)
-#define STR_SVT_MIMETYPE_APP_SXIPACKED		(STR_SVT_MIMETYPE_START+114)
+#define STR_SVT_MIMETYPE_AUDIO_VORBIS 		(STR_SVT_MIMETYPE_START+13)
+#define STR_SVT_MIMETYPE_AUDIO_MIDI 		(STR_SVT_MIMETYPE_START+14)
+#define STR_SVT_MIMETYPE_AUDIO_WAV			(STR_SVT_MIMETYPE_START+15)
+#define STR_SVT_MIMETYPE_IMAGE_GIF			(STR_SVT_MIMETYPE_START+16)
+#define STR_SVT_MIMETYPE_IMAGE_JPEG 		(STR_SVT_MIMETYPE_START+17)
+#define STR_SVT_MIMETYPE_IMAGE_PCX			(STR_SVT_MIMETYPE_START+18)
+#define STR_SVT_MIMETYPE_IMAGE_BMP			(STR_SVT_MIMETYPE_START+19)
+#define STR_SVT_MIMETYPE_TEXT_HTML			(STR_SVT_MIMETYPE_START+20)
+#define STR_SVT_MIMETYPE_TEXT_PLAIN 		(STR_SVT_MIMETYPE_START+21)
+#define STR_SVT_MIMETYPE_TEXT_URL			(STR_SVT_MIMETYPE_START+22)
+#define STR_SVT_MIMETYPE_TEXT_VCARD 		(STR_SVT_MIMETYPE_START+23)
+#define STR_SVT_MIMETYPE_VIDEO_THEORA			(STR_SVT_MIMETYPE_START+24)
+#define STR_SVT_MIMETYPE_VIDEO_VDO			(STR_SVT_MIMETYPE_START+25)
+#define STR_SVT_MIMETYPE_VIDEO_MSVIDEO		(STR_SVT_MIMETYPE_START+26)
+#define STR_SVT_MIMETYPE_X_STARMAIL 		(STR_SVT_MIMETYPE_START+27)
+#define STR_SVT_MIMETYPE_X_VRML 			(STR_SVT_MIMETYPE_START+28)
+#define STR_SVT_MIMETYPE_APP_STARHELP		(STR_SVT_MIMETYPE_START+29)
+#define STR_SVT_MIMETYPE_APP_STARIMPRESS	(STR_SVT_MIMETYPE_START+30)
+#define STR_SVT_MIMETYPE_APP_SCHED_CMB		(STR_SVT_MIMETYPE_START+31)
+#define STR_SVT_MIMETYPE_APP_SCHED_EVT		(STR_SVT_MIMETYPE_START+32)
+#define STR_SVT_MIMETYPE_APP_SCHED_TASK 	(STR_SVT_MIMETYPE_START+33)
+#define STR_SVT_MIMETYPE_APP_SCHED_TVIEW	(STR_SVT_MIMETYPE_START+34)
+
+#define STR_SVT_MIMETYPE_CNT_MSG			(STR_SVT_MIMETYPE_START+35)
+#define STR_SVT_MIMETYPE_CNT_DOCUMENT		(STR_SVT_MIMETYPE_START+36)
+#define STR_SVT_MIMETYPE_CNT_POP3BOX		(STR_SVT_MIMETYPE_START+37)
+#define STR_SVT_MIMETYPE_CNT_IMAPBOX		(STR_SVT_MIMETYPE_START+38)
+#define STR_SVT_MIMETYPE_CNT_IMAPFLD		(STR_SVT_MIMETYPE_START+39)
+#define STR_SVT_MIMETYPE_CNT_VIMBOX 		(STR_SVT_MIMETYPE_START+40)
+#define STR_SVT_MIMETYPE_CNT_VIMINBOX		(STR_SVT_MIMETYPE_START+41)
+#define STR_SVT_MIMETYPE_CNT_BBBOX			(STR_SVT_MIMETYPE_START+42)
+#define STR_SVT_MIMETYPE_CNT_VIM_BB 		(STR_SVT_MIMETYPE_START+43)
+#define STR_SVT_MIMETYPE_CNT_NEWSBOX		(STR_SVT_MIMETYPE_START+44)
+#define STR_SVT_MIMETYPE_CNT_NEWSGRP		(STR_SVT_MIMETYPE_START+45)
+#define STR_SVT_MIMETYPE_CNT_OUTBOX 		(STR_SVT_MIMETYPE_START+46)
+#define STR_SVT_MIMETYPE_CNT_FTPBOX 		(STR_SVT_MIMETYPE_START+47)
+#define STR_SVT_MIMETYPE_CNT_FTPFLD 		(STR_SVT_MIMETYPE_START+48)
+#define STR_SVT_MIMETYPE_CNT_FTPFILE		(STR_SVT_MIMETYPE_START+49)
+#define STR_SVT_MIMETYPE_CNT_FTPLINK		(STR_SVT_MIMETYPE_START+50)
+#define STR_SVT_MIMETYPE_CNT_HTTPBOX		(STR_SVT_MIMETYPE_START+51)
+#define STR_SVT_MIMETYPE_CNT_FSYSBOX		(STR_SVT_MIMETYPE_START+52)
+#define STR_SVT_MIMETYPE_CNT_FSYSFLD		(STR_SVT_MIMETYPE_START+53)
+#define STR_SVT_MIMETYPE_CNT_FSYSFILE		(STR_SVT_MIMETYPE_START+54)
+#define STR_SVT_MIMETYPE_CNT_FSYSURLFILE	(STR_SVT_MIMETYPE_START+55)
+#define STR_SVT_MIMETYPE_CNT_PUBLBOX		(STR_SVT_MIMETYPE_START+56)
+#define STR_SVT_MIMETYPE_CNT_SRCHBOX		(STR_SVT_MIMETYPE_START+57)
+#define STR_SVT_MIMETYPE_CNT_SUBSCRBOX		(STR_SVT_MIMETYPE_START+58)
+#define STR_SVT_MIMETYPE_CNT_BOOKMARK		(STR_SVT_MIMETYPE_START+59)
+#define STR_SVT_MIMETYPE_CNT_CDF			(STR_SVT_MIMETYPE_START+60)
+#define STR_SVT_MIMETYPE_CNT_CDFSUB 		(STR_SVT_MIMETYPE_START+61)
+#define STR_SVT_MIMETYPE_CNT_CDFITEM		(STR_SVT_MIMETYPE_START+62)
+#define STR_SVT_MIMETYPE_CNT_STARCHANNEL	(STR_SVT_MIMETYPE_START+63)
+#define STR_SVT_MIMETYPE_CNT_TRASHBOX		(STR_SVT_MIMETYPE_START+64)
+#define STR_SVT_MIMETYPE_CNT_TRASH			(STR_SVT_MIMETYPE_START+65)
+#define STR_SVT_MIMETYPE_CNT_REMOV_VOL		(STR_SVT_MIMETYPE_START+66)
+#define STR_SVT_MIMETYPE_CNT_FIX_VOL		(STR_SVT_MIMETYPE_START+67)
+#define STR_SVT_MIMETYPE_CNT_REM_VOL		(STR_SVT_MIMETYPE_START+68)
+#define STR_SVT_MIMETYPE_CNT_RAM_VOL		(STR_SVT_MIMETYPE_START+69)
+#define STR_SVT_MIMETYPE_CNT_CDROM			(STR_SVT_MIMETYPE_START+70)
+#define STR_SVT_MIMETYPE_CNT_DISK_35		(STR_SVT_MIMETYPE_START+71)
+#define STR_SVT_MIMETYPE_CNT_DISK_525		(STR_SVT_MIMETYPE_START+72)
+#define STR_SVT_MIMETYPE_CNT_TAPEDRIVE		(STR_SVT_MIMETYPE_START+73)
+#define STR_SVT_MIMETYPE_APP_GAL			(STR_SVT_MIMETYPE_START+74)
+#define STR_SVT_MIMETYPE_APP_GAL_THEME		(STR_SVT_MIMETYPE_START+75)
+#define STR_SVT_MIMETYPE_CNT_SEPARATOR		(STR_SVT_MIMETYPE_START+76)
+#define STR_SVT_MIMETYPE_APP_STARW_GLOB 	(STR_SVT_MIMETYPE_START+77)
+#define STR_SVT_MIMETYPE_APP_SDM			(STR_SVT_MIMETYPE_START+78)
+#define STR_SVT_MIMETYPE_APP_SMD			(STR_SVT_MIMETYPE_START+79)
+#define STR_SVT_MIMETYPE_APP_STARW_WEB		(STR_SVT_MIMETYPE_START+80)
+#define STR_SVT_MIMETYPE_SCHEDULE			(STR_SVT_MIMETYPE_START+81)
+#define STR_SVT_MIMETYPE_SCHEDULE_EVT		(STR_SVT_MIMETYPE_START+82)
+#define STR_SVT_MIMETYPE_SCHEDULE_TASK		(STR_SVT_MIMETYPE_START+83)
+#define STR_SVT_MIMETYPE_SCHEDULE_FEVT		(STR_SVT_MIMETYPE_START+84)
+#define STR_SVT_MIMETYPE_SCHEDULE_FTASK 	(STR_SVT_MIMETYPE_START+85)
+#define STR_SVT_MIMETYPE_FRAMESET			(STR_SVT_MIMETYPE_START+86)
+#define STR_SVT_MIMETYPE_MACRO				(STR_SVT_MIMETYPE_START+87)
+#define STR_SVT_MIMETYPE_CNT_SFSYSFOLDER	(STR_SVT_MIMETYPE_START+88)
+#define STR_SVT_MIMETYPE_CNT_SFSYSFILE		(STR_SVT_MIMETYPE_START+89)
+#define STR_SVT_MIMETYPE_APP_TEMPLATE		(STR_SVT_MIMETYPE_START+90)
+#define STR_SVT_MIMETYPE_IMAGE_GENERIC		(STR_SVT_MIMETYPE_START+91)
+#define STR_SVT_MIMETYPE_APP_MSEXCEL		(STR_SVT_MIMETYPE_START+92)
+#define STR_SVT_MIMETYPE_APP_MSEXCEL_TEMPL	(STR_SVT_MIMETYPE_START+93)
+#define STR_SVT_MIMETYPE_APP_MSPPOINT		(STR_SVT_MIMETYPE_START+94)
+#define STR_SVT_MIMETYPE_TEXT_VCALENDAR 	(STR_SVT_MIMETYPE_START+95)
+#define STR_SVT_MIMETYPE_TEXT_ICALENDAR 	(STR_SVT_MIMETYPE_START+96)
+#define STR_SVT_MIMETYPE_TEXT_XMLICALENDAR 	(STR_SVT_MIMETYPE_START+97)
+#define STR_SVT_MIMETYPE_TEXT_CDE_CALENDAR_APP 	(STR_SVT_MIMETYPE_START+98)
+#define STR_SVT_MIMETYPE_INET_MSG_RFC822 		(STR_SVT_MIMETYPE_START+99)
+#define STR_SVT_MIMETYPE_INET_MULTI_ALTERNATIVE	(STR_SVT_MIMETYPE_START+100)
+#define STR_SVT_MIMETYPE_INET_MULTI_DIGEST 		(STR_SVT_MIMETYPE_START+101)
+#define STR_SVT_MIMETYPE_INET_MULTI_PARALLEL 	(STR_SVT_MIMETYPE_START+102)
+#define STR_SVT_MIMETYPE_INET_MULTI_RELATED		(STR_SVT_MIMETYPE_START+103)
+#define STR_SVT_MIMETYPE_INET_MULTI_MIXED 		(STR_SVT_MIMETYPE_START+104)
+#define STR_SVT_MIMETYPE_APP_IMPRESSPACKED		(STR_SVT_MIMETYPE_START+105)
+#define STR_SVT_MIMETYPE_APP_JAR				(STR_SVT_MIMETYPE_START+106)
+#define STR_SVT_MIMETYPE_IMAGE_PNG				(STR_SVT_MIMETYPE_START+107)
+#define STR_SVT_MIMETYPE_IMAGE_TIFF 			(STR_SVT_MIMETYPE_START+108)
+
+#define STR_SVT_MIMETYPE_APP_SXCALC			(STR_SVT_MIMETYPE_START+109)
+#define STR_SVT_MIMETYPE_APP_SXCHART		(STR_SVT_MIMETYPE_START+110)
+#define STR_SVT_MIMETYPE_APP_SXDRAW			(STR_SVT_MIMETYPE_START+111)
+#define STR_SVT_MIMETYPE_APP_SXMATH			(STR_SVT_MIMETYPE_START+112)
+#define STR_SVT_MIMETYPE_APP_SXWRITER		(STR_SVT_MIMETYPE_START+113)
+#define STR_SVT_MIMETYPE_APP_SXIMPRESS		(STR_SVT_MIMETYPE_START+114)
+#define STR_SVT_MIMETYPE_APP_SXGLOBAL		(STR_SVT_MIMETYPE_START+115)
+#define STR_SVT_MIMETYPE_APP_SXIPACKED		(STR_SVT_MIMETYPE_START+116)
 #define STR_SVT_MIMETYPE_END				(STR_SVT_MIMETYPE_APP_SXIPACKED)
 
 #define STR_SVT_PRNDLG_START				(STR_SVT_MIMETYPE_END+1)
diff --git svtools/source/config/miscopt.cxx svtools/source/config/miscopt.cxx
index 7bf261e..f888962 100644
--- svtools/source/config/miscopt.cxx
+++ svtools/source/config/miscopt.cxx
@@ -269,12 +269,14 @@ static sal_Int16 implSymbolsStyleFromVCL( ULONG nStyle )
     switch ( nStyle )
     {
         case STYLE_SYMBOLS_AUTO:       return SFX_SYMBOLS_STYLE_AUTO;
+#ifndef OOo4Kids
         case STYLE_SYMBOLS_DEFAULT:    return SFX_SYMBOLS_STYLE_DEFAULT;
+        case STYLE_SYMBOLS_TANGO:      return SFX_SYMBOLS_STYLE_TANGO;
+        case STYLE_SYMBOLS_CLASSIC:    return SFX_SYMBOLS_STYLE_CLASSIC;
         case STYLE_SYMBOLS_HICONTRAST: return SFX_SYMBOLS_STYLE_HICONTRAST;
         case STYLE_SYMBOLS_INDUSTRIAL: return SFX_SYMBOLS_STYLE_INDUSTRIAL;
+#endif
         case STYLE_SYMBOLS_CRYSTAL:    return SFX_SYMBOLS_STYLE_CRYSTAL;
-        case STYLE_SYMBOLS_TANGO:      return SFX_SYMBOLS_STYLE_TANGO;
-        case STYLE_SYMBOLS_CLASSIC:    return SFX_SYMBOLS_STYLE_CLASSIC;
     }
 
     return SFX_SYMBOLS_STYLE_AUTO;
@@ -285,12 +287,14 @@ static ULONG implSymbolsStyleToVCL( sal_Int16 nStyle )
     switch ( nStyle )
     {
         case SFX_SYMBOLS_STYLE_AUTO:       return STYLE_SYMBOLS_AUTO;
+        case SFX_SYMBOLS_STYLE_CRYSTAL:    return STYLE_SYMBOLS_CRYSTAL;
+#ifndef OOo4Kids
         case SFX_SYMBOLS_STYLE_DEFAULT:    return STYLE_SYMBOLS_DEFAULT;
         case SFX_SYMBOLS_STYLE_HICONTRAST: return STYLE_SYMBOLS_HICONTRAST;
         case SFX_SYMBOLS_STYLE_INDUSTRIAL: return STYLE_SYMBOLS_INDUSTRIAL;
-        case SFX_SYMBOLS_STYLE_CRYSTAL:    return STYLE_SYMBOLS_CRYSTAL;
         case SFX_SYMBOLS_STYLE_TANGO:      return STYLE_SYMBOLS_TANGO;
         case SFX_SYMBOLS_STYLE_CLASSIC:    return STYLE_SYMBOLS_CLASSIC;
+#endif
     }
 
     return STYLE_SYMBOLS_AUTO;
diff --git svtools/source/misc1/inettype.cxx svtools/source/misc1/inettype.cxx
index 32082d7..fcc4d9e 100644
--- svtools/source/misc1/inettype.cxx
+++ svtools/source/misc1/inettype.cxx
@@ -303,6 +303,7 @@ MediaTypeEntry const aStaticTypeNameMap[CONTENT_TYPE_LAST + 1]
         { CONTENT_TYPE_STR_AUDIO_AIFF, CONTENT_TYPE_AUDIO_AIFF, "aif" },
         { CONTENT_TYPE_STR_AUDIO_BASIC, CONTENT_TYPE_AUDIO_BASIC, "au" },
         { CONTENT_TYPE_STR_AUDIO_MIDI, CONTENT_TYPE_AUDIO_MIDI, "mid" },
+        { CONTENT_TYPE_STR_AUDIO_VORBIS, CONTENT_TYPE_AUDIO_VORBIS, "ogg" },
         { CONTENT_TYPE_STR_AUDIO_WAV, CONTENT_TYPE_AUDIO_WAV, "wav" },
         { CONTENT_TYPE_STR_IMAGE_GENERIC, CONTENT_TYPE_IMAGE_GENERIC, "tmp" },
         { CONTENT_TYPE_STR_IMAGE_GIF, CONTENT_TYPE_IMAGE_GIF, "gif" },
@@ -333,6 +334,7 @@ MediaTypeEntry const aStaticTypeNameMap[CONTENT_TYPE_LAST + 1]
         { CONTENT_TYPE_STR_TEXT_VCALENDAR, CONTENT_TYPE_TEXT_VCALENDAR,
           "vcs" },
         { CONTENT_TYPE_STR_TEXT_VCARD, CONTENT_TYPE_TEXT_VCARD, "vcf" },
+        { CONTENT_TYPE_STR_VIDEO_THEORA, CONTENT_TYPE_VIDEO_THEORA, "ogg" },
         { CONTENT_TYPE_STR_VIDEO_VDO, CONTENT_TYPE_VIDEO_VDO, "vdo" },
         { CONTENT_TYPE_STR_VIDEO_MSVIDEO, CONTENT_TYPE_VIDEO_MSVIDEO, "avi" },
         { CONTENT_TYPE_STR_X_STARMAIL, CONTENT_TYPE_X_STARMAIL, "smd" },
@@ -361,6 +363,7 @@ USHORT const aStaticResourceIDMap[CONTENT_TYPE_LAST + 1]
         STR_SVT_MIMETYPE_AUDIO_AIFF, // CONTENT_TYPE_AUDIO_AIFF
         STR_SVT_MIMETYPE_AUDIO_BASIC, // CONTENT_TYPE_AUDIO_BASIC
         STR_SVT_MIMETYPE_AUDIO_MIDI, // CONTENT_TYPE_AUDIO_MIDI
+        STR_SVT_MIMETYPE_AUDIO_VORBIS, // CONTENT_TYPE_AUDIO_VORBIS
         STR_SVT_MIMETYPE_AUDIO_WAV, // CONTENT_TYPE_AUDIO_WAV
         STR_SVT_MIMETYPE_IMAGE_GIF, // CONTENT_TYPE_IMAGE_GIF
         STR_SVT_MIMETYPE_IMAGE_JPEG, // CONTENT_TYPE_IMAGE_JPEG
@@ -372,6 +375,7 @@ USHORT const aStaticResourceIDMap[CONTENT_TYPE_LAST + 1]
         STR_SVT_MIMETYPE_TEXT_PLAIN, // CONTENT_TYPE_TEXT_PLAIN
         STR_SVT_MIMETYPE_TEXT_URL, // CONTENT_TYPE_TEXT_URL
         STR_SVT_MIMETYPE_TEXT_VCARD, // CONTENT_TYPE_TEXT_VCARD
+        STR_SVT_MIMETYPE_VIDEO_THEORA, // CONTENT_TYPE_VIDEO_THEORA
         STR_SVT_MIMETYPE_VIDEO_VDO, // CONTENT_TYPE_VIDEO_VDO
         STR_SVT_MIMETYPE_VIDEO_MSVIDEO, // CONTENT_TYPE_VIDEO_MSVIDEO
         STR_SVT_MIMETYPE_CNT_MSG, // CONTENT_TYPE_X_CNT_MESSAGE
@@ -507,6 +511,7 @@ MediaTypeEntry const aStaticExtensionMap[]
         { "met", CONTENT_TYPE_IMAGE_GENERIC, "" },
         { "mid", CONTENT_TYPE_AUDIO_MIDI, "" },
         { "midi", CONTENT_TYPE_AUDIO_MIDI, "" },
+        { "ogg", CONTENT_TYPE_AUDIO_VORBIS, "" },
         { "pbm", CONTENT_TYPE_IMAGE_GENERIC, "" },
         { "pcd", CONTENT_TYPE_IMAGE_GENERIC, "" },
         { "pct", CONTENT_TYPE_IMAGE_GENERIC, "" },
diff --git svtools/source/misc1/loginerr.cxx svtools/source/misc1/loginerr.cxx
new file mode 100644
index 0000000..e9222f8
--- /dev/null
+++ svtools/source/misc1/loginerr.cxx
@@ -0,0 +1,45 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: loginerr.cxx,v $
+ * $Revision: 1.6 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_svtools.hxx"
+#ifndef GCC
+#endif
+
+#include <svtools/loginerr.hxx>
+
+//============================================================================
+//
+// CntLoginErrorHint Implementation.
+//
+//============================================================================
+
+TYPEINIT1( CntLoginErrorHint, SfxHint );
+
diff --git svtools/source/misc1/mediatyp.src svtools/source/misc1/mediatyp.src
index fc538d1..93feef6 100644
--- svtools/source/misc1/mediatyp.src
+++ svtools/source/misc1/mediatyp.src
@@ -113,6 +113,87 @@ String STR_SVT_MIMETYPE_AUDIO_MIDI
     Text [ en-US ] = "Audio file" ;
 };
 
+String STR_SVT_MIMETYPE_AUDIO_VORBIS
+{
+    Text [ de ] = "Audio-Datei" ;
+    Text [ en-US ] = "Audio file" ;
+    Text [ af ] = "Oudioler" ;
+    Text [ ar ] = " " ;
+    Text [ as-IN ] = "' " ;
+    Text [ be-BY ] = " " ;
+    Text [ bg ] = "" ;
+    Text [ br ] = "Restr klev" ;
+    Text [ bs ] = "Audio datoteka" ;
+    Text [ ca ] = "Fitxer d'udio" ;
+    Text [ cs ] = "Zvukov soubor" ;
+    Text [ cy ] = "Ffeil sain" ;
+    Text [ da ] = "Lydfil" ;
+    Text [ el ] = " " ;
+    Text [ en-GB ] = "Audio file" ;
+    Text [ en-ZA ] = "Audio file" ;
+    Text [ eo ] = "Audio file" ;
+    Text [ es ] = "Archivo audio" ;
+    Text [ et ] = "Audiofail" ;
+    Text [ fa ] = " " ;
+    Text [ fi ] = "nitiedosto" ;
+    Text [ fr ] = "Fichier audio" ;
+    Text [ ga ] = "Comhad fuaime" ;
+    Text [ gu ] = " " ;
+    Text [ gu-IN ] = " " ;
+    Text [ he ] = " " ;
+    Text [ hi-IN ] = "Audio file" ;
+    Text [ hr ] = "Zvuna datoteka" ;
+    Text [ hu ] = "Hangfjl" ;
+    Text [ it ] = "File audio" ;
+    Text [ ja ] = " " ;
+    Text [ ka ] = " " ;
+    Text [ km ] = "" ;
+    Text [ ko ] = " " ;
+    Text [ ku ] = "Pelgeha deng" ;
+    Text [ lt ] = "Garso failas" ;
+    Text [ mk ] = "" ;
+    Text [ ml-IN ] = " " ;
+    Text [ mr-IN ] = " " ;
+    Text [ nb ] = "Lydfil" ;
+    Text [ ne ] = " " ;
+    Text [ nl ] = "Audiobestand" ;
+    Text [ nn ] = "Lydfil" ;
+    Text [ nr ] = "Ifayili elilalelwako" ;
+    Text [ ns ] = "Faele ya odiyo" ;
+    Text [ or-IN ] = " " ;
+    Text [ pa-IN ] = " " ;
+    Text [ pl ] = "Plik dwikowy" ;
+    Text [ pt ] = "Ficheiro udio" ;
+    Text [ pt-BR ] = "Arquivo de udio" ;
+    Text [ ru ] = " " ;
+    Text [ rw ] = "Audio file" ;
+    Text [ sh-YU ] = "Zvuna datoteka" ;
+    Text [ sk ] = "Zvukov sbor" ;
+    Text [ sl ] = "Zvona datoteka" ;
+    Text [ sr-CS ] = " " ;
+    Text [ ss ] = "I-Odiyofayela" ;
+    Text [ st ] = "Audiyo faele" ;
+    Text [ sv ] = "Audio-fil" ;
+    Text [ sw-TZ ] = "Faili la kusikia" ;
+    Text [ ta ] = "Audio file" ;
+    Text [ ta-IN ] = "Audio file" ;
+    Text [ te-IN ] = " " ;
+    Text [ tg ] = "-" ;
+    Text [ th ] = "Audio file" ;
+    Text [ ti-ER ] = "  " ;
+    Text [ tr ] = "Ses dosyas" ;
+    Text [ ts ] = "Fayili ya Xitlanga-mpfumawulo" ;
+    Text [ uk ] = "Audio file" ;
+    Text [ ur-IN ] = "" ;
+    Text [ ve ] = "Faela ya odio" ;
+    Text [ vi ] = "Tp tin m thanh" ;
+    Text [ xh ] = "Ifayili Yokumanyelwayo" ;
+    Text [ zh-CN ] = "" ;
+    Text [ zh-TW ] = "" ;
+    Text [ zu ] = "Ifayela eliveza umsindo" ;
+    Text [ x-comment ] = " ";
+};
+
 String STR_SVT_MIMETYPE_AUDIO_WAV
 {
     Text [ en-US ] = "Audio file" ;
@@ -158,6 +239,87 @@ String STR_SVT_MIMETYPE_TEXT_VCARD
     Text [ en-US ] = "vCard file" ;
 };
 
+String STR_SVT_MIMETYPE_VIDEO_THEORA
+{
+    Text [ de ] = "Video-Datei" ;
+    Text [ en-US ] = "Video file" ;
+    Text [ af ] = "Videoler" ;
+    Text [ ar ] = " " ;
+    Text [ as-IN ] = "' " ;
+    Text [ be-BY ] = " " ;
+    Text [ bg ] = "" ;
+    Text [ br ] = "Restr video" ;
+    Text [ bs ] = "Video datoteka" ;
+    Text [ ca ] = "Fitxer de vdeo" ;
+    Text [ cs ] = "Video soubor" ;
+    Text [ cy ] = "Ffeil fideo" ;
+    Text [ da ] = "Video-fil" ;
+    Text [ el ] = " Video" ;
+    Text [ en-GB ] = "Video file" ;
+    Text [ en-ZA ] = "Video file" ;
+    Text [ eo ] = "Video file" ;
+    Text [ es ] = "Archivo vdeo" ;
+    Text [ et ] = "Videofail" ;
+    Text [ fa ] = " " ;
+    Text [ fi ] = "Videotiedosto" ;
+    Text [ fr ] = "Fichier vido" ;
+    Text [ ga ] = "Fschomhad" ;
+    Text [ gu ] = " " ;
+    Text [ gu-IN ] = " " ;
+    Text [ he ] = " " ;
+    Text [ hi-IN ] = "Video file" ;
+    Text [ hr ] = "Video datoteka" ;
+    Text [ hu ] = "Videofjl" ;
+    Text [ it ] = "File video" ;
+    Text [ ja ] = " " ;
+    Text [ ka ] = " " ;
+    Text [ km ] = "" ;
+    Text [ ko ] = " " ;
+    Text [ ku ] = "Pelgeha vdeo" ;
+    Text [ lt ] = "Vaizdo failas" ;
+    Text [ mk ] = "" ;
+    Text [ ml-IN ] = " " ;
+    Text [ mr-IN ] = " " ;
+    Text [ nb ] = "Videofil" ;
+    Text [ ne ] = " " ;
+    Text [ nl ] = "Videobestand" ;
+    Text [ nn ] = "Videofil" ;
+    Text [ nr ] = "Ifayili levidiyo" ;
+    Text [ ns ] = "Faele ya bidio" ;
+    Text [ or-IN ] = " " ;
+    Text [ pa-IN ] = " " ;
+    Text [ pl ] = "Plik filmowy" ;
+    Text [ pt ] = "Ficheiro de vdeo" ;
+    Text [ pt-BR ] = "Arquivo de vdeo" ;
+    Text [ ru ] = " " ;
+    Text [ rw ] = "Video file" ;
+    Text [ sh-YU ] = "Video datoteka" ;
+    Text [ sk ] = "Video sbor" ;
+    Text [ sl ] = "Video-datoteka" ;
+    Text [ sr-CS ] = " " ;
+    Text [ ss ] = "Ividiyofayela" ;
+    Text [ st ] = "Bideo faele" ;
+    Text [ sv ] = "Video-fil" ;
+    Text [ sw-TZ ] = "Faili la video" ;
+    Text [ ta ] = "Video file" ;
+    Text [ ta-IN ] = "Video file" ;
+    Text [ te-IN ] = " " ;
+    Text [ tg ] = "-" ;
+    Text [ th ] = "Video file" ;
+    Text [ ti-ER ] = "  " ;
+    Text [ tr ] = "Grnt dosyas" ;
+    Text [ ts ] = "Fayili ya Vhidiyo" ;
+    Text [ uk ] = "Video file" ;
+    Text [ ur-IN ] = "" ;
+    Text [ ve ] = "Faela ya vidio" ;
+    Text [ vi ] = "Tp tin nh ng" ;
+    Text [ xh ] = "Ifayili yevidiyo" ;
+    Text [ zh-CN ] = "" ;
+    Text [ zh-TW ] = "" ;
+    Text [ zu ] = "Ifayela levidiyo" ;
+    Text [ x-comment ] = " ";
+};
+
 String STR_SVT_MIMETYPE_VIDEO_VDO
 {
     Text [ en-US ] = "Video file" ;
diff --git svx/inc/globlmn_tmpl.hrc svx/inc/globlmn_tmpl.hrc
index 327bd45..02a1036 100644
--- svx/inc/globlmn_tmpl.hrc
+++ svx/inc/globlmn_tmpl.hrc
@@ -1077,6 +1077,16 @@
     HelpID = SID_ABOUT ; \
     Text [ en-US ] = "A~bout %PRODUCTNAME..." ; \
     
+#define ITEM_HELP_LICENSE \
+    Identifier = SID_LICENSE ; \
+    Command = ".uno:ShowLicense" ; \
+    HelpID = SID_LICENSE ; \
+    Text [ en-US ] = "L~icense..." ; \
+    Text [ fr ] = "L~icence..." ; \
+    Text [ es ] = "L~icensia..."; \
+    Text [ it ] = "L~icenza..."; \
+    Text [ pt ] = "L~icenca..."; \
+
 /*------------------------------------------------------------------------
  Beschreibung: Menu Help
 ------------------------------------------------------------------------*/
diff --git svx/inc/helpid.hrc svx/inc/helpid.hrc
index 22d3175..1c1cfd4 100644
--- svx/inc/helpid.hrc
+++ svx/inc/helpid.hrc
@@ -819,7 +819,10 @@
 #define HID_MACRO_MACROS							(HID_SVX_EXT0_START + 215)
 #define HID_MACROCHECKDIALOG						(HID_SVX_EXT0_START + 216)
 #define HID_MACRO_HEADERTABLISTBOX					(HID_SVX_EXT0_START + 217)
-
+#ifdef OOo4Kids
+#define HID_BMPMASK_TBI_PADLOCK                     (HID_SVX_EXT0_START + 218)
+#define HID_BMPMASK_CTL_PADLOCK                     (HID_SVX_EXT0_START + 219)
+#endif
 // please adjust ACT_SVX_HID_END2 below if you add entries here!
 
 // -----------------------------------------------------------------------
@@ -831,7 +834,12 @@
 #error Resource-Ueberlauf in #line, #file
 #endif
 
-#define ACT_SVX_HID_END2    (HID_SVX_EXT0_START + 215)
+#ifdef OOo4Kids
+#define ACT_SVX_HID_END2    (HID_SVX_EXT0_START + 219)
+#else
+#define ACT_SVX_HID_END2    (HID_SVX_EXT0_START + 217)
+#endif
+
 #if ACT_SVX_HID_END2 > HID_SVX_EXT0_END
 #error resource overrun in #line, #file
 #endif
diff --git svx/inc/svx/svxacorr.hxx svx/inc/svx/svxacorr.hxx
index 0651f7c..1835315 100644
--- svx/inc/svx/svxacorr.hxx
+++ svx/inc/svx/svxacorr.hxx
@@ -65,6 +65,7 @@ const long SaveWordCplSttLst= 0x00000200;	// GrB. am SatzAnf. auto. aufnehmen
 const long SaveWordWrdSttLst= 0x00000400;	// 2 GrB. am WortAnf. auto. aufnehmen
 const long IngnoreDoubleSpace= 0x00000800;	// 2 Spaces ignorieren
 const long ChgSglQuotes		= 0x00001000;	// einfache Quotes ersetzen
+const long AddNonBrkSpace	= 0x00002000;	// Add non breaking space before :;?!
 
 const long ChgWordLstLoad	= 0x20000000;	// Ersetzungsliste geladen
 const long CplSttLstLoad	= 0x40000000;	// Exceptionlist fuer CplStart geladen
@@ -367,6 +368,9 @@ public:
     BOOL FnChgToEnEmDash( SvxAutoCorrDoc&, const String&,
                                 xub_StrLen nSttPos, xub_StrLen nEndPos,
                                 LanguageType eLang = LANGUAGE_SYSTEM );
+    BOOL FnAddNonBrkSpace( SvxAutoCorrDoc&, const String&,
+                                xub_StrLen nSttPos, xub_StrLen nEndPos,
+                                LanguageType eLang = LANGUAGE_SYSTEM );
     BOOL FnSetINetAttr( SvxAutoCorrDoc&, const String&,
                                 xub_StrLen nSttPos, xub_StrLen nEndPos,
                                 LanguageType eLang = LANGUAGE_SYSTEM );
diff --git svx/inc/svx/swafopt.hxx svx/inc/svx/swafopt.hxx
index 18ae7e0..eb557ea 100644
--- svx/inc/svx/swafopt.hxx
+++ svx/inc/svx/swafopt.hxx
@@ -68,6 +68,7 @@ struct SVX_DLLPUBLIC SvxSwAutoFmtFlags
     BOOL bChgFracionSymbol : 1;
     BOOL bChgOrdinalNumber : 1;
     BOOL bChgToEnEmDash : 1;
+    BOOL bAddNonBrkSpace : 1;
     BOOL bChgWeightUnderl : 1;
     BOOL bSetINetAttr : 1;
 
diff --git svx/source/cui/autocdlg.cxx svx/source/cui/autocdlg.cxx
index 4da7f0d..5704fcf 100644
--- svx/source/cui/autocdlg.cxx
+++ svx/source/cui/autocdlg.cxx
@@ -233,6 +233,7 @@ OfaAutocorrOptionsPage::OfaAutocorrOptionsPage( Window* pParent,
     sNoDblSpaces        (SVX_RES(STR_NO_DBL_SPACES    )),
     sHalf               (SVX_RES(ST_FRACTION          )),
     sDash    			(SVX_RES(ST_DASH	         	)),
+    sNonBrkSpace		(SVX_RES(ST_NON_BREAK_SPACE   )),
     sFirst              (SVX_RES(ST_ORDINAL           ))
 {
     FreeResource();
@@ -278,6 +279,7 @@ BOOL OfaAutocorrOptionsPage::FillItemSet( SfxItemSet& )
     pAutoCorrect->SetAutoCorrFlag(ChgOrdinalNumber,		aCheckLB.IsChecked(nPos++));
     pAutoCorrect->SetAutoCorrFlag(ChgFractionSymbol,	aCheckLB.IsChecked(nPos++));
     pAutoCorrect->SetAutoCorrFlag(ChgToEnEmDash,		aCheckLB.IsChecked(nPos++));
+    pAutoCorrect->SetAutoCorrFlag(AddNonBrkSpace,		aCheckLB.IsChecked(nPos++));
     pAutoCorrect->SetAutoCorrFlag(IngnoreDoubleSpace,	aCheckLB.IsChecked(nPos++));
 
     BOOL bReturn = nFlags != pAutoCorrect->GetFlags();
@@ -319,6 +321,7 @@ void OfaAutocorrOptionsPage::Reset( const SfxItemSet& )
     aCheckLB.InsertEntry(sFirst);
     aCheckLB.InsertEntry(sHalf);
     aCheckLB.InsertEntry(sDash);
+    aCheckLB.InsertEntry(sNonBrkSpace);
     aCheckLB.InsertEntry(sNoDblSpaces);
 
     USHORT nPos = 0;
@@ -330,6 +333,7 @@ void OfaAutocorrOptionsPage::Reset( const SfxItemSet& )
     aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & ChgOrdinalNumber) );
     aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & ChgFractionSymbol) );
     aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & ChgToEnEmDash) );
+    aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & AddNonBrkSpace) );
     aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & IngnoreDoubleSpace) );
 
     aCheckLB.SetUpdateMode(TRUE);
@@ -460,6 +464,7 @@ enum OfaAutoFmtOptions
     REPLACE_1ST,
     REPLACE_HALF,
     REPLACE_DASHES,
+    ADD_NON_BRK_SPACE,
     DEL_SPACES_AT_STT_END,
     DEL_SPACES_BETWEEN_LINES,
     IGNORE_DBLSPACE,
@@ -495,6 +500,7 @@ OfaSwAutoFmtOptionsPage::OfaSwAutoFmtOptionsPage( Window* pParent,
     sFraction			(SVX_RES(	ST_FRACTION     )),
     sDetectURL			(SVX_RES(	ST_DETECT_URL   )),
     sDash				(SVX_RES(	ST_DASH         )),
+    sNonBrkSpace        (SVX_RES(   ST_NON_BREAK_SPACE )),
     sOrdinal			(SVX_RES(	ST_ORDINAL      )),
     sRightMargin		(SVX_RES(	ST_RIGHT_MARGIN	)),
     sNum				(SVX_RES(	STR_NUM			)),
@@ -703,6 +709,12 @@ BOOL OfaSwAutoFmtOptionsPage::FillItemSet( SfxItemSet&  )
     pAutoCorrect->SetAutoCorrFlag(ChgToEnEmDash,
                         aCheckLB.IsChecked(REPLACE_DASHES, CBCOL_SECOND));
 
+    bCheck = aCheckLB.IsChecked(ADD_NON_BRK_SPACE, CBCOL_FIRST);
+    bModified |= pOpt->bAddNonBrkSpace != bCheck;
+    pOpt->bAddNonBrkSpace = bCheck;
+    pAutoCorrect->SetAutoCorrFlag(AddNonBrkSpace,
+                        aCheckLB.IsChecked(ADD_NON_BRK_SPACE, CBCOL_SECOND));
+
     bCheck = aCheckLB.IsChecked(DEL_SPACES_AT_STT_END, CBCOL_FIRST);
     bModified |= pOpt->bAFmtDelSpacesAtSttEnd != bCheck;
     pOpt->bAFmtDelSpacesAtSttEnd = bCheck;
@@ -759,6 +771,7 @@ void OfaSwAutoFmtOptionsPage::Reset( const SfxItemSet& )
     aCheckLB.GetModel()->Insert(CreateEntry(sOrdinal,			CBCOL_BOTH	));
     aCheckLB.GetModel()->Insert(CreateEntry(sFraction,			CBCOL_BOTH  ));
     aCheckLB.GetModel()->Insert(CreateEntry(sDash,				CBCOL_BOTH  ));
+    aCheckLB.GetModel()->Insert(CreateEntry(sNonBrkSpace,       CBCOL_BOTH  ));
     aCheckLB.GetModel()->Insert(CreateEntry(sDelSpaceAtSttEnd,	CBCOL_BOTH  ));
     aCheckLB.GetModel()->Insert(CreateEntry(sDelSpaceBetweenLines, CBCOL_BOTH  ));
 
@@ -790,6 +803,8 @@ void OfaSwAutoFmtOptionsPage::Reset( const SfxItemSet& )
     aCheckLB.CheckEntryPos( REPLACE_HALF,		CBCOL_SECOND,	0 != (nFlags & ChgFractionSymbol) );
     aCheckLB.CheckEntryPos( REPLACE_DASHES,		CBCOL_FIRST,	pOpt->bChgToEnEmDash );
     aCheckLB.CheckEntryPos( REPLACE_DASHES,		CBCOL_SECOND,	0 != (nFlags & ChgToEnEmDash) );
+    aCheckLB.CheckEntryPos( ADD_NON_BRK_SPACE,  CBCOL_FIRST,	0 != ( pOpt->bAddNonBrkSpace ) );
+    aCheckLB.CheckEntryPos( ADD_NON_BRK_SPACE,	CBCOL_SECOND,	0 != (nFlags & AddNonBrkSpace) );
     aCheckLB.CheckEntryPos( DEL_SPACES_AT_STT_END,		CBCOL_FIRST,	pOpt->bAFmtDelSpacesAtSttEnd );
     aCheckLB.CheckEntryPos( DEL_SPACES_AT_STT_END,		CBCOL_SECOND,	pOpt->bAFmtByInpDelSpacesAtSttEnd );
     aCheckLB.CheckEntryPos( DEL_SPACES_BETWEEN_LINES,	CBCOL_FIRST,	pOpt->bAFmtDelSpacesBetweenLines );
diff --git svx/source/cui/autocdlg.hrc svx/source/cui/autocdlg.hrc
index 65770db..7fe7358 100644
--- svx/source/cui/autocdlg.hrc
+++ svx/source/cui/autocdlg.hrc
@@ -152,6 +152,7 @@
 #define ST_DASH                         208
 #define FT_LANG                         209
 #define LB_LANG                         210
+#define ST_NON_BREAK_SPACE              211
 
 #define CB_SMARTTAGS                    220
 #define FT_SMARTTAGS                    221
diff --git svx/source/cui/autocdlg.hxx svx/source/cui/autocdlg.hxx
index f6e48d6..d479f34 100644
--- svx/source/cui/autocdlg.hxx
+++ svx/source/cui/autocdlg.hxx
@@ -118,6 +118,7 @@ private:
     String		sNoDblSpaces;
     String		sHalf;
     String		sDash;
+    String      sNonBrkSpace;
     String		sFirst;
 
 public:
@@ -160,6 +161,7 @@ class OfaSwAutoFmtOptionsPage : public SfxTabPage
     String			sFraction;
     String			sDetectURL;
     String          sDash;
+    String          sNonBrkSpace;
     String			sOrdinal;
     String			sRightMargin;
     String			sNum;
diff --git svx/source/cui/autocdlg.src svx/source/cui/autocdlg.src
index 0d9bc12..e27365f 100644
--- svx/source/cui/autocdlg.src
+++ svx/source/cui/autocdlg.src
@@ -140,6 +140,10 @@ TabDialog RID_OFA_AUTOCORR_DLG
     String ST_DASH \
     { \
         Text [ en-US ] = "Replace dashes" ; \
+    }; \
+    String ST_NON_BREAK_SPACE \
+    { \
+       Text [ en-US ] = "Add non breaking space before : ; ? ! in french text" ; \
     };
 
 /**************************************************************************/
diff --git svx/source/cui/cfg.src svx/source/cui/cfg.src
index 978ae63..9109db6 100644
--- svx/source/cui/cfg.src
+++ svx/source/cui/cfg.src
@@ -638,14 +638,14 @@ ModalDialog MD_ICONSELECTOR
     };       
     OKButton BTN_OK
     {
-        Pos = MAP_APPFONT ( 60 , 130 ) ; 
+        Pos = MAP_APPFONT ( 120 , 130 ) ; 
         Size = MAP_APPFONT ( 50 , 14 ) ;
         TabStop = TRUE ;
         DefButton = TRUE ;
     };
     CancelButton BTN_CANCEL
     {
-        Pos = MAP_APPFONT ( 120 , 130 ) ;
+        Pos = MAP_APPFONT ( 60 , 130 ) ;
         Size = MAP_APPFONT ( 50 , 14 ) ;
         TabStop = TRUE ;
     };
diff --git svx/source/cui/makefile.mk svx/source/cui/makefile.mk
index 7a1db4a..9bac29c 100755
--- svx/source/cui/makefile.mk
+++ svx/source/cui/makefile.mk
@@ -42,6 +42,10 @@ ENABLE_EXCEPTIONS=TRUE
 CFLAGS+= -DENABLE_LAYOUT=1 -I../$(PRJ)/layout/inc -I../$(PRJ)/layout/$(INPATH)/inc
 .ENDIF # ENABLE_LAYOUT == TRUE
 
+.IF "$(OOo4Kids)"=="YES"
+RSCDEFS+=-DOOo4Kids
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 SRS1NAME=cui
diff --git svx/source/cui/optgdlg.cxx svx/source/cui/optgdlg.cxx
index 12910c0..542eac6 100644
--- svx/source/cui/optgdlg.cxx
+++ svx/source/cui/optgdlg.cxx
@@ -101,12 +101,25 @@
 #include <com/sun/star/beans/XPropertySet.hpp>
 #include <com/sun/star/util/XChangesBatch.hpp>
 #include <com/sun/star/uno/Any.hxx>
-#include <com/sun/star/container/XContentEnumerationAccess.hpp>
 #include <com/sun/star/container/XSet.hpp>
 #include <com/sun/star/i18n/ScriptType.hpp>
 
 #include <vcl/svapp.hxx>
 
+#ifdef OOo4Kids
+// UNO stuff (read, write in the prefs)
+#include "vcl/unohelp.hxx"
+#include <com/sun/star/frame/XLayoutManager.hpp>
+#include <com/sun/star/frame/XLayoutManagerListener.hpp>
+#include <com/sun/star/frame/XLayoutManagerEventBroadcaster.hpp>
+#include <sfx2/childwin.hxx>
+// Password stuff
+#include <sfx2/passwd.hxx>
+#include <sfx2/sfxdlg.hxx>
+#include <svtools/PasswordHelper.hxx>
+#include <vcl/dialog.hxx>
+#endif
+
 #include "optgdlg.hrc"
 #include "optgdlg.hxx"
 #include "ofaitem.hxx"
@@ -116,6 +129,7 @@
 #define CONFIG_LANGUAGES "OfficeLanguages"
 
 using namespace ::com::sun::star::uno;
+using namespace ::com::sun::star::frame;
 using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star::container;
@@ -128,6 +142,185 @@ using ::rtl::OUString;
 
 #define MAX_PROGRAM_ENTRIES		3
 
+#ifdef DEBUG
+#include <rtl/strbuf.hxx>
+
+const sal_Char *dbg_dump(const rtl::OString &rStr)
+{
+    static rtl::OStringBuffer aStr;
+    aStr = rtl::OStringBuffer(rStr);
+    aStr.append(static_cast<char>(0));
+    return aStr.getStr();
+}
+
+const sal_Char *dbg_dump(const rtl::OUString &rStr)
+{
+    return dbg_dump(rtl::OUStringToOString(rStr, RTL_TEXTENCODING_UTF8));
+}
+
+const sal_Char *dbg_dump(rtl_String *pStr)
+{
+    return dbg_dump(rtl::OString(pStr));
+}
+
+const sal_Char *dbg_dump(rtl_uString *pStr)
+{
+    return dbg_dump(rtl::OUString(pStr));
+}
+#endif
+
+#ifdef OOo4Kids
+
+class SfxWorkWindow;
+
+static const OUString sULConfigSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationProvider" ) );
+static const OUString sULAccessSrvc( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.configuration.ConfigurationUpdateAccess" ) );
+static const OUString sULaNode( RTL_CONSTASCII_USTRINGPARAM( "/org.openoffice.Office.Common/Misc" ) );
+static const OUString sULPropertyName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserLevel" ) ) );
+static const OUString sPrefsPasswordPropertyName( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPrefsPassword" ) ) );
+static const OUString sPrefsPasswordPropertyIsEnabled( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPrefsPasswordFeatureEnabled" ) ) );
+static const OUString sPrefsPasswordPropertyNeverModified( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "UserPrefsPasswordNeverModified" ) ) );
+
+/* adapt the toolbars to the level */
+
+static const OUString aLayoutManagerPropName( RTL_CONSTASCII_USTRINGPARAM( "LayoutManager" ) );
+
+// The alignment bar
+// static const OUString sAlignmentToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/alignmentbar" ) );
+// The standard toolbar
+static const OUString sStandardbarToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/standardbar" ) );
+// The beginner toolbar (every application has its own)
+static const OUString sBeginnerbarToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/beginner" ) );
+// The average toolbar (every application has its own)
+static const OUString sAveragebarToolbarTypeName( RTL_CONSTASCII_USTRINGPARAM( "private:resource/toolbar/average" ) );
+
+static short setToolbarState( const OUString sSetAToolbarTypeName, bool isTrue )
+{
+    try
+    {
+        // avoids a crash if ever the user opens the prefs while the start center is the current view
+        if ( ! (SfxViewFrame::Current()) )
+            return -1;
+        
+        Reference< XPropertySet > xPropSet( SfxViewFrame::Current()->GetFrame()->GetFrameInterface(), UNO_QUERY );
+        Reference< XLayoutManager > xLayoutManager;
+
+        if ( xPropSet.is() )
+        {
+            Any aValue = xPropSet->getPropertyValue( aLayoutManagerPropName );
+            aValue >>= xLayoutManager;
+        }
+
+        if ( !xLayoutManager.is() )
+            return -1;
+        else
+        {
+            xLayoutManager->lock();
+
+            if ( isTrue )
+            {
+                // requestElement() adds ghosts of the alignmentar (bug ?)
+                xLayoutManager->requestElement( sSetAToolbarTypeName );
+                //xLayoutManager->showElement( sSetAToolbarTypeName );
+            }
+            else
+                xLayoutManager->destroyElement( sSetAToolbarTypeName );
+
+            // should refresh, but does not when showElement() is used
+            xLayoutManager->unlock();
+        }
+    }
+    catch( Exception& )
+    {
+    }
+    return 0;
+}
+
+
+static short getUserLevel()
+{
+    short dUserLevel = 1; // default is beginner 
+    try
+    {
+    // get service provider
+        Reference< XMultiServiceFactory > xSMgr( vcl::unohelper::GetMultiServiceFactory() );
+        // create configuration hierachical access name
+        if( xSMgr.is() )
+    {
+        try
+            {
+                Reference< XMultiServiceFactory > xConfigProvider(
+                    Reference< XMultiServiceFactory >(
+                        xSMgr->createInstance( sULConfigSrvc ),
+                        UNO_QUERY )
+                    );
+                if( xConfigProvider.is() )
+                {
+                    Sequence< Any > aArgs(1);
+                    PropertyValue aVal;
+                    aVal.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "nodepath" ) );
+                    aVal.Value <<= sULaNode;
+                    aArgs.getArray()[0] <<= aVal;
+                    Reference< XNameAccess > xConfigAccess(
+                        Reference< XNameAccess >(
+                            xConfigProvider->createInstanceWithArguments( sULAccessSrvc, aArgs ), UNO_QUERY )
+                        );
+                    if( xConfigAccess.is() )
+                    {
+                        try
+                        {
+                            short bValue = 1;
+                            Any aAny = xConfigAccess->getByName( sULPropertyName );
+                            if( aAny >>= bValue )
+                                dUserLevel = bValue;
+                        }
+                        catch( NoSuchElementException& )
+                        {
+                        }
+                        catch( WrappedTargetException& )
+                        {
+                        }
+                    }
+                }
+            }
+            catch( Exception& )
+            {
+            }
+        }
+    }
+    catch( WrappedTargetException& )
+    {
+    }
+    return dUserLevel;
+}
+
+static void setUserLevel( short nLevel )
+{
+    try
+    {
+        Reference < XMultiServiceFactory > xFactory = ::comphelper::getProcessServiceFactory();
+        // get configuration provider
+        Reference< XMultiServiceFactory > theConfigProvider = Reference< XMultiServiceFactory >(
+        xFactory->createInstance(sULConfigSrvc), UNO_QUERY_THROW);
+        Sequence< Any > theArgs(1);
+        NamedValue v(OUString::createFromAscii("NodePath"),
+            makeAny(OUString::createFromAscii("org.openoffice.Office.Common/Misc")));
+        theArgs[0] <<= v;
+        Reference< XPropertySet > pset = Reference< XPropertySet >(
+            theConfigProvider->createInstanceWithArguments(sULAccessSrvc, theArgs), UNO_QUERY_THROW);
+
+        Any result = pset->getPropertyValue(sULPropertyName);
+
+        pset->setPropertyValue(OUString::createFromAscii("UserLevel"), makeAny(nLevel));
+        Reference< XChangesBatch >(pset, UNO_QUERY_THROW)->commitChanges();
+    }
+    catch( Exception& )
+    {
+    }
+}
+
+#endif // OOo4Kids
+
 // class OfaMiscTabPage --------------------------------------------------
 
 int OfaMiscTabPage::DeactivatePage( SfxItemSet* pSet_ )
@@ -215,6 +408,17 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
     aHelpAgentResetBtn	( this, SVX_RES( PB_HELPAGENT_RESET ) ),
     aHelpFormatFT		( this, SVX_RES( FT_HELPFORMAT ) ),
     aHelpFormatLB		( this, SVX_RES( LB_HELPFORMAT ) ),
+#ifdef OOo4Kids
+    aUserLevelFL        ( this, SVX_RES( FL_USERLEVEL ) ),
+    aUserLevelBeginnerRB  ( this, SVX_RES( RB_USERLEVEL_BEGINNER ) ),
+    aUserLevelAverageRB   ( this, SVX_RES( RB_USERLEVEL_AVERAGE ) ),
+    aUserLevelExpertRB    ( this, SVX_RES( RB_USERLEVEL_EXPERT ) ),
+
+    // Enable/Disable Preferences password 
+    aPrefsPasswordFL    ( this, SVX_RES( FL_ENABLE_PREFS_PASSWORD ) ),
+    aPrefsPasswordCB    ( this, SVX_RES( CB_ENABLE_PREFS_PASSWORD ) ),
+    aChangePrefsPasswordBtn( this, SVX_RES( PB_CHANGE_PREFS_PASSWORD ) ),
+#endif
     aFileDlgFL			( this, SVX_RES( FL_FILEDLG ) ),
     aFileDlgROImage     ( this, SVX_RES( FI_FILEDLG_RO ) ),
     aFileDlgCB			( this, SVX_RES( CB_FILEDLG ) ),
@@ -225,18 +429,31 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
     aTwoFigureFL		( this, SVX_RES( FL_TWOFIGURE ) ),
     aInterpretFT		( this, SVX_RES( FT_INTERPRET ) ),
     aYearValueField		( this, SVX_RES( NF_YEARVALUE ) ),
-    aToYearFT			( this, SVX_RES( FT_TOYEAR ) )
-
+    aToYearFT			( this, SVX_RES( FT_TOYEAR ) ),
+    bIsPasswordFeatureEnabled ( getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED ) ),
+    bIsUserPrefsPasswordNeverModified ( getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_NEVER_MODIFIED ) ),
+    bIsChangesInPrefsAllowed (   !aPrefsPasswordCB.IsChecked() || !bIsPasswordFeatureEnabled
+                                || bIsUserPrefsPasswordNeverModified )
 {
     FreeResource();
 
+    //system fileopen only available in Windows and with gtk vclplug based
+    //picker and on MacOSX (aqua version)
+
+#if !defined( WNT ) && !defined( ENABLE_GTK ) && !( defined(MACOSX) && defined(QUARTZ) )
+    aFileDlgFL.Hide();
+    aFileDlgCB.Hide();
+#else
+#	ifdef ENABLE_GTK
     if (!lcl_HasSystemFilePicker())
     {
         aFileDlgFL.Hide();
         aFileDlgCB.Hide();
     }
+#	endif
+#endif
 
-    #if ! defined(QUARTZ)
+    #if ! defined(QUARTZ) || defined( OOo4Kids )
     aPrintDlgFL.Hide();
     aPrintDlgCB.Hide();
     #endif
@@ -313,6 +530,82 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
     aHelpAgentCB.SetClickHdl( aLink );
     aHelpAgentResetBtn.SetClickHdl( LINK( this, OfaMiscTabPage, HelpAgentResetHdl_Impl ) );
 
+#ifdef OOo4Kids
+    nTxtWidth = aChangePrefsPasswordBtn.GetTextWidth( aChangePrefsPasswordBtn.GetText() );
+    aBtnSz = aChangePrefsPasswordBtn.GetSizePixel();
+    if ( aBtnSz.Width() < nTxtWidth )
+    {
+        aBtnSz.Width() = nTxtWidth;
+        aChangePrefsPasswordBtn.SetSizePixel( aBtnSz );
+    }
+
+    aUserLevelBeginnerRB.SetClickHdl( LINK( this, OfaMiscTabPage, UserLevelCheckHdl_Impl ));
+    aUserLevelAverageRB.SetClickHdl( LINK( this, OfaMiscTabPage, UserLevelCheckHdl_Impl ));
+    aUserLevelExpertRB.SetClickHdl( LINK( this, OfaMiscTabPage, UserLevelCheckHdl_Impl ));
+
+    aPrefsPasswordCB.SetClickHdl( LINK( this, OfaMiscTabPage, aPrefsPasswordCBHdl_Impl ));
+    aChangePrefsPasswordBtn.SetClickHdl( LINK( this, OfaMiscTabPage, aChangePrefsPasswordBtnHdl_Impl ));
+
+    // Enable the checkbox: can be checked or unchecked by the user
+    aPrefsPasswordCB.Enable( true );
+    
+    // we read in the prefs whether the Password feature is enabled,
+    // and check/uncheck the checkbox accordingly
+    aPrefsPasswordCB.Check( bIsPasswordFeatureEnabled );
+
+    // if the checkebox is checked -> enable the "Change" bouton, else, disable
+    aChangePrefsPasswordBtn.Enable( aPrefsPasswordCB.IsChecked() );
+
+    bIsChangesInPrefsAllowed = (   !aPrefsPasswordCB.IsChecked() 
+                                || !bIsPasswordFeatureEnabled
+                                || bIsUserPrefsPasswordNeverModified );
+
+    // initialize the Radio button (User Level)
+    switch ( getUserLevel() )
+    {
+        case USER_LEVEL_BEGINNER:
+        {
+#ifdef DEBUG
+        fprintf(stdout, " %s : User level beginner \n", __func__);
+#endif
+
+            setToolbarState( sStandardbarToolbarTypeName, false);
+            setToolbarState( sBeginnerbarToolbarTypeName, true );
+            setToolbarState( sAveragebarToolbarTypeName, false);
+            aUserLevelBeginnerRB.SetState( TRUE );
+        }
+            break;
+
+        case USER_LEVEL_AVERAGE:
+        {
+#ifdef DEBUG
+            fprintf(stdout, " %s : User level average \n", __func__);
+#endif
+
+            setToolbarState( sStandardbarToolbarTypeName, false);
+            setToolbarState( sBeginnerbarToolbarTypeName, false );
+            setToolbarState( sAveragebarToolbarTypeName, true);
+            aUserLevelAverageRB.SetState( TRUE );
+        }
+            break;    
+
+        case USER_LEVEL_EXPERT:
+        {
+#ifdef DEBUG
+            fprintf(stdout, " %s : User level expert \n", __func__);
+#endif
+            aUserLevelExpertRB.SetState( TRUE );
+
+            setToolbarState( sStandardbarToolbarTypeName, true );
+            setToolbarState( sBeginnerbarToolbarTypeName, false );
+            setToolbarState( sAveragebarToolbarTypeName, false);
+        }
+            break;
+        default:
+            break;
+    }
+#endif // OOo4Kids
+
     //fill default names as user data
     static const char* aHelpFormatNames[] =
     {
@@ -334,6 +627,11 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
 
 OfaMiscTabPage::~OfaMiscTabPage()
 {
+    // even if the user unlocked the feature, keep the checkbox active 
+    // means the user wants to see the feature enabled at next preferences opening
+    if ( aPrefsPasswordCB.IsChecked() )
+        setUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED, true );
+
     for(USHORT i = 0; i < aHelpFormatLB.GetEntryCount(); i++)
     {
         delete static_cast< String* >( aHelpFormatLB.GetEntryData(i) );
@@ -456,6 +754,8 @@ void OfaMiscTabPage::Reset( const SfxItemSet& rSet )
 
 IMPL_LINK( OfaMiscTabPage, TwoFigureHdl, NumericField*, pEd )
 {
+    if ( GetIsChangesInPrefsAllowed() )
+    {
     (void)pEd;
 
     String aOutput( aStrDateInfo );
@@ -473,6 +773,7 @@ IMPL_LINK( OfaMiscTabPage, TwoFigureHdl, NumericField*, pEd )
         aOutput += String::CreateFromInt32( nNum );
     }
     aToYearFT.SetText( aOutput );
+    }
     return 0;
 }
 
@@ -480,11 +781,14 @@ IMPL_LINK( OfaMiscTabPage, TwoFigureHdl, NumericField*, pEd )
 
 IMPL_LINK( OfaMiscTabPage, TwoFigureConfigHdl, NumericField*, pEd )
 {
+    if ( GetIsChangesInPrefsAllowed() )
+    {
     sal_Int64 nNum = aYearValueField.GetValue();
     String aOutput( String::CreateFromInt64( nNum ) );
     aYearValueField.SetText( aOutput );
     aYearValueField.SetSelection( Selection( 0, aOutput.Len() ) );
     TwoFigureHdl( pEd );
+    }
     return 0;
 }
 
@@ -492,8 +796,11 @@ IMPL_LINK( OfaMiscTabPage, TwoFigureConfigHdl, NumericField*, pEd )
 
 IMPL_LINK( OfaMiscTabPage, HelpCheckHdl_Impl, CheckBox*, EMPTYARG )
 {
+    if ( GetIsChangesInPrefsAllowed() )
+    {
     aExtHelpCB.Enable( aToolTipsCB.IsChecked() );
     aHelpAgentResetBtn.Enable( aHelpAgentCB.IsChecked() );
+    }
     return 0;
 }
 
@@ -501,10 +808,251 @@ IMPL_LINK( OfaMiscTabPage, HelpCheckHdl_Impl, CheckBox*, EMPTYARG )
 
 IMPL_LINK( OfaMiscTabPage, HelpAgentResetHdl_Impl, PushButton*, EMPTYARG )
 {
+    if ( GetIsChangesInPrefsAllowed() )
     SvtHelpOptions().resetAgentIgnoreURLCounter();
+
+    return 0;
+}
+
+#ifdef OOo4Kids
+
+bool OfaMiscTabPage::getUserPrefsPasswordBoolProperty( USER_PASSWD_PREFS_PROPERTY aUserPrefsPasswordProperty )
+{
+    bool bToReturn = false;
+    OUString aBoolPropertyName;
+
+    switch ( aUserPrefsPasswordProperty )
+    {
+        case USERPREFS_PASSWORD_FEATURE_ENABLED:
+            aBoolPropertyName = sPrefsPasswordPropertyIsEnabled;
+            break;
+        case USERPREFS_PASSWORD_NEVER_MODIFIED:
+            aBoolPropertyName = sPrefsPasswordPropertyNeverModified;
+            break;
+        default:
+            break;
+    }
+
+    if ( aBoolPropertyName )
+    {
+        try
+        {
+        // get service provider
+            Reference< XMultiServiceFactory > xSMgr( vcl::unohelper::GetMultiServiceFactory() );
+            // create configuration hierachical access name
+            if( xSMgr.is() )
+            {
+                try
+                {
+                    Reference< XMultiServiceFactory > xConfigProvider(
+                        Reference< XMultiServiceFactory >(
+                            xSMgr->createInstance( sULConfigSrvc ),
+                            UNO_QUERY )
+                        );
+                    if( xConfigProvider.is() )
+                    {
+                        Sequence< Any > aArgs(1);
+                        PropertyValue aVal;
+                        aVal.Name = OUString( RTL_CONSTASCII_USTRINGPARAM( "nodepath" ) );
+                        aVal.Value <<= sULaNode;
+                        aArgs.getArray()[0] <<= aVal;
+                        Reference< XNameAccess > xConfigAccess(
+                            Reference< XNameAccess >(
+                                xConfigProvider->createInstanceWithArguments( sULAccessSrvc, aArgs ), UNO_QUERY )
+                            );
+                        if( xConfigAccess.is() )
+                        {
+                            try
+                            {
+                                bool bValue = 0;
+                                Any aAny = xConfigAccess->getByName( aBoolPropertyName );
+                                if( aAny >>= bValue )
+                                    bToReturn = bValue;
+                            }
+                            catch( NoSuchElementException& )
+                            {
+                            }
+                            catch( WrappedTargetException& )
+                            {
+                            }
+                        }
+                    }
+                }
+                catch( Exception& )
+                {
+                }
+            }
+        }
+        catch( WrappedTargetException& )
+        {
+        }
+    }
+    return bToReturn;
+}
+
+void OfaMiscTabPage::setUserPrefsPasswordBoolProperty( USER_PASSWD_PREFS_PROPERTY aUserPrefsPasswordProperty, bool aBool )
+{
+    OUString aBoolPropertyName;
+
+    switch ( aUserPrefsPasswordProperty )
+    {
+        case USERPREFS_PASSWORD_FEATURE_ENABLED:
+            aBoolPropertyName = sPrefsPasswordPropertyIsEnabled;
+            break;
+        case USERPREFS_PASSWORD_NEVER_MODIFIED:
+            aBoolPropertyName = sPrefsPasswordPropertyNeverModified;
+            break;
+        default:
+            break;
+    }
+
+    if ( aBoolPropertyName )
+    {
+        try
+        {
+            Reference < XMultiServiceFactory > xFactory = ::comphelper::getProcessServiceFactory();
+            // get configuration provider
+            Reference< XMultiServiceFactory > theConfigProvider = Reference< XMultiServiceFactory >(
+            xFactory->createInstance(sULConfigSrvc), UNO_QUERY_THROW);
+            Sequence< Any > theArgs(1);
+            NamedValue v(OUString::createFromAscii("NodePath"),
+                makeAny(OUString::createFromAscii("org.openoffice.Office.Common/Misc")));
+            theArgs[0] <<= v;
+            Reference< XPropertySet > pset = Reference< XPropertySet >(
+                theConfigProvider->createInstanceWithArguments(sULAccessSrvc, theArgs), UNO_QUERY_THROW);
+
+            Any result = pset->getPropertyValue( aBoolPropertyName );
+
+            pset->setPropertyValue( aBoolPropertyName, makeAny(aBool));
+            Reference< XChangesBatch >(pset, UNO_QUERY_THROW)->commitChanges();
+        }
+        catch( Exception& )
+        {
+        }
+    }
+}
+
+
+IMPL_LINK( OfaMiscTabPage, UserLevelCheckHdl_Impl, RadioButton*, pButton )
+{
+    if ( getUserPrefsPasswordBoolProperty ( USERPREFS_PASSWORD_FEATURE_ENABLED) )
+    {
+        short aLevel = getUserLevel();
+        switch ( aLevel )
+        {
+            case USER_LEVEL_BEGINNER: aUserLevelBeginnerRB.Check();
+                break;
+            case USER_LEVEL_AVERAGE: aUserLevelAverageRB.Check();
+                break;
+            case USER_LEVEL_EXPERT: aUserLevelExpertRB.Check();
+                break;
+            default:
+                break;
+        }
+    }
+    else
+    {
+        (void) pButton;
+        if ( aUserLevelExpertRB.IsChecked() )
+        {
+            setUserLevel( USER_LEVEL_EXPERT );
+
+            setToolbarState( sStandardbarToolbarTypeName, true );
+            setToolbarState( sBeginnerbarToolbarTypeName, false );
+            setToolbarState( sAveragebarToolbarTypeName, false);
+        }
+    
+        else if ( aUserLevelAverageRB.IsChecked() )
+        {
+            setUserLevel( USER_LEVEL_AVERAGE );
+
+            setToolbarState( sStandardbarToolbarTypeName, false );
+            setToolbarState( sBeginnerbarToolbarTypeName, false );
+            setToolbarState( sAveragebarToolbarTypeName, true);
+        }
+
+        else
+        {
+            setUserLevel( USER_LEVEL_BEGINNER );
+
+            setToolbarState( sStandardbarToolbarTypeName, false );
+            setToolbarState( sBeginnerbarToolbarTypeName, true );
+            setToolbarState( sAveragebarToolbarTypeName, false);
+        }
+    }
     return 0;
 }
 
+IMPL_LINK( OfaMiscTabPage, aPrefsPasswordCBHdl_Impl, CheckBox*, EMPTYARG  )
+{
+    if ( getUserPrefsPasswordBoolProperty ( USERPREFS_PASSWORD_FEATURE_ENABLED) )
+    {
+        // We keep the button checked
+        aPrefsPasswordCB.Check();
+    }
+    else
+        aChangePrefsPasswordBtn.Enable( aPrefsPasswordCB.IsChecked() );
+
+    return 0;
+}
+
+IMPL_LINK( OfaMiscTabPage, aChangePrefsPasswordBtnHdl_Impl, PushButton*, EMPTYARG )
+{
+    // emulates the end of the click
+    aChangePrefsPasswordBtn.Enable( false );
+    aChangePrefsPasswordBtn.Enable( aPrefsPasswordCB.IsChecked() );
+
+    // done only once
+    if ( bIsUserPrefsPasswordNeverModified )
+        setUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_NEVER_MODIFIED, false );
+
+    SfxPasswordDialog aPwdDialog( this );
+    aPwdDialog.ShowExtras( SHOWEXTRAS_CURRENT_PASSWD );
+    aPwdDialog.SetMinLen( 0 );
+    aPwdDialog.Execute();
+    return 0;
+}
+
+
+bool OfaMiscTabPage::IsPadlockLocked()
+{ 
+    bool toReturn = PADLOCK_LOCKED;
+
+    if ( getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED ) )
+    {
+        SfxPasswordDialog aPwdDialog( this );
+        aPwdDialog.ShowExtras( SHOWEXTRAS_NONE_OOO4KIDS );
+        aPwdDialog.SetMinLen( 0 );
+        short nErr = aPwdDialog.Execute();
+
+        if ( (RET_OK == nErr) && !aPwdDialog.bPasswordEntryFailed )
+        {
+#ifdef DEBUG
+            fprintf (stdout, "Setting USERPREFS_PASSWORD_FEATURE_ENABLED = false \n" );
+#endif
+            // deactivate the protection
+            setUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED, false );
+            toReturn = PADLOCK_UNLOCKED;
+        }
+    }
+    else
+    {
+        // click the padlock activates the password, and enables the password stuff !!
+        setUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED, true );
+        // be sure the checkbox is checked
+        aPrefsPasswordCB.Enable( true );
+        aPrefsPasswordCB.Check();
+        // if the checkebox is checked -> enable the "Change" bouton, else, disable
+        aChangePrefsPasswordBtn.Enable( aPrefsPasswordCB.IsChecked() );
+
+        toReturn = PADLOCK_LOCKED;
+
+    }
+    return toReturn;
+}
+
+#endif // OOo4Kids
+
 // -----------------------------------------------------------------------
 
 // -------------------------------------------------------------------
@@ -791,11 +1339,15 @@ OfaViewTabPage::OfaViewTabPage(Window* pParent, const SfxItemSet& rSet ) :
         switch( Application::GetSettings().GetStyleSettings().GetAutoSymbolsStyle() )
         {
             case STYLE_SYMBOLS_DEFAULT:     aAutoStr += aIconStyleLB.GetEntry( 1 ); break;
+#ifndef OOo4Kids
             case STYLE_SYMBOLS_INDUSTRIAL:  aAutoStr += aIconStyleLB.GetEntry( 2 ); break;
             case STYLE_SYMBOLS_CRYSTAL:     aAutoStr += aIconStyleLB.GetEntry( 3 ); break;
             case STYLE_SYMBOLS_TANGO:       aAutoStr += aIconStyleLB.GetEntry( 4 ); break;
             case STYLE_SYMBOLS_CLASSIC:     aAutoStr += aIconStyleLB.GetEntry( 5 ); break;
             case STYLE_SYMBOLS_HICONTRAST:  aAutoStr += aIconStyleLB.GetEntry( 6 ); break;
+#else
+            case STYLE_SYMBOLS_CRYSTAL:     aAutoStr += aIconStyleLB.GetEntry( 2 ); break;
+#endif
         }
 
         aIconStyleLB.RemoveEntry( 0 );
@@ -816,13 +1368,20 @@ OfaViewTabPage::~OfaViewTabPage()
 IMPL_LINK( OfaViewTabPage, OnAntialiasingToggled, void*, NOTINTERESTEDIN )
 {
     (void)NOTINTERESTEDIN;
+    OfaMiscTabPage * pOfaMiscTabPage = NULL;
+    bool bAvoidChanges = pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED );
 
+    if ( bAvoidChanges )
+    {
+    }
+    else
+    {
     sal_Bool bAAEnabled = aFontAntiAliasing.IsChecked();
 
     aAAPointLimitLabel.Enable( bAAEnabled );
     aAAPointLimit.Enable( bAAEnabled );
     aAAPointLimitUnits.Enable( bAAEnabled );
-
+    }
     return 0L;
 }
 #endif
@@ -831,8 +1390,18 @@ IMPL_LINK( OfaViewTabPage, OnAntialiasingToggled, void*, NOTINTERESTEDIN )
 IMPL_LINK( OfaViewTabPage, OnSelectionToggled, void*, NOTINTERESTEDIN )
 {
     (void)NOTINTERESTEDIN;
+
+    OfaMiscTabPage * pOfaMiscTabPage = NULL;
+    bool bAvoidChanges = pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED );
+
+    if ( bAvoidChanges )
+    {
+    }
+    else
+    {
     const bool bSelectionEnabled(maSelectionCB.IsChecked());
     maSelectionMF.Enable(bSelectionEnabled);
+    }
     return 0;
 }
 
@@ -864,7 +1433,11 @@ BOOL OfaViewTabPage::FillItemSet( SfxItemSet& )
     if( nSizeLB_InitialSelection != nSizeLB_NewSelection )
     {
         // from now on it's modified, even if via auto setting the same size was set as now selected in the LB
+#ifndef OOo4Kids
         sal_Int16 eSet = SFX_SYMBOLS_SIZE_AUTO;
+#else
+        sal_Int16 eSet = SFX_SYMBOLS_SIZE_LARGE;
+#endif
         switch( nSizeLB_NewSelection )
         {
             case 0: eSet = SFX_SYMBOLS_SIZE_AUTO;  break;
@@ -884,11 +1457,15 @@ BOOL OfaViewTabPage::FillItemSet( SfxItemSet& )
         {
             case 0: eSet = SFX_SYMBOLS_STYLE_AUTO;       break;
             case 1: eSet = SFX_SYMBOLS_STYLE_DEFAULT;    break;
+#ifndef OOo4Kids
             case 2: eSet = SFX_SYMBOLS_STYLE_HICONTRAST; break;
             case 3: eSet = SFX_SYMBOLS_STYLE_INDUSTRIAL; break;
             case 4: eSet = SFX_SYMBOLS_STYLE_CRYSTAL;    break;
             case 5: eSet = SFX_SYMBOLS_STYLE_TANGO;      break;
             case 6: eSet = SFX_SYMBOLS_STYLE_CLASSIC;    break;
+#else
+            case 2: eSet = SFX_SYMBOLS_STYLE_CRYSTAL;    break;
+#endif
             default:
                 DBG_ERROR( "OfaViewTabPage::FillItemSet(): This state of aIconStyleLB should not be possible!" );
         }
@@ -1067,6 +1644,7 @@ void OfaViewTabPage::Reset( const SfxItemSet& )
     {
         switch ( aMiscOptions.GetCurrentSymbolsStyle() )
         {
+#ifndef OOo4Kids
             case SFX_SYMBOLS_STYLE_DEFAULT:    nStyleLB_InitialSelection = 1; break;
             case SFX_SYMBOLS_STYLE_HICONTRAST: nStyleLB_InitialSelection = 2; break;
             case SFX_SYMBOLS_STYLE_INDUSTRIAL: nStyleLB_InitialSelection = 3; break;
@@ -1074,6 +1652,10 @@ void OfaViewTabPage::Reset( const SfxItemSet& )
             case SFX_SYMBOLS_STYLE_TANGO:      nStyleLB_InitialSelection = 5; break;
             case SFX_SYMBOLS_STYLE_CLASSIC:    nStyleLB_InitialSelection = 6; break;
             default:                           nStyleLB_InitialSelection = 0; break;
+#else
+            case SFX_SYMBOLS_STYLE_CRYSTAL:    nStyleLB_InitialSelection = 1; break;
+            default:                           nStyleLB_InitialSelection = 1; break;
+#endif
         }
     }
 
@@ -1837,6 +2419,15 @@ IMPL_LINK(  OfaLanguagesTabPage, SupportHdl, CheckBox*, pBox )
 {
     DBG_ASSERT( pBox, "OfaLanguagesTabPage::SupportHdl(): pBox invalid" );
 
+    OfaMiscTabPage * pOfaMiscTabPage = NULL;
+    bool bAvoidChanges = pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED );
+
+    if ( bAvoidChanges )
+    {
+    }
+    else
+    {
+
     sal_Bool bCheck = pBox->IsChecked();
     if ( &aAsianSupportCB == pBox )
     {
@@ -1862,7 +2453,7 @@ IMPL_LINK(  OfaLanguagesTabPage, SupportHdl, CheckBox*, pBox )
     {
         DBG_ERRORFILE( "OfaLanguagesTabPage::SupportHdl(): wrong pBox" );
     }
-
+    }
     return 0;
 }
 
@@ -1884,8 +2475,15 @@ namespace
  --------------------------------------------------*/
 IMPL_LINK( OfaLanguagesTabPage, LocaleSettingHdl, SvxLanguageBox*, pBox )
 {
+    OfaMiscTabPage * pOfaMiscTabPage = NULL;
+    bool bAvoidChanges = pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED );
+
+    if ( !bAvoidChanges )
+  {
+
     LanguageType eLang = pBox->GetSelectLanguage();
     sal_uInt16 nType = SvtLanguageOptions::GetScriptTypeOfLanguage(eLang);
+
     // first check if CTL must be enabled
     // #103299# - if CTL font setting is not readonly
     if(!pLangConfig->aLanguageOptions.IsReadOnly(SvtLanguageOptions::E_CTLFONT))
@@ -1920,7 +2518,7 @@ IMPL_LINK( OfaLanguagesTabPage, LocaleSettingHdl, SvxLanguageBox*, pBox )
     String sTempLabel(sDecimalSeparatorLabel);
     sTempLabel.SearchAndReplaceAscii("%1", aLocaleWrapper.getNumDecimalSep() );
     aDecimalSeparatorCB.SetText(sTempLabel);
-
+  }
     return 0;
 }
 
diff --git svx/source/cui/optgdlg.hrc svx/source/cui/optgdlg.hrc
index 4001d20..25bf954 100644
--- svx/source/cui/optgdlg.hrc
+++ svx/source/cui/optgdlg.hrc
@@ -55,10 +55,16 @@
 #define ROW5                    (ROW4+RSC_CD_PUSHBUTTON_HEIGHT+ROWSPACE)
 #define ROW6                    (ROW5+RSC_CD_DROPDOWN_HEIGHT+ROWSPACE)
 #define ROW7					(ROW6+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
+#ifdef OOo4Kids
+#define ROW8					(ROW7+RSC_CD_CHECKBOX_HEIGHT+3*ROWSPACE)
+#else
 #define ROW8					(ROW7+RSC_CD_CHECKBOX_HEIGHT+ROWSPACE)
+#endif
 #define ROW9					(ROW8+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
 #define ROW10					(ROW9+RSC_CD_CHECKBOX_HEIGHT+ROWSPACE)
 #define ROW11					(ROW10+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
+#define ROW12					(ROW11+RSC_CD_CHECKBOX_HEIGHT+ROWSPACE)
+#define ROW13					(ROW12+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
 
 #define DIFF(v1,v2)						(v2-v1)
 #define OFFS_TEXTBOX_FIXEDTEXT(base)	(base+(RSC_CD_TEXTBOX_HEIGHT-RSC_CD_FIXEDTEXT_HEIGHT)/2)
@@ -202,7 +208,16 @@
 #define FT_HELPAGENT_TIME_UNIT      59
 #define FL_DOCSTATUS                60
 #define CB_DOCSTATUS                61
-#endif // #ifndef _SVX_OPTGDLG_HRC
 
+#define FL_USERLEVEL                62
+#define RB_USERLEVEL_BEGINNER		63
+#define RB_USERLEVEL_AVERAGE		64
+#define RB_USERLEVEL_EXPERT         65
+
+#define FL_ENABLE_PREFS_PASSWORD	66
+#define CB_ENABLE_PREFS_PASSWORD	67
+#define PB_CHANGE_PREFS_PASSWORD	68
+
+#endif // #ifndef _SVX_OPTGDLG_HRC
 // ******************************************************************* EOF
 
diff --git svx/source/cui/optgdlg.hxx svx/source/cui/optgdlg.hxx
index 52fe207..a28f9bf 100644
--- svx/source/cui/optgdlg.hxx
+++ svx/source/cui/optgdlg.hxx
@@ -38,6 +38,24 @@
 #include <readonlyimage.hxx>
 #define FOLDERWEBVIEW_DEFAULTFILE   "folder.so"
 
+#if defined( OOo4Kids )
+#define USER_LEVEL_BEGINNER 1
+#define USER_LEVEL_AVERAGE  2
+#define USER_LEVEL_EXPERT   3
+
+#define PADLOCK_UNLOCKED    FALSE
+#define PADLOCK_LOCKED      TRUE
+
+enum aUserPasswordProperty
+{
+    USERPREFS_PASSWORD_FEATURE_ENABLED,
+    USERPREFS_PASSWORD_NEVER_MODIFIED
+};
+typedef enum aUserPasswordProperty USER_PASSWD_PREFS_PROPERTY;
+
+#endif
+
+
 // predeclarations
 class CanvasSettings;
 class SvtOptionsDrawinglayer;
@@ -55,7 +73,16 @@ private:
     PushButton          aHelpAgentResetBtn;
     FixedText           aHelpFormatFT;
     ListBox             aHelpFormatLB;
-
+#ifdef OOo4Kids
+    FixedLine	aUserLevelFL;
+    RadioButton	aUserLevelBeginnerRB;
+    RadioButton	aUserLevelAverageRB;
+    RadioButton	aUserLevelExpertRB;
+
+    FixedLine	aPrefsPasswordFL;
+    CheckBox	aPrefsPasswordCB;
+    PushButton  aChangePrefsPasswordBtn;
+#endif
     FixedLine           aFileDlgFL;
     ReadOnlyImage       aFileDlgROImage;
     CheckBox            aFileDlgCB;
@@ -77,6 +104,22 @@ private:
     DECL_LINK( TwoFigureConfigHdl, NumericField* );
     DECL_LINK( HelpCheckHdl_Impl, CheckBox* );
     DECL_LINK( HelpAgentResetHdl_Impl, PushButton* );
+#ifdef OOo4Kids
+    // value is true when password is disabled
+    // try to modify a value in the prefs,
+    // will trigger a password dialog box when set to false 
+    // (i.e. when the password is enabled)
+    bool            bIsPasswordFeatureEnabled;
+    bool            bIsUserPrefsPasswordNeverModified;
+    bool            bIsChangesInPrefsAllowed;
+    ::rtl::OUString        sUserPrefsPassword;
+
+    DECL_LINK( UserLevelCheckHdl_Impl, RadioButton* pButton );
+    DECL_LINK( aPrefsPasswordCBHdl_Impl, CheckBox* );
+    DECL_LINK( aChangePrefsPasswordBtnHdl_Impl, PushButton* );
+    DECL_LINK( aActivateUserPrefsProtectedBtnHdl_Impl, PushButton* );
+
+#endif
 protected:
     virtual int         DeactivatePage( SfxItemSet* pSet = NULL );
 
@@ -88,6 +131,14 @@ public:
 
     virtual	BOOL 		FillItemSet( SfxItemSet& rSet );
     virtual	void 		Reset( const SfxItemSet& rSet );
+#ifdef OOo4Kids
+    bool                GetIsChangesInPrefsAllowed() { return bIsChangesInPrefsAllowed; }
+    void                EnableChangesInPrefs() { bIsChangesInPrefsAllowed = true; }
+    void                DisableChangesInPrefs() { bIsChangesInPrefsAllowed = false; }
+    bool                getUserPrefsPasswordBoolProperty( USER_PASSWD_PREFS_PROPERTY );
+    void                setUserPrefsPasswordBoolProperty( USER_PASSWD_PREFS_PROPERTY, bool );
+    bool                IsPadlockLocked();
+#endif
 };
 
 // class OfaViewTabPage --------------------------------------------------
diff --git svx/source/cui/optgdlg.src svx/source/cui/optgdlg.src
index f663a7e..f0a5220 100644
--- svx/source/cui/optgdlg.src
+++ svx/source/cui/optgdlg.src
@@ -2,28 +2,28 @@
  *
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
- * Copyright 2008 by Sun Microsystems, Inc.
+ * Copyright 2009 Eric Bachard
  *
- * OpenOffice.org - a multi-platform office productivity suite
+ * OOo4Kids - a multi-platform office productivity suite
  *
- * $RCSfile: optgdlg.src,v $
+ * $RCSfile: optgdlg-OOo4Kids.src,v $
  * $Revision: 1.32 $
  *
- * This file is part of OpenOffice.org.
+ * This file is part of OOo4Kids.
  *
- * OpenOffice.org is free software: you can redistribute it and/or modify
+ * OOo4Kids is free software: you can redistribute it and/or modify
  * it under the terms of the GNU Lesser General Public License version 3
  * only, as published by the Free Software Foundation.
  *
- * OpenOffice.org is distributed in the hope that it will be useful,
+ * OOo4Kids is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU Lesser General Public License version 3 for more details
  * (a copy is included in the LICENSE file that accompanied this code).
  *
  * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://license.ooo4kids.org>
  * for a copy of the LGPLv3 License.
  *
  ************************************************************************/
@@ -39,6 +39,8 @@
  //
  //****************************************************************************
 
+#define MASKCOLOR       MaskColor = Color { Red = 0xFFFF ; Green = 0x0000 ; Blue = 0xFFFF ; };
+
 TabPage OFA_TP_MISC
 {
     HelpID = HID_OFA_TP_MISC ;
@@ -48,42 +50,42 @@ TabPage OFA_TP_MISC
     FixedLine FL_HELP
     {
         Pos = MAP_APPFONT( COL0, ROW0 );
-        Size = MAP_APPFONT( WHOLE_WIDTH, RSC_CD_FIXEDLINE_HEIGHT );
+    Size = MAP_APPFONT( WHOLE_WIDTH, 10 );
         Text [ en-US ] = "Help";
     };
     CheckBox CB_TOOLTIP
     {
         Pos = MAP_APPFONT( COL1, ROW1 );
-        Size = MAP_APPFONT( WHOLE_WIDTH - COL1, RSC_CD_CHECKBOX_HEIGHT );
+        Size = MAP_APPFONT ( 60, 10 ) ;
         Text [ en-US ] = "~Tips";
     };
     CheckBox CB_EXTHELP
     {
-        Pos = MAP_APPFONT( COL2, ROW2 );
-        Size = MAP_APPFONT( WHOLE_WIDTH - COL2, RSC_CD_CHECKBOX_HEIGHT );
+        Pos = MAP_APPFONT ( COL1 + 60, ROW1 ) ;
+        Size = MAP_APPFONT ( 60, 10 ) ;
         Text [ en-US ] = "~Extended tips";
     };
     CheckBox CB_HELPAGENT
     {
-        Pos = MAP_APPFONT( COL1, ROW3 );
-        Size = MAP_APPFONT( WHOLE_WIDTH - COL1, RSC_CD_CHECKBOX_HEIGHT );
+    Pos = MAP_APPFONT( COL1 + 120, ROW1 );
+        Size = MAP_APPFONT ( 60, 10 ) ;
         Text [ en-US ] = "~Help Agent";
     };
     PushButton PB_HELPAGENT_RESET
     {
-        Pos = MAP_APPFONT( COL2, ROW4 );
+    Pos = MAP_APPFONT( COL1 + 180, ROW1 );
         Size = MAP_APPFONT( RSC_CD_PUSHBUTTON_WIDTH, RSC_CD_PUSHBUTTON_HEIGHT );
         Text [ en-US ] = "~Reset Help Agent";
     };
     FixedText FT_HELPFORMAT
     {
-        Pos = MAP_APPFONT( COL1, OFFS_TEXTBOX_FIXEDTEXT(ROW5) );
+        Pos = MAP_APPFONT( COL1, ROW3 );
         Size = MAP_APPFONT( DIFF( COL1, COL3 ), RSC_CD_FIXEDTEXT_HEIGHT );
         Text [ en-US ] = "Help ~formatting";
     };
     ListBox LB_HELPFORMAT
     {
-        Pos = MAP_APPFONT( COL4, ROW5 );
+        Pos = MAP_APPFONT( COL4, ROW3 );
         Size = MAP_APPFONT( WHOLE_WIDTH - COL4, 50 );
         DropDown = TRUE ;
         Border = TRUE ;
@@ -97,52 +99,153 @@ TabPage OFA_TP_MISC
             < "High Contrast White" ; > ;
         };
     };
-    FixedLine FL_FILEDLG
+    FixedLine FL_USERLEVEL
+    {
+        Pos = MAP_APPFONT( COL0, ROW4 );
+        Size = MAP_APPFONT( WHOLE_WIDTH, 10 );
+        Text [ en-US ] = "User Level";
+        Text [ de ] = "Benutzer-Level";
+        Text [ es ] = "Nivel de usuario";
+        Text [ fr ] = "Niveau";
+        Text [ it ] = "Livello dell'utente";
+        Text [ nl ] = "Gebruikersniveau";
+        Text [ pt ] = "Nvel do(a) utilizador(a)";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Osaamistaso";
+    };
+    RadioButton RB_USERLEVEL_BEGINNER
+    {
+        TabStop = TRUE;
+        Pos = MAP_APPFONT ( COL1, ROW5 ) ;
+        Size = MAP_APPFONT ( 60, 10 ) ;
+        Text [ en-US ] = "Beginner";
+        Text [ es ] = "Principiante";
+        Text [ fr ] = "Dbutant";
+        Text [ it ] = "Principiante";
+        Text [ de ] = "Anfnger";
+        Text [ nl ] = "Beginner";
+        Text [ pt ] = "Principiante";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Alkaja";
+    };
+    RadioButton RB_USERLEVEL_AVERAGE
+    {
+        TabStop = TRUE;
+        Pos = MAP_APPFONT ( COL1 + 60, ROW5 ) ;
+        Size = MAP_APPFONT ( 60, 10 ) ;
+        Text [ en-US ] = "Average";
+        Text [ es ] = "Promedio";
+        Text [ fr ] = "Moyen";
+        Text [ it ] = "Medio";
+        Text [ de ] = "Fortgeschrittener";
+        Text [ nl ] = "Gemiddeld";
+        Text [ pt ] = "Mdio";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Osaaja";
+    };
+    RadioButton RB_USERLEVEL_EXPERT
+    {
+        TabStop = TRUE;
+        Pos = MAP_APPFONT( COL1 + 120, ROW5 );
+        Size = MAP_APPFONT ( 60, 10 ) ;
+        Text [ en-US ] = "Expert";
+        Text [ de ] = "Experte";
+        Text [ es ] = "Exerto";
+        Text [ fr ] = "Expert";
+        Text [ it ] = "Esperto";
+        Text [ nl ] = "Expert";
+        Text [ pt ] = "Especialista";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Taituri";
+    };
+
+    FixedLine FL_ENABLE_PREFS_PASSWORD
     {
         Pos = MAP_APPFONT( COL0, ROW6 );
         Size = MAP_APPFONT( WHOLE_WIDTH, RSC_CD_FIXEDLINE_HEIGHT );
+        Text [ en-US ] = "User Preferences protection";
+        Text [ es ] = "Proteccin de preferencias de usuario";
+        Text [ fr ] = "Protection des prfrences utilisateur";
+        Text [ it ] = "Protezione delle preferenze dell'utente";
+        Text [ de ] = "Schutz der Benutzereinstellungen";
+        Text [ nl ] = "Gebruikersinstellingen beveiligen";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Kyttasetusten suojaus";
+    };
+    CheckBox CB_ENABLE_PREFS_PASSWORD
+    {
+        Pos = MAP_APPFONT( COL1, ROW7 );
+        Size = MAP_APPFONT( COL1 + 160 , RSC_CD_CHECKBOX_HEIGHT );
+        Text [ en-US ] = "Enable password";
+        Text [ es ] = "Activar contrasea";
+        Text [ fr ] = "Activer le mot de passe";
+        Text [ it ] = "Abilita password";
+        Text [ de ] = "Passwort aktivieren";
+        Text [ nl ] = "Wachtwoord activeren";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Kyt salasanaa";
+    };
+    PushButton PB_CHANGE_PREFS_PASSWORD
+    {
+        Pos = MAP_APPFONT( COL1 + 180, ROW7 );
+        Size = MAP_APPFONT( RSC_CD_PUSHBUTTON_WIDTH, RSC_CD_PUSHBUTTON_HEIGHT );
+        Text [ en-US ] = "Change";
+        Text [ es ] = "Modificar";
+        Text [ fr ] = "Changer";
+        Text [ it ] = "Modifica";
+        Text [ de ] = "ndern";
+        Text [ nl ] = "Wijzigen";
+        Text [ pt ] = "Modificar";
+        Text [ zh-CN ] = "";
+        Text [ fi ] = "Muutos";
+    };
+
+    FixedLine FL_FILEDLG
+    {
+        Pos = MAP_APPFONT( COL0, ROW8 );
+        Size = MAP_APPFONT( WHOLE_WIDTH, RSC_CD_FIXEDLINE_HEIGHT );
         Text [ en-US ] = "Open/Save dialogs";
     };
     FixedImage FI_FILEDLG_RO
     {
-        Pos = MAP_APPFONT( COL1 - 7, ROW7 + 2 );
+        Pos = MAP_APPFONT( COL1 - 7, ROW9 + 2 );
         Size = MAP_APPFONT( 6, 6 );
         Hide = TRUE;
     };
     CheckBox CB_FILEDLG
     {
-        Pos = MAP_APPFONT( COL1, ROW7 );
+        Pos = MAP_APPFONT( COL1, ROW9 );
         Size = MAP_APPFONT( WHOLE_WIDTH - COL1, RSC_CD_CHECKBOX_HEIGHT );
         Text [ en-US ] = "~Use %PRODUCTNAME dialogs";
     };
     FixedLine FL_DOCSTATUS
     {
-        Pos = MAP_APPFONT( COL0, ROW8 );
+        Pos = MAP_APPFONT( COL0, ROW10 );
         Size = MAP_APPFONT( WHOLE_WIDTH, RSC_CD_FIXEDLINE_HEIGHT );
         Text [ en-US ] = "Document status";
     };
     CheckBox CB_DOCSTATUS
     {
-        Pos = MAP_APPFONT( COL1, ROW9 );
+        Pos = MAP_APPFONT( COL1, ROW11 );
         Size = MAP_APPFONT( WHOLE_WIDTH - COL1, RSC_CD_CHECKBOX_HEIGHT );
         Text [ en-US ] = "~Printing sets \"document modified\" status";
     };
     FixedLine FL_TWOFIGURE
     {
-        Pos = MAP_APPFONT( COL0, ROW10 );
+        Pos = MAP_APPFONT( COL0, ROW12 );
         Size = MAP_APPFONT( WHOLE_WIDTH, RSC_CD_FIXEDLINE_HEIGHT );
         Text [ en-US ] = "Year (two digits)" ;
     };
     FixedText FT_INTERPRET
     {
-        Pos = MAP_APPFONT( COL1, OFFS_TEXTBOX_FIXEDTEXT(ROW11) );
+        Pos = MAP_APPFONT( COL1, OFFS_TEXTBOX_FIXEDTEXT(ROW13) );
         Size = MAP_APPFONT( DIFF( COL1, COL3), RSC_CD_FIXEDTEXT_HEIGHT );
         Text [ en-US ] = "Interpret as years between";
     };
     NumericField NF_YEARVALUE
     {
         Border = TRUE ;
-        Pos = MAP_APPFONT( COL4, ROW11 );
+        Pos = MAP_APPFONT( COL4, ROW13 );
         Size = MAP_APPFONT( EDIT_WIDTH, RSC_CD_TEXTBOX_HEIGHT );
         Minimum = 1583 ;
         Maximum = 9857 ;
@@ -151,7 +254,7 @@ TabPage OFA_TP_MISC
     };
     FixedText FT_TOYEAR
     {
-        Pos = MAP_APPFONT( COL6, OFFS_TEXTBOX_FIXEDTEXT(ROW11) );
+        Pos = MAP_APPFONT( COL6, OFFS_TEXTBOX_FIXEDTEXT(ROW13) );
         Size = MAP_APPFONT( WHOLE_WIDTH - COL6, RSC_CD_FIXEDTEXT_HEIGHT );
         Text [ en-US ] = "and " ;
     };
@@ -187,6 +290,7 @@ TabPage OFA_TP_VIEW
         Size = MAP_APPFONT ( 120 , 8 ) ;
         Text [ en-US ] = "User Interface" ;
     };
+
     FixedText FT_WINDOWSIZE
     {
         Pos = MAP_APPFONT ( 12 , OFFS_TEXTBOX_FIXEDTEXT( ROW_MF_SCALING ) ) ;
@@ -245,12 +349,8 @@ TabPage OFA_TP_VIEW
         StringList [ en-US ] =
         {
             < "Automatic" ; > ;
-            < "Galaxy (default)" ; > ;
-            < "High Contrast" ; > ;
-            < "Industrial" ; > ;
+            < "Galaxy" ; > ;
             < "Crystal" ; > ;
-            < "Tango" ; > ;
-            < "Classic" ; > ;
         };
     };
     CheckBox CB_SYSTEM_FONT
@@ -639,4 +739,3 @@ InfoBox RID_SVX_MSGBOX_LANGUAGE_RESTART
     Message [ en-US ] = "The language setting of the user interface has been updated and will take effect the next time you start %PRODUCTNAME %PRODUCTVERSION";
 };
 
-
diff --git svx/source/cui/tpcolor.cxx svx/source/cui/tpcolor.cxx
index a373c98..755f670 100644
--- svx/source/cui/tpcolor.cxx
+++ svx/source/cui/tpcolor.cxx
@@ -175,8 +175,15 @@ SvxColorTabPage::SvxColorTabPage
 
     // ValueSet
     aValSetColorTable.SetStyle( aValSetColorTable.GetStyle() | WB_VSCROLL | WB_ITEMBORDER );
+
+//  columns x lines in the Colors preferences
+#if !defined( OOo4Kids )
     aValSetColorTable.SetColCount( 8 );
     aValSetColorTable.SetLineCount( 10 );
+#else
+    aValSetColorTable.SetColCount( 4 );
+    aValSetColorTable.SetLineCount( 4 );
+#endif
     aValSetColorTable.SetExtraSpacing( 0 );
     aValSetColorTable.Show();
 
diff --git svx/source/cui/treeopt.cxx svx/source/cui/treeopt.cxx
index 52d4752..a13c708 100644
--- svx/source/cui/treeopt.cxx
+++ svx/source/cui/treeopt.cxx
@@ -148,6 +148,14 @@
 #include <drawitem.hxx>
 #include <rtl/uri.hxx>
 
+#ifdef OOo4Kids
+// Password stuff
+#include <sfx2/passwd.hxx>
+#include <sfx2/sfxdlg.hxx>
+#include <svtools/PasswordHelper.hxx>
+#include <vcl/dialog.hxx>
+#endif
+
 using namespace ::com::sun::star;
 using namespace ::com::sun::star::beans;
 using namespace ::com::sun::star::container;
@@ -208,12 +216,13 @@ static ModuleToGroupNameMap_Impl ModuleMap[] =
     { "LoadSave", String::EmptyString(), SID_FILTER_DLG },
     { "Writer", String::EmptyString(), SID_SW_EDITOPTIONS },
     { "WriterWeb", String::EmptyString(), SID_SW_ONLINEOPTIONS },
+#ifndef OOo4Kids
     { "Math", String::EmptyString(), SID_SM_EDITOPTIONS },
+#endif
     { "Calc", String::EmptyString(), SID_SC_EDITOPTIONS },
     { "Impress", String::EmptyString(), SID_SD_EDITOPTIONS },
     { "Draw", String::EmptyString(), SID_SD_GRAPHIC_OPTIONS },
     { "Charts", String::EmptyString(), SID_SCH_EDITOPTIONS },
-    { "Base", String::EmptyString(), SID_SB_STARBASEOPTIONS },
 
     { NULL, String::EmptyString(), 0xFFFF }
 };
@@ -265,10 +274,10 @@ static String getGroupName( const rtl::OUString& rModule, bool bForced )
             sGroupName = pPageRes->GetImpressArray().GetString(0);
         else if ( rModule == C2U("Draw") )
             sGroupName = pPageRes->GetDrawArray().GetString(0);
+#ifndef OOo4Kids
         else if ( rModule == C2U("Math") )
             sGroupName = pPageRes->GetStarMathArray().GetString(0);
-        else if ( rModule == C2U("Base") )
-            sGroupName = pPageRes->GetDatasourcesArray().GetString(0);
+#endif
     }
     return sGroupName;
 }
@@ -360,16 +369,16 @@ SfxTabPage*	CreateGeneralTabPage( sal_uInt16 nId, Window* pParent, const SfxItem
         case RID_SVXPAGE_ASIAN_LAYOUT:				fnCreate = &SvxAsianLayoutPage::Create; break;
         case RID_SVX_FONT_SUBSTITUTION:				fnCreate = &SvxFontSubstTabPage::Create; break;
         case RID_SVXPAGE_INET_PROXY:				fnCreate = &SvxProxyTabPage::Create; break;
+#ifndef OOo4Kids
         case RID_SVXPAGE_INET_SEARCH:				fnCreate = &SvxSearchTabPage::Create; break;
         case RID_SVXPAGE_INET_SECURITY:				fnCreate = &SvxSecurityTabPage::Create; break;
+#endif
         case RID_SVXPAGE_INET_MAIL:					fnCreate = &SvxEMailTabPage::Create; break;
         case RID_SVXPAGE_COLORCONFIG:				fnCreate = &SvxColorOptionsTabPage::Create; break;
         case RID_OFAPAGE_HTMLOPT:					fnCreate = &OfaHtmlTabPage::Create; break;
         case SID_OPTFILTER_MSOFFICE:				fnCreate = &OfaMSFilterTabPage::Create; break;
         case RID_OFAPAGE_MSFILTEROPT2:				fnCreate = &OfaMSFilterTabPage2::Create; break;
         case RID_SVXPAGE_JSEARCH_OPTIONS:			fnCreate = &SvxJSearchOptionsPage::Create ; break;
-        case SID_SB_CONNECTIONPOOLING:				fnCreate = &::offapp::ConnectionPoolOptionsPage::Create; break;
-        case SID_SB_DBREGISTEROPTIONS:				fnCreate = &::svx::DbRegistrationOptionsPage::Create; break;
         case RID_SVXPAGE_ACCESSIBILITYCONFIG:		fnCreate = &SvxAccessibilityOptionsTabPage::Create; break;
         case RID_SVXPAGE_SSO:						fnCreate = GetSSOCreator(); break;
         case RID_SVXPAGE_OPTIONS_CTL:				fnCreate = &SvxCTLOptionsPage::Create ; break;
@@ -377,7 +386,9 @@ SfxTabPage*	CreateGeneralTabPage( sal_uInt16 nId, Window* pParent, const SfxItem
         case RID_SVXPAGE_INET_MOZPLUGIN:			fnCreate = &MozPluginTabPage::Create; break;
         //added by jmeng end
         case RID_SVXPAGE_OPTIONS_JAVA:				fnCreate = &SvxJavaOptionsPage::Create ; break;
+#ifndef OOo4Kids
         case RID_SVXPAGE_ONLINEUPDATE:				fnCreate = &SvxOnlineUpdateTabPage::Create; break;
+#endif
         case RID_OPTPAGE_CHART_DEFCOLORS:			fnCreate = &SvxDefaultColorOptPage::Create; break;
         case RID_SVXPAGE_IMPROVEMENT:               fnCreate = &SvxImprovementOptionsPage::Create; break;
     }
@@ -406,7 +417,9 @@ static OptionsMapping_Impl __READONLY_DATA OptionsMap_Impl[] =
     { "ProductName",        "Paths",                RID_SFXPAGE_PATH },
     { "ProductName",        "Colors",               RID_SVXPAGE_COLOR },
     { "ProductName",        "Fonts",                RID_SVX_FONT_SUBSTITUTION },
+#ifndef OOo4Kids
     { "ProductName",        "Security",             RID_SVXPAGE_INET_SECURITY },
+#endif
     { "ProductName",        "Appearance",           RID_SVXPAGE_COLORCONFIG },
     { "ProductName",        "Accessibility",        RID_SVXPAGE_ACCESSIBILITYCONFIG },
     { "ProductName",        "Java",                 RID_SVXPAGE_OPTIONS_JAVA },
@@ -473,9 +486,6 @@ static OptionsMapping_Impl __READONLY_DATA OptionsMap_Impl[] =
     { "Draw",               "Print",                SID_SD_TP_PRINT },
     { "Charts",             NULL,                   SID_SCH_EDITOPTIONS },
     { "Charts",             "DefaultColors",        RID_OPTPAGE_CHART_DEFCOLORS },
-    { "Base",               NULL,                   SID_SB_STARBASEOPTIONS },
-    { "Base",               "Connections",          SID_SB_CONNECTIONPOOLING },
-    { "Base",               "Databases",            SID_SB_DBREGISTEROPTIONS },
     { NULL,                 NULL,                   0 }
 };
 
@@ -559,11 +569,16 @@ sal_Bool OfaOptionsTreeListBox::Collapse( SvLBoxEntry* pParent )
 
 // -----------------------------------------------------------------------
 
+#define BMP_RESID(nId)  ResId(nId, DIALOG_MGR())
+
 #define INI_LIST() \
     aOkPB               ( this, SVX_RES( PB_OK ) ),\
     aCancelPB           ( this, SVX_RES( PB_CANCEL ) ),\
     aHelpPB             ( this, SVX_RES( PB_HELP ) ),\
     aBackPB             ( this, SVX_RES( PB_BACK ) ),\
+    aPadlockOpenImageButton     ( this, SVX_RES( BUTTON_PADLOCK_OPEN ) ),\
+    aPadlockClosedImageButton     ( this, SVX_RES( BUTTON_PADLOCK_CLOSED ) ),\
+    aPadlockButtonImageSize ( 20, 20 ),\
     aHiddenGB           ( this, SVX_RES( FB_BORDER ) ),\
     aPageTitleFT        ( this, SVX_RES( FT_PAGE_TITLE ) ),\
     aLine1FL            ( this, SVX_RES( FL_LINE_1 ) ),\
@@ -586,6 +601,8 @@ sal_Bool OfaOptionsTreeListBox::Collapse( SvLBoxEntry* pParent )
     bIsFromExtensionManager( false ), \
     bIsForSetDocumentLanguage( false )
 
+// to initialize the tree // FIXME : find a more elegant solution
+
 // Ctor() with Frame -----------------------------------------------------
 using namespace ::com::sun::star;
 OfaTreeOptionsDialog::OfaTreeOptionsDialog(
@@ -602,8 +619,10 @@ OfaTreeOptionsDialog::OfaTreeOptionsDialog(
     Initialize( _xFrame );
     LoadExtensionOptions( rtl::OUString() );
     ResizeTreeLB();
+    SetPadlockImage();
     if (bActivateLastSelection)
         ActivateLastSelection();
+    ActivatePage( OFA_TP_MISC );
 }
 
 // Ctor() with ExtensionId -----------------------------------------------
@@ -611,7 +630,6 @@ OfaTreeOptionsDialog::OfaTreeOptionsDialog(
 OfaTreeOptionsDialog::OfaTreeOptionsDialog( Window* pParent, const rtl::OUString& rExtensionId ) :
 
     SfxModalDialog( pParent, SVX_RES( RID_OFADLG_OPTIONS_TREE ) ),
-
     INI_LIST()
 
 {
@@ -622,6 +640,27 @@ OfaTreeOptionsDialog::OfaTreeOptionsDialog( Window* pParent, const rtl::OUString
     LoadExtensionOptions( rExtensionId );
     ResizeTreeLB();
     ActivateLastSelection();
+    ActivatePage( OFA_TP_MISC );
+    SetPadlockImage();
+}
+
+
+void OfaTreeOptionsDialog::SetPadlockImage()
+{
+    OfaMiscTabPage * pOfaMiscTabPage = NULL;
+    bool isLocked = pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED );
+    
+    if ( isLocked )
+    {
+        aPadlockOpenImageButton.Hide();
+        aPadlockClosedImageButton.Show();
+    }
+    else
+    {
+        aPadlockClosedImageButton.Hide();
+        aPadlockOpenImageButton.Show();
+    }
+    pOfaMiscTabPage = NULL;
 }
 
 /* -----------------11.02.99 07:58-------------------
@@ -758,18 +797,43 @@ IMPL_LINK( OfaTreeOptionsDialog, BackHdl_Impl, PushButton*, EMPTYARG )
             pPageInfo->m_pExtPage->ResetPage();
     }
     return 0;
+
 }
 /* -----------------11.02.99 16:45-------------------
  *
  * --------------------------------------------------*/
 IMPL_LINK( OfaTreeOptionsDialog, OKHdl_Impl, Button *, EMPTYARG )
 {
+    OfaMiscTabPage * pOfaMiscTabPage = NULL;
+    bool bAvoidChanges = pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED );
+
+#ifdef DEBUG
+    fprintf( stdout, "bAvoidChanges = %d \n", bAvoidChanges);
+#endif
     aTreeLB.EndSelection();
     if ( pCurrentPageEntry && aTreeLB.GetParent( pCurrentPageEntry ) )
     {
         OptionsPageInfo* pPageInfo = (OptionsPageInfo *)pCurrentPageEntry->GetUserData();
         if ( pPageInfo->m_pPage )
         {
+            if ( ( OFA_TP_MISC == pPageInfo->m_nPageId ) )
+            {
+                pOfaMiscTabPage = (OfaMiscTabPage *)pPageInfo->m_pPage;
+                if ( pOfaMiscTabPage && !pOfaMiscTabPage->getUserPrefsPasswordBoolProperty( USERPREFS_PASSWORD_FEATURE_ENABLED ) )
+                    bAvoidChanges = false;
+#ifdef DEBUG
+    fprintf( stdout, "bAvoidChanges = %d \n", bAvoidChanges);
+#endif
+
+            }
+            
+            if ( bAvoidChanges )
+            {
+                aBackPB.Click();
+                return 0;
+            }
+            else
+            {
             OptionsGroupInfo* pGroupInfo =
                 (OptionsGroupInfo *)aTreeLB.GetParent(pCurrentPageEntry)->GetUserData();
             if ( RID_SVXPAGE_COLOR != pPageInfo->m_nPageId
@@ -786,7 +850,9 @@ IMPL_LINK( OfaTreeOptionsDialog, OKHdl_Impl, Button *, EMPTYARG )
             pPageInfo->m_pPage->Hide();
         }
     }
-
+    }
+    if ( !bAvoidChanges )
+    {
     SvLBoxEntry* pEntry = aTreeLB.First();
     while ( pEntry )
     {
@@ -799,7 +865,6 @@ IMPL_LINK( OfaTreeOptionsDialog, OKHdl_Impl, Button *, EMPTYARG )
                     (OptionsGroupInfo*)aTreeLB.GetParent(pEntry)->GetUserData();
                 pPageInfo->m_pPage->FillItemSet(*pGroupInfo->m_pOutItemSet);
             }
-
             if ( pPageInfo->m_pExtPage )
             {
                 pPageInfo->m_pExtPage->DeactivatePage();
@@ -808,10 +873,70 @@ IMPL_LINK( OfaTreeOptionsDialog, OKHdl_Impl, Button *, EMPTYARG )
         }
         pEntry = aTreeLB.Next(pEntry);
     }
+    }
     EndDialog(RET_OK);
     return 0;
 }
 
+IMPL_LINK( OfaTreeOptionsDialog, PadlockHdl_Impl, ImageButton *, EMPTYARG )
+{
+    bool isFound = false;
+    OfaMiscTabPage *  pOfaMiscTabPage = NULL;
+    // start the check on the top of the list
+    SvLBoxEntry* pEntry = aTreeLB.First();
+
+    OptionsPageInfo* pPageInfo = (OptionsPageInfo *)pEntry->GetUserData();
+
+    do
+    {
+        if ( pEntry )
+        {
+            if ( aTreeLB.GetParent( pEntry ) )
+            {
+#ifdef DEBUG
+                fprintf( stdout, "Entering in aTreeLB.GetParent( pEntry ) .... \n" );
+#endif
+                pPageInfo = (OptionsPageInfo *)pEntry->GetUserData();
+                if ( pPageInfo->m_pPage )
+                {
+#ifdef DEBUG
+                    fprintf( stdout, "Entering in pPageInfo && pPageInfo->m_pPage .... \n" );
+                    fprintf( stdout, "pPageInfo->m_pPage value is : %p .... \n", pPageInfo->m_pPage );
+                    fprintf( stdout, "pPageInfo->m_nPageId value is : %d .... \n", pPageInfo->m_nPageId );
+#endif
+                    if ( ( OFA_TP_MISC == pPageInfo->m_nPageId ) )
+                    {
+                        pOfaMiscTabPage = (OfaMiscTabPage *)pPageInfo->m_pPage;
+                        if ( pOfaMiscTabPage )
+                        {
+                            bool bIsLocked = pOfaMiscTabPage->IsPadlockLocked();
+#ifdef DEBUG
+                            fprintf( stdout, "pOfaMiscTabPage = (OfaMiscTabPage *)pPageInfo->m_pPage , bIsLocked == %d \n", bIsLocked);
+#endif
+                            if ( bIsLocked )
+                            {
+                                aPadlockOpenImageButton.Hide();
+                                aPadlockClosedImageButton.Show();
+                            }
+                            else
+                            {    
+                                aPadlockClosedImageButton.Hide();
+                                aPadlockOpenImageButton.Show();
+                            }
+                            isFound = true;
+                        }
+                    }
+                }
+                pPageInfo++;
+            }
+        }
+        pEntry = aTreeLB.Next(pEntry);
+    } while ( pEntry && !isFound );
+
+    return 0;
+}
+
+
 /* -----------------17.02.99 09:15-------------------
  * Eine aufgeklappte Gruppe soll vollstaendig sichtbar sein
  * --------------------------------------------------*/
@@ -872,6 +997,21 @@ void OfaTreeOptionsDialog::ApplyItemSets()
     }
 }
 
+/* ---------------------------------------------------
+ *
+ * --------------------------------------------------*/
+
+void OfaTreeOptionsDialog::loadImage( const ResId& i_rId, ImageButton& i_rButton )
+{
+    BitmapEx aBmp( i_rId );
+    Size aImgSize( aBmp.GetSizePixel() );
+    if( aImgSize.Width() > aPadlockButtonImageSize.Width() )
+        aPadlockButtonImageSize.Width() = aImgSize.Width();
+    if( aImgSize.Height() > aPadlockButtonImageSize.Height() )
+        aPadlockButtonImageSize.Height() = aImgSize.Height();
+    i_rButton.SetModeImage( aBmp );
+}
+
 void OfaTreeOptionsDialog::InitTreeAndHandler()
 {
     aTreeLB.SetNodeDefaultImages();
@@ -907,10 +1047,13 @@ void OfaTreeOptionsDialog::InitTreeAndHandler()
     aTreeLB.SetSelectHdl( LINK( this, OfaTreeOptionsDialog, ShowPageHdl_Impl ) );
     aBackPB.SetClickHdl( LINK( this, OfaTreeOptionsDialog, BackHdl_Impl ) );
     aOkPB.SetClickHdl( LINK( this, OfaTreeOptionsDialog, OKHdl_Impl ) );
-
+    aPadlockClosedImageButton.SetClickHdl( LINK( this, OfaTreeOptionsDialog, PadlockHdl_Impl ) );
+    aPadlockOpenImageButton.SetClickHdl( LINK( this, OfaTreeOptionsDialog, PadlockHdl_Impl ) );
     aHiddenGB.Show();
     aSelectTimer.SetTimeout( SELECT_FIRST_TIMEOUT );
     aSelectTimer.SetTimeoutHdl( LINK( this, OfaTreeOptionsDialog, SelectHdl_Impl ) );
+    SetPaintTransparent( TRUE );
+
 }
 
 /* -----------------17.02.99 09:51-------------------
@@ -1457,12 +1600,13 @@ OfaPageResource::OfaPageResource() :
     aTextDlgAry(SVX_RES(SID_SW_EDITOPTIONS)),
     aHTMLDlgAry(SVX_RES(SID_SW_ONLINEOPTIONS)),
     aCalcDlgAry(SVX_RES(SID_SC_EDITOPTIONS)),
+#ifndef OOo4Kids
     aStarMathDlgAry(SVX_RES(SID_SM_EDITOPTIONS)),
+#endif
     aImpressDlgAry(SVX_RES(SID_SD_EDITOPTIONS)),
     aDrawDlgAry(SVX_RES(SID_SD_GRAPHIC_OPTIONS)),
     aChartDlgAry(SVX_RES(SID_SCH_EDITOPTIONS)),
-    aFilterDlgAry(SVX_RES(SID_FILTER_DLG)),
-    aDatasourcesDlgAry(SVX_RES(SID_SB_STARBASEOPTIONS))
+    aFilterDlgAry(SVX_RES(SID_FILTER_DLG))
 {
     FreeResource();
 }
@@ -2134,6 +2278,7 @@ void OfaTreeOptionsDialog::Initialize( const Reference< XFrame >& _xFrame )
         }
     }
 
+#ifndef OOo4Kids
     // Math options
     if ( aModuleOpt.IsModuleInstalled( SvtModuleOptions::E_SMATH ) )
     {
@@ -2154,7 +2299,6 @@ void OfaTreeOptionsDialog::Initialize( const Reference< XFrame >& _xFrame )
             }
         }
     }
-
     // Database - needed only if there is an application which integrates with databases
     if ( !lcl_isOptionHidden( SID_SB_STARBASEOPTIONS, aOptionsDlgOpt ) &&
         (   aModuleOpt.IsModuleInstalled( SvtModuleOptions::E_SDATABASE )
@@ -2172,7 +2316,7 @@ void OfaTreeOptionsDialog::Initialize( const Reference< XFrame >& _xFrame )
                 AddTabPage( nPageId, rDSArray.GetString(i), nGroup );
         }
     }
-
+#endif
     // Chart options (always installed and active)
     if ( !lcl_isOptionHidden( SID_SCH_EDITOPTIONS, aOptionsDlgOpt ) )
     {
diff --git svx/source/cui/treeopt.hrc svx/source/cui/treeopt.hrc
index 8fe5033..3b774a9 100644
--- svx/source/cui/treeopt.hrc
+++ svx/source/cui/treeopt.hrc
@@ -51,6 +51,17 @@
 #define CB_DISABLE				22
 #define BTN_HINT				23
 #define ST_LOAD_ERROR			24
+#ifdef OOo4Kids
+#define CB_PASSWORD_PROTECTED_PREFS	25
+#define IMAGE_PADLOCK_OPEN		26
+#define IMAGE_PADLOCK_CLOSED		27
+
+#define BUTTON_PADLOCK          28
+#define BUTTON_PADLOCK_OPEN     29
+#define BUTTON_PADLOCK_CLOSED   30
+
+#define WND_PADLOCK             32
+#endif
 
 #define STR_GENERAL_PAGES_START 1
 #define STR_GENERAL				(STR_GENERAL_PAGES_START)
@@ -71,7 +82,11 @@
 // metrics
 
 #define WIDTH_PAGEFRAME			263
+#ifdef OOo4Kids
+#define HEIGHT_PAGEFRAME		221
+#else
 #define HEIGHT_PAGEFRAME		191
+#endif
 #define WIDTH_IMG_HELP			25
 #define HEIGHT_IMG_HELP			30
 
diff --git svx/source/cui/treeopt.hxx svx/source/cui/treeopt.hxx
index 014cb6e..98f69d0 100644
--- svx/source/cui/treeopt.hxx
+++ svx/source/cui/treeopt.hxx
@@ -174,6 +174,7 @@ namespace com { namespace sun { namespace star { namespace awt { class XContaine
 struct OptionsPageInfo;
 struct Module;
 class ExtensionsTabPage;
+
 typedef std::vector< ExtensionsTabPage* > VectorOfPages;
 
 class OfaTreeOptionsDialog : public SfxModalDialog
@@ -183,13 +184,15 @@ private:
     CancelButton    aCancelPB;
     HelpButton 		aHelpPB;
     PushButton 		aBackPB;
+    ImageButton     aPadlockOpenImageButton;
+    ImageButton     aPadlockClosedImageButton;
+    Size            aPadlockButtonImageSize;
 
     FixedBorder		aHiddenGB;
     FixedText 		aPageTitleFT;
     FixedLine		aLine1FL;
     FixedText		aHelpFT;
     FixedImage 		aHelpImg;
-
     ImageList       aPageImages;
     ImageList       aPageImagesHC;
 
@@ -246,7 +249,8 @@ private:
                                const rtl::OUString& rExtensionId,
                                VectorOfNodes& rOutNodeList );
     void            InsertNodes( const VectorOfNodes& rNodeList );
-
+    void            loadImage( const ResId& i_rId, ImageButton& i_rButton );
+    void            SetPadlockImage( void );
 protected:
     DECL_LINK(ExpandedHdl_Impl, SvTreeListBox* );
     DECL_LINK(ShowPageHdl_Impl, SvTreeListBox* );
@@ -254,6 +258,7 @@ protected:
     DECL_LINK( OKHdl_Impl, Button * );
     DECL_LINK( HintHdl_Impl, Timer * );
     DECL_LINK( SelectHdl_Impl, Timer * );
+    DECL_LINK(PadlockHdl_Impl, ImageButton* );
 
     virtual long    Notify( NotifyEvent& rNEvt );
     virtual void    DataChanged( const DataChangedEvent& rDCEvt );
@@ -292,12 +297,13 @@ class OfaPageResource : public Resource
     ResStringArray      aTextDlgAry;
     ResStringArray		aHTMLDlgAry;
     ResStringArray		aCalcDlgAry;
+#ifndef OOo4Kids
     ResStringArray		aStarMathDlgAry;
+#endif
     ResStringArray		aImpressDlgAry;
     ResStringArray		aDrawDlgAry;
     ResStringArray		aChartDlgAry;
     ResStringArray		aFilterDlgAry;
-    ResStringArray		aDatasourcesDlgAry;
 
 public:
     OfaPageResource();
@@ -308,12 +314,13 @@ public:
     ResStringArray& GetTextArray() 			{return aTextDlgAry;}
     ResStringArray& GetHTMLArray() 			{return aHTMLDlgAry;}
     ResStringArray& GetCalcArray() 			{return aCalcDlgAry;}
+#ifndef OOo4Kids
     ResStringArray& GetStarMathArray()		{return aStarMathDlgAry;}
+#endif
     ResStringArray& GetImpressArray() 		{return aImpressDlgAry;}
     ResStringArray& GetDrawArray() 			{return aDrawDlgAry;}
     ResStringArray& GetChartArray()			{return aChartDlgAry;}
     ResStringArray& GetFilterArray() 		{return aFilterDlgAry;}
-    ResStringArray& GetDatasourcesArray()	{return aDatasourcesDlgAry;}
 };
 
 // class ExtensionsTabPage -----------------------------------------------
diff --git svx/source/cui/treeopt.src svx/source/cui/treeopt.src
index be5398f..923f6fa 100644
--- svx/source/cui/treeopt.src
+++ svx/source/cui/treeopt.src
@@ -2,28 +2,28 @@
  *
  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  *
- * Copyright 2008 by Sun Microsystems, Inc.
+ * Copyright 2009 Eric Bachard
  *
  * OpenOffice.org - a multi-platform office productivity suite
  *
- * $RCSfile: treeopt.src,v $
+ * $RCSfile: treeopt-OOo4Kids.src,v $
  * $Revision: 1.22 $
  *
- * This file is part of OpenOffice.org.
+ * This file is part of OOo4Kids.
  *
- * OpenOffice.org is free software: you can redistribute it and/or modify
+ * OOo4Kids is free software: you can redistribute it and/or modify
  * it under the terms of the GNU Lesser General Public License version 3
  * only, as published by the Free Software Foundation.
  *
- * OpenOffice.org is distributed in the hope that it will be useful,
+ * OOo4Kids is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU Lesser General Public License version 3 for more details
  * (a copy is included in the LICENSE file that accompanied this code).
  *
  * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://license.ooo4kids.org>
  * for a copy of the LGPLv3 License.
  *
  ************************************************************************/
@@ -34,6 +34,9 @@
 
 #define IMAGE_STDBTN_COLOR Color { Red = 0xC000; Green = 0xC000; Blue = 0xC000; }
 
+#define MASKCOLOR  MaskColor = \
+    Color { Red = 0xFFFF ; Green = 0x0000 ; Blue = 0xFFFF ; };
+
 ModalDialog RID_OFADLG_OPTIONS_TREE
 {
     HelpID = HID_OFADLG_OPTIONS_TREE;
@@ -44,6 +47,13 @@ ModalDialog RID_OFADLG_OPTIONS_TREE
     Size = MAP_APPFONT ( COL_12 , ROW_5 ) ;
     Text [ en-US ] = "Options";
 
+    CheckBox CB_PASSWORD_PROTECTED_PREFS
+    {
+        Pos = MAP_APPFONT( 10, 10 );
+        Size = MAP_APPFONT( 10, 10 );
+        Text [ en-US ] = "empty";
+    };
+
     OKButton PB_OK
     {
         Pos = MAP_APPFONT ( COL_4, ROW_3 ) ;
@@ -74,7 +84,7 @@ ModalDialog RID_OFADLG_OPTIONS_TREE
     Control TLB_PAGES
     {
         Pos = MAP_APPFONT ( COL_1, ROW_1 ) ;
-        Size = MAP_APPFONT ( (COL_2-COL_1), (ROW_4-ROW_1) );
+        Size = MAP_APPFONT ( (COL_2-COL_1), (ROW_4-ROW_1-FB_IMAGE) );
         TabStop = TRUE ;
         Border = TRUE;
     };
@@ -90,6 +100,51 @@ ModalDialog RID_OFADLG_OPTIONS_TREE
         Size = MAP_APPFONT ( WIDTH_IMG_HELP, HEIGHT_IMG_HELP ) ;
         Hide = TRUE;
     };
+
+    ImageButton BUTTON_PADLOCK_OPEN
+    {
+        Pos = MAP_APPFONT ( (COL_3 + COL_4 )/2 + 5, ROW_3 - 15 ) ;
+        Size = MAP_APPFONT ( 20 , 20 ) ;
+        TabStop = TRUE ;
+        ButtonImage = Image
+        {
+            ImageBitmap = Bitmap
+            {
+                File = "Padlock1_open.png";
+            };
+            MASKCOLOR
+        };
+        QuickHelpText [ en-US ] = "Click to avoid modifications" ;
+        QuickHelpText [ fr ] = "Cliquer pour interdire les modifications" ;
+        QuickHelpText [ de ] = "Klicken, um Dialog zu verriegeln";
+        QuickHelpText [ it ] = "Cliccare per bloccare le modifiche";
+        QuickHelpText [ fi ] = "Napsauta muutosten estmiseksi";
+        QuickHelpText [ pt ] = "Clica para impedires modificaes";
+        QuickHelpText [ zh-CN ] = "";
+    };
+
+    ImageButton BUTTON_PADLOCK_CLOSED
+    {
+        Pos = MAP_APPFONT ( (COL_3 + COL_4 )/2 + 5, ROW_3 - 15 ) ;
+        Size = MAP_APPFONT ( 20 , 20 ) ;
+        TabStop = TRUE ;
+        ButtonImage = Image
+        {
+            ImageBitmap = Bitmap
+            {
+                File = "Padlock1_closed.png";
+            };
+            MASKCOLOR
+        };
+        QuickHelpText [ en-US ] = "Click to unlock" ;
+        QuickHelpText [ fr ] = "Cliquer pour autoriser les modifications" ;
+        QuickHelpText [ de ] = "Klicken, um Dialog zu entriegeln";
+        QuickHelpText [ it ] = "Cliccare per sbloccare le modifiche";
+        QuickHelpText [ fi ] = "Muutosten sallimiseksi napsauta lukkoa";
+        QuickHelpText [ pt ] = "Clica para permitires modificaes";
+        QuickHelpText [ zh-CN ] = "";
+    };
+
     FixedText FT_PAGE_TITLE
     {
         Pos = MAP_APPFONT ( COL_3_3, ROW_1_2 ) ;
@@ -160,7 +215,6 @@ Resource RID_OFADLG_OPTIONS_TREE_PAGES
             < "Security" ; RID_SVXPAGE_INET_SECURITY ; > ;
             < "Appearance" ;        RID_SVXPAGE_COLORCONFIG        ; > ;
             < "Accessibility" ; RID_SVXPAGE_ACCESSIBILITYCONFIG ; > ;
-            < "Java" ; RID_SVXPAGE_OPTIONS_JAVA ; > ;
             < "Network Identity" ; RID_SVXPAGE_SSO ; > ;
             < "Online Update" ; RID_SVXPAGE_ONLINEUPDATE ; > ;
             < "" ; RID_SVXPAGE_IMPROVEMENT ; > ;
@@ -173,9 +227,6 @@ Resource RID_OFADLG_OPTIONS_TREE_PAGES
             < "Language Settings" ; 0; > ;
             < "Languages"; OFA_TP_LANGUAGES; > ;
             < "Writing Aids" ; RID_SFXPAGE_LINGU; > ;
-            < "Searching in Japanese" ;  RID_SVXPAGE_JSEARCH_OPTIONS; > ;
-            < "Asian Layout" ;  RID_SVXPAGE_ASIAN_LAYOUT; > ;
-            < "Complex Text Layout" ;  RID_SVXPAGE_OPTIONS_CTL; >;
         };
     };
     StringArray SID_INET_DLG
@@ -224,14 +275,6 @@ Resource RID_OFADLG_OPTIONS_TREE_PAGES
             < "Background" ;  	RID_SW_TP_BACKGROUND  ; > ;
         };
     };
-    StringArray SID_SM_EDITOPTIONS
-    {
-        ItemList [ en-US ] =
-        {
-            < "%PRODUCTNAME Math" ; 0; > ;
-            < "Settings" ; SID_SM_TP_PRINTOPTIONS;> ;
-        };
-    };
     StringArray SID_SC_EDITOPTIONS
     {
         ItemList [ en-US ] =
@@ -288,15 +331,6 @@ Resource RID_OFADLG_OPTIONS_TREE_PAGES
             < "HTML Compatibility" ; RID_OFAPAGE_HTMLOPT ; > ;
         };
     };
-    StringArray SID_SB_STARBASEOPTIONS
-    {
-        ItemList [ en-US ] =
-        {
-            < "%PRODUCTNAME Base" ; 0; > ;
-            < "Connections" ; SID_SB_CONNECTIONPOOLING; > ;
-            < "Databases" ; SID_SB_DBREGISTEROPTIONS; > ;
-        };
-    };
 };
 String RID_RIDER_SLL_SITE
 {
diff --git svx/source/editeng/acorrcfg.cxx svx/source/editeng/acorrcfg.cxx
index 0745a5e..8795eb9 100644
--- svx/source/editeng/acorrcfg.cxx
+++ svx/source/editeng/acorrcfg.cxx
@@ -128,8 +128,9 @@ Sequence<OUString> 	SvxBaseAutoCorrCfg::GetPropertyNames()
         "ReplaceDoubleQuote",					// 14
         "DoubleQuoteAtStart",					// 15
         "DoubleQuoteAtEnd"						// 16
+        "AddNonBreakingSpace"                   // 17
     };
-    const int nCount = 17;
+    const int nCount = 18;
     Sequence<OUString> aNames(nCount);
     OUString* pNames = aNames.getArray();
     for(int i = 0; i < nCount; i++)
@@ -229,6 +230,10 @@ void SvxBaseAutoCorrCfg::Load(sal_Bool bInit)
                         rParent.pAutoCorrect->SetEndDoubleQuote(
                             sal::static_int_cast< sal_Unicode >( nTemp ) );
                     break;//"DoubleQuoteAtEnd"
+                    case 17:
+                        if(*(sal_Bool*)pValues[nProp].getValue())
+                             nFlags |= AddNonBrkSpace;
+                     break;//"AddNonBreakingSpace"
                 }
             }
         }
@@ -399,8 +404,9 @@ Sequence<OUString> 	SvxSwAutoCorrCfg::GetPropertyNames()
         "Format/ByInput/ApplyNumbering/SpecialCharacter/FontFamily",    //45
         "Format/ByInput/ApplyNumbering/SpecialCharacter/FontCharset",   //46
         "Format/ByInput/ApplyNumbering/SpecialCharacter/FontPitch",     //47
+        "Format/Option/AddNonBreakingSpace",                            //48
     };
-    const int nCount = 48;
+    const int nCount = 49;
     Sequence<OUString> aNames(nCount);
     OUString* pNames = aNames.getArray();
     for(int i = 0; i < nCount; i++)
@@ -552,6 +558,7 @@ void SvxSwAutoCorrCfg::Load(sal_Bool bInit)
                         rSwFlags.aByInputBulletFont.SetPitch(FontPitch(nVal));
                     }
                     break;// "Format/ByInput/ApplyNumbering/SpecialCharacter/FontPitch",
+                    case 48 : rSwFlags.bAddNonBrkSpace = *(sal_Bool*)pValues[nProp].getValue( ); break;// "Format/Output/AddNonBreakingSpace",
                 }
             }
         }
@@ -667,6 +674,9 @@ void SvxSwAutoCorrCfg::Commit()
             case 47 :
                 pValues[nProp] <<= (sal_Int32)rSwFlags.aByInputBulletFont.GetPitch();
             break;// "Format/ByInput/ApplyNumbering/SpecialCharacter/FontPitch",
+            case  48:
+                bVal = rSwFlags.bAddNonBrkSpace;  pValues[nProp].setValue(&bVal, rType);
+            break; // "Format/Option/AddNonBreakingSpace",
         }
     }
     PutProperties(aNames, aValues);
diff --git svx/source/editeng/svxacorr.cxx svx/source/editeng/svxacorr.cxx
index b7861e9..ceb1bca 100644
--- svx/source/editeng/svxacorr.cxx
+++ svx/source/editeng/svxacorr.cxx
@@ -33,6 +33,7 @@
 
 
 #include <com/sun/star/io/XStream.hpp>
+#include <com/sun/star/lang/Locale.hpp>
 #include <tools/urlobj.hxx>
 #include <tools/table.hxx>
 #include <i18npool/mslangid.hxx>
@@ -97,6 +98,8 @@
 #include <com/sun/star/ucb/NameClash.hpp>
 #include <xmloff/xmltoken.hxx>
 
+#define CHAR_HARDBLANK		((sal_Unicode)0x00A0)
+
 using namespace ::com::sun::star::ucb;
 using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star;
@@ -347,6 +350,7 @@ long SvxAutoCorrect::GetDefaultFlags()
                     | ChgFractionSymbol
                     | ChgOrdinalNumber
                     | ChgToEnEmDash
+                    | AddNonBrkSpace
                     | ChgWeightUnderl
                     | SetINetAttr
                     | ChgQuotes
@@ -692,6 +696,54 @@ BOOL SvxAutoCorrect::FnChgToEnEmDash(
     return bRet;
 }
 
+BOOL SvxAutoCorrect::FnAddNonBrkSpace(
+                                SvxAutoCorrDoc& rDoc, const String& rTxt,
+                                xub_StrLen , xub_StrLen nEndPos,
+                                LanguageType eLang )
+{
+    bool bRet = false;
+    
+    CharClass& rCC = GetCharClass( eLang );
+    const lang::Locale rLocale = rCC.getLocale( );
+
+    if ( rLocale.Language == OUString::createFromAscii( "fr" ) )
+    {
+        OUString chars = OUString::createFromAscii( ":;!?" );
+        if ( rLocale.Country == OUString::createFromAscii( "CA" ) )
+            chars = OUString::createFromAscii( ":" );
+
+        sal_Unicode cChar = rTxt.GetChar( nEndPos );
+        if ( chars.indexOf( sal_Unicode( cChar ) ) != -1 )
+        {
+            // Check the previous char
+            sal_Unicode cPrevChar = rTxt.GetChar( nEndPos - 1 );
+            if ( ( chars.indexOf( sal_Unicode( cPrevChar ) ) == -1 ) && cPrevChar != '\t' )
+            { 
+                // Remove any previous normal space
+                xub_StrLen nPos = nEndPos - 1;
+                while ( cPrevChar == ' ' || cPrevChar == CHAR_HARDBLANK )
+                {
+                    if ( nPos == 0 ) break;
+                    nPos--;
+                    cPrevChar = rTxt.GetChar( nPos );
+                }
+
+                if ( nPos != 0 )
+                {
+                    nPos++;
+                    if ( nEndPos - nPos > 0 )
+                        rDoc.Delete( nPos, nEndPos );
+
+                    // Add the non-breaking space at the end pos
+                    rDoc.Insert( nPos, CHAR_HARDBLANK );
+                    bRet = true;
+                }
+            }
+        }
+    }
+
+    return bRet;
+}
 
 BOOL SvxAutoCorrect::FnSetINetAttr( SvxAutoCorrDoc& rDoc, const String& rTxt,
                                     xub_StrLen nSttPos, xub_StrLen nEndPos,
@@ -1302,6 +1354,8 @@ ULONG SvxAutoCorrect::AutoCorrect( SvxAutoCorrDoc& rDoc, const String& rTxt,
                 FnChgFractionSymbol( rDoc, rTxt, nCapLttrPos, nInsPos ) ) ||
             ( IsAutoCorrFlag( nRet = ChgOrdinalNumber ) &&
                 FnChgOrdinalNumber( rDoc, rTxt, nCapLttrPos, nInsPos, eLang ) ) ||
+            ( IsAutoCorrFlag( nRet = AddNonBrkSpace ) &&
+                FnAddNonBrkSpace( rDoc, rTxt, nCapLttrPos, nInsPos - 1, eLang ) ) ||
             ( IsAutoCorrFlag( nRet = SetINetAttr ) &&
                 ( ' ' == cChar || '\t' == cChar || 0x0a == cChar || !cChar ) &&
                 FnSetINetAttr( rDoc, rTxt, nCapLttrPos, nInsPos, eLang ) ) )
diff --git svx/source/editeng/swafopt.cxx svx/source/editeng/swafopt.cxx
index 0940a4e..20db403 100644
--- svx/source/editeng/swafopt.cxx
+++ svx/source/editeng/swafopt.cxx
@@ -53,6 +53,7 @@ SvxSwAutoFmtFlags::SvxSwAutoFmtFlags()
     bChgEnumNum =
     bChgFracionSymbol =
     bChgOrdinalNumber =
+    bAddNonBrkSpace =
     bChgToEnEmDash =
     bChgWeightUnderl =
     bSetINetAttr =
@@ -117,6 +118,7 @@ SvxSwAutoFmtFlags& SvxSwAutoFmtFlags::operator=( const SvxSwAutoFmtFlags& rAFFla
 
     bChgFracionSymbol = rAFFlags.bChgFracionSymbol;
     bChgOrdinalNumber = rAFFlags.bChgOrdinalNumber;
+    bAddNonBrkSpace = rAFFlags.bAddNonBrkSpace;
     bChgToEnEmDash = rAFFlags.bChgToEnEmDash;
     bChgWeightUnderl = rAFFlags.bChgWeightUnderl;
     bSetINetAttr = rAFFlags.bSetINetAttr;
diff --git svx/source/inc/dbcharsethelper.hxx svx/source/inc/dbcharsethelper.hxx
new file mode 100644
index 0000000..a315084
--- /dev/null
+++ svx/source/inc/dbcharsethelper.hxx
@@ -0,0 +1,69 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: dbcharsethelper.hxx,v $
+ * $Revision: 1.6 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef SVX_DBCHARSETHELPER_HXX
+#define SVX_DBCHARSETHELPER_HXX
+
+#include "dbtoolsclient.hxx"
+
+//........................................................................
+namespace svxform
+{
+//........................................................................
+
+    //====================================================================
+    //= ODataAccessCharsetHelper
+    //====================================================================
+    class ODataAccessCharsetHelper : public ODbtoolsClient
+    {
+    protected:
+        mutable ::rtl::Reference< ::connectivity::simple::IDataAccessCharSet >	m_xCharsetHelper;
+
+    protected:
+        virtual bool ensureLoaded() const;
+
+    public:
+        ODataAccessCharsetHelper( );
+
+        inline sal_Int32	getSupportedTextEncodings( ::std::vector< rtl_TextEncoding >& _rEncs ) const
+        {
+            if ( ensureLoaded() )
+                return m_xCharsetHelper->getSupportedTextEncodings( _rEncs );
+            return 0;
+        }
+    };
+
+//........................................................................
+}	// namespace svxform
+//........................................................................
+
+#endif // SVX_DBCHARSETCLIENT_HXX
+
+
diff --git svx/source/inc/dbtoolsclient.hxx svx/source/inc/dbtoolsclient.hxx
new file mode 100644
index 0000000..56bd0cc
--- /dev/null
+++ svx/source/inc/dbtoolsclient.hxx
@@ -0,0 +1,238 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: dbtoolsclient.hxx,v $
+ * $Revision: 1.18 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef SVX_DBTOOLSCLIENT_HXX
+#define SVX_DBTOOLSCLIENT_HXX
+
+#include <connectivity/virtualdbtools.hxx>
+#include <osl/mutex.hxx>
+#include <osl/module.h>
+#include <tools/solar.h>
+#include <unotools/sharedunocomponent.hxx>
+#include <svx/svxdllapi.h>
+
+//........................................................................
+namespace svxform
+{
+//........................................................................
+
+    typedef ::utl::SharedUNOComponent< ::com::sun::star::sdbc::XConnection > SharedConnection;
+
+    //====================================================================
+    //= ODbtoolsClient
+    //====================================================================
+    /** base class for classes which want to use dbtools features with load-on-call
+        of the dbtools lib.
+    */
+    class SVX_DLLPUBLIC ODbtoolsClient
+    {
+    private:
+        static	::osl::Mutex	s_aMutex;
+        static	sal_Int32		s_nClients;
+        static oslModule		s_hDbtoolsModule;
+        static ::connectivity::simple::createDataAccessToolsFactoryFunction
+                                s_pFactoryCreationFunc;
+        //add by BerryJia for fixing Bug97420 Time:2002-9-12-11:00(PRC time)
+        mutable BOOL            m_bCreateAlready;
+
+    private:
+        mutable ::rtl::Reference< ::connectivity::simple::IDataAccessToolsFactory >	m_xDataAccessFactory;
+
+    protected:
+        ODbtoolsClient();
+        virtual ~ODbtoolsClient();
+
+        virtual bool ensureLoaded() const;
+
+    protected:
+        const ::rtl::Reference< ::connectivity::simple::IDataAccessToolsFactory >&
+            getFactory() const { return m_xDataAccessFactory; }
+
+    private:
+        static void registerClient();
+        static void revokeClient();
+    };
+
+    //====================================================================
+    //= OStaticDataAccessTools
+    //====================================================================
+    class SVX_DLLPUBLIC OStaticDataAccessTools : public ODbtoolsClient
+    {
+    protected:
+        mutable ::rtl::Reference< ::connectivity::simple::IDataAccessTools >	m_xDataAccessTools;
+
+    protected:
+        virtual bool ensureLoaded() const;
+
+    public:
+        OStaticDataAccessTools();
+
+        SVX_DLLPRIVATE const ::rtl::Reference< ::connectivity::simple::IDataAccessTools >& getDataAccessTools() const { return m_xDataAccessTools; }
+
+        // ------------------------------------------------
+        ::com::sun::star::uno::Reference< ::com::sun::star::util::XNumberFormatsSupplier> getNumberFormats(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection>& _rxConn,
+            sal_Bool _bAllowDefault
+        ) const;
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE sal_Int32 getDefaultNumberFormat(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& _xColumn,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::util::XNumberFormatTypes >& _xTypes,									 
+            const ::com::sun::star::lang::Locale& _rLocale );
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> getConnection_withFeedback(
+            const ::rtl::OUString& _rDataSourceName,
+            const ::rtl::OUString& _rUser,
+            const ::rtl::OUString& _rPwd,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory
+        ) const SAL_THROW ( (::com::sun::star::sdbc::SQLException) );
+
+        // ------------------------------------------------
+        ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> connectRowset(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory,
+            sal_Bool _bSetAsActiveConnection
+        ) const SAL_THROW ( ( ::com::sun::star::sdbc::SQLException
+                            , ::com::sun::star::lang::WrappedTargetException
+                            , ::com::sun::star::uno::RuntimeException) );
+
+        // ------------------------------------------------
+        ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection> getRowSetConnection(
+                const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet>& _rxRowSet)
+                const SAL_THROW ( (::com::sun::star::uno::RuntimeException) );
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE void TransferFormComponentProperties(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet>& _rxOld,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet>& _rxNew,
+            const ::com::sun::star::lang::Locale& _rLocale
+        ) const;
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE ::rtl::OUString quoteName(
+            const ::rtl::OUString& _rQuote,
+            const ::rtl::OUString& _rName
+        ) const;
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE ::rtl::OUString composeTableNameForSelect(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection >& _rxConnection,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet>& _xTable
+        ) const;
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE ::com::sun::star::sdb::SQLContext prependContextInfo(
+            ::com::sun::star::sdbc::SQLException& _rException,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _rxContext,
+            const ::rtl::OUString& _rContextDescription,
+            const ::rtl::OUString& _rContextDetails
+        ) const;
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XDataSource > getDataSource(
+                const ::rtl::OUString& _rsRegisteredName,
+                const ::com::sun::star::uno::Reference< ::com::sun::star::lang::XMultiServiceFactory>& _rxFactory
+            ) const;
+
+        // ------------------------------------------------
+        /** check if the property "Privileges" supports ::com::sun::star::sdbcx::Privilege::INSERT
+            @param		_rxCursorSet	the property set
+        */
+        SVX_DLLPRIVATE sal_Bool canInsert(const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet>& _rxCursorSet) const;
+
+        // ------------------------------------------------
+        /** check if the property "Privileges" supports ::com::sun::star::sdbcx::Privilege::UPDATE
+            @param		_rxCursorSet	the property set
+        */
+        SVX_DLLPRIVATE sal_Bool canUpdate(const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet>& _rxCursorSet) const;
+
+        // ------------------------------------------------
+        /** check if the property "Privileges" supports ::com::sun::star::sdbcx::Privilege::DELETE
+            @param		_rxCursorSet	the property set
+        */
+        SVX_DLLPRIVATE sal_Bool canDelete(const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet>& _rxCursorSet) const;
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE ::com::sun::star::uno::Reference< ::com::sun::star::container::XNameAccess >
+            getFieldsByCommandDescriptor(
+                const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection >& _rxConnection,
+                const sal_Int32 _nCommandType,
+                const ::rtl::OUString& _rCommand,
+                ::com::sun::star::uno::Reference< ::com::sun::star::lang::XComponent >& _rxKeepFieldsAlive,
+                ::dbtools::SQLExceptionInfo* _pErrorInfo = NULL
+            )	SAL_THROW( ( ) );
+
+        // ------------------------------------------------
+        ::com::sun::star::uno::Sequence< ::rtl::OUString >
+            getFieldNamesByCommandDescriptor(
+                const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection >& _rxConnection,
+                const sal_Int32 _nCommandType,
+                const ::rtl::OUString& _rCommand,
+                ::dbtools::SQLExceptionInfo* _pErrorInfo = NULL
+            )	SAL_THROW( ( ) );
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE bool isEmbeddedInDatabase(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _rxComponent,
+            ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XConnection >& _rxActualConnection
+        );
+
+        // ------------------------------------------------
+        SVX_DLLPRIVATE bool isEmbeddedInDatabase(
+            const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& _rxComponent
+        );
+    };
+
+    //====================================================================
+    //= DBToolsObjectFactory
+    //====================================================================
+    class DBToolsObjectFactory : public ODbtoolsClient
+    {
+    public:
+        DBToolsObjectFactory();
+        ~DBToolsObjectFactory();
+
+        // ------------------------------------------------
+        ::std::auto_ptr< ::dbtools::FormattedColumnValue >  createFormattedColumnValue(
+            const ::comphelper::ComponentContext& _rContext,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::sdbc::XRowSet >& _rxRowSet,
+            const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& _rxColumn
+        );
+    };
+
+//........................................................................
+}	// namespace svxform
+//........................................................................
+
+#endif // SVX_DBTOOLSCLIENT_HXX
+
+
diff --git svx/source/intro/intro_tmpl.hrc svx/source/intro/intro_tmpl.hrc
index f724cd4..c6e82b5 100644
--- svx/source/intro/intro_tmpl.hrc
+++ svx/source/intro/intro_tmpl.hrc
@@ -33,6 +33,32 @@
 #define RID_IMGLIST_TREEOPT             (RID_OFA_START + 174)
 #define RID_IMGLIST_TREEOPT_HC          (RID_OFA_START + 175)
 
+#define OOO4KIDS_CONTRIBUTORS_LIST \
+ItemList = \
+{ \
+    < "" ; > ; \
+    < "People who contributed to %PRODUCTNAME : " ; 8 ; > ; \
+    < "Eric Bachard" ; > ; \
+    < "Thorsten Behrens." ; > ; \
+    < "Abdelkader Bellabes" ; > ; \
+    < "Benjamin Bois" ; > ; \
+    < "Cedric Bosdonnat." ; > ; \
+    < "Alexandro Colorado." ; > ; \
+    < "Marie-Claude Dugr." ; > ; \
+    < "Thomas Fontenay." ; > ; \
+    < "Julien Forgeat." ; > ; \
+    < "Isabelle Hurbain-Palatin." ; > ; \
+    < "Risto I. Jskelinen." ; > ; \
+    < "Jean-Marie Lafon." ; > ; \
+    < "Volker Merschmann." ; > ; \
+    < "Leo Moons." ; > ; \
+    < "Matthieu Paret." ; > ; \
+    < "Pierre Pasteau." ; > ; \
+    < "Ricardo Soares Guimaraes." ; > ; \
+    < "Nils Ratusznik." ; > ; \
+    < "" ; > ; \
+};
+
 #define OOO_CONTRIBUTOR_LIST \
 ItemList = \
 { \
diff --git svx/source/intro/iso.src svx/source/intro/iso.src
index 66cac43..1eb8b9e 100644
--- svx/source/intro/iso.src
+++ svx/source/intro/iso.src
@@ -79,6 +79,7 @@ ModalDialog RID_DEFAULTABOUT
         WordBreak = TRUE ;
         Text = "%PRODUCTNAME %ABOUTBOXPRODUCTVERSION %PRODUCTEXTENSION" ;
     };
+/*
     FixedText ABOUT_FTXT_COPYRIGHT
     {
         Pos = MAP_APPFONT ( 54 , 25 ) ;
@@ -86,14 +87,17 @@ ModalDialog RID_DEFAULTABOUT
         WordBreak = TRUE ;
         Text[ en-US ] = "Copyright  2005-2009 Sun Microsystems, Inc. All rights reserved. Sun Microsystems, Inc. has intellectual property rights relating to technology embodied in the product that is described in this document. In particular, and without limitation, these intellectual property rights may include one or more of the U.S. patents listed at http://www.sun.com/patents and one or more additional patents or pending patent applications in the U.S. and in other countries. U.S. Government Rights - Commercial software. Government users are subject to the Sun Microsystems, Inc. standard license agreement and applicable provisions of the FAR and its supplements. Use is subject to license terms. This distribution may include materials developed by third parties. Sun, Sun Microsystems, the Sun logo, Java, Solaris and StarOffice are trademarks or registered trademarks of Sun Microsystems, Inc. in the U.S. and other countries. All SPARC trademarks are used under license and are trademarks or registered trademarks of SPARC International, Inc. in the U.S. and other countries. UNIX is a registered trademark in the U.S. and other countries, exclusively licensed through X/Open Company, Ltd.\n\nThis product is based on the OpenOffice.org project." ;
     };
+*/
     StringArray ABOUT_STR_DEVELOPER_ARY
     {
         DEVELOPER_LIST
     };
+/*
     String ABOUT_STR_FRENCH_COPYRIGHT
     {
         Text = "Copyright  2005-2009 Sun Microsystems, Inc. Tous droits rservs. Sun Microsystems, Inc. dtient les droits de proprit intellectuels relatifs  la technologie incorpore dans le produit qui est dcrit dans ce document. En particulier, et ce sans limitation, ces droits de proprit intellectuelle peuvent inclure un ou plus des brevets amricains lists  l'adresse http://www.sun.com/patents et un ou les brevets supplmentaires ou les applications de brevet en attente aux Etats - Unis et dans les autres pays. L'utilisation est soumise aux termes du contrat de licence. Cette distribution peut comprendre des composants dvelopps par des tierces parties. Sun, Sun Microsystems, le logo Sun, Java, Solaris et StarOffice sont des marques de fabrique ou des marques dposes de Sun Microsystems, Inc. aux Etats-Unis et dans d'autres pays. Toutes les marques SPARC sont utilises sous licence et sont des marques de fabrique ou des marques dposes de SPARC International, Inc. aux Etats-Unis et dans d'autres pays. UNIX est une marque dpose aux Etats-Unis et dans d'autres pays et licencie exlusivement par X/Open Company, Ltd.\n\nCe produit a t cr  partir du projet OpenOffice.org." ;
     };
+*/
     String ABOUT_STR_ACCEL
     {
         Text = "SDT" ;
diff --git svx/source/intro/ooo.src svx/source/intro/ooo.src
index a29ea00..c102ca3 100644
--- svx/source/intro/ooo.src
+++ svx/source/intro/ooo.src
@@ -43,6 +43,15 @@
 #include <svx/svxids.hrc>
 #include "intro.hrc"
 
+#define TEXT_DEFAULTLICENSE \
+    Text [ x-comment ] = "PB: ; PB: only %PRODUCTNAME"; \
+    Text [ en-US ] = "License" ; \
+    Text [ fr ] = "Licence" ; \
+    Text [ es ] = "Licencia..."; \
+    Text [ it ] = "Licenza..."; \
+    Text [ pt ] = "Licena..."; \
+    Text [ nl ] = "Licentie..."; \
+
 String RID_APPTITLE
 {
     Text = "%PRODUCTNAME %PRODUCTVERSION %PRODUCTEXTENSION" ;
@@ -78,6 +87,7 @@ ModalDialog RID_DEFAULTABOUT
         Pos = MAP_APPFONT ( 174 , 6 ) ;
         Size = MAP_APPFONT ( 50 , 14 ) ;
     };
+/*
     FixedText ABOUT_FTXT_VERSION
     {
         Pos = MAP_APPFONT ( 54 , 6 ) ;
@@ -85,6 +95,8 @@ ModalDialog RID_DEFAULTABOUT
         WordBreak = TRUE ;
         Text = "%PRODUCTNAME %ABOUTBOXPRODUCTVERSION %PRODUCTEXTENSION" ;
        };
+*/
+/*
     FixedText ABOUT_FTXT_COPYRIGHT
     {
         Pos = MAP_APPFONT ( 54 , 25 ) ;
@@ -92,9 +104,10 @@ ModalDialog RID_DEFAULTABOUT
         Text[ en-US ] ="Copyright 2000-2009 Sun Microsystems Inc.\nThis product was created by " OOO_VENDOR ", based on OpenOffice.org.\nOpenOffice.org acknowledges all community members, especially those mentioned at http://www.openoffice.org/welcome/credits.html.";
         WordBreak = TRUE ;
     };
+*/
     StringArray ABOUT_STR_DEVELOPER_ARY
     {
-        OOO_CONTRIBUTOR_LIST
+        OOO4KIDS_CONTRIBUTORS_LIST
     };
     String ABOUT_STR_ACCEL
     {
@@ -102,6 +115,29 @@ ModalDialog RID_DEFAULTABOUT
     };
 };
 
+ModalDialog RID_DEFAULTLICENSE
+{
+    OutputSize = TRUE ;
+    Size = MAP_APPFONT ( 245 , 200 ) ;
+    Moveable = TRUE ;
+    SVLook = TRUE ;
+    TEXT_DEFAULTLICENSE
+    OKButton LICENSE_BTN_OK
+    {
+        DefButton = TRUE ;
+        Pos = MAP_APPFONT ( 174 , 6 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+    };
+    StringArray LICENSE_STR_DEVELOPER_ARY
+    {
+        OOO4KIDS_CONTRIBUTORS_LIST
+    };
+    String LICENSE_STR_ACCEL
+    {
+        Text = "SDT" ;
+    };
+};
+
 // imagelist with images of the "New" menu and the file open dialog
 
 #define MASK_COL2	MaskColor = Color { Red = 0xFFFF ; Green = 0x0000 ; Blue = 0xFFFF ; } ;
diff --git svx/source/tbxctrls/tbcontrl.cxx svx/source/tbxctrls/tbcontrl.cxx
index 94494aa..ddef32d 100644
--- svx/source/tbxctrls/tbcontrl.cxx
+++ svx/source/tbxctrls/tbcontrl.cxx
@@ -821,9 +821,14 @@ void SvxFontNameBox_Impl::Select()
 #ifndef WB_NO_DIRECTSELECT
 #define WB_NO_DIRECTSELECT      ((WinBits)0x04000000)
 #endif
-
+#ifdef OOo4Kids
+#define PALETTE_X 4
+#define PALETTE_Y 4
+#else
 #define PALETTE_X 10
 #define PALETTE_Y 11
+#endif
+
 #define PALETTE_SIZE (PALETTE_X * PALETTE_Y)
 
 SvxColorWindow_Impl::SvxColorWindow_Impl( const OUString&            rCommand,
@@ -843,8 +848,11 @@ SvxColorWindow_Impl::SvxColorWindow_Impl( const OUString&            rCommand,
     const SfxPoolItem* pItem = NULL;
     XColorTable* pColorTable = NULL;
     BOOL bKillTable = FALSE;
+#ifdef OOo4Kids
+    const Size aSize12( 40, 40 );
+#else
     const Size aSize12( 13, 13 );
-
+#endif
     if ( pDocSh )
         if ( 0 != ( pItem = pDocSh->GetItem( SID_COLOR_TABLE ) ) )
             pColorTable = ( (SvxColorTableItem*)pItem )->GetColorTable();
diff --git svx/source/tbxctrls/tbunocontroller.cxx svx/source/tbxctrls/tbunocontroller.cxx
index d00ea44..e1bb900 100644
--- svx/source/tbxctrls/tbunocontroller.cxx
+++ svx/source/tbxctrls/tbunocontroller.cxx
@@ -46,8 +46,11 @@
 
 #include <memory>
 
+#ifdef OOo4Kids
 #define LOGICAL_EDIT_HEIGHT         12
-
+#else
+#define LOGICAL_EDIT_HEIGHT         12
+#endif
 using namespace ::com::sun::star;
 
 namespace svx
diff --git sw/inc/bookmrk.hxx sw/inc/bookmrk.hxx
new file mode 100644
index 0000000..6f1c5ae
--- /dev/null
+++ sw/inc/bookmrk.hxx
@@ -0,0 +1,218 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: bookmrk.hxx,v $
+ * $Revision: 1.11 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef _BOOKMRK_HXX
+#define _BOOKMRK_HXX
+
+#include "hintids.hxx"		//die Ids der Attribute, vor macitem damit die
+                            //die Attribut richtig angezogen werden.
+#include <svtools/macitem.hxx>
+
+#ifndef _KEYCOD_HXX //autogen
+#include <vcl/keycod.hxx>
+#endif
+#ifndef _TOOLS_REF_HXX
+#include <tools/ref.hxx>
+#endif
+#include <IDocumentBookmarkAccess.hxx>
+#include <calbck.hxx>
+#include <pam.hxx>
+
+#ifndef SW_DECL_SWSERVEROBJECT_DEFINED
+#define SW_DECL_SWSERVEROBJECT_DEFINED
+SV_DECL_REF( SwServerObject )
+#endif
+
+
+struct SwPosition;	// fwd Decl. wg. UI
+
+class SwBookmark : public SwModify
+{
+    SwPosition *pPos1, *pPos2;	// wird im CTOR gesetzt, im DTOR geloescht
+                                // pPos1 is always != 0, pPos2 may be 0
+    SwServerObjectRef refObj;	// falls DataServer -> Pointer gesetzt
+
+protected:
+    String		aName;
+    String		aShortName;
+    KeyCode		aCode;
+    IDocumentBookmarkAccess::BookmarkType eMarkType;
+
+    SwBookmark( const SwPosition& aPos,
+                const KeyCode& rCode,
+                const String& rName, const String& rShortName);
+
+public:
+    TYPEINFO();
+
+    SwBookmark( const SwPosition& aPos );
+    // --> OD 2007-09-26 #i81002#
+    SwBookmark( const SwPaM& aPaM,
+                const KeyCode& rCode,
+                const String& rName, const String& rShortName);
+    // <--
+
+    // Beim Loeschen von Text werden Bookmarks mitgeloescht!
+    virtual ~SwBookmark();
+
+    // --> OD 2007-10-10 #i81002#
+    // made virtual and thus no longer inline
+    virtual const SwPosition& GetBookmarkPos() const;
+    virtual const SwPosition* GetOtherBookmarkPos() const;
+    // <--
+
+    // nicht undofaehig
+    const String& GetName() const { return aName; }
+    // nicht undofaehig
+    const String& GetShortName() const { return aShortName; }
+    // nicht undofaehig
+    const KeyCode& GetKeyCode() const { return aCode; }
+
+    // Vergleiche auf Basis der Dokumentposition
+    BOOL operator < (const SwBookmark &) const;
+    BOOL operator ==(const SwBookmark &) const;
+    // falls man wirklich auf gleiche Position abfragen will.
+    BOOL IsEqualPos( const SwBookmark &rBM ) const;
+
+    BOOL IsFormFieldMark() const 	{ return IDocumentBookmarkAccess::FORM_FIELDMARK_TEXT == eMarkType || IDocumentBookmarkAccess::FORM_FIELDMARK_NO_TEXT == eMarkType; }
+    BOOL IsBookMark() const 	{ return IDocumentBookmarkAccess::BOOKMARK == eMarkType || IDocumentBookmarkAccess::FORM_FIELDMARK_TEXT == eMarkType || IDocumentBookmarkAccess::FORM_FIELDMARK_NO_TEXT == eMarkType; }
+//    // --> OD 2007-10-17 #TESTING#
+//    BOOL IsBookMark() const
+//    {
+//        return IDocumentBookmarkAccess::BOOKMARK == eMarkType ||
+//               IsCrossRefMark();
+//    }
+//    // <--
+    BOOL IsMark() const 		{ return IDocumentBookmarkAccess::MARK == eMarkType; }
+    BOOL IsUNOMark() const      { return IDocumentBookmarkAccess::UNO_BOOKMARK == eMarkType; }
+    // --> OD 2007-10-11 #i81002# - bookmark type for cross-references
+    BOOL IsCrossRefMark() const { return IDocumentBookmarkAccess::CROSSREF_BOOKMARK == eMarkType; }
+    // <--
+    void SetType( IDocumentBookmarkAccess::BookmarkType eNewType )  { eMarkType = eNewType; }
+    IDocumentBookmarkAccess::BookmarkType GetType() const 	{ return eMarkType; }
+
+        // Daten Server-Methoden
+    void SetRefObject( SwServerObject* pObj );
+    const SwServerObject* GetObject() const		{  return &refObj; }
+          SwServerObject* GetObject() 			{  return &refObj; }
+    BOOL IsServer() const 						{  return refObj.Is(); }
+
+    // --> OD 2007-10-10 #i81002#
+    // made virtual and thus no longer inline
+    // to access start and end of a bookmark.
+    // start and end may be the same
+    virtual const SwPosition* BookmarkStart() const;
+    virtual const SwPosition* BookmarkEnd() const;
+    // <--
+
+    // --> OD 2007-09-26 #i81002#
+    virtual void SetBookmarkPos( const SwPosition* pNewPos1 );
+    virtual void SetOtherBookmarkPos( const SwPosition* pNewPos2 );
+    // <--
+
+private:
+    // fuer METWARE:
+    // es wird (vorerst) nicht kopiert und nicht zugewiesen
+    SwBookmark(const SwBookmark &);
+    SwBookmark &operator=(const SwBookmark &);
+};
+
+class SwMark: public SwBookmark
+{
+public:
+    SwMark( const SwPosition& aPos,
+            const KeyCode& rCode,
+            const String& rName, const String& rShortName);
+};
+            
+class SW_DLLPUBLIC SwFieldBookmark : public SwBookmark
+{
+private:
+    int fftype; // Type: 0 = Text, 1 = Check Box, 2 = List
+    int ffres;
+    bool ffprot;
+    bool ffsize; // 0 = Auto, 1=Exact (see ffhps)
+    int fftypetxt; // Type of text field: 0 = Regular text, 1 = Number, 2 = Date, 3 = Current date, 4 = Current time, 5 = Calculation
+    bool ffrecalc; 
+    int ffmaxlen; // Number of characters for text field. Zero means unlimited.
+    int ffhps; // Check box size (half-point sizes).
+
+    String ffname;
+    String ffhelptext;
+
+public:
+    SwFieldBookmark(const SwPosition& aPos,
+           const KeyCode& rCode,
+           const String& rName, const String& rShortName,
+           IDocumentBookmarkAccess::BookmarkType eMark);
+
+    void SetFieldType(int fftype);
+    int GetFieldType();
+
+    void SetChecked(bool checked);
+    bool IsChecked();
+
+    void SetFFName(String aNewName) {
+        this->ffname=aNewName;
+    }
+
+    String GetFFName()
+    {
+        return ffname;
+    }
+
+    int GetFFRes() {
+        return ffres;
+    }
+
+    void SetFFRes(int nNew) {
+        this->ffres=nNew;
+    }
+
+    void SetFFHelpText(String newffhelptext) {
+        this->ffhelptext=newffhelptext;
+    }
+
+    String GetFFHelpText() {
+        return ffhelptext;
+    }
+};
+            
+class SwUNOMark: public SwBookmark
+{
+public:
+    // --> OD 2007-09-26 #i81002#
+    SwUNOMark( const SwPaM& aPaM,
+               const KeyCode& rCode,
+               const String& rName, const String& rShortName);
+    // <--
+};
+
+
+#endif
diff --git sw/inc/comcore.hrc sw/inc/comcore.hrc
index 8260814..9122841 100644
--- sw/inc/comcore.hrc
+++ sw/inc/comcore.hrc
@@ -115,8 +115,9 @@
 #define STR_AUTOFMTREDL_SET_TMPL_HEADLINE		18
 #define STR_AUTOFMTREDL_SET_NUMBULET			19
 #define STR_AUTOFMTREDL_DEL_MORELINES			20
+#define STR_AUTOFMTREDL_NON_BREAK_SPACE         21
 // !!!!!!!!!!!!!!!!!!!!!!!!!!  das Ende immer richtig setzen !!!!!!!!!!!!
-#define STR_AUTOFMTREDL_END						21
+#define STR_AUTOFMTREDL_END						22
 
 
 #endif
diff --git sw/inc/fmthbsh.hxx sw/inc/fmthbsh.hxx
new file mode 100644
index 0000000..5f117e0
--- /dev/null
+++ sw/inc/fmthbsh.hxx
@@ -0,0 +1,74 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: fmthbsh.hxx,v $
+ * $Revision: 1.5 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef _FMTHBSH_HXX
+#define _FMTHBSH_HXX
+
+
+#include <svtools/poolitem.hxx>
+
+// ATT_SOFTHYPH ******************************
+// Attribut fuer benutzerdefinierte Trennstellen.
+
+class SwFmtSoftHyph : public SfxPoolItem
+{
+public:
+    SwFmtSoftHyph();
+
+    // "pure virtual Methoden" vom SfxPoolItem
+    virtual int             operator==( const SfxPoolItem& ) const;
+    virtual SfxPoolItem*	Clone( SfxItemPool* pPool = 0 ) const;
+
+    inline SwFmtSoftHyph& operator=(const SwFmtSoftHyph&) {
+            return *this;
+        }
+};
+
+// ATT_HARDBLANK ******************************
+// Attribut fuer geschuetzte Leerzeichen.
+
+class SW_DLLPUBLIC SwFmtHardBlank : public SfxPoolItem
+{
+    sal_Unicode cChar;
+public:
+    SwFmtHardBlank( sal_Unicode cCh, BOOL bCheck = TRUE );
+
+    // "pure virtual Methoden" vom SfxPoolItem
+    virtual int             operator==( const SfxPoolItem& ) const;
+    virtual SfxPoolItem*	Clone( SfxItemPool* pPool = 0 ) const;
+
+
+    inline sal_Unicode GetChar() const { return cChar; }
+    inline SwFmtHardBlank& operator=(const SwFmtHardBlank& rHB)
+    { cChar = rHB.GetChar(); return *this; }
+};
+
+
+#endif
+
diff --git sw/inc/swenumdef.hxx sw/inc/swenumdef.hxx
new file mode 100644
index 0000000..6b6f9fa
--- /dev/null
+++ sw/inc/swenumdef.hxx
@@ -0,0 +1,72 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 by Eric Bachard.
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: swenumdef.hxx,v $
+ * $Revision: 0.1 $
+ *
+ * This file is part of OOo4Kids
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef _SW_ENUMDEF_HXX
+#define _SW_ENUMDEF_HXX
+
+/* fixme : complete/improve the enumeration
+ * OutputType is used to define the output medium. e.g. with Impress, we can have slides,
+ * or other output types like paper, transparent medium, slide, screen ... 
+ * Default will be OUTPUT_PAGE
+ */
+ 
+enum OutputType
+{
+    OUTPUT_PAGE,	/* screen */
+    OUTPUT_OVERHEAD,
+    OUTPUT_SLIDE,	/* diapo */
+    OUTPUT_PRESENTATION,
+    OUTPUT_ORIGINAL	/* original */ 
+};
+
+// we'll propose to open templates, and know what we found/open is usefull
+
+enum StartType
+{
+    ST_EMPTY,
+    ST_TEMPLATE,
+    ST_OPEN
+};
+
+// copied from sd. can this be usefull in sw ?
+#define RET_SNAP_DELETE 111
+
+// let's keep it just in case those cases are existing in Writer
+
+//enum SnapKind 
+//{
+//    SK_HORIZONTAL,
+//    SK_VERTICAL,
+//    SK_POINT
+//};
+//
+
+#endif
+
diff --git sw/qa/complex/writer/TextPortionEnumerationTest.java sw/qa/complex/writer/TextPortionEnumerationTest.java
deleted file mode 100755
index a07b3cc..0000000
--- sw/qa/complex/writer/TextPortionEnumerationTest.java
+++ /dev/null
@@ -1,3871 +0,0 @@
-/*************************************************************************
- *
- * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
- *
- * Copyright 2008 by Sun Microsystems, Inc.
- *
- * OpenOffice.org - a multi-platform office productivity suite
- *
- * $RCSfile: $
- * $Revision: $
- *
- * This file is part of OpenOffice.org.
- *
- * OpenOffice.org is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Lesser General Public License version 3
- * only, as published by the Free Software Foundation.
- *
- * OpenOffice.org is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Lesser General Public License version 3 for more details
- * (a copy is included in the LICENSE file that accompanied this code).
- *
- * You should have received a copy of the GNU Lesser General Public License
- * version 3 along with OpenOffice.org.  If not, see
- * <http://www.openoffice.org/license.html>
- * for a copy of the LGPLv3 License.
- *
- ************************************************************************/
-
-package complex.writer;
-
-import complexlib.ComplexTestCase;
-import com.sun.star.uno.UnoRuntime;
-import com.sun.star.uno.AnyConverter;
-import com.sun.star.uno.XComponentContext;
-import com.sun.star.lang.XMultiServiceFactory;
-import com.sun.star.lang.XComponent;
-import com.sun.star.lang.XServiceInfo;
-import com.sun.star.beans.XPropertySet;
-import com.sun.star.beans.XPropertySetInfo;
-import com.sun.star.beans.PropertyValue;
-import com.sun.star.beans.Pair;
-import com.sun.star.beans.StringPair;
-import com.sun.star.container.XNamed;
-import com.sun.star.container.XContentEnumerationAccess;
-import com.sun.star.container.XEnumerationAccess;
-import com.sun.star.container.XEnumeration;
-import com.sun.star.container.NoSuchElementException;
-import com.sun.star.frame.XStorable;
-import com.sun.star.util.XCloseable;
-import com.sun.star.text.XText;
-import com.sun.star.text.XTextContent;
-import com.sun.star.text.XTextDocument;
-import com.sun.star.text.XTextRange;
-import com.sun.star.text.XTextCursor;
-import com.sun.star.text.XWordCursor;
-import com.sun.star.text.XSentenceCursor;
-import com.sun.star.text.XParagraphCursor;
-import com.sun.star.text.XFootnote;
-import com.sun.star.text.XTextField;
-import com.sun.star.text.TextContentAnchorType;
-import static com.sun.star.text.TextContentAnchorType.*;
-import static com.sun.star.text.ControlCharacter.*;
-import com.sun.star.rdf.XMetadatable;
-
-import java.util.Map;
-import java.util.HashMap;
-import java.util.List;
-import java.util.ArrayList;
-import java.util.Stack;
-
-
-class TreeNodeEnum
-{
-    private Object[] m_Elements;
-    private int m_Pos;
-    TreeNodeEnum(Object[] Elements) { m_Elements = Elements; m_Pos = 0; }
-    boolean hasNext() { return m_Pos < m_Elements.length; }
-    TreeNode next() { return (TreeNode) m_Elements[m_Pos++]; }
-}
-
-/** base class for tree nodes. only instance: root of tree. */
-class TreeNode
-{
-    private List<TreeNode> m_Children;
-    String getType() { return "__ROOT__"; }
-    boolean hasContent() { return false; }
-    boolean isNesting() { return false; }
-    TreeNode dup() { throw new RuntimeException("TreeNode.dup"); }
-    TreeNodeEnum createEnumeration() {
-        return new TreeNodeEnum(m_Children.toArray());
-    }
-    TreeNode() { m_Children = new ArrayList<TreeNode>(); }
-    TreeNode appendChild(TreeNode child)
-    { m_Children.add(child); return this; }
-    public String toString() {
-        return "<" + getType() + ">";
-    }
-}
-
-abstract class MarkNode extends TreeNode
-{
-    boolean m_isPoint;
-    boolean m_isStart = false;
-    String m_Name;
-    boolean isPoint() { return m_isPoint; }
-    boolean isStart() { return m_isStart; }
-    String getName() { return m_Name; }
-    MarkNode(String name) { m_Name = name; m_isPoint = true; }
-    boolean equals(MarkNode other) {
-        return (other.m_Name.equals(m_Name)) && (other.m_isPoint == m_isPoint)
-            && (other.m_isStart == m_isStart);
-    }
-    public String toString() {
-        return super.toString() + "\tname: " + m_Name +
-            "\tisPoint: " + m_isPoint + "\tisStart: " + m_isStart;
-    }
-}
-
-class BookmarkNode extends MarkNode
-{
-    private StringPair m_XmlId;
-    StringPair getXmlId() { return m_XmlId; }
-    BookmarkNode dup() { return new BookmarkNode(getName(), getXmlId()); }
-    BookmarkNode(String name) { this(name, new StringPair());  }
-    BookmarkNode(String name, StringPair xmlid) {
-        super(name); m_XmlId = xmlid;
-    }
-    String getType() { return "Bookmark"; }
-    public boolean equals(Object other) {
-        return (other instanceof BookmarkNode)
-            && super.equals((MarkNode) other)
-            && MetaNode.eq(((BookmarkNode) other).m_XmlId, m_XmlId);
-    }
-    public String toString() {
-        return super.toString()
-            + "\txmlid: " + m_XmlId.First + "#" + m_XmlId.Second;
-    }
-}
-
-class BookmarkStartNode extends BookmarkNode
-{
-    BookmarkStartNode dup() { return new BookmarkStartNode(getName()); }
-    BookmarkStartNode(String name) { this(name, new StringPair()); }
-    BookmarkStartNode(String name, StringPair xmlid) {
-        super(name, xmlid); m_isPoint = false; m_isStart = true;
-    }
-}
-
-class BookmarkEndNode extends BookmarkNode
-{
-    BookmarkEndNode dup() { return new BookmarkEndNode(getName()); }
-    BookmarkEndNode(String name) { this(name, new StringPair()); }
-    BookmarkEndNode(String name, StringPair xmlid) {
-        super(name, xmlid); m_isPoint = false; m_isStart = false;
-    }
-}
-
-class ReferenceMarkNode extends MarkNode
-{
-    ReferenceMarkNode dup() { return new ReferenceMarkNode(getName()); }
-    ReferenceMarkNode(String name) { super(name); }
-    String getType() { return "ReferenceMark"; }
-    public boolean equals(Object other) {
-        return (other instanceof ReferenceMarkNode)
-            && super.equals((MarkNode) other);
-    }
-}
-
-class ReferenceMarkStartNode extends ReferenceMarkNode
-{
-    ReferenceMarkStartNode dup()
-    { return new ReferenceMarkStartNode(getName()); }
-    ReferenceMarkStartNode(String name) {
-        super(name); m_isPoint = false; m_isStart = true;
-    }
-}
-
-class ReferenceMarkEndNode extends ReferenceMarkNode
-{
-    ReferenceMarkEndNode dup()
-    { return new ReferenceMarkEndNode(getName()); }
-    ReferenceMarkEndNode(String name) {
-        super(name); m_isPoint = false; m_isStart = false;
-    }
-}
-
-class DocumentIndexMarkNode extends MarkNode
-{
-    DocumentIndexMarkNode dup()
-    { return new DocumentIndexMarkNode(getName()); }
-    DocumentIndexMarkNode(String name) { super(name); }
-    String getType() { return "DocumentIndexMark"; }
-    public boolean equals(Object other) {
-        return (other instanceof DocumentIndexMarkNode)
-            && super.equals((MarkNode) other);
-    }
-}
-
-class DocumentIndexMarkStartNode extends DocumentIndexMarkNode
-{
-    DocumentIndexMarkStartNode dup()
-    { return new DocumentIndexMarkStartNode(getName()); }
-    DocumentIndexMarkStartNode(String name) {
-        super(name); m_isPoint = false; m_isStart = true;
-    }
-}
-
-class DocumentIndexMarkEndNode extends DocumentIndexMarkNode
-{
-    DocumentIndexMarkEndNode dup()
-    { return new DocumentIndexMarkEndNode(getName()); }
-    DocumentIndexMarkEndNode(String name) {
-        super(name); m_isPoint = false; m_isStart = false;
-    }
-}
-
-abstract class ContentNode extends TreeNode
-{
-    private String m_Content;
-    String getContent() { return m_Content; }
-    boolean hasContent() { return true; }
-    ContentNode(String content) {
-        m_Content = content;
-    }
-    TreeNode appendChild(TreeNode t) {
-        throw new RuntimeException("ContentNode.appendChild");
-    }
-    public String toString() {
-        return super.toString() + "\tcontent: " + m_Content;
-    }
-    boolean equals(ContentNode other) {
-        return (other.m_Content.equals(m_Content));
-    }
-}
-
-class TextNode extends ContentNode
-{
-    TextNode dup() { return new TextNode(getContent()); }
-    TextNode(String content) { super(content); }
-    String getType() { return "Text"; }
-    public boolean equals(Object other) {
-        return (other instanceof TextNode) && super.equals((ContentNode) other);
-    }
-}
-
-class TextFieldNode extends ContentNode
-{
-    TextFieldNode dup() { return new TextFieldNode(getContent()); }
-    TextFieldNode(String content) { super(content); }
-    String getType() { return "TextField"; }
-    public boolean equals(Object other) {
-        return (other instanceof TextFieldNode)
-            && super.equals((ContentNode) other);
-    }
-}
-
-class FrameNode extends TreeNode
-{
-    private String m_Name;
-    private TextContentAnchorType m_Anchor;
-    String getName() { return m_Name; }
-    TextContentAnchorType getAnchor() { return m_Anchor; }
-    FrameNode dup() { return new FrameNode(getName(), getAnchor()); }
-    FrameNode(String name, TextContentAnchorType anchor) {
-        m_Name = name; m_Anchor = anchor;
-    }
-    String getType() { return "Frame"; }
-    public boolean equals(Object other) {
-        return (other instanceof FrameNode)
-            && (((FrameNode) other).m_Name.equals(m_Name))
-            && (((FrameNode) other).m_Anchor == m_Anchor);
-    }
-    public String toString() {
-        return super.toString()
-            + "\tname: " + m_Name + "\tanchor: " + toString(m_Anchor);
-    }
-    static String toString(TextContentAnchorType anchor) {
-        switch (anchor.getValue()) {
-            case AS_CHARACTER_value: return "AS_CHARACTER";
-            case AT_CHARACTER_value: return "AT_CHARACTER";
-            case AT_PARAGRAPH_value: return "AT_PARAGRAPH";
-            case AT_PAGE_value:      return "AT_PAGE";
-            case AT_FRAME_value:     return "AT_FRAME";
-            default: throw new RuntimeException("unknown anchor");
-        }
-    }
-}
-
-class FootnoteNode extends TreeNode
-{
-    private String m_Label;
-    String getLabel() { return m_Label; }
-    FootnoteNode dup() { return new FootnoteNode(getLabel()); }
-    FootnoteNode(String label) { m_Label = label; }
-    String getType() { return "Footnote"; }
-    public boolean equals(Object other) {
-        return (other instanceof FootnoteNode)
-            && (((FootnoteNode) other).m_Label.equals(m_Label));
-    }
-    public String toString() {
-        return super.toString() + "\tlabel: " + m_Label;
-    }
-}
-
-class ControlCharacterNode extends TreeNode
-{
-    private short m_Char;
-    short getChar() { return m_Char; }
-    ControlCharacterNode dup() { return new ControlCharacterNode(getChar()); }
-    ControlCharacterNode(short c) { m_Char = c; }
-    String getType() { return "ControlCharacter"; }
-    public boolean equals(Object other) {
-        return (other instanceof ControlCharacterNode)
-            && (((ControlCharacterNode) other).m_Char == m_Char);
-    }
-    public String toString() {
-        return super.toString() + "\tchar: " + m_Char;
-    }
-}
-
-class SoftPageBreakNode extends TreeNode
-{
-    String getType() { return "SoftPageBreak"; }
-    public boolean equals(Object other) {
-        return (other instanceof SoftPageBreakNode);
-    }
-}
-
-class HyperlinkNode extends TreeNode
-{
-    private String m_URL;
-    String getURL() { return m_URL; }
-    HyperlinkNode dup() { return new HyperlinkNode(getURL()); }
-    HyperlinkNode(String url) {
-        if (url.length() == 0) throw new RuntimeException("HyperlinkNode");
-        m_URL = url;
-    }
-    String getType() { return "Hyperlink"; }
-    boolean isNesting() { return true; }
-    public boolean equals(Object other) {
-        return (other instanceof HyperlinkNode)
-            && (((HyperlinkNode) other).m_URL.equals(m_URL));
-    }
-    public String toString() {
-        return super.toString() + "\turl: " + m_URL;
-    }
-}
-
-class RubyNode extends TreeNode
-{
-    private String m_Ruby;
-    String getRubyText() { return m_Ruby; }
-    RubyNode dup() { return new RubyNode(getRubyText()); }
-    RubyNode(String ruby) {
-        if (ruby.length() == 0) throw new RuntimeException("RubyNode");
-        m_Ruby = ruby;
-    }
-    String getType() { return "Ruby"; }
-    boolean isNesting() { return true; }
-    public boolean equals(Object other) {
-        return (other instanceof RubyNode)
-            && (((RubyNode) other).m_Ruby.equals(m_Ruby));
-    }
-    public String toString() {
-        return super.toString() + "\trubytext: " + m_Ruby;
-    }
-}
-
-class MetaNode extends TreeNode
-{
-    private StringPair m_XmlId;
-    StringPair getXmlId() { return m_XmlId; }
-    MetaNode dup() { return new MetaNode(getXmlId()); }
-    MetaNode (StringPair xmlid) { m_XmlId = xmlid; }
-    String getType() { return "InContentMetadata"; }
-    boolean isNesting() { return true; }
-    public boolean equals(Object other) {
-        return (other instanceof MetaNode)
-            && eq(((MetaNode) other).m_XmlId, m_XmlId);
-    }
-    static boolean eq(StringPair left, StringPair right)
-    {
-        return left.First.equals(right.First)
-            && left.Second.equals(right.Second);
-    }
-    public String toString() {
-        return super.toString()
-            + "\txmlid: " + m_XmlId.First + "#" + m_XmlId.Second;
-    }
-}
-
-class MetaFieldNode extends MetaNode
-{
-    MetaFieldNode dup() { return new MetaFieldNode(getXmlId()); }
-    MetaFieldNode (StringPair xmlid) { super(xmlid); }
-    String getType() { return "MetadataField"; }
-}
-
-class Range
-{
-    private short m_Start;
-    private short m_End;
-    private TreeNode m_Node;
-    short getStart()    { return m_Start; }
-    short getEnd()      { return m_End  ; }
-    short getExtent()   { return (short) (m_End - m_Start); }
-    TreeNode getNode()  { return m_Node; }
-    Range(int start, int end, TreeNode node)
-    { m_Start = (short) start; m_End = (short) end; m_Node = node; }
-}
-
-//----------------------------------------------------------------------
-
-/* this is where we nail the pudding to the wall */
-class FuzzyTester
-{
-    private long m_DiffContent = 0;
-    private long m_DiffMissing = 0;
-    private long m_DiffNesting = 0;
-    private long m_DiffSpuriousEmptyText = 0;
-    private long m_DiffSequence = 0; // ignored?
-    private Stack<Pair<TreeNode, TreeNodeEnum>> m_StackExpected;
-    private Stack<Pair<TreeNode, TreeNodeEnum>> m_StackActual;
-    private List<TreeNode> m_BufferExpected;
-    private List<TreeNode> m_BufferActual;
-    private share.LogWriter m_Log;
-
-    FuzzyTester(share.LogWriter log) {
-        m_Log = log;
-        m_BufferExpected = new ArrayList<TreeNode>();
-        m_BufferActual = new ArrayList<TreeNode>();
-        m_StackExpected = new Stack<Pair<TreeNode, TreeNodeEnum>>();
-        m_StackActual = new Stack<Pair<TreeNode, TreeNodeEnum>>();
-    }
-
-    /** idea: traverse both trees, enumerate nodes, stopping at content nodes.
-        then compare buffers. */
-    boolean doTest(TreeNode expected, TreeNode actual)
-    {
-        if (!expected.getType().equals("__ROOT__"))
-            throw new RuntimeException("doTest: expected: root");
-        if (!actual.getType().equals("__ROOT__"))
-            throw new RuntimeException("doTest: actual: root");
-        m_StackExpected.push(new Pair(expected, expected.createEnumeration()));
-        m_StackActual.push(new Pair(actual, actual.createEnumeration()));
-        do {
-            traverse(m_StackExpected, m_BufferExpected);
-            traverse(m_StackActual, m_BufferActual);
-        //??? root?
-            testBuffer();
-        } while (!m_StackExpected.empty() || !m_StackActual.empty());
-        if (m_DiffSequence != 0) {
-            m_Log.println("warning: " +  m_DiffSequence
-                    + " differences in sequence");
-        }
-        if (m_DiffSpuriousEmptyText != 0) {
-            m_Log.println("warning: " +  m_DiffSpuriousEmptyText
-                    + " spurious empty text nodes");
-        }
-        if (m_DiffNesting != 0) {
-            m_Log.println("WARNING: " +  m_DiffNesting
-                    + " differences in nesting");
-        }
-        return (m_DiffContent == 0) && (m_DiffMissing == 0);
-    }
-
-    private void traverse(Stack<Pair<TreeNode, TreeNodeEnum>> stack,
-                  List<TreeNode> buffer)
-    {
-        while (!stack.empty()) {
-            TreeNodeEnum topEnum = stack.peek().Second;
-            if (topEnum.hasNext()) {
-                TreeNode node = topEnum.next();
-                buffer.add(node);
-                TreeNodeEnum nodeEnum = node.createEnumeration();
-                if (nodeEnum.hasNext()) {
-                    stack.push(new Pair(node, nodeEnum));
-                }
-                if (node.hasContent()) {
-                    if (!((node instanceof TextNode) // spurious empty text?
-                        && ((TextNode) node).getContent().length() == 0)) {
-                            return; // break here
-                    }
-                }
-            } else {
-                buffer.add(stack.peek().First);
-                stack.pop();
-            }
-        }
-    }
-
-    private void testTerminatingNode()
-    {
-        int lenExpected = m_BufferExpected.size();
-        int lenActual   = m_BufferActual.size();
-        if (lenExpected == 0 || lenActual == 0)
-            return;
-        TreeNode expected = m_BufferExpected.get(lenExpected - 1);
-        TreeNode actual = m_BufferActual.get(lenActual - 1);
-
-        boolean eRoot = expected.getType().equals("__ROOT__");
-        boolean aRoot = actual.getType().equals("__ROOT__");
-        if (eRoot || aRoot) {
-            if (!(eRoot && aRoot)) {
-                if (aRoot) printMissing(expected);
-                else       printUnexpected(actual);
-                m_DiffMissing++;
-            }
-            return;
-        }
-
-        testContentNode((ContentNode) expected, (ContentNode) actual);
-
-        m_BufferExpected.set(lenExpected - 1, null);
-        m_BufferActual.set(lenActual - 1, null);
-    }
-
-    private void testContentNode(ContentNode expected, ContentNode actual)
-    {
-        String contentExpected = expected.getContent();
-        String contentActual = actual.getContent();
-        if (!expected.equals(actual)) {
-            printDiff("text content differs", contentExpected, contentActual);
-            m_DiffContent++;
-        }
-    }
-
-    private void testBuffer()
-    {
-        int lenExpected = m_BufferExpected.size();
-        int lenActual   = m_BufferActual.size();
-        for (int i = 0; i < lenExpected - 1; i++ )
-        {
-            TreeNode node = m_BufferExpected.get(i);
-            int j = m_BufferActual.indexOf(node);
-            if (j >= 0) {
-                TreeNode other = m_BufferActual.get(j);
-                if (j != i)
-                {
-                    //FIXME how bad is this?
-                    printDiff("position differs",
-                            String.valueOf(i), String.valueOf(j));
-                    // a hacky hack
-                    int min = Math.min(i,j);
-                    int max = Math.max(Math.min(lenActual - 1, i),j);
-                    for (int k = min; k != max; k ++) {
-                        TreeNode tmp = m_BufferActual.get(k);
-                        if (tmp != null && tmp.isNesting()) {
-                            printNesting(node, tmp);
-                            m_DiffNesting++;
-                        }
-                    }
-                    m_DiffSequence++;
-                }
-                m_BufferActual.set(j, null);
-            } else {
-//m_Log.println("testBuffer:");
-                printMissing(node);
-                m_DiffMissing++;
-            }
-        }
-        for (int j = 0; j < lenActual - 1; j++)
-        {
-            TreeNode node = m_BufferActual.get(j);
-            if (node != null)
-            {
-//m_Log.println("testBuffer:");
-                printUnexpected(node);
-                if ((node instanceof TextNode) &&
-                        ((TextNode) node).getContent().length() == 0) {
-                    m_DiffSpuriousEmptyText++;
-                } else {
-                    m_DiffMissing++;
-                }
-            }
-        }
-        testTerminatingNode();
-        m_BufferExpected.clear();
-        m_BufferActual.clear();
-    }
-
-    void printDiff(String prefix, String expected, String actual)
-    {
-        m_Log.println(prefix +
-                ":\texpected: " + expected + "\tactual: " + actual);
-    }
-
-    void printNesting(TreeNode node, TreeNode nesting)
-    {
-        m_Log.println("node: " + node.toString()
-                + " possibly moved across nesting " + nesting.toString());
-    }
-
-    void printMissing(TreeNode node)
-    {
-        m_Log.println("   missing node: " + node.toString());
-
-    }
-
-    void printUnexpected(TreeNode node)
-    {
-        m_Log.println("unexpected node: " + node.toString());
-
-    }
-}
-
-
-//----------------------------------------------------------------------
-
-class EnumConverter
-{
-    private Stack<TreeNode> m_Stack;
-    TextPortionEnumerationTest m_T;
-
-    EnumConverter(TextPortionEnumerationTest err) {
-        m_Stack = new Stack<TreeNode>(); m_T = err;
-    }
-
-    TreeNode convert(XEnumeration xEnum) throws Exception
-    {
-        TreeNode root = new TreeNode();
-        m_Stack.push(root);
-        TreeNode ret = convertChildren(xEnum);
-        m_T.assure("EnumConverter.convert: stack", m_Stack.empty());
-        return ret;
-    }
-
-    TreeNode convertChildren(XEnumeration xEnum) throws Exception
-    {
-        while (xEnum.hasMoreElements()) {
-            TreeNode node;
-            Object xElement = xEnum.nextElement();
-            XTextRange xPortion = (XTextRange)
-                UnoRuntime.queryInterface(XTextRange.class, xElement);
-            XPropertySet xPropSet = (XPropertySet)
-                UnoRuntime.queryInterface(XPropertySet.class, xPortion);
-            String type = (String) xPropSet.getPropertyValue("TextPortionType");
-            if (type.equals("Text")) {
-                String text = xPortion.getString();
-                node = new TextNode(text);
-                String url = (String) xPropSet.getPropertyValue("HyperLinkURL");
-                if (url.length() > 0) {
-                    TreeNode temp = node;
-                    node = new HyperlinkNode(url);
-                    node.appendChild(temp);
-                }
-            } else if (type.equals("TextField")) {
-                Object xField = xPropSet.getPropertyValue("TextField");
-                XServiceInfo xService = (XServiceInfo)
-                    UnoRuntime.queryInterface(XServiceInfo.class, xField);
-                if (xService.supportsService(
-                        "com.sun.star.text.textfield.MetadataField"))
-                {
-                    XMetadatable xMeta = (XMetadatable)
-                        UnoRuntime.queryInterface(XMetadatable.class, xField);
-                    StringPair xmlid = xMeta.getMetadataReference();
-                    node = new MetaFieldNode(xmlid);
-                    m_Stack.push(node);
-                    XEnumerationAccess xEA = (XEnumerationAccess)
-                        UnoRuntime.queryInterface(XEnumerationAccess.class,
-                        xMeta);
-                    XEnumeration xEnumChildren = xEA.createEnumeration();
-                    TreeNode node2 = convertChildren(xEnumChildren);
-                    m_T.assure("stack error: meta-field", node == node2);
-                } else {
-                    XPropertySet xFieldPropSet = (XPropertySet)
-                        UnoRuntime.queryInterface(XPropertySet.class, xField);
-                    String content = (String)
-                        xFieldPropSet.getPropertyValue("Content");
-                    boolean isFixed = (Boolean)
-                        xFieldPropSet.getPropertyValue("IsFixed");
-                    m_T.assure("field not fixed?", isFixed);
-                    node = new TextFieldNode(content);
-                }
-            } else if (type.equals("Footnote")) {
-                Object xNote = xPropSet.getPropertyValue("Footnote");
-                XFootnote xFootnote = (XFootnote)
-                    UnoRuntime.queryInterface(XFootnote.class, xNote);
-                String label = xFootnote.getLabel();
-                node = new FootnoteNode(label);
-            } else if (type.equals("Frame")) {
-                XContentEnumerationAccess xCEA = (XContentEnumerationAccess)
-                    UnoRuntime.queryInterface(XContentEnumerationAccess.class,
-                        xPortion);
-                XEnumeration xContentEnum = xCEA.createContentEnumeration("");
-                while (xContentEnum.hasMoreElements()) {
-                    Object xFrame = xContentEnum.nextElement();
-                    XPropertySet xFramePropSet = (XPropertySet)
-                        UnoRuntime.queryInterface(XPropertySet.class, xFrame);
-                    TextContentAnchorType anchor = (TextContentAnchorType)
-                        xFramePropSet.getPropertyValue("AnchorType");
-                    XNamed xNamed = (XNamed)
-                        UnoRuntime.queryInterface(XNamed.class, xFrame);
-                    String name = xNamed.getName();
-                    node = new FrameNode(name, anchor);
-                    m_Stack.peek().appendChild(node);
-                }
-                continue;
-            } else if (type.equals("ControlCharacter")) {
-                short c = (Short)
-                    xPropSet.getPropertyValue("ControlCharacter");
-                node = new ControlCharacterNode(c);
-            } else if (type.equals("Bookmark")) {
-                Object xMark = xPropSet.getPropertyValue("Bookmark");
-                XNamed xNamed = (XNamed)
-                    UnoRuntime.queryInterface(XNamed.class, xMark);
-                String name = xNamed.getName();
-                XMetadatable xMetadatable = (XMetadatable)
-                    UnoRuntime.queryInterface(XMetadatable.class, xMark);
-                StringPair xmlid = xMetadatable.getMetadataReference();
-                boolean isCollapsed = (Boolean)
-                    xPropSet.getPropertyValue("IsCollapsed");
-                if (isCollapsed) {
-                    node = new BookmarkNode(name, xmlid);
-                } else {
-                    boolean isStart = (Boolean)
-                        xPropSet.getPropertyValue("IsStart");
-                    if (isStart) {
-                        node = new BookmarkStartNode(name, xmlid);
-                    } else {
-                        node = new BookmarkEndNode(name, xmlid);
-                    }
-                }
-            } else if (type.equals("ReferenceMark")) {
-                Object xMark = xPropSet.getPropertyValue("ReferenceMark");
-                XNamed xNamed = (XNamed)
-                    UnoRuntime.queryInterface(XNamed.class, xMark);
-                String name = xNamed.getName();
-                boolean isCollapsed = (Boolean)
-                    xPropSet.getPropertyValue("IsCollapsed");
-                if (isCollapsed) {
-                    node = new ReferenceMarkNode(name);
-                } else {
-                    boolean isStart = (Boolean)
-                        xPropSet.getPropertyValue("IsStart");
-                    if (isStart) {
-                        node = new ReferenceMarkStartNode(name);
-                    } else {
-                        node = new ReferenceMarkEndNode(name);
-                    }
-                }
-            } else if (type.equals("DocumentIndexMark")) {
-                Object xMark = xPropSet.getPropertyValue("DocumentIndexMark");
-                XPropertySet xMarkSet = (XPropertySet)
-                    UnoRuntime.queryInterface(XPropertySet.class, xMark);
-                String name = (String) xMarkSet.getPropertyValue("PrimaryKey");
-                boolean isCollapsed = (Boolean)
-                    xPropSet.getPropertyValue("IsCollapsed");
-                if (isCollapsed) {
-                    node = new DocumentIndexMarkNode(name);
-                } else {
-                    boolean isStart = (Boolean)
-                        xPropSet.getPropertyValue("IsStart");
-                    if (isStart) {
-                        node = new DocumentIndexMarkStartNode(name);
-                    } else {
-                        node = new DocumentIndexMarkEndNode(name);
-                    }
-                }
-            } else if (type.equals("SoftPageBreak")) {
-                node = new SoftPageBreakNode();
-            } else if (type.equals("Ruby")) {
-                boolean isStart = (Boolean)
-                    xPropSet.getPropertyValue("IsStart");
-                if (isStart) {
-                    // ARRGH!!! stupid api...
-                    // the text is ONLY at the start!
-                    String ruby = (String)
-                        xPropSet.getPropertyValue("RubyText");
-                    node = new RubyNode(ruby);
-                    m_Stack.push(node);
-                    continue;
-                } else {
-                    node = m_Stack.pop();
-                    m_T.assure("stack error: Ruby expected; is: " +
-                            node.toString(), node instanceof RubyNode);
-//                    m_T.assure("stack error: ruby",
-//                            ruby.equals(((RubyNode)node).getRubyText()));
-                }
-            } else if (type.equals("InContentMetadata")) {
-                Object xMeta = xPropSet.getPropertyValue("InContentMetadata");
-                XMetadatable xMetadatable = (XMetadatable)
-                    UnoRuntime.queryInterface(XMetadatable.class, xMeta);
-                StringPair xmlid = xMetadatable.getMetadataReference();
-                node = new MetaNode(xmlid);
-                m_Stack.push(node);
-                XEnumerationAccess xEA = (XEnumerationAccess)
-                    UnoRuntime.queryInterface(XEnumerationAccess.class, xMeta);
-                XEnumeration xEnumChildren = xEA.createEnumeration();
-                TreeNode node2 = convertChildren(xEnumChildren);
-                m_T.assure("stack error: meta", node == node2);
-//            } else if (type.equals("MetadataField")) {
-//                    Object xMeta = xPropSet.getPropertyValue("MetadataField");
-            } else {
-                throw new RuntimeException("unexpected type: " + type);
-            }
-            m_Stack.peek().appendChild(node);
-        }
-        TreeNode ret = m_Stack.pop();
-        return ret;
-    }
-}
-
-
-//----------------------------------------------------------------------
-
-abstract class Inserter
-{
-    private XMultiServiceFactory m_xDocFactory;
-    XText m_xText;
-    XParagraphCursor m_xCursor;
-
-    Inserter(XTextDocument xDoc)
-    {
-        m_xDocFactory = (XMultiServiceFactory)
-            UnoRuntime.queryInterface(XMultiServiceFactory.class, xDoc);
-        m_xText = xDoc.getText();
-        XTextCursor xCursor = m_xText.createTextCursor();
-        m_xCursor = (XParagraphCursor)
-            UnoRuntime.queryInterface(XParagraphCursor.class, xCursor);
-    }
-
-    void initParagraph() throws Exception
-    {
-        m_xCursor.gotoStartOfParagraph(false);
-        m_xText.insertControlCharacter(m_xCursor, PARAGRAPH_BREAK, false);
-        // we split the first (empty) paragraph, and then insert into the
-        // second (empty) paragraph; this ensures first is always empty!
-    }
-
-    void insertControlCharacter(XTextCursor xCursor, short cchar)
-        throws Exception
-    {
-        m_xText.insertControlCharacter(xCursor, cchar, false);
-    }
-
-    void insertText(XTextCursor xCursor, String text)
-    {
-        xCursor.setString(text);
-    }
-
-    void insertTextField(XTextCursor xCursor, String content) throws Exception
-    {
-        XTextContent xContent = makeTextField(content);
-        xContent.attach(xCursor);
-    }
-
-    XTextContent makeTextField(String content)
-        throws Exception
-    {
-        Object xField =
-            m_xDocFactory.createInstance("com.sun.star.text.textfield.Author");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xField);
-        XPropertySet xPropSet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, xField);
-        xPropSet.setPropertyValue("IsFixed", true);
-        xPropSet.setPropertyValue("FullName", false);
-        xPropSet.setPropertyValue("Content", content);
-        return xContent;
-    }
-
-    void insertFrame(XTextRange xCursor, String name,
-            TextContentAnchorType anchor) throws Exception
-    {
-        XTextContent xContent = makeFrame(name, anchor);
-        xContent.attach(xCursor);
-    }
-
-    XTextContent makeFrame(String name, TextContentAnchorType anchor)
-        throws Exception
-    {
-        Object xFrame =
-            m_xDocFactory.createInstance("com.sun.star.text.TextFrame");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xFrame);
-        XPropertySet xPropSet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, xFrame);
-        xPropSet.setPropertyValue("AnchorType", anchor);
-        XNamed xNamed = (XNamed)
-            UnoRuntime.queryInterface(XNamed.class, xContent);
-        xNamed.setName(name);
-        return xContent;
-    }
-
-    void insertFootnote(XTextCursor xCursor, String label) throws Exception
-    {
-        XTextContent xContent = makeFootnote(label);
-        xContent.attach(xCursor);
-    }
-
-    XTextContent makeFootnote(String label) throws Exception
-    {
-        Object xNote =
-            m_xDocFactory.createInstance("com.sun.star.text.Footnote");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xNote);
-        XFootnote xFootnote = (XFootnote)
-            UnoRuntime.queryInterface(XFootnote.class, xNote);
-        xFootnote.setLabel(label);
-        return xContent;
-    }
-
-    void insertBookmark(XTextCursor xCursor, String name, StringPair xmlid)
-        throws Exception
-    {
-        XTextContent xContent = makeBookmark(name);
-        xContent.attach(xCursor);
-        if (!xmlid.First.equals(""))
-        {
-            XMetadatable xMetadatable = (XMetadatable)
-                UnoRuntime.queryInterface(XMetadatable.class, xContent);
-            xMetadatable.setMetadataReference(xmlid);
-        }
-    }
-
-    XTextContent makeBookmark(String name) throws Exception
-    {
-        Object xBookmark =
-            m_xDocFactory.createInstance("com.sun.star.text.Bookmark");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xBookmark);
-        XNamed xNamed = (XNamed)
-            UnoRuntime.queryInterface(XNamed.class, xContent);
-        xNamed.setName(name);
-        return xContent;
-    }
-
-    void insertReferenceMark(XTextCursor xCursor, String name) throws Exception
-    {
-        XTextContent xContent = makeReferenceMark(name);
-        xContent.attach(xCursor);
-    }
-
-    XTextContent makeReferenceMark(String name) throws Exception
-    {
-        Object xMark =
-            m_xDocFactory.createInstance("com.sun.star.text.ReferenceMark");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xMark);
-        XNamed xNamed = (XNamed)
-            UnoRuntime.queryInterface(XNamed.class, xContent);
-        xNamed.setName(name);
-        return xContent;
-    }
-
-    void insertDocumentIndexMark(XTextCursor xCursor, String key)
-        throws Exception
-    {
-        XTextContent xContent = makeDocumentIndexMark(key);
-        xContent.attach(xCursor);
-    }
-
-    XTextContent makeDocumentIndexMark(String key) throws Exception
-    {
-        Object xMark =
-            m_xDocFactory.createInstance("com.sun.star.text.DocumentIndexMark");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xMark);
-        XPropertySet xPropSet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, xMark);
-        xPropSet.setPropertyValue("PrimaryKey", key);
-        return xContent;
-    }
-
-    void insertHyperlink(XTextCursor xCursor, String url) throws Exception
-    {
-        XPropertySet xPropSet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, xCursor);
-        xPropSet.setPropertyValue("HyperLinkURL", url);
-    }
-
-    void insertRuby(XTextCursor xCursor, String rubytext) throws Exception
-    {
-        XPropertySet xPropSet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, xCursor);
-        xPropSet.setPropertyValue("RubyText", rubytext);
-    }
-
-    void insertMeta(XTextCursor xCursor, StringPair xmlid)
-        throws Exception
-    {
-        XTextContent xContent = makeMeta();
-        xContent.attach(xCursor);
-        XMetadatable xMetadatable = (XMetadatable)
-            UnoRuntime.queryInterface(XMetadatable.class, xContent);
-        xMetadatable.setMetadataReference(xmlid);
-    }
-
-    XTextContent makeMeta() throws Exception
-    {
-        Object xMeta = m_xDocFactory.createInstance(
-                "com.sun.star.text.InContentMetadata");
-        XTextContent xContent = (XTextContent)
-            UnoRuntime.queryInterface(XTextContent.class, xMeta);
-        return xContent;
-    }
-
-    void insertMetaField(XTextCursor xCursor, StringPair xmlid)
-        throws Exception
-    {
-        XTextContent xContent = makeMetaField();
-        xContent.attach(xCursor);
-        XMetadatable xMetadatable = (XMetadatable)
-            UnoRuntime.queryInterface(XMetadatable.class, xContent);
-        xMetadatable.setMetadataReference(xmlid);
-    }
-
-    XTextField makeMetaField() throws Exception
-    {
-        Object xMeta = m_xDocFactory.createInstance(
-                "com.sun.star.text.textfield.MetadataField");
-        XTextField xContent = (XTextField)
-            UnoRuntime.queryInterface(XTextField.class, xMeta);
-        return xContent;
-    }
-
-}
-
-class TreeInserter extends Inserter
-{
-    private Map<String, XTextRange> m_BookmarkStarts;
-    private Map<String, XTextRange> m_ReferenceMarkStarts;
-    private Map<String, XTextRange> m_DocumentIndexMarkStarts;
-    private List<Pair<XTextRange, FrameNode>> m_FrameHints;
-
-    TreeInserter(XTextDocument xDoc)
-    {
-        super(xDoc);
-        m_BookmarkStarts = new HashMap<String, XTextRange>();
-        m_ReferenceMarkStarts = new HashMap<String, XTextRange>();
-        m_DocumentIndexMarkStarts = new HashMap<String, XTextRange>();
-        m_FrameHints = new ArrayList<Pair<XTextRange, FrameNode>>();
-    }
-
-    void insertTree(TreeNode tree) throws Exception
-    {
-        if (!tree.getType().equals("__ROOT__"))
-            throw new RuntimeException("insertTree: test error: no root");
-        initParagraph();
-        insertChildren(tree.createEnumeration());
-        for (int i = 0; i < m_FrameHints.size(); ++i) {
-            Pair<XTextRange, FrameNode> p = m_FrameHints.get(i);
-            insertFrame(p.First, p.Second.getName(), p.Second.getAnchor());
-        }
-    }
-
-    void insertChildren(TreeNodeEnum children) throws Exception
-    {
-        while (children.hasNext()) {
-            m_xCursor.gotoEndOfParagraph(false);
-            TreeNode node = children.next();
-            String type = node.getType();
-            if (type.equals("Bookmark")) {
-                BookmarkNode bkmk = (BookmarkNode) node;
-                String name = bkmk.getName();
-                StringPair id = bkmk.getXmlId();
-                if (bkmk.isPoint()) {
-                    insertBookmark(m_xCursor, name, id);
-                } else if (bkmk.isStart()) {
-                    m_BookmarkStarts.put(name, m_xCursor.getStart());
-                } else {
-                    XTextRange xRange = m_BookmarkStarts.get(name);
-                    XParagraphCursor xCursor = mkCursor(xRange);
-                    insertBookmark(xCursor, name, id);
-                }
-            } else if (type.equals("ReferenceMark")) {
-                ReferenceMarkNode mark = (ReferenceMarkNode) node;
-                String name = mark.getName();
-                if (mark.isPoint()) {
-                    insertReferenceMark(m_xCursor, name);
-                } else if (mark.isStart()) {
-                    m_ReferenceMarkStarts.put(name, m_xCursor.getStart());
-                } else {
-                    XTextRange xRange = m_ReferenceMarkStarts.get(name);
-                    XParagraphCursor xCursor = mkCursor(xRange);
-                    insertReferenceMark(xCursor, name);
-                }
-            } else if (type.equals("DocumentIndexMark")) {
-                DocumentIndexMarkNode mark = (DocumentIndexMarkNode) node;
-                String name = mark.getName();
-                if (mark.isPoint()) {
-                    insertDocumentIndexMark(m_xCursor, name);
-                } else if (mark.isStart()) {
-                    m_DocumentIndexMarkStarts.put(name, m_xCursor.getStart());
-                } else {
-                    XTextRange xRange = m_DocumentIndexMarkStarts.get(name);
-                    XParagraphCursor xCursor = mkCursor(xRange);
-                    insertDocumentIndexMark(xCursor, name);
-                }
-            } else if (type.equals("Hyperlink")) {
-                HyperlinkNode href = (HyperlinkNode) node;
-                XTextRange xRange = m_xCursor.getStart();
-                insertChildren(href.createEnumeration());
-                XParagraphCursor xCursor = mkCursor(xRange);
-                insertHyperlink(xCursor, href.getURL());
-            } else if (type.equals("Ruby")) {
-                RubyNode ruby = (RubyNode) node;
-                XTextRange xRange = m_xCursor.getStart();
-                insertChildren(ruby.createEnumeration());
-                XParagraphCursor xCursor = mkCursor(xRange);
-                insertRuby(xCursor, ruby.getRubyText());
-            } else if (type.equals("InContentMetadata")) {
-                MetaNode meta = (MetaNode) node;
-                XTextRange xRange = m_xCursor.getStart();
-                insertChildren(meta.createEnumeration());
-                XParagraphCursor xCursor = mkCursor(xRange);
-                insertMeta(xCursor, meta.getXmlId());
-            } else if (type.equals("MetadataField")) {
-                MetaFieldNode meta = (MetaFieldNode) node;
-                XTextRange xRange = m_xCursor.getStart();
-                insertChildren(meta.createEnumeration());
-                XParagraphCursor xCursor = mkCursor(xRange);
-                insertMetaField(xCursor, meta.getXmlId());
-            } else if (type.equals("Text")) {
-                TextNode text = (TextNode) node;
-                insertText(m_xCursor, text.getContent());
-            } else if (type.equals("TextField")) {
-                TextFieldNode field = (TextFieldNode) node;
-                insertTextField(m_xCursor, field.getContent());
-            } else if (type.equals("Footnote")) {
-                FootnoteNode note = (FootnoteNode) node;
-                insertFootnote(m_xCursor, note.getLabel());
-            } else if (type.equals("Frame")) {
-                FrameNode frame = (FrameNode) node;
-                if (frame.getAnchor() == AT_CHARACTER) {
-                    m_FrameHints.add( new Pair(m_xCursor.getStart(), frame) );
-                } else {
-                    insertFrame(m_xCursor, frame.getName(), frame.getAnchor());
-                }
-            } else if (type.equals("ControlCharacter")) {
-                ControlCharacterNode cchar = (ControlCharacterNode) node;
-                insertControlCharacter(m_xCursor, cchar.getChar());
-            } else if (type.equals("SoftPageBreak")) {
-                SoftPageBreakNode spbk = (SoftPageBreakNode) node;
-                throw new RuntimeException("sorry, cannot test SoftPageBreak");
-            } else {
-                throw new RuntimeException("unexpected type: " + type);
-            }
-        }
-    }
-
-    XParagraphCursor mkCursor(XTextRange xRange)
-    {
-        XTextCursor xCursor = m_xText.createTextCursorByRange(xRange);
-        XParagraphCursor xParaCursor = (XParagraphCursor)
-            UnoRuntime.queryInterface(XParagraphCursor.class, xCursor);
-        xParaCursor.gotoEndOfParagraph(true);
-        return xParaCursor;
-    }
-}
-
-
-// FIXME: this does not account for inserted dummy characters!
-class RangeInserter extends Inserter
-{
-    RangeInserter(XTextDocument xDoc) throws Exception
-    { super(xDoc); initParagraph(); }
-
-    /*
-    void insertText(int pos, String text)
-    {
-        m_xCursor.gotoStartOfParagraph(false);
-        m_xCursor.goRight((short) pos, false);
-        insertText(m_xCursor, text);
-    }
-    */
-
-    void insertRange(Range range) throws Exception
-    {
-        m_xCursor.gotoStartOfParagraph(false);
-        m_xCursor.goRight(range.getStart(), false);
-        m_xCursor.goRight(range.getExtent(), true);
-        insertNode(m_xCursor, range.getNode());
-    }
-
-    void insertNode(XParagraphCursor xCursor, TreeNode node) throws Exception
-    {
-        String type = node.getType();
-        if (type.equals("Bookmark")) {
-            BookmarkNode bkmk = (BookmarkNode) node;
-            if (bkmk.isPoint()) throw new RuntimeException("range only");
-            insertBookmark(xCursor, bkmk.getName(), bkmk.getXmlId());
-        } else if (type.equals("ReferenceMark")) {
-            ReferenceMarkNode mark = (ReferenceMarkNode) node;
-            if (mark.isPoint()) throw new RuntimeException("range only");
-            insertReferenceMark(xCursor, mark.getName());
-        } else if (type.equals("DocumentIndexMark")) {
-            DocumentIndexMarkNode mark = (DocumentIndexMarkNode) node;
-            if (mark.isPoint()) throw new RuntimeException("range only");
-            insertDocumentIndexMark(xCursor, mark.getName());
-        } else if (type.equals("Hyperlink")) {
-            HyperlinkNode href = (HyperlinkNode) node;
-            insertHyperlink(xCursor, href.getURL());
-        } else if (type.equals("Ruby")) {
-            RubyNode ruby = (RubyNode) node;
-            insertRuby(xCursor, ruby.getRubyText());
-        } else if (type.equals("InContentMetadata")) {
-            MetaNode meta = (MetaNode) node;
-            insertMeta(xCursor, meta.getXmlId());
-        } else if (type.equals("MetadataField")) {
-            MetaFieldNode meta = (MetaFieldNode) node;
-            insertMetaField(xCursor, meta.getXmlId());
-        } else if (type.equals("Text")) {
-            TextNode text = (TextNode) node;
-            insertText(xCursor, text.getContent());
-        } else if (type.equals("TextField")) {
-            TextFieldNode field = (TextFieldNode) node;
-            insertTextField(m_xCursor, field.getContent());
-        } else if (type.equals("Footnote")) {
-            FootnoteNode note = (FootnoteNode) node;
-            insertFootnote(m_xCursor, note.getLabel());
-        } else if (type.equals("Frame")) {
-            FrameNode frame = (FrameNode) node;
-            insertFrame(xCursor, frame.getName(), frame.getAnchor());
-        } else if (type.equals("ControlCharacter")) {
-            ControlCharacterNode cchar = (ControlCharacterNode) node;
-            insertControlCharacter(m_xCursor, cchar.getChar());
-        } else if (type.equals("SoftPageBreak")) {
-            throw new RuntimeException("sorry, cannot test SoftPageBreak");
-        } else {
-            throw new RuntimeException("unexpected type: " + type);
-        }
-    }
-}
-
-
-//----------------------------------------------------------------------
-
-public class TextPortionEnumerationTest extends ComplexTestCase
-{
-    private XMultiServiceFactory m_xMSF = null;
-    private XComponentContext m_xContext = null;
-    private XTextDocument m_xDoc = null;
-    private String m_TmpDir = null;
-
-    private int m_Count = 1;
-
-//    public String[] getTestMethodNames() { return new String[] { "testLoadStore" }; }
-    public String[] getTestMethodNames() {
-        return new String[] {
-            "testText",
-            "testTextField",
-//            "testControlChar",
-//            "testSoftPageBreak",
-            "testFootnote",
-            "testFrameAs",
-            "testFrameAt",
-            "testBookmarkPoint",
-            "testBookmark",
-            "testBookmarkPointXmlId",
-            "testBookmarkXmlId",
-            "testRefmarkPoint",
-            "testRefmark",
-            "testToxmarkPoint",
-            "testToxmark",
-            "testHyperlink",
-            "testHyperlinkEmpty",
-            "testRuby",
-            "testRubyEmpty",
-            "testMeta",
-            "testMetaEmpty",
-            "testMetaField",
-            "testMetaFieldEmpty",
-            "testBookmark1",
-            "testBookmark2",
-            "testRefMark2",
-            "testRefMark3",
-            "testToxMark2",
-            "testToxMark3",
-            "testMarks1",
-            "testMarks2",
-            "testMarks3",
-            "testFrameMark1",
-            "testFrameMark2",
-            "testFrameMark3",
-            "testFrameMark4",
-            "testFrames1",
-            "testFrames2",
-            "testFrames3",
-            "testFrames4",
-            "testFrames5",
-            "testRubyHyperlink1",
-            "testRubyHyperlink2",
-            "testEnd1",
-            "testEnd2",
-            "testEnd3",
-            "testEnd4",
-            "testEnd5",
-            "testEmpty1",
-            "testEmpty2",
-            "testEmpty3",
-            "test1",
-            "testRange1",
-            "testRangeHyperlinkHyperlink",
-            "testRangeHyperlinkRuby",
-            "testRangeRubyHyperlink",
-            "testRangeRubyRuby",
-            "testRangeHyperlinkMeta",
-            "testRangeRubyMeta",
-            "testRangeMetaHyperlink",
-            "testRangeMetaRuby",
-            "testRangeMetaMeta",
-            "testRange2",
-            "testRange3",
-            "testRange4",
-            "testRange5",
-            "testRange6",
-            "testRange7",
-            "testMetaXText",
-            "testMetaXTextCursor",
-            "testMetaXTextAttachToxMark",
-            "testMetaXTextAttachRefMark",
-            "testMetaXTextAttachTextField",
-            "testMetaXTextAttachFootnote",
-            "testMetaXTextAttachMeta",
-            "testMetaFieldXTextField",
-            "testMetaFieldXPropertySet",
-            "testLoadStore",
-        };
-    }
-
-    public void before() throws Exception
-    {
-        m_xMSF = (XMultiServiceFactory) param.getMSF();
-        XPropertySet xPropertySet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, m_xMSF);
-        Object defaultCtx = xPropertySet.getPropertyValue("DefaultContext");
-        m_xContext = (XComponentContext)
-            UnoRuntime.queryInterface(XComponentContext.class, defaultCtx);
-        assure("could not get component context.", m_xContext != null);
-        m_xDoc = util.WriterTools.createTextDoc(m_xMSF);
-        m_TmpDir = util.utils.getOfficeTemp/*Dir*/(m_xMSF);
-        log.println("tempdir: " + m_TmpDir);
-    }
-
-    public void after()
-    {
-        if (m_xDoc != null) {
-            util.DesktopTools.closeDoc(m_xDoc);
-            m_xDoc = null;
-        }
-    }
-
-    public void testText() throws Exception
-    {
-        TreeNode root = new TreeNode();
-        TreeNode text = new TextNode("abc");
-        root.appendChild(text);
-        doTest(root);
-    }
-
-    public void testTextField() throws Exception
-    {
-        String name = mkName("ruby");
-        TreeNode root = new TreeNode();
-        TreeNode txtf = new TextFieldNode("abc");
-        root.appendChild(txtf);
-        doTest(root);
-    }
-
-    public void testControlChar() throws Exception
-    {
-//FIXME this is converted to a text portion: ControlCharacter is obsolete
-        TreeNode root = new TreeNode();
-        TreeNode cchr = new ControlCharacterNode(HARD_HYPHEN);
-        root.appendChild(cchr);
-        doTest(root);
-    }
-
-    public void testSoftPageBreak() throws Exception
-    {
-//FIXME: insert a soft page break: not done
-        TreeNode root = new TreeNode();
-        TreeNode spbk = new SoftPageBreakNode();
-        TreeNode text = new TextNode("abc");
-        root.appendChild(spbk);
-        root.appendChild(text);
-        doTest(root);
-    }
-
-    public void testFootnote() throws Exception
-    {
-        String name = mkName("ftn");
-        TreeNode root = new TreeNode();
-        TreeNode ftnd = new FootnoteNode(name);
-        root.appendChild(ftnd);
-        doTest(root);
-    }
-
-    public void testFrameAs() throws Exception
-    {
-        String name = mkName("frame");
-        TreeNode root = new TreeNode();
-        TreeNode fram = new FrameNode(name, AS_CHARACTER);
-        root.appendChild(fram);
-        doTest(root);
-    }
-
-    public void testFrameAt() throws Exception
-    {
-        String name = mkName("frame");
-        TreeNode root = new TreeNode();
-//        TreeNode text = new TextNode(""); // necessary?
-        TreeNode fram = new FrameNode(name, AT_CHARACTER);
-//        root.appendChild(text);
-        root.appendChild(fram);
-        doTest(root);
-    }
-
-    public void testBookmarkPoint() throws Exception
-    {
-        String name = mkName("mark");
-        TreeNode root = new TreeNode();
-        TreeNode bkmk = new BookmarkNode(name);
-        TreeNode text = new TextNode("abc");
-        root.appendChild(bkmk);
-        root.appendChild(text);
-        doTest(root);
-    }
-
-    public void testBookmark() throws Exception
-    {
-        String name = mkName("mark");
-        TreeNode root = new TreeNode();
-        TreeNode bkm1 = new BookmarkStartNode(name);
-        TreeNode text = new TextNode("abc");
-        TreeNode bkm2 = new BookmarkEndNode(name);
-        root.appendChild(bkm1);
-        root.appendChild(text);
-        root.appendChild(bkm2);
-        doTest(root);
-    }
-
-    public void testBookmarkPointXmlId() throws Exception
-    {
-        String name = mkName("mark");
-        StringPair id = mkId("id");
-        TreeNode root = new TreeNode();
-        TreeNode bkmk = new BookmarkNode(name, id);
-        TreeNode text = new TextNode("abc");
-        root.appendChild(bkmk);
-        root.appendChild(text);
-        doTest(root);
-    }
-
-    public void testBookmarkXmlId() throws Exception
-    {
-        String name = mkName("mark");
-        StringPair id = mkId("id");
-        TreeNode root = new TreeNode();
-        TreeNode bkm1 = new BookmarkStartNode(name, id);
-        TreeNode text = new TextNode("abc");
-        TreeNode bkm2 = new BookmarkEndNode(name, id);
-        root.appendChild(bkm1);
-        root.appendChild(text);
-        root.appendChild(bkm2);
-        doTest(root);
-    }
-
-    public void testRefmarkPoint() throws Exception
-    {
-        String name = mkName("refmark");
-        TreeNode root = new TreeNode();
-        TreeNode rfmk = new ReferenceMarkNode(name);
-        TreeNode text = new TextNode("abc");
-        root.appendChild(rfmk);
-        root.appendChild(text);
-        doTest(root);
-    }
-
-    public void testRefmark() throws Exception
-    {
-        String name = mkName("refmark");
-        TreeNode root = new TreeNode();
-        TreeNode rfm1 = new ReferenceMarkStartNode(name);
-        TreeNode text = new TextNode("abc");
-        TreeNode rfm2 = new ReferenceMarkEndNode(name);
-        root.appendChild(rfm1);
-        root.appendChild(text);
-        root.appendChild(rfm2);
-        doTest(root);
-    }
-
-    public void testToxmarkPoint() throws Exception
-    {
-        String name = mkName("toxmark");
-        TreeNode root = new TreeNode();
-        TreeNode txmk = new DocumentIndexMarkNode(name);
-        TreeNode text = new TextNode("abc");
-        root.appendChild(txmk);
-        root.appendChild(text);
-        doTest(root);
-    }
-
-    public void testToxmark() throws Exception
-    {
-        String name = mkName("toxmark");
-        TreeNode root = new TreeNode();
-        TreeNode txm1 = new DocumentIndexMarkStartNode(name);
-        TreeNode text = new TextNode("abc");
-        TreeNode txm2 = new DocumentIndexMarkEndNode(name);
-        root.appendChild(txm1);
-        root.appendChild(text);
-        root.appendChild(txm2);
-        doTest(root);
-    }
-
-    public void testHyperlink() throws Exception
-    {
-        String name = mkName("url");
-        TreeNode root = new TreeNode();
-        TreeNode href = new HyperlinkNode(name);
-        TreeNode text = new TextNode("abc");
-        href.appendChild(text);
-        root.appendChild(href);
-        doTest(root);
-    }
-
-    public void testHyperlinkEmpty() throws Exception
-    {
-        String name = mkName("url");
-        TreeNode root = new TreeNode();
-        TreeNode href = new HyperlinkNode(name);
-        TreeNode text = new TextNode("");
-        href.appendChild(text);
-        root.appendChild(href);
-        doTest(root);
-    }
-
-    public void testRuby() throws Exception
-    {
-        String name = mkName("ruby");
-        TreeNode root = new TreeNode();
-        TreeNode ruby = new RubyNode(name);
-        TreeNode text = new TextNode("abc");
-        ruby.appendChild(text);
-        root.appendChild(ruby);
-        doTest(root);
-    }
-
-    public void testRubyEmpty() throws Exception
-    {
-        // BUG: #i91534#
-        String name = mkName("ruby");
-        TreeNode root = new TreeNode();
-        TreeNode ruby = new RubyNode(name);
-        root.appendChild(ruby);
-        doTest(root);
-    }
-
-    public void testMeta() throws Exception
-    {
-        StringPair id = new StringPair("content.xml", mkName("id"));
-        TreeNode root = new TreeNode();
-        TreeNode meta = new MetaNode(id);
-        TreeNode text = new TextNode("abc");
-        root.appendChild(new TextNode("123"));
-        meta.appendChild(text);
-        root.appendChild(meta);
-        doTest(root);
-    }
-
-    public void testMetaEmpty() throws Exception
-    {
-        StringPair id = new StringPair("content.xml", mkName("id"));
-        TreeNode root = new TreeNode();
-        TreeNode meta = new MetaNode(id);
-//        TreeNode text = new TextNode("");
-//        meta.appendChild(text);
-        root.appendChild(meta);
-        doTest(root);
-    }
-
-    public void testMetaField() throws Exception
-    {
-        StringPair id = new StringPair("content.xml", mkName("id"));
-        TreeNode root = new TreeNode();
-        TreeNode meta = new MetaFieldNode(id);
-        TreeNode text = new TextNode("abc");
-        root.appendChild(new TextNode("123"));
-        meta.appendChild(text);
-        root.appendChild(meta);
-        doTest(root);
-    }
-
-    public void testMetaFieldEmpty() throws Exception
-    {
-        StringPair id = new StringPair("content.xml", mkName("id"));
-        TreeNode root = new TreeNode();
-        TreeNode meta = new MetaFieldNode(id);
-//        TreeNode text = new TextNode("");
-//        meta.appendChild(text);
-        root.appendChild(meta);
-        doTest(root);
-    }
-
-    public void testBookmark1() throws Exception
-    {
-        String name1 = mkName("mark");
-        String name2 = mkName("mark");
-        String name3 = mkName("mark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkStartNode(name1) );
-        root.appendChild( new BookmarkNode(name2) );
-        root.appendChild( new BookmarkStartNode(name3) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkEndNode(name1) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new BookmarkEndNode(name3) );
-        doTest(root);
-    }
-
-    public void testBookmark2() throws Exception
-    {
-        String name1 = mkName("mark");
-        String name2 = mkName("mark");
-        String name3 = mkName("mark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkStartNode(name1) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkNode(name2) );
-        root.appendChild( new BookmarkStartNode(name3) );
-        root.appendChild( new BookmarkEndNode(name1) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new BookmarkEndNode(name3) );
-        doTest(root);
-    }
-
-    public void testRefMark2() throws Exception
-    {
-        String name1 = mkName("refmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new ReferenceMarkStartNode(name1) );
-        root.appendChild( new TextNode("abc") );
-        // BUG: #i102541# (this is actually not unoportenum's fault)
-        root.appendChild( new ReferenceMarkEndNode(name1) );
-        root.appendChild( new TextNode("de") );
-        doTest(root);
-    }
-
-    public void testRefMark3() throws Exception
-    {
-        String name1 = mkName("refmark");
-        String name2 = mkName("refmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new ReferenceMarkStartNode(name1) );
-        root.appendChild( new ReferenceMarkStartNode(name2) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new ReferenceMarkEndNode(name2) );
-        root.appendChild( new ReferenceMarkEndNode(name1) );
-        root.appendChild( new TextNode("de") );
-        doTest(root);
-    }
-
-    public void testToxMark2() throws Exception
-    {
-        String name1 = mkName("toxmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new DocumentIndexMarkStartNode(name1) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new DocumentIndexMarkEndNode(name1) );
-        root.appendChild( new TextNode("de") );
-        doTest(root);
-    }
-
-    public void testToxMark3() throws Exception
-    {
-        String name1 = mkName("toxmark");
-        String name2 = mkName("toxmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new DocumentIndexMarkStartNode(name1) );
-        root.appendChild( new DocumentIndexMarkStartNode(name2) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new DocumentIndexMarkEndNode(name2) );
-        root.appendChild( new DocumentIndexMarkEndNode(name1) );
-        root.appendChild( new TextNode("de") );
-        doTest(root);
-    }
-
-    public void testMarks1() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("toxmark");
-        String name3 = mkName("refmark");
-        String name4 = mkName("toxmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkStartNode(name1) );
-        root.appendChild( new DocumentIndexMarkNode(name2) );
-        root.appendChild( new ReferenceMarkStartNode(name3) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkEndNode(name1) );
-        root.appendChild( new DocumentIndexMarkStartNode(name4) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new DocumentIndexMarkEndNode(name4) );
-        root.appendChild( new ReferenceMarkEndNode(name3) );
-        doTest(root);
-    }
-
-    public void testMarks2() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("refmark");
-        String name3 = mkName("refmark");
-        String name4 = mkName("toxmark");
-        String name5 = mkName("refmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkStartNode(name1) );
-        root.appendChild( new ReferenceMarkNode(name2) );
-        root.appendChild( new ReferenceMarkStartNode(name3) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new DocumentIndexMarkStartNode(name4) );
-        root.appendChild( new ReferenceMarkStartNode(name5) );
-        // BUG: #i102541# (this is actually not unoportenum's fault)
-        root.appendChild( new ReferenceMarkEndNode(name3) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new DocumentIndexMarkEndNode(name4) );
-        root.appendChild( new BookmarkEndNode(name1) );
-        root.appendChild( new ReferenceMarkEndNode(name5) );
-        doTest(root);
-    }
-
-    public void testMarks3() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("refmark");
-        String name3 = mkName("refmark");
-        String name4 = mkName("toxmark");
-        String name5 = mkName("refmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkStartNode(name1) );
-        root.appendChild( new DocumentIndexMarkNode(name2) );
-        root.appendChild( new DocumentIndexMarkStartNode(name3) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new ReferenceMarkStartNode(name4) );
-        root.appendChild( new DocumentIndexMarkStartNode(name5) );
-        root.appendChild( new DocumentIndexMarkEndNode(name3) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new ReferenceMarkEndNode(name4) );
-        root.appendChild( new BookmarkEndNode(name1) );
-        root.appendChild( new DocumentIndexMarkEndNode(name5) );
-        doTest(root);
-    }
-
-    public void testFrameMark1() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkNode(name1) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new FrameNode(name2, AS_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testFrameMark2() throws Exception
-    {
-        // BUG: #i98530#
-        String name1 = mkName("bookmark");
-        String name2 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkNode(name1) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new FrameNode(name2, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testFrameMark3() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("bookmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new FrameNode(name1, AS_CHARACTER) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new BookmarkNode(name2) );
-        doTest(root);
-    }
-
-    public void testFrameMark4() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("bookmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new FrameNode(name1, AT_CHARACTER) );
-        root.appendChild( new TextNode("de") );
-        root.appendChild( new BookmarkNode(name2) );
-        doTest(root);
-    }
-
-    public void testFrames1() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("frame");
-        String name3 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new FrameNode(name1, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name2, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name3, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testFrames2() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("frame");
-        String name3 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new FrameNode(name1, AS_CHARACTER) );
-        root.appendChild( new FrameNode(name2, AS_CHARACTER) );
-        root.appendChild( new FrameNode(name3, AS_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testFrames3() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("frame");
-        String name3 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new FrameNode(name1, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name2, AS_CHARACTER) );
-        root.appendChild( new FrameNode(name3, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testFrames4() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("frame");
-        String name3 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new FrameNode(name1, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name2, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name3, AS_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testFrames5() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("frame");
-        String name3 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new FrameNode(name1, AS_CHARACTER) );
-        root.appendChild( new FrameNode(name2, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name3, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testRubyHyperlink1() throws Exception
-    {
-        String name1 = mkName("ruby");
-        String name2 = mkName("url");
-        TreeNode root = new TreeNode();
-        TreeNode ruby = new RubyNode(name1);
-        TreeNode href = new HyperlinkNode(name2);
-        href.appendChild( new TextNode("abc") );
-        ruby.appendChild(href);
-        root.appendChild(ruby);
-        doTest(root);
-    }
-
-    public void testRubyHyperlink2() throws Exception
-    {
-        String name1 = mkName("url");
-        String name2 = mkName("ruby");
-        TreeNode root = new TreeNode();
-        TreeNode href = new HyperlinkNode(name1);
-        TreeNode ruby = new RubyNode(name2);
-        ruby.appendChild( new TextNode("abc") );
-        href.appendChild(ruby);
-        root.appendChild(href);
-        doTest(root);
-    }
-
-    public void testEnd1() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("toxmark");
-        String name3 = mkName("refmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkNode(name1) );
-        root.appendChild( new DocumentIndexMarkNode(name2) );
-        root.appendChild( new ReferenceMarkNode(name3) );
-        doTest(root);
-    }
-
-    public void testEnd2() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("frame");
-        String name3 = mkName("refmark");
-        String name4 = mkName("frame");
-        String name5 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new BookmarkNode(name1) );
-        root.appendChild( new FrameNode(name2, AT_CHARACTER) );
-        root.appendChild( new ReferenceMarkNode(name3) );
-        root.appendChild( new FrameNode(name4, AT_CHARACTER) );
-        root.appendChild( new FrameNode(name5, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testEnd3() throws Exception
-    {
-        String name1 = mkName("ftn");
-        String name2 = mkName("toxmark");
-        TreeNode root = new TreeNode();
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new FootnoteNode(name1) );
-        root.appendChild( new DocumentIndexMarkNode(name2) );
-        doTest(root);
-    }
-
-    public void testEnd4() throws Exception
-    {
-        String name1 = mkName("bookmark");
-        String name2 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkStartNode(name1) );
-        root.appendChild( new TextNode("abc") );
-        root.appendChild( new FrameNode(name2, AS_CHARACTER) );
-        root.appendChild( new BookmarkEndNode(name1) );
-        doTest(root);
-    }
-
-    public void testEnd5() throws Exception
-    {
-        String name1 = mkName("refmark");
-        String name2 = mkName("ruby");
-        TreeNode root = new TreeNode();
-        root.appendChild( new ReferenceMarkStartNode(name1) );
-        root.appendChild( new TextNode("abc") );
-        TreeNode ruby = new RubyNode(name2);
-        ruby.appendChild( new TextFieldNode("de") );
-        root.appendChild(ruby);
-        root.appendChild( new ReferenceMarkEndNode(name1) );
-        doTest(root);
-    }
-
-    public void testEmpty1() throws Exception
-    {
-        String name1 = mkName("refmark");
-        String name2 = mkName("toxmark");
-        String name3 = mkName("bookmark");
-        String name4 = mkName("frame");
-        String name7 = mkName("refmark");
-        String name8 = mkName("toxmark");
-        String name9 = mkName("bookmark");
-        String nameA = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new ReferenceMarkNode(name1) );
-        root.appendChild( new DocumentIndexMarkNode(name2) );
-        root.appendChild( new BookmarkNode(name3) );
-        root.appendChild( new FrameNode(name4, AT_CHARACTER) );
-        root.appendChild( new ReferenceMarkNode(name7) );
-        root.appendChild( new DocumentIndexMarkNode(name8) );
-        root.appendChild( new BookmarkNode(name9) );
-        root.appendChild( new FrameNode(nameA, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testEmpty2() throws Exception
-    {
-        String name3 = mkName("bookmark");
-        String name4 = mkName("frame");
-        String name9 = mkName("bookmark");
-        String nameA = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new BookmarkNode(name3) );
-        root.appendChild( new FrameNode(name4, AT_CHARACTER) );
-        root.appendChild( new BookmarkNode(name9) );
-        root.appendChild( new FrameNode(nameA, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void testEmpty3() throws Exception
-    {
-        String name1 = mkName("refmark");
-        String name2 = mkName("toxmark");
-        String name3 = mkName("bookmark");
-        String name4 = mkName("frame");
-        String name5 = mkName("url");
-        String name6 = mkName("ruby");
-        String name7 = mkName("refmark");
-        String name8 = mkName("toxmark");
-        String name9 = mkName("bookmark");
-        String nameA = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new ReferenceMarkNode(name1) );
-        root.appendChild( new DocumentIndexMarkNode(name2) );
-        root.appendChild( new BookmarkNode(name3) );
-        root.appendChild( new FrameNode(name4, AT_CHARACTER) );
-        /* currently empty hyperlinks may get eaten...
-        TreeNode href = new HyperlinkNode(name5);
-        href.appendChild( new TextNode("") );
-        root.appendChild(href);
-        */
-        TreeNode ruby = new RubyNode(name6);
-        root.appendChild(ruby);
-        root.appendChild( new ReferenceMarkNode(name7) );
-        root.appendChild( new DocumentIndexMarkNode(name8) );
-        root.appendChild( new BookmarkNode(name9) );
-        root.appendChild( new FrameNode(nameA, AT_CHARACTER) );
-        doTest(root);
-    }
-
-    public void test1() throws Exception
-    {
-        String name1 = mkName("frame");
-        String name2 = mkName("bookmark");
-        String name3 = mkName("ruby");
-        String name4 = mkName("ftn");
-        String name5 = mkName("frame");
-        TreeNode root = new TreeNode();
-        root.appendChild( new FrameNode(name1, AT_CHARACTER) );
-        root.appendChild( new BookmarkStartNode(name2) );
-        root.appendChild( new TextNode("abc") );
-        TreeNode ruby = new RubyNode(name3);
-        ruby.appendChild( new TextNode("de") );
-        ruby.appendChild( new FootnoteNode(name4) );
-        ruby.appendChild( new BookmarkEndNode(name2) );
-        root.appendChild(ruby);
-        root.appendChild( new TextNode("fg") );
-        root.appendChild( new FrameNode(name5, AT_CHARACTER) );
-        root.appendChild( new TextFieldNode("h") );
-        doTest(root);
-    }
-
-    /* some range tests for the insertion: these are for the current
-       API which treats hyperlinks and rubys not as entities, but as formatting
-       attributes; if these ever become entities, they should not be split!
-     */
-
-    public void testRange1() throws Exception
-    {
-        String name1 = mkName("url");
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("12345");
-        inserter.insertRange(new Range(0, 0, text));
-        TreeNode url1 = new HyperlinkNode(name1);
-        Range range1 = new Range(0, 5, url1);
-        inserter.insertRange(range1);
-        TreeNode root = new TreeNode();
-        root.appendChild( url1 );
-        url1.appendChild( text );
-        doTest(root, false);
-    }
-
-    public void testRangeHyperlinkHyperlink() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode url1 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(1, 4, url1) );
-        // overlap left
-        TreeNode url2 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(0, 2, url2) );
-        TreeNode root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( url1.dup().appendChild( new TextNode("34") ) )
-            .appendChild( new TextNode("56789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode url3 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(3, 7, url3) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( url1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( url3.dup().appendChild( new TextNode("4567") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // around
-        TreeNode url4 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(3, 7, url4) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( url1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( url4.dup().appendChild( new TextNode("4567") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // inside
-        TreeNode url5 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(4, 6, url5) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( url1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( url4.dup().appendChild( new TextNode("4") ) )
-            .appendChild( url5.dup().appendChild( new TextNode("56") ) )
-            .appendChild( url4.dup().appendChild( new TextNode("7") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // empty
-        TreeNode url6 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(7, 7, url6) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( url1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( url4.dup().appendChild( new TextNode("4") ) )
-            .appendChild( url5.dup().appendChild( new TextNode("56") ) )
-            .appendChild( url4.dup().appendChild( new TextNode("7") ) )
-// this one gets eaten, but we still need to test inserting it (#i106930#)
-//            .appendChild( url6.dup().appendChild( new TextNode("") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-    }
-
-    public void testRangeHyperlinkRuby() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode url1 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(1, 4, url1) );
-        // overlap left
-        TreeNode rby2 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 2, rby2) );
-        TreeNode root = new TreeNode()
-            .appendChild( rby2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( url1.dup().appendChild( new TextNode("34") ) )
-            .appendChild( new TextNode("56789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode rby3 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(3, 5, rby3) );
-        root = new TreeNode()
-            .appendChild( rby2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( url1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( rby3.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // around
-        TreeNode rby4 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(2, 3, rby4) );
-        root = new TreeNode()
-            .appendChild( rby2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( rby4.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("3") ) ) )
-            .appendChild( rby3.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // inside
-        TreeNode url5 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(6, 9, url5) );
-        TreeNode rby6 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(7, 8, rby6) );
-        root = new TreeNode()
-            .appendChild( rby2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( rby4.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("3") ) ) )
-            .appendChild( rby3.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6") )
-            .appendChild( url5.dup().appendChild( new TextNode("7") ) )
-            .appendChild( rby6.dup()
-                .appendChild( url5.dup().appendChild( new TextNode("8") ) ) )
-            .appendChild( url5.dup().appendChild( new TextNode("9") ) );
-        doTest(root, false);
-    }
-
-    public void testRangeRubyHyperlink() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode rby1 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(1, 6, rby1) );
-        // overlap left
-        TreeNode url2 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(0, 3, url2) );
-        TreeNode root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby1.dup()
-                .appendChild( url2.dup().appendChild( new TextNode("23") ) )
-                .appendChild( new TextNode("456") ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode url3 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(5, 7, url3) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby1.dup()
-                .appendChild( url2.dup().appendChild( new TextNode("23") ) )
-                .appendChild( new TextNode("45") )
-                .appendChild( url3.dup().appendChild( new TextNode("6") ) ) )
-            .appendChild( url3.dup().appendChild( new TextNode("7") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // around (not quite, due to API)
-        TreeNode url4 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(1, 8, url4) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby1.dup()
-                .appendChild( url4.dup()
-                    .appendChild( new TextNode("23456") ) ) )
-            .appendChild( url4.dup().appendChild( new TextNode("78") ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-        // inside
-        TreeNode url5 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(3, 5, url5) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby1.dup()
-                .appendChild( url4.dup()
-                    .appendChild( new TextNode("23") ) )
-                .appendChild( url5.dup()
-                    .appendChild( new TextNode("45") ) )
-                .appendChild( url4.dup()
-                    .appendChild( new TextNode("6") ) ) )
-            .appendChild( url4.dup().appendChild( new TextNode("78") ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-    }
-
-    public void testRangeRubyRuby() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode rby1 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(1, 4, rby1) );
-        // overlap left
-        TreeNode rby2 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 2, rby2) );
-        TreeNode root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( rby1.dup().appendChild( new TextNode("34") ) )
-            .appendChild( new TextNode("56789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode rby3 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(3, 7, rby3) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( rby1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( rby3.dup().appendChild( new TextNode("4567") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // around
-        TreeNode rby4 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(3, 7, rby4) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( rby1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( rby4.dup().appendChild( new TextNode("4567") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // inside
-        TreeNode rby5 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(4, 6, rby5) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("12") ) )
-            .appendChild( rby1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( rby4.dup().appendChild( new TextNode("4") ) )
-            .appendChild( rby5.dup().appendChild( new TextNode("56") ) )
-            .appendChild( rby4.dup().appendChild( new TextNode("7") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-    }
-
-    public void testRangeHyperlinkMeta() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode url1 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(1, 4, url1) );
-        // overlap left
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(0, 2, met2) );
-        TreeNode root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( url1.dup().appendChild( new TextNode("34") ) )
-            .appendChild( new TextNode("56789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode met3 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(4/*-1*/, 6/*-1*/, met3) );
-        root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( url1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( met3.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // around
-        TreeNode met4 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3/*-1*/, 4/*-1*/, met4) );
-        root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( met4.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("3") ) ) )
-            .appendChild( met3.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // inside
-        TreeNode url5 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(9/*-3*/, 12/*-3*/, url5) );
-        TreeNode met6 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(10/*-3*/, 11/*-3*/, met6) );
-        root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( url1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( met4.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("3") ) ) )
-            .appendChild( met3.dup()
-                .appendChild( url1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6") )
-            .appendChild( url5.dup().appendChild( new TextNode("7") ) )
-            .appendChild( met6.dup()
-                .appendChild( url5.dup().appendChild( new TextNode("8") ) ) )
-            .appendChild( url5.dup().appendChild( new TextNode("9") ) );
-        doTest(root, false);
-    }
-
-    public void testRangeRubyMeta() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode rby1 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(1, 4, rby1) );
-        // overlap left
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(0, 2, met2) );
-        TreeNode root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( rby1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( rby1.dup().appendChild( new TextNode("34") ) )
-            .appendChild( new TextNode("56789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode met3 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(4/*-1*/, 6/*-1*/, met3) );
-        root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( rby1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( rby1.dup().appendChild( new TextNode("3") ) )
-            .appendChild( met3.dup()
-                .appendChild( rby1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // around
-        TreeNode met4 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3/*-1*/, 4/*-1*/, met4) );
-        root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( rby1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( met4.dup()
-                .appendChild( rby1.dup().appendChild( new TextNode("3") ) ) )
-            .appendChild( met3.dup()
-                .appendChild( rby1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // inside
-        TreeNode rby5 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(9/*-3*/, 12/*-3*/, rby5) );
-        TreeNode met6 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(10/*-3*/, 11/*-3*/, met6) );
-        root = new TreeNode()
-            .appendChild( met2.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( rby1.dup().appendChild( new TextNode("2") ) ) )
-            .appendChild( met4.dup()
-                .appendChild( rby1.dup().appendChild( new TextNode("3") ) ) )
-            .appendChild( met3.dup()
-                .appendChild( rby1.dup().appendChild( new TextNode("4") ) )
-                .appendChild( new TextNode("5") ) )
-            .appendChild( new TextNode("6") )
-            .appendChild( rby5.dup()
-                .appendChild( new TextNode("7") )
-                .appendChild( met6.dup()
-                    .appendChild( new TextNode("8") ) )
-                .appendChild( new TextNode("9") ) );
-        doTest(root, false);
-    }
-
-    public void testRangeMetaHyperlink() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode met1 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(1, 6, met1) );
-        // overlap left
-        TreeNode url2 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(0, 4/*-1*/, url2) );
-        TreeNode root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( url2.dup().appendChild( new TextNode("23") ) )
-                .appendChild( new TextNode("456") ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode url3 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(6/*-1*/, 8/*-1*/, url3) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( url2.dup().appendChild( new TextNode("23") ) )
-                .appendChild( new TextNode("45") )
-                .appendChild( url3.dup().appendChild( new TextNode("6") ) ) )
-            .appendChild( url3.dup().appendChild( new TextNode("7") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-        // around (not quite, due to API)
-        TreeNode url4 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(1, 9/*-1*/, url4) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( url4.dup()
-                    .appendChild( new TextNode("23456") ) ) )
-            .appendChild( url4.dup().appendChild( new TextNode("78") ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-        // inside
-        TreeNode url5 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(4/*-1*/, 6/*-1*/, url5) );
-        root = new TreeNode()
-            .appendChild( url2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( url4.dup()
-                    .appendChild( new TextNode("23") ) )
-                .appendChild( url5.dup()
-                    .appendChild( new TextNode("45") ) )
-                .appendChild( url4.dup()
-                    .appendChild( new TextNode("6") ) ) )
-            .appendChild( url4.dup().appendChild( new TextNode("78") ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-    }
-
-    public void testRangeMetaRuby() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode met1 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(1, 5, met1) );
-        // overlap left
-        TreeNode rby2 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 3/*-1*/, rby2) );
-        TreeNode root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( rby2.dup().appendChild( new TextNode("2") ) )
-                .appendChild( new TextNode("345") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode rby3 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(5/*-1*/, 7/*-1*/, rby3) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( rby2.dup().appendChild( new TextNode("2") ) )
-                .appendChild( new TextNode("34") )
-                .appendChild( rby3.dup().appendChild( new TextNode("5") ) ) )
-            .appendChild( rby3.dup().appendChild( new TextNode("6") ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // around
-        TreeNode rby4 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(1, 7/*-1*/, rby4) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby4.dup()
-                .appendChild( met1.dup()
-                    .appendChild( new TextNode("2345") ) )
-                .appendChild( new TextNode("6") ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // inside
-        TreeNode met5 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(7/*-1*/, 9/*-1*/, met5) );
-        TreeNode rby6 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(9/*-2*/, 10/*-2*/, rby6) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby4.dup()
-                .appendChild( met1.dup()
-                    .appendChild( new TextNode("2345") ) )
-                .appendChild( new TextNode("6") ) )
-            .appendChild( met5.dup()
-                .appendChild( new TextNode("7") )
-                .appendChild( rby6.dup()
-                    .appendChild( new TextNode("8") ) ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-        // inside, with invalid range that includes the dummy char
-        TreeNode rby7 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(7/*-1*/, 9/*-2*/, rby7) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby4.dup()
-                .appendChild( met1.dup()
-                    .appendChild( new TextNode("2345") ) )
-                .appendChild( new TextNode("6") ) )
-            .appendChild( met5.dup()
-                .appendChild( rby7.dup()
-                    .appendChild( new TextNode("7") ) )
-                .appendChild( rby6.dup()
-                    .appendChild( new TextNode("8") ) ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-        // around, at same position as meta
-        TreeNode rby8 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(7/*-1*/, 10/*-2*/, rby8) );
-        root = new TreeNode()
-            .appendChild( rby2.dup().appendChild( new TextNode("1") ) )
-            .appendChild( rby4.dup()
-                .appendChild( met1.dup()
-                    .appendChild( new TextNode("2345") ) )
-                .appendChild( new TextNode("6") ) )
-            .appendChild( rby8.dup()
-                .appendChild( met5.dup()
-                    .appendChild( new TextNode("78") ) ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-    }
-
-    public void testRangeMetaMeta() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode met1 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3, 6, met1) );
-        // overlap left
-        TreeNode met2 = new MetaNode( mkId("id") );
-        try {
-            inserter.insertRange( new Range(0, 4, met2) );
-            assure("testRangeMetaMeta: overlap left allowed", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-        TreeNode root = new TreeNode()
-            .appendChild( new TextNode("123") )
-            .appendChild( met1.dup().appendChild( new TextNode("456") ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // overlap right
-        TreeNode met3 = new MetaNode( mkId("id") );
-        try {
-            inserter.insertRange( new Range(5/*-1*/, 8/*-1*/, met3) );
-            assure("testRangeMetaMeta: overlap right allowed", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-        root = new TreeNode()
-            .appendChild( new TextNode("123") )
-            .appendChild( met1.dup().appendChild( new TextNode("456") ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // around
-        TreeNode met4 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3, 7/*-1*/, met4) );
-        root = new TreeNode()
-            .appendChild( new TextNode("123") )
-            .appendChild( met4.dup()
-                .appendChild( met1.dup().appendChild( new TextNode("456") ) ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-        // inside
-        TreeNode met5 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(6/*-2*/, 8/*-2*/, met5) );
-        root = new TreeNode()
-            .appendChild( new TextNode("123") )
-            .appendChild( met4.dup()
-                .appendChild( met1.dup()
-                    .appendChild( new TextNode("4") )
-                    .appendChild( met5.dup()
-                        .appendChild( new TextNode("56") ) ) ) )
-            .appendChild( new TextNode("789") );
-        doTest(root, false);
-    }
-
-    public void testRange2() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode met1 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(1, 8, met1) );
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3/*-1*/, 8/*-1*/, met2) );
-        TreeNode met3 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(5/*-2*/, 8/*-2*/, met3) );
-        TreeNode root = new TreeNode()
-            .appendChild( new TextNode("1") )
-            .appendChild( met1.dup()
-                .appendChild( new TextNode("2") )
-                .appendChild( met2.dup()
-                    .appendChild( new TextNode("3") )
-                    .appendChild( met3.dup()
-                        .appendChild( new TextNode("456") ) )
-                    .appendChild( new TextNode("7") ) )
-                .appendChild( new TextNode("8") ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-        // split ruby at every meta start!
-        TreeNode rby4 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 7/*-3*/, rby4) );
-        root = new TreeNode()
-            .appendChild( rby4.dup()
-                .appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( rby4.dup()
-                    .appendChild( new TextNode("2") ) )
-                .appendChild( met2.dup()
-                    .appendChild( rby4.dup()
-                        .appendChild( new TextNode("3") ) )
-                    .appendChild( met3.dup()
-                        .appendChild( rby4.dup()
-                            .appendChild( new TextNode("4") ) )
-                        .appendChild( new TextNode("56") ) )
-                    .appendChild( new TextNode("7") ) )
-                .appendChild( new TextNode("8") ) )
-            .appendChild( new TextNode("9") );
-        doTest(root, false);
-        // split ruby at every meta end!
-        TreeNode rby5 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(8/*-3*/, 12/*-3*/, rby5) );
-        root = new TreeNode()
-            .appendChild( rby4.dup()
-                .appendChild( new TextNode("1") ) )
-            .appendChild( met1.dup()
-                .appendChild( rby4.dup()
-                    .appendChild( new TextNode("2") ) )
-                .appendChild( met2.dup()
-                    .appendChild( rby4.dup()
-                        .appendChild( new TextNode("3") ) )
-                    .appendChild( met3.dup()
-                        .appendChild( rby4.dup()
-                            .appendChild( new TextNode("4") ) )
-                        .appendChild( new TextNode("5") )
-                        .appendChild( rby5.dup()
-                            .appendChild( new TextNode("6") ) ) )
-                    .appendChild( rby5.dup()
-                        .appendChild( new TextNode("7") ) ) )
-                .appendChild( rby5.dup()
-                    .appendChild( new TextNode("8") ) ) )
-            .appendChild( rby5.dup()
-                .appendChild( new TextNode("9") ) );
-        doTest(root, false);
-    }
-
-    public void testRange3() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode rby1 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 9, rby1) );
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(2, 7, met2) );
-        TreeNode root = new TreeNode()
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("12") )
-                .appendChild( met2.dup()
-                    .appendChild( new TextNode("34567") ) )
-                .appendChild( new TextNode("89") ) );
-        doTest(root, false);
-        // overwrite outer ruby, split remains at inner meta!
-        TreeNode rby3 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(5/*-1*/, 6/*-1*/, rby3) );
-        root = new TreeNode()
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("12") ) )
-            .appendChild( met2.dup()
-                .appendChild( rby1.dup()
-                    .appendChild( new TextNode("34") ) )
-                .appendChild( rby3.dup()
-                    .appendChild( new TextNode("5") ) )
-                .appendChild( rby1.dup()
-                    .appendChild( new TextNode("67") ) ) )
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("89") ) );
-        doTest(root, false);
-    }
-
-    public void testRange4() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode rby1 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 9, rby1) );
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(1, 8, met2) );
-        TreeNode met3 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3/*-1*/, 8/*-1*/, met3) );
-        TreeNode met4 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(5/*-2*/, 8/*-2*/, met4) );
-        TreeNode root = new TreeNode()
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( met2.dup()
-                    .appendChild( new TextNode("2") )
-                    .appendChild( met3.dup()
-                        .appendChild( new TextNode("3") )
-                        .appendChild( met4.dup()
-                            .appendChild( new TextNode("456") ) )
-                        .appendChild( new TextNode("7") ) )
-                    .appendChild( new TextNode("8") ) )
-                .appendChild( new TextNode("9") ) );
-        doTest(root, false);
-        // overwrite outer ruby, split remains at every inner meta!
-        TreeNode rby5 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(7/*-3*/, 8/*-3*/, rby5) );
-        root = new TreeNode()
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("1") ) )
-            .appendChild( met2.dup()
-                .appendChild( rby1.dup()
-                    .appendChild( new TextNode("2") ) )
-                .appendChild( met3.dup()
-                    .appendChild( rby1.dup()
-                        .appendChild( new TextNode("3") ) )
-                    .appendChild( met4.dup()
-                        .appendChild( rby1.dup()
-                            .appendChild( new TextNode("4") ) )
-                        .appendChild( rby5.dup()
-                            .appendChild( new TextNode("5") ) )
-                        .appendChild( rby1.dup()
-                            .appendChild( new TextNode("6") ) ) )
-                    .appendChild( rby1.dup()
-                        .appendChild( new TextNode("7") ) ) )
-                .appendChild( rby1.dup()
-                    .appendChild( new TextNode("8") ) ) )
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("9") ) );
-        doTest(root, false);
-    }
-
-    public void testRange5() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode rby1 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(0, 9, rby1) );
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(1, 3, met2) );
-        TreeNode met3 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(5/*-1*/, 6/*-1*/, met3) );
-        TreeNode met4 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(8/*-2*/, 10/*-2*/, met4) );
-        TreeNode root = new TreeNode()
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("1") )
-                .appendChild( met2.dup().appendChild( new TextNode("23") ) )
-                .appendChild( new TextNode("4") )
-                .appendChild( met3.dup().appendChild( new TextNode("5") ) )
-                .appendChild( new TextNode("6") )
-                .appendChild( met4.dup().appendChild( new TextNode("78") ) )
-                .appendChild( new TextNode("9") ) );
-        doTest(root, false);
-        // overwrite outer ruby, but split at inner metas!
-        TreeNode rby5 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(3/*-1*/, 10/*-3*/, rby5) );
-        root = new TreeNode()
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("1") ) )
-            .appendChild( met2.dup()
-                .appendChild( rby1.dup()
-                    .appendChild( new TextNode("2") ) )
-                .appendChild( rby5.dup()
-                    .appendChild( new TextNode("3") ) ) )
-            .appendChild( rby5.dup()
-                .appendChild( new TextNode("4") )
-                .appendChild( met3.dup()
-                    .appendChild( new TextNode("5") ) )
-                .appendChild( new TextNode("6") ) )
-            .appendChild( met4.dup()
-                .appendChild( rby5.dup()
-                    .appendChild( new TextNode("7") ) )
-                .appendChild( rby1.dup()
-                    .appendChild( new TextNode("8") ) ) )
-            .appendChild( rby1.dup()
-                .appendChild( new TextNode("9") ) );
-        doTest(root, false);
-    }
-
-    public void testRange6() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode met1 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(1, 5, met1) );
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3/*-1*/, 6/*-1*/, met2) );
-        TreeNode met3 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(5/*-2*/, 7/*-2*/, met3) );
-        TreeNode root = new TreeNode()
-            .appendChild( new TextNode("1") )
-            .appendChild( met1.dup()
-                .appendChild( new TextNode("2") )
-                .appendChild( met2.dup()
-                    .appendChild( new TextNode("3") )
-                    .appendChild( met3.dup()
-                        .appendChild( new TextNode("45") ) ) ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // split at 3 metas, all at same position
-        TreeNode rby4 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(7/*-3*/, 10/*-3*/, rby4) );
-        root = new TreeNode()
-            .appendChild( new TextNode("1") )
-            .appendChild( met1.dup()
-                .appendChild( new TextNode("2") )
-                .appendChild( met2.dup()
-                    .appendChild( new TextNode("3") )
-                    .appendChild( met3.dup()
-                        .appendChild( new TextNode("4") )
-                        .appendChild( rby4.dup()
-                            .appendChild( new TextNode("5") ) ) ) ) )
-            .appendChild( rby4.dup()
-                .appendChild( new TextNode("67") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-    }
-
-    public void testRange7() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123456789");
-        inserter.insertRange( new Range(0, 0, text) );
-        TreeNode url1 = new HyperlinkNode( mkName("url") );
-        inserter.insertRange( new Range(1, 5, url1) );
-        TreeNode met2 = new MetaNode( mkId("id") );
-        inserter.insertRange( new Range(3, 5, met2) );
-        TreeNode root = new TreeNode()
-            .appendChild( new TextNode("1") )
-            .appendChild( url1.dup()
-                .appendChild( new TextNode("23") ) )
-            .appendChild( met2.dup()
-                .appendChild( url1.dup()
-                    .appendChild( new TextNode("45") ) ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        // this should result in not splitting the hyperlink, but due to API
-        // we can't tell :(
-        TreeNode rby3 = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(5/*-1*/, 8/*-1*/, rby3) );
-        root = new TreeNode()
-            .appendChild( new TextNode("1") )
-            .appendChild( url1.dup()
-                .appendChild( new TextNode("23") ) )
-            .appendChild( met2.dup()
-                .appendChild( url1.dup()
-                    .appendChild( new TextNode("4") ) )
-                .appendChild( rby3.dup()
-                    .appendChild( url1.dup()
-                        .appendChild( new TextNode("5") ) ) ) )
-            .appendChild( rby3.dup()
-                .appendChild( new TextNode("67") ) )
-            .appendChild( new TextNode("89") );
-        doTest(root, false);
-    }
-
-    /* TODO: test partial selection, test UNDO/REDO */
-
-    /** test SwXMeta XText interface */
-    public void testMetaXText() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("12AB6789");
-        inserter.insertRange( new Range(0, 0, text) );
-        MetaNode meta = new MetaNode( mkId("id") );
-//        inserter.insertRange( new Range(3, 5, met2) );
-        XTextContent xMeta = inserter.makeMeta();
-
-        XText xDocText = m_xDoc.getText();
-        XTextCursor xDocTextCursor = xDocText.createTextCursor();
-        xDocTextCursor.goRight((short)3, false);
-        xDocTextCursor.goRight((short)2, true);
-        xDocText.insertTextContent(xDocTextCursor, xMeta, true);
-//        xMeta.attach(xDocTextCursor);
-
-        XMetadatable xMetadatable = (XMetadatable)
-            UnoRuntime.queryInterface(XMetadatable.class, xMeta);
-        xMetadatable.setMetadataReference(meta.getXmlId());
-        XText xText = (XText) UnoRuntime.queryInterface(XText.class, xMeta);
-
-        XText xParentText = xText.getText();
-        assure("getText(): no parent", xParentText != null);
-
-        XTextRange xStart = xText.getStart();
-        assure("getStart(): no start", xStart != null);
-
-        XTextRange xEnd = xText.getEnd();
-        assure("getEnd(): no end", xEnd != null);
-
-        /*
-        String string = xText.getString();
-        assure("getString(): invalid string returned",
-            string != null && "AB".equals(string) );
-            */
-
-        xText.setString("45");
-
-        {
-            String string = xText.getString();
-            assure("getString(): invalid string returned: " + string,
-                string != null && "45".equals(string) );
-        }
-
-        XTextCursor xTextCursor = xText.createTextCursor();
-        assure("createTextCursor(): failed", xTextCursor != null);
-
-        try {
-            xText.createTextCursorByRange(null);
-            assure("createTextCursorByRange(): null allowed?", false);
-        } catch (RuntimeException e) { /* expected */ }
-
-        XTextCursor xTextCursorStart = xText.createTextCursorByRange(xStart);
-        assure("createTextCursorByRange(): failed for start",
-                xTextCursorStart != null);
-
-        XTextCursor xTextCursorEnd = xText.createTextCursorByRange(xEnd);
-        assure("createTextCursorByRange(): failed for end",
-                xTextCursorEnd != null);
-
-        // move outside meta
-        xDocTextCursor.gotoStart(false);
-
-        try {
-            xText.insertString(null, "foo", false);
-            assure("insertString(): null allowed?", false);
-        } catch (RuntimeException e) { /* expected */ }
-
-        try {
-            xText.insertString(xDocTextCursor, "foo", false);
-            assure("insertString(): cursor outside allowed?", false);
-        } catch (RuntimeException e) { /* expected */ }
-
-        xStart = xText.getStart();
-        xText.insertString(xStart, "A", false);
-        {
-            String string = xText.getString();
-            assure("getString(): invalid string returned: " + string,
-                string != null && "A45".equals(string) );
-        }
-
-        xText.insertString(xEnd, "B", false);
-        {
-            String string = xText.getString();
-            assure("getString(): invalid string returned: " + string,
-                string != null && "A45B".equals(string) );
-        }
-
-        try {
-            xText.insertControlCharacter(null, HARD_HYPHEN, false);
-            assure("insertControlCharacter(): null allowed?", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-
-        xStart = xText.getStart();
-        try {
-            xText.insertControlCharacter(xDocTextCursor, HARD_HYPHEN, false);
-            assure("insertControlCharacter(): cursor outside allowed?", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-
-        xText.insertControlCharacter(xStart, HARD_HYPHEN, false);
-        {
-            String string = xText.getString();
-            assure("getString(): invalid string returned: " + string,
-                string != null && ('\u2011' + "A45B").equals(string) );
-        }
-
-        xText.insertControlCharacter(xEnd, HARD_HYPHEN, false);
-        {
-            String string = xText.getString();
-            assure("getString(): invalid string returned: " + string,
-                string != null &&
-                ('\u2011' + "A45B" + '\u2011').equals(string) );
-        }
-
-        xText.setString("45");
-
-        try {
-            xText.insertTextContent(null, xMeta, false);
-            assure("insertTextContent(): null range allowed?", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-
-        try {
-            xText.insertTextContent(xStart, null, false);
-            assure("insertTextContent(): null content allowed?", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-
-        try {
-            xText.insertTextContent(xDocTextCursor, xMeta, false);
-            assure("insertTextContent(): cursor outside allowed?", false);
-        } catch (com.sun.star.lang.IllegalArgumentException e) { /* ignore */ }
-
-        TextFieldNode field1 = new TextFieldNode( "f1" );
-        TextFieldNode field2 = new TextFieldNode( "f2" );
-        XTextContent xField1 = inserter.makeTextField(field1.getContent());
-        XTextContent xField2 = inserter.makeTextField(field2.getContent());
-
-        xStart = xText.getStart();
-        xText.insertTextContent(xStart, xField1, false);
-
-        TreeNode root = new TreeNode()
-            .appendChild( new TextNode("12") )
-            .appendChild( meta.dup()
-                .appendChild( field1.dup() )
-                .appendChild( new TextNode("45") ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-
-        xText.insertTextContent(xEnd, xField2, false);
-
-        root = new TreeNode()
-            .appendChild( new TextNode("12") )
-            .appendChild( meta.dup()
-                .appendChild( field1.dup() )
-                .appendChild( new TextNode("45") )
-                .appendChild( field2.dup() ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-
-        try {
-            xText.removeTextContent(null);
-            assure("removeTextContent(): null content allowed?", false);
-        } catch (RuntimeException e) { /* expected */ }
-
-        xText.removeTextContent(xField1);
-
-        XTextRange xAnchor = xMeta.getAnchor();
-        assure("getAnchor(): null", xAnchor != null);
-
-        // evil test case: insert ruby around meta
-        RubyNode ruby = new RubyNode( mkName("ruby") );
-        inserter.insertRange( new Range(2, 6, ruby) );
-
-        /* prevent caching...
-        root = new TreeNode()
-            .appendChild( new TextNode("12") )
-            .appendChild( ruby.dup()
-                .appendChild( meta.dup()
-                    .appendChild( new TextNode("45") )
-                    .appendChild( field2.dup() ) ) )
-            .appendChild( new TextNode("6789") );
-        doTest(root, false);
-        */
-
-        XEnumerationAccess xEA = (XEnumerationAccess)
-            UnoRuntime.queryInterface(XEnumerationAccess.class, xMeta);
-        XEnumeration xEnum = xEA.createEnumeration();
-        assure("createEnumeration(): returns null", xEnum != null);
-        {
-            assure("hasNext(): first missing", xEnum.hasMoreElements());
-            Object xElement = xEnum.nextElement();
-            XTextRange xPortion = (XTextRange)
-                UnoRuntime.queryInterface(XTextRange.class, xElement);
-            XPropertySet xPropSet = (XPropertySet)
-                UnoRuntime.queryInterface(XPropertySet.class, xPortion);
-            String type = (String) xPropSet.getPropertyValue("TextPortionType");
-            assure("first: not text", type.equals("Text"));
-            String txt = xPortion.getString();
-            assure("first: text differs: " + txt, "45".equals(txt));
-        }
-        {
-            assure("hasNext(): second missing", xEnum.hasMoreElements());
-            Object xElement = xEnum.nextElement();
-            XTextRange xPortion = (XTextRange)
-                UnoRuntime.queryInterface(XTextRange.class, xElement);
-            XPropertySet xPropSet = (XPropertySet)
-                UnoRuntime.queryInterface(XPropertySet.class, xPortion);
-            String type = (String) xPropSet.getPropertyValue("TextPortionType");
-            assure("second: not text", type.equals("TextField"));
-        }
-        // no ruby end here!!!
-        assure("hasNext(): more elements?", !xEnum.hasMoreElements());
-
-        XComponent xComponent = (XComponent)
-            UnoRuntime.queryInterface(XComponent.class, xMeta);
-        xComponent.dispose();
-
-        try {
-            XTextCursor xCursor = xText.createTextCursor();
-            assure("createTextCursor(): succeeds on disposed object?",
-                    xCursor == null);
-        } catch (RuntimeException e) { /* expected */ }
-    }
-
-    /** check that cursor move methods move to positions in the meta,
-        but do not move to positions outside the meta. */
-    public void testMetaXTextCursor() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("Text. 12 More text here.");
-        inserter.insertRange( new Range(0, 0, text) );
-        MetaNode met1 = new MetaNode( mkId("id") );
-        XTextContent xMeta = inserter.makeMeta();
-
-        XText xDocText = m_xDoc.getText();
-        XTextCursor xDocTextCursor = xDocText.createTextCursor();
-        xDocTextCursor.goRight((short)7, false);
-        xDocTextCursor.goRight((short)2, true);
-        xDocText.insertTextContent(xDocTextCursor, xMeta, true);
-        xDocTextCursor.gotoStart(true);
-
-        XMetadatable xMetadatable = (XMetadatable)
-            UnoRuntime.queryInterface(XMetadatable.class, xMeta);
-        xMetadatable.setMetadataReference(met1.getXmlId());
-        XText xText = (XText) UnoRuntime.queryInterface(XText.class, xMeta);
-
-        XTextRange xStart = xText.getStart();
-        assure("getStart(): no start", xStart != null);
-        XTextRange xEnd = xText.getEnd();
-        assure("getEnd(): no end", xEnd != null);
-
-        XTextCursor xTextCursor = xText.createTextCursor();
-        assure("createTextCursor(): no cursor", xTextCursor != null);
-
-        // XTextCursor
-        boolean bSuccess = false;
-        xTextCursor.gotoStart(false);
-        xTextCursor.gotoEnd(false);
-        bSuccess = xTextCursor.goLeft((short)1, false);
-        assure("goLeft(): failed", bSuccess);
-        bSuccess = xTextCursor.goLeft((short)1000, false);
-        assure("goLeft(): succeeded", !bSuccess);
-        bSuccess = xTextCursor.goRight((short)1, false);
-        assure("goRight(): failed", bSuccess);
-        bSuccess = xTextCursor.goRight((short)1000, false);
-        assure("goRight(): succeeded", !bSuccess);
-        xTextCursor.gotoRange(xStart, false);
-        xTextCursor.gotoRange(xEnd, false);
-        try {
-            xTextCursor.gotoRange(xDocTextCursor, false);
-            assure("gotoRange(): succeeded", false);
-        } catch (RuntimeException e) { /* expected */ }
-
-        // XWordCursor
-        xText.setString("Two words");
-        xTextCursor.gotoStart(false);
-        XWordCursor xWordCursor = (XWordCursor)
-            UnoRuntime.queryInterface(XWordCursor.class, xTextCursor);
-
-        bSuccess = xWordCursor.gotoNextWord(true);
-        assure("gotoNextWord(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoNextWord(): wrong string: " + string,
-                    "Two ".equals(string));
-        }
-        bSuccess = xWordCursor.gotoNextWord(false);
-        assure("gotoNextWord(): succeeded", !bSuccess);
-        xTextCursor.collapseToEnd();
-        bSuccess = xWordCursor.gotoPreviousWord(true);
-        assure("gotoPreviousWord(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoPreviousWord(): wrong string: " + string,
-                    "words".equals(string));
-        }
-        bSuccess = xWordCursor.gotoPreviousWord(false);
-        assure("gotoPreviousWord(): succeeded", !bSuccess);
-        bSuccess = xWordCursor.gotoEndOfWord(true);
-        assure("gotoEndOfWord(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoEndOfWord(): wrong string: " + string,
-                    "Two".equals(string));
-        }
-        xTextCursor.gotoEnd(false);
-        bSuccess = xWordCursor.gotoStartOfWord(true);
-        assure("gotoStartOfWord(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoStartOfWord(): wrong string: " + string,
-                    "words".equals(string));
-        }
-        xText.setString("");
-        bSuccess = xWordCursor.gotoEndOfWord(false);
-        assure("gotoEndOfWord(): succeeded", !bSuccess);
-        bSuccess = xWordCursor.gotoStartOfWord(false);
-        assure("gotoStartOfWord(): succeeded", !bSuccess);
-
-        // XSentenceCursor
-        xText.setString("This is a sentence. Another sentence.");
-        xTextCursor.gotoStart(false);
-        XSentenceCursor xSentenceCursor = (XSentenceCursor)
-            UnoRuntime.queryInterface(XSentenceCursor.class, xTextCursor);
-
-        bSuccess = xSentenceCursor.gotoNextSentence(true);
-        assure("gotoNextSentence(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoNextSentence(): wrong string: " + string,
-                    "This is a sentence. ".equals(string));
-        }
-        bSuccess = xSentenceCursor.gotoNextSentence(false);
-        assure("gotoNextSentence(): succeeded", !bSuccess);
-        // FIXME:
-        // the sentence cursor seems to work differently than the word cursor
-        xText.setString("This is a sentence. Another sentence. Sentence 3.");
-        xTextCursor.gotoEnd(false);
-        bSuccess = xSentenceCursor.gotoPreviousSentence(true);
-        assure("gotoPreviousSentence(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoPreviousSentence(): wrong string: " + string,
-                    "Another sentence. Sentence 3.".equals(string));
-        }
-        bSuccess = xSentenceCursor.gotoPreviousSentence(false);
-        assure("gotoPreviousSentence(): succeeded", !bSuccess);
-        bSuccess = xSentenceCursor.gotoEndOfSentence(true);
-        assure("gotoEndOfSentence(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoEndOfSentence(): wrong string: " + string,
-                    "This is a sentence.".equals(string));
-        }
-        xTextCursor.gotoEnd(false);
-        bSuccess = xSentenceCursor.gotoStartOfSentence(true);
-        assure("gotoStartOfSentence(): failed", bSuccess);
-        {
-            String string = xTextCursor.getString();
-            assure("gotoStartOfSentence(): wrong string: " + string,
-                    "Sentence 3.".equals(string));
-        }
-        xText.setString("");
-        bSuccess = xSentenceCursor.gotoEndOfSentence(false);
-        assure("gotoEndOfSentence(): succeeded", !bSuccess);
-        bSuccess = xSentenceCursor.gotoStartOfSentence(false);
-        assure("gotoStartOfSentence(): succeeded", !bSuccess);
-
-        XParagraphCursor xParagraphCursor = (XParagraphCursor)
-            UnoRuntime.queryInterface(XParagraphCursor.class, xTextCursor);
-
-        // XParagraphCursor (does not make sense)
-        bSuccess = xParagraphCursor.gotoNextParagraph(false);
-        assure("gotoNextParagraph(): succeeded", !bSuccess);
-        bSuccess = xParagraphCursor.gotoPreviousParagraph(false);
-        assure("gotoPreviousParagraph(): succeeded", !bSuccess);
-        bSuccess = xParagraphCursor.gotoStartOfParagraph(false);
-        assure("gotoStartOfParagraph(): succeeded", !bSuccess);
-        bSuccess = xParagraphCursor.gotoEndOfParagraph(false);
-        assure("gotoEndOfParagraph(): succeeded", !bSuccess);
-    }
-
-
-    abstract class AttachHelper
-    {
-        abstract boolean isAttribute();
-        abstract TreeNode mkTreeNode();
-        abstract XTextContent mkTextContent(Inserter inserter, TreeNode node)
-            throws Exception;
-        void postInserted(TreeNode node, XTextContent xContent)
-            throws Exception { }
-    }
-
-    public void testMetaXTextAttachToxMark() throws Exception
-    {
-        doMetaXTextAttach( new AttachHelper()
-            {
-                boolean isAttribute() { return true; }
-                TreeNode mkTreeNode() {
-                    return new DocumentIndexMarkNode( mkName("toxmark") );
-                }
-                XTextContent mkTextContent(Inserter inserter, TreeNode node)
-                        throws Exception {
-                    return inserter.makeDocumentIndexMark(
-                        ((DocumentIndexMarkNode)node).getName());
-                }
-            });
-    }
-
-    public void testMetaXTextAttachRefMark() throws Exception
-    {
-        doMetaXTextAttach( new AttachHelper()
-            {
-                boolean isAttribute() { return true; }
-                TreeNode mkTreeNode() {
-                    return new ReferenceMarkNode( mkName("refmark") );
-                }
-                XTextContent mkTextContent(Inserter inserter, TreeNode node)
-                        throws Exception {
-                    return inserter.makeReferenceMark(
-                        ((ReferenceMarkNode)node).getName());
-                }
-            });
-    }
-
-    public void testMetaXTextAttachTextField() throws Exception
-    {
-        doMetaXTextAttach( new AttachHelper()
-            {
-                boolean isAttribute() { return false; }
-                TreeNode mkTreeNode() {
-                    return new TextFieldNode( mkName("field") );
-                }
-                XTextContent mkTextContent(Inserter inserter, TreeNode node)
-                        throws Exception {
-                    return inserter.makeTextField(
-                        ((TextFieldNode)node).getContent());
-                }
-            });
-    }
-
-    public void testMetaXTextAttachFootnote() throws Exception
-    {
-        doMetaXTextAttach( new AttachHelper()
-            {
-                boolean isAttribute() { return false; }
-                TreeNode mkTreeNode() {
-                    return new FootnoteNode( mkName("ftn") );
-                }
-                XTextContent mkTextContent(Inserter inserter, TreeNode node)
-                        throws Exception {
-                    return inserter.makeFootnote(
-                        ((FootnoteNode)node).getLabel());
-                }
-            });
-    }
-
-    public void testMetaXTextAttachMeta() throws Exception
-    {
-        doMetaXTextAttach( new AttachHelper()
-            {
-                boolean isAttribute() { return true; }
-                TreeNode mkTreeNode() {
-                    return new MetaNode( mkId("id") );
-                }
-                XTextContent mkTextContent(Inserter inserter, TreeNode node)
-                        throws Exception {
-                    return inserter.makeMeta();
-                }
-                void postInserted(TreeNode node, XTextContent xContent)
-                        throws Exception {
-                    XMetadatable xMetadatable = (XMetadatable)
-                        UnoRuntime.queryInterface(XMetadatable.class, xContent);
-                    xMetadatable.setMetadataReference(
-                            ((MetaNode)node).getXmlId());
-                }
-            });
-    }
-
-    void doMetaXTextAttach(AttachHelper helper) throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("12AB6789");
-        inserter.insertRange( new Range(0, 0, text) );
-        MetaNode met1 = new MetaNode( mkId("id") );
-        XTextContent xMeta = inserter.makeMeta();
-
-        XText xDocText = m_xDoc.getText();
-        XTextCursor xDocTextCursor = xDocText.createTextCursor();
-        xDocTextCursor.goRight((short)3, false);
-        xDocTextCursor.goRight((short)2, true);
-        xDocText.insertTextContent(xDocTextCursor, xMeta, true);
-
-        XMetadatable xMetadatable = (XMetadatable)
-            UnoRuntime.queryInterface(XMetadatable.class, xMeta);
-        xMetadatable.setMetadataReference(met1.getXmlId());
-        XText xText = (XText) UnoRuntime.queryInterface(XText.class, xMeta);
-        XTextRange xStart = null;
-        XTextRange xEnd = null;
-
-        {
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            // insertTextContent with meta getStart()/getEnd()
-            xText.insertTextContent(xStart, xContent1, false);
-            xText.insertTextContent(xEnd  , xContent2, false);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-        {
-            xText.setString("AB");
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            XTextCursor xTextCursor = xText.createTextCursor();
-            xTextCursor.gotoStart(false);
-
-            // insertTextContent with meta cursor
-            xText.insertTextContent(xTextCursor, xContent1, false);
-            xTextCursor.gotoEnd(false);
-            xText.insertTextContent(xTextCursor, xContent2, false);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-        if (!helper.isAttribute())
-        {
-//            xText.setString("AB");
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            XTextCursor xTextCursor = xText.createTextCursor();
-            xTextCursor.gotoStart(false);
-            xTextCursor.goRight((short)1, true);
-
-            // insertTextContent with meta cursor and absorb
-            xText.insertTextContent(xTextCursor, xContent1, true);
-            xTextCursor.gotoEnd(false);
-            xTextCursor.goLeft((short)1, true);
-            xText.insertTextContent(xTextCursor, xContent2, true);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-        {
-            xText.setString("AB");
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            xDocTextCursor.gotoRange(xStart, false);
-
-            // insertTextContent with document cursor
-            xText.insertTextContent(xDocTextCursor, xContent1, false);
-            xDocTextCursor.gotoRange(xEnd, false);
-            xText.insertTextContent(xDocTextCursor, xContent2, false);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-        if (!helper.isAttribute())
-        {
-//            xText.setString("AB");
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            xDocTextCursor.gotoRange(xStart, false);
-            xDocTextCursor.goRight((short)1, true);
-
-            // insertTextContent with document cursor and absorb
-            xText.insertTextContent(xDocTextCursor, xContent1, true);
-            xDocTextCursor.gotoRange(xEnd, false);
-            xDocTextCursor.goLeft((short)1, true);
-            xText.insertTextContent(xDocTextCursor, xContent2, true);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-        {
-            xText.setString("AB");
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            // attach to range from meta getStart()/getEnd()
-            xContent1.attach(xStart);
-            xContent2.attach(xEnd);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-        {
-            xText.setString("AB");
-            xStart = xText.getStart();
-            xEnd = xText.getEnd();
-
-            TreeNode nod1 = helper.mkTreeNode();
-            TreeNode nod2 = helper.mkTreeNode();
-            XTextContent xContent1 = helper.mkTextContent(inserter, nod1);
-            XTextContent xContent2 = helper.mkTextContent(inserter, nod2);
-
-            XTextCursor xTextCursor = xText.createTextCursor();
-            xTextCursor.gotoStart(false);
-
-            // attach to cursor from meta XText
-            xContent1.attach(xTextCursor);
-            xTextCursor.gotoEnd(false);
-            xContent2.attach(xTextCursor);
-
-            helper.postInserted(nod1, xContent1);
-            helper.postInserted(nod2, xContent2);
-
-            TreeNode root = new TreeNode()
-                .appendChild( new TextNode("12") )
-                .appendChild( met1.dup()
-                    .appendChild( nod1.dup() )
-                    .appendChild( new TextNode("AB") )
-                    .appendChild( nod2.dup() ) )
-                .appendChild( new TextNode("6789") );
-            doTest(root, false);
-        }
-    }
-
-    public void testMetaFieldXTextField() throws Exception
-    {
-        com.sun.star.rdf.XRepositorySupplier xModel =
-            (com.sun.star.rdf.XRepositorySupplier) UnoRuntime.queryInterface(
-                com.sun.star.rdf.XRepositorySupplier.class, m_xDoc);
-        com.sun.star.rdf.XRepository xRepo = xModel.getRDFRepository();
-        // for testing just add it to the first graph
-        com.sun.star.rdf.XURI[] Graphs = xRepo.getGraphNames();
-        com.sun.star.rdf.XNamedGraph xGraph = xRepo.getGraph(Graphs[0]);
-        com.sun.star.rdf.XURI xOdfPrefix =
-            com.sun.star.rdf.URI.createKnown(m_xContext,
-                com.sun.star.rdf.URIs.ODF_PREFIX);
-        com.sun.star.rdf.XURI xOdfSuffix =
-            com.sun.star.rdf.URI.createKnown(m_xContext,
-                com.sun.star.rdf.URIs.ODF_SUFFIX);
-        com.sun.star.rdf.XNode xPrefix =
-            com.sun.star.rdf.Literal.create(m_xContext, "foo");
-        com.sun.star.rdf.XNode xSuffix =
-            com.sun.star.rdf.Literal.create(m_xContext, "bar");
-
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("abc");
-        inserter.insertRange( new Range(0, 0, text) );
-        XText xDocText = m_xDoc.getText();
-        XTextCursor xDocTextCursor = xDocText.createTextCursor();
-        xDocTextCursor.goRight((short)1, false);
-        xDocTextCursor.goRight((short)3, true);
-
-        XTextField xMetaField = inserter.makeMetaField();
-
-        xDocText.insertTextContent(xDocTextCursor, xMetaField, true);
-
-        XMetadatable xMetadatable = (XMetadatable)
-            UnoRuntime.queryInterface(XMetadatable.class, xMetaField);
-        xMetadatable.ensureMetadataReference();
-
-        xGraph.addStatement(xMetadatable, xOdfPrefix, xPrefix);
-        xGraph.addStatement(xMetadatable, xOdfSuffix, xSuffix);
-        assure("getPresentation(): wrong",
-            "fooabcbar".equals(xMetaField.getPresentation(false)));
-        inserter.insertRange( new Range(0, 0, text) );
-    }
-
-    public void testMetaFieldXPropertySet() throws Exception
-    {
-        RangeInserter inserter = new RangeInserter(m_xDoc);
-        TreeNode text = new TextNode("123");
-        inserter.insertRange( new Range(0, 0, text) );
-        XText xDocText = m_xDoc.getText();
-        XTextCursor xDocTextCursor = xDocText.createTextCursor();
-        xDocTextCursor.goRight((short)1, false);
-        xDocTextCursor.goRight((short)3, true);
-
-        XTextField xMetaField = inserter.makeMetaField();
-
-        xDocText.insertTextContent(xDocTextCursor, xMetaField, true);
-
-        XPropertySet xPropertySet = (XPropertySet)
-            UnoRuntime.queryInterface(XPropertySet.class, xMetaField);
-        assure("PropertySet: not supported?", xPropertySet != null);
-        XPropertySetInfo xPropertySetInfo = xPropertySet.getPropertySetInfo();
-        assure("hasPropertyByName(\"NumberFormat\"):",
-                xPropertySetInfo.hasPropertyByName("NumberFormat"));
-        assure("hasPropertyByName(\"IsFixedLanguage\"):",
-                xPropertySetInfo.hasPropertyByName("IsFixedLanguage"));
-
-        int def = (Integer) xPropertySet.getPropertyValue("NumberFormat");
-        log.println("NumberFormat: default is " + def);
-        short INT = com.sun.star.i18n.NumberFormatIndex.NUMBER_INT;
-        xPropertySet.setPropertyValue("NumberFormat", INT);
-        xPropertySet.setPropertyValue("IsFixedLanguage", true);
-        int format = (Integer) xPropertySet.getPropertyValue("NumberFormat");
-        assure("NumberFormat: failed", format == INT);
-        boolean isFixed = (Boolean)
-            xPropertySet.getPropertyValue("IsFixedLanguage");
-        assure("IsFixedLanguage: failed", isFixed);
-    }
-
-    public void testLoadStore() throws Exception
-    {
-        XComponent xComp = null;
-        String filename = "TESTMETA.odt";
-        String file;
-        try {
-            file = util.utils.getFullTestURL(filename);
-            xComp = doLoad(file);
-            if (xComp != null)
-            {
-                file = m_TmpDir + filename;
-                doStore(xComp, file);
-                close(xComp);
-                xComp = doLoad(file);
-            }
-        } finally {
-            close(xComp);
-        }
-    }
-
-    private void doStore(XComponent xComp, String file) throws Exception
-    {
-        log.println("Storing test document...");
-
-        XStorable xStor = (XStorable) UnoRuntime.queryInterface(
-                    XStorable.class, xComp);
-
-        xStor.storeToURL(file, new PropertyValue[0]);
-
-        log.println("...done");
-    }
-
-    public XComponent doLoad(String file) throws Exception
-    {
-        XComponent xComp = null;
-
-        log.println("Loading test document...");
-
-        PropertyValue[] loadProps = new PropertyValue[1];
-        loadProps[0] = new PropertyValue();
-        loadProps[0].Name = "Hidden";
-        loadProps[0].Value = new Boolean(true);
-
-        xComp = util.DesktopTools.loadDoc(m_xMSF, file, loadProps);
-//        xComp =  util.DesktopTools.getCLoader(m_xMSF).loadComponentFromURL(file, "_blank", 0, loadProps);
-
-
-        XTextDocument xTextDoc = (XTextDocument)
-            UnoRuntime.queryInterface(XTextDocument.class, xComp);
-
-        XText xText = xTextDoc.getText();
-
-        log.println("...done");
-
-        log.println("Checking meta(-field)s in loaded test document...");
-
-        TreeNode root = new TreeNode()
-            .appendChild( new RubyNode("ruby1")
-                .appendChild( new TextNode("1") ) )
-            .appendChild( new MetaNode(mkId_("id1"))
-                .appendChild( new TextNode("2") ) )
-            .appendChild( new MetaFieldNode(mkId_("id2"))
-                .appendChild( new TextNode("3") ) )
-            .appendChild( new RubyNode("ruby2")
-                .appendChild( new MetaNode(mkId_("id3"))
-                    .appendChild( new TextNode("4") ) ) )
-            .appendChild( new RubyNode("ruby3")
-                .appendChild( new MetaFieldNode(mkId_("id4"))
-                    .appendChild( new TextNode("5") ) ) )
-            .appendChild( new MetaNode(mkId_("id5"))
-                .appendChild( new RubyNode("ruby4")
-                    .appendChild( new TextNode("6") ) ) )
-            .appendChild( new MetaFieldNode(mkId_("id6"))
-                .appendChild( new RubyNode("ruby5")
-                    .appendChild( new TextNode("7") ) ) )
-            .appendChild( new MetaNode(mkId_("id7"))
-                .appendChild( new MetaNode(mkId_("id8"))
-                    .appendChild( new TextNode("8") ) ) )
-            .appendChild( new MetaNode(mkId_("id9"))
-                .appendChild( new MetaFieldNode(mkId_("id10"))
-                    .appendChild( new TextNode("9") ) ) )
-            .appendChild( new MetaFieldNode(mkId_("id11"))
-                .appendChild( new MetaNode(mkId_("id12"))
-                    .appendChild( new TextNode("10") ) ) )
-            .appendChild( new MetaFieldNode(mkId_("id13"))
-                .appendChild( new MetaFieldNode(mkId_("id14"))
-                    .appendChild( new TextNode("11") ) ) )
-            .appendChild( new MetaNode(mkId_("id15"))
-                .appendChild( new RubyNode("ruby6")
-                    .appendChild( new MetaFieldNode(mkId_("id16"))
-                        .appendChild( new TextNode("12") ) ) ) )
-            .appendChild( new MetaNode(mkId_("")) {
-                                public boolean equals(Object other) {
-                                    return (other instanceof MetaNode);
-                                } }
-                .appendChild( new TextNode("13") ) )
-            .appendChild( new TextNode(" X X ") );
-        doTest(xTextDoc, root, false);
-
-        log.println("...done");
-
-        return xComp;
-    }
-
-    static void close(XComponent i_comp)
-    {
-        try {
-            XCloseable xClos = (XCloseable) UnoRuntime.queryInterface(
-                        XCloseable.class, i_comp);
-            if (xClos != null) xClos.close(true);
-        } catch (Exception e) {
-        }
-    }
-
-    private void doTest(TreeNode intree) throws Exception
-    {
-        doTest(m_xDoc, intree, true);
-    }
-
-    private void doTest(TreeNode intree, boolean insert) throws Exception
-    {
-        doTest(m_xDoc, intree, insert);
-    }
-
-    private void doTest(XTextDocument xDoc, TreeNode intree,
-            boolean insert) throws Exception
-    {
-        dumpTree(intree, "I: ");
-
-        if (insert) {
-            new TreeInserter(xDoc).insertTree(intree);
-        }
-
-//Thread.sleep(10000);
-
-        XText xText = xDoc.getText();
-        XEnumerationAccess xTextEA = (XEnumerationAccess)
-            UnoRuntime.queryInterface(XEnumerationAccess.class, xText);
-        XEnumeration xTextEnum = xTextEA.createEnumeration();
-        // skip to right paragraph
-        xTextEnum.nextElement(); // skip first -- always empty!
-        Object xElement = xTextEnum.nextElement(); // second contains test case
-        XEnumerationAccess xEA = (XEnumerationAccess)
-            UnoRuntime.queryInterface(XEnumerationAccess.class, xElement);
-        XEnumeration xEnum = xEA.createEnumeration();
-        TreeNode outtree = new EnumConverter(this).convert(xEnum);
-
-        dumpTree(outtree, "O: ");
-
-        boolean success = new FuzzyTester(log).doTest(intree, outtree);
-        assure("test failed", success);
-    }
-
-    private void dumpTree(TreeNode tree) { dumpTree(tree, "> "); }
-
-    private void dumpTree(TreeNode tree, String prefix)
-    {
-        log.println(prefix + tree.toString());
-        TreeNodeEnum children = tree.createEnumeration();
-        while (children.hasNext()) {
-            TreeNode node = children.next();
-            dumpTree(node, prefix + "  ");
-        }
-    }
-
-    private String mkName(String prefix)
-    {
-        return prefix + String.valueOf(m_Count++);
-    }
-
-    private StringPair mkId(String prefix)
-    {
-        return new StringPair("content.xml", mkName(prefix));
-    }
-
-    private StringPair mkId_(String id)
-    {
-        return new StringPair("content.xml", id);
-    }
-
-    public void assure(String str, boolean cond) { super.assure(str, cond); }
-}
-
diff --git sw/source/core/doc/docfly.cxx sw/source/core/doc/docfly.cxx
index e0645fc..9de42f6 100644
--- sw/source/core/doc/docfly.cxx
+++ sw/source/core/doc/docfly.cxx
@@ -667,6 +667,7 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
     for ( USHORT i = 0; i < _rMrkList.GetMarkCount(); ++i )
     {
         SdrObject* pObj = _rMrkList.GetMark( i )->GetMarkedSdrObj();
+
         if ( !pObj->ISA(SwVirtFlyDrawObj) )
         {
             SwDrawContact* pContact = static_cast<SwDrawContact*>(GetUserCall(pObj));
@@ -678,8 +679,7 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
             if ( !pContact )
             {
 #ifndef PRODUCT
-                bool bNoUserCallExcepted =
-                        pObj->ISA(SwDrawVirtObj) &&
+        bool bNoUserCallExcepted = pObj->ISA(SwDrawVirtObj) &&
                         !static_cast<SwDrawVirtObj*>(pObj)->IsConnected();
                 ASSERT( bNoUserCallExcepted, "SwDoc::ChgAnchor(..) - no contact at selected drawing object" );
 #endif
@@ -717,10 +717,7 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
             case FLY_AUTO_CNTNT:
                 {
                     const Point aNewPoint = pOldAnchorFrm &&
-                                            ( pOldAnchorFrm->IsVertical() ||
-                                              pOldAnchorFrm->IsRightToLeft() )
-                                            ? aObjRect.TopRight()
-                                            : aPt;
+            ( 	pOldAnchorFrm->IsVertical() || pOldAnchorFrm->IsRightToLeft() )? aObjRect.TopRight() : aPt;
 
                     // OD 18.06.2003 #108784# - allow drawing objects in header/footer
                     pNewAnchorFrm = ::FindAnchor( pOldAnchorFrm, aNewPoint, false );
@@ -754,11 +751,12 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
                         GetRootFrm()->GetCrsrOfst( &aPos, aPoint, &aState );
                         // OD 20.06.2003 #108784# - consider that drawing objects
                         // can be in header/footer. Thus, <GetFrm()> by left-top-corner
-                        pTxtFrm = aPos.nNode.GetNode().
-                                        GetCntntNode()->GetFrm( &aPt, 0, FALSE );
+                        pTxtFrm = aPos.nNode.GetNode().GetCntntNode()->GetFrm( &aPt, 0, FALSE );
                     }
+
                     const SwFrm *pTmp = ::FindAnchor( pTxtFrm, aPt );
                     pNewAnchorFrm = pTmp->FindFlyFrm();
+
                     if( pNewAnchorFrm && !pNewAnchorFrm->IsProtected() )
                     {
                         const SwFrmFmt *pTmpFmt = ((SwFlyFrm*)pNewAnchorFrm)->GetFmt();
@@ -771,17 +769,21 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
                     aNewAnch.SetType( FLY_PAGE );
                     // no break
                 }
+
             case FLY_PAGE:
                 {
                     pNewAnchorFrm = GetRootFrm()->Lower();
+
                     while ( pNewAnchorFrm && !pNewAnchorFrm->Frm().IsInside( aPt ) )
                         pNewAnchorFrm = pNewAnchorFrm->GetNext();
+
                     if ( !pNewAnchorFrm )
                         continue;
 
                     aNewAnch.SetPageNum( ((SwPageFrm*)pNewAnchorFrm)->GetPhyPageNum());
                 }
                 break;
+
             case FLY_IN_CNTNT:
                 if( _bSameOnly )    // Positions/Groessenaenderung
                 {
@@ -796,6 +798,7 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
                 {
                     // OD 18.06.2003 #108784# - allow drawing objects in header/footer
                     pNewAnchorFrm = ::FindAnchor( pOldAnchorFrm, aPt, false );
+
                     if( pNewAnchorFrm->IsProtected() )
                     {
                         pNewAnchorFrm = 0;
@@ -807,6 +810,7 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
                     aPoint.X() -= 1;	// nicht im DrawObj landen!!
                     aNewAnch.SetType( FLY_IN_CNTNT );
                     SwPosition aPos( *((SwCntntFrm*)pNewAnchorFrm)->GetNode() );
+
                     if ( pNewAnchorFrm->Frm().IsInside( aPoint ) )
                     {
                     // es muss ein TextNode gefunden werden, denn nur dort
@@ -818,30 +822,34 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
                     {
                         SwCntntNode &rCNd = (SwCntntNode&)
                             *((SwCntntFrm*)pNewAnchorFrm)->GetNode();
+
                         if ( pNewAnchorFrm->Frm().Bottom() < aPt.Y() )
                             rCNd.MakeStartIndex( &aPos.nContent );
                         else
                             rCNd.MakeEndIndex( &aPos.nContent );
                     }
+
                     aNewAnch.SetAnchor( &aPos );
                     SetAttr( aNewAnch, *pContact->GetFmt() );
                     // OD 2004-04-13 #i26791# - adjust vertical positioning to
                     // 'center to baseline'
-                    SetAttr( SwFmtVertOrient( 0, text::VertOrientation::CENTER, text::RelOrientation::FRAME ), *pContact->GetFmt() );
+                    SetAttr( SwFmtVertOrient( 0, text::VertOrientation::CENTER, text::RelOrientation::FRAME ), 
+                 *pContact->GetFmt() );
                     SwTxtNode *pNd = aPos.nNode.GetNode().GetTxtNode();
+
                     ASSERT( pNd, "Cursor not positioned at TxtNode." );
 
                     SwFmtFlyCnt aFmt( pContact->GetFmt() );
                     pNd->InsertItem( aFmt, aPos.nContent.GetIndex(), 0 );
                 }
                 break;
+
             default:
                 ASSERT( !this, "unexpected AnchorId." );
             }
 
             if ( (FLY_IN_CNTNT != _eAnchorType) &&
-                 pNewAnchorFrm &&
-                 ( !_bSameOnly || pNewAnchorFrm != pOldAnchorFrm ) )
+                 pNewAnchorFrm && ( !_bSameOnly || pNewAnchorFrm != pOldAnchorFrm ) )
             {
                 // OD 2004-04-06 #i26791# - Direct object positioning no longer
                 // needed. Apply of attributes (method call <SetAttr(..)>) takes
@@ -878,13 +886,13 @@ sal_Bool SwDoc::ChgAnchor( const SdrMarkList& _rMrkList,
                 const xub_StrLen nIndx( pOldAsCharAnchorPos->nContent.GetIndex() );
                 SwTxtNode* pTxtNode( pOldAsCharAnchorPos->nNode.GetNode().GetTxtNode() );
                 ASSERT( pTxtNode, "<SwDoc::ChgAnchor(..)> - missing previous anchor text node for as-character anchored object" );
-                ASSERT( pTxtNode->HasHints(), "Missing FlyInCnt-Hint." );
                 SwTxtAttr * const pHnt =
                     pTxtNode->GetTxtAttrForCharAt( nIndx, RES_TXTATR_FLYCNT );
                 const_cast<SwFmtFlyCnt&>(pHnt->GetFlyCnt()).SetFlyFmt();
 
                 //Die Verbindung ist geloest, jetzt muss noch das Attribut vernichtet
                 //werden.
+
                 pTxtNode->DeleteAttributes( RES_TXTATR_FLYCNT, nIndx, nIndx );
                 delete pOldAsCharAnchorPos;
             }
diff --git sw/source/core/edit/autofmt.cxx sw/source/core/edit/autofmt.cxx
index 114ae91..cfed93c 100644
--- sw/source/core/edit/autofmt.cxx
+++ sw/source/core/edit/autofmt.cxx
@@ -316,6 +316,7 @@ void SwAutoFormat::_SetRedlineTxt( USHORT nActionId )
         case STR_AUTOFMTREDL_FRACTION:
         case STR_AUTOFMTREDL_DASH:
         case STR_AUTOFMTREDL_ORDINAL:
+        case STR_AUTOFMTREDL_NON_BREAK_SPACE:
             nSeqNo = ++nRedlAutoFmtSeqId;
             break;
         }
@@ -1896,7 +1897,7 @@ void SwAutoFormat::AutoCorrect( xub_StrLen nPos )
         !aFlags.bCptlSttSntnc && !aFlags.bCptlSttWrd &&
         !aFlags.bChgFracionSymbol && !aFlags.bChgOrdinalNumber &&
         !aFlags.bChgToEnEmDash && !aFlags.bSetINetAttr &&
-        !aFlags.bChgWeightUnderl) )
+        !aFlags.bChgWeightUnderl && !aFlags.bAddNonBrkSpace) )
         return;
 
     const String* pTxt = &pAktTxtNd->GetTxt();
@@ -1905,7 +1906,8 @@ void SwAutoFormat::AutoCorrect( xub_StrLen nPos )
 
     BOOL bGetLanguage = aFlags.bChgOrdinalNumber ||
                         aFlags.bChgToEnEmDash || aFlags.bSetINetAttr ||
-                        aFlags.bCptlSttWrd || aFlags.bCptlSttSntnc;
+                        aFlags.bCptlSttWrd || aFlags.bCptlSttSntnc ||
+                        aFlags.bAddNonBrkSpace;
 
 
     aDelPam.DeleteMark();
@@ -2134,6 +2136,9 @@ void SwAutoFormat::AutoCorrect( xub_StrLen nPos )
                 ( aFlags.bChgToEnEmDash &&
                     SetRedlineTxt( STR_AUTOFMTREDL_DASH ) &&
                     pATst->FnChgToEnEmDash( aACorrDoc, *pTxt, nSttPos, nPos, eLang ) ) ||
+                ( aFlags.bAddNonBrkSpace &&
+                    SetRedlineTxt( STR_AUTOFMTREDL_NON_BREAK_SPACE ) &&
+                    pATst->FnAddNonBrkSpace( aACorrDoc, *pTxt, nSttPos, nPos, eLang ) ) ||
                 ( aFlags.bSetINetAttr &&
                     ( nPos == pTxt->Len() || IsSpace( pTxt->GetChar( nPos )) ) &&
                     SetRedlineTxt( STR_AUTOFMTREDL_DETECT_URL ) &&
diff --git sw/source/core/text/txtfrm.cxx sw/source/core/text/txtfrm.cxx
index 8da2cbf..729129c 100644
--- sw/source/core/text/txtfrm.cxx
+++ sw/source/core/text/txtfrm.cxx
@@ -635,8 +635,8 @@ void SwTxtFrm::HideAndShowObjects()
 xub_StrLen SwTxtFrm::FindBrk( const XubString &rTxt,
                           const xub_StrLen nStart, const xub_StrLen nEnd ) const
 {
-    xub_StrLen nFound = nStart;
-    const xub_StrLen nEndLine = Min( nEnd, rTxt.Len() );
+    unsigned long int  nFound = nStart;
+    const unsigned long int nEndLine = Min( nEnd, rTxt.Len() );
 
     // Wir ueberlesen erst alle Blanks am Anfang der Zeile (vgl. Bug 2235).
     while( nFound <= nEndLine && ' ' == rTxt.GetChar( nFound ) )
@@ -649,7 +649,7 @@ xub_StrLen SwTxtFrm::FindBrk( const XubString &rTxt,
     while( nFound <= nEndLine && ' ' != rTxt.GetChar( nFound ) )
         ++nFound;
 
-    return nFound;
+    return (xub_StrLen)nFound;
 }
 
 /*************************************************************************
diff --git sw/source/core/txtnode/fmtatr1.cxx sw/source/core/txtnode/fmtatr1.cxx
new file mode 100644
index 0000000..1741e2a
--- /dev/null
+++ sw/source/core/txtnode/fmtatr1.cxx
@@ -0,0 +1,97 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: fmtatr1.cxx,v $
+ * $Revision: 1.6 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_sw.hxx"
+
+
+
+#include <hintids.hxx>
+#include <errhdl.hxx>
+#include <fmthbsh.hxx>
+
+
+/*************************************************************************
+|*
+|*    class SwFmtHardBlank
+|*
+|*    Beschreibung      Dokument 1.20
+|*    Ersterstellung    JP 23.11.90
+|*    Letzte Aenderung  JP 20.02.91
+|*
+*************************************************************************/
+
+SwFmtHardBlank::SwFmtHardBlank( sal_Unicode cCh, BOOL )
+    : SfxPoolItem( RES_TXTATR_HARDBLANK ),
+    cChar( cCh )
+{
+//	ASSERT( !bCheck || (' ' != cCh && '-' != cCh),
+//			"Invalid character for the HardBlank attribute - "
+//			"must be a normal unicode character" );
+}
+
+int SwFmtHardBlank::operator==( const SfxPoolItem& rAttr ) const
+{
+    ASSERT( SfxPoolItem::operator==( rAttr ), "keine gleichen Attribute" );
+    return cChar == ((SwFmtHardBlank&)rAttr).GetChar();
+}
+
+SfxPoolItem* SwFmtHardBlank::Clone( SfxItemPool* ) const
+{
+    return new SwFmtHardBlank( *this );
+}
+
+/*************************************************************************
+|*
+|*    class SwFmtSoftHyph
+|*
+|*    Beschreibung      Dokument 1.20
+|*    Ersterstellung    JP 23.11.90
+|*    Letzte Aenderung  JP 20.02.91
+|*
+*************************************************************************/
+
+SwFmtSoftHyph::SwFmtSoftHyph()
+    : SfxPoolItem( RES_TXTATR_SOFTHYPH )
+{
+}
+
+int SwFmtSoftHyph::operator==( const SfxPoolItem& ) const
+{
+//	ASSERT( SfxPoolItem::operator==( rAttr ), "keine gleichen Attribute" );
+    return TRUE;
+}
+
+SfxPoolItem* SwFmtSoftHyph::Clone( SfxItemPool* ) const
+{
+    return new SwFmtSoftHyph( *this );
+}
+
+
diff --git sw/source/ui/dbui/dbtree.cxx sw/source/ui/dbui/dbtree.cxx
index 46d8efb..2d2783d 100644
--- sw/source/ui/dbui/dbtree.cxx
+++ sw/source/ui/dbui/dbtree.cxx
@@ -262,6 +262,10 @@ void SwDBTreeList::InitTreeList()
 {
     if(!pImpl->HasContext() && pImpl->GetWrtShell())
         return;
+#ifdef OOo4Kids
+// we no longer use base. Workaround avoiding a crash when trying to connect to a database
+    return;
+#endif
     SetSelectionMode(SINGLE_SELECTION);
     SetWindowBits(WB_HASLINES|WB_CLIPCHILDREN|WB_SORT|WB_HASBUTTONS|WB_HASBUTTONSATROOT|WB_HSCROLL);
     // Font nicht setzen, damit der Font des Controls uebernommen wird!
diff --git sw/source/ui/dialog/SwDialogAssistant.cxx sw/source/ui/dialog/SwDialogAssistant.cxx
new file mode 100644
index 0000000..ea2c26c
--- /dev/null
+++ sw/source/ui/dialog/SwDialogAssistant.cxx
@@ -0,0 +1,2066 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: SwDialogAssistant.cxx,v $
+ * $Revision: 1 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_sw.hxx"
+
+#ifdef SW_DLLIMPLEMENTATION
+#undef SW_DLLIMPLEMENTATION
+#endif
+////#include <com/sun/star/presentation/ClickAction.hpp>
+#include <vcl/svapp.hxx>
+#include <vos/mutex.hxx>
+#include <vcl/msgbox.hxx>
+#include <vcl/lstbox.hxx>
+#include <vcl/combobox.hxx>
+#include <sfx2/doctempl.hxx>
+#include <svtools/lstner.hxx>
+#include <sfx2/objsh.hxx>
+#include <svtools/ehdl.hxx>
+#include <svtools/sfxecode.hxx>
+#include <tools/urlobj.hxx>
+////#include <com/sun/star/presentation/FadeEffect.hpp>
+////#include <fadedef.h>
+#include <sfx2/sfxsids.hrc>
+#include <svtools/undo.hxx>
+
+// FIXME
+#include "WriterDocShell.hxx"
+
+#include <vcl/gdimtf.hxx>
+#include <vcl/wintypes.hxx>
+#include "docprev.hxx"
+#include <sfx2/app.hxx>
+#include <sfx2/docfile.hxx>
+#include <sfx2/dispatch.hxx>
+#include <sfx2/request.hxx>
+//#include <com/sun/star/sdbc/XResultSet.hpp>
+//#include <com/sun/star/lang/XComponent.hpp>
+//#include <com/sun/star/util/XCloseable.hpp>
+//#include <com/sun/star/uno/RuntimeException.hpp>
+//#include <com/sun/star/frame/XModuleManager.hpp>
+//#include <com/sun/star/ucb/XSimpleFileAccess.hpp>
+//#include <com/sun/star/ui/XModuleUIConfigurationManagerSupplier.hpp>
+//#include <com/sun/star/ui/XImageManager.hpp>
+//#include <svtools/historyoptions.hxx>
+//#include <tools/urlobj.hxx>
+//#include <osl/file.hxx>
+//#include <sfx2/filedlghelper.hxx>
+
+//// INTERESTING : 
+//// there is no matching swpages.hxx ...
+////#include "sdpage.hxx"
+#include "helpids.h"
+#include "SwAssistantClass.hxx"
+#include "SwDialogAssistant.hrc"
+#include "SwDialogAssistant.hxx"
+//#include "dlgctrls.hxx"  // for fade effect
+#ifndef _SW_CFGID_HXX
+#include "strings.hrc"
+#endif
+// FIXME
+//#ifndef _DATETIMEITEM_HXX
+//#include "dlgassim.hxx"
+//#endif
+
+#include "TemplateScanner.hxx"
+#include "WindowUpdater.hxx"
+
+#include <comphelper/processfactory.hxx>
+
+using namespace ::com::sun::star;
+using namespace ::com::sun::star::uno;
+using namespace ::sw;
+
+
+void InterpolateFixedBitmap( FixedBitmap * pBitmap )
+{
+    Bitmap aBmp( pBitmap->GetBitmap() );
+    Size aSize = pBitmap->GetSizePixel();
+    aBmp.Scale( aSize, BMP_SCALE_INTERPOLATE );
+    pBitmap->SetBitmap( aBmp );
+}
+
+
+// ====================================================================
+// ====================================================================
+
+UINT32 PageHelpIds[] =
+{
+    HID_SW_AUTOPILOT_PAGE1,
+    HID_SW_AUTOPILOT_PAGE2
+};
+
+// ====================================================================
+
+class PasswordEntry
+{
+public:
+    String maPassword;
+    String maPath;
+};
+
+DECLARE_LIST( PasswordEntryList, PasswordEntry * )
+
+// ====================================================================
+
+/** A simple wrapper that looks like a PushButton and is used to force the
+    broadcasting of focus events primarly for accessibility tools.
+    Forcing focus events is achieved by using two identical PushButtons
+    which, when the focus event is requested, are exchanged and play focus
+    ping-pong by moving the focus from one to the other.
+*/
+class NextButton
+{
+public:
+    NextButton (::Window* pParent, const ResId& rResId);
+
+    void ForceFocusEventBroadcast (void);
+    void SetClickHdl (const Link& rLink);
+    bool IsEnabled (void);
+    void Enable (bool bEnable);
+    
+private:
+    PushButton maNextButton1;
+    PushButton maNextButton2;
+    bool mbIsFirstButtonActive;
+};
+
+
+
+// ====================================================================
+
+class WriterAssistantDlgImpl : public SfxListener
+{
+public:
+    WriterAssistantDlgImpl( ::Window* pWindow, const Link& rFinishLink, BOOL bAutoPilot  );
+    ~WriterAssistantDlgImpl();
+
+    /// Local mutex used to serialize concurrent method calls.
+    ::osl::Mutex maMutex;
+
+    SfxObjectShellLock GetDocument();
+
+    /** closes the current preview docshell */
+    void CloseDocShell();
+
+    /**	Extract form the history list of recently used files the impress
+        files and insert them into a listbox.
+    */
+    void	ScanDocmenu			(void);
+    /**	Flag that is set to TRUE after the recently used files have been
+        scanned.
+    */
+    BOOL mbRecentDocumentsReady;
+
+    /**	When the list of templates has not been scanned already this is done
+        when this method is called.  That includes requesting the whole list
+        of templates from UCB and extracting from that list the impress
+        templates and layouts and storing them for later use in
+        <member>maPresentList</member>.  Note that the first call to this
+        method after installing a new Office may take some time.
+    */
+    void ProvideTemplates (void);
+
+    /**	This method transfers the template folders from the template scanner
+        to the internal structures of this class.  On termination it sets
+        the flag <member>mbTemplatesReady</member> to <TRUE/> to indicate
+        that the templates are available.
+        @param rTemplateFolders
+            This is a list of template folders.  This method takes ownership
+            of the supplied entries by removing them from the list and
+            transferring them to an internal structure.
+    */
+    void TemplateScanDone (std::vector<TemplateDir*>& rTemplateFolders);
+
+    /**	Flag that is set to TRUE after the impress templates have been
+        scanned.
+    */
+    BOOL mbTemplatesReady;
+
+    /** Flag used to prevent nested or concurrent calls to the
+        <member>UpdatePreview</memember> method.  A <TRUE/> value indicates
+        that a preview update is currently active.
+    */
+    BOOL mbPreviewUpdating;
+
+    ::Window* mpWindow;
+
+    void SavePassword( SfxObjectShellLock xDoc, const String& rPath );
+    void RestorePassword( SfxItemSet* pSet, const String& rPath );
+    String GetPassword( const String rPath );
+    void DeletePassords();
+
+    PasswordEntryList maPasswordList;
+
+    String maDocFile;
+    String maLayoutFile;
+
+    String GetDocFileName();
+    String GetLayoutFileName();
+
+    ///	List of URLs of recently used impress files.
+    std::vector<String*> maOpenFilesList;
+
+    ///	List of folders containing data about impress templates.
+    std::vector<TemplateDir*> maPresentList;
+
+    ///	Currently selected template folder.
+    TemplateDir* mpTemplateRegion;
+
+    ///	Currently selected layout folder.
+    TemplateDir* mpLayoutRegion;
+
+    // preview
+    BOOL mbUserDataDirty;
+    Timer maPrevTimer;
+    Timer maEffectPrevTimer;
+    Timer maUpdatePageListTimer;
+    Timer maStartScanTimer;
+
+    SfxObjectShellLock xDocShell;
+
+    ::std::auto_ptr<WindowUpdater> mpWindowUpdater;
+
+    BOOL mbPreview;
+    USHORT mnShowPage;
+    BOOL mbDocPreview;
+
+    ULONG mnTemplate;
+
+    String maPageListFile;
+
+    void UpdatePreview( BOOL bDocPreview );
+    void UpdatePageList();
+    void UpdateUserData();
+
+    BOOL IsOwnFormat( const String& rPath );
+
+    // dlg status
+    void EndDialog( long nResult = 0 );
+
+    void SetStartType( StartType eType );
+    StartType GetStartType();
+
+    void SelectTemplateRegion( const String& rRegion );
+    void SelectLayoutRegion( const String& rRegion );
+
+    void UpdatePage();
+    void ChangePage();
+    void LeavePage();
+
+    String GetUiTextForCommand (const ::rtl::OUString& aCommandURL);
+    Image GetUiIconForCommand (const ::rtl::OUString& aCommandURL);
+
+    DECL_LINK( StartScanHdl, void * );
+    DECL_LINK( SelectFileHdl, ListBox * );
+    DECL_LINK( SelectRegionHdl, ListBox * );
+    DECL_LINK( UpdatePreviewHdl, void * );
+    DECL_LINK( UpdatePageListHdl, void * );
+    DECL_LINK( StartTypeHdl, RadioButton * );
+    DECL_LINK( SelectTemplateHdl, ListBox * );
+    DECL_LINK( NextPageHdl, PushButton * );
+    DECL_LINK( LastPageHdl, PushButton * );
+    DECL_LINK( PreviewFlagHdl, CheckBox * );
+    DECL_LINK( EffectPreviewHdl, Button * );
+    DECL_LINK( SelectLayoutHdl, ListBox * );
+    DECL_LINK( PageSelectHdl, Control * );
+    DECL_LINK( PresTypeHdl, RadioButton * );
+    DECL_LINK( UpdateUserDataHdl, Edit* );
+    DECL_LINK( SelectEffectHdl, void* );
+    DECL_LINK( OpenButtonHdl, Button * );
+
+    // Common
+    WriterAssistant			maWriterAssistantFunc;
+    CheckBox			maPreviewFlag;
+    CheckBox			maStartWithFlag;
+    HelpButton			maHelpButton;
+    CancelButton		maCancelButton;
+    PushButton			maLastPageButton;
+    NextButton	        maNextPageButton;
+    OKButton			maFinishButton;
+    SdDocPreviewWin		maPreview;
+
+    String				maCreateStr;
+    String				maOpenStr;
+
+    // Seite 1
+    FixedBitmap*		mpPage1FB;
+    FixedLine*			mpPage1ArtFL;
+    RadioButton*		mpPage1EmptyRB;
+    RadioButton*		mpPage1TemplateRB;
+    ListBox*			mpPage1RegionLB;
+    ListBox*			mpPage1TemplateLB;
+    RadioButton*		mpPage1OpenRB;
+    ListBox*			mpPage1OpenLB;
+    PushButton*         mpPage1OpenPB;
+
+    // Seite 2
+    FixedBitmap*		mpPage2FB;
+    FixedLine*			mpPage2LayoutFL;
+    ListBox*			mpPage2RegionLB;
+    ListBox*			mpPage2LayoutLB;
+    FixedLine*			mpPage2OutTypesFL;
+    RadioButton*		mpPage2Medium1RB;
+    RadioButton*		mpPage2Medium2RB;
+    RadioButton*		mpPage2Medium3RB;
+    RadioButton*		mpPage2Medium4RB;
+    RadioButton*		mpPage2Medium5RB;
+
+    // Seite 3
+    FixedBitmap*		mpPage3FB;
+    FixedLine*			mpPage3EffectFL;
+    FixedText*			mpPage3EffectFT;
+    FadeEffectLB*		mpPage3EffectLB;
+    FixedText*			mpPage3SpeedFT;
+    ListBox*			mpPage3SpeedLB;
+    FixedLine*			mpPage3PresTypeFL;
+    RadioButton*		mpPage3PresTypeLiveRB;
+    RadioButton*		mpPage3PresTypeKioskRB;
+    FixedText*			mpPage3PresTimeFT;
+    TimeField*			mpPage3PresTimeTMF;
+    FixedText*			mpPage3BreakFT;
+    TimeField*			mpPage3BreakTMF;
+    CheckBox*			mpPage3LogoCB;
+
+    // Seite 4
+    FixedBitmap*		mpPage4FB;
+    FixedLine*			mpPage4PersonalFL;
+    FixedText*			mpPage4AskNameFT;
+    Edit*				mpPage4AskNameEDT;
+    FixedText*			mpPage4AskTopicFT;
+    Edit*				mpPage4AskTopicEDT;
+    FixedText*			mpPage4AskInfoFT;
+    MultiLineEdit*		mpPage4AskInfoEDT;
+
+    // Seite 5
+    FixedBitmap*		mpPage5FB;
+    FixedText*			mpPage5PageListFT;
+    SdPageListControl*	mpPage5PageListCT;
+    CheckBox*			mpPage5SummaryCB;
+
+};
+
+
+
+// ====================================================================
+
+WriterAssistantDlgImpl::WriterAssistantDlgImpl( ::Window* pWindow, const Link& rFinishLink, BOOL bAutoPilot ) :
+    mpTemplateRegion(NULL),
+    mpLayoutRegion(NULL),
+    mbUserDataDirty(FALSE),
+    xDocShell (NULL),
+    mpWindowUpdater (new WindowUpdater()),
+    mbPreview(TRUE),
+    mnShowPage(0),
+    mbDocPreview(FALSE),
+    maWriterAssistantFunc(5),
+    maPreviewFlag(pWindow,SdResId(CB_PREVIEW)),
+    maStartWithFlag(pWindow,SdResId(CB_STARTWITH)),
+    maHelpButton(pWindow,SdResId(BUT_HELP)),
+    maCancelButton(pWindow,SdResId(BUT_CANCEL)),
+    maLastPageButton(pWindow,SdResId(BUT_LAST)),
+    maNextPageButton(pWindow,SdResId(BUT_NEXT)),
+    maFinishButton(pWindow,SdResId(BUT_FINISH)),
+    maPreview(pWindow,SdResId(CT_PREVIEW)),
+    maCreateStr(SdResId(STR_CREATE)),
+    maOpenStr(SdResId(STR_OPEN))
+{
+    maPageListFile += sal_Unicode('?'),
+    mbRecentDocumentsReady = FALSE;
+    mbTemplatesReady = FALSE;
+    mbPreviewUpdating = FALSE;
+
+    mpWindow = pWindow;
+
+    if(bAutoPilot)
+        maStartWithFlag.Hide();
+    else
+        maWriterAssistantFunc.InsertControl(1, &maStartWithFlag );
+
+    //page1 wird initialisiert und an die WriterAssistantenfunktionalitaet
+    //uebergeben
+    maWriterAssistantFunc.InsertControl(1, &maPreview );
+    maWriterAssistantFunc.InsertControl(1, &maPreviewFlag );
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1FB = new FixedBitmap(pWindow,SdResId(FB_PAGE1)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1ArtFL = new FixedLine(pWindow,SdResId(FL_PAGE1_ARTGROUP)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1EmptyRB=new RadioButton(pWindow,SdResId(RB_PAGE1_EMPTY)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1TemplateRB=new RadioButton(pWindow,SdResId(RB_PAGE1_TEMPLATE)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1OpenRB=new RadioButton(pWindow,SdResId(RB_PAGE1_OPEN)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1RegionLB = new ListBox(pWindow,SdResId(LB_PAGE1_REGION)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1TemplateLB=new ListBox(pWindow,SdResId(LB_PAGE1_TEMPLATES)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1OpenPB=new PushButton(pWindow,SdResId(PB_PAGE1_OPEN)));
+    maWriterAssistantFunc.InsertControl(1,
+        mpPage1OpenLB=new ListBox(pWindow,SdResId(LB_PAGE1_OPEN)));
+
+    // Align the button and list box displayed for the "open existing file"
+    // radio button with the text of that radio button.
+    {
+        RadioButton aEmptyRB (mpWindow);
+        sal_Int32 nIndent (aEmptyRB.CalcMinimumSize(0).Width());
+        sal_Int32 nLeft (mpPage1OpenRB->GetPosPixel().X() + nIndent);
+        sal_Int32 nWidth (mpPage1OpenRB->GetSizePixel().Width() - nIndent);
+        mpPage1OpenPB->SetPosSizePixel(
+            Point(nLeft, mpPage1OpenPB->GetPosPixel().Y()),
+            Size(mpPage1OpenPB->GetSizePixel()));
+        mpPage1OpenLB->SetPosSizePixel(
+            Point(nLeft, mpPage1OpenLB->GetPosPixel().Y()),
+            Size(nWidth, mpPage1OpenLB->GetSizePixel().Height()));
+    }
+
+    // Set text and icon of the 'Open...' button.
+    {
+        String sText (GetUiTextForCommand(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:Open"))));
+        // Remove the mnemonic and add a leading space so that icon and text
+        // are not too close together.
+        sText.SearchAndReplaceAll(String(RTL_CONSTASCII_STRINGPARAM("~")),String());
+        sText.Insert(String(RTL_CONSTASCII_STRINGPARAM(" ")),0);
+        mpPage1OpenPB->SetText(sText);
+        // Place icon left of text and both centered in the button.
+        mpPage1OpenPB->SetModeImage(
+            GetUiIconForCommand(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(".uno:Open"))),
+            BMP_COLOR_NORMAL);
+        mpPage1OpenPB->EnableImageDisplay(TRUE);
+        mpPage1OpenPB->EnableTextDisplay(TRUE);
+        mpPage1OpenPB->SetImageAlign(IMAGEALIGN_LEFT);
+        mpPage1OpenPB->SetStyle(mpPage1OpenPB->GetStyle() | WB_CENTER);
+    }
+
+    // links&handler
+    mpPage1RegionLB->SetSelectHdl(LINK(this,WriterAssistantDlgImpl,SelectRegionHdl));
+    mpPage1RegionLB->SetDropDownLineCount( 6 );
+    mpPage1TemplateLB->SetSelectHdl(LINK(this,WriterAssistantDlgImpl,SelectTemplateHdl));
+    mpPage1TemplateLB->InsertEntry(String(SdResId(STR_ISLOADING)));
+
+    mpPage1EmptyRB->SetClickHdl(LINK(this,WriterAssistantDlgImpl,StartTypeHdl));
+    mpPage1TemplateRB->SetClickHdl(LINK(this,WriterAssistantDlgImpl,StartTypeHdl));
+    mpPage1OpenRB->SetClickHdl(LINK(this,WriterAssistantDlgImpl,StartTypeHdl));
+    mpPage1OpenLB->SetSelectHdl(LINK(this,WriterAssistantDlgImpl,SelectFileHdl));
+    mpPage1OpenLB->SetDoubleClickHdl(rFinishLink);
+    mpPage1OpenPB->SetClickHdl(LINK(this,WriterAssistantDlgImpl,OpenButtonHdl));
+    //	mpPage1OpenLB->InsertEntry(String(SdResId(STR_WIZARD_POSITION)));
+
+    // Seite 2
+    maWriterAssistantFunc.InsertControl(2, &maPreview );
+    maWriterAssistantFunc.InsertControl(2, &maPreviewFlag );
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2FB = new FixedBitmap(pWindow,SdResId(FB_PAGE2)));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2LayoutFL = new FixedLine( pWindow, SdResId(FL_PAGE2_LAYOUT) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2RegionLB = new ListBox(pWindow,SdResId(LB_PAGE2_REGION) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2LayoutLB = new ListBox(pWindow,SdResId(LB_PAGE2_LAYOUT) ));
+
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2OutTypesFL = new FixedLine( pWindow, SdResId(FL_PAGE2_OUTPUTTYPES) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2Medium5RB = new RadioButton( pWindow, SdResId(RB_PAGE2_MEDIUM5) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2Medium3RB = new RadioButton( pWindow, SdResId(RB_PAGE2_MEDIUM3) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2Medium4RB = new RadioButton( pWindow, SdResId(RB_PAGE2_MEDIUM4) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2Medium1RB = new RadioButton( pWindow, SdResId(RB_PAGE2_MEDIUM1) ));
+    maWriterAssistantFunc.InsertControl(2,
+        mpPage2Medium2RB = new RadioButton( pWindow, SdResId(RB_PAGE2_MEDIUM2) ));
+    mpPage2Medium5RB->Check();
+
+    mpPage2RegionLB->SetSelectHdl(LINK(this,WriterAssistantDlgImpl,SelectRegionHdl));
+    mpPage2RegionLB->SetDropDownLineCount( 6 );
+    mpPage2LayoutLB->SetSelectHdl(LINK(this,WriterAssistantDlgImpl,SelectLayoutHdl));
+    mpPage2LayoutLB->InsertEntry(String(SdResId(STR_ISLOADING)));
+
+    // Seite 3
+    maWriterAssistantFunc.InsertControl(3, &maPreview );
+    maWriterAssistantFunc.InsertControl(3, &maPreviewFlag );
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3FB = new FixedBitmap(pWindow,SdResId(FB_PAGE3)));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3EffectFL = new FixedLine( pWindow, SdResId(FL_PAGE3_EFFECT) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3EffectFT = new FixedText( pWindow, SdResId(FT_PAGE3_EFFECT) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3EffectLB = new FadeEffectLB( pWindow, SdResId(LB_PAGE3_EFFECT) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3SpeedFT = new FixedText( pWindow, SdResId(FT_PAGE3_SPEED) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3SpeedLB = new FadeEffectLB( pWindow, SdResId(LB_PAGE3_SPEED) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3PresTypeFL = new FixedLine( pWindow, SdResId(FL_PAGE3_PRESTYPE) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3PresTypeLiveRB = new RadioButton( pWindow, SdResId(RB_PAGE3_LIVE) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3PresTypeKioskRB = new RadioButton( pWindow, SdResId(RB_PAGE3_KIOSK) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3PresTimeFT = new FixedText( pWindow, SdResId( FT_PAGE3_TIME) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3PresTimeTMF = new TimeField( pWindow, SdResId( TMF_PAGE3_TIME) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3BreakFT = new FixedText( pWindow, SdResId( FT_PAGE3_BREAK) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3BreakTMF = new TimeField( pWindow, SdResId( TMF_PAGE3_BREAK) ));
+    maWriterAssistantFunc.InsertControl(3,
+        mpPage3LogoCB = new CheckBox( pWindow, SdResId( CB_PAGE3_LOGO) ));
+
+    mpPage3EffectLB->Fill();
+//	mpPage3EffectLB->SelectEffect( presentation::FadeEffect_NONE );
+    mpPage3EffectLB->SetSelectHdl( LINK(this,WriterAssistantDlgImpl,SelectEffectHdl ));
+    mpPage3EffectLB->SetDropDownLineCount( 12 );
+
+    mpPage3SpeedLB->InsertEntry( String( SdResId(STR_SLOW) ));
+    mpPage3SpeedLB->InsertEntry( String( SdResId(STR_MEDIUM) ));
+    mpPage3SpeedLB->InsertEntry( String( SdResId(STR_FAST) ));
+    mpPage3SpeedLB->SetDropDownLineCount( 3 );
+    mpPage3SpeedLB->SetSelectHdl( LINK(this,WriterAssistantDlgImpl,SelectEffectHdl ));
+    mpPage3SpeedLB->SelectEntryPos( 1 );
+
+    mpPage3PresTypeLiveRB->Check();
+    mpPage3PresTypeLiveRB->SetClickHdl( LINK(this,WriterAssistantDlgImpl, PresTypeHdl ));
+    mpPage3PresTypeKioskRB->SetClickHdl( LINK(this,WriterAssistantDlgImpl, PresTypeHdl ));
+    mpPage3PresTimeTMF->SetFormat( TIMEF_SEC );
+    mpPage3PresTimeTMF->SetTime( Time( 0, 0, 10 ) );
+    mpPage3BreakTMF->SetFormat( TIMEF_SEC );
+    mpPage3BreakTMF->SetTime( Time( 0, 0, 10 ) );
+    mpPage3LogoCB->Check();
+
+    // set cursor in timefield
+    Edit *pEditPage3PresTimeTMF = mpPage3PresTimeTMF->GetField();
+    Edit *pEditPage3BreakTMF = mpPage3BreakTMF->GetField();
+    Selection aSel1( pEditPage3PresTimeTMF->GetMaxTextLen(), pEditPage3PresTimeTMF->GetMaxTextLen() );
+    Selection aSel2( pEditPage3BreakTMF->GetMaxTextLen(), pEditPage3BreakTMF->GetMaxTextLen() );
+    pEditPage3PresTimeTMF->SetSelection( aSel1 );
+    pEditPage3BreakTMF->SetSelection( aSel2 );
+
+    // Seite 4
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4FB = new FixedBitmap(pWindow,SdResId(FB_PAGE4)));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4PersonalFL = new FixedLine( pWindow, SdResId(FL_PAGE4_PERSONAL) ));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4AskNameFT   = new FixedText( pWindow, SdResId(FT_PAGE4_ASKNAME) ));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4AskNameEDT  = new Edit( pWindow, SdResId(EDT_PAGE4_ASKNAME) ));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4AskTopicFT= new FixedText( pWindow, SdResId(FT_PAGE4_ASKTOPIC) ));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4AskTopicEDT = new Edit( pWindow, SdResId(EDT_PAGE4_ASKTOPIC) ));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4AskInfoFT   = new FixedText( pWindow, SdResId(FT_PAGE4_ASKINFORMATION) ));
+    maWriterAssistantFunc.InsertControl(4,
+        mpPage4AskInfoEDT  = new MultiLineEdit( pWindow, SdResId(EDT_PAGE4_ASKINFORMATION) ));
+
+    mpPage4AskNameEDT->SetModifyHdl(LINK(this,WriterAssistantDlgImpl,UpdateUserDataHdl));
+    mpPage4AskTopicEDT->SetModifyHdl(LINK(this,WriterAssistantDlgImpl,UpdateUserDataHdl));
+    mpPage4AskInfoEDT->SetModifyHdl(LINK(this,WriterAssistantDlgImpl,UpdateUserDataHdl));
+
+    // page 5
+    maWriterAssistantFunc.InsertControl(5, &maPreview );
+    maWriterAssistantFunc.InsertControl(5, &maPreviewFlag );
+    maWriterAssistantFunc.InsertControl(5,
+        mpPage5FB = new FixedBitmap(pWindow,SdResId(FB_PAGE5)));
+    maWriterAssistantFunc.InsertControl(5,
+        mpPage5PageListFT = new FixedText( pWindow, SdResId( FT_PAGE5_PAGELIST ) ));
+    maWriterAssistantFunc.InsertControl(5,
+        mpPage5PageListCT = new SdPageListControl( pWindow, SdResId( CT_PAGE5_PAGELIST ) ));
+    maWriterAssistantFunc.InsertControl(5,
+        mpPage5SummaryCB  = new CheckBox( pWindow, SdResId( CB_PAGE5_SUMMARY ) ));
+
+    mpPage5PageListCT->SetSelectHdl(LINK(this,WriterAssistantDlgImpl, PageSelectHdl));
+
+
+    // generell
+    InterpolateFixedBitmap( mpPage1FB );
+    InterpolateFixedBitmap( mpPage2FB );
+    InterpolateFixedBitmap( mpPage3FB );
+    InterpolateFixedBitmap( mpPage4FB );
+    InterpolateFixedBitmap( mpPage5FB );
+
+    maLastPageButton.SetClickHdl(LINK(this,WriterAssistantDlgImpl, LastPageHdl ));
+    maNextPageButton.SetClickHdl(LINK(this,WriterAssistantDlgImpl, NextPageHdl ));
+
+    maPreviewFlag.Check( mbPreview );
+    maPreviewFlag.SetClickHdl(LINK(this, WriterAssistantDlgImpl, PreviewFlagHdl ));
+    maPreview.SetClickHdl(LINK(this,WriterAssistantDlgImpl, EffectPreviewHdl ));
+
+    //setzt die Ausgangsseite
+    maWriterAssistantFunc.GotoPage(1);
+    maLastPageButton.Disable();
+
+    maPrevTimer.SetTimeout( 200 );
+    maPrevTimer.SetTimeoutHdl( LINK( this, WriterAssistantDlgImpl, UpdatePreviewHdl));
+
+    maEffectPrevTimer.SetTimeout( 50 );
+    maEffectPrevTimer.SetTimeoutHdl( LINK( this, WriterAssistantDlgImpl, EffectPreviewHdl ));
+
+    maUpdatePageListTimer.SetTimeout( 50 );
+    maUpdatePageListTimer.SetTimeoutHdl( LINK( this, WriterAssistantDlgImpl, UpdatePageListHdl));
+
+    SetStartType( ST_EMPTY );
+
+    ChangePage();
+
+    mpWindowUpdater->RegisterWindow (&maPreview);
+
+    UpdatePreview( TRUE );
+
+    //check wether we should start with a template document initialy and preselect it
+    const ::rtl::OUString aServiceName( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.presentation.PresentationDocument" ) );
+    String aStandardTemplate( SfxObjectFactory::GetStandardTemplate( aServiceName ) );
+    if( aStandardTemplate.Len() )
+    {
+        ProvideTemplates();
+
+        //find aStandardTemplate in maPresentList
+        TemplateDir*   pStandardTemplateDir = 0;
+        TemplateEntry* pStandardTemplateEntry = 0;
+
+        std::vector<TemplateDir*>::iterator	I;
+        for (I=maPresentList.begin(); I!=maPresentList.end(); I++)
+        {
+            TemplateDir* pDir = *I;
+            std::vector<TemplateEntry*>::iterator	J;
+            for (J=pDir->maEntries.begin(); J!=pDir->maEntries.end(); J++)
+            {
+                TemplateEntry* pEntry = *J;
+                if(pEntry->msPath == aStandardTemplate)
+                {
+                    pStandardTemplateDir = pDir;
+                    pStandardTemplateEntry = pEntry;
+                    break;
+                }
+            }
+            if(pStandardTemplateDir)
+                break;
+        }
+
+        //preselect template
+        if( pStandardTemplateDir && pStandardTemplateEntry )
+        {
+            mpPage1RegionLB->SelectEntry( pStandardTemplateDir->msRegion );
+            SelectTemplateRegion( pStandardTemplateDir->msRegion );
+            mpPage1TemplateLB->SelectEntry( pStandardTemplateEntry->msTitle );
+            SelectTemplateHdl(mpPage1TemplateLB);
+        }
+    }
+}
+
+
+
+
+WriterAssistantDlgImpl::~WriterAssistantDlgImpl()
+{
+    CloseDocShell();
+
+    DeletePassords();
+
+    //	Delete the template file infos.
+    std::vector<TemplateDir*>::iterator	I;
+    std::vector<TemplateEntry*>::iterator	J;
+    for (I=maPresentList.begin(); I!=maPresentList.end(); I++)
+    {
+        for (J=(*I)->maEntries.begin(); J!=(*I)->maEntries.end(); J++)
+            delete (*J);
+        delete (*I);
+    }
+
+    // Seite 1
+    delete mpPage1FB;
+    delete mpPage1ArtFL;
+    delete mpPage1EmptyRB;
+    delete mpPage1TemplateRB;
+    delete mpPage1TemplateLB;
+    delete mpPage1RegionLB;
+    delete mpPage1OpenRB;
+    delete mpPage1OpenLB;
+    delete mpPage1OpenPB;
+
+    // Seite 2
+    delete mpPage2FB;
+    delete mpPage2LayoutFL;
+    delete mpPage2RegionLB;
+    delete mpPage2LayoutLB;
+    delete mpPage2OutTypesFL;
+    delete mpPage2Medium1RB;
+    delete mpPage2Medium2RB;
+    delete mpPage2Medium3RB;
+    delete mpPage2Medium4RB;
+    delete mpPage2Medium5RB;
+
+    // Seite 3
+    delete mpPage3FB;
+    delete mpPage3EffectFL;
+    delete mpPage3EffectFT;
+    delete mpPage3EffectLB;
+    delete mpPage3SpeedFT;
+    delete mpPage3SpeedLB;
+    delete mpPage3PresTypeFL;
+    delete mpPage3PresTypeLiveRB;
+    delete mpPage3PresTypeKioskRB;
+    delete mpPage3PresTimeFT;
+    delete mpPage3PresTimeTMF;
+    delete mpPage3BreakFT;
+    delete mpPage3BreakTMF;
+    delete mpPage3LogoCB;
+
+    // Seite 4
+    delete mpPage4FB;
+    delete mpPage4PersonalFL;
+    delete mpPage4AskNameFT;
+    delete mpPage4AskNameEDT;
+    delete mpPage4AskTopicFT;
+    delete mpPage4AskTopicEDT;
+    delete mpPage4AskInfoFT;
+    delete mpPage4AskInfoEDT;
+
+    // Seite 5
+    delete mpPage5FB;
+    delete mpPage5PageListFT;
+    delete mpPage5PageListCT;
+    delete mpPage5SummaryCB;
+
+    //	Delete the file history list.
+    std::vector<String*>::iterator	I2;
+    for (I2=maOpenFilesList.begin(); I2!=maOpenFilesList.end(); I2++)
+        delete *I2;
+}
+
+void WriterAssistantDlgImpl::CloseDocShell()
+{
+    if(xDocShell.Is())
+    {
+        //uno::Reference< lang::XComponent > xModel( xDocShell->GetModel(), uno::UNO_QUERY );
+        uno::Reference< util::XCloseable > xCloseable( xDocShell->GetModel(), uno::UNO_QUERY );
+        //if( xModel.is() )
+        if( xCloseable.is() )
+        {
+            xCloseable->close( sal_True );
+            xDocShell = NULL;
+            //xModel->dispose();
+        }
+        else
+        {
+            xDocShell->DoClose();
+            xDocShell = NULL;
+        }
+    }
+}
+
+void WriterAssistantDlgImpl::EndDialog( long )
+{
+    mpWindow = NULL;
+}
+
+
+
+
+void	WriterAssistantDlgImpl::ScanDocmenu	(void)
+{
+    if( mbRecentDocumentsReady )
+        return;
+
+    uno::Sequence<uno::Sequence<beans::PropertyValue> > aHistory =
+        SvtHistoryOptions().GetList (ePICKLIST);
+
+    uno::Reference< lang::XMultiServiceFactory > xFactory( ::comphelper::getProcessServiceFactory() );
+    uno::Reference< container::XNameAccess > xFilterFactory( xFactory->createInstance( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "com.sun.star.document.FilterFactory" ) ) ), uno::UNO_QUERY );
+
+    Reference< ::com::sun::star::ucb::XSimpleFileAccess > xFileAccess(
+        xFactory->createInstance(
+            ::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("com.sun.star.ucb.SimpleFileAccess"))),
+        UNO_QUERY_THROW);
+
+    sal_uInt32 nCount = aHistory.getLength();
+    for (sal_uInt32 nItem=0; nItem<nCount; ++nItem)
+    {
+        //	Get the current history item's properties.
+        uno::Sequence<beans::PropertyValue> aPropertySet = aHistory[nItem];
+        rtl::OUString	sURL;
+        rtl::OUString	sFilter;
+        rtl::OUString	sTitle;
+        rtl::OUString	sPassword;
+        sal_uInt32 nPropertyCount = aPropertySet.getLength();
+        for (sal_uInt32 nProperty=0; nProperty<nPropertyCount; ++nProperty)
+            if (aPropertySet[nProperty].Name == HISTORY_PROPERTYNAME_URL)
+                aPropertySet[nProperty].Value >>= sURL;
+            else if (aPropertySet[nProperty].Name == HISTORY_PROPERTYNAME_FILTER)
+                aPropertySet[nProperty].Value >>= sFilter;
+            else if (aPropertySet[nProperty].Name == HISTORY_PROPERTYNAME_TITLE)
+                aPropertySet[nProperty].Value >>= sTitle;
+            else if (aPropertySet[nProperty].Name == HISTORY_PROPERTYNAME_PASSWORD)
+                aPropertySet[nProperty].Value >>= sPassword;
+
+        //	If the entry is an impress file then insert it into the
+        //	history list and the list box.
+        uno::Sequence< beans::PropertyValue > lProps;
+        if (xFilterFactory->hasByName(sFilter))
+        {
+            uno::Any aFilterPropSet = xFilterFactory->getByName( sFilter );
+            aFilterPropSet >>= lProps;
+        }
+
+        sal_Int32 nPropCount = lProps.getLength();
+        rtl::OUString sFactoryName;
+        for( sal_Int32 i=0; i<nPropCount; ++i )
+        {
+            if( lProps[i].Name.compareToAscii( "DocumentService" ) == 0 &&
+                (lProps[i].Value >>= sFactoryName) &&
+                sFactoryName.compareToAscii( "com.sun.star.presentation.PresentationDocument" ) == 0 )
+            {
+                // yes, it's an impress document
+                INetURLObject aURL;
+
+                // Do not include the file if it does not exist.
+                if (xFileAccess.is() && ! xFileAccess->exists(sURL))
+                    continue;
+
+                aURL.SetSmartURL (sURL);
+                // The password is set only when it is not empty.
+                if (sPassword.getLength() > 0)
+                    aURL.SetPass (sPassword);
+                maOpenFilesList.push_back (new String (aURL.GetMainURL( INetURLObject::NO_DECODE )));
+                mpPage1OpenLB->InsertEntry (sTitle);
+                break;
+            }
+        }
+    }
+    mbRecentDocumentsReady = TRUE;
+    try
+    {
+        UpdatePreview(TRUE);
+    }
+    catch (uno::RuntimeException& )
+    {
+        // Ignore all exceptions.
+    }
+}
+
+
+
+void WriterAssistantDlgImpl::ProvideTemplates (void)
+{
+    if ( ! mbTemplatesReady)
+    {
+        TemplateScanner aScanner;
+        aScanner.Scan ();
+        TemplateScanDone (aScanner.GetFolderList());
+
+        try
+        {
+            UpdatePreview(TRUE);
+        }
+        catch (uno::RuntimeException& e)
+        {
+            // Ignore all exceptions.
+            (void) e;
+        }
+    }
+}
+
+void WriterAssistantDlgImpl::TemplateScanDone (
+    std::vector<TemplateDir*>& rTemplateFolder)
+{
+    //	This method is called from a thread.  Therefore we get the solar mutex.
+    ::vos::OGuard aGuard (Application::GetSolarMutex());
+
+    // Copy the contents of the given template folders to a local list.
+    maPresentList.swap (rTemplateFolder);
+
+    //	Fill in the list box on the first page.
+    int nFirstEntry = 0;
+    mpPage1RegionLB->Clear();
+    std::vector<TemplateDir*>::iterator	I;
+    int	i;
+    for (i=0,I=maPresentList.begin(); I!=maPresentList.end(); I++,i++)
+    {
+        TemplateDir* pDir = *I;
+        if (pDir == NULL)
+            continue;
+        
+        // HACK! presnt directory is always initially selected.
+        // We have to look at the first entry to get a URL.
+        if (pDir->maEntries.size() > 0)
+        {
+            TemplateEntry* pEntry = pDir->maEntries.front();
+            if (pEntry != NULL)
+                if (pEntry->msPath.SearchAscii("presnt") != STRING_NOTFOUND)
+                    nFirstEntry = i;
+        }
+
+        mpPage1RegionLB->InsertEntry (pDir->msRegion);
+    }
+    mpPage1RegionLB->SelectEntryPos ((USHORT)nFirstEntry);
+    mpPage1RegionLB->Update();
+    SelectTemplateRegion (mpPage1RegionLB->GetSelectEntry());
+
+    //	Fill in the list box on the second page.
+    nFirstEntry = 0;
+    mpPage2RegionLB->Clear();
+    for (i=0,I=maPresentList.begin(); I!=maPresentList.end(); I++,i++)
+    {
+        TemplateDir* pDir = *I;
+        if (pDir == NULL)
+            continue;
+        
+        // HACK! layout directory is always initially selected.
+        // We have to look at the first entry to get a URL.
+        if (pDir->maEntries.size() > 0)
+        {
+            TemplateEntry* pEntry = pDir->maEntries.front();
+            if (pEntry != NULL)
+                if (pEntry->msPath.SearchAscii("layout") != STRING_NOTFOUND)
+                    nFirstEntry = i;
+        }
+
+        mpPage2RegionLB->InsertEntry (pDir->msRegion);
+    }
+    mpPage2RegionLB->SelectEntryPos ((USHORT)nFirstEntry);
+    mpPage2RegionLB->Update();
+    SelectLayoutRegion (mpPage2RegionLB->GetSelectEntry());
+
+    //	Make the changes visible.
+    mbTemplatesReady = TRUE;
+    if (mpWindow)
+        UpdatePage();
+}
+
+
+
+
+// ********************************************************************
+// Status Methoden
+// ********************************************************************
+
+void WriterAssistantDlgImpl::SetStartType( StartType eType )
+{
+    mpPage1EmptyRB->SetState( eType == ST_EMPTY );
+    mpPage1TemplateRB->SetState( eType == ST_TEMPLATE );
+    mpPage1OpenRB->SetState( eType == ST_OPEN );
+    maNextPageButton.Enable( eType != ST_OPEN );
+
+    mpPage1RegionLB->Show(eType == ST_TEMPLATE);
+    mpPage1TemplateLB->Show(eType == ST_TEMPLATE);
+    mpPage1OpenLB->Show(eType == ST_OPEN);
+    mpPage1OpenPB->Show(eType == ST_OPEN);
+    
+    if (eType == ST_OPEN)
+        maFinishButton.SetText(maOpenStr);
+    else
+        maFinishButton.SetText(maCreateStr);	
+}
+
+StartType WriterAssistantDlgImpl::GetStartType()
+{
+    if( mpPage1EmptyRB->IsChecked() )
+        return ST_EMPTY;
+    else if( mpPage1TemplateRB->IsChecked() )
+        return ST_TEMPLATE;
+    else
+        return ST_OPEN;
+}
+
+String WriterAssistantDlgImpl::GetDocFileName()
+{
+    String aTitle;
+    if(mpWindow)
+    {
+        aTitle = mpWindow->GetText();
+        USHORT nPos = aTitle.Search(sal_Unicode('('));
+        if(nPos != STRING_NOTFOUND)
+            aTitle.Erase( nPos-1 );
+    }
+
+    String aDocFile;
+    if( GetStartType() == ST_TEMPLATE )
+    {
+        const USHORT nEntry = mpPage1TemplateLB->GetSelectEntryPos();
+        TemplateEntry* pEntry = NULL;
+        if(nEntry != (USHORT)-1)
+            pEntry = mpTemplateRegion->maEntries[nEntry];
+
+        if(pEntry)
+        {
+            aDocFile = pEntry->msPath;
+
+            aTitle.AppendAscii( RTL_CONSTASCII_STRINGPARAM(  " (" ) );
+            aTitle.Append( pEntry->msTitle );
+            aTitle.Append( sal_Unicode(')') );
+        }
+    }
+    else if( GetStartType() == ST_OPEN )
+    {
+        const USHORT nEntry = mpPage1OpenLB->GetSelectEntryPos();
+        if(nEntry != (USHORT)-1 )
+            aDocFile = *maOpenFilesList[nEntry];
+    }
+
+    if(mpWindow)
+        mpWindow->SetText(aTitle);
+
+    return aDocFile;
+}
+
+String WriterAssistantDlgImpl::GetLayoutFileName()
+{
+    String aFile;
+    const USHORT nEntry = mpPage2LayoutLB->GetSelectEntryPos();
+    TemplateEntry* pEntry = NULL;
+    if(nEntry != (USHORT)-1 && nEntry > 0)
+        pEntry = mpLayoutRegion->maEntries[nEntry-1];
+
+    if(pEntry)
+        aFile = pEntry->msPath;
+
+    return aFile;
+}
+
+SfxObjectShellLock WriterAssistantDlgImpl::GetDocument()
+{
+//	mbPreview = FALSE;		// Document nicht anzeigen
+    UpdatePreview(FALSE);	// aber komplett laden
+    UpdatePageList();
+
+    SfxObjectShell* pShell = xDocShell;
+    ::sd::DrawDocShell* pDocShell = PTR_CAST(::sd::DrawDocShell,pShell);
+    SdDrawDocument* pDoc = pDocShell?pDocShell->GetDoc():NULL;
+
+    if(pDoc)
+    {
+        const USHORT nPageCount = pDoc->GetSdPageCount(PK_STANDARD);
+        BOOL bKiosk = mpPage3PresTypeKioskRB->IsChecked();
+        UINT32 nNewTime = (UINT32)mpPage3PresTimeTMF->GetTime().GetMSFromTime() / 1000;
+        if(bKiosk)
+        {
+            PresentationSettings& rSettings = pDoc->getPresentationSettings();
+            rSettings.mbEndless = bKiosk;
+            rSettings.mnPauseTimeout = (sal_Int32)mpPage3BreakTMF->GetTime().GetMSFromTime() / 1000;
+            rSettings.mbShowPauseLogo = mpPage3LogoCB->IsChecked();
+        }
+
+        USHORT nPgAbsNum = 0;
+        USHORT nPgRelNum = 0;
+        while( nPgAbsNum < nPageCount )
+        {
+            SdPage* pPage = pDoc->GetSdPage( nPgRelNum, PK_STANDARD );
+            if( mpPage5PageListCT->IsPageChecked(nPgAbsNum) )
+            {
+                mpPage3EffectLB->applySelected(pPage);
+                const sal_uInt16 nPos = mpPage3SpeedLB->GetSelectEntryPos();
+                pPage->setTransitionDuration( (nPos == 0) ? 3.0 : (nPos == 1) ? 2.0 : 1.0 );
+                if(bKiosk)
+                {
+                    pPage->SetPresChange( PRESCHANGE_AUTO );
+                    pPage->SetTime(nNewTime);
+                }
+                nPgRelNum++;
+            }
+            else
+            {
+                // diese Seite loeschen
+                pDoc->DeletePage( (nPgRelNum << 1) + 2 ); // Notizseite loeschen
+                pDoc->DeletePage( (nPgRelNum << 1) + 1 );	// Seite loeschen
+            }
+
+            nPgAbsNum++;
+        }
+    }
+    else
+    {
+        DBG_ERROR("sd::WriterAssistantDlgImpl::GetDocument(), no template?");
+    }
+
+    SfxObjectShellLock xRet = xDocShell;
+    xDocShell = NULL;
+
+    return xRet;
+}
+
+void WriterAssistantDlgImpl::LeavePage()
+{
+    int nPage = maWriterAssistantFunc.GetCurrentPage();
+
+    if( nPage == 4 && mbUserDataDirty )
+        maPrevTimer.Start();
+}
+
+void WriterAssistantDlgImpl::ChangePage()
+{
+    maNextPageButton.Enable(!maWriterAssistantFunc.IsLastPage());
+    maLastPageButton.Enable(!maWriterAssistantFunc.IsFirstPage());
+
+    USHORT nPage = (USHORT)maWriterAssistantFunc.GetCurrentPage();
+
+    if( mpWindow )
+        mpWindow->SetHelpId( PageHelpIds[nPage-1]);
+
+    UpdatePage();
+
+    if( maNextPageButton.IsEnabled() )
+    {
+      maNextPageButton.ForceFocusEventBroadcast();
+    }
+    else
+        maFinishButton.GrabFocus();
+}
+
+void WriterAssistantDlgImpl::UpdatePage()
+{
+    USHORT nPage = (USHORT)maWriterAssistantFunc.GetCurrentPage();
+
+    switch(nPage)
+    {
+    case 1:
+        {
+            // Elemente auf der ersten Seite abhaengig vom Starttype Zeigen
+            SetStartType( GetStartType() );
+            mpPage1TemplateRB->Enable(TRUE /*mbTemplatesReady*/);
+            break;
+        }
+
+    case 2:
+        {
+            mpPage2RegionLB->Enable(mbTemplatesReady);
+            mpPage2LayoutLB->Enable(mbTemplatesReady);
+
+            if( GetStartType() != ST_EMPTY )
+            {
+                mpPage2Medium5RB->Enable( TRUE );
+            }
+            else
+            {
+                mpPage2Medium5RB->Enable( FALSE );
+                if(mpPage2Medium5RB->IsChecked())
+                    mpPage2Medium1RB->Check();
+            }
+
+            break;
+        }
+    case 5:
+        {
+            if(mbDocPreview || maPageListFile != maDocFile)
+                mpPage5PageListCT->Clear();
+
+            maUpdatePageListTimer.Start();
+            break;
+        }
+
+    case 3:
+        {
+            if(GetStartType() != ST_TEMPLATE)
+                maNextPageButton.Enable(false);
+
+            BOOL bKiosk = mpPage3PresTypeKioskRB->IsChecked();
+            mpPage3PresTimeFT->Enable(bKiosk);
+            mpPage3BreakFT->Enable(bKiosk);
+            mpPage3PresTimeTMF->Enable(bKiosk);
+            mpPage3BreakTMF->Enable(bKiosk);
+            mpPage3LogoCB->Enable(bKiosk);
+            break;
+        }
+    }
+}
+
+// ********************************************************************
+// UI-Handler
+// ********************************************************************
+
+IMPL_LINK( WriterAssistantDlgImpl, SelectRegionHdl, ListBox *, pLB )
+{
+    if( pLB == mpPage1RegionLB )
+    {
+        SelectTemplateRegion( pLB->GetSelectEntry() );
+        SetStartType( ST_TEMPLATE );
+        mpPage2Medium5RB->Check();
+    }
+    else
+    {
+        SelectLayoutRegion( pLB->GetSelectEntry() );
+    }
+
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, SelectEffectHdl, void*, EMPTYARG )
+{
+    maEffectPrevTimer.Start();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, OpenButtonHdl, Button*, pButton )
+{
+    // Clear the selection and forward the call.
+    mpPage1OpenLB->SetNoSelection();
+    return mpPage1OpenLB->GetDoubleClickHdl().Call(pButton);
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, EffectPreviewHdl, Button *, EMPTYARG )
+{
+    if(mbPreview && xDocShell.Is() )
+    {
+        SfxObjectShell* pShell = xDocShell;
+        DrawDocShell* pDocShell = dynamic_cast< DrawDocShell * >(pShell);
+        if( pDocShell )
+        {
+            SdDrawDocument* pDoc = pDocShell->GetDoc();
+            if( pDoc )
+            {
+                SdPage* pPage = pDoc->GetSdPage( mnShowPage, PK_STANDARD );
+                if( pPage )
+                    mpPage3EffectLB->applySelected(pPage);
+            }
+        }
+        maPreview.startPreview();
+    }
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, PreviewFlagHdl, CheckBox *, EMPTYARG )
+
+{
+    if( maPreviewFlag.IsChecked() != mbPreview )
+    {
+        mbPreview = maPreviewFlag.IsChecked();
+        UpdatePreview(TRUE);
+    }
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, SelectTemplateHdl, ListBox *, EMPTYARG )
+{
+    SetStartType( ST_TEMPLATE );
+    mpPage2Medium5RB->Check();
+    mpPage2LayoutLB->SelectEntryPos(0);
+    maPrevTimer.Start();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, SelectLayoutHdl, ListBox *, EMPTYARG )
+{
+    maPrevTimer.Start();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, SelectFileHdl, ListBox *, EMPTYARG )
+{
+    SetStartType( ST_OPEN );
+    maPrevTimer.Start();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, PageSelectHdl, Control *, EMPTYARG )
+{
+    USHORT nPage = mpPage5PageListCT->GetSelectedPage();
+    if( mnShowPage != nPage )
+    {
+        mnShowPage = nPage;
+        UpdatePreview(FALSE);
+    }
+
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, UpdatePageListHdl, void *, EMPTYARG )
+{
+    UpdatePageList();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, UpdatePreviewHdl, void *, EMPTYARG )
+{
+    UpdatePreview( TRUE );
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, StartTypeHdl, RadioButton *, pButton )
+{
+    StartType eType = pButton == mpPage1EmptyRB?ST_EMPTY:pButton == mpPage1TemplateRB?ST_TEMPLATE:ST_OPEN;
+
+    if(eType == ST_TEMPLATE)
+        ProvideTemplates();
+    else if(eType == ST_OPEN)
+        ScanDocmenu();
+
+    SetStartType( eType );
+
+    if(eType == ST_TEMPLATE)
+    {
+        mpPage1TemplateLB->SelectEntryPos(0);
+        mpPage2Medium5RB->Check();
+    }
+    else if(eType == ST_OPEN)
+        mpPage1OpenLB->SelectEntryPos(0);
+
+    maPrevTimer.Start();
+    return 0;
+}
+
+
+IMPL_LINK( WriterAssistantDlgImpl, NextPageHdl, PushButton *, EMPTYARG )
+{
+    // When changing from the first to the second page make sure that the
+    // templates are present.
+    if (maWriterAssistantFunc.GetCurrentPage() == 1)
+        ProvideTemplates();
+
+    // Change to the next page.
+    LeavePage();
+    maWriterAssistantFunc.NextPage();
+    ChangePage();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, LastPageHdl, PushButton *, EMPTYARG )
+{
+    LeavePage();
+    maWriterAssistantFunc.PreviousPage();
+    ChangePage();
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, PresTypeHdl, RadioButton*, EMPTYARG )
+{
+    if(maDocFile.Len() == 0)
+      {
+        maNextPageButton.Enable(false);
+      }
+
+    BOOL bKiosk = mpPage3PresTypeKioskRB->IsChecked();
+    mpPage3PresTimeFT->Enable(bKiosk);
+    mpPage3BreakFT->Enable(bKiosk);
+    mpPage3PresTimeTMF->Enable(bKiosk);
+    mpPage3BreakTMF->Enable(bKiosk);
+    mpPage3LogoCB->Enable(bKiosk);
+    return 0;
+}
+
+IMPL_LINK( WriterAssistantDlgImpl, UpdateUserDataHdl, Edit*, EMPTYARG )
+{
+    mbUserDataDirty = TRUE;
+    String aTopic = mpPage4AskTopicEDT->GetText();
+    String aName  = mpPage4AskNameEDT->GetText();
+    String aInfo  = mpPage4AskInfoEDT->GetText();
+
+    if(aTopic.Len() == 0 && aName.Len() == 0 && aInfo.Len() == 0)
+        maDocFile.Erase();
+
+    return 0;
+}
+
+// ********************************************************************
+// ********************************************************************
+
+void WriterAssistantDlgImpl::SelectTemplateRegion( const String& rRegion )
+{
+    mpPage1TemplateLB->Clear();
+    std::vector<TemplateDir*>::iterator	I;
+    for (I=maPresentList.begin(); I!=maPresentList.end(); I++)
+    {
+        TemplateDir * pDir = *I;
+        mpTemplateRegion = *I;
+        if (pDir->msRegion.Equals( rRegion ) )
+        {
+            std::vector<TemplateEntry*>::iterator	J;
+            for (J=pDir->maEntries.begin(); J!=pDir->maEntries.end(); J++)
+                mpPage1TemplateLB->InsertEntry ((*J)->msTitle);
+            mpPage1TemplateLB->Update();
+            if(GetStartType() == ST_TEMPLATE)
+            {
+                mpPage1TemplateLB->SelectEntryPos( 0 );
+                SelectTemplateHdl(NULL);
+            }
+            break;
+        }
+    }
+}
+
+void WriterAssistantDlgImpl::SelectLayoutRegion( const String& rRegion )
+{
+    mpPage2LayoutLB->Clear();
+    mpPage2LayoutLB->InsertEntry(String(SdResId(STR_WIZARD_ORIGINAL)));
+    std::vector<TemplateDir*>::iterator	I;
+    for (I=maPresentList.begin(); I!=maPresentList.end(); I++)
+    {
+        TemplateDir * pDir = *I;
+        mpLayoutRegion = *I;
+
+        if (pDir->msRegion.Equals (rRegion))
+        {
+            std::vector<TemplateEntry*>::iterator	J;
+            for (J=pDir->maEntries.begin(); J!=pDir->maEntries.end(); J++)
+                mpPage2LayoutLB->InsertEntry ((*J)->msTitle);
+            mpPage2LayoutLB->Update();
+            break;
+        }
+    }
+}
+
+void WriterAssistantDlgImpl::UpdateUserData()
+{
+    String aTopic = mpPage4AskTopicEDT->GetText();
+    String aName  = mpPage4AskNameEDT->GetText();
+    String aInfo  = mpPage4AskInfoEDT->GetText();
+
+    SfxObjectShell* pShell = xDocShell;
+    DrawDocShell* pDocShell = PTR_CAST(DrawDocShell,pShell);
+    SdDrawDocument* pDoc = pDocShell?pDocShell->GetDoc():NULL;
+    SdPage* pPage = pDoc?pDoc->GetSdPage(0, PK_STANDARD):NULL;
+
+    if(pPage && ( aTopic.Len() != 0 || aName.Len() != 0 || aInfo.Len() != 0 ) )
+    {
+        if( pPage->GetAutoLayout() == AUTOLAYOUT_NONE )
+            pPage->SetAutoLayout(AUTOLAYOUT_TITLE, TRUE);
+
+        SdrTextObj* pObj;
+        String aEmptyString;
+
+        if( aTopic.Len() )
+        {
+            pObj  = dynamic_cast<SdrTextObj*>( pPage->GetPresObj( PRESOBJ_TITLE ) );
+            if( pObj )
+            {
+                pPage->SetObjText( pObj, NULL, PRESOBJ_TITLE, aTopic );
+                pObj->NbcSetStyleSheet( pPage->GetStyleSheetForPresObj( PRESOBJ_TITLE ), TRUE );
+                pObj->SetEmptyPresObj(FALSE);
+            }
+
+        }
+
+        if ( aName.Len() || aInfo.Len() )
+        {
+            String aStrTmp( aName );
+            if( aName.Len() )
+                aStrTmp.AppendAscii( RTL_CONSTASCII_STRINGPARAM( "\n\n" ) );
+            aStrTmp.Append( aInfo );
+
+            pObj = dynamic_cast<SdrTextObj*>( pPage->GetPresObj( PRESOBJ_OUTLINE ) );
+            if( pObj )
+            {
+                pPage->SetObjText( pObj, NULL, PRESOBJ_OUTLINE, aStrTmp );
+                pObj->NbcSetStyleSheet( pPage->GetStyleSheetForPresObj( PRESOBJ_OUTLINE ), TRUE );
+                pObj->SetEmptyPresObj(FALSE);
+            }
+            else
+            {
+                pObj = dynamic_cast<SdrTextObj*>( pPage->GetPresObj( PRESOBJ_TEXT ) );
+                if( pObj )
+                {
+                    pPage->SetObjText( pObj, NULL, PRESOBJ_TEXT, aStrTmp );
+                    pObj->NbcSetStyleSheet( pPage->GetStyleSheetForPresObj( PRESOBJ_TEXT ), TRUE );
+                    pObj->SetEmptyPresObj(FALSE);
+                }
+            }
+        }
+    }
+
+    mbUserDataDirty = FALSE;
+}
+
+void WriterAssistantDlgImpl::UpdatePageList()
+{
+    if(mbDocPreview || !mbPreview)
+        UpdatePreview(FALSE);
+    else if(maPageListFile == maDocFile)
+        return;
+
+    maPageListFile = maDocFile;
+
+    SfxObjectShell* pShell = xDocShell;
+    DrawDocShell* pDocShell = PTR_CAST(DrawDocShell,pShell);
+    SdDrawDocument* pDoc = pDocShell?pDocShell->GetDoc():NULL;
+
+    mpPage5PageListCT->Clear();
+
+    if(pDoc)
+        mpPage5PageListCT->Fill(pDoc);
+}
+
+void WriterAssistantDlgImpl::UpdatePreview( BOOL bDocPreview )
+{
+    // Guard against multiple concurrent execution to this method caused either
+    // by calls from different threads or recursion.
+    ::osl::MutexGuard aGuard (maMutex);
+    if (mbPreviewUpdating)
+        return;
+    mbPreviewUpdating = TRUE;
+
+    if(!mbPreview && bDocPreview)
+    {
+        maPreview.Invalidate();
+        maPreview.SetObjectShell(0);
+        mbPreviewUpdating = FALSE;
+        return;
+    }
+
+    String aDocFile = GetDocFileName();
+    String aLayoutFile = GetLayoutFileName();
+    String aEmptyStr;
+
+    SfxApplication *pSfxApp = SFX_APP();
+    ULONG lErr;
+    BOOL bChangeMaster = aLayoutFile.Len() != 0;
+
+    if( aDocFile.Len() == 0 )
+    {
+        if( !xDocShell.Is() || maDocFile.Len() != 0 ||
+            (maDocFile.Len() == 0 && maLayoutFile.Len() != 0 && aLayoutFile.Len() == 0 ))
+        {
+            CloseDocShell();
+
+            DrawDocShell* pNewDocSh;
+            xDocShell = pNewDocSh = new DrawDocShell(SFX_CREATE_MODE_STANDARD, FALSE);
+            pNewDocSh->DoInitNew(NULL);
+            SdDrawDocument* pDoc = pNewDocSh->GetDoc();
+            pDoc->CreateFirstPages();
+            pDoc->StopWorkStartupDelay();
+            mbDocPreview = FALSE;
+
+            maDocFile = aDocFile;
+            mbUserDataDirty = TRUE;
+        }
+        else
+            bChangeMaster = (aLayoutFile.Len() != 0) && (maLayoutFile != aLayoutFile);
+    }
+    else if( aDocFile == maDocFile && ( mbDocPreview == bDocPreview || bDocPreview ) )
+    {
+        if( aLayoutFile != maLayoutFile )
+        {
+            SfxObjectShell* pShell = xDocShell;
+            DrawDocShell* pDocShell = PTR_CAST(DrawDocShell,pShell);
+            SfxUndoManager* pUndoMgr = pDocShell?pDocShell->GetUndoManager():NULL;
+            if(pUndoMgr)
+                pUndoMgr->Undo();
+            mbUserDataDirty = TRUE;
+        }
+        else
+            bChangeMaster = FALSE;
+    }
+    else
+    {
+        CloseDocShell();
+
+        ::Window *pParent = Application::GetDefDialogParent();
+        Application::SetDefDialogParent( mpWindow );
+
+        SfxErrorContext eEC(ERRCTX_SFX_LOADTEMPLATE,mpWindow);
+
+        SfxItemSet* pSet = new SfxAllItemSet( pSfxApp->GetPool() );
+        if(IsOwnFormat(aDocFile))
+        {
+            pSet->Put( SfxBoolItem( SID_TEMPLATE, TRUE ) );
+            if(bDocPreview)
+                pSet->Put( SfxBoolItem( SID_PREVIEW, TRUE ) );
+            RestorePassword( pSet, aDocFile );
+            if( (lErr = pSfxApp->LoadTemplate( xDocShell, aDocFile, TRUE, pSet )) != 0 )
+                ErrorHandler::HandleError(lErr);
+            else
+                SavePassword( xDocShell, aDocFile );
+        }
+        else
+        {
+            const String aTargetStr( RTL_CONSTASCII_USTRINGPARAM("_default") );
+
+            SfxRequest aReq( SID_OPENDOC, SFX_CALLMODE_SYNCHRON, SFX_APP()->GetPool() );
+            aReq.AppendItem( SfxStringItem( SID_FILE_NAME, aDocFile ));
+            aReq.AppendItem( SfxStringItem( SID_REFERER, aEmptyStr ) );
+            aReq.AppendItem( SfxStringItem( SID_TARGETNAME, aTargetStr ) );
+            aReq.AppendItem( SfxBoolItem( SID_VIEW, FALSE ) );
+            aReq.AppendItem( SfxBoolItem( SID_PREVIEW, bDocPreview ) );
+
+            const SfxObjectShellItem* pRet = (SfxObjectShellItem*)
+                SFX_APP()->ExecuteSlot( aReq );
+
+            if( pRet && pRet->GetObjectShell() )
+                xDocShell = pRet->GetObjectShell();
+        }
+
+
+        Application::SetDefDialogParent( pParent );
+
+        mnShowPage = 0;
+        mbDocPreview = bDocPreview;
+        maDocFile = aDocFile;
+        mbUserDataDirty = TRUE;
+    }
+
+    if(bChangeMaster && (aLayoutFile != maDocFile))
+    {
+        // Layoutvorlage laden
+        SfxObjectShellLock xLayoutDocShell;
+        SfxErrorContext eEC(ERRCTX_SFX_LOADTEMPLATE,mpWindow);
+        SfxItemSet* pSet = new SfxAllItemSet( pSfxApp->GetPool() );
+
+        ::Window *pParent = Application::GetDefDialogParent();
+        Application::SetDefDialogParent( mpWindow );
+
+        if(IsOwnFormat(aLayoutFile))
+        {
+            pSet->Put( SfxBoolItem( SID_TEMPLATE, TRUE ) );
+            pSet->Put( SfxBoolItem( SID_PREVIEW, TRUE ) );
+
+            RestorePassword( pSet, aLayoutFile );
+            if( (lErr = pSfxApp->LoadTemplate( xLayoutDocShell, aLayoutFile, TRUE, pSet )) != 0 )
+                ErrorHandler::HandleError(lErr);
+            SavePassword( xLayoutDocShell, aLayoutFile );
+        }
+
+        Application::SetDefDialogParent( pParent );
+
+        // die Implementierung ermitteln
+        SfxObjectShell* pShell = xDocShell;
+        DrawDocShell* pDocShell = PTR_CAST(DrawDocShell,pShell);
+        SdDrawDocument* pDoc = pDocShell?pDocShell->GetDoc():NULL;
+
+        pShell = xLayoutDocShell;
+        pDocShell = PTR_CAST(DrawDocShell,pShell);
+        SdDrawDocument* pLayoutDoc = pDocShell?pDocShell->GetDoc():NULL;
+
+        if( pDoc && pLayoutDoc )
+        {
+            pDoc->SetMasterPage(0, aEmptyStr, pLayoutDoc, TRUE,  FALSE );
+        }
+        else
+        {
+            DBG_ERROR("sd::WriterAssistantDlgImpl::UpdatePreview(), no document for preview?");
+        }
+
+        mbUserDataDirty = TRUE;
+    }
+    maLayoutFile = aLayoutFile;
+
+    if(mbUserDataDirty)
+        UpdateUserData();
+
+    if ( !xDocShell.Is() || !mbPreview )
+        maPreview.SetObjectShell( 0 );
+    else
+    {
+        maPreview.SetObjectShell( xDocShell, mnShowPage );
+    }
+
+    mbPreviewUpdating = FALSE;
+}
+
+void WriterAssistantDlgImpl::SavePassword( SfxObjectShellLock xDoc, const String& rPath )
+{
+    if(xDoc.Is())
+    {
+        SfxMedium * pMedium = xDoc->GetMedium();
+        if(pMedium && pMedium->IsStorage())
+        {
+            SfxItemSet * pSet = pMedium->GetItemSet();
+          const SfxPoolItem *pItem = 0;
+          if( pSet->GetItemState(SID_PASSWORD, TRUE, &pItem) == SFX_ITEM_SET )
+          {
+            //TODO/MBA: testing
+            String aPass( ((const SfxStringItem*)pItem)->GetValue());
+            if(aPass.Len() == 0)
+                return;
+
+            PasswordEntry* pEntry = maPasswordList.First();
+            while(pEntry)
+            {
+                if(pEntry->maPath == rPath)
+                    break;
+
+                pEntry = maPasswordList.Next();
+
+            }
+
+            if(pEntry == NULL)
+            {
+                pEntry = new PasswordEntry();
+                pEntry->maPath = rPath;
+                maPasswordList.Insert( pEntry );
+            }
+
+            if(pEntry)
+                pEntry->maPassword = aPass;
+          }
+        }
+    }
+}
+
+void WriterAssistantDlgImpl::RestorePassword( SfxItemSet* pSet, const String& rPath )
+{
+    String aPassword( GetPassword( rPath ) );
+
+    if(aPassword.Len())
+        pSet->Put( SfxStringItem( SID_PASSWORD, aPassword ) );
+}
+
+String WriterAssistantDlgImpl::GetPassword( const String rPath )
+{
+    PasswordEntry* pEntry = maPasswordList.First();
+    while(pEntry)
+    {
+        if(pEntry->maPath == rPath)
+            return pEntry->maPassword;
+
+        pEntry = maPasswordList.Next();
+    }
+
+    return String();
+}
+
+void WriterAssistantDlgImpl::DeletePassords()
+{
+    PasswordEntry* pEntry = maPasswordList.First();
+    while(pEntry)
+    {
+        delete pEntry;
+        pEntry = maPasswordList.Next();
+    }
+}
+
+BOOL WriterAssistantDlgImpl::IsOwnFormat( const String& rPath )
+{
+    INetURLObject	aURL( rPath );
+    String			aExt( aURL.GetFileExtension() );
+
+    DBG_ASSERT( aURL.GetProtocol() != INET_PROT_NOT_VALID, "invalid URL" );
+
+    return !aExt.EqualsIgnoreCaseAscii( "ppt" );
+}
+
+
+
+
+String WriterAssistantDlgImpl::GetUiTextForCommand (const ::rtl::OUString& sCommandURL)
+{
+    String sLabel;
+    Reference<container::XNameAccess> xUICommandLabels;
+
+    try
+    {
+        do
+        {
+            if (sCommandURL.getLength() ==  0)
+                break;
+
+            // Retrieve popup menu labels
+            Reference<lang::XMultiServiceFactory> xFactory (
+                ::comphelper::getProcessServiceFactory ());
+            if ( ! xFactory.is())
+                break;
+
+            ::rtl::OUString sModuleIdentifier (
+                RTL_CONSTASCII_USTRINGPARAM("com.sun.star.presentation.PresentationDocument"));
+            Reference<container::XNameAccess> xNameAccess (
+                xFactory->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(
+                    "com.sun.star.frame.UICommandDescription"))),
+                UNO_QUERY);
+            if ( ! xNameAccess.is())
+                break;
+            Any a = xNameAccess->getByName(sModuleIdentifier);
+            a >>= xUICommandLabels;
+            if ( ! xUICommandLabels.is())
+                break;
+
+            ::rtl::OUString sString;
+            Sequence<beans::PropertyValue> aProperties;
+            Any aAny (xUICommandLabels->getByName(sCommandURL));
+            if (aAny >>= aProperties)
+            {
+                sal_Int32 nCount (aProperties.getLength());
+                for (sal_Int32 i=0; i<nCount; i++)
+                {
+                    ::rtl::OUString sPropertyName (aProperties[i].Name);
+                    if (sPropertyName.equalsAscii("Label"))
+                    {
+                        aProperties[i].Value >>= sString;
+                        break;
+                    }
+                }
+            }
+            sLabel = sString;
+        }
+        while(false);
+    }
+    catch (com::sun::star::uno::Exception& rException)
+    {
+        (void)rException;
+    }
+
+    return sLabel;
+}
+
+
+
+
+Image WriterAssistantDlgImpl::GetUiIconForCommand (const ::rtl::OUString& sCommandURL)
+{
+    Image aIcon;
+    Reference<container::XNameAccess> xUICommandLabels;
+
+    try
+    {
+        do
+        {
+            if (sCommandURL.getLength() ==  0)
+                break;
+
+            // Retrieve popup menu labels
+            Reference<lang::XMultiServiceFactory> xFactory (
+                ::comphelper::getProcessServiceFactory ());
+            if ( ! xFactory.is())
+                break;
+
+            ::rtl::OUString sModuleIdentifier (
+                RTL_CONSTASCII_USTRINGPARAM("com.sun.star.presentation.PresentationDocument"));
+
+            Reference<com::sun::star::ui::XModuleUIConfigurationManagerSupplier> xSupplier (
+                xFactory->createInstance(::rtl::OUString(RTL_CONSTASCII_USTRINGPARAM(
+                    "com.sun.star.ui.ModuleUIConfigurationManagerSupplier"))),
+                UNO_QUERY_THROW);
+
+            Reference<com::sun::star::ui::XUIConfigurationManager> xManager (
+                xSupplier->getUIConfigurationManager(sModuleIdentifier));
+            if ( ! xManager.is())
+                break;
+
+            Reference<com::sun::star::ui::XImageManager> xImageManager (
+                xManager->getImageManager(),
+                UNO_QUERY_THROW);
+
+            Sequence<rtl::OUString> aCommandList(1);
+            aCommandList[0] = sCommandURL;
+            Sequence<Reference<graphic::XGraphic> > xIconList (
+                xImageManager->getImages(0,aCommandList));
+            if ( ! xIconList.hasElements())
+                break;
+
+            aIcon = Graphic(xIconList[0]).GetBitmapEx();
+        }
+        while(false);
+    }
+    catch (com::sun::star::uno::Exception& rException)
+    {
+        (void)rException;
+    }
+
+    return aIcon;
+}
+
+
+//////////////////////////////////////////////
+
+WriterAssistantDlg::WriterAssistantDlg(Window* pParent, BOOL bAutoPilot) :
+    ModalDialog(pParent,SdResId(DLG_ASS))
+{
+    Link aFinishLink = LINK(this,WriterAssistantDlg, FinishHdl);
+    mpImpl = new WriterAssistantDlgImpl( this, aFinishLink, bAutoPilot );
+
+    //Buttonbelegung
+    mpImpl->maFinishButton.SetClickHdl(LINK(this,WriterAssistantDlg,FinishHdl));
+
+    FreeResource();
+}
+
+IMPL_LINK( WriterAssistantDlg, FinishHdl, OKButton *, EMPTYARG )
+{
+    if( GetStartType() == ST_OPEN )
+    {
+        //if we do not have a file here asked for one before ending the dialog
+        String aFileToOpen = GetDocPath();
+        if(aFileToOpen.Len() == 0)
+        {
+            sfx2::FileDialogHelper aFileDlg( WB_OPEN, ::String::CreateFromAscii("simpress") );
+
+            if ( aFileDlg.Execute() == ERRCODE_NONE )
+                aFileToOpen = aFileDlg.GetPath();
+            if( aFileToOpen.Len() == 0)
+                return 1;
+            else
+            {
+                //add the selected file to the recent-file-listbox and select the new entry
+                //this is necessary for 'GetDocPath()' returning the selected file after end of dialog
+
+                INetURLObject aURL;
+                aURL.SetSmartURL(aFileToOpen);
+                mpImpl->maOpenFilesList.push_back (new String (aURL.GetMainURL( INetURLObject::NO_DECODE )));
+                USHORT nNewPos = mpImpl->mpPage1OpenLB->InsertEntry(aURL.getName());
+                mpImpl->mpPage1OpenLB->SelectEntryPos(nNewPos);
+            }
+        }
+    }
+
+    //Ende
+    mpImpl->EndDialog(RET_OK);
+    EndDialog(RET_OK);
+    return 0;
+}
+
+WriterAssistantDlg::~WriterAssistantDlg()
+{
+    delete mpImpl;
+}
+
+
+SfxObjectShellLock WriterAssistantDlg::GetDocument()
+{
+    return mpImpl->GetDocument();
+}
+
+String WriterAssistantDlg::GetTopic() const
+{
+    return mpImpl->mpPage4AskTopicEDT->GetText();
+}
+
+String WriterAssistantDlg::GetUserName() const
+{
+    return mpImpl->mpPage4AskNameEDT->GetText();
+}
+
+String WriterAssistantDlg::GetInformation() const
+{
+    return mpImpl->mpPage4AskInfoEDT->GetText();
+}
+
+/*
+OutputType WriterAssistantDlg::GetOutputMedium() const
+{
+    if(mpImpl->mpPage2Medium1RB->IsChecked())
+        return OUTPUT_PRESENTATION;
+    else if(mpImpl->mpPage2Medium2RB->IsChecked())
+        return OUTPUT_SLIDE;
+    else if(mpImpl->mpPage2Medium3RB->IsChecked())
+        return OUTPUT_OVERHEAD;
+    else if(mpImpl->mpPage2Medium4RB->IsChecked())
+        return OUTPUT_PAGE;
+    else
+        return OUTPUT_ORIGINAL;
+}
+*/
+
+BOOL WriterAssistantDlg::IsSummary() const
+{
+    return mpImpl->mpPage5SummaryCB->IsChecked();
+}
+
+StartType WriterAssistantDlg::GetStartType() const
+{
+    return mpImpl->GetStartType();
+}
+
+String WriterAssistantDlg::GetDocPath() const
+{
+    return mpImpl->GetDocFileName();
+}
+
+BOOL WriterAssistantDlg::GetStartWithFlag() const
+{
+    return !mpImpl->maStartWithFlag.IsChecked();
+}
+
+BOOL WriterAssistantDlg::IsDocEmpty() const
+{
+    return mpImpl->GetDocFileName().Len() == 0 &&
+           mpImpl->GetLayoutFileName().Len() == 0;
+}
+
+String WriterAssistantDlg::GetPassword()
+{
+    return mpImpl->GetPassword( mpImpl->maDocFile );
+}
+
+
+
+
+//===== NextButton ============================================================
+
+NextButton::NextButton (::Window* pParent, const ResId& rResId)
+    : maNextButton1(pParent, rResId),
+      maNextButton2(pParent, rResId),
+      mbIsFirstButtonActive(true)
+{
+    // Hide the unused button.
+    maNextButton2.Hide();
+}
+
+
+
+
+void NextButton::ForceFocusEventBroadcast (void)
+{
+    // Hide the currently visible button and show and focus the other one.
+    if (mbIsFirstButtonActive)
+    {
+        mbIsFirstButtonActive = false;
+        maNextButton2.Show();
+        maNextButton2.GrabFocus();
+        maNextButton1.Hide();
+    }
+    else
+    {
+        mbIsFirstButtonActive = true;
+        maNextButton1.Show();
+        maNextButton1.GrabFocus();
+        maNextButton2.Hide();
+    }
+}
+    
+
+
+
+void NextButton::SetClickHdl (const Link& rLink)
+{
+    // Forward the setting of the click handler to the two buttons
+    // regardless of which one is currently visible.
+    maNextButton1.SetClickHdl(rLink);
+    maNextButton2.SetClickHdl(rLink);
+}
+
+
+
+
+bool NextButton::IsEnabled (void)
+{
+    // Because the buttons are both either enabled or disabled, it is
+    // sufficient to ask one to determine the state.
+    return maNextButton1.IsEnabled();
+}
+
+
+
+
+void NextButton::Enable (bool bEnable)
+{
+    // Enable or disable both buttons but do not change visibility or focus.
+    maNextButton1.Enable(bEnable);
+    maNextButton2.Enable(bEnable);
+}
diff --git sw/source/ui/dialog/SwDialogAssistant.src sw/source/ui/dialog/SwDialogAssistant.src
new file mode 100644
index 0000000..1471049
--- /dev/null
+++ sw/source/ui/dialog/SwDialogAssistant.src
@@ -0,0 +1,240 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: SwDialogAssistant.cxx,v $
+ * $Revision: 1.0 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#include "SwDialogAssistant.hrc"
+#include "helpid.h"
+ModalDialog DLG_ASS_WRITER
+{
+    OutputSize = TRUE ;
+    SVLook = TRUE ;
+    Size = MAP_APPFONT ( 272 , 190 ) ;
+    Text [ en-US ] = "Writer Wizard";
+    Text [ fr ] = "Assistant Writer";
+
+    HelpId = HID_SW_AUTOPILOT_PAGE1 ;
+    Moveable = TRUE ;
+    Closeable = FALSE;
+
+    /**************
+     *   Page 1   *
+     **************/
+
+
+    FixedBitmap FB_PAGE1
+    {
+        OutputSize = TRUE ;
+        Scale = TRUE;
+        Border = TRUE;
+        Pos = MAP_APPFONT ( 6 , 4  ) ;
+        Size = MAP_APPFONT ( 258 , 29 ) ;
+        Fixed = Bitmap { File = "writer_wizard.png" ; };
+    };
+
+    RadioButton RB_PAGE1_EMPTY_WRITER_DOC
+    {
+        Pos = MAP_APPFONT ( 12 , 48  );
+        Size = MAP_APPFONT ( 130 , 10 );
+        TabStop = TRUE;
+        Text [ en-US ] = "~New empty Writer document";
+    };
+
+    RadioButton RB_PAGE1_TEMPLATE
+    {
+        Pos = MAP_APPFONT ( 12 , 62  );
+        Size = MAP_APPFONT ( 130 , 10 );
+        Text [ en-US ] = "~something else";
+    };
+
+    PushButton BUT_PAGE1_CREATE
+    {
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 218 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+        Text [ en-US ] = "~Create" ;
+    };
+
+    OKButton BUT_PAGE1_OK
+    {
+        DefButton = TRUE ;
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 165 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+        Text [ en-US ] = "~Ok >>" ;
+    };
+
+    CancelButton BUT_PAGE1_CANCEL
+    {
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 59 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+    };
+/*
+    HelpButton BUT_PAGE1_HELP
+    {
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 6 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+    };
+
+*/
+    /**************
+     *   Page 2   *
+     **************/
+
+    Control CT_PAGE2_PREVIEW
+    {
+        Border = TRUE ;
+        Pos = MAP_APPFONT ( 144 , 40  ) ;
+        Size = MAP_APPFONT ( 122 , 96 ) ;
+        SVLook = FALSE ;
+    };
+
+    CheckBox CB_PAGE2_PREVIEW
+    {
+        Pos = MAP_APPFONT ( 144 , 140  );
+        Size = MAP_APPFONT ( 122 , 10 );
+        TabStop = TRUE;
+        Text [ en-US ] = "Previe~w";
+    };
+
+    PushButton BUT_PAGE2_BACK
+    {
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 112 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+        Text [ en-US ] = "<< ~Back" ;
+            Text [ fr ] = "Prcdent" ;
+    };
+
+    PushButton BUT_PAGE2_CREATE
+    {
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 218 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+        Text [ en-US ] = "~Create" ;
+        Text [ fr ] = "~Crer" ;
+    };
+
+    OKButton BUT_PAGE2_OK
+    {
+        DefButton = TRUE ;
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 165 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+        Text [ en-US ] = "~Ok >>" ;
+    };
+
+    CancelButton BUT_PAGE2_CANCEL
+    {
+        OutputSize = TRUE ;
+        Pos = MAP_APPFONT ( 59 , 170 ) ;
+        Size = MAP_APPFONT ( 50 , 14 ) ;
+        TabStop = TRUE ;
+    };
+
+    CheckBox CB_PAGE2_STARTWITH_SIMPLE_TEXT
+    {
+        OutputSize = TRUE;
+        Pos = MAP_APPFONT ( 6 , 154  );
+        Size = MAP_APPFONT ( 132 , 10 );
+        TabStop = TRUE ;
+        Text [ en-US ] = "Simple text";
+        Text [ fr ] = "Texte simple";
+    };
+
+    CheckBox CB_PAGE2_STARTWITH_JOURNAL
+    {
+        OutputSize = TRUE;
+        Pos = MAP_APPFONT ( 6 , 154  );
+        Size = MAP_APPFONT ( 132 , 10 );
+        TabStop = TRUE ;
+        Text [ en-US ] = "Journal";
+        Text [ fr ] = "Journal";
+    };
+
+    CheckBox CB_PAGE2_STARTWITH_POEM
+    {
+        OutputSize = TRUE;
+        Pos = MAP_APPFONT ( 6 , 154  );
+        Size = MAP_APPFONT ( 132 , 10 );
+        TabStop = TRUE ;
+        Text [ en-US ] = "Poem";
+        Text [ en-US ] = "Pome";
+    };
+
+    CheckBox CB_PAGE2_STARTWITH_BIRTHDAY
+    {
+        OutputSize = TRUE;
+        Pos = MAP_APPFONT ( 6 , 154  );
+        Size = MAP_APPFONT ( 132 , 10 );
+        TabStop = TRUE ;
+        Text [ en-US ] = "Birthday card";
+        Text [ fr ] = "Carte d'anniversaire";
+    };
+
+    CheckBox CB_PAGE2_STARTWITH_EXISTING_TEMPLATE
+    {
+        OutputSize = TRUE;
+        Pos = MAP_APPFONT ( 6 , 154  );
+        Size = MAP_APPFONT ( 132 , 10 );
+        TabStop = TRUE ;
+        Text [ en-US ] = "Existing template";
+        Text [ fr ] = "Modle existant";
+    };
+
+    FixedBitmap FB_PAGE2
+    {
+        OutputSize = TRUE ;
+        Scale = TRUE;
+        Border = TRUE;
+        Pos = MAP_APPFONT ( 6 , 4  ) ;
+        Size = MAP_APPFONT ( 258 , 29 ) ;
+        Fixed = Bitmap { File = "writer_wizard.png" ; };
+    };
+
+    String STR_OPEN
+    {
+        Text [ en-US ] = "~Open";
+        Text [ fr ] = "~Ouvrir";
+    };
+
+    String STR_CREATE
+    {
+        Text [ en-US ] = "~Create" ;
+        Text [ fr ] = "~Crer" ;
+    };
+};
diff --git sw/source/ui/fldui/fldtdlg.src sw/source/ui/fldui/fldtdlg.src
index 880e08d..f878718 100644
--- sw/source/ui/fldui/fldtdlg.src
+++ sw/source/ui/fldui/fldtdlg.src
@@ -73,12 +73,6 @@ TabDialog DLG_FLD_INSERT
                 PageResID = TP_FLD_VAR ;
                 Text [ en-US ] = "Variables" ;
             };
-            PageItem
-            {
-                Identifier = TP_FLD_DB ;
-                PageResID = TP_FLD_DB ;
-                Text [ en-US ] = "Database" ;
-            };
         };
     };
     String STR_FLD_INSERT
diff --git sw/source/ui/inc/SwAssistantClass.hxx sw/source/ui/inc/SwAssistantClass.hxx
new file mode 100644
index 0000000..2cf8932
--- /dev/null
+++ sw/source/ui/inc/SwAssistantClass.hxx
@@ -0,0 +1,89 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: swassclass.hxx,v $
+ * $Revision: 1.5 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef INC_SWASSCLASS
+#define INC_SWASSCLASS
+
+#include <tools/solar.h>
+#include "swdllapi.h"
+
+#define MAX_PAGES 10
+
+class List;
+class Control;
+
+class SW_DLLPUBLIC Assistant
+{
+    List* mpPages[MAX_PAGES];
+        //enthaelt fuer jede Seite die Controls die
+        //korrekt geschaltet werden muessen
+
+    int mnPages;
+        //gibt die Anzahl der Seiten an
+
+    int mnCurrentPage;
+        //gibt die aktuelle Seite an
+
+    bool* mpPageStatus;
+
+public:
+
+    Assistant(int nNoOfPage);
+
+    bool IsEnabled( int nPage );
+    void EnablePage( int nPage );
+    void DisablePage( int nPage );
+
+    bool InsertControl(int nDestPage,Control* pUsedControl);
+        //fuegt einer spezifizierten Seite ein Control hinzu
+
+    bool NextPage();
+        //springt zur naechsten Seite
+
+    bool PreviousPage();
+        //springt zur vorherigen Seite
+
+    bool GotoPage(const int nPageToGo);
+        //springt zu einer angegebenen Seite
+
+    bool IsLastPage();
+        //gibt an ob die aktuelle Seite die letzte ist
+
+    bool IsFirstPage();
+        //gibt an ob die aktuelle Seite die erste ist
+
+    int  GetCurrentPage();
+        //gibt die aktuelle Seite zurueck
+
+    ~Assistant();
+};
+
+
+#endif
diff --git sw/source/ui/inc/SwDialogAssistant.hrc sw/source/ui/inc/SwDialogAssistant.hrc
new file mode 100644
index 0000000..7ffe5d3
--- /dev/null
+++ sw/source/ui/inc/SwDialogAssistant.hrc
@@ -0,0 +1,123 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: SwDialogAssistant.hrc,v $
+ * $Revision: 1 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OOo4Kids is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OOo4Kids.  If not, see
+ * <http://www.OOo4Kids/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+/* PAGE 1 */
+
+/* Create pushbutton, page 1, when create a new empty Writer document is checked */
+#define BUT_PAGE1_CREATE 1
+
+/* OK pushbutton, page 1. Appears when "...something else" is checked */
+#define BUT_PAGE1_OK 2
+
+/* cancel pushbutton. Quits the assistant */
+#define BUT_PAGE1_CANCEL 3
+
+/* Fixed bitmap Page 1 : create */
+#define FB_PAGE1 4
+
+/* Radio button : start with template */
+#define RB_PAGE1_TEMPLATE 5
+
+/* Radio button : start with empty Writer document */
+#define RB_PAGE1_EMPTY_WRITER_DOC 6
+
+
+/* PAGE 2 */
+
+/* Control for a preview : nice and usefull */
+#define CT_PAGE2_PREVIEW 7
+
+/* Checkbox for a preview : checked means preview */
+#define CB_PAGE2_PREVIEW 8
+
+/* previous pushbutton : returns to page 1 */
+#define BUT_PAGE2_BACK 9
+
+/* Create pushbutton, page 1, when one model is either Poem, or Text, or Birthday or Journal is checked */
+#define BUT_PAGE2_CREATE 10
+
+/* OK pushbutton, page 2. Appears when "existing template" is checked */
+#define BUT_PAGE2_OK 11
+
+/* cancel pushbutton. Quits the assistant */
+#define BUT_PAGE2_CANCEL 12
+
+/* Checkbox :  start with simple text */
+#define CB_PAGE2_STARTWITH_SIMPLE_TEXT 13
+
+/* Checkbox :  start with journal */
+#define CB_PAGE2_STARTWITH_JOURNAL 14
+
+/* Checkbox :  start with Poem */
+#define CB_PAGE2_STARTWITH_POEM 15
+
+/* Checkbox :  start with birthday card */
+#define CB_PAGE2_STARTWITH_BIRTHDAY 16
+
+/* Checkbox :  start with invitation */
+#define CB_PAGE2_STARTWITH_INVITATION 17
+
+/* Checkbox :  start with Poem */
+#define CB_PAGE2_STARTWITH_EXISTING_TEMPLATE 18
+
+/* Fixed bitmap Page 2 : create */
+#define FB_PAGE2	19
+
+/* Fixed bitmap page 2 */
+#define FB_PAGE2            20
+
+/* usefull ? */
+#define FL_PAGE2_LAYOUT     21
+
+/* usefull ? */
+#define LB_PAGE2_REGION     22
+
+/* usefull ?  */
+#define LB_PAGE2_LAYOUT     23
+
+/* Radion button : start with an empty document */
+#define RB_PAGE1_EMPTY		24
+
+/* */
+#define RB_PAGE2_OPEN		25
+
+/* */
+#define LB_PAGE2_OPEN		26
+
+/* */
+#define PB_PAGE2_OPEN       27
+/* */
+
+/* */
+#define STR_CREATE			28
+/* */
+#define STR_OPEN			29
+/* */
+#define DLG_ASS_WRITER      930
diff --git sw/source/ui/inc/SwDialogAssistant.hxx sw/source/ui/inc/SwDialogAssistant.hxx
new file mode 100644
index 0000000..7849850
--- /dev/null
+++ sw/source/ui/inc/SwDialogAssistant.hxx
@@ -0,0 +1,83 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2009 Eric Bachard
+ *
+ * OOo4Kids - a multi-platform office productivity suite
+ *
+ * $RCSfile: SwDialogAssistant.hxx,v $
+ * $Revision: 1.7 $
+ *
+ * This file is part of OOo4Kids.
+ *
+ * OOo4Kids is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://ooo4kids.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+
+#ifndef INC_WRITER_DIALOGASS
+#define INC_WRITER_DIALOGASS
+
+#ifndef _GROUP_HXX
+#include <vcl/group.hxx>
+#endif
+#ifndef _EDIT_HXX
+#include <vcl/edit.hxx>
+#endif
+#ifndef _FIXED_HXX
+#include <vcl/fixed.hxx>
+#endif
+#ifndef _BUTTON_HXX
+#include <vcl/button.hxx>
+#endif
+#ifndef _DIALOG_HXX
+#include <vcl/dialog.hxx>
+#endif
+#include <svtools/svmedit.hxx>
+#include "SwAssistantClass.hxx"
+#include <vcl/lstbox.hxx>
+#include <sfx2/app.hxx>
+
+#include "swenumdef.hxx"
+
+class WriterAssistantDlgImpl;
+
+class WriterAssistantDlg:public ModalDialog
+{
+private:
+    WriterAssistantDlgImpl* mpImpl;
+
+public:
+    WriterAssistantDlg(Window* pParent, BOOL bAutoPilot);
+    ~WriterAssistantDlg();
+
+    DECL_LINK( FinishHdl, OKButton * );
+
+    SfxObjectShellLock GetDocument();	//
+    String GetTopic() const;
+    String GetUserName() const;
+    String GetInformation() const;
+//	OutputType GetOutputMedium() const;
+    BOOL IsSummary() const;			//
+//	StartType GetStartType() const;
+    String GetDocPath() const;		//
+    BOOL GetStartWithFlag() const; 		//
+
+    BOOL IsDocEmpty() const;		//
+    String GetPassword();			//
+};
+
+#endif
diff --git sw/source/ui/utlui/utlui.src sw/source/ui/utlui/utlui.src
index 34d9186..03c4a84 100644
--- sw/source/ui/utlui/utlui.src
+++ sw/source/ui/utlui/utlui.src
@@ -122,6 +122,10 @@ Resource RID_SHELLRES_AUTOFMTSTRS
     {
         Text [ en-US ] = "Combine paragraphs";
     };
+    String STR_AUTOFMTREDL_NON_BREAK_SPACE +1
+    {
+        Text [ en-US ] = "Add non breaking space";
+    };
 
 };
 
diff --git sw/uiconfig/swriter/menubar/menubar.xml sw/uiconfig/swriter/menubar/menubar.xml
index 7c44f84..46c6cb8 100644
--- sw/uiconfig/swriter/menubar/menubar.xml
+++ sw/uiconfig/swriter/menubar/menubar.xml
@@ -1,62 +1,29 @@
 <?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE menu:menubar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "menubar.dtd">
 <menu:menubar xmlns:menu="http://openoffice.org/2001/menu" menu:id="menubar">
-    <menu:menu menu:id=".uno:PickList">
+ <menu:menu menu:id=".uno:PickList" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:AddDirect"/>
             <menu:menuitem menu:id=".uno:Open"/>
             <menu:menuitem menu:id=".uno:RecentFileList"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:AutoPilotMenu"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:CloseDoc"/>
-            <menu:menuitem menu:id=".uno:Save"/>
+   <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:SaveAs"/>
-            <menu:menuitem menu:id=".uno:SaveAll"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Reload"/>
-            <menu:menuitem menu:id=".uno:VersionDialog"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:ExportTo"/>
-            <menu:menuitem menu:id=".uno:ExportToPDF"/>
-            <menu:menu menu:id=".uno:SendToMenu">
+   <menu:menu menu:id=".uno:SendToMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:SendMail"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsOOo"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsMS"/>
-                    <menu:menuitem menu:id=".uno:SendMailDocAsPDF"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:NewGlobalDoc"/>
-                    <menu:menuitem menu:id=".uno:NewHtmlDoc"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:SendOutlineToStarImpress"/>
-                    <menu:menuitem menu:id=".uno:SendOutlineToClipboard"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:CreateAbstract"/>
-                    <menu:menuitem menu:id=".uno:SendAbstractToStarImpress"/>
                 </menu:menupopup>
             </menu:menu>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SetDocumentProperties"/>
-            <menu:menuitem menu:id=".uno:Signature"/>
-            <menu:menu menu:id=".uno:TemplateMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:Organizer"/>
-                    <menu:menuitem menu:id=".uno:AddressBookSource"/>
-                    <menu:menuitem menu:id=".uno:SaveAsTemplate"/>
-                    <menu:menuitem menu:id=".uno:OpenTemplate"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:WebHtml"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:PrintPreview"/>
             <menu:menuitem menu:id=".uno:Print"/>
-            <menu:menuitem menu:id=".uno:PrinterSetup"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Quit"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:EditMenu">
+ <menu:menu menu:id=".uno:EditMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:Undo"/>
             <menu:menuitem menu:id=".uno:Redo"/>
@@ -65,79 +32,34 @@
             <menu:menuitem menu:id=".uno:Cut"/>
             <menu:menuitem menu:id=".uno:Copy"/>
             <menu:menuitem menu:id=".uno:Paste"/>
-            <menu:menuitem menu:id=".uno:PasteSpecial"/>
-            <menu:menuitem menu:id=".uno:SelectTextMode"/>
-                        <menu:menu menu:id=".uno:SelectionModeMenu">
-                                <menu:menupopup>
-                                        <menu:menuitem menu:id=".uno:SelectionModeDefault"/>
-                                        <menu:menuitem menu:id=".uno:SelectionModeBlock"/>
-                                </menu:menupopup>
-                        </menu:menu>
                         <menu:menuitem menu:id=".uno:SelectAll"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:ChangesMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:TrackChanges"/>
-                    <menu:menuitem menu:id=".uno:ProtectTraceChangeMode"/>
-                    <menu:menuitem menu:id=".uno:ShowTrackedChanges"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:AcceptTrackedChanges"/>
-                    <menu:menuitem menu:id=".uno:CommentChangeTracking"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MergeDocuments"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:CompareDocuments"/>
             <menu:menuitem menu:id=".uno:SearchDialog"/>
-            <menu:menuitem menu:id=".uno:EditGlossary"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:ChangeDatabaseField"/>
-            <menu:menuitem menu:id=".uno:FieldDialog"/>
-            <menu:menuitem menu:id=".uno:EditFootnote"/>
-            <menu:menuitem menu:id=".uno:IndexEntryDialog"/>
-            <menu:menuitem menu:id=".uno:AuthoritiesEntryDialog"/>
-            <menu:menuitem menu:id=".uno:EditHyperlink"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:LinkDialog"/>
-            <menu:menuitem menu:id=".uno:PlugInsActive"/>
-            <menu:menuitem menu:id=".uno:ImageMapDialog"/>
-            <menu:menuitem menu:id=".uno:ObjectMenue"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:ViewMenu">
+ <menu:menu menu:id=".uno:ViewMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:PrintLayout"/>
-            <menu:menuitem menu:id=".uno:BrowseView"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:AvailableToolbars"/>
             <menu:menuitem menu:id=".uno:StatusBarVisible"/>
-            <menu:menuitem menu:id=".uno:ShowImeStatusWindow"/>
             <menu:menuitem menu:id=".uno:Ruler"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:ViewBounds"/>
-            <menu:menuitem menu:id=".uno:Marks"/>
-            <menu:menuitem menu:id=".uno:Fieldnames"/>
             <menu:menuitem menu:id=".uno:ControlCodes"/>
-            <menu:menuitem menu:id=".uno:ShowHiddenParagraphs"/>
             <menu:menuitem menu:id=".uno:ShowAnnotations"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:ViewDataSourceBrowser"/>
-        <menu:menuitem menu:id=".uno:Navigator"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:FullScreen"/>
             <menu:menuitem menu:id=".uno:Zoom"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:InsertMenu">
+ <menu:menu menu:id=".uno:InsertMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:InsertBreak"/>
-            <menu:menu menu:id=".uno:FieldMenu">
+   <menu:menu menu:id=".uno:FieldMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertDateField"/>
                     <menu:menuitem menu:id=".uno:InsertTimeField"/>
                     <menu:menuitem menu:id=".uno:InsertPageNumberField"/>
                     <menu:menuitem menu:id=".uno:InsertPageCountField"/>
-                    <menu:menuitem menu:id=".uno:InsertTopicField"/>
                     <menu:menuitem menu:id=".uno:InsertTitleField"/>
                     <menu:menuitem menu:id=".uno:InsertAuthorField"/>
                     <menu:menuseparator/>
@@ -145,46 +67,15 @@
                 </menu:menupopup>
             </menu:menu>
             <menu:menuitem menu:id=".uno:InsertSymbol"/>
-            <menu:menu menu:id=".uno:FormattingMarkMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertNonBreakingSpace"/>
-                    <menu:menuitem menu:id=".uno:InsertHardHyphen"/>
-                    <menu:menuitem menu:id=".uno:InsertSoftHyphen"/>
-                    <menu:menuitem menu:id=".uno:InsertZWSP"/>
-                    <menu:menuitem menu:id=".uno:InsertZWNBSP"/>
-                    <menu:menuitem menu:id=".uno:InsertLRM"/>
-                    <menu:menuitem menu:id=".uno:InsertRLM"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:InsertSection"/>
-            <menu:menuitem menu:id=".uno:HyperlinkDialog"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:InsertPageHeader"/>
             <menu:menuitem menu:id=".uno:InsertPageFooter"/>
-            <menu:menuitem menu:id=".uno:InsertFootnoteDialog"/>
-            <menu:menuitem menu:id=".uno:InsertCaptionDialog"/>
-            <menu:menuitem menu:id=".uno:InsertBookmark"/>
-            <menu:menuitem menu:id=".uno:InsertReferenceField"/>
-            <menu:menuitem menu:id=".uno:InsertAnnotation"/>
-            <menu:menuitem menu:id=".uno:InsertScript"/>
-            <menu:menu menu:id=".uno:IndexesMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertIndexesEntry"/>
-                    <menu:menuitem menu:id=".uno:InsertMultiIndex"/>
-                    <menu:menuitem menu:id=".uno:InsertAuthoritiesEntry"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:InsertEnvelope"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:InsertFrame"/>
-            <menu:menuitem menu:id=".uno:InsertTable"/>
-            <menu:menuitem menu:id=".uno:InsertGraphicRuler"/>
-            <menu:menu menu:id=".uno:GraphicMenu">
+   <menu:menuitem menu:id=".uno:InsertObjectStarMath"/>
+   <menu:menu menu:id=".uno:GraphicMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertGraphic"/>
-                    <menu:menu menu:id=".uno:Scan">
+     <menu:menu menu:id=".uno:Scan" menu:label="">
                         <menu:menupopup>
                             <menu:menuitem menu:id=".uno:TwainSelect"/>
                             <menu:menuitem menu:id=".uno:TwainTransfer"/>
@@ -193,79 +84,38 @@
                 </menu:menupopup>
             </menu:menu>
             <menu:menuitem menu:id=".uno:InsertAVMedia"/>
-            <menu:menu menu:id=".uno:ObjectMenu">
+   <menu:menu menu:id=".uno:ObjectMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:InsertObject"/>
                     <menu:menuitem menu:id=".uno:InsertPlugin"/>
                     <menu:menuitem menu:id=".uno:InsertSound"/>
                     <menu:menuitem menu:id=".uno:InsertVideo"/>
-                    <menu:menuitem menu:id=".uno:InsertObjectStarMath"/>
                     <menu:menuitem menu:id=".uno:InsertObjectChart"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menuitem menu:id=".uno:InsertObjectFloatingFrame"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:InsertDoc"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:FormatMenu">
+ <menu:menu menu:id=".uno:FormatMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:ResetAttributes"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:FontDialog"/>
             <menu:menuitem menu:id=".uno:ParagraphDialog"/>
-            <menu:menuitem menu:id=".uno:BulletsAndNumberingDialog"/>
             <menu:menuitem menu:id=".uno:PageDialog"/>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:TransliterateMenu">
+   <menu:menu menu:id=".uno:TransliterateMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:ChangeCaseToUpper"/>
                     <menu:menuitem menu:id=".uno:ChangeCaseToLower"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToHalfWidth"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToFullWidth"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToHiragana"/>
-                    <menu:menuitem menu:id=".uno:ChangeCaseToKatakana"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menuitem menu:id=".uno:RubyDialog"/>
             <menu:menuitem menu:id=".uno:FormatColumns"/>
-            <menu:menuitem menu:id=".uno:EditRegion"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:DesignerDialog"/>
-            <menu:menu menu:id=".uno:AutoFormatMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:OnlineAutoFormat"/>
-                    <menu:menuitem menu:id=".uno:AutoFormatApply"/>
-                    <menu:menuitem menu:id=".uno:AutoFormatRedlineApply"/>
-                    <menu:menuitem menu:id=".uno:AutoCorrectDlg"/>
-                </menu:menupopup>
-            </menu:menu>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:AnchorMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:SetAnchorToPage"/>
-                    <menu:menuitem menu:id=".uno:SetAnchorToPara"/>
-                    <menu:menuitem menu:id=".uno:SetAnchorAtChar"/>
-                    <menu:menuitem menu:id=".uno:SetAnchorToChar"/>
-                    <menu:menuitem menu:id=".uno:SetAnchorToFrame"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:WrapMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:WrapOff"/>
-                    <menu:menuitem menu:id=".uno:WrapOn"/>
-                    <menu:menuitem menu:id=".uno:WrapIdeal"/>
-                    <menu:menuitem menu:id=".uno:WrapThrough"/>
-                    <menu:menuitem menu:id=".uno:WrapThroughTransparent"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:WrapContour"/>
-                    <menu:menuitem menu:id=".uno:ContourDialog"/>
-                    <menu:menuitem menu:id=".uno:WrapAnchorOnly"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:TextWrap"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:ObjectAlign">
+   <menu:menu menu:id=".uno:ObjectAlign" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:CommonAlignLeft"/>
                     <menu:menuitem menu:id=".uno:CommonAlignHorizontalCenter"/>
@@ -277,184 +127,43 @@
                     <menu:menuitem menu:id=".uno:CommonAlignBottom"/>
                 </menu:menupopup>
             </menu:menu>
-            <menu:menu menu:id=".uno:ArrangeMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:BringToFront"/>
-                    <menu:menuitem menu:id=".uno:ObjectForwardOne"/>
-                    <menu:menuitem menu:id=".uno:ObjectBackOne"/>
-                    <menu:menuitem menu:id=".uno:SendToBack"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:SetObjectToForeground"/>
-                    <menu:menuitem menu:id=".uno:SetObjectToBackground"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:FlipMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:FlipHorizontal"/>
-                    <menu:menuitem menu:id=".uno:FlipVertical"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:GroupMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:FormatGroup"/>
-                    <menu:menuitem menu:id=".uno:FormatUngroup"/>
-                    <menu:menuitem menu:id=".uno:EnterGroup"/>
-                    <menu:menuitem menu:id=".uno:LeaveGroup"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuseparator/>
-            <menu:menu menu:id=".uno:ObjectMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:TransformDialog"/>
-                    <menu:menuitem menu:id=".uno:FormatLine"/>
-                    <menu:menuitem menu:id=".uno:FormatArea"/>
-                    <menu:menuitem menu:id=".uno:TextAttributes"/>
-                    <menu:menuitem menu:id=".uno:FontWork"/>
                     <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:ObjectTitleDescription"/>
-                    <menu:menuitem menu:id=".uno:NameGroup"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:FrameDialog"/>
             <menu:menuitem menu:id=".uno:GraphicDialog"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:TableMenu">
-        <menu:menupopup>
-            <menu:menu menu:id=".uno:TableInsertMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:InsertTable"/>
-                    <menu:menuitem menu:id=".uno:InsertRowDialog"/>
-                    <menu:menuitem menu:id=".uno:InsertColumnDialog"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:TableDeleteMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:DeleteTable"/>
-                    <menu:menuitem menu:id=".uno:DeleteRows"/>
-                    <menu:menuitem menu:id=".uno:DeleteColumns"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menu menu:id=".uno:TableSelectMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:SelectTable"/>
-                    <menu:menuitem menu:id=".uno:EntireRow"/>
-                    <menu:menuitem menu:id=".uno:EntireColumn"/>
-                    <menu:menuitem menu:id=".uno:EntireCell"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:MergeCells"/>
-            <menu:menuitem menu:id=".uno:SplitCell"/>
-            <menu:menuitem menu:id=".uno:Protect"/>
-            <menu:menuitem menu:id=".uno:MergeTable"/>
-            <menu:menuitem menu:id=".uno:SplitTable"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:AutoFormat"/>
-            <menu:menu menu:id=".uno:TableAutoFitMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:SetColumnWidth"/>
-                    <menu:menuitem menu:id=".uno:SetOptimalColumnWidth"/>
-                    <menu:menuitem menu:id=".uno:DistributeColumns"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:SetRowHeight"/>
-                    <menu:menuitem menu:id=".uno:SetOptimalRowHeight"/>
-                    <menu:menuitem menu:id=".uno:DistributeRows"/>
-                    <menu:menuitem menu:id=".uno:RowSplit"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:HeadingRowsRepeat"/>
-            <menu:menu menu:id=".uno:TableConvertMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:ConvertTextToTable"/>
-                    <menu:menuitem menu:id=".uno:ConvertTableToText"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:TableSort"/>
-            <menu:menuitem menu:id=".uno:InsertFormula"/>
-            <menu:menuitem menu:id=".uno:TableNumberFormatDialog"/>
-            <menu:menuitem menu:id=".uno:TableBoundaries"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:TableDialog"/>
-        </menu:menupopup>
-    </menu:menu>
-    <menu:menu menu:id=".uno:ToolsMenu">
+ <menu:menu menu:id=".uno:ToolsMenu" menu:label="">
         <menu:menupopup>
                 <menu:menuitem menu:id=".uno:SpellingAndGrammarDialog"/>
-            <menu:menu menu:id=".uno:LanguageMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:SetLanguageSelectionMenu"/>
-                    <menu:menuitem menu:id=".uno:SetLanguageParagraphMenu"/>
-                    <menu:menuitem menu:id=".uno:SetLanguageAllTextMenu"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:HangulHanjaConversion"/>
-                    <menu:menuitem menu:id=".uno:ChineseConversion"/>
-                    <menu:menuitem menu:id=".uno:ThesaurusDialog"/>
-                    <menu:menuitem menu:id=".uno:Hyphenate"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MoreDictionaries"/>
-                </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id=".uno:WordCountDialog"/>
               <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:ChapterNumberingDialog"/>
             <menu:menuitem menu:id=".uno:LineNumberingDialog"/>
-            <menu:menuitem menu:id=".uno:FootnoteDialog"/>
             <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:Gallery"/>
-            <menu:menuitem menu:id=".uno:AVMediaPlayer"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:BibliographyComponent"/>
             <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:MailMergeWizard"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:SortDialog"/>
-            <menu:menuitem menu:id=".uno:CalculateSel"/>
-            <menu:menu menu:id=".uno:UpdateMenu">
+   <menu:menu menu:id=".uno:UpdateMenu" menu:label="">
                 <menu:menupopup>
                     <menu:menuitem menu:id=".uno:UpdateAll"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:UpdateFields"/>
-                    <menu:menuitem menu:id=".uno:UpdateAllLinks"/>
-                    <menu:menuitem menu:id=".uno:UpdateCharts"/>
-                    <menu:menuitem menu:id=".uno:UpdateCurIndex"/>
-                    <menu:menuitem menu:id=".uno:UpdateAllIndexes"/>
-                    <menu:menuitem menu:id=".uno:Repaginate"/>
                 </menu:menupopup>
             </menu:menu>
             <menu:menuseparator/>
-            <menu:menu menu:id=".uno:MacrosMenu">
-                <menu:menupopup>
-                    <menu:menuitem menu:id=".uno:MacroRecorder"/>
-                    <menu:menuitem menu:id=".uno:RunMacro"/>
-                    <menu:menu menu:id=".uno:ScriptOrganizer"/>
-                    <menu:menuitem menu:id=".uno:MacroSignature"/>
-                    <menu:menuseparator/>
-                    <menu:menuitem menu:id=".uno:MacroOrganizer?TabId:short=1"/>
-                    </menu:menupopup>
-            </menu:menu>
-            <menu:menuitem menu:id="service:com.sun.star.deployment.ui.PackageManagerDialog"/>
-            <menu:menuitem menu:id=".uno:OpenXMLFilterSettings"/>
               <menu:menuitem menu:id=".uno:AutoCorrectDlg"/>
             <menu:menuitem menu:id=".uno:ConfigureDialog"/>
             <menu:menuitem menu:id=".uno:OptionsTreeDialog"/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:WindowList">
+ <menu:menu menu:id=".uno:WindowList" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:NewWindow"/>
             <menu:menuitem menu:id=".uno:CloseWin"/>
             <menu:menuseparator/>
         </menu:menupopup>
     </menu:menu>
-    <menu:menu menu:id=".uno:HelpMenu">
+ <menu:menu menu:id=".uno:HelpMenu" menu:label="">
         <menu:menupopup>
             <menu:menuitem menu:id=".uno:HelpIndex"/>
             <menu:menuitem menu:id=".uno:ExtendedHelp"/>
-            <menu:menuseparator/>
-            <menu:menuitem menu:id=".uno:HelpSupport"/>
-            <menu:menuitem menu:id=".uno:OnlineRegistrationDlg"/>
-            <menu:menuseparator/>
             <menu:menuitem menu:id=".uno:About"/>
+   <menu:menuitem menu:id=".uno:ShowLicense"/>
         </menu:menupopup>
     </menu:menu>
 </menu:menubar>
diff --git sw/uiconfig/swriter/toolbar/average.xml sw/uiconfig/swriter/toolbar/average.xml
new file mode 100644
index 0000000..e0e291c
--- /dev/null
+++ sw/uiconfig/swriter/toolbar/average.xml
@@ -0,0 +1,30 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Shrink" toolbar:helpid=".uno:Shrink"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Grow" toolbar:helpid=".uno:Grow"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid=".uno:Bold"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid=".uno:Italic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid=".uno:Underline"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:helpid=".uno:PrintPreview"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertGraphic" toolbar:helpid=".uno:InsertGraphic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:text="Galerie" toolbar:helpid=".uno:Gallery"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid=".uno:InsertTable"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:helpid=".uno:InsertDraw"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid=".uno:SpellOnline"/>
+ <toolbar:toolbarseparator/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sw/uiconfig/swriter/toolbar/beginner.xml sw/uiconfig/swriter/toolbar/beginner.xml
new file mode 100644
index 0000000..6180474
--- /dev/null
+++ sw/uiconfig/swriter/toolbar/beginner.xml
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Shrink" toolbar:helpid=".uno:Shrink"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Grow" toolbar:helpid=".uno:Grow"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid=".uno:Bold"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid=".uno:Underline"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid=".uno:Italic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertGraphic" toolbar:helpid=".uno:InsertGraphic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:text="Galerie" toolbar:helpid=".uno:Gallery"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:helpid=".uno:InsertDraw"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sw/uiconfig/swriter/toolbar/standardbar.xml sw/uiconfig/swriter/toolbar/standardbar.xml
index 33792ed..15d58a1 100644
--- sw/uiconfig/swriter/toolbar/standardbar.xml
+++ sw/uiconfig/swriter/toolbar/standardbar.xml
@@ -1,18 +1,27 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
 <toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
- <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
  <toolbar:toolbaritem xlink:href=".uno:AddDirect" toolbar:helpid="5537"/>
  <toolbar:toolbaritem xlink:href=".uno:NewDoc" toolbar:visible="false" toolbar:helpid="5500"/>
  <toolbar:toolbaritem xlink:href=".uno:Open" toolbar:helpid="5501"/>
  <toolbar:toolbaritem xlink:href=".uno:Save" toolbar:helpid="5505"/>
  <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:visible="false" toolbar:helpid="5502"/>
- <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="5331"/>
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="6312"/>
- <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
- <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:visible="false" toolbar:helpid="5509"/>
+ <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:visible="false" toolbar:helpid="5331"/>
+ <toolbar:toolbaritem xlink:href=".uno:BackgroundColor" toolbar:helpid=".uno:BackgroundColor"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontHeight" toolbar:helpid=".uno:FontHeight"/>
+ <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid=".uno:Bold"/>
+ <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid=".uno:Italic"/>
+ <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid=".uno:Underline"/>
+ <toolbar:toolbaritem xlink:href=".uno:LeftPara" toolbar:helpid=".uno:LeftPara"/>
+ <toolbar:toolbaritem xlink:href=".uno:OpenUrl" toolbar:visible="false"/>
+ <toolbar:toolbaritem xlink:href=".uno:CenterPara" toolbar:helpid=".uno:CenterPara"/>
+ <toolbar:toolbaritem xlink:href=".uno:RightPara" toolbar:helpid=".uno:RightPara"/>
+ <toolbar:toolbaritem xlink:href=".uno:JustifyPara" toolbar:helpid=".uno:JustifyPara"/>
+ <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:helpid="5325"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:SpellingAndGrammarDialog" toolbar:helpid="20622"/>
@@ -21,21 +30,21 @@
  <toolbar:toolbaritem xlink:href=".uno:Cut" toolbar:helpid="5710"/>
  <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="5711"/>
  <toolbar:toolbaritem xlink:href=".uno:Paste" toolbar:helpid="5712"/>
- <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:helpid="5715"/>
+ <toolbar:toolbaritem xlink:href=".uno:FormatPaintbrush" toolbar:visible="false" toolbar:helpid="5715"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:Undo" toolbar:helpid="5701"/>
  <toolbar:toolbaritem xlink:href=".uno:Redo" toolbar:helpid="5700"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:helpid="5678"/>
- <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid="20330"/>
+ <toolbar:toolbaritem xlink:href=".uno:HyperlinkDialog" toolbar:visible="false" toolbar:helpid="5678"/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:visible="false" toolbar:helpid="20330"/>
  <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:helpid="10244"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:SearchDialog" toolbar:helpid="5961"/>
- <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:helpid="10366"/>
- <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:helpid="5960"/>
+ <toolbar:toolbaritem xlink:href=".uno:Navigator" toolbar:visible="false" toolbar:helpid="10366"/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:visible="false" toolbar:helpid="5960"/>
  <toolbar:toolbaritem xlink:href=".uno:ViewDataSourceBrowser" toolbar:helpid="6660"/>
- <toolbar:toolbaritem xlink:href=".uno:ControlCodes" toolbar:helpid="20224"/>
- <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:helpid="10000"/>
+ <toolbar:toolbaritem xlink:href=".uno:ControlCodes" toolbar:visible="false" toolbar:helpid="20224"/>
+ <toolbar:toolbaritem xlink:href=".uno:Zoom" toolbar:visible="false" toolbar:helpid="10000"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:HelpIndex"/>
  <toolbar:toolbaritem xlink:href=".uno:ExtendedHelp" toolbar:visible="false" toolbar:helpid="5402"/>
diff --git sw/uiconfig/swriter/toolbar/textobjectbar.xml sw/uiconfig/swriter/toolbar/textobjectbar.xml
index d48a96d..a6cc059 100644
--- sw/uiconfig/swriter/toolbar/textobjectbar.xml
+++ sw/uiconfig/swriter/toolbar/textobjectbar.xml
@@ -1,9 +1,9 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:helpid="5539"/>
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:visible="false" toolbar:helpid="5539"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:StyleApply" toolbar:helpid="helpid:5552" />
+ <toolbar:toolbaritem xlink:href=".uno:StyleApply" toolbar:visible="false" toolbar:helpid="helpid:5552"/>
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid="helpid:10007" />
  <toolbar:toolbarseparator/>
@@ -12,33 +12,33 @@
  <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid="helpid:10009" />
  <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid="helpid:10008" />
  <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid="helpid:10014" />
- <toolbar:toolbaritem xlink:href=".uno:SuperScript" toolbar:helpid="helpid:20411"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:SubScript" toolbar:helpid="helpid:20412"  toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:LeftPara" toolbar:helpid="helpid:10028"  toolbar:style="radio" />
- <toolbar:toolbaritem xlink:href=".uno:CenterPara" toolbar:helpid="helpid:10030"  toolbar:style="radio" />
- <toolbar:toolbaritem xlink:href=".uno:RightPara" toolbar:helpid="helpid:10029"  toolbar:style="radio" />
- <toolbar:toolbaritem xlink:href=".uno:JustifyPara" toolbar:helpid="helpid:10031"  toolbar:style="radio" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ParaLeftToRight" toolbar:helpid="helpid:10950"  toolbar:style="radio" />
- <toolbar:toolbaritem xlink:href=".uno:ParaRightToLeft" toolbar:helpid="helpid:10951"  toolbar:style="radio" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SpacePara1" toolbar:helpid="helpid:10034"  toolbar:style="radio" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:SpacePara15" toolbar:helpid="helpid:10035"  toolbar:style="radio" toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:SpacePara2" toolbar:helpid="helpid:10036"  toolbar:style="radio" toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:DefaultNumbering" toolbar:helpid="helpid:20144" />
- <toolbar:toolbaritem xlink:href=".uno:DefaultBullet" toolbar:helpid="helpid:20138" />
- <toolbar:toolbaritem xlink:href=".uno:DecrementIndent" toolbar:helpid="helpid:10461" />
- <toolbar:toolbaritem xlink:href=".uno:IncrementIndent" toolbar:helpid="helpid:10462" />
- <toolbar:toolbaritem xlink:href=".uno:Grow" toolbar:helpid="helpid:20403"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:Shrink" toolbar:helpid="helpid:20404"  toolbar:visible="false" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:FontColor" toolbar:helpid="helpid:10017"  toolbar:style="dropdown" />
- <toolbar:toolbaritem xlink:href=".uno:BackColor" toolbar:helpid="helpid:10489"  toolbar:style="dropdown" />
- <toolbar:toolbaritem xlink:href=".uno:BackgroundColor" toolbar:helpid="helpid:10185"  toolbar:style="dropdown" />
- <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:SelectAll" toolbar:helpid="helpid:5723"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:FontDialog" toolbar:helpid="helpid:10296"  toolbar:visible="false" />
- <toolbar:toolbaritem xlink:href=".uno:ParagraphDialog" toolbar:helpid="helpid:10297"  toolbar:visible="false" />
+ <toolbar:toolbaritem xlink:href=".uno:SuperScript" toolbar:visible="false" toolbar:helpid="helpid:20411"/>
+ <toolbar:toolbaritem xlink:href=".uno:SubScript" toolbar:visible="false" toolbar:helpid="helpid:20412"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:LeftPara" toolbar:helpid="helpid:10028"/>
+ <toolbar:toolbaritem xlink:href=".uno:CenterPara" toolbar:helpid="helpid:10030"/>
+ <toolbar:toolbaritem xlink:href=".uno:RightPara" toolbar:helpid="helpid:10029"/>
+ <toolbar:toolbaritem xlink:href=".uno:JustifyPara" toolbar:helpid="helpid:10031"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:ParaLeftToRight" toolbar:helpid="helpid:10950"/>
+ <toolbar:toolbaritem xlink:href=".uno:ParaRightToLeft" toolbar:helpid="helpid:10951"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpacePara1" toolbar:visible="false" toolbar:helpid="helpid:10034"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpacePara15" toolbar:visible="false" toolbar:helpid="helpid:10035"/>
+ <toolbar:toolbaritem xlink:href=".uno:SpacePara2" toolbar:visible="false" toolbar:helpid="helpid:10036"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:DefaultNumbering" toolbar:visible="false" toolbar:helpid="helpid:20144"/>
+ <toolbar:toolbaritem xlink:href=".uno:DefaultBullet" toolbar:visible="false" toolbar:helpid="helpid:20138"/>
+ <toolbar:toolbaritem xlink:href=".uno:DecrementIndent" toolbar:visible="false" toolbar:helpid="helpid:10461"/>
+ <toolbar:toolbaritem xlink:href=".uno:IncrementIndent" toolbar:visible="false" toolbar:helpid="helpid:10462"/>
+ <toolbar:toolbaritem xlink:href=".uno:Grow" toolbar:visible="false" toolbar:helpid="helpid:20403"/>
+ <toolbar:toolbaritem xlink:href=".uno:Shrink" toolbar:visible="false" toolbar:helpid="helpid:20404"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:FontColor" toolbar:helpid="helpid:10017"/>
+ <toolbar:toolbaritem xlink:href=".uno:BackColor" toolbar:visible="false" toolbar:helpid="helpid:10489"/>
+ <toolbar:toolbaritem xlink:href=".uno:BackgroundColor" toolbar:visible="false" toolbar:helpid="helpid:10185"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SelectAll" toolbar:visible="false" toolbar:helpid="helpid:5723"/>
+ <toolbar:toolbaritem xlink:href=".uno:FontDialog" toolbar:visible="false" toolbar:helpid="helpid:10296"/>
+ <toolbar:toolbaritem xlink:href=".uno:ParagraphDialog" toolbar:visible="false" toolbar:helpid="helpid:10297"/>
 </toolbar:toolbar>
\ No newline at end of file
diff --git sw/uiconfig/swriter/toolbar/viewerbar.xml sw/uiconfig/swriter/toolbar/viewerbar.xml
index d4d6a59..b2b0ae7 100644
--- sw/uiconfig/swriter/toolbar/viewerbar.xml
+++ sw/uiconfig/swriter/toolbar/viewerbar.xml
@@ -1,12 +1,12 @@
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
-<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink" toolbar:id="toolbar">
- <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="helpid:5502"  />
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:SaveAs" toolbar:helpid="5502"/>
+ <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="6674"/>
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:helpid="helpid:6312"  />
+ <toolbar:toolbaritem xlink:href=".uno:EditDoc" toolbar:visible="false" toolbar:helpid="helpid:6312"/>
  <toolbar:toolbaritem xlink:href=".uno:SendMail" toolbar:helpid="helpid:5331"  />
  <toolbar:toolbarseparator/>
- <toolbar:toolbaritem xlink:href=".uno:ExportDirectToPDF" toolbar:helpid="helpid:6674"  />
  <toolbar:toolbaritem xlink:href=".uno:PrintDefault" toolbar:helpid="helpid:5509"  />
  <toolbar:toolbarseparator/>
  <toolbar:toolbaritem xlink:href=".uno:Copy" toolbar:helpid="helpid:5711"  />
diff --git sw/uiconfig/swriter/toolbar/writer_average.xml sw/uiconfig/swriter/toolbar/writer_average.xml
new file mode 100644
index 0000000..e0e291c
--- /dev/null
+++ sw/uiconfig/swriter/toolbar/writer_average.xml
@@ -0,0 +1,30 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Shrink" toolbar:helpid=".uno:Shrink"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Grow" toolbar:helpid=".uno:Grow"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid=".uno:Bold"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid=".uno:Italic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid=".uno:Underline"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:PrintPreview" toolbar:helpid=".uno:PrintPreview"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertGraphic" toolbar:helpid=".uno:InsertGraphic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:text="Galerie" toolbar:helpid=".uno:Gallery"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertTable" toolbar:helpid=".uno:InsertTable"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:helpid=".uno:InsertDraw"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:DesignerDialog" toolbar:helpid=".uno:DesignerDialog"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:SpellOnline" toolbar:helpid=".uno:SpellOnline"/>
+ <toolbar:toolbarseparator/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sw/uiconfig/swriter/toolbar/writer_beginner.xml sw/uiconfig/swriter/toolbar/writer_beginner.xml
new file mode 100644
index 0000000..6180474
--- /dev/null
+++ sw/uiconfig/swriter/toolbar/writer_beginner.xml
@@ -0,0 +1,21 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE toolbar:toolbar PUBLIC "-//OpenOffice.org//DTD OfficeDocument 1.0//EN" "toolbar.dtd">
+<toolbar:toolbar xmlns:toolbar="http://openoffice.org/2001/toolbar" xmlns:xlink="http://www.w3.org/1999/xlink">
+ <toolbar:toolbaritem xlink:href=".uno:CharFontName" toolbar:helpid=".uno:CharFontName"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Shrink" toolbar:helpid=".uno:Shrink"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Grow" toolbar:helpid=".uno:Grow"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Bold" toolbar:helpid=".uno:Bold"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Underline" toolbar:helpid=".uno:Underline"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Italic" toolbar:helpid=".uno:Italic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertGraphic" toolbar:helpid=".uno:InsertGraphic"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:Gallery" toolbar:text="Galerie" toolbar:helpid=".uno:Gallery"/>
+ <toolbar:toolbarseparator/>
+ <toolbar:toolbaritem xlink:href=".uno:InsertDraw" toolbar:helpid=".uno:InsertDraw"/>
+</toolbar:toolbar>
\ No newline at end of file
diff --git sysui/desktop/debian/OOo4Kids-debian-menus sysui/desktop/debian/OOo4Kids-debian-menus
new file mode 100644
index 0000000..fe9b794
--- /dev/null
+++ sysui/desktop/debian/OOo4Kids-debian-menus
@@ -0,0 +1,42 @@
+?package(OOo4Kids):needs="X11" section="Apps/Editors"\
+  title="%PRODUCTNAME" command="%PREFIX"\
+  hints="Office Suite for 7-12 children"\
+  kderemove="y"\
+  icon="/usr/share/icons/hicolor/32x32/apps/%ICONPREFIX-ooo4kids.png"\
+  icon16x16="/usr/share/icons/hicolor/16x16/apps/%ICONPREFIX-ooo4kids.png"
+
+?package(OOo4Kids-writer):needs="X11" section="Apps/Editors"\
+  title="%PRODUCTNAME Writer" command="%PREFIX -writer"\
+  hints="Word Processors"\
+  kderemove="y"\
+  icon="/usr/share/icons/hicolor/32x32/apps/%ICONPREFIX-writer.png"\
+  icon16x16="/usr/share/icons/hicolor/16x16/apps/%ICONPREFIX-writer.png"
+
+?package(OOo4Kids-calc):needs="X11" section="Apps/Math"\
+  title="%PRODUCTNAME Calc" command="%PREFIX -calc"\
+  hints="Spreadsheets"\
+  kderemove="y"\
+  icon="/usr/share/icons/hicolor/32x32/apps/%ICONPREFIX-calc.png"\
+  icon16x16="/usr/share/icons/hicolor/16x16/apps/%ICONPREFIX-calc.png"
+
+?package(OOo4Kids-draw):needs="X11" section="Apps/Graphics"\
+  title="%PRODUCTNAME Draw" command="%PREFIX -draw"\
+  hints="Drawing"\
+  kderemove="y"\
+  icon="/usr/share/icons/hicolor/32x32/apps/%ICONPREFIX-draw.png"\
+  icon16x16="/usr/share/icons/hicolor/16x16/apps/%ICONPREFIX-draw.png"
+
+?package(OOo4Kids-impress):needs="X11" section="Apps/Graphics"\
+  title="%PRODUCTNAME Impress" command="%PREFIX -impress"\
+  hints="Presentation"\
+  kderemove="y"\
+  icon="/usr/share/icons/hicolor/32x32/apps/%ICONPREFIX-impress.png"\
+  icon16x16="/usr/share/icons/hicolor/16x16/apps/%ICONPREFIX-impress.png"
+
+?package(OOo4Kids-core02):needs="X11" section="Apps/System"\
+  title="%PRODUCTNAME Printer Administration"\
+  command="%PREFIX-printeradmin"\
+  hints="Setup,Printer,Config"\
+  kderemove="y"\
+  icon="/usr/share/icons/hicolor/32x32/apps/%ICONPREFIX-printeradmin.png"\
+  icon16x16="/usr/share/icons/hicolor/16x16/apps/%ICONPREFIX-printeradmin.png"
diff --git sysui/desktop/debian/control sysui/desktop/debian/control
index 608496d..a6a7ce0 100644
--- sysui/desktop/debian/control
+++ sysui/desktop/debian/control
@@ -1,6 +1,6 @@
 Description: %productname desktop integration
-Maintainer: OpenOffice.org
+Maintainer: OOo4Kids
 Architecture: all
-Provides: openoffice.org-desktop-integration, openoffice.org-unbundled
-Conflicts: openofficeorg-desktop-integration, openofficeorg-debian-menus, openoffice.org-bundled
-Replaces: openofficeorg-desktop-integration, openofficeorg-debian-menus
+Provides: OOo4kids-desktop-integration, OOo4kids-unbundled
+Conflicts: OOo4kids-desktop-integration, OOo4kids-debian-menus, OOo4kids-bundled
+Replaces: OOo4kids-desktop-integration, OOo4kids-debian-menus
diff --git sysui/desktop/debian/makefile.mk sysui/desktop/debian/makefile.mk
index 1e07611..62d7b00 100644
--- sysui/desktop/debian/makefile.mk
+++ sysui/desktop/debian/makefile.mk
@@ -24,7 +24,7 @@
 #
 # You should have received a copy of the GNU Lesser General Public License
 # version 3 along with OpenOffice.org.  If not, see
-# <http://www.openoffice.org/license.html>
+# <http://www.OOo4Kids/license.html>
 # for a copy of the LGPLv3 License.
 #
 #*************************************************************************
@@ -37,6 +37,12 @@ TARGET=debian
 # !!! FIXME !!!
 # debian-menus file.
 
+.IF "$(OOo4Kids)"=="YES"
+PRODUCT_NAME_MENU="OOo4Kids"
+.ELSE
+PRODUCT_NAME_MENU="openoffice.org"
+.ENDIF
+
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :  settings.mk
@@ -49,7 +55,7 @@ TARGET=debian
 
 .IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/deb//)"
 
-DEBFILES=$(foreach,i,{$(PRODUCTLIST)} $(PKGDIR)$/$i3.2-$(TARGET)-menus_$(PKGVERSION.$i)-$(PKGREV)_all.deb)
+DEBFILES=$(foreach,i,{$(PRODUCTLIST)} $(PKGDIR)$/$i-$(TARGET)-menus_$(PKGVERSION.$i)-$(PKGREV)_all.deb)
 
 .ENDIF
 
@@ -66,7 +72,7 @@ ALLTAR : $(DEBFILES)
     @$(MKDIRHIER) $(@:d) $*$/etc $*$/usr/share/applnk/Office $*$/usr/lib/menu
     ln -sf /opt/$(UNIXFILENAME.$(*:f:s/-/ /:1:s/3.2//)) $*$/etc$/
     /bin/sh -c -x "cd $(COMMONMISC)$/$(*:f:s/-/ /:1:s/3.2//) && DESTDIR=$(shell @cd $*; pwd) ICON_PREFIX=$(ICONPREFIX) KDEMAINDIR=/usr GNOMEDIR=/usr create_tree.sh"
-        @cat openoffice.org-debian-menus | sed -e 's/%PRODUCTNAME/$(PRODUCTNAME.$(*:f:s/-/ /:1:s/3.2//)) $(PRODUCTVERSION.$(*:f:s/-/ /:1:s/3.2//))/' -e 's/%PREFIX/$(UNIXFILENAME.$(*:f:s/-/ /:1:s/3.2//))/' -e 's/%ICONPREFIX/$(ICONPREFIX.$(*:f:s/-/ /:1:s/3.2//))/' > $*$/usr/lib/menu/$(*:f:s/_/ /:1:s/3.2//)
+        @cat $(PRODUCT_NAME_MENU)-debian-menus | sed -e 's/%PRODUCTNAME/$(PRODUCTNAME.$(*:f:s/-/ /:1:s/3.2//)) $(PRODUCTVERSION.$(*:f:s/-/ /:1:s/3.2//))/' -e 's/%PREFIX/$(UNIXFILENAME.$(*:f:s/-/ /:1:s/3.2//))/' -e 's/%ICONPREFIX/$(ICONPREFIX.$(*:f:s/-/ /:1:s/3.2//))/' > $*$/usr/lib/menu/$(*:f:s/_/ /:1:s/3.2//)
     echo "Package: $(*:f:s/_/ /:1:s/3.2//)" > $@
     cat $(@:f) | tr -d "\015" | sed "s/%productname/$(PRODUCTNAME.$(*:f:s/-/ /:1:s/3.2//))/" >> $@
     echo "Version: $(PKGVERSION.$(*:f:s/-/ /:1:s/3.2//))-$(PKGREV)" >> $@
diff --git sysui/desktop/debian/postinst sysui/desktop/debian/postinst
index 19753b5..fa734e6 100644
--- sysui/desktop/debian/postinst
+++ sysui/desktop/debian/postinst
@@ -68,7 +68,6 @@ application/vnd.sun.xml.draw.template std
 application/vnd.stardivision.draw sda
 application/vnd.sun.xml.math sxm
 application/vnd.stardivision.math smf
-application/vnd.sun.xml.base odb
 application/vnd.openofficeorg.extension oxt
 END
 
@@ -80,7 +79,7 @@ if [ "$1" = "configure" ]
 then
   # backing out existing entries to avoid duplicates
   sed '
-/^# OpenOffice.org/d
+/^# OOo4Kids/d
 /^application\/vnd\.oasis\.opendocument/d
 /^application\/vnd\.openofficeorg/d
 /^application\/vnd\.sun/d
@@ -96,7 +95,7 @@ then
 
   # now append our stuff to the temporary file
   cat >> /etc/mailcap.tmp$$ << END
-# OpenOffice.org
+# OOo4Kids
 application/vnd.oasis.opendocument.text; %PREFIX -view %s
 application/vnd.oasis.opendocument.text-template; %PREFIX -view %s
 application/vnd.oasis.opendocument.text-web; %PREFIX -view %s
@@ -140,7 +139,6 @@ application/vnd.sun.xml.draw; %PREFIX -view %s
 application/vnd.sun.xml.draw.template; %PREFIX -view %s
 application/vnd.stardivision.draw; %PREFIX -view %s
 application/x-stardraw; %PREFIX -view %s
-application/vnd.oasis.opendocument.database; %PREFIX -view %s
 application/vnd.sun.xml.base; %PREFIX -view %s
 application/vnd.writerperfect; %PREFIX -view %s
 application/wordperfect5.1; %PREFIX -view %s
diff --git sysui/desktop/freedesktop/freedesktop-menus.spec sysui/desktop/freedesktop/freedesktop-menus.spec
index 14a7c77..0d01b6c 100644
--- sysui/desktop/freedesktop/freedesktop-menus.spec
+++ sysui/desktop/freedesktop/freedesktop-menus.spec
@@ -7,7 +7,7 @@ Name: %pkgprefix-freedesktop-menus
 #BuildRequires: perl
 Group: Office
 License: LGPL
-Provides: openoffice.org3-desktop-integration
+Provides: OOo4Kids-desktop-integration
 Conflicts: %pkgprefix-suse-menus
 Conflicts: %pkgprefix-debian-menus
 Conflicts: %pkgprefix-redhat-menus
@@ -160,7 +160,6 @@ application/vnd.sun.xml.draw sxd
 application/vnd.sun.xml.draw.template std
 application/vnd.stardivision.draw sda
 application/vnd.sun.xml.math sxm
-application/vnd.sun.xml.base odb
 application/vnd.stardivision.math smf
 application/vnd.openofficeorg.extension oxt
 application/vnd.openxmlformats-officedocument.wordprocessingml.document docx
@@ -185,7 +184,7 @@ if [ "$1" = 1 ]
 then
   # backing out existing entries to avoid duplicates
   sed '
-/^# OpenOffice.org/d
+/^# OOo4Kids/d
 /^application\/vnd\.oasis\.opendocument/d
 /^application\/vnd\.openofficeorg/d
 /^application\/vnd\.sun/d
@@ -201,7 +200,7 @@ then
 
   # now append our stuff to the temporary file
   cat >> /etc/mailcap.tmp$$ << END
-# OpenOffice.org
+# OOo4Kids
 application/vnd.oasis.opendocument.text; %unixfilename -view %s
 application/vnd.oasis.opendocument.text-template; %unixfilename -view %s
 application/vnd.oasis.opendocument.text-web; %unixfilename -view %s
@@ -245,7 +244,6 @@ application/vnd.sun.xml.draw; %unixfilename -view %s
 application/vnd.sun.xml.draw.template; %unixfilename -view %s
 application/vnd.stardivision.draw; %unixfilename -view %s
 application/x-stardraw; %unixfilename -view %s
-application/vnd.oasis.opendocument.database; %unixfilename -view %s
 application/vnd.sun.xml.base; %unixfilename -view %s
 application/vnd.openofficeorg.extension; %unixfilename %s
 application/vnd.openxmlformats-officedocument.wordprocessingml.document; %unixfilename -view %s
@@ -317,7 +315,7 @@ done
 # https://bugzilla.redhat.com/beta/show_bug.cgi?id=134362
 %defattr(-, root, root)
 %attr(0755, root, root) /usr/bin/*
-/usr/share/applications/%unixfilename-base.desktop
+/usr/share/applications/%unixfilename-ooo4kids.desktop
 /usr/share/applications/%unixfilename-calc.desktop
 /usr/share/applications/%unixfilename-draw.desktop
 /usr/share/applications/%unixfilename-impress.desktop
diff --git sysui/desktop/icons/makefile.mk sysui/desktop/icons/makefile.mk
index 5133ce1..84c5f46 100644
--- sysui/desktop/icons/makefile.mk
+++ sysui/desktop/icons/makefile.mk
@@ -41,8 +41,6 @@ TARGET=icons
 # --- Targets -------------------------------------------------------------
 
 all: \
-    $(MISC)$/ooo-base-app.ico \
-    $(MISC)$/ooo-base-doc.ico \
     $(MISC)$/ooo-calc-app.ico \
     $(MISC)$/ooo-calc-doc.ico \
     $(MISC)$/ooo-calc-tem.ico \
@@ -79,9 +77,7 @@ all: \
     $(MISC)$/ooo3_impress_doc.ico \
     $(MISC)$/ooo3_impress_tem.ico \
     $(MISC)$/ooo3_html_doc.ico \
-    $(MISC)$/ooo3_base_app.ico \
     $(MISC)$/ooo3_draw_tem.ico \
-    $(MISC)$/ooo3_base_doc.ico \
     $(MISC)$/ooo3_calc_tem.ico \
     $(MISC)$/ooo3_writer_app.ico \
     $(MISC)$/ooo3_math_app.ico \
@@ -91,7 +87,6 @@ all: \
     $(MISC)$/ooo3_math_doc.ico \
     $(MISC)$/ooo3_writer_tem.ico \
     $(MISC)$/ooo3_empty_tem.ico \
-    $(MISC)$/ooo11-base-doc.ico \
     $(MISC)$/ooo11-calc-doc.ico \
     $(MISC)$/ooo11-calc-tem.ico \
     $(MISC)$/ooo11-chart-doc.ico \
@@ -103,8 +98,6 @@ all: \
     $(MISC)$/ooo11-math-doc.ico \
     $(MISC)$/ooo11-writer-doc.ico \
     $(MISC)$/ooo11-writer-tem.ico \
-    $(MISC)$/so8-base-app.ico \
-    $(MISC)$/so8-base-doc.ico \
     $(MISC)$/so8-calc-app.ico \
     $(MISC)$/so8-calc-doc.ico \
     $(MISC)$/so8-calc-tem.ico \
@@ -136,14 +129,12 @@ all: \
     $(MISC)$/so9_main_app.ico \
     $(MISC)$/so9_empty_doc.ico \
     $(MISC)$/so9_math_doc.ico \
-    $(MISC)$/so9_base_app.ico \
     $(MISC)$/so9_html_doc.ico \
     $(MISC)$/so9_impress_doc.ico \
     $(MISC)$/so9_draw_tem.ico \
     $(MISC)$/so9_writer_tem.ico \
     $(MISC)$/so9_impress_app.ico \
     $(MISC)$/so9_calc_tem.ico \
-    $(MISC)$/so9_base_doc.ico \
     $(MISC)$/so9_macro_doc.ico \
     $(MISC)$/so9_calc_doc.ico \
     $(MISC)$/so9_draw_doc.ico \
@@ -153,7 +144,6 @@ all: \
     $(MISC)$/so9_chart_doc.ico \
     $(MISC)$/so9_writer_app.ico \
     $(MISC)$/so9_draw_app.ico \
-    $(MISC)$/so7-base-doc.ico \
     $(MISC)$/so7-calc-doc.ico \
     $(MISC)$/so7-calc-tem.ico \
     $(MISC)$/so7-chart-doc.ico \
diff --git sysui/desktop/macosx/Info.plist sysui/desktop/macosx/Info.plist
index 029e479..be1b777 100644
--- sysui/desktop/macosx/Info.plist
+++ sysui/desktop/macosx/Info.plist
@@ -479,30 +479,6 @@
 			</dict>
 		</dict>
 
-		<!-- Base documents -->
-		<dict>
-			<key>UTTypeIdentifier</key>
-			<string>org.oasis-open.opendocument.database</string>
-			<key>UTTypeDescription</key>
-			<string>OpenDocument Database</string>
-			<key>UTTypeConformsTo</key>
-			<array>
-				<string>public.data</string>
-				<string>public.content</string>
-			</array>
-			<key>UTTypeTagSpecification</key>
-			<dict>
-				<key>public.filename-extension</key>
-				<array>
-					<string>odb</string>
-				</array>
-				<key>public.mime-type</key>
-				<array>
-					<string>application/vnd.oasis.opendocument.database</string>
-				</array>
-			</dict>
-		</dict>
-
 		<!-- Extensions -->
 		<dict>
 			<key>UTTypeIdentifier</key>
@@ -1209,24 +1185,6 @@
 		<dict>
 			<key>CFBundleTypeExtensions</key>
 			<array>
-				<string>odb</string>
-			</array>
-			<key>CFBundleTypeMIMETypes</key>
-			<array>
-				<string>application/vnd.oasis.opendocument.database</string>
-			</array>
-			<key>CFBundleTypeIconFile</key>
-			<string>oasis-database.icns</string>
-			<key>CFBundleTypeName</key>
-			<string>OpenDocument Database</string>
-			<key>CFBundleTypeRole</key>
-			<string>Editor</string>
-			<key>LSIsAppleDefaultForType</key>
-			<true/>
-		</dict>
-		<dict>
-			<key>CFBundleTypeExtensions</key>
-			<array>
 				<string>doc</string>
 				<string>dot</string>
 				<string>rtf</string>
@@ -1332,7 +1290,6 @@
 				<string>org.oasis-open.opendocument.presentation-template</string>
 				<string>org.openoffice.graphics-template</string>
 				<string>org.oasis-open.opendocument.graphics-template</string>
-				<string>org.oasis-open.opendocument.database</string>
 				<string>org.oasis-open.opendocument.chart</string>
 				<string>public.rtf</string>
 				<string>public.html</string>
diff --git sysui/desktop/macosx/makefile.mk sysui/desktop/macosx/makefile.mk
index 951def8..6fdfc65 100644
--- sysui/desktop/macosx/makefile.mk
+++ sysui/desktop/macosx/makefile.mk
@@ -54,7 +54,7 @@ ZIP1LIST := $(shell $(PERL) -w list_icons.pl < Info.plist)
 CREATOR_TYPE=OOo2
 EXECUTABLE=droplet
 .ELSE
-CREATOR_TYPE=OOO2
+CREATOR_TYPE=OOO3
 EXECUTABLE=soffice
 .ENDIF
 
diff --git sysui/desktop/mandriva/mandriva-menus.spec sysui/desktop/mandriva/mandriva-menus.spec
index 5be889e..0c5a277 100644
--- sysui/desktop/mandriva/mandriva-menus.spec
+++ sysui/desktop/mandriva/mandriva-menus.spec
@@ -13,7 +13,7 @@ BuildArch: noarch
 #        here and check for the 'mandriva-release' in the future (next year).
 #
 Requires: mandrake-release
-Provides: openoffice.org3-desktop-integration
+Provides: OOo4Kids-desktop-integration
 
 %define _unpackaged_files_terminate_build 0
 
@@ -81,7 +81,6 @@ application/vnd.sun.xml.draw.template std
 application/vnd.stardivision.draw sda
 application/vnd.sun.xml.math sxm
 application/vnd.stardivision.math smf
-application/vnd.sun.xml.base odb
 application/vnd.openofficeorg.extension oxt
 application/vnd.openxmlformats-officedocument.wordprocessingml.document docx
 application/vnd.ms-word.document.macroenabled.12 docm
@@ -105,7 +104,7 @@ if [ "$1" = 1 ]
 then
   # backing out existing entries to avoid duplicates
   sed '
-/^# OpenOffice.org/d
+/^# OOo4Kids/d
 /^application\/vnd\.oasis\.opendocument/d
 /^application\/vnd\.openofficeorg/d
 /^application\/vnd\.sun/d
@@ -165,8 +164,6 @@ application/vnd.sun.xml.draw; %unixfilename -view %s
 application/vnd.sun.xml.draw.template; %unixfilename -view %s
 application/vnd.stardivision.draw; %unixfilename -view %s
 application/x-stardraw; %unixfilename -view %s
-application/vnd.oasis.opendocument.database; %unixfilename -view %s
-application/vnd.sun.xml.base; %unixfilename -view %s
 application/vnd.openofficeorg.extension; %unixfilename %s
 application/vnd.openxmlformats-officedocument.wordprocessingml.document; %unixfilename -view %s
 application/vnd.ms-word.document.macroenabled.12;%unixfilename -view %s
@@ -230,13 +227,12 @@ EOF
 # FIXME: Office/Database request in the Cooker ML, leave in Spreadsheets
 # until new group will be created
 #
-GenerateMenu "%unixfilename -base" \
-	"More Applications/Databases" \
-	"base" \
-	"%productname %{menuversion} Base" \
-	"%productname %{menuversion} Database" \
-	"core01" \
-	"application/vnd.oasis.opendocument.database,application/vnd.sun.xml.base"
+GenerateMenu "%unixfilename " \
+    "Office Suite for 7-12 children" \
+    "OOo4Kids" \
+    "%productname %{menuversion} OOo4Kids" \
+    "%productname %{menuversion} Office Suite" \
+    "core01"
 
 GenerateMenu "%unixfilename -calc" \
 	"Office/Spreadsheets" \
@@ -307,7 +303,7 @@ fi
 
 
 %files
-%attr(0755,root,root) /usr/bin/soffice
+%attr(0755,root,root) /usr/bin/%unixfilename
 %attr(0755,root,root) %verify(not size md5) /usr/bin/%unixfilename
 %attr(0755,root,root) /usr/bin/%unixfilename-printeradmin
 %defattr(0644, root, root)
@@ -318,7 +314,7 @@ fi
 /usr/share/applications/%unixfilename-draw.desktop
 /usr/share/applications/%unixfilename-impress.desktop
 /usr/share/applications/%unixfilename-math.desktop
-/usr/share/applications/%unixfilename-base.desktop
+/usr/share/applications/%unixfilename-ooo4kids.desktop
 /usr/share/applications/%unixfilename-printeradmin.desktop
 /usr/share/applications/%unixfilename-startcenter.desktop
 /usr/share/mime-info/*.keys
diff --git sysui/desktop/menus/base.desktop sysui/desktop/menus/base.desktop
deleted file mode 100644
index 89d0a20..0000000
--- sysui/desktop/menus/base.desktop
+++ /dev/null
@@ -1,11 +0,0 @@
-[Desktop Entry]
-Version=1.0
-Terminal=false
-Icon=base
-Type=Application
-Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-MoreApplications-Databases;
-Exec=openoffice -base %U
-MimeType=application/vnd.oasis.opendocument.database;application/vnd.sun.xml.base;
-Name=%PRODUCTNAME Base
-GenericName=Database Development
-Comment=Manage databases, create queries and reports to track and manage your information by using Base.
diff --git sysui/desktop/menus/calc.desktop sysui/desktop/menus/calc.desktop
index e49b114..c05166a 100644
--- sysui/desktop/menus/calc.desktop
+++ sysui/desktop/menus/calc.desktop
@@ -4,7 +4,7 @@ Terminal=false
 Icon=calc
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Spreadsheets;
-Exec=openoffice -calc %U
+Exec=${UNIXBASISROOTNAME} -calc %U
 MimeType=application/vnd.oasis.opendocument.spreadsheet;application/vnd.oasis.opendocument.spreadsheet-template;application/vnd.sun.xml.calc;application/vnd.sun.xml.calc.template;application/vnd.stardivision.calc;application/vnd.stardivision.chart;application/msexcel;application/vnd.ms-excel;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;application/vnd.ms-excel.sheet.macroenabled.12;application/vnd.openxmlformats-officedocument.spreadsheetml.template;application/vnd.ms-excel.template.macroenabled.12;application/vnd.ms-excel.sheet.binary.macroenabled.12;text/csv;application/x-dbf;
 Name=%PRODUCTNAME Calc
 GenericName=Spreadsheet
diff --git sysui/desktop/menus/draw.desktop sysui/desktop/menus/draw.desktop
index 438d603..70b6643 100644
--- sysui/desktop/menus/draw.desktop
+++ sysui/desktop/menus/draw.desktop
@@ -4,7 +4,7 @@ Terminal=false
 Icon=draw
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Drawing;
-Exec=openoffice -draw %U
+Exec=${UNIXBASISROOTNAME} -draw %U
 MimeType=application/vnd.oasis.opendocument.graphics;application/vnd.oasis.opendocument.graphics-template;application/vnd.sun.xml.draw;application/vnd.sun.xml.draw.template;application/vnd.stardivision.draw;
 Name=%PRODUCTNAME Draw
 GenericName=Drawing Program
diff --git sysui/desktop/menus/impress.desktop sysui/desktop/menus/impress.desktop
index 0aa3cde..c6233ac 100644
--- sysui/desktop/menus/impress.desktop
+++ sysui/desktop/menus/impress.desktop
@@ -4,7 +4,7 @@ Terminal=false
 Icon=impress
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Presentations;
-Exec=openoffice -impress %U
+Exec=${UNIXBASISROOTNAME} -impress %U
 MimeType=application/vnd.oasis.opendocument.presentation;application/vnd.oasis.opendocument.presentation-template;application/vnd.sun.xml.impress;application/vnd.sun.xml.impress.template;application/vnd.stardivision.impress;application/mspowerpoint;application/vnd.ms-powerpoint;application/vnd.openxmlformats-officedocument.presentationml.presentation;application/vnd.ms-powerpoint.presentation.macroenabled.12;application/vnd.openxmlformats-officedocument.presentationml.template;application/vnd.ms-powerpoint.template.macroenabled.12;
 Name=%PRODUCTNAME Impress
 GenericName=Presentation
diff --git sysui/desktop/menus/math.desktop sysui/desktop/menus/math.desktop
index 15a6d42..8e17fd8 100644
--- sysui/desktop/menus/math.desktop
+++ sysui/desktop/menus/math.desktop
@@ -4,7 +4,7 @@ Terminal=false
 Icon=math
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Other;
-Exec=openoffice -math %U
+Exec=${UNIXBASISROOTNAME} -math %U
 MimeType=application/vnd.oasis.opendocument.formula;application/vnd.sun.xml.math;application/vnd.stardivision.math;
 Name=%PRODUCTNAME Math
 GenericName=Formula Editor
diff --git sysui/desktop/menus/ooo4kids.desktop sysui/desktop/menus/ooo4kids.desktop
new file mode 100644
index 0000000..a94d993
--- /dev/null
+++ sysui/desktop/menus/ooo4kids.desktop
@@ -0,0 +1,11 @@
+[Desktop Entry]
+Version=1.0
+Terminal=false
+Icon=startcenter
+Type=Application
+Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-MoreApplications-Office;
+Exec=${UNIXBASISROOTNAME}  %U
+MimeType=application/vnd.oasis.opendocument.database;application/vnd.sun.xml.base;
+Name=%PRODUCTNAME
+GenericName=
+Comment=Office suite for 7-12.
diff --git sysui/desktop/menus/printeradmin.desktop sysui/desktop/menus/printeradmin.desktop
index 9ddd9bf..17b5831 100644
--- sysui/desktop/menus/printeradmin.desktop
+++ sysui/desktop/menus/printeradmin.desktop
@@ -4,5 +4,5 @@ Terminal=false
 Icon=printeradmin
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;
-Exec=openoffice-printeradmin
+Exec=${UNIXBASISROOTNAME}-printeradmin
 Name=%PRODUCTNAME Printer Administration
diff --git sysui/desktop/menus/qstart.desktop sysui/desktop/menus/qstart.desktop
index 17e4edf..1cded62 100644
--- sysui/desktop/menus/qstart.desktop
+++ sysui/desktop/menus/qstart.desktop
@@ -3,7 +3,7 @@ Version=1.0
 Terminal=false
 Type=Application
 Categories=Office;
-Exec=openoffice -quickstart -nologo -nodefault
+Exec=${UNIXBASISROOTNAME} -quickstart -nologo -nodefault
 NoDisplay=true
 Name=%PRODUCTNAME Quickstarter
 Comment=Hook for quickstarter startup
diff --git sysui/desktop/menus/startcenter.desktop sysui/desktop/menus/startcenter.desktop
index b606749..3ba78d5 100644
--- sysui/desktop/menus/startcenter.desktop
+++ sysui/desktop/menus/startcenter.desktop
@@ -4,7 +4,7 @@ Terminal=false
 Icon=startcenter
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Other;
-Exec=openoffice %U
+Exec=${UNIXBASISROOTNAME} %U
 MimeType=
 Name=%PRODUCTNAME 
 GenericName=Office 
diff --git sysui/desktop/menus/writer.desktop sysui/desktop/menus/writer.desktop
index 0184d91..188e295 100644
--- sysui/desktop/menus/writer.desktop
+++ sysui/desktop/menus/writer.desktop
@@ -4,7 +4,7 @@ Terminal=false
 Icon=writer
 Type=Application
 Categories=Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Wordprocessors;
-Exec=openoffice -writer %U
+Exec=${UNIXBASISROOTNAME} -writer %U
 MimeType=application/vnd.oasis.opendocument.text;application/vnd.oasis.opendocument.text-template;application/vnd.oasis.opendocument.text-web;application/vnd.oasis.opendocument.text-master;application/vnd.sun.xml.writer;application/vnd.sun.xml.writer.template;application/vnd.sun.xml.writer.global;application/vnd.stardivision.writer;application/msword;application/vnd.ms-word;application/x-doc;application/rtf;text/rtf;application/vnd.wordperfect;application/wordperfect;application/vnd.openxmlformats-officedocument.wordprocessingml.document;application/vnd.ms-word.document.macroenabled.12;application/vnd.openxmlformats-officedocument.wordprocessingml.template;application/vnd.ms-word.template.macroenabled.12;
 Name=%PRODUCTNAME Writer
 GenericName=Word Processor
diff --git sysui/desktop/mimetypes/OOo4Kids.applications sysui/desktop/mimetypes/OOo4Kids.applications
new file mode 100644
index 0000000..f8fc025
--- /dev/null
+++ sysui/desktop/mimetypes/OOo4Kids.applications
@@ -0,0 +1,9 @@
+OFFICENAME
+    command=OFFICENAME
+    name=%PRODUCTNAME
+    can_open_multiple_files=true
+    expects_uris=true
+    requires_terminal=false
+    supported_uri_schemes=file,http,https,smb
+    mime_types=application/vnd.oasis.opendocument.text,application/vnd.oasis.opendocument.text-template,application/vnd.oasis.opendocument.text-web,application/vnd.oasis.opendocument.text-master,application/vnd.oasis.opendocument.graphics,application/vnd.oasis.opendocument.graphics-template,application/vnd.oasis.opendocument.presentation,application/vnd.oasis.opendocument.presentation-template,application/vnd.oasis.opendocument.spreadsheet,application/vnd.oasis.opendocument.spreadsheet-template,application/vnd.oasis.opendocument.formula,application/vnd.ms-excel,application/rtf,application/msword,application/vnd.ms-powerpoint,application/vnd.stardivision.calc,application/vnd.stardivision.chart,application/vnd.stardivision.draw,application/vnd.stardivision.impress,application/vnd.stardivision.mail,application/vnd.stardivision.math,application/vnd.stardivision.writer,application/vnd.sun.xml.calc,application/vnd.sun.xml.calc.template,application/vnd.sun.xml.draw,application/vnd.sun.xml.draw.template,application/vnd.sun.xml.impress,application/vnd.sun.xml.impress.template,application/vnd.sun.xml.math,application/vnd.sun.xml.writer,application/vnd.sun.xml.writer.global,application/vnd.sun.xml.writer.template,image/x-emf,image/x-pcx,image/x-photo-cd,image/x-pict;application/vnd.wordperfect;application/vnd.openofficeorg.extension;application/vnd.openxmlformats-officedocument.wordprocessingml.document;application/vnd.ms-word.document.macroenabled.12;application/vnd.openxmlformats-officedocument.wordprocessingml.template;application/vnd.ms-word.template.macroenabled.12;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;application/vnd.ms-excel.sheet.macroenabled.12;application/vnd.openxmlformats-officedocument.spreadsheetml.template;application/vnd.ms-excel.template.macroenabled.12;application/vnd.openxmlformats-officedocument.presentationml.presentation;application/vnd.ms-powerpoint.presentation.macroenabled.12;application/vnd.openxmlformats-officedocument.presentationml.template;application/vnd.ms-powerpoint.template.macroenabled.12;application/vnd.ms-excel.sheet.binary.macroenabled.12;
+
diff --git sysui/desktop/mimetypes/OOo4Kids.mime sysui/desktop/mimetypes/OOo4Kids.mime
new file mode 100644
index 0000000..8213dab
--- /dev/null
+++ sysui/desktop/mimetypes/OOo4Kids.mime
@@ -0,0 +1,80 @@
+application/vnd.oasis.opendocument.text:
+    ext: odt
+
+application/vnd.oasis.opendocument.text-template:
+    ext: ott
+
+application/vnd.oasis.opendocument.text-web:
+    ext: oth
+
+application/vnd.oasis.opendocument.text-master:
+    ext: odm
+
+application/vnd.oasis.opendocument.graphics:
+    ext: odg
+
+application/vnd.oasis.opendocument.graphics-template:
+    ext: otg
+
+application/vnd.oasis.opendocument.presentation:
+    ext: odp
+
+application/vnd.oasis.opendocument.presentation-template:
+    ext: otp
+
+application/vnd.oasis.opendocument.spreadsheet:
+    ext: ods
+
+application/vnd.oasis.opendocument.spreadsheet-template:
+    ext: ots
+
+application/vnd.oasis.opendocument.formula:
+    ext: odf
+
+application/vnd.openxmlformats-officedocument.wordprocessingml.document
+    ext: docx
+
+application/vnd.ms-word.document.macroenabled.12
+    ext: docm
+
+application/vnd.openxmlformats-officedocument.wordprocessingml.template
+    ext: dotx
+
+application/vnd.ms-word.template.macroenabled.12
+    ext: dotm
+
+application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
+    ext: xlsx
+
+application/vnd.ms-excel.sheet.macroenabled.12
+    ext: xlsm
+
+application/vnd.openxmlformats-officedocument.spreadsheetml.template
+    ext: xltx
+    
+application/vnd.ms-excel.template.macroenabled.12
+    ext: xltm
+    
+application/vnd.openxmlformats-officedocument.presentationml.presentation
+    ext: pptx
+    
+application/vnd.ms-powerpoint.presentation.macroenabled.12
+    ext: pptm
+    
+application/vnd.openxmlformats-officedocument.presentationml.template
+    ext: potx
+    
+application/vnd.ms-powerpoint.template.macroenabled.12
+    ext: potm
+
+application/vnd.ms-excel.sheet.binary.macroenabled.12
+    ext: xlsb
+
+application/vnd.ms-word
+    ext: doc
+
+application/vnd.ms-excel
+    ext: xls
+
+application/vnd.ms-powerpoint
+    ext: ppt
diff --git sysui/desktop/productversion.mk sysui/desktop/productversion.mk
index 7d2467d..51fa7f9 100644
--- sysui/desktop/productversion.mk
+++ sysui/desktop/productversion.mk
@@ -47,11 +47,11 @@ RPMMACROS= \
 PKGDIR=$(BIN)
 .ENDIF
 
-PRODUCTLIST = openoffice.org broffice.org
+PRODUCTLIST = OOo4Kids
 
 # default values to minimize maintainance effort 
-PRODUCTVERSION = 3.2
-PRODUCTVERSIONSHORT = 3
+PRODUCTVERSION = 0.9
+PRODUCTVERSIONSHORT = 0.9
 PKGVERSION = $(PRODUCTVERSION)
 # gnome-vfs treats everything behind the last '.' as an icon extension, 
 # even though the "icon_filename" in '.keys' is specified as filename 
@@ -62,15 +62,15 @@ ICONVERSION = $(PRODUCTVERSIONSHORT:s/.//g)
 # UNIXWRAPPERNAME variable is used to generate the common desktop files below share/xdg;
 # the default values get replaced by make_installer.pl at (core0x) packaging time;
 # another wrapper name can be forced by --with-unix-wrapper configure option
-# which is need by other distributors, see http://www.openoffice.org/issues/show_bug.cgi?id=75366
+# which is need by other distributors, see http://www.OOo4Kids/issues/show_bug.cgi?id=75366
 UNIXWRAPPERNAME *= '$${{UNIXPRODUCTNAME}}$${{BRANDPACKAGEVERSION}}'
 
-PRODUCTNAME.openoffice.org = OpenOffice.org
-PRODUCTVERSION.openoffice.org = $(PRODUCTVERSION)
-PRODUCTVERSIONSHORT.openoffice.org = $(PRODUCTVERSIONSHORT)
-PKGVERSION.openoffice.org = $(PKGVERSION)
-UNIXFILENAME.openoffice.org = $(PRODUCTNAME.openoffice.org:l)$(PRODUCTVERSIONSHORT.openoffice.org)
-ICONPREFIX.openoffice.org = $(UNIXFILENAME.openoffice.org:s/.//g)
+PRODUCTNAME.OOo4Kids = OOo4Kids
+PRODUCTVERSION.OOo4Kids = $(PRODUCTVERSION)
+PRODUCTVERSIONSHORT.OOo4Kids = $(PRODUCTVERSIONSHORT)
+PKGVERSION.OOo4Kids = $(PKGVERSION)
+UNIXFILENAME.OOo4Kids = $(PRODUCTNAME.OOo4Kids:l)$(PRODUCTVERSIONSHORT.OOo4Kids)
+ICONPREFIX.OOo4Kids = $(UNIXFILENAME.OOo4Kids:s/.//g)
 
 PRODUCTNAME.broffice.org = BrOffice.org
 PRODUCTVERSION.broffice.org = $(PRODUCTVERSION)
diff --git sysui/desktop/redhat/redhat-menus.spec sysui/desktop/redhat/redhat-menus.spec
index 4ad74ad..5857198 100644
--- sysui/desktop/redhat/redhat-menus.spec
+++ sysui/desktop/redhat/redhat-menus.spec
@@ -5,11 +5,11 @@ Summary: %productname desktop integration
 Name: %pkgprefix-redhat-menus
 Group: Office
 License: LGPL
-Vendor: OpenOffice.org
+Vendor: OOo4Kids
 AutoReqProv: no
 BuildArch: noarch
 Requires: redhat-release
-Provides: openoffice.org3-desktop-integration
+Provides: OOo4Kids-desktop-integration
 %define _unpackaged_files_terminate_build 0
 %description 
 %productname desktop integration
@@ -39,12 +39,12 @@ done
 %clean
 rm -rf $RPM_BUILD_ROOT
 
-%triggerin --  %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-base, %pkgprefix-math
+%triggerin --  %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-ooo4kids, %pkgprefix-math
 if [ -x /usr/bin/update-desktop-database ]; then
   update-desktop-database -q /usr/share/applications
 fi
 
-%triggerun --  %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-base, %pkgprefix-math
+%triggerun --  %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-ooo4kids, %pkgprefix-math
 if [ "$1" = "0" ] ; then  
   # the menu-package gets uninstalled/updated - postun will run the command
   exit 0
@@ -83,7 +83,7 @@ fi
 # backing out existing entries to avoid duplicates
 sed '
 /application\/vnd\.oasis\.opendocument/d
-/application\/vnd\.openofficeorg/d
+/application\/vnd\.OOo4Kids/d
 /application\/vnd\.sun/d
 /application\/vnd\.stardivision/d
 ' /etc/mime.types 2>/dev/null >> /etc/mime.types.tmp$$
@@ -120,8 +120,7 @@ application/vnd.sun.xml.draw.template std
 application/vnd.stardivision.draw sda
 application/vnd.sun.xml.math sxm
 application/vnd.stardivision.math smf
-application/vnd.sun.xml.base odb
-application/vnd.openofficeorg.extension oxt
+application/vnd.OOo4Kids.extension oxt
 application/vnd.openxmlformats-officedocument.wordprocessingml.document docx
 application/vnd.ms-word.document.macroenabled.12 docm
 application/vnd.openxmlformats-officedocument.wordprocessingml.template dotx
@@ -144,9 +143,9 @@ if [ "$1" = 1 ]
 then
   # backing out existing entries to avoid duplicates
   sed '
-/^# OpenOffice.org/d
+/^# OOo4Kids/d
 /^application\/vnd\.oasis\.opendocument/d
-/^application\/vnd\.openofficeorg/d
+/^application\/vnd\.OOo4Kids/d
 /^application\/vnd\.sun/d
 /^application\/vnd\.stardivision/d
 /^application\/vnd\.ms-word/d
@@ -160,7 +159,7 @@ then
 
   # now append our stuff to the temporary file
   cat >> /etc/mailcap.tmp$$ << END
-# OpenOffice.org
+# OOo4Kids
 application/vnd.oasis.opendocument.text; %unixfilename -view %s
 application/vnd.oasis.opendocument.text-template; %unixfilename -view %s
 application/vnd.oasis.opendocument.text-web; %unixfilename -view %s
@@ -204,14 +203,12 @@ application/vnd.sun.xml.draw; %unixfilename -view %s
 application/vnd.sun.xml.draw.template; %unixfilename -view %s
 application/vnd.stardivision.draw; %unixfilename -view %s
 application/x-stardraw; %unixfilename -view %s
-application/vnd.oasis.opendocument.database; %unixfilename -view %s
-application/vnd.sun.xml.base; %unixfilename -view %s
 application/vnd.writerperfect; %unixfilename -view %s
 application/wordperfect5.1; %unixfilename -view %s
 application/x-wordperfect; %unixfilename -view %s
 application/wordperfect; %unixfilename -view %s
 application/wpwin; %unixfilename -view %s
-application/vnd.openofficeorg.extension; %unixfilename %s
+application/vnd.OOo4Kids.extension; %unixfilename %s
 application/vnd.openxmlformats-officedocument.wordprocessingml.document; %unixfilename -view %s
 application/vnd.ms-word.document.macroenabled.12;%unixfilename -view %s
 application/vnd.openxmlformats-officedocument.wordprocessingml.template; %unixfilename -view %s
@@ -266,7 +263,7 @@ for theme in gnome hicolor locolor; do
 done
 
 %files
-%attr(0755,root,root) /usr/bin/soffice
+%attr(0755,root,root) /usr/bin/%unixfilename
 %attr(0755,root,root) %verify(not size md5) /usr/bin/%unixfilename
 %attr(0755,root,root) /usr/bin/%unixfilename-printeradmin
 %defattr(0644, root, root)
@@ -276,7 +273,7 @@ done
 /usr/share/applications/%unixfilename-draw.desktop
 /usr/share/applications/%unixfilename-impress.desktop
 /usr/share/applications/%unixfilename-math.desktop
-/usr/share/applications/%unixfilename-base.desktop
+/usr/share/applications/%unixfilename-ooo4kids.desktop
 /usr/share/applications/%unixfilename-printeradmin.desktop
 /usr/share/applications/%unixfilename-startcenter.desktop
 /usr/share/applnk-redhat/Office/%unixfilename-writer.desktop
@@ -284,7 +281,7 @@ done
 /usr/share/applnk-redhat/Office/%unixfilename-draw.desktop
 /usr/share/applnk-redhat/Office/%unixfilename-impress.desktop
 /usr/share/applnk-redhat/Office/%unixfilename-math.desktop
-/usr/share/applnk-redhat/Office/%unixfilename-base.desktop
+/usr/share/applnk-redhat/Office/%unixfilename-ooo4kids.desktop
 /usr/share/applnk-redhat/Office/%unixfilename-printeradmin.desktop
 /usr/share/applnk-redhat/Office/%unixfilename-startcenter.desktop
 /usr/share/mime-info/*.keys
diff --git sysui/desktop/share/OOo4Kids.sh sysui/desktop/share/OOo4Kids.sh
new file mode 100644
index 0000000..d3ecf97
--- /dev/null
+++ sysui/desktop/share/OOo4Kids.sh
@@ -0,0 +1,2 @@
+#!/bin/sh
+exec /opt/%PREFIX/program/soffice "$@"
diff --git sysui/desktop/share/brand.pl sysui/desktop/share/brand.pl
index 5451f70..a4e4517 100644
--- sysui/desktop/share/brand.pl
+++ sysui/desktop/share/brand.pl
@@ -42,8 +42,8 @@ eval 'exec perl -wS $0 ${1+"$@"}'
 $destdir = pop @ARGV;
 mkdir $destdir,0777;
 
-$productname = "OpenOffice.org";
-$productfilename = "openoffice";
+$productname = "OOo4Kids";
+$productfilename = "OOo4Kids";
 $prefix = "";
 $iconprefix = "";
 
diff --git sysui/desktop/share/create_mime_xml.pl sysui/desktop/share/create_mime_xml.pl
index b6ff10a..e599e28 100644
--- sysui/desktop/share/create_mime_xml.pl
+++ sysui/desktop/share/create_mime_xml.pl
@@ -1,7 +1,7 @@
 #!/usr/bin/perl
 use File::Basename;
 $basedir = dirname($0);
-$productname = 'OpenOffice.org';
+$productname = 'OOo4Kids';
 $mimedir = $basedir.'/../mimetypes';
 
 $FS= ' ';		# field seperator (space) - for documents.ulf 
diff --git sysui/desktop/share/create_tree.sh sysui/desktop/share/create_tree.sh
index 84af1c7..134c8ae 100644
--- sysui/desktop/share/create_tree.sh
+++ sysui/desktop/share/create_tree.sh
@@ -32,12 +32,12 @@ then
   done
   
   mkdir -p ${DESTDIR}/${GNOMEDIR}/share/mime-info
-  cp openoffice.mime ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.mime
-  cp openoffice.keys ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.keys
+  cp OOo4Kids.mime ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.mime
+  cp OOo4Kids.keys ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.keys
   chmod 0644 ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.*
 
   mkdir -p ${DESTDIR}/${GNOMEDIR}/share/application-registry
-  cp openoffice.applications ${DESTDIR}/${GNOMEDIR}/share/application-registry/${PREFIX}.applications
+  cp OOo4Kids.applications ${DESTDIR}/${GNOMEDIR}/share/application-registry/${PREFIX}.applications
   chmod 0644 ${DESTDIR}/${GNOMEDIR}/share/application-registry/${PREFIX}.*
 
   if [ "${GNOME_MIME_THEME}" ]
@@ -66,8 +66,6 @@ then
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}drawing-template.png            ${link_dir}/gnome-mime-application-vnd.sun.xml.draw.template.png
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}formula.png                     ${link_dir}/gnome-mime-application-vnd.sun.xml.math.png
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}master-document.png             ${link_dir}/gnome-mime-application-vnd.sun.xml.writer.global.png
-      ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}oasis-database.png              ${link_dir}/gnome-mime-application-vnd.sun.xml.base.png
-      ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}oasis-database.png              ${link_dir}/gnome-mime-application-vnd.oasis.opendocument.database.png
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}oasis-drawing.png               ${link_dir}/gnome-mime-application-vnd.oasis.opendocument.graphics.png
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}oasis-drawing-template.png      ${link_dir}/gnome-mime-application-vnd.oasis.opendocument.graphics-template.png
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}oasis-formula.png               ${link_dir}/gnome-mime-application-vnd.oasis.opendocument.formula.png
@@ -94,15 +92,15 @@ mkdir -p ${DESTDIR}/usr/bin
 
 office_root=/opt/${PREFIX}
 
-ln -sf ${office_root}/program/soffice ${DESTDIR}/usr/bin/soffice
+ln -sf ${office_root}/program/soffice ${DESTDIR}/usr/bin/${PREFIX}
 
-cp openoffice.sh ${DESTDIR}/usr/bin/${PREFIX}
+cp OOo4Kids.sh ${DESTDIR}/usr/bin/${PREFIX}
 cp printeradmin.sh ${DESTDIR}/usr/bin/${PREFIX}-printeradmin
 chmod 0755 ${DESTDIR}/usr/bin/${PREFIX} ${DESTDIR}/usr/bin/${PREFIX}-printeradmin
 
 mkdir -p ${DESTDIR}/usr/share/mime/packages
-cp openoffice.org.xml ${DESTDIR}/usr/share/mime/packages/
-chmod 0644 ${DESTDIR}/usr/share/mime/packages/openoffice.org.xml
+cp OOo4Kids.xml ${DESTDIR}/usr/share/mime/packages/
+chmod 0644 ${DESTDIR}/usr/share/mime/packages/OOo4Kids.xml
 
 mkdir -p ${DESTDIR}/usr/share/applications
 for i in `cat launcherlist`; do
diff --git sysui/desktop/share/documents.ulf sysui/desktop/share/documents.ulf
index 88fd05c..39ee76e 100644
--- sysui/desktop/share/documents.ulf
+++ sysui/desktop/share/documents.ulf
@@ -58,9 +58,6 @@ en-US = "OpenDocument Spreadsheet"
 [oasis-spreadsheet-template]
 en-US = "OpenDocument Spreadsheet Template"
 
-[oasis-database]
-en-US = "OpenDocument Database"
-
 [oasis-web-template]
 en-US = "HTML Document Template"
 
diff --git sysui/desktop/share/launcher_comment.ulf sysui/desktop/share/launcher_comment.ulf
index e3abc7c..3d2fdb0 100644
--- sysui/desktop/share/launcher_comment.ulf
+++ sysui/desktop/share/launcher_comment.ulf
@@ -13,9 +13,9 @@ en-US = "Perform calculation, analyze information and manage lists in spreadshee
 [math]
 en-US = "Create and edit scientific formulas and equations by using Math."
 
-[base]
-en-US = "Manage databases, create queries and reports to track and manage your information by using Base."
+[ooo4kids]
+en-US = "Office Suite for 7-12"
 
 [startcenter]
-en-US = "The office productivity suite compatible to the open and standardized ODF document format. Supported by Sun Microsystems."
+en-US = "The office productivity suite compatible to the open and standardized ODF document format. Supported by EducOOo."
 
diff --git sysui/desktop/share/launcher_genericname.ulf sysui/desktop/share/launcher_genericname.ulf
index ea11da0..6dddf93 100644
--- sysui/desktop/share/launcher_genericname.ulf
+++ sysui/desktop/share/launcher_genericname.ulf
@@ -7,8 +7,8 @@ en-US = "Presentation"
 [calc]
 en-US = "Spreadsheet"
 
-[base]
-en-US = "Database Development"
+[ooo4kids]
+en-US = "Office Suite for 7-12"
 
 [math]
 en-US = "Formula Editor"
diff --git sysui/desktop/share/makefile.mk sysui/desktop/share/makefile.mk
index a0ed77b..1e2af70 100644
--- sysui/desktop/share/makefile.mk
+++ sysui/desktop/share/makefile.mk
@@ -56,7 +56,7 @@ ULFFILES= \
     launcher_genericname.ulf \
     launcher_name.ulf
 
-LAUNCHERLIST = writer calc draw impress math base printeradmin qstart startcenter
+LAUNCHERLIST = writer calc draw impress math ooo4kids printeradmin qstart startcenter
 LAUNCHERDEPN = ../menus/{$(LAUNCHERLIST)}.desktop
 
 LAUNCHERFLAGFILE = $(COMMONMISC)/$(TARGET)/xdg.flag
@@ -135,13 +135,25 @@ ICONDEPN = \
     ../icons/locolor/{16x16 32x32}/apps/{$(LAUNCHERLIST:s/qstart//)}.png \
     ../icons/locolor/{16x16 32x32}/mimetypes/{$(MIMEICONLIST)}.png
 
+.IF "$(XO_INTEL)"=="YES"
+XO_FILES = \
+    ./misc/MANIFEST \
+    ./misc/activity.info \
+    ./misc/activity-ooo4kids.svg \
+    ./misc/setup.py	\
+    ./misc/sugarOOo4Kids
+.ENDIF
+
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :  target.mk
 
 .IF "$(GUI)"=="UNX"
+.IF "$(OOo4Kids)"=="YES" && "$(OS)"=="LINUX"
+ALLTAR : $(LAUNCHERFLAGFILE) $(SPECFILES) $(COMMONMISC)$/{$(PRODUCTLIST)}$/build.flag $(MISC)$/ooo4kidsrc.txt
+.ELSE
 ALLTAR : $(LAUNCHERFLAGFILE) $(SPECFILES) $(COMMONMISC)$/{$(PRODUCTLIST)}$/build.flag
-
+.ENDIF
 .ENDIF          # "$(GUI)"=="UNIX"
 
 #
@@ -168,8 +180,8 @@ $(LAUNCHERFLAGFILE) : $(LAUNCHERDEPN)
 #
 # Create shared mime info xml file
 #
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.org.xml : ../mimetypes/{$(MIMELIST)}.desktop create_mime_xml.pl
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.org.xml : $(ULFDIR)$/documents.ulf
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.xml : ../mimetypes/{$(MIMELIST)}.desktop create_mime_xml.pl
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.xml : $(ULFDIR)$/documents.ulf
     @echo Create shared mime info xml file ..
     @echo ---------------------------------
     @$(PERL) create_mime_xml.pl $< > $@.$(INPATH)
@@ -179,8 +191,8 @@ $(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.org.xml : $(ULFDIR)$/documents.ulf
 # Create GNOME mime-info files
 #
 
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.keys : ../mimetypes/openoffice.mime brand.pl translate.pl ../productversion.mk $(ULFDIR)$/documents.ulf
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.keys : ../mimetypes/{$(MIMELIST)}.keys  
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.keys : ../mimetypes/OOo4Kids.mime brand.pl translate.pl ../productversion.mk $(ULFDIR)$/documents.ulf
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.keys : ../mimetypes/{$(MIMELIST)}.keys  
     @@-$(MKDIRHIER) $(@:d)
     @echo Creating GNOME .keys file for $(@:d:d:f) ..
     @echo ---------------------------------
@@ -189,15 +201,15 @@ $(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.keys : ../mimetypes/{$(MIMELIST)}.ke
     @cat $(MISC)/$(@:d:d:f)/{$(MIMELIST)}.keys > $@.$(INPATH)
     @mv -f $@.$(INPATH) $@
 
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.mime : ../mimetypes/$$(@:f)
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.mime : ../mimetypes/$$(@:f)
     @@-$(MKDIRHIER) $(@:d)
     @echo Creating GNOME .mime file for $(@:d:d:f) ..
     @echo ---------------------------------
     @cat $< | tr -d "\015" > $@.$(INPATH)
     @mv -f $@.$(INPATH) $@
 
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.applications : ../productversion.mk 
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.applications : ../mimetypes/$$(@:f)
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.applications : ../productversion.mk 
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.applications : ../mimetypes/$$(@:f)
     @@-$(MKDIRHIER) $(@:d)
     @echo Creating GNOME .applications file for $(@:d:d:f) ..
     @echo ---------------------------------
@@ -236,8 +248,8 @@ $(COMMONMISC)$/{$(PRODUCTLIST)}$/create_tree.sh : $$(@:f)
 # Create skript files
 #
 
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/{openoffice printeradmin}.sh : ../productversion.mk
-$(COMMONMISC)$/{$(PRODUCTLIST)}$/{openoffice printeradmin}.sh : $$(@:f)
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/{OOo4Kids printeradmin}.sh : ../productversion.mk
+$(COMMONMISC)$/{$(PRODUCTLIST)}$/{OOo4Kids printeradmin}.sh : $$(@:f)
     @@-$(MKDIRHIER) $(@:d)
     @cat $< | tr -d "\015" | sed -e "s/%PREFIX/$(UNIXFILENAME.$(@:d:d:f))/g" > $@.$(INPATH)
     @mv -f $@.$(INPATH) $@
@@ -258,10 +270,16 @@ $(COMMONMISC)$/{$(PRODUCTLIST)}$/build.flag : $(ICONDEPN) \
     $(COMMONMISC)$/{$(PRODUCTLIST)}$/launcherlist \
     $(COMMONMISC)$/{$(PRODUCTLIST)}$/mimelnklist \
     $(COMMONMISC)$/{$(PRODUCTLIST)}$/create_tree.sh \
-    $(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.keys \
-    $(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.mime \
-    $(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.org.xml	\
-    $(COMMONMISC)$/{$(PRODUCTLIST)}$/openoffice.applications \
-    $(COMMONMISC)$/{$(PRODUCTLIST)}$/{openoffice printeradmin}.sh
+    $(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.keys \
+    $(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.mime \
+    $(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.xml	\
+    $(COMMONMISC)$/{$(PRODUCTLIST)}$/OOo4Kids.applications \
+    $(COMMONMISC)$/{$(PRODUCTLIST)}$/{OOo4Kids printeradmin}.sh
     @touch $@
 
+.IF "$(OS)"=="LINUX" && "$(OOo4Kids)"=="YES"
+# ooo4kidsrc.txt and XO files (when existing) are simply copied
+$(MISC)$/ooo4kidsrc.txt : misc/ooo4kidsrc.txt $(XO_FILES)
+    +$(COPY) $< $(MISC)
+.ENDIF
+
diff --git sysui/desktop/share/misc/MANIFEST sysui/desktop/share/misc/MANIFEST
new file mode 100644
index 0000000..e5e2c95
--- /dev/null
+++ sysui/desktop/share/misc/MANIFEST
@@ -0,0 +1,6 @@
+setup.py
+activity
+activity/activity.info
+activity/activity-ooo4kids.svg
+bin/soffice
+MANIFEST
\ No newline at end of file
diff --git sysui/desktop/share/misc/activity-ooo4kids.svg sysui/desktop/share/misc/activity-ooo4kids.svg
new file mode 100644
index 0000000..cb81389
--- /dev/null
+++ sysui/desktop/share/misc/activity-ooo4kids.svg
@@ -0,0 +1,729 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no"?>
+<!-- Created with Inkscape (http://www.inkscape.org/) -->
+<svg
+   xmlns:dc="http://purl.org/dc/elements/1.1/"
+   xmlns:cc="http://creativecommons.org/ns#"
+   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
+   xmlns:svg="http://www.w3.org/2000/svg"
+   xmlns="http://www.w3.org/2000/svg"
+   xmlns:xlink="http://www.w3.org/1999/xlink"
+   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
+   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
+   width="45"
+   height="45"
+   id="svg2"
+   sodipodi:version="0.32"
+   inkscape:version="0.46"
+   sodipodi:docname="20091102_OOO4Kids_app-icon_XO_2.svg"
+   inkscape:output_extension="org.inkscape.output.svg.inkscape"
+   inkscape:export-filename="/media/disk/shared/OOo4Kids/icons/20091102_OOO4Kids_app-icon_XO_2.png"
+   inkscape:export-xdpi="90"
+   inkscape:export-ydpi="90"
+   version="1.0"
+   style="display:inline">
+  <sodipodi:namedview
+     id="base"
+     pagecolor="#ffffff"
+     bordercolor="#ff0404"
+     borderopacity="0.10980392"
+     gridtolerance="10"
+     guidetolerance="10"
+     objecttolerance="10"
+     inkscape:pageopacity="0.0"
+     inkscape:pageshadow="2"
+     inkscape:zoom="2.8284273"
+     inkscape:cx="44.207141"
+     inkscape:cy="61.152834"
+     inkscape:document-units="px"
+     inkscape:current-layer="g3444"
+     showgrid="false"
+     inkscape:object-nodes="false"
+     inkscape:window-width="1270"
+     inkscape:window-height="964"
+     inkscape:window-x="1280"
+     inkscape:window-y="0"
+     showguides="true"
+     inkscape:guide-bbox="true"
+     width="80px"
+     inkscape:showpageshadow="false">
+    <inkscape:grid
+       id="grid2909"
+       type="xygrid"
+       visible="true"
+       enabled="true"
+       dotted="true" />
+  </sodipodi:namedview>
+  <defs
+     id="defs4">
+    <inkscape:perspective
+       sodipodi:type="inkscape:persp3d"
+       inkscape:vp_x="0 : 40 : 1"
+       inkscape:vp_y="0 : 1000 : 0"
+       inkscape:vp_z="80 : 40 : 1"
+       inkscape:persp3d-origin="40 : 26.666667 : 1"
+       id="perspective188" />
+    <linearGradient
+       id="linearGradient10445">
+      <stop
+         style="stop-color:#a0b9e5;stop-opacity:1;"
+         offset="0"
+         id="stop10447" />
+      <stop
+         id="stop10449"
+         offset="0.20366968"
+         style="stop-color:#a0b9e5;stop-opacity:1;" />
+      <stop
+         id="stop10451"
+         offset="0.43655413"
+         style="stop-color:#f8fcbb;stop-opacity:1;" />
+      <stop
+         id="stop10453"
+         offset="0.45643234"
+         style="stop-color:#f8fcbb;stop-opacity:1;" />
+      <stop
+         style="stop-color:#83e57f;stop-opacity:1;"
+         offset="0.46864489"
+         id="stop10455" />
+      <stop
+         id="stop10457"
+         offset="0.93765712"
+         style="stop-color:#49a13d;stop-opacity:1;" />
+      <stop
+         style="stop-color:#49a13d;stop-opacity:1;"
+         offset="1"
+         id="stop10459" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient5706">
+      <stop
+         style="stop-color:#f2f2f2;stop-opacity:1;"
+         offset="0"
+         id="stop5708" />
+      <stop
+         id="stop5710"
+         offset="0.22960269"
+         style="stop-color:#dadada;stop-opacity:1;" />
+      <stop
+         id="stop5712"
+         offset="0.45920539"
+         style="stop-color:#f2f2f2;stop-opacity:1;" />
+      <stop
+         style="stop-color:#f2f2f2;stop-opacity:1;"
+         offset="0.66841078"
+         id="stop5714" />
+      <stop
+         style="stop-color:#ababab;stop-opacity:1;"
+         offset="1"
+         id="stop5716" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3450"
+       inkscape:collect="always">
+      <stop
+         id="stop3452"
+         offset="0"
+         style="stop-color:#ffffff;stop-opacity:1;" />
+      <stop
+         id="stop3454"
+         offset="1"
+         style="stop-color:#ffffff;stop-opacity:0;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3439">
+      <stop
+         id="stop3441"
+         offset="0"
+         style="stop-color:#f6f6f6;stop-opacity:1;" />
+      <stop
+         style="stop-color:#ffffff;stop-opacity:1;"
+         offset="0.59491569"
+         id="stop3447" />
+      <stop
+         id="stop3443"
+         offset="1"
+         style="stop-color:#e6e6e6;stop-opacity:1;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3335">
+      <stop
+         style="stop-color:#f7f7f7;stop-opacity:1;"
+         offset="0"
+         id="stop3337" />
+      <stop
+         id="stop3339"
+         offset="0.10441791"
+         style="stop-color:#dadada;stop-opacity:1;" />
+      <stop
+         id="stop3341"
+         offset="0.30943826"
+         style="stop-color:#f4f4f4;stop-opacity:1;" />
+      <stop
+         style="stop-color:#f0f0f0;stop-opacity:1;"
+         offset="0.53413677"
+         id="stop3343" />
+      <stop
+         style="stop-color:#a5a5a5;stop-opacity:1;"
+         offset="1"
+         id="stop3345" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3293">
+      <stop
+         id="stop3295"
+         offset="0"
+         style="stop-color:#ffffff;stop-opacity:0.75;" />
+      <stop
+         id="stop3297"
+         offset="1"
+         style="stop-color:#ffffff;stop-opacity:0.29310346;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3266">
+      <stop
+         style="stop-color:#65c0ff;stop-opacity:1;"
+         offset="0"
+         id="stop3278" />
+      <stop
+         id="stop3284"
+         offset="0.25"
+         style="stop-color:#0067b0;stop-opacity:1;" />
+      <stop
+         id="stop3270"
+         offset="1"
+         style="stop-color:#0067b0;stop-opacity:1;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3250">
+      <stop
+         id="stop3252"
+         offset="0"
+         style="stop-color:#f7f7f7;stop-opacity:1;" />
+      <stop
+         style="stop-color:#dadada;stop-opacity:1;"
+         offset="0.22960269"
+         id="stop3264" />
+      <stop
+         style="stop-color:#f4f4f4;stop-opacity:1;"
+         offset="0.45920539"
+         id="stop3258" />
+      <stop
+         id="stop3260"
+         offset="0.66841078"
+         style="stop-color:#f0f0f0;stop-opacity:1;" />
+      <stop
+         id="stop3254"
+         offset="1"
+         style="stop-color:#a5a5a5;stop-opacity:1;" />
+    </linearGradient>
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3450"
+       id="linearGradient5456"
+       gradientUnits="userSpaceOnUse"
+       x1="-3.2684402"
+       y1="8.0394249"
+       x2="-3.2684402"
+       y2="35.580303" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3439"
+       id="linearGradient5504"
+       gradientUnits="userSpaceOnUse"
+       x1="11.481562"
+       y1="7.1618719"
+       x2="-11.018438"
+       y2="61.411873" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3450"
+       id="linearGradient5506"
+       gradientUnits="userSpaceOnUse"
+       x1="-3.2684402"
+       y1="8.0394249"
+       x2="-3.2684402"
+       y2="35.580303" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3439"
+       id="linearGradient5669"
+       gradientUnits="userSpaceOnUse"
+       x1="11.481562"
+       y1="7.1618719"
+       x2="-11.018438"
+       y2="61.411873" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3266"
+       id="linearGradient2491"
+       gradientUnits="userSpaceOnUse"
+       x1="0.39405614"
+       y1="54.462219"
+       x2="11.394055"
+       y2="54.462219" />
+    <radialGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3293"
+       id="radialGradient2493"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(1.0469958,0,-3.495377e-8,11.287276,0.5185009,-523.99721)"
+       cx="5.8940554"
+       cy="49.993374"
+       fx="5.8940554"
+       fy="49.993374"
+       r="2.5625" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3335"
+       id="linearGradient2495"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(0.3933508,0,0,0.1967871,3.5756237,10.288784)"
+       x1="0.42684901"
+       y1="29.305779"
+       x2="15.810218"
+       y2="29.305779" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient5706"
+       id="linearGradient2497"
+       gradientUnits="userSpaceOnUse"
+       x1="-0.60594404"
+       y1="29.305782"
+       x2="12.394056"
+       y2="29.305782" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3250"
+       id="linearGradient2499"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(0.2508507,0,0,-0.6252128,4.4155281,45.753135)"
+       x1="-2.0788133"
+       y1="29.305784"
+       x2="13.866926"
+       y2="29.305784" />
+    <linearGradient
+       id="linearGradient3583">
+      <stop
+         id="stop3585"
+         offset="0"
+         style="stop-color:#93e98e;stop-opacity:1;" />
+      <stop
+         id="stop3587"
+         offset="1"
+         style="stop-color:#6dcc67;stop-opacity:1;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3565">
+      <stop
+         id="stop3567"
+         offset="0"
+         style="stop-color:#bae9b7;stop-opacity:1;" />
+      <stop
+         id="stop3569"
+         offset="1"
+         style="stop-color:#71d06b;stop-opacity:1;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient5649">
+      <stop
+         style="stop-color:#fdfa8b;stop-opacity:1;"
+         offset="0"
+         id="stop5651" />
+      <stop
+         id="stop5659"
+         offset="0.73764622"
+         style="stop-color:#f8f6a3;stop-opacity:1;" />
+      <stop
+         style="stop-color:#f3f3bb;stop-opacity:0;"
+         offset="1"
+         id="stop5653" />
+    </linearGradient>
+    <filter
+       inkscape:collect="always"
+       id="filter5800"
+       x="-0.94982374"
+       width="2.8996475"
+       y="-0.11907261"
+       height="1.2381452">
+      <feGaussianBlur
+         inkscape:collect="always"
+         stdDeviation="1.7272821"
+         id="feGaussianBlur5802" />
+    </filter>
+    <filter
+       inkscape:collect="always"
+       id="filter5804"
+       x="-0.21361254"
+       width="1.4272251"
+       y="-0.19139649"
+       height="1.3827929">
+      <feGaussianBlur
+         inkscape:collect="always"
+         stdDeviation="1.7272821"
+         id="feGaussianBlur5806" />
+    </filter>
+    <filter
+       inkscape:collect="always"
+       id="filter5808"
+       x="-0.13307671"
+       width="1.2661535"
+       y="-0.48851702"
+       height="1.977034">
+      <feGaussianBlur
+         inkscape:collect="always"
+         stdDeviation="1.7272821"
+         id="feGaussianBlur5810" />
+    </filter>
+    <filter
+       inkscape:collect="always"
+       id="filter5812"
+       x="-0.1887085"
+       width="1.377417"
+       y="-0.25256062"
+       height="1.5051212">
+      <feGaussianBlur
+         inkscape:collect="always"
+         stdDeviation="1.7272821"
+         id="feGaussianBlur5814" />
+    </filter>
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient5820"
+       id="linearGradient5826"
+       x1="175.0497"
+       y1="-243.98534"
+       x2="175.0497"
+       y2="-279.2883"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="translate(-3.6373801e-2,0)" />
+    <linearGradient
+       id="linearGradient5016">
+      <stop
+         id="stop5018"
+         style="stop-color:#ffffff;stop-opacity:1;"
+         offset="0" />
+      <stop
+         id="stop5020"
+         style="stop-color:#ffffff;stop-opacity:0;"
+         offset="1" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient5820"
+       inkscape:collect="always">
+      <stop
+         id="stop5822"
+         offset="0"
+         style="stop-color:#3a8a2f;stop-opacity:0.35675675" />
+      <stop
+         id="stop5824"
+         offset="1"
+         style="stop-color:#3a8a2f;stop-opacity:0;" />
+    </linearGradient>
+    <linearGradient
+       id="linearGradient3760">
+      <stop
+         id="stop3762"
+         offset="0"
+         style="stop-color:#c43900;stop-opacity:1;" />
+      <stop
+         id="stop3764"
+         offset="1"
+         style="stop-color:#ffb911;stop-opacity:1;" />
+    </linearGradient>
+    <filter
+       height="2.0153902"
+       y="-0.50769508"
+       width="1.2013071"
+       x="-0.10065349"
+       id="filter4664"
+       inkscape:collect="always">
+      <feGaussianBlur
+         id="feGaussianBlur4666"
+         stdDeviation="2.2766069"
+         inkscape:collect="always" />
+    </filter>
+    <linearGradient
+       id="linearGradient9258">
+      <stop
+         style="stop-color:#d5d5d5;stop-opacity:1"
+         offset="0"
+         id="stop9260" />
+      <stop
+         style="stop-color:#ffffff;stop-opacity:1;"
+         offset="1"
+         id="stop9262" />
+    </linearGradient>
+    <radialGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient5016"
+       id="radialGradient10437"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(6.1850298e-3,0.2740564,-2.1663531,0.390327,447.7911,-219.13482)"
+       cx="507.94495"
+       cy="210.67746"
+       fx="507.94495"
+       fy="210.67746"
+       r="60.986797" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient10445"
+       id="linearGradient10482"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="translate(-42.5,0.538242)"
+       x1="11.481562"
+       y1="10.152135"
+       x2="11.481562"
+       y2="61.509136" />
+    <radialGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient5649"
+       id="radialGradient10484"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(2.6312899,6.0654036e-2,-5.4100758e-2,2.3469962,55.589854,-328.70769)"
+       cx="117.37347"
+       cy="120.71171"
+       fx="117.37347"
+       fy="120.71171"
+       r="16.006641" />
+    <radialGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3565"
+       id="radialGradient10486"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(0.2484736,-7.1602431e-2,1.3811445e-2,2.3376546e-2,-81.360283,42.349686)"
+       cx="161.46869"
+       cy="95.374214"
+       fx="161.46869"
+       fy="95.374214"
+       r="166.34375" />
+    <radialGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3583"
+       id="radialGradient10488"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(0.297931,5.0017064e-2,-5.0211767e-2,6.1243035e-2,-78.031287,22.591965)"
+       cx="118.71812"
+       cy="99.801773"
+       fx="118.71812"
+       fy="99.801773"
+       r="93.508942" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3450"
+       id="linearGradient10490"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="translate(-42.5,0.538242)"
+       x1="-3.2684402"
+       y1="8.0394249"
+       x2="-3.2684402"
+       y2="35.580303" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient9258"
+       id="linearGradient10610"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(0.9923991,-0.123061,0.3757196,0.9267334,-39.981562,-2.4118722)"
+       x1="38.95845"
+       y1="82.791977"
+       x2="58.156479"
+       y2="44.293991" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3760"
+       id="linearGradient10625"
+       gradientUnits="userSpaceOnUse"
+       x1="375.50848"
+       y1="394.17932"
+       x2="402.56219"
+       y2="381.91104" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3760"
+       id="linearGradient10627"
+       gradientUnits="userSpaceOnUse"
+       x1="409.82281"
+       y1="336.69012"
+       x2="427.75656"
+       y2="386.3616" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3760"
+       id="linearGradient10633"
+       gradientUnits="userSpaceOnUse"
+       x1="409.82281"
+       y1="336.69012"
+       x2="427.75656"
+       y2="386.3616"
+       gradientTransform="matrix(-0.5238366,0,0,0.5238366,281.69974,-155.31363)" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3760"
+       id="linearGradient10636"
+       gradientUnits="userSpaceOnUse"
+       x1="375.50848"
+       y1="394.17932"
+       x2="402.56219"
+       y2="381.91104"
+       gradientTransform="matrix(-0.5238366,0,0,0.5238366,261.71818,-157.7255)" />
+    <filter
+       inkscape:collect="always"
+       id="filter10646">
+      <feGaussianBlur
+         inkscape:collect="always"
+         stdDeviation="0.32769395"
+         id="feGaussianBlur10648" />
+    </filter>
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3760"
+       id="linearGradient2575"
+       gradientUnits="userSpaceOnUse"
+       x1="375.50848"
+       y1="394.17932"
+       x2="402.56219"
+       y2="381.91104" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3760"
+       id="linearGradient2577"
+       gradientUnits="userSpaceOnUse"
+       x1="409.82281"
+       y1="336.69012"
+       x2="427.75656"
+       y2="386.3616" />
+    <linearGradient
+       inkscape:collect="always"
+       xlink:href="#linearGradient3450"
+       id="linearGradient2585"
+       gradientUnits="userSpaceOnUse"
+       gradientTransform="matrix(0.9923991,-0.123061,0.3889736,0.959425,38.97063,89.543605)"
+       x1="-3.2684402"
+       y1="8.0394249"
+       x2="-3.2684402"
+       y2="35.580303" />
+    <inkscape:perspective
+       id="perspective3405"
+       inkscape:persp3d-origin="27.5 : 18.333333 : 1"
+       inkscape:vp_z="55 : 27.5 : 1"
+       inkscape:vp_y="0 : 1000 : 0"
+       inkscape:vp_x="0 : 27.5 : 1"
+       sodipodi:type="inkscape:persp3d" />
+    <inkscape:perspective
+       id="perspective3470"
+       inkscape:persp3d-origin="22.5 : 15 : 1"
+       inkscape:vp_z="45 : 22.5 : 1"
+       inkscape:vp_y="0 : 1000 : 0"
+       inkscape:vp_x="0 : 22.5 : 1"
+       sodipodi:type="inkscape:persp3d" />
+  </defs>
+  <metadata
+     id="metadata7">
+    <rdf:RDF>
+      <cc:Work
+         rdf:about="">
+        <dc:format>image/svg+xml</dc:format>
+        <dc:type
+           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
+      </cc:Work>
+    </rdf:RDF>
+  </metadata>
+  <g
+     style="display:inline"
+     transform="translate(-19.981562,-2.4118721)"
+     id="layer1"
+     inkscape:groupmode="layer"
+     inkscape:label="principal">
+    <text
+       inkscape:export-ydpi="71.219765"
+       inkscape:export-xdpi="71.219765"
+       inkscape:export-filename="/home/leon/VMeaglenest/gnu/img/OOo4Kids/200900406_app_icons.png"
+       sodipodi:linespacing="100%"
+       id="text3878"
+       y="-9.5239601"
+       x="-13.92922"
+       style="font-size:40px;font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;text-align:start;line-height:100%;writing-mode:lr-tb;text-anchor:start;fill:#7b7b7b;fill-opacity:1;stroke:none;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1;font-family:Black boys on mopeds"
+       xml:space="preserve"><tspan
+         y="-9.5239601"
+         x="-13.92922"
+         id="tspan3880"
+         sodipodi:role="line">OOo4Kids</tspan></text>
+    <path
+       sodipodi:nodetypes="cccccc"
+       id="path10529"
+       d="M 34.718558,125.37867 L 25.966652,103.79161 C 25.104686,101.66552 26.181197,99.73437 28.380354,99.461666 L 62.121927,95.277592 C 64.321084,95.004889 66.785452,96.496962 67.647418,98.623048 L 76.399324,120.21011"
+       style="fill:none;fill-opacity:1;stroke:url(#linearGradient2585);stroke-width:1;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-opacity:1;display:inline" />
+    <g
+       style="display:inline"
+       id="g10568"
+       transform="matrix(0.9923991,-0.123061,0.3889736,0.959425,80.938225,3.7971096)" />
+    <g
+       id="g3444"
+       transform="matrix(0.6146488,0,0,0.6146488,5.0614453,-1.0867669)">
+      <rect
+         transform="matrix(0.9923875,-0.1231546,0.3754706,0.9268343,0,0)"
+         style="fill:#aaaaaa;fill-opacity:1;stroke:#000000;stroke-width:4.96593714000000030;stroke-linejoin:bevel;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;display:inline"
+         id="rect10531"
+         width="32.281693"
+         height="41.802811"
+         x="12.833101"
+         y="40.874645"
+         rx="4.9999995"
+         ry="5" />
+      <g
+         transform="matrix(1.021538,0,0,1.021538,-49.789571,-1.6769528)"
+         id="g3418">
+        <path
+           sodipodi:nodetypes="cscssc"
+           id="path5162"
+           d="M 105.9211,50.91337 C 102.68482,54.072969 99.747391,60.710727 102.67554,60.037037 C 104.04473,59.722017 117.14161,53.828405 117.44676,48.148623 C 121.72369,48.649007 140.37502,35.385265 138.8574,30.716263 C 137.47954,26.477235 127.48184,33.08929 115.50388,42.746898 C 113.21361,44.593506 106.20081,50.575579 105.9211,50.91337 z"
+           style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:4.77792883;stroke-linecap:round;stroke-linejoin:round;marker:none;marker-start:none;marker-mid:none;marker-end:none;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
+        <path
+           sodipodi:nodetypes="cscssc"
+           id="path5164"
+           d="M 103.89326,50.814846 C 96.192442,51.613954 89.05465,49.924156 88.8673,46.845532 C 88.436208,39.865032 95.162941,32.16532 96.211866,32.407427 C 94.508543,29.727086 93.500802,12.63028 98.480356,11.603141 C 104.17285,10.428946 114.78777,29.42884 113.48231,41.018431 C 113.153,43.941943 104.21066,50.512194 103.89326,50.814846 z"
+           style="fill:#ffffff;fill-opacity:1;fill-rule:nonzero;stroke:#000000;stroke-width:4.77792883;stroke-linecap:round;stroke-linejoin:round;marker:none;marker-start:none;marker-mid:none;marker-end:none;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;visibility:visible;display:inline;overflow:visible;enable-background:accumulate" />
+        <path
+           id="path5166"
+           d="M 126.94049,31.439433 C 126.75149,31.79309 126.54382,32.140811 126.31831,32.479272 C 125.71641,33.382582 125.02671,34.085597 124.43977,34.391618 C 123.85283,34.697633 123.36184,34.571259 123.27653,33.753443 C 123.22163,33.227359 123.44971,32.446626 123.73678,31.697024 C 124.02384,30.94744 124.38185,30.206269 124.72482,29.634651 L 124.98993,30.053529 C 124.75957,30.43747 124.44474,31.08115 124.21946,31.669447 C 123.99417,32.25775 123.87246,32.763312 123.89673,32.996 C 123.955,33.554468 124.26194,33.629859 124.69554,33.403784 C 125.12913,33.177715 125.6806,32.615387 126.11836,31.958425 C 127.54069,29.823769 128.06558,27.088896 127.50121,26.037726 C 126.73835,24.616837 124.44116,26.213615 122.78163,29.095798 C 122.17166,30.155152 121.23703,31.057644 120.31077,32.805755 C 119.46125,34.409041 117.93695,35.874474 116.43799,39.04866 L 116.65095,38.086524 C 118.39099,35.785332 119.31308,34.175184 120.06321,32.830985 C 120.77603,31.553625 121.7099,30.077341 122.48984,28.722789 C 124.47852,25.268986 127.16207,23.410464 128.07538,25.111551 C 128.68322,26.243709 128.2634,28.963906 126.94049,31.439433 z"
+           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.59264302;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
+           sodipodi:nodetypes="cssssccsssssssccsssc" />
+        <path
+           id="path5170"
+           d="M 114.29199,25.163126 C 114.34366,25.566715 114.41517,25.974485 114.50788,26.381455 C 114.7557,27.469427 115.16387,28.422216 115.61956,28.968279 C 116.07526,29.514305 116.60065,29.62866 116.98866,28.935131 C 117.22864,28.50619 117.33576,27.75397 117.31735,26.948074 C 117.29897,26.142187 117.13478,25.220946 116.79717,24.614789 L 116.57827,25.522126 C 116.74718,25.8254 116.82638,26.262781 116.8375,26.750707 C 116.84864,27.238634 116.77032,27.7153 116.65337,27.924358 C 116.39395,28.388058 116.07566,28.314376 115.74457,27.917647 C 115.41347,27.520904 115.09253,26.769952 114.91543,25.992435 C 114.33829,23.458724 114.84071,20.802689 115.76762,20.132382 C 117.0225,19.224902 118.59487,21.691441 119.17261,25.017174 C 119.22017,25.290939 119.26511,25.931466 119.22591,26.741917 C 119.18669,27.552379 118.72457,29.426076 118.48298,30.491793 C 117.99982,32.623222 116.38384,36.701101 115.58512,39.196533 L 115.84985,40.308524 C 116.71998,37.986396 118.38659,33.559398 118.91323,31.236116 C 119.17655,30.074477 119.65639,28.085904 119.70251,27.132902 C 119.74861,26.179896 119.7163,25.396814 119.6077,24.771686 C 118.91869,20.805421 117.06041,17.896311 115.54508,18.99214 C 114.53541,19.722295 113.9304,22.33806 114.29199,25.163126 z"
+           style="fill:#000000;fill-opacity:1;fill-rule:evenodd;stroke:#000000;stroke-width:1.59264302;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1;display:inline"
+           sodipodi:nodetypes="cssssccssssssssccssssc" />
+      </g>
+    </g>
+    <g
+       id="g3473"
+       transform="translate(109.41154,4.7896594)">
+      <rect
+         id="rect3457"
+         style="fill:#aaaaaa;stroke:#000000;stroke-width:3"
+         height="40"
+         width="20"
+         y="3"
+         x="13" />
+      <line
+         id="line3459"
+         style="fill:#aaaaaa;stroke:#000000;stroke-width:3"
+         x2="33"
+         x1="25"
+         y2="13"
+         y1="13" />
+      <line
+         id="line3461"
+         style="fill:#aaaaaa;stroke:#000000;stroke-width:3"
+         x2="33"
+         x1="25"
+         y2="23"
+         y1="23" />
+      <line
+         id="line3463"
+         style="fill:#aaaaaa;stroke:#000000;stroke-width:3"
+         x2="33"
+         x1="25"
+         y2="33"
+         y1="33" />
+    </g>
+  </g>
+</svg>
diff --git sysui/desktop/share/misc/activity.info sysui/desktop/share/misc/activity.info
new file mode 100644
index 0000000..01c5712
--- /dev/null
+++ sysui/desktop/share/misc/activity.info
@@ -0,0 +1,8 @@
+[Activity]
+name = OOo4Kids
+bundle_id = ooo.educ.OOo4KidsActivity
+icon = activity-ooo4kids
+activity_version = 1
+host_version = 1
+show_launcher = yes
+exec = sugarOOo4Kids
diff --git sysui/desktop/share/misc/ooo4kidsrc.txt sysui/desktop/share/misc/ooo4kidsrc.txt
new file mode 100644
index 0000000..5144cb9
--- /dev/null
+++ sysui/desktop/share/misc/ooo4kidsrc.txt
@@ -0,0 +1,44 @@
+#
+# Configure file for UI colors in OOOo4Kids on Linux
+# Created by Eric Bachard 2009 09 25 (based on Mox Soini work )
+#
+# The settings under label [General] are used. Modify it according to
+# the other labels, if you want to change it.
+#
+
+# only the [General]  part is used
+# a commented line starts with # character
+
+[General]
+background=244,244,244
+foreground=0,0,0
+#selectBackground=52,112,204
+selectBackground=52,112,204
+selectForeground=255,255,255
+#font=Andale Mono,Andale Sans UI
+#cursorFlashTime=0
+
+# based on Mac OS X examples
+# invent your theme !
+
+[XO like]
+background=100,100,100
+foreground=255,255,255
+#selectBackground=52,112,204
+selectBackground=230,255,0
+selectForeground=0,0,0
+#font=Andale Mono,Andale Sans UI
+#cursorFlashTime=0
+
+[Aqua]
+background=244,244,244
+foreground=0,0,0
+selectBackground=52,112,204
+selectForeground=255,255,255
+
+[Graphite]
+background=244,244,244
+foreground=0,0,0
+selectBackground=94,106,121
+selectForeground=255,255,255
+
diff --git sysui/desktop/share/misc/setup.py sysui/desktop/share/misc/setup.py
new file mode 100644
index 0000000..ec0f64e
--- /dev/null
+++ sysui/desktop/share/misc/setup.py
@@ -0,0 +1,3 @@
+#!/usr/bin/env python
+from sugar.activity import bundlebuilder
+bundlebuilder.start()
diff --git sysui/desktop/share/misc/sugarOOo4Kids sysui/desktop/share/misc/sugarOOo4Kids
new file mode 100644
index 0000000..5c59dc5
--- /dev/null
+++ sysui/desktop/share/misc/sugarOOo4Kids
@@ -0,0 +1,13 @@
+#!/bin/sh
+while [ -n "$2" ] ; do
+     case "$1" in
+         -b | --bundle-id)     export SUGAR_BUNDLE_ID="$2" ;;
+         -a | --activity-id)   export SUGAR_ACTIVITY_ID="$2" ;;
+         -o | --object-id)     export SUGAR_OBJECT_ID="$2" ;;
+         -u | --uri)           export SUGAR_URI="$2" ;;
+         *) echo unknown argument $1 $2 ;;
+     esac
+     shift;shift
+done
+export NET_WM_NAME="OOo4Kids"
+exec ../resources/program/soffice
diff --git sysui/desktop/share/translate.pl sysui/desktop/share/translate.pl
index 8ae5557..325c87c 100644
--- sysui/desktop/share/translate.pl
+++ sysui/desktop/share/translate.pl
@@ -40,7 +40,7 @@ eval 'exec perl -wS $0 ${1+"$@"}'
 #
 
 my ($prefix, $ext, $key);
-$productname = "OpenOffice.org";
+$productname = "OOo4Kids";
 $workdir = ".";
 
 while ($_ = $ARGV[0], /^-/) {
diff --git sysui/desktop/slackware/makefile.mk sysui/desktop/slackware/makefile.mk
index ae08a37..9e8e3dc 100644
--- sysui/desktop/slackware/makefile.mk
+++ sysui/desktop/slackware/makefile.mk
@@ -44,7 +44,7 @@ TARGET=slackware
 
 # --- Files --------------------------------------------------------
 
-MENUFILES=$(PKGDIR)$/{$(PRODUCTLIST)}3.2-$(TARGET)-menus-$(PKGVERSION)-noarch-$(PKGREV).tgz
+MENUFILES=$(PKGDIR)$/{$(PRODUCTLIST)}-$(TARGET)-menus-$(PKGVERSION)-noarch-$(PKGREV).tgz
 
 .IF "$(USE_SHELL)"=="bash"
 ECHOPARAM=-e
diff --git sysui/desktop/slackware/slack-desc sysui/desktop/slackware/slack-desc
index 42d6ce8..b1937fa 100644
--- sysui/desktop/slackware/slack-desc
+++ sysui/desktop/slackware/slack-desc
@@ -10,4 +10,4 @@ PKGNAME: default, make sure to adapt the link
 PKGNAME:          /etc/UNIXFILENAME
 PKGNAME: accordingly to point to the correct location.
 PKGNAME:
-PKGNAME: This package is provided by OpenOffice.org
+PKGNAME: This package is provided by EducOOo
diff --git sysui/desktop/suse/suse-menus.spec sysui/desktop/suse/suse-menus.spec
index a1bd2b0..5845896 100644
--- sysui/desktop/suse/suse-menus.spec
+++ sysui/desktop/suse/suse-menus.spec
@@ -5,14 +5,14 @@ Summary: %productname desktop integration
 Name: %pkgprefix-suse-menus
 Group: Office
 License: LGPL
-Vendor: OpenOffice.org
+Vendor: EducOOo
 AutoReqProv: no
 BuildArch: noarch
 # /etc/SuSE-release for SuSE, SLES and Novell Linux Desktop ..
 Requires: /etc/SuSE-release
 # .. but not for Sun JDS
 Conflicts: SunDesktopVersion
-Provides: openoffice.org3-desktop-integration
+Provides: OOo4Kids-desktop-integration
 %define _unpackaged_files_terminate_build 0
 %description 
 %productname desktop integration
@@ -38,14 +38,14 @@ export GNOME_MIME_THEME=hicolor
 %clean
 rm -rf $RPM_BUILD_ROOT
 
-%triggerin -- %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-base, %pkgprefix-math
+%triggerin -- %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-ooo4kids, %pkgprefix-math
 if [ -x /opt/gnome/bin/update-desktop-database ]; then
   echo Update Desktop Database
   /opt/gnome/bin/update-desktop-database -q /usr/share/applications
   /opt/gnome/bin/update-desktop-database 
 fi 
 
-%triggerun -- %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-base, %pkgprefix-math
+%triggerun -- %pkgprefix, %pkgprefix-writer, %pkgprefix-calc, %pkgprefix-draw, %pkgprefix-impress, %pkgprefix-ooo4kids, %pkgprefix-math
 if [ "$1" = "0" ] ; then  
   # the menu-package gets uninstalled/updated - postun will run the command
   exit 0
@@ -131,7 +131,6 @@ application/vnd.sun.xml.draw.template std
 application/vnd.stardivision.draw sda
 application/vnd.sun.xml.math sxm
 application/vnd.stardivision.math smf
-application/vnd.sun.xml.base odb
 application/vnd.openofficeorg.extension oxt
 application/vnd.openxmlformats-officedocument.wordprocessingml.document docx
 application/vnd.ms-word.document.macroenabled.12 docm
@@ -215,8 +214,6 @@ application/vnd.sun.xml.draw; %unixfilename -view %s
 application/vnd.sun.xml.draw.template; %unixfilename -view %s
 application/vnd.stardivision.draw; %unixfilename -view %s
 application/x-stardraw; %unixfilename -view %s
-application/vnd.oasis.opendocument.database; %unixfilename -view %s
-application/vnd.sun.xml.base; %unixfilename -view %s
 application/vnd.wordperfect; %unixfilename -view %s
 application/wordperfect5.1; %unixfilename -view %s
 application/x-wordperfect; %unixfilename -view %s
@@ -278,7 +275,7 @@ for themedir in /opt/gnome/share/icons/gnome /opt/gnome/share/icons/hicolor /opt
 done
 
 %files
-%attr(0755,root,root) /usr/bin/soffice
+%attr(0755,root,root) /usr/bin/%unixfilename
 %attr(0755,root,root) %verify(not size md5) /usr/bin/%unixfilename
 %attr(0755,root,root) /usr/bin/%unixfilename-printeradmin
 %defattr(0644, root, root)
@@ -288,7 +285,7 @@ done
 /usr/share/applications/%unixfilename-draw.desktop
 /usr/share/applications/%unixfilename-impress.desktop
 /usr/share/applications/%unixfilename-math.desktop
-/usr/share/applications/%unixfilename-base.desktop
+/usr/share/applications/%unixfilename-ooo4kids.desktop
 /usr/share/applications/%unixfilename-printeradmin.desktop
 /usr/share/applications/%unixfilename-startcenter.desktop
 /opt/gnome/share/mime-info/*.keys
diff --git sysui/prj/d.lst sysui/prj/d.lst
index 1263769..5e5b320 100644
--- sysui/prj/d.lst
+++ sysui/prj/d.lst
@@ -1,6 +1,7 @@
 mkdir: %_DEST%\res%_EXT%\icons
 mkdir: %_DEST%\inc%_EXT%\icons
 mkdir: %_DEST%\bin%_EXT%\so
+mkdir: %_DEST%\bin%_EXT%\xo_files
 mkdir: %_DEST%\bin%_EXT%\desktop-integration
 mkdir: %_DEST%\bin%_EXT%\desktop-integration\rpm
 mkdir: %_DEST%\bin%_EXT%\desktop-integration\deb
@@ -10,9 +11,9 @@ mkdir: %_DEST%\bin%_EXT%\desktop-integration\pkg
 ..\%__SRC%\misc\*.gif %_DEST%\res%_EXT%\icons\*.gif
 ..\%__SRC%\bin\*.zip %_DEST%\bin%_EXT%\*.zip
 ..\%__SRC%\bin\*.tar.gz %_DEST%\bin%_EXT%\*.tar.gz
-..\%__SRC%\bin\rpm\*.tar.gz %_DEST%\bin%_EXT%\desktop-integration\rpm\*.tar.gz
-..\%__SRC%\bin\deb\*.tar.gz %_DEST%\bin%_EXT%\desktop-integration\deb\*.tar.gz
-..\%__SRC%\bin\pkg\*.tar.gz %_DEST%\bin%_EXT%\desktop-integration\pkg\*.tar.gz
+..\%__SRC%\bin\rpm\OOo4Kids-desktop-integration.tar.gz %_DEST%\bin%_EXT%\desktop-integration\rpm\ooo4kids-desktop-integration.tar.gz
+..\%__SRC%\bin\deb\OOo4Kids-desktop-integration.tar.gz %_DEST%\bin%_EXT%\desktop-integration\deb\ooo4kids-desktop-integration.tar.gz
+..\%__SRC%\bin\pkg\OOo4Kids-desktop-integration.tar.gz %_DEST%\bin%_EXT%\desktop-integration\pkg\ooo4kids-desktop-integration.tar.gz
 
 ..\%__SRC%\bin\*.dll %_DEST%\bin%_EXT%\*.dll
 ..\%__SRC%\bin\quickstart.exe %_DEST%\bin%_EXT%\quickstart.exe
@@ -23,3 +24,10 @@ mkdir: %_DEST%\bin%_EXT%\desktop-integration\pkg
 ..\%__SRC%\misc\desktopshare\*.desktop %_DEST%\pck%_EXT%\*.desktop
 ..\%__SRC%\misc\PkgInfo %_DEST%\pck%_EXT%\PkgInfo
 ..\%__SRC%\misc\Info.plist %_DEST%\pck%_EXT%\Info.plist
+
+..\%__SRC%\misc\ooo4kidsrc.txt %_DEST%\bin%_EXT%\ooo4kidsrc.txt
+..\%__SRC%\misc\MANIFEST %_DEST%\bin%_EXT%\MANIFEST
+..\%__SRC%\misc\activity.info %_DEST%\bin%_EXT%\activity.info
+..\%__SRC%\misc\activity-ooo4kids.svg %_DEST%\bin%_EXT%\activity-ooo4kids.svg
+..\%__SRC%\misc\sugarOOo4Kids %_DEST%\bin%_EXT%\sugarOOo4Kids
+..\%__SRC%\misc\setup.py %_DEST%\bin%_EXT%\setup.py
diff --git testtools/com/sun/star/comp/bridge/makefile.mk testtools/com/sun/star/comp/bridge/makefile.mk
index 8f1a15f..acd2196 100644
--- testtools/com/sun/star/comp/bridge/makefile.mk
+++ testtools/com/sun/star/comp/bridge/makefile.mk
@@ -38,6 +38,10 @@ TARGET=com_sun_star_comp_bridge
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :  settings.mk
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
 
 # ------------------------------------------------------------------
 
diff --git testtools/source/bridgetest/cli/makefile.mk testtools/source/bridgetest/cli/makefile.mk
index 630cfeb..90ee24b 100644
--- testtools/source/bridgetest/cli/makefile.mk
+++ testtools/source/bridgetest/cli/makefile.mk
@@ -45,6 +45,11 @@ CCACHE_DISABLE=TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 DLLPRE =
 CFLAGSENABLESYMBOLS:=-Z7
diff --git testtools/source/bridgetest/idl/makefile.mk testtools/source/bridgetest/idl/makefile.mk
index 1b4b517..8a94051 100644
--- testtools/source/bridgetest/idl/makefile.mk
+++ testtools/source/bridgetest/idl/makefile.mk
@@ -33,9 +33,15 @@ PRJ := ..$/..$/..
 PRJNAME := testtools
 TARGET := bridgetest_idl
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE: settings.mk
 .INCLUDE: target.mk
 .IF "$(L10N_framework)"==""
+
 ALLTAR: $(MISC)$/$(TARGET).cppumaker.done $(MISC)$/$(TARGET).javamaker.done
 
 $(MISC)$/$(TARGET).cppumaker.done: $(BIN)$/bridgetest.rdb
diff --git testtools/source/bridgetest/makefile.mk testtools/source/bridgetest/makefile.mk
index 3dfb18c..00865c4 100644
--- testtools/source/bridgetest/makefile.mk
+++ testtools/source/bridgetest/makefile.mk
@@ -37,8 +37,14 @@ USE_DEFFILE=TRUE
 ENABLE_EXCEPTIONS=TRUE
 LIBTARGET=NO
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE: settings.mk
 .IF "$(L10N_framework)"==""
+
 DLLPRE = # no leading "lib" on .so files
 
 .IF "$(GUI)"=="WNT"
@@ -121,7 +127,7 @@ SHL3VERSIONMAP = component.map
 SHL3IMPLIB = i$(SHL3TARGET)
 DEF3NAME = $(SHL3TARGET)
 
-.IF "$(SOLAR_JAVA)" != ""
+.IF "$(SOLAR_JAVA)" != "" && "$(OOo4Kids)"!="YES"
 JARFILES = java_uno.jar jurt.jar ridl.jar
 JAVATARGETS=\
     $(DLLDEST)$/bridgetest_javaserver$(BATCH_SUFFIX) \
@@ -184,7 +190,7 @@ $(DLLDEST)$/bridgetest_server$(BATCH_SUFFIX) .ERRREMOVE: makefile.mk
     $(GIVE_EXEC_RIGHTS) $@
 
 
-.IF "$(SOLAR_JAVA)" != ""
+.IF "$(SOLAR_JAVA)" != "" && "$(OOo4Kids)"!="YES"
 # jar-files, which regcomp needs so that it can use java
 MY_JARS=java_uno.jar ridl.jar jurt.jar juh.jar
 
diff --git testtools/source/bridgetest/pyuno/makefile.mk testtools/source/bridgetest/pyuno/makefile.mk
index 44b9f98..2d624cc 100644
--- testtools/source/bridgetest/pyuno/makefile.mk
+++ testtools/source/bridgetest/pyuno/makefile.mk
@@ -40,6 +40,12 @@ ENABLE_EXCEPTIONS=TRUE
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :  settings.mk
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 # --- Files --------------------------------------------------------
 .IF "$(L10N_framework)"==""
 PYEXC=$(DLLDEST)$/python$(EXECPOST)
diff --git testtools/source/cliversioning/makefile.mk testtools/source/cliversioning/makefile.mk
index d319ce7..22a86e9 100644
--- testtools/source/cliversioning/makefile.mk
+++ testtools/source/cliversioning/makefile.mk
@@ -36,6 +36,11 @@ PRJNAME = cli_ure
 TARGET := test_climaker
 PACKAGE = cliversion
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE: settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git testtools/source/performance/makefile.mk testtools/source/performance/makefile.mk
index 3f7f557..a264eac 100644
--- testtools/source/performance/makefile.mk
+++ testtools/source/performance/makefile.mk
@@ -43,6 +43,11 @@ LIBTARGET=NO
 
 # ------------------------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 LIB1TARGET=$(SLB)$/perftest.lib
 LIB1OBJFILES= \
         $(SLO)$/ubtest.obj
diff --git testtools/source/servicetests/makefile.mk testtools/source/servicetests/makefile.mk
index df31205..fbddb28 100644
--- testtools/source/servicetests/makefile.mk
+++ testtools/source/servicetests/makefile.mk
@@ -30,6 +30,12 @@
 #*************************************************************************
 
 PRJ := ..$/..
+
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 PRJNAME := testtools
 TARGET := testtools_servicetests
 
diff --git testtools/util/makefile.pmk testtools/util/makefile.pmk
index b52727a..2d75df9 100644
--- testtools/util/makefile.pmk
+++ testtools/util/makefile.pmk
@@ -37,3 +37,7 @@ CFLAGSENABLESYMBOLS:=-Z7
 .ENDIF
 .ENDIF			# "L10N_framework"==""
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
diff --git transex3/java/l10nconv/makefile.mk transex3/java/l10nconv/makefile.mk
index feb8697..200ed43 100755
--- transex3/java/l10nconv/makefile.mk
+++ transex3/java/l10nconv/makefile.mk
@@ -33,6 +33,11 @@ PRJ=../..
 PRJNAME=transex3
 TARGET=converter
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 
 ALLTAR : ANTBUILD
diff --git transex3/java/receditor/makefile.mk transex3/java/receditor/makefile.mk
index e5e3921..61201af 100755
--- transex3/java/receditor/makefile.mk
+++ transex3/java/receditor/makefile.mk
@@ -33,6 +33,11 @@ PRJ=../..
 PRJNAME=transex3
 TARGET=receditor
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 
 ALLTAR : ANTBUILD
diff --git transex3/source/filter/merge/makefile.mk transex3/source/filter/merge/makefile.mk
index bf768be..5b214b9 100644
--- transex3/source/filter/merge/makefile.mk
+++ transex3/source/filter/merge/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/filter$/config$/tools$/merge
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE: settings.mk
 
 #----- compile .java files -----------------------------------------
@@ -77,7 +82,7 @@ JARCOMPRESS     =   TRUE
 
 .INCLUDE :  target.mk
 
-.IF "$(SOLAR_JAVA)" != "" || "$(GUI)"=="OS2"
+.IF "$(SOLAR_JAVA)" != "" || "$(GUI)"=="OS2" || "$(OOo4Kids)"!="YES"
 ALLTAR : $(OWNCOPY)
 
 .IF "$(JARTARGETN)" != ""
diff --git transex3/source/filter/utils/makefile.mk transex3/source/filter/utils/makefile.mk
index d41d8ba..2f9450a 100644
--- transex3/source/filter/utils/makefile.mk
+++ transex3/source/filter/utils/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/filter$/config$/tools$/utils
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo : "Nothing to build "
+.ENDIF
+
 .INCLUDE: settings.mk
 
 #----- compile .java files -----------------------------------------
diff --git transex3/source/help/makefile.mk transex3/source/help/makefile.mk
index edf68d9..10e53c1 100644
--- transex3/source/help/makefile.mk
+++ transex3/source/help/makefile.mk
@@ -95,6 +95,7 @@ SHL1USE_EXPORTS	=ordinal
 DEF1NAME	=$(SHL1TARGET) 
 DEFLIB1NAME	=$(TARGET)
 
+.IF "$(OOo4Kids)"!="YES"
 JAVAFILES = \
     HelpIndexerTool.java			        \
     HelpFileDocument.java
@@ -124,11 +125,13 @@ JARCLASSDIRS	   = $(PACKAGE)/*
 JARTARGET	       = HelpIndexerTool.jar
 JARCOMPRESS        = TRUE 
 #CUSTOMMANIFESTFILE = MANIFEST.MF 
+.ENDIF # "$(OOo4Kids)"!="YES" 
  
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :  target.mk
 
+.IF "$(OOo4Kids)"!="YES"
 .IF "$(JARTARGETN)"!=""
 $(JARTARGETN) : $(COMP)
 .ENDIF
@@ -137,3 +140,4 @@ fix_system_lucene:
     @echo "Fix Java Class-Path entry for Lucene libraries from system."
     @$(SED) -r -e "s#^(Class-Path:).*#\1 file://$(LUCENE_CORE_JAR) file://$(LUCENE_ANALYZERS_JAR)#" \
     -i ../../$(INPATH)/class/HelpLinker/META-INF/MANIFEST.MF
+.ENDIF # "$(OOo4Kids)"!="YES"
diff --git unoil/climaker/makefile.mk unoil/climaker/makefile.mk
index c72291a..e224391 100644
--- unoil/climaker/makefile.mk
+++ unoil/climaker/makefile.mk
@@ -35,6 +35,11 @@ PRJNAME = unoil
 # for dummy
 TARGET = unotypes
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
diff --git unoil/climaker/version.txt unoil/climaker/version.txt
index 4824a36..867c3d4 100644
--- unoil/climaker/version.txt
+++ unoil/climaker/version.txt
@@ -29,8 +29,8 @@
 #
 #*************************************************************************
 
-CLI_OOOTYPES_NEW_VERSION=1.0.4.0
-CLI_OOOTYPES_OLD_VERSION=1.0.0.0-1.0.3.0
-CLI_OOOTYPES_POLICY_VERSION=4.0.0.0	
+CLI_OOOTYPES_NEW_VERSION=1.0.3.0
+CLI_OOOTYPES_OLD_VERSION=1.0.0.0-1.0.2.0
+CLI_OOOTYPES_POLICY_VERSION=3.0.0.0	
 CLI_OOOTYPES_POLICY_ASSEMBLY=policy.1.0.cli_oootypes
 
diff --git unoil/util/makefile.mk unoil/util/makefile.mk
index 82c4890..4cca62b 100644
--- unoil/util/makefile.mk
+++ unoil/util/makefile.mk
@@ -37,6 +37,11 @@ TARGET	= unoil
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
 MAXLINELENGTH = 100000
 
 JARCLASSDIRS	= com drafts
diff --git unotools/inc/unotools/configmgr.hxx unotools/inc/unotools/configmgr.hxx
index 07a6ecd..9b9bd1c 100644
--- unotools/inc/unotools/configmgr.hxx
+++ unotools/inc/unotools/configmgr.hxx
@@ -102,7 +102,8 @@ namespace utl
                 PRODUCTXMLFILEFORMATVERSION,
                 WRITERCOMPATIBILITYVERSIONOOO11,
                 OPENSOURCECONTEXT,
-                ABOUTBOXPRODUCTVERSION
+                ABOUTBOXPRODUCTVERSION,
+                LICENSEBOXVERSION
             };
             //direct readonly access to some special configuration elements
             static com::sun::star::uno::Any GetDirectConfigProperty(ConfigProperty eProp);
diff --git unotools/source/config/configmgr.cxx unotools/source/config/configmgr.cxx
index 6c34be4..202482b 100644
--- unotools/source/config/configmgr.cxx
+++ unotools/source/config/configmgr.cxx
@@ -73,6 +73,8 @@ namespace
         : public rtl::Static< ::rtl::OUString, ProductVersion > {};
     struct AboutBoxProductVersion
         : public rtl::Static< ::rtl::OUString, AboutBoxProductVersion > {};
+    struct LicenseBoxVersion
+        : public rtl::Static< ::rtl::OUString, LicenseBoxVersion > {};
     struct ProductExtension
         : public rtl::Static< ::rtl::OUString, ProductExtension > {};
     struct XMLFileFormatName
@@ -429,6 +431,12 @@ Any ConfigManager::GetDirectConfigProperty(ConfigProperty eProp)
         return aRet;
     }
 
+    rtl::OUString &rLicenseBoxVersion = LicenseBoxVersion::get();
+    if ( eProp == LICENSEBOXVERSION && rLicenseBoxVersion.getLength() )
+    {
+        aRet <<= rLicenseBoxVersion;
+        return aRet;
+    }
     rtl::OUString &rAboutBoxProductVersion = AboutBoxProductVersion::get();
     if ( eProp == ABOUTBOXPRODUCTVERSION && rAboutBoxProductVersion.getLength() )
     {
@@ -496,6 +504,7 @@ Any ConfigManager::GetDirectConfigProperty(ConfigProperty eProp)
         case PRODUCTXMLFILEFORMATNAME :
         case PRODUCTXMLFILEFORMATVERSION:
         case OPENSOURCECONTEXT:
+        case LICENSEBOXVERSION:
         case ABOUTBOXPRODUCTVERSION:        sPath += C2U("Setup/Product"); break;
 
         case DEFAULTCURRENCY:				sPath += C2U("Setup/L10N"); break;
@@ -528,6 +537,7 @@ Any ConfigManager::GetDirectConfigProperty(ConfigProperty eProp)
             case LOCALE:							sProperty = C2U("ooLocale"); break;
             case PRODUCTNAME:						sProperty = C2U("ooName"); break;
             case PRODUCTVERSION:					sProperty = C2U("ooSetupVersion"); break;
+            case LICENSEBOXVERSION:				sProperty = C2U("ooSetupVersionLicenseBox"); break;
             case ABOUTBOXPRODUCTVERSION: 			sProperty = C2U("ooSetupVersionAboutBox"); break;
             case PRODUCTEXTENSION:					sProperty = C2U("ooSetupExtension"); break;
             case PRODUCTXMLFILEFORMATNAME:          sProperty = C2U("ooXMLFileFormatName"); break;
diff --git unoxml/source/rdf/makefile.mk unoxml/source/rdf/makefile.mk
index 298c1dc..ba9ad23 100644
--- unoxml/source/rdf/makefile.mk
+++ unoxml/source/rdf/makefile.mk
@@ -41,6 +41,11 @@ ENABLE_EXCEPTIONS=TRUE
 
 .INCLUDE :  settings.mk
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "nothing to build"
+.ENDIF
+
 .IF "$(SYSTEM_REDLAND)" == "YES"
 CFLAGS+=-DSYSTEM_REDLAND $(REDLAND_CFLAGS)
 .ENDIF
diff --git vcl/aqua/source/app/saldata.cxx vcl/aqua/source/app/saldata.cxx
index 852ad2a..c5b0f46 100644
--- vcl/aqua/source/app/saldata.cxx
+++ vcl/aqua/source/app/saldata.cxx
@@ -149,7 +149,11 @@ struct curs_ent
 }
 const aCursorTab[ POINTER_COUNT ] =
 {
+#ifdef OOo4Kids
+{ "arrow", { 16, 12 } }, //POINTER_ARROW
+#else
 { NULL, { 0, 0 } }, //POINTER_ARROW
+#endif
 { "nullptr", { 16, 16 } }, //POINTER_NULL
 { "hourglass", { 15, 15 } }, //POINTER_WAIT
 { NULL, { 0, 0 } }, //POINTER_TEXT
@@ -178,7 +182,7 @@ const aCursorTab[ POINTER_COUNT ] =
 { NULL, { 0, 0 } }, //POINTER_VSIZEBAR
 { NULL, { 0, 0 } }, //POINTER_HAND
 { NULL, { 0, 0 } }, //POINTER_REFHAND
-{ "pen", { 3, 27 } }, //POINTER_PEN
+{ "pen", { 3, 42 } }, //POINTER_PEN
 { "magnify", { 12, 13 } }, //POINTER_MAGNIFY
 { "fill", { 10, 22 } }, //POINTER_FILL
 { "rotate", { 15, 15 } }, //POINTER_ROTATE
@@ -242,7 +246,8 @@ const aCursorTab[ POINTER_COUNT ] =
 { "tblselse", { 30, 30 } }, //POINTER_TAB_SELECT_SE
 { "tblselw", { 1, 16 } }, //POINTER_TAB_SELECT_W
 { "tblselsw", { 1, 30 } }, //POINTER_TAB_SELECT_SW
-{ "pntbrsh", { 9, 16 } }  //POINTER_PAINTBRUSH
+{ "pntbrsh", { 9, 16 } },  //POINTER_PAINTBRUSH
+{ "eraser96", { 9, 16 } }  //POINTER_ERASER
 };
 
 NSCursor* SalData::getCursor( PointerStyle i_eStyle )
diff --git vcl/aqua/source/window/salframe.cxx vcl/aqua/source/window/salframe.cxx
index 468d7ad..1b198c7 100644
--- vcl/aqua/source/window/salframe.cxx
+++ vcl/aqua/source/window/salframe.cxx
@@ -821,7 +821,9 @@ NSCursor* AquaSalFrame::getCurrentCursor() const
     case POINTER_SSIZE:     pCursor = [NSCursor resizeDownCursor];      break;
     case POINTER_ESIZE:     pCursor = [NSCursor resizeRightCursor];      break;
     case POINTER_WSIZE:     pCursor = [NSCursor resizeLeftCursor];     break;
+#ifndef OOo4Kids
     case POINTER_ARROW:     pCursor = [NSCursor arrowCursor];           break;
+#endif
     case POINTER_VSPLIT:
     case POINTER_VSIZEBAR:
     case POINTER_WINDOW_NSIZE:
diff --git vcl/aqua/source/window/salmenu.cxx vcl/aqua/source/window/salmenu.cxx
index 4c65feb..297f277 100644
--- vcl/aqua/source/window/salmenu.cxx
+++ vcl/aqua/source/window/salmenu.cxx
@@ -52,6 +52,7 @@ const AquaSalMenu* AquaSalMenu::pCurrentMenuBar = NULL;
 -(void)showDialog: (int)nDialog;
 -(void)showPreferences: (id)sender;
 -(void)showAbout: (id)sender;
+-(void)showLicense: (id)sender;
 @end
 
 @implementation MainMenuSelector
@@ -67,11 +68,16 @@ const AquaSalMenu* AquaSalMenu::pCurrentMenuBar = NULL;
     }
     else
     {
+    // the SHOWDIALOG event associated with these string 
+    // is catched by the application, in windowcommanddispatch, in framework,
+        // is turned into command, and is dispatched as the command .uno:ShowLicense
         String aDialog;
         if( nDialog == SHOWDIALOG_ID_ABOUT )
             aDialog = String( RTL_CONSTASCII_USTRINGPARAM( "ABOUT" ) );
         else if( nDialog == SHOWDIALOG_ID_PREFERENCES )
             aDialog = String( RTL_CONSTASCII_USTRINGPARAM( "PREFERENCES" ) );
+        else if( nDialog == SHOWDIALOG_ID_LICENSE )
+            aDialog = String( RTL_CONSTASCII_USTRINGPARAM( "LICENSE" ) );
         const ApplicationEvent* pAppEvent = new ApplicationEvent( String(),
                                                                   ApplicationAddress(),
                                                                   ByteString( "SHOWDIALOG" ),
@@ -88,6 +94,10 @@ const AquaSalMenu* AquaSalMenu::pCurrentMenuBar = NULL;
 {
     [self showDialog: SHOWDIALOG_ID_ABOUT];
 }
+-(void)showLicense: (id) sender
+{
+    [self showDialog: SHOWDIALOG_ID_LICENSE];
+}
 @end
 
 
@@ -146,11 +156,25 @@ static void initAppMenu()
                         [pAppMenu insertItem: [NSMenuItem separatorItem] atIndex: 3];
                     }
                     
+                    // insert license entry
+                    String aLicense( ResId( SV_STDTEXT_LICENSE, *pMgr ) );
+                    pString = CreateNSString( aLicense );
+                    pNewItem = [pAppMenu insertItemWithTitle: pString
+                                         action: @selector(showLicense:)
+                                         keyEquivalent: @","
+                                         atIndex: 4];
+                    if (pString)
+                        [pString release];
+                    if( pNewItem )
+                    {
+                        [pNewItem setTarget: pMainMenuSelector];
+                        [pAppMenu insertItem: [NSMenuItem separatorItem] atIndex: 5];
+                    }
                     // WARNING: ultra ugly code ahead
                     
                     // rename standard entries
                     // rename "Services"
-                    pNewItem = [pAppMenu itemAtIndex: 4];
+                    pNewItem = [pAppMenu itemAtIndex: 5];
                     if( pNewItem )
                     {
                         pString = CreateNSString( String( ResId( SV_MENU_MAC_SERVICES, *pMgr ) ) );
@@ -160,7 +184,7 @@ static void initAppMenu()
                     }
 
                     // rename "Hide NewApplication"
-                    pNewItem = [pAppMenu itemAtIndex: 6];
+                    pNewItem = [pAppMenu itemAtIndex: 8];
                     if( pNewItem )
                     {
                         pString = CreateNSString( String( ResId( SV_MENU_MAC_HIDEAPP, *pMgr ) ) );
@@ -170,7 +194,7 @@ static void initAppMenu()
                     }
 
                     // rename "Hide Others"
-                    pNewItem = [pAppMenu itemAtIndex: 7];
+                    pNewItem = [pAppMenu itemAtIndex: 9];
                     if( pNewItem )
                     {
                         pString = CreateNSString( String( ResId( SV_MENU_MAC_HIDEALL, *pMgr ) ) );
@@ -180,7 +204,7 @@ static void initAppMenu()
                     }
 
                     // rename "Show all"
-                    pNewItem = [pAppMenu itemAtIndex: 8];
+                    pNewItem = [pAppMenu itemAtIndex: 10];
                     if( pNewItem )
                     {
                         pString = CreateNSString( String( ResId( SV_MENU_MAC_SHOWALL, *pMgr ) ) );
@@ -190,7 +214,7 @@ static void initAppMenu()
                     }
 
                     // rename "Quit NewApplication"
-                    pNewItem = [pAppMenu itemAtIndex: 10];
+                    pNewItem = [pAppMenu itemAtIndex: 12];
                     if( pNewItem )
                     {
                         pString = CreateNSString( String( ResId( SV_MENU_MAC_QUITAPP, *pMgr ) ) );
diff --git vcl/inc/vcl/cmdevt.hxx vcl/inc/vcl/cmdevt.hxx
index a7c908d..60e11d8 100644
--- vcl/inc/vcl/cmdevt.hxx
+++ vcl/inc/vcl/cmdevt.hxx
@@ -310,6 +310,10 @@ inline CommandModKeyData::CommandModKeyData( USHORT nCode )
 #define SHOWDIALOG_ID_PREFERENCES       1
 #define SHOWDIALOG_ID_ABOUT             2
 
+#if defined( OOo4Kids )
+#define SHOWDIALOG_ID_LICENSE		3
+#endif
+
 class VCL_DLLPUBLIC CommandDialogData
 {
     int             m_nDialogId;
diff --git vcl/inc/vcl/graphite_layout.hxx vcl/inc/vcl/graphite_layout.hxx
index 2ec3bc4..97121c8 100644
--- vcl/inc/vcl/graphite_layout.hxx
+++ vcl/inc/vcl/graphite_layout.hxx
@@ -53,11 +53,12 @@
 #include <vcl/dllapi.h>
 // Module
 
+#ifndef OOo4Kids
 // For backwards compatibility with 2.4.x
 #if (SUPD == 680)
 typedef sal_Int32 sal_GlyphId;
 #endif
-
+#endif  // !OOo4Kids
 
 // Module type definitions and forward declarations.
 //
diff --git vcl/inc/vcl/introwin.hxx vcl/inc/vcl/introwin.hxx
index a4b9578..0fdaff2 100644
--- vcl/inc/vcl/introwin.hxx
+++ vcl/inc/vcl/introwin.hxx
@@ -48,6 +48,8 @@ public:
     IntroWindow();
     ~IntroWindow();
 
+//    void SetBackgroundBitmapEx( const BitmapEx& rBitmapEx );
+
     void SetBackgroundBitmap( const Bitmap& rBitmap );
 };
 
diff --git vcl/inc/vcl/menu.hxx vcl/inc/vcl/menu.hxx
index 4f8ad3a..ea043b5 100644
--- vcl/inc/vcl/menu.hxx
+++ vcl/inc/vcl/menu.hxx
@@ -90,6 +90,7 @@ typedef USHORT MenuItemBits;
 #define MIB_AUTOCHECK			((MenuItemBits)0x0004)
 #define MIB_ABOUT				((MenuItemBits)0x0008)
 #define MIB_HELP				((MenuItemBits)0x0010)
+#define MIB_SHOWLICENSE				((MenuItemBits)0x0016)
 #define MIB_POPUPSELECT 		((MenuItemBits)0x0020)
 // not in rsc/vclsrc.hxx because only a prelimitary solution
 #define MIB_NOSELECT 		    ((MenuItemBits)0x0040)
diff --git vcl/inc/vcl/ptrstyle.hxx vcl/inc/vcl/ptrstyle.hxx
index ba98c86..a86b7b6 100644
--- vcl/inc/vcl/ptrstyle.hxx
+++ vcl/inc/vcl/ptrstyle.hxx
@@ -139,7 +139,10 @@ typedef USHORT PointerStyle;
 // --> FME 2004-08-16 #i20119# Paintbrush tool
 #define POINTER_PAINTBRUSH              ((PointerStyle)93)
 // <--
-
+#ifdef OOo4Kids
+#define POINTER_ERASER              ((PointerStyle)94)
+#define POINTER_COUNT                   95
+#else
 #define POINTER_COUNT                   94
-
+#endif
 #endif // _VCL_PTRSTYLE_HXX
diff --git vcl/inc/vcl/salobj.hxx vcl/inc/vcl/salobj.hxx
index 1702b37..eeea4bb 100644
--- vcl/inc/vcl/salobj.hxx
+++ vcl/inc/vcl/salobj.hxx
@@ -73,6 +73,7 @@ public:
 
     virtual void					SetBackground() = 0;
     virtual void					SetBackground( SalColor nSalColor ) = 0;
+    virtual void                    SetForwardKey( BOOL bEnable ) {}
 
     virtual const SystemEnvData*	GetSystemData() const = 0;
 
diff --git vcl/inc/vcl/settings.hxx vcl/inc/vcl/settings.hxx
index 8562e0e..1616a96 100644
--- vcl/inc/vcl/settings.hxx
+++ vcl/inc/vcl/settings.hxx
@@ -517,6 +517,7 @@ private:
 #define STYLE_TOOLBAR_ICONSIZE_LARGE		((ULONG)2)
 
 #define STYLE_SYMBOLS_AUTO			((ULONG)0)
+#ifndef OOo4Kids
 #define STYLE_SYMBOLS_DEFAULT		((ULONG)1)
 #define STYLE_SYMBOLS_HICONTRAST	((ULONG)2)
 #define STYLE_SYMBOLS_INDUSTRIAL	((ULONG)3)
@@ -524,6 +525,11 @@ private:
 #define STYLE_SYMBOLS_TANGO		((ULONG)5)
 #define STYLE_SYMBOLS_CLASSIC		((ULONG)6)
 #define STYLE_SYMBOLS_THEMES_MAX	((ULONG)6)
+#else
+#define STYLE_SYMBOLS_DEFAULT		((ULONG)1)
+#define STYLE_SYMBOLS_CRYSTAL		((ULONG)2)
+#define STYLE_SYMBOLS_THEMES_MAX	((ULONG)1)
+#endif
 
 #define STYLE_CURSOR_NOBLINKTIME    ((ULONG)0xFFFFFFFF)
 
diff --git vcl/inc/vcl/svids.hrc vcl/inc/vcl/svids.hrc
index 4de4e9b..1003656 100644
--- vcl/inc/vcl/svids.hrc
+++ vcl/inc/vcl/svids.hrc
@@ -108,7 +108,8 @@
 #define SV_STDTEXT_ABOUT                    10204
 #define SV_STDTEXT_PREFERENCES              10205
 #define SV_MAC_SCREENNNAME                  10206
-#define SV_STDTEXT_LAST 					SV_MAC_SCREENNNAME
+#define SV_STDTEXT_LICENSE		    10207
+#define SV_STDTEXT_LAST 		SV_STDTEXT_LICENSE
 
 #define SV_ACCESSERROR_FIRST				SV_ACCESSERROR_WRONG_VERSION
 #define SV_ACCESSERROR_WRONG_VERSION		10500
diff --git vcl/inc/vcl/syschild.hxx vcl/inc/vcl/syschild.hxx
index 239f08b..ed1ce1e 100644
--- vcl/inc/vcl/syschild.hxx
+++ vcl/inc/vcl/syschild.hxx
@@ -65,6 +65,7 @@ public:
     //  however, this might not always be required
     void                    EnableEraseBackground( BOOL bEnable = TRUE );
     BOOL                    IsEraseBackgroundEnabled();
+     void                    SetForwardKey( BOOL bEnable );
 };
 
 #endif // _SV_SYSCHILD_HXX
diff --git vcl/inc/vcl/toolbox.h vcl/inc/vcl/toolbox.h
index 32baf7f..aadec4f 100644
--- vcl/inc/vcl/toolbox.h
+++ vcl/inc/vcl/toolbox.h
@@ -44,13 +44,19 @@
 #define TB_DROPDOWNARROWWIDTH   11
 
 #define TB_MENUBUTTON_SIZE      12
-#define TB_MENUBUTTON_OFFSET    2
 
+#define TB_MENUBUTTON_OFFSET    2
 #define TB_SMALLIMAGESIZE       16
 
+#ifndef OOo4Kids
 #define TB_LARGEIMAGESIZE            26
 #define TB_LARGEIMAGESIZE_INDUSTRIAL 24
 #define TB_LARGEIMAGESIZE_CRYSTAL    22
+#else
+#define TB_LARGEIMAGESIZE            36
+#define TB_LARGEIMAGESIZE_INDUSTRIAL 30
+#define TB_LARGEIMAGESIZE_CRYSTAL    45
+#endif
 
 class Window;
 
diff --git vcl/inc/vcl/wrkwin.hxx vcl/inc/vcl/wrkwin.hxx
index 4a9a115..ca68a78 100644
--- vcl/inc/vcl/wrkwin.hxx
+++ vcl/inc/vcl/wrkwin.hxx
@@ -58,7 +58,8 @@ private:
     BOOL            mbPresentationMode:1,
                     mbPresentationVisible:1,
                     mbPresentationFull:1,
-                    mbFullScreenMode:1;
+                    mbFullScreenMode:1,
+            mbIsRemoteActive:1;
 
     SAL_DLLPRIVATE void ImplInitWorkWindowData();
     SAL_DLLPRIVATE void ImplInit( Window* pParent, WinBits nStyle, const ::com::sun::star::uno::Any& aSystemWorkWindowToken );
@@ -106,6 +107,9 @@ public:
 
     void			Maximize( BOOL bMaximize = TRUE );
     BOOL			IsMaximized();
+    void	    SetRemoteUsable() { mbIsRemoteActive = TRUE; }
+    void	    SetRemoteNotUsable() { mbIsRemoteActive = FALSE; }
+    BOOL	    IsRemoteUsable() const { return mbIsRemoteActive; } 
 };
 
 #endif // _SV_WRKWIN_HXX
diff --git vcl/source/app/settings.cxx vcl/source/app/settings.cxx
index 8bb191b..6886950 100644
--- vcl/source/app/settings.cxx
+++ vcl/source/app/settings.cxx
@@ -702,11 +702,13 @@ void StyleSettings::Set3DColors( const Color& rColor )
     switch ( nStyle )
     {
         case STYLE_SYMBOLS_DEFAULT:    return ::rtl::OUString::createFromAscii( "default" );
-        case STYLE_SYMBOLS_HICONTRAST: return ::rtl::OUString::createFromAscii( "hicontrast" );
-        case STYLE_SYMBOLS_INDUSTRIAL: return ::rtl::OUString::createFromAscii( "industrial" );
         case STYLE_SYMBOLS_CRYSTAL:    return ::rtl::OUString::createFromAscii( "crystal" );
+#ifndef OOo4Kids
+        case STYLE_SYMBOLS_HICONTRAST: return ::rtl::OUString::createFromAscii( "hicontrast" );
         case STYLE_SYMBOLS_TANGO:      return ::rtl::OUString::createFromAscii( "tango" );
+        case STYLE_SYMBOLS_INDUSTRIAL: return ::rtl::OUString::createFromAscii( "industrial" );
         case STYLE_SYMBOLS_CLASSIC:    return ::rtl::OUString::createFromAscii( "classic" );
+#endif
     }
 
     return ::rtl::OUString::createFromAscii( "auto" );
@@ -718,17 +720,18 @@ ULONG StyleSettings::ImplNameToSymbolsStyle( const ::rtl::OUString &rName ) cons
 {
     if ( rName == ::rtl::OUString::createFromAscii( "default" ) )
         return STYLE_SYMBOLS_DEFAULT;
-    else if ( rName == ::rtl::OUString::createFromAscii( "hicontrast" ) )
-        return STYLE_SYMBOLS_HICONTRAST;
-    else if ( rName == ::rtl::OUString::createFromAscii( "industrial" ) )
-        return STYLE_SYMBOLS_INDUSTRIAL;
     else if ( rName == ::rtl::OUString::createFromAscii( "crystal" ) )
         return STYLE_SYMBOLS_CRYSTAL;
+#ifndef OOo4Kids
     else if ( rName == ::rtl::OUString::createFromAscii( "tango" ) )
         return STYLE_SYMBOLS_TANGO;
+    else if ( rName == ::rtl::OUString::createFromAscii( "hicontrast" ) )
+        return STYLE_SYMBOLS_HICONTRAST;
+    else if ( rName == ::rtl::OUString::createFromAscii( "industrial" ) )
+        return STYLE_SYMBOLS_INDUSTRIAL;
     else if ( rName == ::rtl::OUString::createFromAscii( "classic" ) )
         return STYLE_SYMBOLS_CLASSIC;
-
+#endif
     return STYLE_SYMBOLS_AUTO;
 }
 
@@ -779,8 +782,11 @@ ULONG StyleSettings::GetCurrentSymbolsStyle() const
 
             nPreferredStyle = snFallbackDesktopStyle;
         }
-
+#ifndef OOo4Kids
         nStyle = GetHighContrastMode()? STYLE_SYMBOLS_HICONTRAST: nPreferredStyle;
+#else
+        nStyle = STYLE_SYMBOLS_CRYSTAL;
+#endif
     }
 
     return nStyle;
@@ -790,7 +796,9 @@ ULONG StyleSettings::GetCurrentSymbolsStyle() const
 
 ULONG StyleSettings::GetAutoSymbolsStyle() const
 {
+#ifndef OOo4Kids
     const ::rtl::OUString&      rDesktopEnvironment = Application::GetDesktopEnvironment();
+#endif
     ULONG                       nRet = STYLE_SYMBOLS_DEFAULT;
     bool                        bCont = true;
 
@@ -810,10 +818,14 @@ ULONG StyleSettings::GetAutoSymbolsStyle() const
 
     if( bCont )
     {
+#ifndef OOo4Kids
         if( rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "gnome" ) )
             nRet = STYLE_SYMBOLS_TANGO;
         else if( rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "kde" ) )
             nRet = STYLE_SYMBOLS_CRYSTAL;
+#else
+            nRet = STYLE_SYMBOLS_CRYSTAL;
+#endif
     }
 
     return nRet;
diff --git vcl/source/src/stdtext.src vcl/source/src/stdtext.src
index 4cfbd91..e9119d2 100644
--- vcl/source/src/stdtext.src
+++ vcl/source/src/stdtext.src
@@ -109,6 +109,18 @@ String SV_STDTEXT_ABOUT
     Text [ en-US ] = "About %PRODUCTNAME";
 };
 
+String SV_STDTEXT_LICENSE
+{
+    Text [ en-US ] = "License...";
+    Text [ fr ] = "Licence...";
+    Text [ es ] = "Licensia...";
+    Text [ pt ] = "Licena...";
+    Text [ it ] = "Licenza...";
+    Text [ nl ] = "Licentie...";
+    Text [ zh-CN ] = "";
+};
+
+
 String SV_STDTEXT_PREFERENCES
 {
     Text [ en-US ] = "Preferences...";
diff --git vcl/source/window/cursor.cxx vcl/source/window/cursor.cxx
index 30cf754..701c77e 100644
--- vcl/source/window/cursor.cxx
+++ vcl/source/window/cursor.cxx
@@ -57,6 +57,7 @@ struct ImplCursorData
 
 // =======================================================================
 
+
 static void ImplCursorInvert( ImplCursorData* pData )
 {
     Window* pWindow  = pData->mpWindow;
@@ -67,8 +68,14 @@ static void ImplCursorInvert( ImplCursorData* pData )
         nInvertStyle = INVERT_50;
     else
         nInvertStyle = 0;
-
+#ifdef OOo4Kids
+    Size aNewPixSize; 
+    aNewPixSize.setWidth(  1.5 * pData->maPixSize.getWidth() );
+    aNewPixSize.setHeight ( pData->maPixSize.getHeight() );
+    Rectangle aRect( pData->maPixPos, aNewPixSize );
+#else
     Rectangle aRect( pData->maPixPos, pData->maPixSize );
+#endif	
     if ( pData->mnDirection || pData->mnOrientation || pData->mnPixSlant )
     {
         Polygon aPoly( aRect );
diff --git vcl/source/window/javachild.cxx vcl/source/window/javachild.cxx
index 2a72973..efafbca 100644
--- vcl/source/window/javachild.cxx
+++ vcl/source/window/javachild.cxx
@@ -32,7 +32,7 @@
 #include "precompiled_vcl.hxx"
 
   
-#ifdef SOLAR_JAVA
+#if defined SOLAR_JAVA && !defined( OOo4Kids )
 #include <jni.h>
 #endif
 #include <comphelper/processfactory.hxx>
@@ -84,7 +84,7 @@ JavaChildWindow::~JavaChildWindow()
 
 void JavaChildWindow::implTestJavaException( void* pEnv )
 {
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     JNIEnv*     pJavaEnv = reinterpret_cast< JNIEnv* >( pEnv );
     jthrowable  jtThrowable = pJavaEnv->ExceptionOccurred();
     
@@ -109,7 +109,7 @@ void JavaChildWindow::implTestJavaException( void* pEnv )
 
         throw uno::RuntimeException(ouMessage, uno::Reference<uno::XInterface>());
     }
-#endif // SOLAR_JAVA
+#endif // SOLAR_JAVA && !OOo4Kids
 }
 
 // -----------------------------------------------------------------------
@@ -124,7 +124,7 @@ sal_IntPtr JavaChildWindow::getParentWindowHandleForJava()
     // FIXME: this is wrong
     nRet = reinterpret_cast< sal_IntPtr >( GetSystemData()->pView );
 #elif defined UNX
-#ifdef SOLAR_JAVA
+#if defined( SOLAR_JAVA ) && !defined( OOo4Kids )
     uno::Reference< lang::XMultiServiceFactory > xFactory( vcl::unohelper::GetMultiServiceFactory() );
         
     if( xFactory.is() && ( GetSystemData()->aWindow > 0 ) )
@@ -201,7 +201,7 @@ sal_IntPtr JavaChildWindow::getParentWindowHandleForJava()
         {
         }
     }
-#endif // SOLAR_JAVA
+#endif // SOLAR_JAVA && not OOo4Kids
 #else // WNT || QUARTZ || UNX
     // TBD
 #endif
diff --git vcl/source/window/syschild.cxx vcl/source/window/syschild.cxx
index 79aebbb..5a5c74f 100644
--- vcl/source/window/syschild.cxx
+++ vcl/source/window/syschild.cxx
@@ -193,3 +193,9 @@ BOOL SystemChildWindow::IsEraseBackgroundEnabled()
     else
         return FALSE;
 }
+
+void SystemChildWindow::SetForwardKey( BOOL bEnable )
+{
+       if ( mpWindowImpl->mpSysObj )
+               mpWindowImpl->mpSysObj->SetForwardKey( bEnable );
+}
diff --git vcl/source/window/toolbox.cxx vcl/source/window/toolbox.cxx
index 5f36ab1..2fe2b96 100644
--- vcl/source/window/toolbox.cxx
+++ vcl/source/window/toolbox.cxx
@@ -98,8 +98,14 @@ DBG_NAMEEX( Window )
 #define TB_SPIN_OFFSET          2
 #define TB_NEXT_SIZE            22
 #define TB_NEXT_OFFSET          2
+// adds offset on top / bottom of the image
+//#ifdef OOo4Kids
+//#define TB_BORDER_OFFSET1       16
+//#define TB_BORDER_OFFSET2       8
+//#else
 #define TB_BORDER_OFFSET1       4
 #define TB_BORDER_OFFSET2       2
+//#endif
 #define TB_CUSTOMIZE_OFFSET     2
 #define TB_RESIZE_OFFSET        3
 #define TB_MAXLINES             5
@@ -1859,6 +1865,9 @@ static void ImplAddButtonBorder( long &rWidth, long& rHeight, USHORT aOutStyle,
 {
     if ( aOutStyle & TOOLBOX_STYLE_OUTBUTTON )
     {
+    // OOo4Kids : can draw buttons on the expected area. 
+    // Pb: some buttons have something on right, 
+    // some not and this causes unaligned toolbars (mainly vertical toolbars)
         rWidth += OUTBUTTON_SIZE;
         rHeight += OUTBUTTON_SIZE;
     }
diff --git vcl/source/window/toolbox2.cxx vcl/source/window/toolbox2.cxx
index 23e0fa7..3fb8845 100644
--- vcl/source/window/toolbox2.cxx
+++ vcl/source/window/toolbox2.cxx
@@ -56,9 +56,11 @@ using namespace vcl;
 using namespace rtl;
 
 // =======================================================================
-
+//#ifdef OOo4Kids
+//#define TB_SEP_SIZE 			60
+//#else
 #define TB_SEP_SIZE 			8
-
+//#endif
 // -----------------------------------------------------------------------
 
 ImplToolBoxPrivateData::ImplToolBoxPrivateData() :
@@ -996,9 +998,11 @@ const Size& ToolBox::GetDefaultImageSize() const
         s_nSymbolsStyle = nSymbolsStyle;
         switch ( nSymbolsStyle )
         {
+#ifndef OOo4Kids
             case STYLE_SYMBOLS_INDUSTRIAL:
                 aLargeButtonSize = Size( TB_LARGEIMAGESIZE_INDUSTRIAL, TB_LARGEIMAGESIZE_INDUSTRIAL );
                 break;
+#endif
             case STYLE_SYMBOLS_CRYSTAL:
                 aLargeButtonSize = Size( TB_LARGEIMAGESIZE_CRYSTAL, TB_LARGEIMAGESIZE_CRYSTAL );
                 break;
diff --git vcl/source/window/window.cxx vcl/source/window/window.cxx
index 3b18e4d..bd32956 100644
--- vcl/source/window/window.cxx
+++ vcl/source/window/window.cxx
@@ -6382,7 +6382,7 @@ void Window::Show( BOOL bVisible, USHORT nFlags )
 {
     DBG_CHKTHIS( Window, ImplDbgCheckWindow );
 
-    if ( mpWindowImpl->mbVisible == bVisible )
+    if ( mpWindowImpl && mpWindowImpl->mbVisible == bVisible )
         return;
 
     ImplDelData aDogTag( this );
diff --git vcl/unx/gtk/window/gtkobject.cxx vcl/unx/gtk/window/gtkobject.cxx
index 38d67d6..a8a1c7e 100644
--- vcl/unx/gtk/window/gtkobject.cxx
+++ vcl/unx/gtk/window/gtkobject.cxx
@@ -212,3 +212,12 @@ void GtkSalObject::signalDestroy( GtkObject* pObj, gpointer object )
         pThis->m_pSocket = NULL;
     }
 }
+
+void GtkSalObject::SetForwardKey( BOOL bEnable )
+{
+    printf ("GtkSalObject::SetForwardKey\n");
+    if( bEnable )
+        gtk_widget_add_events( GTK_WIDGET( m_pSocket ), GDK_KEY_PRESS_MASK | GDK_KEY_RELEASE );
+    else
+        gtk_widget_set_events( GTK_WIDGET( m_pSocket ), ~(GDK_KEY_PRESS_MASK | GDK_KEY_RELEASE) & gtk_widget_get_events( GTK_WIDGET( m_pSocket ) ) );
+}
diff --git vcl/unx/inc/ooo4kidsint.hxx vcl/unx/inc/ooo4kidsint.hxx
new file mode 100644
index 0000000..c594a0d
--- /dev/null
+++ vcl/unx/inc/ooo4kidsint.hxx
@@ -0,0 +1,57 @@
+/*************************************************************************
+ *
+ *  OOo4Kids - a multi-platform office productivity suite
+ *
+ *  $RCSfile: oooo4kidsint.hxx,v $
+ 
+ *  $Revision: 1.0 $
+ *
+ *
+ *  Author : ericb
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 3
+ *
+ *
+ *    GNU Lesser General Public License Version 3
+ *    =============================================
+ *    Copyright 2009 Eric Bachard.
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 3, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef _SV_OOO4KIDSINT_HXX
+#define _SV_OOO4KIDSINT_HXX
+
+#ifndef _SV_DTINT_HXX
+#include <dtint.hxx>
+#endif
+#ifndef _LIST_HXX
+#include <tools/list.hxx>
+#endif
+
+class OOo4KidsIntegrator : public DtIntegrator
+{
+    friend DtIntegrator* DtIntegrator::CreateDtIntegrator();
+private:
+    OOo4KidsIntegrator();
+
+public:
+    virtual ~OOo4KidsIntegrator();
+
+    virtual void GetSystemLook( AllSettings& rSettings );
+};
+
+#endif
diff --git vcl/unx/inc/plugins/gtk/gtkobject.hxx vcl/unx/inc/plugins/gtk/gtkobject.hxx
index 8121b78..639f602 100644
--- vcl/unx/inc/plugins/gtk/gtkobject.hxx
+++ vcl/unx/inc/plugins/gtk/gtkobject.hxx
@@ -64,6 +64,7 @@ public:
 
     virtual void					SetBackground();
     virtual void					SetBackground( SalColor nSalColor );
+    virtual void                    SetForwardKey( BOOL bEnable );
 
     virtual const SystemEnvData*	GetSystemData() const;
    
diff --git vcl/unx/inc/sugarxproperties.hxx vcl/unx/inc/sugarxproperties.hxx
new file mode 100644
index 0000000..ad9a18c
--- /dev/null
+++ vcl/unx/inc/sugarxproperties.hxx
@@ -0,0 +1,18 @@
+/******************************
+ * Include file for the
+ * SetSugarXProperties function.
+ *******************************/
+
+#ifndef SUGAR_X_PROPERTIES_
+#define SUGAR_X_PROPERTIES_
+
+#ifndef XLIB_Window
+#define XLIB_Window unsigned int
+#endif
+
+void	SetSugarXProperties(Display *disp, Window win);
+void	SetSugarXProperties(Display *disp, XLIB_Window win);
+
+#undef XLIB_Window
+
+#endif
diff --git vcl/unx/source/app/makefile.mk vcl/unx/source/app/makefile.mk
index a7f790f..64f47d3 100644
--- vcl/unx/source/app/makefile.mk
+++ vcl/unx/source/app/makefile.mk
@@ -35,6 +35,10 @@ PRJNAME=vcl
 TARGET=salapp
 .INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
+.IF "$(XO_INTEL)"=="YES"
+ADDCDEFS+=-DXO_INTEL
+.ENDIF
+
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :  settings.mk
diff --git vcl/unx/source/app/saldisp.cxx vcl/unx/source/app/saldisp.cxx
index b9d3a59..01f2b45 100644
--- vcl/unx/source/app/saldisp.cxx
+++ vcl/unx/source/app/saldisp.cxx
@@ -106,6 +106,10 @@ Status XineramaGetInfo(Display*, int, XRectangle*, unsigned char*, int*);
 #include <osl/socket.h>
 #include <poll.h>
 
+#ifdef XO_INTEL
+#include <sugarxproperties.hxx>
+#endif
+
 using namespace rtl;
 using namespace vcl_sal;
 
@@ -738,7 +742,9 @@ void SalDisplay::initScreen( int nScreen ) const
                          (unsigned char*)&rSD.m_aRefWindow,
                          1
                          );
-
+#ifdef XO_INTEL
+    SetSugarXProperties(pDisp_, rSD.m_aRefWindow);
+#endif
         ByteString aExec( SessionManagerClient::getExecName(), osl_getThreadTextEncoding() );
         const char* argv[2];
         argv[0] = "/bin/sh";
diff --git vcl/unx/source/app/sm.cxx vcl/unx/source/app/sm.cxx
index 65289e5..3399a44 100644
--- vcl/unx/source/app/sm.cxx
+++ vcl/unx/source/app/sm.cxx
@@ -53,6 +53,10 @@
 
 #include <osl/conditn.h>
 
+#ifdef XO_INTEL
+#include <sugarxproperties.hxx>
+#endif
+
 #define USE_SM_EXTENSION
 
 #if OSL_DEBUG_LEVEL > 1
@@ -492,6 +496,9 @@ void SessionManagerClient::open()
                              (unsigned char*)aClientID.GetBuffer(),
                              aClientID.Len()
                              );
+#ifdef XO_INTEL
+      SetSugarXProperties(pDisp->GetDisplay(), pDisp->GetDrawable( pDisp->GetDefaultScreenNumber() ));
+#endif
         }
     }
     else if( ! aSmcConnection )
diff --git vcl/unx/source/app/wmadaptor.cxx vcl/unx/source/app/wmadaptor.cxx
index f72c4e3..69307e0 100644
--- vcl/unx/source/app/wmadaptor.cxx
+++ vcl/unx/source/app/wmadaptor.cxx
@@ -53,6 +53,10 @@
 #include <stdio.h>
 #endif
 
+#ifdef XO_INTEL
+#include <sugarxproperties.hxx>
+#endif
+
 namespace vcl_sal {
 
 class NetWMAdaptor : public WMAdaptor
@@ -1112,6 +1116,9 @@ void WMAdaptor::setWMName( X11SalFrame* pFrame, const String& rWMName ) const
                      PropModeReplace,
                      (unsigned char*)aWMLocale.getStr(),
                      aWMLocale.getLength() );
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, (XLIB_Window)pEnv->aShellWindow);
+#endif
     if (aProp.value != NULL)
         XFree( aProp.value );
 }
@@ -1147,6 +1154,9 @@ void NetWMAdaptor::setWMName( X11SalFrame* pFrame, const String& rWMName ) const
                          PropModeReplace,
                          (unsigned char*)aTitle.GetBuffer(),
                          aTitle.Len()+1 );
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, (XLIB_Window)pEnv->aShellWindow);
+#endif
     // The +1 copies the terminating null byte. Although
     // the spec says, this should not be necessary
     // at least the kwin implementation seems to depend
@@ -1207,6 +1217,9 @@ void NetWMAdaptor::setNetWMState( X11SalFrame* pFrame ) const
             XDeleteProperty( m_pDisplay,
                              pFrame->GetShellWindow(),
                              m_aWMAtoms[ NET_WM_STATE ] );
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, pFrame->GetShellWindow());
+#endif
         if( pFrame->mbMaximizedHorz
            && pFrame->mbMaximizedVert
            && ! ( pFrame->nStyle_ & SAL_FRAME_STYLE_SIZEABLE ) )
@@ -1297,6 +1310,9 @@ void GnomeWMAdaptor::setGnomeWMState( X11SalFrame* pFrame ) const
                          (unsigned char*)&nWinWMState,
                          1
                          );
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, pFrame->GetShellWindow());
+#endif
         if( pFrame->mbMaximizedHorz
            && pFrame->mbMaximizedVert
            && ! ( pFrame->nStyle_ & SAL_FRAME_STYLE_SIZEABLE ) )
@@ -1422,7 +1438,9 @@ void WMAdaptor::setFrameTypeAndDecoration( X11SalFrame* pFrame, WMWindowType eTy
                       PropModeReplace,
                       (unsigned char*)&aHint,
                       5 );
-
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, pFrame->GetShellWindow());
+#endif
     // set transientFor hint
     /*  #91030# dtwm will not map a dialogue if the transient
      *  window is iconified. This is deemed undesireable because
@@ -1520,6 +1538,9 @@ void NetWMAdaptor::setFrameTypeAndDecoration( X11SalFrame* pFrame, WMWindowType
                               m_pSalDisplay->GetRootWindow( pFrame->GetScreenNumber() ) );
         pFrame->mbTransientForRoot = true;
     }
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, pFrame->GetShellWindow());
+#endif
 }
 
 /*
@@ -1868,6 +1889,9 @@ void GnomeWMAdaptor::enableAlwaysOnTop( X11SalFrame* pFrame, bool bEnable ) cons
                              1
                              );
         }
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, pFrame->GetShellWindow());
+#endif
     }
 }
 
@@ -2388,6 +2412,9 @@ void NetWMAdaptor::setFrameStruts( X11SalFrame* pFrame,
                              nSetData
                              );
     }
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, pFrame->GetShellWindow());
+#endif
 }
 
 /*
@@ -2414,4 +2441,7 @@ void NetWMAdaptor::setUserTime( X11SalFrame* i_pFrame, long i_nUserTime ) const
                          1
                          );
     }
+#ifdef XO_INTEL
+      SetSugarXProperties(m_pDisplay, i_pFrame->GetShellWindow());
+#endif
 }
diff --git vcl/unx/source/gdi/dtint.cxx vcl/unx/source/gdi/dtint.cxx
index fdd0b05..d08a578 100644
--- vcl/unx/source/gdi/dtint.cxx
+++ vcl/unx/source/gdi/dtint.cxx
@@ -43,6 +43,9 @@
 #ifdef USE_CDE
 #include <cdeint.hxx>
 #endif
+#ifdef LINUX
+#include <ooo4kidsint.hxx>
+#endif
 #include <dtint.hxx>
 #include <saldisp.hxx>
 #include <saldata.hxx>
@@ -95,6 +98,9 @@ DtIntegrator::~DtIntegrator()
 
 DtIntegrator* DtIntegrator::CreateDtIntegrator()
 {
+#if defined( LINUX ) && defined( OOo4Kids ) 
+    return new OOo4KidsIntegrator();
+#endif
     /*
      *  #i22061# override desktop detection
      *  if environment variable OOO_FORCE_DESKTOP is set
diff --git vcl/unx/source/gdi/makefile.mk vcl/unx/source/gdi/makefile.mk
index bdd400b..ee5f4be 100644
--- vcl/unx/source/gdi/makefile.mk
+++ vcl/unx/source/gdi/makefile.mk
@@ -66,6 +66,11 @@ SLOFILES=	\
         $(SLO)$/xrender_peer.obj	\
         $(SLO)$/pspgraphics.obj
         
+.IF "$(OOo4Kids)"=="YES" && "$(OS)"=="LINUX"
+SLOFILES += \
+        $(SLO)$/ooo4kidsint.obj
+.ENDIF
+
 EXCEPTIONSFILES=\
         $(SLO)$/xlfd_extd.obj	\
         $(SLO)$/salgdi.obj		\
diff --git vcl/unx/source/gdi/ooo4kidsint.cxx vcl/unx/source/gdi/ooo4kidsint.cxx
new file mode 100644
index 0000000..c38902a
--- /dev/null
+++ vcl/unx/source/gdi/ooo4kidsint.cxx
@@ -0,0 +1,259 @@
+/*************************************************************************
+ *
+ *  OOo4Kids - a multi-platform office productivity suite
+ *
+ *  $RCSfile: ooo4kidsint.cxx,v $
+ *
+ *  $Revision: 1.0 $
+ *
+ *  Author: ericb
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 3.
+ *
+ *
+ *    GNU Lesser General Public License Version 3
+ *    =============================================
+ *    Copyright 2009 by Eric Bachard
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 3, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_vcl.hxx"
+
+#include <ooo4kidsint.hxx>
+#include <tools/config.hxx>
+#include <vcl/settings.hxx>
+#include <osl/thread.h>
+#include <osl/file.hxx>
+#include <rtl/bootstrap.hxx>
+#include <unistd.h>
+#include <cstdio>
+
+using namespace rtl;
+using namespace osl;
+
+OOo4KidsIntegrator::OOo4KidsIntegrator()
+{
+    meType = DtGeneric;
+}
+
+OOo4KidsIntegrator::~OOo4KidsIntegrator()
+{
+}
+
+void OOo4KidsIntegrator::GetSystemLook( AllSettings& rSettings )
+{
+    rtl_TextEncoding aEncoding = osl_getThreadTextEncoding();
+
+    StyleSettings aStyleSettings( rSettings.GetStyleSettings() );
+    // #i48001# set a default blink rate
+    aStyleSettings.SetCursorBlinkTime( 500 );
+
+    // #i61174# aquacolors 
+    // aUserConfigFile : string containing the user install directory completed with "/user/OOo4Kidsrc.txt"
+    // currently : ~/.ooo4kids/0.6/user/OOo4Kidsrc.txt
+    // aDefaultConfigFile : string containing the OpenOffice.org install directory + presets/OOo4Kidsrc.txt
+    // default should be <install_dir>/ooo4kids0.5/basis-link/presets/OOo4Kidsrc.txt
+
+    rtl::OUString aUserConfigFile;
+    rtl::OUString aDefaultConfigFile;
+    rtl::OUString aTryFiles[2];
+    rtl::OUString aIniPath;
+    
+    // read the content of bootstraprc is necessary to find the path to the user configuration file
+    // ~/.ooo4kids/0.6/user/OOo4Kidsrc.txt
+    Bootstrap::get( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "BRAND_BASE_DIR") ), aIniPath );
+    aIniPath += rtl::OUString( 	RTL_CONSTASCII_USTRINGPARAM( "/program/" SAL_CONFIGFILE( "bootstrap" ) ) );
+
+    Bootstrap aBootstrap(aIniPath);
+    aBootstrap.getFrom( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("OOo4KidsIntegrationUserFile") ), aUserConfigFile );
+
+#if OSL_DEBUG_LEVEL > 1
+    fprintf(stderr, "aUserConfigFile contains :   %s\n", rtl::OUStringToOString( aUserConfigFile, aEncoding ).getStr());
+#endif
+
+    if (aUserConfigFile.getLength() != 0)
+    osl::FileBase::getSystemPathFromFileURL( aUserConfigFile, aTryFiles[0]);
+
+    // if OOo4Kidsrc.txt is not found in user install dir, fallback to the second OOo4Kidsrc.txt (with default values), located in <install_dir>/presets
+    aBootstrap.getFrom( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("OOo4KidsIntegrationDefaultFile") ), aDefaultConfigFile );
+    osl::FileBase::getSystemPathFromFileURL(aDefaultConfigFile, aTryFiles[1]);
+
+#if OSL_DEBUG_LEVEL > 1
+    fprintf(stderr, "aDefaultConfigFile contains :  %s\n", rtl::OUStringToOString( aDefaultConfigFile, aEncoding ).getStr());
+#endif
+    
+    for( unsigned int i = 0; (i < sizeof(aTryFiles) / sizeof(aTryFiles[0])); i++ )
+    {
+    
+        #if OSL_DEBUG_LEVEL > 1
+        fprintf(stderr, "try accessing %d, %s\n", i, rtl::OUStringToOString( aTryFiles[i], aEncoding ).getStr());
+    #endif
+        if( access( rtl::OUStringToOString( aTryFiles[i], aEncoding ).getStr(), R_OK ) )
+            continue;
+        
+        #if OSL_DEBUG_LEVEL > 1
+        fprintf( stderr, "using %s for style settings\n", rtl::OUStringToOString( aTryFiles[i], aEncoding ).getStr() );
+        #endif
+        
+        Config aConfig( aTryFiles[i] );
+        ByteString aLine;
+        
+        if( aConfig.HasGroup( "General" ) )
+        {
+            aConfig.SetGroup( "General" );
+            
+            aLine = aConfig.ReadKey( "foreground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 )
+            {
+                Color aFore( aLine.GetToken( 0, ',' ).ToInt32(),
+                        aLine.GetToken( 1, ',' ).ToInt32(),
+                        aLine.GetToken( 2, ',' ).ToInt32() );
+                aStyleSettings.SetDialogTextColor( aFore );
+                aStyleSettings.SetMenuTextColor( aFore );
+                aStyleSettings.SetButtonTextColor( aFore );
+                aStyleSettings.SetRadioCheckTextColor( aFore );
+                aStyleSettings.SetGroupTextColor( aFore );
+                aStyleSettings.SetLabelTextColor( aFore );
+                aStyleSettings.SetInfoTextColor( aFore );
+                aStyleSettings.SetFieldTextColor( aFore );
+            }
+            
+            aLine = aConfig.ReadKey( "background" );
+            if( aLine.GetTokenCount( ',' ) >= 3 )
+            {
+                Color aBack( aLine.GetToken( 0, ',' ).ToInt32(),
+                        aLine.GetToken( 1, ',' ).ToInt32(),
+                        aLine.GetToken( 2, ',' ).ToInt32() );
+                aStyleSettings.Set3DColors( aBack );
+                aStyleSettings.SetFaceColor( aBack );
+                aStyleSettings.SetDialogColor( aBack );
+                aStyleSettings.SetMenuColor( aBack );
+                aStyleSettings.SetMenuBarColor( aBack );
+                aStyleSettings.SetLightBorderColor( aBack );
+                if( aBack == COL_LIGHTGRAY )
+                            aStyleSettings.SetCheckedColor( Color( 0xCC, 0xCC, 0xCC ) );
+                else
+                {
+                    Color aColor2 = aStyleSettings.GetLightColor();
+                    aStyleSettings.SetCheckedColor( 
+                        Color( (BYTE)(((USHORT)aBack.GetRed()+(USHORT)aColor2.GetRed())/2),
+                                (BYTE)(((USHORT)aBack.GetGreen()+(USHORT)aColor2.GetGreen())/2),
+                                (BYTE)(((USHORT)aBack.GetBlue()+(USHORT)aColor2.GetBlue())/2)
+                                ) );
+                }
+            }
+            
+            aLine = aConfig.ReadKey( "selectForeground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 ) 
+            {
+                Color aSelectFore( aLine.GetToken( 0, ',' ).ToInt32(),
+                   aLine.GetToken( 1, ',' ).ToInt32(),
+                   aLine.GetToken( 2, ',' ).ToInt32());
+                          
+                aStyleSettings.SetHighlightTextColor( aSelectFore );
+                aStyleSettings.SetMenuHighlightTextColor( aSelectFore );
+            }
+            aLine = aConfig.ReadKey( "selectBackground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 ) 
+            {
+                Color aSelectBack( aLine.GetToken( 0, ',' ).ToInt32(),
+                    aLine.GetToken( 1, ',' ).ToInt32(),
+                    aLine.GetToken( 2, ',' ).ToInt32() );
+
+                aStyleSettings.SetHighlightColor( aSelectBack );
+                aStyleSettings.SetMenuHighlightColor( aSelectBack );
+            }
+            aLine = aConfig.ReadKey( "activeForeground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 ) {
+                Color aActiveFore( aLine.GetToken( 0, ',' ).ToInt32(),
+                    aLine.GetToken( 1, ',' ).ToInt32(),
+                    aLine.GetToken( 2, ',' ).ToInt32() );
+
+                aStyleSettings.SetActiveTextColor( aActiveFore );
+            }
+            aLine = aConfig.ReadKey( "activeBackground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 ) {
+                Color aActiveBack( aLine.GetToken( 0, ',' ).ToInt32(),
+                    aLine.GetToken( 1, ',' ).ToInt32(),
+                    aLine.GetToken( 2, ',' ).ToInt32() );
+
+                aStyleSettings.SetActiveColor( aActiveBack );
+                aStyleSettings.SetActiveColor2( aActiveBack );
+            }
+            aLine = aConfig.ReadKey( "deactiveForeground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 ) {
+                Color aDeactiveFore( aLine.GetToken( 0, ',' ).ToInt32(),
+                    aLine.GetToken( 1, ',' ).ToInt32(),
+                    aLine.GetToken( 2, ',' ).ToInt32() );
+
+                aStyleSettings.SetDeactiveTextColor( aDeactiveFore );
+                aStyleSettings.SetDisableColor( aDeactiveFore );
+            }
+            aLine = aConfig.ReadKey( "deactiveBackground" );
+            if( aLine.GetTokenCount( ',' ) >= 3 ) {
+                Color aDeactiveBack( aLine.GetToken( 0, ',' ).ToInt32(),
+                    aLine.GetToken( 1, ',' ).ToInt32(),
+                    aLine.GetToken( 2, ',' ).ToInt32() );
+
+                aStyleSettings.SetDeactiveColor( aDeactiveBack );
+                aStyleSettings.SetDeactiveColor2( aDeactiveBack );
+                aStyleSettings.SetDeactiveBorderColor( aDeactiveBack );
+                aStyleSettings.SetActiveBorderColor( aDeactiveBack );
+            }
+
+            aLine = aConfig.ReadKey( "font" );
+            if( aLine.Len() )
+            {
+                Font aFont = aStyleSettings.GetAppFont();
+                String aFontName( aLine, RTL_TEXTENCODING_UTF8 );
+                if( aFontName.GetTokenCount( ',' ) > 0 )
+                    aFontName = aFontName.GetToken( 0, ',' );
+                aFont.SetName( aFontName );
+                
+                aStyleSettings.SetAppFont( aFont );
+                aStyleSettings.SetHelpFont( aFont );
+                aStyleSettings.SetTitleFont( aFont );
+                aStyleSettings.SetFloatTitleFont( aFont );
+                aStyleSettings.SetMenuFont( aFont );
+                aStyleSettings.SetToolFont( aFont );
+                aStyleSettings.SetLabelFont( aFont );
+                aStyleSettings.SetInfoFont( aFont );
+                aStyleSettings.SetRadioCheckFont( aFont );
+                aStyleSettings.SetPushButtonFont( aFont );
+                aStyleSettings.SetFieldFont( aFont );
+                aStyleSettings.SetIconFont( aFont );
+                aStyleSettings.SetGroupFont( aFont );
+            }
+            
+            aLine = aConfig.ReadKey( "cursorFlashTime" );
+            if( aLine.Len() )
+            {
+                sal_Int32 nTime = aLine.ToInt32() / 2;
+                if( nTime == 0 )
+                    nTime = STYLE_CURSOR_NOBLINKTIME;
+                aStyleSettings.SetCursorBlinkTime( nTime );
+            }
+        }
+
+        break;
+    }
+        
+    rSettings.SetStyleSettings( aStyleSettings );
+} 
+
diff --git vcl/unx/source/gdi/salgdi.cxx vcl/unx/source/gdi/salgdi.cxx
index ae281ab..dca9b7a 100644
--- vcl/unx/source/gdi/salgdi.cxx
+++ vcl/unx/source/gdi/salgdi.cxx
@@ -519,11 +519,23 @@ void X11SalGraphics::GetResolution( sal_Int32 &rDPIX, sal_Int32 &rDPIY ) // cons
     
     rDPIX = pDisplay->GetResolution().A();
     rDPIY = pDisplay->GetResolution().B();
+#if defined( OOo4Kids )
+#ifdef DEBUG
+    fprintf( stderr, " rDPIX = %d \n", rDPIX);
+    fprintf( stderr, " rDPIY = %d \n", rDPIY);
+#endif
+    if ( rDPIX < 96)
+    {
+    rDPIX = 96;
+    rDPIY = 96;
+    }
+#else
     if( !pDisplay->GetExactResolution() && rDPIY < 96 )
     {
         rDPIX = Divide( rDPIX * 96, rDPIY );
             rDPIY = 96;
     }
+#endif
     else if ( rDPIY > 200 )
     {
         rDPIX = Divide( rDPIX * 200, rDPIY );
diff --git vcl/unx/source/gdi/salgdi2.cxx vcl/unx/source/gdi/salgdi2.cxx
index 99bae3a..128b5eb 100644
--- vcl/unx/source/gdi/salgdi2.cxx
+++ vcl/unx/source/gdi/salgdi2.cxx
@@ -833,6 +833,11 @@ bool X11SalGraphics::drawAlphaBitmap( const SalTwoRect& rTR,
     if( !aSrcPic )
         return false;
 
+    //initialize the renderer
+    sal_uInt32 nMask = rPeer.InitRenderText( nDepth );
+    if ( 0 == nMask )
+        return false; // rPeer not correctly initialized
+
     // create alpha Picture
 
     // TODO: use SalX11Bitmap functionality and caching for the Alpha Pixmap
diff --git vcl/unx/source/window/FWS.cxx vcl/unx/source/window/FWS.cxx
index ed24c5a..49ef960 100644
--- vcl/unx/source/window/FWS.cxx
+++ vcl/unx/source/window/FWS.cxx
@@ -41,6 +41,10 @@
 #include <X11/Xatom.h>
 #include "FWS.hxx"
 
+#ifdef XO_INTEL
+#include "sugarxproperties.hxx"
+#endif
+
 static Atom fwsIconAtom;
 
 static Atom FWS_CLIENT;
@@ -279,5 +283,8 @@ AddFwsProtocols (Display *display, Window window)
     XChangeProperty (display, window, WM_PROTOCOLS,
             XA_ATOM, 32, PropModeAppend,
             (unsigned char *) fwsProtocols, nProtos);
+#ifdef XO_INTEL
+      SetSugarXProperties(display, window);
+#endif
 }
 
diff --git vcl/unx/source/window/SugarProperties.cxx vcl/unx/source/window/SugarProperties.cxx
new file mode 100644
index 0000000..eccb040
--- /dev/null
+++ vcl/unx/source/window/SugarProperties.cxx
@@ -0,0 +1,95 @@
+/**********************************
+ * Specific code for XOs' OS Sugar.
+ * Credits goes to www.catmoran.com
+ * and the libsugarize.so source code.
+ **********************************/
+
+#include <dlfcn.h>
+
+#include <X11/Xlib.h>
+
+#include <string.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <sys/types.h>
+#include <unistd.h>
+
+#define XLIB_Window unsigned int
+
+static Atom	ActivityId;
+static Atom	BundleId;
+static Atom	Cardinal;
+static Atom	AString;
+static Atom	ActivityPid;
+static Atom	ActivityName;
+static Atom	Utf8;
+static char	*activity_id = NULL;
+static char	*bundle_id = NULL;
+static unsigned char	*activity_name = NULL;
+static int	pid = -1;
+static Display	*disp2 = NULL;
+
+
+void	SetSugarXProperties(Display *disp, Window win)
+{
+  static Window		win2 = -1;
+
+  if (pid == -1)
+    {
+      //Initialisation of every variable
+      ActivityId = XInternAtom(disp, "_SUGAR_ACTIVITY_ID", 0);
+      BundleId = XInternAtom(disp, "_SUGAR_BUNDLE_ID", 0);
+      Cardinal = XInternAtom(disp, "CARDINAL", 0);
+      AString = XInternAtom(disp, "STRING", 0);
+      ActivityPid = XInternAtom(disp, "_NET_WM_PID", 0);
+      ActivityName = XInternAtom(disp, "_NET_WM_NAME", 0);
+      Utf8 = XInternAtom(disp, "UTF8_STRING", 0);
+      activity_id = getenv("SUGAR_ACTIVITY_ID");
+      bundle_id = getenv("SUGAR_BUNDLE_ID");
+      activity_name = (unsigned char*)"OOo4Kids";
+      pid = getpid();
+    }
+  if (disp == disp2 && win == win2) //In order not to set twice the properties on the same window
+    return ;
+  disp2 = disp;
+  win2 = win;
+  XChangeProperty(disp, win, ActivityPid, Cardinal, 32, PropModeReplace, (unsigned char*)&pid, 1);
+  XChangeProperty(disp, win, ActivityName, Utf8, 8, PropModeReplace, activity_name, 8);
+  if (activity_id)
+    XChangeProperty(disp, win, ActivityId, AString, 8, PropModeReplace, (unsigned char*)activity_id, strlen(activity_id));
+  if (bundle_id)
+    XChangeProperty(disp, win, BundleId, AString, 8, PropModeReplace, (unsigned char*)bundle_id, strlen(bundle_id));
+  return ;
+}
+
+void	SetSugarXProperties(Display *disp, XLIB_Window win)
+{
+  static XLIB_Window	win2;
+
+  if (pid == -1)
+    {
+      //Initialisation of every variable
+      ActivityId = XInternAtom(disp, "_SUGAR_ACTIVITY_ID", 0);
+      BundleId = XInternAtom(disp, "_SUGAR_BUNDLE_ID", 0);
+      Cardinal = XInternAtom(disp, "CARDINAL", 0);
+      AString = XInternAtom(disp, "STRING", 0);
+      ActivityPid = XInternAtom(disp, "_NET_WM_PID", 0);
+      ActivityName = XInternAtom(disp, "_NET_WM_NAME", 0);
+      Utf8 = XInternAtom(disp, "UTF8_STRING", 0);
+      activity_id = getenv("SUGAR_ACTIVITY_ID");
+      bundle_id = getenv("SUGAR_BUNDLE_ID");
+      activity_name = (unsigned char*)"OOo4Kids";
+      pid = getpid();
+    }
+  if (disp == disp2 && win == win2) //In order not to set twice the properties on the same window
+    return ;
+  disp2 = disp;
+  win2 = win;
+  XChangeProperty(disp, win, ActivityPid, Cardinal, 32, PropModeReplace, (unsigned char*)&pid, 1);
+  XChangeProperty(disp, win, ActivityName, Utf8, 8, PropModeReplace, activity_name, 8);
+  if (activity_id)
+    XChangeProperty(disp, win, ActivityId, AString, 8, PropModeReplace, (unsigned char*)activity_id, strlen(activity_id));
+  if (bundle_id)
+    XChangeProperty(disp, win, BundleId, AString, 8, PropModeReplace, (unsigned char*)bundle_id, strlen(bundle_id));
+  return ;
+}
diff --git vcl/unx/source/window/makefile.mk vcl/unx/source/window/makefile.mk
index a040980..6947980 100644
--- vcl/unx/source/window/makefile.mk
+++ vcl/unx/source/window/makefile.mk
@@ -37,6 +37,10 @@ TARGET=salwin
 
 ENABLE_EXCEPTIONS=TRUE
 
+.IF "$(XO_INTEL)"=="YES"
+ADDCDEFS+=-DXO_INTEL
+.ENDIF
+
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :  settings.mk
@@ -54,6 +58,11 @@ dummy:
 SLOFILES=	\
         $(SLO)/FWS.obj $(SLO)/salframe.obj $(SLO)/salobj.obj $(SLO)/salmenu.obj
 
+.IF "$(XO_INTEL)"=="YES"
+SLOFILES+=	\
+        $(SLO)$/SugarProperties.obj
+.ENDIF
+
 .ENDIF		# "$(GUIBASE)"!="unx"
 
 # --- Targets ------------------------------------------------------
diff --git vcl/unx/source/window/salframe.cxx vcl/unx/source/window/salframe.cxx
index 7e61602..cdc8b56 100644
--- vcl/unx/source/window/salframe.cxx
+++ vcl/unx/source/window/salframe.cxx
@@ -83,6 +83,10 @@
 # define Button7 7
 #endif
 
+#ifdef XO_INTEL
+#include "sugarxproperties.hxx"
+#endif
+
 using namespace vcl_sal;
 using namespace vcl;
 
@@ -183,6 +187,9 @@ void X11SalFrame::setXEmbedInfo()
                          PropModeReplace,
                          reinterpret_cast<unsigned char*>(aInfo),
                          sizeof(aInfo)/sizeof(aInfo[0]) );
+#ifdef XO_INTEL
+      SetSugarXProperties(pDisplay_->GetDisplay(), mhWindow);
+#endif
     }
 }
 
@@ -570,6 +577,10 @@ void X11SalFrame::Init( ULONG nSalFrameStyle, int nScreen, SystemParentData* pPa
                              1
                              );
         }
+#ifdef XO_INTEL
+          SetSugarXProperties(GetXDisplay(), mhWindow);
+#endif
+
 #define DECOFLAGS (SAL_FRAME_STYLE_MOVEABLE | SAL_FRAME_STYLE_SIZEABLE | SAL_FRAME_STYLE_CLOSEABLE)
         int nDecoFlags = WMAdaptor::decoration_All;
         if( (nStyle_ & SAL_FRAME_STYLE_PARTIAL_FULLSCREEN) ||
@@ -2338,7 +2349,9 @@ MessageToXAutoLock( Display *p_display, int n_message )
     a_messageatom = XInternAtom( p_display, p_atomname, False );
     XChangeProperty (p_display, a_rootwindow, a_messageatom, XA_INTEGER,
             8, PropModeReplace, (unsigned char*)&n_message, sizeof(n_message) );
-
+#ifdef XO_INTEL
+      SetSugarXProperties(p_display, a_rootwindow);
+#endif
     return True;
 }
 
@@ -3967,8 +3980,14 @@ long X11SalFrame::HandleClientMessage( XClientMessageEvent *pEvent )
                     XSetCommand( GetXDisplay(), GetShellWindow(), (char**)argv, 2 );
                 }
                 else
+          {
                     // can only happen in race between WM and window closing
                     XChangeProperty( GetXDisplay(), GetShellWindow(), rWMAdaptor.getAtom( WMAdaptor::WM_COMMAND ), XA_STRING, 8, PropModeReplace, (unsigned char*)"", 0 );
+#ifdef XO_INTEL
+          SetSugarXProperties(GetXDisplay(), GetShellWindow());
+#endif
+          }
+
             }
             else
             {
@@ -4033,6 +4052,9 @@ void X11SalFrame::SaveYourselfDone( SalFrame* pSaveFrame )
                 XChangeProperty( pFrame->GetXDisplay(),
                                  pFrame->GetShellWindow(),
                                  rWMAdaptor.getAtom( WMAdaptor::WM_COMMAND ), XA_STRING, 8, PropModeReplace, (unsigned char*)"", 0 );
+#ifdef XO_INTEL
+          SetSugarXProperties(pFrame->GetXDisplay(), pFrame->GetShellWindow());
+#endif
             }
         }
         s_pSaveYourselfFrame->ShutDown();
diff --git vcl/win/source/window/salframe.cxx vcl/win/source/window/salframe.cxx
index 02152f8..02f4a85 100644
--- vcl/win/source/window/salframe.cxx
+++ vcl/win/source/window/salframe.cxx
@@ -2334,7 +2334,7 @@ void WinSalFrame::SetPointer( PointerStyle ePointerStyle )
 
     };
 
-#if POINTER_COUNT != 94
+#if POINTER_COUNT != 95
 #error New Pointer must be defined!
 #endif
 
diff --git wizards/com/sun/star/wizards/agenda/makefile.mk wizards/com/sun/star/wizards/agenda/makefile.mk
index 375476c..384acce 100644
--- wizards/com/sun/star/wizards/agenda/makefile.mk
+++ wizards/com/sun/star/wizards/agenda/makefile.mk
@@ -36,6 +36,12 @@ PACKAGE = com$/sun$/star$/wizards$/agenda
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/fax/makefile.mk wizards/com/sun/star/wizards/fax/makefile.mk
index 66e5613..44c64aa 100644
--- wizards/com/sun/star/wizards/fax/makefile.mk
+++ wizards/com/sun/star/wizards/fax/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/fax
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/form/makefile.mk wizards/com/sun/star/wizards/form/makefile.mk
index 1853e08..4ec8500 100644
--- wizards/com/sun/star/wizards/form/makefile.mk
+++ wizards/com/sun/star/wizards/form/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/form
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/letter/makefile.mk wizards/com/sun/star/wizards/letter/makefile.mk
index 6c4a621..d2d76ae 100644
--- wizards/com/sun/star/wizards/letter/makefile.mk
+++ wizards/com/sun/star/wizards/letter/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/letter
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/makefile.mk wizards/com/sun/star/wizards/makefile.mk
index d876d19..bfd6e9a 100644
--- wizards/com/sun/star/wizards/makefile.mk
+++ wizards/com/sun/star/wizards/makefile.mk
@@ -35,6 +35,11 @@ PACKAGE = com$/sun$/star$/wizards
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/query/makefile.mk wizards/com/sun/star/wizards/query/makefile.mk
index 887b470..a7e9020 100644
--- wizards/com/sun/star/wizards/query/makefile.mk
+++ wizards/com/sun/star/wizards/query/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/query
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/report/makefile.mk wizards/com/sun/star/wizards/report/makefile.mk
index d4624cc..8cf99f6 100644
--- wizards/com/sun/star/wizards/report/makefile.mk
+++ wizards/com/sun/star/wizards/report/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/report
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/reportbuilder/layout/makefile.mk wizards/com/sun/star/wizards/reportbuilder/layout/makefile.mk
index 0bf60e0..d96d919 100644
--- wizards/com/sun/star/wizards/reportbuilder/layout/makefile.mk
+++ wizards/com/sun/star/wizards/reportbuilder/layout/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/reportbuilder$/layout
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/reportbuilder/makefile.mk wizards/com/sun/star/wizards/reportbuilder/makefile.mk
index 961c1a0..01e45ec 100644
--- wizards/com/sun/star/wizards/reportbuilder/makefile.mk
+++ wizards/com/sun/star/wizards/reportbuilder/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/reportbuilder
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/table/makefile.mk wizards/com/sun/star/wizards/table/makefile.mk
index f7cfcfe..9ebe38b 100644
--- wizards/com/sun/star/wizards/table/makefile.mk
+++ wizards/com/sun/star/wizards/table/makefile.mk
@@ -35,6 +35,11 @@ PACKAGE = com$/sun$/star$/wizards$/table
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
diff --git wizards/com/sun/star/wizards/web/data/makefile.mk wizards/com/sun/star/wizards/web/data/makefile.mk
index 68152ec..c6db2bb 100644
--- wizards/com/sun/star/wizards/web/data/makefile.mk
+++ wizards/com/sun/star/wizards/web/data/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/web$/data
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
diff --git wizards/com/sun/star/wizards/web/export/makefile.mk wizards/com/sun/star/wizards/web/export/makefile.mk
index 2ad816f..f8ea530 100644
--- wizards/com/sun/star/wizards/web/export/makefile.mk
+++ wizards/com/sun/star/wizards/web/export/makefile.mk
@@ -36,6 +36,12 @@ PACKAGE = com$/sun$/star$/wizards$/web$/export
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+
 .INCLUDE : settings.mk
 
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
diff --git wizards/com/sun/star/wizards/web/makefile.mk wizards/com/sun/star/wizards/web/makefile.mk
index e9aa9ad..6128286 100644
--- wizards/com/sun/star/wizards/web/makefile.mk
+++ wizards/com/sun/star/wizards/web/makefile.mk
@@ -36,6 +36,11 @@ PACKAGE = com$/sun$/star$/wizards$/web
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : settings.mk
 #.INCLUDE :  $(PRJ)$/util$/makefile.pmk
 JARFILES= unoil.jar jurt.jar ridl.jar juh.jar jut.jar java_uno.jar java_uno_accessbridge commonwizards.jar 
diff --git wizards/util/makefile.mk wizards/util/makefile.mk
index 25f7d0f..6f24a69 100644
--- wizards/util/makefile.mk
+++ wizards/util/makefile.mk
@@ -37,6 +37,10 @@ GEN_HID=TRUE
 GEN_HID_OTHER=TRUE
 
 # --- Settings -----------------------------------------------------
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
 
 .INCLUDE :  settings.mk
 
diff --git writerperfect/prj/d.lst writerperfect/prj/d.lst
index 8884d78..7cd3b89 100644
--- writerperfect/prj/d.lst
+++ writerperfect/prj/d.lst
@@ -1,5 +1,4 @@
 ..\%__SRC%\lib\libwpft*.so %_DEST%\lib%_EXT%
 ..\%__SRC%\bin\wpft*.dll %_DEST%\lib%_EXT%
-..\%__SRC%\bin\wpft*.dll %_DEST%\bin%_EXT%
 ..\%__SRC%\bin\wpftgo.dll %_DEST%\bin%_EXT%\wpftgo.dll
 ..\%__SRC%\lib\*.dylib %_DEST%\lib%_EXT%\*.dylib
diff --git xmerge/source/aportisdoc/makefile.mk xmerge/source/aportisdoc/makefile.mk
index 67d763f..ee37d81 100644
--- xmerge/source/aportisdoc/makefile.mk
+++ xmerge/source/aportisdoc/makefile.mk
@@ -33,6 +33,11 @@ TARGET=aportisdoc
 PRJ=../..
 PRJNAME=xmerge
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmerge/source/bridge/makefile.mk xmerge/source/bridge/makefile.mk
index b0dc371..2a812f8 100644
--- xmerge/source/bridge/makefile.mk
+++ xmerge/source/bridge/makefile.mk
@@ -33,6 +33,12 @@ TARGET=XMergeBridge
 PRJ=../..
 PRJNAME=xmerge
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmerge/source/htmlsoff/makefile.mk xmerge/source/htmlsoff/makefile.mk
index d164ccd..51090d7 100644
--- xmerge/source/htmlsoff/makefile.mk
+++ xmerge/source/htmlsoff/makefile.mk
@@ -33,6 +33,11 @@ TARGET=htmlsoff
 PRJ=../..
 PRJNAME=xmerge
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmerge/source/pexcel/makefile.mk xmerge/source/pexcel/makefile.mk
index c0fdb53..7160f3d 100644
--- xmerge/source/pexcel/makefile.mk
+++ xmerge/source/pexcel/makefile.mk
@@ -33,6 +33,11 @@ TARGET=pexcel
 PRJ=../..
 PRJNAME=xmerge
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmerge/source/pocketword/makefile.mk xmerge/source/pocketword/makefile.mk
index 24f6e45..898ce2f 100644
--- xmerge/source/pocketword/makefile.mk
+++ xmerge/source/pocketword/makefile.mk
@@ -33,6 +33,12 @@ TARGET=pocketword
 PRJ=../..
 PRJNAME=xmerge
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmerge/source/xmerge/makefile.mk xmerge/source/xmerge/makefile.mk
index 7420f88..8d3bba4 100644
--- xmerge/source/xmerge/makefile.mk
+++ xmerge/source/xmerge/makefile.mk
@@ -32,6 +32,11 @@
 TARGET=xmerge
 PRJ=../..
 
+.IF "$(OOo4Kids)"=="YES"
+dummy:
+    @echo "Nothing to build"
+.ENDIF
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmerge/util/makefile.mk xmerge/util/makefile.mk
index 61ee7d7..6ed97b3 100644
--- xmerge/util/makefile.mk
+++ xmerge/util/makefile.mk
@@ -32,6 +32,12 @@
 TARGET=xmrg_util
 PRJ=..
 
+.IF "$(OOo4Kids)"=="YES"
+all:
+    @echo "Nothing to build"
+.ENDIF
+
+
 .INCLUDE : ant.mk
 .IF "$(L10N_framework)"==""
 ALLTAR: ANTBUILD
diff --git xmlhelp/source/com/sun/star/help/makefile.mk xmlhelp/source/com/sun/star/help/makefile.mk
index f5cbd39..6047213 100644
--- xmlhelp/source/com/sun/star/help/makefile.mk
+++ xmlhelp/source/com/sun/star/help/makefile.mk
@@ -36,7 +36,8 @@ LIBBASENAME = helplinker
 PACKAGE = com$/sun$/star$/help
 TARGETTYPE=CUI
 
-.IF "$(SOLAR_JAVA)"!=""
+.IF "$(SOLAR_JAVA)"!="" || "$(OOo4Kids)"!="YES"
+
 # --- Settings -----------------------------------------------------
 
 .INCLUDE : settings.mk
@@ -57,7 +58,6 @@ CFLAGS+=-DSYSTEM_DB -I$(DB_INCLUDES)
 CFLAGS+=-DSYSTEM_EXPAT
 .ENDIF
 
-
 JAVACLASSFILES = \
     $(SOLARBINDIR)$/help$/$(PACKAGE)$/HelpIndexerTool.class			\
     $(SOLARBINDIR)$/help$/$(PACKAGE)$/HelpFileDocument.class		\
diff --git xmloff/source/forms/elementimport.cxx xmloff/source/forms/elementimport.cxx
index e25eef3..0f51e12 100644
--- xmloff/source/forms/elementimport.cxx
+++ xmloff/source/forms/elementimport.cxx
@@ -306,8 +306,9 @@ namespace xmloff
             OSL_ENSURE(sal_False, "OElementImport::EndElement: did not find a name attribute!");
             m_sName = implGetDefaultName();
         }
-
+#ifndef OOo4Kids
         m_xParentContainer->insertByName(m_sName, makeAny(m_xElement));
+#endif
         LEAVE_LOG_CONTEXT( );
     }
 
@@ -1844,8 +1845,9 @@ namespace xmloff
     void OFormImport::StartElement(const Reference< sax::XAttributeList >& _rxAttrList)
     {
         m_rFormImport.enterEventContext();
+#ifndef OOo4Kids
         OFormImport_Base::StartElement(_rxAttrList);
-
+#endif
         // handle the target-frame attribute
         simulateDefaultedAttribute(OAttributeMetaData::getCommonControlAttributeName(CCA_TARGET_FRAME), PROPERTY_TARGETFRAME, "_blank");
     }
