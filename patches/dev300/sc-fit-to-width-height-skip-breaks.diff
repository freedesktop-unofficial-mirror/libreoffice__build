From 17b0bc3d2cb143857b68fbf282e1017334b2e886 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:39 +0200
Subject: [PATCH 169/878] sc-fit-to-width-height-skip-breaks.diff

---
 sc/source/core/data/table5.cxx |    9 +++++++++
 1 files changed, 9 insertions(+), 0 deletions(-)

diff --git a/sc/source/core/data/table5.cxx b/sc/source/core/data/table5.cxx
index 29f66a8..e4ffc14 100644
--- a/sc/source/core/data/table5.cxx
+++ b/sc/source/core/data/table5.cxx
@@ -124,6 +124,15 @@ void ScTable::UpdatePageBreaks( const ScRange* pUserArea )
         bSkipBreaks = ( ((const SfxUInt16Item*)pItem)->GetValue() > 0 );
     }
 
+    if (!bSkipBreaks && pStyleSet->GetItemState(ATTR_PAGE_SCALETO, false, &pItem) == SFX_ITEM_SET)
+    {
+        const ScPageScaleToItem& rScaleToItem = static_cast<const ScPageScaleToItem&>(
+            pStyleSet->Get(ATTR_PAGE_SCALETO));
+        if (rScaleToItem.GetWidth() > 0 || rScaleToItem.GetHeight() > 0)
+            // when fitting to a fixed width x height, ignore manual breaks.
+            bSkipBreaks = true;
+    }
+
     //--------------------------------------------------------------------------
 
     long nPageSizeX = aPageSizeTwips.Width();
-- 
1.7.0.1

