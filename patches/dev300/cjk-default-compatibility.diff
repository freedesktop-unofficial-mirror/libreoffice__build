From 3fec23956e8d90405d96fc97ac3cf67b69823809 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:53:35 +0200
Subject: [PATCH 060/878] cjk-default-compatibility.diff

---
 svtools/inc/svtools/compatibility.hxx   |    2 +
 svtools/source/config/compatibility.cxx |   40 +++++++++++++++++++++++++++++++
 svx/source/cui/optgdlg.cxx              |    6 ++++
 3 files changed, 48 insertions(+), 0 deletions(-)

diff --git a/svtools/inc/svtools/compatibility.hxx b/svtools/inc/svtools/compatibility.hxx
index b08c317..e24fd8a 100644
--- a/svtools/inc/svtools/compatibility.hxx
+++ b/svtools/inc/svtools/compatibility.hxx
@@ -153,6 +153,8 @@ class SVL_DLLPUBLIC SvtCompatibilityOptions: public svt::detail::Options
 
         void Clear();
 
+        void SetDefault( ::rtl::OUString sName, bool bValue );
+
         /*-****************************************************************************************************//**
             @short      return complete specified list
             @descr      Call it to get all entries of compatibility options.
diff --git a/svtools/source/config/compatibility.cxx b/svtools/source/config/compatibility.cxx
index ae1982b..13b7bd5 100644
--- a/svtools/source/config/compatibility.cxx
+++ b/svtools/source/config/compatibility.cxx
@@ -32,6 +32,7 @@
 //	includes
 //_________________________________________________________________________________________________________________
 
+#include <vcl/svapp.hxx>
 #include <svtools/compatibility.hxx>
 #include <unotools/configmgr.hxx>
 #include <unotools/configitem.hxx>
@@ -247,6 +248,8 @@ class SvtCompatibilityOptions_Impl : public ConfigItem
          SvtCompatibilityOptions_Impl();
         ~SvtCompatibilityOptions_Impl();
 
+        void SetDefault( OUString sName, bool bValue );
+
         //---------------------------------------------------------------------------------------------------------
         //	overloaded methods of baseclass
         //---------------------------------------------------------------------------------------------------------
@@ -425,6 +428,12 @@ SvtCompatibilityOptions_Impl::SvtCompatibilityOptions_Impl()
 
         if ( !bDefaultFound && aItem.sName.equals( COMPATIBILITY_DEFAULT_NAME ) != sal_False )
         {
+            const AllSettings& rSettings = Application::GetSettings();
+            com::sun::star::lang::Locale aLocale = rSettings.GetLocale();
+            if ( aLocale.Language.equalsAscii( "zh" ) || aLocale.Language.equalsAscii( "ja" ) ||
+                    aLocale.Language.equalsAscii( "ko" ) )
+                aItem.bExpandWordSpace = false;
+
             m_aDefOptions = aItem;
             bDefaultFound = true;
         }
@@ -443,6 +452,32 @@ SvtCompatibilityOptions_Impl::~SvtCompatibilityOptions_Impl()
     }
 }
 
+void SvtCompatibilityOptions_Impl::SetDefault( OUString sName, bool bValue )
+{
+    if ( COMPATIBILITY_PROPERTYNAME_USEPRTMETRICS.equals( sName ) )
+        m_aDefOptions.SetUsePrtMetrics( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_ADDSPACING.equals( sName ) )
+        m_aDefOptions.SetAddSpacing( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_ADDSPACINGATPAGES.equals( sName ) )
+        m_aDefOptions.SetAddSpacingAtPages( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_USEOURTABSTOPS.equals( sName ) )
+        m_aDefOptions.SetUseOurTabStops( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_NOEXTLEADING.equals( sName ) )
+        m_aDefOptions.SetNoExtLeading( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_USELINESPACING.equals( sName ) )
+        m_aDefOptions.SetUseLineSpacing( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_ADDTABLESPACING.equals( sName ) )
+        m_aDefOptions.SetAddTableSpacing( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_USEOBJECTPOSITIONING.equals( sName ) )
+        m_aDefOptions.SetUseObjPos( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_USEOURTEXTWRAPPING.equals( sName ) )
+        m_aDefOptions.SetUseOurTextWrapping( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_CONSIDERWRAPPINGSTYLE.equals( sName ) )
+        m_aDefOptions.SetConsiderWrappingStyle( bValue );
+    else if ( COMPATIBILITY_PROPERTYNAME_EXPANDWORDSPACE.equals( sName ) )
+        m_aDefOptions.SetExpandWordSpace( bValue );
+}
+
 //*****************************************************************************************************************
 //	public method
 //*****************************************************************************************************************
@@ -680,6 +715,11 @@ void SvtCompatibilityOptions::Clear()
     m_pDataContainer->Clear();
 }
 
+void SvtCompatibilityOptions::SetDefault( ::rtl::OUString sName, bool bValue )
+{
+    m_pDataContainer->SetDefault( sName, bValue );
+}
+
 //*****************************************************************************************************************
 //	public method
 //*****************************************************************************************************************
diff --git a/svx/source/cui/optgdlg.cxx b/svx/source/cui/optgdlg.cxx
index eb3f9ab..e6c18ee 100644
--- a/svx/source/cui/optgdlg.cxx
+++ b/svx/source/cui/optgdlg.cxx
@@ -43,6 +43,7 @@
 #include <vcl/msgbox.hxx>
 #include <vcl/mnemonic.hxx>
 #include <i18npool/mslangid.hxx>
+#include <svtools/compatibility.hxx>
 #include <svtools/useroptions.hxx>
 #include <svtools/cacheoptions.hxx>
 #include <svtools/fontoptions.hxx>
@@ -1548,6 +1549,11 @@ BOOL OfaLanguagesTabPage::FillItemSet( SfxItemSet& rSet )
         Application::SetSettings( aSettings );
         pLangConfig->aSysLocaleOptions.SetLocaleConfigString( sNewLang );
         rSet.Put( SfxBoolItem( SID_OPT_LOCALE_CHANGED, TRUE ) );
+
+        sal_uInt16 nNewType = SvtLanguageOptions::GetScriptTypeOfLanguage( eNewLocale );
+        bool bNewCJK = ( nNewType & SCRIPTTYPE_ASIAN ) != 0;
+        SvtCompatibilityOptions aCompatOpts;
+        aCompatOpts.SetDefault( COMPATIBILITY_PROPERTYNAME_EXPANDWORDSPACE, !bNewCJK );
     }
 
     //
-- 
1.7.0.1

