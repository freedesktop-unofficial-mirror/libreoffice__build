From 9a43dd6538785238e5e81c78100dc037467c3388 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:53:23 +0200
Subject: [PATCH 050/878] registry-speed-fix.diff

---
 registry/source/keyimpl.cxx |    4 ----
 registry/source/regimpl.cxx |    8 ++++----
 2 files changed, 4 insertions(+), 8 deletions(-)

diff --git a/registry/source/keyimpl.cxx b/registry/source/keyimpl.cxx
index 14c0504..dda7c0f 100644
--- a/registry/source/keyimpl.cxx
+++ b/registry/source/keyimpl.cxx
@@ -362,7 +362,6 @@ RegError ORegKey::setValue(const OUString& valueName, RegValueType vType, RegVal
         return REG_SET_VALUE_FAILED;
     }
 
-    rValue.flush();
     rtl_freeMemory(pBuffer);
     return REG_NO_ERROR;
 }
@@ -421,7 +420,6 @@ RegError ORegKey::setLongListValue(const OUString& valueName, sal_Int32* pValueL
         return REG_SET_VALUE_FAILED;
     }
 
-    rValue.flush();
     rtl_freeMemory(pBuffer);
     return REG_NO_ERROR;
 }
@@ -489,7 +487,6 @@ RegError ORegKey::setStringListValue(const OUString& valueName, sal_Char** pValu
         return REG_SET_VALUE_FAILED;
     }
 
-    rValue.flush();
     rtl_freeMemory(pBuffer);
     return REG_NO_ERROR;
 }
@@ -557,7 +554,6 @@ RegError ORegKey::setUnicodeListValue(const OUString& valueName, sal_Unicode** p
         return REG_SET_VALUE_FAILED;
     }
 
-    rValue.flush();
     rtl_freeMemory(pBuffer);
     return REG_NO_ERROR;
 }
diff --git a/registry/source/regimpl.cxx b/registry/source/regimpl.cxx
index 0f45aa5..097a032 100644
--- a/registry/source/regimpl.cxx
+++ b/registry/source/regimpl.cxx
@@ -845,7 +845,7 @@ RegError ORegistry::eraseKey(ORegKey* pKey, const OUString& keyName)
     {
         return REG_DELETE_KEY_FAILED;
     }
-    sFile.flush();
+    //sFile.flush();
 
     // set flag deleted !!!
     ((ORegKey*)hOldKey)->setDeleted(sal_True);
@@ -891,7 +891,7 @@ RegError ORegistry::deleteSubkeysAndValues(ORegKey* pKey)
             {
                 return REG_DELETE_VALUE_FAILED;
             }
-        ((OStoreFile&)pKey->getStoreFile()).flush();
+        //((OStoreFile&)pKey->getStoreFile()).flush();
         }
 
         _err = rStoreDir.next(iter);
@@ -1062,7 +1062,7 @@ RegError ORegistry::loadAndSaveValue(ORegKey* pTargetKey,
     {
         return REG_VALUE_NOT_EXISTS;
     }
-    pSourceKey->getStoreFile().flush();
+    //pSourceKey->getStoreFile().flush();
 
     pBuffer = (sal_uInt8*)rtl_allocateMemory(VALUE_HEADERSIZE);
 
@@ -1134,7 +1134,7 @@ RegError ORegistry::loadAndSaveValue(ORegKey* pTargetKey,
         rtl_freeMemory(pBuffer);
         return REG_INVALID_VALUE;
     }
-    rTargetFile.flush();
+    //rTargetFile.flush();
 
     if (rwBytes != nSize)
     {
-- 
1.7.0.1

