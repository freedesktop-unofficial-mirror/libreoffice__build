From e87d4485adbdb475b0fde9820648fb325bd2d05e Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:09:05 +0200
Subject: [PATCH 746/768] sfx2-add-to-recently-used-after-save.diff

---
 sfx2/inc/sfx2/objsh.hxx     |    3 +++
 sfx2/source/doc/objstor.cxx |   24 +++++++++++++++---------
 2 files changed, 18 insertions(+), 9 deletions(-)

diff --git sfx2/inc/sfx2/objsh.hxx sfx2/inc/sfx2/objsh.hxx
index 8435f2c..c1775b4 100644
--- sfx2/inc/sfx2/objsh.hxx
+++ sfx2/inc/sfx2/objsh.hxx
@@ -245,6 +245,9 @@ protected:
     /// template method, called by FlushDocInfo; this implementation is empty
     virtual void                DoFlushDocInfo();
 
+    // helper method
+    void AddToRecentlyUsedList();
+
 public:
                                 TYPEINFO();
                                 SFX_DECL_INTERFACE(SFX_INTERFACE_SFXDOCSH)
diff --git sfx2/source/doc/objstor.cxx sfx2/source/doc/objstor.cxx
index 6128852..24ca99a 100644
--- sfx2/source/doc/objstor.cxx
+++ sfx2/source/doc/objstor.cxx
@@ -962,15 +962,7 @@ sal_Bool SfxObjectShell::DoLoad( SfxMedium *pMed )
             && !( pPreviewItem && pPreviewItem->GetValue() )
             && !( pHiddenItem && pHiddenItem->GetValue() ) )
             {
-                INetURLObject aUrl( pMedium->GetOrigURL() );
-
-                if ( aUrl.GetProtocol() == INET_PROT_FILE )
-                {
-                    const SfxFilter* pOrgFilter = pMedium->GetOrigFilter();
-                    Application::AddToRecentDocumentList(
-                        aUrl.GetURLNoPass( INetURLObject::NO_DECODE ),
-                        (pOrgFilter) ? pOrgFilter->GetMimeType() : String() );
-                }
+            AddToRecentlyUsedList();
             }
         }
 
@@ -2365,9 +2357,23 @@ sal_Bool SfxObjectShell::DoSaveCompleted( SfxMedium* pNewMed )
     pMedium->ClearBackup_Impl();
     pMedium->LockOrigFileOnDemand( sal_True, sal_False );
 
+    AddToRecentlyUsedList();
+
     return bOk;
 }
 
+void SfxObjectShell::AddToRecentlyUsedList()
+{
+    INetURLObject aUrl( pMedium->GetOrigURL() );
+
+    if ( aUrl.GetProtocol() == INET_PROT_FILE )
+    {
+    const SfxFilter* pOrgFilter = pMedium->GetOrigFilter();
+    Application::AddToRecentDocumentList( aUrl.GetURLNoPass( INetURLObject::NO_DECODE ),
+                          (pOrgFilter) ? pOrgFilter->GetMimeType() : String() );
+    }
+}
+
 //-------------------------------------------------------------------------
 
 sal_Bool SfxObjectShell::ConvertFrom
-- 
1.7.0.1

