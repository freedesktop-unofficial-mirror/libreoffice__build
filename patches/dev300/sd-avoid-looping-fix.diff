From f455e07e2b0ec9cf428213f07919066e0db63163 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:08:57 +0200
Subject: [PATCH 740/768] sd-avoid-looping-fix.diff

---
 sd/source/filter/ppt/pptatom.cpp |   10 +++++++++-
 1 files changed, 9 insertions(+), 1 deletions(-)

diff --git sd/source/filter/ppt/pptatom.cpp sd/source/filter/ppt/pptatom.cpp
index ad4ac1d..811be1c 100644
--- sd/source/filter/ppt/pptatom.cpp
+++ sd/source/filter/ppt/pptatom.cpp
@@ -49,7 +49,15 @@ Atom::Atom( const DffRecordHeader& rRecordHeader, SvStream& rStream )
 
             Atom* pLastAtom = NULL;
 
-            while( (mrStream.GetError() == 0 ) && ( mrStream.Tell() < maRecordHeader.GetRecEndFilePos() ) )
+            // retrieve file size (to allow sanity checks)
+            const sal_Size nStreamPos = mrStream.Tell();
+            mrStream.Seek( STREAM_SEEK_TO_END );
+            const sal_Size nStreamSize = mrStream.Tell();
+            mrStream.Seek( nStreamPos );
+
+            while( (mrStream.GetError() == 0 )
+                   && ( mrStream.Tell() < nStreamSize )
+                   && ( mrStream.Tell() < maRecordHeader.GetRecEndFilePos() ) )
             {
                 mrStream >> aChildHeader;
 
-- 
1.7.0.1

