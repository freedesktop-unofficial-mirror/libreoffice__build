From 23e50cf33a0555fb7dac4d9ff47e9b69bf2a3852 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:04:17 +0200
Subject: [PATCH 540/768] linkwarn-dlg-in-apps.diff

---
 sc/source/ui/drawfunc/fuins1.cxx |   10 ++++++++++
 sd/source/ui/func/fuinsert.cxx   |   12 +++++++++++-
 sw/source/ui/uiview/view2.cxx    |   15 +++++++++++++++
 3 files changed, 36 insertions(+), 1 deletions(-)

diff --git sc/source/ui/drawfunc/fuins1.cxx sc/source/ui/drawfunc/fuins1.cxx
index 80d6324..70243ac 100644
--- sc/source/ui/drawfunc/fuins1.cxx
+++ sc/source/ui/drawfunc/fuins1.cxx
@@ -34,8 +34,10 @@
 #include <svx/svdpage.hxx>
 #include <svx/svdpagv.hxx>
 #include <svx/svdview.hxx>
+#include <svx/linkwarn.hxx>
 #include <svtools/filter.hxx>
 #include <svl/stritem.hxx>
+#include <svtools/miscopt.hxx>
 #include <vcl/msgbox.hxx>
 #include <tools/urlobj.hxx>
 #include <avmedia/mediawindow.hxx>
@@ -289,6 +291,14 @@ FuInsertGraphic::FuInsertGraphic( ScTabViewShell*	pViewSh,
                 String aFilterName = aDlg.GetCurrentFilter();
                 BOOL bAsLink = aDlg.IsAsLink();
 
+                // really store as link only?
+                if( bAsLink && SvtMiscOptions().ShowLinkWarningDialog() )
+                {
+                    SvxLinkWarningDialog aWarnDlg(pWin,aFileName);
+                    if( aWarnDlg.Execute() != RET_OK )
+                        bAsLink = sal_False; // don't store as link
+                }
+
                 lcl_InsertGraphic( aGraphic, aFileName, aFilterName, bAsLink, FALSE, pViewSh, pWindow, pView );
 
                 //	append items for recording
diff --git sd/source/ui/func/fuinsert.cxx sd/source/ui/func/fuinsert.cxx
index b8ea639..3ff6a58 100644
--- sd/source/ui/func/fuinsert.cxx
+++ sd/source/ui/func/fuinsert.cxx
@@ -48,9 +48,11 @@
 #include <sfx2/request.hxx>
 #include <svl/globalnameitem.hxx>
 #include <unotools/pathoptions.hxx>
+#include <svtools/miscopt.hxx>
 #include <svx/pfiledlg.hxx>
 #include <svx/dialogs.hrc>
 #include <sfx2/linkmgr.hxx>
+#include <svx/linkwarn.hxx>
 #include <svx/svdetc.hxx>
 #include <avmedia/mediawindow.hxx>
 #ifndef _UNOTOOLS_UCBSTREAMHELPER_HXX
@@ -174,7 +176,15 @@ void FuInsertGraphic::DoExecute( SfxRequest&  )
 
                 if(pGrafObj && aDlg.IsAsLink())
                 {
-                    // store link only?
+                    // really store as link only?
+                    if( SvtMiscOptions().ShowLinkWarningDialog() )
+                    {
+                        SvxLinkWarningDialog aWarnDlg(mpWindow,aDlg.GetPath());
+                        if( aWarnDlg.Execute() != RET_OK )
+                            return; // don't store as link
+                    }
+
+                    // store as link
                     String aFltName(aDlg.GetCurrentFilter());
                     String aPath(aDlg.GetPath());
                     pGrafObj->SetGraphicLink(aPath, aFltName);
diff --git sw/source/ui/uiview/view2.cxx sw/source/ui/uiview/view2.cxx
index 4ec0f71..71459ce 100644
--- sw/source/ui/uiview/view2.cxx
+++ sw/source/ui/uiview/view2.cxx
@@ -46,8 +46,14 @@
 #include <undobj.hxx>
 #include <swundo.hxx>
 #include <caption.hxx>
+<<<<<<< HEAD
 #include <svl/PasswordHelper.hxx>
 #include <svl/urihelper.hxx>
+=======
+#include <svtools/PasswordHelper.hxx>
+#include <svtools/urihelper.hxx>
+#include <svtools/miscopt.hxx>
+>>>>>>> cc3ce8a... linkwarn-dlg-in-apps.diff
 #include <sfx2/passwd.hxx>
 #include <sfx2/sfxdlg.hxx>
 #include <sfx2/filedlghelper.hxx>
@@ -55,6 +61,7 @@
 #include <editeng/langitem.hxx>
 #include <svx/viewlayoutitem.hxx>
 #include <svx/zoomslideritem.hxx>
+#include <svx/linkwarn.hxx>
 #include <svx/htmlmode.hxx>
 #include <vcl/svapp.hxx>
 #include <vcl/wrkwin.hxx>
@@ -400,6 +407,14 @@ BOOL SwView::InsertGraphicDlg( SfxRequest& rReq )
                 rReq.AppendItem( SfxStringItem( FN_PARAM_2, sGraphicFormat ) );
                 rReq.AppendItem( SfxBoolItem( FN_PARAM_1, bAsLink ) );
             }
+
+            // really store as link only?
+            if( bAsLink && SvtMiscOptions().ShowLinkWarningDialog() )
+            {
+                SvxLinkWarningDialog aWarnDlg(GetWindow(),pFileDlg->GetPath());
+                if( aWarnDlg.Execute() != RET_OK )
+                    bAsLink=sal_False; // don't store as link
+            }
         }
 
         SwWrtShell& rSh = GetWrtShell();
-- 
1.7.0.1

