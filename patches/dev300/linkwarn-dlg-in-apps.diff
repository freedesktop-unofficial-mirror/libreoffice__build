From cc3ce8a4b2b7cef47b634ee8f495a4c63cb3d268 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:04:17 +0200
Subject: [PATCH 613/878] linkwarn-dlg-in-apps.diff

---
 sc/source/ui/drawfunc/fuins1.cxx |   10 ++++++++++
 sd/source/ui/func/fuinsert.cxx   |   12 +++++++++++-
 sw/source/ui/uiview/view2.cxx    |   10 ++++++++++
 3 files changed, 31 insertions(+), 1 deletions(-)

diff --git a/sc/source/ui/drawfunc/fuins1.cxx b/sc/source/ui/drawfunc/fuins1.cxx
index 8cc4a7a..da7e89b 100644
--- a/sc/source/ui/drawfunc/fuins1.cxx
+++ b/sc/source/ui/drawfunc/fuins1.cxx
@@ -35,8 +35,10 @@
 #include <svx/svdpage.hxx>
 #include <svx/svdpagv.hxx>
 #include <svx/svdview.hxx>
+#include <svx/linkwarn.hxx>
 #include <svtools/filter.hxx>
 #include <svtools/stritem.hxx>
+#include <svtools/miscopt.hxx>
 #include <vcl/msgbox.hxx>
 #include <tools/urlobj.hxx>
 #include <avmedia/mediawindow.hxx>
@@ -290,6 +292,14 @@ FuInsertGraphic::FuInsertGraphic( ScTabViewShell*	pViewSh,
                 String aFilterName = aDlg.GetCurrentFilter();
                 BOOL bAsLink = aDlg.IsAsLink();
 
+                // really store as link only?
+                if( bAsLink && SvtMiscOptions().ShowLinkWarningDialog() )
+                {
+                    SvxLinkWarningDialog aWarnDlg(pWin,aFileName);
+                    if( aWarnDlg.Execute() != RET_OK )
+                        bAsLink = sal_False; // don't store as link
+                }
+
                 lcl_InsertGraphic( aGraphic, aFileName, aFilterName, bAsLink, FALSE, pViewSh, pWindow, pView );
 
                 //	append items for recording
diff --git a/sd/source/ui/func/fuinsert.cxx b/sd/source/ui/func/fuinsert.cxx
index 76195cd..668fcab 100644
--- a/sd/source/ui/func/fuinsert.cxx
+++ b/sd/source/ui/func/fuinsert.cxx
@@ -48,9 +48,11 @@
 #include <sfx2/request.hxx>
 #include <svtools/globalnameitem.hxx>
 #include <svtools/pathoptions.hxx>
+#include <svtools/miscopt.hxx>
 #include <svx/pfiledlg.hxx>
 #include <svx/impgrf.hxx>
 #include <svx/dialogs.hrc>
+#include <svx/linkwarn.hxx>
 #include <svx/linkmgr.hxx>
 #include <svx/svdetc.hxx>
 #include <avmedia/mediawindow.hxx>
@@ -175,7 +177,15 @@ void FuInsertGraphic::DoExecute( SfxRequest&  )
 
                 if(pGrafObj && aDlg.IsAsLink())
                 {
-                    // store link only?
+                    // really store as link only?
+                    if( SvtMiscOptions().ShowLinkWarningDialog() )
+                    {
+                        SvxLinkWarningDialog aWarnDlg(mpWindow,aDlg.GetPath());
+                        if( aWarnDlg.Execute() != RET_OK )
+                            return; // don't store as link
+                    }
+
+                    // store as link
                     String aFltName(aDlg.GetCurrentFilter());
                     String aPath(aDlg.GetPath());
                     pGrafObj->SetGraphicLink(aPath, aFltName);
diff --git a/sw/source/ui/uiview/view2.cxx b/sw/source/ui/uiview/view2.cxx
index 70d23e4..738c5b7 100644
--- a/sw/source/ui/uiview/view2.cxx
+++ b/sw/source/ui/uiview/view2.cxx
@@ -58,6 +58,7 @@
 #include <caption.hxx>
 #include <svtools/PasswordHelper.hxx>
 #include <svtools/urihelper.hxx>
+#include <svtools/miscopt.hxx>
 #include <sfx2/passwd.hxx>
 #include <sfx2/sfxdlg.hxx>
 #include <sfx2/filedlghelper.hxx>
@@ -65,6 +66,7 @@
 #include <svx/langitem.hxx>
 #include <svx/viewlayoutitem.hxx>
 #include <svx/zoomslideritem.hxx>
+#include <svx/linkwarn.hxx>
 #include <svx/htmlmode.hxx>
 #ifndef _APP_HXX //autogen
 #include <vcl/svapp.hxx>
@@ -422,6 +424,14 @@ BOOL SwView::InsertGraphicDlg( SfxRequest& rReq )
                 rReq.AppendItem( SfxStringItem( FN_PARAM_2, sGraphicFormat ) );
                 rReq.AppendItem( SfxBoolItem( FN_PARAM_1, bAsLink ) );
             }
+
+            // really store as link only?
+            if( bAsLink && SvtMiscOptions().ShowLinkWarningDialog() )
+            {
+                SvxLinkWarningDialog aWarnDlg(GetWindow(),pFileDlg->GetPath());
+                if( aWarnDlg.Execute() != RET_OK )
+                    bAsLink=sal_False; // don't store as link
+            }
         }
 
         SwWrtShell& rSh = GetWrtShell();
-- 
1.7.0.1

