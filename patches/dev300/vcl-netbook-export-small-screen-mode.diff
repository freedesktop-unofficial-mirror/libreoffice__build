From 45859d988ed8f3aad42e17ca00c0cd83b19c8166 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:08:44 +0200
Subject: [PATCH 832/878] vcl-netbook-export-small-screen-mode.diff

---
 vcl/inc/vcl/salframe.hxx             |    2 ++
 vcl/inc/vcl/window.hxx               |    2 ++
 vcl/source/window/window3.cxx        |    6 ++++++
 vcl/unx/gtk/window/gtkframe.cxx      |    9 +++++++--
 vcl/unx/inc/plugins/gtk/gtkframe.hxx |    2 ++
 5 files changed, 19 insertions(+), 2 deletions(-)

diff --git a/vcl/inc/vcl/salframe.hxx b/vcl/inc/vcl/salframe.hxx
index 6224c2b..f0ab736 100644
--- a/vcl/inc/vcl/salframe.hxx
+++ b/vcl/inc/vcl/salframe.hxx
@@ -292,6 +292,8 @@ public:
     // (e.g. input methods, printer update handlers).
     long						CallCallback( USHORT nEvent, const void* pEvent ) const
     { return m_pProc ? m_pProc( m_pWindow, const_cast<SalFrame*>(this), nEvent, pEvent ) : 0; }
+
+    virtual BOOL GetSmallScreenMode() { return FALSE; }
 };
 
 
diff --git a/vcl/inc/vcl/window.hxx b/vcl/inc/vcl/window.hxx
index 09a5c02..ca7420d 100644
--- a/vcl/inc/vcl/window.hxx
+++ b/vcl/inc/vcl/window.hxx
@@ -1156,6 +1156,8 @@ public:
 
     virtual XubString GetSurroundingText() const;
     virtual Selection GetSurroundingTextSelection() const;
+
+    BOOL GetSmallScreenMode();
 };
 
 
diff --git a/vcl/source/window/window3.cxx b/vcl/source/window/window3.cxx
index ed15fa2..2ca6a67 100644
--- a/vcl/source/window/window3.cxx
+++ b/vcl/source/window/window3.cxx
@@ -34,6 +34,7 @@
 #include "vcl/window.h"
 #include "vcl/window.hxx"
 #include "vcl/waitobj.hxx"
+#include "vcl/salframe.hxx"
 #include "vcl/salgdi.hxx"
 #include "vcl/salnativewidgets.hxx"
 #include "vcl/salctrlhandle.hxx"
@@ -333,3 +334,8 @@ void Window::ImplAdjustNWFSizes()
         break;
     }
 }
+
+BOOL Window::GetSmallScreenMode()
+{
+    return ImplGetFrame()->GetSmallScreenMode();
+}
diff --git a/vcl/unx/gtk/window/gtkframe.cxx b/vcl/unx/gtk/window/gtkframe.cxx
index 4e1bc38..99ce264 100644
--- a/vcl/unx/gtk/window/gtkframe.cxx
+++ b/vcl/unx/gtk/window/gtkframe.cxx
@@ -847,7 +847,7 @@ void GtkSalFrame::Init( SalFrame* pParent, ULONG nStyle )
             gtk_window_set_keep_above( GTK_WINDOW(m_pWindow), true );
         }
         
-    if( getDisplay()->getWMAdaptor()->getSmallScreen() && eWinType == GTK_WINDOW_TOPLEVEL && !(nStyle & SAL_FRAME_STYLE_DIALOG ) )
+    if( GetSmallScreenMode() && eWinType == GTK_WINDOW_TOPLEVEL && !(nStyle & SAL_FRAME_STYLE_DIALOG ) )
         bNoDecor = true;
 
         gtk_window_set_type_hint( GTK_WINDOW(m_pWindow), eType );
@@ -1631,7 +1631,7 @@ void GtkSalFrame::SetWindowState( const SalFrameState* pState )
         SAL_FRAMESTATE_MASK_MAXIMIZED_X | SAL_FRAMESTATE_MASK_MAXIMIZED_Y |
         SAL_FRAMESTATE_MASK_MAXIMIZED_WIDTH | SAL_FRAMESTATE_MASK_MAXIMIZED_HEIGHT;
     
-    if( getDisplay()->getWMAdaptor()->getSmallScreen() && !(m_nStyle & SAL_FRAME_STYLE_DIALOG) )
+    if( GetSmallScreenMode() && !(m_nStyle & SAL_FRAME_STYLE_DIALOG) )
       gtk_window_maximize( GTK_WINDOW(m_pWindow) );
     else {
     if( (pState->mnMask & SAL_FRAMESTATE_MASK_STATE) &&
@@ -3765,6 +3765,11 @@ gboolean GtkSalFrame::IMHandler::signalIMRetrieveSurrounding( GtkIMContext* pCon
     return FALSE;
 }
 
+BOOL GtkSalFrame::GetSmallScreenMode()
+{
+    return getDisplay()->getWMAdaptor()->getSmallScreen();
+}
+
 gboolean GtkSalFrame::IMHandler::signalIMDeleteSurrounding( GtkIMContext*, gint offset, gint nchars, 
     gpointer /*im_handler*/ )
 {
diff --git a/vcl/unx/inc/plugins/gtk/gtkframe.hxx b/vcl/unx/inc/plugins/gtk/gtkframe.hxx
index a82fb66..d455f81 100644
--- a/vcl/unx/inc/plugins/gtk/gtkframe.hxx
+++ b/vcl/unx/inc/plugins/gtk/gtkframe.hxx
@@ -391,6 +391,8 @@ public:
     virtual void					EndSetClipRegion();
 
     static GtkSalFrame         *getFromWindow( GtkWindow *pWindow );
+
+    virtual BOOL GetSmallScreenMode();
 };
 
 
-- 
1.7.0.1

