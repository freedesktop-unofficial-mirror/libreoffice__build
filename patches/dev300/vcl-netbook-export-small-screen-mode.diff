From afc2085cd9d94c11e54309da1f686e9df1acd408 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:08:44 +0200
Subject: [PATCH 734/768] vcl-netbook-export-small-screen-mode.diff

---
 vcl/inc/vcl/salframe.hxx             |    2 ++
 vcl/inc/vcl/window.hxx               |    2 ++
 vcl/source/window/window3.cxx        |    6 ++++++
 vcl/unx/gtk/window/gtkframe.cxx      |    9 +++++++--
 vcl/unx/inc/plugins/gtk/gtkframe.hxx |    2 ++
 5 files changed, 19 insertions(+), 2 deletions(-)

diff --git vcl/inc/vcl/salframe.hxx vcl/inc/vcl/salframe.hxx
index 4e40b3e..0aec41a 100644
--- vcl/inc/vcl/salframe.hxx
+++ vcl/inc/vcl/salframe.hxx
@@ -293,6 +293,8 @@ public:
     // (e.g. input methods, printer update handlers).
     long						CallCallback( USHORT nEvent, const void* pEvent ) const
     { return m_pProc ? m_pProc( m_pWindow, const_cast<SalFrame*>(this), nEvent, pEvent ) : 0; }
+
+    virtual BOOL GetSmallScreenMode() { return FALSE; }
 };
 
 
diff --git vcl/inc/vcl/window.hxx vcl/inc/vcl/window.hxx
index 7686c82..a17c736 100644
--- vcl/inc/vcl/window.hxx
+++ vcl/inc/vcl/window.hxx
@@ -1155,6 +1155,8 @@ public:
 
     virtual XubString GetSurroundingText() const;
     virtual Selection GetSurroundingTextSelection() const;
+
+    BOOL GetSmallScreenMode();
 };
 
 
diff --git vcl/source/window/window3.cxx vcl/source/window/window3.cxx
index 4beef2e..91cb760 100644
--- vcl/source/window/window3.cxx
+++ vcl/source/window/window3.cxx
@@ -34,6 +34,7 @@
 #include "vcl/window.h"
 #include "vcl/window.hxx"
 #include "vcl/waitobj.hxx"
+#include "vcl/salframe.hxx"
 #include "vcl/salgdi.hxx"
 #include "vcl/salnativewidgets.hxx"
 #include "vcl/salctrlhandle.hxx"
@@ -339,3 +340,8 @@ void Window::ImplAdjustNWFSizes()
         break;
     }
 }
+
+BOOL Window::GetSmallScreenMode()
+{
+    return ImplGetFrame()->GetSmallScreenMode();
+}
diff --git vcl/unx/gtk/window/gtkframe.cxx vcl/unx/gtk/window/gtkframe.cxx
index 1dc2aec..360ff68 100644
--- vcl/unx/gtk/window/gtkframe.cxx
+++ vcl/unx/gtk/window/gtkframe.cxx
@@ -853,7 +853,7 @@ void GtkSalFrame::Init( SalFrame* pParent, ULONG nStyle )
             gtk_window_set_keep_above( GTK_WINDOW(m_pWindow), true );
         }
         
-    if( getDisplay()->getWMAdaptor()->getSmallScreen() && eWinType == GTK_WINDOW_TOPLEVEL && !(nStyle & SAL_FRAME_STYLE_DIALOG ) )
+    if( GetSmallScreenMode() && eWinType == GTK_WINDOW_TOPLEVEL && !(nStyle & SAL_FRAME_STYLE_DIALOG ) )
         bNoDecor = true;
 
         gtk_window_set_type_hint( GTK_WINDOW(m_pWindow), eType );
@@ -1630,7 +1630,7 @@ void GtkSalFrame::SetWindowState( const SalFrameState* pState )
         SAL_FRAMESTATE_MASK_MAXIMIZED_X | SAL_FRAMESTATE_MASK_MAXIMIZED_Y |
         SAL_FRAMESTATE_MASK_MAXIMIZED_WIDTH | SAL_FRAMESTATE_MASK_MAXIMIZED_HEIGHT;
     
-    if( getDisplay()->getWMAdaptor()->getSmallScreen() && !(m_nStyle & SAL_FRAME_STYLE_DIALOG) )
+    if( GetSmallScreenMode() && !(m_nStyle & SAL_FRAME_STYLE_DIALOG) )
       gtk_window_maximize( GTK_WINDOW(m_pWindow) );
     else {
     if( (pState->mnMask & SAL_FRAMESTATE_MASK_STATE) &&
@@ -3744,6 +3744,11 @@ gboolean GtkSalFrame::IMHandler::signalIMRetrieveSurrounding( GtkIMContext* pCon
     return FALSE;
 }
 
+BOOL GtkSalFrame::GetSmallScreenMode()
+{
+    return getDisplay()->getWMAdaptor()->getSmallScreen();
+}
+
 gboolean GtkSalFrame::IMHandler::signalIMDeleteSurrounding( GtkIMContext*, gint offset, gint nchars, 
     gpointer /*im_handler*/ )
 {
diff --git vcl/unx/inc/plugins/gtk/gtkframe.hxx vcl/unx/inc/plugins/gtk/gtkframe.hxx
index a848df3..0be351b 100644
--- vcl/unx/inc/plugins/gtk/gtkframe.hxx
+++ vcl/unx/inc/plugins/gtk/gtkframe.hxx
@@ -391,6 +391,8 @@ public:
     virtual void					EndSetClipRegion();
 
     static GtkSalFrame         *getFromWindow( GtkWindow *pWindow );
+
+    virtual BOOL GetSmallScreenMode();
 };
 
 
-- 
1.7.0.1

