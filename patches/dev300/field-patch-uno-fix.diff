From 3a502de50fe5cb00d7b8ae9643745564265804cb Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:04:28 +0200
Subject: [PATCH 623/878] field-patch-uno-fix.diff

---
 sw/source/core/unocore/unocoll.cxx |   40 ++++++++++++++++++-----------------
 1 files changed, 21 insertions(+), 19 deletions(-)

diff --git a/sw/source/core/unocore/unocoll.cxx b/sw/source/core/unocore/unocoll.cxx
index 25c8297..512b302 100644
--- a/sw/source/core/unocore/unocoll.cxx
+++ b/sw/source/core/unocore/unocoll.cxx
@@ -1720,7 +1720,7 @@ sal_Int32 SwXBookmarks::getCount(void)
     vos::OGuard aGuard(Application::GetSolarMutex());
     if(!IsValid())
         throw uno::RuntimeException();
-    return GetDoc()->getIDocumentMarkAccess()->getBookmarksCount();
+    return GetDoc()->getIDocumentMarkAccess()->getMarksCount();
 }
 
 uno::Any SwXBookmarks::getByIndex(sal_Int32 nIndex)
@@ -1730,11 +1730,11 @@ uno::Any SwXBookmarks::getByIndex(sal_Int32 nIndex)
     if(!IsValid())
         throw uno::RuntimeException();
     IDocumentMarkAccess* const pMarkAccess = GetDoc()->getIDocumentMarkAccess();
-    if(nIndex < 0 || nIndex >= pMarkAccess->getBookmarksCount())
+    if(nIndex < 0 || nIndex >= pMarkAccess->getMarksCount())
         throw IndexOutOfBoundsException();
 
     uno::Any aRet;
-    ::sw::mark::IMark* pBkmk = pMarkAccess->getBookmarksBegin()[nIndex].get();
+    ::sw::mark::IMark* pBkmk = pMarkAccess->getMarksBegin()[nIndex].get();
     uno::Reference< XTextContent > xRef = GetObject(*pBkmk, GetDoc());
     aRet.setValue(&xRef, ::getCppuType((uno::Reference<XTextContent>*)0));
     return aRet;
@@ -1748,8 +1748,8 @@ uno::Any SwXBookmarks::getByName(const rtl::OUString& rName)
         throw uno::RuntimeException();
 
     IDocumentMarkAccess* const pMarkAccess = GetDoc()->getIDocumentMarkAccess();
-    IDocumentMarkAccess::const_iterator_t ppBkmk = pMarkAccess->findBookmark(rName);
-    if(ppBkmk == pMarkAccess->getBookmarksEnd())
+    IDocumentMarkAccess::const_iterator_t ppBkmk = pMarkAccess->findMark(rName);
+    if(ppBkmk == pMarkAccess->getMarksEnd())
         throw NoSuchElementException();
 
     uno::Any aRet;
@@ -1766,10 +1766,10 @@ uno::Sequence< OUString > SwXBookmarks::getElementNames(void)
         throw uno::RuntimeException();
 
     IDocumentMarkAccess* const pMarkAccess = GetDoc()->getIDocumentMarkAccess();
-    uno::Sequence<OUString> aSeq(pMarkAccess->getBookmarksCount());
+    uno::Sequence<OUString> aSeq(pMarkAccess->getMarksCount());
     sal_Int32 nCnt = 0;
-    for(IDocumentMarkAccess::const_iterator_t ppMark = pMarkAccess->getBookmarksBegin();
-        ppMark != pMarkAccess->getBookmarksEnd();)
+    for(IDocumentMarkAccess::const_iterator_t ppMark = pMarkAccess->getMarksBegin();
+        ppMark != pMarkAccess->getMarksEnd();)
         aSeq[nCnt++] = (*ppMark++)->GetName();
     return aSeq;
 }
@@ -1782,7 +1782,7 @@ sal_Bool SwXBookmarks::hasByName(const OUString& rName)
         throw uno::RuntimeException();
 
     IDocumentMarkAccess* const pMarkAccess = GetDoc()->getIDocumentMarkAccess();
-    return pMarkAccess->findBookmark(rName) != pMarkAccess->getBookmarksEnd();
+    return pMarkAccess->findMark(rName) != pMarkAccess->getMarksEnd();
 }
 
 uno::Type SAL_CALL SwXBookmarks::getElementType()
@@ -1807,16 +1807,18 @@ SwXBookmark* SwXBookmarks::GetObject( ::sw::mark::IMark& rBkmk, SwDoc* pDoc)
     if(!pXBkmk)
     {
         // FIXME: These belong in XTextFieldsSupplier
-        //if (dynamic_cast< ::sw::mark::TextFieldmark* >(&rBkmk))
-        //    pXBkmk = new SwXFieldmark(false, &rBkmk, pDoc);
-        //else if (dynamic_cast< ::sw::mark::CheckboxFieldmark* >(&rBkmk))
-        //    pXBkmk = new SwXFieldmark(true, &rBkmk, pDoc);
-        //else
-        OSL_ENSURE(
-            dynamic_cast< ::sw::mark::IBookmark* >(&rBkmk),
-            "<SwXBookmark::GetObject(..)>"
-            "SwXBookmark requested for non-bookmark mark.");
-        pXBkmk = new SwXBookmark(&rBkmk, pDoc);
+        if (dynamic_cast< ::sw::mark::ICheckboxFieldmark* >(&rBkmk))
+            pXBkmk = new SwXFieldmark(true, &rBkmk, pDoc);
+        else if (dynamic_cast< ::sw::mark::IFieldmark* >(&rBkmk))
+            pXBkmk = new SwXFieldmark(false, &rBkmk, pDoc);
+        else
+        {
+            OSL_ENSURE(
+                dynamic_cast< ::sw::mark::IBookmark* >(&rBkmk),
+                "<SwXBookmark::GetObject(..)>"
+                "SwXBookmark requested for non-bookmark mark.");
+            pXBkmk = new SwXBookmark(&rBkmk, pDoc);
+        }
     }
     return pXBkmk;
 }
-- 
1.7.0.1

