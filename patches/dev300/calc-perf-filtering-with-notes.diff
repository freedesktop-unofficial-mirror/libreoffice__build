From 4b3407f9d97546bf2b48c2d0b7a1df6725a17bf9 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:56:36 +0200
Subject: [PATCH 218/878] calc-perf-filtering-with-notes.diff

---
 sc/source/core/data/table2.cxx |    4 ----
 sc/source/core/data/table3.cxx |    3 ++-
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git a/sc/source/core/data/table2.cxx b/sc/source/core/data/table2.cxx
index 03f3895..94fedaf 100644
--- a/sc/source/core/data/table2.cxx
+++ b/sc/source/core/data/table2.cxx
@@ -2380,8 +2380,6 @@ void ScTable::DBShowRow(SCROW nRow, BOOL bShow)
 void ScTable::DBShowRows(SCROW nRow1, SCROW nRow2, BOOL bShow)
 {
     SCROW nStartRow = nRow1;
-    IncRecalcLevel();
-    InitializeNoteCaptions();
     while (nStartRow <= nRow2)
     {
         BYTE nOldFlag = pRowFlags->GetValue(nStartRow) & CR_HIDDEN;
@@ -2424,8 +2422,6 @@ void ScTable::DBShowRows(SCROW nRow1, SCROW nRow2, BOOL bShow)
     //	to be done here.
     if (pOutlineTable)
         UpdateOutlineRow( nRow1, nRow2, bShow );
-
-    DecRecalcLevel();
 }
 
 
diff --git a/sc/source/core/data/table3.cxx b/sc/source/core/data/table3.cxx
index e860634..df163df 100644
--- a/sc/source/core/data/table3.cxx
+++ b/sc/source/core/data/table3.cxx
@@ -1623,6 +1623,7 @@ SCSIZE ScTable::Query(ScQueryParam& rParamOrg, BOOL bKeepSub)
                             aParam.nDestCol, aParam.nDestRow, aParam.nDestTab );
     }
 
+    InitializeNoteCaptions();
     for (SCROW j=aParam.nRow1 + nHeader; j<=nEndRow; j++)
     {
         BOOL bResult;									// Filterergebnis
@@ -1700,7 +1701,7 @@ SCSIZE ScTable::Query(ScQueryParam& rParamOrg, BOOL bKeepSub)
         DBShowRows(nOldStart,nOldEnd, bOldResult);
 
     delete[] pSpecial;
-
+    SetDrawPageSize();
     return nCount;
 }
 
-- 
1.7.0.1

