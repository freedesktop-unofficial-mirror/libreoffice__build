From 45fe47144c41e64b3c91a91b6cf77446c91b1d5b Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:56:36 +0200
Subject: [PATCH 191/768] calc-perf-filtering-with-notes.diff

---
 sc/source/core/data/table2.cxx |    4 ----
 sc/source/core/data/table3.cxx |    3 ++-
 2 files changed, 2 insertions(+), 5 deletions(-)

diff --git sc/source/core/data/table2.cxx sc/source/core/data/table2.cxx
index bd14718..53877f9 100644
--- sc/source/core/data/table2.cxx
+++ sc/source/core/data/table2.cxx
@@ -2381,8 +2381,6 @@ void ScTable::DBShowRow(SCROW nRow, BOOL bShow)
 void ScTable::DBShowRows(SCROW nRow1, SCROW nRow2, BOOL bShow)
 {
     SCROW nStartRow = nRow1;
-    IncRecalcLevel();
-    InitializeNoteCaptions();
     while (nStartRow <= nRow2)
     {
         BYTE nOldFlag = pRowFlags->GetValue(nStartRow) & CR_HIDDEN;
@@ -2425,8 +2423,6 @@ void ScTable::DBShowRows(SCROW nRow1, SCROW nRow2, BOOL bShow)
     //	to be done here.
     if (pOutlineTable)
         UpdateOutlineRow( nRow1, nRow2, bShow );
-
-    DecRecalcLevel();
 }
 
 
diff --git sc/source/core/data/table3.cxx sc/source/core/data/table3.cxx
index 61cc051..6f274e4 100644
--- sc/source/core/data/table3.cxx
+++ sc/source/core/data/table3.cxx
@@ -1623,6 +1623,7 @@ SCSIZE ScTable::Query(ScQueryParam& rParamOrg, BOOL bKeepSub)
                             aParam.nDestCol, aParam.nDestRow, aParam.nDestTab );
     }
 
+    InitializeNoteCaptions();
     for (SCROW j=aParam.nRow1 + nHeader; j<=nEndRow; j++)
     {
         BOOL bResult;									// Filterergebnis
@@ -1700,7 +1701,7 @@ SCSIZE ScTable::Query(ScQueryParam& rParamOrg, BOOL bKeepSub)
         DBShowRows(nOldStart,nOldEnd, bOldResult);
 
     delete[] pSpecial;
-
+    SetDrawPageSize();
     return nCount;
 }
 
-- 
1.7.0.1

