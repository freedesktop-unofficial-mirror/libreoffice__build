Index: config_office/configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.269
retrieving revision 1.254.6.2
diff -u -p -u -p -B -r1.269 -r1.254.6.2
--- config_office/configure.in	28 May 2008 10:42:27 -0000	1.269
+++ config_office/configure.in	2 Jun 2008 13:52:09 -0000	1.254.6.2
@@ -5155,16 +5155,28 @@ dnl Gnome VFS check
 dnl ===================================================================
 
 ENABLE_GNOMEVFS=""
+GNOMEVFS_HAS_LOCKING=""
 AC_MSG_CHECKING([whether to enable GNOME VFS support])
 if test "$_os" != "WINNT" -a "$_os" != "Darwin" -a "$enable_gnome_vfs" = "yes"; then
     ENABLE_GNOMEVFS="TRUE"
     AC_MSG_RESULT([yes])
     PKG_CHECK_MODULES( GNOMEVFS, gnome-vfs-2.0 >= 2.6.0 )
     PKG_CHECK_MODULES( GCONF, gconf-2.0 )
+
+    AC_LANG_SAVE
+    AC_LANG_CPLUSPLUS
+    save_CXXFLAGS=$CXXFLAGS
+    CXXFLAGS="$CXXFLAGS $GNOMEVFS_CFLAGS"
+    AC_CHECK_DECL(GNOME_VFS_OPEN_LOCKED,
+                  GNOMEVFS_HAS_LOCKING="YES",,
+                  [#include <libgnomevfs/gnome-vfs-handle.h>])
+    CXXFLAGS=$save_CXXFLAGS
+    AC_LANG_RESTORE
 else
     AC_MSG_RESULT([no])
 fi
 AC_SUBST(ENABLE_GNOMEVFS)
+AC_SUBST(GNOMEVFS_HAS_LOCKING)
 
 dnl ===================================================================
 dnl Check whether the gtk 2.0 libraries are available.
Index: config_office/set_soenv.in
===================================================================
RCS file: /cvs/tools/config_office/set_soenv.in,v
retrieving revision 1.187
retrieving revision 1.179.6.2
diff -u -p -u -p -B -r1.187 -r1.179.6.2
--- config_office/set_soenv.in	14 May 2008 14:56:22 -0000	1.187
+++ config_office/set_soenv.in	2 Jun 2008 13:52:14 -0000	1.179.6.2
@@ -1697,6 +1697,7 @@ ToFile( "SYSTEM_SERVLETAPI", "@SYSTEM_SE
 ToFile( "SERVLETAPI_JAR",    "@SERVLETAPI_JAR@",   "e" );
 ToFile( "ENABLE_DBUS",       "@ENABLE_DBUS@",      "e" );
 ToFile( "ENABLE_GNOMEVFS",   "@ENABLE_GNOMEVFS@",  "e" );
+ToFile( "GNOMEVFS_HAS_LOCKING","@GNOMEVFS_HAS_LOCKING@",  "e" );
 ToFile( "ENABLE_GIO",        "@ENABLE_GIO@",       "e" );
 ToFile( "ENABLE_KDE",        "@ENABLE_KDE@",       "e" );
 ToFile( "KDE_CFLAGS",        "@KDE_CFLAGS@",       "e" );
