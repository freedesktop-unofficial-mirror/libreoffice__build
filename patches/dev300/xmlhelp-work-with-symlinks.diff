---
 xmlhelp/source/cxxhelp/provider/databases.cxx |   21 +++++++++++++--------
 xmlhelp/source/treeview/tvread.cxx            |   12 +++++++++---
 2 files changed, 22 insertions(+), 11 deletions(-)

diff --git xmlhelp/source/cxxhelp/provider/databases.cxx xmlhelp/source/cxxhelp/provider/databases.cxx
index 6693d69..0b0dd48 100644
--- xmlhelp/source/cxxhelp/provider/databases.cxx
+++ xmlhelp/source/cxxhelp/provider/databases.cxx
@@ -28,6 +28,7 @@
 #include "db.hxx"
 #include <osl/diagnose.h>
 #include <osl/thread.h>
+#include <osl/process.h>
 #include <rtl/uri.hxx>
 #include <osl/file.hxx>
 #include <rtl/memory.h>
@@ -239,17 +238,21 @@ static bool impl_getZipFile(
         const rtl::OUString & rZipName,
         rtl::OUString & rFileName )
 {
+    rtl::OUString aWorkingDir;
+    osl_getProcessWorkingDir( &aWorkingDir.pData );
     const rtl::OUString *pPathArray = rImagesZipPaths.getArray();
     for ( int i = 0; i < rImagesZipPaths.getLength(); ++i )
     {
-        rFileName = pPathArray[ i ];
-        if ( rFileName.getLength() )
+        rtl::OUString aFileName = pPathArray[ i ];
+        if ( aFileName.getLength() )
         {
-            if ( 1 + rFileName.lastIndexOf( '/' ) != rFileName.getLength() )
+            if ( 1 + aFileName.lastIndexOf( '/' ) != aFileName.getLength() )
             {
-                rFileName += rtl::OUString::createFromAscii( "/" );
+                aFileName += rtl::OUString::createFromAscii( "/" );
             }
-            rFileName += rZipName;
+            aFileName += rZipName;
+            // the icons are not read when the URL is a symlink
+            osl::File::getAbsoluteFileURL( aWorkingDir, aFileName, rFileName );
 
             // test existence
             osl::DirectoryItem aDirItem;
@@ -1328,7 +1331,9 @@ void Databases::cascadingStylesheet( const rtl::OUString& Language,
                 osl::FileBase::E_None == aFile.open( OpenFlag_Read )                 &&
                 osl::FileBase::E_None == aDirItem.getFileStatus( aStatus ) )
             {
-                m_nCustomCSSDocLength = int( aStatus.getFileSize() );
+                sal_uInt64 nSize;
+                aFile.getSize( nSize );
+                m_nCustomCSSDocLength = (int)nSize;
                 m_pCustomCSSDoc = new char[ 1 + m_nCustomCSSDocLength ];
                 m_pCustomCSSDoc[ m_nCustomCSSDocLength ] = 0;
                 sal_uInt64 a = m_nCustomCSSDocLength,b = m_nCustomCSSDocLength;
diff --git xmlhelp/source/treeview/tvread.cxx xmlhelp/source/treeview/tvread.cxx
index 02ba6b9..aa399a5 100644
--- xmlhelp/source/treeview/tvread.cxx
+++ xmlhelp/source/treeview/tvread.cxx
@@ -781,9 +781,15 @@ ConfigData TVChildTarget::init( const Reference< XMultiServiceFactory >& xSMgr )
                 rtl::OUString baseName = aFileName.copy(0,idx_).toAsciiLowerCase();
                 if(! showBasic && baseName.compareToAscii("sbasic") == 0 )
                   continue;
-                
-                configData.vFileLen.push_back( aFileStatus.getFileSize() );
-                configData.vFileURL.push_back( aFileUrl );
+                osl::File aFile( aFileUrl );
+                if( osl::FileBase::E_None == aFile.open( OpenFlag_Read ) )
+                {
+                    sal_uInt64 nSize;
+                    aFile.getSize( nSize );
+                    configData.vFileLen.push_back( aFileStatus.getFileSize() );
+                    configData.vFileURL.push_back( aFileUrl );
+                    aFile.close();
+                }
               }
           }
         aDirectory.close();
-- 
1.7.0.1

