From 304b6c74b30d2ccef03977cb16dc05705ec32484 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:58:42 +0200
Subject: [PATCH 294/768] crash-startup.diff

---
 vcl/source/gdi/makefile.mk      |    2 +-
 vcl/unx/gtk/window/gtkframe.cxx |    8 +++++++-
 2 files changed, 8 insertions(+), 2 deletions(-)

diff --git vcl/source/gdi/makefile.mk vcl/source/gdi/makefile.mk
index 75f2b3f..d60e37f 100644
--- vcl/source/gdi/makefile.mk
+++ vcl/source/gdi/makefile.mk
@@ -48,6 +48,7 @@ CDEFS+=-DENABLE_GRAPHITE
 # --- Files --------------------------------------------------------
 
 EXCEPTIONSFILES=	$(SLO)$/salmisc.obj 	\
+                    $(SLO)$/bitmapex.obj	\
                     $(SLO)$/outdev.obj		\
                     $(SLO)$/outdev3.obj 	\
                     $(SLO)$/gfxlink.obj		\
@@ -83,7 +84,6 @@ SLOFILES=	$(EXCEPTIONSFILES)      \
             $(SLO)$/bitmap3.obj 	\
             $(SLO)$/bitmap4.obj 	\
             $(SLO)$/alpha.obj		\
-            $(SLO)$/bitmapex.obj	\
             $(SLO)$/imgcons.obj 	\
             $(SLO)$/bmpacc.obj		\
             $(SLO)$/bmpacc2.obj 	\
diff --git vcl/unx/gtk/window/gtkframe.cxx vcl/unx/gtk/window/gtkframe.cxx
index 9658a1c..f525f0e 100644
--- vcl/unx/gtk/window/gtkframe.cxx
+++ vcl/unx/gtk/window/gtkframe.cxx
@@ -1147,7 +1147,13 @@ void GtkSalFrame::SetIcon( USHORT nIcon )
     {
         // #i44723# workaround gcc temporary problem
         ResId aResId( nOffsets[nIndex] + nIcon, *ImplGetResMgr() );
-        BitmapEx aIcon( aResId );
+        BitmapEx aIcon;
+        try {
+            aIcon = BitmapEx( aResId );
+        } catch (com::sun::star::uno::RuntimeException &) {
+            // UCB not initialized for splash screen creation; very exceptional.
+            continue;
+        }
 
         // #i81083# convert to 24bit/8bit alpha bitmap
         Bitmap aBmp = aIcon.GetBitmap();
-- 
1.7.0.1

