From e7123aaf9a3e6fc5c45f1f09e4e8c944bd0a13e7 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:53:00 +0200
Subject: [PATCH 030/878] speed-soffice-sh.diff

---
 desktop/scripts/makefile.mk |   12 ++++++++++--
 desktop/scripts/soffice.sh  |    3 ++-
 2 files changed, 12 insertions(+), 3 deletions(-)

diff --git a/desktop/scripts/makefile.mk b/desktop/scripts/makefile.mk
index 427b7e5..330f5ba 100644
--- a/desktop/scripts/makefile.mk
+++ b/desktop/scripts/makefile.mk
@@ -49,8 +49,16 @@ UNIXTEXT= \
     $(MISC)$/unoinfo.sh \
     $(MISC)$/unopkg.sh
 
-.IF "$(OS)" != "MACOSX"
-UNIXTEXT+= $(MISC)$/soffice.sh
+.IF "$(OS)" == "MACOSX"
+all: $(UNIXTEXT)
+.ELSE
+all: $(UNIXTEXT) $(MISC)$/soffice.sh
 .ENDIF
 
 .INCLUDE :  target.mk
+
+$(MISC)$/soffice.sh : soffice.sh
+    @echo "Building wrapper: " $@
+    @@-$(RM) -f $@ $@.tmp
+    @tr -d "\015" < $(@:f) > $@.tmp
+    $(TYPE) $@.tmp | $(SED) "s/%%OS%%/$(OS)/" | $(SED) "s/%%CPUNAME%%/$(CPUNAME)/" > $@
diff --git a/desktop/scripts/soffice.sh b/desktop/scripts/soffice.sh
index b0de1d6..7f0528b 100644
--- a/desktop/scripts/soffice.sh
+++ b/desktop/scripts/soffice.sh
@@ -40,7 +40,8 @@ export SAL_ENABLE_FILE_LOCKING
 # SAL_NOOPENGL=true; export SAL_NOOPENGL
 
 # the following test is needed on Linux PPC with IBM j2sdk142
-if [ "`uname -s`" = "Linux" -a "`uname -m`" = "ppc" ] ; then
+# These variables are substituted during the build process
+if [ "%%OS%%" = "LINUX" -a "%%CPUNAME%%" = "POWERPC" ] ; then
     JITC_PROCESSOR_TYPE=6
     export JITC_PROCESSOR_TYPE
 fi
-- 
1.7.0.1

