From c2716de38ac8d08d80c5639c8e1001e9ccdaa311 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:52:31 +0200
Subject: [PATCH 008/878] cws-koheidatapilot03-xmloff.diff

---
 xmloff/inc/xmlnmspe.hxx         |    3 ++-
 xmloff/inc/xmloff/xmltoken.hxx  |    4 ++++
 xmloff/source/core/xmlexp.cxx   |    6 ++++++
 xmloff/source/core/xmlimp.cxx   |    4 ++++
 xmloff/source/core/xmltoken.cxx |    4 ++++
 5 files changed, 20 insertions(+), 1 deletions(-)

diff --git a/xmloff/inc/xmlnmspe.hxx b/xmloff/inc/xmlnmspe.hxx
index be04ae1..b598137 100644
--- a/xmloff/inc/xmlnmspe.hxx
+++ b/xmloff/inc/xmlnmspe.hxx
@@ -86,8 +86,9 @@ const sal_uInt16 XML_NAMESPACE_##prefix##_EXT	    = key; \
 const sal_uInt16 XML_NAMESPACE_##prefix##_EXT_IDX	= key;
 
 XML_NAMESPACE_EXT( OFFICE,      37U )
+XML_NAMESPACE_EXT( TABLE,       38U )
 
-#define _XML_OLD_NAMESPACE_BASE 38U
+#define _XML_OLD_NAMESPACE_BASE 39U
 
 // namespaces used in the technical preview (SO 5.2)
 XML_OLD_NAMESPACE( FO,		0U )
diff --git a/xmloff/inc/xmloff/xmltoken.hxx b/xmloff/inc/xmloff/xmltoken.hxx
index 6e4c45e..aa41530 100644
--- a/xmloff/inc/xmloff/xmltoken.hxx
+++ b/xmloff/inc/xmloff/xmltoken.hxx
@@ -144,6 +144,9 @@ namespace xmloff { namespace token {
         // ODF Enhanced namespaces
         XML_NP_OFFICE_EXT,
         XML_N_OFFICE_EXT,
+
+        XML_NP_TABLE_EXT,
+        XML_N_TABLE_EXT,
         
         // units
         XML_UNIT_MM,
@@ -517,6 +520,7 @@ namespace xmloff { namespace token {
         XML_DATA_LABEL_SYMBOL,
         XML_DATA_LABEL_TEXT,
         XML_DATA_PILOT_FIELD,
+        XML_DATA_PILOT_GRAND_TOTAL,
         XML_DATA_PILOT_LEVEL,
         XML_DATA_PILOT_MEMBER,
         XML_DATA_PILOT_MEMBERS,
diff --git a/xmloff/source/core/xmlexp.cxx b/xmloff/source/core/xmlexp.cxx
index 0003ed8..a18e8bc 100644
--- a/xmloff/source/core/xmlexp.cxx
+++ b/xmloff/source/core/xmlexp.cxx
@@ -319,6 +319,12 @@ void SvXMLExport::_InitCtor()
         mpNamespaceMap->Add( GetXMLToken(XML_NP_OOOW),  GetXMLToken(XML_N_OOOW),    XML_NAMESPACE_OOOW );
         mpNamespaceMap->Add( GetXMLToken(XML_NP_OOOC),  GetXMLToken(XML_N_OOOC),    XML_NAMESPACE_OOOC );
         mpNamespaceMap->Add( GetXMLToken(XML_NP_OF),    GetXMLToken(XML_N_OF),      XML_NAMESPACE_OF );
+
+        if (getDefaultVersion() == SvtSaveOptions::ODFVER_LATEST)
+        {
+            mpNamespaceMap->Add(
+                GetXMLToken(XML_NP_TABLE_EXT), GetXMLToken(XML_N_TABLE_EXT), XML_NAMESPACE_TABLE_EXT);
+        }
     }
     if( (getExportFlags() & (EXPORT_MASTERSTYLES|EXPORT_CONTENT) ) != 0 )
     {
diff --git a/xmloff/source/core/xmlimp.cxx b/xmloff/source/core/xmlimp.cxx
index 91480f1..bce461e 100644
--- a/xmloff/source/core/xmlimp.cxx
+++ b/xmloff/source/core/xmlimp.cxx
@@ -98,6 +98,7 @@ sal_Char __READONLY_DATA sXML_np__of[] = "_of";
 sal_Char __READONLY_DATA sXML_np__style[] = "_style";
 sal_Char __READONLY_DATA sXML_np__text[] = "_text";
 sal_Char __READONLY_DATA sXML_np__table[] = "_table";
+sal_Char __READONLY_DATA sXML_np__table_ext[] = "_table_ooo";
 sal_Char __READONLY_DATA sXML_np__draw[] = "_draw";
 sal_Char __READONLY_DATA sXML_np__dr3d[] = "_dr3d";
 sal_Char __READONLY_DATA sXML_np__fo[] = "_fo";
@@ -256,6 +257,9 @@ void SvXMLImport::_InitCtor()
         mpNamespaceMap->Add( OUString( RTL_CONSTASCII_USTRINGPARAM ( sXML_np__table ) ),
                             GetXMLToken(XML_N_TABLE),
                             XML_NAMESPACE_TABLE );
+        mpNamespaceMap->Add( OUString( RTL_CONSTASCII_USTRINGPARAM ( sXML_np__table_ext ) ),
+                            GetXMLToken(XML_N_TABLE_EXT),
+                            XML_NAMESPACE_TABLE_EXT );
         mpNamespaceMap->Add( OUString( RTL_CONSTASCII_USTRINGPARAM ( sXML_np__draw ) ),
                             GetXMLToken(XML_N_DRAW),
                             XML_NAMESPACE_DRAW );
diff --git a/xmloff/source/core/xmltoken.cxx b/xmloff/source/core/xmltoken.cxx
index bb4370a..c593808 100644
--- a/xmloff/source/core/xmltoken.cxx
+++ b/xmloff/source/core/xmltoken.cxx
@@ -153,6 +153,9 @@ namespace xmloff { namespace token {
         TOKEN( "officeooo", XML_NP_OFFICE_EXT ),
         TOKEN( "http://openoffice.org/2009/office", XML_N_OFFICE_EXT ),
 
+        TOKEN( "tableooo", XML_NP_TABLE_EXT ),
+        TOKEN( "http://openoffice.org/2009/table", XML_N_TABLE_EXT ),
+
         // units
         TOKEN( "mm",                              XML_UNIT_MM ),
         TOKEN( "m",                               XML_UNIT_M ),
@@ -525,6 +528,7 @@ namespace xmloff { namespace token {
         TOKEN( "data-label-symbol",               XML_DATA_LABEL_SYMBOL ),
         TOKEN( "data-label-text",                 XML_DATA_LABEL_TEXT ),
         TOKEN( "data-pilot-field",                XML_DATA_PILOT_FIELD ),
+        TOKEN( "data-pilot-grand-total",          XML_DATA_PILOT_GRAND_TOTAL ),
         TOKEN( "data-pilot-level",                XML_DATA_PILOT_LEVEL ),
         TOKEN( "data-pilot-member",               XML_DATA_PILOT_MEMBER ),
         TOKEN( "data-pilot-members",              XML_DATA_PILOT_MEMBERS ),
-- 
1.7.0.1

