From 9bd66e234e8085694e5d2016c8f3aa6f571a5ee8 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:52:25 +0200
Subject: [PATCH 004/878] cws-koheidatapilot03-accessibility.diff

---
 accessibility/source/helper/acc_factory.cxx |   13 ++++++++++++-
 1 files changed, 12 insertions(+), 1 deletions(-)

diff --git a/accessibility/source/helper/acc_factory.cxx b/accessibility/source/helper/acc_factory.cxx
index ce60192..c265acf 100644
--- a/accessibility/source/helper/acc_factory.cxx
+++ b/accessibility/source/helper/acc_factory.cxx
@@ -69,6 +69,7 @@
 #include <accessibility/extended/accessibleeditbrowseboxcell.hxx>
 #include <vcl/lstbox.hxx>
 #include <vcl/combobox.hxx>
+#include "vcl/popupmenuwindow.hxx"
 
 #include <floatingwindowaccessible.hxx>
 
@@ -373,7 +374,17 @@ inline bool hasFloatingChild(Window *pWindow)
             }
             else if ( nType == WINDOW_BORDERWINDOW && hasFloatingChild( pWindow ) ) 
             {
-                xContext = new FloatingWindowAccessible( _pXWindow );
+                PopupMenuFloatingWindow* pChild = dynamic_cast<PopupMenuFloatingWindow*>(
+                    pWindow->GetAccessibleChildWindow(0));
+                if ( pChild && pChild->IsPopupMenu() )
+                {
+                    // Get the accessible context from the child window.
+                    Reference<XAccessible> xAccessible = pChild->CreateAccessible();
+                    if (xAccessible.is())
+                        xContext = xAccessible->getAccessibleContext();
+                }
+                else
+                    xContext = new FloatingWindowAccessible( _pXWindow );
             }            
             else if ( nType == WINDOW_HELPTEXTWINDOW )
             {
-- 
1.7.0.1

