--- solenv/inc/wntgcci6.mk.pristine	2008-10-29 08:42:22.000000000 +0100
+++ solenv/inc/wntgcci6.mk	2008-10-30 14:11:42.000000000 +0100
@@ -31,14 +31,19 @@
 
 # mk file for wntgcci6
 
-SOLAR_JAVA*=TRUE
+#SOLAR_JAVA*=TRUE
 FULL_DESK=TRUE
 JAVAFLAGSDEBUG=-g
 
 # SOLAR JAva Unterstuetzung nur fuer wntmsci
 
+.IF "$(CROSS_COMPILING)" == "no"
 ASM=ml
 AFLAGS=/c /Cp /coff
+.ELSE # "$(CROSS_COMPILING)" == "yes"
+ASM=$(NASM)
+REGCOMP:=wine $(SOLARBINDIR)/regcomp
+.ENDIF # "$(CROSS_COMPILING)" == "yes"
 
 # architecture dependent flags for the C and C++ compiler that can be changed by
 # exporting the variable ARCH_FLAGS="..." in the shell, which is used to start build
@@ -50,7 +54,13 @@ CXX*=gcc
 #CFLAGS=-c -Wall -I$(INCLUDE) $(OLE2DEF)
 # new:
 #CYGINC=$(INCLUDE:s/-I /-I/:+"  ":s/;/ -I/:s/-I  //:s/   / /)
-CFLAGS=-fmessage-length=0 -c -nostdinc $(OLE2DEF)
+CFLAGS=-fmessage-length=0 -c $(OLE2DEF)
+.IF "$(CROSS_COMPILING)" == "no"
+CFLAGS += -nostdinc
+.ELSE # "$(CROSS_COMPILING)" == "yes"
+CFLAGS += -D__CROSS__
+SCPDEFS += -D__MINGW32__ -D__CROSS__ -DDISABLE_ATL -DUSE_SYSTEM_STL
+.ENDIF # "$(CROSS_COMPILING)" == "yes"
 ###
 CFLAGSCC=-pipe $(ARCH_FLAGS)
 CFLAGSCXX=-pipe $(ARCH_FLAGS)
@@ -109,18 +116,37 @@ DYNAMIC= -dynamic
 
 LINK*=$(CXX)
 LINKC*=$(CC)
-
-CYGLIB=$(LIB:s/;/ -L/)
-LINKFLAGS=-nostdlib -Wl,--enable-stdcall-fixup,--enable-runtime-pseudo-reloc -L$(CYGLIB)
+# FIXME: better way to strip trailing semicolon from $(LIB) to avoid
+# CYGLIB content to end with -L, eating next argument
+LIB___=$(LIB)---
+LIB_NO_TRAILING_SEMI___ = $(LIB___:s/;---//)
+LIB_NO_TRAILING_SEMI = $(LIB_NO_TRAILING_SEMI___:s/---//)
+CYGLIB=$(LIB_NO_TRAILING_SEMI:s/;/ -L/)
+LINKFLAGS=-Wl,--enable-stdcall-fixup,--enable-runtime-pseudo-reloc
+.IF "$(CYGLIB)" != ""
+LINKFLAGS += -L$(CYGLIB)
+.ENDIF #"$(CYGLIB)" != ""
+.IF "$(CROSS_COMPILING)" == "no"
+LINKFLAGS += -nostdlib
+.ELSE # "$(CROSS_COMPILING)" == "yes"
+LINKFLAGS += -L$(SOLARBINDIR) -L$(SOLARLIBDIR) -L$(COMPATH)/../../bin -L$(COMPATH)/../../lib
+.ENDIF # "$(CROSS_COMPILING)" == "yes"
 .IF "$(USE_MINGW)"=="cygwin"
 MINGWLIBDIR=$(COMPATH)$/lib$/mingw
 .ELSE
 MINGWLIBDIR=$(COMPATH)$/lib
 .ENDIF
-LINKFLAGSAPPGUI=-mwindows $(MINGWLIBDIR)$/crt2.o
-LINKFLAGSSHLGUI=--warn-once -mwindows -shared $(MINGWLIBDIR)$/dllcrt2.o
-LINKFLAGSAPPCUI=-mconsole $(MINGWLIBDIR)$/crt2.o
-LINKFLAGSSHLCUI=--warn-once -mconsole -shared $(MINGWLIBDIR)$/dllcrt2.o
+LINKFLAGSAPPGUI=-mwindows
+LINKFLAGSSHLGUI=--warn-once -mwindows -shared
+LINKFLAGSAPPCUI=-mconsole
+LINKFLAGSSHLCUI=--warn-once -mconsole -shared
+.IF "$(CROSS_COMPILING)" == "no"
+LINKFLAGSAPPGUI+=$(MINGWLIBDIR)$/crt2.o
+LINKFLAGSSHLGUI+=$(MINGWLIBDIR)$/dllcrt2.o
+LINKFLAGSAPPCUI+=$(MINGWLIBDIR)$/crt2.o
+LINKFLAGSSHLCUI+=$(MINGWLIBDIR)$/dllcrt2.o
+.ENDIF # "$(CROSS_COMPILING)" == "no"
+
 LINKFLAGSTACK=
 LINKFLAGSPROF=
 LINKFLAGSDEBUG=-g
@@ -144,24 +170,28 @@ STDLIBCUIMT+=-lmingwthrd
 STDSHLGUIMT+=-lmingwthrd
 STDSHLCUIMT+=-lmingwthrd
 .ENDIF
-STDLIBGUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt
-STDLIBCUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt
-STDSHLGUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt
-STDSHLCUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt
+STDLIBGUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt -lversion
+STDLIBCUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt -lversion
+STDSHLGUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt -lversion
+STDSHLCUIMT+=-lmingw32 -lmoldname -lmingwex -Wl,--end-group $(UWINAPILIB) -lm -lkernel32 -luser32 -lmsvcrt -lversion
 
 LIBSTLPORT=-lstlport_gcc
 LIBSTLPORTST=-lstlport_gcc_static
 
-LIBMGR=ar
+LIBMGR=$(AR)
 LIBFLAGS=-rsu
 
-IMPLIB=ld
+IMPLIB=$(LD)
 IMPLIBFLAGS=
 
 MAPSYM=tmapsym
 MAPSYMFLAGS=
 
+.IF "$(CROSS_COMPILING)" == "no"
 RC=rc
+.ELSE # "$(CROSS_COMPILING)" == "yes"
+RC=$(WINDRES)
+.ENDIF # "$(CROSS_COMPILING)" == "yes"
 RCFLAGS=-D__MINGW32__ -DWIN32 -D_WIN32_IE=0x400 -fo$@ $(RCFILES)
 RCLINK=
 RCLINKFLAGS=
@@ -170,12 +200,22 @@ RCSETVERSION=
 DLLPOSTFIX=gi
 PCHPOST=.gch
 
+.IF "$(CROSS_COMPILING)" == "no"
+LINK_PSDK_LIB=$(PSDK_HOME)/lib/
+PSDK_DOT_LIB=.lib
+.ELSE # "$(CROSS_COMPILING)" == "yes"
+DISABLE_ACTIVEX=TRUE
+DISABLE_ATL=TRUE
+LINK_PSDK_LIB=-l
+PSDK_DOT_LIB=
+.ENDIF # "$(CROSS_COMPILING)" == "yes"
+
 ADVAPI32LIB=-ladvapi32
 SHELL32LIB=-lshell32
 GDI32LIB=-lgdi32
 OLE32LIB=-lole32
 OLEAUT32LIB=-loleaut32
-UUIDLIB=$(PSDK_HOME)$/lib$/uuid.lib
+UUIDLIB=$(LINK_PSDK_LIB)uuid$(PSDK_DOT_LIB)
 WINSPOOLLIB=-lwinspool
 IMM32LIB=-limm32
 PSPLIB=-lpsp
@@ -189,14 +228,21 @@ USER32LIB=-luser32
 LIBCMT=-lmsvcrt
 COMDLG32LIB=-lcomdlg32
 COMCTL32LIB=-lcomctl32
-CRYPT32LIB=$(PSDK_HOME)$/lib$/crypt32.lib
-GDIPLUSLIB=$(PSDK_HOME)$/lib$/gdiplus.lib
-DBGHELPLIB=$(PSDK_HOME)$/lib$/dbghelp.lib
-MSILIB=$(PSDK_HOME)$/lib$/msi.lib
-DDRAWLIB=$(DIRECTXSDK_LIB)/ddraw.lib
-SHLWAPILIB=$(PSDK_HOME)$/lib$/shlwapi.lib
-URLMONLIB=$(PSDK_HOME)$/lib$/urlmon.lib
-UNICOWSLIB=$(PSDK_HOME)$/lib$/unicows.lib
+CRYPT32LIB=$(LINK_PSDK_LIB)crypt32$(PSDK_DOT_LIB)
+GDIPLUSLIB=$(LINK_PSDK_LIB)gdiplus$(PSDK_DOT_LIB)
+DBGHELPLIB=$(LINK_PSDK_LIB)dbghelp$(PSDK_DOT_LIB)
+MSILIB=$(LINK_PSDK_LIB)msi$(PSDK_DOT_LIB)
+DDRAWLIB=$(DIRECTXSDK_LIB)/ddraw$(PSDK_DOT_LIB)
+SHLWAPILIB=$(LINK_PSDK_LIB)shlwapi$(PSDK_DOT_LIB)
+URLMONLIB=$(LINK_PSDK_LIB)urlmon$(PSDK_DOT_LIB)
+UNICOWSLIB=$(LINK_PSDK_LIB)unicows$(PSDK_DOT_LIB)
 WININETLIB=-lwininet
 OLDNAMESLIB=-lmoldname
-MSIMG32LIB=$(PSDK_HOME)$/lib$/msimg32.lib
+MSIMG32LIB=$(LINK_PSDK_LIB)msimg32$(PSDK_DOT_LIB)
+
+.IF "$(CROSS_COMPILING)" == "yes"
+CURLLIB=-lcurl
+BERKELEYLIB=-ldb -lwsock32
+XSLTLIB=-lxslt -lxml2
+LIBXML2LIB=-lxml2
+.ENDIF
--- solenv/inc/shlinfo.rc.pristine	2008-10-29 09:33:25.000000000 +0100
+++ solenv/inc/shlinfo.rc	2008-10-29 09:33:33.000000000 +0100
@@ -29,8 +29,9 @@
  ************************************************************************/
 
 #define VERSION			3
-#define SUBVERSION		1
-#define VERVARIANT		0
+#if !defined(VERVARIANT)
+  #define VERVARIANT 		0
+#endif
 
 // .0 + VER_CONCEPT
 // .100 + VER_ALPHA
@@ -90,16 +91,16 @@
 // 				version information
 // -----------------------------------------------------------------------
 
-VS_VERSION_INFO versioninfo
+VS_VERSION_INFO VERSIONINFO
 #ifndef SUBVERSION
-	fileversion    VERSION, 0, 0, VERVARIANT
-	productversion VERSION, 0, 0, VERVARIANT
+	FILEVERSION    VERSION, 0, 0, VERVARIANT
+	PRODUCTVERSION VERSION, 0, 0, VERVARIANT
 #else
-	fileversion    VERSION, VERVARIANT, VER_COUNT
-	productversion VERSION, VERVARIANT, VER_COUNT
+	FILEVERSION    VERSION, VERVARIANT, VER_COUNT
+	PRODUCTVERSION VERSION, VERVARIANT, VER_COUNT
 #endif
-	fileflagsmask 0x3F
-	fileflags
+	FILEFLAGSMASK 0x3F
+	FILEFLAGS
 #if defined(DEBUG)
 	VS_FF_DEBUG |
 #endif
@@ -108,36 +109,36 @@
 #endif
 	0
 #ifndef WIN32
-	fileos VOS_DOS_WINDOWS16
+	FILEOS VOS_DOS_WINDOWS16
 #else
-	fileos VOS_NT_WINDOWS32
+	FILEOS VOS_NT_WINDOWS32
 #endif
-	filetype VFT_APP
+	FILETYPE VFT_APP
 	{
-		block "StringFileInfo"
+		BLOCK "StringFileInfo"
 		{
 #ifdef LG_D
-			block "040704E4"
+			BLOCK "040704E4"
 			{
 				// German StringTable
-				value "CompanyName",		"Sun Microsystems, Inc.\0"
-				value "FileVersion",		PPS(VER_LEVEL) "\0"
-				value "OriginalFilename",	PPS(ORG_NAME) "\0"
-				value "InternalName", 		PPS(INTERNAL_NAME) "\0"
-				value "LegalCopyright",		S_CRIGHT " Sun Microsystems, Inc.\0"
+				VALUE "CompanyName",		"Sun Microsystems, Inc.\0"
+				VALUE "FileVersion",		PPS(VER_LEVEL) "\0"
+				VALUE "OriginalFilename",	PPS(ORG_NAME) "\0"
+				VALUE "InternalName", 		PPS(INTERNAL_NAME) "\0"
+				VALUE "LegalCopyright",		S_CRIGHT " Sun Microsystems, Inc.\0"
 				ADDITIONAL_VERINFO1
 				ADDITIONAL_VERINFO2
 				ADDITIONAL_VERINFO3
 			}
 #else
-			block "040904E4"
+			BLOCK "040904E4"
 			{
 				// International StringTable
-				value "CompanyName", 		"Sun Microsystems, Inc.\0"
-				value "FileVersion",		PPS(VER_LEVEL) "\0"
-				value "OriginalFilename",	PPS(ORG_NAME) "\0"
-				value "InternalName", 		PPS(INTERNAL_NAME) "\0"
-				value "LegalCopyright", 	S_CRIGHT " Sun Microsystems, Inc.\0"
+				VALUE "CompanyName", 		"Sun Microsystems, Inc.\0"
+				VALUE "FileVersion",		PPS(VER_LEVEL) "\0"
+				VALUE "OriginalFilename",	PPS(ORG_NAME) "\0"
+				VALUE "InternalName", 		PPS(INTERNAL_NAME) "\0"
+				VALUE "LegalCopyright", 	S_CRIGHT " Sun Microsystems, Inc.\0"
 				ADDITIONAL_VERINFO1
 				ADDITIONAL_VERINFO2
 				ADDITIONAL_VERINFO3
@@ -145,12 +146,12 @@
 #endif
 		}
 
-		block "VarFileInfo"
+		BLOCK "VarFileInfo"
 		{
 #ifdef LG_D
-			value "Translation", 0x0407, 1252
+			VALUE "Translation", 0x0407, 1252
 #else
-			value "Translation", 0x0409, 1252
+			VALUE "Translation", 0x0409, 1252
 #endif
 		}
 	}
@@ -160,6 +161,6 @@
 {
 	0xF0, "sw", 0x0F, VER_YEAR, VER_MONTH, VER_DAY,
 	VERSION, VERVARIANT, VER_COUNT
-};
+}
 
 #endif // OS2
--- solenv/inc/_tg_shl.mk.pristine	2008-10-29 09:33:25.000000000 +0100
+++ solenv/inc/_tg_shl.mk	2008-10-29 09:33:33.000000000 +0100
@@ -275,7 +275,11 @@
 	@echo $(EMQ)#define INTERNAL_NAME $(SHL1TARGET:b) >> $(MISC)$/$(SHL1DEFAULTRES:b).rc
 	@echo $(EMQ)#include $(EMQ)"shlinfo.rc$(EMQ)" >> $(MISC)$/$(SHL1DEFAULTRES:b).rc
 .ENDIF			# "$(use_shl_versions)" != ""
+.IF "$(CROSS_COMPILING)" == "no"
 	$(RC) -DWIN32 $(INCLUDE) $(RCLINKFLAGS) $(MISC)$/$(SHL1DEFAULTRES:b).rc
+.ELSE # "$(CROSS_COMPILING)" == "yes"
+	$(RC) -DWIN32 $(INCLUDE) $(RCLINKFLAGS) -i $(MISC)$/$(SHL1DEFAULTRES:b).rc -o $(MISC)$/$(SHL1DEFAULTRES:b).res 
+.ENDIF # "$(CROSS_COMPILING)" == "yes"
 .ENDIF			# "$(SHL1DEFAULTRES)"!=""
 .IF "$(SHL1ALLRES)"!=""
 .IF "$(USE_SHELL)"=="4nt"
@@ -283,18 +287,18 @@
 .ELSE			# "$(USE_SHELL)"=="4nt"
 	$(TYPE) $(SHL1ALLRES) > $(SHL1LINKRES)
 .IF "$(COM)"=="GCC"
-	windres $(SHL1LINKRES) $(SHL1LINKRESO)
+	$(WINDRES) $(SHL1LINKRES) $(SHL1LINKRESO)
 .ENDIF			# "$(COM)"=="GCC"
 .ENDIF			# "$(USE_SHELL)"=="4nt"
 .ENDIF			# "$(SHL1ALLRES)"!=""
 .IF "$(COM)"=="GCC"	# always have to call dlltool explicitly as ld cannot handle # comment in .def
 .IF "$(DEFLIB1NAME)"!=""	# do not have to include objs
-	@echo dlltool --input-def $(SHL1DEF) \
+	@echo $(DLLTOOL) --input-def $(SHL1DEF) \
 		--dllname $(SHL1TARGET)$(DLLPOST) \
 		--kill-at \
 		--output-exp $(MISC)$/$(@:b)_exp.o > $(MISC)$/$(TARGET).$(@:b)_1.cmd
 .ELSE			# "$(DEFLIB1NAME)"!=""	# do not have to include objs
-	@echo dlltool --input-def $(SHL1DEF) \
+	@echo $(DLLTOOL) --input-def $(SHL1DEF) \
 		--dllname $(SHL1TARGET)$(DLLPOST) \
 		--kill-at \
 		--output-exp $(MISC)$/$(@:b)_exp.o \
