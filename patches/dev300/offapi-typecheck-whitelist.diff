From 4882b4eadb79b5aa8b14b5460558b4d98debd6d8 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:53:56 +0200
Subject: [PATCH 079/878] offapi-typecheck-whitelist.diff

---
 offapi/util/makefile.mk     |    9 ++++++---
 offapi/util/types-whitelist |    1 +
 2 files changed, 7 insertions(+), 3 deletions(-)
 create mode 100644 offapi/util/types-whitelist

diff --git a/offapi/util/makefile.mk b/offapi/util/makefile.mk
index 3df302b..0c020e9 100644
--- a/offapi/util/makefile.mk
+++ b/offapi/util/makefile.mk
@@ -175,13 +175,16 @@ $(OUT)$/ucrdoc$/types_doc.db : $(OUT)$/ucrdoc$/offapi_doc.db $(SOLARBINDIR)$/udk
 #
 #JSC: i have removed the doc rdb because all type information is already in the
 #     types.rdb, even the service and singleton type info. IDL docu isn't checked.
-$(REGISTRYCHECKFLAG) : $(UCR)$/types.db $(OUT)$/ucrdoc$/types_doc.db
-    $(REGCOMPARE) -f -t -r1 $(REFERENCE_RDB) -r2 $(UCR)$/types.db \
+#
+#Use the types-whitelist to exclude published API from signalling incompatibility.
+#Handle with care.
+$(REGISTRYCHECKFLAG) : $(UCR)$/types.db $(OUT)$/ucrdoc$/types_doc.db types-whitelist
+    $(REGCOMPARE) -f -t -r1 $(REFERENCE_RDB) -r2 $(UCR)$/types.db @types-whitelist \
         && echo > $(REGISTRYCHECKFLAG)
 
 #JSC: new target to prepare some UNO type statistics, the ouput will be later used
 #     for versioning of UNO cli type libraries
-$(UNOTYPE_STATISTICS) : $(REGISTRYCHECKFLAG)
+$(UNOTYPE_STATISTICS) : $(UCR)$/types.db $(OUT)$/ucrdoc$/types_doc.db
     $(AUGMENT_LIBRARY_PATH) $(PERL) checknewapi.pl $(UCR)$/types.db $(REFERENCE_RDB) "$(RSCREVISION)" "$(REGVIEWTOOL)" > $@
 
 .INCLUDE :  target.mk
diff --git a/offapi/util/types-whitelist b/offapi/util/types-whitelist
new file mode 100644
index 0000000..343bede
--- /dev/null
+++ b/offapi/util/types-whitelist
@@ -0,0 +1 @@
+-x /UCR/com/sun/star/drawing/TextFitToSizeType
-- 
1.7.0.1

