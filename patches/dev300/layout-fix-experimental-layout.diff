From 1ffbfcffae44e3937576fafd2ddbdc5ef76f6b1d Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:02:20 +0200
Subject: [PATCH 510/878] layout-fix-experimental-layout.diff

---
 sc/source/ui/attrdlg/scdlgfact.cxx |    8 ++------
 sc/source/ui/attrdlg/scdlgfact.hxx |    5 +++--
 svx/source/cui/numfmt.cxx          |   20 ++++++++------------
 svx/source/cui/numfmt.hxx          |    6 ++++++
 4 files changed, 19 insertions(+), 20 deletions(-)

diff --git a/sc/source/ui/attrdlg/scdlgfact.cxx b/sc/source/ui/attrdlg/scdlgfact.cxx
index 4c13dde..fcc568e 100644
--- a/sc/source/ui/attrdlg/scdlgfact.cxx
+++ b/sc/source/ui/attrdlg/scdlgfact.cxx
@@ -28,10 +28,6 @@
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_sc.hxx"
 
-#if ! ENABLE_LAYOUT_EXPERIMENTAL
-#undef ENABLE_LAYOUT
-#endif
-
 #undef SC_DLLIMPLEMENTATION
 
 #include "scdlgfact.hxx"
@@ -153,7 +149,7 @@ String AbstractTabDialog_Impl::GetText() const
     return pDlg->GetText();
 }
 
-#if ENABLE_LAYOUT
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
 namespace layout
 {
 IMPL_ABSTDLG_BASE(AbstractTabDialog_Impl); //add for ScAttrDlg, ScHFEditDlg, ScStyleDlg, ScSubTotalDlg,ScCharDlg, ScParagraphDlg, ScValidationDlg, ScSortDlg
@@ -188,7 +184,7 @@ String AbstractTabDialog_Impl::GetText() const
     return pDlg->GetText();
 }
 }
-#endif /* ENABLE_LAYOUT */
+#endif /* ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT */
 
 //add for AbstractTabDialog_Impl end
 // AbstractScImportAsciiDlg_Impl begin
diff --git a/sc/source/ui/attrdlg/scdlgfact.hxx b/sc/source/ui/attrdlg/scdlgfact.hxx
index f5a8db5..e9942fb 100644
--- a/sc/source/ui/attrdlg/scdlgfact.hxx
+++ b/sc/source/ui/attrdlg/scdlgfact.hxx
@@ -375,7 +375,8 @@ class AbstractTabDialog_Impl : public SfxAbstractTabDialog
     virtual void		SetText( const XubString& rStr ); //add by CHINA001
     virtual String   	GetText() const; //add by CHINA001
 };
-#if ENABLE_LAYOUT
+
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
 namespace layout
 {
 //add for ScAttrDlg , ScHFEditDlg, ScStyleDlg, ScSubTotalDlg, ScCharDlg, ScParagraphDlg, ScValidationDlg, ScSortDlg
@@ -391,7 +392,7 @@ class AbstractTabDialog_Impl : public SfxAbstractTabDialog
     virtual String   	GetText() const; //add by CHINA001
 };
 } // end namespace layout
-#endif /* ENABLE_LAYOUT */
+#endif /* ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT */
 //------------------------------------------------------------------------
 //AbstractDialogFactory_Impl implementations
 class ScAbstractDialogFactory_Impl : public ScAbstractDialogFactory
diff --git a/svx/source/cui/numfmt.cxx b/svx/source/cui/numfmt.cxx
index 79e94fb..099e107 100644
--- a/svx/source/cui/numfmt.cxx
+++ b/svx/source/cui/numfmt.cxx
@@ -25,10 +25,6 @@
  *
  ************************************************************************/
 
-#if !ENABLE_LAYOUT_EXPERIMENTAL && defined (ENABLE_LAYOUT)
-#undef ENABLE_LAYOUT
-#endif
-
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_svx.hxx"
 
@@ -237,19 +233,19 @@ void SvxNumberPreviewImpl::DataChanged( const DataChangedEvent& rDCEvt )
 
 #define HDL(hdl) LINK( this, SvxNumberFormatTabPage, hdl )
 
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
 #include <layout/layout-pre.hxx>
 
-#if ENABLE_LAYOUT
 #undef SVX_RES
 #define SVX_RES(x) #x
 #define SVX_RES_PLAIN(x) ResId (x, DIALOG_MGR ())
 #define THIS_SVX_RES(x) this, #x
 #undef SfxTabPage
 #define SfxTabPage( parent, id, args ) SfxTabPage( parent, "number-format.xml", id, &args )
-#else /* !ENABLE_LAYOUT */
+#else /* ! ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT */
 #define SVX_RES_PLAIN SVX_RES
 #define THIS_SVX_RES SVX_RES
-#endif /* !ENABLE_LAYOUT */
+#endif /* ! ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT */
 
 SvxNumberFormatTabPage::SvxNumberFormatTabPage( Window*				pParent,
                                                 const SfxItemSet&	rCoreAttrs )
@@ -280,7 +276,7 @@ SvxNumberFormatTabPage::SvxNumberFormatTabPage( Window*				pParent,
         aFtComment      ( this, SVX_RES( FT_COMMENT ) ),
         aEdComment      ( this, SVX_RES( ED_COMMENT ) ),
         
-#if ENABLE_LAYOUT
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
         aWndPreview     ( LAYOUT_THIS_WINDOW(this), SVX_RES_PLAIN( WND_NUMBER_PREVIEW ) ),
 #else
         aWndPreview     ( this, SVX_RES_PLAIN( WND_NUMBER_PREVIEW ) ),
@@ -292,7 +288,7 @@ SvxNumberFormatTabPage::SvxNumberFormatTabPage( Window*				pParent,
         sAutomaticEntry ( THIS_SVX_RES( STR_AUTO_ENTRY)),
         pLastActivWindow( NULL )
 {
-#if ENABLE_LAYOUT
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
     aLbFormat.Clear ();
 #endif /* ENABLE_LAYOUT */
 
@@ -1170,7 +1166,7 @@ void SvxNumberFormatTabPage::UpdateFormatListBox_Impl
             aPos.Y()=nStdFormatY;
             aSize.Height()=nStdFormatHeight;
             aLbFormat.SetPosSizePixel(aPos,aSize);
-#if ENABLE_LAYOUT
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
             aLbCurrency.Disable();
 #else /* !ENABLE_LAYOUT */
             aLbCurrency.Hide();
@@ -1181,7 +1177,7 @@ void SvxNumberFormatTabPage::UpdateFormatListBox_Impl
             aPos.Y()=nCurFormatY;
             aSize.Height()=nCurFormatHeight;
             aLbFormat.SetPosSizePixel(aPos,aSize);
-#if ENABLE_LAYOUT
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
             aLbCurrency.Enable();
 #else /* !ENABLE_LAYOUT */
             aLbCurrency.Show();
@@ -1319,7 +1315,7 @@ IMPL_LINK( SvxNumberFormatTabPage, SelFormatHdl_Impl, void *, pLb )
 
         // Reinit options enable/disable for current selection.
 
-#if ENABLE_LAYOUT
+#if ENABLE_LAYOUT_EXPERIMENTAL && ENABLE_LAYOUT
         if (aLbFormat.GetSelectEntryPos () == LISTBOX_ENTRY_NOTFOUND)
 #else /* !ENABLE_LAYOUT */
         // Current category may be UserDefined with no format entries defined.
diff --git a/svx/source/cui/numfmt.hxx b/svx/source/cui/numfmt.hxx
index 5f2a632..abe24d4 100644
--- a/svx/source/cui/numfmt.hxx
+++ b/svx/source/cui/numfmt.hxx
@@ -92,8 +92,12 @@ public:
 
 // -----------------------------------------------------------------------
 
+#if ENABLE_LAYOUT_EXPERIMENTAL
 #include <sfx2/layout.hxx>
 #include <layout/layout-pre.hxx>
+#else
+#define LocalizedString String
+#endif /* !ENABLE_LAYOUT_EXPERIMENTAL */
 
 class SvxNumberFormatTabPage : public SfxTabPage
 {
@@ -197,7 +201,9 @@ private:
 #endif
 };
 
+#if ENABLE_LAYOUT_EXPERIMENTAL
 #include <layout/layout-post.hxx>
+#endif /* ENABLE_LAYOUT_EXPERIMENTAL */
 
 #endif
 
-- 
1.7.0.1

