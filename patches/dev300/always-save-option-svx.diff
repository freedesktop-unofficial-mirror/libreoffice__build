From ad36e13d3764e10844a250a96cee28795f8a0db5 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:07:38 +0200
Subject: [PATCH 773/878] always-save-option-svx.diff

---
 svx/source/cui/optgdlg.cxx |   18 ++++++++++++++----
 svx/source/cui/optgdlg.hrc |    4 +++-
 svx/source/cui/optgdlg.hxx |    1 +
 svx/source/cui/optgdlg.src |   14 ++++++++++----
 4 files changed, 28 insertions(+), 9 deletions(-)

diff --git a/svx/source/cui/optgdlg.cxx b/svx/source/cui/optgdlg.cxx
index d0d9f85..aebb1a8 100644
--- a/svx/source/cui/optgdlg.cxx
+++ b/svx/source/cui/optgdlg.cxx
@@ -221,6 +221,7 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
     aPrintDlgCB			( this, SVX_RES( CB_PRINTDLG ) ),
     aDocStatusFL		( this, SVX_RES( FL_DOCSTATUS ) ),
     aDocStatusCB		( this, SVX_RES( CB_DOCSTATUS ) ),
+    aSaveAlwaysCB       ( this, SVX_RES( CB_SAVE_ALWAYS ) ),
     aTwoFigureFL		( this, SVX_RES( FL_TWOFIGURE ) ),
     aInterpretFT		( this, SVX_RES( FT_INTERPRET ) ),
     aYearValueField		( this, SVX_RES( NF_YEARVALUE ) ),
@@ -251,7 +252,7 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
 
         Window* pWins[] =
         {
-            &aDocStatusFL, &aDocStatusCB, &aTwoFigureFL,
+            &aDocStatusFL, &aDocStatusCB, &aSaveAlwaysCB, &aTwoFigureFL,
             &aInterpretFT, &aYearValueField, &aToYearFT
         };
         Window** pCurrent = pWins;
@@ -273,8 +274,8 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
 
         Window* pWins[] =
         {
-            &aPrintDlgFL, &aPrintDlgCB, &aDocStatusFL, &aDocStatusCB, &aTwoFigureFL,
-            &aInterpretFT, &aYearValueField, &aToYearFT
+            &aPrintDlgFL, &aPrintDlgCB, &aDocStatusFL, &aDocStatusCB, &aSaveAlwaysCB,
+            &aTwoFigureFL, &aInterpretFT, &aYearValueField, &aToYearFT
         };
         Window** pCurrent = pWins;
         const sal_Int32 nCount = sizeof( pWins ) / sizeof( pWins[ 0 ] );
@@ -299,7 +300,7 @@ OfaMiscTabPage::OfaMiscTabPage(Window* pParent, const SfxItemSet& rSet ) :
 
         Window* pWins[] =
         {
-            &aDocStatusFL, &aDocStatusCB, &aTwoFigureFL,
+            &aDocStatusFL, &aDocStatusCB, &aSaveAlwaysCB, &aTwoFigureFL,
             &aInterpretFT, &aYearValueField, &aToYearFT
         };
         Window** pCurrent = pWins;
@@ -430,6 +431,13 @@ BOOL OfaMiscTabPage::FillItemSet( SfxItemSet& rSet )
         bModified = TRUE;
     }
 
+    if ( aSaveAlwaysCB.IsChecked() != aSaveAlwaysCB.GetSavedValue() )
+    {
+        SvtMiscOptions aMiscOpt;
+        aMiscOpt.SetSaveAlwaysAllowed( aSaveAlwaysCB.IsChecked() );
+        bModified = TRUE;
+    }
+
     const SfxUInt16Item* pUInt16Item =
         PTR_CAST( SfxUInt16Item, GetOldItem( rSet, SID_ATTR_YEAR2000 ) );
     USHORT nNum = (USHORT)aYearValueField.GetText().ToInt32();
@@ -471,6 +479,8 @@ void OfaMiscTabPage::Reset( const SfxItemSet& rSet )
     aFileDlgCB.SaveValue();
     aPrintDlgCB.Check( !aMiscOpt.UseSystemPrintDialog() );
     aPrintDlgCB.SaveValue();
+    aSaveAlwaysCB.Check( aMiscOpt.IsSaveAlwaysAllowed() );
+    aSaveAlwaysCB.SaveValue();
 
     aODMADlgCB.Check( aMiscOpt.TryODMADialog() );
     aODMADlgCB.SaveValue();
diff --git a/svx/source/cui/optgdlg.hrc b/svx/source/cui/optgdlg.hrc
index fd4e059..4f4c87f 100644
--- a/svx/source/cui/optgdlg.hrc
+++ b/svx/source/cui/optgdlg.hrc
@@ -56,7 +56,8 @@
 #define ROW9					(ROW8+RSC_CD_CHECKBOX_HEIGHT+ROWSPACE)
 #define ROW10					(ROW9+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
 #define ROW11					(ROW10+RSC_CD_CHECKBOX_HEIGHT+ROWSPACE)
-#define ROW12					(ROW11+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
+#define ROW12					(ROW11+RSC_CD_CHECKBOX_HEIGHT+ROWSPACE)
+#define ROW13					(ROW12+RSC_CD_FIXEDLINE_HEIGHT+ROWSPACE)
 
 #define DIFF(v1,v2)						(v2-v1)
 #define OFFS_TEXTBOX_FIXEDTEXT(base)	(base+(RSC_CD_TEXTBOX_HEIGHT-RSC_CD_FIXEDTEXT_HEIGHT)/2)
@@ -201,6 +202,7 @@
 #define FL_DOCSTATUS                60
 #define CB_DOCSTATUS                61
 #define CB_ODMADLG                  62
+#define CB_SAVE_ALWAYS              74
 #endif // #ifndef _SVX_OPTGDLG_HRC
 
 // ******************************************************************* EOF
diff --git a/svx/source/cui/optgdlg.hxx b/svx/source/cui/optgdlg.hxx
index 89ab8cd..fb1f34f 100644
--- a/svx/source/cui/optgdlg.hxx
+++ b/svx/source/cui/optgdlg.hxx
@@ -63,6 +63,7 @@ private:
 
     FixedLine           aDocStatusFL;
     CheckBox            aDocStatusCB;
+    CheckBox            aSaveAlwaysCB;
 
     FixedLine           aTwoFigureFL;
     FixedText			aInterpretFT;
diff --git a/svx/source/cui/optgdlg.src b/svx/source/cui/optgdlg.src
index d0e84df..b41b206 100644
--- a/svx/source/cui/optgdlg.src
+++ b/svx/source/cui/optgdlg.src
@@ -131,22 +131,28 @@ TabPage OFA_TP_MISC
         Size = MAP_APPFONT( WHOLE_WIDTH - COL1, RSC_CD_CHECKBOX_HEIGHT );
         Text [ en-US ] = "~Printing sets \"document modified\" status";
     };
+    CheckBox CB_SAVE_ALWAYS
+    {
+        Pos = MAP_APPFONT( COL1, ROW11 );
+        Size = MAP_APPFONT( WHOLE_WIDTH - COL1, RSC_CD_CHECKBOX_HEIGHT );
+        Text [ en-US ] = "Allow to save document even when the document is not modified";
+    };
     FixedLine FL_TWOFIGURE
     {
-        Pos = MAP_APPFONT( COL0, ROW11 );
+        Pos = MAP_APPFONT( COL0, ROW12 );
         Size = MAP_APPFONT( WHOLE_WIDTH, RSC_CD_FIXEDLINE_HEIGHT );
         Text [ en-US ] = "Year (two digits)" ;
     };
     FixedText FT_INTERPRET
     {
-        Pos = MAP_APPFONT( COL1, OFFS_TEXTBOX_FIXEDTEXT(ROW12) );
+        Pos = MAP_APPFONT( COL1, OFFS_TEXTBOX_FIXEDTEXT(ROW13) );
         Size = MAP_APPFONT( DIFF( COL1, COL3), RSC_CD_FIXEDTEXT_HEIGHT );
         Text [ en-US ] = "Interpret as years between";
     };
     NumericField NF_YEARVALUE
     {
         Border = TRUE ;
-        Pos = MAP_APPFONT( COL4, ROW12 );
+        Pos = MAP_APPFONT( COL4, ROW13 );
         Size = MAP_APPFONT( EDIT_WIDTH, RSC_CD_TEXTBOX_HEIGHT );
         Minimum = 1583 ;
         Maximum = 9857 ;
@@ -155,7 +161,7 @@ TabPage OFA_TP_MISC
     };
     FixedText FT_TOYEAR
     {
-        Pos = MAP_APPFONT( COL6, OFFS_TEXTBOX_FIXEDTEXT(ROW12) );
+        Pos = MAP_APPFONT( COL6, OFFS_TEXTBOX_FIXEDTEXT(ROW13) );
         Size = MAP_APPFONT( WHOLE_WIDTH - COL6, RSC_CD_FIXEDTEXT_HEIGHT );
         Text [ en-US ] = "and " ;
     };
-- 
1.7.0.1

