From 4ed18602eb01841d1942db4f5e36b172f93fd572 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:54:11 +0200
Subject: [PATCH 092/878] buildfix-fmtargs.diff

---
 cpputools/source/unoexe/unoexe.cxx            |    4 ++--
 extensions/source/logging/consolehandler.cxx  |    4 ++--
 fpicker/source/unx/gnome/SalGtkFilePicker.cxx |    2 +-
 icc/makefile.mk                               |    2 +-
 icc/mdv-fmtargs-buildfix.patch                |   20 ++++++++++++++++++++
 rsc/source/prj/start.cxx                      |    2 +-
 svtools/bmpmaker/bmp.cxx                      |    2 +-
 svtools/bmpmaker/bmpsum.cxx                   |    2 +-
 svtools/bmpmaker/g2g.cxx                      |    2 +-
 vcl/source/fontsubset/sft.cxx                 |   16 ++++++++--------
 vcl/unx/source/plugadapt/salplug.cxx          |    2 +-
 11 files changed, 39 insertions(+), 19 deletions(-)
 create mode 100644 icc/mdv-fmtargs-buildfix.patch

diff --git a/cpputools/source/unoexe/unoexe.cxx b/cpputools/source/unoexe/unoexe.cxx
index 424ce27..18f491c 100644
--- a/cpputools/source/unoexe/unoexe.cxx
+++ b/cpputools/source/unoexe/unoexe.cxx
@@ -131,7 +131,7 @@ static sal_Bool s_quiet = false;
 static inline void out( const sal_Char * pText )
 {
     if (! s_quiet)
-        fprintf( stderr, pText );
+        fprintf( stderr, "%s", pText );
 }
 //--------------------------------------------------------------------------------------------------
 static inline void out( const OUString & rText )
@@ -139,7 +139,7 @@ static inline void out( const OUString & rText )
     if (! s_quiet)
     {
         OString aText( OUStringToOString( rText, RTL_TEXTENCODING_ASCII_US ) );
-        fprintf( stderr, aText.getStr() );
+        fprintf( stderr, "%s", aText.getStr() );
     }
 }
 
diff --git a/extensions/source/logging/consolehandler.cxx b/extensions/source/logging/consolehandler.cxx
index 0815040..424ddc5 100644
--- a/extensions/source/logging/consolehandler.cxx
+++ b/extensions/source/logging/consolehandler.cxx
@@ -249,9 +249,9 @@ namespace logging
             return sal_False;
 
         if ( _rRecord.Level >= m_nThreshold )
-            fprintf( stderr, sEntry.getStr() );
+            fprintf( stderr, "%s", sEntry.getStr() );
         else
-            fprintf( stdout, sEntry.getStr() );
+            fprintf( stdout, "%s", sEntry.getStr() );
 
         return sal_True;
     }
diff --git a/fpicker/source/unx/gnome/SalGtkFilePicker.cxx b/fpicker/source/unx/gnome/SalGtkFilePicker.cxx
index 5148b97..e10081e 100644
--- a/fpicker/source/unx/gnome/SalGtkFilePicker.cxx
+++ b/fpicker/source/unx/gnome/SalGtkFilePicker.cxx
@@ -1058,7 +1058,7 @@ sal_Int16 SAL_CALL SalGtkFilePicker::execute() throw( uno::RuntimeException )
                                 GTK_DIALOG_MODAL,
                                 GTK_MESSAGE_QUESTION,
                                 GTK_BUTTONS_YES_NO,
-                                  OUStringToOString(
+                                  "\"%s\"", OUStringToOString(
                                     aResProvider.getResString( FILE_PICKER_OVERWRITE ),
                                     RTL_TEXTENCODING_UTF8 ).getStr() );
 
diff --git a/icc/makefile.mk b/icc/makefile.mk
index ab010ac..19ba44c 100644
--- a/icc/makefile.mk
+++ b/icc/makefile.mk
@@ -45,7 +45,7 @@ CONVERTFILES= \
     Contrib$/ICC_utils$/Stubs.h \
     Contrib$/ICC_utils$/Vetters.cpp
 
-CONFIGURE_ACTION= $(GNUCOPY) -r $(BACK_PATH)..$/source$/create_sRGB_profile Contrib$/CmdLine && unzip -o $(BACK_PATH)..$/makefiles.zip
+CONFIGURE_ACTION= $(GNUCOPY) -r $(BACK_PATH)..$/source$/create_sRGB_profile Contrib$/CmdLine && unzip -o $(BACK_PATH)..$/makefiles.zip && patch -p0 < $(BACK_PATH)..$/mdv-fmtargs-buildfix.patch
 BUILD_ACTION=dmake &&  cd Contrib$/CmdLine$/create_sRGB_profile && $(AUGMENT_LIBRARY_PATH) .$/create_sRGB_profile
 
 # --- Targets ------------------------------------------------------
diff --git a/icc/mdv-fmtargs-buildfix.patch b/icc/mdv-fmtargs-buildfix.patch
new file mode 100644
index 0000000..5774e36
--- /dev/null
+++ b/icc/mdv-fmtargs-buildfix.patch
@@ -0,0 +1,20 @@
+--- IccProfLib/IccProfile.cpp  2009-01-20 11:48:36.000000000 -0500
++++ IccProfile.cpp     2009-01-19 14:41:23.000000000 -0500
+@@ -1155,7 +1155,7 @@
+
+   CIccInfo Info;
+   icChar buf[128];
+-  sprintf(buf, Info.GetSigName(m_Header.deviceClass));
++  sprintf(buf, "%s", Info.GetSigName(m_Header.deviceClass));
+   if (m_Header.deviceClass!=icSigInputClass && m_Header.deviceClass!=icSigDisplayClass) {
+     if (GetTag(icSigGrayTRCTag) || GetTag(icSigRedTRCTag) || GetTag(icSigGreenTRCTag) ||
+        GetTag(icSigBlueTRCTag) || GetTag(icSigRedColorantTag) || GetTag(icSigGreenColorantTag) ||
+@@ -1230,7 +1230,7 @@
+   for (i=m_Tags->begin(); i!=m_Tags->end(); i++) {
+     tagsig = i->TagInfo.sig;
+     typesig = i->pTag->GetType();
+-    sprintf(buf, Info.GetSigName(tagsig));
++    sprintf(buf, "%s", Info.GetSigName(tagsig));
+     if (!IsTypeValid(tagsig, typesig)) {
+       sReport += icValidateNonCompliantMsg;
+       sReport += buf;
diff --git a/rsc/source/prj/start.cxx b/rsc/source/prj/start.cxx
index 68405fc..c40ed77 100644
--- a/rsc/source/prj/start.cxx
+++ b/rsc/source/prj/start.cxx
@@ -241,7 +241,7 @@ static BOOL CallRsc2( ByteString aRsc2Name,
 #ifdef OS2
         fprintf( fRspFile, "%s\n", aSrsName.GetBuffer() );
 #else
-        fprintf( fRspFile, aSrsName.GetBuffer() );
+        fprintf( fRspFile, "%s", aSrsName.GetBuffer() );
 #endif
 
         pString = pInputList->First();
diff --git a/svtools/bmpmaker/bmp.cxx b/svtools/bmpmaker/bmp.cxx
index e44dd05..b3cf1d9 100644
--- a/svtools/bmpmaker/bmp.cxx
+++ b/svtools/bmpmaker/bmp.cxx
@@ -161,7 +161,7 @@ void BmpApp::Message( const String& rText, BYTE cExit )
 
     ByteString aText( rText, RTL_TEXTENCODING_UTF8 );
     aText.Append( "\r\n" );
-    fprintf( stderr, aText.GetBuffer() );
+    fprintf( stderr, "%s", aText.GetBuffer() );
 }
 
 // -----------------------------------------------------------------------------
diff --git a/svtools/bmpmaker/bmpsum.cxx b/svtools/bmpmaker/bmpsum.cxx
index 0a6d680..83aa821 100644
--- a/svtools/bmpmaker/bmpsum.cxx
+++ b/svtools/bmpmaker/bmpsum.cxx
@@ -167,7 +167,7 @@ void BmpSum::Message( const String& rText, BYTE nExitCode )
 
     ByteString aText( rText, RTL_TEXTENCODING_UTF8 );
     aText.Append( "\r\n" );
-    fprintf( stderr, aText.GetBuffer() );
+    fprintf( stderr, "%s", aText.GetBuffer() );
 }
 
 // -----------------------------------------------------------------------------
diff --git a/svtools/bmpmaker/g2g.cxx b/svtools/bmpmaker/g2g.cxx
index 68aeb01..1843b1f 100644
--- a/svtools/bmpmaker/g2g.cxx
+++ b/svtools/bmpmaker/g2g.cxx
@@ -125,7 +125,7 @@ void G2GApp::Message( const String& rText, BYTE nExitCode )
 
     ByteString aText( rText, RTL_TEXTENCODING_UTF8 );
     aText.Append( "\r\n" );
-    fprintf( stderr, aText.GetBuffer() );
+    fprintf( stderr, "%s", aText.GetBuffer() );
 }
 
 // -----------------------------------------------------------------------------
diff --git a/vcl/source/fontsubset/sft.cxx b/vcl/source/fontsubset/sft.cxx
index b0cf48f..60dc461 100644
--- a/vcl/source/fontsubset/sft.cxx
+++ b/vcl/source/fontsubset/sft.cxx
@@ -2045,7 +2045,7 @@ int  CreateT3FromTTGlyphs(TrueTypeFont *ttf, FILE *outf, const char *fname, /*FO
     fprintf(outf, h02, modname, modver, modextra);
     fprintf(outf, h09, ttf->psname);
 
-    fprintf(outf, h10);
+    fprintf(outf, "%s", h10);
     fprintf(outf, h11, fname);
 /*    fprintf(outf, h12, 4000000); */
 
@@ -2060,17 +2060,17 @@ int  CreateT3FromTTGlyphs(TrueTypeFont *ttf, FILE *outf, const char *fname, /*FO
      */
 
     fprintf(outf, h17, rtl_crc32(0, ttf->ptr, ttf->fsize), nGlyphs, rtl_crc32(0, glyphArray, nGlyphs * 2), rtl_crc32(0, encoding, nGlyphs));
-    fprintf(outf, h13);
+    fprintf(outf, "%s", h13);
     fprintf(outf, h14, XUnits(UPEm, GetInt16(table, 36, 1)), XUnits(UPEm, GetInt16(table, 38, 1)), XUnits(UPEm, GetInt16(table, 40, 1)), XUnits(UPEm, GetInt16(table, 42, 1)));
-    fprintf(outf, h15);
+    fprintf(outf, "%s", h15);
 
     for (i = 0; i < nGlyphs; i++) {
         fprintf(outf, h16, encoding[i], i);
     }
 
     fprintf(outf, h30, nGlyphs+1);
-    fprintf(outf, h31);
-    fprintf(outf, h32);
+    fprintf(outf, "%s", h31);
+    fprintf(outf, "%s", h32);
 
     for (i = 0; i < nGlyphs; i++) {
         fprintf(outf, h33, i);
@@ -2118,14 +2118,14 @@ int  CreateT3FromTTGlyphs(TrueTypeFont *ttf, FILE *outf, const char *fname, /*FO
         }
         if (n > 0) fprintf(outf, "\tfill\n");     /* if glyph is not a whitespace character */
 
-        fprintf(outf, h34);
+        fprintf(outf, "%s", h34);
 
         free(pa);
         free(path);
     }
-    fprintf(outf, h35);
+    fprintf(outf, "%s", h35);
 
-    fprintf(outf, h40);
+    fprintf(outf, "%s", h40);
     fprintf(outf, h41, fname);
 
     return SF_OK;
diff --git a/vcl/unx/source/plugadapt/salplug.cxx b/vcl/unx/source/plugadapt/salplug.cxx
index 4f3fe43..872d136 100644
--- a/vcl/unx/source/plugadapt/salplug.cxx
+++ b/vcl/unx/source/plugadapt/salplug.cxx
@@ -260,7 +260,7 @@ void SalAbort( const XubString& rErrorText )
     if( !rErrorText.Len() )
         std::fprintf( stderr, "Application Error" );
     else
-        std::fprintf( stderr, ByteString( rErrorText, gsl_getSystemTextEncoding() ).GetBuffer() );
+        std::fprintf( stderr, "%s", ByteString( rErrorText, gsl_getSystemTextEncoding() ).GetBuffer() );
     abort();
 }
 
-- 
1.7.0.1

