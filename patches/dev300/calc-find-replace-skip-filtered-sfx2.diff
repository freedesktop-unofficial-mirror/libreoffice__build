From cd3bf48fefe72e9da0ff21f6c55d9fb7920b1585 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:56:17 +0200
Subject: [PATCH 201/878] calc-find-replace-skip-filtered-sfx2.diff

---
 sfx2/inc/sfx2/sfxsids.hrc        |   29 +++++++++++++++--------------
 sfx2/inc/sfx2/srchitem.hxx       |    4 ++++
 sfx2/source/control/srchitem.cxx |   17 ++++++++++++++++-
 3 files changed, 35 insertions(+), 15 deletions(-)

diff --git a/sfx2/inc/sfx2/sfxsids.hrc b/sfx2/inc/sfx2/sfxsids.hrc
index f840813..f1640e0 100644
--- a/sfx2/inc/sfx2/sfxsids.hrc
+++ b/sfx2/inc/sfx2/sfxsids.hrc
@@ -1292,20 +1292,21 @@
 #define MID_SEARCH_CELLTYPE             2
 #define MID_SEARCH_ROWDIRECTION         3
 #define MID_SEARCH_ALLTABLES            4
-#define MID_SEARCH_BACKWARD             5
-#define MID_SEARCH_PATTERN              6
-#define MID_SEARCH_CONTENT              7
-#define MID_SEARCH_ASIANOPTIONS         8
-#define MID_SEARCH_ALGORITHMTYPE        9
-#define MID_SEARCH_FLAGS                10
-#define MID_SEARCH_SEARCHSTRING         11
-#define MID_SEARCH_REPLACESTRING        12
-#define MID_SEARCH_LOCALE               13
-#define MID_SEARCH_CHANGEDCHARS         14
-#define MID_SEARCH_DELETEDCHARS         15
-#define MID_SEARCH_INSERTEDCHARS        16
-#define MID_SEARCH_TRANSLITERATEFLAGS   17
-#define MID_SEARCH_COMMAND          	18
+#define MID_SEARCH_SEARCHFILTERED       5
+#define MID_SEARCH_BACKWARD             6
+#define MID_SEARCH_PATTERN              7
+#define MID_SEARCH_CONTENT              8
+#define MID_SEARCH_ASIANOPTIONS         9
+#define MID_SEARCH_ALGORITHMTYPE        10
+#define MID_SEARCH_FLAGS                11
+#define MID_SEARCH_SEARCHSTRING         12
+#define MID_SEARCH_REPLACESTRING        13
+#define MID_SEARCH_LOCALE               14
+#define MID_SEARCH_CHANGEDCHARS         15
+#define MID_SEARCH_DELETEDCHARS         16
+#define MID_SEARCH_INSERTEDCHARS        17
+#define MID_SEARCH_TRANSLITERATEFLAGS   18
+#define MID_SEARCH_COMMAND          	19
 
 // SvxSizeItem
 #define MID_SIZE_SIZE       0
diff --git a/sfx2/inc/sfx2/srchitem.hxx b/sfx2/inc/sfx2/srchitem.hxx
index 0249691..6bca4d2 100644
--- a/sfx2/inc/sfx2/srchitem.hxx
+++ b/sfx2/inc/sfx2/srchitem.hxx
@@ -82,6 +82,7 @@ class SFX2_DLLPUBLIC SvxSearchItem :
     sal_uInt16		nAppFlag;   		// Fuer welche Applikation ist der Dialog ueberhaupt
     sal_Bool		bRowDirection;		// Suchrichtung Zeilenweise/Spaltenweise
     sal_Bool		bAllTables;			// in alle Tabellen suchen
+    sal_Bool        bSearchFiltered;      // search filtered cells.
 
     // Writer-spezifisch
     sal_Bool		bNotes;
@@ -150,6 +151,9 @@ public:
             sal_Bool		IsAllTables() const { return bAllTables; }
             void			SetAllTables(sal_Bool bNew) { bAllTables = bNew; }
 
+            sal_Bool        IsSearchFiltered() const { return bSearchFiltered; }
+            void            SetSearchFiltered(sal_Bool b) { bSearchFiltered = b; }
+
             sal_uInt16		GetCellType() const { return nCellType; }
             void			SetCellType(sal_uInt16 nNewCellType) { nCellType = nNewCellType; }
 
diff --git a/sfx2/source/control/srchitem.cxx b/sfx2/source/control/srchitem.cxx
index 7f21350..14abf4a 100644
--- a/sfx2/source/control/srchitem.cxx
+++ b/sfx2/source/control/srchitem.cxx
@@ -64,7 +64,7 @@ using namespace com::sun::star::util;
 
 #define CFG_ROOT_NODE       "Office.Common/SearchOptions"
 
-#define SRCH_PARAMS         11
+#define SRCH_PARAMS         12
 #define SRCH_PARA_OPTIONS   "Options"
 #define SRCH_PARA_FAMILY    "Family"
 #define SRCH_PARA_COMMAND   "Command"
@@ -72,6 +72,7 @@ using namespace com::sun::star::util;
 #define SRCH_PARA_APPFLAG   "AppFlag"
 #define SRCH_PARA_ROWDIR    "RowDirection"
 #define SRCH_PARA_ALLTABLES "AllTables"
+#define SRCH_PARA_SEARCHFILTERED "SearchFiltered"
 #define SRCH_PARA_BACKWARD  "Backward"
 #define SRCH_PARA_PATTERN   "Pattern"
 #define SRCH_PARA_CONTENT   "Content"
@@ -137,6 +138,7 @@ SvxSearchItem::SvxSearchItem( const sal_uInt16 nId ) :
     nAppFlag		( SVX_SEARCHAPP_WRITER ),
     bRowDirection	( sal_True ),
     bAllTables		( sal_False ),
+    bSearchFiltered   ( sal_False ),
     bNotes			( sal_False),
     bBackward		( sal_False ),
     bPattern		( sal_False ),
@@ -214,6 +216,7 @@ SvxSearchItem::SvxSearchItem( const SvxSearchItem& rItem ) :
     nAppFlag		( rItem.nAppFlag ),
     bRowDirection	( rItem.bRowDirection ),
     bAllTables		( rItem.bAllTables ),
+    bSearchFiltered   ( rItem.bSearchFiltered ),
     bNotes			( rItem.bNotes),
     bBackward		( rItem.bBackward ),
     bPattern		( rItem.bPattern ),
@@ -263,6 +266,7 @@ int SvxSearchItem::operator==( const SfxPoolItem& rItem ) const
            ( eFamily 		== rSItem.eFamily )			&&
            ( bRowDirection 	== rSItem.bRowDirection )	&&
            ( bAllTables 	== rSItem.bAllTables )		&&
+           ( bSearchFiltered  == rSItem.bSearchFiltered )   &&
            ( nCellType 		== rSItem.nCellType )		&&
            ( nAppFlag 		== rSItem.nAppFlag )		&&
            ( bAsianOptions	== rSItem.bAsianOptions )	&&
@@ -453,6 +457,8 @@ sal_Bool SvxSearchItem::QueryValue( com::sun::star::uno::Any& rVal, BYTE nMember
             aSeq[5].Value <<= bRowDirection;
             aSeq[6].Name = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SRCH_PARA_ALLTABLES ));
             aSeq[6].Value <<= bAllTables;
+            aSeq[6].Name = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SRCH_PARA_SEARCHFILTERED ));
+            aSeq[6].Value <<= bSearchFiltered;
             aSeq[7].Name = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SRCH_PARA_BACKWARD ));
             aSeq[7].Value <<= bBackward;
             aSeq[8].Name = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( SRCH_PARA_PATTERN ));
@@ -474,6 +480,8 @@ sal_Bool SvxSearchItem::QueryValue( com::sun::star::uno::Any& rVal, BYTE nMember
             rVal <<= (sal_Bool) bRowDirection; break;
         case MID_SEARCH_ALLTABLES:
             rVal <<= (sal_Bool) bAllTables; break;
+        case MID_SEARCH_SEARCHFILTERED:
+            rVal <<= (sal_Bool) bSearchFiltered; break;
         case MID_SEARCH_BACKWARD:
             rVal <<= (sal_Bool) bBackward; break;
         case MID_SEARCH_PATTERN:
@@ -573,6 +581,11 @@ sal_Bool SvxSearchItem::PutValue( const com::sun::star::uno::Any& rVal, BYTE nMe
                         if ( ( aSeq[i].Value >>= bAllTables ) == sal_True )
                             ++nConvertedCount;
                     }
+                    else if ( aSeq[i].Name.equalsAscii( SRCH_PARA_SEARCHFILTERED ) )
+                    {
+                        if ( ( aSeq[i].Value >>= bSearchFiltered ) == sal_True )
+                            ++nConvertedCount;
+                    }
                     else if ( aSeq[i].Name.equalsAscii( SRCH_PARA_BACKWARD ) )
                     {
                         if ( ( aSeq[i].Value >>= bBackward ) == sal_True )
@@ -609,6 +622,8 @@ sal_Bool SvxSearchItem::PutValue( const com::sun::star::uno::Any& rVal, BYTE nMe
             bRet = (rVal >>= bRowDirection); break;
         case MID_SEARCH_ALLTABLES:
             bRet = (rVal >>= bAllTables); break;
+        case MID_SEARCH_SEARCHFILTERED:
+            bRet = (rVal >>= bSearchFiltered); break;
         case MID_SEARCH_BACKWARD:
             bRet = (rVal >>= bBackward); break;
         case MID_SEARCH_PATTERN:
-- 
1.7.0.1

