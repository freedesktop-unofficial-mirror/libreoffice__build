From 9bafad8f79e4e197fc2687767c598acaef0f92de Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:56:58 +0200
Subject: [PATCH 237/878] calc-perf-page-and-manual-breaks-fwd-iterator.diff

---
 sc/source/core/data/table5.cxx |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/sc/source/core/data/table5.cxx b/sc/source/core/data/table5.cxx
index 74af167..8eb21c6 100644
--- a/sc/source/core/data/table5.cxx
+++ b/sc/source/core/data/table5.cxx
@@ -200,10 +200,14 @@ void ScTable::UpdatePageBreaks( const ScRange* pUserArea )
     BOOL bRepeatRow = ( nRepeatStartY != SCROW_REPEAT_NONE );
     BOOL bRowFound = FALSE;
     long nSizeY = 0;
+    ScFlatBoolRowSegments::ForwardIterator aIter(*mpHiddenRows);
     for (SCROW nY = nStartRow; nY <= nEndRow; ++nY)
     {
         BOOL bStartOfPage = FALSE;
-        long nThisY = RowHidden(nY) ? 0 : pRowHeight->GetValue(nY);
+        bool bThisRowHidden = false;
+        aIter.getValue(nY, bThisRowHidden);
+        long nThisY = bThisRowHidden ? 0 : pRowHeight->GetValue(nY);
+
         bool bManualBreak = HasRowManualBreak(nY);
         if ( (nSizeY+nThisY > nPageSizeY) || (bManualBreak && !bSkipBreaks) )
         {
-- 
1.7.0.1

