From 30fdc505da336612267de09035d0b7c802ad9100 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:09:34 +0200
Subject: [PATCH 874/878] oox-import-helper-debug-dump.diff

---
 oox/inc/oox/drawingml/textliststyle.hxx           |    4 ++++
 oox/inc/oox/drawingml/textparagraphproperties.hxx |    4 ++++
 oox/inc/oox/helper/propertymap.hxx                |    1 +
 oox/inc/oox/helper/propertyset.hxx                |    4 ++++
 oox/source/drawingml/textliststyle.cxx            |   11 +++++++++++
 oox/source/helper/propertymap.cxx                 |   11 ++++++++---
 oox/source/helper/propertyset.cxx                 |    7 +++++++
 7 files changed, 39 insertions(+), 3 deletions(-)

diff --git a/oox/inc/oox/drawingml/textliststyle.hxx b/oox/inc/oox/drawingml/textliststyle.hxx
index 6ba4cdf..1a8fca4 100644
--- a/oox/inc/oox/drawingml/textliststyle.hxx
+++ b/oox/inc/oox/drawingml/textliststyle.hxx
@@ -50,6 +50,10 @@ public:
     inline const TextParagraphPropertiesVector& getAggregationListStyle() const { return maAggregationListStyle; };
     inline TextParagraphPropertiesVector&       getAggregationListStyle() { return maAggregationListStyle; };
 
+#if OSL_DEBUG_LEVEL > 0
+    void dump( int nLevels=9 );
+#endif
+
 protected:
 
     TextParagraphPropertiesVector maListStyle;
diff --git a/oox/inc/oox/drawingml/textparagraphproperties.hxx b/oox/inc/oox/drawingml/textparagraphproperties.hxx
index f79280a..a490444 100644
--- a/oox/inc/oox/drawingml/textparagraphproperties.hxx
+++ b/oox/inc/oox/drawingml/textparagraphproperties.hxx
@@ -112,6 +112,10 @@ public:
         size can be zero and the default value is returned. */
     float                               getCharHeightPoints( float fDefault ) const;
 
+#if OSL_DEBUG_LEVEL > 0
+    void dump() { maTextParagraphPropertyMap.dump(); OSL_TRACE("character height: %f", maTextCharacterProperties.getCharHeightPoints(-1)); }
+#endif
+
 protected:
 
     TextCharacterProperties         maTextCharacterProperties;
diff --git a/oox/inc/oox/helper/propertymap.hxx b/oox/inc/oox/helper/propertymap.hxx
index b6dd7ed..150f5c3 100644
--- a/oox/inc/oox/helper/propertymap.hxx
+++ b/oox/inc/oox/helper/propertymap.hxx
@@ -90,6 +90,7 @@ public:
                         makePropertySet() const;
 
 #if OSL_DEBUG_LEVEL > 0
+  static void dump( ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet > rXPropSet);
   void dump();
 #endif
 
diff --git a/oox/inc/oox/helper/propertyset.hxx b/oox/inc/oox/helper/propertyset.hxx
index bdb81c6..1800775 100644
--- a/oox/inc/oox/helper/propertyset.hxx
+++ b/oox/inc/oox/helper/propertyset.hxx
@@ -123,6 +123,10 @@ public:
         @param rPropertyMap  The property map. */
     void                setProperties( const PropertyMap& rPropertyMap );
 
+#if OSL_DEBUG_LEVEL > 0
+    void dump();
+#endif
+
     // ------------------------------------------------------------------------
 private:
     /** Gets the specified property from the property set.
diff --git a/oox/source/drawingml/textliststyle.cxx b/oox/source/drawingml/textliststyle.cxx
index 5d01a28..07a71c0 100644
--- a/oox/source/drawingml/textliststyle.cxx
+++ b/oox/source/drawingml/textliststyle.cxx
@@ -65,4 +65,15 @@ void TextListStyle::apply( const TextListStyle& rTextListStyle )
     applyStyleList( rTextListStyle.getListStyle(), getListStyle() );
 }
 
+#if OSL_DEBUG_LEVEL > 0
+void TextListStyle::dump( int nLevels )
+{
+    for ( int i = 0; i < nLevels; i++ )
+    {
+    OSL_TRACE("level: %d", i);
+        maListStyle[ i ]->dump();
+    }
+}
+#endif
+
 } }
diff --git a/oox/source/helper/propertymap.cxx b/oox/source/helper/propertymap.cxx
index e9c379c..58e2d27 100644
--- a/oox/source/helper/propertymap.cxx
+++ b/oox/source/helper/propertymap.cxx
@@ -242,13 +242,13 @@ Reference< XPropertySet > PropertyMap::makePropertySet() const
 }
 
 #if OSL_DEBUG_LEVEL > 0
-void PropertyMap::dump()
+void PropertyMap::dump( Reference< XPropertySet > rXPropSet )
 {
-  Reference< XPropertySet > rXPropSet( makePropertySet(), UNO_QUERY );
-
     Reference< XPropertySetInfo > info = rXPropSet->getPropertySetInfo ();
     Sequence< beans::Property > props = info->getProperties ();
 
+    OSL_TRACE("dump props, len: %d", props.getLength ());
+
     for (int i=0; i < props.getLength (); i++) {
         OString name = OUStringToOString( props [i].Name, RTL_TEXTENCODING_UTF8);
         fprintf (stderr,"%30s = ", name.getStr() );
@@ -294,6 +294,11 @@ void PropertyMap::dump()
     }
     }
 }
+
+void PropertyMap::dump()
+{
+    dump( Reference< XPropertySet >( makePropertySet(), UNO_QUERY ) );
+}
 #endif
 
 // ============================================================================
diff --git a/oox/source/helper/propertyset.cxx b/oox/source/helper/propertyset.cxx
index 5477224..4d8d7bd 100644
--- a/oox/source/helper/propertyset.cxx
+++ b/oox/source/helper/propertyset.cxx
@@ -168,6 +168,13 @@ void PropertySet::setAnyProperty( const OUString& rPropName, const Any& rValue )
     }
 }
 
+#if OSL_DEBUG_LEVEL > 0
+void PropertySet::dump()
+{
+    PropertyMap::dump( Reference< XPropertySet >( getXPropertySet(), UNO_QUERY ) );
+}
+#endif
+
 // ============================================================================
 
 } // namespace oox
-- 
1.7.0.1

