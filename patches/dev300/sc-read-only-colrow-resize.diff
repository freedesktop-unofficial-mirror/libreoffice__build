From 3fbae1f18303cee496bffadead2610a3915e6aa4 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:21 +0200
Subject: [PATCH 153/878] sc-read-only-colrow-resize.diff

---
 sc/source/ui/view/colrowba.cxx |    6 ++----
 sc/source/ui/view/viewfunc.cxx |    6 +++++-
 2 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/sc/source/ui/view/colrowba.cxx b/sc/source/ui/view/colrowba.cxx
index afec89f..3cd53b1 100644
--- a/sc/source/ui/view/colrowba.cxx
+++ b/sc/source/ui/view/colrowba.cxx
@@ -215,8 +215,7 @@ BOOL ScColBar::IsDisabled()
 
 BOOL ScColBar::ResizeAllowed()
 {
-    return !pViewData->HasEditView( pViewData->GetActivePart() ) &&
-            !pViewData->GetDocShell()->IsReadOnly();
+    return !pViewData->HasEditView( pViewData->GetActivePart() );
 }
 
 void ScColBar::DrawInvert( long nDragPosP )
@@ -381,8 +380,7 @@ BOOL ScRowBar::IsDisabled()
 
 BOOL ScRowBar::ResizeAllowed()
 {
-    return !pViewData->HasEditView( pViewData->GetActivePart() ) &&
-            !pViewData->GetDocShell()->IsReadOnly();
+    return !pViewData->HasEditView( pViewData->GetActivePart() );
 }
 
 void ScRowBar::DrawInvert( long nDragPosP )
diff --git a/sc/source/ui/view/viewfunc.cxx b/sc/source/ui/view/viewfunc.cxx
index edd248a..681caa5 100644
--- a/sc/source/ui/view/viewfunc.cxx
+++ b/sc/source/ui/view/viewfunc.cxx
@@ -2115,7 +2115,10 @@ void ScViewFunc::SetWidthOrHeight( BOOL bWidth, SCCOLROW nRangeCnt, SCCOLROW* pR
                         bOnlyMatrix;
             }
         }
-    if ( !bAllowed )
+
+    // Allow users to resize cols/rows in readonly docs despite the r/o state.
+    // It is frustrating to be unable to see content in mis-sized cells.
+    if( !bAllowed && !pDocSh->IsReadOnly() )
     {
         ErrorMessage(STR_PROTECTIONERR);
         return;
@@ -2342,6 +2345,7 @@ void ScViewFunc::SetWidthOrHeight( BOOL bWidth, SCCOLROW nRangeCnt, SCCOLROW* pR
             }
 
         pDocSh->UpdateOle(GetViewData());
+        if( !pDocSh->IsReadOnly() )
         aModificator.SetDocumentModified();
 
         ShowCursor();
-- 
1.7.0.1

