From f0ef8f38d03e387e0e822002a480f48317ee564d Mon Sep 17 00:00:00 2001
From: Jan Nieuwenhuizen <janneke@gnu.org>
Date: Sat, 25 Apr 2009 22:19:21 +0200
Subject: [PATCH] OOXML: arabic xlsx export crasher.  Fixes n#497419.

---
 sc/source/filter/excel/xetable.cxx |    2 +-
 1 files changed, 1 insertions(+), 1 deletions(-)

diff --git sc/source/filter/excel/xetable.cxx sc/source/filter/excel/xetable.cxx
index 3c2b1a5..8dea9e7 100644
--- sc/source/filter/excel/xetable.cxx
+++ sc/source/filter/excel/xetable.cxx
@@ -894,7 +894,7 @@ XclExpFormulaCell::XclExpFormulaCell(
         mxAddRec = rShrfmlaBfr.CreateOrExtendShrfmla( rScTokArr, aScPos );
 
     // no shared formula found - create a simple cell formula
-    if( !mxAddRec )
+    if( !mxAddRec || ! mxTokArr )
         mxTokArr = rRoot.GetFormulaCompiler().CreateFormula( EXC_FMLATYPE_CELL, rScTokArr, &aScPos );
 }
 
-- 
1.6.0.4

