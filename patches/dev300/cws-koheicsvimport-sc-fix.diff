From 462bd3b810a6b8b8f958ac662fa8af38749811c2 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:52:37 +0200
Subject: [PATCH 012/878] cws-koheicsvimport-sc-fix.diff

---
 sc/inc/scabstdlg.hxx                |    1 +
 sc/source/ui/attrdlg/scdlgfact.cxx  |    5 +++++
 sc/source/ui/attrdlg/scdlgfact.hxx  |    1 +
 sc/source/ui/dbgui/scuiasciiopt.cxx |   17 ++++++++++++-----
 sc/source/ui/inc/scuiasciiopt.hxx   |    1 +
 sc/source/ui/unoobj/filtuno.cxx     |    1 +
 6 files changed, 21 insertions(+), 5 deletions(-)

diff --git a/sc/inc/scabstdlg.hxx b/sc/inc/scabstdlg.hxx
index f30cf6a..cc7673e 100644
--- a/sc/inc/scabstdlg.hxx
+++ b/sc/inc/scabstdlg.hxx
@@ -63,6 +63,7 @@ class AbstractScImportAsciiDlg : public VclAbstractDialog  //add for ScImportAsc
 public:
     virtual void                        GetOptions( ScAsciiOptions& rOpt ) = 0;
     virtual void                        SetTextToColumnsMode() = 0;
+    virtual void                        SaveParameters() = 0;
 };
 
 
diff --git a/sc/source/ui/attrdlg/scdlgfact.cxx b/sc/source/ui/attrdlg/scdlgfact.cxx
index d76f4dc..238a6ee 100644
--- a/sc/source/ui/attrdlg/scdlgfact.cxx
+++ b/sc/source/ui/attrdlg/scdlgfact.cxx
@@ -195,6 +195,11 @@ void AbstractScImportAsciiDlg_Impl::SetTextToColumnsMode()
     pDlg->SetTextToColumnsMode();
 }
 
+void AbstractScImportAsciiDlg_Impl::SaveParameters()
+{
+    pDlg->SaveParameters();
+}
+
 // AbstractScImportAsciiDlg_Impl end
 
 //AbstractScAutoFormatDlg_Impl begin
diff --git a/sc/source/ui/attrdlg/scdlgfact.hxx b/sc/source/ui/attrdlg/scdlgfact.hxx
index 45324dc..56e2a9e 100644
--- a/sc/source/ui/attrdlg/scdlgfact.hxx
+++ b/sc/source/ui/attrdlg/scdlgfact.hxx
@@ -117,6 +117,7 @@ class AbstractScImportAsciiDlg_Impl : public AbstractScImportAsciiDlg  //add for
     DECL_ABSTDLG_BASE(AbstractScImportAsciiDlg_Impl, ScImportAsciiDlg)
     virtual void                        GetOptions( ScAsciiOptions& rOpt );
     virtual void                        SetTextToColumnsMode();
+    virtual void                        SaveParameters();
 };
 
 class AbstractScAutoFormatDlg_Impl : public AbstractScAutoFormatDlg  //add for ScAutoFormatDlg
diff --git a/sc/source/ui/dbgui/scuiasciiopt.cxx b/sc/source/ui/dbgui/scuiasciiopt.cxx
index f087913..f42965c 100644
--- a/sc/source/ui/dbgui/scuiasciiopt.cxx
+++ b/sc/source/ui/dbgui/scuiasciiopt.cxx
@@ -419,11 +419,6 @@ ScImportAsciiDlg::ScImportAsciiDlg( Window* pParent,String aDatName,
 
 ScImportAsciiDlg::~ScImportAsciiDlg()
 {
-    if (mbFileImport)
-        save_Separators( maFieldSeparators, aCbTextSep.GetText(), aCkbAsOnce.IsChecked(),
-                         aCkbQuotedAsText.IsChecked(), aCkbDetectNumber.IsChecked(),
-                         aRbFixed.IsChecked(), aNfRow.GetValue(), aLbCharSet.GetSelectEntryPos(),
-                         static_cast<sal_Int32>(aLbCustomLang.GetSelectLanguage()) );
     delete[] mpRowPosArray;
 }
 
@@ -537,6 +532,18 @@ void ScImportAsciiDlg::SetTextToColumnsMode()
     aCkbDetectNumber.Disable();
 }
 
+void ScImportAsciiDlg::SaveParameters()
+{
+    if (!mbFileImport)
+        // We save parameters only for file import.
+        return;
+
+    save_Separators( maFieldSeparators, aCbTextSep.GetText(), aCkbAsOnce.IsChecked(),
+                     aCkbQuotedAsText.IsChecked(), aCkbDetectNumber.IsChecked(),
+                     aRbFixed.IsChecked(), aNfRow.GetValue(), aLbCharSet.GetSelectEntryPos(),
+                     static_cast<sal_Int32>(aLbCustomLang.GetSelectLanguage()) );
+}
+
 void ScImportAsciiDlg::SetSelectedCharSet()
 {
     meCharSet = aLbCharSet.GetSelectTextEncoding();
diff --git a/sc/source/ui/inc/scuiasciiopt.hxx b/sc/source/ui/inc/scuiasciiopt.hxx
index dd35be2..7ed3ff9 100644
--- a/sc/source/ui/inc/scuiasciiopt.hxx
+++ b/sc/source/ui/inc/scuiasciiopt.hxx
@@ -104,6 +104,7 @@ public:
 
     void                        GetOptions( ScAsciiOptions& rOpt );
     void                        SetTextToColumnsMode();
+    void                        SaveParameters();
 
 private:
     /** Sets the selected char set data to meCharSet and mbCharSetSystem. */
diff --git a/sc/source/ui/unoobj/filtuno.cxx b/sc/source/ui/unoobj/filtuno.cxx
index 238516b..1ed1c75 100644
--- a/sc/source/ui/unoobj/filtuno.cxx
+++ b/sc/source/ui/unoobj/filtuno.cxx
@@ -176,6 +176,7 @@ sal_Int16 SAL_CALL ScFilterOptionsObj::execute() throw(uno::RuntimeException)
         {
             ScAsciiOptions aOptions;
             pDlg->GetOptions( aOptions );
+            pDlg->SaveParameters();
             aFilterOptions = aOptions.WriteToString();
             nRet = ui::dialogs::ExecutableDialogResults::OK;
         }
-- 
1.7.0.1

