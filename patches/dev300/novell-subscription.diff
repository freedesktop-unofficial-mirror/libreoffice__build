From 4970b5d52a6c5cc74c202daead84c4548424ca58 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:57:28 +0200
Subject: [PATCH 235/768] novell-subscription.diff

---
 .../org/openoffice/Office/UI/GenericCommands.xcu   |   13 +++++
 sfx2/inc/sfx2/sfxsids.hrc                          |    4 ++
 sfx2/sdi/appslots.sdi                              |    4 ++
 sfx2/sdi/sfx.sdi                                   |   50 ++++++++++++++++++++
 sfx2/source/appl/appserv.cxx                       |   17 +++++++
 5 files changed, 88 insertions(+), 0 deletions(-)

diff --git officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
index ab40f20..1f018d4 100644
--- officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
+++ officecfg/registry/data/org/openoffice/Office/UI/GenericCommands.xcu
@@ -4090,6 +4090,11 @@
                     <value xml:lang="en-US">~Support</value>
                 </prop>
             </node>
+            <node oor:name=".uno:GetSubscription" oor:op="replace">
+                <prop oor:name="Label" oor:type="xs:string">
+                    <value xml:lang="en-US">~Upgrade to Full Version</value>
+                </prop>
+            </node>
             <node oor:name=".uno:StatusBarVisible" oor:op="replace">
                 <prop oor:name="Label" oor:type="xs:string">
                     <value xml:lang="en-US">Status ~Bar</value>
@@ -5146,6 +5151,14 @@
       </node>
     </node>
         <node oor:name="Popups">
+            <node oor:name=".uno:SubscriptionMenu" oor:op="replace">
+                <prop oor:name="Label" oor:type="xs:string">
+                    <value xml:lang="en-US">~Subscription</value>
+                </prop>
+                <prop oor:name="Properties" oor:type="xs:int">
+                    <value>1</value>
+                </prop>
+            </node>
             <node oor:name=".uno:HelpMenu" oor:op="replace">
                 <prop oor:name="Label" oor:type="xs:string">
                     <value xml:lang="en-US">~Help</value>
diff --git sfx2/inc/sfx2/sfxsids.hrc sfx2/inc/sfx2/sfxsids.hrc
index 782e261..f0f3922 100644
--- sfx2/inc/sfx2/sfxsids.hrc
+++ sfx2/inc/sfx2/sfxsids.hrc
@@ -127,6 +127,10 @@
 #define SID_HELP_SUPPORTPAGE				(SID_SFX_START + 1683)
 #define SID_HELP_TUTORIALS					(SID_SFX_START + 1695)
 
+// default id for subscription
+#define SID_SUBSCRIPTIONMENU  				(SID_SFX_START + 3997)
+#define SID_SUBSCRIPTION_GET  				(SID_SFX_START + 3998)
+
 // default-ids for document
 #define SID_NEWDOC                          (SID_SFX_START + 500)
 #define SID_OPENDOC                         (SID_SFX_START + 501)
diff --git sfx2/sdi/appslots.sdi sfx2/sdi/appslots.sdi
index a230036..064d4f5 100644
--- sfx2/sdi/appslots.sdi
+++ sfx2/sdi/appslots.sdi
@@ -89,6 +89,10 @@ interface Application
         ExecMethod = MiscExec_Impl ;
         StateMethod = MiscState_Impl ;
     ]
+    SID_SUBSCRIPTION_GET
+    [
+        ExecMethod = MiscExec_Impl ;
+    ]
     SID_LOADCONFIG // ole(no) api(final/play)
     [
         ExecMethod = MiscExec_Impl ;
diff --git sfx2/sdi/sfx.sdi sfx2/sdi/sfx.sdi
index 1a3dead..2a523dc 100644
--- sfx2/sdi/sfx.sdi
+++ sfx2/sdi/sfx.sdi
@@ -7387,6 +7387,56 @@ SfxVoidItem AddonHelp SID_ADDONHELP
 ]
 
 //--------------------------------------------------------------------------
+SfxVoidItem SubscriptionMenu SID_SUBSCRIPTIONMENU
+()
+[
+    /* flags: */
+    AutoUpdate = FALSE,
+    Cachable = Cachable,
+    FastCall = FALSE,
+    HasCoreId = FALSE,
+    HasDialog = FALSE,
+    ReadOnlyDoc = TRUE,
+    Toggle = FALSE,
+    Container = FALSE,
+    RecordAbsolute = FALSE,
+    RecordPerSet;
+    Synchron;
+
+    /* config: */
+    AccelConfig = FALSE,
+    MenuConfig = TRUE,
+    StatusBarConfig = FALSE,
+    ToolBoxConfig = FALSE,
+    GroupId = GID_APPLICATION;
+]
+
+//--------------------------------------------------------------------------
+SfxVoidItem GetSubscription SID_SUBSCRIPTION_GET
+()
+[
+    /* flags: */
+    AutoUpdate = FALSE,
+    Cachable = Cachable,
+    FastCall = FALSE,
+    HasCoreId = FALSE,
+    HasDialog = FALSE,
+    ReadOnlyDoc = TRUE,
+    Toggle = FALSE,
+    Container = FALSE,
+    RecordAbsolute = FALSE,
+    RecordPerSet;
+    Synchron;
+
+    /* config: */
+    AccelConfig = TRUE,
+    MenuConfig = TRUE,
+    StatusBarConfig = FALSE,
+    ToolBoxConfig = TRUE,
+    GroupId = GID_APPLICATION;
+]
+
+//--------------------------------------------------------------------------
 SfxStringItem FormatMenuState SID_FORMATMENUSTATE
 [
     /* flags: */
diff --git sfx2/source/appl/appserv.cxx sfx2/source/appl/appserv.cxx
index c5098be..3280dd1 100644
--- sfx2/source/appl/appserv.cxx
+++ sfx2/source/appl/appserv.cxx
@@ -521,6 +521,23 @@ void SfxApplication::MiscExec_Impl( SfxRequest& rReq )
         }
 
         // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
+        case SID_SUBSCRIPTION_GET:
+        {
+            try {
+                Reference< com::sun::star::system::XSystemShellExecute > xSystemShell
+                    ( ::comphelper::getProcessServiceFactory()->createInstance( DEFINE_CONST_UNICODE("com.sun.star.system.SystemShellExecute" ) ), UNO_QUERY );
+                if ( xSystemShell.is()) {
+                    rtl::OUString aURI( DEFINE_CONST_UNICODE( "http://shop.novell.com/DRHM/servlet/ControllerServlet?Action=DisplayProductDetailsPage&SiteID=novell&Locale=en_US&Env=BASE&productID=108881200" ) );
+                    xSystemShell->execute( aURI, ::rtl::OUString(), com::sun::star::system::SystemShellExecuteFlags::DEFAULTS );
+                }
+
+                break;
+            } catch (const ::com::sun::star::uno::Exception &) {
+            }
+            /* drop through on exception */
+        }
+
+        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         case SID_ORGANIZER:
         {
             SfxTemplateOrganizeDlg  *pDlg =
-- 
1.7.0.1

