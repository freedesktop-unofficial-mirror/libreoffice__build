From c0729f568a3f6431b86adf4a8317c296d7291268 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:54:13 +0200
Subject: [PATCH 093/878] printing-bugfix-254573.diff

---
 sd/source/ui/view/PrintManager.cxx |   18 ++++++++++++++++--
 1 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/sd/source/ui/view/PrintManager.cxx b/sd/source/ui/view/PrintManager.cxx
index 3cf9a0e..2041edf 100644
--- a/sd/source/ui/view/PrintManager.cxx
+++ b/sd/source/ui/view/PrintManager.cxx
@@ -770,12 +770,14 @@ bool PrintManager::FitPageToPrinterWithDialog (
         SdOptionsPrintItem* pPrintOpts = NULL;
         BOOL                bScalePage = TRUE;
         BOOL                bTilePage = FALSE;
+        BOOL                bNotesPage = FALSE;
         BOOL                bPrintBooklet = FALSE;
 
         if( rOptions.GetItemState( ATTR_OPTIONS_PRINT, FALSE, (const SfxPoolItem**) &pPrintOpts ) == SFX_ITEM_SET )
         {
             bScalePage = pPrintOpts->GetOptionsPrint().IsPagesize();
             bPrintBooklet = pPrintOpts->GetOptionsPrint().IsBooklet();
+            bNotesPage = pPrintOpts->GetOptionsPrint().IsNotes();
             pPrintOpts->GetOptionsPrint().SetCutPage( FALSE );
         }
         else
@@ -786,18 +788,30 @@ bool PrintManager::FitPageToPrinterWithDialog (
         Size    aPrintSize( pPrinter->GetOutputSize() );
         long    nPageWidth = aPageSize.Width() - pPage->GetLftBorder() - pPage->GetRgtBorder();
         long    nPageHeight = aPageSize.Height() - pPage->GetUppBorder() - pPage->GetLwrBorder();
+        long    nNotesPageWidth, nNotesPageHeight;
         long    nPrintWidth = aPrintSize.Width();
         long    nPrintHeight = aPrintSize.Height();
         USHORT  nRet = RET_OK;
 
+        if( bNotesPage ) {
+            SdPage* pNotesPage = mrBase.GetDocument()->GetSdPage( 0, PK_NOTES );
+            Size aNotesPageSize = Size( pNotesPage->GetSize () );
+            nNotesPageWidth = aNotesPageSize.Width() - pNotesPage->GetLftBorder() - pNotesPage->GetRgtBorder();
+            nNotesPageHeight = aNotesPageSize.Height() - pNotesPage->GetUppBorder() - pNotesPage->GetLwrBorder();
+        }
+
         // When necessary then show a dialog that asks the user how to fit
         // the pages to be printed to the (smaller) printer pages.
         if ( !bScalePage
             && !bTilePage
             && !bPrintBooklet
-            && ( ( nPageWidth > nPrintWidth || nPageHeight > nPrintHeight )
+            && ( ( ( nPageWidth > nPrintWidth || nPageHeight > nPrintHeight )
                 && ( nPageWidth > nPrintHeight || nPageHeight > nPrintWidth )
-                )
+                   ) ||
+                 ( bNotesPage
+                   && ( nNotesPageWidth > nPrintWidth || nNotesPageHeight > nPrintHeight )
+                   && ( nNotesPageWidth > nPrintHeight || nNotesPageHeight > nPrintWidth ) )
+                 )
             )
         {
             if (IsScreenFormat())
-- 
1.7.0.1

