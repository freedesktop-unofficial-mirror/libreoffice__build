--- sc/inc/column.hxx.old	2010-03-03 16:59:11.000000000 +0100
+++ sc/inc/column.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -378,7 +378,7 @@ public:
                 /// Including current, may return -1
     SCsROW		GetNextUnprotected( SCROW nRow, BOOL bUp ) const;
 
-    void		GetFilterEntries(SCROW nStartRow, SCROW nEndRow, TypedScStrCollection& rStrings);
+    void		GetFilterEntries(SCROW nStartRow, SCROW nEndRow, TypedScStrCollection& rStrings, bool& rHasDates);
     BOOL		GetDataEntries(SCROW nRow, TypedScStrCollection& rStrings, BOOL bLimit);
 
 //UNUSED2008-05  SCROW		NoteCount( SCROW nMaxRow = MAXROW ) const;
--- sc/inc/dbcolect.hxx.old	2010-03-03 16:59:10.000000000 +0100
+++ sc/inc/dbcolect.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -88,6 +88,7 @@ private:
     SCCOLROW		nQueryField[MAXQUERY];
     ScQueryOp		eQueryOp[MAXQUERY];
     BOOL			bQueryByString[MAXQUERY];
+    bool            bQueryByDate[MAXQUERY];
     String*			pQueryStr[MAXQUERY];
     double			nQueryVal[MAXQUERY];
     ScQueryConnect  eQueryConnect[MAXQUERY];
--- sc/inc/document.hxx.old	2010-03-03 16:59:11.000000000 +0100
+++ sc/inc/document.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -1394,9 +1394,9 @@ public:
     void 			GetUpperCellString(SCCOL nCol, SCROW nRow, SCTAB nTab, String& rStr);
 
     BOOL			GetFilterEntries( SCCOL nCol, SCROW nRow, SCTAB nTab,
-                                TypedScStrCollection& rStrings, bool bFilter = false );
+                                bool bFilter, TypedScStrCollection& rStrings, bool& rHasDates);
     SC_DLLPUBLIC BOOL			GetFilterEntriesArea( SCCOL nCol, SCROW nStartRow, SCROW nEndRow,
-                                SCTAB nTab, TypedScStrCollection& rStrings );
+                                SCTAB nTab, TypedScStrCollection& rStrings, bool& rHasDates );
     BOOL			GetDataEntries( SCCOL nCol, SCROW nRow, SCTAB nTab,
                                 TypedScStrCollection& rStrings, BOOL bLimit = FALSE );
     BOOL			GetFormulaEntries( TypedScStrCollection& rStrings );
--- sc/inc/global.hxx.old	2010-03-03 16:44:03.000000000 +0100
+++ sc/inc/global.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -797,6 +797,7 @@ struct ScQueryEntry
 {
     BOOL			bDoQuery;
     BOOL			bQueryByString;
+    bool            bQueryByDate;
     SCCOLROW		nField;
     ScQueryOp		eOp;
     ScQueryConnect  eConnect;
--- sc/inc/table.hxx.old	2010-03-03 16:59:11.000000000 +0100
+++ sc/inc/table.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -643,8 +643,8 @@ public:
     SCSIZE		Query(ScQueryParam& rQueryParam, BOOL bKeepSub);
     BOOL		CreateQueryParam(SCCOL nCol1, SCROW nRow1, SCCOL nCol2, SCROW nRow2, ScQueryParam& rQueryParam);
 
-    void		GetFilterEntries(SCCOL nCol, SCROW nRow1, SCROW nRow2, TypedScStrCollection& rStrings);
-    void        GetFilteredFilterEntries( SCCOL nCol, SCROW nRow1, SCROW nRow2, const ScQueryParam& rParam, TypedScStrCollection& rStrings );
+    void        GetFilterEntries(SCCOL nCol, SCROW nRow1, SCROW nRow2, TypedScStrCollection& rStrings, bool& rHasDates);
+    void        GetFilteredFilterEntries( SCCOL nCol, SCROW nRow1, SCROW nRow2, const ScQueryParam& rParam, TypedScStrCollection& rStrings, bool& rHasDates );
     BOOL		GetDataEntries(SCCOL nCol, SCROW nRow, TypedScStrCollection& rStrings, BOOL bLimit);
 
     BOOL		HasColHeader( SCCOL nStartCol, SCROW nStartRow, SCCOL nEndCol, SCROW nEndRow );
--- sc/source/core/data/column3.cxx.old	2010-03-03 16:44:02.000000000 +0100
+++ sc/source/core/data/column3.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -1470,8 +1470,9 @@ BOOL ScColumn::SetString( SCROW nRow, SC
 }
 
 
-void ScColumn::GetFilterEntries(SCROW nStartRow, SCROW nEndRow, TypedScStrCollection& rStrings)
+void ScColumn::GetFilterEntries(SCROW nStartRow, SCROW nEndRow, TypedScStrCollection& rStrings, bool& rHasDates)
 {
+    bool bHasDates = false;
     SvNumberFormatter* pFormatter = pDocument->GetFormatTable();
     String aString;
     SCROW nRow = 0;
@@ -1507,6 +1508,18 @@ void ScColumn::GetFilterEntries(SCROW nS
                     nValue = 0.0;
             }
 
+            if (pFormatter)
+            {
+                short nType = pFormatter->GetType(nFormat);
+                if ((nType & NUMBERFORMAT_DATE) && !(nType & NUMBERFORMAT_TIME))
+                {    
+                    // special case for date values.  Disregard the time
+                    // element if the number format is of date type.
+                    nValue = ::rtl::math::approxFloor(nValue);
+                    bHasDates = true;
+                }
+            }
+
             pData = new TypedStrData( aString, nValue, SC_STRTYPE_VALUE );
         }
 #if 0 // DR
@@ -1525,6 +1538,8 @@ void ScColumn::GetFilterEntries(SCROW nS
 
         ++nIndex;
     }
+
+    rHasDates = bHasDates;
 }
 
 //
--- sc/source/core/data/documen3.cxx.old	2009-10-19 13:27:16.000000000 +0200
+++ sc/source/core/data/documen3.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -1260,7 +1260,8 @@ BOOL ScDocument::HasRowHeader( SCCOL nSt
 //	GetFilterEntries - Eintraege fuer AutoFilter-Listbox
 //
 
-BOOL ScDocument::GetFilterEntries( SCCOL nCol, SCROW nRow, SCTAB nTab, TypedScStrCollection& rStrings, bool bFilter )
+BOOL ScDocument::GetFilterEntries(
+    SCCOL nCol, SCROW nRow, SCTAB nTab, bool bFilter, TypedScStrCollection& rStrings, bool& rHasDates)
 {
     if ( ValidTab(nTab) && pTab[nTab] && pDBCollection )
     {
@@ -1297,11 +1298,11 @@ BOOL ScDocument::GetFilterEntries( SCCOL
 
             if ( bFilter )
             {
-                pTab[nTab]->GetFilteredFilterEntries( nCol, nStartRow, nEndRow, aParam, rStrings );
+                pTab[nTab]->GetFilteredFilterEntries( nCol, nStartRow, nEndRow, aParam, rStrings, rHasDates );
             }
             else
             {
-                pTab[nTab]->GetFilterEntries( nCol, nStartRow, nEndRow, rStrings );
+                pTab[nTab]->GetFilterEntries( nCol, nStartRow, nEndRow, rStrings, rHasDates );
             }
 
             return TRUE;
@@ -1316,11 +1317,11 @@ BOOL ScDocument::GetFilterEntries( SCCOL
 //
 
 BOOL ScDocument::GetFilterEntriesArea( SCCOL nCol, SCROW nStartRow, SCROW nEndRow,
-                                        SCTAB nTab, TypedScStrCollection& rStrings )
+                                        SCTAB nTab, TypedScStrCollection& rStrings, bool& rHasDates )
 {
     if ( ValidTab(nTab) && pTab[nTab] )
     {
-        pTab[nTab]->GetFilterEntries( nCol, nStartRow, nEndRow, rStrings );
+        pTab[nTab]->GetFilterEntries( nCol, nStartRow, nEndRow, rStrings, rHasDates );
         return TRUE;
     }
 
--- sc/source/core/data/global2.cxx.old	2010-03-03 16:44:03.000000000 +0100
+++ sc/source/core/data/global2.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -145,30 +145,32 @@ BOOL ScImportParam::operator==( const Sc
 //------------------------------------------------------------------------
 // struct ScQueryParam:
 
-ScQueryEntry::ScQueryEntry()
+ScQueryEntry::ScQueryEntry() :
+    bDoQuery(FALSE),
+    bQueryByString(FALSE),
+    bQueryByDate(false),
+    nField(0),
+    eOp(SC_EQUAL),
+    eConnect(SC_AND),
+    pStr(new String),
+    nVal(0.0),
+    pSearchParam(NULL),
+    pSearchText(NULL)
 {
-    bDoQuery		= FALSE;
-    bQueryByString	= FALSE;
-    eOp				= SC_EQUAL;
-    eConnect		= SC_AND;
-    nField			= 0;
-    nVal			= 0.0;
-    pStr			= new String;
-    pSearchParam	= NULL;
-    pSearchText		= NULL;
 }
 
-ScQueryEntry::ScQueryEntry(const ScQueryEntry& r)
+ScQueryEntry::ScQueryEntry(const ScQueryEntry& r) :
+    bDoQuery(r.bDoQuery),
+    bQueryByString(r.bQueryByString),
+    bQueryByDate(r.bQueryByDate),
+    nField(r.nField),
+    eOp(r.eOp),
+    eConnect(r.eConnect),
+    pStr(new String(*r.pStr)),
+    nVal(r.nVal),
+    pSearchParam(NULL),
+    pSearchText(NULL)
 {
-    bDoQuery		= r.bDoQuery;
-    bQueryByString	= r.bQueryByString;
-    eOp				= r.eOp;
-    eConnect		= r.eConnect;
-    nField			= r.nField;
-    nVal			= r.nVal;
-    pStr			= new String(*r.pStr);
-    pSearchParam	= NULL;
-    pSearchText		= NULL;
 }
 
 ScQueryEntry::~ScQueryEntry()
@@ -185,6 +187,7 @@ ScQueryEntry& ScQueryEntry::operator=( c
 {
     bDoQuery		= r.bDoQuery;
     bQueryByString	= r.bQueryByString;
+    bQueryByDate    = r.bQueryByDate;
     eOp				= r.eOp;
     eConnect		= r.eConnect;
     nField			= r.nField;
@@ -205,6 +208,7 @@ void ScQueryEntry::Clear()
 {
     bDoQuery		= FALSE;
     bQueryByString	= FALSE;
+    bQueryByDate    = false;
     eOp				= SC_EQUAL;
     eConnect		= SC_AND;
     nField			= 0;
@@ -223,6 +227,7 @@ BOOL ScQueryEntry::operator==( const ScQ
 {
     return bDoQuery			== r.bDoQuery
         && bQueryByString	== r.bQueryByString
+        && bQueryByDate     == r.bQueryByDate
         && eOp				== r.eOp
         && eConnect			== r.eConnect
         && nField			== r.nField
--- sc/source/core/data/table3.cxx.old	2010-03-03 16:59:10.000000000 +0100
+++ sc/source/core/data/table3.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -61,6 +61,7 @@
 #include "cellform.hxx"
 #include "postit.hxx"
 #include "queryparam.hxx"
+#include "svtools/zformat.hxx"
 
 #include <vector>
 
@@ -1144,6 +1145,20 @@ BOOL ScTable::ValidQuery(SCROW nRow, con
             }
             else
                 nCellVal = GetValue( static_cast<SCCOL>(rEntry.nField), nRow );
+
+            if (rEntry.bQueryByDate)
+            {
+                sal_uInt32 nNumFmt = GetNumberFormat(static_cast<SCCOL>(rEntry.nField), nRow);
+                const SvNumberformat* pEntry = pDocument->GetFormatTable()->GetEntry(nNumFmt);
+                if (pEntry)
+                {
+                    short nNumFmtType = pEntry->GetType();
+                    if ((nNumFmtType & NUMBERFORMAT_DATE) && !(nNumFmtType & NUMBERFORMAT_TIME))
+                        // The format is of date type.  Strip off the time element.
+                        nCellVal = ::rtl::math::approxFloor(nCellVal);
+                }
+            }
+
             switch (rEntry.eOp)
             {
                 case SC_EQUAL :
@@ -1931,12 +1946,13 @@ BOOL ScTable::HasRowHeader( SCCOL nStart
     return TRUE;
 }
 
-void ScTable::GetFilterEntries(SCCOL nCol, SCROW nRow1, SCROW nRow2, TypedScStrCollection& rStrings)
+void ScTable::GetFilterEntries(SCCOL nCol, SCROW nRow1, SCROW nRow2, TypedScStrCollection& rStrings, bool& rHasDates)
 {
-    aCol[nCol].GetFilterEntries( nRow1, nRow2, rStrings );
+    aCol[nCol].GetFilterEntries( nRow1, nRow2, rStrings, rHasDates );
 }
 
-void ScTable::GetFilteredFilterEntries( SCCOL nCol, SCROW nRow1, SCROW nRow2, const ScQueryParam& rParam, TypedScStrCollection& rStrings )
+void ScTable::GetFilteredFilterEntries(
+    SCCOL nCol, SCROW nRow1, SCROW nRow2, const ScQueryParam& rParam, TypedScStrCollection& rStrings, bool& rHasDates )
 {
     // remove the entry for this column from the query parameter
     ScQueryParam aParam( rParam );
@@ -1954,15 +1970,18 @@ void ScTable::GetFilteredFilterEntries(
 
     BOOL* pSpecial = new BOOL[nEntryCount];
     lcl_PrepareQuery( pDocument, this, aParam, pSpecial );
-
+    bool bHasDates = false;
     for ( SCROW j = nRow1; j <= nRow2; ++j )
     {
         if ( ValidQuery( j, aParam, pSpecial ) )
         {
-            aCol[nCol].GetFilterEntries( j, j, rStrings );
+            bool bThisHasDates = false;
+            aCol[nCol].GetFilterEntries( j, j, rStrings, bThisHasDates );
+            bHasDates |= bThisHasDates;
         }
     }
 
+    rHasDates = bHasDates;
     delete[] pSpecial;
 }
 
--- sc/source/core/tool/dbcolect.cxx.old	2010-03-03 16:59:10.000000000 +0100
+++ sc/source/core/tool/dbcolect.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -159,6 +159,7 @@ ScDBData::ScDBData( const ScDBData& rDat
         nQueryField[i]		= rData.nQueryField[i];
         eQueryOp[i]			= rData.eQueryOp[i];
         bQueryByString[i]	= rData.bQueryByString[i];
+        bQueryByDate[i]     = rData.bQueryByDate[i];
         pQueryStr[i]		= new String( *(rData.pQueryStr[i]) );
         nQueryVal[i]		= rData.nQueryVal[i];
         eQueryConnect[i]	= rData.eQueryConnect[i];
@@ -249,6 +250,7 @@ ScDBData& ScDBData::operator= (const ScD
         nQueryField[i]		= rData.nQueryField[i];
         eQueryOp[i]			= rData.eQueryOp[i];
         bQueryByString[i]	= rData.bQueryByString[i];
+        bQueryByDate[i]     = rData.bQueryByDate[i];
         *pQueryStr[i]		= *rData.pQueryStr[i];
         nQueryVal[i]		= rData.nQueryVal[i];
         eQueryConnect[i]	= rData.eQueryConnect[i];
@@ -519,6 +521,7 @@ void ScDBData::GetQueryParam( ScQueryPar
         rEntry.nField = nQueryField[i];
         rEntry.eOp = eQueryOp[i];
         rEntry.bQueryByString = bQueryByString[i];
+        rEntry.bQueryByDate = bQueryByDate[i];
         *rEntry.pStr = *pQueryStr[i];
         rEntry.nVal = nQueryVal[i];
         rEntry.eConnect = eQueryConnect[i];
@@ -550,6 +553,7 @@ void ScDBData::SetQueryParam(const ScQue
         nQueryField[i] = rEntry.nField;
         eQueryOp[i] = rEntry.eOp;
         bQueryByString[i] = rEntry.bQueryByString;
+        bQueryByDate[i] = rEntry.bQueryByDate;
         *pQueryStr[i] = *rEntry.pStr;
         nQueryVal[i] = rEntry.nVal;
         eQueryConnect[i] = rEntry.eConnect;
--- sc/source/ui/dbgui/filtdlg.cxx.old	2009-10-08 16:17:09.000000000 +0200
+++ sc/source/ui/dbgui/filtdlg.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -451,24 +451,27 @@ void ScFilterDlg::UpdateValueList( USHOR
             SCCOL nColumn = theQueryData.nCol1 + static_cast<SCCOL>(nFieldSelPos) - 1;
             if (!pEntryLists[nColumn])
             {
+                USHORT nOffset = GetSliderPos();
                 SCTAB nTab		 = nSrcTab;
                 SCROW nFirstRow = theQueryData.nRow1;
                 SCROW nLastRow	 = theQueryData.nRow2;
+                mbHasDates[nOffset+nList-1] = false;
 
                 //	erstmal ohne die erste Zeile
 
                 pEntryLists[nColumn] = new TypedScStrCollection( 128, 128 );
                 pEntryLists[nColumn]->SetCaseSensitive( aBtnCase.IsChecked() );
                 pDoc->GetFilterEntriesArea( nColumn, nFirstRow+1, nLastRow,
-                                            nTab, *pEntryLists[nColumn] );
+                                            nTab, *pEntryLists[nColumn], mbHasDates[nOffset+nList-1] );
 
                 //	Eintrag fuer die erste Zeile
                 //!	Eintrag (pHdrEntry) ohne Collection erzeugen?
 
                 nHeaderPos[nColumn] = USHRT_MAX;
                 TypedScStrCollection aHdrColl( 1, 1 );
+                bool bDummy = false;
                 pDoc->GetFilterEntriesArea( nColumn, nFirstRow, nFirstRow,
-                                            nTab, aHdrColl );
+                                            nTab, aHdrColl, bDummy );
                 TypedStrData* pHdrEntry = aHdrColl[0];
                 if ( pHdrEntry )
                 {
@@ -1064,7 +1067,8 @@ IMPL_LINK( ScFilterDlg, ValModifyHdl, Co
                 static_cast<SCCOL>(nField) - 1) : static_cast<SCCOL>(0);
            
             ScQueryOp eOp  = (ScQueryOp)pLbCond->GetSelectEntryPos();
-           rEntry.eOp	  = eOp;
+            rEntry.eOp	   = eOp;
+            rEntry.bQueryByDate = mbHasDates[nQE];
 
         }
     }		
--- sc/source/ui/dbgui/pfiltdlg.cxx.old	2009-10-07 15:06:14.000000000 +0200
+++ sc/source/ui/dbgui/pfiltdlg.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -352,11 +352,12 @@ void ScPivotFilterDlg::UpdateValueList(
                 SCROW	nFirstRow	= theQueryData.nRow1;
                 SCROW	nLastRow	= theQueryData.nRow2;
                 nFirstRow++;
+                bool bHasDates = false;
 
                 pEntryLists[nColumn] = new TypedScStrCollection( 128, 128 );
                 pEntryLists[nColumn]->SetCaseSensitive( aBtnCase.IsChecked() );
                 pDoc->GetFilterEntriesArea( nColumn, nFirstRow, nLastRow,
-                                            nTab, *pEntryLists[nColumn] );
+                                            nTab, *pEntryLists[nColumn], bHasDates );
             }
 
             TypedScStrCollection* pColl = pEntryLists[nColumn];
--- sc/source/ui/inc/filtdlg.hxx.old	2009-10-08 16:17:09.000000000 +0200
+++ sc/source/ui/inc/filtdlg.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -167,6 +167,7 @@ private:
     ListBox*			aFieldLbArr[4];
     ListBox*			aCondLbArr[4];
     ListBox*			aConnLbArr[4];
+    bool                mbHasDates[MAXQUERY];
     BOOL                bRefreshExceptQuery[MAXQUERY];
     USHORT				nFieldCount;
     BOOL				bRefInputMode;
--- sc/source/ui/inc/gridwin.hxx.old	2010-03-03 16:44:05.000000000 +0100
+++ sc/source/ui/inc/gridwin.hxx	2010-03-03 16:59:11.000000000 +0100
@@ -219,7 +219,7 @@ private:
 
     BOOL 			IsAutoFilterActive( SCCOL nCol, SCROW nRow, SCTAB nTab );
     void			ExecFilter( ULONG nSel, SCCOL nCol, SCROW nRow,
-                                const String& aValue );
+                                const String& aValue, bool bCheckForDates );
     void			FilterSelect( ULONG nSel );
 
     void			ExecDataSelect( SCCOL nCol, SCROW nRow, const String& rStr );
--- sc/source/ui/view/gridwin.cxx.old	2010-03-03 16:59:09.000000000 +0100
+++ sc/source/ui/view/gridwin.cxx	2010-03-03 16:59:11.000000000 +0100
@@ -173,6 +173,7 @@ private:
     BOOL			bInit;
     BOOL			bCancelled;
     BOOL            bInSelect;
+    bool            mbListHasDates;
     ULONG			nSel;
     ScFilterBoxMode	eMode;
 
@@ -196,6 +197,8 @@ public:
     BOOL            IsInInit() const        { return bInit; }
     void			SetCancelled()			{ bCancelled = TRUE; }
     BOOL            IsInSelect() const      { return bInSelect; }
+    void            SetListHasDates(bool b) { mbListHasDates = b; }
+    bool            HasDates() const        { return mbListHasDates; }
 };
 
 //-------------------------------------------------------------------
@@ -211,6 +214,7 @@ ScFilterListBox::ScFilterListBox( Window
     bInit( TRUE ),
     bCancelled( FALSE ),
     bInSelect( FALSE ),
+    mbListHasDates(false),
     nSel( 0 ),
     eMode( eNewMode )
 {
@@ -916,7 +920,9 @@ void ScGridWindow::DoAutoFilterMenue( SC
         pFilterBox->SetSeparatorPos( nDefCount - 1 );
 
         //	get list entries
-        pDoc->GetFilterEntries( nCol, nRow, nTab, aStrings, true );
+        bool bHasDates = false;
+        pDoc->GetFilterEntries( nCol, nRow, nTab, true, aStrings, bHasDates);
+        pFilterBox->SetListHasDates(bHasDates);
 
         //	check widths of numerical entries (string entries are not included)
         //	so all numbers are completely visible
@@ -1126,7 +1132,7 @@ void ScGridWindow::FilterSelect( ULONG n
             ExecDataSelect( nCol, nRow, aString );
             break;
         case SC_FILTERBOX_FILTER:
-            ExecFilter( nSel, nCol, nRow, aString );
+            ExecFilter( nSel, nCol, nRow, aString, pFilterBox->HasDates() );
             break;
         case SC_FILTERBOX_SCENARIO:
             pViewData->GetView()->UseScenario( aString );
@@ -1159,7 +1165,7 @@ void ScGridWindow::ExecDataSelect( SCCOL
 
 void ScGridWindow::ExecFilter( ULONG nSel,
                                SCCOL nCol, SCROW nRow,
-                               const String& aValue )
+                               const String& aValue, bool bCheckForDates )
 {
     SCTAB nTab = pViewData->GetTabNo();
     ScDocument* pDoc = pViewData->GetDocument();
@@ -1231,6 +1237,7 @@ void ScGridWindow::ExecFilter( ULONG nSe
                     rNewEntry.bDoQuery		 = TRUE;
                     rNewEntry.bQueryByString = TRUE;
                     rNewEntry.nField		 = nCol;
+                    rNewEntry.bQueryByDate   = bCheckForDates;
                     if ( nSel == SC_AUTOFILTER_TOP10 )
                     {
                         rNewEntry.eOp	= SC_TOPVAL;
