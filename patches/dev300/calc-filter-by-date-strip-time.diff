--- sc/source/core/data/column3.cxx.old	2009-04-02 10:45:01.000000000 +0000
+++ sc/source/core/data/column3.cxx	2009-04-06 16:41:49.000000000 +0000
@@ -1418,6 +1418,15 @@ void ScColumn::GetFilterEntries(SCROW nS
 					nValue = 0.0;
 			}
 
+            if (pFormatter)
+            {
+                short nType = pFormatter->GetType(nFormat);
+                if ((nType & NUMBERFORMAT_DATE) && !(nType & NUMBERFORMAT_TIME))
+                    // special case for date values.  Disregard the time
+                    // element if the number format is of date type.
+                    nValue = ::rtl::math::approxFloor(nValue);
+            }
+
 			pData = new TypedStrData( aString, nValue, SC_STRTYPE_VALUE );
 		}
 #if 0 // DR
--- sc/source/core/data/table3.cxx.old	2009-04-06 16:41:48.000000000 +0000
+++ sc/source/core/data/table3.cxx	2009-04-06 16:41:49.000000000 +0000
@@ -61,6 +61,7 @@
 #include "progress.hxx"
 #include "cellform.hxx"
 #include "postit.hxx"
+#include "svtools/zformat.hxx"
 
 #include <vector>
 
@@ -1166,6 +1167,17 @@ BOOL ScTable::ValidQuery(SCROW nRow, con
             }
             else
                 nCellVal = GetValue( static_cast<SCCOL>(rEntry.nField), nRow );
+
+            sal_uInt32 nNumFmt = GetNumberFormat(static_cast<SCCOL>(rEntry.nField), nRow);
+            const SvNumberformat* pEntry = pDocument->GetFormatTable()->GetEntry(nNumFmt);
+            if (pEntry)
+            {
+                short nNumFmtType = pEntry->GetType();
+                if ((nNumFmtType & NUMBERFORMAT_DATE) && !(nNumFmtType & NUMBERFORMAT_TIME))
+                    // The format is of date type.  Strip off the time element.
+                    nCellVal = ::rtl::math::approxFloor(nCellVal);
+            }
+
 			switch (rEntry.eOp)
 			{
 				case SC_EQUAL :
