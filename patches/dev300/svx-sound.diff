Sounds in slideshow fix

From: rodo


---

 svx/inc/svx/svdomedia.hxx       |    5 +++++
 svx/inc/svx/unoshprp.hxx        |    2 ++
 svx/source/svdraw/svdomedia.cxx |   16 ++++++++++++++++
 svx/source/unodraw/unoprov.cxx  |    1 +
 svx/source/unodraw/unoshap4.cxx |   19 +++++++++++++++++--
 5 files changed, 41 insertions(+), 2 deletions(-)


diff --git svx/inc/svx/svdomedia.hxx svx/inc/svx/svdomedia.hxx
index cf82e82..8fd0a5e 100644
--- svx/inc/svx/svdomedia.hxx
+++ svx/inc/svx/svdomedia.hxx
@@ -79,6 +79,9 @@ public:
         void						setURL( const ::rtl::OUString& rURL );
         const ::rtl::OUString&		getURL() const;
 
+        void						setSlidesNumber( sal_uInt16 nSlidesNumber );
+        sal_uInt16		        getSlidesNumber() const;
+
         void						setMediaProperties( const ::avmedia::MediaItem& rState );
         const ::avmedia::MediaItem& getMediaProperties() const;
 
@@ -108,6 +111,8 @@ private:
         ::std::auto_ptr< Graphic >  mapGraphic;
         ::rtl::Reference< sdr::media::MediaLink > mxMediaLink;
 		SdrMediaLink*				mpSdrMediaLink;
+
+        sal_uInt16                  mnSlidesNumber;
 };
 
 #endif //_SVDOMEDIA_HXX
diff --git svx/inc/svx/unoshprp.hxx svx/inc/svx/unoshprp.hxx
index 7366f1a..e425ef9 100644
--- svx/inc/svx/unoshprp.hxx
+++ svx/inc/svx/unoshprp.hxx
@@ -194,6 +194,8 @@
 
 #define OWN_ATTR_EDGE_POLYPOLYGONBEZIER			(OWN_ATTR_VALUE_START+88)
 
+#define OWN_ATTR_MEDIA_SLIDES_NUMBER					(OWN_ATTR_VALUE_START+89)
+
 #define OWN_ATTR_VALUE_END                      OWN_ATTR_EDGE_POLYPOLYGONBEZIER // WARNING: ee items start at 3991!
 
 // #FontWork#
diff --git svx/source/svdraw/svdomedia.cxx svx/source/svdraw/svdomedia.cxx
index 884d71f..40da1e5 100644
--- svx/source/svdraw/svdomedia.cxx
+++ svx/source/svdraw/svdomedia.cxx
@@ -117,6 +117,7 @@ TYPEINIT1( SdrMediaObj, SdrRectObj );
 
 SdrMediaObj::SdrMediaObj()
 : mpSdrMediaLink( 0 )
+, mnSlidesNumber( 1 )
 {
 }
 
@@ -125,6 +126,7 @@ SdrMediaObj::SdrMediaObj()
 SdrMediaObj::SdrMediaObj( const Rectangle& rRect )
 : SdrRectObj( rRect )
 , mpSdrMediaLink( 0 )
+, mnSlidesNumber( 1 )
 {
 }
 
@@ -275,6 +277,20 @@ const ::rtl::OUString& SdrMediaObj::getURL() const
 
 // ------------------------------------------------------------------------------
 
+void SdrMediaObj::setSlidesNumber( sal_uInt16 nSlidesNumber )
+{
+    mnSlidesNumber = nSlidesNumber;
+}
+
+// ------------------------------------------------------------------------------
+    
+sal_uInt16 SdrMediaObj::getSlidesNumber() const
+{
+    return mnSlidesNumber;
+}
+
+// ------------------------------------------------------------------------------
+
 void SdrMediaObj::setMediaProperties( const ::avmedia::MediaItem& rState )
 {
     mediaPropertiesChanged( rState );
diff --git svx/source/unodraw/unoprov.cxx svx/source/unodraw/unoprov.cxx
index 0ab785b..bf56f64 100644
--- svx/source/unodraw/unoprov.cxx
+++ svx/source/unodraw/unoprov.cxx
@@ -750,6 +750,7 @@ SfxItemPropertyMapEntry* ImplGetSvxMediaShapePropertyMap()
         { MAP_CHAR_LEN(UNO_NAME_LINKDISPLAYNAME), OWN_ATTR_LDNAME, &::getCppuType(( const ::rtl::OUString*)0),	::com::sun::star::beans::PropertyAttribute::READONLY, 0},
         { MAP_CHAR_LEN("Transformation"), OWN_ATTR_TRANSFORMATION, &::getCppuType((const struct com::sun::star::drawing::HomogenMatrix3*)0), 0, 0 },
         { MAP_CHAR_LEN("MediaURL"),	OWN_ATTR_MEDIA_URL, &::getCppuType((const ::rtl::OUString*)0), 0, 0},
+        { MAP_CHAR_LEN("MediaSlidesNumber"),	OWN_ATTR_MEDIA_SLIDES_NUMBER, &::getCppuType((const sal_uInt16*)0), 0, 0},
         { MAP_CHAR_LEN("PreferredSize"), OWN_ATTR_MEDIA_PREFERREDSIZE, &::getCppuType((const ::com::sun::star::awt::Size*)0), ::com::sun::star::beans::PropertyAttribute::READONLY, 0},
         { MAP_CHAR_LEN("Loop"),	OWN_ATTR_MEDIA_LOOP, &::getCppuType((const sal_Bool*)0), 0, 0},
         { MAP_CHAR_LEN("Mute"),	OWN_ATTR_MEDIA_MUTE, &::getCppuType((const sal_Bool*)0), 0, 0},
diff --git svx/source/unodraw/unoshap4.cxx svx/source/unodraw/unoshap4.cxx
index 96c2cae..9ea08e2 100644
--- svx/source/unodraw/unoshap4.cxx
+++ svx/source/unodraw/unoshap4.cxx
@@ -865,7 +865,7 @@ SvxMediaShape::~SvxMediaShape() throw()
 
 bool SvxMediaShape::setPropertyValueImpl( const ::rtl::OUString& rName, const SfxItemPropertySimpleEntry* pProperty, const ::com::sun::star::uno::Any& rValue ) throw(::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::beans::PropertyVetoException, ::com::sun::star::lang::IllegalArgumentException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
-    if( (pProperty->nWID >= OWN_ATTR_MEDIA_URL) && (pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM) )
+    if( (pProperty->nWID >= OWN_ATTR_MEDIA_URL) && (pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM) || pProperty->nWID == OWN_ATTR_MEDIA_SLIDES_NUMBER )
     {
         SdrMediaObj* pMedia = static_cast< SdrMediaObj* >( mpObj.get() );
         ::avmedia::MediaItem aItem;
@@ -884,6 +884,17 @@ bool SvxMediaShape::setPropertyValueImpl( const ::rtl::OUString& rName, const Sf
         }
         break;
 
+        case OWN_ATTR_MEDIA_SLIDES_NUMBER:
+        {
+            sal_uInt16 nSlidesNumber;
+            if( rValue >>= nSlidesNumber )
+            {
+                bOk = true;
+                pMedia->setSlidesNumber( nSlidesNumber );
+            }
+        }
+        break;
+
         case( OWN_ATTR_MEDIA_LOOP ):
         {
             sal_Bool bLoop = sal_Bool();
@@ -954,7 +965,7 @@ bool SvxMediaShape::setPropertyValueImpl( const ::rtl::OUString& rName, const Sf
 
 bool SvxMediaShape::getPropertyValueImpl( const ::rtl::OUString& rName, const SfxItemPropertySimpleEntry* pProperty, ::com::sun::star::uno::Any& rValue ) throw(::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
-    if( ( pProperty->nWID >= OWN_ATTR_MEDIA_URL ) && ( pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM ) )
+    if( ( pProperty->nWID >= OWN_ATTR_MEDIA_URL ) && ( pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM ) || pProperty->nWID == OWN_ATTR_MEDIA_SLIDES_NUMBER )
     {
         SdrMediaObj* pMedia = static_cast< SdrMediaObj* >( mpObj.get() );
         const ::avmedia::MediaItem aItem( pMedia->getMediaProperties() );
@@ -965,6 +976,10 @@ bool SvxMediaShape::getPropertyValueImpl( const ::rtl::OUString& rName, const Sf
                 rValue <<= aItem.getURL();
                 break;
 
+            case OWN_ATTR_MEDIA_SLIDES_NUMBER:
+                rValue <<= pMedia->getSlidesNumber();
+                break;
+
             case( OWN_ATTR_MEDIA_LOOP ):
                 rValue <<= (sal_Bool) aItem.isLoop();
                 break;
