From e96d488cfd1ce3c52c7249aa8dd39fec49b3d970 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:08:53 +0200
Subject: [PATCH 839/878] svx-sound.diff

---
 svx/inc/svx/svdomedia.hxx       |    5 +++++
 svx/inc/svx/unoshprp.hxx        |    2 ++
 svx/source/svdraw/svdomedia.cxx |   16 ++++++++++++++++
 svx/source/unodraw/unoprov.cxx  |    1 +
 svx/source/unodraw/unoshap4.cxx |   19 +++++++++++++++++--
 5 files changed, 41 insertions(+), 2 deletions(-)

diff --git a/svx/inc/svx/svdomedia.hxx b/svx/inc/svx/svdomedia.hxx
index defcc40..00a736f 100644
--- svx/inc/svx/svdomedia.hxx
+++ svx/inc/svx/svdomedia.hxx
@@ -76,6 +76,9 @@ public:
         void						setURL( const ::rtl::OUString& rURL );
         const ::rtl::OUString&		getURL() const;
 
+        void						setSlidesNumber( sal_uInt16 nSlidesNumber );
+        sal_uInt16		        getSlidesNumber() const;
+
         void						setMediaProperties( const ::avmedia::MediaItem& rState );
         const ::avmedia::MediaItem& getMediaProperties() const;
 
@@ -105,6 +108,8 @@ private:
         ::std::auto_ptr< Graphic >  mapGraphic;
         ::rtl::Reference< sdr::media::MediaLink > mxMediaLink;
         SdrMediaLink*				mpSdrMediaLink;
+
+        sal_uInt16                  mnSlidesNumber;
 };
 
 #endif //_SVDOMEDIA_HXX
diff --git a/svx/inc/svx/unoshprp.hxx b/svx/inc/svx/unoshprp.hxx
index 1b122ac..6034a56 100644
--- svx/inc/svx/unoshprp.hxx
+++ svx/inc/svx/unoshprp.hxx
@@ -191,4 +191,6 @@
 
 #define OWN_ATTR_EDGE_POLYPOLYGONBEZIER			(OWN_ATTR_VALUE_START+88)	// maximum is OWN_ATTR_VALUE_START+88, see svl/inc/svl/solar.hrc
 
+#define OWN_ATTR_MEDIA_SLIDES_NUMBER					(OWN_ATTR_VALUE_START+89)
+ 
 // #FontWork#
diff --git a/svx/source/svdraw/svdomedia.cxx b/svx/source/svdraw/svdomedia.cxx
index a25fc2d..108d96a 100644
--- svx/source/svdraw/svdomedia.cxx
+++ svx/source/svdraw/svdomedia.cxx
@@ -114,6 +114,7 @@ TYPEINIT1( SdrMediaObj, SdrRectObj );
 
 SdrMediaObj::SdrMediaObj()
 : mpSdrMediaLink( 0 )
+, mnSlidesNumber( 1 )
 {
 }
 
@@ -122,6 +123,7 @@ SdrMediaObj::SdrMediaObj()
 SdrMediaObj::SdrMediaObj( const Rectangle& rRect )
 : SdrRectObj( rRect )
 , mpSdrMediaLink( 0 )
+, mnSlidesNumber( 1 )
 {
 }
 
@@ -272,6 +274,20 @@ const ::rtl::OUString& SdrMediaObj::getURL() const
 
 // ------------------------------------------------------------------------------
 
+void SdrMediaObj::setSlidesNumber( sal_uInt16 nSlidesNumber )
+{
+    mnSlidesNumber = nSlidesNumber;
+}
+
+// ------------------------------------------------------------------------------
+
+sal_uInt16 SdrMediaObj::getSlidesNumber() const
+{
+    return mnSlidesNumber;
+}
+
+// ------------------------------------------------------------------------------
+
 void SdrMediaObj::setMediaProperties( const ::avmedia::MediaItem& rState )
 {
     mediaPropertiesChanged( rState );
diff --git a/svx/source/unodraw/unoprov.cxx b/svx/source/unodraw/unoprov.cxx
index 8daf660..2d4f764 100644
--- svx/source/unodraw/unoprov.cxx
+++ svx/source/unodraw/unoprov.cxx
@@ -747,6 +747,7 @@ SfxItemPropertyMapEntry* ImplGetSvxMediaShapePropertyMap()
         { MAP_CHAR_LEN(UNO_NAME_LINKDISPLAYNAME), OWN_ATTR_LDNAME, &::getCppuType(( const ::rtl::OUString*)0),	::com::sun::star::beans::PropertyAttribute::READONLY, 0},
         { MAP_CHAR_LEN("Transformation"), OWN_ATTR_TRANSFORMATION, &::getCppuType((const struct com::sun::star::drawing::HomogenMatrix3*)0), 0, 0 },
         { MAP_CHAR_LEN("MediaURL"),	OWN_ATTR_MEDIA_URL, &::getCppuType((const ::rtl::OUString*)0), 0, 0},
+        { MAP_CHAR_LEN("MediaSlidesNumber"),	OWN_ATTR_MEDIA_SLIDES_NUMBER, &::getCppuType((const sal_uInt16*)0), 0, 0},
         { MAP_CHAR_LEN("PreferredSize"), OWN_ATTR_MEDIA_PREFERREDSIZE, &::getCppuType((const ::com::sun::star::awt::Size*)0), ::com::sun::star::beans::PropertyAttribute::READONLY, 0},
         { MAP_CHAR_LEN("Loop"),	OWN_ATTR_MEDIA_LOOP, &::getCppuType((const sal_Bool*)0), 0, 0},
         { MAP_CHAR_LEN("Mute"),	OWN_ATTR_MEDIA_MUTE, &::getCppuType((const sal_Bool*)0), 0, 0},
diff --git a/svx/source/unodraw/unoshap4.cxx b/svx/source/unodraw/unoshap4.cxx
index d1662cf..874d8ec 100644
--- svx/source/unodraw/unoshap4.cxx
+++ svx/source/unodraw/unoshap4.cxx
@@ -862,7 +862,7 @@ SvxMediaShape::~SvxMediaShape() throw()
 
 bool SvxMediaShape::setPropertyValueImpl( const ::rtl::OUString& rName, const SfxItemPropertySimpleEntry* pProperty, const ::com::sun::star::uno::Any& rValue ) throw(::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::beans::PropertyVetoException, ::com::sun::star::lang::IllegalArgumentException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
-    if( (pProperty->nWID >= OWN_ATTR_MEDIA_URL) && (pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM) )
+    if( (pProperty->nWID >= OWN_ATTR_MEDIA_URL) && (pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM) || pProperty->nWID == OWN_ATTR_MEDIA_SLIDES_NUMBER )
     {
         SdrMediaObj* pMedia = static_cast< SdrMediaObj* >( mpObj.get() );
         ::avmedia::MediaItem aItem;
@@ -881,6 +881,17 @@ bool SvxMediaShape::setPropertyValueImpl( const ::rtl::OUString& rName, const Sf
         }
         break;
 
+        case OWN_ATTR_MEDIA_SLIDES_NUMBER:
+        {
+            sal_uInt16 nSlidesNumber;
+            if( rValue >>= nSlidesNumber )
+            {
+                bOk = true;
+                pMedia->setSlidesNumber( nSlidesNumber );
+            }
+        }
+        break;
+
         case( OWN_ATTR_MEDIA_LOOP ):
         {
             sal_Bool bLoop = sal_Bool();
@@ -951,7 +962,7 @@ bool SvxMediaShape::setPropertyValueImpl( const ::rtl::OUString& rName, const Sf
 
 bool SvxMediaShape::getPropertyValueImpl( const ::rtl::OUString& rName, const SfxItemPropertySimpleEntry* pProperty, ::com::sun::star::uno::Any& rValue ) throw(::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
-    if( ( pProperty->nWID >= OWN_ATTR_MEDIA_URL ) && ( pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM ) )
+    if( ( pProperty->nWID >= OWN_ATTR_MEDIA_URL ) && ( pProperty->nWID <= OWN_ATTR_MEDIA_ZOOM ) || pProperty->nWID == OWN_ATTR_MEDIA_SLIDES_NUMBER )
     {
         SdrMediaObj* pMedia = static_cast< SdrMediaObj* >( mpObj.get() );
         const ::avmedia::MediaItem aItem( pMedia->getMediaProperties() );
@@ -962,6 +973,10 @@ bool SvxMediaShape::getPropertyValueImpl( const ::rtl::OUString& rName, const Sf
                 rValue <<= aItem.getURL();
                 break;
 
+            case OWN_ATTR_MEDIA_SLIDES_NUMBER:
+                rValue <<= pMedia->getSlidesNumber();
+                break;
+
             case( OWN_ATTR_MEDIA_LOOP ):
                 rValue <<= (sal_Bool) aItem.isLoop();
                 break;
-- 
1.7.0.1

