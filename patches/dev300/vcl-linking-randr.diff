--- ./config_office/configure.in.randr~	2008-07-07 22:59:53.422096394 +0200
+++ ./config_office/configure.in	2008-07-07 23:01:37.984851576 +0200
@@ -269,8 +269,12 @@ AC_ARG_ENABLE(xrender-link,
 [  --enable-xrender-link   link with libXrender instead of dynamically open it
 ],,)
 AC_ARG_ENABLE(randr,
-[  --disable-randr          disable RandR support in the vcl project
+[  --disable-randr         disable RandR support in the vcl project
 ],,enable_randr=yes)
+AC_ARG_ENABLE(randr-link,
+[  --disable-randr-link    disable linking with libXrandr, instead dynamically 
+                           open it at runtime
+],,enable_randr_link=yes)
 AC_ARG_WITH(myspell-dicts,
 [  --without-myspell-dicts Removes myspell dictionaries from openoffice.org
                           installation set, for people building for specific
@@ -1191,18 +1195,6 @@ else
 fi
 AC_SUBST(ENABLE_FONTCONFIG)
 
-dnl ===================================================================
-dnl Build options
-dnl ===================================================================
-AC_MSG_CHECKING([whether to enable RandR support])
-if test "$test_randr" = "yes" -a \( "$enable_randr" = "yes" -o "$enable_randr" = "TRUE" \) ; then
-   ENABLE_RANDR="TRUE"
-   AC_MSG_RESULT([yes])
-else
-   ENABLE_RANDR=""
-   AC_MSG_RESULT([no])
-fi
-AC_SUBST(ENABLE_RANDR)
 
 dnl ===================================================================
 dnl Disable legacy binary file formats filters
@@ -1982,14 +1974,6 @@ if test "$test_cups" = "yes" -a "$ENABLE
 fi
 
 dnl ===================================================================
-dnl Check if X11/extensions/Xrandr.h is available 
-dnl ===================================================================
-if test "$test_randr" = "yes" -a "$ENABLE_RANDR" = "TRUE" ; then
-    AC_CHECK_HEADER(X11/extensions/Xrandr.h, [],
-                    [AC_MSG_ERROR([X11/extensions/Xrandr.h could not be found. X11 dev missing?])], [])
-fi
-
-dnl ===================================================================
 dnl Check if PAM/pam_appl.h is available on Linux or FreeBSD
 dnl ===================================================================
 if test "$_os" = "Linux" -o "$_os" = "FreeBSD" -o "$_os" = "GNU"; then
@@ -4614,6 +4598,37 @@ AC_SUBST(SYSTEM_XRENDER_HEADERS)
 AC_SUBST(XRENDER_LINK)
 
 dnl ===================================================================
+dnl Check for XRandr
+dnl ===================================================================
+AC_MSG_CHECKING([whether to enable RandR support])
+if test "$test_randr" = "yes" -a \( "$enable_randr" = "yes" -o "$enable_randr" = "TRUE" \) ; then
+   if test -z "$enable_randr_link" -o "$enable_randr_link" = "no"; then
+	  XRANDR_DLOPEN="TRUE"
+	  AC_MSG_RESULT([resorting to dlopen libXrandr at runtime])
+   else
+	  XRANDR_DLOPEN="FALSE"
+      PKG_CHECK_MODULES(XRANDR, xrandr >= 1.2, ENABLE_RANDR="TRUE", ENABLE_RANDR="")
+      if test "$ENABLE_RANDR" != "TRUE"; then
+         AC_CHECK_HEADER(X11/extensions/Xrandr.h, [],
+                        [AC_MSG_ERROR([X11/extensions/Xrandr.h could not be found. X11 dev missing?])], [])
+         XRANDR_CFLAGS=" "
+         AC_CHECK_LIB(Xrandr, XRRQueryExtension, [],
+              [ AC_MSG_ERROR(libXrandr not found or functional) ], [])
+         XRANDR_LIBS="-lXrandr "
+         ENABLE_RANDR="TRUE"
+	     AC_MSG_RESULT([enabling RandR support])
+      fi
+   fi
+else
+   ENABLE_RANDR=""
+   AC_MSG_RESULT([no])
+fi
+AC_SUBST(XRANDR_DLOPEN)
+AC_SUBST(XRANDR_CFLAGS)
+AC_SUBST(XRANDR_LIBS)
+AC_SUBST(ENABLE_RANDR)
+
+dnl ===================================================================
 dnl Check for system Mesa
 dnl ===================================================================
 AC_MSG_CHECKING([which Mesa headers to use])
--- ./config_office/set_soenv.in.randr~	2008-07-07 22:59:53.425096356 +0200
+++ ./config_office/set_soenv.in	2008-07-07 23:01:37.987846160 +0200
@@ -1964,6 +1964,9 @@ ToFile( "FREETYPE_LIBS",     "@FREETYPE_
 ToFile( "SYSTEM_CAIRO",      "@SYSTEM_CAIRO@",     "e" );
 ToFile( "CAIRO_CFLAGS",      "@CAIRO_CFLAGS@",     "e" );
 ToFile( "CAIRO_LIBS",        "@CAIRO_LIBS@",       "e" );
+ToFile( "XRANDR_CFLAGS",     "@XRANDR_CFLAGS@",    "e" );
+ToFile( "XRANDR_LIBS",       "@XRANDR_LIBS@",      "e" );
+ToFile( "XRANDR_DLOPEN",     "@XRANDR_DLOPEN@",    "e" );
 ToFile( "SYSTEM_LIBWPD",     "@SYSTEM_LIBWPD@",    "e" );
 ToFile( "LIBWPD_CFLAGS",     "@LIBWPD_CFLAGS@",    "e" );
 ToFile( "LIBWPD_LIBS",       "@LIBWPD_LIBS@",      "e" );
