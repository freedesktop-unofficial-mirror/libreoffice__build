Index: prj/build.lst
===================================================================
RCS file: /cvs/util/xmlhelp/prj/build.lst,v
retrieving revision 1.17
diff -u -u -r1.17 build.lst
--- xmlhelp/prj/build.lst	24 Jun 2008 16:17:30 -0000	1.17
+++ xmlhelp/prj/build.lst	27 Jun 2008 20:20:55 -0000
@@ -1,4 +1,4 @@
-xh	xmlhelp	:	ucbhelper LIBXSLT:libxslt jut unoil BERKELEYDB:berkeleydb svtools lucene NULL
+xh	xmlhelp	:	ucbhelper LIBXSLT:libxslt jut unoil BERKELEYDB:berkeleydb svtools LUCENE:lucene NULL
 xh	xmlhelp									usr1	-	all	xh_mkout NULL
 xh	xmlhelp\inc								nmake	-	all	xh_inc NULL
 xh	xmlhelp\source\treeview					nmake	-	all	xh_treeview xh_inc NULL
Index: source/com/sun/star/help/makefile.mk
===================================================================
RCS file: /cvs/util/xmlhelp/source/com/sun/star/help/makefile.mk,v
retrieving revision 1.36
diff -u -u -r1.36 makefile.mk
--- xmlhelp/source/com/sun/star/help/makefile.mk	24 Jun 2008 16:19:16 -0000	1.36
+++ xmlhelp/source/com/sun/star/help/makefile.mk	27 Jun 2008 20:20:55 -0000
@@ -100,7 +100,12 @@
 	$(CLASSDIR)$/$(PACKAGE)$/HelpIndexer.class			        \
 	$(CLASSDIR)$/$(PACKAGE)$/HelpFileDocument.class
 
-JARFILES  = lucene-core-2.3.jar ridl.jar jurt.jar unoil.jar juh.jar
+JARFILES  = ridl.jar jurt.jar unoil.jar juh.jar
+.IF "$(SYSTEM_LUCENE)" == "YES"
+JARFILES += lucene-core-2.3.jar
+.ELSE
+XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(LUCENE_CORE_JAR)
+.ENDIF
 JAVAFILES = $(subst,$(CLASSDIR)$/$(PACKAGE)$/, $(subst,.class,.java $(JAVACLASSFILES)))
   
 JARTARGET	   = LuceneHelpWrapper.jar
? unxlngx6.pro
Index: source/ooo/file_ooo.scp
===================================================================
RCS file: /cvs/installation/scp2/source/ooo/file_ooo.scp,v
retrieving revision 1.249
diff -u -u -r1.249 file_ooo.scp
--- scp2/source/ooo/file_ooo.scp	24 Jun 2008 16:25:44 -0000	1.249
+++ scp2/source/ooo/file_ooo.scp	27 Jun 2008 20:29:52 -0000
@@ -476,8 +476,10 @@
 #endif
 
 #ifdef SOLAR_JAVA
+#ifndef SYSTEM_LUCENE
 STD_JAR_FILE( gid_File_Jar_Lucene, lucene-core-2.3 )
 #endif
+#endif
 
 #ifdef SOLAR_JAVA
 UNO_JAR_FILE( gid_File_Jar_Lucenehelpwrapper, LuceneHelpWrapper )
--- scp2/source/ooo/makefile.mk	30 Jun 2008 15:24:20 -0000	1.70
+++ scp2/source/ooo/makefile.mk	30 Jun 2008 17:46:41 -0000
@@ -179,6 +179,10 @@
 SCPDEFS+=-DENABLE_CAIRO
 .ENDIF
 
+.IF "$(SYSTEM_LUCENE)" == "YES"
+SCPDEFS+=-DSYSTEM_LUCENE
+.ENDIF
+
 .IF "$(SYSTEM_ICU)" == "YES"
 SCPDEFS+=-DSYSTEM_ICU
 .ELSE
Index: configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.272
diff -u -u -r1.272 configure.in
--- config_office/configure.in	24 Jun 2008 11:59:33 -0000	1.272
+++ config_office/configure.in	27 Jun 2008 20:31:29 -0000
@@ -339,6 +339,13 @@
 AC_ARG_WITH(system-db,
 [  --with-system-db        Use berkeley db already on system
 ],,)
+AC_ARG_WITH(system-lucene,
+[  --with-system-lucene    Use hsqldb already on system
+],,)
+AC_ARG_WITH(lucene-core-jar,
+[  --with-lucene-core-jar=JARFILE   Specify path to jarfile manually ],
+[ LUCENE_CORE_JAR="$withval"
+])
 AC_ARG_WITH(system-hsqldb,
 [  --with-system-hsqldb    Use hsqldb already on system
 ],,)
@@ -3660,6 +3675,27 @@
 AC_SUBST(DB_JAR)
 
 dnl ===================================================================
+dnl Check for system lucene
+dnl ===================================================================
+AC_MSG_CHECKING([which lucene to use])
+if test -n "$with_system_lucene" -o -n "$with_system_libs" && \
+       test "$with_system_lucene" != "no" && test "$with_system_jars" != "no"; then
+        AC_MSG_RESULT([external])
+        SYSTEM_LUCENE=YES
+        if test -z $LUCENE_CORE_JAR; then
+               LUCENE_CORE_JAR=/usr/share/java/lucene-core-2.3.jar
+        fi
+        AC_CHECK_FILE($LUCENE_CORE_JAR, [],
+               [AC_MSG_ERROR(lucene-core.jar not found.)], [])
+else
+    AC_MSG_RESULT([internal])
+    SYSTEM_LUCENE=NO
+    BUILD_TYPE="$BUILD_TYPE LUCENE"
+fi
+AC_SUBST(SYSTEM_LUCENE)
+AC_SUBST(LUCENE_CORE_JAR)
+
+dnl ===================================================================
 dnl Check for system hsqldb
 dnl ===================================================================
 AC_MSG_CHECKING([which hsqldb to use])
Index: set_soenv.in
===================================================================
RCS file: /cvs/tools/config_office/set_soenv.in,v
retrieving revision 1.190
diff -u -u -r1.190 set_soenv.in
--- config_office/set_soenv.in	13 Jun 2008 14:11:11 -0000	1.190
+++ config_office/set_soenv.in	27 Jun 2008 20:31:29 -0000
@@ -1969,6 +1969,8 @@
 ToFile( "DB_INCLUDES",       "@DB_INCLUDES@",      "e" );
 ToFile( "SYSTEM_HSQLDB",     "@SYSTEM_HSQLDB@",    "e" );
 ToFile( "HSQLDB_JAR",        "@HSQLDB_JAR@",       "e" );
+ToFile( "SYSTEM_LUCENE",     "@SYSTEM_LUCENE@",    "e" );
+ToFile( "LUCENE_CORE_JAR",   "@LUCENE_CORE_JAR@",  "e" );
 ToFile( "SYSTEM_BSH",        "@SYSTEM_BSH@",       "e" );
 ToFile( "BSH_JAR",           "@BSH_JAR@",          "e" );
 ToFile( "SYSTEM_XML_APIS",   "@SYSTEM_XML_APIS@",  "e" );
Index: sdev300.ini
===================================================================
RCS file: /cvs/tools/solenv/config/sdev300.ini,v
retrieving revision 1.35
diff -u -u -r1.35 sdev300.ini
--- solenv/config/sdev300.ini	26 Jun 2008 11:21:33 -0000	1.35
+++ solenv/config/sdev300.ini	27 Jun 2008 20:35:10 -0000
@@ -91,7 +91,7 @@
 		{
 			BIG_SVX TRUE
 			BMP_WRITES_FLAG TRUE
-            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS BSH CURL DICTIONARIES FREETYPE HSQLDB HUNSPELL JPEG LIBXML2 LIBXMLSEC LPSOLVE MOZ NEON TWAIN PYTHON ZLIB SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK MSFONTEXTRACT MATHMLDTD BOOST EXPAT CRASHREP BERKELEYDB LIBXSLT XALAN SUN AGG GTK ICU SYSTRAY_GTK JAVAINSTALLER2 VIGRA OPENSSL JFREEREPORT APACHE_COMMONS TOMCAT REPORTDESIGN SDEXT SWEXT XPDF
+            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS BSH CURL DICTIONARIES FREETYPE HSQLDB HUNSPELL JPEG LIBXML2 LIBXMLSEC LPSOLVE MOZ NEON TWAIN PYTHON ZLIB SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK MSFONTEXTRACT MATHMLDTD BOOST EXPAT CRASHREP BERKELEYDB LIBXSLT XALAN SUN AGG GTK ICU SYSTRAY_GTK JAVAINSTALLER2 VIGRA OPENSSL JFREEREPORT APACHE_COMMONS TOMCAT REPORTDESIGN SDEXT SWEXT XPDF LUCENE
 			RES_ENUS TRUE
 			RES_GER TRUE
 			NO_REC_RES TRUE
Index: settings.pmk
===================================================================
RCS file: /cvs/documentation/helpcontent2/settings.pmk,v
retrieving revision 1.10
diff -u -u -r1.10 settings.pmk
--- helpcontent2/settings.pmk	24 Jun 2008 16:16:09 -0000	1.10
+++ helpcontent2/settings.pmk	28 Jun 2008 00:37:39 -0000
@@ -1,6 +1,11 @@
 .INCLUDE : $(INCCOM)$/aux_langs.mk
 
-my_cp:=$(CLASSPATH)$(PATH_SEPERATOR)$(SOLARBINDIR)$/jaxp.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/parser.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/unoil.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/ridl.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jurt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jut.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlsearch.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/LuceneHelpWrapper.jar$(PATH_SEPERATOR)$(SOLARBINDIR)/lucene-core-2.3.jar
+my_cp:=$(CLASSPATH)$(PATH_SEPERATOR)$(SOLARBINDIR)$/jaxp.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/parser.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/unoil.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/ridl.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jurt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jut.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlsearch.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/LuceneHelpWrapper.jar$
+.IF "$(SYSTEM_LUCENE)" == "YES"
+my_cp!:=$(my_cp)$(PATH_SEPERATOR)$(LUCENE_CORE_JAR)
+.ELSE
+my_cp!:=$(my_cp)$(PATH_SEPERATOR)$(SOLARBINDIR)/lucene-core-2.3.jar
+.ENDIF
  
 .IF "$(SYSTEM_DB)" != "YES"
 JAVA_LIBRARY_PATH= -Djava.library.path=$(SOLARSHAREDBIN)
