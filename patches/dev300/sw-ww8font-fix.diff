From 2e0b785cd39b47c73303c504abb76c36869261be Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:07 +0200
Subject: [PATCH 117/768] sw-ww8font-fix.diff

---
 sw/source/filter/ww8/ww8scan.cxx |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git sw/source/filter/ww8/ww8scan.cxx sw/source/filter/ww8/ww8scan.cxx
index 5fd6d59..58af49c 100644
--- sw/source/filter/ww8/ww8scan.cxx
+++ sw/source/filter/ww8/ww8scan.cxx
@@ -32,6 +32,7 @@
 
 
 #include <functional>
+#include <algorithm>
 
 #include <string.h>         // memset()
 #include <rtl/tencinfo.h>
@@ -6400,8 +6401,10 @@ WW8Fonts::WW8Fonts( SvStream& rSt, WW8Fib& rFib )
 #ifdef __WW8_NEEDS_COPY
                 {
                     BYTE nLen = 0x28;
+                    BYTE nLength = sizeof( pVer8->szFfn ) / sizeof( SVBT16 );
+                    nLength = std::min( nLength, BYTE( pVer8->cbFfnM1+1 ) );
                     for( UINT16* pTmp = pVer8->szFfn;
-                        nLen < pVer8->cbFfnM1 + 1 ; ++pTmp, nLen+=2 )
+                        nLen < nLength; ++pTmp, nLen+=2 )
                     {
                         *pTmp = SVBT16ToShort( *(SVBT16*)pTmp );
                     }
-- 
1.7.0.1

