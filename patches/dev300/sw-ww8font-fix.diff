From 91f4fce09c4818430fe1f8237ac1846f63a2407c Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:07 +0200
Subject: [PATCH 141/878] sw-ww8font-fix.diff

---
 sw/source/filter/ww8/ww8scan.cxx |    5 ++++-
 1 files changed, 4 insertions(+), 1 deletions(-)

diff --git a/sw/source/filter/ww8/ww8scan.cxx b/sw/source/filter/ww8/ww8scan.cxx
index 973e417..f28d9b8 100644
--- a/sw/source/filter/ww8/ww8scan.cxx
+++ b/sw/source/filter/ww8/ww8scan.cxx
@@ -32,6 +32,7 @@
 
 
 #include <functional>
+#include <algorithm>
 
 #include <string.h>         // memset()
 #include <rtl/tencinfo.h>
@@ -6399,8 +6400,10 @@ WW8Fonts::WW8Fonts( SvStream& rSt, WW8Fib& rFib )
 #ifdef __WW8_NEEDS_COPY
                 {
                     BYTE nLen = 0x28;
+                    BYTE nLength = sizeof( pVer8->szFfn ) / sizeof( SVBT16 );
+                    nLength = std::min( nLength, BYTE( pVer8->cbFfnM1+1 ) );
                     for( UINT16* pTmp = pVer8->szFfn;
-                        nLen < pVer8->cbFfnM1 + 1 ; ++pTmp, nLen+=2 )
+                        nLen < nLength; ++pTmp, nLen+=2 )
                     {
                         *pTmp = SVBT16ToShort( *(SVBT16*)pTmp );
                     }
-- 
1.7.0.1

