From 7fdfc795dcb84ff47d1957de08a105ac019f600e Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:54:18 +0200
Subject: [PATCH 098/878] padmin-nofontconfig.diff

---
 padmin/source/makefile.mk  |    8 +++++++-
 padmin/source/padialog.cxx |   12 +++++++++++-
 padmin/source/padialog.hxx |    2 ++
 3 files changed, 20 insertions(+), 2 deletions(-)

diff --git a/padmin/source/makefile.mk b/padmin/source/makefile.mk
index 6bf5cd3..4c5ba2b 100644
--- a/padmin/source/makefile.mk
+++ b/padmin/source/makefile.mk
@@ -43,6 +43,10 @@ LIBTARGET=NO
 
 .INCLUDE: settings.mk
 
+.IF "$(FONTCONFIG_FONTS)" != ""
+CFLAGS+=-DFONTCONFIG_FONTS
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 SRS1NAME=$(TARGET)
@@ -65,11 +69,13 @@ SLOFILES=\
     $(SLO)$/progress.obj		\
     $(SLO)$/newppdlg.obj		\
     $(SLO)$/prtsetup.obj		\
-    $(SLO)$/fontentry.obj		\
     $(SLO)$/helper.obj			\
     $(SLO)$/adddlg.obj			\
     $(SLO)$/titlectrl.obj
 
+.IF "$(FONTCONFIG_FONTS)" == ""
+SLOFILES+= $(SLO)$/fontentry.obj
+.ENDIF
 
 OBJFILES=\
     $(OBJ)/pamain.obj
diff --git a/padmin/source/padialog.cxx b/padmin/source/padialog.cxx
index da28ab3..8e109f5 100644
--- a/padmin/source/padialog.cxx
+++ b/padmin/source/padialog.cxx
@@ -31,7 +31,11 @@
 #include <string.h>
 #include <math.h>
 
+#include "tools/urlobj.hxx"
+
+#ifndef FONTCONFIG_FONTS
 #include "padialog.hrc"
+#endif
 #include "fontentry.hxx"
 #include "helper.hxx"
 #include "padialog.hxx"
@@ -89,7 +93,9 @@ PADialog::PADialog( Window* pParent, BOOL /*bAdmin*/ ) :
         m_aCUPSCB( this, PaResId( RID_PA_CB_CUPSUSAGE ) ),
         m_aSepButtonFL( this, PaResId( RID_PA_FL_SEPBUTTON ) ),
         m_aAddPB( this, PaResId( RID_PA_BTN_ADD ) ),
+    #ifndef FONTCONFIG_FONTS
         m_aFontsPB( this, PaResId( RID_PA_BTN_FONTS ) ),
+    #endif
         m_aCancelButton( this, PaResId( RID_PA_BTN_CANCEL ) ),
         m_aDefPrt( PaResId( RID_PA_STR_DEFPRT ) ),
         m_aRenameStr( PaResId( RID_PA_STR_RENAME ) ),
@@ -135,14 +141,16 @@ void PADialog::Init()
     m_aConfPB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
     m_aRenamePB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
     m_aTestPagePB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
-    m_aFontsPB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
     m_aAddPB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
     m_aDevicesLB.setDelPressedLink( LINK( this, PADialog, DelPressedHdl ) );
     m_aCUPSCB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
 
+     #ifndef FONTCONFIG_FONTS
+        m_aFontsPB.SetClickHdl( LINK( this, PADialog, ClickBtnHdl ) );
     ::psp::PrintFontManager& rFontManager( ::psp::PrintFontManager::get() );
     if( ! rFontManager.checkImportPossible() )
         m_aFontsPB.Enable( FALSE );
+     #endif
 }
 
 PADialog::~PADialog()
@@ -208,11 +216,13 @@ IMPL_LINK( PADialog, ClickBtnHdl, PushButton*, pButton )
         PrintTestPage();
     else if( pButton == &m_aAddPB )
         AddDevice();
+     #ifndef FONTCONFIG_FONTS
     else if( pButton == &m_aFontsPB )
     {
         FontNameDlg aDialog( this );
         aDialog.Execute();
     }
+     #endif
     else if( static_cast<Button*>(pButton) == &m_aCUPSCB )
     {
         m_rPIManager.setCUPSDisabled( m_aCUPSCB.IsChecked() );
diff --git a/padmin/source/padialog.hxx b/padmin/source/padialog.hxx
index 51f4883..824ae45 100644
--- a/padmin/source/padialog.hxx
+++ b/padmin/source/padialog.hxx
@@ -74,7 +74,9 @@ namespace padmin {
 
         FixedLine							m_aSepButtonFL;
         PushButton							m_aAddPB;
+#ifndef FONTCONFIG_FONTS
         PushButton							m_aFontsPB;
+#endif
         CancelButton  						m_aCancelButton;
 
         String								m_aDefPrt;
-- 
1.7.0.1

