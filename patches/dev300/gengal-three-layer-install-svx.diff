diff --git a/source/gengal/gengal.cxx b/source/gengal/gengal.cxx
index 70c270a..67e4112 100644
--- svx/source/gengal/gengal.cxx
+++ svx/source/gengal/gengal.cxx
@@ -84,23 +84,12 @@ class GalApp : public Application
 {
 public:
 	virtual void Main();
-};
-
-Reference< XMultiServiceFactory > createApplicationServiceManager()
-{
-    Reference< XMultiServiceFactory > xMS;
-	try
-	{
-		Reference< XComponentContext > xComponentContext = ::cppu::defaultBootstrap_InitialComponentContext();
-        if ( xComponentContext.is() )
-		    xMS = xMS.query( xComponentContext->getServiceManager() );
-	}
-	catch( ::com::sun::star::uno::Exception& )
-	{
-	}
 
-	return xMS;
-}
+protected:
+    Reference<XMultiServiceFactory> xMSF;
+    void Init();
+    void InitUCB();
+};
 
 Gallery* createGallery( const rtl::OUString& aGalleryURL )
 {
@@ -239,31 +228,30 @@ static OUString Smartify( const OUString &rPath )
 	return aURL.GetMainURL( INetURLObject::NO_DECODE );
 }
 
-// Cut/paste [ evilness ] from Desktop::CreateApplicationServiceManager()
-Reference< XMultiServiceFactory > CreateApplicationServiceManager()
-{
-	try
-	{
-		Reference<XComponentContext> xComponentContext = ::cppu::defaultBootstrap_InitialComponentContext();
-		Reference<XMultiServiceFactory> xMS(xComponentContext->getServiceManager(), UNO_QUERY);
-
-		return xMS;
-	}
-	catch( ::com::sun::star::uno::Exception& )
-	{
-	}
-
-	return Reference< XMultiServiceFactory >();
-}
+#define OUSTRING_CSTR( str ) \
+    rtl::OUStringToOString( str, RTL_TEXTENCODING_ASCII_US ).getStr()
 
-void GalApp::Main()
+void GalApp::Init()
 {
-	Reference<XComponentContext> xComponentContext = ::cppu::defaultBootstrap_InitialComponentContext();
-	Reference<XMultiServiceFactory> xMSF(xComponentContext->getServiceManager(), UNO_QUERY);
+    OUString fileName = GetAppFileName();
+    OUString baseBinDir = fileName.copy( 0, fileName.lastIndexOf( '/' ) );
+    OUString installPrefix = baseBinDir + OUString::createFromAscii( "/../.." );
+    setenv( "OOO_INSTALL_PREFIX", OUSTRING_CSTR( installPrefix ), 0 );
+    OSL_TRACE( "OOO_INSTALL_PREFIX=%s", getenv( "OOO_INSTALL_PREFIX" ) );
+
+	Reference<XComponentContext> xComponentContext
+        = ::cppu::defaultBootstrap_InitialComponentContext();
+	xMSF = Reference<XMultiServiceFactory>
+        ( xComponentContext->getServiceManager(), UNO_QUERY );
 	if( !xMSF.is() )
 		fprintf( stderr, "Failed to bootstrap\n" );
 	::comphelper::setProcessServiceFactory( xMSF );
-	
+
+    InitUCB();
+}
+
+void GalApp::InitUCB()
+{
 	OUString aEmpty;
 	Sequence< Any > aArgs(6);
 	aArgs[0]
@@ -277,7 +265,10 @@ void GalApp::Main()
 
 	if (! ::ucbhelper::ContentBroker::initialize( xMSF, aArgs ) )
 		fprintf( stderr, "Failed to init content broker\n" );
+}
 
+void GalApp::Main()
+{
 	bool bHelp = false;
 	rtl::OUString aPath, aDestDir;
 	rtl::OUString aName = rtl::OUString::createFromAscii( "Default name" );
diff --git a/source/gengal/gengal.sh b/source/gengal/gengal.sh
index e7b3a81..9e614ee 100644
--- svx/source/gengal/gengal.sh
+++ svx/source/gengal/gengal.sh
@@ -98,5 +98,8 @@ unset XENVIRONMENT
 PATH="$sd_prog":$PATH
 export PATH
 
+OOO_INSTALL_PREFIX=${OOO_INSTALL_PREFIX-$sd_prog/../..}
+export OOO_INSTALL_PREFIX
+
 # execute binary
 exec "$sd_prog/$sd_binary" "$@"
diff --git a/source/gengal/gengalrc.in b/source/gengal/gengalrc.in
new file mode 100644
index 0000000..00ae5eb
--- /dev/null
+++ svx/source/gengal/gengalrc.in
@@ -0,0 +1,12 @@
+OOO_INSTALL_PREFIX_URL=file://${OOO_INSTALL_PREFIX}
+OOO_BASIS_URL=${OOO_INSTALL_PREFIX_URL}/basis-link
+OOO_BASIS_BIN_URL=${OOO_BASIS_URL}/program
+OOO_URE_URL=${OOO_BASIS_URL}/ure-link
+#
+#CFG_INIFILE=${OOO_BASIS_BIN_URL}/configmgrrc
+#BaseInstallation=${OOO_BASIS_URL}
+BRAND_BASE_DIR=${OOO_INSTALL_PREFIX_URL}
+OOO_BASE_DIR=${OOO_BASIS_URL}
+#
+UNO_TYPES=${OOO_URE_URL}/share/misc/types.rdb ${OOO_BASIS_BIN_URL}/offapi.rdb
+UNO_SERVICES=${OOO_URE_URL}/share/misc/services.rdb ${OOO_BASIS_BIN_URL}/services.rdb
diff --git a/source/gengal/makefile.mk b/source/gengal/makefile.mk
index d84b3f4..cb17531 100644
--- svx/source/gengal/makefile.mk
+++ svx/source/gengal/makefile.mk
@@ -83,8 +83,12 @@ APP1STDLIBS=$(TOOLSLIB) 		\
 .INCLUDE :	target.mk
 
 ALLTAR : \
-	$(SCRIPTFILES)
+	$(SCRIPTFILES)\
+	$(BIN)/gengalrc
 
 $(SCRIPTFILES) : $$(@:f:+".sh")
 	@tr -d "\015" < $(@:f:+".sh") > $@
 
+$(BIN)/%: %.in
+	cp $< $@
+
