---
 sfx2/source/dialog/mailmodel.cxx          |   10 ++++++++--
 shell/source/win32/simplemail/senddoc.cxx |   17 ++++++++++++++---
 2 files changed, 22 insertions(+), 5 deletions(-)

diff --git sfx2/source/dialog/mailmodel.cxx sfx2/source/dialog/mailmodel.cxx
index cea40e6..a4ec594 100644
--- sfx2/source/dialog/mailmodel.cxx
+++ sfx2/source/dialog/mailmodel.cxx
@@ -847,8 +847,14 @@ SfxMailModel::SendMailResult SfxMailModel::Send( const css::uno::Reference< css:
                     }
 
                     Sequence< OUString > aAttachmentSeq(&(maAttachedDocuments[0]),maAttachedDocuments.size());
-
-                    xSimpleMailMessage->setSubject( maSubject );
+ 
+                    if ( xSimpleMailMessage->getSubject().getLength() == 0 ) {
+                        OUString baseName( maAttachedDocuments[0].copy( maAttachedDocuments[0].lastIndexOf( '/' ) + 1 ) );
+                        OUString subject( baseName );
+                        if ( maAttachedDocuments.size() > 1 )
+                            subject += OUString::createFromAscii( ", ..." );
+                        xSimpleMailMessage->setSubject( subject );
+                    }
                     xSimpleMailMessage->setAttachement( aAttachmentSeq );
 
                     sal_Bool bSend( sal_False );
diff --git shell/source/win32/simplemail/senddoc.cxx shell/source/win32/simplemail/senddoc.cxx
index 0b51c58..9338669 100644
--- shell/source/win32/simplemail/senddoc.cxx
+++ shell/source/win32/simplemail/senddoc.cxx
@@ -29,6 +29,9 @@
 #include <osl/diagnose.h>
 #include <sal/macros.h>
 #include <rtl/string.hxx>
+#include <rtl/ustring.hxx>
+#include <rtl/uri.hxx>
+#include <osl/thread.hxx>
 
 #include "simplemapi.hxx"
 
@@ -167,7 +168,17 @@ void initMapiMessage(
 {
     ZeroMemory(pMapiMessage, sizeof(MapiMessage));
              
-    pMapiMessage->lpszSubject = const_cast<char*>(gSubject.c_str());   
+    try {
+         rtl_uString *subject = NULL;
+         rtl_uString_newFromAscii(&subject, const_cast<char*>(gSubject.c_str()));
+         rtl_uString *decoded_subject = NULL;
+         rtl_uriDecode(subject, rtl_UriDecodeWithCharset, RTL_TEXTENCODING_UTF8, &decoded_subject);
+         rtl::OUString ou_subject(decoded_subject);
+         pMapiMessage->lpszSubject = strdup(OUStringToOString(ou_subject, osl_getThreadTextEncoding(), RTL_UNICODETOTEXT_FLAGS_UNDEFINED_QUESTIONMARK).getStr());
+    }
+    catch (...) {
+    pMapiMessage->lpszSubject = const_cast<char*>(gSubject.c_str());
+    }
     pMapiMessage->lpszNoteText = (gBody.length() ? const_cast<char*>(gBody.c_str()) : NULL);
     pMapiMessage->lpOriginator = aMapiOriginator;       
     pMapiMessage->lpRecips = &aMapiRecipientList[0];
-- 
1.7.0.1

