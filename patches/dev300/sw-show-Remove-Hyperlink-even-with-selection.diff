From 1a66270512e93cef9698ff1cbd6eeca510f06678 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:55:08 +0200
Subject: [PATCH 142/878] sw-show-Remove-Hyperlink-even-with-selection.diff

---
 sw/source/ui/shells/textsh1.cxx |   15 ++++++++++++++-
 1 files changed, 14 insertions(+), 1 deletions(-)

diff --git a/sw/source/ui/shells/textsh1.cxx b/sw/source/ui/shells/textsh1.cxx
index 5213fa0..33ee275 100644
--- a/sw/source/ui/shells/textsh1.cxx
+++ b/sw/source/ui/shells/textsh1.cxx
@@ -1541,7 +1541,6 @@ void SwTextShell::GetState( SfxItemSet &rSet )
                                 GetViewFrame()->GetChildWindow( nWhich ) ));
                 break;
             case FN_EDIT_HYPERLINK:
-            case FN_REMOVE_HYPERLINK:
             case FN_COPY_HYPERLINK_LOCATION:
             {
                 SfxItemSet aSet(GetPool(),
@@ -1554,6 +1553,20 @@ void SwTextShell::GetState( SfxItemSet &rSet )
                 }
             }
             break;
+            case FN_REMOVE_HYPERLINK:
+            {
+                SfxItemSet aSet(GetPool(),
+                                RES_TXTATR_INETFMT,
+                                RES_TXTATR_INETFMT);
+                rSh.GetCurAttr(aSet);
+
+        // If a hyperlink is selected, either alone or along with other text...
+                if( ((SFX_ITEM_DONTCARE & aSet.GetItemState( RES_TXTATR_INETFMT, TRUE )) == 0) || rSh.HasReadonlySel())
+                {
+                    rSet.DisableItem(nWhich);
+                }
+            }
+            break;
             case SID_TRANSLITERATE_HALFWIDTH:
             case SID_TRANSLITERATE_FULLWIDTH:
             case SID_TRANSLITERATE_HIRAGANA:
-- 
1.7.0.1

