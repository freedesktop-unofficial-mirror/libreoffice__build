From 2c7b7d2d2a71ca0315348b5824c460457c3dc5e6 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:07:37 +0200
Subject: [PATCH 772/878] always-save-option-svtools.diff

---
 svtools/inc/svtools/miscopt.hxx   |    3 ++
 svtools/source/config/miscopt.cxx |   42 +++++++++++++++++++++++++++++++++++-
 2 files changed, 43 insertions(+), 2 deletions(-)

diff --git a/svtools/inc/svtools/miscopt.hxx b/svtools/inc/svtools/miscopt.hxx
index 2c4dafb..5f3416d 100644
--- a/svtools/inc/svtools/miscopt.hxx
+++ b/svtools/inc/svtools/miscopt.hxx
@@ -146,6 +146,9 @@ class SVT_DLLPUBLIC SvtMiscOptions: public svt::detail::Options
         void        SetShowLinkWarningDialog( sal_Bool bSet );
         sal_Bool    IsShowLinkWarningDialogReadOnly() const;
 
+        void        SetSaveAlwaysAllowed( sal_Bool bSet );
+        sal_Bool    IsSaveAlwaysAllowed() const;
+
     //-------------------------------------------------------------------------------------------------------------
     //	private methods
     //-------------------------------------------------------------------------------------------------------------
diff --git a/svtools/source/config/miscopt.cxx b/svtools/source/config/miscopt.cxx
index c6cb486..109d503 100644
--- a/svtools/source/config/miscopt.cxx
+++ b/svtools/source/config/miscopt.cxx
@@ -88,8 +88,10 @@ using namespace ::com::sun::star;
 #define PROPERTYHANDLE_SHOWLINKWARNINGDIALOG 7
 #define PROPERTYNAME_DISABLEUICUSTOMIZATION	ASCII_STR("DisableUICustomization")
 #define PROPERTYHANDLE_DISABLEUICUSTOMIZATION			8
+#define PROPERTYNAME_ALWAYSALLOWSAVE ASCII_STR("AlwaysAllowSave")
+#define PROPERTYHANDLE_ALWAYSALLOWSAVE 9
 
-#define PROPERTYCOUNT						9
+#define PROPERTYCOUNT                       10
 
 #define VCL_TOOLBOX_STYLE_FLAT				((USHORT)0x0004) // from <vcl/toolbox.hxx>
 
@@ -123,6 +125,7 @@ class SvtMiscOptions_Impl : public ConfigItem
     sal_Bool    m_bShowLinkWarningDialog;
     sal_Bool    m_bIsShowLinkWarningDialogRO;
     sal_Bool    m_bDisableUICustomization;
+    sal_Bool    m_bAlwaysAllowSave;
 
     //-------------------------------------------------------------------------------------------------------------
     //	public methods
@@ -203,6 +206,12 @@ class SvtMiscOptions_Impl : public ConfigItem
         inline sal_Bool DisableUICustomization() const
         { return m_bDisableUICustomization; }
 
+        inline void SetSaveAlwaysAllowed( sal_Bool bSet )
+        { m_bAlwaysAllowSave = bSet; SetModified(); }
+
+        inline sal_Bool IsSaveAlwaysAllowed() const
+        { return m_bAlwaysAllowSave; }
+
         inline sal_Bool IsPluginsEnabled() const
         { return m_bPluginsEnabled; }
 
@@ -349,6 +358,7 @@ SvtMiscOptions_Impl::SvtMiscOptions_Impl()
     , m_bIsUseSystemPrintDialogRO( sal_False )
     , m_bShowLinkWarningDialog( sal_True )
     , m_bIsShowLinkWarningDialogRO( sal_False )
+    , m_bAlwaysAllowSave( sal_False )
 
 {
     // Use our static list of configuration keys to get his values.
@@ -460,6 +470,12 @@ SvtMiscOptions_Impl::SvtMiscOptions_Impl()
                     DBG_ERROR("Wrong type of \"Misc\\DisableUICustomization\"!" );
                     break;
             }
+            case PROPERTYHANDLE_ALWAYSALLOWSAVE :
+            {
+                if( !(seqValues[nProperty] >>= m_bAlwaysAllowSave) )
+                    DBG_ERROR("Wrong type of \"Misc\\AlwaysAllowSave\"!" );
+                    break;
+            }
         }
     }
 
@@ -580,6 +596,12 @@ void SvtMiscOptions_Impl::Load( const Sequence< OUString >& rPropertyNames )
                                                                 DBG_ERROR("Wrong type of \"Misc\\DisableUICustomization\"!" );
                                                         }
                                                     break;
+            case PROPERTYHANDLE_ALWAYSALLOWSAVE:
+            {
+                if( !(seqValues[nProperty] >>= m_bAlwaysAllowSave) )
+                    DBG_ERROR("Wrong type of \"Misc\\AlwaysAllowSave\"!" );
+            }
+            break;
         }
     }
 }
@@ -749,6 +771,11 @@ void SvtMiscOptions_Impl::Commit()
                 seqValues[nProperty] <<= m_bDisableUICustomization;
                 break;
             }
+            case PROPERTYHANDLE_ALWAYSALLOWSAVE :
+            {
+                seqValues[nProperty] <<= m_bAlwaysAllowSave;
+                break;
+            }
         }
     }
     // Set properties in configuration.
@@ -771,7 +798,8 @@ Sequence< OUString > SvtMiscOptions_Impl::GetPropertyNames()
         PROPERTYNAME_USESYSTEMPRINTDIALOG,
         PROPERTYNAME_TRYODMADIALOG,
         PROPERTYNAME_SHOWLINKWARNINGDIALOG,
-        PROPERTYNAME_DISABLEUICUSTOMIZATION
+        PROPERTYNAME_DISABLEUICUSTOMIZATION,
+        PROPERTYNAME_ALWAYSALLOWSAVE
     };
 
     // Initialize return sequence with these list ...
@@ -977,6 +1005,16 @@ sal_Bool SvtMiscOptions::IsShowLinkWarningDialogReadOnly() const
     return m_pDataContainer->IsShowLinkWarningDialogReadOnly();
 }
 
+void SvtMiscOptions::SetSaveAlwaysAllowed( sal_Bool bSet )
+{
+    m_pDataContainer->SetSaveAlwaysAllowed( bSet );
+}
+
+sal_Bool SvtMiscOptions::IsSaveAlwaysAllowed() const
+{
+    return m_pDataContainer->IsSaveAlwaysAllowed();
+}
+
 //*****************************************************************************************************************
 //	private method
 //*****************************************************************************************************************
-- 
1.7.0.1

