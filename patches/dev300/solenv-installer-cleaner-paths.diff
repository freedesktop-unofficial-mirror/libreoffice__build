From 11723b79f6417dd094a9dd272f5a8937749ac254 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:57:41 +0200
Subject: [PATCH 246/768] solenv-installer-cleaner-paths.diff

---
 solenv/bin/modules/installer/worker.pm |   17 ++++++++++++++---
 1 files changed, 14 insertions(+), 3 deletions(-)

diff --git solenv/bin/modules/installer/worker.pm solenv/bin/modules/installer/worker.pm
index 89ce484..c162710 100644
--- solenv/bin/modules/installer/worker.pm
+++ solenv/bin/modules/installer/worker.pm
@@ -772,9 +772,16 @@ sub install_simple ($$$$$$)
     
         if ((!($dir =~ /\bPREDEFINED_/ )) || ( $dir =~ /\bPREDEFINED_PROGDIR\b/ ))
         {
-            # printf "mkdir $destdir$onedir->{'HostName'}\n";
-            mkdir $destdir . $onedir->{'HostName'};
-            push @lines, "%dir " . $onedir->{'HostName'} . "\n";
+            my $hostname = $onedir->{'HostName'};
+
+            # ignore '.' subdirectories
+            next if ( $hostname =~ m/\.$/ );
+            # remove './' from the path
+            $hostname =~ s/\.\///g;
+
+            # printf "mkdir $destdir$hostname\n";
+            mkdir $destdir . $hostname;
+            push @lines, "%dir " . $hostname . "\n";
         }
     }
 
@@ -791,6 +798,10 @@ sub install_simple ($$$$$$)
         $destination =~ s/\$\$/\$/;
         $sourcepath =~ s/\$\$/\$/;
 
+        # remove './' from the path
+        $sourcepath =~ s/\.\///g;
+        $destination =~ s/\.\///g;
+
         push @lines, "$destination\n";
         # printf "cp $sourcepath $destdir$destination\n";
         copy ("$sourcepath", "$destdir$destination") || die "Can't copy file: $sourcepath -> $destdir$destination $!";
-- 
1.7.0.1

