From 0192a12956e11433c2c301aa12ffb2e94d9e1d63 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:06:32 +0200
Subject: [PATCH 717/878] oox-pptx-import-fix-text-body-properties-priority.diff

---
 oox/source/drawingml/shape.cxx                     |    2 +-
 oox/source/drawingml/textbodypropertiescontext.cxx |   12 ++++++++----
 2 files changed, 9 insertions(+), 5 deletions(-)

diff --git a/oox/source/drawingml/shape.cxx b/oox/source/drawingml/shape.cxx
index f914c46..da6901e 100644
--- a/oox/source/drawingml/shape.cxx
+++ b/oox/source/drawingml/shape.cxx
@@ -458,7 +458,6 @@ Reference< XShape > Shape::createAndInsert(
         PropertyMap aShapeProperties;
         PropertyMap::const_iterator	aShapePropIter;
 
-        aShapeProperties.insert( getShapeProperties().begin(), getShapeProperties().end() );
         if( mxCreateCallback.get() )
         {
             for ( aShapePropIter = mxCreateCallback->getShapeProperties().begin();
@@ -474,6 +473,7 @@ Reference< XShape > Shape::createAndInsert(
                 aShapeProperties[ (*aShapePropIter).first ] = (*aShapePropIter).second;		
         }
 
+        aShapeProperties.insert( getShapeProperties().begin(), getShapeProperties().end() );
         // applying properties
         PropertySet aPropSet( xSet );
         if ( aServiceName == OUString::createFromAscii( "com.sun.star.drawing.GraphicObjectShape" ) )
diff --git a/oox/source/drawingml/textbodypropertiescontext.cxx b/oox/source/drawingml/textbodypropertiescontext.cxx
index 40583fc..7deaa58 100644
--- a/oox/source/drawingml/textbodypropertiescontext.cxx
+++ b/oox/source/drawingml/textbodypropertiescontext.cxx
@@ -66,21 +66,25 @@ TextBodyPropertiesContext::TextBodyPropertiesContext( ContextHandler& rParent,
     // ST_Coordinate
     OUString sValue;
     sValue = xAttributes->getOptionalValue( XML_lIns );
+    if( sValue.getLength() ) {
     sal_Int32 nLeftInset = ( sValue.getLength() != 0 ? GetCoordinate(  sValue ) : 91440 / 360 );
     mrTextBodyProp.maPropertyMap[ PROP_TextLeftDistance ]  <<= static_cast< sal_Int32 >( nLeftInset );
-
+    }
     sValue = xAttributes->getOptionalValue( XML_tIns );
+    if( sValue.getLength() ) {
     sal_Int32 nTopInset  = ( sValue.getLength() != 0 ? GetCoordinate(  sValue ) : 91440 / 360 );
     mrTextBodyProp.maPropertyMap[ PROP_TextUpperDistance ] <<= static_cast< sal_Int32 >( nTopInset );
-
+    }
     sValue = xAttributes->getOptionalValue( XML_rIns );
+    if( sValue.getLength() ) {
     sal_Int32 nRightInset  = ( sValue.getLength() != 0 ? GetCoordinate(  sValue ) : 91440 / 360 );
     mrTextBodyProp.maPropertyMap[ PROP_TextRightDistance ] <<= static_cast< sal_Int32 >( nRightInset );
-
+    }
     sValue = xAttributes->getOptionalValue( XML_bIns );
+    if( sValue.getLength() ) {
     sal_Int32 nBottonInset = ( sValue.getLength() != 0 ? GetCoordinate(  sValue ) : 45720 / 360 );
     mrTextBodyProp.maPropertyMap[ PROP_TextLowerDistance ] <<= static_cast< sal_Int32 >( nBottonInset );
-
+    }
 
     // ST_TextAnchoringType
     mrTextBodyProp.maPropertyMap[ PROP_TextVerticalAdjust ] <<= GetTextVerticalAdjust( xAttributes->getOptionalValueToken( XML_anchor, XML_t ) );
-- 
1.7.0.1

