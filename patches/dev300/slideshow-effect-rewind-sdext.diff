From d8efe5703fdb53ffbe2a5c2c1c358323696a7a5f Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:54:07 +0200
Subject: [PATCH 088/878] slideshow-effect-rewind-sdext.diff

---
 sdext/source/presenter/PresenterController.cxx     |   13 +++++++++++--
 .../presenter/PresenterCurrentSlideObserver.cxx    |    4 ++--
 .../presenter/PresenterCurrentSlideObserver.hxx    |    2 +-
 sdext/source/presenter/description.xml             |    4 ++--
 4 files changed, 16 insertions(+), 7 deletions(-)

diff --git a/sdext/source/presenter/PresenterController.cxx b/sdext/source/presenter/PresenterController.cxx
index 866a311..76e7ae1 100644
--- a/sdext/source/presenter/PresenterController.cxx
+++ b/sdext/source/presenter/PresenterController.cxx
@@ -998,14 +998,23 @@ void SAL_CALL PresenterController::keyReleased (const awt::KeyEvent& rEvent)
             }
             break;
 
-        case awt::Key::LEFT:
         case awt::Key::PAGEUP:
+            if (mxSlideShowController.is())
+            {
+                if (rEvent.Modifiers == awt::KeyModifier::MOD2)
+                    mxSlideShowController->gotoPreviousSlide();
+                else
+                    mxSlideShowController->gotoPreviousEffect();
+            }
+            break;
+
+        case awt::Key::LEFT:
         case awt::Key::UP:
         case awt::Key::P:
         case awt::Key::BACKSPACE:
             if (mxSlideShowController.is())
             {
-                mxSlideShowController->gotoPreviousSlide();
+                mxSlideShowController->gotoPreviousEffect();
             }
             break;
 
diff --git a/sdext/source/presenter/PresenterCurrentSlideObserver.cxx b/sdext/source/presenter/PresenterCurrentSlideObserver.cxx
index d48378e..f516630 100644
--- a/sdext/source/presenter/PresenterCurrentSlideObserver.cxx
+++ b/sdext/source/presenter/PresenterCurrentSlideObserver.cxx
@@ -105,13 +105,13 @@ void SAL_CALL PresenterCurrentSlideObserver::resumed (void)
 {
 }
 
-void SAL_CALL PresenterCurrentSlideObserver::slideEnded (void)
+void SAL_CALL PresenterCurrentSlideObserver::slideEnded (sal_Bool bReverse)
     throw (css::uno::RuntimeException)
 {
     // Determine whether the new current slide (the one after the one that
     // just ended) is the slide past the last slide in the presentation,
     // i.e. the one that says something like "click to end presentation...".
-    if (mxSlideShowController.is())
+    if (mxSlideShowController.is() && !bReverse)
         if (mxSlideShowController->getNextSlideIndex() < 0)
             if( mpPresenterController.is() )
                 mpPresenterController->UpdateCurrentSlide(+1);
diff --git a/sdext/source/presenter/PresenterCurrentSlideObserver.hxx b/sdext/source/presenter/PresenterCurrentSlideObserver.hxx
index 6571f25..cf1855b 100644
--- a/sdext/source/presenter/PresenterCurrentSlideObserver.hxx
+++ b/sdext/source/presenter/PresenterCurrentSlideObserver.hxx
@@ -72,7 +72,7 @@ public:
     virtual void SAL_CALL slideTransitionStarted(  ) throw (::com::sun::star::uno::RuntimeException);
     virtual void SAL_CALL slideTransitionEnded(  ) throw (::com::sun::star::uno::RuntimeException);
     virtual void SAL_CALL slideAnimationsEnded(  ) throw (::com::sun::star::uno::RuntimeException);
-    virtual void SAL_CALL slideEnded(  ) throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL slideEnded(sal_Bool bReverse) throw (::com::sun::star::uno::RuntimeException);
     virtual void SAL_CALL hyperLinkClicked( const ::rtl::OUString& hyperLink ) throw (::com::sun::star::uno::RuntimeException);
 
     // XAnimationListener
diff --git a/sdext/source/presenter/description.xml b/sdext/source/presenter/description.xml
index a239df9..158d177 100755
--- a/sdext/source/presenter/description.xml
+++ b/sdext/source/presenter/description.xml
@@ -8,10 +8,10 @@
   <identifier value="com.sun.PresenterScreen-UPDATED_PLATFORM" />
 
   <dependencies>
-    <OpenOffice.org-minimal-version value="3.0" dep:name="OpenOffice.org 3.0"/>
+    <OpenOffice.org-minimal-version value="3.1" dep:name="OpenOffice.org 3.2"/>
   </dependencies>
 
-  <version value="1.0.4" />
+  <version value="1.1.0" />
 
   <platform value="UPDATED_PLATFORM" />
 
-- 
1.7.0.1

