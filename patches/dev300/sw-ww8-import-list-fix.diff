From 430e827ed858102719400d6527d8ce84668084d4 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:07:18 +0200
Subject: [PATCH 756/878] sw-ww8-import-list-fix.diff

---
 sw/source/filter/ww8/ww8par6.cxx |   23 +++++++++++++++++++++++
 1 files changed, 23 insertions(+), 0 deletions(-)

diff --git a/sw/source/filter/ww8/ww8par6.cxx b/sw/source/filter/ww8/ww8par6.cxx
index 4013f45..6f09801 100644
--- a/sw/source/filter/ww8/ww8par6.cxx
+++ b/sw/source/filter/ww8/ww8par6.cxx
@@ -3938,6 +3938,29 @@ void SwWW8ImplReader::Read_LR( USHORT nId, const BYTE* pData, short nLen )
     if( pLR )
         aLR = *(const SvxLRSpaceItem*)pLR;
 
+    // Fix the regression issue: #i99822#: Discussion?
+    // Since the list lever formatting doesn't apply into paragraph style
+    // for list levels of mode LABEL_ALIGNMENT.(see ww8par3.cxx
+    // W8ImplReader::RegisterNumFmtOnTxtNode).
+    // Need to apply the list format to the paragraph here.
+    SwTxtNode* pTxtNode = pPaM->GetNode()->GetTxtNode();
+    if( pTxtNode && pTxtNode->AreListLevelIndentsApplicable() )
+    {
+        SwNumRule * pNumRule = pTxtNode->GetNumRule();
+        if( pNumRule )
+        {
+            BYTE nLvl = static_cast< BYTE >(pTxtNode->GetActualListLevel());
+            const SwNumFmt* pFmt = pNumRule->GetNumFmt( nLvl );
+            if ( pFmt && pFmt->GetPositionAndSpaceMode() == SvxNumberFormat::LABEL_ALIGNMENT )
+            {
+                aLR.SetTxtLeft( pFmt->GetIndentAt() );
+                aLR.SetTxtFirstLineOfst( static_cast<short>(pFmt->GetFirstLineIndent()) );
+                // make paragraph have hard-set indent attributes
+                pTxtNode->SetAttr( aLR );
+            }
+        }
+    }
+
     /*
     The older word sprms mean left/right, while the new ones mean before/after.
     Writer now also works with before after, so when we see old left/right and
-- 
1.7.0.1

