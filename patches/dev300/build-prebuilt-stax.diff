From 32143954ef2a932de37d1994bed3d705e56bf1c4 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:57:44 +0200
Subject: [PATCH 278/878] build-prebuilt-stax.diff

---
 configure.in     |   13 +++++++++++++
 set_soenv.in     |    1 +
 stax/makefile.mk |   10 ++++++++++
 3 files changed, 24 insertions(+), 0 deletions(-)

diff --git a/configure.in b/configure.in
index b49687d..9a31132 100644
--- a/configure.in
+++ b/configure.in
@@ -3569,6 +3569,19 @@ else
 fi
 
 dnl ===================================================================
+dnl Check for building stax
+dnl ===================================================================
+AC_MSG_CHECKING([whether to build the stax])
+if test -f "external/StAX/jsr173_1.0_api.jar"; then
+   BUILD_STAX=NO
+   AC_MSG_RESULT([no, will use the prebuilt external/StAX/jsr173_1.0_api.jar])
+else
+   BUILD_STAX=YES
+   AC_MSG_RESULT([yes])
+fi
+AC_SUBST(BUILD_STAX)
+
+dnl ===================================================================
 dnl Check for building ODK
 dnl ===================================================================
 AC_MSG_CHECKING([whether to build the ODK])
diff --git a/set_soenv.in b/set_soenv.in
index 4c330ab..93b8d06 100644
--- a/set_soenv.in
+++ b/set_soenv.in
@@ -1943,6 +1943,7 @@ ToFile( "ENABLE_AGG",        "@ENABLE_AGG@",       "e" );
 ToFile( "SYSTEM_AGG",	     "@SYSTEM_AGG@",       "e" );
 ToFile( "AGG_VERSION",	     "@AGG_VERSION@",      "e" );
 ToFile( "BUILD_DMAKE",       "@BUILD_DMAKE@",      "e" );
+ToFile( "BUILD_STAX",        "@BUILD_STAX@",       "e" );
 ToFile( "BUILD_UNOWINREG",   "@BUILD_UNOWINREG@",  "e" );
 ToFile( "USE_XINERAMA",      "@USE_XINERAMA@",     "e" );
 ToFile( "XINERAMA_LINK",     "@XINERAMA_LINK@",    "e" );
diff --git a/stax/makefile.mk b/stax/makefile.mk
index 497736b..12762bb 100644
--- a/stax/makefile.mk
+++ b/stax/makefile.mk
@@ -47,6 +47,15 @@ all:
     @echo "Therefore the files provided here does not need to be built in addition."
 .ENDIF
 
+EXTERNAL_DIR=$(PRJ)$/..$/external/StAX
+
+.IF "$(BUILD_STAX)" != "YES"
+
+$(OUT)$/class$/jsr173_1.0_api.jar : $(EXTERNAL_DIR)$/jsr173_1.0_api.jar
+    +$(COPY) $< $@
+
+.ELSE 			#  "$(BUILD_STAX)" != "YES"
+
 # --- Files --------------------------------------------------------
 TARFILE_NAME=stax-api-1.0-2-sources
 TARFILE_ROOTDIR=src
@@ -55,6 +64,7 @@ BUILD_ACTION=$(JAVAC) javax$/xml$/stream$/*.java && jar -cf jsr173_1.0_api.jar j
 
 OUT2CLASS=jsr173_1.0_api.jar
 
+.ENDIF			#  "$(BUILD_STAX)" != "YES"
 .ELSE			# $(SOLAR_JAVA)!= ""
 nojava:
     @echo "Not building $(PRJNAME) because Java is disabled"
-- 
1.7.0.1

