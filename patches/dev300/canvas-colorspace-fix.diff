From c2cb25a0e827763163f41105eab202d409781a66 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:04:59 +0200
Subject: [PATCH 648/878] canvas-colorspace-fix.diff

---
 canvas/source/cairo/cairo_canvashelper.cxx |   22 +++++++++++-----------
 1 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/canvas/source/cairo/cairo_canvashelper.cxx b/canvas/source/cairo/cairo_canvashelper.cxx
index 4f29227..6f229c1 100644
--- a/canvas/source/cairo/cairo_canvashelper.cxx
+++ b/canvas/source/cairo/cairo_canvashelper.cxx
@@ -1637,12 +1637,12 @@ namespace cairocanvas
                 rendering::RGBColor* pOut( aRes.getArray() );
                 for( sal_Size i=0; i<nLen; i+=4 )
                 {
-                    const sal_Int8 nAlpha(pIn[3]);
-                    if( nAlpha )
+                    const double fAlpha((sal_uInt8)pIn[3]);
+                    if( fAlpha )
                         *pOut++ = rendering::RGBColor(
-                            vcl::unotools::toDoubleColor(pIn[2]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[1]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[0]/nAlpha));
+                            pIn[2]/fAlpha,
+                            pIn[1]/fAlpha,
+                            pIn[0]/fAlpha);
                     else
                         *pOut++ = rendering::RGBColor(0,0,0);
                     pIn += 4;
@@ -1662,13 +1662,13 @@ namespace cairocanvas
                 rendering::ARGBColor* pOut( aRes.getArray() );
                 for( sal_Size i=0; i<nLen; i+=4 )
                 {
-                    const sal_Int8 nAlpha(pIn[3]);
-                    if( nAlpha )
+                    const double fAlpha((sal_uInt8)pIn[3]);
+                    if( fAlpha )
                         *pOut++ = rendering::ARGBColor(
-                            vcl::unotools::toDoubleColor(nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[2]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[1]/nAlpha),
-                            vcl::unotools::toDoubleColor(pIn[0]/nAlpha));
+                            fAlpha/255.0,
+                            pIn[2]/fAlpha,
+                            pIn[1]/fAlpha,
+                            pIn[0]/fAlpha);
                     else
                         *pOut++ = rendering::ARGBColor(0,0,0,0);
                     pIn += 4;
-- 
1.7.0.1

