Make vbahelper truly optional

From: Eric Bachard <ericb@openoffice.org>


---

 solenv/inc/libs.mk                     |    2 ++
 sw/util/makefile.mk                    |   10 ++++++++--
 vbahelper/source/msforms/makefile.mk   |    5 +++++
 vbahelper/source/vbahelper/makefile.mk |    5 +++++
 vbahelper/util/makefile.mk             |    4 ++++
 5 files changed, 24 insertions(+), 2 deletions(-)


diff --git solenv/inc/libs.mk solenv/inc/libs.mk
index 346bcdb..dfdd04c 100644
--- solenv/inc/libs.mk
+++ solenv/inc/libs.mk
@@ -190,7 +190,9 @@ SAXLIB=-lsax$(DLLPOSTFIX)
 MAILLIB=-lmail
 DOCMGRLIB=-ldmg$(DLLPOSTFIX)
 BASICLIB=-lsb$(DLLPOSTFIX)
+.IF "$(ENABLE_VBA)"=="YES"
 VBAHELPERLIB=-lvbahelper$(DLLPOSTFIX)
+.ENDIF
 DBTOOLSLIB=-ldbtools$(DLLPOSTFIX)
 HM2LIBSH=-lhmwrpdll
 HM2LIBST=-lhmwrap
diff --git sw/util/makefile.mk sw/util/makefile.mk
index b4e1127..ddd3ced 100644
--- sw/util/makefile.mk
+++ sw/util/makefile.mk
@@ -126,8 +126,12 @@ SHL1STDLIBS+= \
     $(SALLIB) \
     $(SALHELPERLIB) \
     $(ICUUCLIB) \
-    $(I18NUTILLIB)	\
-		        $(VBAHELPERLIB) \
+	$(I18NUTILLIB)
+.IF "$(ENABLE_VBA)" == "YES"
+SHL1STDLIBS+= \
+		        $(VBAHELPERLIB)
+.ENDIF # "$(ENABLE_VBA)" == "YES" 
+SHL1STDLIBS+= \
     $(AVMEDIALIB)
 
 .IF "$(GUI)"=="WNT"
@@ -345,6 +349,7 @@ SHL4STDLIBS= \
     $(BASICLIB)     \
     $(I18NUTILLIB)
 
+.IF "$(ENABLE_VBA)" == "YES"
 #target vba
 TARGET_VBA=vbaswobj
 SHL5TARGET=$(TARGET_VBA)$(DLLPOSTFIX).uno
@@ -377,5 +382,6 @@ SHL5STDLIBS= \
 
 SHL5DEPN=$(SHL1TARGETN)
 SHL5LIBS=$(SLB)$/$(TARGET_VBA).lib
+.ENDIF # .IF "$(ENABLE_VBA)" == "YES"
 
 .INCLUDE :  target.mk
diff --git vbahelper/source/msforms/makefile.mk vbahelper/source/msforms/makefile.mk
index 9bde7db..e123aeb 100644
--- vbahelper/source/msforms/makefile.mk
+++ vbahelper/source/msforms/makefile.mk
@@ -37,6 +37,11 @@ ENABLE_EXCEPTIONS := TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(ENABLE_VBA)" == "NO"
+dummy:
+	@echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 
 CDEFS+=-DVBA_OOBUILD_HACK
diff --git vbahelper/source/vbahelper/makefile.mk vbahelper/source/vbahelper/makefile.mk
index bd57415..ce2f862 100644
--- vbahelper/source/vbahelper/makefile.mk
+++ vbahelper/source/vbahelper/makefile.mk
@@ -37,6 +37,11 @@ ENABLE_EXCEPTIONS := TRUE
 
 # --- Settings -----------------------------------------------------
 
+.IF "$(ENABLE_VBA)" == "NO"
+dummy:
+	@echo "Nothing to build"
+.ENDIF
+
 .INCLUDE :  settings.mk
 
 SLOFILES=\
diff --git vbahelper/util/makefile.mk vbahelper/util/makefile.mk
index 9180676..14cec55 100644
--- vbahelper/util/makefile.mk
+++ vbahelper/util/makefile.mk
@@ -38,6 +38,10 @@ TARGET=vbahelper
 
 .INCLUDE :  settings.mk
 
+.IF "$(ENABLE_VBA)" == "NO"
+dummy:
+	@echo "Nothing to build"
+.ENDIF
 
 TARGET_HELPER=vbahelper
 
