From 67b1e72b45535de14fbef8f5e2c3ee2d531f34f0 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:59:22 +0200
Subject: [PATCH 331/768] win32-gw-send-mail.diff

---
 shell/source/win32/simplemail/senddoc.cxx        |    5 ++++-
 shell/source/win32/simplemail/smplmailclient.cxx |    7 ++-----
 2 files changed, 6 insertions(+), 6 deletions(-)

diff --git shell/source/win32/simplemail/senddoc.cxx shell/source/win32/simplemail/senddoc.cxx
index 42f5b9e..0b51c58 100644
--- shell/source/win32/simplemail/senddoc.cxx
+++ shell/source/win32/simplemail/senddoc.cxx
@@ -30,7 +30,7 @@
 #include <osl/diagnose.h>
 
 #ifndef _RTL_STRING_HXX_
-//#include <rtl/string.hxx>
+#include <rtl/string.hxx>
 #endif
 #include "simplemapi.hxx"
 
@@ -299,6 +299,9 @@ int main(int argc, char* argv[])
     {
         OSL_ENSURE(false, ex.what());
     }        
+    if (ulRet != SUCCESS_SUCCESS)
+        // FIXME: Localisation of this message..
+        MessageBox( NULL, "Sending mail failed. Please save this document instead and attach it from within your e-mail client.", "OpenOffice.org senddoc.exe", MB_OK|MB_ICONERROR|MB_TOPMOST );
     return ulRet;
 }
 
diff --git shell/source/win32/simplemail/smplmailclient.cxx shell/source/win32/simplemail/smplmailclient.cxx
index 7da7f1c..d5e6b58 100644
--- shell/source/win32/simplemail/smplmailclient.cxx
+++ shell/source/win32/simplemail/smplmailclient.cxx
@@ -142,7 +142,7 @@ namespace /* private */
             senddocUrl.pData,
             (rtl_uString**)&rCommandArgs[0], 
             rCommandArgs.size(),
-            osl_Process_WAIT | osl_Process_DETACHED,
+            osl_Process_DETACHED,
             NULL,
             NULL,
             NULL,
@@ -152,11 +152,8 @@ namespace /* private */
         if (err != osl_Process_E_None)
             return false;
                 
-        oslProcessInfo procInfo;
-        procInfo.Size = sizeof(oslProcessInfo);    
-        osl_getProcessInfo(proc, osl_Process_EXITCODE, &procInfo);
         osl_freeProcessHandle(proc);   
-        return (procInfo.Code == SUCCESS_SUCCESS);            
+        return true;
     }
 } // namespace private 
 
-- 
1.7.0.1

