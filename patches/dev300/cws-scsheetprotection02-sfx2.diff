? sfx2/sfx2.vpj
Index: sfx2/inc/sfx2/passwd.hxx
===================================================================
RCS file: /cvs/framework/sfx2/inc/sfx2/passwd.hxx,v
retrieving revision 1.3
retrieving revision 1.2.272.2
diff -u -b -I $Revision.*$ -I $Author.*$ -r1.3 -r1.2.272.2
--- sfx2/inc/sfx2/passwd.hxx	11 Apr 2008 11:37:34 -0000	1.3
+++ sfx2/inc/sfx2/passwd.hxx	6 May 2008 23:39:22 -0000	1.2.272.2
@@ -81,6 +81,7 @@
 	String			GetConfirm() const { return maConfirmED.GetText(); }
 
 	void 			SetMinLen( USHORT Len );
+    void            SetMaxLen( USHORT Len );
 	void			SetEditHelpId( ULONG nId ) { maPasswordED.SetHelpId( nId ); }
 	void			ShowExtras( USHORT nExtras ) { mnExtras = nExtras; }
 
Index: sfx2/source/dialog/filedlghelper.cxx
===================================================================
RCS file: /cvs/framework/sfx2/source/dialog/filedlghelper.cxx,v
retrieving revision 1.142
retrieving revision 1.140.2.3
diff -u -b -I $Revision.*$ -I $Author.*$ -r1.142 -r1.140.2.3
--- sfx2/source/dialog/filedlghelper.cxx	15 Apr 2008 14:18:43 -0000	1.142
+++ sfx2/source/dialog/filedlghelper.cxx	6 May 2008 23:39:30 -0000	1.140.2.3
@@ -556,6 +556,11 @@
 {
 	sal_Bool operator() ( const SfxFilter* _pFilter )
 	{
+        if (_pFilter->GetFilterName().EqualsAscii("MS Excel 97"))
+            // temporary hack to enable password protection for Excel 97.  Is
+            // there a better way to enable password protection of a filter?
+            return true;
+
         return  _pFilter && _pFilter->IsOwnFormat()
 			&&	_pFilter->UsesStorage()
 			&&	( SOFFICE_FILEFORMAT_60 <= _pFilter->GetVersion() );
@@ -1538,6 +1543,9 @@
 		if( !rpSet )
 			rpSet = new SfxAllItemSet( SFX_APP()->GetPool() );
 
+		// set the filter
+		getRealFilter( rFilter );
+
 		// check, wether or not we have to display a password box
 		if ( mbHasPassword && mbIsPwdEnabled && xCtrlAccess.is() )
 		{
@@ -1547,9 +1555,16 @@
 				sal_Bool bPassWord = sal_False;
 				if ( ( aValue >>= bPassWord ) && bPassWord )
 				{
-					// ask for the password
+					// ask for a password
 					SfxPasswordDialog aPasswordDlg( NULL );
 					aPasswordDlg.ShowExtras( SHOWEXTRAS_CONFIRM );
+                    if ( rFilter.EqualsAscii("MS Excel 97") )
+                    {
+                        // Excel allows 1-15 length password.
+                        aPasswordDlg.SetMinLen(1);
+                        aPasswordDlg.SetMaxLen(15);
+                    }
+
 					short nRet = aPasswordDlg.Execute();
 					if ( RET_OK == nRet )
 					{
@@ -1616,9 +1631,6 @@
 			catch( IllegalArgumentException ){}
 		}
 
-		// set the filter
-		getRealFilter( rFilter );
-
 		// fill the rpURLList
 		implGetAndCacheFiles(mxFileDlg, rpURLList, getCurentSfxFilter());
 		if ( rpURLList == NULL )
Index: sfx2/source/dialog/passwd.cxx
===================================================================
RCS file: /cvs/framework/sfx2/source/dialog/passwd.cxx,v
retrieving revision 1.9
retrieving revision 1.8.72.2
diff -u -b -I $Revision.*$ -I $Author.*$ -r1.9 -r1.8.72.2
--- sfx2/source/dialog/passwd.cxx	11 Apr 2008 12:45:35 -0000	1.9
+++ sfx2/source/dialog/passwd.cxx	6 May 2008 23:39:25 -0000	1.8.72.2
@@ -112,6 +112,15 @@
 
 // -----------------------------------------------------------------------
 
+void SfxPasswordDialog::SetMaxLen( USHORT nLen )
+{
+    maPasswordED.SetMaxTextLen( nLen );
+    maConfirmED.SetMaxTextLen( nLen );
+	EditModifyHdl( NULL );
+}
+
+// -----------------------------------------------------------------------
+
 short SfxPasswordDialog::Execute()
 {
 	if ( mnExtras < SHOWEXTRAS_ALL )
Index: sfx2/source/doc/objserv.cxx
===================================================================
RCS file: /cvs/framework/sfx2/source/doc/objserv.cxx,v
retrieving revision 1.105
retrieving revision 1.104.20.3
diff -u -b -I $Revision.*$ -I $Author.*$ -r1.105 -r1.104.20.3
