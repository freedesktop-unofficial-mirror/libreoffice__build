From fa196022816949cbaaaea17252177bbdafecd4a8 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:08:05 +0200
Subject: [PATCH 700/768] calc-distributed-cell-text-sc-fix.diff

---
 sc/source/ui/view/output2.cxx |   15 ++++++++-------
 1 files changed, 8 insertions(+), 7 deletions(-)

diff --git sc/source/ui/view/output2.cxx sc/source/ui/view/output2.cxx
index 1594fc4..193414e 100644
--- sc/source/ui/view/output2.cxx
+++ sc/source/ui/view/output2.cxx
@@ -2189,12 +2189,13 @@ void EditAlignmentParam::calcPaperSize(
         rPaperSize.Height() = rAlignRect.GetHeight() - nTopM - nBottomM;
     }
 
-    if (mbAsianVertical && mbBreak)
+    if (mbAsianVertical)
     {
-        //	add some extra height (default margin value) for safety
-        //	as long as GetEditArea isn't used below
-        long nExtraHeight = static_cast<long>(20*nPPTY);
-        rPaperSize.Height() = rAlignRect.GetHeight() - nTopM - nBottomM + nExtraHeight;
+        rPaperSize.Height() = rAlignRect.GetHeight() - nTopM - nBottomM;
+        // Subtract some extra value from the height or else the text would go
+        // outside the cell area.  The value of 5 is arbitrary, and is based
+        // entirely on heuristics.
+        rPaperSize.Height() -= 5;
     }
 }
 
@@ -2977,8 +2978,8 @@ void ScOutputData::DrawEdit(BOOL bPixelToLogic)
                                         aLogicStart.Y() += nTopM;
                                 }
 
-                                if ( ( aAlignParam.meOrient==SVX_ORIENTATION_STANDARD && !aAlignParam.mbAsianVertical ) ||
-                                     aAlignParam.meOrient==SVX_ORIENTATION_STACKED || !aAlignParam.mbBreak )
+                                if (!aAlignParam.mbAsianVertical &&
+                                    (aAlignParam.meOrient == SVX_ORIENTATION_STANDARD || aAlignParam.meOrient == SVX_ORIENTATION_STACKED || !aAlignParam.mbBreak))
                                 {
                                     if (aAlignParam.meVerJust==SVX_VER_JUSTIFY_BOTTOM ||
                                         aAlignParam.meVerJust==SVX_VER_JUSTIFY_STANDARD)
-- 
1.7.0.1

