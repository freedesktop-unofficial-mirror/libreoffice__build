--- toolkit/inc/layout/layout-post.hxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/inc/layout/layout-post.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -35,33 +35,55 @@
 #if ENABLE_LAYOUT
 
 #undef AdvancedButton
+#undef ApplyButton
 #undef Box
 #undef Button
 #undef CancelButton
 #undef CheckBox
+#undef ComboBox
 #undef Container
+#undef Control
+#undef Dialog
+#undef Edit
 #undef FixedImage
 #undef FixedInfo
 #undef FixedLine
 #undef FixedText
-#undef HelpButton
 #undef HBox
+#undef HelpButton
+#undef IgnoreButton
+#undef ListBox
 #undef MetricField
+#undef MetricFormatter
 #undef MoreButton
 #undef MultiLineEdit
+#undef NoButton
+#undef NumericField
+#undef NumericFormatter
 #undef OKButton
+#undef Plugin
 #undef ProgressBar
 #undef PushButton
 #undef RadioButton
-#undef SfxModalDialog
+#undef ResetButton
+#undef RetryButton
+#undef SpinField
 #undef Table
 #undef VBox
+#undef YesButton
+
+#undef ModalDialog
+#undef ModelessDialog
+#undef SfxModalDialog
 
 #undef Window
 
+
 #undef SVX_RES
 #define SVX_RES(i) ResId(i,DIALOG_MGR())
 
+#undef SvtResId
+
 #undef SW_RES
 #define SW_RES(i) ResId(i,SWDIALOG_MGR())
 
--- toolkit/inc/layout/layout-pre.hxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/inc/layout/layout-pre.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -45,63 +45,80 @@
 //typedef layout::FixedLine FixedLine;
 
 #define AdvancedButton layout::AdvancedButton
+#define ApplyButton layout::ApplyButton
 #define Box layout::Box
 #define Button layout::Button
 #define CancelButton layout::CancelButton
 #define CheckBox layout::CheckBox
+#define ComboBox layout::ComboBox
 #define Container layout::Container
+#define Control layout::Control
+#define Dialog layout::Dialog
+#define Edit layout::Edit
 #define FixedImage layout::FixedImage
 #define FixedInfo layout::FixedInfo
 #define FixedLine layout::FixedLine
 #define FixedText layout::FixedText
 #define HBox layout::HBox
 #define HelpButton layout::HelpButton
+#define IgnoreButton layout::IgnoreButton
+#define ListBox layout::ListBox
 #define MetricField layout::MetricField
+#define MetricFormatter layout::MetricFormatter
 #define MoreButton layout::MoreButton
 #define MultiLineEdit layout::MultiLineEdit
+#define NoButton layout::NoButton
+#define NumericField layout::NumericField
+#define NumericFormatter layout::NumericFormatter
 #define OKButton layout::OKButton
+#define Plugin layout::Plugin
 #define ProgressBar layout::ProgressBar
 #define PushButton layout::PushButton
 #define RadioButton layout::RadioButton
-#define SfxModalDialog layout::Dialog
+#define ResetButton layout::ResetButton
+#define RetryButton layout::RetryButton
+#define SpinField layout::SpinField
 #define Table layout::Table
 #define VBox layout::VBox
+#define YesButton layout::YesButton
 
-/* FIXME: why are we defaulting to layout::Window?
-   /home/janneke/vc/ooo-build/build/hack/sw/source/ui/dialog/wordcountdialog.cxx:87: error: no matching function for call to 'layout::Dialog::Dialog(Window*&, const char [14], const char [7])'
-   ../../../../layout/inc/layout/layout.hxx:304: note: candidates are: layout::Dialog::Dialog(layout::Window*, const char*, const char*, sal_uInt32)
-   ../../../../layout/inc/layout/layout.hxx:300: note:                 layout::Dialog::Dialog(const layout::Dialog&)
-*/
+#define ModalDialog Dialog
+#define ModelessDialog Dialog
+#define SfxModalDialog Dialog
 
 #define Window ::Window
 
+#define LAYOUT_DIALOG_PARENT\
+    VCLXWindow::GetImplementation( uno::Reference <awt::XWindow> ( GetPeer(), uno::UNO_QUERY ) )->GetWindow()
+
 #undef SVX_RES
 #define SVX_RES(x) #x
+#undef SvtResId
+#define SvtResId(x) #x
 #undef SW_RES
 #define SW_RES(x) #x
 
-/* Hmm.  This hack makes zoom.cxx, wordcountdialog.cxx diffs smaller
- * but is not scalable. */
+/* Hmm.  These hacks make zoom.cxx, wordcountdialog.cxx, ... diffs
+ * smaller but 'tis not really scalable. */
 #ifdef _LAYOUT_POST_HXX
 
 #ifdef _SVX_RECOVER_CXX
 #undef SfxModalDialog
 // 3rd parameter must match ID in <modaldialog> "RID_SVXDLG_RECOVER", localize.sdf
-#define SfxModalDialog( pParent, SVX_RES_RID ) layout::Dialog( pParent, "recover.xml", "RID_SVXDLG_RECOVER" )
-//#define _SVX_RECOVER_HRC
+#define SfxModalDialog( pParent, SVX_RES_RID ) Dialog( pParent, "recover.xml", "RID_SVXDLG_RECOVER" )
 #endif /* _SVX_RECOVER_CXX */
 
 #ifdef SW_WORDCOUNTDIALOG_HXX
 #undef SfxModalDialog
 // 3rd parameter must match ID in <modaldialog> "DLG_WORDCOUNT", localize.sdf
-#define SfxModalDialog( pParent, SW_RES_RID ) layout::Dialog( pParent, "wordcount.xml", "DLG_WORDCOUNT" )
+#define SfxModalDialog( pParent, SW_RES_RID ) Dialog( pParent, "wordcount.xml", "DLG_WORDCOUNT" )
 #define SW_WORDCOUNTDIALOG_HRC
 #endif /* SW_WORDCOUNTDIALOG_HXX */
 
 #ifdef _SVX_ZOOM_CXX
 #undef SfxModalDialog
 // 3rd parameter must match ID in <modaldialog> "RID_SVXDLG_ZOOM", localize.sdf
-#define SfxModalDialog( pParent, SVX_RES_RID ) layout::Dialog( pParent, "zoom.xml", "RID_SVXDLG_ZOOM" )
+#define SfxModalDialog( pParent, SVX_RES_RID ) Dialog( pParent, "zoom.xml", "RID_SVXDLG_ZOOM" )
 #define _SVX_ZOOM_HRC
 #endif /* _SVX_ZOOM_CXX */
 
@@ -109,7 +126,7 @@
 
 #else /* !ENABLE_LAYOUT */
 
-#define LAYOUT_PRE_POST
+#define LAYOUT_PRE_POST 1
 
 #endif /* !ENABLE_LAYOUT */
 
--- toolkit/inc/layout/layout.hxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/inc/layout/layout.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -45,8 +45,9 @@
 
 #include <toolkit/dllapi.h>
 
-class Window;
+class Control;
 class Image;
+class Window;
 
 namespace layout
 {
@@ -512,6 +513,17 @@ public:
     VBox( sal_Int32 nBorder, bool bHomogeneous );
 };
 
+class PluginImpl;
+class TOOLKIT_DLLPUBLIC Plugin : public Control
+{
+    friend class PluginImpl;
+    DECL_GET_IMPL( Plugin );
+    //DECL_CONSTRUCTORS( Plugin, Control, 0 );
+public:
+    ::Control *mpPlugin;
+    Plugin( Context *pCtx, char const* pId, ::Control *plugin );
+};
+
 } // end namespace layout
 
 #endif /* _LAYOUT_HXX */
--- toolkit/source/awt/makefile.mk.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/awt/makefile.mk	2009-04-06 16:42:11.000000000 +0000
@@ -75,6 +75,7 @@ SLOFILES=   \
 			$(SLO)/vclxbutton.obj\
 			$(SLO)/vclxdialog.obj\
 			$(SLO)/vclxfixedline.obj\
+	$(SLO)/vclxplugin.obj\
 			$(SLO)/vclxscroller.obj\
 			$(SLO)/vclxsplitter.obj\
 			$(SLO)/vclxtabcontrol.obj
--- toolkit/source/awt/vclxplugin.cxx.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/source/awt/vclxplugin.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,91 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 51 Franklin Street, 5th Floor, Boston,
+ *    MA  02110-1301  USA
+ *
+ ************************************************************************/
+
+#include "vclxplugin.hxx"
+
+#include <com/sun/star/awt/PosSize.hpp>
+#include <toolkit/helper/property.hxx>
+
+#include "forward.hxx"
+
+#include <vcl/ctrl.hxx>
+
+namespace layoutimpl
+{
+
+using namespace ::com::sun::star;
+
+VCLXPlugin::VCLXPlugin( Window *p, WinBits b )
+    : VCLXWindow()
+    , mpWindow( p )
+    , mpPlugin( 0 )
+    , mStyle( b )
+{
+}
+
+VCLXPlugin::~VCLXPlugin()
+{
+}
+
+void SAL_CALL VCLXPlugin::dispose() throw(uno::RuntimeException)
+{
+    {
+        ::vos::OGuard aGuard( GetMutex() );
+        
+        lang::EventObject aDisposeEvent;
+        aDisposeEvent.Source = *this;
+    }
+    
+    VCLXWindow::dispose();
+}
+
+void VCLXPlugin::SetPlugin( ::Control *p )
+{
+    mpPlugin = p;
+}
+
+awt::Size SAL_CALL VCLXPlugin::getMinimumSize()
+    throw(::com::sun::star::uno::RuntimeException)
+{
+    ::vos::OClearableGuard aGuard( GetMutex() );
+    if ( mpPlugin )
+    {
+        Size s = mpPlugin->GetSizePixel();
+        return awt::Size( s.Width(), s.Height() );
+    }
+    return awt::Size();
+}
+
+} // namespace layoutimpl
--- toolkit/source/awt/vclxplugin.hxx.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/source/awt/vclxplugin.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,75 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 51 Franklin Street, 5th Floor, Boston,
+ *    MA  02110-1301  USA
+ *
+ ************************************************************************/
+
+#ifndef LAYOUT_AWT_VCLXPLUGIN_HXX
+#define LAYOUT_AWT_VCLXPLUGIN_HXX
+
+#include <toolkit/awt/vclxwindow.hxx>
+#include <vcl/wintypes.hxx>
+
+class Control;
+namespace layoutimpl
+{
+
+namespace css = ::com::sun::star;
+
+class VCLXPlugin : public VCLXWindow
+{
+public:
+    Window *mpWindow;
+    ::Control *mpPlugin;
+    WinBits mStyle;
+
+    VCLXPlugin( Window *p, WinBits b );
+
+    void SetPlugin( ::Control *p );
+
+protected:
+    ~VCLXPlugin();
+
+    // XComponent
+    void SAL_CALL dispose() throw(::com::sun::star::uno::RuntimeException);
+
+    virtual ::com::sun::star::awt::Size SAL_CALL getMinimumSize()
+        throw(::com::sun::star::uno::RuntimeException);
+
+private:
+    VCLXPlugin( VCLXPlugin const & );
+    VCLXPlugin& operator=( VCLXPlugin const & );
+};
+
+} // namespace layoutimpl
+
+#endif /* LAYOUT_AWT_VCLXPLUGIN_HXX */
--- toolkit/source/layout/dialogbuttonhbox.cxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/dialogbuttonhbox.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -39,7 +39,7 @@
 #include "proplist.hxx"
 
 #if TEST_LAYOUT && !defined( DBG_UTIL )
-#include <stdio.h>
+#include <cstdio>
 #undef DBG_ERROR
 #define DBG_ERROR printf
 #undef DBG_ERROR1
--- toolkit/source/layout/helper.cxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/helper.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -42,7 +42,7 @@
 #include "layout/layoutcore.hxx"
 
 #if TEST_LAYOUT && !defined( DBG_UTIL )
-#include <stdio.h>
+#include <cstdio>
 #undef DBG_ERROR
 #define DBG_ERROR printf
 #undef DBG_ERROR1
@@ -174,7 +174,7 @@ createToolkitWidget( uno::Reference< awt
     uno::Reference< awt::XWindowPeer > xWinPeer;
     try
     {
-//        DBG_ERROR1("Asking toolkit: %s\n", OUSTRING_CSTR( desc.WindowServiceName ) );
+        OSL_TRACE("Asking toolkit: %s", OUSTRING_CSTR( desc.WindowServiceName ) );
         xWinPeer = xToolkit->createWindow( desc );
         if ( !xWinPeer.is() )
             throw uno::RuntimeException(
@@ -348,6 +348,7 @@ PropHelper::queryInterface( const ::com:
 #include <awt/vclxscroller.hxx>
 #include <awt/vclxsplitter.hxx>
 #include <awt/vclxtabcontrol.hxx>
+#include <awt/vclxplugin.hxx>
 #include <toolkit/awt/vclxtoolkit.hxx>
 #include <toolkit/awt/vclxwindow.hxx>
 #include <vcl/button.hxx>
@@ -356,8 +357,7 @@ PropHelper::queryInterface( const ::com:
 #include <vcl/tabctrl.hxx>
 #include <vcl/tabpage.hxx>
 
-
-///#include <svtools/prgsbar.hxx>
+#include <typeinfo>
 
 namespace layoutimpl
 {
@@ -478,12 +478,19 @@ uno::Reference< awt::XLayoutConstrains >
         pNewWindow = new PushButton( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
         pNewComp = new layoutimpl::VCLXAdvancedButton( pNewWindow );
     }
+    else if ( aName.equalsAscii( "plugin" ) )
+    {
+        pNewWindow = new Control( pParent, ImplGetWinBits( WindowAttributes, 0 ) );
+        OSL_TRACE( "%s: parent=%p (%s)\n", __FUNCTION__, pParent, typeid( *pParent ).name() );
+        pNewComp = new layoutimpl::VCLXPlugin( pNewWindow, ImplGetWinBits( WindowAttributes, 0 ) );
+    }
 
     if ( !pNewWindow )
         return xRef;
 
     pNewWindow->SetCreatedWithToolkit( sal_True );
-    pNewComp->SetCreatedWithToolkit( TRUE );
+    if ( pNewComp )
+        pNewComp->SetCreatedWithToolkit( TRUE );
     xRef = pNewComp;
     pNewWindow->SetComponentInterface( pNewComp );
     if ( WindowAttributes & awt::WindowAttribute::SHOW )
--- toolkit/source/layout/import.hxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/import.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -34,6 +34,7 @@
 
 #include <map>
 #include <list>
+#define _BACKWARD_BACKWARD_WARNING_H 1
 #include <hash_map>
 
 #include <com/sun/star/xml/input/XRoot.hpp>
--- toolkit/source/layout/proplist.cxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/proplist.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -42,7 +42,7 @@
 #include "layout/layoutcore.hxx"
 
 #if TEST_LAYOUT && !defined( DBG_UTIL )
-#include <stdio.h>
+#include <cstdio>
 #undef DBG_ERROR
 #define DBG_ERROR printf
 #undef DBG_ERROR1
@@ -254,8 +254,7 @@ setProperties( uno::Reference< uno::XInt
         PropList::const_iterator cur;
         for ( cur = rProps.begin(); cur != rProps.end(); cur++ )
         {
-            OString attr = OUStringToOString( cur->first, RTL_TEXTENCODING_UTF8 );
-            OString value = OUStringToOString( cur->second, RTL_TEXTENCODING_UTF8 );
+            DBG_ERROR1( "%s=%s\n", OUSTRING_CSTR( cur->first ), OUSTRING_CSTR( cur->second ) );
         }
         return;
     }
@@ -271,7 +270,7 @@ setProperty( uno::Reference< uno::XInter
 {
     OUString unoAttr = toUnoNaming( attr );
 
-    OSL_TRACE( "setting %s=%s\n", OUSTRING_CSTR( attr ), OUSTRING_CSTR( value ) );
+    OSL_TRACE( "setting %s=%s", OUSTRING_CSTR( attr ), OUSTRING_CSTR( value ) );
     // get a Property object
     beans::Property prop;
     try
--- toolkit/source/layout/root.cxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/root.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -31,8 +31,8 @@
 
 #include "root.hxx"
 
-#include <assert.h>
-#include <stdio.h>
+#include <cassert>
+#include <cstdio>
 
 #include <com/sun/star/awt/WindowAttribute.hpp>
 #include <com/sun/star/awt/XMessageBox.hpp>
--- toolkit/source/layout/root.hxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/root.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -32,6 +32,7 @@
 #ifndef CORE_ROOT_HXX
 #define CORE_ROOT_HXX
 
+#define _BACKWARD_BACKWARD_WARNING_H 1
 #include <hash_map>
 
 #include <com/sun/star/awt/XLayoutRoot.hpp>
--- toolkit/source/layout/translate.cxx.old	2009-04-02 10:49:36.000000000 +0000
+++ toolkit/source/layout/translate.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -33,7 +33,7 @@
 
 #include <list>
 #if TEST_LAYOUT
-#include <stdio.h>
+#include <cstdio>
 #include "tools/getprocessworkingdir.hxx"
 #endif
 
@@ -93,9 +93,7 @@ getFirstExisting( OUString const& aDir,
           i != aSubDirs.end(); i++ )
     {
         String aFile = aDir + aSlash + *i + aSlash + aXMLName;
-#if TEST_LAYOUT
-        printf( "testing: %s\n", OUSTRING_CSTR( aFile ) );
-#endif
+        OSL_TRACE( "testing: %s", OUSTRING_CSTR( aFile ) );
         if ( fileExists( aFile ) )
             return aFile;
     }
@@ -129,9 +127,7 @@ readRightTranslation( OUString const& aX
         aXMLFile = getFirstExisting( aXMLDir, aSubdirs, aXMLName );
     }
 
-#if TEST_LAYOUT
-    printf( "FOUND:%s\n", OUSTRING_CSTR ( OUString (aXMLFile) ) );
-#endif /* TEST_LAYOUT */
+    OSL_TRACE( "FOUND:%s", OUSTRING_CSTR ( OUString (aXMLFile) ) );
     return aXMLFile;
 }
 
--- toolkit/source/vclcompat/wrapper.cxx.old	2009-04-02 10:49:35.000000000 +0000
+++ toolkit/source/vclcompat/wrapper.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -31,20 +31,21 @@
 
 #include "wrapper.hxx"
 
-#include <com/sun/star/graphic/XGraphic.hpp>
-#include <com/sun/star/awt/XFixedText.hpp>
+#include <awt/vclxplugin.hxx>
+#include <com/sun/star/awt/VclWindowPeerAttribute.hpp>
+#include <com/sun/star/awt/WindowAttribute.hpp>
 #include <com/sun/star/awt/XDialog2.hpp>
+#include <com/sun/star/awt/XFixedText.hpp>
 #include <com/sun/star/awt/XProgressBar.hpp>
-#include <com/sun/star/awt/WindowAttribute.hpp>
-#include <com/sun/star/awt/VclWindowPeerAttribute.hpp>
+#include <com/sun/star/graphic/XGraphic.hpp>
 #include <comphelper/processfactory.hxx>
-#include <vcl/window.hxx>
-#include <toolkit/awt/vclxwindow.hxx>
-
-#include <layout/layoutcore.hxx>
 #include <layout/factory.hxx>
+#include <layout/layoutcore.hxx>
 #include <layout/root.hxx>
+#include <toolkit/awt/vclxwindow.hxx>
+#include <vcl/ctrl.hxx>
 #include <vcl/image.hxx>
+#include <vcl/window.hxx>
 
 using namespace ::com::sun::star;
 
@@ -566,4 +567,36 @@ sal_Int32 ProgressBar::GetValue()
     return getImpl().mxProgressBar->getValue();
 }
 
+class PluginImpl: public ControlImpl
+{
+public:
+    ::Control *mpPlugin;
+
+    PluginImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow, :: Control *plugin )
+        : ControlImpl( pCtx, xPeer, pWindow )
+        , mpPlugin( plugin )
+    {
+        uno::Reference <awt::XWindow> ref( mxWindow, uno::UNO_QUERY );
+        layoutimpl::VCLXPlugin *vcl
+            = static_cast<layoutimpl::VCLXPlugin*>( VCLXWindow::GetImplementation( ref ) );
+        ::Window *parent = vcl->mpWindow->GetParent();
+        vcl->SetWindow( plugin );
+        vcl->SetPlugin( mpPlugin );
+        plugin->SetParent( parent );
+        plugin->SetStyle( vcl->mStyle );
+        plugin->SetCreatedWithToolkit( TRUE );
+        plugin->SetComponentInterface( vcl );
+        plugin->Show();
+    }
+};
+
+Plugin::Plugin( Context *pCtx, char const *pId, ::Control *plugin )
+    : Control( new PluginImpl( pCtx, pCtx->GetPeerHandle( pId, 0 ), this, plugin ) )
+    , mpPlugin( plugin )
+{
+}
+
+DECL_GET_IMPL_IMPL( Plugin )
+
+
 } // namespace layout
--- toolkit/source/vclcompat/wrapper.hxx.old	2009-04-02 10:49:35.000000000 +0000
+++ toolkit/source/vclcompat/wrapper.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -39,23 +39,23 @@
 
 #include <cstring>
 
-namespace css = com::sun::star;
-
 namespace layout
 {
 
+namespace css = com::sun::star;
+
 class WindowImpl
 {
   public:
-    Window  *mpWindow;
+    Window *mpWindow;
     Context *mpCtx;
-    css::uno::Reference< css::awt::XWindow >        mxWindow;
+    css::uno::Reference< css::awt::XWindow > mxWindow;
     css::uno::Reference< css::awt::XVclWindowPeer > mxVclPeer;
 
     WindowImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow )
-        : mpWindow ( pWindow )
-        , mpCtx ( pCtx )
-        , mxWindow ( xPeer, css::uno::UNO_QUERY )
+        : mpWindow( pWindow )
+        , mpCtx( pCtx )
+        , mxWindow( xPeer, css::uno::UNO_QUERY )
         , mxVclPeer( xPeer, css::uno::UNO_QUERY )
     {
     }
@@ -97,7 +97,9 @@ class ControlImpl : public WindowImpl
 {
   public:
     ControlImpl( Context *pCtx, const PeerHandle &xPeer, Window *pWindow )
-        : WindowImpl( pCtx, xPeer, pWindow ) {}
+        : WindowImpl( pCtx, xPeer, pWindow )
+    {
+    }
 };
 
 inline WindowImpl &Window::getImpl() const
--- toolkit/workben/layout/editor.cxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/workben/layout/editor.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -32,30 +32,28 @@
 #include "editor.hxx"
 
 #undef NDEBUG
-#include <assert.h>
-#include <stdio.h>
-
-#include <vector>
+#include <cassert>
+#include <cstdio>
+#include <cstring>
 #include <list>
-#include <rtl/strbuf.hxx>
-#include <rtl/ustrbuf.hxx>
-
-using namespace layout::css;
-
-using rtl::OUString;
+#include <vector>
 
-#include <com/sun/star/awt/XWindow.hpp>
-#include <com/sun/star/awt/XWindowPeer.hpp>
-#include <com/sun/star/awt/XVclWindowPeer.hpp>
+#include <com/sun/star/awt/WindowAttribute.hpp>
 #include <com/sun/star/awt/XLayoutConstrains.hpp>
 #include <com/sun/star/awt/XLayoutContainer.hpp>
-#include <com/sun/star/awt/WindowAttribute.hpp>
-
 #include <com/sun/star/awt/XToolkit.hpp>
+#include <com/sun/star/awt/XVclWindowPeer.hpp>
+#include <com/sun/star/awt/XWindow.hpp>
+#include <com/sun/star/awt/XWindowPeer.hpp>
+#include <rtl/strbuf.hxx>
+#include <rtl/ustrbuf.hxx>
 #include <toolkit/helper/property.hxx>
-
 #include <vcl/lstbox.h>
 
+using namespace layout::css;
+
+using rtl::OUString;
+
 // FIXME:
 //#define FILEDLG
 
--- toolkit/workben/layout/makefile.mk.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/workben/layout/makefile.mk	2009-04-06 16:42:11.000000000 +0000
@@ -43,7 +43,7 @@ ENABLE_EXCEPTIONS=TRUE
 CFLAGS += -I$(PRJ)/source/layout
 
 # Allow zoom and wordcount to be built without depending on svx,sv,sfx2
-CFLAGS += -I../$(PRJ)/svx/inc -I../$(PRJ)/svtools/inc -I../$(PRJ)/sfx2/inc
+CFLAGS += -I../$(PRJ)/svx/inc -I../$(PRJ)/svtools/inc
 
 .INCLUDE : $(PRJ)$/util$/makefile.pmk
 
@@ -55,6 +55,7 @@ CFLAGS+=-Wall -Wno-non-virtual-dtor
 
 CXXFILES=\
 	editor.cxx \
+	plugin.cxx \
 	recover.cxx \
 	wordcountdialog.cxx \
 	test.cxx \
@@ -62,6 +63,7 @@ CXXFILES=\
 
 OBJFILES=\
 	$(OBJ)$/editor.obj \
+	$(OBJ)$/plugin.obj \
 	$(OBJ)$/recover.obj \
 	$(OBJ)$/test.obj \
 	$(OBJ)$/wordcountdialog.obj \
@@ -77,12 +79,15 @@ APP1STDLIBS= \
 		$(CPPUHELPERLIB)		\
 		$(SALLIB)			\
 		$(XMLSCRIPTLIB)			\
-		$(TKLIB)
+		$(TKLIB) \
+		$(SVXLIB) \
+		$(ISCLIB) \
+#
 
 svtools = $(INCCOM)/svtools
-all: $(svtools) ALLTAR
+default: ALLTAR
 
-.INCLUDE :  target.mk
+.INCLUDE : target.mk
 
 XML_FILES=\
 	recover.xml\
@@ -92,13 +97,15 @@ XML_FILES=\
 TRALAY=tralay
 XML_LANGS=$(alllangiso)
 
-#ALL_XMLS=$(foreach,i,$(XML_LANGS) $(foreach,j,$(XML_FILES) $i/$j))
-ALLTAR: $(foreach,i,$(XML_FILES) en-US/$i)
+ALLTAR: $(BIN)/testrc $(svtools) $(foreach,i,$(XML_FILES) en-US/$i)
 
 $(XML_LANGS:f:t"/%.xml ")/%.xml: %.xml
 	$(TRALAY) -m localize.sdf -o . -l $(XML_LANGS:f:t" -l ") $<
 	rm -rf en-US
 
+$(BIN)/%: %.in
+	cp $< $@
+
 $(svtools):
 # FIXME: there's a bug in svtools layout or usage
 # Include files are in svtools/inc, but are referenced as <svtools/..>
--- toolkit/workben/layout/plugin.cxx.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/workben/layout/plugin.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,73 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#define _LAYOUT_PLUGIN_CXX
+
+#include "plugin.hxx"
+
+#include <com/sun/star/awt/XDialog2.hpp>
+#include <dialcontrol.hxx>
+#include <toolkit/awt/vclxwindow.hxx>
+
+#include <layout/layout-pre.hxx>
+
+using namespace com::sun::star;
+
+#define LAYOUT_RES(x) #x
+
+#undef ModalDialog
+#define ModalDialog( parent, id ) Dialog( parent, "plugin.xml", id )
+
+PluginDialog::PluginDialog( Window* pParent )
+    : ModalDialog( pParent, LAYOUT_RES( RID_DLG_PLUGIN ) )
+    , aHeaderImage( this, LAYOUT_RES( FI_HEADER ) )
+    , aHeaderText( this, LAYOUT_RES( FT_HEADER ) )
+    , aHeaderLine( this, LAYOUT_RES( FL_HEADER ) )
+    , aPlugin( this, LAYOUT_RES( PL_DIAL ),
+// FIXME: width=, height=, are not recognized as properties.
+//               new svx::DialControl( LAYOUT_DIALOG_PARENT, Size( 0, 0 ), 0 ) )
+               new svx::DialControl( LAYOUT_DIALOG_PARENT, Size( 80, 80 ), 0 ) )
+      //, aDialControl( static_cast<svx::DialControl&> ( aPlugin.GetPlugin() ) )
+    , aDialControl( static_cast<svx::DialControl&> ( *aPlugin.mpPlugin ) )
+    , aOKBtn( this, LAYOUT_RES( BTN_OK ) )
+	, aCancelBtn( this, LAYOUT_RES( BTN_CANCEL ) )
+	, aHelpBtn( this, LAYOUT_RES( BTN_HELP ) )
+{
+    aDialControl.SetRotation( 425 );
+}
+
+PluginDialog::~PluginDialog()
+{
+}
--- toolkit/workben/layout/plugin.hxx.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/workben/layout/plugin.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,65 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef _LAYOUT_PLUGIN_HXX
+#define _LAYOUT_PLUGIN_HXX
+
+#include <layout/layout.hxx>
+#include <layout/layout-pre.hxx>
+
+namespace svx {
+class DialControl;
+}
+
+class PluginDialog : public ModalDialog
+{
+private:
+    FixedImage aHeaderImage;
+    FixedText aHeaderText;
+    FixedLine aHeaderLine;
+    Plugin aPlugin;
+    svx::DialControl& aDialControl;
+    OKButton aOKBtn;
+    CancelButton aCancelBtn;
+    HelpButton aHelpBtn;
+
+public:
+    PluginDialog( Window* pParent );
+    ~PluginDialog();
+};
+
+#include <layout/layout-post.hxx>
+
+#endif /* _LAYOUT_PLUGIN_HXX */
+
--- toolkit/workben/layout/plugin.xml.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/workben/layout/plugin.xml	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,29 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!-- This is a template.  i18n translation is not performed in-place;
+     i18n translated xml files are generated from this template by
+     transex3/layout/tralay.  !-->
+
+<modaldialog xmlns="http://openoffice.org/2007/layout"
+             xmlns:cnt="http://openoffice.org/2007/layout/container"
+             id="RID_DLG_PLUGIN" _title="Plugin Test" optimumsize="true"
+	     help-id="SID_ATTR_PLUGIN"
+             has_border="true" sizeable="true" moveable="true">
+    <vbox spacing="5" border="5">
+        <hbox spacing="5" cnt:expand="false">
+	    <fixedimage id="FI_HEADER" cnt:expand="false" graphic="res/commandimagelist/sc_apply.png" />
+	    <fixedtext id="FT_HEADER" _label="Plugin Test"/>
+	</hbox>
+	<fixedline id="FL_HEADER"/>
+	<hbox>
+	  <flow cnt:padding="80"/>
+	  <plugin id="PL_DIAL" width="80" height="80"/>
+	</hbox>
+	<dialogbuttonhbox border="5" spacing="5">
+	    <flow/>
+	    <okbutton id="BTN_OK"/>
+	    <cancelbutton id="BTN_CANCEL" />
+	    <helpbutton id="BTN_HELP"/>
+	</dialogbuttonhbox>
+    </vbox>
+</modaldialog>
+
--- toolkit/workben/layout/simple-paragraph.cxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/workben/layout/simple-paragraph.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -37,12 +37,12 @@
 
 // include ---------------------------------------------------------------
 
-#include <stdio.h>
+#include <cstdio>
 #include <tools/shl.hxx>
 #include <sfx2/objsh.hxx>
 #include <vcl/msgbox.hxx>
 
-#include <stdio.h>
+#include <cstdio>
 
 namespace SVX {
 #include <svx/paraprev.hxx>        // Preview
--- toolkit/workben/layout/test.cxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/workben/layout/test.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -30,7 +30,6 @@
  ************************************************************************/
 
 #include <vcl/svapp.hxx>
-//#include <transex3/vosapp.hxx>
 
 // This works and was used before for standalone test, not sure why
 // we'd want it.
@@ -38,29 +37,30 @@
 #include "uno.hxx"
 
 #include <cstdio>
-#include <osl/file.h>
+#include <cstdlib>
 
-#include <rtl/ustring.hxx>
+#include <com/sun/star/xml/sax/SAXException.hpp>
+#include <comphelper/processfactory.hxx>
 #include <cppuhelper/bootstrap.hxx>
-
-#include <ucbhelper/contentbroker.hxx>
+#include <rtl/ustring.hxx>
 #include <ucbhelper/configurationkeys.hxx>
-
-#include <comphelper/processfactory.hxx>
-#include <com/sun/star/xml/sax/SAXException.hpp>
+#include <ucbhelper/contentbroker.hxx>
 
 #include "editor.hxx"
 
-#include "wordcountdialog.hxx"
-#undef _LAYOUT_POST_HXX
 
-#include "zoom.hxx"
+#include "plugin.hxx"
 #undef _LAYOUT_POST_HXX
 
 #include "recover.hxx"
 #undef _LAYOUT_POST_HXX
 
-//#undef SW_WORDCOUNTDIALOG_HXX
+#include "wordcountdialog.hxx"
+#undef _LAYOUT_POST_HXX
+
+#include "zoom.hxx"
+#undef _LAYOUT_POST_HXX
+
 #include <layout/layout-pre.hxx>
 
 using namespace ::rtl;
@@ -68,38 +68,6 @@ using namespace ::cppu;
 using namespace ::com::sun::star;
 using namespace ::com::sun::star::uno;
 
-Reference< XComponentContext > createInitialComponentContext(
-    OUString const & inst_dir )
-{
-    Reference< XComponentContext > xContext;
-    
-    try
-    {
-        OUString file_url;
-        oslFileError rc = osl_getFileURLFromSystemPath(
-            inst_dir.pData, &file_url.pData );
-        OSL_ASSERT( osl_File_E_None == rc );
-        (void) rc;  // quiet warning
-        
-        OUString unorc = file_url + OUString(
-            OUString::createFromAscii( "/program/" SAL_CONFIGFILE( "uno" )) );
-        
-        return defaultBootstrap_InitialComponentContext( unorc );
-    }
-    
-    catch( Exception& rExc )
-    {
-        OString aStr( OUStringToOString( rExc.Message,
-                                         RTL_TEXTENCODING_ASCII_US ) );
-        OSL_ENSURE( 0, aStr.getStr() );
-    }
-    
-    return xContext;
-}
-
-
-// -----------------------------------------------------------------------
-
 class LayoutTest : public Application
 {
     Reference< XComponentContext > mxContext;
@@ -115,7 +83,7 @@ public:
     void RunEditor();
     void RunFiles();
     void ExceptionalMain();
-    void IInit();
+    void Init();
     void InitUCB();
     void LoadFile( OUString const &aName );
     void Main();
@@ -124,18 +92,29 @@ public:
 
 static void usage()
 {
-    fprintf (stderr, "usage: test [--inst inst_dir] [DIALOG.XML]... | --test [DIALOG.XML]\n" );
+    fprintf (stderr, "usage: test [--inst OOO_INSTALL_PREFIX] [DIALOG.XML]... | --test [DIALOG.XML]\n" );
     exit( 2 );
 }
 
+static uno::Reference< lang::XSingleServiceFactory > get_factory( char const *service )
+{
+    uno::Reference< lang::XSingleServiceFactory > xFactory(
+        comphelper::createProcessComponent(
+            rtl::OUString::createFromAscii( service ) ), uno::UNO_QUERY );
+
+    if ( !xFactory.is() )
+        fprintf( stderr, "error loading: %s\n", service );
+    return xFactory;
+}
+
+#define GET_FACTORY(x) get_factory( #x )
+    
 void LayoutTest::LoadFile( const OUString &aTestFile )
 {
     fprintf( stderr, "TEST: layout instance\n" );
 
-    uno::Reference< lang::XSingleServiceFactory > xFactory(
-        comphelper::createProcessComponent(
-            rtl::OUString::createFromAscii( "com.sun.star.awt.Layout" ) ),
-        uno::UNO_QUERY );
+    uno::Reference< lang::XSingleServiceFactory > xFactory
+        = GET_FACTORY( com.sun.star.awt.Layout );
     if ( !xFactory.is() )
     {
         fprintf( stderr, "Layout engine not installed\n" );
@@ -155,40 +134,34 @@ void LayoutTest::LoadFile( const OUStrin
     fprintf( stderr, "TEST: file loaded\n" );
 }
 
-// Nurgh ...
 void LayoutTest::InitUCB()
 {
     OUString aEmpty;
-    Sequence< Any > aArgs(6);
+    Sequence< Any > aArgs( 6 );
     aArgs[0]
-        <<= OUString::createFromAscii(UCB_CONFIGURATION_KEY1_LOCAL);
+        <<= OUString::createFromAscii( UCB_CONFIGURATION_KEY1_LOCAL );
     aArgs[1]
-        <<= OUString::createFromAscii(UCB_CONFIGURATION_KEY2_OFFICE);
+        <<= OUString::createFromAscii( UCB_CONFIGURATION_KEY2_OFFICE );
     aArgs[2] <<= OUString::createFromAscii( "PIPE" );
     aArgs[3] <<= aEmpty;
     aArgs[4] <<= OUString::createFromAscii( "PORTAL" );
     aArgs[5] <<= aEmpty;
 
-    if (! ::ucbhelper::ContentBroker::initialize( mxMSF, aArgs ) )
+    if ( !::ucbhelper::ContentBroker::initialize( mxMSF, aArgs ) )
+    {
         fprintf( stderr, "Failed to init content broker\n" );
+        fprintf( stderr, "arg[0]: %s\n", UCB_CONFIGURATION_KEY1_LOCAL );
+        fprintf( stderr, "arg[1]: %s\n", UCB_CONFIGURATION_KEY2_OFFICE );
+    }
 }
 
-#define INIT_ENV_VOODOO( installDir )                                   \
-    /* Unless you do this, obviously you don't deserve to have anything work */ \
-    OString aCfg = "CFG_INIFILE=file://"                                \
-                 + OUStringToOString( installDir, RTL_TEXTENCODING_UTF8 ) \
-                 + "/program/configmgrrc";                              \
-    putenv( (char *)aCfg.getStr() );                                    \
-    /* Unless you do this, obviously you don't want your paths to be correct & \
-       hence no images.zip location is possible. */                     \
-    OString aBaseInst = "BaseInstallation=file://"                      \
-                 + OUStringToOString( installDir, RTL_TEXTENCODING_UTF8 ); \
-    putenv( (char *)aBaseInst.getStr() );                               \
-
-void LayoutTest::IInit()
+void LayoutTest::Init()
 {
-    INIT_ENV_VOODOO( mInstallDir );
-    mxContext = createInitialComponentContext( mInstallDir );
+    ParseCommandLine();
+    if (!getenv ("OOO_INSTALL_PREFIX") )
+        setenv( "OOO_INSTALL_PREFIX", OUSTRING_CSTR( mInstallDir ), 1 );
+    OSL_TRACE( "OOO_INSTALL_PREFIX=%s\n", getenv( "OOO_INSTALL_PREFIX" ) );
+    mxContext = defaultBootstrap_InitialComponentContext();
     mxMSF = new UnoBootstrapLayout( Reference< lang::XMultiServiceFactory >( mxContext->getServiceManager(), UNO_QUERY ) );
     ::comphelper::setProcessServiceFactory( mxMSF );
     InitUCB();
@@ -196,6 +169,7 @@ void LayoutTest::IInit()
 
 void LayoutTest::ParseCommandLine()
 {
+    printf ("%s\n", __PRETTY_FUNCTION__);
     for ( sal_uInt16 i = 0; i < GetCommandLineParamCount(); i++ )
     {
         OUString aParam = OUString( GetCommandLineParam( i ) );
@@ -206,6 +180,7 @@ void LayoutTest::ParseCommandLine()
             if ( i >= GetCommandLineParamCount() - 1)
                 usage();
             mInstallDir = GetCommandLineParam( ++i );
+            setenv( "OOO_INSTALL_PREFIX", OUSTRING_CSTR( mInstallDir ), 1 );
         }
         else if ( aParam.equalsAscii( "--test" ) )
         {
@@ -234,7 +209,17 @@ void LayoutTest::RunEditor()
     editor.Execute();
 }
 
-void RunDialog( layout::Dialog& dialog )
+void RunDialog( Dialog& dialog )
+{
+    dialog.Show();
+    dialog.Execute();
+    fprintf( stderr, "1st execute exited" );
+    dialog.Execute();
+    fprintf( stderr, "2nd execute exited" );
+}
+
+#undef Dialog
+void RunDialog( ::Dialog& dialog )
 {
     dialog.Show();
     dialog.Execute();
@@ -245,20 +230,27 @@ void RunDialog( layout::Dialog& dialog )
 
 void TestDialog( OUString const& name )
 {
-    if ( name.equalsAscii( "zoom" ) )
+    if ( 0 )
+        ;
+    else if ( name.equalsAscii( "plugin" ) )
     {
-        SvxZoomDialog zoom( 0 );
-        RunDialog( zoom );
+        PluginDialog plugin ( 0 );
+        RunDialog( plugin );
+    }
+    else if ( name.equalsAscii( "recover" ) )
+    {
+        SvxRecoverDialog recover ( 0 );
+        RunDialog( recover );
     }
     else if ( name.equalsAscii( "wordcount" ) )
     {
         SwWordCountDialog words ( 0 );
         RunDialog( words );
     }
-    else if ( name.equalsAscii( "recover" ) )
+    else if ( name.equalsAscii( "zoom" ) )
     {
-        SvxRecoverDialog recover ( 0 );
-        RunDialog( recover );
+        SvxZoomDialog zoom( 0 );
+        RunDialog( zoom );
     }
 }
 
@@ -274,10 +266,6 @@ void LayoutTest::RunFiles()
 
 void LayoutTest::ExceptionalMain()
 {
-    ParseCommandLine();
-    IInit();
-    INIT_ENV_VOODOO( mInstallDir );
-
     if ( mTestDialog.getLength() )
         TestDialog( mTestDialog );
     else if ( mEditMode )
@@ -323,4 +311,4 @@ LayoutTest::LayoutTest( char const* inst
 {
 }
 
-LayoutTest lt( "/usr/local/lib/ooo" );
+LayoutTest layout_test( "/usr/local/lib/ooo" );
--- toolkit/workben/layout/testrc.in.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/workben/layout/testrc.in	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,12 @@
+OOO_INSTALL_PREFIX_URL=file://${OOO_INSTALL_PREFIX}
+OOO_BASIS_URL=${OOO_INSTALL_PREFIX_URL}/openoffice.org/basis3.0
+OOO_BASIS_BIN_URL=${OOO_INSTALL_PREFIX_URL}/openoffice.org/basis3.0/program
+OOO_URE_URL=${OOO_INSTALL_PREFIX_URL}/openoffice.org/ure
+#
+#CFG_INIFILE=${OOO_BASIS_BIN_URL}/configmgrrc
+#BaseInstallation=${OOO_BASIS_URL}
+BRAND_BASE_DIR=${OOO_INSTALL_PREFIX_URL}/openoffice.org3
+OOO_BASE_DIR=${OOO_BASIS_URL}
+#
+UNO_TYPES=${OOO_URE_URL}/share/misc/types.rdb ${OOO_BASIS_BIN_URL}/offapi.rdb
+UNO_SERVICES=${OOO_URE_URL}/share/misc/services.rdb ${OOO_BASIS_BIN_URL}/services.rdb
--- toolkit/workben/layout/uno.hxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/workben/layout/uno.hxx	2009-04-06 16:42:11.000000000 +0000
@@ -32,7 +32,7 @@
 #ifndef _LAYOUT_UNO_HXX
 #define _LAYOUT_UNO_HXX
 
-#include <stdio.h>
+#include <cstdio>
 #include <com/sun/star/lang/XComponent.hpp>
 #include <com/sun/star/lang/XInitialization.hpp>
 #include <com/sun/star/lang/XMultiServiceFactory.hpp>
--- toolkit/workben/layout/zoom.cxx.old	2009-04-02 10:49:37.000000000 +0000
+++ toolkit/workben/layout/zoom.cxx	2009-04-06 16:42:11.000000000 +0000
@@ -51,9 +51,7 @@
 #define _SVX_ZOOM_CXX
 
 #include <svx/dialogs.hrc>
-#if !ENABLE_LAYOUT
 #include "zoom.hrc"
-#endif /* !ENABLE_LAYOUT */
 
 #include "zoom.hxx"
 #if TEST_LAYOUT
--- toolkit/workben/layout/zoom.hrc.old	1970-01-01 00:00:00.000000000 +0000
+++ toolkit/workben/layout/zoom.hrc	2009-04-06 16:42:11.000000000 +0000
@@ -0,0 +1,61 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile: zoom.hrc,v $
+ *
+ *  $Revision: 1.4 $
+ *
+ *  last change: $Author: kz $ $Date: 2008/03/07 15:16:57 $
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef _SVX_ZOOM_HRC
+#define _SVX_ZOOM_HRC
+
+// defines ------------------------------------------------------------------
+
+#define FL_ZOOM                                 14
+#define BTN_OPTIMAL                             15
+#define BTN_WHOLE_PAGE                          16
+#define BTN_PAGE_WIDTH                          17
+#define BTN_100                                 18
+#define BTN_USER                                19
+#define ED_USER                                 20
+
+#define FL_VIEWLAYOUT                           21
+#define BTN_AUTOMATIC                           22
+#define BTN_SINGLE                              23
+#define BTN_COLUMNS                             24
+#define ED_COLUMNS                              25
+#define CHK_BOOK                                26
+
+#define FL_BOTTOM                               27
+#define BTN_ZOOM_OK                             28
+#define BTN_ZOOM_CANCEL                         29
+#define BTN_ZOOM_HELP                           30
+
+#endif
+
