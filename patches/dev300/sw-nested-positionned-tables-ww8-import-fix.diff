From b9eed4629f705be0e72749e2e168d31a02a1589f Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:04:42 +0200
Subject: [PATCH 633/878] sw-nested-positionned-tables-ww8-import-fix.diff

---
 sw/source/filter/ww8/ww8par.cxx |   10 ++++++++--
 1 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/sw/source/filter/ww8/ww8par.cxx b/sw/source/filter/ww8/ww8par.cxx
index c7cb580..f205e02 100644
--- a/sw/source/filter/ww8/ww8par.cxx
+++ b/sw/source/filter/ww8/ww8par.cxx
@@ -2123,6 +2123,8 @@ bool SwWW8ImplReader::ProcessSpecial(bool &rbReSync, WW8_CP nStartCp)
             nCellLevel = 0 != pPlcxMan->HasParaSprm(0x244B);
     }
 
+ mark:
+
     WW8_TablePos *pTabPos=0;
     WW8_TablePos aTabPos;
     if (nCellLevel && !bVer67)
@@ -2136,7 +2138,7 @@ bool SwWW8ImplReader::ProcessSpecial(bool &rbReSync, WW8_CP nStartCp)
         if (const BYTE *pLevel = pPlcxMan->HasParaSprm(0x6649))
             nCellLevel = *pLevel;
 
-        bool bHasRowEnd = SearchRowEnd(pPap, nMyStartCp, nCellLevel-1);
+        bool bHasRowEnd = SearchRowEnd(pPap, nMyStartCp, (nInTable<nCellLevel?nInTable:nCellLevel-1));
 
         //Bad Table, remain unchanged in level, e.g. #i19667#
         if (!bHasRowEnd)
@@ -2217,12 +2219,16 @@ bool SwWW8ImplReader::ProcessSpecial(bool &rbReSync, WW8_CP nStartCp)
                                             // in Tabellen
         while (nInTable < nCellLevel)
         {
-            if (StartTable(nStartCp))
+            if (StartTable(nStartCp)) {
                 ++nInTable;
+        }
             else
                 break;
 
             maApos.push_back(false);
+        if (nInTable<nCellLevel)
+           goto mark;
+
         }
         // nach StartTable ist ein ReSync noetig ( eigentlich nur, falls die
         // Tabelle ueber eine FKP-Grenze geht
-- 
1.7.0.1

