From 92a2de5b6d770ec591e6a8fa4885f05d8cd95918 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:00:31 +0200
Subject: [PATCH 355/768] win32-installer-register-moox-types.diff

---
 .../win32/customactions/reg4msdoc/registrar.cxx    |   48 ++++++++++++++++++++
 .../reg4msdoc/registrationcontextinformation.cxx   |   36 +++++++++++++++
 .../reg4msdoc/registrationcontextinformation.hxx   |   14 ++++++
 3 files changed, 98 insertions(+), 0 deletions(-)

diff --git setup_native/source/win32/customactions/reg4msdoc/registrar.cxx setup_native/source/win32/customactions/reg4msdoc/registrar.cxx
index 94be324..b67a377 100644
--- setup_native/source/win32/customactions/reg4msdoc/registrar.cxx
+++ setup_native/source/win32/customactions/reg4msdoc/registrar.cxx
@@ -82,6 +82,14 @@ void Registrar::RegisterForMsWord() const
         RegistrationContextInformation::Writer);
     
     RegisterForMsOfficeApplication(
+        m_ContextInformation.GetMOOXWordDocumentFileExtension(),
+        m_ContextInformation.GetMOOXWordDocumentDisplayName(),
+        m_ContextInformation.GetWordDocumentDefaultIconEntry(),
+        m_ContextInformation.GetWordDocumentDefaultShellCommand(),
+        m_ContextInformation.ShellNewCommandDisplayName(),
+        RegistrationContextInformation::Writer);
+
+    RegisterForMsOfficeApplication(
         m_ContextInformation.GetWordTemplateFileExtension(),
         m_ContextInformation.GetWordTemplateDisplayName(),
         m_ContextInformation.GetWordTemplateDefaultIconEntry(),
@@ -115,6 +123,14 @@ void Registrar::UnregisterForMsWord() const
     try
     {
         UnregisterForMsOfficeApplication(
+            m_ContextInformation.GetMOOXWordDocumentFileExtension());
+    }
+    catch(RegistryKeyNotFoundException&)
+    {}
+
+    try
+    {
+        UnregisterForMsOfficeApplication(
             m_ContextInformation.GetWordTemplateFileExtension());		
     }
     catch(RegistryKeyNotFoundException&)
@@ -193,6 +209,14 @@ void Registrar::RegisterForMsExcel() const
         RegistrationContextInformation::Calc);
 
     RegisterForMsOfficeApplication(
+        m_ContextInformation.GetMOOXExcelSheetFileExtension(),
+        m_ContextInformation.GetMOOXExcelSheetDisplayName(),
+        m_ContextInformation.GetExcelSheetDefaultIconEntry(),
+        m_ContextInformation.GetExcelSheetDefaultShellCommand(),
+        m_ContextInformation.ShellNewCommandDisplayName(),
+        RegistrationContextInformation::Calc);
+
+    RegisterForMsOfficeApplication(
         m_ContextInformation.GetExcelTemplateFileExtension(),
         m_ContextInformation.GetExcelTemplateDisplayName(),
         m_ContextInformation.GetExcelTemplateDefaultIconEntry(),
@@ -218,6 +242,22 @@ void Registrar::UnregisterForMsExcel() const
     try
     {
         UnregisterForMsOfficeApplication(
+            m_ContextInformation.GetMOOXExcelSheetFileExtension());
+    }
+    catch(RegistryKeyNotFoundException&)
+    {}
+
+    try
+    {
+        UnregisterForMsOfficeApplication(
+            m_ContextInformation.GetMOOXPowerPointDocumentFileExtension());
+    }
+    catch(RegistryKeyNotFoundException&)
+    {}
+
+    try
+    {
+        UnregisterForMsOfficeApplication(
             m_ContextInformation.GetExcelTemplateFileExtension());
     }
     catch(RegistryKeyNotFoundException&)
@@ -245,6 +285,14 @@ void Registrar::RegisterForMsPowerPoint() const
         RegistrationContextInformation::Impress);
             
     RegisterForMsOfficeApplication(
+        m_ContextInformation.GetMOOXPowerPointDocumentFileExtension(),
+        m_ContextInformation.GetMOOXPowerPointDocumentDisplayName(),
+        m_ContextInformation.GetPowerPointDocumentDefaultIconEntry(),
+        m_ContextInformation.GetPowerPointDocumentDefaultShellCommand(),
+        m_ContextInformation.ShellNewCommandDisplayName(),
+        RegistrationContextInformation::Impress);
+
+    RegisterForMsOfficeApplication(
         m_ContextInformation.GetPowerPointShowFileExtension(),
         m_ContextInformation.GetPowerPointShowDisplayName(),
         m_ContextInformation.GetPowerPointShowDefaultIconEntry(),
diff --git setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.cxx setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.cxx
index f29f861..d11ea52 100644
--- setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.cxx
+++ setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.cxx
@@ -53,6 +53,18 @@ std::wstring RegistrationContextInformation::GetWordDocumentDefaultShellCommand(
     return std::wstring(TEXT("open"));
 }
 
+std::wstring RegistrationContextInformation::GetMOOXWordDocumentDisplayName() const
+{
+    std::wstring str;
+    str = TEXT("Microsoft Word 2007 Document");
+    return str;
+}
+
+std::wstring RegistrationContextInformation::GetMOOXWordDocumentFileExtension() const
+{
+    return std::wstring(TEXT(".docx"));
+}
+
 std::wstring RegistrationContextInformation::GetWordTemplateDisplayName() const
 {
     std::wstring str;
@@ -125,6 +137,18 @@ std::wstring RegistrationContextInformation::GetExcelSheetDefaultShellCommand()
     return std::wstring(TEXT("open"));
 }
 
+std::wstring RegistrationContextInformation::GetMOOXExcelSheetDisplayName() const
+{
+    std::wstring str;
+    str = TEXT("Microsoft Excel 2007 Spreadsheet");
+    return str;
+}
+
+std::wstring RegistrationContextInformation::GetMOOXExcelSheetFileExtension() const
+{
+    return std::wstring(TEXT(".xlsx"));
+}
+
 std::wstring RegistrationContextInformation::GetExcelTemplateDisplayName() const
 {
     std::wstring str;
@@ -173,6 +197,18 @@ std::wstring RegistrationContextInformation::GetPowerPointDocumentDefaultShellCo
     return std::wstring(TEXT("open"));
 }
 
+std::wstring RegistrationContextInformation::GetMOOXPowerPointDocumentDisplayName() const
+{
+    std::wstring str;
+    str = TEXT("Microsoft PowerPoint 2007 Presentation");
+    return str;
+}
+
+std::wstring RegistrationContextInformation::GetMOOXPowerPointDocumentFileExtension() const
+{
+    return std::wstring(TEXT(".pptx"));
+}
+
 std::wstring RegistrationContextInformation::GetPowerPointTemplateDisplayName() const
 {
     std::wstring str;
diff --git setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.hxx setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.hxx
index e2d8364..0821837 100644
--- setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.hxx
+++ setup_native/source/win32/customactions/reg4msdoc/registrationcontextinformation.hxx
@@ -46,6 +46,14 @@ public:
     std::wstring GetWordDocumentDefaultIconEntry() const;
     std::wstring GetWordDocumentDefaultShellCommand() const;
 
+    /** MOOX Word document information
+        The icon index is the index of the icon
+        in soffice.exe to be associated with
+        word document files
+    */
+    std::wstring GetMOOXWordDocumentDisplayName() const;
+    std::wstring GetMOOXWordDocumentFileExtension() const;
+
     /** Word template information
         The icon index is the index of the icon 
         in soffice.exe to be associated with 
@@ -76,6 +84,9 @@ public:
     std::wstring GetExcelSheetDefaultIconEntry() const;
     std::wstring GetExcelSheetDefaultShellCommand() const;
 
+    std::wstring GetMOOXExcelSheetDisplayName() const;
+    std::wstring GetMOOXExcelSheetFileExtension() const;
+
     /** Excel template information
         The icon index is the index of the icon 
         in soffice.exe to be associated with 
@@ -96,6 +107,9 @@ public:
     std::wstring GetPowerPointDocumentDefaultIconEntry() const;
     std::wstring GetPowerPointDocumentDefaultShellCommand() const;
 
+    std::wstring GetMOOXPowerPointDocumentDisplayName() const;
+    std::wstring GetMOOXPowerPointDocumentFileExtension() const;
+
     /** PowerPoint template information
         The icon index is the index of the icon 
         in soffice.exe to be associated with 
-- 
1.7.0.1

