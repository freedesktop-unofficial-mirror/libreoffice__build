Index: framework/source/uielement/generictoolbarcontroller.cxx
===================================================================
RCS file: /cvs/framework/framework/source/uielement/generictoolbarcontroller.cxx,v
retrieving revision 1.7
retrieving revision 1.7.34.1
diff -u -p -u -p -r1.7 -r1.7.34.1
--- framework/source/uielement/generictoolbarcontroller.cxx	13 Dec 2004 12:27:01 -0000	1.7
+++ framework/source/uielement/generictoolbarcontroller.cxx	27 Jan 2005 17:08:26 -0000	1.7.34.1
@@ -110,6 +110,9 @@
 #ifndef _SV_SVAPP_HXX
 #include <vcl/svapp.hxx>
 #endif
+#ifndef _VCL_MNEMONIC_HXX_
+#include <vcl/mnemonic.hxx>
+#endif
 #include <tools/urlobj.hxx>
 
 using namespace ::rtl;
@@ -278,7 +281,11 @@ throw ( RuntimeException )
 		        nItemBits |= TIB_CHECKABLE;
             }
             else
-                m_pToolbar->SetItemText( m_nID, aStrValue );
+            {
+                ::rtl::OUString aText( MnemonicGenerator::EraseAllMnemonicChars( aStrValue ) );
+                m_pToolbar->SetItemText( m_nID, aText );
+                m_pToolbar->SetQuickHelpText( m_nID, aText );
+            }
             
             m_pToolbar->ShowItem( m_nID, TRUE );
         }
cvs diff: cannot open CVS/Entries for reading: No such file or directory
cvs [diff aborted]: no repository
Index: svx/inc/lboxctrl.hxx
===================================================================
RCS file: /cvs/graphics/svx/inc/lboxctrl.hxx,v
retrieving revision 1.8
retrieving revision 1.7.344.2
diff -u -p -u -p -r1.8 -r1.7.344.2
--- svx/inc/lboxctrl.hxx	21 Jan 2005 14:53:59 -0000	1.8
+++ svx/inc/lboxctrl.hxx	4 Feb 2005 15:42:14 -0000	1.7.344.2
@@ -106,6 +106,7 @@ public:
 class SVX_DLLPUBLIC SvxUndoRedoControl : public SvxListBoxControl
 {
     std::vector< ::rtl::OUString > aUndoRedoList;
+    ::rtl::OUString                aDefaultText;
 
 public:
 	SFX_DECL_TOOLBOX_CONTROL();
Index: svx/inc/tbcontrl.hxx
===================================================================
RCS file: /cvs/graphics/svx/inc/tbcontrl.hxx,v
retrieving revision 1.9
retrieving revision 1.8.72.3
diff -u -p -u -p -r1.9 -r1.8.72.3
--- svx/inc/tbcontrl.hxx	21 Jan 2005 15:38:08 -0000	1.9
+++ svx/inc/tbcontrl.hxx	7 Feb 2005 13:25:55 -0000	1.8.72.3
@@ -478,4 +478,18 @@ protected:
 							   const SfxPoolItem* pState );
 };
 
+class SVX_DLLPUBLIC SvxSimpleUndoRedoController : public SfxToolBoxControl
+{
+private:
+    ::rtl::OUString             aDefaultText;
+
+public:
+    SFX_DECL_TOOLBOX_CONTROL();
+    SvxSimpleUndoRedoController( USHORT nSlotId, USHORT nId, ToolBox& rTbx );
+    ~SvxSimpleUndoRedoController();
+
+    virtual void                StateChanged( USHORT nSID, SfxItemState eState,
+											  const SfxPoolItem* pState );
+};
+
 #endif // #ifndef _SVX_TBCONTRL_HXX
Index: svx/source/tbxctrls/lboxctrl.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/tbxctrls/lboxctrl.cxx,v
retrieving revision 1.20
retrieving revision 1.20.448.1
diff -u -p -u -p -r1.20 -r1.20.448.1
--- svx/source/tbxctrls/lboxctrl.cxx	6 Jul 2004 13:19:31 -0000	1.20
+++ svx/source/tbxctrls/lboxctrl.cxx	27 Jan 2005 17:01:49 -0000	1.20.448.1
@@ -332,6 +332,7 @@ SvxUndoRedoControl::SvxUndoRedoControl( 
 {
 	rTbx.SetItemBits( nId, TIB_DROPDOWN | rTbx.GetItemBits( nId ) );
 	rTbx.Invalidate();
+    aDefaultText = MnemonicGenerator::EraseAllMnemonicChars( rTbx.GetItemText( nId ) );
 }
 
 SvxUndoRedoControl::~SvxUndoRedoControl()
@@ -343,7 +344,12 @@ void SvxUndoRedoControl::StateChanged( 
 {
     if ( nSID == SID_UNDO || nSID == SID_REDO )
     {
-        if ( pState && pState->ISA( SfxStringItem ))
+        if ( eState == SFX_ITEM_DISABLED )
+        {
+            ToolBox& rBox = GetToolBox();
+            rBox.SetQuickHelpText( GetId(), aDefaultText );
+        }
+        else if ( pState && pState->ISA( SfxStringItem ) )
         {
             SfxStringItem& rItem = *(SfxStringItem *)pState;
             ToolBox& rBox = GetToolBox();
Index: svx/source/tbxctrls/tbcontrl.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/tbxctrls/tbcontrl.cxx,v
retrieving revision 1.60
retrieving revision 1.58.6.2
diff -u -p -u -p -r1.60 -r1.58.6.2
--- svx/source/tbxctrls/tbcontrl.cxx	27 Jan 2005 10:45:20 -0000	1.60
+++ svx/source/tbxctrls/tbcontrl.cxx	4 Feb 2005 17:18:06 -0000	1.58.6.2
@@ -133,6 +133,9 @@
 #ifndef INCLUDED_SVTOOLS_FONTOPTIONS_HXX
 #include <svtools/fontoptions.hxx>
 #endif
+#ifndef _VCL_MNEMONIC_HXX_
+#include <vcl/mnemonic.hxx>
+#endif
 
 #pragma hdrstop
 
@@ -214,6 +217,7 @@ SFX_IMPL_TOOLBOX_CONTROL( SvxFrameToolBo
 SFX_IMPL_TOOLBOX_CONTROL( SvxFrameLineStyleToolBoxControl, SvxLineItem );
 SFX_IMPL_TOOLBOX_CONTROL( SvxFrameLineColorToolBoxControl, SvxColorItem );
 SFX_IMPL_TOOLBOX_CONTROL( SvxReloadControllerItem,	SfxBoolItem );
+SFX_IMPL_TOOLBOX_CONTROL( SvxSimpleUndoRedoController, SfxStringItem );
 
 //========================================================================
 // class SvxStyleBox_Impl -----------------------------------------------------
@@ -3249,6 +3253,38 @@ void SvxReloadControllerItem::StateChang
 }
 
 //========================================================================
+// class SvxSimpleUndoRedoController -------------------------------------
+//========================================================================
+
+SvxSimpleUndoRedoController::SvxSimpleUndoRedoController( USHORT nSlotId, USHORT nId, ToolBox& rTbx  )
+    :SfxToolBoxControl( nSlotId, nId, rTbx )
+{
+    aDefaultText = rTbx.GetItemText( nId );
+}
+
+// -----------------------------------------------------------------------
+
+SvxSimpleUndoRedoController::~SvxSimpleUndoRedoController()
+{
+}
+
+// -----------------------------------------------------------------------
+
+void SvxSimpleUndoRedoController::StateChanged( USHORT nSID, SfxItemState eState, const SfxPoolItem* pState )
+{
+    SfxStringItem* pItem = PTR_CAST( SfxStringItem, pState );
+    ToolBox& rBox = GetToolBox();
+    if ( pItem && eState != SFX_ITEM_DISABLED )
+    {
+        ::rtl::OUString aNewText( MnemonicGenerator::EraseAllMnemonicChars( pItem->GetValue() ) );
+        rBox.SetQuickHelpText( GetId(), aNewText );
+    }
+    if ( eState == SFX_ITEM_DISABLED )
+        rBox.SetQuickHelpText( GetId(), aDefaultText );
+    rBox.EnableItem( GetId(), eState != SFX_ITEM_DISABLED );
+}
+
+//========================================================================
 
 void lcl_ResizeValueSet( Window &rWin, ValueSet &rValueSet )
 {
Index: sfx2/source/control/statcach.cxx
===================================================================
RCS file: /cvs/framework/sfx2/source/control/statcach.cxx,v
retrieving revision 1.24
retrieving revision 1.23.22.2
diff -u -p -u -p -r1.24 -r1.23.22.2
--- sfx2/source/control/statcach.cxx	27 Jan 2005 09:46:41 -0000	1.24
+++ sfx2/source/control/statcach.cxx	4 Feb 2005 17:28:14 -0000	1.23.22.2
@@ -322,8 +322,7 @@ const SfxSlotServer* SfxStateCache::GetS
 
         DBG_ASSERT( !pDispatch, "Old Dispatch not removed!" );
 
-        // we don't need to check the dispatch provider if we only have an internal controller
-        if ( pController && xProv.is() )
+        if ( xProv.is() )
         {
             const SfxSlot* pSlot = aSlotServ.GetSlot();
             if ( !pSlot )
Index: odk/examples/DevelopersGuide/BasicAndDialogs/ToolkitControls/ToolkitControls/ProgressBar.xba
===================================================================
RCS file: /cvs/api/odk/examples/DevelopersGuide/BasicAndDialogs/ToolkitControls/ToolkitControls/ProgressBar.xba,v
retrieving revision 1.2
retrieving revision 1.2.4.1
diff -u -p -u -p -r1.2 -r1.2.4.1
--- odk/examples/DevelopersGuide/BasicAndDialogs/ToolkitControls/ToolkitControls/ProgressBar.xba	31 Jan 2005 16:08:17 -0000	1.2
+++ odk/examples/DevelopersGuide/BasicAndDialogs/ToolkitControls/ToolkitControls/ProgressBar.xba	8 Feb 2005 11:06:37 -0000	1.2.4.1
@@ -40,8 +40,8 @@ Sub ProgressBarDemo()
 	
 	REM progress bar settings
 	Const ProgressValueMin = 0
-	Const ProgressValueMax = 40
-	Const ProgressStep = 4		
+	Const ProgressValueMax = 50
+	Const ProgressStep = 1
 
 	REM set minimum and maximum progress value
 	oProgressBarModel = oDialog.Model.ProgressBar1
@@ -61,7 +61,7 @@ Sub ProgressBarDemo()
 	REM increase progress value every second
 	For ProgressValue = ProgressValueMin To ProgressValueMax Step ProgressStep
    	    oProgressBarModel.ProgressValue = ProgressValue
-		Wait 1000	
+		Wait 40
 	Next ProgressValue
 
 	REM hide progress bar
Index: basctl/source/basicide/basicbox.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/basicbox.cxx,v
retrieving revision 1.6
retrieving revision 1.6.6.1
diff -u -p -u -p -r1.6 -r1.6.6.1
--- basctl/source/basicide/basicbox.cxx	13 Jan 2005 17:48:52 -0000	1.6
+++ basctl/source/basicide/basicbox.cxx	25 Jan 2005 16:07:30 -0000	1.6.6.1
@@ -263,7 +263,7 @@ void BasicLibBox::InsertEntries( SfxObje
         String aLibName = pLibNames[ i ];
         if ( eLocation == BasicIDE::GetLibraryLocation( pShell, aLibName ) )
         {
-            String aName( BasicIDE::GetTitle( pShell, eLocation, SFX_TITLE_FILENAME ) );
+            String aName( BasicIDE::GetTitle( pShell, eLocation, SFX_TITLE_CAPTION ) );
             String aEntryText( CreateMgrAndLibStr( aName, aLibName ) );
             USHORT nPos = InsertEntry( aEntryText, LISTBOX_APPEND );
             SetEntryData( nPos, new BasicLibEntry( pShell, eLocation, aLibName ) );
Index: basctl/source/basicide/basides1.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/basides1.cxx,v
retrieving revision 1.39
retrieving revision 1.39.22.2
diff -u -p -u -p -r1.39 -r1.39.22.2
--- basctl/source/basicide/basides1.cxx	13 Dec 2004 12:39:55 -0000	1.39
+++ basctl/source/basicide/basides1.cxx	25 Jan 2005 16:07:50 -0000	1.39.22.2
@@ -344,7 +344,11 @@ void __EXPORT BasicIDEShell::ExecuteGlob
                 // document basic
                 SfxObjectShell* pShell = pCurWin->GetShell();
                 if ( pShell )
-					pShell->ExecuteSlot( rReq );
+                {
+                    SfxViewFrame* pViewFrame = SfxViewFrame::GetFirst( pShell );
+                    if ( pViewFrame )
+                        pViewFrame->GetBindings().Execute( nSlot );
+                }
 
 				SfxBindings &rBindings = BasicIDE::GetBindings();
 				rBindings.Invalidate( SID_DOC_MODIFIED );
@@ -694,7 +698,7 @@ void __EXPORT BasicIDEShell::ExecuteGlob
                     {
                         SfxMedium* pMedium = pObjShell->GetMedium();
                         if ( ( pMedium && aDocument == String(pMedium->GetURLObject().GetMainURL( INetURLObject::NO_DECODE )) ) ||
-                                aDocument == pObjShell->GetTitle( SFX_TITLE_FILENAME ) )
+                                aDocument == pObjShell->GetTitle( SFX_TITLE_CAPTION ) )
                         {
                             pShell = pObjShell;
                             break;
Index: basctl/source/basicide/basides2.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/basides2.cxx,v
retrieving revision 1.11
retrieving revision 1.11.26.1
diff -u -p -u -p -r1.11 -r1.11.26.1
--- basctl/source/basicide/basides2.cxx	17 Nov 2004 10:26:41 -0000	1.11
+++ basctl/source/basicide/basides2.cxx	25 Jan 2005 16:07:51 -0000	1.11.26.1
@@ -189,7 +189,7 @@ void BasicIDEShell::SetMDITitle()
     if ( m_aCurLibName.Len() )
     {
         LibraryLocation eLocation = BasicIDE::GetLibraryLocation( m_pCurShell, m_aCurLibName );
-        aTitle = BasicIDE::GetTitle( m_pCurShell, eLocation, SFX_TITLE_FILENAME );
+        aTitle = BasicIDE::GetTitle( m_pCurShell, eLocation, SFX_TITLE_CAPTION );
         aTitle += '.';
         aTitle += m_aCurLibName;
 	}
@@ -202,7 +202,7 @@ void BasicIDEShell::SetMDITitle()
     if ( pViewFrame )
     {
         SfxObjectShell* pShell = pViewFrame->GetObjectShell();
-        if ( pShell && aTitle != pShell->GetTitle( SFX_TITLE_FILENAME ) )
+        if ( pShell && aTitle != pShell->GetTitle( SFX_TITLE_CAPTION ) )
         {
             pShell->SetTitle( aTitle );
             pShell->SetModified( FALSE );
Index: basctl/source/basicide/basidesh.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/basidesh.cxx,v
retrieving revision 1.33
retrieving revision 1.33.6.1
diff -u -p -u -p -r1.33 -r1.33.6.1
--- basctl/source/basicide/basidesh.cxx	13 Jan 2005 17:49:19 -0000	1.33
+++ basctl/source/basicide/basidesh.cxx	27 Jan 2005 17:11:48 -0000	1.33.6.1
@@ -108,6 +108,7 @@
 #include <svx/insctrl.hxx>
 #include <svx/srchdlg.hxx>
 #include <svx/lboxctrl.hxx>
+#include <svx/tbcontrl.hxx>
 
 #ifndef _COM_SUN_STAR_SCRIPT_XLIBRARYCONTAINER_HPP_
 #include <com/sun/star/script/XLibraryContainer.hpp>
@@ -198,6 +199,8 @@ void BasicIDEShell::Init()
 	SvxPosSizeStatusBarControl::RegisterControl();
 	SvxInsertStatusBarControl::RegisterControl();
 	XmlSecStatusBarControl::RegisterControl( SID_SIGNATURE );
+    SvxSimpleUndoRedoController::RegisterControl( SID_UNDO );
+    SvxSimpleUndoRedoController::RegisterControl( SID_REDO );
 
 	SvxSearchDialogWrapper::RegisterChildWindow( sal_False );
 
Index: basctl/source/basicide/bastype2.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/bastype2.cxx,v
retrieving revision 1.15
retrieving revision 1.15.6.1
diff -u -p -u -p -r1.15 -r1.15.6.1
--- basctl/source/basicide/bastype2.cxx	13 Jan 2005 17:49:45 -0000	1.15
+++ basctl/source/basicide/bastype2.cxx	25 Jan 2005 16:08:15 -0000	1.15.6.1
@@ -566,7 +566,7 @@ String BasicTreeListBox::GetRootEntryNam
     else if ( !( nMode & BROWSEMODE_MODULES ) && ( nMode & BROWSEMODE_DIALOGS ) )
         eType = LIBRARY_TYPE_DIALOG;
 
-    return BasicIDE::GetTitle( pShell, eLocation, SFX_TITLE_FILENAME, eType );
+    return BasicIDE::GetTitle( pShell, eLocation, SFX_TITLE_CAPTION, eType );
 }
 
 void BasicTreeListBox::GetRootEntryBitmaps( SfxObjectShell* pShell, Image& rImage, Image& rImageHC )
Index: basctl/source/basicide/bastypes.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/bastypes.cxx,v
retrieving revision 1.24
retrieving revision 1.24.74.1
diff -u -p -u -p -r1.24 -r1.24.74.1
--- basctl/source/basicide/bastypes.cxx	23 Jul 2004 12:04:26 -0000	1.24
+++ basctl/source/basicide/bastypes.cxx	25 Jan 2005 16:08:15 -0000	1.24.74.1
@@ -260,7 +260,7 @@ String IDEBaseWindow::CreateQualifiedNam
     if ( m_aLibName.Len() )
     {
         LibraryLocation eLocation = BasicIDE::GetLibraryLocation( m_pShell, m_aLibName );
-        aName = BasicIDE::GetTitle( m_pShell, eLocation, SFX_TITLE_APINAME );
+        aName = BasicIDE::GetTitle( m_pShell, eLocation, SFX_TITLE_CAPTION );
         aName += '.';
         aName += m_aLibName;
         aName += '.';
Index: basctl/source/basicide/moduldl2.cxx
===================================================================
RCS file: /cvs/script/basctl/source/basicide/moduldl2.cxx,v
retrieving revision 1.50
retrieving revision 1.49.6.2
diff -u -p -u -p -r1.50 -r1.49.6.2
--- basctl/source/basicide/moduldl2.cxx	27 Jan 2005 14:25:38 -0000	1.50
+++ basctl/source/basicide/moduldl2.cxx	4 Feb 2005 17:35:40 -0000	1.49.6.2
@@ -1259,7 +1259,7 @@ void LibPage::FillListBox()
 
 void LibPage::InsertListBoxEntry( SfxObjectShell* pShell, LibraryLocation eLocation )
 {
-    String aEntryText( BasicIDE::GetTitle( pShell, eLocation, SFX_TITLE_FILENAME ) );
+    String aEntryText( BasicIDE::GetTitle( pShell, eLocation, SFX_TITLE_CAPTION ) );
     USHORT nPos = aBasicsBox.InsertEntry( aEntryText, LISTBOX_APPEND );
     aBasicsBox.SetEntryData( nPos, new BasicShellEntry( pShell, eLocation ) );
 }
Index: basctl/source/dlged/dlged.cxx
===================================================================
RCS file: /cvs/script/basctl/source/dlged/dlged.cxx,v
retrieving revision 1.35
retrieving revision 1.35.22.1
diff -u -p -u -p -r1.35 -r1.35.22.1
--- basctl/source/dlged/dlged.cxx	10 Dec 2004 17:01:51 -0000	1.35
+++ basctl/source/dlged/dlged.cxx	17 Feb 2005 15:40:52 -0000	1.35.22.1
@@ -637,6 +637,11 @@ IMPL_LINK( DlgEditor, PaintTimeout, Time
 		}
 	}
 
+    // #i43005# repaint problems when deleting controls
+    Wallpaper aWallpaper( Color( COL_WHITE ) );
+    if ( pWindow )
+        pWindow->DrawWallpaper( aPaintRect, aWallpaper );
+
     // #114282# unbuffered paint
     SdrPageView* pPgView = pDlgEdView->GetPageViewPvNum(0);
     if ( pPgView )
