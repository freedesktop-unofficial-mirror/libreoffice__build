diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=sc.vpj sc.clean/source/core/data/documen7.cxx sc/source/core/data/documen7.cxx
--- sc.clean/source/core/data/documen7.cxx	2008-04-01 18:26:36.000000000 +0200
+++ sc/source/core/data/documen7.cxx	2008-04-13 00:11:00.000000000 +0200
@@ -35,7 +35,7 @@
 
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_sc.hxx"
-
+#include <stdio.h>
 // INCLUDE ---------------------------------------------------------------
 
 #include <vcl/svapp.hxx>
@@ -110,6 +110,16 @@ void ScDocument::Broadcast( ULONG nHint,
 
 void ScDocument::Broadcast( const ScHint& rHint )
 {
+    const ScAddress& rAddr = rHint.GetAddress();
+    if (rAddr != BCA_BRDCST_ALWAYS)
+    {
+        String aStr;
+        rAddr.Format(aStr, SCA_ABS, this);
+        fprintf(stdout, "ScDocument::Broadcast:   address = '%s'; col = %d; row = %ld\n",
+                rtl::OUStringToOString(aStr, RTL_TEXTENCODING_UTF8).getStr(),
+                rAddr.Col(), rAddr.Row());
+    }
+
 	if ( !pBASM )
 		return ;	// Clipboard or Undo
 	if ( !nHardRecalcState )
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=sc.vpj sc.clean/source/ui/docshell/docsh.cxx sc/source/ui/docshell/docsh.cxx
--- sc.clean/source/ui/docshell/docsh.cxx	2008-04-01 18:26:34.000000000 +0200
+++ sc/source/ui/docshell/docsh.cxx	2008-04-13 00:15:17.000000000 +0200
@@ -37,7 +37,7 @@
 #include "precompiled_sc.hxx"
 // System - Includes -----------------------------------------------------
 
-
+#include <stdio.h>
 
 #include "scitems.hxx"
 #include <svx/eeitem.hxx>
@@ -2629,7 +2629,49 @@ ScDocShellModificator::~ScDocShellModifi
 
 void ScDocShellModificator::SetDocumentModified()
 {
+    static long callCount = 0;
+    fprintf(stdout, "ScDocShellModificator::SetDocumentModified: --begin (%ld)\n", callCount++);
+
 	ScDocument* pDoc = rDocShell.GetDocument();
+    {
+        // Kohei's experimental code
+        ScViewData* pViewData = ScDocShell::GetViewData();
+        ScMarkData aMarkData( pViewData->GetMarkData() );
+        aMarkData.SetMarking(false);
+
+        if (aMarkData.IsMarked())
+        {
+            if (aMarkData.IsMultiMarked())
+            {
+                ScRangeList aList;
+                aMarkData.FillRangeListWithMarks(&aList, false);
+                String aStr;
+                aList.Format(aStr, SCR_ABS_3D, pDoc, ScAddress::CONV_XL_A1);
+                fprintf(stdout, "ScDocShellModificator::SetDocumentModified:   format = '%s' (multimark list)\n",
+                        rtl::OUStringToOString(aStr, RTL_TEXTENCODING_UTF8).getStr());
+            }
+            else
+            {
+                ScRange aRange;
+                aMarkData.GetMarkArea(aRange);
+                String aStr;
+                aRange.Format(aStr, SCR_ABS_3D, pDoc, ScAddress::CONV_XL_A1);
+                fprintf(stdout, "ScDocShellModificator::SetDocumentModified:   format = '%s'\n",
+                        rtl::OUStringToOString(aStr, RTL_TEXTENCODING_UTF8).getStr());
+            }
+        }
+        else
+        {
+            ScAddress aAddr(pViewData->GetCurX(), pViewData->GetCurY(), pViewData->GetTabNo());
+            String aStr;
+            aAddr.Format(aStr, SCA_ABS_3D, pDoc, ScAddress::CONV_XL_A1);
+            fprintf(stdout, "ScDocShellModificator::SetDocumentModified:   format = '%s' (not marked)\n",
+                    rtl::OUStringToOString(aStr, RTL_TEXTENCODING_UTF8).getStr());
+            fprintf(stdout, "ScDocShellModificator::SetDocumentModified: tab=%d; col=%d; row=%ld\n",
+                    pViewData->GetTabNo(), pViewData->GetCurX(), pViewData->GetCurY());
+        }
+    }
+
 	if ( !pDoc->IsImportingXML() )
 	{
 		// AutoCalcShellDisabled temporaer restaurieren
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=sc.vpj sc.clean/source/ui/view/gridwin.cxx sc/source/ui/view/gridwin.cxx
--- sc.clean/source/ui/view/gridwin.cxx	2008-04-01 18:26:33.000000000 +0200
+++ sc/source/ui/view/gridwin.cxx	2008-04-12 10:58:05.000000000 +0200
@@ -36,7 +36,7 @@
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_sc.hxx"
 
-
+#include <stdio.h>
 
 //------------------------------------------------------------------
 
@@ -5175,6 +5175,7 @@ void ScGridWindow::DeleteSelectionOverla
 
 void ScGridWindow::UpdateSelectionOverlay()
 {
+//  fprintf(stdout, "ScGridWindow::UpdateSelectionOverlay: --begin\n");
     MapMode aDrawMode = GetDrawMapMode();
     MapMode aOldMode = GetMapMode();
     if ( aOldMode != aDrawMode )
@@ -5185,8 +5186,10 @@ void ScGridWindow::UpdateSelectionOverla
     std::vector<Rectangle> aPixelRects;
     GetSelectionRects( aPixelRects );
 
+
     if ( aPixelRects.size() && pViewData->IsActive() )
     {
+//      fprintf(stdout, "ScGridWindow::UpdateSelectionOverlay:   rect count = %d\n", aPixelRects.size());
         SCTAB nTab = pViewData->GetTabNo();
         BOOL bLayoutRTL = pViewData->GetDocument()->IsLayoutRTL( nTab );
         BOOL bOld = pViewData->GetView()->IsOldSelection();
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=sc.vpj sc.clean/source/ui/view/tabview3.cxx sc/source/ui/view/tabview3.cxx
--- sc.clean/source/ui/view/tabview3.cxx	2008-04-01 18:26:33.000000000 +0200
+++ sc/source/ui/view/tabview3.cxx	2008-04-13 10:25:27.000000000 +0200
@@ -1570,11 +1570,13 @@ void ScTabView::Unmark()
 
 void ScTabView::SetMarkData( const ScMarkData& rNew )
 {
+    fprintf(stdout, "ScTabView::SetMarkData: --begin\n");
     DoneBlockMode();
     InitOwnBlockMode();
     aViewData.GetMarkData() = rNew;
 
     MarkDataChanged();
+    fprintf(stdout, "ScTabView::SetMarkData: --end\n");
 }
 
 void ScTabView::MarkDataChanged()
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=sc.vpj sc.clean/source/ui/view/viewfun3.cxx sc/source/ui/view/viewfun3.cxx
--- sc.clean/source/ui/view/viewfun3.cxx	2008-04-01 18:26:33.000000000 +0200
+++ sc/source/ui/view/viewfun3.cxx	2008-04-13 10:35:05.000000000 +0200
@@ -752,6 +752,7 @@ BOOL ScViewFunc::PasteFromClip( USHORT n
 									InsCellCmd eMoveMode, USHORT nUndoExtraFlags,
 									BOOL bAllowDialogs )
 {
+    fprintf(stdout, "ScViewFunc::PasteFromClip: --begin\n");
 	if (!pClipDoc)
 	{
 		DBG_ERROR("PasteFromClip: pClipDoc=0 not allowed");
@@ -1049,6 +1050,7 @@ BOOL ScViewFunc::PasteFromClip( USHORT n
 		DoneBlockMode();
 		InitOwnBlockMode();
 	}
+    rMark.SetMarking(true);
 	rMark.SetMarkArea( aUserRange );
     MarkDataChanged();
 
@@ -1217,6 +1219,7 @@ BOOL ScViewFunc::PasteFromClip( USHORT n
 	SelectionChanged();
 
 	delete pTransClip;
+    fprintf(stdout, "ScViewFunc::PasteFromClip: --end\n");
 	return TRUE;
 }
 
