Index: solenv/inc/libs.mk
===================================================================
RCS file: /cvs/tools/solenv/inc/libs.mk,v
retrieving revision 1.96
diff -u -p -u -r1.96 libs.mk
--- solenv/inc/libs.mk	20 Jan 2006 14:22:05 -0000	1.96
+++ solenv/inc/libs.mk	20 Mar 2006 13:41:17 -0000
@@ -64,12 +64,13 @@ DUNOUTILLIBST=-ldunoutil
 DVCLUTILLIBST=-ldvclutil
 BPICONVLIB=-lbpiconv
 TOOLSLIB=-ltl$(OFFICEUPD)$(DLLPOSTFIX)
+UNOTYPESLIB=-lexcept$(OFFICEUPD)$(DLLPOSTFIX)
 # make sure some ancient libs are empty
 OSLLIB=
 RTLLIB=
 TECLIB=
 CPPULIB=-luno_cppu
-CPPUHELPERLIB=-luno_cppuhelper$(COMID)
+CPPUHELPERLIB=-luno_cppuhelper$(COMID) $(UNOTYPESLIB)
 .INCLUDE .IGNORE : ucbhelper$/version.mk
 UCBHELPERLIB=-lucbhelper$(UCBHELPER_MAJOR)$(COMID)
 REGLIB=-lreg

Index: cppuhelper/source/makefile.mk
===================================================================
RCS file: /cvs/udk/cppuhelper/source/makefile.mk,v
retrieving revision 1.41
diff -u -p -u -r1.41 makefile.mk
--- cppuhelper/source/makefile.mk	27 Oct 2005 17:19:33 -0000	1.41
+++ cppuhelper/source/makefile.mk	20 Mar 2006 13:11:41 -0000
@@ -151,8 +151,9 @@ SHL1TARGET=uno_$(TARGET)$(COMID)
 SHL1STDLIBS= \
 		$(SALLIB)		\
 		$(SALHELPERLIB)	\
-		$(CPPULIB)
+		$(CPPULIB) \
+		$(UNOTYPESLIB)
 
 SHL1DEPN=
 SHL1IMPLIB=i$(TARGET)
--- /dev/null	2006-03-11 13:25:00.000000000 +0000
+++ offuh/except/except.cxx	2006-03-17 20:34:49.000000000 +0000
@@ -0,1 +1,25 @@
+#include <sal/config.h>
+#include <cppu/macros.hxx>
+
+// We don't want to hide all this shared goodness:
+#undef CPPU_GCC_DLLPUBLIC_EXPORT
+#define CPPU_GCC_DLLPUBLIC_EXPORT 
+#undef CPPU_GCC_DLLPRIVATE
+#define CPPU_GCC_DLLPRIVATE 
+
+#define CPPU_INTERNAL_IMPL 1 
+
+// Evilness: sal/config.h includes stdlib.h
+// that has some workarounds for 'major' / 'minor'
+// issues, at least on Linux. These then cause problems
+// with chained constructors: FooClass : major(0) tec.
+
+// obscure CORBA compat interfaces
+#undef major
+#undef minor
+
+// com/sun/star/drawing/CaptionEscapeDirection.idl: keyword genius
+#define auto not_auto
+
+#include <catch.hxx>
--- /dev/null	2006-03-11 13:25:00.000000000 +0000
+++ offuh/except/makefile.mk	2006-03-17 11:44:41.000000000 +0000
@@ -0,0 +1,23 @@
+# --- Settings -----------------------------------------------------
+
+PRJ=..
+
+PRJNAME=offuh
+TARGET=unotypes
+ENABLE_EXCEPTIONS=TRUE
+
+.INCLUDE :  settings.mk
+
+LIB1TARGET= $(SLB)$/$(TARGET).lib
+LIB1OBJFILES= $(SLO)$/except.obj
+
+SHL1TARGET=except$(UPD)$(DLLPOSTFIX)
+SHL1LIBS=$(LIB1TARGET)
+SHL1STDLIBS= $(SALLIB) $(SALHELPERLIB) $(REGLIB) $(CPPULIB)
+
+# --- Targets -------------------------------------------------------
+
+.INCLUDE :  target.mk
+
+$(LIB1OBJFILES) : $(MISC)$/offuh.don
+


Index: codemaker/source/cppumaker/cppumaker.cxx
===================================================================
RCS file: /cvs/udk/codemaker/source/cppumaker/cppumaker.cxx,v
retrieving revision 1.8
diff -u -p -u -r1.8 cppumaker.cxx
--- codemaker/source/cppumaker/cppumaker.cxx	8 Sep 2005 02:11:34 -0000	1.8
+++ codemaker/source/cppumaker/cppumaker.cxx	20 Mar 2006 13:40:57 -0000
@@ -180,6 +180,9 @@ SAL_IMPLEMENT_MAIN_WITH_ARGS(argc, argv)
 		exit(99);
 	}
 
+	if (options.isValid("-O")) // sucky indeed !
+		inline_str = "";
+
 	if (options.isValid("-B"))
 	{
 		typeMgr.setBase(options.getOption("-B"));
@@ -245,6 +248,36 @@ SAL_IMPLEMENT_MAIN_WITH_ARGS(argc, argv)
 		exit(99);
 	}
 
+	if (!aIncludes.empty() && options.isValid("-O"))
+	{
+		OString outPath = options.getOption("-O");
+		outPath += "/catch.hxx";
+		FILE *excepts = fopen (outPath, "w+");
+		fprintf (excepts, "// This file is autogenerated by cppumaker\n");
+		fprintf (excepts, "// include exception headers\n");
+
+		::std::list<rtl::OString>::const_iterator iter;
+
+		for (iter = aIncludes.begin(); iter != aIncludes.end(); iter++)
+		{
+			rtl::OString aStr = *iter;
+			fprintf (excepts, "#include <%s.hpp>\n", (const sal_Char *) aStr);
+		}
+	
+		fprintf (excepts, "// dummy method\n");
+		fprintf (excepts, "extern void force_emit ()\n");
+		fprintf (excepts, "{\n");
+		for (iter = aExceptionNames.begin(); iter != aExceptionNames.end(); iter++) {
+			fprintf (excepts, "    try {\n");
+			fprintf (excepts, "        force_emit ();\n");
+			fprintf (excepts, "    }\n");
+			rtl::OString aStr = *iter;
+			fprintf (excepts, "catch (const %s &r) {} \n", (const sal_Char *)aStr);
+		}
+		fprintf (excepts, "}\n\n");
+		fclose (excepts);
+	}
+
 	return 0;
 }
 
Index: codemaker/source/cppumaker/cpputype.cxx
===================================================================
RCS file: /cvs/udk/codemaker/source/cppumaker/cpputype.cxx,v
retrieving revision 1.37
diff -u -p -u -r1.37 cpputype.cxx
--- codemaker/source/cppumaker/cpputype.cxx	26 Jan 2006 17:42:38 -0000	1.37
+++ codemaker/source/cppumaker/cpputype.cxx	20 Mar 2006 13:40:58 -0000
@@ -56,6 +56,11 @@
 
 using namespace rtl;
 
+::std::list<rtl::OString> aExceptionNames;
+::std::list<rtl::OString> aIncludes;
+// This sucks - but ...
+const char *inline_str = "inline";
+
 namespace {
 
 rtl::OString translateSimpleUnoType(rtl::OString const & unoType) {
@@ -322,9 +327,11 @@ void CppuType::addGetCppuTypeIncludes(co
     }
 }
 
-bool CppuType::dumpFiles(CppuOptions * options, rtl::OString const & outPath) {
+bool CppuType::dumpFiles(CppuOptions * options, rtl::OString const & outPath)
+{
+	aIncludes.insert(aIncludes.end(), m_typeName);
     return dumpFile(options, ".hdl", m_typeName, outPath)
-        && dumpFile(options, ".hpp", m_typeName, outPath);
+		&& dumpFile(options, ".hpp", m_typeName, outPath);
 }
 
 void CppuType::addLightGetCppuTypeIncludes(
@@ -357,7 +364,8 @@ void CppuType::dumpTemplateHead(FileStre
 
 void CppuType::dumpTemplateParameters(FileStream &) const {}
 
-void CppuType::dumpGetCppuTypePreamble(FileStream & out) {
+void CppuType::dumpGetCppuTypePreamble(FileStream & out)
+{
     if (isPolymorphic()) {
         out << "namespace cppu {\n\n";
         dumpTemplateHead(out);
@@ -367,17 +375,26 @@ void CppuType::dumpGetCppuTypePreamble(F
         out << " > {\npublic:\n";
         inc();
         out << indent()
-            << "static inline ::com::sun::star::uno::Type const & get() {\n";
+            << "static " << inline_str << " ::com::sun::star::uno::Type const & get()\n";
+		out << "{\n";
     } else {
         if (codemaker::cppumaker::dumpNamespaceOpen(out, m_typeName, false)) {
             out << "\n\n";
         }
-        out << ("inline ::com::sun::star::uno::Type const &"
-                " cppu_detail_getUnoType(");
+        out << inline_str << (" ::com::sun::star::uno::Type const &"
+							  " cppu_detail_getUnoType(");
         dumpType(out, m_typeName, false, false, true);
-        out << " const *) {\n";
+        out << " const *)";
+
+		out << "\n";
+		out << "#ifndef CPPU_INTERNAL_IMPL\n";
+		out << ";\n";
+		if (codemaker::cppumaker::dumpNamespaceClose(out, m_typeName, false))
+			out << "\n";
+		out << "#else // CPPU_INTERNAL_IMPL\n";
+		out << "{\n";
     }
-    inc();
+	inc();
 }
 
 void CppuType::dumpGetCppuTypePostamble(FileStream & out) {
@@ -393,9 +410,10 @@ void CppuType::dumpGetCppuTypePostamble(
         if (codemaker::cppumaker::dumpNamespaceClose(out, m_typeName, false)) {
             out << "\n\n";
         }
+		out << "#endif // CPP_INTERNAL_IMPL\n";
     }
     dumpTemplateHead(out);
-    out << "inline ::com::sun::star::uno::Type const & SAL_CALL getCppuType(";
+    out << inline_str << " ::com::sun::star::uno::Type const & SAL_CALL getCppuType(";
     dumpType(out, m_typeName);
     dumpTemplateParameters(out);
     out << " const *) SAL_THROW(()) {\n";
@@ -443,7 +461,7 @@ sal_Bool CppuType::dumpFile(CppuOptions*
 	sal_Bool ret = sal_False;
 
     OString sTmpExt(".tml");
-    sal_Bool bHdl = sal_True;    ;
+    sal_Bool bHdl = sal_True;
     if (sExtension.equals(".hpp")) {
         sTmpExt = ".tmp";
         bHdl = sal_False;
@@ -627,8 +645,8 @@ void CppuType::dumpInitializer(
 
 void CppuType::dumpGetCppuType(FileStream & out) {
     if (m_typeName.equals("com/sun/star/uno/XInterface")) {
-        out << indent()
-            << ("inline ::com::sun::star::uno::Type const & SAL_CALL"
+		out << indent() << inline_str
+            << (" ::com::sun::star::uno::Type const & SAL_CALL"
                 " getCppuType(");
         dumpType(out, m_typeName, true, false);
         out << " *) SAL_THROW(()) {\n";
@@ -639,8 +657,8 @@ void CppuType::dumpGetCppuType(FileStrea
         dec();
         out << indent() << "}\n";
     } else if (m_typeName.equals("com/sun/star/uno/Exception")) {
-        out << indent()
-            << ("inline ::com::sun::star::uno::Type const & SAL_CALL"
+		out << indent() << inline_str
+            << (" ::com::sun::star::uno::Type const & SAL_CALL"
                 " getCppuType(");
         dumpType(out, m_typeName, true, false);
         out << " *) SAL_THROW(()) {\n";
@@ -1468,11 +1486,12 @@ sal_Bool InterfaceType::dumpHFile(
         o << "\n";
     }
 	dumpDeclaration(o);
+
     if (codemaker::cppumaker::dumpNamespaceClose(o, m_typeName, false)) {
         o << "\n";
     }
 
-	o << "\ninline const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
+	o << inline_str << "\n const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
 	dumpType(o, m_typeName, sal_True, sal_False);
 	o << "* ) SAL_THROW( () );\n\n";
 
@@ -1500,8 +1519,8 @@ sal_Bool InterfaceType::dumpDeclaration(
 	dumpAttributes(o);
 	dumpMethods(o);
 
-    o << "\n" << indent()
-      << ("static inline ::com::sun::star::uno::Type const & SAL_CALL"
+    o << "\n" << indent() << "static " << inline_str
+      << (" ::com::sun::star::uno::Type const & SAL_CALL"
           " static_type(void * = 0);\n");
 
 	dec();
@@ -1521,6 +1540,8 @@ sal_Bool InterfaceType::dumpHxxFile(
 	includes.dump(o, &m_typeName);
 	o << "\n";
 
+	o << "#ifdef CPPU_INTERNAL_IMPL\n";
+	o << "// InterfaceType::dumpHxxFile impl\n";
 	dumpGetCppuType(o);
 
     o << "\n::com::sun::star::uno::Type const & "
@@ -1532,6 +1553,7 @@ sal_Bool InterfaceType::dumpHxxFile(
     o << " * >(0));\n";
     dec();
     o << "}\n";
+	o << "#endif // CPPU_INTERNAL_IMPL\n";
 
 	o << "\n#endif // "<< headerDefine << "\n";
 	return sal_True;
@@ -2432,8 +2454,8 @@ sal_Bool ConstantsType::dumpDeclaration(
             m_reader.getFieldTypeName(i), RTL_TEXTENCODING_UTF8);
 				
         o << "static const ";
-        dumpType(o, fieldType);	
-        o << " " << fieldName << " = ";
+        dumpType(o, fieldType);
+        o << " " << translateIdentifier(fieldName, "const", false) << " = ";
         dumpConstantValue(o, i);
         o << ";\n";
 	}		
@@ -2447,7 +2469,7 @@ sal_Bool ConstantsType::hasConstants()
 }	
 
 sal_Bool ConstantsType::dumpHxxFile(
-    FileStream& o, codemaker::cppumaker::Includes & includes)
+	FileStream& o, codemaker::cppumaker::Includes & includes)
 	throw( CannotDumpException )
 {
 	sal_Bool bSpecialDefine = sal_True;
@@ -2489,6 +2511,7 @@ ModuleType::~ModuleType()
 bool ModuleType::dumpFiles(
     CppuOptions * options, rtl::OString const & outPath)
 {
+	aIncludes.insert(aIncludes.end(), m_typeName);
     rtl::OString tmpName(m_typeName);
     if (tmpName.equals("/")) {
         tmpName = "global";
@@ -2496,7 +2519,7 @@ bool ModuleType::dumpFiles(
         tmpName += "/" + m_typeName.copy(m_typeName.lastIndexOf('/') + 1);
     }
     return dumpFile(options, ".hdl", tmpName, outPath)
-        && dumpFile(options, ".hpp", tmpName, outPath);
+		&& dumpFile(options, ".hpp", tmpName, outPath);
 }
 
 //*************************************************************************
@@ -2551,7 +2574,7 @@ sal_Bool StructureType::dumpHFile(
 	  << "class Type;\n} } } }\n\n";
 
     dumpTemplateHead(o);
-	o << "inline const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
+	o << inline_str << " const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
 	dumpType(o, m_typeName, sal_True, sal_False); 
     dumpTemplateParameters(o);
 	o << "* );\n\n";
@@ -2585,10 +2608,10 @@ sal_Bool StructureType::dumpDeclaration(
     }
     o << " {\n";
     inc();
-    o << indent() << "inline " << m_name << "() SAL_THROW(());\n";
+    o << indent() << inline_str << " " << m_name << "() SAL_THROW(());\n";
     sal_uInt16 members = m_reader.getFieldCount();
     if (members > 0 || getInheritedMemberCount() > 0) {
-        o << "\n" << indent() << "inline " << m_name << "(";
+		o << "\n" << indent() << inline_str << " " << m_name << "(";
         bool prev = dumpSuperMember(o, base, true);
         for (sal_uInt16 i = 0; i < members; ++i) {
             if (prev) {
@@ -2652,7 +2675,7 @@ sal_Bool StructureType::dumpDeclaration(
 }
 
 sal_Bool StructureType::dumpHxxFile(
-    FileStream& o, codemaker::cppumaker::Includes & includes)
+	FileStream& o, codemaker::cppumaker::Includes & includes)
 	throw( CannotDumpException )
 {
 	OString headerDefine(dumpHeaderDefine(o, "HPP"));
@@ -2667,7 +2690,7 @@ sal_Bool StructureType::dumpHxxFile(
 	o << "\n";
 
     dumpTemplateHead(o);
-	o << "inline " << m_name;
+	o << inline_str << " " << m_name;
     dumpTemplateParameters(o);
     o << "::" << m_name << "() SAL_THROW( () )\n";
 	inc();
@@ -2718,7 +2741,7 @@ sal_Bool StructureType::dumpHxxFile(
 	if (fieldCount > 0 || getInheritedMemberCount() > 0)
 	{
         dumpTemplateHead(o);
-		o << "inline " << m_name;
+		o << inline_str << " " << m_name;
         dumpTemplateParameters(o);
         o << "::" << m_name << "(";
 
@@ -2792,7 +2815,9 @@ sal_Bool StructureType::dumpHxxFile(
     }
 
 	o << "\n";
+	o << "#ifdef CPPU_INTERNAL_IMPL\n";
 	dumpGetCppuType(o);
+	o << "\n#endif // CPPU_INTERNAL_IMPL\n";
 
 	o << "\n#endif // "<< headerDefine << "\n";
 
@@ -3256,7 +3281,7 @@ sal_Bool ExceptionType::dumpHFile(
 	o << "\nnamespace com { namespace sun { namespace star { namespace uno {\n"
 	  << "class Type;\n} } } }\n\n";
 
-	o << "inline const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
+	o << inline_str << " const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
 	dumpType(o, m_typeName, sal_True, sal_False); 
 	o << "* ) SAL_THROW( () );\n\n";
 
@@ -3265,6 +3290,16 @@ sal_Bool ExceptionType::dumpHFile(
 	return sal_True;
 }
 
+bool
+ExceptionType::dumpFiles(CppuOptions * options, rtl::OString const & outPath)
+{
+	OString aTypeName = scopedName (OString(), m_typeName);
+	aExceptionNames.insert(aExceptionNames.end(), aTypeName);
+
+	aIncludes.insert(aIncludes.end(), m_typeName);
+	return CppuType::dumpFiles (options, outPath);
+}
+
 sal_Bool ExceptionType::dumpDeclaration(FileStream& o)
 	throw( CannotDumpException )
 {
@@ -3280,7 +3315,7 @@ sal_Bool ExceptionType::dumpDeclaration(
 		
 	o << "\n{\npublic:\n";
 	inc();
-	o << indent() << "inline CPPU_GCC_DLLPRIVATE " << m_name
+	o << indent() << inline_str << " CPPU_GCC_DLLPRIVATE " << m_name
       << "() SAL_THROW( () );\n\n";
 		
 	sal_uInt16 		fieldCount = m_reader.getFieldCount();
@@ -3291,7 +3326,7 @@ sal_Bool ExceptionType::dumpDeclaration(
 		
 	if (fieldCount > 0 || getInheritedMemberCount() > 0)
 	{
-		o << indent() << "inline CPPU_GCC_DLLPRIVATE " << m_name << "(";
+		o << indent() << inline_str << " CPPU_GCC_DLLPRIVATE " << m_name << "(";
 			
 		sal_Bool superHasMember = dumpSuperMember(o, superType, sal_True);
 			
@@ -3318,10 +3353,10 @@ sal_Bool ExceptionType::dumpDeclaration(
 		}		
 		o << ") SAL_THROW( () );\n\n";
 	}
-    o << indent() << "inline CPPU_GCC_DLLPRIVATE " << m_name << "(" << m_name
+    o << indent() << inline_str << " CPPU_GCC_DLLPRIVATE " << m_name << "(" << m_name
       << " const &);\n\n"
-      << indent() << "inline CPPU_GCC_DLLPRIVATE ~" << m_name << "();\n\n"
-      << indent() << "inline CPPU_GCC_DLLPRIVATE " << m_name << " & operator =("
+      << indent() << inline_str << " CPPU_GCC_DLLPRIVATE ~" << m_name << "();\n\n"
+      << indent() << inline_str << " CPPU_GCC_DLLPRIVATE " << m_name << " & operator =("
       << m_name << " const &);\n\n";
 
 	for (i=0; i < fieldCount; i++)
@@ -3355,7 +3390,7 @@ sal_Bool ExceptionType::dumpDeclaration(
 }
 
 sal_Bool ExceptionType::dumpHxxFile(
-    FileStream& o, codemaker::cppumaker::Includes & includes)
+	FileStream& o, codemaker::cppumaker::Includes & includes)
 	throw( CannotDumpException )
 {
 	OString headerDefine(dumpHeaderDefine(o, "HPP"));
@@ -3365,12 +3400,15 @@ sal_Bool ExceptionType::dumpHxxFile(
 	includes.dump(o, &m_typeName);
 	o << "\n";
 	
+	o << "#ifdef CPPU_INTERNAL_IMPL\n";
+	o << "// ExceptionType::dumpHxxFile impl\n";
+
     if (codemaker::cppumaker::dumpNamespaceOpen(o, m_typeName, false)) {
         o << "\n";
     }
 	o << "\n";
 
-	o << "inline " << m_name << "::" << m_name << "() SAL_THROW( () )\n";
+	o << inline_str << " " << m_name << "::" << m_name << "() SAL_THROW( () )\n";
 	inc();
 	OString superType;
     if (m_reader.getSuperTypeCount() >= 1) {
@@ -3426,7 +3464,7 @@ sal_Bool ExceptionType::dumpHxxFile(
 
 	if (fieldCount > 0 || getInheritedMemberCount() > 0)
 	{
-		o << indent() << "inline " << m_name << "::" << m_name << "(";
+		o << indent() << inline_str << " " << m_name << "::" << m_name << "(";
 
 		sal_Bool superHasMember = dumpSuperMember(o, superType, sal_True);
 
@@ -3539,6 +3577,7 @@ sal_Bool ExceptionType::dumpHxxFile(
 
 	o << "\n";
 	dumpGetCppuType(o);
+	o << "\n#endif // CPPU_INTERNAL_IMPL\n";
 
 	o << "\n#endif // "<< headerDefine << "\n";
 	return sal_True;
@@ -3638,7 +3677,7 @@ sal_Bool EnumType::dumpHFile(
 	o << "\nnamespace com { namespace sun { namespace star { namespace uno {\n"
 	  << "class Type;\n} } } }\n\n";
 
-	o << "inline const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
+	o << inline_str << " const ::com::sun::star::uno::Type& SAL_CALL getCppuType( ";
 	dumpType(o, m_typeName, sal_True, sal_False); 
 	o << "* ) SAL_THROW( () );\n\n";
 
@@ -3686,7 +3725,7 @@ sal_Bool EnumType::dumpDeclaration(FileS
 }
 
 sal_Bool EnumType::dumpHxxFile(
-    FileStream& o, codemaker::cppumaker::Includes & includes)
+	FileStream& o, codemaker::cppumaker::Includes & includes)
 	throw( CannotDumpException )
 {
 	OString headerDefine(dumpHeaderDefine(o, "HPP"));
@@ -3696,7 +3735,9 @@ sal_Bool EnumType::dumpHxxFile(
     includes.dump(o, &m_typeName);
 	o << "\n";
 
+	o << "#ifdef CPPU_INTERNAL_IMPL\n";
 	dumpGetCppuType(o);
+	o << "\n#endif // CPPU_INTERNAL_IMPL\n";
 
 	o << "\n#endif // "<< headerDefine << "\n";
 	return sal_True;
@@ -3862,7 +3903,7 @@ sal_Bool TypeDefType::dumpDeclaration(Fi
 }
 
 sal_Bool TypeDefType::dumpHxxFile(
-    FileStream& o, codemaker::cppumaker::Includes & includes)
+	FileStream& o, codemaker::cppumaker::Includes & includes)
 	throw( CannotDumpException )
 {
 	OString headerDefine(dumpHeaderDefine(o, "HPP"));
@@ -3890,7 +3931,8 @@ sal_Bool ConstructiveType::dumpHFile(
 bool ConstructiveType::dumpFiles(
     CppuOptions * options, rtl::OString const & outPath)
 {
-    return dumpFile(options, ".hpp", m_typeName, outPath);
+	aIncludes.insert(aIncludes.end(), m_typeName);
+	return dumpFile(options, ".hpp", m_typeName, outPath);
 }
 
 //*************************************************************************
@@ -3921,8 +3963,69 @@ bool ServiceType::isSingleInterfaceBased
     return m_reader.getSuperTypeCount() == 1;
 }
 
+void ServiceType::dumpCtorSignature(FileStream & o,
+									const OString & cppName,
+									bool impl, int i)
+		throw (CannotDumpException)
+{
+	OString aNameSpace;
+	if (impl)
+		aNameSpace = cppName + "::";
+
+	rtl::OString baseName(
+            rtl::OUStringToOString(
+					m_reader.getSuperTypeName(0), RTL_TEXTENCODING_UTF8));
+	rtl::OString scopedBaseName(scopedName(rtl::OString(), baseName));
+
+	o << indent() << (impl ? "" : "static ");
+	if (isDefaultConstructor(i)) {
+		o << "::com::sun::star::uno::Reference< "
+		  << scopedBaseName << " > "
+		  << aNameSpace
+		  << translateIdentifier("create", "method", false, &cppName)
+		  << ("(::com::sun::star::uno::Reference<"
+			  " ::com::sun::star::uno::XComponentContext > const &"
+			  " the_context)");
+	} else {
+		o << "::com::sun::star::uno::Reference< "
+		  << scopedBaseName << " > "
+		  << aNameSpace
+		  << translateIdentifier(
+				  rtl::OUStringToOString(
+                          m_reader.getMethodName(i), RTL_TEXTENCODING_UTF8),
+				  "method", false, &cppName)
+		  << ("(::com::sun::star::uno::Reference<"
+			  " ::com::sun::star::uno::XComponentContext > const &"
+			  " the_context");
+		sal_uInt16 params = m_reader.getMethodParameterCount(i);
+		for (sal_uInt16 j = 0; j < params; ++j) {
+			o << ", ";
+			rtl::OStringBuffer buf;
+			if ((m_reader.getMethodParameterFlags(i, j) & RT_PARAM_REST)
+				!= 0)
+			{
+				buf.append(RTL_CONSTASCII_STRINGPARAM("[]"));
+			}
+			buf.append(
+					rtl::OUStringToOString(
+                            m_reader.getMethodParameterTypeName(i, j),
+                            RTL_TEXTENCODING_UTF8));
+			rtl::OString type(buf.makeStringAndClear());
+			bool byRef = passByReference(type);
+			dumpType(o, type, byRef, byRef);
+			o << " "
+			  << translateIdentifier(
+					  rtl::OUStringToOString(
+                              m_reader.getMethodParameterName(i, j),
+                              RTL_TEXTENCODING_UTF8),
+					  "param", false);
+		}
+		o << ")\n";
+	}
+}
+
 sal_Bool ServiceType::dumpHxxFile(
-    FileStream & o, codemaker::cppumaker::Includes & includes)
+	FileStream & o, codemaker::cppumaker::Includes & includes)
     throw (CannotDumpException)
 {
     sal_uInt16 ctors = m_reader.getMethodCount();
@@ -3983,27 +4086,39 @@ sal_Bool ServiceType::dumpHxxFile(
     o << "\n";
     includes.dump(o, 0);
     o << "\n";
+
     if (codemaker::cppumaker::dumpNamespaceOpen(o, m_typeName, false)) {
         o << "\n";
     }
     o << "\nclass " << cppName << " {\n";
     inc();
     if (ctors > 0) {
+        o << "public:\n";
+        for (sal_uInt16 i = 0; i < ctors; ++i) {
+			dumpCtorSignature (o, cppName, false, i);
+			o << ";\n";
+		}
+	}
+    o << "private:\n";
+    o << indent() << cppName << "(); // not implemented\n"
+      << indent() << cppName << "(" << cppName << " &); // not implemented\n"
+      << indent() << "~" << cppName << "(); // not implemented\n"
+      << indent() << "void operator =(" << cppName << "); // not implemented\n";
+    dec();
+    o << "};\n\n";
+
+    if (ctors > 0) {
+		o << "#ifdef CPPU_INTERNAL_IMPL\n";
         rtl::OString fullName(m_typeName.replace('/', '.'));
         rtl::OString baseName(
             rtl::OUStringToOString(
                 m_reader.getSuperTypeName(0), RTL_TEXTENCODING_UTF8));
         rtl::OString fullBaseName(baseName.replace('/', '.'));
         rtl::OString scopedBaseName(scopedName(rtl::OString(), baseName));
-        o << "public:\n";
         for (sal_uInt16 i = 0; i < ctors; ++i) {
-            if (isDefaultConstructor(i)) {
-                o << indent() << "static ::com::sun::star::uno::Reference< "
-                  << scopedBaseName << " > "
-                  << translateIdentifier("create", "method", false, &cppName)
-                  << ("(::com::sun::star::uno::Reference<"
-                      " ::com::sun::star::uno::XComponentContext > const &"
-                      " the_context) {\n");
+			dumpCtorSignature (o, cppName, true, i);
+			if (isDefaultConstructor(i)) {
+				o << "{\n";
                 inc();
                 o << indent()
                   << ("::com::sun::star::uno::Reference<"
@@ -4059,40 +4174,10 @@ sal_Bool ServiceType::dumpHxxFile(
                 dec();
                 o << indent() << "}\n\n";
             } else {
-                o << indent() << "static ::com::sun::star::uno::Reference< "
-                  << scopedBaseName << " > "
-                  << translateIdentifier(
-                      rtl::OUStringToOString(
-                          m_reader.getMethodName(i), RTL_TEXTENCODING_UTF8),
-                      "method", false, &cppName)
-                  << ("(::com::sun::star::uno::Reference<"
-                      " ::com::sun::star::uno::XComponentContext > const &"
-                      " the_context");
-                sal_uInt16 params = m_reader.getMethodParameterCount(i);
-                bool rest = hasRestParameter(i);
-                for (sal_uInt16 j = 0; j < params; ++j) {
-                    o << ", ";
-                    rtl::OStringBuffer buf;
-                    if ((m_reader.getMethodParameterFlags(i, j) & RT_PARAM_REST)
-                        != 0)
-                    {
-                        buf.append(RTL_CONSTASCII_STRINGPARAM("[]"));
-                    }
-                    buf.append(
-                        rtl::OUStringToOString(
-                            m_reader.getMethodParameterTypeName(i, j),
-                            RTL_TEXTENCODING_UTF8));
-                    rtl::OString type(buf.makeStringAndClear());
-                    bool byRef = passByReference(type);
-                    dumpType(o, type, byRef, byRef);
-                    o << " "
-                      << translateIdentifier(
-                          rtl::OUStringToOString(
-                              m_reader.getMethodParameterName(i, j),
-                              RTL_TEXTENCODING_UTF8),
-                          "param", false);
-                }
-                o << ") {\n";
+				bool rest = hasRestParameter(i);
+				sal_uInt16 params = m_reader.getMethodParameterCount(i);
+
+				o << "{\n";
                 inc();
                 o << indent()
                   << ("::com::sun::star::uno::Reference<"
@@ -4216,14 +4301,9 @@ sal_Bool ServiceType::dumpHxxFile(
                 o << indent() << "}\n\n";
             }
         }
+		o << "#endif // CPPU_INTERNAL_IMPL\n";
     }
-    o << "private:\n";
-    o << indent() << cppName << "(); // not implemented\n"
-      << indent() << cppName << "(" << cppName << " &); // not implemented\n"
-      << indent() << "~" << cppName << "(); // not implemented\n"
-      << indent() << "void operator =(" << cppName << "); // not implemented\n";
-    dec();
-    o << "};\n\n";
+
     if (codemaker::cppumaker::dumpNamespaceClose(o, m_typeName, false)) {
         o << "\n";
     }
@@ -4282,7 +4362,7 @@ bool SingletonType::isInterfaceBased() {
 }
 
 sal_Bool SingletonType::dumpHxxFile(
-    FileStream & o, codemaker::cppumaker::Includes & includes)
+	FileStream & o, codemaker::cppumaker::Includes & includes)
     throw (CannotDumpException)
 {
     rtl::OString cppName(translateIdentifier(m_name, "singleton", isGlobal()));
@@ -4304,6 +4384,10 @@ sal_Bool SingletonType::dumpHxxFile(
     includes.addRtlUstringHxx();
     includes.dump(o, 0);
     o << "\n";
+
+	o << "#ifdef CPPU_INTERNAL_IMPL\n";
+	o << "// SingletonType::dumpHxxFile impl\n";
+
     if (codemaker::cppumaker::dumpNamespaceOpen(o, m_typeName, false)) {
         o << "\n";
     }
@@ -4340,6 +4424,7 @@ sal_Bool SingletonType::dumpHxxFile(
     if (codemaker::cppumaker::dumpNamespaceClose(o, m_typeName, false)) {
         o << "\n";
     }
+	o << "\n#endif // CPPU_INTERNAL_IMPL\n";
     o << "\n#endif // "<< headerDefine << "\n";
     return true;
 }
Index: codemaker/source/cppumaker/cpputype.hxx
===================================================================
RCS file: /cvs/udk/codemaker/source/cppumaker/cpputype.hxx,v
retrieving revision 1.9
diff -u -p -u -r1.9 cpputype.hxx
--- codemaker/source/cppumaker/cpputype.hxx	10 Jan 2006 15:46:47 -0000	1.9
+++ codemaker/source/cppumaker/cpputype.hxx	20 Mar 2006 13:40:58 -0000
@@ -61,6 +61,11 @@ enum CppuTypeDecl
 class CppuOptions;
 class FileStream;
 
+#include <list>
+extern ::std::list<rtl::OString> aExceptionNames;
+extern ::std::list<rtl::OString> aIncludes;
+extern const char *inline_str;
+
 class CppuType
 {
 public:
@@ -300,6 +305,7 @@ public:
 
 	virtual ~ExceptionType();
 
+    bool        dumpFiles(CppuOptions * options, rtl::OString const & outPath);
 	sal_Bool	dumpDeclaration(FileStream& o) throw( CannotDumpException );
 	sal_Bool	dumpHFile(FileStream& o, codemaker::cppumaker::Includes & includes) throw( CannotDumpException );
 	sal_Bool	dumpHxxFile(FileStream& o, codemaker::cppumaker::Includes & includes) throw( CannotDumpException );
@@ -367,6 +373,11 @@ public:
         throw (CannotDumpException);
 
 private:
+
+	void dumpCtorSignature(FileStream & o, 
+						   const rtl::OString & cppName,
+						   bool impl, int i) throw (CannotDumpException);
+
     virtual void addSpecialDependencies();
 
     bool isDefaultConstructor(sal_uInt16 ctorIndex) const;
