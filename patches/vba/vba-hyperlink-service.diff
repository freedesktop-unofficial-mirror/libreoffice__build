--- backup/oovbaapi/org/openoffice/excel/makefile.mk	2008-04-30 06:51:43.000000000 +0800
+++ oovbaapi/org/openoffice/excel/makefile.mk	2008-04-30 07:09:52.000000000 +0800
@@ -92,6 +92,8 @@ IDLFILES= XApplication.idl\
 	Workbook.idl \
 	Worksheet.idl \
 	Window.idl \
+ 	XHyperlink.idl \
+ 	Hyperlink.idl \
 
 
 # ------------------------------------------------------------------
--- /dev/null	2007-05-04 18:54:36.000000000 +0800
+++ oovbaapi/org/openoffice/excel/Hyperlink.idl	2008-04-30 07:09:52.000000000 +0800
@@ -0,0 +1,54 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile: Hyperlink.idl,v $
+ *
+ *  $Revision: 1.2 $
+ *
+ *  last change: $Author: vg $ $Date: 2007/12/07 11:20:59 $
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef __org_openoffice_excel_Hyperlink_idl__
+#define __org_openoffice_excel_Hyperlink_idl__
+
+#ifndef __org_openoffice_excel_XHyperlink_idl__
+#include <org/openoffice/excel/XHyperlink.idl>
+#endif
+
+#include <com/sun/star/uno/XComponentContext.idl>
+#include <com/sun/star/frame/XModel.idl>
+
+module org { module openoffice { module excel {
+service Hyperlink : XHyperlink
+{
+  	createHyperlink(  [in] ::org::openoffice::vba::XHelperInterface Parent, [in] ::com::sun::star::frame::XModel xModel );
+};
+
+}; }; };
+
+#endif
--- /dev/null	2007-05-04 18:54:36.000000000 +0800
+++ oovbaapi/org/openoffice/excel/XHyperlink.idl	2008-04-30 07:24:49.000000000 +0800
@@ -0,0 +1,65 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile: XHyperlink.idl,v $
+ *
+ *  $Revision: 1.0 $
+ *
+ *  last change: $Author: vg $ $Date: 2007/12/07 11:25:42 $
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef __org_openoffice_excel_XHyperlink_idl__
+#define __org_openoffice_excel_XHyperlink_idl__
+                                                                                                                             
+#ifndef __com_sun_star_uno_XInterface_idl__
+#include <com/sun/star/uno/XInterface.idl>
+#endif
+
+#ifndef __org_openoffice_vba_XHelperInterface_idl__
+#include <org/openoffice/vba/XHelperInterface.idl>
+#endif
+
+//=============================================================================
+                                                                                                                             
+module org {  module openoffice {  module excel {
+                                                                                                                             
+//=============================================================================
+interface XRange;
+interface XHyperlink
+{
+	interface ::org::openoffice::vba::XHelperInterface;
+	
+	[attribute] string Address;
+	[attribute] string Name;
+	[attribute] string TextToDisplay;
+
+	XRange Range();
+};
+                                                                                                                             
+}; }; };
+                                                                                                                             
+#endif
--- backup/sc/source/ui/vba/service.cxx	2008-04-30 06:51:18.000000000 +0800
+++ sc/source/ui/vba/service.cxx	2008-04-30 07:13:46.000000000 +0800
@@ -65,6 +65,10 @@ namespace  userform
 {
 extern sdecl::ServiceDecl const serviceDecl;
 }
+namespace hyperlink 
+{
+extern sdecl::ServiceDecl const serviceDecl;
+}
 
 
 extern "C"
@@ -83,7 +87,7 @@ extern "C"
 
 	// Component registration
         if ( component_writeInfoHelper( pServiceManager, pRegistryKey, 
-		range::serviceDecl, workbook::serviceDecl, worksheet::serviceDecl, globals::serviceDecl, userform::serviceDecl, window::serviceDecl ) )
+		range::serviceDecl, workbook::serviceDecl, worksheet::serviceDecl, globals::serviceDecl, userform::serviceDecl, window::serviceDecl, hyperlink::serviceDecl ) )
 		{
 			// Singleton registration
 			try
@@ -111,7 +115,7 @@ extern "C"
     {
 		OSL_TRACE("In component_getFactory for %s", pImplName );
 	void* pRet =  component_getFactoryHelper(
-        	pImplName, pServiceManager, pRegistryKey, range::serviceDecl, workbook::serviceDecl, worksheet::serviceDecl, globals::serviceDecl, userform::serviceDecl, window::serviceDecl );
+        	pImplName, pServiceManager, pRegistryKey, range::serviceDecl, workbook::serviceDecl, worksheet::serviceDecl, globals::serviceDecl, userform::serviceDecl, window::serviceDecl, hyperlink::serviceDecl );
 	OSL_TRACE("Ret is 0x%x", pRet);
 	return pRet;
     }
--- /dev/null	2007-05-04 18:54:36.000000000 +0800
+++ sc/source/ui/vba/vbahyperlink.hxx	2008-04-30 07:13:46.000000000 +0800
@@ -0,0 +1,72 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile: vbahyperlink.hxx,v $
+ *
+ *  $Revision: 1.2 $
+ *
+ *  last change: $Author: vg $ $Date: 2007/12/07 10:55:55 $
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef SC_VBA_HYPERLINK_HXX
+#define SC_VBA_HYPERLINK_HXX
+
+#include <org/openoffice/excel/XHyperlink.hpp>
+#include <com/sun/star/table/XCell.hpp>
+#include <com/sun/star/beans/XPropertySet.hpp>
+#include <org/openoffice/excel/XRange.hpp>
+
+#include "vbahelperinterface.hxx"
+
+typedef InheritedHelperInterfaceImpl1< oo::excel::XHyperlink > HyperlinkImpl_BASE;
+
+class ScVbaHyperlink : public HyperlinkImpl_BASE 
+{
+	css::uno::Reference< css::table::XCell > mxCell;
+	css::uno::Reference< css::beans::XPropertySet > mxTextField;
+
+public:
+	ScVbaHyperlink( css::uno::Sequence< css::uno::Any > const& aArgs, css::uno::Reference< css::uno::XComponentContext > const& xContext ) throw ( css::lang::IllegalArgumentException );
+	virtual ~ScVbaHyperlink();
+
+	// Attributes
+	virtual ::rtl::OUString SAL_CALL getAddress() throw (css::uno::RuntimeException);
+	virtual void SAL_CALL setAddress( const ::rtl::OUString &rAddress ) throw (css::uno::RuntimeException);
+	virtual ::rtl::OUString SAL_CALL getName() throw (css::uno::RuntimeException);
+	virtual void SAL_CALL setName( const ::rtl::OUString &rName ) throw (css::uno::RuntimeException);
+	virtual ::rtl::OUString SAL_CALL getTextToDisplay() throw (css::uno::RuntimeException);
+	virtual void SAL_CALL setTextToDisplay( const ::rtl::OUString &rTextToDisplay ) throw (css::uno::RuntimeException);
+	
+	// Methods
+	virtual css::uno::Reference< oo::excel::XRange > SAL_CALL Range() throw (css::uno::RuntimeException);
+
+	// XHelperInterface
+	virtual rtl::OUString& getServiceImplName();
+	virtual css::uno::Sequence<rtl::OUString> getServiceNames();
+};
+#endif /* SC_VBA_HYPERLINK_HXX */
+
--- /dev/null	2007-05-04 18:54:36.000000000 +0800
+++ sc/source/ui/vba/vbahyperlink.cxx	2008-04-30 07:13:46.000000000 +0800
@@ -0,0 +1,139 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile: vbahyperlink.cxx,v $
+ *
+ *  $Revision: 1.2 $
+ *
+ *  last change: $Author: vg $ $Date: 2007/12/07 10:55:43 $
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#include "helperdecl.hxx"
+#include "vbahyperlink.hxx"
+#include <com/sun/star/container/XIndexAccess.hpp>
+#include <com/sun/star/text/XTextFieldsSupplier.hpp> 
+#include <com/sun/star/container/XEnumerationAccess.hpp> 
+#include "vbarange.hxx"
+
+using namespace ::org::openoffice;
+using namespace ::com::sun::star;
+
+ScVbaHyperlink::ScVbaHyperlink( uno::Sequence< uno::Any> const & args,
+    uno::Reference< uno::XComponentContext> const & xContext ) throw ( lang::IllegalArgumentException ) :  HyperlinkImpl_BASE( getXSomethingFromArgs< vba::XHelperInterface >( args, 0 ), xContext ), mxCell( getXSomethingFromArgs< table::XCell >( args, 1, false ) )
+{
+	mxCell = getXSomethingFromArgs< table::XCell >( args, 1, false );
+	uno::Reference< text::XTextFieldsSupplier > xTextFields( mxCell, uno::UNO_QUERY_THROW );
+	uno::Reference< container::XIndexAccess > xIndex( xTextFields->getTextFields(), uno::UNO_QUERY_THROW );
+	mxTextField.set( xIndex->getByIndex(0), uno::UNO_QUERY_THROW );
+}
+
+ScVbaHyperlink::~ScVbaHyperlink()
+{
+}
+
+::rtl::OUString
+ScVbaHyperlink::getAddress() throw (css::uno::RuntimeException)
+{
+	rtl::OUString aAddress;
+	uno::Any aValue = mxTextField->getPropertyValue( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "URL" ) ) );
+	aValue >>= aAddress;
+	return aAddress;
+}
+
+void
+ScVbaHyperlink::setAddress( const ::rtl::OUString & rAddress ) throw (css::uno::RuntimeException)
+{
+	uno::Any aValue;
+	aValue <<= rAddress;
+	mxTextField->setPropertyValue( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "URL" ) ), aValue );
+}
+
+::rtl::OUString
+ScVbaHyperlink::getName() throw (css::uno::RuntimeException)
+{
+	// it seems this attribute is same as TextToDisplay
+	return getTextToDisplay();
+}
+
+void
+ScVbaHyperlink::setName( const ::rtl::OUString &  rName ) throw (css::uno::RuntimeException)
+{
+	setTextToDisplay( rName );
+}
+
+::rtl::OUString
+ScVbaHyperlink::getTextToDisplay() throw (css::uno::RuntimeException)
+{
+	rtl::OUString aTextToDisplay;
+	uno::Any aValue = mxTextField->getPropertyValue( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Representation" ) ) );
+	aValue >>= aTextToDisplay;
+	return aTextToDisplay;
+}
+
+void
+ScVbaHyperlink::setTextToDisplay( const ::rtl::OUString & rTextToDisplay ) throw (css::uno::RuntimeException)
+{
+	uno::Any aValue;
+	aValue <<= rTextToDisplay;
+	mxTextField->setPropertyValue( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Representation" ) ), aValue );
+}
+
+css::uno::Reference< oo::excel::XRange > SAL_CALL ScVbaHyperlink::Range() throw (css::uno::RuntimeException)
+{
+	uno::Reference< table::XCellRange > xRange( mxCell,uno::UNO_QUERY_THROW );
+	// FIXME: need to pass current worksheet as the parent of XRange.
+	return uno::Reference< excel::XRange >( new ScVbaRange( uno::Reference< vba::XHelperInterface > (), mxContext, xRange ) );
+}
+
+rtl::OUString&
+ScVbaHyperlink::getServiceImplName()
+{
+	static rtl::OUString sImplName( RTL_CONSTASCII_USTRINGPARAM("ScVbaHyperlink") );
+	return sImplName;
+}
+
+uno::Sequence< rtl::OUString >
+ScVbaHyperlink::getServiceNames()
+{
+	static uno::Sequence< rtl::OUString > aServiceNames;
+	if ( aServiceNames.getLength() == 0 )
+	{
+		aServiceNames.realloc( 1 );
+		aServiceNames[ 0 ] = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("org.openoffice.excel.Hyperlink" ) );
+	}
+	return aServiceNames;
+}
+
+namespace hyperlink
+{
+namespace sdecl = comphelper::service_decl;
+sdecl::vba_service_class_<ScVbaHyperlink, sdecl::with_args<true> > serviceImpl;
+extern sdecl::ServiceDecl const serviceDecl(
+    serviceImpl,
+    "ScVbaHyperlink",
+    "org.openoffice.excel.Hyperlink" );
+}
--- sc/source/ui/vba/makefile.mk.orig	2008-05-04 12:10:31.000000000 +0800
+++ sc/source/ui/vba/makefile.mk	2008-05-04 12:10:45.000000000 +0800
@@ -125,6 +125,7 @@ SLOFILES= \
                 $(SLO)$/vbacommandbarcontrols.obj \
                 $(SLO)$/vbacommandbar.obj \
                 $(SLO)$/vbacommandbars.obj \
+        $(SLO)$/vbahyperlink.obj \
 		$(SLO)$/service.obj \
  
 
