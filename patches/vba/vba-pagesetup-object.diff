--- ../dev300-m10.src/oovbaapi/org/openoffice/excel/XWorksheet.idl	2008-05-09 13:54:11.000000000 +0800
+++ oovbaapi/org/openoffice/excel/XWorksheet.idl	2008-05-09 11:55:19.000000000 +0800
@@ -51,6 +51,7 @@ module org {  module openoffice {  modul
 interface XComments;
 interface XRange;
 interface XOutline;
+interface XPageSetup;
 interface XWorksheet
 {
 	interface ::org::openoffice::vba::XHelperInterface;
@@ -83,6 +84,7 @@ interface XWorksheet
 	any PivotTables([in] any Index);
 	any Comments([in] any Index);
 	XOutline Outline();
+	XPageSetup PageSetup();
 	any OLEObjects([in] any Index);
 	void ShowDataForm();
 	any Shapes([in] any Index);
--- ../dev300-m10.src/oovbaapi/org/openoffice/excel/makefile.mk	2008-05-09 13:54:31.000000000 +0800
+++ oovbaapi/org/openoffice/excel/makefile.mk	2008-05-08 11:50:56.000000000 +0800
@@ -94,6 +94,7 @@ IDLFILES= XApplication.idl\
 	Window.idl \
  	XHyperlink.idl \
  	Hyperlink.idl \
+ 	XPageSetup.idl \
 
 
 # ------------------------------------------------------------------
--- /dev/null	2008-04-03 19:37:22.000000000 +0800
+++ oovbaapi/org/openoffice/excel/XPageSetup.idl	2008-05-08 11:50:20.000000000 +0800
@@ -0,0 +1,64 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: XPageSetup.idl,v $
+ * $Revision: 1.0 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef __org_openoffice_excel_XPageSetup_idl__
+#define __org_openoffice_excel_XPageSetup_idl__
+
+#ifndef __com_sun_star_uno_XInterface_idl__
+#include <com/sun/star/uno/XInterface.idl>
+#endif
+
+#ifndef __org_openoffice_vba_XHelperInterface_idl__
+#include <org/openoffice/vba/XHelperInterface.idl>
+#endif
+
+//=============================================================================
+
+module org {  module openoffice {  module excel { 
+
+//=============================================================================
+
+
+interface XPageSetup
+{
+
+	interface ::org::openoffice::vba::XHelperInterface;
+
+	//Attributes
+    [attribute] string PrintArea;
+
+};
+
+//=============================================================================
+
+}; }; };
+
+#endif
+
+
--- ../dev300-m10.src/sc/source/ui/vba/vbaworksheet.hxx	2008-05-09 13:54:11.000000000 +0800
+++ sc/source/ui/vba/vbaworksheet.hxx	2008-05-09 11:58:52.000000000 +0800
@@ -42,6 +42,7 @@
 #include <com/sun/star/uno/XComponentContext.hpp>
 #include <com/sun/star/frame/XModel.hpp>
 #include <org/openoffice/excel/XOutline.hpp>
+#include <org/openoffice/excel/XPageSetup.hpp>
 #include <org/openoffice/excel/XChartObjects.hpp>
 
 #include "vbahelperinterface.hxx"
@@ -89,6 +90,7 @@ public:
 	virtual css::uno::Reference< oo::excel::XRange > SAL_CALL getUsedRange() throw (css::uno::RuntimeException) ;
 	virtual css::uno::Any SAL_CALL ChartObjects( const css::uno::Any& Index ) throw (css::uno::RuntimeException);
 	virtual css::uno::Reference< oo::excel::XOutline > SAL_CALL Outline( ) throw (css::uno::RuntimeException);
+	virtual css::uno::Reference< oo::excel::XPageSetup > SAL_CALL PageSetup( ) throw (css::uno::RuntimeException);
 	virtual css::uno::Reference< oo::excel::XWorksheet > SAL_CALL getNext() throw (css::uno::RuntimeException);
 	virtual css::uno::Reference< oo::excel::XWorksheet > SAL_CALL getPrevious() throw (css::uno::RuntimeException);
 
--- ../dev300-m10.src/sc/source/ui/vba/vbaworksheet.cxx	2008-05-09 13:54:27.000000000 +0800
+++ sc/source/ui/vba/vbaworksheet.cxx	2008-05-09 12:05:36.000000000 +0800
@@ -85,6 +85,7 @@
 #include "vbaoleobject.hxx"
 #include "vbaoleobjects.hxx"
 #include "vbashapes.hxx"
+#include "vbapagesetup.hxx"
 
 #define STANDARDWIDTH 2267
 #define STANDARDHEIGHT 427
@@ -267,6 +268,13 @@ ScVbaWorksheet::Outline( ) throw (uno::R
 	return new ScVbaOutline( this, mxContext, xOutline);
 }
 
+uno::Reference< excel::XPageSetup >
+ScVbaWorksheet::PageSetup( ) throw (uno::RuntimeException)
+{
+	uno::Reference<sheet::XPrintAreas> xPrintAreas(getSheet(),uno::UNO_QUERY_THROW);
+	return new ScVbaPageSetup( this, mxContext, xPrintAreas);
+}
+
 sal_Int32 
 ScVbaWorksheet::getStandardWidth() throw (uno::RuntimeException)
 {
--- ../dev300-m10.src/sc/source/ui/vba/makefile.mk	2008-05-09 13:54:31.000000000 +0800
+++ sc/source/ui/vba/makefile.mk	2008-05-08 15:08:22.000000000 +0800
@@ -126,6 +126,7 @@ SLOFILES= \
                 $(SLO)$/vbacommandbar.obj \
                 $(SLO)$/vbacommandbars.obj \
         $(SLO)$/vbahyperlink.obj \
+        $(SLO)$/vbapagesetup.obj \
 		$(SLO)$/service.obj \
  
 
--- /dev/null	2008-04-03 19:37:22.000000000 +0800
+++ sc/source/ui/vba/vbapagesetup.hxx	2008-05-09 10:55:46.000000000 +0800
@@ -0,0 +1,58 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: vbapagesetup.hxx,v $
+ * $Revision: 1.4 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#ifndef SC_VBA_PAGESETUP_HXX
+#define SC_VBA_PAGESETUP_HXX
+
+#include <com/sun/star/sheet/XPrintAreas.hpp>
+#include <cppuhelper/implbase1.hxx>
+#include <org/openoffice/excel/XPageSetup.hpp>
+#include <com/sun/star/uno/XComponentContext.hpp>
+#include "vbahelperinterface.hxx"
+
+typedef InheritedHelperInterfaceImpl1< oo::excel::XPageSetup > ScVbaPageSetup_BASE;
+
+class ScVbaPageSetup :  public ScVbaPageSetup_BASE 
+{
+	css::uno::Reference< css::sheet::XPrintAreas > mxPrintAreas;
+public:
+	ScVbaPageSetup( const css::uno::Reference< oo::vba::XHelperInterface >& xParent, const css::uno::Reference< css::uno::XComponentContext >& xContext,
+		 css::uno::Reference<css::sheet::XPrintAreas> printareas): ScVbaPageSetup_BASE( xParent, xContext) , mxPrintAreas(printareas)
+	{}
+	virtual ~ScVbaPageSetup(){}
+    
+    // Attribute
+	virtual rtl::OUString SAL_CALL getPrintArea() throw (css::uno::RuntimeException);
+	virtual void SAL_CALL setPrintArea( const rtl::OUString& rAreas ) throw (css::uno::RuntimeException);
+
+	// XHelperInterface
+	virtual rtl::OUString& getServiceImplName();
+	virtual css::uno::Sequence<rtl::OUString> getServiceNames();
+};
+#endif
--- /dev/null	2008-04-03 19:37:22.000000000 +0800
+++ sc/source/ui/vba/vbapagesetup.cxx	2008-05-09 12:53:00.000000000 +0800
@@ -0,0 +1,134 @@
+/*************************************************************************
+ *
+ * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
+ * 
+ * Copyright 2008 by Sun Microsystems, Inc.
+ *
+ * OpenOffice.org - a multi-platform office productivity suite
+ *
+ * $RCSfile: vbapagesetup.cxx,v $
+ * $Revision: 1.4 $
+ *
+ * This file is part of OpenOffice.org.
+ *
+ * OpenOffice.org is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Lesser General Public License version 3
+ * only, as published by the Free Software Foundation.
+ *
+ * OpenOffice.org is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Lesser General Public License version 3 for more details
+ * (a copy is included in the LICENSE file that accompanied this code).
+ *
+ * You should have received a copy of the GNU Lesser General Public License
+ * version 3 along with OpenOffice.org.  If not, see
+ * <http://www.openoffice.org/license.html>
+ * for a copy of the LGPLv3 License.
+ *
+ ************************************************************************/
+#include "vbapagesetup.hxx"
+#include "cellsuno.hxx"
+#include "convuno.hxx"
+using namespace ::com::sun::star;
+using namespace ::org::openoffice;
+
+// assume that xIf is infact a ScCellRangesBase
+ScDocument* getDocumentFromIf( const uno::Reference< uno::XInterface >& xIf ) throw ( uno::RuntimeException )
+{
+    ScCellRangesBase* pUno= dynamic_cast< ScCellRangesBase* >( xIf.get() );
+    if ( !pUno )
+        throw uno::RuntimeException( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Failed to access underlying uno range object" ) ), uno::Reference<
+uno::XInterface >()  );
+    
+    return pUno->GetDocument();
+}
+
+rtl::OUString SAL_CALL ScVbaPageSetup::getPrintArea() throw (css::uno::RuntimeException)
+{
+    rtl::OUStringBuffer aPrintArea;
+    uno::Reference< uno::XInterface > xIf( mxPrintAreas, uno::UNO_QUERY_THROW );
+    ScDocument* pDoc = getDocumentFromIf( xIf );
+    if( pDoc )
+    {
+        uno::Sequence< table::CellRangeAddress > aSeq = mxPrintAreas->getPrintAreas();
+        USHORT nCount = (USHORT) aSeq.getLength();
+        if( nCount )
+        {
+            ScAddress::Details aDetails( ScAddress::CONV_XL_A1, 0, 0 );
+            USHORT nFlags = SCA_VALID;
+            nFlags |= ( SCA_TAB_ABSOLUTE | SCA_COL_ABSOLUTE | SCA_ROW_ABSOLUTE | SCA_TAB2_ABSOLUTE | SCA_COL2_ABSOLUTE | SCA_ROW2_ABSOLUTE );
+            String sRange;
+            ScRange aPrintRange;
+            const table::CellRangeAddress* pAry = aSeq.getArray();
+            for( USHORT i=0; i<nCount; i++ )
+            {
+                if( i > 0 )
+                    aPrintArea.append( rtl::OUString( ',' ) );
+                ScUnoConversion::FillScRange( aPrintRange, pAry[i] );
+                aPrintRange.Format( sRange,  nFlags, pDoc, aDetails );
+                aPrintArea.append( sRange );
+            }
+        }
+    }
+    
+    return aPrintArea.makeStringAndClear();
+}
+
+void SAL_CALL ScVbaPageSetup::setPrintArea( const rtl::OUString& rAreas ) throw (css::uno::RuntimeException)
+{
+    uno::Reference< uno::XInterface > xIf( mxPrintAreas, uno::UNO_QUERY_THROW );
+    ScDocument* pDoc = getDocumentFromIf( xIf );
+    if( pDoc )
+    {
+        if( rAreas.getLength() == 0 ||
+            rAreas.equalsIgnoreAsciiCase ( rtl::OUString::createFromAscii("FALSE") ) )
+        {
+            // print the whole sheet
+            uno::Sequence< table::CellRangeAddress > aSeq;
+            mxPrintAreas->setPrintAreas( aSeq );
+        }
+        else
+        {
+            ScAddress::Details aDetails( ScAddress::CONV_XL_A1, 0, 0 );
+            USHORT nFlags = SCA_VALID;
+            ScRange aRange;
+            
+            String aPrintArea( rAreas );
+            const sal_Unicode sep(',');
+            USHORT nCount = aPrintArea.GetTokenCount(sep);
+            uno::Sequence< table::CellRangeAddress > aSeq( nCount );
+            for( USHORT i=0; i<nCount; i++ )
+            {
+                String aToken = aPrintArea.GetToken( i, sep );
+                if ( aRange.ParseAny( aToken, pDoc, aDetails ) & nFlags )
+                {
+                    table::CellRangeAddress aRangeAddress;
+                    ScUnoConversion::FillApiRange( aRangeAddress, aRange );
+                    aSeq[ i ] = aRangeAddress;
+                }
+            }
+
+            mxPrintAreas->setPrintAreas( aSeq );
+        }
+    }
+}
+
+rtl::OUString& 
+ScVbaPageSetup::getServiceImplName()
+{
+	static rtl::OUString sImplName( RTL_CONSTASCII_USTRINGPARAM("ScVbaPageSetup") );
+	return sImplName;
+}
+
+uno::Sequence< rtl::OUString > 
+ScVbaPageSetup::getServiceNames()
+{
+	static uno::Sequence< rtl::OUString > aServiceNames;
+	if ( aServiceNames.getLength() == 0 )
+	{
+		aServiceNames.realloc( 1 );
+		aServiceNames[ 0 ] = rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("org.openoffice.excel.PageSetup" ) );
+	}
+	return aServiceNames;
+}
