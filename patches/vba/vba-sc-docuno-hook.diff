Index: sc/source/ui/unoobj/docuno.cxx
===================================================================
RCS file: /cvs/sc/sc/source/ui/unoobj/docuno.cxx,v
retrieving revision 1.50
diff -u -r1.50 docuno.cxx
--- sc/source/ui/unoobj/docuno.cxx	23 Mar 2005 13:08:32 -0000	1.50
+++ sc/source/ui/unoobj/docuno.cxx	22 Jul 2005 07:57:25 -0000
@@ -89,6 +89,8 @@
 #include <com/sun/star/i18n/XForbiddenCharacters.hpp>
 #include <com/sun/star/script/XLibraryContainer.hpp>
 #include <com/sun/star/lang/XInitialization.hpp>
+
+#include <org/openoffice/vba/XGlobals.hpp>
 #ifndef _COMPHELPER_PROCESSFACTORY_HXX_
 #include <comphelper/processfactory.hxx>
 #endif
@@ -127,6 +129,8 @@
 
 using namespace com::sun::star;
 
+#define SC_VBA_GLOBALS_PROP "VBAGlobals"
+
 //------------------------------------------------------------------------
 
 //	alles ohne Which-ID, Map nur fuer PropertySetInfo
@@ -164,6 +168,7 @@
 		{MAP_CHAR_LEN(SC_UNO_STANDARDDEC),	0,	&getCppuType((sal_Int16*)0),							  0},
         {MAP_CHAR_LEN(SC_UNO_REGEXENABLED), 0,  &getBooleanCppuType(),                                    0},
         {MAP_CHAR_LEN(SC_UNO_RUNTIMEUID),   0,  &getCppuType(static_cast< const rtl::OUString * >(0)),    beans::PropertyAttribute::READONLY},
+        {MAP_CHAR_LEN(SC_VBA_GLOBALS_PROP), 0,  &getCppuType((uno::Sequence< uno::Any >*)0), beans::PropertyAttribute::READONLY},
 
 		{0,0,0,0}
 	};
@@ -1476,6 +1481,24 @@
         {
             aRet <<= getRuntimeUID();
         }
+		else if ( aString.EqualsAscii( SC_VBA_GLOBALS_PROP ) )
+		{
+			uno::Reference < uno::XComponentContext > xCtx;
+			uno::Reference < beans::XPropertySet > xProps(
+				::comphelper::getProcessServiceFactory(), uno::UNO_QUERY_THROW );
+			xCtx.set( xProps->getPropertyValue( rtl::OUString( 
+				RTL_CONSTASCII_USTRINGPARAM( "DefaultContext" ))), 
+				uno::UNO_QUERY_THROW );
+			uno::Reference< org::openoffice::vba::XGlobals > xGlobals(
+				xCtx->getValueByName(
+				::rtl::OUString::createFromAscii( 
+					"/singletons/org.openoffice.vba.theGlobals") ), 
+				uno::UNO_QUERY );
+			if ( xGlobals.is() )
+			{
+				aRet <<= xGlobals->getGlobals();
+			}
+		}
 	}
 
 	return aRet;
