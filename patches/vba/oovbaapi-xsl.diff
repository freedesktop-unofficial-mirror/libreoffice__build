--- oovbaapi/genconstidl/oovbaconsts.xsl	2007-07-11 17:23:10.000000000 +0200
+++ oovbaapi/genconstidl/oovbaconsts.xsl	2007-07-11 20:21:13.000000000 +0200
@@ -43,20 +43,17 @@
                    Have to end with path separator -->
     <xsl:param name="IDL_DIRECTORY" />
 
-    <xsl:key name="same-context-elements"
-             match="/api/element[@type='constant']"
-             use="normalize-space(source/context)" />
-
     <xsl:template match="/">
-        <!-- once for each group of different elements with an 'type' attribute equal to 'constant' -->
-        <xsl:for-each select="/api/element[@type='constant'][generate-id() = generate-id(key('same-context-elements', normalize-space(source/context))[1])]">
-            <xsl:sort select="normalize-space(source/context)" />
+        <!-- once for each enumeration -->
+        <xsl:for-each select="/api/element[@type='enumeration']">
+            <xsl:sort select="normalize-space(source/name)" />
 
-            <redirect:write select="concat($IDL_DIRECTORY, normalize-space(source/context),'.idl')">
+            <redirect:write select="concat($IDL_DIRECTORY, normalize-space(source/name),'.idl')">
                 <xsl:call-template name="write-idl-prefix-1" />
                 <xsl:call-template name="write-idl-prefix-2" />
                 <!-- write IDL content -->
-                <xsl:for-each select="key('same-context-elements', normalize-space(source/context))">
+                <xsl:variable name="enumerationname" select="normalize-space(source/name)"/>
+                <xsl:for-each select="/api/element[@type='constant' and normalize-space(source/context)=$enumerationname]">
                     <xsl:call-template name="write-idl-content" />
                 </xsl:for-each>
                 <xsl:call-template name="write-idl-suffix" />
@@ -76,7 +73,7 @@
     </xsl:template>
     <xsl:template name="write-idl-prefix-2">
 <xsl:text> {
-            constants </xsl:text><xsl:value-of select="normalize-space(source/context)" /><xsl:text> {</xsl:text>
+            constants </xsl:text><xsl:value-of select="normalize-space(source/name)" /><xsl:text> {</xsl:text>
     </xsl:template>
 
     <!-- writing the IDL content -->
