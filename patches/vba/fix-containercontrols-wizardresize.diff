From 9e61ebda4bacd91c4c70bed1b6eaff2ce0858170 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 17:00:25 +0200
Subject: [PATCH 407/878] fix-containercontrols-wizardresize.diff

---
 toolkit/inc/toolkit/controls/dialogcontrol.hxx |    4 ++--
 toolkit/source/controls/dialogcontrol.cxx      |   12 +++++++-----
 2 files changed, 9 insertions(+), 7 deletions(-)

diff --git a/toolkit/inc/toolkit/controls/dialogcontrol.hxx b/toolkit/inc/toolkit/controls/dialogcontrol.hxx
index 7ead237..fbb4e74 100644
--- a/toolkit/inc/toolkit/controls/dialogcontrol.hxx
+++ b/toolkit/inc/toolkit/controls/dialogcontrol.hxx
@@ -230,6 +230,8 @@ typedef ::cppu::ImplHelper2	< ::com::sun::star::container::XContainerListener
 class UnoDialogContainerControl : public UnoControlContainer, public UnoDialogContainerControl_IBase
 {
 protected:
+    bool                                                                        mbSizeModified;
+    bool                                                                        mbPosModified;
     ::com::sun::star::uno::Reference< ::com::sun::star::awt::XTabController >	mxTabController;
     void		ImplInsertControl( ::com::sun::star::uno::Reference< ::com::sun::star::awt::XControlModel >& rxModel, const ::rtl::OUString& rName );
     void		ImplRemoveControl( ::com::sun::star::uno::Reference< ::com::sun::star::awt::XControlModel >& rxModel );
@@ -280,8 +282,6 @@ private:
     ::com::sun::star::uno::Reference< ::com::sun::star::awt::XMenuBar >			mxMenuBar;
     TopWindowListenerMultiplexer	                                            maTopWindowListeners;
     bool                                                                        mbWindowListener;
-    bool                                                                        mbSizeModified;
-    bool                                                                        mbPosModified;
     ::com::sun::star::uno::Reference< ::com::sun::star::graphic::XGraphicObject > mxGrfObj;
     ::com::sun::star::uno::Reference< ::com::sun::star::util::XModifyListener > mxListener;
 
diff --git a/toolkit/source/controls/dialogcontrol.cxx b/toolkit/source/controls/dialogcontrol.cxx
index 2447dcf..c0541c5 100644
--- a/toolkit/source/controls/dialogcontrol.cxx
+++ b/toolkit/source/controls/dialogcontrol.cxx
@@ -2178,7 +2178,9 @@ uno::Reference< beans::XPropertySetInfo > UnoFrameModel::getPropertySetInfo(  )
 //	----------------------------------------------------
 //	class DialogContainerControl
 //	----------------------------------------------------
-UnoDialogContainerControl::UnoDialogContainerControl()
+UnoDialogContainerControl::UnoDialogContainerControl() :
+    mbSizeModified(false),
+    mbPosModified(false)
 {
     maComponentInfos.nWidth = 280;
     maComponentInfos.nHeight = 400;
@@ -2251,7 +2253,6 @@ void UnoDialogContainerControl::ImplSetPosSize( Reference< XControl >& rxCtrl )
     xP->getPropertyValue( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "PositionY" ) ) ) >>= nY;
     xP->getPropertyValue( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Width" ) ) ) >>= nWidth;
     xP->getPropertyValue( ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Height" ) ) ) >>= nHeight;
-
     MapMode aMode( MAP_APPFONT );
     sal_Bool bVBAForm = sal_False;
     Reference< XPropertySet > xDlgModelProps( getModel(), UNO_QUERY );
@@ -2481,9 +2482,12 @@ void UnoDialogContainerControl::ImplModelPropertiesChanged( const Sequence< Prop
             {
                 if ( bOwnModel )
                 {
+                    if ( !mbPosModified && !mbSizeModified )
+                    {
                         // Don't set new pos/size if we get new values from window listener
                         Reference< XControl > xThis( (XAggregation*)(::cppu::OWeakAggObject*)this, UNO_QUERY );
                         ImplSetPosSize( xThis );
+                    }
                 }
                 else
                 {
@@ -2551,9 +2555,7 @@ void SAL_CALL UnoDialogContainerControl::changesOccurred( const ChangesEvent& )
 
 UnoDialogControl::UnoDialogControl() :
     maTopWindowListeners( *this ),
-    mbWindowListener(false),
-    mbSizeModified(false),
-    mbPosModified(false)
+    mbWindowListener(false)
 {
     maComponentInfos.nWidth = 300;
     maComponentInfos.nHeight = 450;
-- 
1.7.0.1

