--- sc/source/ui/vba/vbaworksheet.cxx	
+++ sc/source/ui/vba/vbaworksheet.cxx
@@ -53,7 +53,6 @@
 #include <com/sun/star/sheet/XCellAddressable.hpp>
 #include <com/sun/star/sheet/XSheetOutline.hpp>
 #include <com/sun/star/sheet/XDataPilotTablesSupplier.hpp>
-#include <cppuhelper/bootstrap.hxx>
 #include <com/sun/star/util/XURLTransformer.hpp>
 #include <com/sun/star/frame/XDispatchProvider.hpp>
 #include <com/sun/star/frame/XComponentLoader.hpp>
@@ -62,13 +61,23 @@
 #include <com/sun/star/drawing/XDrawPageSupplier.hpp>
 #include <com/sun/star/drawing/XControlShape.hpp>
 #include <com/sun/star/form/FormComponentType.hpp>
+
+#include <comphelper/processfactory.hxx>
+
 #include <tools/string.hxx>
 
+//zhangyun showdataform
+#include <sfx2/sfxdlg.hxx>
+#include <scabstdlg.hxx>
+#include <tabvwsh.hxx>
+#include <scitems.hxx>
+
 #include <svx/svdouno.hxx>
 
 #include "cellsuno.hxx"
 #include "drwlayer.hxx"
 
+#include "scextopt.hxx"
 #include "vbaoutline.hxx"
 #include "vbarange.hxx"
 #include "vbacomments.hxx"
@@ -158,7 +167,8 @@ openNewDoc(rtl::OUString aSheetName )
 	uno::Reference<frame::XModel> xModel;
 	try
 	{
-		uno::Reference<uno::XComponentContext > xContext(  ::cppu::defaultBootstrap_InitialComponentContext(), uno::UNO_QUERY_THROW );
+		uno::Reference< beans::XPropertySet > xProps( ::comphelper::getProcessServiceFactory(), uno::UNO_QUERY_THROW );	
+		uno::Reference< uno::XComponentContext > xContext(  xProps->getPropertyValue( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "DefaultContext" ))), uno::UNO_QUERY_THROW );
 		uno::Reference<lang::XMultiComponentFactory > xServiceManager(
 										xContext->getServiceManager(), uno::UNO_QUERY_THROW );
 
@@ -178,9 +188,6 @@ openNewDoc(rtl::OUString aSheetName )
 		}
 		xModel.set(xSpreadDoc,uno::UNO_QUERY_THROW);
 	}
-	catch ( ::cppu::BootstrapException & /*e*/ )    
-	{
-	}
 	catch ( uno::Exception & /*e*/ )
 	{
 	}
@@ -779,6 +806,15 @@ ScVbaWorksheet::getServiceNames()
 	}
 	return aServiceNames;
 }
+
+sal_Int16
+ScVbaWorksheet::getSheetID() throw (uno::RuntimeException)
+{
+	uno::Reference< sheet::XCellRangeAddressable > xAddressable( mxSheet, uno::UNO_QUERY_THROW );
+	return xAddressable->getRangeAddress().Sheet;
+}
+
+
 namespace worksheet
 {
 
