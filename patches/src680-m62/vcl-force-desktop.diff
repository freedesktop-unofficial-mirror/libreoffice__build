--- vcl/unx/source/plugadapt/salplug.cxx	2004-08-23 16:17:32.000000000 -0700
+++ vcl/unx/source/plugadapt/salplug.cxx	2004-08-23 17:43:17.000000000 -0700
@@ -350,7 +350,24 @@
 static const char * get_desktop_environment()
 {
     static const char *pRet = NULL;
+
+    static const char *pOverride = getenv( "OOO_FORCE_DESKTOP" );
     
+    if ( pOverride && *pOverride )
+    {
+        OString aOver( pOverride );
+#ifdef USE_CDE
+        if ( aOver.equalsIgnoreAsciiCase( "cde" ) )
+            pRet = desktop_strings[DESKTOP_CDE];
+#endif
+        if ( aOver.equalsIgnoreAsciiCase( "kde" ) )
+            pRet = desktop_strings[DESKTOP_KDE];
+        if ( aOver.equalsIgnoreAsciiCase( "gnome" ) )
+            pRet = desktop_strings[DESKTOP_GNOME];
+        if ( aOver.equalsIgnoreAsciiCase( "none" ) )
+            pRet = desktop_strings[DESKTOP_UNKNOWN];
+    }
+
     if ( NULL == pRet )
     {
         // get display to connect to
@@ -397,7 +397,11 @@ static const char * get_desktop_environm
             {
                 XErrorHandler pOldHdl = XSetErrorHandler( autodect_error_handler );
             
-                if ( is_gnome_desktop( pDisplay ) )
+                if ( NULL != getenv( "GNOME_DESKTOP_SESSION_ID" ) )
+                    pRet = desktop_strings[DESKTOP_GNOME];
+                else if ( NULL != getenv( "KDE_FULL_SESSION" ) )
+                    pRet = desktop_strings[DESKTOP_KDE];
+                else if ( is_gnome_desktop( pDisplay ) )
                     pRet = desktop_strings[DESKTOP_GNOME];
                 else if ( is_kde_desktop( pDisplay ) )
                     pRet = desktop_strings[DESKTOP_KDE];
