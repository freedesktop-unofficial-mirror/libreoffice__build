--- svtools/source/filepicker/folderpicker.cxx.old	2004-09-10 11:46:08.000000000 +0530
+++ svtools/source/filepicker/folderpicker.cxx	2004-09-10 12:03:02.000000000 +0530
@@ -265,7 +265,21 @@
 // ------------------------------------------------------------------------
 // misc. helpers
 //------------------------------------------------------------------------------------
-#define SYSTEM_FOLDER_OPEN_SERVICE_NAME "com.sun.star.ui.dialogs.SystemFolderPicker"
+::rtl::OUString impl_SystemFolderOpenServiceName()
+{
+	const ::rtl::OUString &rDesktopEnvironment =
+		Application::GetDesktopEnvironment();
+
+	if ( rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "gnome" ) )
+	{
+		return ::rtl::OUString::createFromAscii( "com.sun.star.ui.dialogs.GtkFolderPicker" );
+	}
+	else if ( rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "kde" ) )
+	{
+		return ::rtl::OUString::createFromAscii( "com.sun.star.ui.dialogs.KDEFolderPicker" );
+	}
+	return ::rtl::OUString::createFromAscii( "com.sun.star.ui.dialogs.SystemFolderPicker" );
+}
 
 sal_Bool SvtFolderPicker::HasSystemFolderPicker( const Reference< XMultiServiceFactory > xFactory )
 {
@@ -279,7 +293,7 @@
 
     try
     {
-		::rtl::OUString aFolderService( RTL_CONSTASCII_USTRINGPARAM( SYSTEM_FOLDER_OPEN_SERVICE_NAME ) );
+		::rtl::OUString aFolderService = impl_SystemFolderOpenServiceName();
 
         Reference< XEnumeration > xEnum = xEnumAccess->createContentEnumeration( aFolderService );
         if ( xEnum.is() && xEnum->hasMoreElements() )
@@ -365,7 +379,7 @@
 
         if ( bHasSystemFolderPicker && UseSystemFolderPicker() )
         {
-            ::rtl::OUString aFolderService( RTL_CONSTASCII_USTRINGPARAM( SYSTEM_FOLDER_OPEN_SERVICE_NAME ) );
+            ::rtl::OUString aFolderService = impl_SystemFolderOpenServiceName();
             xRet = xServiceManager->createInstance( aFolderService );
         }
     }
