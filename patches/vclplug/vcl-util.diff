Index: vcl/util/makefile.mk
===================================================================
RCS file: /cvs/gsl/vcl/util/makefile.mk,v
retrieving revision 1.47.10.2
retrieving revision 1.54
diff -u -p -u -r1.47.10.2 -r1.54
--- vcl/util/makefile.mk	3 Mar 2004 14:33:18 -0000	1.47.10.2
+++ vcl/util/makefile.mk	10 May 2004 16:01:11 -0000	1.54
@@ -65,7 +65,6 @@ PRJ=..
 PRJNAME=vcl
 TARGET=vcl
 VERSION=$(UPD)
-USE_DEFFILE=TRUE
 
 # --- Settings -----------------------------------------------------------
 
@@ -84,8 +83,6 @@ HXXDEPNLST= $(INC)$/accel.hxx       \
             $(INC)$/btndlg.hxx      \
             $(INC)$/button.hxx      \
             $(INC)$/ctrl.hxx        \
-            $(INC)$/color.hxx       \
-            $(INC)$/config.hxx      \
             $(INC)$/cursor.hxx      \
             $(INC)$/cmdevt.hxx      \
             $(INC)$/decoview.hxx    \
@@ -106,7 +103,6 @@ HXXDEPNLST= $(INC)$/accel.hxx       \
             $(INC)$/keycodes.hxx    \
             $(INC)$/keycod.hxx      \
             $(INC)$/image.hxx       \
-            $(INC)$/line.hxx        \
             $(INC)$/lstbox.h        \
             $(INC)$/lstbox.hxx      \
             $(INC)$/mapmod.hxx      \
@@ -120,15 +116,11 @@ HXXDEPNLST= $(INC)$/accel.hxx       \
             $(INC)$/outdev.hxx      \
             $(INC)$/outdev3d.hxx    \
             $(INC)$/pointr.hxx      \
-            $(INC)$/poly.hxx        \
             $(INC)$/ptrstyle.hxx    \
             $(INC)$/prntypes.hxx    \
             $(INC)$/print.hxx       \
             $(INC)$/prndlg.hxx      \
             $(INC)$/region.hxx      \
-            $(INC)$/rc.hxx          \
-            $(INC)$/resid.hxx       \
-            $(INC)$/resary.hxx      \
             $(INC)$/salbtype.hxx    \
             $(INC)$/scrbar.hxx      \
             $(INC)$/slider.hxx      \
@@ -146,7 +138,6 @@ HXXDEPNLST= $(INC)$/accel.hxx       \
             $(INC)$/svapp.hxx       \
             $(INC)$/syschild.hxx    \
             $(INC)$/sysdata.hxx     \
-            $(INC)$/system.hxx      \
             $(INC)$/syswin.hxx      \
             $(INC)$/tabctrl.hxx     \
             $(INC)$/tabdlg.hxx      \
@@ -179,23 +170,14 @@ LIB1FILES=  $(SLB)$/app.lib     \
             $(SLB)$/helper.lib
 
 
-.IF "$(remote)" != ""
-    LIB1FILES+= $(SLB)$/remote.lib
-.IF "$(COM)"=="GCC"
-LIB1OBJFILES=$(SLO)$/salmain.obj
-.ENDIF
-.ELSE           # "$(remote)" != ""
+.IF "$(GUI)" == "UNX"
+LIB1FILES+=$(SLB)$/salplug.lib
+.ELSE
 LIB1FILES+= \
             $(SLB)$/salwin.lib  \
             $(SLB)$/salgdi.lib  \
             $(SLB)$/salapp.lib
-.ENDIF          # "$(remote)" != ""
-
-.IF "$(GUI)" == "UNX"
-.IF "$(USE_XPRINT)" != "TRUE"
-    SHL1STDLIBS=-lpsp$(VERSION)$(DLLPOSTFIX)
-.ENDIF # ! USE_XPRINT
-.ENDIF # UNX
+.ENDIF
 
 SHL1TARGET= vcl$(VERSION)$(DLLPOSTFIX)
 SHL1IMPLIB= ivcl
@@ -208,11 +190,9 @@ SHL1STDLIBS+=\
             $(CPPUHELPERLIB)    \
             $(CPPULIB)          \
             $(VOSLIB)           \
-            $(SALLIB)
-
-.IF "$(ENABLE_CTL)"!=""
-    SHL1STDLIBS+= $(ICUUCLIB) $(ICULELIB)
-.ENDIF # ENABLE_CTL
+            $(SALLIB)			\
+            $(ICUUCLIB)			\
+            $(ICULELIB)
 
 .IF "$(USE_BUILTIN_RASTERIZER)"!=""
     LIB1FILES +=    $(SLB)$/glyphs.lib
@@ -227,6 +207,8 @@ SHL1DEPN=   $(L)$/itools.lib $(L)$/sot.l
 SHL1LIBS=   $(LIB1TARGET)
 .IF "$(GUI)"!="UNX"
 SHL1OBJS=   $(SLO)$/salshl.obj
+.ELSE
+SHL1STDLIBS+=-ldl
 .ENDIF
 
 .IF "$(GUI)" != "MAC"
@@ -242,10 +224,6 @@ DEF1DEPN    =   $(MISC)$/$(SHL1TARGET).f
                 $(LIB1TARGET)
 DEF1DES     =VCL
 DEFLIB1NAME =vcl
-DEF1EXPORT1=component_getFactory
-DEF1EXPORT2=component_getImplementationEnvironment
-DEF1EXPORT3=component_writeInfo
-
 
 # --- W32 ----------------------------------------------------------------
 
@@ -263,9 +241,9 @@ SHL1STDLIBS += uwinapi.lib      \
 .IF "$(GUI)$(COM)$(CPU)" == "WNTMSCI"
 LINKFLAGSSHL += /ENTRY:LibMain@12
 .ENDIF
-
 .ENDIF
 
+
 # --- UNX ----------------------------------------------------------------
 
 .IF "$(GUI)"=="UNX"
@@ -278,47 +256,110 @@ SHL1STDLIBS += -ldl
 SHL1STDLIBS += -framework Cocoa
 .ENDIF
 
+
+SHL1STDLIBS += -lX11
+
+.ENDIF          # "$(GUI)"=="UNX"
+
+# UNX sal plugins
+.IF "$(GUI)" == "UNX"
+
+# basic pure X11 plugin
+LIB2TARGET=$(SLB)$/ipure_x
+LIB2FILES= \
+            $(SLB)$/salwin.lib  \
+            $(SLB)$/salgdi.lib  \
+            $(SLB)$/salapp.lib
+SHL2TARGET=vclplug_gen$(UPD)$(DLLPOSTFIX)
+SHL2IMPLIB=ipure_x
+SHL2LIBS=  $(LIB2TARGET)
+
+# libs for generic plugin
+SHL2STDLIBS=\
+			$(VCLLIB)\
+			-lpsp$(VERSION)$(DLLPOSTFIX)\
+            $(SOTLIB)           \
+            $(UNOTOOLSLIB)      \
+            $(TOOLSLIB)         \
+            $(COMPHELPERLIB)	\
+            $(UCBHELPERLIB)     \
+            $(CPPUHELPERLIB)    \
+            $(CPPULIB)          \
+            $(VOSLIB)           \
+            $(SALLIB)
+
+.IF "$(OS)"=="MACOSX"
+SHL2STDLIBS += -lXinerama
+.ENDIF
+
+.IF "$(OS)"=="LINUX" || "$(OS)"=="SOLARIS" || "$(OS)"=="FREEBSD"
+SHL2STDLIBS += -laudio
+#.IF "$(NAS_LINKING_NEEDS_XT)" == "YES"
+SHL2STDLIBS += -lXt
+#.ENDIF
+.IF "$(OS)"=="SOLARIS"
+# needed by libaudio.a
+SHL2STDLIBS += -ldl -lnsl -lsocket
+.ENDIF # SOLARIS
+.ENDIF # "$(OS)"=="LINUX" || "$(OS)"=="SOLARIS" || "$(OS)"=="FREEBSD"
+
 .IF "$(GUIBASE)"=="unx"
 
 .IF "$(WITH_LIBSN)"=="YES"
-SHL1STDLIBS+=$(LIBSN_LIBS)
+SHL2STDLIBS+=$(LIBSN_LIBS)
 .ENDIF
 
 # Solaris
 .IF "$(OS)"=="SOLARIS"
-
-.IF "$(USE_XPRINT)" == "TRUE"
-SHL1STDLIBS += -lXp -lXext -lSM -lICE -lX11
-.ELSE
-SHL1STDLIBS += -lXext -lSM -lICE -lX11
-.ENDIF          # "$(USE_XPRINT)" == "TRUE"
-
+SHL2STDLIBS += -lXext -lSM -lICE -lX11
 # Others
 .ELSE           # "$(OS)"=="SOLARIS"
-.IF "$(USE_XPRINT)" == "TRUE"
-SHL1STDLIBS += -lXp -lXext -lSM -lICE -lX11
-.ELSE
 .IF "$(CPU)" == "I"
-SHL1STDLIBS += -Wl,-Bstatic -lXinerama -Wl,-Bdynamic 
-.ENDIF
-SHL1STDLIBS += -lXext -lSM -lICE -lX11
-.ENDIF          # "$(USE_XPRINT)" == "TRUE"
+SHL2STDLIBS += -Wl,-Bstatic -lXinerama -Wl,-Bdynamic 
+.ENDIF 			# "$(CPU)=="I"
+SHL2STDLIBS += -lXext -lSM -lICE -lX11
 .ENDIF          # "$(OS)"=="SOLARIS"
+
 .ENDIF          # "$(GUIBASE)"=="unx"
 
-.IF "$(OS)"=="MACOSX"
-SHL1STDLIBS += -lXinerama
-.ENDIF
+# dummy plugin
+LIB3TARGET=$(SLB)$/idummy_plug_
+LIB3FILES= \
+            $(SLB)$/dapp.lib
+SHL3TARGET=vclplug_dummy$(UPD)$(DLLPOSTFIX)
+SHL3IMPLIB=idummy_plug_
+SHL3LIBS=  $(LIB3TARGET)
+
+# libs for dummy plugin
+SHL3STDLIBS=\
+			$(VCLLIB)\
+            $(SOTLIB)           \
+            $(UNOTOOLSLIB)      \
+            $(TOOLSLIB)         \
+            $(COMPHELPERLIB)	\
+            $(UCBHELPERLIB)     \
+            $(CPPUHELPERLIB)    \
+            $(CPPULIB)          \
+            $(VOSLIB)           \
+            $(SALLIB)
 
-.IF "$(OS)"=="LINUX" || "$(OS)"=="SOLARIS" || "$(OS)"=="FREEBSD"
-SHL1STDLIBS += -laudio
-.IF "$(OS)"=="SOLARIS"
-# needed by libaudio.a
-SHL1STDLIBS += -ldl -lnsl -lsocket
-.ENDIF # SOLARIS
-.ENDIF          # "$(OS)"=="LINUX" || "$(OS)"=="SOLARIS" || "$(OS)"=="FREEBSD"
+# gtk plugin
+.IF "$(ENABLE_GTK)" != ""
+LIB4TARGET=$(SLB)$/igtk_plug_
+LIB4FILES=\
+			$(SLB)$/gtkapp.lib\
+			$(SLB)$/gtkgdi.lib\
+			$(SLB)$/gtkwin.lib
+SHL4TARGET=vclplug_gtk$(UPD)$(DLLPOSTFIX)
+SHL4IMPLIB=igtk_plug_
+SHL4LIBS=$(LIB4TARGET)
+# libs for gtk plugin
+SHL4STDLIBS=`pkg-config --libs gtk+-2.0 gthread-2.0`
+SHL4STDLIBS+=-l$(SHL2TARGET)
+SHL4STDLIBS+=$(SHL3STDLIBS) -lX11 -ldl
+.ENDIF # "$(ENABLE_GTK)" != ""
 
-.ENDIF          # "$(GUI)"=="UNX"
+.ENDIF # UNX
 
 # --- Allgemein ----------------------------------------------------------
 
@@ -348,16 +386,6 @@ $(MISC)$/$(SHL1TARGET).flt: makefile.mk
     @echo RmBitmap>> $@
     @echo RmSound>> $@
     @echo __CT>> $@
-    @echo _TI2>> $@
-    @echo _TI3>> $@
-    @echo _real@ >> $@
-    @echo xMonitorFrom >> $@
-    @echo xEnumDisplay >> $@
-    @echo xGetSystemMetrics >> $@
-    @echo xGetMonitorInfo >> $@
-    @echo WIN_ >> $@
-    @echo component_ >> $@
     @echo DNDEventDispatcher>> $@
     @echo DNDListenerContainer>> $@
     @echo vcl\ >> $@
-
Index: vcl/util/makefile.pmk
===================================================================
RCS file: /cvs/gsl/vcl/util/makefile.pmk,v
retrieving revision 1.14
retrieving revision 1.16
diff -u -p -u -r1.14 -r1.16
--- vcl/util/makefile.pmk	16 Jul 2003 17:47:17 -0000	1.14
+++ vcl/util/makefile.pmk	2 Mar 2004 11:32:11 -0000	1.16
@@ -59,24 +59,12 @@
 #
 #
 #*************************************************************************
-PROJECTPCH4DLL=TRUE
-PROJECTPCH=vclpch
-PROJECTPCHSOURCE=$(PRJ)$/util$/vclpch
 PDBTARGET=vcl
 
-.IF "$(remote)" != ""
-USE_BUILTIN_RASTERIZER=true
-.ENDIF
 .IF "$(GUI)" == "UNX"
 USE_BUILTIN_RASTERIZER=true
 .ENDIF
 
 .IF "$(USE_BUILTIN_RASTERIZER)" != ""
-ENVCDEFS += -DUSE_BUILTIN_RASTERIZER
+ADDCDEFS += -DUSE_BUILTIN_RASTERIZER
 .ENDIF
-
-ENABLE_CTL=true
-.IF "$(ENABLE_CTL)" != ""
-ENVCDEFS += -DENABLE_CTL
-.ENDIF
-
Index: vcl/util/makefile.prj
===================================================================
RCS file: /cvs/gsl/vcl/util/makefile.prj,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -p -u -r1.1.1.1 -r1.2
--- vcl/util/makefile.prj	18 Sep 2000 17:05:48 -0000	1.1.1.1
+++ vcl/util/makefile.prj	6 Jan 2004 14:47:47 -0000	1.2
@@ -1,4 +1 @@
-PROJECTPCH4DLL=TRUE
-PROJECTPCH=vclpch
-PROJECTPCHSOURCE=$(PRJ)\util\vclpch
 PDBTARGET=vcl
