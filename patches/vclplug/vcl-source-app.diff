Index: vcl/source/app/access.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/Attic/access.cxx,v
retrieving revision 1.1.1.1
diff -u -p -u -r1.1.1.1 access.cxx
--- vcl/source/app/access.cxx	18 Sep 2000 17:05:35 -0000	1.1.1.1
+++ vcl/source/app/access.cxx	6 Jul 2004 01:20:06 -0000
@@ -335,7 +335,7 @@ void AccessObject::Execute( long nExtern
 	{
 		case ACCESS_TYPE_MENUITEM:
 			{
-			if ( ((Menu*)mpType)->bIsMenuBar )
+			if ( ((Menu*)mpType)->IsMenuBar() )
 				((MenuBar*)mpType)->SelectEntry( (USHORT) mnData1 );
 			else
 				((PopupMenu*)mpType)->SelectEntry( (USHORT) mnData1 );
@@ -662,7 +662,7 @@ XubString AccessObject::GetType()
 			{
 			Menu* pMenu = (Menu*)mpType;
 
-			if ( pMenu->bIsMenuBar )
+			if ( pMenu->IsMenuBar() )
 				pStr = "MenuBar";
 			else
 				pStr = "Menu";
Index: vcl/source/app/oldsv.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/Attic/oldsv.cxx,v
retrieving revision 1.9
diff -u -p -u -r1.9 oldsv.cxx
--- vcl/source/app/oldsv.cxx	11 Oct 2002 08:37:20 -0000	1.9
+++ vcl/source/app/oldsv.cxx	6 Jul 2004 02:11:39 -0000
@@ -98,25 +98,6 @@
 
 // ------------------------------------------------------------------------
 
-TYPEINIT0(ApplicationProperty)
-
-// ------------------------------------------------------------------------
-
-static PropertyHandler* pHandler=0;
-
-void Application::Property( ApplicationProperty& rProp )
-{
-    if ( pHandler )
-        pHandler->Property( rProp );
-}
-
-void Application::SetPropertyHandler( PropertyHandler* p )
-{
-    if ( pHandler )
-        delete pHandler;
-    pHandler = p;
-}
-
 void Application::EnterWait()
 {
     if ( Application::GetAppWindow() )
@@ -316,52 +297,6 @@ Color OutputDevice::GetSolidColor( const
     return rColor;
 }
 
-// ------------------------------------------------------------------------
-
-
-void WorkWindow::ImplSetFrameState( ULONG aFrameState )
-{
-    Window* pWindow = mpFrameWindow;
-
-#ifndef REMOTE_APPSERVER
-    SalFrameState   aState;
-    aState.mnMask   = SAL_FRAMESTATE_MASK_STATE;
-    aState.mnState  = aFrameState; //SAL_FRAMESTATE_MAXIMIZED;
-    mpFrame->SetWindowState( &aState );
-#else
-    //ByteString aStr;
-    //ImplWindowStateToStr( rData, aStr );
-    //mpFrame->SetWindowState( ::rtl::OUString( aStr.GetBuffer(), aStr.Len(), RTL_TEXTENCODING_ASCII_US ) );
-#endif
-
-    // Syncrones Resize ausloesen, damit wir nach Moeglichkeit gleich
-    // mit der richtigen Groesse rechnen
-    long nNewWidth;
-    long nNewHeight;
-    pWindow->mpFrame->GetClientSize( nNewWidth, nNewHeight );
-    ImplHandleResize( pWindow, nNewWidth, nNewHeight );
-}
-
-
-void WorkWindow::Minimize()
-{
-    ImplSetFrameState( SAL_FRAMESTATE_MINIMIZED );
-}
-
-void WorkWindow::Maximize()
-{
-    ImplSetFrameState( SAL_FRAMESTATE_MAXIMIZED );
-}
-
-void WorkWindow::Restore()
-{
-    ImplSetFrameState( SAL_FRAMESTATE_NORMAL );
-}
-
-BOOL WorkWindow::IsMaximized() const
-{
-    return FALSE;
-}
 
 // ------------------------------------------------------------------------
 /*
@@ -471,8 +406,4 @@ USHORT Application::DispatchAppEvents()
     }
 
     return nEvents;
-}
-
-void Application::AppEvent( const ApplicationEvent& rAppEvent )
-{
 }
Index: vcl/source/app/dbggui.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/dbggui.cxx,v
retrieving revision 1.12
retrieving revision 1.16
diff -u -p -u -r1.12 -r1.16
--- vcl/source/app/dbggui.cxx	27 Nov 2002 09:19:16 -0000	1.12
+++ vcl/source/app/dbggui.cxx	30 Mar 2004 13:42:10 -0000	1.16
@@ -59,15 +59,13 @@
  *
  ************************************************************************/
 
-#pragma hdrstop
 
-#ifdef DBG_UTIL
 
-#define _SV_DBGGUI_CXX
+#ifdef DBG_UTIL
 
 #include "svdata.hxx"
-#include <stdio.h>
-#include <string.h>
+#include <cstdio>
+#include <cstring>
 #include <limits.h>
 #include <svsys.h>
 
@@ -108,9 +106,6 @@
 #ifndef _SV_WRKWIN_HXX
 #include <wrkwin.hxx>
 #endif
-#ifndef _SV_SYSTEM_HXX
-#include <system.hxx>
-#endif
 #ifndef _SV_SOUND_HXX
 #include <sound.hxx>
 #endif
@@ -170,7 +165,6 @@ static sal_Char* pDbgHelpText[] =
 "\n",
 "Damit die Makros Wirkung haben, muss DBG_UTIL defniert sein.\n",
 "\n",
-#ifndef CFRONT
 "--- Optionen ---\n",
 "This\n",
 "Es wird auf gueltigen This-Pointer getestet. Dadurch kann man erreichen, "
@@ -510,7 +504,6 @@ static sal_Char* pDbgHelpText[] =
 "    //...\n",
 "}",
 "\n",
-#endif
 NULL
 };
 
@@ -684,7 +677,7 @@ void DbgWindow::InsertLine( const XubStr
 // =======================================================================
 
 DbgDialog::DbgDialog() :
-    ModalDialog( Application::GetAppWindow(), WB_STDMODAL | WB_SYSTEMWINDOW ),
+    ModalDialog( NULL, WB_STDMODAL | WB_SYSTEMWINDOW ),
     maXtorThis( this ),
     maXtorFunc( this ),
     maXtorExit( this ),
@@ -1097,11 +1090,7 @@ DbgDialog::DbgDialog() :
     }
 
     {
-#ifdef REMOTE_APPSERVER
-    SetText( XubString( RTL_CONSTASCII_USTRINGPARAM( "VCL Debug Options (Server)" ) ) );
-#else
     SetText( XubString( RTL_CONSTASCII_USTRINGPARAM( "VCL Debug Options" ) ) );
-#endif
     SetOutputSizePixel( LogicToPixel( Size( 340, 265 ), aAppMap ) );
     }
 }
@@ -1211,10 +1200,10 @@ IMPL_LINK( DbgDialog, ClickHdl, Button*,
         DbgData* pData = DbgGetData();
         pData->nTestFlags &= ~(DBG_TEST_XTOR_TRACE | DBG_TEST_MEM_INIT | DBG_TEST_RESOURCE | DBG_TEST_DIALOG | DBG_TEST_BOLDAPPFONT);
         pData->nTestFlags |= aData.nTestFlags & (DBG_TEST_XTOR_TRACE | DBG_TEST_MEM_INIT | DBG_TEST_RESOURCE | DBG_TEST_DIALOG | DBG_TEST_BOLDAPPFONT);
-        strcpy( pData->aInclClassFilter, aData.aInclClassFilter );
-        strcpy( pData->aExclClassFilter, aData.aExclClassFilter );
-        strcpy( pData->aInclFilter, aData.aInclFilter );
-        strcpy( pData->aExclFilter, aData.aExclFilter );
+        strncpy( pData->aInclClassFilter, aData.aInclClassFilter, sizeof( pData->aInclClassFilter ) );
+        strncpy( pData->aExclClassFilter, aData.aExclClassFilter, sizeof( pData->aExclClassFilter ) );
+        strncpy( pData->aInclFilter, aData.aInclFilter, sizeof( pData->aInclFilter ) );
+        strncpy( pData->aExclFilter, aData.aExclFilter, sizeof( pData->aExclFilter ) );
         if ( maBoldAppFont.GetSavedValue() != maBoldAppFont.IsChecked() )
         {
             AllSettings aSettings = Application::GetSettings();
@@ -1403,7 +1392,7 @@ void DbgDialogTest( Window* pWindow )
             XubString       aErrorText = aText;
             USHORT          nAccelPos;
             xub_Unicode     cAccel = 0;
-            if ( aErrorText > 128 )
+            if ( aErrorText.Len() > 128 )
             {
                 aErrorText.Erase( 128 );
                 aErrorText.AppendAscii( "..." );
@@ -1711,10 +1700,6 @@ void DbgPrintShell( const char* pLine );
 
 void DbgPrintMsgBox( const char* pLine )
 {
-#ifdef REMOTE_APPSERVER
-    DbgPrintShell( pLine );
-    return;
-#endif
     if ( Application::IsDialogCancelEnabled() )
     {
 #if defined( WNT )
@@ -1738,7 +1723,6 @@ void DbgPrintMsgBox( const char* pLine )
 #endif
     }
 
-#ifndef REMOTE_APPSERVER
 #ifdef UNX
     sal_Bool bAcquire = Application::GetSolarMutex().tryToAcquire();
     if (!bAcquire)
@@ -1748,7 +1732,6 @@ void DbgPrintMsgBox( const char* pLine )
         return;
     }
 #endif
-#endif
 
     strcpy( aDbgOutBuf, pLine );
     strcat( aDbgOutBuf, "\nAbort ? (Yes=abort / No=ignore / Cancel=core dump)" );
@@ -1760,7 +1743,6 @@ void DbgPrintMsgBox( const char* pLine )
     if ( pSVData->maWinData.mpCaptureWin )
         pSVData->maWinData.mpCaptureWin->ReleaseMouse();
 
-#ifndef REMOTE_APPSERVER
 #if defined( WNT )
     BOOL bOldCallTimer = pSVData->mbNoCallTimer;
     pSVData->mbNoCallTimer = TRUE;
@@ -1805,30 +1787,19 @@ void DbgPrintMsgBox( const char* pLine )
 #else
     USHORT nOldMode = Application::GetSystemWindowMode();
     Application::SetSystemWindowMode( nOldMode & ~SYSTEMWINDOW_MODE_NOAUTOMODE );
-    ErrorBox aBox( Application::GetAppWindow(), WB_YES_NO_CANCEL | WB_DEF_NO,
+    ErrorBox aBox( NULL, WB_YES_NO_CANCEL | WB_DEF_NO,
                    UniString( aDbgOutBuf, RTL_TEXTENCODING_UTF8 ) );
     aBox.SetText( String( RTL_CONSTASCII_USTRINGPARAM("Debug Output") ) );
     Application::SetSystemWindowMode( nOldMode );
     short nRet = aBox.Execute();
 #endif
-#else
-    USHORT nOldMode = Application::GetSystemWindowMode();
-    Application::SetSystemWindowMode( nOldMode & ~SYSTEMWINDOW_MODE_NOAUTOMODE );
-    ErrorBox aBox( Application::GetAppWindow(), WB_YES_NO_CANCEL | WB_DEF_NO,
-                   UniString( aDbgOutBuf, RTL_TEXTENCODING_UTF8 ) );
-    aBox.SetText( String( RTL_CONSTASCII_USTRINGPARAM("Debug Output (Server)") ) );
-    Application::SetSystemWindowMode( nOldMode );
-    short nRet = aBox.Execute();
-#endif
 
-#ifndef REMOTE_APPSERVER
 #ifdef UNX
     if (bAcquire)
     {
         Application::GetSolarMutex().release();
     }
 #endif
-#endif
 
     if ( nRet == RET_YES )
         GetpApp()->Abort( XubString( RTL_CONSTASCII_USTRINGPARAM( "Debug-Utilities-Error" ) ) );
@@ -1882,7 +1853,7 @@ void DbgPrintShell( const char* pLine )
 
 // =======================================================================
 
-#if defined( REMOTE_APPSERVER ) || defined( WNT ) || defined( OS2 )
+#ifdef WNT
 void ImplDbgTestSolarMutex();
 #endif
 
@@ -1893,7 +1864,7 @@ void DbgGUIInit()
     DbgSetPrintMsgBox( DbgPrintMsgBox );
     DbgSetPrintWindow( DbgPrintWindow );
     DbgSetPrintShell( DbgPrintShell );
-#if defined( REMOTE_APPSERVER ) || defined( WNT ) || defined( OS2 )
+#ifdef WNT
     DbgSetTestSolarMutex( ImplDbgTestSolarMutex );
 #endif
 }
@@ -1905,7 +1876,7 @@ void DbgGUIDeInit()
     DbgSetPrintMsgBox( NULL );
     DbgSetPrintWindow( NULL );
     DbgSetPrintShell( NULL );
-#if defined( REMOTE_APPSERVER ) || defined( WNT ) || defined( OS2 )
+#ifdef WNT
     DbgSetTestSolarMutex( NULL );
 #endif
 
Index: vcl/source/app/dndhelp.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/dndhelp.cxx,v
retrieving revision 1.2
retrieving revision 1.3
diff -u -p -u -r1.2 -r1.3
--- vcl/source/app/dndhelp.cxx	23 Nov 2001 12:38:33 -0000	1.2
+++ vcl/source/app/dndhelp.cxx	1 Dec 2003 13:05:02 -0000	1.3
@@ -59,7 +59,7 @@
  *
  ************************************************************************/
 
-#pragma hdrstop
+
 
 #include <dndhelp.hxx>
 
Index: vcl/source/app/help.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/help.cxx,v
retrieving revision 1.23.60.1
retrieving revision 1.26
diff -u -p -u -r1.23.60.1 -r1.26
--- vcl/source/app/help.cxx	9 Jan 2004 18:13:42 -0000	1.23.60.1
+++ vcl/source/app/help.cxx	6 Jan 2004 13:10:20 -0000	1.26
@@ -59,8 +59,6 @@
  *
  ************************************************************************/
 
-#define _SV_HELP_CXX
-
 #ifndef _SV_SVDATA_HXX
 #include <svdata.hxx>
 #endif
@@ -90,7 +88,7 @@
 
 #include <stdio.h>
 
-#pragma hdrstop
+
 
 
 // =======================================================================
@@ -108,6 +106,10 @@
 // =======================================================================
 
 Help::Help()
+{
+}
+
+Help::~Help()
 {
 }
 
Index: vcl/source/app/i18nhelp.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/i18nhelp.cxx,v
retrieving revision 1.3
retrieving revision 1.4
diff -u -p -u -r1.3 -r1.4
--- vcl/source/app/i18nhelp.cxx	23 Aug 2001 12:03:17 -0000	1.3
+++ vcl/source/app/i18nhelp.cxx	1 Dec 2003 13:05:40 -0000	1.4
@@ -59,7 +59,7 @@
  *
  ************************************************************************/
 
-#pragma hdrstop
+
 
 #include <i18nhelp.hxx>
 
Index: vcl/source/app/idlemgr.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/idlemgr.cxx,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -p -u -r1.1.1.1 -r1.2
--- vcl/source/app/idlemgr.cxx	18 Sep 2000 17:05:35 -0000	1.1.1.1
+++ vcl/source/app/idlemgr.cxx	6 Jan 2004 13:10:53 -0000	1.2
@@ -58,8 +58,6 @@
  *
  *
  ************************************************************************/
-
-#define _SV_IDLEMGR_CXX
 
 #ifndef _LIST_HXX
 #include <tools/list.hxx>
Index: vcl/source/app/makefile.mk
===================================================================
RCS file: /cvs/gsl/vcl/source/app/makefile.mk,v
retrieving revision 1.10.260.1
retrieving revision 1.13
diff -u -p -u -r1.10.260.1 -r1.13
--- vcl/source/app/makefile.mk	2 Mar 2004 10:00:57 -0000	1.10.260.1
+++ vcl/source/app/makefile.mk	18 May 2004 10:50:00 -0000	1.13
@@ -89,32 +87,15 @@ SLOFILES=	$(SLO)$/access.obj		\
 			$(SLO)$/svapp.obj		\
 			$(SLO)$/svdata.obj		\
 			$(SLO)$/svmain.obj		\
-			$(SLO)$/system.obj		\
 			$(SLO)$/timer.obj		\
 			$(SLO)$/dndhelp.obj     \
 			$(SLO)$/unohelp.obj     \
 			$(SLO)$/unohelp2.obj    \
 			$(SLO)$/vclevent.obj	\
 			$(SLO)$/i18nhelp.obj	\
+			$(SLO)$/salvtables.obj	\
 			$(SLO)$/session.obj
 
-.IF "$(remote)"!=""
-EXCEPTIONSFILES=					\
-			$(SLO)$/svapp.obj		\
-			$(SLO)$/access.obj		\
-			$(SLO)$/oldsv.obj		\
-			$(SLO)$/help.obj		\
-			$(SLO)$/resmgr.obj		\
-			$(SLO)$/sound.obj		\
-			$(SLO)$/svdata.obj		\
-			$(SLO)$/svmain.obj		\
-			$(SLO)$/system.obj		\
-			$(SLO)$/idlemgr.obj 	\
-			$(SLO)$/timer.obj		\
-			$(SLO)$/unohelp.obj     \
-			$(SLO)$/unohelp2.obj    \
-			$(SLO)$/dndhelp.obj
-.ELSE
 EXCEPTIONSFILES=					\
 			$(SLO)$/svapp.obj		\
 			$(SLO)$/svdata.obj		\
@@ -124,7 +105,6 @@ EXCEPTIONSFILES=					\
 			$(SLO)$/i18nhelp.obj 	\
 			$(SLO)$/svmain.obj		\
 			$(SLO)$/session.obj
-.ENDIF
 
 # --- Targets ------------------------------------------------------
 
Index: vcl/source/app/salvtables.cxx
===================================================================
RCS file: vcl/source/app/salvtables.cxx
diff -N vcl/source/app/salvtables.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ vcl/source/app/salvtables.cxx	10 May 2004 15:45:16 -0000	1.4
@@ -0,0 +1,137 @@
+/*************************************************************************
+ *
+ *  
+ *
+ *  
+ *
+ *  
+ *
+ *  The Contents of this file are made available subject to the terms of
+ *  either of the following licenses
+ *
+ *         - GNU Lesser General Public License Version 2.1
+ *         - Sun Industry Standards Source License Version 1.1
+ *
+ *  Sun Microsystems Inc., October, 2000
+ *
+ *  GNU Lesser General Public License Version 2.1
+ *  =============================================
+ *  Copyright 2000 by Sun Microsystems, Inc.
+ *  901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *  This library is free software; you can redistribute it and/or
+ *  modify it under the terms of the GNU Lesser General Public
+ *  License version 2.1, as published by the Free Software Foundation.
+ *
+ *  This library is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *  Lesser General Public License for more details.
+ *
+ *  You should have received a copy of the GNU Lesser General Public
+ *  License along with this library; if not, write to the Free Software
+ *  Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *  MA  02111-1307  USA
+ *
+ *
+ *  Sun Industry Standards Source License Version 1.1
+ *  =================================================
+ *  The contents of this file are subject to the Sun Industry Standards
+ *  Source License Version 1.1 (the "License"); You may not use this file
+ *  except in compliance with the License. You may obtain a copy of the
+ *  License at http://www.openoffice.org/license.html.
+ *
+ *  Software provided under this License is provided on an "AS IS" basis,
+ *  WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
+ *  WITHOUT LIMITATION, WARRANTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+ *  MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+ *  See the License for the specific provisions governing your rights and
+ *  obligations concerning the Software.
+ *
+ *  The Initial Developer of the Original Code is: Sun Microsystems, Inc.
+ *
+ *  Copyright: 2000 by Sun Microsystems, Inc.
+ *
+ *  All Rights Reserved.
+ *
+ *  Contributor(s): _______________________________________
+ *
+ *
+ ************************************************************************/
+
+#include <salframe.hxx>
+#include <salinst.hxx>
+#include <salvd.hxx>
+#include <salprn.hxx>
+#include <saltimer.hxx>
+#include <salsound.hxx>
+#include <salogl.hxx>
+#include <salimestatus.hxx>
+#include <salsys.hxx>
+#include <salbmp.hxx>
+#include <salobj.hxx>
+#include <salmenu.hxx>
+#include <salctrlhandle.hxx>
+
+// this file contains the virtual destructors of the sal interface
+// compilers ususally put their vtables where the destructor is
+
+SalFrame::~SalFrame()
+{
+}
+
+SalInstance::~SalInstance()
+{
+}
+
+SalSound::~SalSound()
+{
+}
+
+SalTimer::~SalTimer()
+{
+}
+
+SalOpenGL::~SalOpenGL()
+{
+}
+
+SalBitmap::~SalBitmap()
+{
+}
+
+SalI18NImeStatus::~SalI18NImeStatus()
+{
+}
+
+SalSystem::~SalSystem()
+{
+}
+
+SalPrinter::~SalPrinter()
+{
+}
+
+SalInfoPrinter::~SalInfoPrinter()
+{
+}
+
+SalVirtualDevice::~SalVirtualDevice()
+{
+}
+
+SalObject::~SalObject()
+{
+}
+
+SalMenu::~SalMenu()
+{
+}
+
+SalMenuItem::~SalMenuItem()
+{
+}
+SalControlHandle::~SalControlHandle()
+{
+}
+
Index: vcl/source/app/session.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/session.cxx,v
retrieving revision 1.1.4.2
retrieving revision 1.2
diff -u -p -u -r1.1.4.2 -r1.2
--- vcl/source/app/session.cxx	2 Mar 2004 14:22:34 -0000	1.1.4.2
+++ vcl/source/app/session.cxx	18 May 2004 10:53:41 -0000	1.2
@@ -58,12 +58,6 @@
  *
  *
  ************************************************************************/
-#ifdef WNT
-#define VCL_NEED_BASETSD
-#include <tools/presys.h>
-#include <windows.h>
-#include <tools/postsys.h>
-#endif
 
 #ifndef _SV_SVAPP_HXX
 #include <svapp.hxx>
Index: vcl/source/app/settings.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/settings.cxx,v
retrieving revision 1.38.122.1
retrieving revision 1.46
diff -u -p -u -r1.38.122.1 -r1.46
--- vcl/source/app/settings.cxx	15 Jan 2004 14:16:01 -0000	1.38.122.1
+++ vcl/source/app/settings.cxx	25 Jun 2004 15:15:36 -0000	1.46
@@ -59,8 +59,6 @@
  *
  ************************************************************************/
 
-#define _SV_SETTINGS_CXX
-
 #ifndef _DEBUG_HXX
 #include <tools/debug.hxx>
 #endif
@@ -112,7 +110,7 @@
 
 using namespace rtl;
 
-#pragma hdrstop
+
 
 // =======================================================================
 
@@ -241,7 +239,7 @@ ImplMouseData::ImplMouseData()
     mnDragLinkCode              = KEY_SHIFT | KEY_MOD1;
     mnContextMenuCode           = MOUSE_RIGHT;
     mnContextMenuClicks         = 1;
-    mbContextMenuDown           = FALSE;
+    mbContextMenuDown           = TRUE;
     mnMiddleButtonAction        = MOUSE_MIDDLE_AUTOSCROLL;
     mnScrollRepeat              = 100;
     mnButtonStartRepeat         = 370;
@@ -473,11 +471,7 @@ ImplStyleData::ImplStyleData()
     mnIconVertSpace             = 40;
     mnAntialiasedMin            = 0;
     mnCursorSize                = 2;
-#ifdef REMOTE_APPSERVER
     mnCursorBlinkTime           = STYLE_CURSOR_NOBLINKTIME;
-#else
-    mnCursorBlinkTime           = 500;
-#endif
     mnScreenZoom                = 100;
     mnScreenFontZoom            = 100;
     mnRadioButtonStyle          = 0;
@@ -499,60 +493,60 @@ ImplStyleData::ImplStyleData()
 // -----------------------------------------------------------------------
 
 ImplStyleData::ImplStyleData( const ImplStyleData& rData ) :
-    maFaceColor( rData.maFaceColor ),
-    maCheckedColor( rData.maCheckedColor ),
-    maLightColor( rData.maLightColor ),
-    maLightBorderColor( rData.maLightBorderColor ),
-    maShadowColor( rData.maShadowColor ),
-    maDarkShadowColor( rData.maDarkShadowColor ),
-    maButtonTextColor( rData.maButtonTextColor ),
-    maRadioCheckTextColor( rData.maRadioCheckTextColor ),
-    maGroupTextColor( rData.maGroupTextColor ),
-    maLabelTextColor( rData.maLabelTextColor ),
-    maInfoTextColor( rData.maInfoTextColor ),
-    maWindowColor( rData.maWindowColor ),
-    maWindowTextColor( rData.maWindowTextColor ),
-    maDialogColor( rData.maDialogColor ),
-    maDialogTextColor( rData.maDialogTextColor ),
-    maWorkspaceColor( rData.maWorkspaceColor ),
-    maFieldColor( rData.maFieldColor ),
-    maFieldTextColor( rData.maFieldTextColor ),
+    maActiveBorderColor( rData.maActiveBorderColor ),
     maActiveColor( rData.maActiveColor ),
     maActiveColor2( rData.maActiveColor2 ),
     maActiveTextColor( rData.maActiveTextColor ),
-    maActiveBorderColor( rData.maActiveBorderColor ),
+    maButtonTextColor( rData.maButtonTextColor ),
+    maCheckedColor( rData.maCheckedColor ),
+    maDarkShadowColor( rData.maDarkShadowColor ),
+    maDeactiveBorderColor( rData.maDeactiveBorderColor ),
     maDeactiveColor( rData.maDeactiveColor ),
     maDeactiveColor2( rData.maDeactiveColor2 ),
     maDeactiveTextColor( rData.maDeactiveTextColor ),
-    maDeactiveBorderColor( rData.maDeactiveBorderColor ),
-    maMenuColor( rData.maMenuColor ),
-    maMenuBarColor( rData.maMenuBarColor ),
-    maMenuBorderColor( rData.maMenuBorderColor ),
-    maMenuTextColor( rData.maMenuTextColor ),
-    maMenuHighlightColor( rData.maMenuHighlightColor ),
-    maMenuHighlightTextColor( rData.maMenuHighlightTextColor ),
-    maHighlightColor( rData.maHighlightColor ),
-    maHighlightTextColor( rData.maHighlightTextColor ),
+    maDialogColor( rData.maDialogColor ),
+    maDialogTextColor( rData.maDialogTextColor ),
     maDisableColor( rData.maDisableColor ),
+    maFaceColor( rData.maFaceColor ),
+    maFieldColor( rData.maFieldColor ),
+    maFieldTextColor( rData.maFieldTextColor ),
+	maFontColor( rData.maFontColor ),
+    maGroupTextColor( rData.maGroupTextColor ),
     maHelpColor( rData.maHelpColor ),
     maHelpTextColor( rData.maHelpTextColor ),
+    maHighlightColor( rData.maHighlightColor ),
+    maHighlightLinkColor( rData.maLinkColor ),
+    maHighlightTextColor( rData.maHighlightTextColor ),
+    maInfoTextColor( rData.maInfoTextColor ),
+    maLabelTextColor( rData.maLabelTextColor ),
+    maLightBorderColor( rData.maLightBorderColor ),
+    maLightColor( rData.maLightColor ),
     maLinkColor( rData.maLinkColor ),
+    maMenuBarColor( rData.maMenuBarColor ),
+    maMenuBorderColor( rData.maMenuBorderColor ),
+    maMenuColor( rData.maMenuColor ),
+    maMenuHighlightColor( rData.maMenuHighlightColor ),
+    maMenuHighlightTextColor( rData.maMenuHighlightTextColor ),
+    maMenuTextColor( rData.maMenuTextColor ),
+    maRadioCheckTextColor( rData.maRadioCheckTextColor ),
+    maShadowColor( rData.maShadowColor ),
     maVisitedLinkColor( rData.maLinkColor ),
-    maHighlightLinkColor( rData.maLinkColor ),
+    maWindowColor( rData.maWindowColor ),
+    maWindowTextColor( rData.maWindowTextColor ),
+    maWorkspaceColor( rData.maWorkspaceColor ),
     maAppFont( rData.maAppFont ),
     maHelpFont( rData.maAppFont ),
     maTitleFont( rData.maTitleFont ),
     maFloatTitleFont( rData.maFloatTitleFont ),
     maMenuFont( rData.maMenuFont ),
     maToolFont( rData.maToolFont ),
-    maGroupFont( rData.maGroupFont ),
     maLabelFont( rData.maLabelFont ),
+    maGroupFont( rData.maGroupFont ),
     maInfoFont( rData.maInfoFont ),
     maRadioCheckFont( rData.maRadioCheckFont ),
     maPushButtonFont( rData.maPushButtonFont ),
     maFieldFont( rData.maFieldFont ),
-    maIconFont( rData.maIconFont ),
-	maFontColor( rData.maFontColor )
+    maIconFont( rData.maIconFont )
 {
     mnRefCount                  = 1;
     mnBorderSize                = rData.mnBorderSize;
@@ -582,6 +576,7 @@ ImplStyleData::ImplStyleData( const Impl
     mnOptions                   = rData.mnOptions;
 	mnHighContrast				= rData.mnHighContrast;
 	mnUseSystemUIFonts			= rData.mnUseSystemUIFonts;
+	mnUseFlatBorders 			= rData.mnUseFlatBorders;
 	mnUseFlatMenues 			= rData.mnUseFlatMenues;
     mnAutoMnemonic				= rData.mnAutoMnemonic;
     mnUseImagesInMenus			= rData.mnUseImagesInMenus;
@@ -595,7 +590,7 @@ void ImplStyleData::SetStandardStyles()
     Font aStdFont( FAMILY_SWISS, Size( 0, 8 ) );
     aStdFont.SetCharSet( gsl_getSystemTextEncoding() );
     aStdFont.SetWeight( WEIGHT_NORMAL );
-    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(LANGUAGE_ENGLISH) );
+    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(com::sun::star::lang::Locale( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("en") ), rtl::OUString(), rtl::OUString() ) ) );
     maAppFont                   = aStdFont;
     maHelpFont                  = aStdFont;
     maMenuFont                  = aStdFont;
@@ -609,7 +604,6 @@ void ImplStyleData::SetStandardStyles()
     maIconFont                  = aStdFont;
     maFloatTitleFont            = aStdFont;
     aStdFont.SetWeight( WEIGHT_BOLD );
-    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(LANGUAGE_ENGLISH) );
     maTitleFont                 = aStdFont;
 
     maFaceColor                 = Color( COL_LIGHTGRAY );
@@ -667,229 +661,13 @@ void ImplStyleData::SetStandardStyles()
     mnMenuBarHeight             = 14;
 	mnHighContrast				= 0;
 	mnUseSystemUIFonts			= 0;
+	mnUseFlatBorders 			= 0;
 	mnUseFlatMenues 			= 0;
 	mnUseImagesInMenus			= (USHORT)TRUE;
 }
 
 // -----------------------------------------------------------------------
 
-void ImplStyleData::SetStandardWinStyles()
-{
-    SetStandardStyles();
-
-    mnRadioButtonStyle         &= ~STYLE_RADIOBUTTON_STYLE;
-    mnRadioButtonStyle         |= STYLE_RADIOBUTTON_WIN;
-    mnCheckBoxStyle            &= ~STYLE_CHECKBOX_STYLE;
-    mnCheckBoxStyle            |= STYLE_CHECKBOX_WIN;
-    mnPushButtonStyle          &= ~STYLE_PUSHBUTTON_STYLE;
-    mnPushButtonStyle          |= STYLE_PUSHBUTTON_WIN;
-    mnTabControlStyle           = 0;
-
-    mnOptions                  &= ~(STYLE_OPTION_SYSTEMSTYLE | STDSYS_STYLE);
-    mnOptions                  |= STYLE_OPTION_WINSTYLE;
-}
-
-// -----------------------------------------------------------------------
-
-void ImplStyleData::SetStandardOS2Styles()
-{
-    Font aStdFont( FAMILY_SWISS, Size( 0, 9 ) );
-    aStdFont.SetCharSet( gsl_getSystemTextEncoding() );
-    aStdFont.SetWeight( WEIGHT_NORMAL );
-    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(LANGUAGE_ENGLISH) );
-    maAppFont                   = aStdFont;
-    maHelpFont                  = aStdFont;
-    maToolFont                  = aStdFont;
-    maGroupFont                 = aStdFont;
-    maLabelFont                 = aStdFont;
-    maInfoFont                  = aStdFont;
-    maRadioCheckFont            = aStdFont;
-    maPushButtonFont            = aStdFont;
-    maFieldFont                 = aStdFont;
-    maIconFont                  = aStdFont;
-    maFloatTitleFont            = aStdFont;
-    aStdFont.SetWeight( WEIGHT_BOLD );
-    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(LANGUAGE_ENGLISH) );
-    maMenuFont                  = aStdFont;
-    maTitleFont                 = aStdFont;
-
-    maFaceColor                 = Color( COL_LIGHTGRAY );
-    maCheckedColor              = Color( 0xCC, 0xCC, 0xCC );
-    maLightColor                = Color( COL_WHITE );
-    maLightBorderColor          = Color( COL_LIGHTGRAY );
-    maShadowColor               = Color( COL_GRAY );
-    maDarkShadowColor           = Color( COL_BLACK );
-    maButtonTextColor           = Color( COL_BLACK );
-    maRadioCheckTextColor       = Color( COL_BLACK );
-    maGroupTextColor            = Color( COL_BLACK );
-    maLabelTextColor            = Color( COL_BLACK );
-    maInfoTextColor             = Color( COL_BLACK );
-    maWindowColor               = Color( COL_WHITE );
-    maWindowTextColor           = Color( COL_BLACK );
-    maDialogColor               = Color( COL_LIGHTGRAY );
-    maDialogTextColor           = Color( COL_BLACK );
-    maWorkspaceColor            = Color( COL_GRAY );
-    maFieldColor                = Color( COL_WHITE );
-    maFieldTextColor            = Color( COL_BLACK );
-    maActiveColor               = Color( COL_BLUE );
-    maActiveColor2              = Color( COL_BLACK );
-    maActiveTextColor           = Color( COL_WHITE );
-    maActiveBorderColor         = Color( COL_LIGHTGRAY );
-    maDeactiveColor             = Color( COL_GRAY );
-    maDeactiveColor2            = Color( COL_BLACK );
-    maDeactiveTextColor         = Color( COL_LIGHTGRAY );
-    maDeactiveBorderColor       = Color( COL_LIGHTGRAY );
-    maMenuColor                 = Color( COL_LIGHTGRAY );
-    maMenuBarColor              = Color( COL_LIGHTGRAY );
-    maMenuBorderColor           = Color( COL_LIGHTGRAY );
-    maMenuTextColor             = Color( COL_BLACK );
-    maMenuHighlightColor        = Color( COL_BLUE );
-    maMenuHighlightTextColor    = Color( COL_WHITE );
-    maHighlightColor            = Color( COL_GRAY );
-    maHighlightTextColor        = Color( COL_WHITE );
-    maDisableColor              = Color( COL_GRAY );
-    maHelpColor                 = Color( 0xFF, 0xFF, 0xE0 );
-    maHelpTextColor             = Color( COL_BLACK );
-
-    mnRadioButtonStyle         &= ~STYLE_RADIOBUTTON_STYLE;
-    mnRadioButtonStyle         |= STYLE_RADIOBUTTON_OS2;
-    mnCheckBoxStyle            &= ~STYLE_CHECKBOX_STYLE;
-    mnCheckBoxStyle            |= STYLE_CHECKBOX_OS2;
-    mnPushButtonStyle          &= ~STYLE_PUSHBUTTON_STYLE;
-    mnPushButtonStyle          |= STYLE_PUSHBUTTON_OS2;
-    mnTabControlStyle           = STYLE_TABCONTROL_SINGLELINE |
-                                  STYLE_TABCONTROL_COLOR;
-
-    mnOptions                  &= ~(STYLE_OPTION_SYSTEMSTYLE | STDSYS_STYLE);
-    mnOptions                  |= STYLE_OPTION_OS2STYLE | STYLE_OPTION_SPINARROW;
-    mnBorderSize                = 1;
-    mnTitleHeight               = 18;
-    mnFloatTitleHeight          = 13;
-    mnTearOffTitleHeight        = 8;
-    mnMenuBarHeight             = 14;
-	mnHighContrast				= 0;
-	mnUseSystemUIFonts			= 0;
-	mnUseFlatMenues 			= 0;
-	mnUseImagesInMenus			= (USHORT)TRUE;	
-}
-
-// -----------------------------------------------------------------------
-
-void ImplStyleData::SetStandardMacStyles()
-{
-    Font aStdFont( FAMILY_SWISS, Size( 0, 8 ) );
-    aStdFont.SetCharSet( gsl_getSystemTextEncoding() );
-    aStdFont.SetWeight( WEIGHT_NORMAL );
-    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(LANGUAGE_ENGLISH) );
-    maAppFont                   = aStdFont;
-    maHelpFont                  = aStdFont;
-    maToolFont                  = aStdFont;
-    maPushButtonFont            = aStdFont;
-    maGroupFont                 = aStdFont;
-    maLabelFont                 = aStdFont;
-    maInfoFont                  = aStdFont;
-    maRadioCheckFont            = aStdFont;
-    maFieldFont                 = aStdFont;
-    maIconFont                  = aStdFont;
-    maFloatTitleFont            = aStdFont;
-    aStdFont.SetName( vcl::DefaultFontConfigItem::get()->getUserInterfaceFont(LANGUAGE_ENGLISH) );
-//    aStdFont.SetWeight( WEIGHT_BOLD );
-    maMenuFont                  = aStdFont;
-    maTitleFont                 = aStdFont;
-//    maPushButtonFont            = aStdFont;
-//    maGroupFont                 = aStdFont;
-//    maLabelFont                 = aStdFont;
-
-    maFaceColor                 = Color( COL_LIGHTGRAY );
-    maCheckedColor              = Color( 0x99, 0x99, 0x99 );
-    maLightColor                = Color( COL_WHITE );
-    maLightBorderColor          = Color( COL_LIGHTGRAY );
-    maShadowColor               = Color( COL_GRAY );
-    maDarkShadowColor           = Color( COL_BLACK );
-    maButtonTextColor           = Color( COL_BLACK );
-    maRadioCheckTextColor       = Color( COL_BLACK );
-    maGroupTextColor            = Color( COL_BLACK );
-    maLabelTextColor            = Color( COL_BLACK );
-    maInfoTextColor             = Color( COL_BLACK );
-    maWindowColor               = Color( COL_WHITE );
-    maWindowTextColor           = Color( COL_BLACK );
-    maDialogColor               = Color( COL_LIGHTGRAY );
-    maDialogTextColor           = Color( COL_BLACK );
-    maWorkspaceColor            = Color( COL_GRAY );
-    maFieldColor                = Color( COL_WHITE );
-    maFieldTextColor            = Color( COL_BLACK );
-    maActiveColor               = Color( COL_LIGHTGRAY );
-    maActiveColor2              = Color( COL_LIGHTGRAY );
-    maActiveTextColor           = Color( COL_BLACK );
-    maActiveBorderColor         = Color( COL_LIGHTGRAY );
-    maDeactiveColor             = Color( COL_LIGHTGRAY );
-    maDeactiveColor2            = Color( COL_LIGHTGRAY );
-    maDeactiveTextColor         = Color( COL_GRAY );
-    maDeactiveBorderColor       = Color( COL_LIGHTGRAY );
-    maMenuColor                 = Color( COL_LIGHTGRAY );
-    maMenuBarColor              = Color( COL_LIGHTGRAY );
-    maMenuBorderColor           = Color( COL_LIGHTGRAY );
-    maMenuTextColor             = Color( COL_BLACK );
-    maMenuHighlightColor        = Color( COL_BLUE );
-    maMenuHighlightTextColor    = Color( COL_WHITE );
-    maHighlightColor            = Color( COL_BLUE );
-    maHighlightTextColor        = Color( COL_WHITE );
-    maDisableColor              = Color( COL_GRAY );
-    maHelpColor                 = Color( 0xFF, 0xFF, 0xE0 );
-    maHelpTextColor             = Color( COL_BLACK );
-
-    mnRadioButtonStyle         &= ~STYLE_RADIOBUTTON_STYLE;
-    mnRadioButtonStyle         |= STYLE_RADIOBUTTON_MAC;
-    mnCheckBoxStyle            &= ~STYLE_CHECKBOX_STYLE;
-    mnCheckBoxStyle            |= STYLE_CHECKBOX_MAC;
-    mnPushButtonStyle          &= ~STYLE_PUSHBUTTON_STYLE;
-    mnPushButtonStyle          |= STYLE_PUSHBUTTON_MAC;
-    mnTabControlStyle           = 0;
-
-    mnOptions                  &= ~(STYLE_OPTION_SYSTEMSTYLE | STDSYS_STYLE);
-    mnOptions                  |= STYLE_OPTION_MACSTYLE | STYLE_OPTION_NOMNEMONICS | STYLE_OPTION_SPINUPDOWN;
-    mnBorderSize                = 2;
-    mnTitleHeight               = 16;
-    mnFloatTitleHeight          = 12;
-    mnTearOffTitleHeight        = 7;
-    mnMenuBarHeight             = 14;
-	mnHighContrast				= 0;
-	mnUseSystemUIFonts			= 0;
-	mnUseFlatMenues 			= 0;
-	mnUseImagesInMenus			= (USHORT)TRUE;
-}
-
-// -----------------------------------------------------------------------
-
-void ImplStyleData::SetStandardUnixStyles()
-{
-    SetStandardStyles();
-
-    maActiveColor               = Color( 182, 77, 121 );
-    maActiveColor2              = Color( 182, 77, 121 );
-    maActiveTextColor           = Color( COL_WHITE );
-    maActiveBorderColor         = Color( 182, 77, 121 );
-    maDeactiveColor             = Color( 174, 178, 199 );
-    maDeactiveColor2            = Color( 174, 178, 199 );
-    maDeactiveTextColor         = Color( COL_BLACK );
-    maDeactiveBorderColor       = Color( 174, 178, 199 );
-
-    mnRadioButtonStyle         &= ~STYLE_RADIOBUTTON_STYLE;
-    mnRadioButtonStyle         |= STYLE_RADIOBUTTON_UNIX;
-    mnCheckBoxStyle            &= ~STYLE_CHECKBOX_STYLE;
-    mnCheckBoxStyle            |= STYLE_CHECKBOX_UNIX;
-    mnPushButtonStyle          &= ~STYLE_PUSHBUTTON_STYLE;
-    mnPushButtonStyle          |= STYLE_PUSHBUTTON_UNIX;
-    mnTabControlStyle           = 0;
-
-    mnOptions                  &= ~(STYLE_OPTION_SYSTEMSTYLE | STDSYS_STYLE);
-    mnOptions                  |= STYLE_OPTION_UNIXSTYLE;
-
-    mnBorderSize                = 3;
-}
-
-// -----------------------------------------------------------------------
-
 StyleSettings::StyleSettings()
 {
     mpData = new ImplStyleData();
@@ -960,32 +738,28 @@ void StyleSettings::SetStandardStyles()
 
 void StyleSettings::SetStandardWinStyles()
 {
-    CopyData();
-    mpData->SetStandardWinStyles();
+    return; // no more style changes since NWF
 }
 
 // -----------------------------------------------------------------------
 
 void StyleSettings::SetStandardOS2Styles()
 {
-    CopyData();
-    mpData->SetStandardOS2Styles();
+    return; // no more style changes since NWF
 }
 
 // -----------------------------------------------------------------------
 
 void StyleSettings::SetStandardMacStyles()
 {
-    CopyData();
-    mpData->SetStandardMacStyles();
+    return; // no more style changes since NWF
 }
 
 // -----------------------------------------------------------------------
 
 void StyleSettings::SetStandardUnixStyles()
 {
-    CopyData();
-    mpData->SetStandardUnixStyles();
+    return; // no more style changes since NWF
 }
 
 
@@ -1023,6 +797,54 @@ void StyleSettings::CopyData()
 
 // -----------------------------------------------------------------------
 
+inline BOOL ImplIsBackOrWhite( const Color& rColor )
+{
+    UINT8 nLuminance = rColor.GetLuminance();
+    return ( nLuminance < 8 ) || ( nLuminance > 250 );
+}
+
+BOOL StyleSettings::IsHighContrastBlackAndWhite() const
+{
+    BOOL bBWOnly = TRUE;
+
+    // Only use B&W if fully B&W, like on GNOME.
+    // Some colors like CheckedColor and HighlightColor are not B&W in Windows Standard HC Black,
+    // and we don't want to be B&W then, so check these color first, very probably not B&W.
+    
+    // Unfortunately, GNOME uses a very very dark color (0x000033) instead of BLACK (0x000000)
+
+    if ( !ImplIsBackOrWhite( GetFaceColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetHighlightTextColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetWindowColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetWindowTextColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetButtonTextColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetButtonTextColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetGroupTextColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetLabelTextColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetDialogColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetFieldColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetMenuColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetMenuBarColor() ) )
+        bBWOnly = FALSE;
+    else if ( !ImplIsBackOrWhite( GetMenuHighlightColor() ) )
+        bBWOnly = FALSE;
+
+    return bBWOnly;
+}
+
+// -----------------------------------------------------------------------
+
 BOOL StyleSettings::operator ==( const StyleSettings& rSet ) const
 {
     if ( mpData == rSet.mpData )
@@ -1056,6 +878,7 @@ BOOL StyleSettings::operator ==( const S
          (mpData->mnTabControlStyle         == rSet.mpData->mnTabControlStyle)          &&
          (mpData->mnHighContrast			== rSet.mpData->mnHighContrast)             &&
          (mpData->mnUseSystemUIFonts		== rSet.mpData->mnUseSystemUIFonts)         &&
+         (mpData->mnUseFlatBorders   		== rSet.mpData->mnUseFlatBorders)           &&
          (mpData->mnUseFlatMenues   		== rSet.mpData->mnUseFlatMenues)            &&
          (mpData->maFaceColor               == rSet.mpData->maFaceColor)                &&
          (mpData->maCheckedColor            == rSet.mpData->maCheckedColor)             &&
@@ -1124,6 +947,8 @@ ImplMiscData::ImplMiscData()
     mnRefCount                  = 1;
     mnTwoDigitYearStart         = 1930;
     mnEnableATT					= ~0;
+    static const char* pEnv = getenv("SAL_DECIMALSEP_ENABLED" ); // set default without UI
+    mbEnableLocalizedDecimalSep = (pEnv != NULL) ? TRUE : FALSE;
 }
 
 // -----------------------------------------------------------------------
@@ -1133,6 +958,7 @@ ImplMiscData::ImplMiscData( const ImplMi
     mnRefCount                  = 1;
     mnTwoDigitYearStart         = rData.mnTwoDigitYearStart;
     mnEnableATT					= rData.mnEnableATT;
+    mbEnableLocalizedDecimalSep = rData.mbEnableLocalizedDecimalSep;
 }
 
 // -----------------------------------------------------------------------
@@ -1204,7 +1030,8 @@ BOOL MiscSettings::operator ==( const Mi
         return TRUE;
 
     if ( (mpData->mnTwoDigitYearStart   == rSet.mpData->mnTwoDigitYearStart ) &&
-         (mpData->mnEnableATT			== rSet.mpData->mnEnableATT ) )
+         (mpData->mnEnableATT			== rSet.mpData->mnEnableATT ) &&
+         (mpData->mbEnableLocalizedDecimalSep == rSet.mpData->mbEnableLocalizedDecimalSep ) )
         return TRUE;
     else
         return FALSE;
@@ -1214,16 +1041,12 @@ BOOL MiscSettings::operator ==( const Mi
 
 BOOL MiscSettings::GetEnableATToolSupport() const
 {
-#ifndef REMOTE_APPSERVER
     if( mpData->mnEnableATT == (USHORT)~0 )
     {
 #ifdef UNX
         mpData->mnEnableATT = 0;
 
-        DtIntegrator* pIntegrator = DtIntegrator::CreateDtIntegrator( NULL );
         static const char* pEnv = getenv("SAL_ACCESSIBILITY_ENABLED" );
-        if( ( pIntegrator && pIntegrator->GetDtType() == DtGNOME ) ||
-            ( pEnv && *pEnv ) )
         {
             char buf[16];
             // use 2 shells to suppress the eventual "gcontool-2 not found" message
@@ -1300,9 +1123,6 @@ BOOL MiscSettings::GetEnableATToolSuppor
     }
     return (BOOL)mpData->mnEnableATT;
     
-#else // REMOTE_APPSERVER
-    return FALSE;
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -1361,6 +1181,19 @@ void MiscSettings::SetEnableATToolSuppor
     }
 }
 
+void MiscSettings::SetEnableLocalizedDecimalSep( BOOL bEnable )
+{
+    CopyData();
+    mpData->mbEnableLocalizedDecimalSep = bEnable;
+}
+
+BOOL MiscSettings::GetEnableLocalizedDecimalSep() const
+{
+    return mpData->mbEnableLocalizedDecimalSep;
+}
+
+
+
 // =======================================================================
 
 ImplSoundData::ImplSoundData()
@@ -1547,9 +1380,9 @@ ImplHelpData::ImplHelpData()
 {
     mnRefCount                  = 1;
     mnOptions                   = 0;
-    mnTipDelay                  = 200;  // #112193# faster tooltips  
+    mnTipDelay                  = 500;
     mnTipTimeout                = 3000;
-    mnBalloonDelay              = 1000; // #112193# faster tooltips  
+    mnBalloonDelay              = 1500;
 }
 
 // -----------------------------------------------------------------------
Index: vcl/source/app/sound.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/sound.cxx,v
retrieving revision 1.6
retrieving revision 1.9
diff -u -p -u -r1.6 -r1.9
--- vcl/source/app/sound.cxx	27 Mar 2003 17:57:50 -0000	1.6
+++ vcl/source/app/sound.cxx	6 Jan 2004 13:12:46 -0000	1.9
@@ -59,8 +59,6 @@
  *
  ************************************************************************/
 
-#define _SV_SOUND_CXX
-
 #ifndef _URLOBJ_HXX
 #include <tools/urlobj.hxx>
 #endif
@@ -73,17 +71,12 @@
 #ifndef _SV_SVSYS_HXX
 #include <svsys.h>
 #endif
-#ifndef REMOTE_APPSERVER
 #ifndef _SV_SALSOUND_HXX
 #include <salsound.hxx>
 #endif
 #ifndef _SV_SALFRAME_HXX
 #include <salframe.hxx>
 #endif
-#else
-#include <rmwindow.hxx>
-#include <rmsound.hxx>
-#endif
 #ifndef _DEBUG_HXX
 #include <tools/debug.hxx>
 #endif
@@ -105,29 +98,27 @@
 #ifndef _SV_SOUND_HXX
 #include <sound.hxx>
 #endif
+#ifndef _SV_SALINST_HXX
+#include <salinst.hxx>
+#endif
+
 
-#pragma hdrstop
 
 // ----------------------
 // - SalSound-Callback	-
 // ----------------------
 
-#ifndef REMOTE_APPSERVER
-
 void SalSoundProc( void* pInst, SoundNotification eNotification, ULONG nError )
 {
 	( (Sound*) pInst )->ImplNotify( eNotification, nError );
 }
 
-#endif
-
 // ---------
 // - Sound -
 // ---------
 
 Sound::Sound( Window* pWindow ) :
 			mpWindow		( pWindow ),
-			mpSoundData		( NULL ),
 			mnDataLen		( 0UL ),
 			mnSoundLen		( 0UL ),
 			mnStartTime		( 0UL ),
@@ -137,29 +128,16 @@ Sound::Sound( Window* pWindow ) :
 			mbPlaying		( FALSE ),
 			mbLoopMode		( FALSE )
 {
-#ifndef REMOTE_APPSERVER
-
-	mpSound = new SalSound;
-	mpSound->Create();
+	mpSound = ImplGetSVData()->mpDefInst->CreateSalSound();
 
 	if( mpSound->IsValid() )
 		mpSound->SetNotifyProc( this, SalSoundProc );
-
-#else
-
-	mpSound = new RMSound;
-	mpSound->Create( this );
-	
-#endif
 }
 
 // -----------------------------------------------------------------------
 
 Sound::~Sound()
 {
-	if( mpSoundData )
-		SvMemFree( mpSoundData );
-
 	delete mpSound;
 }
 
@@ -203,23 +181,7 @@ BOOL Sound::SetSoundName( const XubStrin
 		mbLoopMode = FALSE;
 		bRet = TRUE;
 
-#ifdef REMOTE_APPSERVER
-		if( mpSoundData )
-		{
-			SvMemFree( mpSoundData );
-			mpSoundData = NULL;
-		}
-
-		// if IFace is init., destroy it and create a new one
-		if( maSoundName.Len() )
-		{
-			delete mpSound;
-			mpSound = new RMSound;
-			mpSound->Create( this );
-		}
-#else
-		mpSound->Init( NULL, rSoundName, mnSoundLen );
-#endif
+		mpSound->Init( rSoundName, mnSoundLen );
 	}
 	else if( mpSound->IsValid() )
 	{
@@ -230,11 +192,7 @@ BOOL Sound::SetSoundName( const XubStrin
         // #106654# Accept only local sound files
 		if( aSoundURL.GetProtocol() == INET_PROT_FILE )
 		{
-#ifdef REMOTE_APPSERVER
-			aSoundName = aSoundURL.GetMainURL( INetURLObject::NO_DECODE );
-#else
-			::utl::LocalFileHelper::ConvertURLToPhysicalName( aSoundURL.GetMainURL( INetURLObject::NO_DECODE ), aSoundName );
-#endif
+			utl::LocalFileHelper::ConvertURLToPhysicalName( aSoundURL.GetMainURL( INetURLObject::NO_DECODE ), aSoundName );
             bValidName = TRUE;
 		}
 		else if( aSoundURL.GetProtocol() == INET_PROT_NOT_VALID &&
@@ -250,11 +208,11 @@ BOOL Sound::SetSoundName( const XubStrin
 
             // #106654# Don't set bRet to true for invalid sound file
             // names, but init with empty string, anyway
-		    mpSound->Init( NULL, aSoundName, mnSoundLen );
+		    mpSound->Init( aSoundName, mnSoundLen );
 		}
 
         if( bValidName )
-		    bRet = mpSound->Init( NULL, aSoundName, mnSoundLen );
+		    bRet = mpSound->Init( aSoundName, mnSoundLen );
 	}
 
 	maSoundName = rSoundName;
@@ -269,38 +227,9 @@ BOOL Sound::SetSoundName( const XubStrin
 
 // -----------------------------------------------------------------------
 
-BOOL Sound::SetSoundData( const BYTE* pSoundData, ULONG nDataLen )
-{
-	BOOL bRet;
-
-	if( mpSoundData )
-		SvMemFree( mpSoundData );
-	
-	mpSoundData = (BYTE*) SvMemAlloc( mnDataLen = nDataLen );
-	HMEMCPY( mpSoundData, pSoundData, nDataLen );
-
-	if( mpSound->IsValid() )
-		bRet = mpSound->Init( NULL, mpSoundData, mnDataLen, mnSoundLen );
-	else
-		bRet = FALSE;
-
-	// if sound could not be initialized, but we've gotten _no_
-	// notification ==> create common error notification
-	if( !bRet && !mnErrorCode )
-		ImplNotify( SOUND_NOTIFY_ERROR, SOUNDERR_GENERAL_ERROR );
-
-	return bRet;
-}
-
-// -----------------------------------------------------------------------
-
 void Sound::SetStartTime( ULONG nStartTime ) 
 {
 	mnStartTime = nStartTime;
-
-#ifdef REMOTE_APPSERVER
-	mpSound->SetStartTime( nStartTime );
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -308,10 +237,6 @@ void Sound::SetStartTime( ULONG nStartTi
 void Sound::SetPlayTime( ULONG nPlayTime )
 {
 	mnPlayTime = nPlayTime; 
-
-#ifdef REMOTE_APPSERVER
-	mpSound->SetStartTime( nPlayTime );
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -319,10 +244,6 @@ void Sound::SetPlayTime( ULONG nPlayTime
 void Sound::SetLoopMode( BOOL bLoop ) 
 {
 	mbLoopMode = bLoop; 
-
-#ifdef REMOTE_APPSERVER
-	mpSound->SetStartTime( bLoop );
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -330,10 +251,6 @@ void Sound::SetLoopMode( BOOL bLoop ) 
 void Sound::ClearError() 
 {
 	mnErrorCode = 0; 
-
-#ifdef REMOTE_APPSERVER
-	mpSound->ClearError();
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -344,13 +261,8 @@ void Sound::Play()
 
 	if( mpSound->IsValid() && !mnErrorCode )
 	{
-#ifndef REMOTE_APPSERVER
 		mpSound->Play( mnStartTime, mnPlayTime, mbLoopMode );
-#else
-		mpSound->Play();
-#endif
-
-		mbPlaying = TRUE;
+        mbPlaying = TRUE;
 	}
 	else
 		bRet = FALSE;
Index: vcl/source/app/stdtext.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/stdtext.cxx,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -p -u -r1.1.1.1 -r1.3
--- vcl/source/app/stdtext.cxx	18 Sep 2000 17:05:35 -0000	1.1.1.1
+++ vcl/source/app/stdtext.cxx	6 Jan 2004 13:13:14 -0000	1.3
@@ -59,8 +59,6 @@
  *
  ************************************************************************/
 
-#define _SV_STDTEXT_CXX
-
 #ifndef _SV_SVIDS_HRC
 #include <svids.hrc>
 #endif
@@ -74,7 +72,7 @@
 #include <stdtext.hxx>
 #endif
 
-#pragma hdrstop
+
 
 // =======================================================================
 
Index: vcl/source/app/svapp.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/svapp.cxx,v
retrieving revision 1.44
retrieving revision 1.50
diff -u -p -u -r1.44 -r1.50
--- vcl/source/app/svapp.cxx	15 Apr 2003 16:05:08 -0000	1.44
+++ vcl/source/app/svapp.cxx	25 Jun 2004 17:08:44 -0000	1.50
@@ -59,10 +59,7 @@
  *
  ************************************************************************/
 
-#define _SV_APP_CXX
-
 #include <stdio.h>
-#ifndef REMOTE_APPSERVER
 #ifndef _SV_SVSYS_HXX
 #include <svsys.h>
 #endif
@@ -72,16 +69,6 @@
 #ifndef _SV_SALFRAME_HXX
 #include <salframe.hxx>
 #endif
-#else
-#include "rvp.hxx"
-#include <rmwindow.hxx>
-#include <rmevents.hxx>
-#include <vos/thread.hxx>
-#ifndef _SV_MSGBOX_HXX
-#include <msgbox.hxx>
-#endif
-#endif
-
 #ifndef _VOS_PROCESS_HXX
 #include <vos/process.hxx>
 #endif
@@ -155,25 +139,21 @@
 #include <comphelper/processfactory.hxx>
 #endif
 
-#ifdef REMOTE_APPSERVER
-#include <osl/signal.h>
-#include <ooffice.hxx>
-#include <cppuhelper/implbase1.hxx>
-
-#include <com/sun/star/connection/XConnectionBroadcaster.hpp>
-#include <com/sun/star/io/XStreamListener.hpp>
-#include <com/sun/star/portal/client/XRmSync.hpp>
-#endif
-
 #include <osl/module.h>
 #include <osl/file.hxx>
 
 #include "osl/thread.h"
 #include "rtl/tencinfo.h"
 
-#if defined UNX
-#include "i18n_status.hxx"
-#endif // UNX
+#ifndef INCLUDED_RTL_INSTANCE_HXX
+#include <rtl/instance.hxx>
+#endif
+
+#ifndef _SV_SALIMESTATUS_HXX
+#include <salimestatus.hxx>
+#endif
+
+#include <utility>
 
 using namespace ::com::sun::star::uno;
 
@@ -906,44 +620,7 @@ USHORT Application::GetDispatchLevel()
 
 BOOL Application::AnyInput( USHORT nType )
 {
-#ifndef REMOTE_APPSERVER
-    return SalInstance::AnyInput( nType );
-#else
-    ImplSVData* pSVData = ImplGetSVData();
-
-    if( ( nType & ( INPUT_ANY ) ) == ( INPUT_ANY ) )
-    {
-        return( pSVData->mpRmEventQueue->HasMouseEvent() ||
-                pSVData->mpRmEventQueue->HasKeyEvent() ||
-                pSVData->mpRmEventQueue->HasPaintEvent() ||
-                pSVData->mpRmEventQueue->HasTimerEvent() ||
-                pSVData->mpRmEventQueue->HasOtherEvent() );
-    }
-    else if( ( nType & ( INPUT_MOUSEANDKEYBOARD ) ) == ( INPUT_MOUSEANDKEYBOARD ) )
-    {
-        return( pSVData->mpRmEventQueue->HasMouseEvent() ||
-                pSVData->mpRmEventQueue->HasKeyEvent() );
-    }
-    else
-    {
-        if( nType & INPUT_MOUSE )
-            return pSVData->mpRmEventQueue->HasMouseEvent();
-
-        if( nType & INPUT_KEYBOARD )
-            return pSVData->mpRmEventQueue->HasKeyEvent();
-
-        if( nType & INPUT_PAINT )
-            return pSVData->mpRmEventQueue->HasPaintEvent();
-
-        if( nType & INPUT_TIMER )
-            return pSVData->mpRmEventQueue->HasTimerEvent();
-
-        if( nType & INPUT_OTHER )
-            return pSVData->mpRmEventQueue->HasOtherEvent();
-    }
-
-    return FALSE;
-#endif
+    return (BOOL)ImplGetSVData()->mpDefInst->AnyInput( nType );
 }
 
 // -----------------------------------------------------------------------
@@ -1057,8 +732,8 @@ void Application::SetSettings( const All
             // Update all windows
             Window* pFirstFrame = pSVData->maWinData.mpFirstFrame;
             // Daten, die neu berechnet werden muessen, zuruecksetzen
-            long nOldDPIX;
-            long nOldDPIY;
+            long nOldDPIX(0);
+            long nOldDPIY(0);
             if ( pFirstFrame )
             {
                 nOldDPIX = pFirstFrame->mnDPIX;
@@ -1310,7 +979,6 @@ BOOL Application::PostUserEvent( ULONG& 
     pSVEvent->mpWindow  = NULL;
     pSVEvent->mbCall    = TRUE;
     rEventId = (ULONG)pSVEvent;
-#ifndef REMOTE_APPSERVER
     if ( ImplGetDefaultWindow()->ImplGetFrame()->PostEvent( pSVEvent ) )
         return TRUE;
     else
@@ -1319,31 +987,29 @@ BOOL Application::PostUserEvent( ULONG& 
         delete pSVEvent;
         return FALSE;
     }
-#else
-    ExtRmEvent* pEvt = new ExtRmEvent( RMEVENT_USEREVENT, NULL, pSVEvent );
-    ImplPostEvent( pEvt );
-    return TRUE;
-#endif
 }
 
 // -----------------------------------------------------------------------
 
 void Application::RemoveUserEvent( ULONG nUserEvent )
 {
-    ImplSVEvent* pSVEvent = (ImplSVEvent*)nUserEvent;
+    if(nUserEvent)
+	{
+		ImplSVEvent* pSVEvent = (ImplSVEvent*)nUserEvent;
 
-    DBG_ASSERT( !pSVEvent->mpWindow,
-                "Application::RemoveUserEvent(): Event is send to a window" );
-    DBG_ASSERT( pSVEvent->mbCall,
-                "Application::RemoveUserEvent(): Event is already removed" );
+		DBG_ASSERT( !pSVEvent->mpWindow,
+					"Application::RemoveUserEvent(): Event is send to a window" );
+		DBG_ASSERT( pSVEvent->mbCall,
+					"Application::RemoveUserEvent(): Event is already removed" );
+
+		if ( pSVEvent->mpWindow )
+		{
+			pSVEvent->mpWindow->ImplRemoveDel( &(pSVEvent->maDelData) );
+			pSVEvent->mpWindow = NULL;
+		}
 
-    if ( pSVEvent->mpWindow )
-    {
-        pSVEvent->mpWindow->ImplRemoveDel( &(pSVEvent->maDelData) );
-        pSVEvent->mpWindow = NULL;
-    }
-
-    pSVEvent->mbCall = FALSE;
+		pSVEvent->mbCall = FALSE;
+	}
 }
 
 // -----------------------------------------------------------------------
@@ -1935,12 +1481,8 @@ void Application::SetUnoWrapper( UnoWrap
 
 ::com::sun::star::uno::Reference< ::com::sun::star::awt::XDisplayConnection > Application::GetDisplayConnection()
 {
-#ifndef REMOTE_APPSERVER
     ImplSVData* pSVData = ImplGetSVData();
     return pSVData->mpDisplayConnection ? pSVData->mpDisplayConnection : new ::vcl::DisplayConnection;
-#else
-    return ::com::sun::star::uno::Reference< ::com::sun::star::awt::XDisplayConnection >();
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -2302,10 +1691,9 @@ BOOL Application::IsHeadlessModeEnabled(
 bool Application::CanToggleImeStatusWindow()
 {
-#if defined UNX
-    return vcl::I18NStatus::get().canToggleStatusWindow();
-#else // UNX
-    return false;
-#endif // UNX
+    ImplSVData* pSVData = ImplGetSVData();
+    if( ! pSVData->mpImeStatus )
+        pSVData->mpImeStatus  = pSVData->mpDefInst->CreateI18NImeStatus();
+    return pSVData->mpImeStatus->canToggle();
 }
 
 void Application::ShowImeStatusWindow(bool bShow)
@@ -2329,9 +1704,11 @@ void Application::ShowImeStatusWindow(bo
     ImplGetSVData()->maAppData.meShowImeStatusWindow = bShow
         ? ImplSVAppData::ImeStatusWindowMode_SHOW
         : ImplSVAppData::ImeStatusWindowMode_HIDE;
-#if defined UNX
-    vcl::I18NStatus::get().toggleStatusWindow();
-#endif
+
+    ImplSVData* pSVData = ImplGetSVData();
+    if( ! pSVData->mpImeStatus )
+        pSVData->mpImeStatus  = pSVData->mpDefInst->CreateI18NImeStatus();
+    pSVData->mpImeStatus->toggle();
 }
 
 bool Application::GetShowImeStatusWindowDefault()
@@ -2342,6 +1719,11 @@ bool Application::GetShowImeStatusWindow
         && aInfo.MaximumCharSize > 1;
 }
 
+const ::rtl::OUString& Application::GetDesktopEnvironment()
+{
+    return SalGetDesktopEnvironment();    
+}
+
 BOOL Application::IsAccessibilityEnabled()
 {
     return FALSE;
@@ -2362,4 +1744,32 @@ BOOL InitAccessBridge( BOOL bShowCancel,
     }
 
     return bRet;
+}
+
+// MT: AppProperty, AppEvent was in oldsv.cxx, but is still needed...
+// ------------------------------------------------------------------------
+
+TYPEINIT0(ApplicationProperty)
+
+// ------------------------------------------------------------------------
+
+static PropertyHandler* pHandler=NULL;
+
+void Application::Property( ApplicationProperty& rProp )
+{
+    if ( pHandler )
+        pHandler->Property( rProp );
+}
+
+void Application::SetPropertyHandler( PropertyHandler* p )
+{
+    if ( pHandler )
+        delete pHandler;
+    pHandler = p;
+}
+
+
+
+void Application::AppEvent( const ApplicationEvent& rAppEvent )
+{
 }
Index: vcl/source/app/svdata.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/svdata.cxx,v
retrieving revision 1.27.60.1
retrieving revision 1.34
diff -u -p -u -r1.27.60.1 -r1.34
--- vcl/source/app/svdata.cxx	7 Apr 2004 11:01:55 -0000	1.27.60.1
+++ vcl/source/app/svdata.cxx	25 Jun 2004 17:08:58 -0000	1.34
@@ -61,9 +61,6 @@
 
 #include <string.h>
 
-#define _SV_SVDATA_CXX
-
-#ifndef REMOTE_APPSERVER
 #ifndef _SV_SVSYS_HXX
 #include <svsys.h>
 #endif
@@ -73,7 +70,6 @@
 #ifndef _SV_SALFRAME_HXX
 #include <salframe.hxx>
 #endif
-#endif
 
 #ifndef _VOS_MUTEX_HXX
 #include <vos/mutex.hxx>
@@ -110,9 +106,6 @@
 #include <wrkwin.hxx>
 #endif
 
-#ifndef _VCL_UNOWRAP_HXX
-#include <unowrap.hxx>
-#endif
 #ifndef _VCL_UNOHELP_HXX
 #include <unohelp.hxx>
 #endif
@@ -121,6 +114,10 @@
 #include <button.hxx> // for Button::GetStandardText
 #endif
 
+#ifndef _SV_SALIMESTATUS_HXX
+#include <salimestatus.hxx>
+#endif
+
 #ifndef _COM_SUN_STAR_LANG_XMULTISERVICEFACTORY_HPP_
 #include <com/sun/star/lang/XMultiServiceFactory.hpp>
 #endif
@@ -155,6 +153,14 @@ using namespace rtl;
 // static SV-Data
 ImplSVData* pImplSVData = &private_aImplSVData;
+
+SalSystem* ImplGetSalSystem()
+{
+    ImplSVData* pSVData = ImplGetSVData();
+    if( ! pSVData->mpSalSystem )
+        pSVData->mpSalSystem = pSVData->mpDefInst->CreateSalSystem();
+    return pSVData->mpSalSystem;
+}
 
 // static SharedLib SV-Data
 ImplSVShlData aImplSVShlData;
 
@@ -210,12 +210,6 @@ void ImplDeInitSVData()
     if( pSVData->maGDIData.mpFontSubstConfig )
         delete pSVData->maGDIData.mpFontSubstConfig;
 
-    if ( pSVData->mpUnoWrapper )
-    {
-        pSVData->mpUnoWrapper->Destroy();
-        pSVData->mpUnoWrapper = NULL;
-    }
-
     if ( pSVData->maAppData.mpMSFTempFileName )
     {
         if ( pSVData->maAppData.mxMSF.is() )
@@ -231,9 +225,6 @@ void ImplDeInitSVData()
         delete pSVData->maAppData.mpMSFTempFileName;
         pSVData->maAppData.mpMSFTempFileName = NULL;
     }
-#ifdef REMOTE_APPSERVER
-    delete pSVData->mpPrinterEnvironment;
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -241,7 +232,6 @@ void ImplDeInitSVData()
 void ImplDestroySVData()
 {
     ImplSVData** ppSVData = (ImplSVData**)GetAppData( SHL_SV );
-    ImplSVData*  pSVData = *ppSVData;
 
     // delete global sharedlib data
     // ...
@@ -402,17 +392,17 @@ bool ImplInitAccessBridge(BOOL bAllowCan
 
     catch(::com::sun::star::java::JavaNotConfiguredException e)
     {
-        ResMgr *pResMgr = bErrorMessage ? ImplGetResMgr() : NULL;
-        
-        if( pResMgr && bAllowCancel )
+        if( bErrorMessage && bAllowCancel )
         {
+            ResMgr *pResMgr = ImplGetResMgr();
+
             String aTitle(ResId(SV_ACCESSERROR_JAVA_NOT_CONFIGURED, pResMgr));
             String aMessage(ResId(SV_ACCESSERROR_JAVA_MSG, pResMgr));
 
             aMessage += String(" ", 1, RTL_TEXTENCODING_ASCII_US);
             aMessage += String(ResId(SV_ACCESSERROR_OK_CANCEL_MSG, pResMgr));
 
-            int ret = ImplShowNativeMessageBox(
+            int ret = ImplGetSalSystem()->ShowNativeMessageBox(
                 aTitle,
                 ReplaceJavaErrorMessages(aMessage),
                 SALSYSTEM_SHOWNATIVEMSGBOX_BTNCOMBI_OK_CANCEL,
@@ -428,17 +418,17 @@ bool ImplInitAccessBridge(BOOL bAllowCan
 
     catch(::com::sun::star::java::JavaVMCreationFailureException e)
     {
-        ResMgr *pResMgr = bErrorMessage ? ImplGetResMgr() : NULL;
-        
-        if( pResMgr && bAllowCancel )
+        if( bErrorMessage && bAllowCancel )
         {
+            ResMgr *pResMgr = ImplGetResMgr();
+
             String aTitle(ResId(SV_ACCESSERROR_FAULTY_JAVA, pResMgr));
             String aMessage(ResId(SV_ACCESSERROR_JAVA_MSG, pResMgr));
 
             aMessage += String(" ", 1, RTL_TEXTENCODING_ASCII_US);
             aMessage += String(ResId(SV_ACCESSERROR_OK_CANCEL_MSG, pResMgr));
 
-            int ret = ImplShowNativeMessageBox(
+            int ret = ImplGetSalSystem()->ShowNativeMessageBox(
                 aTitle,
                 ReplaceJavaErrorMessages(aMessage),
                 SALSYSTEM_SHOWNATIVEMSGBOX_BTNCOMBI_OK_CANCEL,
@@ -454,17 +444,17 @@ bool ImplInitAccessBridge(BOOL bAllowCan
 
     catch(::com::sun::star::java::MissingJavaRuntimeException e)
     {
-        ResMgr *pResMgr = bErrorMessage ? ImplGetResMgr() : NULL;
-        
-        if( pResMgr && bAllowCancel )
+        if( bErrorMessage && bAllowCancel )
         {
+            ResMgr *pResMgr = ImplGetResMgr();
+
             String aTitle(ResId(SV_ACCESSERROR_MISSING_JAVA, pResMgr));
             String aMessage(ResId(SV_ACCESSERROR_JAVA_MSG, pResMgr));
 
             aMessage += String(" ", 1, RTL_TEXTENCODING_ASCII_US);
             aMessage += String(ResId(SV_ACCESSERROR_OK_CANCEL_MSG, pResMgr));
 
-            int ret = ImplShowNativeMessageBox(
+            int ret = ImplGetSalSystem()->ShowNativeMessageBox(
                 aTitle,
                 ReplaceJavaErrorMessages(aMessage),
                 SALSYSTEM_SHOWNATIVEMSGBOX_BTNCOMBI_OK_CANCEL,
@@ -480,17 +470,17 @@ bool ImplInitAccessBridge(BOOL bAllowCan
 
     catch(::com::sun::star::java::JavaDisabledException e)
     {
-        ResMgr *pResMgr = bErrorMessage ? ImplGetResMgr() : NULL;
-        
-        if( pResMgr && bAllowCancel )
+        if( bErrorMessage && bAllowCancel )
         {
+            ResMgr *pResMgr = ImplGetResMgr();
+
             String aTitle(ResId(SV_ACCESSERROR_JAVA_DISABLED, pResMgr));
             String aMessage(ResId(SV_ACCESSERROR_JAVA_MSG, pResMgr));
 
             aMessage += String(" ", 1, RTL_TEXTENCODING_ASCII_US);
             aMessage += String(ResId(SV_ACCESSERROR_OK_CANCEL_MSG, pResMgr));
 
-            int ret = ImplShowNativeMessageBox(
+            int ret = ImplGetSalSystem()->ShowNativeMessageBox(
                 aTitle,
                 ReplaceJavaErrorMessages(aMessage),
                 SALSYSTEM_SHOWNATIVEMSGBOX_BTNCOMBI_OK_CANCEL,
@@ -507,10 +497,10 @@ bool ImplInitAccessBridge(BOOL bAllowCan
 
     catch(::com::sun::star::uno::RuntimeException e)
     {
-        ResMgr *pResMgr = bErrorMessage ? ImplGetResMgr() : NULL;
-        
-        if( pResMgr )
+        if( bErrorMessage )
         {
+            ResMgr *pResMgr = ImplGetResMgr();
+
             String aTitle;
             String aMessage(ResId(SV_ACCESSERROR_BRIDGE_MSG, pResMgr));
 
@@ -533,7 +523,7 @@ bool ImplInitAccessBridge(BOOL bAllowCan
                     aMessage += String(" ", 1, RTL_TEXTENCODING_ASCII_US);
                     aMessage += String(ResId(SV_ACCESSERROR_OK_CANCEL_MSG, pResMgr));
 
-                    int ret = ImplShowNativeMessageBox(
+                    int ret = ImplGetSalSystem()->ShowNativeMessageBox(
                         aTitle, 
                         ReplaceJavaErrorMessages(aMessage), 
                         SALSYSTEM_SHOWNATIVEMSGBOX_BTNCOMBI_OK_CANCEL,
@@ -547,7 +537,7 @@ bool ImplInitAccessBridge(BOOL bAllowCan
                 {
                     // The user tried to activate accessibility support using Tools-Options dialog,
                     // so we don't offer to terminate here !
-                    ImplShowNativeMessageBox(
+                    ImplGetSalSystem()->ShowNativeMessageBox(
                         aTitle, 
                         ReplaceJavaErrorMessages(aMessage), 
                         SALSYSTEM_SHOWNATIVEMSGBOX_BTNCOMBI_OK,
@@ -567,8 +557,6 @@ bool ImplInitAccessBridge(BOOL bAllowCan
 
 // -----------------------------------------------------------------------
 
-#ifndef REMOTE_APPSERVER
-
 Window* ImplFindWindow( const SalFrame* pFrame, Point& rSalFramePos )
 {
     ImplSVData* pSVData = ImplGetSVData();
@@ -588,18 +576,3 @@ Window* ImplFindWindow( const SalFrame* 
 
     return NULL;
 }
-
-#endif
-
-// -----------------------------------------------------------------------
-
-#ifdef REMOTE_APPSERVER
-
-void rvpExceptionHandler()
-{
-#ifdef DBG_UTIL
-    fprintf( stderr, "RVP exception caught!\n" );
-#endif
-}
-
-#endif
Index: vcl/source/app/svmain.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/svmain.cxx,v
retrieving revision 1.41
retrieving revision 1.49
diff -u -p -u -r1.41 -r1.49
--- vcl/source/app/svmain.cxx	11 Apr 2003 17:28:07 -0000	1.41
+++ vcl/source/app/svmain.cxx	28 May 2004 13:32:57 -0000	1.49
@@ -59,8 +59,6 @@
  *
  ************************************************************************/
 
-#define _SV_SVMAIN_CXX
-
 #ifdef WNT
 #include <tools/prewin.h>
 #include <process.h>    // for _beginthreadex
@@ -76,9 +74,6 @@
 #include <svunx.h>
 #endif
 
-#ifndef _SV_SALDATA_HXX
-#include <saldata.hxx>
-#endif
 #ifndef _SV_SVSYS_HXX
 #include <svsys.h>
 #endif
@@ -128,7 +123,7 @@
 #include <image.hxx>
 #endif
 #ifndef _SV_RESMGR_HXX
-#include <resmgr.hxx>
+#include <tools/resmgr.hxx>
 #endif
 #ifndef _SV_ACCMGR_HXX
 #include <accmgr.hxx>
@@ -148,6 +143,18 @@
 #ifndef _SV_SETTINGS_HXX
 #include <settings.hxx>
 #endif
+#ifndef _VCL_UNOWRAP_HXX
+#include <unowrap.hxx>
+#endif
+#ifndef _SV_SALSYS_HXX
+#include <salsys.hxx>
+#endif
+#ifndef _SV_SALTIMER_HXX
+#include <saltimer.hxx>
+#endif
+#ifndef _SV_SALIMESTATUS_HXX
+#include <salimestatus.hxx>
+#endif
 
 #include <vos/process.hxx>
 #include <osl/file.hxx>
@@ -165,36 +175,9 @@ using namespace ::rtl;
 using namespace ::com::sun::star::uno;
 using namespace ::com::sun::star::lang;
 
-#ifdef REMOTE_APPSERVER
-#include <config.hxx>
-#include <ooffice.hxx>
-#include <rversion.h>
-#include <xevthdl.hxx>
-#include <rmevents.hxx>
-#include <rmprint.hxx>
-#include <outdev.h>
-#include <vos/mutex.hxx>
-#include <vos/timer.hxx>
-#include "rvp.hxx"
-#include <unotools/atom.hxx>
-
-
-#include <com/sun/star/portal/client/XRmStatus.hpp>
-#include <com/sun/star/portal/client/XRmSync.hpp>
-
-using namespace ::cppu;
-using namespace ::com::sun::star::portal::client;
-
-#ifdef UNX
-void SalData::Init (int *pIPointer, char *pCPointer[] )
-{};
-#endif /* UNX */
-
-#endif /* REMOTE_APPSERVER */
-
 #include <fontcfg.hxx>
 
-#pragma hdrstop
+
 
 // =======================================================================
 
@@ -252,11 +235,7 @@ public:
             }
             bIn = FALSE;
 
-#ifndef REMOTE_APPSERVER
             return vos::OSignalHandler::TAction_CallNextHandler;
-#else
-            return vos::OSignalHandler::TAction_KillApplication;
-#endif
         }
     }
 
@@ -312,23 +291,7 @@ BOOL InitVCL( const ::com::sun::star::un
     {
         pOwnSvApp = new Application_Impl();
     }
-#ifndef REMOTE_APPSERVER
     InitSalMain();
-#endif
-
-#ifdef WNT
-    // remember data, copied from WinMain
-    SalData* pData = GetAppSalData();
-    if ( pData )    // Im AppServer NULL
-    {
-        STARTUPINFO aSI;
-        aSI.cb = sizeof( aSI );
-        GetStartupInfo( &aSI );
-        pData->mhInst                   = GetModuleHandle( NULL );
-        pData->mhPrevInst               = NULL;
-        pData->mnCmdShow                = aSI.wShowWindow;
-    }
-#endif
 
     /*AllSettings aAS;
     Application::SetSettings( aAS );// ???
@@ -347,19 +310,13 @@ BOOL InitVCL( const ::com::sun::star::un
     vos::OStartupInfo   aStartInfo;
     rtl::OUString       aExeFileName;
 
-#ifdef REMOTE_APPSERVER
-    // create condition now to avoid race
-    pSVData->mpStartUpCond = new vos::OCondition;
-#endif
 
     // Sal initialisieren
-#ifndef REMOTE_APPSERVER
     RTL_LOGFILE_CONTEXT_TRACE( aLog, "{ ::CreateSalInstance" );
     pSVData->mpDefInst = CreateSalInstance();
     if ( !pSVData->mpDefInst )
         return FALSE;
     RTL_LOGFILE_CONTEXT_TRACE( aLog, "} ::CreateSalInstance" );
-#endif
 
 	// Initialize application instance (should be done after initialization of VCL SAL part)
     if( pSVData->mpApp )
@@ -367,24 +324,6 @@ BOOL InitVCL( const ::com::sun::star::un
         // soffice/sfx implementation creates the global service manager
         pSVData->mpApp->Init();
 
-#ifdef REMOTE_APPSERVER
-    {
-    Reference< XMultiServiceFactory > rSMgr = ::comphelper::getProcessServiceFactory();
-
-    pSVData->mpRmEventQueue = new RmEventQueue;
-    pSVData->mpWindowObjectMutex = new vos::OMutex;
-    pSVData->maAppData.mpSolarMutex = new ImplRemoteYieldMutex;
-
-    pSVData->maGDIData.mpScreenFontList   = new ImplDevFontList;
-    pSVData->maGDIData.mpScreenFontCache  = new ImplFontCache( FALSE );
-
-    pSVData->maAppData.mpSolarMutex->acquire(); // mutex should be aquired for startup
-
-//    ImplInitRemotePrinterList();
-    }
-
-#endif
-
     // Den AppFileName gleich holen und absolut machen, bevor das
     // WorkingDirectory sich aendert...
     aStartInfo.getExecutableFile( aExeFileName );
@@ -418,11 +359,5 @@ void DeInitVCL()
        pSVData->maAppData.mpAccessList = NULL;
    }
 
-    // globale daten wieder freigeben
-#ifndef REMOTE_APPSERVER
-    SalSound::Release();
-    SalOpenGL::Release();
-#endif
-
     // free global data
     delete pSVData->maGDIData.mpGrfConverter; 
@@ -499,79 +424,11 @@ void DeInitVCL()
         pSVData->mpResMgr = NULL;
     }
 
-#ifdef REMOTE_APPSERVER
-    if( pSVData->mxClientFactory.is() )
-    {
-        try
-        {
-            pSVData->mxClientFactory = Reference < XMultiServiceFactory >();
-        }
-        catch(::com::sun::star::uno::Exception&)
-        {
-        }
-    }
-
-    if( pSVData->mxMultiFactory.is() )
-    {
-        try
-        {
-            pSVData->mxMultiFactory.clear();
-        }
-        catch(::com::sun::star::uno::Exception&)
-        {
-        }
-
-    }
-    CORmStarOffice::eraseRemoteCaches();
-    if( pSVData->mxStatus.is() )
-    {
-        try
-        {
-            // #93174 DO NOT SYNC HERE - 
-            // the client's sync object might already be destructed by the ORmRemoteClientFactory destructor
-            // CHECK_FOR_RVPSYNC_NORMAL()
-
-            delete pSVData->mpRVPNormalSync;
-            delete pSVData->mpRVPSoundSync;
-            delete pSVData->mpAtoms;
-
-            pSVData->mxStatus->Quit();
-            pSVData->mxStatus = Reference < ::com::sun::star::portal::client::XRmStatus >();
-        }
-        catch(::com::sun::star::uno::Exception&)
-        {
-        }
-    }
-
-    if( pSVData->mpApp )
-        // call deinit to deinitialize application class
-        // soffice/sfx implementation disposes the global service manager
-        // Warning: After this call you can't call uno services
-        pSVData->mpApp->DeInit();
-
-    pSVData->maAppData.mpSolarMutex->release();
-    delete pSVData->maAppData.mpSolarMutex;
-    pSVData->maAppData.mpSolarMutex = NULL;
-    pSVData->mpOTimer->release();
-    pSVData->mpOTimer = NULL;
-    delete pSVData->mpRmEventQueue;
-    pSVData->mpRmEventQueue = NULL;
-    delete pSVData->mpWindowObjectMutex;
-    pSVData->mpWindowObjectMutex = NULL;
-
-    if ( pSVData->mpKeyNames )
-    {
-        for( String* pObj = pSVData->mpKeyNames->First(); pObj; pObj = pSVData->mpKeyNames->Next() )
-            delete pObj;
-        delete pSVData->mpKeyNames;
-    }
-#else
     if( pSVData->mpApp )
         // call deinit to deinitialize application class
         // soffice/sfx implementation disposes the global service manager
         // Warning: After this call you can't call uno services
         pSVData->mpApp->DeInit();
-#endif
 
     if ( pSVData->maAppData.mpSettings )
     {
@@ -624,6 +481,13 @@ void DeInitVCL()
     if ( pSVData->maAppData.mpFirstEventHook )
         ImplFreeEventHookData();
 
+	// #114285# Moved here from ImplDeInitSVData...
+    if ( pSVData->mpUnoWrapper )
+    {
+        pSVData->mpUnoWrapper->Destroy();
+        pSVData->mpUnoWrapper = NULL;
+    }
+
     ImplDeletePrnQueueList();
     delete pSVData->maGDIData.mpScreenFontList;
     pSVData->maGDIData.mpScreenFontList = NULL;
@@ -633,16 +497,22 @@ void DeInitVCL()
 
     ResMgr::DestroyAllResMgr();
 
+	// destroy all Sal interfaces before destorying the instance
+	// and thereby unloading the plugin
+	delete pSVData->mpImeStatus;
+	pSVData->mpImeStatus = NULL;
+	delete pSVData->mpSalSystem;
+	pSVData->mpSalSystem = NULL;
+	delete pSVData->mpSalTimer;
+	pSVData->mpSalTimer = NULL;
+
     // Sal deinitialisieren
-#ifndef REMOTE_APPSERVER
     DestroySalInstance( pSVData->mpDefInst );
-#endif
 
     DeInitTools();
 
-#ifndef REMOTE_APPSERVER
     DeInitSalMain();
-#endif
+
     if( pOwnSvApp )
     {
         delete pOwnSvApp;
Index: vcl/source/app/timer.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/timer.cxx,v
retrieving revision 1.1.1.1
retrieving revision 1.4
diff -u -p -u -r1.1.1.1 -r1.4
--- vcl/source/app/timer.cxx	18 Sep 2000 17:05:35 -0000	1.1.1.1
+++ vcl/source/app/timer.cxx	6 Jan 2004 13:15:29 -0000	1.4
@@ -59,19 +59,13 @@
  *
  ************************************************************************/
 
-#define _SV_TIMER_CXX
-
 #ifndef _SV_SVSYS_HXX
 #include <svsys.h>
 #endif
 
-#ifndef REMOTE_APPSERVER
 #ifndef _SV_SALTIMER_HXX
 #include <saltimer.hxx>
 #endif
-#else
-#include <rmevents.hxx>
-#endif
 
 #ifndef _TIME_HXX
 #include <tools/time.hxx>
@@ -83,6 +77,9 @@
 #ifndef _SV_SVAPP_HXX
 #include <svapp.hxx>
 #endif
+#ifndef _SV_SALINST_HXX
+#include <salinst.hxx>
+#endif
 
 #define protected public
 #ifndef _SV_TIMER_HXX
@@ -90,7 +87,7 @@
 #endif
 #undef protected
 
-#pragma hdrstop
+
 
 // =======================================================================
 
@@ -134,12 +131,8 @@ void ImplDeInitTimer()
 
 		pSVData->mpFirstTimerData	= NULL;
 		pSVData->mnTimerPeriod		= 0;
-#ifndef REMOTE_APPSERVER
-		SalTimer::Stop();
-#else
-		if ( pSVData->mpOTimer )
-			pSVData->mpOTimer->StopTimer();
-#endif
+        delete pSVData->mpSalTimer;
+        pSVData->mpSalTimer = NULL;
 	}
 }
 
@@ -150,24 +143,11 @@ static void ImplStartTimer( ImplSVData* 
 	if ( !nMS )
 		nMS = 1;
 
-#ifndef REMOTE_APPSERVER
 	if ( nMS != pSVData->mnTimerPeriod )
 	{
 		pSVData->mnTimerPeriod = nMS;
-		SalTimer::Start( nMS );
+		pSVData->mpSalTimer->Start( nMS );
 	}
-#else
-	pSVData->mnTimerPeriod = nMS;
-	if ( !pSVData->mpOTimer )
-	{
-		pSVData->mpOTimer = new VclOTimer;
-		pSVData->mpOTimer->acquire();
-	}
-	else
-		pSVData->mpOTimer->StopTimer();
-	pSVData->mpOTimer->setRemainingTime( nMS, 0 );
-	pSVData->mpOTimer->StartTimer();
-#endif
 }
 
 // -----------------------------------------------------------------------
@@ -275,12 +255,7 @@ void ImplTimerCallbackProc()
 	// Wenn keine Timer mehr existieren, dann Clock loeschen
 	if ( !pSVData->mpFirstTimerData )
 	{
-#ifndef REMOTE_APPSERVER
-		SalTimer::Stop();
-#else
-		if ( pSVData->mpOTimer )
-			pSVData->mpOTimer->StopTimer();
-#endif
+        pSVData->mpSalTimer->Stop();
 		pSVData->mnTimerPeriod = MAX_TIMER_PERIOD;
 	}
 	else
@@ -292,49 +267,6 @@ void ImplTimerCallbackProc()
 
 // =======================================================================
 
-#ifdef REMOTE_APPSERVER
-
-VclOTimer::VclOTimer() :
-	maTimeoutHdl( LINK( this, VclOTimer, Timeout ) )
-{
-	mbSend = FALSE;
-}
-
-void SAL_CALL VclOTimer::onShot()
-{
-	stop(); // start wird durch ImplTimerCallbackProc() gerufen
-	if ( !mbSend )
-	{
-		mbSend = TRUE;
-		if ( !Application::PostUserEvent( maTimeoutHdl ) )
-		{
-			mbSend = FALSE;
-			start();
-		}
-	}
-}
-
-IMPL_LINK( VclOTimer, Timeout, void*, EMPTYARG )
-{
-	mbSend = FALSE;
-	ImplTimerCallbackProc();
-	return 0;
-}
-
-void VclOTimer::StartTimer()
-{
-	start();
-}
-
-void VclOTimer::StopTimer()
-{
-	stop();
-}
-
-#endif
-
-// =======================================================================
-
 Timer::Timer()
 {
 	mpTimerData 	= NULL;
@@ -402,9 +334,11 @@ void Timer::Start()
 		if ( !pSVData->mpFirstTimerData )
 		{
 			pSVData->mnTimerPeriod = MAX_TIMER_PERIOD;
-#ifndef REMOTE_APPSERVER
-			SalTimer::SetCallback( ImplTimerCallbackProc );
-#endif
+            if( ! pSVData->mpSalTimer )
+            {
+                pSVData->mpSalTimer = pSVData->mpDefInst->CreateSalTimer();
+                pSVData->mpSalTimer->SetCallback( ImplTimerCallbackProc );
+            }
 		}
 
 		// insert timer and start
Index: vcl/source/app/unohelp.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/app/unohelp.cxx,v
retrieving revision 1.27
retrieving revision 1.29
diff -u -p -u -r1.27 -r1.29
--- vcl/source/app/unohelp.cxx	24 Apr 2003 16:31:14 -0000	1.27
+++ vcl/source/app/unohelp.cxx	1 Dec 2003 13:09:39 -0000	1.29
@@ -59,7 +59,7 @@
  *
  ************************************************************************/
 
-#pragma hdrstop
+
 
 #include <unohelp.hxx>
 
@@ -118,8 +118,8 @@ using namespace ::rtl;
 
 struct VCLRegServiceInfo
 {
-	sal_Char*	pLibName;
-	sal_Bool	bHasSUPD;
+	const sal_Char*		pLibName;
+	sal_Bool			bHasSUPD;
 };
 
 static VCLRegServiceInfo aVCLComponentsArray[] =
