Index: fpicker/prj/build.lst
===================================================================
RCS file: /cvs/gsl/fpicker/prj/build.lst,v
retrieving revision 1.6
Index: fpicker/prj/build.lst
===================================================================
--- fpicker/prj/build.lst.orig	2004-07-31 19:07:38.510660640 +0200
+++ fpicker/prj/build.lst	2004-07-31 19:13:36.266273520 +0200
@@ -1,5 +1,8 @@
 fp	fpicker	:	rdbmaker svtools NULL
+fp	fpicker\source\unx\gnome		nmake	-	u	fp_gnome_filepicker NULL
+fp	fpicker\source\unx\kde_unx		nmake	-	u	fp_unx_common NULL
+fp	fpicker\source\unx\kde				nmake	-	u	fp_unx_kde_filepicker NULL
 fp	fpicker\source\win32\filepicker		nmake	-	w	fp_win32_filepicker NULL
 fp	fpicker\source\win32\folderpicker	nmake	-	w	fp_win32_folderpicker NULL
 fp  fpicker\source\win32\misc			nmake	-	w	fp_win32_misc fp_win32_filepicker.w fp_win32_folderpicker.w NULL
-fp	fpicker\util						nmake	-	w	fp_util fp_win32_filepicker.w fp_win32_misc.w fp_win32_folderpicker.w NULL
+fp	fpicker\util				nmake	-	all	fp_util fp_gnome_filepicker.u fp_unx_common.u fp_unx_kde_filepicker.u fp_win32_filepicker.w fp_win32_misc.w fp_win32_folderpicker.w NULL
Index: fpicker/prj/d.lst
===================================================================
--- fpicker/prj/d.lst.orig	2004-07-31 19:07:38.523658664 +0200
+++ fpicker/prj/d.lst	2004-07-31 19:13:36.267273368 +0200
@@ -1,4 +1,6 @@
 ..\%__SRC%\bin\*.dll %_DEST%\bin%_EXT%\*.dll
+..\%__SRC%\lib\* %_DEST%\lib%_EXT%\*
+..\%__SRC%\bin\kdefilepicker %_DEST%\bin%_EXT%\kdefilepicker
 
 ..\source\win32\filepicker\*.xml %_DEST%\xml%_EXT%\*.xml
 ..\source\win32\folderpicker\*.xml %_DEST%\xml%_EXT%\*.xml
Index: fpicker/util/makefile.mk
===================================================================
--- fpicker/util/makefile.mk.orig	2002-08-26 16:03:30.000000000 +0200
+++ fpicker/util/makefile.mk	2004-08-12 11:44:31.777392976 +0200
@@ -75,15 +75,17 @@ USE_LDUMP2=TRUE
 
 # --- fps dynlib ----------------------------------------------
 
-.IF "$(GUI)"=="WNT"
-
-SHL1TARGET=$(TARGET1)
+.IF "$(GUI)"=="WNT" || "$(GUIBASE)" == "unx"
 
-SHL1STDLIBS=$(CPPULIB)\
+COMMON_LIBS=$(CPPULIB)\
 			$(CPPUHELPERLIB)\
 			$(SALLIB)\
 			$(VCLLIB)\
-			$(TOOLSLIB)\
+			$(TOOLSLIB)
+
+.IF "$(GUI)"=="WNT"
+SHL1TARGET=$(TARGET1)
+SHL1STDLIBS=		$(COMMON_LIBS) \
 			uwinapi.lib \
 			advapi32.lib \
 			shell32.lib\
@@ -94,53 +96,89 @@ SHL1STDLIBS=$(CPPULIB)\
 			kernel32.lib\
 			comsupp.lib\
 			oleaut32.lib
+SHL2STDLIBS=		$(COMMON_LIBS) \
+			uwinapi.lib \
+			advapi32.lib \
+			ole32.lib\
+			gdi32.lib\
+			shell32.lib\
+			comsupp.lib\
+			oleaut32.lib
 
-SHL1DEPN=
 SHL1IMPLIB=i$(SHL1TARGET)
-
 SHL1LIBS=$(SLB)$/fps.lib\
 		 $(SLB)$/utils.lib
-
-SHL1OBJS=$(SLOFILES)
-			
 SHL1RES=$(RES)$/$(TARGET1).res
 SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+DEF1NAME=$(SHL1TARGET)
+
+.ELSE # "$(GUI)"=="WNT"
 
+.IF "$(ENABLE_GTK)" == "TRUE"
+SHL1TARGET=fps_gnome
+SHL1LIBS=$(SLB)$/fps_gnome.lib
+SHL1STDLIBS= $(COMMON_LIBS) `pkg-config --libs gtk+-2.0`
+SHL2STDLIBS= $(SHL1STDLIBS)
 DEF1NAME=$(SHL1TARGET)
+.ENDIF # "$(ENABLE_GTK)" == "TRUE"
+
+.IF "$(ENABLE_KDE)" == "TRUE"
+SHL3TARGET=fps_kde
+SHL3STDLIBS=$(COMMON_LIBS) \
+			$(SVTOOLLIB)
+SHL3DEPN=
+SHL3IMPLIB=i$(SHL1TARGET)
+SHL3LIBS=$(SLB)$/fps_kde.lib
+
+SHL3OBJS=$(SLOFILES)
+			
+#SHL3RES=$(RES)$/$(SHL3TARGET).res
+SHL3DEF=$(MISC)$/$(SHL3TARGET).def
+
+DEF3NAME=$(SHL3TARGET)
+DEF3EXPORTFILE=	exports.dxp
+
+# kdefilepicker binary
+
+APP4TARGET=kdefilepicker
+
+APP4STDLIBS=\
+			$(SALLIB) \
+			$(WIDGETSET_KDE_LIBS) -lkio
+
+APP4OBJS=\
+			$(SLO)$/kdecommandthread.obj \
+			$(SLO)$/kdefilepicker.obj \
+			$(SLO)$/kdefilepicker.moc.obj \
+			$(SLO)$/kdefpmain.obj \
+			$(SLO)$/kdemodalityfilter.obj
+
+.ENDIF # "$(ENABLE_KDE)" == "TRUE"
+
+.ENDIF
+
+SHL1DEPN=
+SHL1OBJS=$(SLOFILES)
+
 DEF1EXPORTFILE=	exports.dxp
 
 # --- fop dynlib --------------------------------------------------
 
 SHL2TARGET=$(TARGET2)
 
-SHL2STDLIBS=$(CPPULIB)\
-			$(CPPUHELPERLIB)\
-			$(SALLIB)\
-			$(TOOLSLIB)\
-			$(VCLLIB)\
-			uwinapi.lib \
-			advapi32.lib \
-			ole32.lib\
-			gdi32.lib\
-			shell32.lib\
-			comsupp.lib\
-			oleaut32.lib
-
 SHL2DEPN=
-SHL2IMPLIB=i$(SHL2TARGET)
-
-SHL2LIBS=\
-	$(SLB)$/fop.lib\
-	$(SLB)$/utils.lib
-
+SHL2IMPLIB=$(SHL1IMPLIB)
+SHL2LIBS=$(SHL1LIBS)
 SHL2OBJS=$(SLOFILES) 
 SHL2DEF=$(MISC)$/$(SHL2TARGET).def
 
 DEF2NAME=$(SHL2TARGET)
 DEF2EXPORTFILE=	exports.dxp
 
-
-# "$(GUI)"=="WNT"
+# "$(GUI)"=="WNT" || "$(GUIBASE)"=="unx"
+.ELSE
+dummy:
+    @echo "Nothing to build for OS $(OS)"
 .ENDIF			
 
 
Index: fpicker/source/unx/gnome/makefile.mk
===================================================================
--- /dev/null	2004-08-25 23:04:59.000000000 +0530
+++ fpicker/source/unx/gnome/makefile.mk	2004-09-10 14:33:32.000000000 +0530
@@ -0,0 +1,103 @@
+#*************************************************************************
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to the terms of
+#   either of the following licenses
+#
+#          - GNU Lesser General Public License Version 2.1
+#          - Sun Industry Standards Source License Version 1.1
+#
+#   Sun Microsystems Inc., October, 2000
+#
+#   GNU Lesser General Public License Version 2.1
+#   =============================================
+#   Copyright 2000 by Sun Microsystems, Inc.
+#   901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#   This library is free software; you can redistribute it and/or
+#   modify it under the terms of the GNU Lesser General Public
+#   License version 2.1, as published by the Free Software Foundation.
+#
+#   This library is distributed in the hope that it will be useful,
+#   but WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#   Lesser General Public License for more details.
+#
+#   You should have received a copy of the GNU Lesser General Public
+#   License along with this library; if not, write to the Free Software
+#   Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#   MA  02111-1307  USA
+#
+#
+#   Sun Industry Standards Source License Version 1.1
+#   =================================================
+#   The contents of this file are subject to the Sun Industry Standards
+#   Source License Version 1.1 (the "License"); You may not use this file
+#   except in compliance with the License. You may obtain a copy of the
+#   License at http://www.openoffice.org/license.html.
+#
+#   Software provided under this License is provided on an "AS IS" basis,
+#   WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING,
+#   WITHOUT LIMITATION, WARRANTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+#   MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+#   See the License for the specific provisions governing your rights and
+#   obligations concerning the Software.
+#
+#   The Initial Developer of the Original Code is: Sun Microsystems, Inc.
+#
+#   Copyright: 2000 by Sun Microsystems, Inc.
+#
+#   All Rights Reserved.
+#
+#   Contributor(s): _______________________________________
+#
+#
+#
+#*************************************************************************
+
+PRJ=..$/..$/..
+
+PRJNAME=fpicker
+TARGET=fps_gnome
+#LIBTARGET=NO
+ENABLE_EXCEPTIONS=TRUE
+
+# --- Settings -----------------------------------------------------
+
+.INCLUDE :  settings.mk
+
+# ------------------------------------------------------------------
+
+.IF "$(ENABLE_GTK)" != "TRUE"
+
+dummy:
+	@echo "Nothing to build. GUIBASE == $(GUIBASE), ENABLE_GTK == $(ENABLE_GTK)"
+
+.ELSE # we build for GNOME
+
+#.INCLUDE : ..$/..$/cppumaker.mk
+
+CFLAGS+= $(WIDGETSET_GTK_CFLAGS)
+#CFLAGS+=`pkg-config --cflags gtk+-2.0`
+
+# --- Files --------------------------------------------------------
+
+SLOFILES =\
+		$(SLO)$/SalGtkPicker.obj				\
+		$(SLO)$/SalGtkFilePicker.obj			\
+		$(SLO)$/SalGtkFolderPicker.obj			\
+		$(SLO)$/resourceprovider.obj			\
+        $(SLO)$/asynceventnotifier.obj          \
+        $(SLO)$/filepickereventnotification.obj \
+		$(SLO)$/FPentry.obj
+
+.ENDIF # "$(ENABLE_GTK)" != "TRUE"
+
+# --- Targets ------------------------------------------------------
+
+.INCLUDE :	target.mk
