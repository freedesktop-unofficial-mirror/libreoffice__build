--- vcl/unx/kde/kdedata.cxx	2005-03-23 14:04:08.745017139 +0100
+++ vcl/unx/kde/kdedata.cxx	2005-03-23 14:04:02.258136858 +0100
@@ -65,6 +65,7 @@
 #include <kaboutdata.h>
 #include <kapplication.h>
 #include <kcmdlineargs.h>
+#include <kstartupinfo.h>
 #include <qpaintdevice.h>
 #undef Region
 
@@ -173,8 +174,25 @@ void KDEXLib::Init()
 
 	KCmdLineArgs::init( nFakeArgc, pFakeArgv, kAboutData );
 
+	// Do not let KApplication eat the DESKTOP_STARTUP_ID
+	char *pDesktopStartupId = NULL;
+	char *pEnv = getenv( "DESKTOP_STARTUP_ID" );
+	if ( pEnv )
+	{
+		pDesktopStartupId = strdup( pEnv );
+		unsetenv( "DESKTOP_STARTUP_ID" );
+	}
+
 	KApplication::disableAutoDcopRegistration();
+	KStartupInfo::disableAutoAppStartedSending();
 	new KApplication();
+	
+	// Now set DESKTOP_STARTUP_ID for the VCL initialization
+	if ( pDesktopStartupId )
+	{
+		setenv( "DESKTOP_STARTUP_ID", pDesktopStartupId, 1 );
+		free( pDesktopStartupId );
+	}
 
     Display* pDisp = QPaintDevice::x11AppDisplay();
 	XVisualInfo aVI;
