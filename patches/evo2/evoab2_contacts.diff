--- /dev/null	2004-06-16 06:40:55.000000000 -0700
+++ connectivity/source/drivers/evoab1.5/NEvoContacts.hxx	2004-07-30 11:19:47.000000000 -0700
@@ -0,0 +1,331 @@
+#ifndef _CONNECTIVITY_EVOAB_EVOCONTACTS_HXX_
+#define _CONNECTIVITY_EVOAB_EVOCONTACTS_HXX_
+
+#define COMMA_SEPARATOR ","
+#define NOMAP -1
+
+
+#ifndef _RTL_USTRING_HXX_
+#include <rtl/ustring.hxx>
+#endif
+
+#ifndef _CONNECTIVITY_EVOAB_DEBUG_HXX_
+#include "NDebug.hxx"
+#endif
+
+#include <vector>
+// todo in place of string use rtl string 
+#include <string>
+#include <iostream>
+using namespace std;
+
+extern "C"
+{
+#include <bonobo/bonobo-main.h>
+#include <stdlib.h>
+#include <string.h>
+#include <libebook/e-book.h>
+
+
+enum _DeliveryAddressField
+{
+	DELIVERY_ADDRESS_STREET,
+	DELIVERY_ADDRESS_EXT,
+	DELIVERY_ADDRESS_CITY,
+	DELIVERY_ADDRESS_REGION,
+	DELIVERY_ADDRESS_CODE,
+	DELIVERY_ADDRESS_COUNTRY
+};
+
+enum _EContactFieldCSV
+{
+	E_CONTACT_CSV_FILE_AS,
+	E_CONTACT_CSV_FULL_NAME,
+	E_CONTACT_CSV_EMAIL,
+	E_CONTACT_CSV_PHONE_PRIMARY,
+	E_CONTACT_CSV_PHONE_ASSISTANT,
+	E_CONTACT_CSV_PHONE_BUSINESS,
+	E_CONTACT_CSV_PHONE_CALLBACK,
+	E_CONTACT_CSV_PHONE_COMPANY,
+	E_CONTACT_CSV_PHONE_HOME,
+	E_CONTACT_CSV_ORG,
+	/*E_CONTACT_CSV_ADDRESS_BUSINESS, */
+	E_CONTACT_CSV_ADDRESS_BUSINESS_STREET,
+	E_CONTACT_CSV_ADDRESS_BUSINESS_EXT,
+	E_CONTACT_CSV_ADDRESS_BUSINESS_CITY,
+	E_CONTACT_CSV_ADDRESS_BUSINESS_REGION,
+	E_CONTACT_CSV_ADDRESS_BUSINESS_POSTCODE,
+	E_CONTACT_CSV_ADDRESS_BUSINESS_COUNTRY,
+	/*E_CONTACT_CSV_ADDRESS_HOME, */
+	E_CONTACT_CSV_ADDRESS_HOME_STREET,
+	E_CONTACT_CSV_ADDRESS_HOME_EXT,
+	E_CONTACT_CSV_ADDRESS_HOME_CITY,
+	E_CONTACT_CSV_ADDRESS_HOME_REGION,
+	E_CONTACT_CSV_ADDRESS_HOME_POSTCODE,
+	E_CONTACT_CSV_ADDRESS_HOME_COUNTRY,
+	E_CONTACT_CSV_PHONE_MOBILE,
+	E_CONTACT_CSV_PHONE_CAR,
+	E_CONTACT_CSV_PHONE_BUSINESS_FAX,
+	E_CONTACT_CSV_PHONE_HOME_FAX,
+	E_CONTACT_CSV_PHONE_BUSINESS_2,
+	E_CONTACT_CSV_PHONE_HOME_2,
+	E_CONTACT_CSV_PHONE_ISDN,
+	E_CONTACT_CSV_PHONE_OTHER,
+	E_CONTACT_CSV_PHONE_OTHER_FAX,
+	E_CONTACT_CSV_PHONE_PAGER,
+	E_CONTACT_CSV_PHONE_RADIO,
+	E_CONTACT_CSV_PHONE_TELEX,
+	E_CONTACT_CSV_PHONE_TTYTDD,
+	/*E_CONTACT_CSV_ADDRESS_OTHER, */
+	E_CONTACT_CSV_ADDRESS_OTHER_STREET,
+	E_CONTACT_CSV_ADDRESS_OTHER_EXT,
+	E_CONTACT_CSV_ADDRESS_OTHER_CITY,
+	E_CONTACT_CSV_ADDRESS_OTHER_REGION,
+	E_CONTACT_CSV_ADDRESS_OTHER_POSTCODE,
+	E_CONTACT_CSV_ADDRESS_OTHER_COUNTRY,
+	E_CONTACT_CSV_EMAIL_2,
+	E_CONTACT_CSV_EMAIL_3,
+	E_CONTACT_CSV_URL,
+	E_CONTACT_CSV_ORG_UNIT,
+	E_CONTACT_CSV_OFFICE,
+	E_CONTACT_CSV_TITLE,
+	E_CONTACT_CSV_ROLE,
+	E_CONTACT_CSV_MANAGER,
+	E_CONTACT_CSV_ASSISTANT,
+	E_CONTACT_CSV_NICKNAME,
+	E_CONTACT_CSV_SPOUSE,
+	E_CONTACT_CSV_NOTE,
+	E_CONTACT_CSV_CALENDAR_URI,
+	E_CONTACT_CSV_FREEBUSY_URL,
+	/*E_CONTACT_CSV_ANNIVERSARY, */
+	E_CONTACT_CSV_ANNIVERSARY_YEAR,
+	E_CONTACT_CSV_ANNIVERSARY_MONTH,
+	E_CONTACT_CSV_ANNIVERSARY_DAY,
+	/*E_CONTACT_CSV_BIRTH_DATE, */
+	E_CONTACT_CSV_BIRTH_DATE_YEAR,
+	E_CONTACT_CSV_BIRTH_DATE_MONTH,
+	E_CONTACT_CSV_BIRTH_DATE_DAY,
+	E_CONTACT_CSV_MAILER,
+	E_CONTACT_CSV_NAME_OR_ORG,
+	E_CONTACT_CSV_CATEGORIES,
+	E_CONTACT_CSV_FAMILY_NAME,
+	E_CONTACT_CSV_GIVEN_NAME,
+	E_CONTACT_CSV_ADDITIONAL_NAME,
+	E_CONTACT_CSV_NAME_SUFFIX,
+	E_CONTACT_CSV_WANTS_HTML,
+	E_CONTACT_CSV_IS_LIST,
+	E_CONTACT_CSV_LAST
+};
+
+struct _EContactCSVFieldData
+{
+	gint csv_field;
+	gint contact_field;
+	gchar *csv_name;
+};
+
+typedef enum _DeliveryAddressField DeliveryAddressField;
+typedef enum _EContactFieldCSV EContactFieldCSV;
+typedef struct _EContactCSVFieldData EContactCSVFieldData;
+
+
+
+}
+
+static EContactCSVFieldData csv_field_data[] = {
+	{E_CONTACT_CSV_FILE_AS, E_CONTACT_FILE_AS, ""},
+	{E_CONTACT_CSV_FULL_NAME, E_CONTACT_CSV_FULL_NAME, ""},
+	{E_CONTACT_CSV_EMAIL, E_CONTACT_EMAIL_1, ""},
+	{E_CONTACT_CSV_PHONE_PRIMARY, E_CONTACT_PHONE_PRIMARY,
+	 ""},
+	{E_CONTACT_CSV_PHONE_ASSISTANT,
+	 E_CONTACT_PHONE_ASSISTANT, ""},
+	{E_CONTACT_CSV_PHONE_BUSINESS,
+	 E_CONTACT_PHONE_BUSINESS, ""},
+	{E_CONTACT_CSV_PHONE_CALLBACK,
+	 E_CONTACT_PHONE_CALLBACK, ""},
+	{E_CONTACT_CSV_PHONE_COMPANY, E_CONTACT_PHONE_COMPANY,
+	 ""},
+	{E_CONTACT_CSV_PHONE_HOME, E_CONTACT_PHONE_HOME, ""},
+	{E_CONTACT_CSV_ORG, E_CONTACT_ORG, ""},
+	/*E_CONTACT_CSV_ADDRESS_BUSINESS, */
+	{E_CONTACT_CSV_ADDRESS_BUSINESS_STREET, NOMAP,
+	 "Business Address"},
+	{E_CONTACT_CSV_ADDRESS_BUSINESS_EXT, NOMAP,
+	 "Business Address2"},
+	{E_CONTACT_CSV_ADDRESS_BUSINESS_CITY, NOMAP,
+	 "Business Address City"},
+	{E_CONTACT_CSV_ADDRESS_BUSINESS_REGION, NOMAP,
+	 "Business Address State"},
+	{E_CONTACT_CSV_ADDRESS_BUSINESS_POSTCODE, NOMAP,
+	 "Business Address PostCode"},
+	{E_CONTACT_CSV_ADDRESS_BUSINESS_COUNTRY, NOMAP,
+	 "Business Address Country"},
+	/*E_CONTACT_CSV_ADDRESS_HOME, */
+	{E_CONTACT_CSV_ADDRESS_HOME_STREET, NOMAP, "Home Address"},
+	{E_CONTACT_CSV_ADDRESS_HOME_EXT, NOMAP, "Home Address2"},
+	{E_CONTACT_CSV_ADDRESS_HOME_CITY, NOMAP, "Home Address City"},
+	{E_CONTACT_CSV_ADDRESS_HOME_REGION, NOMAP,
+	 "Home Address State"},
+	{E_CONTACT_CSV_ADDRESS_HOME_POSTCODE, NOMAP,
+	 "Home Address PostCode"},
+	{E_CONTACT_CSV_ADDRESS_HOME_COUNTRY, NOMAP,
+	 "Home Address Country"},
+	{E_CONTACT_CSV_PHONE_MOBILE, E_CONTACT_PHONE_MOBILE,
+	 ""},
+	{E_CONTACT_CSV_PHONE_CAR, E_CONTACT_PHONE_CAR, ""},
+	{E_CONTACT_CSV_PHONE_BUSINESS_FAX,
+	 E_CONTACT_PHONE_BUSINESS_FAX, ""},
+	{E_CONTACT_CSV_PHONE_HOME_FAX,
+	 E_CONTACT_PHONE_HOME_FAX, ""},
+	{E_CONTACT_CSV_PHONE_BUSINESS_2,
+	 E_CONTACT_PHONE_BUSINESS_2, ""},
+	{E_CONTACT_CSV_PHONE_HOME_2, E_CONTACT_PHONE_HOME_2,
+	 ""},
+	{E_CONTACT_CSV_PHONE_ISDN, E_CONTACT_PHONE_ISDN, ""},
+	{E_CONTACT_CSV_PHONE_OTHER, E_CONTACT_PHONE_OTHER, ""},
+	{E_CONTACT_CSV_PHONE_OTHER_FAX,
+	 E_CONTACT_PHONE_OTHER_FAX, ""},
+	{E_CONTACT_CSV_PHONE_PAGER, E_CONTACT_PHONE_PAGER, ""},
+	{E_CONTACT_CSV_PHONE_RADIO, E_CONTACT_PHONE_RADIO, ""},
+	{E_CONTACT_CSV_PHONE_TELEX, E_CONTACT_PHONE_TELEX, ""},
+	{E_CONTACT_CSV_PHONE_TTYTDD, E_CONTACT_PHONE_TTYTDD,
+	 ""},
+	/*E_CONTACT_CSV_ADDRESS_OTHER, */
+	{E_CONTACT_CSV_ADDRESS_OTHER_STREET, NOMAP, "Other Address"},
+	{E_CONTACT_CSV_ADDRESS_OTHER_EXT, NOMAP, "Other Address2"},
+	{E_CONTACT_CSV_ADDRESS_OTHER_CITY, NOMAP,
+	 "Other Address City"},
+	{E_CONTACT_CSV_ADDRESS_OTHER_REGION, NOMAP,
+	 "Other Address State"},
+	{E_CONTACT_CSV_ADDRESS_OTHER_POSTCODE, NOMAP,
+	 "Other Address PostCode"},
+	{E_CONTACT_CSV_ADDRESS_OTHER_COUNTRY, NOMAP,
+	 "Other Address Country"},
+	{E_CONTACT_CSV_EMAIL_2, E_CONTACT_EMAIL_2, ""},
+	{E_CONTACT_CSV_EMAIL_3, E_CONTACT_EMAIL_3, ""},
+	{E_CONTACT_CSV_URL, NOMAP, ""},
+	{E_CONTACT_CSV_ORG_UNIT, E_CONTACT_ORG_UNIT, ""},
+	{E_CONTACT_CSV_OFFICE, E_CONTACT_OFFICE, ""},
+	{E_CONTACT_CSV_TITLE, E_CONTACT_TITLE, ""},
+	{E_CONTACT_CSV_ROLE, E_CONTACT_ROLE, ""},
+	{E_CONTACT_CSV_MANAGER, E_CONTACT_MANAGER, ""},
+	{E_CONTACT_CSV_ASSISTANT, E_CONTACT_ASSISTANT, ""},
+	{E_CONTACT_CSV_NICKNAME, E_CONTACT_NICKNAME, ""},
+	{E_CONTACT_CSV_SPOUSE, E_CONTACT_SPOUSE, ""},
+	{E_CONTACT_CSV_NOTE, E_CONTACT_NOTE, ""},
+	{E_CONTACT_CSV_CALENDAR_URI, E_CONTACT_CALENDAR_URI, ""},
+	{E_CONTACT_CSV_FREEBUSY_URL, E_CONTACT_FREEBUSY_URL, ""},
+	/*E_CONTACT_ANNIVERSARY, */
+	{E_CONTACT_CSV_ANNIVERSARY_YEAR, NOMAP, "Anniversary Year"},
+	{E_CONTACT_CSV_ANNIVERSARY_MONTH, NOMAP, "Anniversary Month"},
+	{E_CONTACT_CSV_ANNIVERSARY_DAY, NOMAP, "Anniversary Day"},
+	/*E_CONTACT_BIRTH_DATE, */
+	{E_CONTACT_CSV_BIRTH_DATE_YEAR, NOMAP, "Birth Year"},
+	{E_CONTACT_CSV_BIRTH_DATE_MONTH, NOMAP, "Birth Month"},
+	{E_CONTACT_CSV_BIRTH_DATE_DAY, NOMAP, "Birth Day"},
+	{E_CONTACT_CSV_MAILER, E_CONTACT_MAILER, ""},
+	{E_CONTACT_CSV_NAME_OR_ORG, E_CONTACT_NAME_OR_ORG, ""},
+	{E_CONTACT_CSV_CATEGORIES, E_CONTACT_CATEGORIES, ""},
+	{E_CONTACT_CSV_FAMILY_NAME, E_CONTACT_FAMILY_NAME, ""},
+	{E_CONTACT_CSV_GIVEN_NAME, E_CONTACT_GIVEN_NAME, ""},
+	{E_CONTACT_CSV_ADDITIONAL_NAME,
+	 NOMAP, ""},
+	{E_CONTACT_CSV_NAME_SUFFIX, NOMAP, ""},
+	{E_CONTACT_CSV_WANTS_HTML, E_CONTACT_WANTS_HTML, ""},
+	{E_CONTACT_CSV_IS_LIST, E_CONTACT_IS_LIST, ""},
+	{E_CONTACT_CSV_LAST, NOMAP, ""}
+
+};
+
+namespace connectivity
+{
+	namespace evoab
+	{
+		class EvoContacts
+		{
+		public:
+			EvoContacts(char *url);
+			EvoContacts(char *_uri,char *_user,char *_passwd);
+			~EvoContacts();
+			
+			/* Get the field value from current row's column specified by the colIndex */
+			//const char * getFieldValue(int fieldIndex);
+			void * getFieldValue(int fieldIndex);
+			
+			/* Get the current row index */
+			int getCurrentRowIndex();
+			
+			/* Move the cursor to next offset, it can be negative ie go to previous rows 0 if success else -1 */
+			int moveCursor(int offset);
+			
+			/* Move the cursor to first row 0 if success else -1 */
+			int moveCursorToStart();
+			
+			/* Move the cursor to last row+1 0 if success else -1 */
+			int moveCursorToEnd();
+			
+			/* get the current cursor position same as current row index */
+			int getCurrentCursor();
+			
+			/* get the end cursor position is the length of EContacts array */
+			int getEndCursor();
+			
+			/* get the fieldname based on the fieldindex */
+			::rtl::OUString getFieldName(int fieldIndex);
+			
+			/* get no of fields */
+			int getFieldCount();
+			
+			/* construct/load the addressbook data */
+			int construct();
+
+			/* Change the selected addressbook and prepare */
+			void setAddressBook(char *abname);
+			
+			/* Dont know the format yet */
+			void setQuery(char *queryString);
+			
+			const ::std::vector< ::rtl::OUString > & getColumnNames() const;
+			
+                        EContact *getCurrentEvoContact() {
+                                return getCurrentContact();
+                        }
+
+			   GList *getEvoAddressBooks() {
+				   return m_sourcenames;
+			   }
+	
+			   
+			
+		private:
+			int m_currentIndex;
+			int m_startIndex;
+			int m_endIndex;
+			guint m_noOfContacts;
+			guint m_noOfFields;
+			
+			char *m_addressBookURI;
+			char *m_userName;
+			char *m_passwd;
+			char *m_selABName;
+			EBook *m_book;
+			EBookQuery *m_query;
+			EContact *m_current_contact;
+			GSList *m_pre_defined_fields;
+			GList *m_sourcenames;
+			GList *m_contacts;
+			::std::vector< ::rtl::OUString > m_columnNames;
+			
+			void set_pre_defined_field(GSList **);
+			gint e_contact_csv_get_contact_field (EContactFieldCSV csv_field);
+			void initColumnNames();
+                        EContact * getCurrentContact() {
+                                return m_current_contact;
+                        }
+
+		};
+	}
+}
+
+#endif
--- /dev/null	2004-06-16 06:40:55.000000000 -0700
+++ connectivity/source/drivers/evoab1.5/NEvoContacts.cxx	2004-08-13 13:51:05.790059376 -0700
@@ -0,0 +1,541 @@
+#ifndef _CONNECTIVITY_EVOAB_EVOCONTACTS_HXX_
+#include "NEvoContacts.hxx"
+#endif
+
+#ifndef _SVTOOLS_LOGINDLG_HXX
+#include <svtools/logindlg.hxx>
+#endif 
+
+#define ID_INDEX 2
+using namespace connectivity::evoab;
+
+
+/* Addressbook parameters like addressBookUri,userName and paswd should be freed by this class */
+EvoContacts::EvoContacts(char *_uri): m_addressBookURI(g_strdup(_uri))
+{
+	const char *fName="EvoContacts::EvoContacts";
+
+	EVO_TRACE(fName);
+	set_pre_defined_field(&m_pre_defined_fields);
+	m_book = NULL;
+	m_query = NULL;
+	m_contacts = NULL;
+	m_userName = NULL;
+	m_passwd = NULL;
+	m_current_contact = NULL;
+	m_sourcenames = NULL;
+	m_selABName =NULL;
+}
+
+EvoContacts::EvoContacts(char *_uri,char *_user,char *_passwd): m_addressBookURI(g_strdup(_uri)), 
+								m_userName(g_strdup(_user)), 
+								m_passwd(g_strdup(_passwd))
+{
+	char *fName="EvoContacts::EvoContacts";
+
+	EVO_TRACE(fName);
+	set_pre_defined_field(&m_pre_defined_fields);
+	m_book = NULL;
+	m_query = NULL;
+	m_contacts = NULL;
+	m_current_contact = NULL;
+	m_sourcenames = NULL;
+	m_selABName =NULL;
+	m_passwd = NULL;
+}
+
+
+EvoContacts::~EvoContacts()
+{
+	char *fName="EvoContacts::~EvoContacts";
+
+	EVO_TRACE(fName);
+
+	if (m_addressBookURI)
+		g_free(m_addressBookURI);
+	if (m_userName)
+		g_free(m_userName);
+	if (m_passwd)
+		g_free(m_passwd);
+
+	// free the book and contacts
+	
+	if (m_book)
+		g_object_unref (m_book);
+
+	if (m_contacts)
+		{
+			for (GList *c = m_contacts; c; c = c->next) {
+				EContact *contact = E_CONTACT (c->data);
+				g_object_unref (G_OBJECT (contact));
+			}
+			g_list_free (m_contacts);
+		}
+	
+	g_free (m_selABName);
+
+	g_list_foreach (m_sourcenames, g_free, NULL);
+	
+}
+
+void EvoContacts::setAddressBook(char *abname)
+{
+	ESourceList *addressbooksourcelist = NULL;
+	int result;
+	ESource *addressbooksource;
+	GSList *g;
+	EBook *tempBook;
+	int sourcelen =0;
+	gboolean status;
+	EBookStatus stat;
+	char *fName="EvoContacts::setAddressBook";
+	ESourceGroup *group;
+	ESource      *source;
+
+	result = e_book_get_addressbooks (&addressbooksourcelist, NULL);
+	
+	if (!status) {
+		printf ("error %d getting address books\n", status);
+		return ;
+		// throw an exception 
+	}	
+	
+	status = FALSE;
+	for (g=e_source_list_peek_groups (addressbooksourcelist); g && !status; g = g->next) {
+		GSList *s;
+		char *sname;
+		for (s = e_source_group_peek_sources (E_SOURCE_GROUP (g->data)); s; s=s->next) {
+			addressbooksource = E_SOURCE (s->data);
+			tempBook = e_book_new (addressbooksource, NULL);
+			sname = e_source_peek_name(addressbooksource);
+			if (!strcmp(sname, abname)) {
+				m_book = tempBook;
+				source = addressbooksource;
+				group = E_SOURCE_GROUP (g->data);
+				status = TRUE;
+				g_free (m_selABName);				
+				m_selABName = g_strdup(abname);
+				break;
+			}			
+		}
+	}
+
+	status = e_book_open (m_book,sal_True, NULL);
+	
+	if (!status) {
+		printf ("failed to open local addressbook\n");
+		return ;
+	}
+	
+	//query = e_book_query_field_exists (E_CONTACT_FULL_NAME);
+	// Groupwise doesnt some how work with E_CONTACT_FULL_NAME exist query :-(
+	
+       m_query = e_book_query_field_test (E_CONTACT_FULL_NAME, E_BOOK_QUERY_CONTAINS, "");
+
+	//Authentication for abooks that need it.
+       char *auth = e_source_get_property (source, "auth");
+       if (auth) {	  	
+	   	
+		//Check whether the connection is already authenticated
+		status = e_book_get_contacts (m_book, m_query, &m_contacts, NULL);
+		if (!status ) {
+			// Oops Its not, lets do now.
+		  	char *user = e_source_get_property (source, "user");
+	              ::svt::LoginDialog aDlg(NULL,
+	                     LF_NO_PATH | LF_NO_ACCOUNT | LF_NO_ERRORTEXT | LF_USERNAME_READONLY | LF_NO_SAVEPASSWORD | LF_NO_ERRORTEXT ,
+	                     String(), NULL);
+	                                                                                                                             
+	              aDlg.SetName( ::rtl::OUString::createFromAscii(user));
+	              aDlg.ClearPassword();  // this will give the password field the focus
+	                                                                                                                             
+	              aDlg.SetLoginRequestText(::rtl::OUString::createFromAscii(""));
+	                                                                                                                            
+	              sal_Int32 nResult = aDlg.Execute();
+
+			if ( nResult != TRUE)
+				return;
+	                                                                                                                             
+	              String sPassword = aDlg.GetPassword();
+
+		  	status = e_book_authenticate_user (m_book, user, get_utf_string(sPassword), auth, NULL);		
+			
+			status = e_book_get_contacts (m_book, m_query, &m_contacts, NULL);
+
+		}
+			  
+	} else  {	
+		status = e_book_get_contacts (m_book, m_query, &m_contacts, NULL);
+	}
+
+	e_book_query_unref (m_query);
+
+	if (!status) {
+		printf ("error %d getting card list\n", status);
+		return ;
+		// throw an exception 
+	}
+
+	m_noOfContacts = g_list_length(m_contacts); // no of rows 
+
+	m_noOfFields = g_slist_length(m_pre_defined_fields); // no of columns 
+
+	m_currentIndex = -1;
+	m_startIndex = -1;
+	m_endIndex = m_noOfContacts + 1; // one greater the last 
+	m_current_contact = E_CONTACT(g_list_nth_data (m_contacts, 0));
+	initColumnNames();
+
+
+}
+
+int  EvoContacts::construct()
+{
+	gboolean status;
+	EBookStatus stat;
+	char *fName="EvoContacts::construct";
+	ESourceGroup *group;
+	ESource      *source;
+
+
+	EVO_TRACE(fName);
+
+
+	if (bonobo_init (NULL, NULL) == FALSE)
+		{
+			g_error ("Could not initialize Bonobo");
+			// throw exception 
+		}
+
+	EVO_TRACE("loading addressbook %s\n",m_addressBookURI);
+
+	group  = e_source_group_new ("DataSources", "");
+	/*
+         * Info for developer: Some EDS API's below uses "NULL" as one of the parameter
+         * that is basically "GError **". It is passwd as NULL b'se the type of of error
+         * is of no interest. the construct should either return success or failure only
+         */
+	if (strcmp(m_addressBookURI,"evolution://")) {
+		m_book= e_book_new_from_uri(m_addressBookURI,NULL);
+                 status = e_book_open(m_book,sal_True,NULL);
+		if ( m_userName && m_passwd ) {
+			status = e_book_authenticate_user(m_book, m_userName, m_passwd,"noauth",NULL);
+                  }
+	} else {	
+                m_book = e_book_new_system_addressbook (NULL);
+		status = e_book_open (m_book,sal_True, NULL);
+	}
+
+	{ // Build the addressbook names and store it 
+	
+		ESourceList *addressbooksourcelist = NULL;
+		int result;
+		ESource *addressbooksource;
+		GSList *g;
+		EBook *tempBook;
+		int sourcelen =0;
+		
+		m_sourcenames = NULL;
+		result = e_book_get_addressbooks (&addressbooksourcelist, NULL);
+		
+		for (g=e_source_list_peek_groups (addressbooksourcelist); g; g = g->next) {
+			GSList *s;
+			char *sname;
+			for (s = e_source_group_peek_sources (E_SOURCE_GROUP (g->data)); s; s=s->next) {
+				addressbooksource = E_SOURCE (s->data);
+				tempBook = e_book_new (addressbooksource, NULL);
+				sname = e_source_peek_name(addressbooksource);				
+				m_sourcenames = g_list_append(m_sourcenames, g_strdup (sname));
+			}
+		}
+
+	}
+
+	
+	source = e_book_get_source(m_book);
+	e_source_set_group (source, group);
+ 	
+	if (status == FALSE)
+		{
+			printf ("failed to open local addressbook\n");
+			return -1;
+		}
+	
+	m_query = e_book_query_field_test (E_CONTACT_FULL_NAME, E_BOOK_QUERY_CONTAINS, "");
+	
+	status = e_book_get_contacts (m_book, m_query, &m_contacts, NULL);
+
+	e_book_query_unref (m_query);
+
+	if (status == FALSE) 
+		{
+			printf ("error %d getting card list\n", status);
+			return -1;
+			// throw an exception 
+		}
+
+	m_noOfContacts = g_list_length(m_contacts); // no of rows 
+	m_noOfFields = g_slist_length(m_pre_defined_fields); // no of columns 
+
+	m_currentIndex = -1;
+	m_startIndex = -1;
+	m_endIndex = m_noOfContacts + 1; // one greater the last 
+	m_current_contact = E_CONTACT(g_list_nth_data (m_contacts, 0)); 
+	initColumnNames();
+
+	return 0;
+}
+
+::rtl::OUString EvoContacts::getFieldName(int colIndex)
+{
+	char *fName="EvoContacts::getFieldName";
+	int fieldIndex = 0;
+
+	EVO_TRACE(fName);
+
+	/* as the columns are numbered from 1 */
+	fieldIndex = colIndex - 1; 
+
+	// todo check index
+	//EVO_TRACE("getFieldName %s %d\n",get_utf_string(columnNames[fieldIndex]),fieldIndex);
+
+	return m_columnNames[fieldIndex];
+}
+
+/**
+ * getFieldValue:
+ * @colIndex: The index of the column from the table whose value is to be found.
+ * Returns the fieldValue based on index, for a currentContact 
+ *
+ * Info for developer: The return value was changed to "void *" as the field_value can be anything 
+ * gboolean or gchar etc
+ * Based on the type of column getColumnType("ResultsetMetaData.cxx") appropriate function from 
+ * "NResultSet.cxx"  is called. Ex if gchar then getString is called. 
+ * If gboolean then getBoolean is called.
+ *
+ * History->Function changed by Jayant M to return void * instead of char *.
+ */
+
+void * EvoContacts::getFieldValue(int colIndex)
+{
+	gint contact_field;
+	EContactFieldCSV csv_field;
+	void *field_value;
+	int fieldIndex = 0;
+
+	/* as the columns are numbered from 1 */
+	fieldIndex = colIndex - 1; 
+
+	const EContactAddress *delivery_address = NULL;
+
+	csv_field = (EContactFieldCSV)GPOINTER_TO_INT (g_slist_nth_data (m_pre_defined_fields, fieldIndex));
+
+	contact_field = e_contact_csv_get_contact_field (csv_field);
+	if (contact_field != NOMAP) {
+		field_value = (void *)e_contact_get (m_current_contact, (EContactField)contact_field);
+	} else {
+		field_value = g_strdup ("");
+ 
+	}
+
+	if (fieldIndex == ID_INDEX) {
+		field_value =  g_strdup (""); // dont print id till its fine 
+		}
+
+	/* caller should free the memory */
+	return field_value;
+
+}
+
+int EvoContacts::getCurrentRowIndex()
+{
+
+	char *fName="EvoContacts::getCurrentRowIndex";
+
+	EVO_TRACE(fName);
+
+	return m_currentIndex;
+}
+
+int EvoContacts::moveCursor(int offset)
+{
+	char *fName="EvoContacts::moveCursor";
+
+	EVO_TRACE(fName);
+
+	m_currentIndex = m_currentIndex + offset;
+
+	/* verify if currentIndex is negative throw exception */
+	m_current_contact = E_CONTACT(g_list_nth_data (m_contacts, m_currentIndex));
+	
+	if (m_current_contact)
+		return 0;
+	else
+		return -1;
+} 
+
+int EvoContacts::moveCursorToStart()
+{
+	char *fName="EvoContacts::moveCursorToStart";
+
+	EVO_TRACE(fName);
+
+	m_currentIndex = m_startIndex;
+	return 0;
+}
+
+int EvoContacts::moveCursorToEnd()
+{
+	char *fName="EvoContacts::moveCursorToEnd";
+
+	EVO_TRACE(fName);
+
+	m_currentIndex = m_endIndex;
+	return 0;
+}
+
+int EvoContacts::getCurrentCursor()
+{
+	char *fName="EvoContacts::getCurrentCursor";
+
+	EVO_TRACE(fName);
+
+	return m_currentIndex;
+}
+
+int EvoContacts::getEndCursor()
+{
+	char *fName="EvoContacts::getEndCursor";
+
+	EVO_TRACE(fName);
+
+	return m_endIndex;
+}
+
+int EvoContacts::getFieldCount()
+{
+	char *fName="EvoContacts::getFieldCount";
+
+	EVO_TRACE(fName);
+	EVO_TRACE("getFieldCount %d\n", m_noOfFields);
+
+	return m_noOfFields;
+}
+
+void EvoContacts::setQuery(char *queryString)
+{
+}
+
+const ::std::vector < ::rtl::OUString > & EvoContacts::getColumnNames() const
+{
+	char *fName="EvoContacts::getColumnNames";
+
+	EVO_TRACE(fName);
+
+	return m_columnNames;
+}
+
+
+// private functions 
+
+void
+EvoContacts::initColumnNames()
+{
+	guint fieldNumber;
+	EContactFieldCSV csvField;
+	gint contactField;
+	char *fName="EvoContacts::initColumnNames";
+
+	EVO_TRACE(fName);
+
+	
+	fieldNumber = g_slist_length (m_pre_defined_fields);
+	
+	for(guint i=0; i<fieldNumber ; i++)
+		{
+			csvField = (EContactFieldCSV)GPOINTER_TO_INT (g_slist_nth_data (m_pre_defined_fields, i));
+			contactField = e_contact_csv_get_contact_field (csvField);
+			
+			if (contactField != NOMAP) {
+				m_columnNames.push_back(::rtl::OUString::createFromAscii(e_contact_field_name((EContactField)contactField)));
+			} else {
+				m_columnNames.push_back(::rtl::OUString::createFromAscii(csv_field_data[csvField].csv_name));
+			}
+		}
+}
+
+gint
+EvoContacts::e_contact_csv_get_contact_field (EContactFieldCSV csv_field)
+{
+	return csv_field_data[csv_field].contact_field;
+}
+
+void
+EvoContacts::set_pre_defined_field (GSList ** pre_defined_fields)
+{
+	*pre_defined_fields = NULL;
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_GIVEN_NAME));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_FAMILY_NAME));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_FULL_NAME));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_NICKNAME));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_EMAIL));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_PHONE_PRIMARY));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_EMAIL_2));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_WANTS_HTML));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_PHONE_BUSINESS));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_PHONE_HOME));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_PHONE_BUSINESS_FAX));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_PHONE_PAGER));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_PHONE_MOBILE));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_HOME_STREET));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_HOME_EXT));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_HOME_CITY));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_HOME_REGION));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_HOME_POSTCODE));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_HOME_COUNTRY));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_BUSINESS_STREET));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_BUSINESS_EXT));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_BUSINESS_CITY));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_BUSINESS_REGION));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_BUSINESS_POSTCODE));
+	*pre_defined_fields =
+		g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ADDRESS_BUSINESS_COUNTRY));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_TITLE));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_OFFICE));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_ORG));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_URL));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_CALENDAR_URI));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_BIRTH_DATE_YEAR));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_BIRTH_DATE_MONTH));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_BIRTH_DATE_DAY));
+	*pre_defined_fields = g_slist_append (*pre_defined_fields, GINT_TO_POINTER (E_CONTACT_CSV_NOTE));
+}
+
+
+#ifdef DEBUG1
+int main(int argc,char *argv[])
+{
+	EvoContacts econtact = EvoContacts(argv[1]);
+
+	econtact.construct();
+	const ::std::vector<string> & colNames = econtact.getColumnNames();
+
+	
+	econtact.moveCursor(2);
+	econtact.moveCursor(0);
+	
+	for(int i=0;i<colNames.size();i++)
+		{
+			cout << colNames[i] << "\n";
+		}
+
+	printf("%s %s\n",econtact.getFieldName(1),econtact.getFieldValue(1));
+
+}
+#endif 
