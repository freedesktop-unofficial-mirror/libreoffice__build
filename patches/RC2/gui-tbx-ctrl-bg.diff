Index: svx/source/tbxctrls/tbcontrl.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/tbxctrls/tbcontrl.cxx,v
retrieving revision 1.42
diff -u -p -u -r1.42 tbcontrl.cxx
--- svx/source/tbxctrls/tbcontrl.cxx	6 Jun 2003 10:44:32 -0000	1.42
+++ svx/source/tbxctrls/tbcontrl.cxx	11 Jul 2003 14:44:19 -0000
@@ -1814,11 +1814,16 @@ void SvxTbxButtonColorUpdater_Impl::Upda
 	BOOL	bSizeChanged = ( theBmpSize != aImage.GetSizePixel() );
 	BOOL	bDisplayModeChanged = ( bWasHiContrastMode != pTbx->GetBackground().GetColor().IsDark() );
 
+	Color	aTransparentColor; // A hack - much like the others for alpha:
+	const StyleSettings& rStyleSettings = Application::GetSettings().GetStyleSettings();
+	aTransparentColor = rStyleSettings.GetFaceColor ();
+
     Color aColor( rColor );
+
     
     // #109290# Workaround for SetFillColor with COL_AUTO
     if ( aColor.GetColor() == COL_AUTO )
-        aColor = Color( IMAGE_COL_TRANSPARENT );
+        aColor = aTransparentColor;
 
 	if ( aCurColor == aColor && !bSizeChanged && !bDisplayModeChanged )
 		return;
@@ -1838,7 +1843,7 @@ void SvxTbxButtonColorUpdater_Impl::Upda
 
 		aVirDev.SetPen( Pen( PEN_NULL ) );
 		aVirDev.SetOutputSizePixel( theBmpSize );
-		aVirDev.SetFillColor( Color( IMAGE_COL_TRANSPARENT ) );
+		aVirDev.SetFillColor( aTransparentColor );
 		aVirDev.DrawRect( Rectangle( aNullPnt, theBmpSize ) );
 		aVirDev.DrawImage( aNullPnt, aImage );
 		delete pBtnBmp;
@@ -1860,7 +1865,7 @@ void SvxTbxButtonColorUpdater_Impl::Upda
 
 	if ( nDrawMode == TBX_UPDATER_MODE_CHAR_COLOR_NEW &&
 		 ( aColor.GetColor() != COL_AUTO &&
-		   aColor.GetColor() != IMAGE_COL_TRANSPARENT ))
+		   aColor != aTransparentColor ) )
 	{
 		// Draw border only if COLOR_AUTO is the new color!
 		aVirDev.SetLineColor( aColor );
@@ -1878,6 +1883,7 @@ void SvxTbxButtonColorUpdater_Impl::Upda
 	}
 	else if ( nDrawMode != TBX_UPDATER_MODE_NONE )
 	{
+		aVirDev.SetFillColor( aTransparentColor );
 		DrawChar( aVirDev, aColor );
 	}
 	else
@@ -1885,21 +1891,9 @@ void SvxTbxButtonColorUpdater_Impl::Upda
 
 	aCurColor = aColor;
 
-    // The following code asumes that we cannot change the display color depth
-    // during Office runtime. Which is at least NOT true for newer Windows versions!
-	const Bitmap	aBmp( aVirDev.GetBitmap( aNullPnt, theBmpSize ) );
-	static Color	aTransparentColor;
-	static sal_Bool	bTransparentColorInitialized = sal_False;
-
-	if( !bTransparentColorInitialized )
-	{
-		aVirDev.DrawPixel( aNullPnt, IMAGE_COL_TRANSPARENT );
-		aTransparentColor = aVirDev.GetPixel( aNullPnt );
-		bTransparentColorInitialized = sal_True;
-	}
+	const Bitmap aBmp( aVirDev.GetBitmap( aNullPnt, theBmpSize ) );
+	Image aNewImage( aBmp );
 
-	Bitmap	aMaskBitmap = aBmp.CreateMask( aTransparentColor );
-	Image aNewImage( aBmp, aMaskBitmap );
 	pTbx->SetItemImage( nBtnId, aNewImage );
 }
 
@@ -1917,7 +1911,6 @@ void SvxTbxButtonColorUpdater_Impl::Draw
 	if ( nDrawMode == TBX_UPDATER_MODE_CHAR_COLOR )
 	{
 		aFont.SetColor( rCol );
-		aFont.SetFillColor( Color( IMAGE_COL_TRANSPARENT ) );
 	}
 	else
 	{
