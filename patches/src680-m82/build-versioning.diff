Index: sfx2/inc/about.hxx
===================================================================
RCS file: /cvs/framework/sfx2/inc/about.hxx,v
retrieving revision 1.2
diff -u -r1.2 about.hxx
--- sfx2/inc/about.hxx	6 Jan 2004 16:16:50 -0000	1.2
+++ sfx2/inc/about.hxx	26 Jan 2005 16:10:39 -0000
@@ -92,10 +92,12 @@
 
 	FixedInfo   	aVersionText;
 	FixedInfo   	aCopyrightText;
+	FixedInfo   	aBuildData;
 
 	ResStringArray	aDeveloperAry;
 	String			aDevVersionStr;
 	String 			aAccelStr;
+	String			aVersionData;
 
 	AccelList 		aAccelList;
 
Index: sfx2/source/dialog/about.cxx
===================================================================
RCS file: /cvs/framework/sfx2/source/dialog/about.cxx,v
retrieving revision 1.22
diff -u -r1.22 about.cxx
--- sfx2/source/dialog/about.cxx	7 Jan 2005 08:56:37 -0000	1.22
+++ sfx2/source/dialog/about.cxx	26 Jan 2005 16:10:39 -0000
@@ -103,6 +103,21 @@
 typedef const char* (*fncChar)();
 
 // class AboutDialog -----------------------------------------------------
+static void layoutText( FixedInfo &rText, long &nY, long nTextWidth, Size a6Size )
+{
+	Point aTextPos = rText.GetPosPixel();
+	aTextPos.X() = a6Size.Width() * 2;
+	aTextPos.Y() = nY;
+	rText.SetPosPixel( aTextPos );
+
+	Size aTxtSiz = rText.GetSizePixel();
+	aTxtSiz.Width() = nTextWidth;
+    Size aCalcSize = rText.CalcMinimumSize( nTextWidth );
+    aTxtSiz.Height() = aCalcSize.Height();
+	rText.SetSizePixel( aTxtSiz );
+
+	nY += aTxtSiz.Height();
+}
 
 AboutDialog::AboutDialog( Window* pParent, const ResId& rId, const String& rVerStr ) :
 
@@ -111,6 +126,7 @@
 	aOKButton      	( this,		ResId( ABOUT_BTN_OK ) ),
 	aVersionText 	( this, 	ResId( ABOUT_FTXT_VERSION ) ),
 	aCopyrightText	( this, 	ResId( ABOUT_FTXT_COPYRIGHT ) ),
+	aBuildData      ( this ),
 	aDeveloperAry	( 			ResId( ABOUT_STR_DEVELOPER_ARY ) ),
 	aDevVersionStr	( rVerStr ),
 	aAccelStr		( 			ResId( ABOUT_STR_ACCEL ) ),
@@ -211,6 +227,22 @@
 	Color aTextColor( rSettings.GetWindowTextColor() );
 	aVersionText.SetControlForeground( aTextColor );
 	aCopyrightText.SetControlForeground( aTextColor );
+	aBuildData.SetBackground( aWall );
+
+	Font aSmallFont = rSettings.GetInfoFont();
+	Size aSmaller = aNewFont.GetSize();
+	aSmaller.Width() = (long) (aSmaller.Width() * 0.75);
+	aSmaller.Height() = (long) (aSmaller.Height() * 0.75);
+	aNewFont.SetSize( aSmaller );
+	aBuildData.SetFont( aNewFont );
+	aBuildData.SetBackground( aWall );
+#ifdef BUILD_VER_STRING	
+	String aBuildString( DEFINE_CONST_UNICODE( BUILD_VER_STRING ) );
+#else
+	String aBuildString;
+#endif
+	aBuildData.SetText( aBuildString );
+	aBuildData.Show();
 
 	// Gr"ossen und Positionen berechnen
 	Size aAppLogoSiz = aAppLogo.GetSizePixel();
@@ -222,31 +254,18 @@
 
 	// Texte (Gr"osse und Position )
 	Size a6Size = aVersionText.LogicToPixel( Size( 6, 6 ), MAP_APPFONT );
-	long nY = 0;
-	Point aTextPos = aVersionText.GetPosPixel();
-	aTextPos.X() = a6Size.Width() * 2;
-	aTextPos.Y() = aAppLogoSiz.Height() + ( a6Size.Height() * 2 );
-	nY = aTextPos.Y();
-	aVersionText.SetPosPixel( aTextPos );
-	Size aTxtSiz = aVersionText.GetSizePixel();
-	aTxtSiz.Width() = aAppLogoSiz.Width() - ( a6Size.Width() * 4 );
-	long nTextWidth = aTxtSiz.Width();
-    Size aCalcSize = aVersionText.CalcMinimumSize( nTextWidth );
-
-    aTxtSiz.Height() = aCalcSize.Height();
-	aVersionText.SetSizePixel( aTxtSiz );
-	nY += aTxtSiz.Height() + ( a6Size.Height() / 3 );
+	long nTextWidth = aAppLogoSiz.Width() - ( a6Size.Width() * 4 );
+	long nY = aAppLogoSiz.Height() + ( a6Size.Height() * 2 );
 
-	aTextPos = aCopyrightText.GetPosPixel();
-	aTextPos.X() = a6Size.Width() * 2;
-	aTextPos.Y() = nY;
-	aCopyrightText.SetPosPixel( aTextPos );
-	aTxtSiz = aCopyrightText.GetSizePixel();
-	aTxtSiz.Width() = nTextWidth;
-    aCalcSize = aCopyrightText.CalcMinimumSize( nTextWidth );
-    aTxtSiz.Height() = aCalcSize.Height();
-	aCopyrightText.SetSizePixel( aTxtSiz );
-	nY += aTxtSiz.Height() + ( a6Size.Height() / 2 );
+	layoutText( aVersionText, nY, nTextWidth, a6Size );
+	nY += ( a6Size.Height() / 3 );
+	layoutText( aCopyrightText, nY, nTextWidth, a6Size );
+	nY += ( a6Size.Height() / 3 );
+	if( aBuildString.Len() > 0 )
+	{
+		layoutText( aBuildData, nY, nTextWidth, a6Size );
+		nY += ( a6Size.Height() / 2 );
+	}
 
 	// OK-Button-Position (at the bottom and centered)
 	Size aOKSiz = aOKButton.GetSizePixel();
@@ -271,6 +290,8 @@
         sCopyright.SearchAndReplaceAll(sSO, sProduct);
         aCopyrightText.SetText(sCopyright);
     }
+
+	
 }
 
 // -----------------------------------------------------------------------
Index: sfx2/source/dialog/makefile.mk
===================================================================
RCS file: /cvs/framework/sfx2/source/dialog/makefile.mk,v
retrieving revision 1.27
diff -u -r1.27 makefile.mk
--- sfx2/source/dialog/makefile.mk	11 Jan 2005 14:57:53 -0000	1.27
+++ sfx2/source/dialog/makefile.mk	26 Jan 2005 16:10:40 -0000
@@ -136,6 +136,10 @@
 		printopt.src        \
 		srchdlg.src
 
+.IF "$(BUILD_VER_STRING)"!=""
+CFLAGS+=-DBUILD_VER_STRING='"$(BUILD_VER_STRING)"'
+.ENDIF
+
 # --- Targets -------------------------------------------------------
 
 .INCLUDE :  target.mk


Index: config_office/set_soenv.in
===================================================================
RCS file: /cvs/tools/config_office/set_soenv.in,v
retrieving revision 1.33
diff -u -r1.33 set_soenv.in
--- config_office/set_soenv.in	14 Jan 2005 11:35:31 -0000	1.33
+++ config_office/set_soenv.in	26 Jan 2005 16:18:57 -0000
@@ -1406,6 +1413,7 @@
 ToFile( "PRODUCT",           "@PRODUCT@",        "e" );
 ToFile( "PROFULLSWITCH",     "@PROFULLSWITCH@",  "e" );
 ToFile( "PROEXT",            $PROEXT,            "e" );
+ToFile( "BUILD_VER_STRING",  "@BUILD_VER_STRING@", "e" );
 ToFile( "ENABLE_GTK",        "@ENABLE_GTK@",       "e" );
 ToFile( "GTK_CFLAGS",        "@GTK_CFLAGS@",       "e" );
 ToFile( "GTK_LIBS",          "@GTK_LIBS@",         "e" );


Index: config_office/configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.82
diff -u -r1.82 configure.in
--- config_office/configure.in	5 Jan 2005 12:09:48 -0000	1.82
+++ config_office/configure.in	26 Jan 2005 16:19:58 -0000
@@ -354,6 +379,13 @@
 
                           Usage: --with-use-shell=tcsh|4nt
 ],with_use_shell=$withval,with_use_shell="tcsh")
+AC_ARG_WITH(build-version,
+[  --with-build-version   Allows the builder to add a custom version tag
+                          that will appear in the Help/About box for QA
+                          purposes.
+
+                          Usage: --with-build-version="Built by Jim"
+],with_build_version=$withval)
 AC_ARG_ENABLE(sgistl,
 [  --enable-sgistl         for IRIX users, use this option option to build
                           OpenOffice.org using SGI's STL.
@@ -1436,6 +1495,17 @@
 fi
 
 dnl ===================================================================
+dnl Custom build version
+dnl ===================================================================
+
+if test "z$with_build_version" != "z"; then
+   BUILD_VER_STRING=$with_build_version
+else
+   BUILD_VER_STRING=
+fi
+AC_SUBST(BUILD_VER_STRING)
+
+dnl ===================================================================
 dnl Java support enable
 dnl ===================================================================
 AC_MSG_CHECKING([whether to build with Java support])
