--- config_office/configure.in.ark	2005-01-28 05:10:19.000000000 +0100
+++ config_office/configure.in	2005-01-28 05:14:19.000000000 +0100
@@ -2552,7 +2552,12 @@
 KDE_LIBS=""
 if test "$test_kde" = "yes" -a "$ENABLE_KDE" = "TRUE" ; then
     dnl Search paths for Qt and KDE
-    qt_incdirs="$QTINC /usr/local/qt/include /usr/include/qt /usr/include /usr/X11R6/include/X11/qt /usr/X11R6/include/qt /usr/lib/qt3/include /usr/lib/qt/include /usr/share/qt3/include $x_includes"
+    if test -n "$QTDIR" ; then
+        qt_incdirs="$QTDIR/include"
+        qt_libdirs="$QTDIR/lib"
+    fi
+    qt_incdirs="$QTINC $qt_incdirs /usr/local/qt/include /usr/include/qt /usr/include /usr/X11R6/include/X11/qt /usr/X11R6/include/qt /usr/lib/qt3/include /usr/lib/qt/include /usr/share/qt3/include $x_includes"
+    qt_libdirs="$QTLIB $qt_libdirs /usr/local/qt/lib /usr/lib/qt /usr/lib/qt3/lib /usr/X11R6/lib"
     if test -n "$QTDIR" ; then
         qt_incdirs="$QTDIR/include $qt_incdirs"
     fi
@@ -2565,6 +2570,7 @@
 
     dnl What to test
     qt_test_include="qstyle.h"
+    qt_test_library="libqt-mt.so.3"
     kde_test_include="ksharedptr.h"
     kde_test_library="libkdeui.la"
 
@@ -2578,6 +2584,15 @@
         fi
     done
     AC_MSG_RESULT([$qt_incdir])
+    AC_MSG_CHECKING([for Qt libraries])
+    qt_libdir="no"
+    for kde_check in $qt_libdirs ; do
+        if test -r "$kde_check/$qt_test_library" ; then
+            qt_libdir="$kde_check"
+            break
+        fi
+    done
+    AC_MSG_RESULT([$qt_libdir])
     if test "x$qt_incdir" == "xno" ; then
         AC_MSG_ERROR([Qt headers not found.  Please specify the root of
 your Qt installation by exporting QTDIR before running "configure".])
@@ -2614,8 +2629,14 @@
     fi
 
     dnl Set the variables
+    if test z$kde_libdir != "z/usr/lib"; then
+        KDE_LIBS="-L$kde_libdir"
+    fi
     KDE_CFLAGS="-I$qt_incdir -I$kde_incdir -DQT_CLEAN_NAMESPACE -DQT_NO_EMIT -DQT_THREAD_SUPPORT"
-    KDE_LIBS="-L$kde_libdir -lkdeui"
+    KDE_LIBS="$KDE_LIBS -lkdecore -lkdeui -lqt-mt"
+    if test z$qt_libdir != "zno"; then
+        KDE_LIBS="-L$qt_libdir $KDE_LIBS"
+    fi
 fi
 AC_SUBST(KDE_CFLAGS)
 AC_SUBST(KDE_LIBS)
