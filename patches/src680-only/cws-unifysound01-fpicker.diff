Index: fpicker/source/unx/gnome/SalGtkFilePicker.cxx
===================================================================
RCS file: /cvs/gsl/fpicker/source/unx/gnome/SalGtkFilePicker.cxx,v
retrieving revision 1.23
retrieving revision 1.23.4.2
diff -u -p -u -p -r1.23 -r1.23.4.2
--- fpicker/source/unx/gnome/SalGtkFilePicker.cxx	31 Jul 2007 16:00:02 -0000	1.23
+++ fpicker/source/unx/gnome/SalGtkFilePicker.cxx	13 Aug 2007 09:58:19 -0000	1.23.4.2
@@ -192,7 +192,10 @@ SalGtkFilePicker::SalGtkFilePicker( cons
 	}
 
 	for( i = 0; i < BUTTON_LAST; i++ )
+    {
 		m_pButtons[i] = NULL;
+		mbButtonVisibility[i] = false;
+    }
 
 	for( i = 0; i < LIST_LAST; i++ )
     {
@@ -259,27 +262,6 @@ SalGtkFilePicker::SalGtkFilePicker( cons
 		gtk_box_pack_end( GTK_BOX( pThinVBox ), m_pToggles[i], FALSE, FALSE, 0 );
 	}
 
-	for( i = 0; i < BUTTON_LAST; i++ )
-	{
-		m_pButtons[i] = gtk_button_new();
-
-#define LABEL_BUTTON( elem ) \
-		case elem : \
-			aLabel = aResProvider.getResString( PUSHBUTTON_##elem ); \
-			setLabel( PUSHBUTTON_##elem, aLabel ); \
-			break
-
-  		switch( i ) {
-
-		LABEL_BUTTON( PLAY );
-			default:
-				OSL_TRACE("Handle unknown control %d\n", i);
-				break;
-		}
-
-		gtk_box_pack_end( GTK_BOX( pThinVBox ), m_pButtons[i], FALSE, TRUE, 0 );
-	}
-
 	for( i = 0; i < LIST_LAST; i++ )
 	{
         m_pHBoxs[i] = gtk_hbox_new( FALSE, 0 );
@@ -1119,6 +1101,16 @@ sal_Int16 SAL_CALL SalGtkFilePicker::exe
 				retVal = ExecutableDialogResults::CANCEL;
 				break;
 
+			case 1:	//PLAY
+				{
+					FilePickerEvent evt;
+				    evt.ElementId = PUSHBUTTON_PLAY;
+				    OSL_TRACE( "filter_changed, isn't it great %x\n", this);
+				    controlStateChanged( evt );
+				    btn = GTK_RESPONSE_NO;
+				}
+				break;
+
 			default:
 				retVal = 0;
 				break;
@@ -1412,14 +1404,12 @@ throw( uno::RuntimeException )
 		OSL_TRACE("enable unknown control %d\n", nControlId );
 }
 
-void SAL_CALL SalGtkFilePicker::setLabel( sal_Int16 nControlId, const ::rtl::OUString& aLabel ) 
+void SAL_CALL SalGtkFilePicker::setLabel( sal_Int16 nControlId, const ::rtl::OUString& rLabel ) 
 	throw( uno::RuntimeException )
 {
 	OSL_ASSERT( m_pDialog != NULL );
 	::vos::OGuard aGuard( Application::GetSolarMutex() );
 
-	OString aTxt = OUStringToOString( aLabel, RTL_TEXTENCODING_UTF8 );
-
 	GType tType;
 	GtkWidget *pWidget;
 
@@ -1428,7 +1418,22 @@ void SAL_CALL SalGtkFilePicker::setLabel
 	  	OSL_TRACE("Set label on unknown control %d\n", nControlId);
 		return;
 	}
-	if( tType == GTK_TYPE_TOGGLE_BUTTON || tType == GTK_TYPE_BUTTON || tType == GTK_TYPE_LABEL )
+
+    OString aTxt = OUStringToOString( rLabel.replace('~', '_'), RTL_TEXTENCODING_UTF8 );
+    if (nControlId == ExtendedFilePickerElementIds::PUSHBUTTON_PLAY)
+    {
+#ifdef GTK_STOCK_MEDIA_PLAY
+        if (!msPlayLabel.getLength())
+            msPlayLabel = rLabel;
+        if (msPlayLabel == rLabel)
+            gtk_button_set_label(GTK_BUTTON(pWidget), GTK_STOCK_MEDIA_PLAY);
+        else
+            gtk_button_set_label(GTK_BUTTON(pWidget), GTK_STOCK_MEDIA_STOP);
+#else
+        gtk_button_set_label(GTK_BUTTON(pWidget), aTxt.getStr());
+#endif
+    }
+	else if( tType == GTK_TYPE_TOGGLE_BUTTON || tType == GTK_TYPE_BUTTON || tType == GTK_TYPE_LABEL )
 		g_object_set( pWidget, "label", aTxt.getStr(),
 					  "use_underline", TRUE, (char *)NULL );
 	else
@@ -1726,6 +1731,7 @@ void SAL_CALL SalGtkFilePicker::initiali
 		case FILEOPEN_PLAY:        
 			eAction = GTK_FILE_CHOOSER_ACTION_OPEN;
 			first_button_text = GTK_STOCK_OPEN;
+			mbButtonVisibility[PLAY] = true;
 			// TODO
 		        break;
 		case FILEOPEN_READONLY_VERSION:
@@ -1766,7 +1772,21 @@ void SAL_CALL SalGtkFilePicker::initiali
     gtk_file_chooser_set_action( GTK_FILE_CHOOSER( m_pDialog ), eAction);
     dialog_remove_buttons( GTK_DIALOG( m_pDialog ) );
     gtk_dialog_add_button( GTK_DIALOG( m_pDialog ), GTK_STOCK_CANCEL, GTK_RESPONSE_CANCEL );
+    for( int nTVIndex = 0; nTVIndex < BUTTON_LAST; nTVIndex++ )
+    {
+        if( mbButtonVisibility[nTVIndex] )
+        {
+#ifdef GTK_STOCK_MEDIA_PLAY
+            m_pButtons[ nTVIndex ] = gtk_dialog_add_button( GTK_DIALOG( m_pDialog ), GTK_STOCK_MEDIA_PLAY, 1 );
+#else
+		    CResourceProvider aResProvider;
+            OString aPlay = OUStringToOString( aResProvider.getResString( PUSHBUTTON_PLAY ), RTL_TEXTENCODING_UTF8 );
+            m_pButtons[ nTVIndex ] = gtk_dialog_add_button( GTK_DIALOG( m_pDialog ), aPlay.getStr(), 1 );
+#endif
+        }
+    }
     gtk_dialog_add_button( GTK_DIALOG( m_pDialog ), first_button_text, GTK_RESPONSE_ACCEPT );
+
     gtk_dialog_set_default_response( GTK_DIALOG (m_pDialog), GTK_RESPONSE_ACCEPT );
 
 	// Setup special flags
@@ -2031,9 +2051,6 @@ SalGtkFilePicker::~SalGtkFilePicker()
 	for( i = 0; i < TOGGLE_LAST; i++ )
 		gtk_widget_destroy( m_pToggles[i] );
 
-	for( i = 0; i < BUTTON_LAST; i++ )
-		gtk_widget_destroy( m_pButtons[i] );
-
 	for( i = 0; i < LIST_LAST; i++ )
     {
 		gtk_widget_destroy( m_pListLabels[i] );
Index: fpicker/source/unx/gnome/SalGtkFilePicker.hxx
===================================================================
RCS file: /cvs/gsl/fpicker/source/unx/gnome/SalGtkFilePicker.hxx,v
retrieving revision 1.10
retrieving revision 1.10.110.2
diff -u -p -u -p -r1.10 -r1.10.110.2
--- fpicker/source/unx/gnome/SalGtkFilePicker.hxx	7 Aug 2006 13:59:37 -0000	1.10
+++ fpicker/source/unx/gnome/SalGtkFilePicker.hxx	13 Aug 2007 09:58:19 -0000	1.10.110.2
@@ -289,6 +289,7 @@ class SalGtkFilePicker : 
 	private:
         ::com::sun::star::uno::Reference< ::com::sun::star::ui::dialogs::XFilePickerListener >
             m_xListener;
+        ::rtl::OUString msPlayLabel;
 		FilterList *m_pFilterList;
 		GtkWidget  *m_pVBox;
 
@@ -332,6 +333,7 @@ class SalGtkFilePicker : 
 		GtkWidget *m_pLists[ LIST_LAST ];
 		GtkWidget *m_pListLabels[ LIST_LAST ];
 		bool mbListVisibility[ LIST_LAST ];
+		bool mbButtonVisibility[ BUTTON_LAST ];
         gulong mnHID_FolderChange;
         gulong mnHID_SelectionChange;
 
Index: fpicker/source/unx/gnome/SalGtkPicker.cxx
===================================================================
RCS file: /cvs/gsl/fpicker/source/unx/gnome/SalGtkPicker.cxx,v
retrieving revision 1.14
retrieving revision 1.14.84.1
diff -u -p -u -p -r1.14 -r1.14.84.1
--- fpicker/source/unx/gnome/SalGtkPicker.cxx	24 Oct 2006 15:02:38 -0000	1.14
+++ fpicker/source/unx/gnome/SalGtkPicker.cxx	10 Aug 2007 11:03:44 -0000	1.14.84.1
@@ -131,7 +131,8 @@ gboolean rundialog(RunDialog *pDialog)
 void RunDialog::run() 
 { 
     mnStatus = gtk_dialog_run( GTK_DIALOG( m_pDialog ) ); 
-    gtk_widget_hide( m_pDialog );
+    if (mnStatus != 1)	//PLAY
+        gtk_widget_hide( m_pDialog );
 
     maLock.acquire();
     mbFinished = true;
