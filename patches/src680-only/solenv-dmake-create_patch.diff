--- solenv/inc/tg_ext.mk	18 Jul 2007 08:01:29 -0000	1.77
+++ solenv/inc/tg_ext.mk	15 Nov 2007 10:47:15 -0000
@@ -319,8 +319,10 @@
 #ignore returncode of 1 (indicates differences...)	
 # hard coded again to get the same directory level as before. quite ugly...
 	-cd $(PRJ)$/$(ROUT) && diff -rc misc$/$(TARFILE_ROOTDIR) misc$/build$/$(TARFILE_ROOTDIR) | $(PERL) $(SOLARENV)$/bin$/cleandiff.pl | tr -d "\015" > misc$/$(NEW_PATCH_FILE_NAME).tmp
+	@@-$(TOUCH) $(NEW_PATCH_FILE_NAME).bak
 	@@-mv $(NEW_PATCH_FILE_NAME) $(NEW_PATCH_FILE_NAME).bak
-	@@-mv $(MISC)$/$(NEW_PATCH_FILE_NAME).tmp $(PRJ)$/$(NEW_PATCH_FILE_NAME)
+	$(PERL) $(SOLARENV)$/bin$/patch_sanitizer.pl $(NEW_PATCH_FILE_NAME).bak $(MISC)$/$(NEW_PATCH_FILE_NAME).tmp $(PRJ)$/$(NEW_PATCH_FILE_NAME)
+	@@-$(RM) $(MISC)$/$(NEW_PATCH_FILE_NAME).tmp
 	$(MAKECMD) $(MAKEMACROS) patch
 	@echo still some problems with win32 generated patches...
 
