unchanged:
--- vcl/unx/source/app/salsys.cxx	2003-04-15 18:08:33.000000000 +0200
+++ vcl/unx/source/app/salsys.cxx	2004-06-22 11:38:48.368258816 +0200
@@ -59,6 +59,12 @@
  *
  ************************************************************************/
 
+#ifdef WIDGETSET_KDE
+#define Region QtXRegion
+#include <qpaintdevice.h>
+#undef Region
+#endif
+
 #include <salsys.hxx>
 #include <stacktrace.hxx>
 
@@ -71,6 +77,15 @@
 #include <button.hxx>
 #include <svdata.hxx>
 
+#ifdef WIDGETSET_GTK
+#include <gtk/gtk.h>
+#undef _PREX_H
+#undef _POSTX_H
+#include <prex.h>
+#include <gdk/gdkx.h>
+#include <postx.h>
+#endif
+
 // -----------------------------------------------------------------------
 
 String GetSalSummarySystemInfos( ULONG nFlags )
@@ -106,7 +121,14 @@ String GetSalSummarySystemInfos( ULONG n
 bool GetSalSystemDisplayInfo( System::DisplayInfo& rInfo )
 {
     bool bSuccess = false;
+#if defined( WIDGETSET_GTK )
+    gtk_init( NULL, NULL );
+    Display* pDisplay = GDK_DISPLAY_XDISPLAY( gdk_display_get_default() );
+#elif defined( WIDGETSET_KDE )
+    Display* pDisplay = QPaintDevice::x11AppDisplay();
+#else
     Display* pDisplay = XOpenDisplay( NULL );
+#endif
     if( pDisplay )
     {
         int nScreen = DefaultScreen( pDisplay );
@@ -122,7 +144,9 @@ bool GetSalSystemDisplayInfo( System::Di
         rInfo.nDepth	= aVI.depth;
         rInfo.nWidth	= DisplayWidth( pDisplay, nScreen );
         rInfo.nHeight	= DisplayHeight( pDisplay, nScreen );
+#if !defined( WIDGETSET_GTK ) && !defined( WIDGETSET_KDE )
         XCloseDisplay( pDisplay );
+#endif
         bSuccess = true;
     }
     return bSuccess;
unchanged:
--- vcl/win/inc/saldata.hxx	28 May 2003 12:34:54 -0000	1.11
+++ vcl/win/inc/saldata.hxx	3 Mar 2004 15:32:07 -0000
@@ -169,6 +169,7 @@ struct SalData
     SysAgt_Enable_PROC      mpSageEnableProc;       // funktion to deactivate the system agent
     SalIcon*                mpFirstIcon;            // icon cache, points to first icon, NULL if none
     TempFontItem*           mpTempFontItem;
+    BOOL                    mbThemeChanged;         // true if visual theme was changed: throw away theme handles
 };
 
 inline void SetSalData( SalData* pData ) { ImplGetSVData()->mpSalData = (void*)pData; }
