Index: scaddins/source/analysis/analysis.cxx
===================================================================
RCS file: /cvs/sc/scaddins/source/analysis/analysis.cxx,v
retrieving revision 1.33
diff -u -p -u -r1.33 analysis.cxx
--- scaddins/source/analysis/analysis.cxx	4 Jun 2003 10:31:33 -0000	1.33
+++ scaddins/source/analysis/analysis.cxx	26 Feb 2004 07:00:30 -0000
@@ -1307,7 +1307,7 @@ STRING SAL_CALL AnalysisAddIn::getComple
 			THROW_IAE;
 	}
 
-	return Complex( fR,fI ).GetString( bi );
+	return Complex( fR, fI, bi ? 'i' : 'j' ).GetString();
 }
 
 
Index: scaddins/source/analysis/analysishelper.cxx
===================================================================
RCS file: /cvs/sc/scaddins/source/analysis/analysishelper.cxx,v
retrieving revision 1.40
diff -u -p -u -r1.40 analysishelper.cxx
--- scaddins/source/analysis/analysishelper.cxx	4 Jun 2003 10:31:45 -0000	1.40
+++ scaddins/source/analysis/analysishelper.cxx	26 Feb 2004 07:00:41 -0000
@@ -991,7 +991,7 @@ sal_Bool ParseDouble( const sal_Unicode*
 					eS = S_Frac;
 				else if( IsImagUnit( c ) )
 				{
-					rRet = bNegNum? -1.0 : 1.0;
+					rRet = 0.0;
 					return sal_True;
 				}
 				else
@@ -2160,16 +2160,15 @@ inline sal_Bool Complex::IsImagUnit( sal
 	return c == 'i' || c == 'j';
 }
 
-
 sal_Bool Complex::ParseString( const STRING& rStr, Complex& rCompl )
 {
 	const sal_Unicode*		pStr = ( const sal_Unicode * ) rStr;
 
-
-	if( IsImagUnit( *pStr ) && rStr.getLength() == 1 )
+	if( IsImagUnit( *pStr ) && rStr.getLength() == 1)
 	{
 		rCompl.r = 0.0;
 		rCompl.i = 1.0;
+		rCompl.c = *pStr;
 		return sal_True;
 	}
 
@@ -2186,6 +2185,7 @@ sal_Bool Complex::ParseString( const STR
 			double		r = f;
 			if( IsImagUnit( pStr[ 1 ] ) )
 			{
+				rCompl.c = pStr[ 1 ];
 				if( pStr[ 2 ] == 0 )
 				{
 					rCompl.r = f;
@@ -2195,6 +2195,7 @@ sal_Bool Complex::ParseString( const STR
 			}
 			else if( ParseDouble( pStr, f ) && IsImagUnit( *pStr ) )
 			{
+				rCompl.c = *pStr;
 				pStr++;
 				if( *pStr == 0 )
 				{
@@ -2207,6 +2208,7 @@ sal_Bool Complex::ParseString( const STR
 			break;
 		case 'j':
 		case 'i':
+			rCompl.c = *pStr;
 			pStr++;
 			if( *pStr == 0 )
 			{
@@ -2225,7 +2227,7 @@ sal_Bool Complex::ParseString( const STR
 }
 
 
-STRING Complex::GetString( sal_Bool bi ) const THROWDEF_RTE_IAE
+STRING Complex::GetString() const THROWDEF_RTE_IAE
 {
 	static const STRING	aI( "i", 1, RTL_TEXTENCODING_MS_1252 );
 	static const STRING	aJ( "j", 1, RTL_TEXTENCODING_MS_1252 );
@@ -2234,16 +2236,23 @@ STRING Complex::GetString( sal_Bool bi )
 
     CHK_FINITE(r);
     CHK_FINITE(i);
-    STRING              aRet( ::GetString( r ) );
+    STRING aRet;
+	bool   bHasReal = r != 0.0;
 
-	if( i == 1.0 )
-		aRet += aPlus;
+	if( bHasReal )
+	    aRet = ::GetString( r );
+	
+	if( i == 1.0)
+	{
+		if( bHasReal )
+			aRet += aPlus;
+	}
 	else if( i == -1.0 )
 		aRet += aMinus;
 	else
-		aRet += ::GetString( i, sal_True );
+		aRet += ::GetString( i, bHasReal );
 
-	aRet += bi? aI : aJ;
+	aRet += c == 'i' ? aI : aJ;
 
 	return aRet;
 }
Index: scaddins/source/analysis/analysishelper.hxx
===================================================================
RCS file: /cvs/sc/scaddins/source/analysis/analysishelper.hxx,v
retrieving revision 1.24
diff -u -p -u -r1.24 analysishelper.hxx
--- scaddins/source/analysis/analysishelper.hxx	4 Jun 2003 10:31:56 -0000	1.24
+++ scaddins/source/analysis/analysishelper.hxx	26 Feb 2004 07:00:42 -0000
@@ -532,16 +532,16 @@ class Complex
 {
 	double					r;
 	double					i;
+	sal_Char                c;
 
 public:
-//	inline					Complex( void );
-	inline					Complex( double fReal, double fImag = 0.0 );
+	inline					Complex( double fReal, double fImag = 0.0, sal_Char cC = 'i' );
 	inline					Complex( const Complex& rCopy );
 							Complex( const STRING& rComplexAsString ) THROWDEF_RTE_IAE;
 
 	inline static sal_Bool	IsImagUnit( sal_Unicode c );
 	static sal_Bool			ParseString( const STRING& rComplexAsString, Complex& rReturn );
-    STRING                  GetString( sal_Bool bUse_i = sal_True ) const THROWDEF_RTE_IAE;
+    STRING                  GetString() const THROWDEF_RTE_IAE;
 
 	inline double			Real( void ) const;
 	inline double			Imag( void ) const;
@@ -872,23 +872,14 @@ inline const FuncData* FuncDataList::Get
 }
 
 
-
-
-/*inline Complex::Complex( void )
-{
-//#ifdef DEBUG
-//	SetNAN( i );
-//	r = i;
-//#endif
-}*/
-
-
-inline Complex::Complex( double fReal, double fImag ) : r( fReal ), i( fImag )
+inline Complex::Complex( double fReal, double fImag, sal_Char cC ) :
+		r( fReal ), i( fImag ), c( cC )
 {
 }
 
 
-inline Complex::Complex( const Complex& rCpy ) : r( rCpy.r ), i( rCpy.i )
+inline Complex::Complex( const Complex& rCpy ) :
+		r( rCpy.r ), i( rCpy.i ), c( rCpy.c )
 {
 }
 
