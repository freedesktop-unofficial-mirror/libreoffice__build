Index: svtools/source/misc/transfer.cxx
===================================================================
RCS file: /cvs/util/svtools/source/misc/transfer.cxx,v
retrieving revision 1.63
diff -u -p -u -r1.63 transfer.cxx
--- svtools/source/misc/transfer.cxx	27 Mar 2003 14:39:19 -0000	1.63
+++ svtools/source/misc/transfer.cxx	17 Jun 2004 15:29:28 -0000
@@ -107,6 +107,7 @@
 #ifndef _SV_WINDOW_HXX
 #include <vcl/window.hxx>
 #endif
+#include <vcl/bmpacc.hxx>
 #ifndef _COMPHELPER_PROCESSFACTORY_HXX_
 #include <comphelper/processfactory.hxx>
 #endif
@@ -1545,6 +1546,21 @@ sal_Bool TransferableDataHelper::GetBitm
 	    xStm->ResetError();
 		*xStm >> rBmp;
 		bRet = ( xStm->GetError() == ERRCODE_NONE );
+	}
+
+	int i = rBmp.GetBitCount();
+	if(rBmp.GetBitCount() == 32)
+	{
+		// Strangely we seem to get an existant but broken / odd alpha channel on win32 
+		Size aSize = rBmp.GetSizePixel();
+		BitmapWriteAccess *pUpd = rBmp.AcquireWriteAccess();
+		for( int nY = 0; nY < aSize.Height(); nY++)
+		{
+			for( int nX = 0; nX < aSize.Width(); nX++ )
+				pUpd->SetAlpha( nY, nX, 255 );
+		}
+		rBmp.ReleaseAccess( pUpd );
+               rBmp.Convert( BMP_CONVERSION_24BIT );
 	}
 
 	return bRet;

--- vcl/source/gdi/bitmap3.cxx	2004-09-08 10:21:22.015625000 +0100
+++ vcl/source/gdi/bitmap3.cxx	2004-09-16 14:31:01.437500000 +0100
@@ -385,7 +385,7 @@
 
 		case( BMP_CONVERSION_24BIT ):
 		{
-			if( nBitCount < 24 )
+			if( nBitCount != 24 )
 				bRet = ImplConvertUp( 24, FALSE );
 			else
 				bRet = TRUE;
