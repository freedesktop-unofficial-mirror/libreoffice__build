Index: scp/source/office/profile.scp
===================================================================
--- scp/source/office/profile.scp.orig	2003-08-20 15:19:53.000000000 +0200
+++ scp/source/office/profile.scp	2003-10-22 22:45:15.000000000 +0200
@@ -2201,7 +2201,7 @@ ConfigurationItem GID_CONFIGURATIONITEM_
     ModuleID = GID_MODULE_SO_ROOT;
     Path        = "org.openoffice.Office.Common/Path/Current";
     Key         = "OfficeInstall";
-    Value       = "<progpath>";
+    Value       = "<progpath_nodestdir>";
     Styles      = (CFG_STRING, WORKSTATION);
 End
 
Index: setup2/mow/source/system/mowos.cxx
===================================================================
--- setup2/mow/source/system/mowos.cxx.orig	2003-07-16 19:59:34.000000000 +0200
+++ setup2/mow/source/system/mowos.cxx	2003-10-22 22:45:15.000000000 +0200
@@ -394,6 +394,18 @@ BOOL UnixOS::CreateHardLink
 	return link(aSource.GetBuffer(),aDest.GetBuffer()) == 0;
 }
 
+ByteString UnixOS::GetTargetPath( ByteString const &aPath)
+{
+	const char *destdir;
+	ByteString aResult = aPath;
+
+	if ( (destdir = getenv( "DESTDIR" )) ||
+	     (destdir = getenv( "OODESTDIR" )) )
+	    aResult.SearchAndReplace( destdir, ByteString() );
+
+	return aResult;
+}
+
 BOOL UnixOS::ConvertShellScript(
 	SiDirEntry const& aDest,
 	SiDirEntry const& aSource,
@@ -404,11 +416,15 @@ BOOL UnixOS::ConvertShellScript(
 	SvFileStream aDestStream( aDest.GetFullUni(), STREAM_READWRITE | STREAM_TRUNC );
 	SvFileStream aSourceStream( aSource.GetFullUni(), STREAM_READ );
 	ByteString aLine;
+	ByteString aProgNoDestPath;
+
+	aProgNoDestPath = GetTargetPath( rProgPath );
 
 	while ( aSourceStream.ReadLine( aLine ))
 	{
 		aLine.SearchAndReplace("<workpath>", rWorkPath);
 		aLine.SearchAndReplace("<progpath>", rProgPath);
+		aLine.SearchAndReplace("<progpath_nodestdir>", aProgNoDestPath);
 		if (! aDestStream.WriteLine( aLine ))
 			return FALSE;
 	}
Index: setup2/source/agenda/environ.cxx
===================================================================
--- setup2/source/agenda/environ.cxx.orig	2003-05-15 11:39:38.000000000 +0200
+++ setup2/source/agenda/environ.cxx	2003-10-22 22:46:44.000000000 +0200
@@ -291,6 +291,9 @@ void SiEnvironment::InitReplacement( SiI
 
     AddReplacement( "<progpath>", GetProgPath( eIMode ), OSL_GETTHREADTEXTENCODING );
     AddReplacement( "<workpath>", GetWorkPath( eIMode ), OSL_GETTHREADTEXTENCODING );
+#ifdef UNX
+    AddReplacement( "<progpath_nodestdir>", UnixOS::GetTargetPath( GetProgPath( eIMode ) ), OSL_GETTHREADTEXTENCODING );
+#endif
 
 	UniString suProgPath( GetProgPath( eIMode ), osl_getThreadTextEncoding() );
 	rtl::OUString suProgPathURL;
Index: setup2/inc/os.hxx
===================================================================
--- setup2/inc/os.hxx.orig	2003-03-27 12:07:06.000000000 +0100
+++ setup2/inc/os.hxx	2003-10-22 22:45:15.000000000 +0200
@@ -296,6 +296,7 @@ public:
 	static BOOL  	IsRoot();
 
 	static DateTime GetDateTime(ByteString const& aFile);
+	static ByteString GetTargetPath( ByteString const &aPath);
 
 	static BOOL     SetRights( ByteString const& rFile, int nRights );
 	static void		ChangeOwnerRecursive( const ByteString aPath, const ByteString& rUserName );
