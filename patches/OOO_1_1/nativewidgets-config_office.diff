--- config_office/configure.in	3 Mar 2004 15:21:04 -0000
+++ config_office/configure.in	2004-06-15 10:39:12.530630080 +0200
@@ -86,6 +86,22 @@
 AC_ARG_WITH(system-zlib,
 [  --with-system-zlib      Use zlib already on system
 ],,)
+AC_ARG_WITH(widgetset,
+[  --with-widgetset        Determines the set of native widgets used for rendering
+                          controls.  If not specified, regular old Windows-ish
+                          widgets are used as always.
+                            Available native widget sets:
+                              aqua     - Mac OS X Aqua widgets
+                              gtk      - Linux GTK+ widgets
+                              kde      - Linux KDE widgets
+
+                          Usage: --with-widgetset=<aqua|gtk|kde|etc...>
+],,)
+AC_ARG_ENABLE(kde_fpicker,
+[  --enable-kde-fpicker    Enables usage of the KDE native file dialog.
+
+                          Usage: --enable-kde-fpicker
+],,)
 AC_ARG_WITH(stlport4-home,
 [  --with-stlport4-home    The location that STLport4 is installed in. The STL
                           header files are assumed to be in stlport4-home/stlport
@@ -1694,6 +1714,106 @@
 AC_SUBST(WITH_LIBSN)
 AC_SUBST(LIBSN_CFLAGS)
 AC_SUBST(LIBSN_LIBS)
+
+dnl ===================================================================
+dnl  Test for Native Widget set
+dnl ===================================================================
+
+WITH_WIDGETSET=
+ENABLE_FPICKER_KDE=
+if test "$with_widgetset" = "aqua" ; then
+	WITH_WIDGETSET="aqua"
+fi
+if test "$with_widgetset" = "gtk" ; then
+	PKG_CHECK_MODULES( WIDGETSET, gtk+-2.0 >= 0 )
+	PKG_CHECK_MODULES( GDKPIXBUF, gdk-pixbuf-xlib-2.0 >=  0 )	
+	WITH_WIDGETSET="gtk"
+	WIDGETSET_CFLAGS="$WIDGETSET_CFLAGS $GDKPIXBUF_CFLAGS -DWIDGETSET_GTK"
+	WIDGETSET_LIBS="$WIDGETSET_LIBS $GDKPIXBUF_LIBS"
+fi
+if test "$with_widgetset" = "kde" -o "$enable_kde_fpicker" = "yes" ; then
+	dnl Search paths for Qt and KDE
+	qt_incdirs="$QTINC /usr/local/qt/include /usr/include/qt /usr/include /usr/X11R6/include/X11/qt /usr/X11R6/include/qt /usr/lib/qt3/include /usr/lib/qt/include /usr/share/qt3/include $x_includes"
+	if test -n "$QTDIR" ; then
+		qt_incdirs="$QTDIR/include $qt_incdirs"
+	fi
+	kde_incdirs="/usr/lib/kde/include /usr/local/kde/include /usr/local/include /usr/kde/include /usr/include/kde /usr/include /opt/kde3/include /opt/kde/include $x_includes"
+	kde_libdirs="/usr/lib/kde/lib /usr/local/kde/lib /usr/kde/lib /usr/lib/kde /usr/lib/kde3 /usr/lib /usr/X11R6/lib /usr/local/lib /opt/kde3/lib /opt/kde/lib /usr/X11R6/kde/lib"
+	if test -n "$KDEDIR" ; then
+		kde_incdirs="$KDEDIR/include $kde_incdirs"
+		kde_libdirs="$KDEDIR/lib $kde_libdirs"
+	fi
+
+	dnl What to test
+	qt_test_include="qstyle.h"
+	kde_test_include="ksharedptr.h"
+	kde_test_library="libkdeui.la"
+
+	dnl Check for Qt headers
+	AC_MSG_CHECKING([for Qt headers])
+	qt_incdir="no"
+	for kde_check in $qt_incdirs ; do
+		if test -r "$kde_check/$qt_test_include" ; then
+			qt_incdir="$kde_check"
+			break
+		fi
+	done
+	AC_MSG_RESULT([$qt_incdir])
+	if test "x$qt_incdir" == "xno" ; then
+		AC_MSG_ERROR([Qt headers not found.  Please specify the root of
+your Qt installation by exporting QTDIR before running "configure".])
+	fi
+
+	dnl Check for KDE headers
+	AC_MSG_CHECKING([for KDE headers])
+	kde_incdir="no"
+	for kde_check in $kde_incdirs ; do
+		if test -r "$kde_check/$kde_test_include" ; then
+			kde_incdir="$kde_check"
+			break
+		fi
+	done
+	AC_MSG_RESULT([$kde_incdir])
+	if test "x$kde_incdir" == "xno" ; then
+		AC_MSG_ERROR([KDE headers not found.  Please specify the root of
+your KDE installation by exporting KDEDIR before running "configure".])
+	fi
+
+	dnl Check for KDE libraries
+	AC_MSG_CHECKING([for KDE libraries])
+	kde_libdir="no"
+	for kde_check in $kde_libdirs ; do
+		if test -r "$kde_check/$kde_test_library" ; then
+			kde_libdir="$kde_check"
+			break
+		fi
+	done
+	AC_MSG_RESULT([$kde_libdir])
+	if test "x$kde_libdir" == "xno" ; then
+		AC_MSG_ERROR([KDE libraries not found.  Please specify the root of
+your KDE installation by exporting KDEDIR before running "configure".])
+	fi
+
+	dnl Set the variables
+	if test "$with_widgetset" = "kde"; then
+		WITH_WIDGETSET="kde"
+		WIDGETSET_CFLAGS="-I$qt_incdir -I$kde_incdir -DQT_CLEAN_NAMESPACE -DQT_THREAD_SUPPORT -DWIDGETSET_KDE"
+		WIDGETSET_LIBS="-L$kde_libdir -lkdeui"
+	fi
+	if test "$enable_kde_fpicker" = "yes"; then
+		ENABLE_FPICKER_KDE="TRUE"
+		FPICKER_KDE_CFLAGS="-I$qt_incdir -I$kde_incdir -DQT_CLEAN_NAMESPACE -DQT_THREAD_SUPPORT -DFPICKER_KDE"
+		FPICKER_KDE_LIBS="-L$kde_libdir -lkdeui"
+	fi
+fi
+
+AC_SUBST(WITH_WIDGETSET)
+AC_SUBST(WIDGETSET_CFLAGS)
+AC_SUBST(WIDGETSET_LIBS)
+
+AC_SUBST(ENABLE_FPICKER_KDE)
+AC_SUBST(FPICKER_KDE_CFLAGS)
+AC_SUBST(FPICKER_KDE_LIBS)
 
 dnl ===================================================================
 dnl Disable mozilla if we can
diff -u config_office/set_soenv.in config_office/set_soenv.in
--- config_office/set_soenv.in	3 Mar 2004 15:21:04 -0000
+++ config_office/set_soenv.in	2004-06-15 10:25:25.625338792 +0200
@@ -1784,6 +1784,12 @@
 ToFile( "BUILD_DMAKE",       "@BUILD_DMAKE@",      "e" );
 ToFile( "GXX_INCLUDE_PATH",  "@GXX_INCLUDE_PATH@", "e" );
 ToFile( "COMMON_BUILD_TOOLS",$COMMON_BUILD_TOOLS,  "e" );
+ToFile( "WITH_WIDGETSET",    "@WITH_WIDGETSET@",   "e" );
+ToFile( "WIDGETSET_CFLAGS",  "@WIDGETSET_CFLAGS@", "e" );
+ToFile( "WIDGETSET_LIBS",    "@WIDGETSET_LIBS@",   "e" );
+ToFile( "ENABLE_FPICKER_KDE","@ENABLE_FPICKER_KDE@","e" );
+ToFile( "FPICKER_KDE_CFLAGS","@FPICKER_KDE_CFLAGS@","e" );
+ToFile( "FPICKER_KDE_LIBS",  "@FPICKER_KDE_LIBS@",  "e" );
 if ($platform ne "$Winnt")
 {  ToFile( "TEMP",              $TEMP,              "e" );
    ToFile( "TMP",               $TEMP,              "e" );
