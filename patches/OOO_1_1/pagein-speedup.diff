Index: desktop/source/pagein/makefile.mk
===================================================================
RCS file: /cvs/framework/desktop/source/pagein/makefile.mk,v
retrieving revision 1.4
diff -u -p -u -r1.4 makefile.mk
--- desktop/source/pagein/makefile.mk	7 Jul 2003 10:47:49 -0000	1.4
+++ desktop/source/pagein/makefile.mk	28 Oct 2003 17:51:23 -0000
@@ -91,76 +91,58 @@ STDLIB+=-library=no%Crun
 
 # --- Targets ------------------------------------------------------
 
-ALL: \
-	$(MISC)$/$(TARGET)-calc    \
-	$(MISC)$/$(TARGET)-draw    \
-	$(MISC)$/$(TARGET)-impress \
-	$(MISC)$/$(TARGET)-writer  \
-	$(MISC)$/$(TARGET)-common  \
-    ALLTAR
-
 .INCLUDE :  target.mk
 
 ICUDLLPOST=$(DLLPOST).22
 UDKDLLPOST=$(DLLPOST).$(UDK_MAJOR)
 UPDDLLPOST=$(UPD)$(DLLPOSTFIX)$(DLLPOST)
 
-$(MISC)$/$(TARGET)-calc : makefile.mk
-	@+echo Making: $@
-	@+echo $(DLLPRE)sc$(UPDDLLPOST)  >  $@
-
-$(MISC)$/$(TARGET)-draw : makefile.mk
-	@+echo Making: $@
-	@+echo $(DLLPRE)sd$(UPDDLLPOST)  >  $@
-
-$(MISC)$/$(TARGET)-impress : makefile.mk
-	@+echo Making: $@
-	@+echo $(DLLPRE)sd$(UPDDLLPOST)  >  $@
-
-$(MISC)$/$(TARGET)-writer : makefile.mk
-	@+echo Making: $@
-	@+echo $(DLLPRE)sw$(UPDDLLPOST)  >  $@
+$(OBJ)/pagein.obj : $(INCCOM)$/$(TARGET)-names.h
 
-# sorted in reverse load order (ld.so.1)
-$(MISC)$/$(TARGET)-common : makefile.mk
+$(INCCOM)$/$(TARGET)-names.h : makefile.mk
 	@+echo Making: $@
-	@-+echo $(DLLPRE)icui18n$(ICUDLLPOST)  >  $@
-	@-+echo $(DLLPRE)i18npool$(UPDDLLPOST) >> $@
+	@+echo 'char calc_name[]    = "$(DLLPRE)sc$(UPDDLLPOST)";'  >  $@
+	@-+echo 'char draw_name[]    = "$(DLLPRE)sd$(UPDDLLPOST)";'  >>  $@
+	@-+echo 'char writer_name[]  = "$(DLLPRE)sw$(UPDDLLPOST)";'  >>  $@
+	@-+echo 'char *common_names[] = {{' >> $@
+	@-+echo '"$(DLLPRE)icui18n$(ICUDLLPOST)",'  >> $@
+	@-+echo '"$(DLLPRE)i18npool$(UPDDLLPOST)",' >> $@
 #
-	@-+echo $(DLLPRE)xcr$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)xo$(UPDDLLPOST)    >> $@
-	@-+echo $(DLLPRE)go$(UPDDLLPOST)    >> $@
-	@-+echo $(DLLPRE)sb$(UPDDLLPOST)    >> $@
-	@-+echo $(DLLPRE)sfx$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)svx$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)ofa$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)so$(UPDDLLPOST)    >> $@
+	@-+echo '"$(DLLPRE)xcr$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)xo$(UPDDLLPOST)",'    >> $@
+	@-+echo '"$(DLLPRE)go$(UPDDLLPOST)",'    >> $@
+	@-+echo '"$(DLLPRE)sb$(UPDDLLPOST)",'    >> $@
+	@-+echo '"$(DLLPRE)sfx$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)svx$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)ofa$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)so$(UPDDLLPOST)",'    >> $@
 #
-	@-+echo $(DLLPRE)fwe$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)fwk$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)ucpfile1$(DLLPOST) >> $@
-	@-+echo $(DLLPRE)fwi$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)fwl$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)cfgmgr2$(DLLPOST)  >> $@
+	@-+echo '"$(DLLPRE)fwe$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)fwk$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)ucpfile1$(DLLPOST)",' >> $@
+	@-+echo '"$(DLLPRE)fwi$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)fwl$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)cfgmgr2$(DLLPOST)",'  >> $@
 #
-	@-+echo $(DLLPRE)icuuc$(ICUDLLPOST) >> $@
-	@-+echo $(DLLPRE)sot$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)psp$(UPDDLLPOST)   >> $@
+	@-+echo '"$(DLLPRE)icuuc$(ICUDLLPOST)",' >> $@
+	@-+echo '"$(DLLPRE)sot$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)psp$(UPDDLLPOST)",'   >> $@
 .IF "$(COMNAME)" == "gcc2" || "$(COMNAME)" == "gcc3"
-	@-+echo $(DLLPRE)stlport_gcc$(DLLPOST)    >> $@
+	@-+echo '"$(DLLPRE)stlport_gcc$(DLLPOST)",'    >> $@
 .ENDIF # gcc
 .IF "$(COMNAME)" == "sunpro5"
-	@-+echo $(DLLPRE)stlport_sunpro$(DLLPOST) >> $@
+	@-+echo '"$(DLLPRE)stlport_sunpro$(DLLPOST)",' >> $@
 .ENDIF # sunpro5
-	@-+echo $(DLLPRE)sal$(UDKDLLPOST)   >>  $@
-	@-+echo $(DLLPRE)cppu$(UDKDLLPOST)  >> $@
-	@-+echo $(DLLPRE)cppuhelper$(COMID)$(UDKDLLPOST)               >> $@
-	@-+echo $(DLLPRE)ucbhelper$(UCBHELPER_MAJOR)$(COMID)$(DLLPOST) >> $@
-	@-+echo $(DLLPRE)comphelp$(COMPHLP_MAJOR)$(COMID)$(DLLPOST)    >> $@
-	@-+echo $(DLLPRE)tl$(UPDDLLPOST)    >> $@
-	@-+echo $(DLLPRE)utl$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)svl$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)vcl$(UPDDLLPOST)   >> $@
-	@-+echo $(DLLPRE)tk$(UPDDLLPOST)    >> $@
-	@-+echo $(DLLPRE)svt$(UPDDLLPOST)   >> $@
-	@-+echo soffice.bin                 >> $@
+	@-+echo '"$(DLLPRE)sal$(UDKDLLPOST)",'   >>  $@
+	@-+echo '"$(DLLPRE)cppu$(UDKDLLPOST)",'  >> $@
+	@-+echo '"$(DLLPRE)cppuhelper$(COMID)$(UDKDLLPOST)",'               >> $@
+	@-+echo '"$(DLLPRE)ucbhelper$(UCBHELPER_MAJOR)$(COMID)$(DLLPOST)",' >> $@
+	@-+echo '"$(DLLPRE)comphelp$(COMPHLP_MAJOR)$(COMID)$(DLLPOST)",'    >> $@
+	@-+echo '"$(DLLPRE)tl$(UPDDLLPOST)",'    >> $@
+	@-+echo '"$(DLLPRE)utl$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)svl$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)vcl$(UPDDLLPOST)",'   >> $@
+	@-+echo '"$(DLLPRE)tk$(UPDDLLPOST)",'    >> $@
+	@-+echo '"$(DLLPRE)svt$(UPDDLLPOST)",'   >> $@
+	@-+echo '"soffice.bin"'            >> $@
+	@-+echo '}};'                         >> $@
Index: desktop/source/pagein/pagein.c
===================================================================
RCS file: /cvs/framework/desktop/source/pagein/pagein.c,v
retrieving revision 1.2
diff -u -p -u -r1.2 pagein.c
--- desktop/source/pagein/pagein.c	4 Jun 2003 10:43:30 -0000	1.2
+++ desktop/source/pagein/pagein.c	28 Oct 2003 17:51:23 -0000
@@ -60,11 +60,53 @@
  ************************************************************************/
 
 #include "file_image.h"
+#include "pagein-names.h"
 
 #include <unistd.h>
 #include <errno.h>
 #include <stdio.h>
 #include <string.h>
+#include <sys/types.h>
+#include <dirent.h>
+
+typedef enum {
+		PAGEIN_NONE,
+		PAGEIN_SC = 0x1,
+		PAGEIN_SD = 0x2,
+		PAGEIN_SW = 0x4
+} PageInComponent;
+
+static int should_pagein (const char * filename,
+						  PageInComponent nComponent)
+{
+    int i;
+
+    switch (nComponent)
+	{
+	case PAGEIN_SC:
+		if (!strcmp (filename, calc_name))
+			return 1;
+		break;
+	case PAGEIN_SD:
+		if (!strcmp (filename, draw_name))
+			return 1;
+		break;
+	case PAGEIN_SW:
+		if (!strcmp (filename, writer_name))
+			return 1;
+		break;
+	default:
+		break;
+	}
+
+	for (i = 0; i < sizeof (common_names) / sizeof (common_names[0]); i++)
+	{
+        if (!strcmp( filename, common_names[i]))
+            return 1;
+	}
+
+	return 0;
+}
 
 /* do_pagein */
 static int do_pagein (const char * filename, size_t * size)
@@ -96,6 +138,7 @@ int  main (int argc, char **argv)
 {
 	int    i, v = 0;
 	size_t nfiles = 0, nbytes = 0;
+	PageInComponent nComponent = PAGEIN_NONE;
 
 	if (argc < 2)
 	{
@@ -137,28 +180,15 @@ int  main (int argc, char **argv)
 		}
 		
 
-		if ((argv[i][0] == '@') && ((fp = fopen (argv[i], "r")) == 0))
+		if ((argv[i][0] == '@'))
 		{
-			char path[1024];
-			if ((fp = fopen (&(argv[i][1]), "r")) == 0)
-			{
-				fprintf (stderr, "fopen: %s\n", strerror(errno));
-				continue;
-			}
-			while (fgets (path, sizeof(path), fp) != 0)
-			{
-				path[strlen(path) - 1] = '\0', k = 0;
-				if (do_pagein (path, &k) == 0)
-				{
-					/* accumulate total size */
-					nbytes += k;
-				}
-
-				if (v >= 2)
-					fprintf (stderr, "pagein(\"%s\") = %d bytes\n", path, k);
-				nfiles += 1;
-			}
-			fclose (fp);
+            if (strstr (argv[i], "draw") ||
+				strstr (argv[i], "impress"))
+				nComponent |= PAGEIN_SD;
+			if (strstr (argv[i], "write"))
+				nComponent |= PAGEIN_SW;
+			if (strstr (argv[i], "calc"))
+				nComponent |= PAGEIN_SC;
 		}
 		else
 		{
@@ -174,6 +204,40 @@ int  main (int argc, char **argv)
 			if (v >= 2)
 				fprintf (stderr, "pagein(\"%s\") = %d bytes\n", argv[i], k);
 			nfiles += 1;
+		}
+	}
+
+
+	if (nComponent != PAGEIN_NONE)
+	{
+        DIR *dirh;
+		
+		if (!(dirh = opendir (".")))
+				fprintf (stderr, "Can't open directory\n");
+		else
+		{
+            struct dirent *dent;
+				
+			while ((dent = readdir (dirh)))
+			{
+                if (should_pagein (dent->d_name, nComponent))
+						fprintf( stderr, "Should page in '%s'\n", dent->d_name);
+				else
+						fprintf( stderr, "Skip '%s'\n", dent->d_name);
+
+#if 0
+				if (do_pagein (path, &k) == 0)
+				{
+					/* accumulate total size */
+					nbytes += k;
+				}
+
+				if (v >= 2)
+					fprintf (stderr, "pagein(\"%s\") = %d bytes\n", path, k);
+				nfiles += 1;
+#endif
+			}
+			closedir (dirh);
 		}
 	}
 
