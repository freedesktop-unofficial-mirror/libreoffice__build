Index: solenv/bin/deliver.pl
===================================================================
RCS file: /cvs/tools/solenv/bin/deliver.pl,v
retrieving revision 1.50.8.2
diff -u -p -u -r1.50.8.2 deliver.pl
--- solenv/bin/deliver.pl	28 Jan 2004 17:28:59 -0000	1.50.8.2
+++ solenv/bin/deliver.pl	2 Apr 2004 00:58:50 -0000
@@ -673,6 +673,20 @@ sub copy_if_newer 
         return 0;
     }
 
+    my $incdir = $ENV{'SOLARENVINC'};
+    if ($to =~ /[\/\\]inc[\/\\].*\.h*/ && -f $to) {
+	my $to_content = slurp ($to);
+	my $from_content = slurp ($from);
+
+	if (length ($from_content) == length ($to_content) &&
+	    $from_content eq $to_content) {
+	    print "COPY: skipping identical header $to\n";
+	    return 1;
+	} else {
+	    print "Header content different for $to\n";
+        }
+    }
+
     if( !$opt_check && $opt_link ) {
         # hard link if possible
         if( link($from, $to) ){
@@ -886,6 +900,21 @@ sub walk_hedabu_list 
     }
 }
 
+sub slurp {
+    my $from = shift;
+    my $save = $/;
+    my $FROM;
+
+    undef $/;
+    open ($FROM, "<$from");
+    # slurp whole file in one big string
+    my $content = <$FROM>;
+    close ($FROM);
+    $/ = $save;
+
+    return $content;
+}
+
 sub hedabu_if_newer 
 {
     my $from = shift;
@@ -907,13 +936,7 @@ sub hedabu_if_newer 
         
         return 1 if $opt_check;
 
-        my $save = $/;
-        undef $/;
-        open(FROM, "<$from");
-        # slurp whole file in one big string
-        my $content = <FROM>;
-        close(FROM);
-        $/ = $save;
+        my $content = slurp ($from);
 
         # strip any carriage returns
         $content =~ tr/\r//d;
@@ -928,6 +951,18 @@ sub hedabu_if_newer 
 
         # __SOLAR_PRIVATE hack
         $content =~ s/#if _SOLAR__PRIVATE/#if 0 \/\/ _SOLAR__PRIVATE/g;
+
+        if( -f $to) {
+            my $to_content = slurp ("$to");
+
+            if (length ($content) == length ($to_content) &&
+                   $content eq $to_content) {
+                   print "HEDABU: skipping identical header $to\n";
+                   return 1;
+            } else {
+                   print "Header content different $a $b\n";
+            }
+        }
 
         open(TO, ">$to");
         print TO $content;
