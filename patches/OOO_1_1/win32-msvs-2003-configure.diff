Index: config_office/configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.55.6.8.2.4
diff -u -p -u -r1.55.6.8.2.4 configure.in
--- config_office/configure.in	25 May 2004 13:16:00 -0000	1.55.6.8.2.4
+++ config_office/configure.in	24 Jun 2004 12:02:22 -0000
@@ -701,6 +701,16 @@ dnl  Check which Microsoft C/C++ or MinG
 dnl ===================================================================
 if test "$_os" = "WINNT"; then
 	if test "$WITH_MINGWIN" != "yes"; then
+		AC_MSG_CHECKING([for friendly registry keys])
+		# VS.Net 2003, VS.Net 2002, VC6
+		if test -z "$with_cl_home"; then
+		    vctest=`./oowintool --msvc-productdir`;
+		    if test -x "$vctest/bin/cl.exe"; then
+			with_cl_home=$vctest;
+		    fi
+		fi
+		AC_MSG_RESULT([done])
+
 		AC_MSG_CHECKING([the Microsoft C/C++ Compiler])
 		dnl ===========================================================
 		dnl  Check for mspdb?0.dll
@@ -779,7 +789,7 @@ if test "$_os" = "WINNT"; then
 							}
 							}"`
 			AC_MSG_RESULT([found Compiler version $CCNUMVER.])
-			if test "$CCNUMVER" -ge "001300103077"; then
+			if test "$CCNUMVER" -ge "001300102240"; then
 				COMEX=10
 			else
 				if test "$CCNUMVER" -ge "001300000000"; then
@@ -1496,7 +1506,7 @@ if test \( "$_os" = "WINNT" \) ; then
 	if test -z "$with_psdk_home"; then
 		# This line will work with cygwin 1.3.? and newer, for older versions
 		# cat will output nothing, therefore PSDK_HOME will be empty.
-		PSDK_HOME=`cat "/proc/registry/HKEY_LOCAL_MACHINE/SOFTWARE/Microsoft/MicrosoftSDK/Directories/Install Dir"`
+		PSDK_HOME=`./oowintool --psdk-home`
 	else
 		PSDK_HOME="$with_psdk_home"
 	fi
@@ -1686,6 +1696,13 @@ Get it from the Microsoft site and put i
 may have to search Microsoft's website.) Last time it was seen at:
 <http://www.microsoft.com/downloads/release.asp?releaseid=30682>.])
    fi
+fi
+
+dnl ===================================================================
+dnl Windows builds - attempt to auto-copy required dlls into external/
+dnl ===================================================================
+if test "$_os" = "WINNT"; then
+	./oowintool --msvc-copy-dlls ../external/msvcp
 fi
 
 dnl ===================================================================
