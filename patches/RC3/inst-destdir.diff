Index: scp/source/office/profile.scp
===================================================================
RCS file: /cvs/installation/scp/source/office/profile.scp,v
retrieving revision 1.176
diff -u -p -u -r1.176 profile.scp
--- scp/source/office/profile.scp	2 May 2003 15:32:03 -0000	1.176
+++ scp/source/office/profile.scp	14 May 2003 15:15:28 -0000
@@ -2191,7 +2191,7 @@ ConfigurationItem GID_CONFIGURATIONITEM_
     ModuleID = GID_MODULE_SO_ROOT;
     Path        = "org.openoffice.Office.Common/Path/Current";
     Key         = "OfficeInstall";
-    Value       = "<progpath>";
+    Value       = "<progpath_nodestdir>";
     Styles      = (CFG_STRING, WORKSTATION);
 End
 
Index: setup2/mow/source/system/mowos.cxx
===================================================================
RCS file: /cvs/installation/setup2/mow/source/system/mowos.cxx,v
retrieving revision 1.10
diff -u -p -u -r1.10 mowos.cxx
--- setup2/mow/source/system/mowos.cxx	4 Apr 2003 15:08:43 -0000	1.10
+++ setup2/mow/source/system/mowos.cxx	14 May 2003 15:17:39 -0000
@@ -394,6 +394,18 @@ BOOL UnixOS::CreateHardLink
 	return link(aSource.GetBuffer(),aDest.GetBuffer()) == 0;
 }
 
+ByteString UnixOS::GetTargetPath( ByteString const &aPath)
+{
+	const char *destdir;
+	ByteString aResult = aPath;
+
+	if ( (destdir = getenv( "DESTDIR" )) ||
+	     (destdir = getenv( "OODESTDIR" )) )
+	    aResult.SearchAndReplace( destdir, ByteString() );
+
+	return aResult;
+}
+
 BOOL UnixOS::ConvertShellScript(
 	SiDirEntry const& aDest,
 	SiDirEntry const& aSource,
@@ -404,11 +416,15 @@ BOOL UnixOS::ConvertShellScript(
 	SvFileStream aDestStream( aDest.GetFullUni(), STREAM_READWRITE | STREAM_TRUNC );
 	SvFileStream aSourceStream( aSource.GetFullUni(), STREAM_READ );
 	ByteString aLine;
+	ByteString aProgNoDestPath;
+
+	aProgNoDestPath = GetTargetPath( rProgPath );
 
 	while ( aSourceStream.ReadLine( aLine ))
 	{
 		aLine.SearchAndReplace("<workpath>", rWorkPath);
 		aLine.SearchAndReplace("<progpath>", rProgPath);
+		aLine.SearchAndReplace("<progpath_nodestdir>", aProgNoDestPath);
 		if (! aDestStream.WriteLine( aLine ))
 			return FALSE;
 	}
Index: setup2/source/agenda/environ.cxx
===================================================================
RCS file: /cvs/installation/setup2/source/agenda/environ.cxx,v
retrieving revision 1.53
diff -u -p -u -r1.53 environ.cxx
--- setup2/source/agenda/environ.cxx	17 Apr 2003 15:47:28 -0000	1.53
+++ setup2/source/agenda/environ.cxx	14 May 2003 15:18:22 -0000
@@ -291,6 +291,9 @@ void SiEnvironment::InitReplacement( SiI
 
 	AddReplacement( "<progpath>", GetProgPath( eIMode ), OSL_GETTHREADTEXTENCODING );
 	AddReplacement( "<workpath>", GetWorkPath( eIMode ), OSL_GETTHREADTEXTENCODING );
+#ifdef UNX
+	AddReplacement( "<progpath_nodestdir>", UnixOS::GetTargetPath( GetProgPath( eIMode ) ), OSL_GETTHREADTEXTENCODING );
+#endif
 
 	UniString suProgPath( GetProgPath( eIMode ), osl_getThreadTextEncoding() );
 	rtl::OUString suProgPathURL;
Index: setup2/inc/os.hxx
===================================================================
RCS file: /cvs/installation/setup2/inc/os.hxx,v
retrieving revision 1.21
diff -u -p -u -r1.21 os.hxx
--- setup2/inc/os.hxx	27 Mar 2003 11:07:06 -0000	1.21
+++ setup2/inc/os.hxx	15 May 2003 07:29:08 -0000
@@ -296,6 +295,7 @@ public:
 	static BOOL  	IsRoot();
 
 	static DateTime GetDateTime(ByteString const& aFile);
+	static ByteString GetTargetPath( ByteString const &aPath);
 
 	static BOOL     SetRights( ByteString const& rFile, int nRights );
 	static void		ChangeOwnerRecursive( const ByteString aPath, const ByteString& rUserName );
