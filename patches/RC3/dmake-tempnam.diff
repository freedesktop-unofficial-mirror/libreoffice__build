Fix for tempnam vulnerability, IZ#7800

Index: dmake/config.h.in
===================================================================
RCS file: /cvs/tools/dmake/config.h.in,v
retrieving revision 1.8
diff -u -3 -p -r1.8 config.h.in
--- dmake/config.h.in	25 Mar 2003 14:02:09 -0000	1.8
+++ dmake/config.h.in	14 Jul 2003 13:51:57 -0000
@@ -67,6 +67,12 @@
 /* Define to 1 if you have the `strstr' function. */
 #undef HAVE_STRSTR
 
+/* Define if you have the mkstemp function.  */
+#undef HAVE_MKSTEMP
+
+/* Define if you have the tempnam function.  */
+#undef HAVE_TEMPNAM
+
 /* Define to 1 if you have the <sys/dir.h> header file, and it defines `DIR'.
    */
 #undef HAVE_SYS_DIR_H
Index: dmake/configure.in
===================================================================
RCS file: /cvs/tools/dmake/configure.in,v
retrieving revision 1.19
diff -u -3 -p -r1.19 configure.in
--- dmake/configure.in	25 Mar 2003 14:02:10 -0000	1.19
+++ dmake/configure.in	14 Jul 2003 13:51:57 -0000
@@ -47,7 +47,7 @@ AC_FUNC_MEMCMP
 AC_TYPE_SIGNAL
 AC_FUNC_UTIME_NULL
 AC_FUNC_VPRINTF
-AC_CHECK_FUNCS(getcwd getwd putenv strcspn strerror strspn strstr setvbuf tzset settz)
+AC_CHECK_FUNCS(getcwd getwd putenv strcspn strerror strspn strstr setvbuf tzset settz mkstemp tempnam)
 
 dnl Checks for OS
 AC_MSG_CHECKING([the operating system])
Index: dmake/function.c
===================================================================
RCS file: /cvs/tools/dmake/function.c,v
retrieving revision 1.4
diff -u -3 -p -r1.4 function.c
--- dmake/function.c	25 Mar 2003 14:02:11 -0000	1.4
+++ dmake/function.c	14 Jul 2003 13:51:57 -0000
@@ -346,8 +346,11 @@ char *data;
       char *newtmp;
 
       /* This call to Get_temp sets TMPFILE for subsequent expansion of file.
-       * DO NOT DELETE IT! */
-      Get_temp( &newtmp, "", FALSE ); FREE(newtmp);
+	   * The contents file variable passed may include TMPFILE to be expanded. */
+      /* Using TMPFILE as an argument to mktmp is no longer supported because it is not
+       * safe to create a random filename and assume the file does not exist.  Howver,
+       * we still allow Expand() to do its job for fixed filenames */
+      /* Get_temp( &newtmp, "", FALSE ); FREE(newtmp); */
       tmpname = Expand(file);
 
       if( *tmpname ) {
@@ -562,10 +565,9 @@ char *mod1;
    cell.ce_attr   = A_PHONY|A_SILENT;
 
    if( nestlevel == 0 ) {
-      tmpnm   = tempnam(NIL(char),"mk");
       org_out = dup(1);
 
-      if( (tmp = fopen(tmpnm, "w+")) == NIL(FILE) )
+      if( (tmp = Get_temp(&tmpnm, "", "w+")) == NIL(FILE) )
 	 Open_temp_error( tmpnm, cname.ht_name );
 
       close(1);
Index: dmake/sysintf.c
===================================================================
RCS file: /cvs/tools/dmake/sysintf.c,v
retrieving revision 1.4
diff -u -3 -p -r1.4 sysintf.c
--- dmake/sysintf.c	11 Oct 2002 13:42:44 -0000	1.4
+++ dmake/sysintf.c	14 Jul 2003 13:51:57 -0000
@@ -441,7 +441,40 @@ Get_switch_char()
    return( getswitchar() );
 }
 
+/*
+** Create a temporary file and open with exclusive access
+** Path is updated with the filename and the file descriptor
+** is returned.  Note that the new name should be freed when
+** the file is removed.
+**/
+int Create_temp(tmpdir, path, suff)
+char *tmpdir;
+char **path;
+char *suff;
+{
+   int fd;
+
+#if defined(HAVE_MKSTEMP)
+   mode_t       mask;
+
+   *path = DmStrJoin( tmpdir, "/", -1, FALSE);
+   *path = DmStrJoin( *path, "mkXXXXXX", -1, TRUE );
+   *path = DmStrJoin( *path, suff, -1, TRUE );
+   mask = umask(0044);
+   fd = mkstemp( *path );
+   umask(mask);
 
+#elif defined(HAVE_TEMPNAM)
+   *path = DmStrJoin( tempnam(tmpdir, "mk"), suff, -1, TRUE );
+   fd = open(*path, O_CREAT | O_EXCL | O_TRUNC | O_RDWR, 0600);
+#else
+
+#error mkstemp() or tempnam() is needed
+
+#endif
+
+   return fd;
+}
 
 /*
 ** Generate a temporary file name and open the file for writing.
@@ -449,19 +482,40 @@ Get_switch_char()
 ** return -1, else return the fileno of the open file.
 ** and update the source file pointer to point at the new file name.
 ** Note that the new name should be freed when the file is removed.
+** The file stream is opened with the given mode
 */
 PUBLIC FILE*
-Get_temp(path, suff, op)
+Get_temp(path, suff, mode)
 char **path;
 char *suff;
-int  op;
+char *mode;
 {
-   extern char *tempnam();
-
-   *path = DmStrJoin( tempnam(NIL(char), "mk"), suff, -1, TRUE );
-   Def_macro( "TMPFILE", *path, M_MULTI|M_EXPANDED );
+   int          fd;
+   FILE         *fp;
+   char         *tmpdir;
+   int          tries = 20;
+
+   tmpdir = Read_env_string( "TMPDIR" );
+   if( tmpdir == NIL(char) )
+      tmpdir = "/tmp";
+
+   while( --tries )
+   {
+      if( (fd = Create_temp(tmpdir, path, suff)) != -1)
+         break;
+
+      free(*path);
+   }
+
+   if( fd != -1)
+   {
+      Def_macro( "TMPFILE", *path, M_MULTI|M_EXPANDED );
+      fp = fdopen(fd, mode);
+   }
+   else
+      fp = NIL(FILE);
 
-   return( op?fopen(*path, "w"):NIL(FILE) );
+   return fp;
 }
 
 
@@ -480,7 +534,7 @@ char    **fname;
 
    name = (cp != NIL(CELL))?cp->CE_NAME:"makefile text";
 
-   if( (fp = Get_temp(&tmpname, suffix, TRUE)) == NIL(FILE) )
+   if( (fp = Get_temp(&tmpname, suffix, "w")) == NIL(FILE) )
       Open_temp_error( tmpname, name );
 
    Link_temp( cp, fp, tmpname );
Index: dmake/mac/public.h
===================================================================
RCS file: /cvs/tools/dmake/mac/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/mac/public.h	12 Jun 2003 10:50:45 -0000	1.4
+++ dmake/mac/public.h	14 Jul 2003 13:51:57 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/man/dmake.tf
===================================================================
RCS file: /cvs/tools/dmake/man/dmake.tf,v
retrieving revision 1.2
diff -u -3 -p -r1.2 dmake.tf
--- dmake/man/dmake.tf	3 Oct 2002 12:29:46 -0000	1.2
+++ dmake/man/dmake.tf	14 Jul 2003 13:52:00 -0000
@@ -1332,16 +1332,8 @@ The last line of the file is terminated 
 due to the \en found at the end of the \fIdata\fP string.
 .PP
 If the optional \fIfile\fP specifier is present then its expanded value
-is the name of the temporary file to create.  Whenever a $(mktmp ...) macro
-is expanded the macro $(TMPFILE) is set to a new temporary file name.  Thus
-the construct:
-.RS
-.sp
-$(mktmp,$(TMPFILE) data)
-.sp
-.RE
-is completely equivalent to not specifying the $(TMPFILE) optional argument.
-Another example that would be useful for MSDOS users with a Turbo-C compiler
+is the name of the temporary file to create.  An example that would be useful
+for MSDOS users with a Turbo-C compiler
 .RS
 .sp
 $(mktmp,turboc.cfg $(CFLAGS))
Index: dmake/msdos/borland/bcc30/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/borland/bcc30/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/borland/bcc30/public.h	12 Jun 2003 10:50:57 -0000	1.4
+++ dmake/msdos/borland/bcc30/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/borland/bcc40/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/borland/bcc40/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/borland/bcc40/public.h	12 Jun 2003 10:51:09 -0000	1.4
+++ dmake/msdos/borland/bcc40/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/borland/bcc45/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/borland/bcc45/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/borland/bcc45/public.h	12 Jun 2003 10:51:19 -0000	1.4
+++ dmake/msdos/borland/bcc45/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/borland/bcc50/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/borland/bcc50/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/borland/bcc50/public.h	12 Jun 2003 10:51:31 -0000	1.4
+++ dmake/msdos/borland/bcc50/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/borland/tcc20/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/borland/tcc20/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/borland/tcc20/public.h	12 Jun 2003 10:51:41 -0000	1.4
+++ dmake/msdos/borland/tcc20/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/microsft/msc51/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/microsft/msc51/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/microsft/msc51/public.h	12 Jun 2003 10:51:53 -0000	1.4
+++ dmake/msdos/microsft/msc51/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/microsft/msc60/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/microsft/msc60/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/microsft/msc60/public.h	12 Jun 2003 10:52:05 -0000	1.4
+++ dmake/msdos/microsft/msc60/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/msdos/zortech/public.h
===================================================================
RCS file: /cvs/tools/dmake/msdos/zortech/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/msdos/zortech/public.h	12 Jun 2003 10:52:15 -0000	1.4
+++ dmake/msdos/zortech/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/os2/ibm/icc/public.h
===================================================================
RCS file: /cvs/tools/dmake/os2/ibm/icc/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/os2/ibm/icc/public.h	12 Jun 2003 10:52:26 -0000	1.4
+++ dmake/os2/ibm/icc/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/os2/ibm/icc3/public.h
===================================================================
RCS file: /cvs/tools/dmake/os2/ibm/icc3/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/os2/ibm/icc3/public.h	12 Jun 2003 10:52:38 -0000	1.4
+++ dmake/os2/ibm/icc3/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/qssl/public.h
===================================================================
RCS file: /cvs/tools/dmake/qssl/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/qssl/public.h	12 Jun 2003 10:52:50 -0000	1.4
+++ dmake/qssl/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/tos/public.h
===================================================================
RCS file: /cvs/tools/dmake/tos/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/tos/public.h	12 Jun 2003 10:53:07 -0000	1.4
+++ dmake/tos/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/386ix/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/386ix/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/386ix/public.h	12 Jun 2003 10:53:18 -0000	1.4
+++ dmake/unix/386ix/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/bsd43/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/bsd43/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/bsd43/public.h	12 Jun 2003 10:53:29 -0000	1.4
+++ dmake/unix/bsd43/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/bsd43/uw/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/bsd43/uw/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/bsd43/uw/public.h	12 Jun 2003 10:53:40 -0000	1.4
+++ dmake/unix/bsd43/uw/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/bsd43/vf/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/bsd43/vf/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/bsd43/vf/public.h	12 Jun 2003 10:53:52 -0000	1.4
+++ dmake/unix/bsd43/vf/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/bsdarm32/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/bsdarm32/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/bsdarm32/public.h	12 Jun 2003 10:54:02 -0000	1.4
+++ dmake/unix/bsdarm32/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/coherent/ver40/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/coherent/ver40/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/coherent/ver40/public.h	12 Jun 2003 10:54:12 -0000	1.4
+++ dmake/unix/coherent/ver40/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/coherent/ver42/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/coherent/ver42/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/coherent/ver42/public.h	12 Jun 2003 10:54:24 -0000	1.4
+++ dmake/unix/coherent/ver42/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/cygwin/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/cygwin/public.h,v
retrieving revision 1.3
diff -u -3 -p -r1.3 public.h
--- dmake/unix/cygwin/public.h	25 Mar 2003 14:02:46 -0000	1.3
+++ dmake/unix/cygwin/public.h	14 Jul 2003 13:52:00 -0000
@@ -144,7 +144,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/linux/gnu/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/linux/gnu/public.h,v
retrieving revision 1.3
diff -u -3 -p -r1.3 public.h
--- dmake/unix/linux/gnu/public.h	25 Mar 2003 14:02:46 -0000	1.3
+++ dmake/unix/linux/gnu/public.h	14 Jul 2003 13:52:00 -0000
@@ -183,7 +183,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/macosx/gnu/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/macosx/gnu/public.h,v
retrieving revision 1.3
diff -u -3 -p -r1.3 public.h
--- dmake/unix/macosx/gnu/public.h	25 Mar 2003 14:02:47 -0000	1.3
+++ dmake/unix/macosx/gnu/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/solaris/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/solaris/public.h,v
retrieving revision 1.2
diff -u -3 -p -r1.2 public.h
--- dmake/unix/solaris/public.h	13 Jan 2003 14:28:05 -0000	1.2
+++ dmake/unix/solaris/public.h	14 Jul 2003 13:52:00 -0000
@@ -122,7 +122,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/solaris/gnu/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/solaris/gnu/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/solaris/gnu/public.h	12 Jun 2003 10:54:36 -0000	1.4
+++ dmake/unix/solaris/gnu/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/sysvr1/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/sysvr1/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/sysvr1/public.h	12 Jun 2003 10:54:47 -0000	1.4
+++ dmake/unix/sysvr1/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/sysvr3/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/sysvr3/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/sysvr3/public.h	12 Jun 2003 10:54:59 -0000	1.4
+++ dmake/unix/sysvr3/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/sysvr3/gnu/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/sysvr3/gnu/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/sysvr3/gnu/public.h	12 Jun 2003 10:55:10 -0000	1.4
+++ dmake/unix/sysvr3/gnu/public.h	14 Jul 2003 13:52:00 -0000
@@ -121,7 +121,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/sysvr3/pwd/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/sysvr3/pwd/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/sysvr3/pwd/public.h	12 Jun 2003 10:55:21 -0000	1.4
+++ dmake/unix/sysvr3/pwd/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/sysvr4/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/sysvr4/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/sysvr4/public.h	12 Jun 2003 10:55:33 -0000	1.4
+++ dmake/unix/sysvr4/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/xenix/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/xenix/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/xenix/public.h	12 Jun 2003 10:55:47 -0000	1.4
+++ dmake/unix/xenix/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/unix/xenix/pwd/public.h
===================================================================
RCS file: /cvs/tools/dmake/unix/xenix/pwd/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/unix/xenix/pwd/public.h	12 Jun 2003 10:56:00 -0000	1.4
+++ dmake/unix/xenix/pwd/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/win95/borland/bcc50/public.h
===================================================================
RCS file: /cvs/tools/dmake/win95/borland/bcc50/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/win95/borland/bcc50/public.h	12 Jun 2003 10:56:12 -0000	1.4
+++ dmake/win95/borland/bcc50/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/win95/microsft/vpp40/public.h
===================================================================
RCS file: /cvs/tools/dmake/win95/microsft/vpp40/public.h,v
retrieving revision 1.3
diff -u -3 -p -r1.3 public.h
--- dmake/win95/microsft/vpp40/public.h	25 Mar 2003 14:02:54 -0000	1.3
+++ dmake/win95/microsft/vpp40/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/winnt/borland/bcc50/public.h
===================================================================
RCS file: /cvs/tools/dmake/winnt/borland/bcc50/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/winnt/borland/bcc50/public.h	12 Jun 2003 10:56:24 -0000	1.4
+++ dmake/winnt/borland/bcc50/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/winnt/microsft/vpp40/public.h
===================================================================
RCS file: /cvs/tools/dmake/winnt/microsft/vpp40/public.h,v
retrieving revision 1.4
diff -u -3 -p -r1.4 public.h
--- dmake/winnt/microsft/vpp40/public.h	12 Jun 2003 10:56:35 -0000	1.4
+++ dmake/winnt/microsft/vpp40/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/winnt/mingw/public.h
===================================================================
RCS file: /cvs/tools/dmake/winnt/mingw/public.h,v
retrieving revision 1.2
diff -u -3 -p -r1.2 public.h
--- dmake/winnt/mingw/public.h	25 Mar 2003 14:02:56 -0000	1.2
+++ dmake/winnt/mingw/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
Index: dmake/winnt/msvc6/public.h
===================================================================
RCS file: /cvs/tools/dmake/winnt/msvc6/public.h,v
retrieving revision 1.2
diff -u -3 -p -r1.2 public.h
--- dmake/winnt/msvc6/public.h	25 Mar 2003 14:02:57 -0000	1.2
+++ dmake/winnt/msvc6/public.h	14 Jul 2003 13:52:00 -0000
@@ -123,7 +123,7 @@ void Epilog ANSI((int));
 char *Get_current_dir ANSI(());
 int Set_dir ANSI((char*));
 char Get_switch_char ANSI(());
-FILE* Get_temp ANSI((char **, char *, int));
+FILE* Get_temp ANSI((char **, char *, char *));
 FILE *Start_temp ANSI((char *, CELLPTR, char **));
 void Open_temp_error ANSI((char *, char *));
 void Link_temp ANSI((CELLPTR, FILE *, char *));
