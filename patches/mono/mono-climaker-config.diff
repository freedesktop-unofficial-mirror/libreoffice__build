From 6bd90eb5c8364d3d5d55516338a15b64678cd0e3 Mon Sep 17 00:00:00 2001
From: Jan Holesovsky <kendy@suse.cz>
Date: Fri, 14 May 2010 16:59:43 +0200
Subject: [PATCH 387/878] mono-climaker-config.diff

---
 configure.in |   16 ++++++++++++++++
 set_soenv.in |    1 +
 2 files changed, 17 insertions(+), 0 deletions(-)

diff --git a/configure.in b/configure.in
index 5d73e88..bcfd8f4 100644
--- a/configure.in
+++ b/configure.in
@@ -2031,6 +2031,21 @@ if test "$_os" = "Linux"; then
                         "`echo $MCS_VERSION | cut -d"." -f3`" -ge "8"; then
                 ENABLE_MONO=YES
                 CSC=$MCS
+                AC_PATH_PROG(GMCS, gmcs, no)
+                AC_PATH_PROG(MKBUNDLE2, mkbundle2, no)
+                GMCS_VERSION=`$GMCS --version | cut -d" " -f5`
+                if test "`echo $GMCS_VERSION | cut -d"." -f1`" -gt "1" || \
+                   test "`echo $GMCS_VERSION | cut -d"." -f1`" = "1" -a \
+                        "`echo $GMCS_VERSION | cut -d"." -f2`" -ge "3" || \
+                   test "`echo $GMCS_VERSION | cut -d"." -f1`" = "1" -a \
+                    "`echo $GMCS_VERSION | cut -d"." -f2`" = "2" -a \
+                    "`echo $GMCS_VERSION | cut -d"." -f3`" -ge "3"; then
+                    # mkbundle2 does not work on ppc, http://bugzilla.ximian.com/show_bug.cgi?id=81525
+                    if test "`uname -m`" != "ppc" -a "`uname -m`" != "ppc64" ; then
+                    ENABLE_MONO_CLIMAKER=YES
+                    AC_MSG_NOTICE([mono is up-to-date enough - building mono climaker])
+                    fi
+                fi
             else
                 if test -n "$enable_mono" ; then
                     AC_MSG_ERROR([no, mcs >= 1.1.8 is needed.])
@@ -2052,6 +2067,7 @@ AC_SUBST(AL)
 AC_SUBST(ENABLE_MONO)
 AC_SUBST(MONO_CFLAGS)
 AC_SUBST(MONO_LIBS)
+AC_SUBST(ENABLE_MONO_CLIMAKER)
 
 dnl ===================================================================
 dnl Check if stdc headers are available excluding windows.
diff --git a/set_soenv.in b/set_soenv.in
index 70f4dc3..45739a5 100644
--- a/set_soenv.in
+++ b/set_soenv.in
@@ -1699,6 +1699,7 @@ ToFile( "MKDEPENDSOLVER",    "TRUE",             "e" );
 ToFile( "Platform dependent constant values.", $empty, "c" );
 ToFile( "SOLAR_JAVA",        $SOLAR_JAVA,        "e" );
 ToFile( "ENABLE_MONO",       "@ENABLE_MONO@",    "e" );
+ToFile( "ENABLE_MONO_CLIMAKER",       "@ENABLE_MONO_CLIMAKER@",    "e" );
 ToFile( "CSC",               "@CSC@",            "e" );
 ToFile( "AL",                "@AL@",             "e" );
 ToFile( "CSC_PATH",          "@CSC_PATH@",       "e" );
-- 
1.7.0.1

