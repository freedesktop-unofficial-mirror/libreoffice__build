Index: vcl/inc/salptype.hxx
===================================================================
RCS file: /cvs/gsl/vcl/inc/salptype.hxx,v
retrieving revision 1.1.1.1
diff -u -p -u -r1.1.1.1 salptype.hxx
--- vcl/inc/salptype.hxx	19 Sep 2000 10:23:06 -0000	1.1.1.1
+++ vcl/inc/salptype.hxx	17 Jan 2003 13:46:37 -0000
@@ -80,8 +80,9 @@
 // - SalPrinterError -
 // -------------------
 
-#define SAL_PRINTER_ERROR_GENERALERROR			1
-#define SAL_PRINTER_ERROR_ABORT 				2
+#define SAL_PRINTER_ERROR_GENERALERROR	1
+#define SAL_PRINTER_ERROR_ABORT		2
+#define SAL_PRINTER_ERROR_NO_PRINTER	3
 
 
 // -------------------
Index: vcl/source/gdi/print.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/gdi/print.cxx,v
retrieving revision 1.24.4.4
diff -u -p -u -r1.24.4.4 print.cxx
--- vcl/source/gdi/print.cxx	19 Jun 2002 11:32:01 -0000	1.24.4.4
+++ vcl/source/gdi/print.cxx	17 Jan 2003 13:47:43 -0000
@@ -1525,6 +1525,9 @@ ULONG ImplSalPrinterErrorCodeToVCL( ULON
 		case SAL_PRINTER_ERROR_ABORT:
 			nVCLError = PRINTER_ABORT;
 			break;
+		case SAL_PRINTER_ERROR_NO_PRINTER:
+			nVCLError = ERRCODE_IO_NOTEXISTS;
+			break;
 		default:
 			nVCLError = PRINTER_GENERALERROR;
 			break;
@@ -1701,6 +1701,8 @@
                                                                                                                             
                mnCurPage = 0;
                                                                                                                             
+               BOOL success = TRUE;
+
                if ( mpPrinter )
                {
                        mbPrinting              = FALSE;
@@ -1708,7 +1710,14 @@
                        maJobName.Erase();
                                                                                                                             
                        mbDevOutput = FALSE;
-                       mpPrinter->EndJob();
+                       if (!mpPrinter->EndJob())
+                         {
+                           mnError = ImplSalPrinterErrorCodeToVCL( mpPrinter->GetErrorCode() );
+                           if ( !mnError )
+                             mnError = PRINTER_GENERALERROR;
+                           success = FALSE;
+                         }
+
                        // Hier den Drucker nicht asyncron zerstoeren, da es
                        // W95 nicht verkraftet, wenn gleichzeitig gedruckt wird
                        // und ein Druckerobjekt zerstoert wird
@@ -1719,7 +1728,7 @@
                else
                        mpQPrinter->EndQueuePrint();
                                                                                                                             
-               return TRUE;
+               return success;
        }
 #else
        ImplSVData* pSVData = ImplGetSVData();
Index: sfx2/source/view/makefile.mk
===================================================================
RCS file: /cvs/framework/sfx2/source/view/makefile.mk,v
retrieving revision 1.4
diff -u -p -u -r1.4 makefile.mk
--- sfx2/source/view/makefile.mk	18 Jun 2001 10:52:07 -0000	1.4
+++ sfx2/source/view/makefile.mk	17 Jan 2003 15:54:00 -0000
@@ -109,6 +109,8 @@ SLOFILES =	\
 		$(SLO)$/topfrm.obj \
 		$(SLO)$/sfxbasecontroller.obj
 
+CFLAGS+= `pkg-config --cflags glib-2.0`
+
 # --- Targets -------------------------------------------------------
 
 .INCLUDE :  target.mk

--- sfx2/source/view/viewprn.cxx	4 Dec 2001 16:37:44 -0000	1.11
+++ sfx2/source/view/viewprn.cxx	17 Jan 2003 15:54:01 -0000
@@ -94,6 +94,8 @@
 #include <svtools/printwarningoptions.hxx>
 #pragma hdrstop
 
+#include <glib.h>
+
 #include "viewsh.hxx"
 #include "viewimp.hxx"
 #include "viewfrm.hxx"
@@ -373,6 +375,8 @@ SfxPrinter* SfxViewShell::SetPrinter_Imp
 #pragma optimize ( "", off )
 #endif
 
+#include <stdio.h>
+
 void SfxViewShell::ExecPrint_Impl( SfxRequest &rReq )
 {
 	USHORT                  nCopies=1, nPaperBin = 0, nDialogRet = RET_CANCEL;
@@ -728,7 +732,27 @@ void SfxViewShell::ExecPrint_Impl( SfxRe
 				// Printer konnte nicht gestartet werden
 				String aMsg( SfxResId( STR_NOSTARTPRINTER ) );
 				if ( !rReq.IsAPI() )
-				ErrorBox( NULL, WB_OK | WB_DEF_OK,  aMsg ).Execute();
+				  {
+#ifdef UNX
+				    if ( nError == ERRCODE_IO_NOTEXISTS ) 
+				      {
+					ErrorBox box ( NULL, WB_OK | WB_DEF_OK,  aMsg );
+#define BUTTONID_ADD_PRN 77					
+					box.AddButton( ::rtl::OUString( SfxResId( STR_ADDPRINTER ) ),
+						       BUTTONID_ADD_PRN, 0, 0 );
+					if (box.Execute () == BUTTONID_ADD_PRN)
+					  {
+					    const char *argv[] = { "gnome-cups-add", NULL };
+				//	    fprintf (stderr, "Add printer ...\n");
+					    g_spawn_async (NULL, (gchar **)argv,
+							   NULL, G_SPAWN_SEARCH_PATH,
+							   NULL, NULL, NULL, NULL);
+					}
+				      }
+				    else
+#endif
+				      ErrorBox( NULL, WB_OK | WB_DEF_OK,  aMsg ).Execute();
+				  }
 				rReq.SetReturnValue(SfxBoolItem(0,FALSE));
 			}
 			else

Index: sfx2/source/view/view.hrc
===================================================================
RCS file: /cvs/framework/sfx2/source/view/view.hrc,v
retrieving revision 1.5
diff -u -p -u -r1.5 view.hrc
--- sfx2/source/view/view.hrc	30 Jul 2001 11:15:41 -0000	1.5
+++ sfx2/source/view/view.hrc	15 Jul 2003 11:58:12 -0000
@@ -112,6 +112,7 @@
 #define MSG_CANT_CLOSE						(RID_SFX_VIEW_START+42)
 
 #define TP_FRAMEPROPERTIES                  (RID_SFX_VIEW_START+44)
+#define STR_ADDPRINTER                      (RID_SFX_VIEW_START+45)
 
 #define FT_FRAMENAME					3
 #define ED_FRAMENAME					4
Index: sfx2/source/view/view.src
===================================================================
RCS file: /cvs/framework/sfx2/source/view/view.src,v
retrieving revision 1.29.2.11.2.1
diff -u -p -u -r1.29.2.11.2.1 view.src
--- sfx2/source/view/view.src	31 Oct 2002 21:30:33 -0000	1.29.2.11.2.1
+++ sfx2/source/view/view.src	15 Jul 2003 11:58:18 -0000
@@ -119,6 +119,12 @@ String STR_NOSTARTPRINTER
 	TEXT[ language_user1 ] = " ";
 	TEXT[ catalan ] = "No se puede iniciar la impresora.\nPor favor verifique la configuración de su impresora.";
 };
+String STR_ADDPRINTER
+{
+	TEXT = "Drucker hinzufügen";
+	TEXT [ English ] = "Add Printer";
+	TEXT [ english_us ] = "Add Printer";
+};
 String STR_PRINTER_NOTAVAIL
 {
 	TEXT = "Das Dokument wurde für den Drucker $1 formatiert. Der Drucker ist nicht vorhanden.\nSoll der Standarddrucker $2 verwendet werden?" ;
