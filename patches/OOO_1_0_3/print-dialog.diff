Index: svtools/source/dialogs/printdlg.cxx
===================================================================
RCS file: /cvs/util/svtools/source/dialogs/printdlg.cxx,v
retrieving revision 1.8
diff -u -p -u -r1.8 printdlg.cxx
--- svtools/source/dialogs/printdlg.cxx	13 Sep 2001 11:17:35 -0000	1.8
+++ svtools/source/dialogs/printdlg.cxx	8 Jan 2003 15:37:36 -0000
@@ -408,12 +408,23 @@ IMPL_LINK( PrintDialog, ImplBrowseHdl, v
             aServiceType[0] <<= TemplateDescription::FILESAVE_SIMPLE;
             xInit->initialize( aServiceType );
 
+	    INetURLObject aLocation( maFiPrintFile.GetText(), INET_PROT_FILE );
+
+	    xFilePicker->setDefaultName( aLocation.GetLastName() );
+	    xFilePicker->setDisplayDirectory ( aLocation.GetPartBeforeLastName() );
+
 #ifdef UNX
+	    Printer* pPrinter = TEMPPRINTER() ? TEMPPRINTER() : mpPrinter;
+
             // add PostScript and PDF
             try
             {
                 xFilterMgr->appendFilter( OUString( RTL_CONSTASCII_USTRINGPARAM( "PostScript" ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "*.ps" ) ) );
                 xFilterMgr->appendFilter( OUString( RTL_CONSTASCII_USTRINGPARAM( "PDF" ) ), OUString( RTL_CONSTASCII_USTRINGPARAM( "*.pdf" ) ) );
+
+		String aFilter = pPrinter->GetJobValue( String::CreateFromAscii( "Filter#" ) );
+		if (aFilter.Len())
+		  xFilterMgr->setCurrentFilter( aFilter );
             }
             catch( IllegalArgumentException& rExc )
             {
@@ -434,8 +445,12 @@ IMPL_LINK( PrintDialog, ImplBrowseHdl, v
             if( xFilePicker->execute() == ExecutableDialogResults::OK )
             {
                 Sequence< OUString > aPathSeq( xFilePicker->getFiles() );
-				INetURLObject aObj( aPathSeq[0] );
-				maFiPrintFile.SetText( aObj.PathToFileName() );
+		INetURLObject aObj( aPathSeq[0] );
+		maFiPrintFile.SetText( aObj.PathToFileName() );
+#ifdef UNX
+		pPrinter->SetJobValue( String::CreateFromAscii( "Filter#" ),
+				       xFilterMgr->getCurrentFilter() );
+#endif
             }
 
             return 0;
@@ -492,8 +507,8 @@ IMPL_LINK( PrintDialog, ImplModifyContro
 
                if ( !bCopies )
                        maCbxCollate.Check( FALSE );
-               else if ( mbCollateCheck )
-                       maCbxCollate.Check( TRUE );
+               else
+                       maCbxCollate.Check(( mbCollateCheck = TRUE ));
        }
 
        // Sortieren
