Index: scp/source/office/profile.scp
===================================================================
RCS file: /cvs/oo/installation/scp/source/office/profile.scp,v
retrieving revision 1.129.2.5
diff -u -p -u -r1.129.2.5 profile.scp
--- scp/source/office/profile.scp	1 Nov 2002 09:41:30 -0000	1.129.2.5
+++ scp/source/office/profile.scp	17 Mar 2003 14:54:27 -0000
@@ -1969,7 +1969,7 @@ ConfigurationItem GID_CONFIGURATIONITEM_
     ModuleID = GID_MODULE_SO_ROOT;
     Path        = "org.openoffice.Office.Common/Path/Current";
     Key         = "OfficeInstall";
-    Value       = "<progpath>";
+    Value       = "<progpath_nodestdir>";
     Styles      = CFG_STRING;
 End
 
Index: setup2/inc/os.hxx
===================================================================
RCS file: /cvs/oo/installation/setup2/inc/os.hxx,v
retrieving revision 1.11
diff -u -p -u -r1.11 os.hxx
--- setup2/inc/os.hxx	18 Dec 2001 15:38:24 -0000	1.11
+++ setup2/inc/os.hxx	17 Mar 2003 14:59:33 -0000
@@ -276,6 +276,7 @@ public:
 
 	static DateTime		GetDateTime(ByteString const& aFile);
 
+	static ByteString       GetTargetPath( ByteString const &aPath);
 	static void		SetRights(ByteString const& aFile, int nRights);
 	static void		ChangeOwnerRecursive( const ByteString aPath, const ByteString& rUserName );
 
Index: setup2/mow/source/system/mowos.cxx
===================================================================
RCS file: /cvs/oo/installation/setup2/mow/source/system/mowos.cxx,v
retrieving revision 1.6.4.1
diff -u -p -u -r1.6.4.1 mowos.cxx
--- setup2/mow/source/system/mowos.cxx	11 Mar 2002 19:30:39 -0000	1.6.4.1
+++ setup2/mow/source/system/mowos.cxx	17 Mar 2003 15:35:37 -0000
@@ -379,6 +379,18 @@ BOOL UnixOS::CreateHardLink
 	return link(aSource.GetBuffer(),aDest.GetBuffer()) == 0;
 }
 
+ByteString UnixOS::GetTargetPath( ByteString const &aPath)
+{
+	const char *destdir;
+	ByteString aResult = aPath;
+
+	if ( (destdir = getenv( "DESTDIR" )) ||
+	     (destdir = getenv( "OODESTDIR" )) )
+	    aResult.SearchAndReplace( destdir, ByteString() );
+
+	return aResult;
+}
+
 BOOL UnixOS::ConvertShellScript(
 	SiDirEntry const& aDest,
 	SiDirEntry const& aSource,
@@ -389,11 +401,15 @@ BOOL UnixOS::ConvertShellScript(
 	SvFileStream aDestStream( aDest.GetFullUni(), STREAM_READWRITE | STREAM_TRUNC );
 	SvFileStream aSourceStream( aSource.GetFullUni(), STREAM_READ );
 	ByteString aLine;
+	ByteString aProgNoDestPath;
+
+	aProgNoDestPath = GetTargetPath( rProgPath );
 
 	while ( aSourceStream.ReadLine( aLine ))
 	{
 		aLine.SearchAndReplace("<workpath>", rWorkPath);
 		aLine.SearchAndReplace("<progpath>", rProgPath);
+		aLine.SearchAndReplace("<progpath_nodestdir>", aProgNoDestPath);
 		if (! aDestStream.WriteLine( aLine ))
 			return FALSE;
 	}
Index: setup2/source/agenda/environ.cxx
===================================================================
RCS file: /cvs/oo/installation/setup2/source/agenda/environ.cxx,v
retrieving revision 1.32.6.2.2.1
diff -u -p -u -r1.32.6.2.2.1 environ.cxx
--- setup2/source/agenda/environ.cxx	31 Oct 2002 20:46:57 -0000	1.32.6.2.2.1
+++ setup2/source/agenda/environ.cxx	17 Mar 2003 15:37:52 -0000
@@ -267,6 +267,9 @@ void SiEnvironment::InitReplacement( SiI
 
 	AddReplacement( "<progpath>", GetProgPath( eIMode ), OSL_GETTHREADTEXTENCODING );
 	AddReplacement( "<workpath>", GetWorkPath( eIMode ), OSL_GETTHREADTEXTENCODING );
+#ifdef UNX
+	AddReplacement( "<progpath_nodestdir>", UnixOS::GetTargetPath( GetProgPath( eIMode ) ), OSL_GETTHREADTEXTENCODING );
+#endif
 
 	// #90348#
 	UniString suWorkPath( GetWorkPath( eIMode ), osl_getThreadTextEncoding() );
