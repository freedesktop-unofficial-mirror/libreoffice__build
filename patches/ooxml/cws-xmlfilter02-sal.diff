--- sal/qa/rtl/oustring/rtl_OUString2.cxx	26 Jul 2007 09:23:37 -0000	1.12
+++ sal/qa/rtl/oustring/rtl_OUString2.cxx	5 Oct 2007 05:34:45 -0000	1.7.76.4
@@ -348,6 +348,33 @@ sal_Int16 SAL_CALL checkPrecisionSize()
         
     };
 
+    class toInt: public CppUnit::TestFixture {
+    public:
+        void test() {
+            CPPUNIT_ASSERT_EQUAL(
+                static_cast< sal_Int32 >(-0x76543210),
+                (rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("-76543210")).
+                 toInt32(16)));
+            CPPUNIT_ASSERT_EQUAL(
+                static_cast< sal_Int32 >(0xFEDCBA98),
+                (rtl::OUString(RTL_CONSTASCII_USTRINGPARAM("+FEDCBA98")).
+                 toInt32(16)));
+            CPPUNIT_ASSERT_EQUAL(
+                static_cast< sal_Int64 >(-SAL_CONST_INT64(0x76543210FEDCBA98)),
+                (rtl::OUString(
+                    RTL_CONSTASCII_USTRINGPARAM("-76543210FEDCBA98")).
+                 toInt64(16)));
+            CPPUNIT_ASSERT_EQUAL(
+                static_cast< sal_Int64 >(SAL_CONST_INT64(0xFEDCBA9876543210)),
+                (rtl::OUString(
+                    RTL_CONSTASCII_USTRINGPARAM("+FEDCBA9876543210")).
+                 toInt64(16)));
+        }
+
+        CPPUNIT_TEST_SUITE(toInt);
+        CPPUNIT_TEST(test);
+        CPPUNIT_TEST_SUITE_END();
+    };
     
 // -----------------------------------------------------------------------------
 // - toDouble (tests)
@@ -1195,6 +1222,7 @@ void iterateCodePoints::testNotWellForme
 
 // -----------------------------------------------------------------------------
 CPPUNIT_TEST_SUITE_NAMED_REGISTRATION(rtl_OUString::valueOf, "rtl_OUString");
+CPPUNIT_TEST_SUITE_NAMED_REGISTRATION(rtl_OUString::toInt, "rtl_OUString");
 CPPUNIT_TEST_SUITE_NAMED_REGISTRATION(rtl_OUString::toDouble, "rtl_OUString");
 CPPUNIT_TEST_SUITE_NAMED_REGISTRATION(rtl_OUString::toFloat, "rtl_OUString");
 CPPUNIT_TEST_SUITE_NAMED_REGISTRATION(rtl_OUString::lastIndexOf, "rtl_OUString");
--- sal/rtl/source/strtmpl.c	3 Apr 2007 14:06:07 -0000	1.24
+++ sal/rtl/source/strtmpl.c	8 May 2007 10:27:55 -0000	1.22.112.2
@@ -852,15 +852,10 @@ sal_Bool SAL_CALL IMPL_RTL_STRNAME( toBo
 
 /* ----------------------------------------------------------------------- */
 
-#define INT32_MIN_VALUE     ((sal_Int32)0x80000000);
-#define INT32_MAX_VALUE     ((sal_Int32)0x7fffffff);
-
 sal_Int32 SAL_CALL IMPL_RTL_STRNAME( toInt32 )( const IMPL_RTL_STRCODE* pStr,
                                                 sal_Int16 nRadix )
 {
     sal_Bool    bNeg;
-    sal_Int32   nLimit;
-    sal_Int32   nMultMin;
     sal_Int16   nDigit;
     sal_Int32   n = 0;
 
@@ -874,7 +869,6 @@ sal_Int32 SAL_CALL IMPL_RTL_STRNAME( toI
     if ( *pStr == '-' )
     {
         bNeg = sal_True;
-        nLimit = INT32_MIN_VALUE;
         pStr++;
     }
     else
@@ -882,9 +876,7 @@ sal_Int32 SAL_CALL IMPL_RTL_STRNAME( toI
         if ( *pStr == '+' )
             pStr++;
         bNeg = sal_False;
-        nLimit = -INT32_MAX_VALUE;
     }
-    nMultMin = nLimit / nRadix;
 
     while ( *pStr )
     {
@@ -892,39 +884,24 @@ sal_Int32 SAL_CALL IMPL_RTL_STRNAME( toI
         if ( nDigit < 0 )
             break;
 
-        if ( n < nMultMin )
-            break;
-
         n *= nRadix;
-        if ( n < (nLimit+nDigit) )
-            break;
-        n -= nDigit;
+        n += nDigit;
 
         pStr++;
     }
 
     if ( bNeg )
-        return n;
-    else
         return -n;
+    else
+        return n;
 }
 
 /* ----------------------------------------------------------------------- */
 
-#ifndef WNT
-#define INT64_MIN_VALUE     0x8000000000000000LL;
-#define INT64_MAX_VALUE     0x7fffffffffffffffLL;
-#else
-#define INT64_MIN_VALUE     0x8000000000000000L;
-#define INT64_MAX_VALUE     0x7fffffffffffffffL;
-#endif
-
 sal_Int64 SAL_CALL IMPL_RTL_STRNAME( toInt64 )( const IMPL_RTL_STRCODE* pStr,
                                                 sal_Int16 nRadix )
 {
     sal_Bool    bNeg;
-    sal_Int64   nLimit;
-    sal_Int64   nMultMin;
     sal_Int16   nDigit;
     sal_Int64   n = 0;
 
@@ -938,7 +915,6 @@ sal_Int64 SAL_CALL IMPL_RTL_STRNAME( toI
     if ( *pStr == '-' )
     {
         bNeg = sal_True;
-        nLimit = INT64_MIN_VALUE;
         pStr++;
     }
     else
@@ -946,9 +922,7 @@ sal_Int64 SAL_CALL IMPL_RTL_STRNAME( toI
         if ( *pStr == '+' )
             pStr++;
         bNeg = sal_False;
-        nLimit = -INT64_MAX_VALUE;
     }
-    nMultMin = nLimit / nRadix;
 
     while ( *pStr )
     {
@@ -956,21 +930,16 @@ sal_Int64 SAL_CALL IMPL_RTL_STRNAME( toI
         if ( nDigit < 0 )
             break;
 
-        if ( n < nMultMin )
-            break;
-
         n *= nRadix;
-        if ( n < (nLimit+nDigit) )
-            break;
-        n -= nDigit;
+        n += nDigit;
 
         pStr++;
     }
 
     if ( bNeg )
-        return n;
-    else
         return -n;
+    else
+        return n;
 }
 
 /* ======================================================================= */
