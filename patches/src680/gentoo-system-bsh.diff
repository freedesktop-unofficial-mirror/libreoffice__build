--- beanshell/makefile.mk	2005-08-08 08:42:40.000000000 +0100
+++ beanshell/makefile.mk	2005-08-08 08:43:19.000000000 +0100
@@ -43,6 +43,12 @@
 
 .INCLUDE :	settings.mk
 
+.IF "$(SYSTEM_BSH)" == "YES"
+all:
+        @echo "An already available installation of beanshell should exist on your system."
+        @echo "Therefore the version provided here does not need to be built in addition."
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 TARFILE_NAME=bsh-2.0b1-src
--- config_office/configure.in	2005-08-08 08:34:55.000000000 +0100
+++ config_office/configure.in	2005-08-08 08:36:50.000000000 +0100
@@ -236,6 +236,9 @@
 [  --with-db-jar=JARFILE   Specify path to jarfile manually ],
 [ DB_JAR="$withval"
 ])
+AC_ARG_WITH(system-beanshell,
+[  --with-system-beanshell Use beanshell already on system
+],,)
 AC_ARG_WITH(system-sablot,
 [  --with-system-sablot    Use sablot already on system
 ],,)
@@ -2625,6 +2632,27 @@
 AC_SUBST(DB_JAR)
 
 dnl ===================================================================
+dnl Check for system beanshell
+dnl ===================================================================
+AC_MSG_CHECKING([which beanshell to use])
+if test -n "$with_system_beanshell" -o -n "$with_system_libs" && \
+	test "$with_system_beanshell" != "no"; then
+        AC_MSG_RESULT([external])
+        SYSTEM_BSH=YES
+        BSH_JAR=/usr/share/bsh/lib/bsh.jar
+        AC_CHECK_FILE($BSH_JAR, [],
+         [AC_MSG_ERROR(Beanshell jar not found.)], [])
+else
+    AC_MSG_RESULT([internal])
+    SYSTEM_BSH=NO
+    # if set to "no" scripting module fails
+    unset BSH_JAR
+    BUILD_TYPE="$BUILD_TYPE BSH"
+fi
+AC_SUBST(SYSTEM_BSH)
+AC_SUBST(BSH_JAR)
+
+dnl ===================================================================
 dnl Check for system sablot
 dnl ===================================================================
 AC_MSG_CHECKING([which sablot to use])
--- config_office/set_soenv.in	2005-08-08 08:34:55.000000000 +0100
+++ config_office/set_soenv.in	2005-08-08 08:37:30.000000000 +0100
@@ -1752,6 +1752,8 @@
 ToFile( "DB_VERSION",        "@DB_VERSION@",       "e" );
 ToFile( "DB_INCLUDES",       "@DB_INCLUDES@",      "e" );
 ToFile( "DB_JAR",            "@DB_JAR@",           "e" );
+ToFile( "SYSTEM_BSH",        "@SYSTEM_BSH@",       "e" );
+ToFile( "BSH_JAR",           "@BSH_JAR@",          "e" );
 ToFile( "SYSTEM_SABLOT",     "@SYSTEM_SABLOT@",    "e" );
 ToFile( "SABLOT_LIBS",       "@SABLOT_LIBS@",      "e" );
 ToFile( "SYSTEM_ODBC_HEADERS","@SYSTEM_ODBC_HEADERS@","e" );
--- scp2/source/ooo/file_ooo.scp	2005-08-08 08:45:11.000000000 +0100
+++ scp2/source/ooo/file_ooo.scp	2005-08-08 08:47:36.000000000 +0100
@@ -631,9 +631,9 @@
 #endif
 
 #ifdef SOLAR_JAVA
-
+#ifndef SYSTEM_BSH
 STD_JAR_FILE( gid_File_Jar_Bsh, bsh )
-
+#endif
 #endif
 
 #ifdef SOLAR_JAVA
--- scp2/source/ooo/makefile.mk.orig	2005-10-27 14:54:34.000000000 +0200
+++ scp2/source/ooo/makefile.mk	2005-10-27 14:54:54.000000000 +0200
@@ -142,6 +142,10 @@
 SCPDEFS+=-DSYSTEM_XMLSEC
 .ENDIF
 
+.IF "$(SYSTEM_BSH)" == "YES"
+SCPDEFS+=-DSYSTEM_BSH
+.ENDIF
+
 .IF "$(SYSTEM_ICU)" == "YES"
 SCPDEFS+=-DSYSTEM_ICU
 .ELSE
--- scp2/source/ooo/profileitem_ooo.scp.orig	2005-11-02 20:06:02.000000000 +0100
+++ scp2/source/ooo/profileitem_ooo.scp	2005-11-02 20:07:48.000000000 +0100
@@ -740,6 +740,10 @@
     Section = "Bootstrap";
     Order = 7;
     Key = "UNO_JAVA_JFW_CLASSPATH_URLS";
+#ifdef SYSTEM_BSH
+    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar file:///usr/share/bsh/lib/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar $ORIGIN/classes/hsqldb.jar $ORIGIN/classes/sdbc_hsqldb.jar";
+#else
     Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar $ORIGIN/classes/hsqldb.jar $ORIGIN/classes/sdbc_hsqldb.jar";
+#endif
 End
 
--- scripting/java/build.xml	2005-08-08 08:52:47.000000000 +0100
+++ scripting/java/build.xml	2005-08-08 08:55:34.000000000 +0100
@@ -50,6 +50,11 @@
        Not needed in default build -->
   <property name="netbeans.install.path" value="/export/home/netbeans"/>
 
+  <!-- ==================== environment vars =============================
+       use jar from system env BSH_JAR or if unset use jar from location   -->
+  <property environment="env"/>
+  <property name="env.BSH_JAR" location="${solar.jar}/bsh.jar"/>
+
   <!-- ==================== classpath setting ============================ -->
   <path id="idlclasspath">
     <pathelement location="${solar.jar}/jurt.jar"/>
@@ -58,7 +61,7 @@
     <pathelement location="${solar.jar}/juh.jar"/>
     <pathelement location="${solar.jar}/java_uno.jar"/>
     <pathelement location="${solar.jar}/ridl.jar"/>
-    <pathelement location="${solar.jar}/bsh.jar"/>
+    <pathelement location="${env.BSH_JAR}"/>
     <pathelement location="${solar.jar}/js.jar"/>
     <pathelement location="${jardir}"/>
   </path> 
--- scripting/prj/build.lst	2005-09-09 09:29:54.000000000 +0100
+++ scripting/prj/build.lst	2005-09-09 09:30:02.000000000 +0100
@@ -1,4 +1,4 @@
-tc	scripting	:	bridges rdbmaker vcl xmlscript basic sfx2 rhino beanshell javaunohelper NULL
+tc	scripting	:	bridges rdbmaker vcl xmlscript basic sfx2 rhino BSH:beanshell javaunohelper NULL
 tc	scripting									usr1	-	all	tc_mkout NULL
 tc	scripting\source\provider				nmake	-	all	tc_scriptingprovider NULL
 tc	scripting\source\basprov				nmake	-	all	tc_scriptingbasprov NULL
--- solenv/config/ssrc680.ini.orig	2005-10-27 14:47:52.000000000 +0200
+++ solenv/config/ssrc680.ini	2005-10-27 14:48:27.000000000 +0200
@@ -108,7 +108,7 @@
 			BIG_SVX TRUE
 			BIG_GOODIES TRUE
 			BMP_WRITES_FLAG TRUE
-            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS CURL DICTIONARIES FREETYPE JPEG LIBXML2 LIBXMLSEC MOZ NAS NEON NP_SDK TWAIN PYTHON ZLIB SNDFILE PORTAUDIO SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK MSFONTEXTRACT MATHMLDTD BOOST EXPAT CRASHREP BERKELEYDB SABLOT XALAN SUN AGG
+            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS CURL DICTIONARIES FREETYPE JPEG LIBXML2 LIBXMLSEC MOZ NAS NEON NP_SDK TWAIN PYTHON ZLIB SNDFILE PORTAUDIO SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK MSFONTEXTRACT MATHMLDTD BOOST EXPAT CRASHREP BERKELEYDB SABLOT XALAN SUN AGG BSH
 			RES_ENUS TRUE
 			RES_GER TRUE
 			NO_REC_RES TRUE
