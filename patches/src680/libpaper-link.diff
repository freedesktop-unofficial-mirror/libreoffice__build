--- psprint/source/printer/makefile.mk-old	2007-03-26 16:03:15.000000000 +0200
+++ psprint/source/printer/makefile.mk	2007-03-26 16:04:21.000000000 +0200
@@ -47,6 +47,10 @@
 CDEFS += -DENABLE_CUPS
 .ENDIF
 
+.IF "$(LIBPAPER_LINK)" == "YES"
+CDEFS += -DLIBPAPER_LINK
+.ENDIF
+
 # --- Files --------------------------------------------------------
 
 .IF "$(GUIBASE)"=="aqua"
--- psprint/source/printer/printerinfomanager.cxx-old	2007-03-26 16:25:28.000000000 +0200
+++ psprint/source/printer/printerinfomanager.cxx	2007-03-26 16:29:56.000000000 +0200
@@ -64,6 +64,10 @@
 
 #include <hash_set>
 
+#ifdef LIBPAPER_LINK
+#include <paper.h>
+#endif
+
 using namespace psp;
 using namespace rtl;
 using namespace osl;
@@ -142,6 +146,9 @@
 
 void PrinterInfoManager::initSystemDefaultPaper()
 {
+    bool bSuccess = false;
+    const char* pPaper;
+#ifndef LIBPAPER_LINK
     // try libpaper
     OUString aModName( RTL_CONSTASCII_USTRINGPARAM( "libpaper.so.1" ) );
     OUString aInitName( RTL_CONSTASCII_USTRINGPARAM( "paperinit" ) );
@@ -150,14 +157,17 @@
     oslModule hMod = osl_loadModule( aModName.pData, SAL_LOADMODULE_NOW );
     if( hMod )
     {
-        bool bSuccess = false;
         int (*init)() = (int(*)())osl_getFunctionSymbol( hMod, aInitName.pData );
         int (*done)() = (int(*)())osl_getFunctionSymbol( hMod, aDoneName.pData );
         const char* (*sys)() = (const char*(*)())osl_getFunctionSymbol( hMod, aSystemName.pData );
         if( init && done && sys )
         {
             init();
-            const char* pPaper = sys();
+            pPaper = sys();
+#else
+	    paperinit();
+	    pPaper = systempapername();
+#endif
             if( pPaper && *pPaper )
             {
                 m_aSystemDefaultPaper = OUString( OStringToOUString( pPaper, osl_getThreadTextEncoding() ) );
@@ -166,12 +176,18 @@
                 fprintf( stderr, "paper from libpaper = %s\n", pPaper );
                 #endif
             }
+#ifndef LIBPAPER_LINK
             done();
         }
         osl_unloadModule( hMod );
+#else
+	paperdone();
+#endif
         if( bSuccess )
             return;
+#ifndef LIBPAPER_LINK
     }
+#endif
 
     // default value is Letter for US (en_US), Cannada (en_CA, fr_CA); else A4
     // en will be interpreted as en_US
--- psprint/util/makefile.mk-old	2006-04-07 15:44:51.000000000 +0200
+++ psprint/util/makefile.mk	2007-03-26 16:10:34.000000000 +0200
@@ -82,6 +82,10 @@
 SHL1STDLIBS+=$(JVMFWKLIB)
 .ENDIF
 
+.IF "$(LIBPAPER_LINK)" == "YES"
+SHL1STDLIBS += -lpaper
+.ENDIF
+
 SHL1DEF=	$(MISC)$/$(SHL1TARGET).def
 
 .ENDIF      # "$(OS)"=="WNT"
--- config_office/configure.in-old	2007-03-26 16:11:32.000000000 +0200
+++ config_office/configure.in	2007-03-26 16:14:40.000000000 +0200
@@ -1880,6 +1880,20 @@
 fi
 AC_SUBST(CRYPT_LINK)
 
+AC_MSG_CHECKING([whether to link to libpaper])
+if test -n "$enable_libpaper_link"; then
+   AC_MSG_RESULT([yes])
+   LIBPAPER_LINK=YES
+   AC_CHECK_HEADER(paper.h, [],
+      [AC_MSG_ERROR([paper.h needed. install libpaper headers])], [])
+   AC_CHECK_LIB(paper, systempapername, [],
+      [AC_MSG_ERROR([libpaper not found or functional])], [])
+else
+  AC_MSG_RESULT([no])
+  LIBPAPER_LINK=NO
+fi
+AC_SUBST(LIBPAPER_LINK)
+
 dnl ===================================================================
 dnl Testing for c++ compiler and version...
 dnl ===================================================================
--- config_office/set_soenv.in-old	2007-03-26 16:14:48.000000000 +0200
+++ config_office/set_soenv.in	2007-03-26 16:15:14.000000000 +0200
@@ -1903,6 +1903,7 @@
 ToFile( "NEW_SHADOW_API",    "@NEW_SHADOW_API@",   "e" );
 ToFile( "PAM_LINK",          "@PAM_LINK@",         "e" );
 ToFile( "CRYPT_LINK",        "@CRYPT_LINK@",       "e" );
+ToFile( "LIBPAPER_LINK",     "@LIBPAPER_LINK@",    "e" );
 ToFile( "XAU_LIBS",          "@XAU_LIBS@",         "e" );
 ToFile( "GXX_INCLUDE_PATH",  "@GXX_INCLUDE_PATH@", "e" );
 ToFile( "COMMON_BUILD_TOOLS",$COMMON_BUILD_TOOLS,  "e" );
