--- fpicker/source/unx/gnome/SalGtkFilePicker.cxx	25 Feb 2005 11:35:46 -0000	1.4.4.2
+++ fpicker/source/unx/gnome/SalGtkFilePicker.cxx	7 Mar 2005 12:16:41 -0000
@@ -851,7 +851,8 @@ sal_Int16 SAL_CALL SalGtkFilePicker::exe
 		btn = GTK_RESPONSE_YES; // we dont want to repeat unless user clicks NO for file save.
 
 		resumeEventNotification();
-		gint nStatus = gtk_dialog_run( GTK_DIALOG( m_pDialog ) );
+        RunDialog aRunInMain(m_pDialog);
+        gint nStatus = aRunInMain.runandwaitforresult();
 		suspendEventNotification();
 		switch( nStatus )
 		{
@@ -901,9 +902,6 @@ sal_Int16 SAL_CALL SalGtkFilePicker::exe
 				break;
 		}
 	}
-
-	gtk_widget_hide( m_pDialog );
-
 	shutdownEventNotification();
 	return retVal;
 }
--- fpicker/source/unx/gnome/SalGtkFolderPicker.cxx	25 Feb 2005 11:35:47 -0000	1.3.4.1
+++ fpicker/source/unx/gnome/SalGtkFolderPicker.cxx	7 Mar 2005 12:16:41 -0000
@@ -233,8 +233,8 @@ sal_Int16 SAL_CALL SalGtkFolderPicker::e
 
 	sal_Int16 retVal = 0;
 
-	gint nStatus = gtk_dialog_run( GTK_DIALOG( m_pDialog ) );
-	gtk_widget_hide( m_pDialog );
+        RunDialog aRunInMain(m_pDialog);
+        gint nStatus = aRunInMain.runandwaitforresult();
 	switch( nStatus )
 	{
 		case GTK_RESPONSE_ACCEPT:
--- fpicker/source/unx/gnome/SalGtkPicker.cxx	18 Jan 2005 13:25:26 -0000	1.4
+++ fpicker/source/unx/gnome/SalGtkPicker.cxx	7 Mar 2005 12:16:41 -0000
@@ -101,6 +101,29 @@ using namespace ::com::sun::star;
 using namespace ::com::sun::star::lang;
 using namespace ::com::sun::star::uno;
 
+gboolean rundialog(RunDialog *pDialog)
+{
+    pDialog->run();
+    return false;
+}
+
+void RunDialog::run() 
+{ 
+    mnStatus = gtk_dialog_run( GTK_DIALOG( m_pDialog ) ); 
+	gtk_widget_hide( m_pDialog );
+    bFinished = true;
+}
+
+gint RunDialog::runandwaitforresult() 
+{ 
+    g_timeout_add_full(G_PRIORITY_HIGH_IDLE, 0, (GSourceFunc)rundialog, this, NULL);
+    do {
+        Application::Yield();
+    }
+    while (!bFinished);
+    return mnStatus; 
+}
+
 SalGtkPicker::~SalGtkPicker()
 {
 	if (m_pDialog)
--- fpicker/source/unx/gnome/SalGtkPicker.hxx	8 Sep 2004 17:08:43 -0000	1.2
+++ fpicker/source/unx/gnome/SalGtkPicker.hxx	7 Mar 2005 12:16:41 -0000
@@ -113,4 +113,16 @@ class SalGtkPicker
 
 };
 
+class RunDialog
+{
+private:
+    bool bFinished;
+    gint mnStatus;
+    GtkWidget *m_pDialog;
+public:
+    void run();
+    RunDialog(GtkWidget *pDialog) : bFinished(false), m_pDialog(pDialog) { }
+    gint runandwaitforresult();
+};
+
 #endif
