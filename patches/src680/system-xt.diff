Index: config_office/configure.in
===================================================================
--- config_office/configure.in.orig	2006-01-08 16:30:02.000000000 +0100
+++ config_office/configure.in	2006-01-08 16:30:58.000000000 +0100
@@ -265,6 +265,9 @@ AC_ARG_WITH(system-hsqldb,
 AC_ARG_WITH(system-beanshell,
 [  --with-system-beanshell Use beanshell already on system
 ],,)
+AC_ARG_WITH(system-xt,
+[  --with-system-xt        Use xt already on system
+],,)
 AC_ARG_WITH(system-sablot,
 [  --with-system-sablot    Use sablot already on system
 ],,)
@@ -2850,6 +2853,24 @@ AC_SUBST(SYSTEM_BSH)
 AC_SUBST(BSH_JAR)
 
 dnl ===================================================================
+dnl Check for system xt
+dnl ===================================================================
+AC_MSG_CHECKING([which xt to use])
+if test -n "$with_system_xt" -o -n "$with_system_libs" && \
+	test "$with_system_xt" != "no"; then
+        AC_MSG_RESULT([external])
+        SYSTEM_XT=YES
+        XT_JAR=/usr/share/java/xt.jar
+        AC_CHECK_FILE($XT_JAR, [],
+         [AC_MSG_ERROR(xt.jar not found.)], [])
+else
+    AC_MSG_RESULT([internal])
+    SYSTEM_XT=NO
+fi
+AC_SUBST(SYSTEM_XT)
+AC_SUBST(XT_JAR)
+
+dnl ===================================================================
 dnl Check for system sablot
 dnl ===================================================================
 AC_MSG_CHECKING([which sablot to use])
Index: config_office/set_soenv.in
===================================================================
--- config_office/set_soenv.in.orig	2006-01-08 16:30:02.000000000 +0100
+++ config_office/set_soenv.in	2006-01-08 16:30:58.000000000 +0100
@@ -1780,6 +1780,8 @@ ToFile( "SYSTEM_HSQLDB",     "@SYSTEM_HS
 ToFile( "HSQLDB_JAR",        "@HSQLDB_JAR@",       "e" );
 ToFile( "SYSTEM_BSH",        "@SYSTEM_BSH@",       "e" );
 ToFile( "BSH_JAR",           "@BSH_JAR@",          "e" );
+ToFile( "SYSTEM_XT",         "@SYSTEM_XT@",        "e" );
+ToFile( "XT_JAR",            "@XT_JAR@",           "e" );
 ToFile( "SYSTEM_SABLOT",     "@SYSTEM_SABLOT@",    "e" );
 ToFile( "SABLOT_LIBS",       "@SABLOT_LIBS@",      "e" );
 ToFile( "SYSTEM_ODBC_HEADERS","@SYSTEM_ODBC_HEADERS@","e" );
Index: xt/download/build-xt-src-only.sh
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/download/build-xt-src-only.sh	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,16 @@
+#! /bin/sh
+
+# Remove generated files from xt's "-src" zip file
+
+bin_src_zip=$1
+src_zip="$(basename $1 .zip)-only.zip"
+
+exclude_re="^xt-[0-9]*/\(ant\|docs/api\|lib\|thirdparty\)\|semantic\.cache"
+
+cp $bin_src_zip $src_zip
+
+unzip -l $bin_src_zip \
+    | grep / \
+    | sed -e "s/^[^/]*xt-/xt-/" \
+    | grep -e $exclude_re \
+    | zip -d -@ $src_zip
Index: xt/makefile.mk
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/makefile.mk	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,73 @@
+#*************************************************************************
+#
+#   OpenOffice.org - a multi-platform office productivity suite
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to
+#   the terms of GNU Lesser General Public License Version 2.1.
+#
+#
+#     GNU Lesser General Public License Version 2.1
+#     =============================================
+#     Copyright 2005 by Sun Microsystems, Inc.
+#     901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License version 2.1, as published by the Free Software Foundation.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#     MA  02111-1307  USA
+#
+#*************************************************************************
+
+PRJ=.
+
+PRJNAME=ooo_xt
+TARGET=ooo_xt
+
+.IF "$(SYSTEM_XT)" == "YES"
+all:
+        @echo "An installation of xt should already exist on your system."
+        @echo "Therefore the version provided here does not need to be built."
+
+.ELSE
+.IF "$(SOLAR_JAVA)"!=""
+# --- Settings -----------------------------------------------------
+
+.INCLUDE :	settings.mk
+
+# --- Files --------------------------------------------------------
+
+TARFILE_NAME=xt-20051206-src-only
+TARFILE_ROOTDIR=xt-20051206
+
+ADDITIONAL_FILES=makefile.mk \
+
+PATCH_FILE_NAME=xt-20051206.patch
+
+BUILD_ACTION=dmake $(MFLAGS) $(CALLMACROS)
+
+# --- Targets ------------------------------------------------------
+
+.INCLUDE : set_ext.mk
+.INCLUDE : target.mk
+.INCLUDE : tg_ext.mk
+
+.ELSE
+all:
+        @echo Java disabled
+.ENDIF
+.ENDIF
Index: xt/prj/build.lst
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/prj/build.lst	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,5 @@
+xt      xt      :       external NULL
+xt      xt                      usr1    -       all     xt_mkout NULL
+xt      xt                      nmake   -       all     xt NULL
+xt      xt\src\com\jclark\xsl   nmake   -       all     xt_xs xt NULL
+
Index: xt/prj/d.lst
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/prj/d.lst	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1 @@
+..\%__SRC%\class\*.jar %_DEST%\bin%_EXT%\*.*
Index: xt/src/com/jclark/xsl/dom/XmlSearchTransform.java
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/src/com/jclark/xsl/dom/XmlSearchTransform.java	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,10 @@
+package com.jclark.xsl.dom;
+
+import com.jclark.xsl.om.Node;
+import com.jclark.xsl.tr.Result;
+
+public interface XmlSearchTransform extends Transform
+{
+    public void transform(Node sourceRoot,
+                          Result result) throws TransformException;
+}
Index: xt/src/com/jclark/xsl/dom/XmlSearchXSLTransformEngine.java
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/src/com/jclark/xsl/dom/XmlSearchXSLTransformEngine.java	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,178 @@
+// Derived from:
+// Id: XSLTransformEngine.java 96 2005-02-28 21:07:29Z blindsey
+// And added methods required by XmlSearch
+
+// Copyright (c) 1998, 1999 James Clark
+
+// Permission is hereby granted, free of charge, to any person obtaining
+// a copy of this software and associated documentation files (the
+// ``Software''), to deal in the Software without restriction, including
+// without limitation the rights to use, copy, modify, merge, publish,
+// distribute, sublicense, and/or sell copies of the Software, and to
+// permit persons to whom the Software is furnished to do so, subject to
+// the following conditions:
+
+// The above copyright notice and this permission notice shall be included
+// in all copies or substantial portions of the Software.
+
+// THE SOFTWARE IS PROVIDED ``AS IS'', WITHOUT WARRANTY OF ANY KIND, EXPRESS
+// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
+// IN NO EVENT SHALL JAMES CLARK BE LIABLE FOR ANY CLAIM, DAMAGES OR
+// OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
+// ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
+// OTHER DEALINGS IN THE SOFTWARE.
+
+// Except as contained in this notice, the name of James Clark shall
+// not be used in advertising or otherwise to promote the sale, use or
+// other dealings in this Software without prior written authorization
+// from James Clark.
+
+
+package com.jclark.xsl.dom;
+
+import com.jclark.xsl.tr.*;
+import com.jclark.xsl.om.*;
+import com.jclark.xsl.sax.ExtensionHandlerImpl;
+import com.jclark.xsl.sax.MultiNamespaceResult;
+import java.net.URL;
+import java.io.IOException;
+
+public class XmlSearchXSLTransformEngine
+    implements TransformEngine, XMLProcessor
+{
+    private Engine engine;
+    private DOMExtensions extend;
+
+    public Node load(URL url,
+                   int documentIndex,
+                   LoadContext context,
+                   NameTable nameTable) throws XSLException
+    {
+      throw new XSLException("external documents not supported");
+    }
+
+    public Result createResult(Node baseNode,
+                             int documentIndex,
+                             LoadContext loadContext,
+                             Node[] rootNodeRef) throws XSLException
+    {
+      if (baseNode == null)
+          throw new XSLException("cannot convert result tree fragment returned by extension function to a node-set with the DOM");
+      RootNode root = ((NodeBase)baseNode).root;
+      org.w3c.dom.DocumentFragment docFrag
+          = root.ownerDocument.createDocumentFragment();
+      String base = null;
+      URL baseURL = baseNode.getURL();
+      if (baseURL != null)
+          base = baseURL.toString();
+      rootNodeRef[0] =
+          new RootNode(docFrag,
+                       extend,
+                       loadContext,
+                       engine.getNameTable(),
+                       base,
+                       documentIndex);
+      return new MultiNamespaceResult(new DOMBuilder(docFrag), null);
+    }
+
+    public XmlSearchXSLTransformEngine()
+    {
+      engine = new EngineImpl(this, new ExtensionHandlerImpl());
+    }
+
+    public XmlSearchXSLTransformEngine(DOMExtensions extend)
+    {
+      this();
+      this.extend = extend;
+    }
+
+    private class TransformImpl implements XmlSearchTransform, ParameterSet
+    {
+      private Sheet sheet;
+
+      TransformImpl (Sheet sheet) {
+          this.sheet = sheet;
+      }
+
+      public void transform(org.w3c.dom.Node sourceRoot,
+                            org.w3c.dom.Node resultRoot)
+          throws TransformException {
+          try {
+              sheet.process(new RootNode(sourceRoot,
+                                         extend,
+                                         sheet.getSourceLoadContext(),
+                                         engine.getNameTable(),
+                                         null,
+                                         0),
+                            XmlSearchXSLTransformEngine.this,
+                            this, // ParameterSet
+                            new MultiNamespaceResult(new DOMBuilder(resultRoot),
+                                                     null));
+          }
+          catch (XSLException e) {
+              throw toTransformException(e);
+          }
+      }
+
+      public void transform(Node sourceRoot,
+                            Result result)
+          throws TransformException {
+          try {
+              sheet.process(sourceRoot,
+                            XmlSearchXSLTransformEngine.this,
+                            this, // ParameterSet
+                            result);
+          }
+          catch (XSLException e) {
+              throw toTransformException(e);
+          }
+      }
+      public Object getParameter(Name name) {
+          return null;
+      }
+    }
+
+    public Transform createTransform(org.w3c.dom.Node domNode)
+      throws TransformException
+    {
+      try {
+          return new TransformImpl(engine.createSheet(new RootNode(domNode,
+                                                                   extend,
+                                                                   engine.getSheetLoadContext(),
+                                                                   engine.getNameTable(),
+                                                                   null,
+                                                                   0)));
+      }
+      catch (XSLException e) {
+          throw toTransformException(e);
+      }
+      catch (IOException e) {
+          throw new Error("unexpected exception: " + e);
+      }
+    }
+
+    public NameTable getNameTable()
+    {
+      return engine.getNameTable();
+    }
+
+    public LoadContext getSourceLoadContext()
+    {
+      return engine.getSheetLoadContext();
+    }
+
+    private TransformException toTransformException(XSLException e)
+    {
+      org.w3c.dom.Node domNode = null;
+      Node node = e.getNode();
+      if (node != null) {
+          domNode = ((NodeBase)node).domNode;
+      }
+      String message = e.getMessage();
+      if (e == null) {
+          message = e.getException().toString();
+      }
+      return new TransformException(message, domNode);
+    }
+}
Index: xt/src/com/jclark/xsl/makefile.mk
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/src/com/jclark/xsl/makefile.mk	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,70 @@
+#*************************************************************************
+#
+#   OpenOffice.org - a multi-platform office productivity suite
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to
+#   the terms of GNU Lesser General Public License Version 2.1.
+#
+#
+#     GNU Lesser General Public License Version 2.1
+#     =============================================
+#     Copyright 2005 by Sun Microsystems, Inc.
+#     901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License version 2.1, as published by the Free Software Foundation.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#     MA  02111-1307  USA
+#
+#*************************************************************************
+
+PRJ   = ..$/..$/..$/..
+PRJNAME       = xt-xmlsearch
+PACKAGE = com$/jclark$/xsl
+TARGET  = com_jclark_xsl
+
+# --- Settings -----------------------------------------------------
+
+.INCLUDE : settings.mk
+
+.IF "$(XML_CLASSPATH)" != ""
+XCLASSPATH+=:$(XML_CLASSPATH)
+.ENDIF
+.IF "$(SYSTEM_XT)" == "YES"
+XCLASSPATH+=$(PATH_SEPERATOR)$(XT_JAR)
+.ENDIF
+
+JARFILES              =  xt.jar
+
+JAVAFILES             = $(subst,$(CLASSDIR)$/$(PACKAGE)$/, $(subst,.class,.java $(JAVACLASSFILES)))
+
+# --- Files --------------------------------------------------------
+
+JAVACLASSFILES        = \
+      $(CLASSDIR)$/$(PACKAGE)$/dom$/XmlSearchTransform.class \
+      $(CLASSDIR)$/$(PACKAGE)$/dom$/XmlSearchXSLTransformEngine.class
+
+JARCLASSDIRS  = com$/jclark
+JARTARGET     = $(PRJNAME).jar
+JARCOMPRESS   = TRUE
+CUSTOMMANIFESTFILE =
+
+
+# --- Targets ------------------------------------------------------
+
+.INCLUDE :  target.mk
Index: xt/xt-20051206.patch
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ xt/xt-20051206.patch	2006-01-08 16:30:58.000000000 +0100
@@ -0,0 +1,143 @@
+diff -rc misc/xt-20051206/build.xml misc/build/xt-20051206/build.xml
+*** misc/xt-20051206/build.xml	2005-12-06 14:30:46.000000000 +0100
+--- misc/build/xt-20051206/build.xml	2006-01-08 13:44:15.000000000 +0100
+***************
+*** 1,6 ****
+  <!-- $Id$ -->
+  
+! <project name="federator" default="help" basedir=".">
+  
+    <!-- 
+      |ANT Build targets for compiling sources, generating
+--- 1,6 ----
+  <!-- $Id$ -->
+  
+! <project name="federator" default="compile" basedir=".">
+  
+    <!-- 
+      |ANT Build targets for compiling sources, generating
+***************
+*** 238,244 ****
+        </srcfiles>
+      </uptodate>
+  
+!     <mkdir dir="${lib} "/>
+  
+      <!-- for debugging this build script -->  
+      <echo message="top: ${top}" />
+--- 238,244 ----
+        </srcfiles>
+      </uptodate>
+  
+!     <mkdir dir="${lib}"/>
+  
+      <!-- for debugging this build script -->  
+      <echo message="top: ${top}" />
+***************
+*** 306,311 ****
+--- 306,314 ----
+        
+        <classpath refid="compileJars" />
+  
++       <include name="**/*.java"/>
++       <exclude name="**/*Servlet*.java"/>
++ 
+      </javac>
+  
+      <!-- bundle up any local properties files -->
+***************
+*** 314,323 ****
+      </copy>
+  
+      <!-- jar it up -->
+!     <jar jarfile="${stage}/xt${version}.jar" 
+           basedir="${stage}/xt"
+           includes="**/*" />
+!     <copy todir="${lib}" file="${stage}/xt${version}.jar"/>
+    </target>
+  
+  
+--- 317,326 ----
+      </copy>
+  
+      <!-- jar it up -->
+!     <jar jarfile="${stage}/xt.jar" 
+           basedir="${stage}/xt"
+           includes="**/*" />
+!     <copy todir="${top}/../../../class" file="${stage}/xt.jar"/>
+    </target>
+  
+  
+Nur in misc/build/xt-20051206/: build.xml~.
+Nur in misc/build/xt-20051206/: build.xml.orig.
+Nur in misc/build/xt-20051206/: lib.
+diff -rc misc/xt-20051206/makefile.mk misc/build/xt-20051206/makefile.mk
+*** misc/xt-20051206/makefile.mk	2006-01-08 13:44:48.000000000 +0100
+--- misc/build/xt-20051206/makefile.mk	2006-01-08 13:37:20.000000000 +0100
+***************
+*** 1 ****
+! dummy
+--- 1,40 ----
+! #*************************************************************************
+! #
+! #   $RCSfile$
+! #
+! #   $Revision$
+! #
+! #   last change: $Author$ $Date$
+! #
+! #   The Contents of this file are made available subject to
+! #   the terms of GNU Lesser General Public License Version 2.1.
+! #
+! #
+! #     GNU Lesser General Public License Version 2.1
+! #     =============================================
+! #     Copyright 2005 by Sun Microsystems, Inc.
+! #     901 San Antonio Road, Palo Alto, CA 94303, USA
+! #
+! #     This library is free software; you can redistribute it and/or
+! #     modify it under the terms of the GNU Lesser General Public
+! #     License version 2.1, as published by the Free Software Foundation.
+! #
+! #     This library is distributed in the hope that it will be useful,
+! #     but WITHOUT ANY WARRANTY; without even the implied warranty of
+! #     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+! #     Lesser General Public License for more details.
+! #
+! #     You should have received a copy of the GNU Lesser General Public
+! #     License along with this library; if not, write to the Free Software
+! #     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+! #     MA  02111-1307  USA
+! #
+! #*************************************************************************
+! 
+! PRJ=..$/..$/..$/..
+! PRJNAME=ooo_xt
+! TARGET=compile
+! 
+! .INCLUDE : ant.mk
+! 
+! ALLTAR : ANTBUILD
+Nur in misc/build/xt-20051206/: makefile.mk.dummy.
+Nur in misc/build/xt-20051206/: makefile.mk.orig.
+diff -rc misc/xt-20051206/src/xt/java/com/jclark/xsl/trax/TransformerFactoryImpl.java misc/build/xt-20051206/src/xt/java/com/jclark/xsl/trax/TransformerFactoryImpl.java
+*** misc/xt-20051206/src/xt/java/com/jclark/xsl/trax/TransformerFactoryImpl.java	2005-12-06 14:30:52.000000000 +0100
+--- misc/build/xt-20051206/src/xt/java/com/jclark/xsl/trax/TransformerFactoryImpl.java	2006-01-08 13:37:20.000000000 +0100
+***************
+*** 384,389 ****
+--- 384,396 ----
+  
+      }
+  
++     /**
++      *
++      */
++     public void setFeature(String name, boolean value) throws TransformerConfigurationException
++     {
++     }
++ 
+      //
+      //
+      //
+Nur in misc/build/xt-20051206/src/xt/java/com/jclark/xsl/trax: TransformerFactoryImpl.java.orig.
+Nur in misc/build/xt-20051206/: stage.
Index: XmlSearch/src/com/sun/xmlsearch/makefile.mk
===================================================================
--- XmlSearch/src/com/sun/xmlsearch/makefile.mk.orig	2006-01-08 16:30:02.000000000 +0100
+++ XmlSearch/src/com/sun/xmlsearch/makefile.mk	2006-01-08 16:30:58.000000000 +0100
@@ -24,9 +24,12 @@ TARGET  = com_sun_xmlsearch
 .IF "$(XML_CLASSPATH)" != ""
 XCLASSPATH+=:$(XML_CLASSPATH)
 .ENDIF
+.IF "$(SYSTEM_XT)" == "YES"
+XCLASSPATH+=$(PATH_SEPERATOR)$(XT_JAR)
+.ENDIF
 
-JARFILES 		=  xt.jar
-#EXTRAJARFILES 		=  xt.jar  
+JARFILES 		=  xt.jar xt-xmlsearch.jar
+#EXTRAJARFILES 		=  xt.jar xt-xmlsearch.jar
 
 JAVAFILES		= $(subst,$(CLASSDIR)$/$(PACKAGE)$/, $(subst,.class,.java $(JAVACLASSFILES))) 
 
Index: XmlSearch/src/com/sun/xmlsearch/tree/TreeBuilder.java
===================================================================
--- XmlSearch/src/com/sun/xmlsearch/tree/TreeBuilder.java.orig	2006-01-08 16:30:02.000000000 +0100
+++ XmlSearch/src/com/sun/xmlsearch/tree/TreeBuilder.java	2006-01-08 16:30:58.000000000 +0100
@@ -145,6 +145,7 @@ public final class TreeBuilder extends H
 
 		public URL getURL() { return null; }
 		public int getLineNumber() { return -1; }
+		public int getColumnNumber() { return -1; }
 		public NamespacePrefixMap getNamespacePrefixMap() {
 			return _parent.getNamespacePrefixMap();
 		}
@@ -154,6 +155,12 @@ public final class TreeBuilder extends H
 		public String getUnparsedEntityURI(String name) {
 			return "getUnparsedEntityURI";
 		}
+		public String getPublicId() {
+			return "getPublicId";
+		}
+		public String getSystemId() {
+			return "getSystemId";
+		}
   
 		public boolean isLeaf() { return true; }
 		public int getChildCount() { return 0; }
Index: XmlSearch/src/com/sun/xmlsearch/xml/indexer/XmlIndexBuilder.java
===================================================================
--- XmlSearch/src/com/sun/xmlsearch/xml/indexer/XmlIndexBuilder.java.orig	2006-01-08 16:30:02.000000000 +0100
+++ XmlSearch/src/com/sun/xmlsearch/xml/indexer/XmlIndexBuilder.java	2006-01-08 16:30:58.000000000 +0100
@@ -60,13 +60,13 @@ import com.jclark.xsl.tr.Result;
 import com.jclark.xsl.tr.OutputMethod;
 import com.jclark.xsl.tr.LoadContext;
 
-import com.jclark.xsl.dom.Transform;
+import com.jclark.xsl.dom.XmlSearchTransform;
 import com.jclark.xsl.dom.TransformEngine;
 import com.jclark.xsl.dom.TransformException;
-import com.jclark.xsl.dom.XSLTransformEngine;
+import com.jclark.xsl.dom.XmlSearchXSLTransformEngine;
 
 public final class XmlIndexBuilder {
-	final class MyXslEngine extends XSLTransformEngine {
+	final class MyXslEngine extends XmlSearchXSLTransformEngine {
 		public Node load(
 			URL url,
 			int documentIndex,
@@ -436,8 +436,8 @@ public final class XmlIndexBuilder {
 
 	private TreeBuilder _treeBuilder;
 	private MyXslEngine _transformEngine;
-	private Transform _indexingTransform;
-	private Transform _defaultTransform;
+	private XmlSearchTransform _indexingTransform;
+	private XmlSearchTransform _defaultTransform;
 	private IndexAdapter _indexAdapter;
 
 	public XmlIndexBuilder(String indexDir) throws Exception {
@@ -534,7 +534,7 @@ public final class XmlIndexBuilder {
 		return _treeBuilder.getRoot(docUrl);
 	}
 
-	private Transform getTransform(String stylesheetName) throws Exception {
+	private XmlSearchTransform getTransform(String stylesheetName) throws Exception {
 		// System.out.println("creating indexing transform: " + stylesheetName);
 		URL stylesheetUrl = null;
 		if (_useLocalTransformFile) {
@@ -556,7 +556,7 @@ public final class XmlIndexBuilder {
 		DocumentBuilder dBuilder = dFactory.newDocumentBuilder();
 		Document sheet = dBuilder.parse(stylesheetStream);
 
-		return _transformEngine.createTransform(sheet);
+		return (XmlSearchTransform)_transformEngine.createTransform(sheet);
 	}
 
 	// GTM new:
Index: xmlhelp/source/com/sun/star/help/makefile.mk
===================================================================
--- xmlhelp/source/com/sun/star/help/makefile.mk.orig	2006-01-08 16:30:02.000000000 +0100
+++ xmlhelp/source/com/sun/star/help/makefile.mk	2006-01-08 16:30:58.000000000 +0100
@@ -22,9 +22,12 @@ TARGET  = com_sun_star_help
 
 .INCLUDE : settings.mk
 
-JARFILES 		= xt.jar unoil.jar ridl.jar jurt.jar jut.jar xmlsearch.jar
+JARFILES 		= xt.jar unoil.jar ridl.jar jurt.jar jut.jar xmlsearch.jar xt-xmlsearch.jar
 EXTRAJARFILES 	= 
 
+.IF "$(SYSTEM_XT)" == "YES"
+XCLASSPATH+=$(PATH_SEPERATOR)$(XT_JAR)
+.ENDIF
 .IF "$(SYSTEM_DB)" == "YES"
 XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(DB_JAR)
 .ELSE
Index: helpcontent2/settings.pmk
===================================================================
--- helpcontent2/settings.pmk.orig	2006-01-08 16:30:02.000000000 +0100
+++ helpcontent2/settings.pmk	2006-01-08 16:30:58.000000000 +0100
@@ -1,5 +1,8 @@
+.IF "$(SYSTEM_XT)" != "YES"
+XT_JAR=$(SOLARBINDIR)$/xt.jar
+.ENDIF
 
-my_cp:=$(CLASSPATH)$(PATH_SEPERATOR)$(SOLARBINDIR)$/xercesImpl.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/unoil.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/ridl.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jurt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jut.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlsearch.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlhelp.jar
+my_cp:=$(CLASSPATH)$(PATH_SEPERATOR)$(SOLARBINDIR)$/xercesImpl.jar$(PATH_SEPERATOR)$(XT_JAR)$(PATH_SEPERATOR)$(SOLARBINDIR)$/xt-xmlsearch.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/unoil.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/ridl.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jurt.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/jut.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlsearch.jar$(PATH_SEPERATOR)$(SOLARBINDIR)$/xmlhelp.jar
 
 .IF "$(SYSTEM_DB)" == "YES"
 my_cp!:=$(my_cp)$(PATH_SEPERATOR)$(DB_JAR)
Index: XmlSearch/prj/build.lst
===================================================================
--- XmlSearch/prj/build.lst.orig	2006-01-08 14:45:58.000000000 +0100
+++ XmlSearch/prj/build.lst	2006-01-08 16:51:06.000000000 +0100
@@ -1,2 +1,2 @@
-xh	XmlSearch	:	external codemaker NULL
+xh	XmlSearch	:	xt codemaker NULL
 xh XmlSearch\src\com\sun\xmlsearch    nmake - all xs NULL
