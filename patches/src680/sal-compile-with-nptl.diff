--- sal/osl/unx/process.c.ark	2005-01-27 23:02:00.000000000 +0100
+++ sal/osl/unx/process.c	2005-01-27 23:04:54.000000000 +0100
@@ -533,7 +533,7 @@
 			for (i = 0; data.m_pszEnv[i] != NULL; i++)
 	     		putenv(data.m_pszEnv[i]);
 
-#if defined(LINUX)
+#if defined(LINUX) && !defined(NPTL)
             /* mfe: linux likes to have just one thread when the exec family is called */
             /*      this np function has this purpose ...                              */
             pthread_kill_other_threads_np();
--- config_office/configure.in.ark	2005-01-27 23:04:31.000000000 +0100
+++ config_office/configure.in	2005-01-27 23:06:28.000000000 +0100
@@ -546,6 +546,9 @@
 		test_gtk=yes
 		test_kde=yes
 		test_cups=yes
+		if getconf GNU_LIBPTHREAD_VERSION |grep -q NPTL; then
+			PTHREAD_CFLAGS="-DNPTL"
+		fi
 		_os=Linux
 		;;
 	gnu)
--- solenv/inc/unxlngp.mk.ark	2005-01-28 00:28:08.000000000 +0100
+++ solenv/inc/unxlngp.mk	2005-01-28 00:28:18.000000000 +0100
@@ -65,7 +65,7 @@
 AFLAGS=
 
 # _PTHREADS is needed for the stl
-CDEFS+=-D_PTHREADS -D_REENTRANT -DGLIBC=2
+CDEFS+=$(PTHREAD_CFLAGS) -D_PTHREADS -D_REENTRANT -DGLIBC=2
 CDEFS+=-D_STD_NO_NAMESPACE -D_VOS_NO_NAMESPACE -D_UNO_NO_NAMESPACE
 CDEFS+=-DNO_INET_ON_DEMAND -DX86 -DNEW_SOLAR
 
--- solenv/inc/unxlngr.mk.ark	2005-01-28 00:28:33.000000000 +0100
+++ solenv/inc/unxlngr.mk	2005-01-28 00:28:40.000000000 +0100
@@ -73,7 +73,7 @@
 LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -DARM32 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DARM32 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
--- solenv/inc/unxlngi5.mk.ark	2005-01-28 00:27:54.000000000 +0100
+++ solenv/inc/unxlngi5.mk	2005-01-28 00:28:02.000000000 +0100
@@ -72,7 +72,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # enable visibility define in "sal/types.h"
 .IF "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
--- solenv/inc/unxlngppc4.mk.ark	2005-01-28 00:28:18.000000000 +0100
+++ solenv/inc/unxlngppc4.mk	2005-01-28 00:28:24.000000000 +0100
@@ -72,7 +72,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400 -DPOWERPC -DPPC
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400 -DPOWERPC -DPPC
 
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
--- solenv/inc/unxlngs3904.mk.ark	2005-01-28 00:28:40.000000000 +0100
+++ solenv/inc/unxlngs3904.mk	2005-01-28 00:28:47.000000000 +0100
@@ -72,7 +72,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
--- solenv/inc/unxlngs.mk.ark	2005-01-28 00:28:47.000000000 +0100
+++ solenv/inc/unxlngs.mk	2005-01-28 00:28:53.000000000 +0100
@@ -72,7 +72,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -D_PTHREADS -D_REENTRANT -DSPARC -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -D_PTHREADS -D_REENTRANT -DSPARC -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!=""
--- solenv/inc/unxlngppc.mk.ark	2005-01-28 00:28:24.000000000 +0100
+++ solenv/inc/unxlngppc.mk	2005-01-28 00:28:33.000000000 +0100
@@ -73,7 +73,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl 
-CDEFS+=-DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400 -DPOWERPC -DPPC 
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400 -DPOWERPC -DPPC 
 
 # this is a platform with JAVA support
 .IF "$(SOLAR_JAVA)"!="" 
--- solenv/inc/unxlngi4.mk.ark	2005-01-28 00:27:47.000000000 +0100
+++ solenv/inc/unxlngi4.mk	2005-01-28 00:27:54.000000000 +0100
@@ -72,7 +72,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # enable visibility define in "sal/types.h"
 .IF "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
--- solenv/inc/unxlngi6.mk.ark	2005-01-28 00:28:03.000000000 +0100
+++ solenv/inc/unxlngi6.mk	2005-01-28 00:28:08.000000000 +0100
@@ -72,7 +72,7 @@
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DX86 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # enable visibility define in "sal/types.h"
 .IF "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
--- solenv/inc/unxlnxi.mk.ark	2005-01-28 00:29:00.000000000 +0100
+++ solenv/inc/unxlnxi.mk	2005-01-28 00:29:06.000000000 +0100
@@ -64,7 +64,7 @@
 AFLAGS=
 
 # _PTHREADS is needed for the stl
-CDEFS+=-D_PTHREADS
+CDEFS+=$(PTHREAD_CFLAGS) -D_PTHREADS
 CDEFS+=-D_STD_NO_NAMESPACE -D_VOS_NO_NAMESPACE -D_UNO_NO_NAMESPACE
 CDEFS+=-DNO_INET_ON_DEMAND -DX86 -DNEW_SOLAR
 
--- solenv/inc/unxlngx6.mk	5 Oct 2005 11:36:34 -0000	1.2
+++ solenv/inc/unxlngx6.mk	1 Nov 2005 19:12:24 -0000
@@ -45,7 +45,7 @@ JAVAFLAGSDEBUG=-g
 #LINKOUTPUT_FILTER=" |& $(SOLARENV)$/bin$/msg_filter"
 
 # _PTHREADS is needed for the stl
-CDEFS+=-DGLIBC=2 -DX86_64 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
+CDEFS+=$(PTHREAD_CFLAGS) -DGLIBC=2 -DX86_64 -D_PTHREADS -D_REENTRANT -DNEW_SOLAR -D_USE_NAMESPACE=1 -DSTLPORT_VERSION=400
 
 # enable visibility define in "sal/types.h"
 .IF "$(HAVE_GCC_VISIBILITY_FEATURE)" == "TRUE"
