diff -urN svx.orig/inc/gallery1.hxx svx/inc/gallery1.hxx
--- svx.orig/inc/gallery1.hxx	2004-08-31 16:51:50.000000000 +0200
+++ svx/inc/gallery1.hxx	2005-05-13 15:07:37.000000000 +0200
@@ -66,6 +66,7 @@
 #include <tools/list.hxx>
 #include <tools/urlobj.hxx>
 #include <svtools/brdcst.hxx>
+#include "svx/svxdllapi.h"
 #include "gallery.hrc"
 
 #include <cstdio>
@@ -185,23 +186,23 @@
 
 public:
 
-	static Gallery*				AcquireGallery( const String& rMultiPath );
-	static void					ReleaseGallery( Gallery* pGallery );
+	SVX_DLLPUBLIC static Gallery*			AcquireGallery( const String& rMultiPath );
+	SVX_DLLPUBLIC static void			ReleaseGallery( Gallery* pGallery );
 								
 	const ULONG					GetThemeCount() const { return aThemeList.Count(); }
 	const GalleryThemeEntry*	GetThemeInfo( ULONG nPos ) { return aThemeList.GetObject( nPos ); }
 	const GalleryThemeEntry*	GetThemeInfo( const String& rThemeName ) { return ImplGetThemeEntry( rThemeName ); }
 	
-	BOOL						HasTheme( const String& rThemeName );
+	SVX_DLLPUBLIC BOOL				HasTheme( const String& rThemeName );
 	String						GetThemeName( ULONG nThemeId ) const;
 
-	BOOL						CreateTheme( const String& rThemeName );
+	SVX_DLLPUBLIC BOOL				CreateTheme( const String& rThemeName, UINT32 nNumFrom = 0 );
 	BOOL						CreateImportTheme( const INetURLObject& rURL, const String& rFileName );
 	BOOL						RenameTheme( const String& rOldName, const String& rNewName );
 	BOOL						RemoveTheme( const String& rThemeName );
 
-	GalleryTheme*				AcquireTheme( const String& rThemeName, SfxListener& rListener );
-	void						ReleaseTheme( GalleryTheme*	pTheme, SfxListener& rListener );
+	SVX_DLLPUBLIC GalleryTheme*			AcquireTheme( const String& rThemeName, SfxListener& rListener );
+	SVX_DLLPUBLIC void				ReleaseTheme( GalleryTheme*	pTheme, SfxListener& rListener );
 
 public:
 
diff -urN svx.orig/inc/galobj.hxx svx/inc/galobj.hxx
--- svx.orig/inc/galobj.hxx	2004-02-03 18:25:18.000000000 +0100
+++ svx/inc/galobj.hxx	2005-05-13 15:07:22.000000000 +0200
@@ -134,7 +134,7 @@
 	BOOL					bIsValid;
 	BOOL					bIsThumbBmp;
 
-	virtual void 			WriteData( SvStream& rOut ) const;
+	virtual void 			WriteData( SvStream& rOut, const String& rDestDir ) const;
 	virtual void 			ReadData( SvStream& rIn, UINT16& rReadVersion );
 
 	BOOL					CreateThumb( const Graphic& rGraphic );
@@ -170,7 +170,7 @@
 
 	GalSoundType		eSoundType;
 
-	virtual void 		WriteData( SvStream& rOut ) const;
+	virtual void		WriteData( SvStream& rOut, const String& rDestDir ) const;
 	virtual void 		ReadData( SvStream& rIn, UINT16& rReadVersion );
 
 	virtual UINT16		GetVersion() const { return 6; }
@@ -198,7 +198,7 @@
 
 	BOOL				CreateThumb( const FmFormModel& rModel );
 
-	virtual void 		WriteData( SvStream& rOut ) const;
+	virtual void		WriteData( SvStream& rOut, const String& rDestDir ) const;
 	virtual void 		ReadData( SvStream& rIn, UINT16& rReadVersion );
 
 	virtual UINT16		GetVersion() const { return 5; }
@@ -227,7 +227,7 @@
 
 	void				Init( const Graphic& rGraphic, const INetURLObject& rURL );
 
-	virtual void   		WriteData( SvStream& rOut ) const;
+	virtual void		WriteData( SvStream& rOut, const String& rDestDir ) const;
 	virtual void   		ReadData( SvStream& rIn, UINT16& rReadVersion );
 
 	virtual UINT16		GetVersion() const { return 5; }
diff -urN svx.orig/inc/galtheme.hxx svx/inc/galtheme.hxx
--- svx.orig/inc/galtheme.hxx	2005-01-21 15:42:45.000000000 +0100
+++ svx/inc/galtheme.hxx	2005-05-13 15:07:22.000000000 +0200
@@ -129,6 +129,7 @@
 
 	GalleryObjectList			aObjectList;
 	String						aImportName;
+	String						m_aDestDir;
 	SotStorageRef				aSvDrawStorageRef;
 	Gallery*					pParent;
 	GalleryThemeEntry*			pThm;
@@ -172,6 +173,9 @@
 	const String&				GetImportName() const { return aImportName; }
 	void						SetImportName(const String& rImportName) { aImportName = rImportName; }
 
+	const String&				GetDestDir() const { return m_aDestDir; }
+	void					SetDestDir(const String& rDestDir) { m_aDestDir = rDestDir; }
+
 	const INetURLObject&		GetThmURL() const { return pThm->GetThmURL(); }
 	const INetURLObject&		GetSdgURL() const { return pThm->GetSdgURL(); }
 	const INetURLObject&		GetSdvURL() const { return pThm->GetSdvURL(); }
diff -urN svx.orig/prj/build.lst svx/prj/build.lst
--- svx.orig/prj/build.lst	2004-11-17 11:20:45.000000000 +0100
+++ svx/prj/build.lst	2005-05-13 15:07:04.000000000 +0200
@@ -44,3 +44,4 @@
 sx	svx\source\customshapes					nmake	-	all sx_customshapes NULL
 sx	svx\source\toolbars						nmake	-	all sx_toolbars NULL
 sx	svx\util								nmake	-	all	sx_util sx_3deng sx_dlg sx_draw sx_properties sx_contact sx_mixer sx_event sx_animation sx_eeng sx_fmcmp sx_form sx_gall sx_items sx_link sx_mnuc sx_msfilt sx_opt sx_outl sx_rtf sx_sdi sx_stbc sx_tbxc sx_undrw sx_unedt sx_ungal sx_xml sx_xout sx_accessibility sx_intro sx_init sx_customshapes sx_toolbars NULL
+sx	svx\source\gengal						nmake	-	all	sx_gengal sx_util NULL
diff -urN svx.orig/prj/d.lst svx/prj/d.lst
--- svx.orig/prj/d.lst	2005-05-03 16:49:41.000000000 +0200
+++ svx/prj/d.lst	2005-05-13 15:07:04.000000000 +0200
@@ -25,6 +25,7 @@
 ..\%__SRC%\lib\lib*.* %_DEST%\lib%_EXT%\lib*.*
 ..\%__SRC%\lib\isvx.lib %_DEST%\lib%_EXT%\isvx.lib
 ..\%__SRC%\slb\xdraw.lib %_DEST%\lib%_EXT%\svxsmrtd.lib
+..\%__SRC%\bin\gengal* %_DEST%\bin%_EXT%\gengal*
 ..\%__SRC%\bin\svxslots.tlb %_DEST%\bin%_EXT%\svxslots.tlb
 ..\%__SRC%\bin\cui*.dll %_DEST%\bin%_EXT%\cui*.dll
 ..\%__SRC%\bin\svx*.dll %_DEST%\bin%_EXT%\svx*.dll
diff -urN svx.orig/source/gallery2/gallery1.cxx svx/source/gallery2/gallery1.cxx
--- svx.orig/source/gallery2/gallery1.cxx	2004-12-13 13:18:25.000000000 +0100
+++ svx/source/gallery2/gallery1.cxx	2005-05-13 15:07:32.000000000 +0200
@@ -715,14 +715,15 @@
 
 // ------------------------------------------------------------------------
 
-BOOL Gallery::CreateTheme( const String& rThemeName )
+BOOL Gallery::CreateTheme( const String& rThemeName, UINT32 nNumFrom )
 {
 	BOOL bRet = FALSE;
 
 	if( !HasTheme( rThemeName ) && ( GetUserURL().GetProtocol() != INET_PROT_NOT_VALID ) )
 	{
+		nLastFileNumber=nNumFrom > nLastFileNumber ? nNumFrom : ++nLastFileNumber;
 		GalleryThemeEntry* pNewEntry = new GalleryThemeEntry( GetUserURL(), rThemeName,
-															  ++nLastFileNumber,
+															  nLastFileNumber,
 															  FALSE, FALSE, TRUE, 0, FALSE );
 
 		aThemeList.Insert( pNewEntry, LIST_APPEND );
diff -urN svx.orig/source/gallery2/galobj.cxx svx/source/gallery2/galobj.cxx
--- svx.orig/source/gallery2/galobj.cxx	2004-12-13 13:18:55.000000000 +0100
+++ svx/source/gallery2/galobj.cxx	2005-05-13 15:07:22.000000000 +0200
@@ -163,7 +163,7 @@
 
 // ------------------------------------------------------------------------
 
-void SgaObject::WriteData( SvStream& rOut ) const
+void SgaObject::WriteData( SvStream& rOut, const String& rDestDir ) const
 {
 	static const UINT32 nInventor = COMPAT_FORMAT( 'S', 'G', 'A', '3' );
 
@@ -186,7 +186,9 @@
 	else
 		rOut << aThumbMtf;
 
-	rOut << ByteString( String(aURL.GetMainURL( INetURLObject::NO_DECODE )), RTL_TEXTENCODING_UTF8 );
+	String aURLWithoutDestDir = String(aURL.GetMainURL( INetURLObject::NO_DECODE ));
+	aURLWithoutDestDir.SearchAndReplace(rDestDir, String());
+	rOut << ByteString( aURLWithoutDestDir, RTL_TEXTENCODING_UTF8 );
 }
 
 // ------------------------------------------------------------------------
@@ -253,7 +255,7 @@
 
 SvStream& operator<<( SvStream& rOut, const SgaObject& rObj )
 {
-	rObj.WriteData( rOut );
+	rObj.WriteData( rOut, String() );
 	return rOut;
 }
 
@@ -306,13 +308,13 @@
 
 // ------------------------------------------------------------------------
 
-void SgaObjectBmp::WriteData( SvStream& rOut ) const
+void SgaObjectBmp::WriteData( SvStream& rOut, const String& rDestDir ) const
 {
 	String	aDummyStr;
 	char	aDummy[ 10 ];
 
 	// Version setzen
-	SgaObject::WriteData( rOut );
+	SgaObject::WriteData( rOut, rDestDir );
 	rOut.Write( aDummy, 10 );
 	rOut << ByteString( aDummyStr, RTL_TEXTENCODING_UTF8 ) << ByteString( aTitle, RTL_TEXTENCODING_UTF8 );
 }
@@ -393,9 +395,9 @@
 
 // ------------------------------------------------------------------------
 
-void SgaObjectSound::WriteData( SvStream& rOut ) const
+void SgaObjectSound::WriteData( SvStream& rOut, const String& rDestDir ) const
 {
-	SgaObject::WriteData( rOut );
+	SgaObject::WriteData( rOut, rDestDir );
 	rOut << (UINT16) eSoundType << ByteString( aTitle, RTL_TEXTENCODING_UTF8 );
 }
 
@@ -567,9 +569,9 @@
 
 // ------------------------------------------------------------------------
 
-void SgaObjectSvDraw::WriteData( SvStream& rOut ) const
+void SgaObjectSvDraw::WriteData( SvStream& rOut, const String& rDestDir ) const
 {
-	SgaObject::WriteData( rOut );
+	SgaObject::WriteData( rOut, rDestDir );
 	rOut << ByteString( aTitle, RTL_TEXTENCODING_UTF8 );
 }
 
diff -urN svx.orig/source/gallery2/galtheme.cxx svx/source/gallery2/galtheme.cxx
--- svx.orig/source/gallery2/galtheme.cxx	2005-01-11 14:00:56.000000000 +0100
+++ svx/source/gallery2/galtheme.cxx	2005-05-13 15:07:22.000000000 +0200
@@ -159,7 +159,7 @@
 	{
 		const sal_uInt32 nOffset = pOStm->Seek( STREAM_SEEK_TO_END );
 
-		*pOStm << rObj;
+		rObj.WriteData( *pOStm, m_aDestDir );
 
 		if( !pOStm->GetError() )
 		{
@@ -1423,7 +1423,8 @@
 					aPath = pObj->aURL.GetMainURL( INetURLObject::NO_DECODE );
 			}
 		}
-
+		
+		aPath.SearchAndReplace(m_aDestDir, String());
 		rOStm << bRel << ByteString( aPath, RTL_TEXTENCODING_UTF8 ) << pObj->nOffset << (sal_uInt16) pObj->eObjKind;
 	}
 
