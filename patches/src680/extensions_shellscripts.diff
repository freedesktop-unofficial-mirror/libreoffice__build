--- setup_native/source/packinfo/shellscripts_extensions.txt.orig	2007-09-06 12:03:18.000000000 +0200
+++ setup_native/source/packinfo/shellscripts_extensions.txt	2008-03-22 09:52:34.000000000 +0100
@@ -28,7 +28,7 @@
 fi
 
 if [ -x "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" ]; then
-  "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$ORIGIN/../share/config/javasettingsunopkginstall.xml'
+  "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
 fi
 
 if [ -n "$$INSTDIR" ]; then
@@ -61,7 +61,7 @@
 fi
 
 if [ -x "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" ]; then
-  "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" add --shared "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}" "-env:UserInstallation=file://////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$ORIGIN/../share/config/javasettingsunopkginstall.xml'
+  "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" add --shared "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}" "-env:UserInstallation=file://////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
 fi
 
 if [ -n "$$INSTDIR" ]; then
@@ -99,7 +99,7 @@
 fi
 
 if [ -x "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" ]; then
-  "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$ORIGIN/../share/config/javasettingsunopkginstall.xml'
+  "$$RPM_INSTALL_PREFIX/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
 fi
 
 if [ -n "$$INSTDIR" ]; then
@@ -109,6 +109,122 @@
 exit 0
 END
 
+# Start of deb package script #################
+
+%system deb
+
+# As remove does not need the oxt file, this could potentially 
+# be done in the postinstall script as well.
+%preinstall << END
+# if this is an update, remove the old package instance first
+test "$$1" = "upgrade" || exit 0
+
+#Find the temp dir
+if [ -n "$$TMPDIR" ]; then
+  UNOPKGTMP="$$TMPDIR"
+elif [ -n "$$TMP" ]; then
+  UNOPKGTMP="$$TMP"
+elif [ -d "/tmp" ]; then
+  UNOPKGTMP="/tmp"
+else
+  echo "No tmp directory found!"
+  exit 1
+fi
+
+#Create the command which creates a temporary directory
+if [ -x "/bin/mktemp" ]
+then
+  INSTDIR=`/bin/mktemp -d "$${UNOPKGTMP}/userinstall.XXXXXX"`
+else
+  INSTDIR="$${UNOPKGTMP}/userinstall.$$$$"
+  mkdir "$$INSTDIR"
+fi
+
+if [ -x "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/program/unopkg" ]; then
+  "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
+fi
+
+if [ -n "$$INSTDIR" ]; then
+  rm -rf "$$INSTDIR"
+fi
+
+exit 0
+END
+
+%postinstall << END
+#Find the temp dir
+if [ -n "$$TMPDIR" ]; then
+  UNOPKGTMP="$$TMPDIR"
+elif [ -n "$$TMP" ]; then
+  UNOPKGTMP="$$TMP"
+elif [ -d "/tmp" ]; then
+  UNOPKGTMP="/tmp"
+else
+  echo "No tmp directory found!"
+  exit 1
+fi
+
+#Create the command which creates a temporary directory
+if [ -x "/bin/mktemp" ]
+then
+  INSTDIR=`/bin/mktemp -d "$${UNOPKGTMP}/userinstall.XXXXXX"`
+else
+  INSTDIR="$${UNOPKGTMP}/userinstall.$$$$"
+  mkdir "$$INSTDIR"
+fi
+
+if [ -x "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/program/unopkg" ]; then
+  "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/program/unopkg" add --shared "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}" "-env:UserInstallation=file://////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
+fi
+
+if [ -n "$$INSTDIR" ]; then
+  rm -rf "$$INSTDIR"
+fi
+
+exit 0
+
+
+END
+
+%preremove << END
+# if this is an update, just do nothing
+test "$$1" = "upgrade" || exit 0
+
+#Find the temp dir
+if [ -n "$$TMPDIR" ]; then
+  UNOPKGTMP="$$TMPDIR"
+elif [ -n "$$TMP" ]; then
+  UNOPKGTMP="$$TMP"
+elif [ -d "/tmp" ]; then
+  UNOPKGTMP="/tmp"
+else
+  echo "No tmp directory found!"
+  exit 1
+fi
+
+#Create the command which creates a temporary directory
+if [ -x "/bin/mktemp" ]
+then
+  INSTDIR=`/bin/mktemp -d "$${UNOPKGTMP}/userinstall.XXXXXX"`
+else
+  INSTDIR="$${UNOPKGTMP}/userinstall.$$$$"
+  mkdir "$$INSTDIR"
+fi
+
+if [ -x "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/program/unopkg" ]; then
+  "PRODUCTINSTALLLOCATION/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
+fi
+
+if [ -n "$$INSTDIR" ]; then
+  rm -rf "$$INSTDIR"
+fi
+
+exit 0
+END
+
+# End of deb package script #################
+
+
 %system solaris
 
 %postinstall << END
@@ -137,11 +253,16 @@
 if [ -x $$PKG_INSTALL_ROOT/usr/lib/postrun ]; then
 ( echo "test -x \"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg\" || exit 0"
   echo "umask 022"
-  echo "\"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg\" add --shared \"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}\" \"-env:UserInstallation=file:////$$INSTDIR\" '-env:UNO_JAVA_JFW_INSTALL_DATA=\$$ORIGIN/../share/config/javasettingsunopkginstall.xml'"
+  echo "\"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg\" add --shared \"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}\" \"-env:UserInstallation=file:////$$INSTDIR\" '-env:UNO_JAVA_JFW_INSTALL_DATA=\$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'"
 ) | $$PKG_INSTALL_ROOT/usr/lib/postrun -b -c UNOPKG
+  if [ "$$?" != "0" ]; then
+    echo "\nERROR: Installation of UNO extension ${OXTFILENAME}"
+    echo " through $$PKG_INSTALL_ROOT/usr/lib/postrun failed."
+    exit 1
+  fi
 else
   # No postrun available, try running unopkg directly
-  "$$BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg" add --shared "$$BASEDIR/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$ORIGIN/../share/config/javasettingsunopkginstall.xml'
+  "$$BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg" add --shared "$$BASEDIR/PRODUCTDIRECTORYNAME/share/extension/install/${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
   if [ "$$?" != "0" ]; then
     echo "\nERROR: Installation of UNO extension ${OXTFILENAME} failed."
     test "$$BASEDIR" = "$$CLIENT_BASEDIR" || echo "ERROR: alternate root install requires SUNWpostrun package to be installed"
@@ -183,13 +304,13 @@
 ( echo "test -x \"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg\" || exit 0"
   echo "cd \"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program\""
   echo "umask 022"
-  echo "\"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg\" remove --shared \"${OXTFILENAME}\" \"-env:UserInstallation=file:////$$INSTDIR\" '-env:UNO_JAVA_JFW_INSTALL_DATA=\$$ORIGIN/../share/config/javasettingsunopkginstall.xml'"
+  echo "\"$$CLIENT_BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg\" remove --shared \"${OXTFILENAME}\" \"-env:UserInstallation=file:////$$INSTDIR\" '-env:UNO_JAVA_JFW_INSTALL_DATA=\$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'"
   echo "rm -rf \"$$INSTDIR\""
 ) | $$PKG_INSTALL_ROOT/usr/lib/postrun -b -c UNOPKG
 else
   # No postrun available, try running unopkg directly
   test -x $$BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg || exit 0  
-  "$$BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$ORIGIN/../share/config/javasettingsunopkginstall.xml'
+  "$$BASEDIR/PRODUCTDIRECTORYNAME/program/unopkg" remove --shared "${OXTFILENAME}" "-env:UserInstallation=file:////$$INSTDIR" '-env:UNO_JAVA_JFW_INSTALL_DATA=$$OOO_BASE_DIR/share/config/javasettingsunopkginstall.xml'
   if [ "$$?" != "0" ]; then
     echo "\nERROR: Removal of UNO extension ${OXTFILENAME} failed."
     test "$$BASEDIR" = "$$CLIENT_BASEDIR" || echo "ERROR: alternate root uninstall requires SUNWpostrun package to be installed"
