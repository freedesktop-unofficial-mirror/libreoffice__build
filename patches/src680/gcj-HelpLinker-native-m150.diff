Index: set_soenv.in
===================================================================
RCS file: /cvs/tools/config_office/set_soenv.in,v
retrieving revision 1.74
diff -u -p -u -r1.74 set_soenv.in
--- config_office/set_soenv.in	30 Aug 2005 09:12:51 -0000	1.74
+++ config_office/set_soenv.in	16 Sep 2005 10:53:11 -0000
@@ -78,7 +78,7 @@ my ( $oldPATH, $SRC_ROOT, $SO_HOME, $JAV
      $UPD, $SOLARUPD, $WORK_STAMP, $TF_ONE51, $TF_UCB, 
      $URD_ONLY, $SOLARROOT, $SOLARSRC, $DEVROOT, $SOLARVER, $SOLARVERSION, $SOLARENV, 
      $STAR_INIROOT, $STAR_INIROOTOLD, $STAR_STANDLST, $STAR_SSCOMMON, $STAR_SSOLARINI, 
-     $STAR_REGISTRY, $STAR_RESOURCEPATH, $DMAKEROOT, $CLASSPATH, $XCLASSPATH, $COMPATH, $GCJ_DATABASE,
+     $STAR_REGISTRY, $STAR_RESOURCEPATH, $DMAKEROOT, $CLASSPATH, $XCLASSPATH, $COMPATH, $GCJ_DATABASE, $GCJ_CACHEDIR,
      $MSPDB_PATH, $MIDL_PATH, $CSC_PATH, $NMAKE_PATH, 
      $LD_LIBRARY_PATH, $PATH, $SOLARDEF, $SOLAREXTRAINC, $SOLAREXTRALIB, $SOLARLIB, 
      $SOLARINC, $LOCALINI, $PATHEXTRA, $FRAMEWORKSHOME, $COMEX, $MULTITHREAD_OBJ, $PERL, 
@@ -894,8 +894,10 @@ $CLASSPATH            = '$JAVA_HOME'.$ds
 # Location of the JDK supported standard classes.zip file.
 # see above for why the change
 $XCLASSPATH           = '$JAVA_HOME'.$ds.'jre'.$LIB.$ds."rt.jar".$ps.'.';
-# Localtion of gcj cache
-$GCJ_DATABASE = '$SOLARVER'.$ds.'$UPD'.$ds.'$INPATH'.$LIB.$ds."openoffice.org.gcjdb";
+# Location of gcj cache
+$GCJ_CACHEDIR = '$SOLARVER'.$ds.'$UPD'.$ds.'$INPATH'.$LIB.$ds;
+# Location of gcj database
+$GCJ_DATABASE = $GCJ_CACHEDIR."openoffice.org.gcjdb";
 
 # Paths to run time shared libraries.
 if ($platform =~ m/solaris/) 
@@ -1659,6 +1661,7 @@ if ( $JDK ne "gcj" ) {
    ToFile( "XCLASSPATH",        $XCLASSPATH,        "e" );
 }
 else {
+   ToFile( "GCJ_CACHEDIR",     $GCJ_CACHEDIR,       "e" );
    ToFile( "GCJ_DATABASE",     $GCJ_DATABASE,       "e" );
    ToFile( "JAVACACHE",        '@JAVACACHE@',       "e" );
    ToFile( "AWTLIB",           '@AWTLIB@',          "e" );
Index: util/target.pmk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/target.pmk,v
retrieving revision 1.10
diff -u -p -u -r1.10 target.pmk
--- helpcontent2/util/target.pmk	8 Sep 2005 03:01:39 -0000	1.10
+++ helpcontent2/util/target.pmk	16 Sep 2005 11:12:39 -0000
@@ -52,5 +52,8 @@
 
 $(LINKALLTARGETS) : $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/$$(@:b:s/_/./:e:s/.//)/$i) $(subst,LANGUAGE,$$(@:b:s/_/./:e:s/.//) $(LINKADDEDDEPS)) $(COMMONMISC)$/xhp_changed.flag
 	@+-$(MKDIR) -p $(@:d)
+.IF "$(JDK)" != "gcj"
 	$(JAVAI) $(JAVA_VM_HEAP_SIZE) $(JAVA_LIBRARY_PATH) -cp $(my_cp) com.sun.star.help.HelpLinker @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -idx $(PRJ)$/source$/auxiliary$/index.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
-
+.ELSE
+	HelpLinker @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -idx $(PRJ)$/source$/auxiliary$/index.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
+.ENDIF
Index: bin/deliver.pl
===================================================================
RCS file: /cvs/tools/solenv/bin/deliver.pl,v
retrieving revision 1.92
diff -u -p -u -r1.92 deliver.pl
--- solenv/bin/deliver.pl	7 Sep 2005 22:07:53 -0000	1.92
+++ solenv/bin/deliver.pl	16 Sep 2005 10:53:51 -0000
@@ -720,8 +720,10 @@ sub strip_target {
 };
 
 sub cachejar {
+    my $todir = $ENV{'GCJ_CACHEDIR'};
     my $file = shift;
-    my $to = $file.".so";
+    $lib = basename($file);
+    my $to = $todir."lib".$lib.".so";
     print "CACHEJAR: $file -> $to with $ENV{GCJ_DATABASE}\n";
     print "Caching 1/2: $ENV{JAVACOMPILER} -shared -fPIC -Wl,-Bsymbolic -O2 -findirect-dispatch -fjni -o $to $file\n";
     system("$ENV{JAVACOMPILER} -shared -fPIC -Wl,-Bsymbolic -O2 -findirect-dispatch -fjni -o $to $file");
Index: prj/d.lst
===================================================================
RCS file: /cvs/util/xmlhelp/prj/d.lst,v
retrieving revision 1.12
diff -u -p -u -r1.12 d.lst
--- xmlhelp/prj/d.lst	27 May 2003 15:54:01 -0000	1.12
+++ xmlhelp/prj/d.lst	16 Sep 2005 10:51:40 -0000
@@ -1,4 +1,5 @@
 ..\%__SRC%\bin\*.dll %_DEST%\bin%_EXT%\*.*
+..\%__SRC%\bin\HelpLinker %_DEST%\bin%_EXT%\HelpLinker
 ..\%__SRC%\lib\lib*.so %_DEST%\lib%_EXT%
 ..\%__SRC%\lib\*.dylib %_DEST%\lib%_EXT%\*.*
 ..\%__SRC%\class\*.jar %_DEST%\bin%_EXT%\*.*
Index: source/com/sun/star/help/makefile.mk
===================================================================
RCS file: /cvs/util/xmlhelp/source/com/sun/star/help/makefile.mk,v
retrieving revision 1.20
diff -u -p -u -r1.20 makefile.mk
--- xmlhelp/source/com/sun/star/help/makefile.mk	11 Apr 2005 09:31:48 -0000	1.20
+++ xmlhelp/source/com/sun/star/help/makefile.mk	21 Sep 2005 13:00:11 -0000
@@ -75,10 +75,27 @@ JAVACLASSFILES += \
 	$(CLASSDIR)$/$(PACKAGE)$/FileURLStreamHandlerWithNotify.class
 .ENDIF
 
+.IF "$(JDK)"=="gcj"
+
+.IF "$(SYSTEM_DB)"=="YES"
+$(BIN)$/HelpLinker: $(LB)$/libdb.jar.a
+.ELSE
+$(BIN)$/HelpLinker:
+.ENDIF
+	$(JAVACOMPILER) --main=com.sun.star.help.HelpLinker -o $(BIN)$/HelpLinker \
+		-O2 -Wl,-Bsymbolic -findirect-dispatch -fjni -fno-assert -Wno-deprecated \
+		$(JAVACPS) $(CLASSPATH) $(JAVAFILES) $(SOLARLIB) -L$(LB) \
+		-ldb.jar -lxmlsearch.jar -lxt.jar -lunoil.jar -ljurt.jar -lridl.jar
+
+$(LB)$/libdb.jar.a:
+	$(JAVACOMPILER) -c -O2 -findirect-dispatch -fjni $(DB_JAR) -o $(LB)$/libdb.jar.a
+
+.ELSE
 JARCLASSDIRS	= com
 JARTARGET		= $(PRJNAME).jar
 JARCOMPRESS 	= TRUE
 CUSTOMMANIFESTFILE = manifest
+.ENDIF
 
 
 # --- Targets ------------------------------------------------------
