diff -Nur config_office.orig/configure.in config_office/configure.in
--- config_office.orig/configure.in	2006-04-29 17:30:48.000000000 +0200
+++ config_office/configure.in	2006-04-29 17:46:34.000000000 +0200
@@ -313,6 +313,10 @@
 [  --with-xalan-jar=JARFILE   Specify path to jarfile manually ],
 [ XALAN_JAR="$withval"
 ])
+AC_ARG_WITH(serializer-jar,
+[  --with-serializer-jar=JARFILE   Specify path to jarfile manually ],
+[ SERIALIZER_JAR="$withval"
+])
 AC_ARG_WITH(system-sablot,
 [  --with-system-sablot    Use sablot already on system
 ],,)
@@ -3119,6 +3123,26 @@
           AC_CHECK_FILE($XALAN_JAR, [],
                [AC_MSG_ERROR(xalan.jar replacement not found.)], [])
         fi
+        if test -z "$SERIALIZER_JAR"; then
+          # FIXME: add check for xalan version to know when serializer.jar
+          #        is required 
+          AC_CHECK_FILE(/usr/share/java/xalan-j2-serializer.jar, 
+            [ SERIALIZER_JAR=/usr/share/java/xalan-j2-serializer.jar ],
+            [
+              AC_CHECK_FILE(/usr/share/java/xalan2-serializer.jar, 
+                [ SERIALIZER_JAR=/usr/share/java/xalan2-serializer.jar ],
+                [ AC_CHECK_FILE(/usr/share/java/serializer.jar,
+                    [ SERIALIZER_JAR=/usr/share/java/serializer.jar ],
+                    [], []
+                  )
+                ]
+              )
+            ]
+          )
+	else
+          AC_CHECK_FILE($SERIALIZER_JAR, [],
+               [AC_MSG_ERROR(serializer.jar not found.)], [])
+        fi
 else
     AC_MSG_RESULT([internal])
     SYSTEM_XALAN=NO
@@ -3126,6 +3150,7 @@
 fi
 AC_SUBST(SYSTEM_XALAN)
 AC_SUBST(XALAN_JAR)
+AC_SUBST(SERIALIZER_JAR)
 
 if test -n "$NEED_XALAN"; then
    BUILD_TYPE="$BUILD_TYPE XALAN"
diff -Nur config_office.orig/set_soenv.in config_office/set_soenv.in
--- config_office.orig/set_soenv.in	2006-04-29 17:31:15.000000000 +0200
+++ config_office/set_soenv.in	2006-04-29 17:47:03.000000000 +0200
@@ -1771,6 +1771,7 @@
 ToFile( "XERCES_JAR",        "@XERCES_JAR@",       "e" );
 ToFile( "SYSTEM_XALAN",      "@SYSTEM_XALAN@",     "e" );
 ToFile( "XALAN_JAR",         "@XALAN_JAR@",        "e" );
+ToFile( "SERIALIZER_JAR",    "@SERIALIZER_JAR@",   "e" );
 ToFile( "SYSTEM_XT",         "@SYSTEM_XT@",        "e" );
 ToFile( "XT_JAR",            "@XT_JAR@",           "e" );
 ToFile( "SYSTEM_SABLOT",     "@SYSTEM_SABLOT@",    "e" );
diff -Nur filter.orig/source/config/fragments/makefile.mk filter/source/config/fragments/makefile.mk
--- filter.orig/source/config/fragments/makefile.mk	2006-09-27 17:09:06.000000000 +0200
+++ filter/source/config/fragments/makefile.mk		2006-09-27 17:09:12.000000000 +0200
@@ -159,8 +159,15 @@
 .ENDIF
 
 .IF "$(XSLTPROC)"=="NO_XSLTPROC"
-XALAN_JAR*=$(SOLARBINDIR)$/xalan.jar
-PACKLANG := $(JAVAI) $(JAVACPS) $(XALAN_JAR) org.apache.xalan.xslt.Process -XSL langfilter.xsl
+.IF "$(SYSTEM_XALAN)" == "YES"
+XCLASSPATH!:=$(XALAN_JAR)
+.IF "$(SERIALIZER_JAR)" != ""
+XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(SERIALIZER_JAR)
+.ENDIF
+.ELSE
+XCLASSPATH!:=$(SOLARBINDIR)$/xalan.jar
+.ENDIF
+PACKLANG := $(JAVAI) $(JAVACPS) $(XCLASSPATH) org.apache.xalan.xslt.Process -XSL langfilter.xsl
 PACKLANG_IN := -IN
 PACKLANG_PARAM := -PARAM
 PACKLANG_XSL := -XSL
diff -Nur filter.orig/source/xsltfilter/makefile.mk filter/source/xsltfilter/makefile.mk
--- filter.orig/source/xsltfilter/makefile.mk	2006-04-29 18:08:18.000000000 +0200
+++ filter/source/xsltfilter/makefile.mk	2006-04-29 18:09:56.000000000 +0200
@@ -74,6 +74,9 @@
 
 .IF "$(SYSTEM_XALAN)" == "YES"
 XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(XALAN_JAR)
+.IF "$(SERIALIZER_JAR)" != ""
+XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(SERIALIZER_JAR)
+.ENDIF
 .ELSE
 JARFILES += xalan.jar
 .ENDIF
--- scp2/source/ooo/makefile.mk.orig	2006-08-29 15:17:52.000000000 +0200
+++ scp2/source/ooo/makefile.mk	2006-08-29 15:19:45.000000000 +0200
@@ -166,6 +166,9 @@
 
 .IF "$(SYSTEM_XALAN)" == "YES"
 SCPDEFS+=-DSYSTEM_XALAN -DXALAN_JAR=\""file://$(XALAN_JAR)"\"
+.IF "$(SERIALIZER_JAR)" != ""
+SCPDEFS+=-DSYSTEM_SERIALIZER -DSERIALIZER_JAR=\""file://$(SERIALIZER_JAR)"\"
+.ENDIF
 .ENDIF
 
 .IF "$(JDK)" == "gcj"
--- scp2/source/ooo/profileitem_ooo.scp.orig	2006-08-29 15:18:04.000000000 +0200
+++ scp2/source/ooo/profileitem_ooo.scp	2006-08-29 15:23:31.000000000 +0200
@@ -841,5 +841,8 @@
 #endif
 #ifdef SYSTEM_XALAN
     ValueList29 = XALAN_JAR;
+#ifdef SYSTEM_SERIALIZER
+    ValueList30 = SERIALIZER_JAR;
+#endif
 #endif
 End
