Index: basic/inc/sbmod.hxx
===================================================================
RCS file: /cvs/script/basic/inc/sbmod.hxx,v
retrieving revision 1.11
diff -u -p -r1.11 sbmod.hxx
--- basic/inc/sbmod.hxx	7 Sep 2005 21:02:58 -0000	1.11
+++ basic/inc/sbmod.hxx	3 Feb 2006 17:43:23 -0000
@@ -127,6 +132,10 @@ public:
     // Store only image, no source (needed for new password protection)
    	BOOL StoreBinaryData( SvStream& );    
 	BOOL LoadBinaryData( SvStream& );
+	BOOL IsCompatibleModeSet(){ return bIsCompatible; }
+	void SetCompatibleMode( BOOL bCompatible );
+private:
+	BOOL bIsCompatible;
 };
 
 #ifndef __SB_SBMODULEREF_HXX
Index: basic/source/classes/sbxmod.cxx
===================================================================
RCS file: /cvs/script/basic/source/classes/sbxmod.cxx,v
retrieving revision 1.27
diff -u -p -r1.27 sbxmod.cxx
--- basic/source/classes/sbxmod.cxx	29 Sep 2005 18:38:55 -0000	1.27
+++ basic/source/classes/sbxmod.cxx	3 Feb 2006 17:43:51 -0000
@@ -238,7 +238,8 @@ int CDECL compare_strings( const void *a
 
 SbModule::SbModule( const String& rName )
 		 : SbxObject( String( RTL_CONSTASCII_USTRINGPARAM("StarBASICModule") ) ),
-		   pImage( NULL ), pBreaks( NULL ), pClassData( NULL )
+		   pImage( NULL ), pBreaks( NULL ), pClassData( NULL ), 
+bIsCompatible( TRUE )
 {
 	SetName( rName );
 	SetFlag( SBX_EXTSEARCH | SBX_GBLSEARCH );
@@ -695,7 +696,8 @@ USHORT SbModule::Run( SbMethod* pMeth )
 		xBasic = (StarBASIC*) GetParent();
 
 		pINST = new SbiInstance( (StarBASIC*) GetParent() );
-
+		if ( bIsCompatible != pINST->IsCompatibility() )
+			pINST->EnableCompatibility( bIsCompatible );
 		// Error-Stack loeschen
 		SbErrorStack*& rErrStack = GetSbData()->pErrStack;
 		delete rErrStack;
@@ -1971,6 +1974,15 @@ void SbMethod::Broadcast( ULONG nHintId 
 	}
 }
 
+void
+SbModule::SetCompatibleMode(BOOL bCompatible)
+{ 
+	
+	bIsCompatible = bCompatible;
+	if ( pINST && ( bIsCompatible != pINST->IsCompatibility() ) )
+		pINST->EnableCompatibility( bIsCompatible );
+}
+
 /////////////////////////////////////////////////////////////////////////
 
 // Implementation SbJScriptMethod (Method-Klasse als Wrapper fuer JavaScript-Funktionen)
Index: basic/source/comp/parser.cxx
===================================================================
RCS file: /cvs/script/basic/source/comp/parser.cxx,v
retrieving revision 1.13
diff -u -p -r1.13 parser.cxx
--- basic/source/comp/parser.cxx	29 Sep 2005 16:17:04 -0000	1.13
+++ basic/source/comp/parser.cxx	3 Feb 2006 17:44:06 -0000
@@ -128,7 +129,7 @@ static SbiStatement StmntTable [] = {
 #pragma warning( disable: 4355 )
 #endif
 
-SbiParser::SbiParser( StarBASIC* pb, SbModule* pm )
+SbiParser::SbiParser( StarBASIC* pb, SbModule* pm, BOOL bIsCompatible )
 		: SbiTokenizer( pm->GetSource32(), pb ),
 		  aGblStrings( this ),
 		  aLclStrings( this ),
@@ -162,6 +166,9 @@ SbiParser::SbiParser( StarBASIC* pb, SbM
 
 	rTypeArray = new SbxArray; // Array fuer Benutzerdefinierte Typen
 	rEnumArray = new SbxArray; // Array for Enum types
+	bCompatible = bIsCompatible;
+	if ( bCompatible )
+		AddConstants();
 }
 
 
Index: basic/source/inc/parser.hxx
===================================================================
RCS file: /cvs/script/basic/source/inc/parser.hxx,v
retrieving revision 1.8
diff -u -p -r1.8 parser.hxx
--- basic/source/inc/parser.hxx	29 Sep 2005 16:31:38 -0000	1.8
+++ basic/source/inc/parser.hxx	3 Feb 2006 17:44:37 -0000
@@ -94,7 +94,7 @@ public:
 	IfaceVector   aIfaceVector;		// Holds all interfaces implemented by a class module
 	SbxDataType   eDefTypes[26];	// DEFxxx-Datentypen
 
-	SbiParser( StarBASIC*, SbModule* );
+	SbiParser( StarBASIC*, SbModule*, BOOL bIsCompatible = FALSE );
 	BOOL Parse();					// die Aktion
 	SbiExprNode* GetWithVar();		// Innerste With-Variable liefern
 

Index: basic/source/comp/sbcomp.cxx
===================================================================
RCS file: /cvs/script/basic/source/comp/sbcomp.cxx,v
retrieving revision 1.11
diff -u -p -r1.11 sbcomp.cxx
--- basic/source/comp/sbcomp.cxx	29 Sep 2005 16:17:05 -0000	1.11
+++ basic/source/comp/sbcomp.cxx	3 Feb 2006 17:52:04 -0000
@@ -126,7 +126,7 @@ BOOL SbModule::Compile()
 	SbModule* pOld = pCMOD;
 	pCMOD = this;
 
-	SbiParser* pParser = new SbiParser( (StarBASIC*) GetParent(), this );
+	SbiParser* pParser = new SbiParser( (StarBASIC*) GetParent(), this, bIsCompatible );
 	while( pParser->Parse() ) {}
 	if( !pParser->GetErrors() )
 		pParser->aGen.Save();
