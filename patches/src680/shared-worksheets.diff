diff -pur sc.orig/source/ui/docshell/docsh.cxx sc/source/ui/docshell/docsh.cxx
--- sc.orig/source/ui/docshell/docsh.cxx	2006-11-15 18:58:41.000000000 +0100
+++ sc/source/ui/docshell/docsh.cxx	2006-12-11 12:39:37.000000000 +0100
@@ -59,6 +59,7 @@
 #include <vcl/virdev.hxx>
 #include <vcl/waitobj.hxx>
 #include <svtools/ctrltool.hxx>
+#include <svtools/ehdl.hxx>
 #include <svtools/sfxecode.hxx>
 #include <svtools/zforlist.hxx>
 #include <sfx2/app.hxx>
@@ -102,6 +103,7 @@
 
 // INCLUDE ---------------------------------------------------------------
 
+#include "acredlin.hxx"
 #include "cell.hxx"
 #include "global.hxx"
 #include "filter.hxx"
@@ -131,6 +133,7 @@
 #include "printfun.hxx"
 #include "dociter.hxx"
 #include "cellform.hxx"
+#include "reffact.hxx"
 #include "chartlis.hxx"
 #include "hints.hxx"
 #include "xmlwrap.hxx"
@@ -141,6 +144,7 @@
 #include "compiler.hxx"
 #include "cfgids.hxx"
 #include "warnpassword.hxx"
+#include "chgviset.hxx"
 
 #include "docsh.hxx"
 
@@ -1253,27 +1449,77 @@ BOOL __EXPORT ScDocShell::ConvertFrom( S
 	return bRet;
 }
 
+void ScDocShell::LoadAndMergeSharedWorksheet( SfxMedium* pMedium )
+{
+    if ( /* FIXME !bSharedWorksheet ||*/ !pMedium )
+        return;
+
+    fprintf( stderr, "Shared worksheet...\n" );
+
+    // FIXME ExecuteChangeProtectionDialog()
+
+    bool bHasConflicts = false;
+    do {
+        SfxMedium *pMed = new SfxMedium( pMedium->GetName(), STREAM_STD_READ, FALSE, pMedium->GetFilter() /* TODO the other params as well? */ );
+        SfxErrorContext aEc( ERRCTX_SFX_OPENDOC, pMed->GetName() );
+
+        // load the most recent version of the doc
+        ScDocShell* pOtherDocSh = new ScDocShell;
+        SfxObjectShellRef aDocShTablesRef = pOtherDocSh;
+        pOtherDocSh->DoLoad( pMed );
+        ULONG nErr = pOtherDocSh->GetErrorCode();
+
+        // merge just if OK - we ignore errors
+        if ( pOtherDocSh->GetError() )
+            bHasConflicts = false;
+        else
+        {
+            MergeDocument( *pOtherDocSh->GetDocument() );
+            bHasConflicts = !bHasConflicts/* FIXME real value according to whether there were conflicts or not */;
+
+            if ( bHasConflicts )
+            {
+                // TODO Unlock
+                ScAcceptChgModalDlg aChangeDlg( GetDialogParent(), GetViewData() );
+                aChangeDlg.Execute();
+                // TODO Lock
+            }
+        }
+        pOtherDocSh->DoClose(); // delete happens with the Ref
+    } while ( bHasConflicts );
+}
+
+void ScDocShell::BeforeSaving()
+{
+    ScRefreshTimerProtector( aDocument.GetRefreshTimerControlAddress() );
+
+    //	DoEnterHandler hier nicht (wegen AutoSave), ist im ExecuteSave
+
+    ScChartListenerCollection* pCharts = aDocument.GetChartListenerCollection();
+    if (pCharts)
+        pCharts->UpdateDirtyCharts();					// Charts, die noch upgedated werden muessen
+    if (pAutoStyleList)
+        pAutoStyleList->ExecuteAllNow();				// Vorlagen-Timeouts jetzt ausfuehren
+    if (GetCreateMode()== SFX_CREATE_MODE_STANDARD)
+        SfxObjectShell::SetVisArea( Rectangle() );     // normal bearbeitet -> keine VisArea
+}
 
 BOOL __EXPORT ScDocShell::Save()
 {
 	RTL_LOGFILE_CONTEXT_AUTHOR ( aLog, "sc", "nn93723", "ScDocShell::Save" );
 
-	ScRefreshTimerProtector( aDocument.GetRefreshTimerControlAddress() );
+	BeforeSaving();
 
-	//	DoEnterHandler hier nicht (wegen AutoSave), ist im ExecuteSave
-
-	ScChartListenerCollection* pCharts = aDocument.GetChartListenerCollection();
-	if (pCharts)
-		pCharts->UpdateDirtyCharts();					// Charts, die noch upgedated werden muessen
-	if (pAutoStyleList)
-		pAutoStyleList->ExecuteAllNow();				// Vorlagen-Timeouts jetzt ausfuehren
-	if (GetCreateMode()== SFX_CREATE_MODE_STANDARD)
-        SfxObjectShell::SetVisArea( Rectangle() );     // normal bearbeitet -> keine VisArea
+	// TODO Lock
+	LoadAndMergeSharedWorksheet( GetMedium() );
 
 	//	wait cursor is handled with progress bar
     BOOL bRet = SfxObjectShell::Save();
 	if( bRet )
         bRet = SaveXML( GetMedium(), NULL );
+
+	// TODO Unlock
+
 	return bRet;
 }
 
@@ -1474,23 +1539,18 @@ BOOL __EXPORT ScDocShell::SaveAs( SfxMed
 {
 	RTL_LOGFILE_CONTEXT_AUTHOR ( aLog, "sc", "nn93723", "ScDocShell::SaveAs" );
 
-	ScRefreshTimerProtector( aDocument.GetRefreshTimerControlAddress() );
+	BeforeSaving();
 
-	//	DoEnterHandler hier nicht (wegen AutoSave), ist im ExecuteSave
-
-	ScChartListenerCollection* pCharts = aDocument.GetChartListenerCollection();
-	if (pCharts)
-		pCharts->UpdateDirtyCharts();					// Charts, die noch upgedated werden muessen
-	if (pAutoStyleList)
-		pAutoStyleList->ExecuteAllNow();				// Vorlagen-Timeouts jetzt ausfuehren
-	if (GetCreateMode()== SFX_CREATE_MODE_STANDARD)
-        SfxObjectShell::SetVisArea( Rectangle() );     // normal bearbeitet -> keine VisArea
+	// TODO Lock
+	LoadAndMergeSharedWorksheet( &rMedium );
 
 	//	wait cursor is handled with progress bar
     BOOL bRet = SfxObjectShell::SaveAs( rMedium );
 	if( bRet )
         bRet = SaveXML( &rMedium, NULL );
 
+	// TODO Unlock
+
 	return bRet;
 }
 
diff -pur sc.orig/source/ui/inc/docsh.hxx sc/source/ui/inc/docsh.hxx
--- sc.orig/source/ui/inc/docsh.hxx	2006-05-04 17:03:46.000000000 +0200
+++ sc/source/ui/inc/docsh.hxx	2006-11-24 15:29:13.000000000 +0100
@@ -150,6 +150,9 @@ class SC_DLLPUBLIC ScDocShell: public Sf
 	SC_DLLPRIVATE void			InitOptions();
 	SC_DLLPRIVATE void			ResetDrawObjectShell();
 
+	SC_DLLPRIVATE void			LoadAndMergeSharedWorksheet( SfxMedium* pMedium );
+	SC_DLLPRIVATE void			BeforeSaving();
+
 	SC_DLLPRIVATE BOOL			GetTabParam( const SfxItemSet* pArgs, USHORT nId, SCTAB& rTab );
     //BOOL            LoadCalc( SotStorage* pStor );
     //BOOL            SaveCalc( SotStorage* pStor );
