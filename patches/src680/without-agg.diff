--- config_office/configure.in.orig	2006-07-17 15:18:33.000000000 +0200
+++ config_office/configure.in	2006-07-17 15:25:09.000000000 +0200
@@ -363,6 +363,9 @@
 AC_ARG_WITH(system-neon,
 [  --with-system-neon      Use neon already on system
 ],,)
+AC_ARG_WITH(agg,
+[  --without-agg           Disable the use of agg altogether
+],,with_agg=yes)
 AC_ARG_WITH(system-agg,
 [  --with-system-agg       Use AGG already on system
 ],,)
@@ -3889,10 +3892,20 @@
 fi
 
 dnl ===================================================================
-dnl Check for system AGG
+dnl Test for disabling agg
 dnl ===================================================================
-AC_MSG_CHECKING([which AGG to use])
-if test -n "$with_system_agg" -o -n "$with_system_libs" && \
+AC_MSG_CHECKING([whether to enable agg])
+if test "$with_agg" = "no"; then
+  AC_MSG_RESULT([no])
+else
+  AC_MSG_RESULT([yes])
+  ENABLE_AGG=YES
+  AC_SUBST(ENABLE_AGG)
+  dnl ===================================================================
+  dnl Check for system AGG
+  dnl ===================================================================
+  AC_MSG_CHECKING([which AGG to use])
+  if test -n "$with_system_agg" -o -n "$with_system_libs" && \
    test "$with_system_agg" != "no"; then
          AC_MSG_RESULT([external])
          PKG_CHECK_MODULES(AGG, libagg >= 2.3)
@@ -3906,14 +3919,15 @@
 		 AGG_VERSION=2300
          fi
          SYSTEM_AGG=YES
-else
+  else
          AC_MSG_RESULT([internal])
          SYSTEM_AGG=NO
          AGG_VERSION=2300
          BUILD_TYPE="$BUILD_TYPE AGG"
-fi
+  fi
 AC_SUBST(SYSTEM_AGG)
 AC_SUBST(AGG_VERSION)
+fi
 
 dnl ===================================================================
 dnl Check for system xmlsec1
--- config_office/set_soenv.in.orig	2006-07-17 15:27:18.000000000 +0200
+++ config_office/set_soenv.in	2006-07-17 15:28:02.000000000 +0200
@@ -1800,6 +1800,7 @@
 ToFile( "NEON_LIBS",         "@NEON_LIBS@",        "e" );
 ToFile( "NEON_CFLAGS",       "@NEON_CFLAGS@",      "e" );
 ToFile( "DISABLE_NEON",      "@DISABLE_NEON@",     "e" );
+ToFile( "ENABLE_AGG",        "@ENABLE_AGG@",       "e" );
 ToFile( "SYSTEM_AGG",	     "@SYSTEM_AGG@",       "e" );
 ToFile( "AGG_VERSION",	     "@AGG_VERSION@",      "e" );
 ToFile( "BUILD_DMAKE",       "@BUILD_DMAKE@",      "e" );
--- canvas/source/tools/makefile.mk	2006-07-14 13:30:28.000000000 +0200
+++ canvas/source/tools/makefile.mk	2006-07-17 15:40:21.000000000 +0200
@@ -59,12 +59,10 @@
 
 
 SLOFILES =	\
-	$(SLO)$/bitmap.obj \
 	$(SLO)$/cachedprimitivebase.obj \
 	$(SLO)$/canvascustomspritehelper.obj \
 	$(SLO)$/canvastools.obj \
 	$(SLO)$/elapsedtime.obj \
-	$(SLO)$/image.obj \
 	$(SLO)$/linepolypolygonbase.obj \
 	$(SLO)$/parametricpolypolygon.obj \
 	$(SLO)$/prioritybooster.obj \
@@ -79,7 +77,14 @@
 
 SHL1TARGET= 	$(TARGET)$(UPD)$(DLLPOSTFIX)
 SHL1IMPLIB= 	i$(TARGET)
-SHL1STDLIBS=	$(SALLIB) $(CPPULIB) $(BASEGFXLIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(VCLLIB) $(AGGLIB) $(TOOLSLIB)
+SHL1STDLIBS=	$(SALLIB) $(CPPULIB) $(BASEGFXLIB) $(CPPUHELPERLIB) $(COMPHELPERLIB) $(VCLLIB) $(TOOLSLIB)
+
+.IF "$(ENABLE_AGG)"=="YES"
+SLOFILES+=	\
+	$(SLO)$/bitmap.obj \
+	$(SLO)$/image.obj
+SHL1STDLIBS+=	$(AGGLIB)
+.ENDIF
 
 SHL1LIBS=		$(SLB)$/$(TARGET).lib
 
--- scp2/source/canvas/makefile.mk.orig	2006-07-20 11:53:02.000000000 +0200
+++ scp2/source/canvas/makefile.mk	2006-07-20 11:55:58.000000000 +0200
@@ -47,9 +47,12 @@
 
 SCP_PRODUCT_TYPE=osl
 
+.IF "$(ENABLE_AGG)" == "YES"
+SCPDEFS+=-DENABLE_AGG
 .IF "$(SYSTEM_AGG)" == "YES"
 SCPDEFS+=-DSYSTEM_AGG
 .ENDIF
+.ENDIF
 
 PARFILES= canvascommons.par		\
           directxcanvas.par     \
--- scp2/source/canvas/canvascommons.scp.orig	2006-07-20 11:54:34.000000000 +0200
+++ scp2/source/canvas/canvascommons.scp	2006-07-20 11:55:22.000000000 +0200
@@ -37,7 +37,9 @@
 
 STD_LIB_FILE_PATCH(gid_File_Lib_CppCanvas, cppcanvas)
 STD_LIB_FILE_PATCH(gid_File_Lib_CanvasTools, canvastools)
+#ifdef ENABLE_AGG
 #ifndef SYSTEM_AGG
 STD_LIB_FILE_PATCH(gid_File_Lib_Agg, agg)
 #endif
+#endif
 SPECIAL_UNO_COMPONENT_LIB_FILE_PATCH(gid_File_CanvasFactory, canvasfactory.uno)
