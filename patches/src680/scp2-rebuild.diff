Index: scp2/macros/images.pl
===================================================================
RCS file: /cvs/installation/scp2/macros/images.pl,v
retrieving revision 1.2
diff -u -p -u -r1.2 images.pl
--- scp2/macros/images.pl	18 Jan 2005 14:36:28 -0000	1.2
+++ scp2/macros/images.pl	11 Feb 2005 15:59:56 -0000
@@ -1,10 +1,72 @@
-my $outfile = "";
+#*************************************************************************
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to the terms of
+#   either of the following licenses
+#
+#          - GNU Lesser General Public License Version 2.1
+#          - Sun Industry Standards Source License Version 1.1
+#
+#   Sun Microsystems Inc., October, 2000
+#
+#   GNU Lesser General Public License Version 2.1
+#   =============================================
+#   Copyright 2000 by Sun Microsystems, Inc.
+#   901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#   This library is free software; you can redistribute it and/or
+#   modify it under the terms of the GNU Lesser General Public
+#   License version 2.1, as published by the Free Software Foundation.
+#
+#   This library is distributed in the hope that it will be useful,
+#   but WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#   Lesser General Public License for more details.
+#
+#   You should have received a copy of the GNU Lesser General Public
+#   License along with this library; if not, write to the Free Software
+#   Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#   MA  02111-1307  USA
+#
+#
+#   Sun Industry Standards Source License Version 1.1
+#   =================================================
+#   The contents of this file are subject to the Sun Industry Standards
+#   Source License Version 1.1 (the "License"); You may not use this file
+#   except in compliance with the License. You may obtain a copy of the
+#   License at http://www.openoffice.org/license.html.
+#
+#   Software provided under this License is provided on an "AS IS" basis,
+#   WITHOUT WARRUNTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING,
+#   WITHOUT LIMITATION, WARRUNTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+#   MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+#   See the License for the specific provisions governing your rights and
+#   obligations concerning the Software.
+#
+#   The Initial Developer of the Original Code is: Novell, Inc..
+#
+#   Copyright: 2000 by Sun Microsystems, Inc.
+#
+#   All Rights Reserved.
+#
+#   Contributor(s): _______________________________________
+#
+#
+#
+#*************************************************************************
+my $replacefile = "";
 
 while (my $a = shift @ARGV) {
     if ($a eq '-o') {
-	$outfile = shift @ARGV || die "-o requires filename";
-    }
+	$replacefile = shift @ARGV || die "-o requires filename";
+    } 
 }
+my $outfile = "$replacefile.test";
 
 open OUTFILE, ">$outfile" || die "$0 ERROR: cannot open $outfile for writing!\n";
 
@@ -36,3 +98,27 @@ EOFRAG
 }
 
 close OUTFILE;
+
+my $do_replace = 1;
+
+# Now compare our output with what came before
+if (-f $replacefile)
+{
+    my ($A, $B);
+    open $A, "$outfile" || die "Can't open $outfile: $!";
+    open $B, "$replacefile" || die "Can't open $replacefile: $!";
+    my @alines = <$A>;
+    my @blines = <$B>;
+    if (join (' ', @alines) eq join (' ', @blines)) {
+	print "Image list unchanged\n";
+	unlink $outfile;
+	exit (0);
+    }
+    close $A;
+    close $B;
+}
+
+unlink $replacefile;
+rename $outfile, $replacefile;
+
+exit (0);
Index: scp2/macros/makefile.mk
===================================================================
RCS file: /cvs/installation/scp2/macros/makefile.mk,v
retrieving revision 1.3
diff -u -p -u -r1.3 makefile.mk
--- scp2/macros/makefile.mk	20 Jan 2005 12:44:21 -0000	1.3
+++ scp2/macros/makefile.mk	11 Feb 2005 15:59:56 -0000
@@ -87,5 +87,6 @@ ALLTAR : $(INCCOM)$/langmacros.inc $(INC
 	+$(PERL) macro.pl -o $@.tmp && $(RENAME) $@.tmp $@
 
 .PHONY $(INCCOM)$/images.inc:
-	+$(PERL) images.pl -o $@.tmp && $(RENAME) $@.tmp $@
+	+-$(RENAME) $@ $@.tmp >& $(NULLDEV)
+	+$(PERL) -w images.pl -o $@.tmp && $(RENAME) $@.tmp $@
 
