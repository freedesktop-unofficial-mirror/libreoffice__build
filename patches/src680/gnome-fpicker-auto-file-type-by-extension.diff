--- fpicker/source/unx/gnome/SalGtkFilePicker.cxx	2005-08-25 20:40:15.000000000 +0530
+++ fpicker/source/unx/gnome/SalGtkFilePicker.cxx	2005-08-27 21:43:54.000000000 +0530
@@ -931,6 +931,8 @@ uno::Sequence<rtl::OUString> SAL_CALL Sa
 		if( GTK_FILE_CHOOSER_ACTION_SAVE == eAction )
 		{
             OUString sFilterName;
+            sal_Int32 nTokenIndex = 0;
+            bool bExtensionTypedIn = false;
 
             GtkTreeSelection* selection = gtk_tree_view_get_selection(GTK_TREE_VIEW(m_pFilterView));
             GtkTreeIter iter;
@@ -944,6 +946,33 @@ uno::Sequence<rtl::OUString> SAL_CALL Sa
             }
             else
             {
+                if( aSelectedFiles[nToIndex].indexOf('.') > 0 )
+                {
+                    rtl::OUString sExtension;
+                    nTokenIndex = 0;
+                    do
+                        sExtension = aSelectedFiles[nToIndex].getToken( 0, '.', nTokenIndex );
+                    while( nTokenIndex >= 0 );
+
+                    if( sExtension.getLength() >= 3 ) // 3 = typical/minimum extension length
+                    {
+                        static const OUString aStarDot = OUString::createFromAscii( "*." );
+
+                        for ( FilterList::iterator aListIter = m_pFilterList->begin();
+                              aListIter != m_pFilterList->end();
+                              ++aListIter
+                        )
+                        {
+                            if( aListIter->getFilter().indexOf( aStarDot+sExtension ) >= 0 )
+                            {
+                                setCurrentFilter( aListIter->getTitle() );
+                                bExtensionTypedIn = true;
+                                break;
+                            }
+                        }
+                    }
+                }
+
 			    const gchar* filtername = 
 				    gtk_file_filter_get_name( gtk_file_chooser_get_filter( GTK_FILE_CHOOSER( m_pDialog ) ) );
                 sFilterName = OUString( filtername, strlen( filtername ), RTL_TEXTENCODING_UTF8 );
@@ -960,7 +989,7 @@ uno::Sequence<rtl::OUString> SAL_CALL Sa
 			OSL_TRACE( "turned into %s\n", 
 				OUStringToOString( aFilter, RTL_TEXTENCODING_UTF8 ).getStr() );
 
-			sal_Int32 nTokenIndex = 0;
+			nTokenIndex = 0;
 			rtl::OUString sToken;
 			//   rtl::OUString strExt;
 			do
@@ -981,6 +1010,7 @@ uno::Sequence<rtl::OUString> SAL_CALL Sa
 			// if AutoExtension is enabled and checked and current filter is not *, 
 			// then complete the file name by concatinating the filter
 			if( mbToggleVisibility[AUTOEXTENSION] 
+			     && ( !bExtensionTypedIn )
 			     && ( gtk_toggle_button_get_active( GTK_TOGGLE_BUTTON( m_pToggles[AUTOEXTENSION] ) ) ) 
 			     && ( !sToken.equalsAscii( "*" ) ) )
 			{
