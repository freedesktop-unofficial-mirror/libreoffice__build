--- config_office/configure.in.ark	2005-01-28 03:20:07.000000000 +0100
+++ config_office/configure.in	2005-01-28 03:31:37.000000000 +0100
@@ -2614,10 +2614,13 @@
 KDE_LIBS=""
 if test "$test_kde" = "yes" -a "$ENABLE_KDE" = "TRUE" ; then
     dnl Search paths for Qt and KDE
-    qt_incdirs="$QTINC /usr/local/qt/include /usr/include/qt /usr/include /usr/X11R6/include/X11/qt /usr/X11R6/include/qt /usr/lib64/qt3/include /usr/lib64/qt/include /usr/lib/qt3/include /usr/lib/qt/include /usr/share/qt3/include $x_includes"
     if test -n "$QTDIR" ; then
-        qt_incdirs="$QTDIR/include $qt_incdirs"
+        qt_incdirs="$QTDIR/include"
+        qt_libdirs="$QTDIR/lib"
     fi
+    qt_incdirs="$qt_incdirs $QTINC /usr/local/qt/include /usr/include/qt /usr/include /usr/X11R6/include/X11/qt /usr/X11R6/include/qt /usr/lib64/qt3/include /usr/lib64/qt/include /usr/lib/qt3/include /usr/lib/qt/include /usr/share/qt3/include $x_includes"
+    qt_libdirs="$qt_libdirs $QTLIB /usr/local/qt/lib /usr/lib/qt /usr/lib/qt3/lib /usr/X11R6/lib /usr/lib64/qt/lib /usr/lib64/qt3/lib"
+
     kde_incdirs="/usr/lib64/kde/include /usr/lib/kde/include /usr/local/kde/include /usr/local/include /usr/kde/include /usr/include/kde /usr/include /opt/kde3/include /opt/kde/include $x_includes"
     kde_libdirs="/usr/lib64/kde/lib64 /usr/local/kde/lib64 /usr/kde/lib64 /usr/lib64/kde /usr/lib64/kde3 /usr/lib64 /usr/X11R6/lib64 /usr/local/lib64 /opt/kde3/lib64 /opt/kde/lib64 /usr/X11R6/kde/lib64 /usr/lib/kde/lib /usr/local/kde/lib /usr/kde/lib /usr/lib/kde /usr/lib/kde3 /usr/lib /usr/X11R6/lib /usr/local/lib /opt/kde3/lib /opt/kde/lib /usr/X11R6/kde/lib"
     if test -n "$KDEDIR" ; then
@@ -2640,6 +2643,15 @@
         fi
     done
     AC_MSG_RESULT([$qt_incdir])
+    AC_MSG_CHECKING([for Qt libraries])
+    qt_libdir="no"
+    for kde_check in $qt_libdirs ; do
+        if test -r "$kde_check/$qt_test_library" ; then
+            qt_libdir="$kde_check"
+            break
+        fi
+    done
+    AC_MSG_RESULT([$qt_libdir])
     if test "x$qt_incdir" == "xno" ; then
         AC_MSG_ERROR([Qt headers not found.  Please specify the root of
 your Qt installation by exporting QTDIR before running "configure".])
@@ -2677,7 +2689,13 @@
 
     dnl Set the variables
     KDE_CFLAGS="-I$qt_incdir -I$kde_incdir -DQT_CLEAN_NAMESPACE -DQT_NO_EMIT -DQT_THREAD_SUPPORT"
-    KDE_LIBS="-L$kde_libdir -lkdeui"
+    if test z$kde_libdir != "z/usr/lib"; then
+        KDE_LIBS="-L$kde_libdir"
+    fi
+    KDE_LIBS="$KDE_LIBS -lkdecore -lkdeui -lqt-mt"
+    if test z$qt_libdir != "zno"; then
+        KDE_LIBS="-L$qt_libdir $KDE_LIBS"
+    fi
 fi
 AC_SUBST(KDE_CFLAGS)
 AC_SUBST(KDE_LIBS)
