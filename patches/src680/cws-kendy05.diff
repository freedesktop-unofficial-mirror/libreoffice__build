Index: solenv/bin/linkoo
===================================================================
RCS file: /cvs/tools/solenv/bin/linkoo,v
retrieving revision 1.5
retrieving revision 1.5.80.3
diff -u -p -r1.5 -r1.5.80.3
--- solenv/bin/linkoo	11 Feb 2005 15:23:57 -0000	1.5
+++ solenv/bin/linkoo	8 Apr 2005 13:34:34 -0000	1.5.80.3
@@ -67,13 +67,13 @@
 #
 #*************************************************************************
 
-# ends up in program/env
+# ends up in program/ooenv
+( $moz_lib = `pkg-config --variable=libdir mozilla-nss` ) =~ tr/\n/:/;
 $env_script = '
 java_path=`./javaldx`
-export LD_LIBRARY_PATH=".:$java_path:$LD_LIBRARY_PATH"
+export LD_LIBRARY_PATH=".:$java_path:' . $moz_lib . '$LD_LIBRARY_PATH"
 ulimit -c unlimited
 export PATH=".:$PATH"
-export LD_LIBRARY_PATH=".:$LD_LIBRARY_PATH"
 export GNOME_DISABLE_CRASH_DIALOG=1
 export STAR_RESOURCEPATH=`pwd`/resource
 ';
@@ -238,13 +238,24 @@ sub scan_and_link_files($$$)
     print "\n";
 }
 
-sub fixup_evilness
+sub evilness($)
 {
+    my $doit = shift;
     my $name = 'librecentfile.so';
-    my $src = "$OOO_BUILD/shell/$TARGET/lib/$name";
-    if (-f $src) {
-	print " link $name\n";
-	symlink $src, "$OOO_BUILD/sfx2/$TARGET/lib/$name";
+    my $src  = "$OOO_BUILD/shell/$TARGET/lib/$name";
+    my $dest = "$OOO_BUILD/sfx2/$TARGET/lib/$name";
+
+    if ($doit eq 'undo') {
+	if (-l $dest) {
+	    print " unlink $name\n";
+	    unlink $dest;
+	}
+    } else {
+	$doit eq 'do' || die;
+        if (-f $src) {
+	    print " link $name\n";
+	    symlink $src, $dest;
+	}
     }
 }
 
@@ -290,6 +301,8 @@ substr ($OOO_BUILD, 0, 1)   eq '/' || di
 
 ($TARGET, $LIBVER, $LANG, $DLLSUFFIX) = sniff_target ($OOO_BUILD);
 
+evilness ('undo');
+
 my $installed_files = build_installed_list ($OOO_INSTALL);
 
 scan_and_link_files ($OOO_BUILD, $installed_files, $TARGET);
@@ -304,11 +317,11 @@ if (-l $ooo_res && -l $star_res) {
 }
 print "\n";
 
-if (!-f "$OOO_INSTALL/program/env") {
-    print "Creating '$OOO_INSTALL/program/env'\n";
-    open ($env, ">$OOO_INSTALL/program/env") || die "Can't open $OOO_INSTALL/program/env: $!";
-    print $env $env_script;
-    close ($env);
+if (!-f "$OOO_INSTALL/program/ooenv") {
+    print "Creating '$OOO_INSTALL/program/ooenv'\n";
+    open ($ooenv, ">$OOO_INSTALL/program/ooenv") || die "Can't open $OOO_INSTALL/program/ooenv: $!";
+    print $ooenv $env_script;
+    close ($ooenv);
 }
 
-fixup_evilness();
+evilness ('do');
