Index: sysui/desktop/productversion.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/productversion.mk,v
retrieving revision 1.22
retrieving revision 1.22.6.2
diff -u -p -u -p -r1.22 -r1.22.6.2
--- sysui/desktop/productversion.mk	10 May 2007 15:18:33 -0000	1.22
+++ sysui/desktop/productversion.mk	19 Jun 2007 10:14:55 -0000	1.22.6.2
@@ -32,13 +32,6 @@
 #     MA  02111-1307  USA
 #
 #*************************************************************************
-# NOTE: remove $(UPD) for final releases
-PRODUCTNAME     = OpenOffice.org
-PRODUCTVERSION  = 2.3
-LONGPRODUCTNAME = OpenOffice.org 2.3
-UNIXFILENAME    = openoffice.org2.3
-PKGVERSION      = 2.3
-
 .IF "$(OS)"=="LINUX"
 PKGREV          = $(BUILD)
 .ELSE
@@ -61,7 +54,7 @@ PKGDIR=$(BIN)
 PRODUCTLIST = openoffice.org broffice.org
 
 # default values to minimize maintainance effort 
-PRODUCTVERSION = 2.2
+PRODUCTVERSION = 2.3
 PKGVERSION = $(PRODUCTVERSION)
 # gnome-vfs treats everything behind the last '.' as an icon extension, 
 # even though the "icon_filename" in '.keys' is specified as filename 
@@ -69,6 +62,10 @@ PKGVERSION = $(PRODUCTVERSION)
 # type icons :-), we are stripping all '.' for now.
 # ToDo: maybe we use a product major later ??
 ICONVERSION = $(PRODUCTVERSION:s/.//g)
+# UNIXFILENAME variable is used to generate the common desktop files below share/xdg;
+# another wrapper name can be forced by --with-unix-wrapper configure option;
+# it is need by other distributors, see http://www.openoffice.org/issues/show_bug.cgi?id=75366
+UNIXFILENAME *= '$${{UNIXPRODUCTNAME}}$${{PRODUCTVERSION}}'
 
 PRODUCTNAME.openoffice.org = OpenOffice.org
 PRODUCTVERSION.openoffice.org = $(PRODUCTVERSION)
Index: sysui/desktop/freedesktop/freedesktop-menus.spec
===================================================================
RCS file: /cvs/gsl/sysui/desktop/freedesktop/freedesktop-menus.spec,v
retrieving revision 1.16
retrieving revision 1.16.6.1
diff -u -p -u -p -r1.16 -r1.16.6.1
--- sysui/desktop/freedesktop/freedesktop-menus.spec	10 May 2007 14:59:10 -0000	1.16
+++ sysui/desktop/freedesktop/freedesktop-menus.spec	18 Jun 2007 16:04:33 -0000	1.16.6.1
@@ -40,7 +40,7 @@ export KDEMAINDIR=/usr
 export GNOMEDIR=/usr
 export GNOME_MIME_THEME=hicolor
 
-create_tree.sh
+./create_tree.sh
 
 cd $RPM_BUILD_ROOT
 
Index: sysui/desktop/mandriva/mandriva-menus.spec
===================================================================
RCS file: /cvs/gsl/sysui/desktop/mandriva/mandriva-menus.spec,v
retrieving revision 1.16
retrieving revision 1.16.6.1
diff -u -p -u -p -r1.16 -r1.16.6.1
--- sysui/desktop/mandriva/mandriva-menus.spec	10 May 2007 14:59:50 -0000	1.16
+++ sysui/desktop/mandriva/mandriva-menus.spec	18 Jun 2007 16:04:33 -0000	1.16.6.1
@@ -208,7 +208,7 @@ export DESTDIR=$RPM_BUILD_ROOT
 export KDEMAINDIR=/usr
 export GNOMEDIR=/usr
 
-create_tree.sh
+./create_tree.sh
 
 #
 # Mandriva menus fun
Index: sysui/desktop/menus/base.desktop
===================================================================
RCS file: /cvs/gsl/sysui/desktop/menus/base.desktop,v
retrieving revision 1.6
retrieving revision 1.6.208.1
diff -u -p -u -p -r1.6 -r1.6.208.1
--- sysui/desktop/menus/base.desktop	13 May 2005 09:27:14 -0000	1.6
+++ sysui/desktop/menus/base.desktop	15 Jun 2007 20:07:57 -0000	1.6.208.1
@@ -5,7 +5,7 @@ Terminal=false
 Icon=base
 Type=Application
 InitialPreference=2
-Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;
+Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-MoreApplications-Databases;
 Exec=openoffice -base %U
 MimeType=application/vnd.oasis.opendocument.database;application/vnd.sun.xml.base
 Name=%PRODUCTNAME Base
Index: sysui/desktop/menus/calc.desktop
===================================================================
RCS file: /cvs/gsl/sysui/desktop/menus/calc.desktop,v
retrieving revision 1.7
retrieving revision 1.7.226.1
diff -u -p -u -p -r1.7 -r1.7.226.1
--- sysui/desktop/menus/calc.desktop	24 Feb 2005 16:13:30 -0000	1.7
+++ sysui/desktop/menus/calc.desktop	15 Jun 2007 20:07:57 -0000	1.7.226.1
@@ -5,7 +5,7 @@ Terminal=false
 Icon=calc
 Type=Application
 InitialPreference=2
-Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;
+Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Spreadsheets;
 Exec=openoffice -calc %U
 MimeType=application/vnd.oasis.opendocument.spreadsheet;application/vnd.oasis.opendocument.spreadsheet-template;application/vnd.sun.xml.calc;application/vnd.sun.xml.calc.template;application/vnd.stardivision.calc;application/vnd.stardivision.chart;application/msexcel;application/vnd.ms-excel
 Name=%PRODUCTNAME Calc
Index: sysui/desktop/menus/draw.desktop
===================================================================
RCS file: /cvs/gsl/sysui/desktop/menus/draw.desktop,v
retrieving revision 1.7
retrieving revision 1.7.226.1
diff -u -p -u -p -r1.7 -r1.7.226.1
--- sysui/desktop/menus/draw.desktop	24 Feb 2005 16:13:42 -0000	1.7
+++ sysui/desktop/menus/draw.desktop	15 Jun 2007 20:07:57 -0000	1.7.226.1
@@ -5,7 +5,7 @@ Terminal=false
 Icon=draw
 Type=Application
 InitialPreference=2
-Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;
+Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Drawing;
 Exec=openoffice -draw %U
 MimeType=application/vnd.oasis.opendocument.graphics;application/vnd.oasis.opendocument.graphics-template;application/vnd.sun.xml.draw;application/vnd.sun.xml.draw.template;application/vnd.stardivision.draw
 Name=%PRODUCTNAME Draw
Index: sysui/desktop/menus/impress.desktop
===================================================================
RCS file: /cvs/gsl/sysui/desktop/menus/impress.desktop,v
retrieving revision 1.8
retrieving revision 1.8.214.1
diff -u -p -u -p -r1.8 -r1.8.214.1
--- sysui/desktop/menus/impress.desktop	20 Apr 2005 11:35:17 -0000	1.8
+++ sysui/desktop/menus/impress.desktop	15 Jun 2007 20:07:57 -0000	1.8.214.1
@@ -5,7 +5,7 @@ Terminal=false
 Icon=impress
 Type=Application
 InitialPreference=2
-Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;
+Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Presentations;
 Exec=openoffice -impress %U
 MimeType=application/vnd.oasis.opendocument.presentation;application/vnd.oasis.opendocument.presentation-template;application/vnd.sun.xml.impress;application/vnd.sun.xml.impress.template;application/vnd.stardivision.impress;application/mspowerpoint;application/vnd.ms-powerpoint
 Name=%PRODUCTNAME Impress
Index: sysui/desktop/menus/math.desktop
===================================================================
RCS file: /cvs/gsl/sysui/desktop/menus/math.desktop,v
retrieving revision 1.7
retrieving revision 1.7.226.1
diff -u -p -u -p -r1.7 -r1.7.226.1
--- sysui/desktop/menus/math.desktop	24 Feb 2005 16:14:06 -0000	1.7
+++ sysui/desktop/menus/math.desktop	15 Jun 2007 20:07:57 -0000	1.7.226.1
@@ -5,7 +5,7 @@ Terminal=false
 Icon=math
 Type=Application
 InitialPreference=2
-Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;
+Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Other;
 Exec=openoffice -math %U
 MimeType=application/vnd.oasis.opendocument.formula;application/vnd.sun.xml.math;application/vnd.stardivision.math
 Name=%PRODUCTNAME Math
Index: sysui/desktop/menus/writer.desktop
===================================================================
RCS file: /cvs/gsl/sysui/desktop/menus/writer.desktop,v
retrieving revision 1.10
retrieving revision 1.10.96.1
diff -u -p -u -p -r1.10 -r1.10.96.1
--- sysui/desktop/menus/writer.desktop	19 Apr 2006 15:28:26 -0000	1.10
+++ sysui/desktop/menus/writer.desktop	15 Jun 2007 20:07:57 -0000	1.10.96.1
@@ -5,7 +5,7 @@ Terminal=false
 Icon=writer
 Type=Application
 InitialPreference=2
-Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;
+Categories=Application;Office;X-Red-Hat-Base;X-SuSE-Core-Office;X-MandrivaLinux-Office-Wordprocessors;
 Exec=openoffice -writer %U
 MimeType=application/vnd.oasis.opendocument.text;application/vnd.oasis.opendocument.text-template;application/vnd.oasis.opendocument.text-web;application/vnd.oasis.opendocument.text-master;application/vnd.sun.xml.writer;application/vnd.sun.xml.writer.template;application/vnd.sun.xml.writer.global;application/vnd.stardivision.writer;application/msword;application/vnd.ms-word;application/x-doc;application/rtf;application/vnd.wordperfect;application/wordperfect
 Name=%PRODUCTNAME Writer
Index: sysui/desktop/redhat/redhat-menus.spec
===================================================================
RCS file: /cvs/gsl/sysui/desktop/redhat/redhat-menus.spec,v
retrieving revision 1.26
retrieving revision 1.26.6.1
diff -u -p -u -p -r1.26 -r1.26.6.1
--- sysui/desktop/redhat/redhat-menus.spec	10 May 2007 15:00:13 -0000	1.26
+++ sysui/desktop/redhat/redhat-menus.spec	18 Jun 2007 16:04:33 -0000	1.26.6.1
@@ -31,7 +31,7 @@ export KDEMAINDIR=/usr
 export GNOMEDIR=/usr
 export GNOME_MIME_THEME=hicolor
 
-create_tree.sh
+./create_tree.sh
 
 # legacy redhat KDE location for .desktop files
 mkdir -p $RPM_BUILD_ROOT/usr/share/applnk-redhat/Office
Index: sysui/desktop/share/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/share/makefile.mk,v
retrieving revision 1.18
retrieving revision 1.18.6.1
diff -u -p -u -p -r1.18 -r1.18.6.1
--- sysui/desktop/share/makefile.mk	10 May 2007 15:34:33 -0000	1.18
+++ sysui/desktop/share/makefile.mk	18 Jun 2007 16:02:21 -0000	1.18.6.1
@@ -144,7 +144,7 @@ $(LAUNCHERFLAGFILE) : $(LAUNCHERDEPN) 
 	@$(MKDIRHIER) $(@:db).$(INPATH)
 	@echo Creating desktop entries for $(@:f) ..
 	@echo ---------------------------------
-	@$(PERL) brand.pl -p '$${{PRODUCTNAME}} $${{PRODUCTVERSION}}' -u '$${{UNIXPRODUCTNAME}}$${{PRODUCTVERSION}}' --iconprefix '$${{WITHOUTDOTUNIXPRODUCTNAME}}${ICONVERSION}-' $< $(@:db).$(INPATH)
+	@$(PERL) brand.pl -p '$${{PRODUCTNAME}} $${{PRODUCTVERSION}}' -u $(UNIXFILENAME) --iconprefix '$${{WITHOUTDOTUNIXPRODUCTNAME}}${ICONVERSION}-' $< $(@:db).$(INPATH)
 	@$(PERL) translate.pl -p '$${{PRODUCTNAME}} $${{PRODUCTVERSION}}' -d $(@:db).$(INPATH) --ext "desktop" --key "Name" $(ULFDIR)$/launcher_name.ulf
 	@$(PERL) translate.pl -p '$${{PRODUCTNAME}} $${{PRODUCTVERSION}}' -d $(@:db).$(INPATH) --ext "desktop" --key "Comment" $(ULFDIR)$/launcher_comment.ulf
 .IF "$(WITH_LIBSN)"=="YES"
Index: sysui/desktop/suse/suse-menus.spec
===================================================================
RCS file: /cvs/gsl/sysui/desktop/suse/suse-menus.spec,v
retrieving revision 1.27
retrieving revision 1.27.6.1
diff -u -p -u -p -r1.27 -r1.27.6.1
--- sysui/desktop/suse/suse-menus.spec	10 May 2007 15:02:09 -0000	1.27
+++ sysui/desktop/suse/suse-menus.spec	18 Jun 2007 16:04:34 -0000	1.27.6.1
@@ -36,7 +36,7 @@ export KDEMAINDIR=/opt/kde3
 export GNOMEDIR=/opt/gnome
 export GNOME_MIME_THEME=hicolor
 
-create_tree.sh
+./create_tree.sh
 
 %clean
 rm -rf $RPM_BUILD_ROOT/*
Index: config_office/configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.208
retrieving revision 1.208.2.1
diff -u -p -u -p -r1.208 -r1.208.2.1
--- config_office/configure.in	11 Jun 2007 14:21:25 -0000	1.208
+++ config_office/configure.in	18 Jun 2007 16:02:21 -0000	1.208.2.1
@@ -584,6 +584,12 @@ AC_ARG_WITH(vendor,
 
                           Usage: --with-vendor="John the Builder"
 ],,)
+AC_ARG_WITH(unix-wrapper,
+[  --with-unix-wrapper    Redefines the name of the UNIX wrapper that will be used
+                          in the desktop files and in the desktop-integration RPMs.
+
+                          Usage: --with-unix-wrapper=ooffice
+],,)
 AC_ARG_WITH(asm-home,
 [  --with-asm-home         For Windows users, please supply the path for the
                           ml.exe assembler.
@@ -5264,6 +5270,16 @@ else
 fi
 AC_SUBST(OOO_VENDOR)
 
+UNIXFILENAME=
+AC_MSG_CHECKING([for UNIX wrapper name])
+if test -z "$with_unix_wrapper" -o "$with_unix_wrapper" = "no"  -o "$with_unix_wrapper" = "yes" ; then
+   AC_MSG_RESULT([not set])
+else
+   UNIXFILENAME="$with_unix_wrapper"
+   AC_MSG_RESULT([$UNIXFILENAME])
+fi
+AC_SUBST(UNIXFILENAME)
+
 AC_MSG_CHECKING([whether to statically link to Gtk])
 if test -n "$enable_static_gtk" && test "$enable_static_gtk" != "no"; then
    ENABLE_STATIC_GTK="TRUE"
Index: config_office/set_soenv.in
===================================================================
RCS file: /cvs/tools/config_office/set_soenv.in,v
retrieving revision 1.148
retrieving revision 1.148.2.1
diff -u -p -u -p -r1.148 -r1.148.2.1
--- config_office/set_soenv.in	11 Jun 2007 14:21:39 -0000	1.148
+++ config_office/set_soenv.in	18 Jun 2007 16:02:21 -0000	1.148.2.1
@@ -1540,6 +1540,7 @@ ToFile( "EXTERNAL_WARNINGS_NOT_ERRORS", 
 ToFile( "PRODUCT",           "@PRODUCT@",        "e" );
 ToFile( "PROFULLSWITCH",     "@PROFULLSWITCH@",  "e" );
 ToFile( "PROEXT",            $PROEXT,            "e" );
+ToFile( "UNIXFILENAME",   "@UNIXFILENAME@",   "e" );
 ToFile( "BUILD_MOZAB",       "@BUILD_MOZAB@",    "e" );
 ToFile( "PREBUILD_MOZAB",    $PREBUILD_MOZAB,    "e" );
 ToFile( "MOZILLA_VERSION",   $MOZILLA_VERSION,   "e" );
