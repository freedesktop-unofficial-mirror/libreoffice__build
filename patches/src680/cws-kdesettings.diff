Index: helpcontent2/source/text/shared/optionen/01020100.xhp
===================================================================
RCS file: /cvs/documentation/helpcontent2/source/text/shared/optionen/01020100.xhp,v
retrieving revision 1.4
retrieving revision 1.4.94.1
diff -u -p -u -p -r1.4 -r1.4.94.1
--- helpcontent2/source/text/shared/optionen/01020100.xhp	7 Sep 2005 23:32:44 -0000	1.4
+++ helpcontent2/source/text/shared/optionen/01020100.xhp	11 Apr 2006 12:34:29 -0000	1.4.94.1
@@ -67,7 +67,7 @@ YJ: checked</lastedited>
 <paragraph role="paragraph" id="par_id3156155" xml-lang="en-US" l10n="U" oldref="15">Lets you enter the proxy server manually. Specify the proxy servers in accordance with your Internet service. Ask your system administrator for the proxies and ports to enter.</paragraph>
 <paragraph role="tip" id="par_id3148943" xml-lang="en-US" l10n="U" oldref="29">Type server names without the protocol prefix. For example, type www.sun.com, not http://www.sun.com.</paragraph>
 <paragraph role="heading" id="par_idN10684" xml-lang="en-US" level="4" l10n="NEW">System</paragraph>
-<paragraph role="paragraph" id="par_idN10688" xml-lang="en-US" l10n="NEW">On Windows or UNIX systems using Gnome, this option tells %PRODUCTNAME to use the system settings. You must restart %PRODUCTNAME to initiate this setting.<comment>UFI: see spec "System-Settings"</comment></paragraph>
+<paragraph role="paragraph" id="par_idN10688" xml-lang="en-US" l10n="NEW">On Windows or UNIX systems using GNOME or KDE, this option tells %PRODUCTNAME to use the system settings. You must restart %PRODUCTNAME to initiate this setting.<comment>UFI: see spec "System-Settings"</comment></paragraph>
 <bookmark xml-lang="en-US" branch="hid/SVX:EDIT:RID_SVXPAGE_INET_PROXY:ED_HTTP_PROXY" id="bm_id3154346" localize="false"/>
 <paragraph role="heading" id="hd_id3148948" xml-lang="en-US" level="3" l10n="U" oldref="16">HTTP proxy</paragraph>
 <paragraph role="paragraph" id="par_id3154923" xml-lang="en-US" l10n="U" oldref="17"><ahelp hid="SVX:EDIT:RID_SVXPAGE_INET_PROXY:ED_HTTP_PROXY">Type the name of the proxy server for <link href="text/shared/00/00000002.xhp#http" name="HTTP">HTTP</link>.</ahelp> Type the port in the right-hand field.</paragraph>
Index: shell/prj/build.lst
===================================================================
RCS file: /cvs/gsl/shell/prj/build.lst,v
retrieving revision 1.26
retrieving revision 1.26.38.1
diff -u -p -u -p -r1.26 -r1.26.38.1
--- shell/prj/build.lst	23 Sep 2005 13:49:03 -0000	1.26
+++ shell/prj/build.lst	11 Apr 2006 12:34:29 -0000	1.26.38.1
@@ -21,5 +21,6 @@ sh    shell\source\win32\shlxthandler   
 sh    shell\source\backends\localebe               nmake   -   all sh_backends_localebe NULL
 sh    shell\source\backends\wininetbe              nmake   -   w   sh_backends_wininetbe NULL
 sh    shell\source\backends\gconfbe                nmake   -   u   sh_backends_gconfbe NULL
+sh    shell\source\backends\kdebe                  nmake   -   u   sh_backends_kdebe NULL
 sh    shell\source\win32\shlxthandler\ooofilt      nmake   -   w   sh_win32_shlxthandler_ooofilt sh_all_zipfile.w sh_all_ooofilereader.w sh_win32_shlxthandler_util.w sh_all NULL
 sh    shell\source\win32\shlxthandler\ooofilt\proxy nmake   -   w   sh_win32_ooofiltproxy NULL 
Index: shell/prj/d.lst
===================================================================
RCS file: /cvs/gsl/shell/prj/d.lst,v
retrieving revision 1.14
retrieving revision 1.14.116.1
diff -u -p -u -p -r1.14 -r1.14.116.1
--- shell/prj/d.lst	18 Nov 2004 08:49:24 -0000	1.14
+++ shell/prj/d.lst	11 Apr 2006 12:34:29 -0000	1.14.116.1
@@ -26,3 +26,4 @@ mkdir: %_DEST%\inc%_EXT%\shell
 ..\source\cmdmail\cmdmail.xml %_DEST%\xml%_EXT%\cmdmail.xml
 
 ..\%__SRC%\misc\gconfbe1-ucd.txt  %_DEST%\bin%_EXT%\gconfbe1-ucd.txt
+..\%__SRC%\misc\kdebe1-ucd.txt  %_DEST%\bin%_EXT%\kdebe1-ucd.txt
Index: shell/source/backends/gconfbe/gconfbecdef.cxx
===================================================================
RCS file: /cvs/gsl/shell/source/backends/gconfbe/gconfbecdef.cxx,v
retrieving revision 1.5
retrieving revision 1.5.2.1
diff -u -p -u -p -r1.5 -r1.5.2.1
--- shell/source/backends/gconfbe/gconfbecdef.cxx	22 Mar 2006 09:34:51 -0000	1.5
+++ shell/source/backends/gconfbe/gconfbecdef.cxx	29 May 2006 13:47:16 -0000	1.5.2.1
@@ -71,22 +71,18 @@ static uno::Reference<uno::XInterface> S
         
         if (xCurrentContext.is())
         {
-#ifndef ENABLE_LOCKDOWN
             uno::Any aValue = xCurrentContext->getValueByName(
                 rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "system.desktop-environment" ) ) );
         
             rtl::OUString aDesktopEnvironment;
             if ( (aValue >>= aDesktopEnvironment) && (aDesktopEnvironment.equalsAscii("GNOME")) )
             {
-#endif // ! ENABLE_LOCKDOWN
                 // ORBit-2 versions < 2.8 cause a deadlock with the gtk+ VCL plugin
                 if ( (orbit_major_version >= 2) && (orbit_minor_version >= 8) )
                 {
                     return * GconfBackend::createInstance(xContext);
                 }
-#ifndef ENABLE_LOCKDOWN
             }
-#endif // ! ENABLE_LOCKDOWN
         }
         
         return uno::Reference<uno::XInterface>(); 
Index: shell/source/backends/kdebe/exports.map
===================================================================
RCS file: shell/source/backends/kdebe/exports.map
diff -N shell/source/backends/kdebe/exports.map
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/exports.map	11 Apr 2006 12:40:13 -0000	1.1.2.1
@@ -0,0 +1,11 @@
+UDK_3_0_0 {
+	global:
+		GetVersionInfo;
+		component_getDescriptionFunc;
+		component_getImplementationEnvironment;
+		component_getFactory;
+		component_writeInfo;
+
+	local:
+		*;
+};
Index: shell/source/backends/kdebe/kdebackend.cxx
===================================================================
RCS file: shell/source/backends/kdebe/kdebackend.cxx
diff -N shell/source/backends/kdebe/kdebackend.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdebackend.cxx	11 Apr 2006 12:40:13 -0000	1.1.2.1
@@ -0,0 +1,179 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include "kdebackend.hxx"
+
+#ifndef KDECOMMONLAYER_HXX_
+#include "kdecommonlayer.hxx"
+#endif 
+#ifndef KDEINETLAYER_HXX_
+#include "kdeinetlayer.hxx"
+#endif 
+#ifndef KDEVCLLAYER_HXX_
+#include "kdevcllayer.hxx"
+#endif 
+
+//------------------------------------------------------------------------------
+
+KDEBackend* KDEBackend::mInstance= 0;
+
+KDEBackend* KDEBackend::createInstance(const uno::Reference<uno::XComponentContext>& xContext)
+{
+    if (mInstance == 0)
+    {
+        mInstance = new KDEBackend (xContext);
+    }
+    
+    return mInstance;
+}
+
+//------------------------------------------------------------------------------
+
+KDEBackend::KDEBackend(const uno::Reference<uno::XComponentContext>& xContext)
+        throw (backend::BackendAccessException)
+    : BackendBase(mMutex), m_xContext(xContext)
+{
+}
+
+//------------------------------------------------------------------------------
+
+KDEBackend::~KDEBackend(void)
+{
+}
+
+//------------------------------------------------------------------------------
+
+uno::Reference<backend::XLayer> SAL_CALL KDEBackend::getLayer(
+    const rtl::OUString& aComponent, const rtl::OUString& aTimestamp)
+    throw (backend::BackendAccessException, lang::IllegalArgumentException)
+{
+    uno::Reference<backend::XLayer> xLayer;
+    
+    if( aComponent.equalsAscii("org.openoffice.Office.Common" ) )
+    {
+        xLayer = new KDECommonLayer(m_xContext);
+    }
+    else if( aComponent.equalsAscii("org.openoffice.Inet" ) )
+    {
+        xLayer = new KDEInetLayer(m_xContext);
+    }
+    else if( aComponent.equalsAscii("org.openoffice.VCL" ) )
+    {
+        xLayer = new KDEVCLLayer(m_xContext);
+    }
+    
+    return xLayer;
+}
+
+//------------------------------------------------------------------------------
+
+uno::Reference<backend::XUpdatableLayer> SAL_CALL
+KDEBackend::getUpdatableLayer(const rtl::OUString& aComponent) 
+    throw (backend::BackendAccessException,lang::NoSupportException,	   
+		   lang::IllegalArgumentException)
+{
+    throw lang::NoSupportException( rtl::OUString(
+        RTL_CONSTASCII_USTRINGPARAM("KDEBackend: No Update Operation allowed, Read Only access") ),
+        *this) ; 
+}
+
+//------------------------------------------------------------------------------
+
+rtl::OUString SAL_CALL KDEBackend::getBackendName(void)
+{
+    return rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM("com.sun.star.comp.configuration.backend.KDEBackend") );
+}
+
+//------------------------------------------------------------------------------
+
+rtl::OUString SAL_CALL KDEBackend::getImplementationName(void) 
+    throw (uno::RuntimeException) 
+{
+    return getBackendName() ;
+}
+
+//------------------------------------------------------------------------------
+
+uno::Sequence<rtl::OUString> SAL_CALL KDEBackend::getBackendServiceNames(void) 
+{
+    uno::Sequence<rtl::OUString> aServices(2) ;
+    aServices[0] = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM("com.sun.star.configuration.backend.KDEBackend")) ;
+    aServices[1] = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM("com.sun.star.configuration.backend.PlatformBackend")) ;
+            
+    return aServices ;
+}
+
+//------------------------------------------------------------------------------
+
+uno::Sequence<rtl::OUString> SAL_CALL KDEBackend::getSupportedComponents(void)
+{
+    uno::Sequence<rtl::OUString> aSupportedComponentsList(3) ;
+    aSupportedComponentsList[0] = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM("org.openoffice.VCL")) ;
+    aSupportedComponentsList[1] = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM("org.openoffice.Inet")) ;
+    aSupportedComponentsList[2] = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM("org.openoffice.Office.Common")) ;
+            
+    return aSupportedComponentsList ;
+}
+
+//------------------------------------------------------------------------------
+
+sal_Bool SAL_CALL KDEBackend::supportsService(const rtl::OUString& aServiceName) 
+    throw (uno::RuntimeException) 
+{
+    uno::Sequence< rtl::OUString > const svc = getBackendServiceNames();
+
+    for(sal_Int32 i = 0; i < svc.getLength(); ++i )
+        if(svc[i] == aServiceName)
+            return true;
+
+    return false;
+}
+
+//------------------------------------------------------------------------------
+
+uno::Sequence<rtl::OUString> 
+SAL_CALL KDEBackend::getSupportedServiceNames(void) 
+    throw (uno::RuntimeException) 
+{
+    return getBackendServiceNames() ;
+}
+
+// ---------------------------------------------------------------------------------------
Index: shell/source/backends/kdebe/kdebackend.hxx
===================================================================
RCS file: shell/source/backends/kdebe/kdebackend.hxx
diff -N shell/source/backends/kdebe/kdebackend.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdebackend.hxx	11 Apr 2006 12:40:13 -0000	1.1.2.1
@@ -0,0 +1,155 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef KDEBACKEND_HXX_
+#define KDEBACKEND_HXX_
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XSCHEMASUPPLIER_HPP_
+#include <com/sun/star/configuration/backend/XSingleLayerStratum.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_LANG_XINITIALIZATION_HPP_
+#include <com/sun/star/lang/XInitialization.hpp>
+#endif
+#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
+#include <com/sun/star/uno/XComponentContext.hpp>
+#endif
+#ifndef _COM_SUN_STAR_LANG_XSERVICEINFO_HPP_
+#include <com/sun/star/lang/XServiceInfo.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_INVALIDBOOTSTRAPFILEEXCEPTION_HPP_
+#include <com/sun/star/configuration/InvalidBootstrapFileException.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_CANNOTCONNECTEXCEPTION_HPP_
+#include <com/sun/star/configuration/backend/CannotConnectException.hpp>
+#endif
+
+#ifndef _CPPUHELPER_COMPBASE2_HXX_
+#include <cppuhelper/compbase2.hxx>
+#endif
+
+#ifndef INCLUDED_MAP
+#include <map>
+#define INCLUDED_MAP
+#endif
+
+namespace css = com::sun::star ;
+namespace uno = css::uno ;
+namespace lang = css::lang ;
+namespace backend = css::configuration::backend ;
+
+
+//------------------------------------------------------------------------------
+typedef cppu::WeakComponentImplHelper2<backend::XSingleLayerStratum,
+				       lang::XServiceInfo> BackendBase ;
+
+/**
+  Implements the SingleLayerStratum service for KDE access.
+  */
+class KDEBackend : public BackendBase {
+    public :
+        
+	static KDEBackend* createInstance(const uno::Reference<uno::XComponentContext>& xContext);
+
+        // XServiceInfo
+        virtual rtl::OUString SAL_CALL getImplementationName(  ) 
+            throw (uno::RuntimeException) ;
+        
+        virtual sal_Bool SAL_CALL supportsService( const rtl::OUString& aServiceName ) 
+            throw (uno::RuntimeException) ;
+
+        virtual uno::Sequence<rtl::OUString> SAL_CALL getSupportedServiceNames(  ) 
+            throw (uno::RuntimeException) ;
+
+        /**
+          Provides the implementation name.
+
+          @return   implementation name
+          */
+        static rtl::OUString SAL_CALL getBackendName(void) ;
+
+        /**
+          Provides the supported services names
+
+          @return   service names
+          */
+        static uno::Sequence<rtl::OUString> SAL_CALL getBackendServiceNames(void) ;
+
+        /**
+          Provides the supported component nodes
+
+          @return supported component nodes
+        */
+        static uno::Sequence<rtl::OUString> SAL_CALL getSupportedComponents(void) ;
+        
+        //XSingleLayerStratum
+        virtual uno::Reference<backend::XLayer> SAL_CALL 
+            getLayer( const rtl::OUString& aLayerId, const rtl::OUString& aTimestamp )
+                throw (backend::BackendAccessException, lang::IllegalArgumentException) ;
+
+        virtual uno::Reference<backend::XUpdatableLayer> SAL_CALL
+            getUpdatableLayer( const rtl::OUString& aLayerId ) 
+                throw (backend::BackendAccessException, lang::NoSupportException,	   
+                       lang::IllegalArgumentException) ;
+
+    protected:
+        /**
+          Service constructor from a service factory.
+
+          @param xContext   component context
+          */
+         KDEBackend(const uno::Reference<uno::XComponentContext>& xContext) 
+            throw (backend::BackendAccessException);
+                        
+        /** Destructor */
+        ~KDEBackend(void) ;
+
+    private:
+     
+        /** Build KDE/OO mapping table */ 
+		void initializeMappingTable ();
+
+        
+        /** The component context */		
+        uno::Reference<uno::XComponentContext> m_xContext;
+		
+        /** Mutex for reOOurces protection */
+        osl::Mutex mMutex ;
+
+        static KDEBackend* mInstance;
+};
+
+#endif // CONFIGMGR_LOCALBE_LOCALSINGLESTRATUM_HXX_
Index: shell/source/backends/kdebe/kdebe.xml
===================================================================
RCS file: shell/source/backends/kdebe/kdebe.xml
diff -N shell/source/backends/kdebe/kdebe.xml
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdebe.xml	11 Apr 2006 12:40:14 -0000	1.1.2.1
@@ -0,0 +1,36 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!DOCTYPE module-description PUBLIC "-//StarOffice//DTD ComponentDescription 1.0//EN" "module-description.dtd">
+<module-description xmlns:xlink="http://www.w3.org/1999/xlink">
+    <module-name>kdebe</module-name>
+    <component-description>
+        <author> Éric Bischoff </author>
+        <name>com.sun.star.comp.configuration.backend.KDEBackend</name>
+        <description> The KDE configuration backend </description>
+        <loader-name>com.sun.star.loader.SharedLibrary</loader-name>
+        <language>c++</language>
+        <status value="beta"/>        
+        <supported-service>com.sun.star.comp.configuration.backend.KDEBackend</supported-service>		
+        <supported-service>com.sun.star.comp.configuration.backend.PlatformBackend</supported-service>		
+        <service-dependency>...</service-dependency>
+        <type>com.sun.star.configuration.backend.XBackendChangesListener</type>
+        <type>com.sun.star.configuration.backend.XBackendChangesNotifier</type>
+        <type>com.sun.star.configuration.backend.XLayerHandler</type>
+        <type>com.sun.star.configuration.backend.XSingleLayerStratum</type>
+        <type>com.sun.star.lang.XMultiComponentFactory</type>
+        <type>com.sun.star.lang.XServiceInfo</type>
+        <type>com.sun.star.lang.XSingleComponentFactory</type>
+        <type>com.sun.star.lang.XTypeProvider</type>
+        <type>com.sun.star.uno.TypeClass</type>
+        <type>com.sun.star.uno.XAggregation</type>
+        <type>com.sun.star.uno.XComponentContext</type>
+        <type>com.sun.star.uno.XCurrentContext</type>
+        <type>com.sun.star.uno.XWeak</type>
+        <type>com.sun.star.registry.XRegistryKey</type>
+    </component-description>
+    <project-build-dependency>cppuhelper</project-build-dependency>
+    <project-build-dependency>cppu</project-build-dependency>
+    <project-build-dependency>sal</project-build-dependency>
+    <runtime-module-dependency>cppuhelper3$(COM)</runtime-module-dependency>
+    <runtime-module-dependency>cppu3</runtime-module-dependency>
+    <runtime-module-dependency>sal3</runtime-module-dependency>
+</module-description>
Index: shell/source/backends/kdebe/kdebe1-ucd.txt
===================================================================
RCS file: shell/source/backends/kdebe/kdebe1-ucd.txt
diff -N shell/source/backends/kdebe/kdebe1-ucd.txt
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdebe1-ucd.txt	11 Apr 2006 12:40:14 -0000	1.1.2.1
@@ -0,0 +1,9 @@
+[ComponentDescriptor]
+ImplementationName=com.sun.star.comp.configuration.backend.KDEBackend
+ComponentName=kdebe1.uno.so
+LoaderName=com.sun.star.loader.SharedLibrary
+[Data]
+SupportedComponents=org.openoffice.VCL;org.openoffice.Inet;org.openoffice.Office.Common
+[SupportedServices]
+com.sun.star.configuration.backend.KDEBackend
+com.sun.star.configuration.backend.PlatformBackend
Index: shell/source/backends/kdebe/kdebecdef.cxx
===================================================================
RCS file: shell/source/backends/kdebe/kdebecdef.cxx
diff -N shell/source/backends/kdebe/kdebecdef.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdebecdef.cxx	11 Apr 2006 12:40:14 -0000	1.1.2.1
@@ -0,0 +1,160 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef KDEBACKEND_HXX_
+#include "kdebackend.hxx"
+#endif
+
+#ifndef _COM_SUN_STAR_REGISTRY_XREGISTRYKEY_HPP_
+#include <com/sun/star/registry/XRegistryKey.hpp>
+#endif
+
+#ifndef _CPPUHELPER_IMPLEMENTATIONENTRY_HXX_
+#include <cppuhelper/implementationentry.hxx>
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
+#include <com/sun/star/uno/XComponentContext.hpp>
+#endif
+
+#include "uno/current_context.hxx"
+
+namespace css = com::sun::star ;
+namespace uno = css::uno ;
+namespace lang = css::lang ;
+namespace backend = css::configuration::backend ;
+
+//==============================================================================
+
+static uno::Reference<uno::XInterface> SAL_CALL createKDEBackend(const uno::Reference<uno::XComponentContext>& xContext)
+{
+    try {
+        uno::Reference< uno::XCurrentContext > xCurrentContext(uno::getCurrentContext());
+        
+        if (xCurrentContext.is())
+        {
+            uno::Any aValue = xCurrentContext->getValueByName(
+                rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "system.desktop-environment" ) ) );
+        
+            rtl::OUString aDesktopEnvironment;
+            if ( (aValue >>= aDesktopEnvironment) && (aDesktopEnvironment.equalsAscii("KDE")) )
+                return * KDEBackend::createInstance(xContext);
+        }
+        
+        return uno::Reference<uno::XInterface>(); 
+        
+    } catch (uno::RuntimeException e) {
+        return uno::Reference<uno::XInterface>();    
+    }    
+    
+}
+
+//==============================================================================
+
+static const cppu::ImplementationEntry kImplementations_entries[] = 
+{
+    {
+        createKDEBackend,
+        KDEBackend::getBackendName,
+        KDEBackend::getBackendServiceNames,
+        cppu::createSingleComponentFactory,
+        NULL,
+        0
+    },
+	{ NULL }
+} ;
+//------------------------------------------------------------------------------
+
+extern "C" void SAL_CALL component_getImplementationEnvironment(
+                                            const sal_Char **aEnvTypeName,
+                                            uno_Environment **aEnvironment) {
+    *aEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME ;
+}
+
+//------------------------------------------------------------------------------
+
+extern "C" sal_Bool SAL_CALL component_writeInfo(void *pServiceManager,
+                                                 void *pRegistryKey) {
+    
+    using namespace ::com::sun::star::registry;
+    if (pRegistryKey)
+    {
+        try
+        {
+            uno::Reference< XRegistryKey > xImplKey = static_cast< XRegistryKey* >( pRegistryKey )->createKey(
+                rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("/") ) + KDEBackend::getBackendName()
+            );
+            
+	    // Register associated service names
+            uno::Reference< XRegistryKey > xServicesKey = xImplKey->createKey( 
+                rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("/UNO/SERVICES") )
+            );
+            
+            uno::Sequence<rtl::OUString> sServiceNames = KDEBackend::getBackendServiceNames();
+            for (sal_Int32 i = 0 ; i < sServiceNames.getLength() ; ++ i)
+                xServicesKey->createKey(sServiceNames[i]);
+
+            // Register supported components            
+            uno::Reference<XRegistryKey> xComponentKey = xImplKey->createKey(
+                rtl::OUString( RTL_CONSTASCII_USTRINGPARAM("/DATA/SupportedComponents") )
+            );
+        
+            xComponentKey->setAsciiListValue( KDEBackend::getSupportedComponents() );
+
+            return sal_True;
+        }
+        
+        catch( InvalidRegistryException& )
+        {                       
+            OSL_ENSURE(sal_False, "InvalidRegistryException caught");           
+        }
+    }
+    
+    return sal_False;
+}
+
+//------------------------------------------------------------------------------
+
+extern "C" void *component_getFactory(const sal_Char *aImplementationName,
+                                      void *aServiceManager,
+                                      void *aRegistryKey) {
+                                      
+    return cppu::component_getFactoryHelper(
+        aImplementationName,
+        aServiceManager,
+        aRegistryKey,
+        kImplementations_entries) ;
+}
+//------------------------------------------------------------------------------
Index: shell/source/backends/kdebe/kdecommonlayer.cxx
===================================================================
RCS file: shell/source/backends/kdebe/kdecommonlayer.cxx
diff -N shell/source/backends/kdebe/kdecommonlayer.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdecommonlayer.cxx	2 May 2006 13:50:08 -0000	1.1.2.2
@@ -0,0 +1,168 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef KDECOMMONLAYER_HXX_
+#include "kdecommonlayer.hxx"
+#endif 
+
+#ifndef _KEMAILSETTINGS_H
+#include "kemailsettings.h"
+#endif
+
+#ifndef _KGLOBALSETTINGS_H
+#include "kglobalsettings.h"
+#endif
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_PROPERTYINFO_HPP_
+#include <com/sun/star/configuration/backend/PropertyInfo.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYERCONTENTDESCIBER_HPP_
+#include <com/sun/star/configuration/backend/XLayerContentDescriber.hpp>
+#endif
+
+#ifndef _OSL_SECURITY_HXX_
+#include <osl/security.hxx>
+#endif
+#ifndef _OSL_FILE_HXX_
+#include <osl/file.hxx>
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_SEQUENCE_HXX_
+#include <com/sun/star/uno/Sequence.hxx>
+#endif
+
+#define SPACE      ' '
+
+//==============================================================================
+
+KDECommonLayer::KDECommonLayer(const uno::Reference<uno::XComponentContext>& xContext)
+{
+    //Create instance of LayerContentDescriber Service
+    rtl::OUString const k_sLayerDescriberService(RTL_CONSTASCII_USTRINGPARAM(
+        "com.sun.star.comp.configuration.backend.LayerDescriber"));
+
+    typedef uno::Reference<backend::XLayerContentDescriber> LayerDescriber; 
+    uno::Reference< lang::XMultiComponentFactory > xServiceManager = xContext->getServiceManager();
+    if( xServiceManager.is() )
+    {
+        m_xLayerContentDescriber = LayerDescriber::query(
+            xServiceManager->createInstanceWithContext(k_sLayerDescriberService, xContext));
+    }
+    else
+    {
+        OSL_TRACE("Could not retrieve ServiceManager");
+    }
+}
+
+//------------------------------------------------------------------------------
+
+void SAL_CALL KDECommonLayer::readData( const uno::Reference<backend::XLayerHandler>& xHandler) 
+    throw ( backend::MalformedDataException, lang::NullPointerException, 
+            lang::WrappedTargetException, uno::RuntimeException)
+{
+    if( ! m_xLayerContentDescriber.is() )
+    {
+        throw uno::RuntimeException( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(
+            "Could not create com.sun.star.configuration.backend.LayerContentDescriber Service"
+        ) ), static_cast < backend::XLayer * > (this) );
+    }
+    
+    uno::Sequence<backend::PropertyInfo> aPropInfoList(2);
+    sal_Int32 nProperties = 0;
+
+    KEMailSettings aEmailSettings;
+    QString aClientProgram;
+    ::rtl::OUString sClientProgram;
+
+    aClientProgram = aEmailSettings.getSetting( KEMailSettings::ClientProgram );
+    if ( aClientProgram.isEmpty() )
+        aClientProgram = "kmail";
+    else
+        aClientProgram = aClientProgram.section(SPACE, 0, 0);
+    sClientProgram = (const sal_Unicode *) aClientProgram.ucs2();
+
+    aPropInfoList[nProperties].Name = rtl::OUString(
+        RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Office.Common/ExternalMailer/Program") );
+    aPropInfoList[nProperties].Type = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM( "string" ) );
+    aPropInfoList[nProperties].Protected = sal_False;
+    aPropInfoList[nProperties++].Value = uno::makeAny( sClientProgram );
+
+    QString aDocumentsDir( "file:" );
+    ::rtl::OUString sDocumentsDir;
+
+    aDocumentsDir += KGlobalSettings::documentPath();
+    if ( aDocumentsDir.endsWith(QChar('/')) )
+        aDocumentsDir.truncate ( aDocumentsDir.length() - 1 );
+    sDocumentsDir = (const sal_Unicode *) aDocumentsDir.ucs2();
+
+    aPropInfoList[nProperties].Name = rtl::OUString(
+        RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Office.Common/Path/Current/Work") );
+    aPropInfoList[nProperties].Type = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM( "string" ) );
+    aPropInfoList[nProperties].Protected = sal_False;
+    aPropInfoList[nProperties++].Value = uno::makeAny( sDocumentsDir );
+
+    if( nProperties > 0 )
+    {
+        aPropInfoList.realloc(nProperties);
+        m_xLayerContentDescriber->describeLayer(xHandler, aPropInfoList);
+    }
+}
+
+//------------------------------------------------------------------------------
+
+rtl::OUString SAL_CALL KDECommonLayer::getTimestamp(void) 
+    throw (uno::RuntimeException)
+{
+    // Return the value as timestamp to avoid regenerating the binary cache
+    // on each office launch.
+
+    ::rtl::OUString sTimeStamp,
+                    sep( RTL_CONSTASCII_USTRINGPARAM( "$" ) );
+
+    KEMailSettings aEmailSettings;
+    QString aClientProgram = aEmailSettings.getSetting( KEMailSettings::ClientProgram );
+    aClientProgram = aClientProgram.section(SPACE, 0, 0);
+
+    QString aDocumentsDir;
+    aDocumentsDir = KGlobalSettings::documentPath();
+
+    sTimeStamp = (const sal_Unicode *) aClientProgram.ucs2();
+    sTimeStamp += sep;
+    sTimeStamp += (const sal_Unicode *) aDocumentsDir.ucs2();
+
+    return sTimeStamp;
+}
Index: shell/source/backends/kdebe/kdecommonlayer.hxx
===================================================================
RCS file: shell/source/backends/kdebe/kdecommonlayer.hxx
diff -N shell/source/backends/kdebe/kdecommonlayer.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdecommonlayer.hxx	11 Apr 2006 12:40:15 -0000	1.1.2.1
@@ -0,0 +1,72 @@
+#ifndef KDECOMMONLAYER_HXX_
+#define KDECOMMONLAYER_HXX_
+
+#ifndef KDEBACKEND_HXX_
+#include "kdebackend.hxx"
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
+#include <com/sun/star/uno/XComponentContext.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYER_HPP_
+#include <com/sun/star/configuration/backend/XLayer.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_BACKENDACCESSEXCEPTION_HPP_
+#include <com/sun/star/configuration/backend/BackendAccessException.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYERCONTENTDESCIBER_HPP_
+#include <com/sun/star/configuration/backend/XLayerContentDescriber.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_UTIL_XTIMESTAMPED_HPP_
+#include <com/sun/star/util/XTimeStamped.hpp>
+#endif
+
+#ifndef _CPPUHELPER_IMPLBASE2_HXX_
+#include <cppuhelper/implbase2.hxx>
+#endif
+
+namespace css = com::sun::star ;
+namespace uno = css::uno ;
+namespace lang = css::lang ;
+namespace backend = css::configuration::backend ;
+namespace util = css::util ;
+
+/**
+  Implementation of the XLayer interface for the KDE values mapped into
+  the org.openoffice.Office.Common configuration component.
+  */
+class KDECommonLayer : public cppu::WeakImplHelper2<backend::XLayer, util::XTimeStamped> 
+{
+public :
+    /**
+      Constructor given the component context
+
+      @param xContext       The component context
+    */
+    
+    KDECommonLayer(const uno::Reference<uno::XComponentContext>& xContext);
+
+    // XLayer
+    virtual void SAL_CALL readData(
+        const uno::Reference<backend::XLayerHandler>& xHandler) 
+        throw ( backend::MalformedDataException,
+            lang::NullPointerException, 
+            lang::WrappedTargetException, 
+            uno::RuntimeException) ;
+
+    // XTimeStamped
+    virtual rtl::OUString SAL_CALL getTimestamp(void) 
+        throw (uno::RuntimeException);
+
+    protected:
+
+    /** Destructor */
+    ~KDECommonLayer(void) {}
+              
+    private :
+        uno::Reference<backend::XLayerContentDescriber> m_xLayerContentDescriber ;
+  } ;
+
+#endif // KDECOMMONLAYER
Index: shell/source/backends/kdebe/kdeinetlayer.cxx
===================================================================
RCS file: shell/source/backends/kdebe/kdeinetlayer.cxx
diff -N shell/source/backends/kdebe/kdeinetlayer.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdeinetlayer.cxx	29 May 2006 19:50:34 -0000	1.1.2.3
@@ -0,0 +1,244 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef KDEINETLAYER_HXX_
+#include "kdeinetlayer.hxx"
+#endif 
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_PROPERTYINFO_HPP_
+#include <com/sun/star/configuration/backend/PropertyInfo.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYERCONTENTDESCIBER_HPP_
+#include <com/sun/star/configuration/backend/XLayerContentDescriber.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_SEQUENCE_HXX_
+#include <com/sun/star/uno/Sequence.hxx>
+#endif
+
+#ifndef __kprotocolmanager_h__
+#include <kprotocolmanager.h>
+#endif
+
+#define COMMA      ','
+#define SEMI_COLON ';'
+
+//==============================================================================
+
+KDEInetLayer::KDEInetLayer(const uno::Reference<uno::XComponentContext>& xContext)
+{
+    //Create instance of LayerContentDescriber Service
+    rtl::OUString const k_sLayerDescriberService(RTL_CONSTASCII_USTRINGPARAM(
+        "com.sun.star.comp.configuration.backend.LayerDescriber"));
+
+    typedef uno::Reference<backend::XLayerContentDescriber> LayerDescriber; 
+    uno::Reference< lang::XMultiComponentFactory > xServiceManager = xContext->getServiceManager();
+    if( xServiceManager.is() )
+    {
+        m_xLayerContentDescriber = LayerDescriber::query(
+            xServiceManager->createInstanceWithContext(k_sLayerDescriberService, xContext));
+    }
+    else
+    {
+        OSL_TRACE("Could not retrieve ServiceManager");
+    }
+}
+
+//------------------------------------------------------------------------------
+
+void SAL_CALL KDEInetLayer::readData( const uno::Reference<backend::XLayerHandler>& xHandler) 
+    throw ( backend::MalformedDataException, lang::NullPointerException, 
+            lang::WrappedTargetException, uno::RuntimeException)
+{
+    if( ! m_xLayerContentDescriber.is() )
+    {
+        throw uno::RuntimeException( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(
+            "Could not create com.sun.star.configuration.backend.LayerContentDescriber Service"
+        ) ), static_cast < backend::XLayer * > (this) );
+    }
+
+    uno::Sequence<backend::PropertyInfo> aPropInfoList(6);
+    sal_Int32 nProperties = 0;
+
+    KProtocolManager::ProxyType aProxyType = KProtocolManager::proxyType();
+
+    switch ( KProtocolManager::proxyType() )
+    {
+        case KProtocolManager::ManualProxy: // Proxies are manually configured
+            setProxy(aPropInfoList, nProperties, 1,
+                     KProtocolManager::noProxyFor(),
+                     KProtocolManager::proxyFor( "HTTP" ),
+                     KProtocolManager::proxyFor( "FTP" ) );
+            break;
+        case KProtocolManager::PACProxy:    // A proxy configuration URL has been given
+        case KProtocolManager::WPADProxy:   // A proxy should be automatically discovered
+        case KProtocolManager::EnvVarProxy: // Use the proxy values set through environment variables
+// In such cases, the proxy address is not stored in KDE, but determined dynamically.
+// The proxy address may depend on the requested address, on the time of the day, on the speed of the wind...
+// The best we can do here is to ask the current value for a given address.
+            setProxy(aPropInfoList, nProperties, 1,
+                     KProtocolManager::noProxyFor(),
+                     KProtocolManager::proxyForURL( "http://www.openoffice.org" ),
+                     KProtocolManager::proxyForURL( "ftp://ftp.openoffice.org" ) );
+            break;
+        default:                            // No proxy is used
+            setProxy(aPropInfoList, nProperties, 0);
+    }
+
+    if ( nProperties > 0 )
+    {
+      aPropInfoList.realloc(nProperties);
+      m_xLayerContentDescriber->describeLayer(xHandler, aPropInfoList);
+    }
+}
+
+//------------------------------------------------------------------------------
+
+rtl::OUString SAL_CALL KDEInetLayer::getTimestamp(void) 
+    throw (uno::RuntimeException)
+{
+    // Return the value as timestamp to avoid regenerating the binary cache
+    // on each office launch.
+
+    QString aProxyType, aNoProxyFor, aHTTPProxy, aFTPProxy;
+
+    switch ( KProtocolManager::proxyType() )
+    {
+        case KProtocolManager::ManualProxy:
+            aProxyType = '1';
+            aNoProxyFor = KProtocolManager::noProxyFor();
+            aHTTPProxy = KProtocolManager::proxyFor( "HTTP" );
+            aFTPProxy = KProtocolManager::proxyFor( "FTP" );
+            break;
+        case KProtocolManager::PACProxy:
+        case KProtocolManager::WPADProxy:
+        case KProtocolManager::EnvVarProxy:
+            aProxyType = '1';
+            aNoProxyFor = KProtocolManager::noProxyFor();
+            aHTTPProxy = KProtocolManager::proxyForURL( "http://www.openoffice.org" );
+            aFTPProxy = KProtocolManager::proxyForURL( "ftp://ftp.openoffice.org" );
+            break;
+        default:
+            aProxyType = '0';
+    }
+
+    ::rtl::OUString sTimeStamp,
+                    sep( RTL_CONSTASCII_USTRINGPARAM( "$" ) );
+
+    sTimeStamp = (const sal_Unicode *) aProxyType.ucs2();
+    sTimeStamp += sep;
+    sTimeStamp += (const sal_Unicode *) aNoProxyFor.ucs2();
+    sTimeStamp += sep;
+    sTimeStamp += (const sal_Unicode *) aHTTPProxy.ucs2();
+    sTimeStamp += sep;
+    sTimeStamp += (const sal_Unicode *) aFTPProxy.ucs2();
+
+    return sTimeStamp;
+}
+
+//------------------------------------------------------------------------------
+
+void SAL_CALL KDEInetLayer::setProxy
+    (uno::Sequence<backend::PropertyInfo> &aPropInfoList, sal_Int32 &nProperties,
+     int nProxyType, const QString &aNoProxy, const QString &aHTTPProxy, const QString &aFTPProxy) const
+{
+    aPropInfoList[nProperties].Name = rtl::OUString(
+        RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Inet/Settings/ooInetProxyType") );
+    aPropInfoList[nProperties].Type = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM( "int" ) );
+    aPropInfoList[nProperties].Protected = sal_False;
+    aPropInfoList[nProperties++].Value = uno::makeAny( (sal_Int32) nProxyType );
+
+    if (nProxyType == 0) return;
+
+    if ( !aNoProxy.isEmpty() )
+    {
+        QString aNoProxyFor(aNoProxy);
+        ::rtl::OUString sNoProxyFor;
+
+        aNoProxyFor = aNoProxyFor.replace( COMMA, SEMI_COLON );
+        sNoProxyFor = (const sal_Unicode *) aNoProxyFor.ucs2();
+
+        aPropInfoList[nProperties].Name = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Inet/Settings/ooInetNoProxy") );
+        aPropInfoList[nProperties].Type = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM( "string" ) );
+        aPropInfoList[nProperties].Protected = sal_False;
+        aPropInfoList[nProperties++].Value = uno::makeAny( sNoProxyFor );
+    }
+
+    if ( !aHTTPProxy.isEmpty() )
+    {
+        KURL aProxy(aHTTPProxy);
+        ::rtl::OUString sProxy = (const sal_Unicode *) aProxy.host().ucs2();
+        sal_Int32 nPort = aProxy.port();
+
+        aPropInfoList[nProperties].Name = rtl::OUString(
+            RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Inet/Settings/ooInetHTTPProxyName") );
+        aPropInfoList[nProperties].Type = rtl::OUString( 
+            RTL_CONSTASCII_USTRINGPARAM( "string" ) );
+        aPropInfoList[nProperties].Protected = sal_False;
+        aPropInfoList[nProperties++].Value = uno::makeAny( sProxy );
+
+        aPropInfoList[nProperties].Name = rtl::OUString(
+            RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Inet/Settings/ooInetHTTPProxyPort") );
+        aPropInfoList[nProperties].Type = rtl::OUString( 
+            RTL_CONSTASCII_USTRINGPARAM( "int" ) );
+        aPropInfoList[nProperties].Protected = sal_False;
+        aPropInfoList[nProperties++].Value = uno::makeAny( nPort );
+    }
+
+    if ( !aFTPProxy.isEmpty() )
+    {
+        KURL aProxy(aFTPProxy);
+        ::rtl::OUString sProxy = (const sal_Unicode *) aProxy.host().ucs2();
+        sal_Int32 nPort = aProxy.port();
+
+        aPropInfoList[nProperties].Name = rtl::OUString(
+            RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Inet/Settings/ooInetFTPProxyName") );
+        aPropInfoList[nProperties].Type = rtl::OUString( 
+            RTL_CONSTASCII_USTRINGPARAM( "string" ) );
+        aPropInfoList[nProperties].Protected = sal_False;
+        aPropInfoList[nProperties++].Value = uno::makeAny( sProxy );
+
+        aPropInfoList[nProperties].Name = rtl::OUString(
+            RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.Inet/Settings/ooInetFTPProxyPort") );
+        aPropInfoList[nProperties].Type = rtl::OUString( 
+            RTL_CONSTASCII_USTRINGPARAM( "int" ) );
+        aPropInfoList[nProperties].Protected = sal_False;
+        aPropInfoList[nProperties++].Value = uno::makeAny( nPort );
+    }
+}
+
Index: shell/source/backends/kdebe/kdeinetlayer.hxx
===================================================================
RCS file: shell/source/backends/kdebe/kdeinetlayer.hxx
diff -N shell/source/backends/kdebe/kdeinetlayer.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdeinetlayer.hxx	11 Apr 2006 12:40:15 -0000	1.1.2.1
@@ -0,0 +1,81 @@
+#ifndef KDEINETLAYER_HXX_
+#define KDEINETLAYER_HXX_
+
+#ifndef KDEBACKEND_HXX_
+#include "kdebackend.hxx"
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
+#include <com/sun/star/uno/XComponentContext.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYER_HPP_
+#include <com/sun/star/configuration/backend/XLayer.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_BACKENDACCESSEXCEPTION_HPP_
+#include <com/sun/star/configuration/backend/BackendAccessException.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYERCONTENTDESCIBER_HPP_
+#include <com/sun/star/configuration/backend/XLayerContentDescriber.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_UTIL_XTIMESTAMPED_HPP_
+#include <com/sun/star/util/XTimeStamped.hpp>
+#endif
+
+#ifndef _CPPUHELPER_IMPLBASE2_HXX_
+#include <cppuhelper/implbase2.hxx>
+#endif
+
+#ifndef QSTRING_H
+#include <qstring.h>
+#endif
+
+namespace css = com::sun::star ;
+namespace uno = css::uno ;
+namespace lang = css::lang ;
+namespace backend = css::configuration::backend ;
+namespace util = css::util ;
+
+/**
+  Implementation of the XLayer interface for the KDE values mapped into
+  the org.openoffice.Inet configuration component.
+  */
+class KDEInetLayer : public cppu::WeakImplHelper2<backend::XLayer, util::XTimeStamped> 
+{
+public :
+    /**
+      Constructor given the component context
+
+      @param xContext       The component context
+    */
+
+    KDEInetLayer(const uno::Reference<uno::XComponentContext>& xContext);
+
+    // XLayer
+    virtual void SAL_CALL readData(
+        const uno::Reference<backend::XLayerHandler>& xHandler) 
+        throw ( backend::MalformedDataException,
+                lang::NullPointerException, 
+                lang::WrappedTargetException, 
+                uno::RuntimeException) ;
+    
+    // XTimeStamped
+    virtual rtl::OUString SAL_CALL getTimestamp(void) 
+        throw (uno::RuntimeException);
+
+    protected:
+
+    /** Destructor */
+    ~KDEInetLayer(void) {}
+              
+private :
+    uno::Reference<backend::XLayerContentDescriber> m_xLayerContentDescriber ;
+
+    void SAL_CALL setProxy
+        (uno::Sequence<backend::PropertyInfo> &aPropInfoList, sal_Int32 &nProperties,
+         int nProxyType, const QString &aNoProxyfor = QString(),
+         const QString &aHTTPProxy = QString(), const QString &aFTPProxy = QString()) const;
+  } ;
+
+#endif // KDEINETLAYER
Index: shell/source/backends/kdebe/kdevcllayer.cxx
===================================================================
RCS file: shell/source/backends/kdebe/kdevcllayer.cxx
diff -N shell/source/backends/kdebe/kdevcllayer.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdevcllayer.cxx	2 May 2006 13:55:45 -0000	1.1.2.4
@@ -0,0 +1,133 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#ifndef KDEVCLLAYER_HXX_
+#include "kdevcllayer.hxx"
+#endif 
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_PROPERTYINFO_HPP_
+#include <com/sun/star/configuration/backend/PropertyInfo.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYERCONTENTDESCIBER_HPP_
+#include <com/sun/star/configuration/backend/XLayerContentDescriber.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_SEQUENCE_HXX_
+#include <com/sun/star/uno/Sequence.hxx>
+#endif
+
+#ifndef QGLOBAL_H
+#include "qglobal.h"
+#endif
+#ifndef QACCESSIBLE_H
+#include "qaccessible.h"
+#endif
+
+//==============================================================================
+
+KDEVCLLayer::KDEVCLLayer(const uno::Reference<uno::XComponentContext>& xContext)
+{
+    //Create instance of LayerContentDescriber Service
+    rtl::OUString const k_sLayerDescriberService(RTL_CONSTASCII_USTRINGPARAM(
+        "com.sun.star.comp.configuration.backend.LayerDescriber"));
+
+    typedef uno::Reference<backend::XLayerContentDescriber> LayerDescriber; 
+    uno::Reference< lang::XMultiComponentFactory > xServiceManager = xContext->getServiceManager();
+    if( xServiceManager.is() )
+    {
+        m_xLayerContentDescriber = LayerDescriber::query(
+            xServiceManager->createInstanceWithContext(k_sLayerDescriberService, xContext));
+    }
+    else
+    {
+        OSL_TRACE("Could not retrieve ServiceManager");
+    }
+}
+
+//------------------------------------------------------------------------------
+
+void SAL_CALL KDEVCLLayer::readData( const uno::Reference<backend::XLayerHandler>& xHandler) 
+    throw ( backend::MalformedDataException, lang::NullPointerException, 
+            lang::WrappedTargetException, uno::RuntimeException)
+{
+    if( ! m_xLayerContentDescriber.is() )
+    {
+        throw uno::RuntimeException( rtl::OUString( RTL_CONSTASCII_USTRINGPARAM(
+            "Could not create com.sun.star.configuration.backend.LayerContentDescriber Service"
+        ) ), static_cast < backend::XLayer * > (this) );
+    }
+    
+    uno::Sequence<backend::PropertyInfo> aPropInfoList(1);
+
+/*
+   Commenting out, does not make much sense without an accessibility bridge
+===========================================================================
+#if defined(QT_ACCESSIBILITY_SUPPORT)
+// Accessibility tools under Qt for UNIX are available starting with Qt 4.0
+    int nVersionMajor = 0;
+    const char *q = qVersion();     // "3.1.0" for example
+    while ('0' <= *q && *q <= '9')
+        nVersionMajor = nVersionMajor * 10 + *q++ - '0';
+    sal_Bool ATToolSupport = (sal_Bool) (nVersionMajor >= 4);
+#else
+    sal_Bool ATToolSupport = sal_False;
+#endif
+===========================================================================
+   End of commented out section
+*/  sal_Bool ATToolSupport = sal_False;
+
+    aPropInfoList[0].Name = rtl::OUString(
+        RTL_CONSTASCII_USTRINGPARAM( "org.openoffice.VCL/Settings/Accessibility/EnableATToolSupport") );
+    aPropInfoList[0].Type = rtl::OUString( 
+        RTL_CONSTASCII_USTRINGPARAM( "string" ) );
+    aPropInfoList[0].Protected = sal_False;
+    aPropInfoList[0].Value = uno::makeAny( rtl::OUString::valueOf( ATToolSupport ) );
+
+    m_xLayerContentDescriber->describeLayer(xHandler, aPropInfoList);
+}
+
+//------------------------------------------------------------------------------
+
+rtl::OUString SAL_CALL KDEVCLLayer::getTimestamp(void) 
+    throw (uno::RuntimeException)
+{
+    // Return the value as timestamp to avoid regenerating the binary cache
+    // on each office launch.
+
+    ::rtl::OUString sTimeStamp(
+                RTL_CONSTASCII_USTRINGPARAM( "FALSE" ) );
+
+    return sTimeStamp;
+}
Index: shell/source/backends/kdebe/kdevcllayer.hxx
===================================================================
RCS file: shell/source/backends/kdebe/kdevcllayer.hxx
diff -N shell/source/backends/kdebe/kdevcllayer.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/kdevcllayer.hxx	11 Apr 2006 12:40:16 -0000	1.1.2.1
@@ -0,0 +1,72 @@
+#ifndef KDEVCLLAYER_HXX_
+#define KDEVCLLAYER_HXX_
+
+#ifndef KDEBACKEND_HXX_
+#include "kdebackend.hxx"
+#endif
+
+#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
+#include <com/sun/star/uno/XComponentContext.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYER_HPP_
+#include <com/sun/star/configuration/backend/XLayer.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_BACKENDACCESSEXCEPTION_HPP_
+#include <com/sun/star/configuration/backend/BackendAccessException.hpp>
+#endif
+#ifndef _COM_SUN_STAR_CONFIGURATION_BACKEND_XLAYERCONTENTDESCIBER_HPP_
+#include <com/sun/star/configuration/backend/XLayerContentDescriber.hpp>
+#endif
+
+#ifndef _COM_SUN_STAR_UTIL_XTIMESTAMPED_HPP_
+#include <com/sun/star/util/XTimeStamped.hpp>
+#endif
+
+#ifndef _CPPUHELPER_IMPLBASE2_HXX_
+#include <cppuhelper/implbase2.hxx>
+#endif
+
+namespace css = com::sun::star ;
+namespace uno = css::uno ;
+namespace lang = css::lang ;
+namespace backend = css::configuration::backend ;
+namespace util = css::util ;
+
+/**
+  Implementation of the XLayer interface for the KDE values mapped into
+  the org.openoffice.VCL configuration component.
+  */
+class KDEVCLLayer : public cppu::WeakImplHelper2<backend::XLayer, util::XTimeStamped> 
+{
+public :
+    /**
+      Constructor given the component context
+
+      @param xContext       The component context
+    */
+    
+    KDEVCLLayer(const uno::Reference<uno::XComponentContext>& xContext);
+
+    // XLayer
+    virtual void SAL_CALL readData(
+        const uno::Reference<backend::XLayerHandler>& xHandler) 
+        throw ( backend::MalformedDataException,
+            lang::NullPointerException, 
+            lang::WrappedTargetException, 
+            uno::RuntimeException) ;
+
+    // XTimeStamped
+    virtual rtl::OUString SAL_CALL getTimestamp(void) 
+        throw (uno::RuntimeException);
+
+    protected:
+
+    /** Destructor */
+    ~KDEVCLLayer(void) {}
+              
+    private :
+        uno::Reference<backend::XLayerContentDescriber> m_xLayerContentDescriber ;
+  } ;
+
+#endif // KDEVCLLAYER
Index: shell/source/backends/kdebe/makefile.mk
===================================================================
RCS file: shell/source/backends/kdebe/makefile.mk
diff -N shell/source/backends/kdebe/makefile.mk
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ shell/source/backends/kdebe/makefile.mk	11 Apr 2006 12:40:16 -0000	1.1.2.1
@@ -0,0 +1,90 @@
+#*************************************************************************
+#
+#   OpenOffice.org - a multi-platform office productivity suite
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to
+#   the terms of GNU Lesser General Public License Version 2.1.
+#
+#
+#     GNU Lesser General Public License Version 2.1
+#     =============================================
+#     Copyright 2005 by Sun Microsystems, Inc.
+#     901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License version 2.1, as published by the Free Software Foundation.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#     MA  02111-1307  USA
+#
+#*************************************************************************
+PRJ=..$/..$/..
+
+PRJNAME=shell
+TARGET=kdebe
+
+LIBTARGET=NO
+ENABLE_EXCEPTIONS=TRUE
+
+COMP1TYPELIST=$(TARGET)
+COMPRDB=$(SOLARBINDIR)$/types.rdb
+UNOUCROUT=$(OUT)$/inc$/$(TARGET)
+INCPRE=$(UNOUCROUT)
+
+# --- Settings ---
+
+.INCLUDE : settings.mk
+
+UNIXTEXT=$(MISC)/$(TARGET)1-ucd.txt
+
+# no "lib" prefix
+DLLPRE =
+
+.IF "$(ENABLE_KDE)" == "TRUE"
+
+CFLAGS+=$(KDE_CFLAGS)
+
+# --- Files ---
+
+SLOFILES=\
+	$(SLO)$/kdebackend.obj \
+	$(SLO)$/kdecommonlayer.obj \
+	$(SLO)$/kdeinetlayer.obj \
+	$(SLO)$/kdevcllayer.obj \
+	$(SLO)$/kdebecdef.obj
+
+SHL1NOCHECK=TRUE
+SHL1TARGET=$(TARGET)1.uno   
+SHL1OBJS=$(SLOFILES)
+SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+
+SHL1IMPLIB=i$(SHL1TARGET)
+SHL1STDLIBS=    \
+        $(CPPUHELPERLIB) \
+        $(CPPULIB) \
+        $(SALLIB) \
+        $(KDE_LIBS) -lkio
+        
+SHL1VERSIONMAP=exports.map
+SHL1DEF=$(MISC)$/$(SHL1TARGET).def
+DEF1NAME=$(SHL1TARGET)
+
+.ENDIF          # "$(ENABLE_KDE)" == "TRUE"
+
+# --- Targets ---
+
+.INCLUDE : target.mk
Index: instsetoo_native/inc_openoffice/unix/packagelist.txt
===================================================================
RCS file: /cvs/installation/instsetoo_native/inc_openoffice/unix/packagelist.txt,v
retrieving revision 1.23
retrieving revision 1.23.34.1
diff -u -p -u -p -r1.23 -r1.23.34.1
--- instsetoo_native/inc_openoffice/unix/packagelist.txt	31 Jan 2006 18:27:57 -0000	1.23
+++ instsetoo_native/inc_openoffice/unix/packagelist.txt	11 Apr 2006 12:34:30 -0000	1.23.34.1
@@ -32,6 +32,20 @@ destpath = "/opt/%UNIXPRODUCTNAME%PRODUC
 End
 
 Start
+module = "gid_Module_Optional_Kde"
+solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME-kde-integration"
+solarisrequires = "%WITHOUTDOTUNIXPRODUCTNAME-core01"
+packagename = "%UNIXPRODUCTNAME-kde-integration"
+linuxreplaces = "%WITHOUTDOTUNIXPRODUCTNAME-kde-integration"
+freebsdrequires = "%UNIXPRODUCTNAME-core01"
+requires = "%UNIXPRODUCTNAME-core01"
+copyright = "1999-2006 by OpenOffice.org"
+vendor = "OpenOffice.org"
+description = "KDE integration module for %PRODUCTNAME %PRODUCTVERSION"
+destpath = "/opt/%UNIXPRODUCTNAME%PRODUCTVERSION"
+End
+
+Start
 module = "gid_Module_Root"
 solarispackagename = "%WITHOUTDOTUNIXPRODUCTNAME-core01"
 solarisrequires = ""
Index: scp2/prj/build.lst
===================================================================
RCS file: /cvs/installation/scp2/prj/build.lst,v
retrieving revision 1.19
retrieving revision 1.19.218.1
diff -u -p -u -p -r1.19 -r1.19.218.1
--- scp2/prj/build.lst	9 Nov 2005 09:38:56 -0000	1.19
+++ scp2/prj/build.lst	11 Apr 2006 12:34:30 -0000	1.19.218.1
@@ -10,6 +10,7 @@ cp    scp2\source\gnome           nmake 
 cp    scp2\source\graphicfilter   nmake    -    all    cp_graphicfilter cp_langmacros NULL
 cp    scp2\source\impress         nmake    -    all    cp_impress cp_langmacros NULL
 cp    scp2\source\javafilter      nmake    -    all    cp_javafilter cp_langmacros NULL
+cp    scp2\source\kde             nmake    -    all    cp_kde cp_langmacros NULL
 cp    scp2\source\lingu           nmake    -    all    cp_lingu cp_langmacros NULL
 cp    scp2\source\math            nmake    -    all    cp_math cp_langmacros NULL
 cp    scp2\source\ooo             nmake    -    all    cp_ooo cp_langmacros NULL
@@ -22,4 +23,4 @@ cp    scp2\source\base            nmake 
 cp    scp2\source\xsltfilter      nmake    -    all    cp_xsltfilter cp_langmacros NULL
 cp    scp2\source\winexplorerext  nmake    -    all    cp_winexplorerext cp_langmacros NULL
 cp    scp2\source\ure             nmake    -    all    cp_ure cp_langmacros NULL
-cp    scp2\util                   nmake    -    all    cp_util cp_activex cp_calc cp_canvas cp_crashrep cp_draw cp_gnome cp_graphicfilter cp_impress cp_javafilter cp_lingu cp_math cp_ooo cp_python cp_quickstart cp_testtool cp_writer cp_base cp_xsltfilter cp_winexplorerext cp_ure cp_sdkoo NULL
+cp    scp2\util                   nmake    -    all    cp_util cp_activex cp_calc cp_canvas cp_crashrep cp_draw cp_gnome cp_graphicfilter cp_impress cp_javafilter cp_kde cp_lingu cp_math cp_ooo cp_python cp_quickstart cp_testtool cp_writer cp_base cp_xsltfilter cp_winexplorerext cp_ure cp_sdkoo NULL
Index: scp2/source/kde/file_kde.scp
===================================================================
RCS file: scp2/source/kde/file_kde.scp
diff -N scp2/source/kde/file_kde.scp
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ scp2/source/kde/file_kde.scp	11 Apr 2006 12:49:56 -0000	1.2.2.1
@@ -0,0 +1,45 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#include "macros.inc"
+
+File gid_File_Lib_Kdebe
+    TXT_FILE_BODY;
+    Styles = (PACKED);
+    Dir = gid_Dir_Program;
+    Name = STRING(CONCAT2(kdebe1.uno,UNXSUFFIX));
+    RegistryID = gid_Starregistry_Services_Rdb;
+    Regmergefile = "kdebe1-ucd.txt";
+End
+
Index: scp2/source/kde/localize.sdf
===================================================================
RCS file: scp2/source/kde/localize.sdf
diff -N scp2/source/kde/localize.sdf
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ scp2/source/kde/localize.sdf	11 Apr 2006 12:49:56 -0000	1.7.2.1
@@ -0,0 +1,103 @@
+#
+#    ####    ###     #   #   ###   #####    #####  ####   #####  #####  
+#    #   #  #   #    ##  #  #   #    #      #      #   #    #      #    
+#    #   #  #   #    # # #  #   #    #      ###    #   #    #      #    
+#    #   #  #   #    #  ##  #   #    #      #      #   #    #      #    
+#    ####    ###     #   #   ###     #      #####  ####   #####    #    
+#
+#    DO NOT EDIT! This file will be overwritten by localisation process
+#
+#*************************************************************************
+#
+#   OpenOffice.org - a multi-platform office productivity suite
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to
+#   the terms of GNU Lesser General Public License Version 2.1.
+#
+#
+#     GNU Lesser General Public License Version 2.1
+#     =============================================
+#     Copyright 2005 by Sun Microsystems, Inc.
+#     901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License version 2.1, as published by the Free Software Foundation.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#     MA  02111-1307  USA
+#
+#*************************************************************************
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	cs	Tento modul umožňuje integraci %PRODUCTNAME %PRODUCTVERSION do pracovního prostředí KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	es	Este módulo permite la integración de %PRODUCTNAME %PRODUCTVERSION en el entorno de escritorio de KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	fr	Ce module se charge de l'intégration de %PRODUCTNAME %PRODUCTVERSION dans l'environnement de bureau KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	hu	Ez a modul lehetővé teszi a %PRODUCTNAME %PRODUCTVERSION együttműködését a KDE grafikus munkakörnyezettel.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	it	Questo modulo permette di integrare %PRODUCTNAME %PRODUCTVERSION nel Desktop Environment di KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	ja	このモジュールは %PRODUCTNAME %PRODUCTVERSION を KDE Desktop Environment に統合します。				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	ko	이 모듈은 %PRODUCTNAME %PRODUCTVERSION을(를) KDE Desktop Environment로 통합시킵니다.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	nl	Deze module zorgt voor de integratie van %PRODUCTNAME %PRODUCTVERSION in het KDE DesktopEnvironment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	pt-BR	Este módulo se encarrega da integração do %PRODUCTNAME %PRODUCTVERSION no desktop KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	sk	Tento modul umožňuje integráciu %PRODUCTNAME %PRODUCTVERSION do KDE Desktop Environment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	sv	Den här modulen ser till att %PRODUCTNAME %PRODUCTVERSION integreras i skrivbordsmiljön KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	tr	Bu modül KDE masaüstü dağıtımı %PRODUCTNAME %PRODUCTVERSION uyumu sağlar.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	zh-CN	这个模块将 %PRODUCTNAME %PRODUCTVERSION 整合到 SOLARIS 的 KDE 操作界面内。				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	zh-TW	這個模組將 %PRODUCTNAME %PRODUCTVERSION 整合到 KDE 操作界面。				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	cs	Integrace do KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	da	KDE integration				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	es	Integración KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	fr	Intégration KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	hu	KDE-környezet				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	it	Integrazione KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	ja	KDE 統合				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	ko	KDE 통합				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	nl	KDE integratie				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	pt-BR	Integração KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	sk	Integrácia do KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	sv	KDE-integration				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	tr	KDE Entegrasyonu				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	zh-CN	KDE 整合				2002-02-02 02:02:02
+scp2	source\kde\module_kde.lng	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	zh-TW	KDE 整合				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	cs	Tento modul umožňuje integraci %PRODUCTNAME %PRODUCTVERSION do pracovního prostředí KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	es	Integración del sistema de %PRODUCTNAME %PRODUCTVERSION con KDE Desktop Environment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	fr	Intégration système de %PRODUCTNAME %PRODUCTVERSION dans l'environnement de bureau KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	hu	Ez a modul lehetővé teszi a %PRODUCTNAME %PRODUCTVERSION együttműködését a KDE grafikus munkakörnyezettel.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	it	Integrazione di %PRODUCTNAME %PRODUCTVERSION nel KDE Desktop Environment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	ja	KDE Desktop Environment への %PRODUCTNAME %PRODUCTVERSION のシステム統合。				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	km	ការ​រួមបញ្ចូល​ប្រព័ន្ធ​នៃ %PRODUCTNAME %PRODUCTVERSION ទៅ​ក្នុង KDE Desktop Environment ។				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	ko	KDE 데스크톱 환경에 %PRODUCTNAME %PRODUCTVERSION 시스템 통합				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	nl	Systeemintegratie van %PRODUCTNAME %PRODUCTVERSION in het KDE DesktopEnvironment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	pt-BR	Integração do sistema do %PRODUCTNAME %PRODUCTVERSION ao KDE Desktop Environment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	sk	Tento modul umožňuje integráciu %PRODUCTNAME %PRODUCTVERSION do KDE Desktop Environment.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	sv	Systemintegration av %PRODUCTNAME %PRODUCTVERSION i skrivbordsmiljön KDE.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	tr	Bu modül KDE masaüstü dağıtımı %PRODUCTNAME %PRODUCTVERSION uyumu sağlar.				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	zh-CN	将 %PRODUCTNAME %PRODUCTVERSION 系统集成到 KDE 桌面环境。				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_DESC_MODULE_OPTIONAL_KDE				0	zh-TW	%PRODUCTNAME %PRODUCTVERSION 與 KDE 桌面環境的系統整合。				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	cs	Integrace do KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	da	KDE integration				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	es	Integración KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	fr	Intégration KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	hu	KDE-környezet				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	it	Integrazione KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	ja	KDE 統合				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	km	ការ​រួមបញ្ចូល KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	ko	KDE 통합				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	nl	KDE-integratie				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	pt-BR	Integração KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	sk	Integrácia do KDE				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	sv	KDE-integration				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	tr	KDE Entegrasyonu				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	zh-CN	KDE 整合				2002-02-02 02:02:02
+scp2	source\kde\module_kde.ulf	0	LngText	STR_NAME_MODULE_OPTIONAL_KDE				0	zh-TW	KDE 整合				2002-02-02 02:02:02
Index: scp2/source/kde/makefile.mk
===================================================================
RCS file: scp2/source/kde/makefile.mk
diff -N scp2/source/kde/makefile.mk
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ scp2/source/kde/makefile.mk	11 Apr 2006 12:49:56 -0000	1.3.2.1
@@ -0,0 +1,58 @@
+#*************************************************************************
+#
+#   OpenOffice.org - a multi-platform office productivity suite
+#
+#   $RCSfile$
+#
+#   $Revision$
+#
+#   last change: $Author$ $Date$
+#
+#   The Contents of this file are made available subject to
+#   the terms of GNU Lesser General Public License Version 2.1.
+#
+#
+#     GNU Lesser General Public License Version 2.1
+#     =============================================
+#     Copyright 2005 by Sun Microsystems, Inc.
+#     901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#     This library is free software; you can redistribute it and/or
+#     modify it under the terms of the GNU Lesser General Public
+#     License version 2.1, as published by the Free Software Foundation.
+#
+#     This library is distributed in the hope that it will be useful,
+#     but WITHOUT ANY WARRANTY; without even the implied warranty of
+#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#     Lesser General Public License for more details.
+#
+#     You should have received a copy of the GNU Lesser General Public
+#     License along with this library; if not, write to the Free Software
+#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#     MA  02111-1307  USA
+#
+#*************************************************************************
+
+PRJ=..$/..
+
+PRJPCH=
+
+PRJNAME=scp2
+TARGET=kde
+TARGETTYPE=CUI
+
+# --- Settings -----------------------------------------------------
+
+.INCLUDE :  settings.mk
+
+SCP_PRODUCT_TYPE=osl
+
+.IF "$(ENABLE_KDE)" == "TRUE"
+PARFILES =                   \
+        module_kde.par     \
+        file_kde.par
+.ENDIF
+
+# --- File ---------------------------------------------------------
+
+.INCLUDE :  target.mk
Index: scp2/source/kde/module_kde.scp
===================================================================
RCS file: scp2/source/kde/module_kde.scp
diff -N scp2/source/kde/module_kde.scp
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ scp2/source/kde/module_kde.scp	11 Apr 2006 12:49:56 -0000	1.2.2.1
@@ -0,0 +1,46 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#include "macros.inc"
+
+Module gid_Module_Optional_Kde
+    ParentID = gid_Module_Optional;
+    Default = YES;
+	Name = "gid_Module_Optional_Kde";
+	Description = "gid_Module_Optional_Kde";
+    Files = (gid_File_Lib_Kdebe);
+    Dirs = ();
+End
+
Index: scp2/util/makefile.mk
===================================================================
RCS file: /cvs/installation/scp2/util/makefile.mk,v
retrieving revision 1.32
retrieving revision 1.32.52.1
diff -u -p -u -p -r1.32 -r1.32.52.1
--- scp2/util/makefile.mk	9 Mar 2006 14:09:29 -0000	1.32
+++ scp2/util/makefile.mk	11 Apr 2006 12:34:30 -0000	1.32.52.1
@@ -142,6 +142,12 @@ SCP1FILES += \
              module_gnome.par   \
              file_gnome.par
 .ENDIF
+
+.IF "$(ENABLE_KDE)" == "TRUE"
+SCP1FILES += \
+             module_kde.par     \
+             file_kde.par
+.ENDIF
 .ENDIF
 
 .IF "$(ENABLE_CRASHDUMP)" != ""
@@ -253,6 +259,12 @@ SCP2FILES +=                           \
 SCP2FILES += \
              module_gnome.par   \
              file_gnome.par
+.ENDIF
+
+.IF "$(ENABLE_KDE)" == "TRUE"
+SCP2FILES += \
+             module_kde.par     \
+             file_kde.par
 .ENDIF
 .ENDIF
 
