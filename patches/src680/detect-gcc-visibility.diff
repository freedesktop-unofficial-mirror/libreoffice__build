--- config_office/set_soenv.in.ark	2005-01-28 00:35:41.000000000 +0100
+++ config_office/set_soenv.in	2005-01-28 00:36:12.000000000 +0100
@@ -1437,6 +1437,7 @@
 ToFile( "PROFULLSWITCH",     "@PROFULLSWITCH@",  "e" );
 ToFile( "PROEXT",            $PROEXT,            "e" );
 ToFile( "BUILD_VER_STRING",  "@BUILD_VER_STRING@", "e" );
+ToFile( "HAVE_GCC_VISIBILITY_FEATURE", "@HAVE_GCC_VISIBILITY_FEATURE@", "e");
 ToFile( "ENABLE_GTK",        "@ENABLE_GTK@",       "e" );
 ToFile( "GTK_CFLAGS",        "@GTK_CFLAGS@",       "e" );
 ToFile( "GTK_LIBS",          "@GTK_LIBS@",         "e" );
--- config_office/configure.in.ark	2005-01-28 00:36:16.000000000 +0100
+++ config_office/configure.in	2005-01-28 00:41:55.000000000 +0100
@@ -832,7 +832,18 @@
       fi
       AC_MSG_RESULT([ok (GNU ld)])
    fi
+   AC_MSG_CHECKING([for gcc visibility feature])
+   AC_LANG_SAVE
+   AC_LANG_CPLUSPLUS
+   save_CXXFLAGS="$CXXFLAGS"
+   CXXFLAGS="$CXXFLAGS -fvisibility=hidden"
+   AC_COMPILE_IFELSE([int main(int, char**) { }],
+      [HAVE_GCC_VISIBILITY_FEATURE=TRUE; result=yes], [result=no])
+   CXXFLAGS="$save_CXXFLAGS"
+   AC_MSG_RESULT([$result])
+   AC_LANG_RESTORE
 fi  
+AC_SUBST(HAVE_GCC_VISIBILITY_FEATURE)
 
 dnl ===================================================================
 dnl Search all the common names for GNU make
