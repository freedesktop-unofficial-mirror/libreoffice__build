--- config_office/set_soenv.in.ark	2005-01-28 00:35:41.000000000 +0100
+++ config_office/set_soenv.in	2005-01-28 00:36:12.000000000 +0100
@@ -1437,6 +1437,7 @@
 ToFile( "PROFULLSWITCH",     "@PROFULLSWITCH@",  "e" );
 ToFile( "PROEXT",            $PROEXT,            "e" );
 ToFile( "BUILD_VER_STRING",  "@BUILD_VER_STRING@", "e" );
+ToFile( "HAVE_GCC_VISIBILITY_FEATURE", "@HAVE_GCC_VISIBILITY_FEATURE@", "e");
 ToFile( "ENABLE_GTK",        "@ENABLE_GTK@",       "e" );
 ToFile( "GTK_CFLAGS",        "@GTK_CFLAGS@",       "e" );
 ToFile( "GTK_LIBS",          "@GTK_LIBS@",         "e" );
--- config_office/configure.in.ark	2005-01-28 00:36:16.000000000 +0100
+++ config_office/configure.in	2005-01-28 00:41:55.000000000 +0100
@@ -832,7 +832,22 @@
       fi
       AC_MSG_RESULT([ok (GNU ld)])
    fi
 fi  
+AC_SUBST(HAVE_GCC_VISIBILITY_FEATURE)
+if test "$GCC" = "yes"; then
+   AC_MSG_CHECKING([whether $CC supports -fvisibility=hidden])
+   save_CFLAGS=$CFLAGS
+   CFLAGS="$CFLAGS -fvisibility=hidden"
+   AC_TRY_LINK([], [ return 0; ], [ HAVE_GCC_VISIBILITY_FEATURE=TRUE ], [])
+   CFLAGS=$save_CFLAGS
+   if test "$HAVE_GCC_VISIBILITY_FEATURE" = "TRUE"; then
+      AC_MSG_RESULT([yes])
+   else
+      AC_MSG_RESULT([no])
+   fi
+fi
+AC_SUBST(HAVE_GCC_VISIBILITY_FEATURE)
+
 
 dnl ===================================================================
 dnl Search all the common names for GNU make
