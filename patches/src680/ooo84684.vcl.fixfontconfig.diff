Index: inc/vcl/outfont.hxx
===================================================================
RCS file: /cvs/gsl/vcl/inc/vcl/outfont.hxx,v
retrieving revision 1.3
diff -u -r1.3 outfont.hxx
--- vcl/inc/vcl/outfont.hxx	12 Dec 2007 13:19:39 -0000	1.3
+++ vcl/inc/vcl/outfont.hxx	19 Dec 2007 10:55:40 -0000
@@ -237,6 +237,7 @@
     // find the device font
     ImplDevFontListData*    FindFontFamily( const String& rFontName ) const;
     ImplDevFontListData*    ImplFindByFont( ImplFontSelectData&, bool bPrinter, ImplDirectFontSubstitution* ) const;
+    void ImplChangeByFontSubstitute(ImplFontSelectData& aFontSelData) const;
     ImplDevFontListData*    ImplFindBySearchName( const String& ) const;
 
     // suggest fonts for glyph fallback
Index: source/gdi/outdev3.cxx
===================================================================
RCS file: /cvs/gsl/vcl/source/gdi/outdev3.cxx,v
retrieving revision 1.234
diff -u -r1.234 outdev3.cxx
--- vcl/source/gdi/outdev3.cxx	12 Dec 2007 13:20:52 -0000	1.234
+++ vcl/source/gdi/outdev3.cxx	19 Dec 2007 10:56:52 -0000
@@ -2916,6 +2916,7 @@
     if( !pEntry ) // no direct cache hit
     {
         // find the best matching logical font family and update font selector accordingly
+	pFontList->ImplChangeByFontSubstitute(aFontSelData);
         pFontFamily = pFontList->ImplFindByFont( aFontSelData, mbPrinter, pDevSpecific );
         DBG_ASSERT( (pFontFamily != NULL), "ImplFontCache::Get() No logical font found!" );
         if( pFontFamily )
@@ -2970,6 +2971,19 @@
 
 // -----------------------------------------------------------------------
 
+void ImplDevFontList::ImplChangeByFontSubstitute(ImplFontSelectData& aFontSelData) const
+{
+    if( mpPreMatchHook )
+    {
+        xub_StrLen nTokenPos = 0;
+        aFontSelData.maTargetName = GetNextFontToken( aFontSelData.maSearchName, nTokenPos );
+        if( mpPreMatchHook->FindFontSubstitute( aFontSelData ) )
+            aFontSelData.maName = aFontSelData.maSearchName;
+    }
+}
+
+// -----------------------------------------------------------------------
+
 ImplDevFontListData* ImplDevFontList::ImplFindByFont( ImplFontSelectData& rFSD,
     bool bPrinter, ImplDirectFontSubstitution* pDevSpecific ) const
 {
