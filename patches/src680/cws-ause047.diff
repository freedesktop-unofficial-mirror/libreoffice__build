Index: sysui/desktop/debian/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/debian/makefile.mk,v
retrieving revision 1.10
retrieving revision 1.10.4.1
diff -u -p -u -p -r1.10 -r1.10.4.1
--- sysui/desktop/debian/makefile.mk	13 Jan 2006 14:56:56 -0000	1.10
+++ sysui/desktop/debian/makefile.mk	27 Jan 2006 10:41:21 -0000	1.10.4.1
@@ -128,7 +128,7 @@ KDEICONLIST = \
 	locolor/{16x16 32x32}/apps/$(ICONPREFIX)-{$(LAUNCHERLIST)}.png \
 	locolor/{16x16 32x32}/mimetypes/$(ICONPREFIX)-{$(MIMEICONLIST)}.png
 
-.IF "$(DPKG)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/deb//)"
 
 PKGNAME=openoffice.org-$(TARGET)-menus
 DEBFILE=$(PKGDIR)/$(PKGNAME)_$(PKGVERSION)-$(PKGREV)_all.deb
@@ -157,7 +157,7 @@ ULFDIR = $(COMMONMISC)$/desktopshare
 
 .INCLUDE :  target.mk
 
-.IF "$(DPKG)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/deb//)"
 
 ALLTAR : $(DEBFILE) 
 
Index: sysui/desktop/freedesktop/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/freedesktop/makefile.mk,v
retrieving revision 1.7
retrieving revision 1.7.4.2
diff -u -p -u -p -r1.7 -r1.7.4.2
--- sysui/desktop/freedesktop/makefile.mk	13 Jan 2006 14:57:10 -0000	1.7
+++ sysui/desktop/freedesktop/makefile.mk	27 Jan 2006 10:41:22 -0000	1.7.4.2
@@ -49,7 +49,7 @@ TARGET=freedesktop
 
 # --- Files --------------------------------------------------------
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 PACKAGE_RPM = $(MISC)$/$(TARGET).rpmflag
 
@@ -59,7 +59,7 @@ PACKAGE_RPM = $(MISC)$/$(TARGET).rpmflag
 
 .INCLUDE :  target.mk
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 ALLTAR : $(PACKAGE_RPM)
 
@@ -68,6 +68,7 @@ ALLTAR : $(PACKAGE_RPM)
 $(PACKAGE_RPM) : $(MISC)$/redhat.rpmflag
 
 $(PACKAGE_RPM) : $(MISC)/$(TARGET)-menus.spec
+	@-$(MKDIRHIER) $(@:d)
 	-@$(RM) $(PKGDIR)$/openoffice.org-$(TARGET)-*.noarch.rpm $(BIN)/noarch/openoffice.org-$(TARGET)-*.noarch.rpm
 	@$(MKDIRHIER) $(MISC)$/$(TARGET)
 	@$(MKDIRHIER) $(MISC)$/$(TARGET)$/BUILD
Index: sysui/desktop/mandriva/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/mandriva/makefile.mk,v
retrieving revision 1.7
retrieving revision 1.7.4.2
diff -u -p -u -p -r1.7 -r1.7.4.2
--- sysui/desktop/mandriva/makefile.mk	13 Jan 2006 14:57:24 -0000	1.7
+++ sysui/desktop/mandriva/makefile.mk	27 Jan 2006 10:41:23 -0000	1.7.4.2
@@ -121,7 +121,7 @@ KDEICONLIST = \
 	locolor/{16x16 32x32}/apps/$(ICONPREFIX)-{$(LAUNCHERLIST)}.png \
 	locolor/{16x16 32x32}/mimetypes/$(ICONPREFIX)-{$(MIMEICONLIST)}.png
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 PKGNAME=$(shell sed -n -e 's/^Name: //p' $(TARGET)-menus.spec)
 RPMFILE=$(PKGDIR)$/$(PKGNAME)-$(PKGVERSION)-$(PKGREV).noarch.rpm
@@ -146,7 +146,7 @@ ULFDIR = $(COMMONMISC)$/desktopshare
 
 .INCLUDE :  target.mk
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 ALLTAR : $(RPMFILE) 
 
@@ -221,6 +221,7 @@ $(MISC)/$(TARGET)/etc/$(UNIXFILENAME) :
 # --- packaging ---------------------------------------------------
 	
 $(RPMFILE) : $(RPMDEPN) $(MISC)/$(TARGET)-menus.spec
+	@-$(MKDIRHIER) $(@:d)
 	-$(RM) $(@:d)$/$(PKGNAME)-*.noarch.rpm $(BIN)$/noarch$/$(PKGNAME)-*.noarch.rpm
 	@$(RPM) $(RPMMACROS) -bb $(MISC)/$(TARGET)-menus.spec \
 		--buildroot $(LAUNCHERDIR) \
Index: sysui/desktop/redhat/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/redhat/makefile.mk,v
retrieving revision 1.18
retrieving revision 1.18.4.2
diff -u -p -u -p -r1.18 -r1.18.4.2
--- sysui/desktop/redhat/makefile.mk	13 Jan 2006 14:57:38 -0000	1.18
+++ sysui/desktop/redhat/makefile.mk	27 Jan 2006 10:41:24 -0000	1.18.4.2
@@ -121,7 +121,7 @@ KDEICONLIST = \
 	locolor/{16x16 32x32}/apps/$(ICONPREFIX)-{$(LAUNCHERLIST)}.png \
 	locolor/{16x16 32x32}/mimetypes/$(ICONPREFIX)-{$(MIMEICONLIST)}.png
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 PKGNAME=$(shell sed -n -e 's/^Name: //p' $(TARGET)-menus.spec)
 RPMFILE=$(PKGDIR)/$(PKGNAME)-$(PKGVERSION)-$(PKGREV).noarch.rpm
@@ -148,7 +148,7 @@ ULFDIR = $(COMMONMISC)$/desktopshare
 
 .INCLUDE :  target.mk
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 ALLTAR : $(RPMFILE) 
 
@@ -227,6 +227,7 @@ $(MISC)/$(TARGET)/etc/$(UNIXFILENAME) :
 # --- packaging ---------------------------------------------------
 	
 $(RPMFILE) : $(RPMDEPN) $(MISC)/$(TARGET)-menus.spec
+	@-$(MKDIRHIER) $(@:d)
 	-$(RM) $(@:d)$/$(PKGNAME)-* $(BIN)$/noarch$/$(PKGNAME)-*
 	@$(RPM) -bb $(MISC)/$(TARGET)-menus.spec $(RPMMACROS) \
 		--buildroot $(LAUNCHERDIR) \
Index: sysui/desktop/share/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/share/makefile.mk,v
retrieving revision 1.10
retrieving revision 1.10.32.1
diff -u -p -u -p -r1.10 -r1.10.32.1
--- sysui/desktop/share/makefile.mk	5 Oct 2005 13:00:54 -0000	1.10
+++ sysui/desktop/share/makefile.mk	27 Jan 2006 10:41:25 -0000	1.10.32.1
@@ -66,7 +66,7 @@ LAUNCHERDEPN = ../menus/{$(LAUNCHERLIST)
 LAUNCHERFLAGFILE = $(COMMONMISC)/$(TARGET)/xdg.flag
 MIMEINFO = $(COMMONMISC)/$(TARGET)/openoffice.org.xml
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 SPECFILES = \
 	$(MISC)/redhat-menus.spec \
 	$(MISC)/suse-menus.spec \
@@ -109,7 +109,7 @@ $(MIMEINFO) : $(COMMONMISC)$/$(TARGET)$/
 	@$(PERL) create_mime_xml.pl $< > $(@).$(INPATH)
 	@mv -f $(@).$(INPATH) $@
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 $(SPECFILES) : add_specfile_triggers.sed symlink_triggers
 $(SPECFILES) : ../$$(@:b:s/-menus//)/$$(@:f)
 	@sed -f ../share/add_specfile_triggers.sed $< | tr -d "\015" >$@
Index: sysui/desktop/suse/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/suse/makefile.mk,v
retrieving revision 1.19
retrieving revision 1.19.4.2
diff -u -p -u -p -r1.19 -r1.19.4.2
--- sysui/desktop/suse/makefile.mk	13 Jan 2006 14:58:05 -0000	1.19
+++ sysui/desktop/suse/makefile.mk	27 Jan 2006 10:41:26 -0000	1.19.4.2
@@ -121,7 +121,7 @@ KDEICONLIST = \
 	locolor/{16x16 32x32}/apps/$(ICONPREFIX)-{$(LAUNCHERLIST)}.png \
 	locolor/{16x16 32x32}/mimetypes/$(ICONPREFIX)-{$(MIMEICONLIST)}.png
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 PKGNAME=$(shell sed -n -e 's/^Name: //p' $(TARGET)-menus.spec)
 RPMFILE=$(PKGDIR)/$(PKGNAME)-$(PKGVERSION)-$(PKGREV).noarch.rpm
@@ -147,7 +147,7 @@ ULFDIR = $(COMMONMISC)$/desktopshare
 
 .INCLUDE :  target.mk
 
-.IF "$(RPM)"!=""
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 
 ALLTAR : $(RPMFILE) 
 
@@ -226,6 +226,7 @@ $(MISC)/$(TARGET)/etc/$(UNIXFILENAME) :
 # --- packaging ---------------------------------------------------
 	
 $(RPMFILE) : $(RPMDEPN) $(MISC)/$(TARGET)-menus.spec
+	@-$(MKDIRHIER) $(@:d)
 	-$(RM) $(@:d)$/$(PKGNAME)-*.noarch.rpm $(BIN)$/noarch$/$(PKGNAME)-*.noarch.rpm 
 	@$(RPM) -bb $(MISC)/$(TARGET)-menus.spec $(RPMMACROS) \
 		--buildroot $(LAUNCHERDIR) \
Index: sysui/desktop/util/makefile.mk
===================================================================
RCS file: /cvs/gsl/sysui/desktop/util/makefile.mk,v
retrieving revision 1.11
retrieving revision 1.11.4.2
diff -u -p -u -p -r1.11 -r1.11.4.2
--- sysui/desktop/util/makefile.mk	13 Jan 2006 14:58:26 -0000	1.11
+++ sysui/desktop/util/makefile.mk	27 Jan 2006 10:41:29 -0000	1.11.4.2
@@ -81,12 +81,13 @@ PKGCONFIG_LIBS!:=-Wl,--export-dynamic $(
 
 .ENDIF          # "$(ENABLE_GNOMEVFS)"!=""
 
-.IF "$(OS)"!="SOLARIS"
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
 TARFILE=$(BIN)$/rpm$/openoffice.org-desktop-integration.tar.gz
-.IF "$(DPKG)" != ""
+.ENDIF
+
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/deb//)"
 TARFILE2=$(BIN)$/deb$/openoffice.org-desktop-integration.tar.gz
-.ENDIF  # "$(DPKG)" != ""
-.ENDIF  # "$(OS)"!="SOLARIS"
+.ENDIF
 
 # --- Files --------------------------------------------------------
 
@@ -113,17 +114,18 @@ $(SCRIPTS) : $$(@:f)
     +@cat $(@:f) | tr -d "\015" > $@
     +@chmod 555 $@
 
-.IF "$(OS)"!="SOLARIS"
+.IF "$(TARFILE)" != ""
 
 $(TARFILE) : $(PKGDIR)$/{$(shell ls $(PKGDIR))}
 	$(MKDIRHIER) $(@:d)
 	tar -C $(PKGDIR:d:d) -cf - $(PKGDIR:f)/ | gzip > $@
-.ENDIF
 
-.IF "$(DPKG)" != ""
+.ENDIF # "$(TARFILE)" != ""
+
+.IF "$(TARFILE2)" != ""
 
 $(TARFILE2) : $(shell ls $(PKGDIR)$/*.deb)
 	$(MKDIRHIER) $(@:d)
 	tar -C $(PKGDIR) -cf - {$(<:f)} | gzip > $@
 	
-.ENDIF # IF "$(DPKG)" != ""
+.ENDIF
Index: solenv/inc/packtools.mk
===================================================================
RCS file: /cvs/tools/solenv/inc/packtools.mk,v
retrieving revision 1.6
retrieving revision 1.6.8.2
diff -u -p -u -p -r1.6 -r1.6.8.2
--- solenv/inc/packtools.mk	13 Jan 2006 15:02:07 -0000	1.6
+++ solenv/inc/packtools.mk	25 Jan 2006 13:27:34 -0000	1.6.8.2
@@ -34,6 +34,18 @@
 #*************************************************************************
 
 .IF "$(GUI)"!="WNT"
-RPM*:=$(shell +-ls -l `which rpm` >& /dev/null && set i=`which rpm` && echo rpm`test -x $${{i}}build && echo build`)
+
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
+rpm_version:=$(shell +ls -l `which rpm` >& /dev/null && rpm --version)
+.IF "$(rpm_version)"=="$(rpm_version:s/version 3.//)"
+RPM*:=$(shell +test -x `which rpmbuild` && echo -n rpmbuild)
+.ELSE			# "$(rpm_version)"=="$(rpm_version:s/version 3.//)"
+RPM*:=$(shell +test -x `which rpm` && echo -n rpm)
+.ENDIF			# "$(rpm_version)"=="$(rpm_version:s/version 3.//)"
+.ENDIF			# "$(PKGFORMAT)"!="$(PKGFORMAT:s/rpm//)"
+
+.IF "$(PKGFORMAT)"!="$(PKGFORMAT:s/deb//)"
 DPKG*:=$(shell +-ls -l `which dpkg` >& /dev/null && echo dpkg)
+.ENDIF			# "$(PKGFORMAT)"!="$(PKGFORMAT:s/deb//)"
+
 .ENDIF
