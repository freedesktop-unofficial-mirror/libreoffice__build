--- config_office/configure.in.old	2007-11-02 03:25:07.000000000 -0500
+++ config_office/configure.in	2008-02-19 16:54:11.000000000 -0600
@@ -3521,7 +3521,9 @@
     AC_MSG_RESULT([external])
     SYSTEM_MOZILLA=YES
     AC_MSG_CHECKING([which Mozilla flavour to use])
-    if test -n "$with_system_mozilla" && test "$with_system_mozilla" = "xulrunner"; then
+    if test -n "$with_system_mozilla" && test "$with_system_mozilla" = "libxul"; then
+      MOZ_FLAVOUR=libxul
+    elif test -n "$with_system_mozilla" && test "$with_system_mozilla" = "xulrunner"; then
       MOZ_FLAVOUR=xulrunner
     elif test -n "$with_system_mozilla" && test "$with_system_mozilla" = "seamonkey"; then
       MOZ_FLAVOUR=seamonkey
@@ -3535,8 +3537,6 @@
     tmp=`echo $MOZ_FLAVOUR | $PERL -e 'print ucfirst(<STDIN>);'`
     AC_MSG_RESULT($tmp)
 
-    PKG_CHECK_MODULES( MOZILLAXPCOM, $MOZ_FLAVOUR-xpcom )
-
     if $PKG_CONFIG --exists nspr ; then
       PKG_CHECK_MODULES( MOZ_NSPR, nspr )
       NSPR_LIB="-L`$PKG_CONFIG --variable=libdir nspr`"
@@ -3566,9 +3566,20 @@
     CPPFLAGS="$save_CPPFLAGS"
     LIBS="$save_LIBS"
 
-    MOZ_INC=`$PKG_CONFIG --variable=includedir $MOZ_FLAVOUR-xpcom`
-    MOZ_LIB=`$PKG_CONFIG --variable=libdir $MOZ_FLAVOUR-xpcom`
-    MOZ_LIB_XPCOM=$MOZILLAXPCOM_LIBS
+    if $PKG_CONFIG --exists $MOZ_FLAVOUR-xpcom ; then
+      PKG_CHECK_MODULES( MOZILLAXPCOM, $MOZ_FLAVOUR-xpcom )
+      MOZ_INC=`$PKG_CONFIG --variable=includedir $MOZ_FLAVOUR-xpcom`
+      MOZ_LIB=`$PKG_CONFIG --variable=libdir $MOZ_FLAVOUR-xpcom`
+      MOZ_LIB_XPCOM=$MOZILLAXPCOM_LIBS
+    elif $PKG_CONFIG --exists $MOZ_FLAVOUR-embedding ; then
+      PKG_CHECK_MODULES( MOZILLAXPCOM, $MOZ_FLAVOUR-embedding )
+      MOZ_INC=`$PKG_CONFIG --variable=includedir $MOZ_FLAVOUR-embedding`/unstable
+      MOZ_LIB=`$PKG_CONFIG --variable=sdkdir $MOZ_FLAVOUR-embedding`/lib
+      MOZ_LIB_XPCOM=$MOZILLAXPCOM_LIBS
+    else
+      AC_MSG_ERROR([Could not find xpcom.])
+    fi
+
     if test "$WITH_LDAP" != "NO" && test "$WITH_OPENLDAP" != "YES"; then
       AC_MSG_CHECKING([whether $tmp was compiled with --enable-ldap])
       if test -d "$MOZ_INC/ldap"; then
--- extensions/source/plugin/util/makefile.pmk.old	2007-02-06 06:59:38.000000000 -0600
+++ extensions/source/plugin/util/makefile.pmk	2008-02-20 08:31:33.000000000 -0600
@@ -39,6 +39,6 @@
 
 .IF "$(SYSTEM_MOZILLA)" == "YES"
 CFLAGS+=-DSYSTEM_MOZILLA
-PKGCONFIG_MODULES=$(MOZ_FLAVOUR)-plugin
+PKGCONFIG_MODULES=mozilla-plugin
 .INCLUDE : pkg_config.mk
 .ENDIF
