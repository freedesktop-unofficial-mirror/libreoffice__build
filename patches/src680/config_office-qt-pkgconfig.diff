--- config_office/configure.in	2005-03-29 16:32:49.479131000 +0200
+++ config_office/configure.in	2005-03-30 13:54:31.959814570 +0200
@@ -3060,14 +3060,19 @@ dnl ====================================
 
 KDE_CFLAGS=""
 KDE_LIBS=""
+MOC="moc"
 if test "$test_kde" = "yes" -a "$ENABLE_KDE" = "TRUE" ; then
-    dnl Search paths for Qt and KDE
-    qt_incdirs="$QTINC /usr/local/qt/include /usr/include/qt /usr/include /usr/X11R6/include/X11/qt /usr/X11R6/include/qt /usr/lib/qt3/include /usr/lib/qt/include /usr/share/qt3/include $x_includes"
-    qt_libdirs="$QTLIB /usr/local/qt/lib /usr/lib/qt /usr/include /usr/X11R6/lib/X11/qt /usr/X11R6/lib/qt /usr/lib/qt3/lib /usr/lib/qt/lib /usr/share/qt3/lib $x_includes"
-    if test -n "$QTDIR" ; then
-        qt_incdirs="$QTDIR/include $qt_incdirs"
-        qt_libdirs="$QTDIR/lib $qt_libdirs"
+    dnl Search paths for Qt
+    PKG_CHECK_MODULES( QT, qt-mt >= 3.0 )
+
+    AC_PATH_PROG( MOC, moc, no,
+        [`$PKG_CONFIG --variable=exec_prefix qt-mt`/bin:$QTDIR/bin:$PATH] )
+    if test "$MOC" = "no" ; then
+        AC_MSG_ERROR([Qt Meta Object Compiler not found.  Please specify
+the root of your Qt installation by exporting QTDIR before running "configure".])
     fi
+
+    dnl Search paths for KDE
     kde_incdirs="/usr/lib/kde/include /usr/local/kde/include /usr/local/include /usr/kde/include /usr/include/kde /usr/include /opt/kde3/include /opt/kde/include $x_includes"
     kde_libdirs="/usr/lib/kde/lib /usr/local/kde/lib /usr/kde/lib /usr/lib/kde /usr/lib/kde3 /usr/lib /usr/X11R6/lib /usr/local/lib /opt/kde3/lib /opt/kde/lib /usr/X11R6/kde/lib"
     if test -n "$KDEDIR" ; then
@@ -3076,41 +3081,9 @@ if test "$test_kde" = "yes" -a "$ENABLE_
     fi
 
     dnl What to test
-    qt_test_include="qstyle.h"
-    qt_test_library="libqt-mt.so"
     kde_test_include="ksharedptr.h"
     kde_test_library="libkdeui.la"
 
-    dnl Check for Qt headers
-    AC_MSG_CHECKING([for Qt headers])
-    qt_incdir="no"
-    for kde_check in $qt_incdirs ; do
-        if test -r "$kde_check/$qt_test_include" ; then
-            qt_incdir="$kde_check"
-            break
-        fi
-    done
-    AC_MSG_RESULT([$qt_incdir])
-    if test "x$qt_incdir" = "xno" ; then
-        AC_MSG_ERROR([Qt headers not found.  Please specify the root of
-your Qt installation by exporting QTDIR before running "configure".])
-    fi
-
-    dnl Check for Qt libraries
-    AC_MSG_CHECKING([for Qt libraries])
-    qt_libdir="no"
-    for qt_check in $qt_libdirs ; do
-        if test -r "$qt_check/$qt_test_library" ; then
-            qt_libdir="$qt_check"
-            break
-        fi
-    done
-    AC_MSG_RESULT([$qt_libdir])
-    if test "x$qt_libdir" = "xno" ; then
-        AC_MSG_ERROR([Qt libraries not found.  Please specify the root of
-your Qt installation by exporting QTDIR before running "configure".])
-    fi
-
     dnl Check for KDE headers
     AC_MSG_CHECKING([for KDE headers])
     kde_incdir="no"
@@ -3142,11 +3115,12 @@ your KDE installation by exporting KDEDI
     fi
 
     dnl Set the variables
-    KDE_CFLAGS="-I$qt_incdir -I$kde_incdir -DQT_CLEAN_NAMESPACE -DQT_NO_EMIT -DQT_THREAD_SUPPORT"
-    KDE_LIBS="-L$kde_libdir -L$qt_libdir -lkdeui -lkdecore -lqt-mt"
+    KDE_CFLAGS="$QT_CFLAGS -I$kde_incdir -DQT_CLEAN_NAMESPACE -DQT_NO_EMIT -DQT_THREAD_SUPPORT"
+    KDE_LIBS="$QT_LIBS -L$kde_libdir -lkdeui -lkdecore"
 fi
 AC_SUBST(KDE_CFLAGS)
 AC_SUBST(KDE_LIBS)
+AC_SUBST(MOC)
 
 dnl ===================================================================
 dnl Test for the presence of libstartup-notification
--- config_office/set_soenv.in	2005-03-29 16:32:49.484130000 +0200
+++ config_office/set_soenv.in	2005-03-30 13:53:30.931381015 +0200
@@ -1451,6 +1451,7 @@ ToFile( "ENABLE_GNOMEVFS",   "@ENABLE_GN
 ToFile( "ENABLE_KDE",        "@ENABLE_KDE@",       "e" );
 ToFile( "KDE_CFLAGS",        "@KDE_CFLAGS@",       "e" );
 ToFile( "KDE_LIBS",          "@KDE_LIBS@",         "e" );
+ToFile( "MOC",               "@MOC@",         "e" );
 ToFile( "CUSTOM_IMAGE_SETS", "@CUSTOM_IMAGE_SETS@","e" );
 ToFile( "PSPRINT",           "TRUE",             "e" );
 # [ed] 5/14/02 If we're building Aqua graphics, insert a C macro to indicate this.
