Index: source/xmlsec/nss/makefile.mk
===================================================================
RCS file: /cvs/xml/xmlsecurity/source/xmlsec/nss/makefile.mk,v
retrieving revision 1.2
diff -u -p -r1.2 makefile.mk
--- xmlsecurity/source/xmlsec/nss/makefile.mk	23 Jul 2004 03:00:41 -0000	1.2
+++ xmlsecurity/source/xmlsec/nss/makefile.mk	28 Oct 2004 08:43:05 -0000
@@ -80,7 +80,12 @@ LIBTARGET=NO
 
 .IF "$(CRYPTO_ENGINE)" == "nss"
 
+.IF "$(SYSTEM_MOZILLA)" == "YES"
+CFLAGS+=-DSYSTEM_MOZILLA
+.ELSE
 MOZ_INC = $(SOLARVERSION)$/$(INPATH)$/inc$(UPDMINOREXT)$/mozilla
+.ENDIF
+
 NSS_INC = $(MOZ_INC)$/nss
 NSPR_INC = $(MOZ_INC)$/nspr
 
@@ -152,6 +156,93 @@ SLOFILES = \
 	$(SLO)$/seinitializer_nssimpl.obj \
 	$(SLO)$/xsec_nss.obj
 
+.IF "$(SYSTEM_MOZILLA)" == "YES" && "$(MOZ_NSS_HACK)" == "YES"
+SOLARINC += -I$(MOZ_INC)$/dbm
+CDEFS += -DNSS_3_4_CODE
+SLOFILES += \
+	$(SLO)$/alg1485.obj \
+	$(SLO)$/arena.obj \
+	$(SLO)$/asymmkey.obj \
+	$(SLO)$/certdb.obj \
+	$(SLO)$/certdecode.obj \
+	$(SLO)$/certificate.obj \
+	$(SLO)$/certv3.obj \
+	$(SLO)$/certxutl.obj \
+	$(SLO)$/ckhelper.obj \
+	$(SLO)$/crl.obj \
+	$(SLO)$/cryptocontext.obj \
+	$(SLO)$/derdec.obj \
+	$(SLO)$/derenc.obj \
+	$(SLO)$/dersubr.obj \
+	$(SLO)$/dertime.obj \
+	$(SLO)$/devmod.obj \
+	$(SLO)$/devslot.obj \
+	$(SLO)$/devtoken.obj \
+	$(SLO)$/devutil.obj \
+	$(SLO)$/dev3hack.obj \
+	$(SLO)$/dsautil.obj \
+	$(SLO)$/error.obj \
+	$(SLO)$/errorval.obj \
+	$(SLO)$/genname.obj \
+	$(SLO)$/hash.obj \
+	$(SLO)$/hashops.obj \
+	$(SLO)$/item.obj \
+	$(SLO)$/libc.obj \
+	$(SLO)$/list.obj \
+	$(SLO)$/nssb64d.obj \
+	$(SLO)$/nssb64e.obj \
+	$(SLO)$/nssilock.obj \
+	$(SLO)$/nsslocks.obj \
+	$(SLO)$/nssrwlk.obj \
+	$(SLO)$/pkibase.obj \
+	$(SLO)$/pkistore.obj \
+	$(SLO)$/pki3hack.obj \
+	$(SLO)$/pk11cert.obj \
+	$(SLO)$/pk11err.obj \
+	$(SLO)$/pk11kea.obj \
+	$(SLO)$/pk11list.obj \
+	$(SLO)$/pk11load.obj \
+	$(SLO)$/pk11pars.obj \
+	$(SLO)$/pk11pbe.obj \
+	$(SLO)$/pk11pk12.obj \
+	$(SLO)$/pk11pqg.obj \
+	$(SLO)$/pk11sdr.obj \
+	$(SLO)$/pk11skey.obj \
+	$(SLO)$/pk11slot.obj \
+	$(SLO)$/pk11util.obj \
+	$(SLO)$/polcyxtn.obj \
+	$(SLO)$/portreg.obj \
+	$(SLO)$/pqgutil.obj \
+	$(SLO)$/quickder.obj \
+	$(SLO)$/secalgid.obj \
+	$(SLO)$/secasn1d.obj \
+	$(SLO)$/secasn1e.obj \
+	$(SLO)$/secasn1u.obj \
+	$(SLO)$/secdig.obj \
+	$(SLO)$/secinit.obj \
+	$(SLO)$/secitem.obj \
+	$(SLO)$/seckey.obj \
+	$(SLO)$/secname.obj \
+	$(SLO)$/secoid.obj \
+	$(SLO)$/secplcy.obj \
+	$(SLO)$/secport.obj \
+	$(SLO)$/secsign.obj \
+	$(SLO)$/sectime.obj \
+	$(SLO)$/secvfy.obj \
+	$(SLO)$/sechash.obj \
+	$(SLO)$/stanpcertdb.obj \
+	$(SLO)$/symmkey.obj \
+	$(SLO)$/tdcache.obj \
+	$(SLO)$/tracker.obj \
+	$(SLO)$/trustdomain.obj \
+	$(SLO)$/base_utf8.obj \
+	$(SLO)$/util_utf8.obj \
+	$(SLO)$/whatnspr.obj \
+	$(SLO)$/xauthkid.obj \
+	$(SLO)$/xbsconst.obj \
+	$(SLO)$/xconst.obj
+
+.ENDIF # "$(SYSTEM_MOZILLA)" == "YES"
 	
 .ENDIF
 
Index: source/xmlsec/nss/seinitializer_nssimpl.cxx
===================================================================
RCS file: /cvs/xml/xmlsecurity/source/xmlsec/nss/seinitializer_nssimpl.cxx,v
retrieving revision 1.11
diff -u -p -r1.11 seinitializer_nssimpl.cxx
--- xmlsecurity/source/xmlsec/nss/seinitializer_nssimpl.cxx	5 Aug 2004 07:13:30 -0000	1.11
+++ xmlsecurity/source/xmlsec/nss/seinitializer_nssimpl.cxx	28 Oct 2004 08:43:06 -0000
@@ -101,6 +101,9 @@
 #include "nspr.h"
 #include "prtypes.h"
 #include "pk11func.h"
+#ifdef SYSTEM_MOZILLA
+#include "nssrenam.h"
+#endif
 #include "cert.h"
 #include "cryptohi.h"
 #include "certdb.h"
Index: source/xmlsec/nss/x509certificate_nssimpl.hxx
===================================================================
RCS file: /cvs/xml/xmlsecurity/source/xmlsec/nss/x509certificate_nssimpl.hxx,v
retrieving revision 1.3
diff -u -p -r1.3 x509certificate_nssimpl.hxx
--- xmlsecurity/source/xmlsec/nss/x509certificate_nssimpl.hxx	15 Jul 2004 08:12:10 -0000	1.3
+++ xmlsecurity/source/xmlsec/nss/x509certificate_nssimpl.hxx	28 Oct 2004 08:43:07 -0000
@@ -94,6 +94,9 @@
 #include <com/sun/star/security/XCertificate.hpp>
 #endif
 
+#ifdef SYSTEM_MOZILLA
+#include "nssrenam.h"
+#endif
 #include "cert.h"
 
 class X509Certificate_NssImpl : public ::cppu::WeakImplHelper2<
