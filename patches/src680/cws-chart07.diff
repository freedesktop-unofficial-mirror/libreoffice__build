cvs diff: Diffing solenv
cvs diff: Diffing solenv/bin
cvs diff: Diffing solenv/bin/modules
cvs diff: Diffing solenv/bin/modules/installer
cvs diff: Diffing solenv/bin/modules/installer/windows
cvs diff: Diffing solenv/bin/modules/packager
cvs diff: Diffing solenv/bin/modules/par2script
cvs diff: Diffing solenv/bin/modules/pre2par
cvs diff: Diffing solenv/config
cvs diff: Diffing solenv/inc
Index: solenv/inc/unxlngi6.mk
===================================================================
RCS file: /cvs/tools/solenv/inc/unxlngi6.mk,v
retrieving revision 1.36
retrieving revision 1.36.68.1
diff -u -u -p -r1.36 -r1.36.68.1
--- solenv/inc/unxlngi6.mk	30 May 2007 10:17:21 -0000	1.36
+++ solenv/inc/unxlngi6.mk	11 Jul 2007 16:57:27 -0000	1.36.68.1
@@ -140,7 +140,6 @@ CFLAGSWERRCC=-Werror
 # settings.mk):
 MODULES_WITH_WARNINGS := \
     b_server \
-    chart2 \
     devtools \
     extensions \
     r_tools \
Index: solenv/inc/wntmsci10.mk
===================================================================
RCS file: /cvs/tools/solenv/inc/wntmsci10.mk,v
retrieving revision 1.31
retrieving revision 1.31.60.1
diff -u -u -p -r1.31 -r1.31.60.1
--- solenv/inc/wntmsci10.mk	8 Jun 2007 12:47:38 -0000	1.31
+++ solenv/inc/wntmsci10.mk	11 Jul 2007 16:16:38 -0000	1.31.60.1
@@ -218,7 +218,6 @@ CFLAGSWERRCC=-WX
 # COMPILER_WARN_ERRORS=TRUE here instead of setting MODULES_WITH_WARNINGS (see
 # settings.mk):
 MODULES_WITH_WARNINGS := \
-    chart2 \
     extensions \
     lingucomponent \
     soldep \
cvs diff: Diffing solenv/inc/startup
cvs diff: Diffing solenv/inc/startup/AIX
cvs diff: Diffing solenv/inc/startup/FREEBSD
cvs diff: Diffing solenv/inc/startup/HPUX
cvs diff: Diffing solenv/inc/startup/IRIX
cvs diff: Diffing solenv/inc/startup/LINUX
cvs diff: Diffing solenv/inc/startup/MACOSX
cvs diff: Diffing solenv/inc/startup/NETBSD
cvs diff: Diffing solenv/inc/startup/SOLARIS
cvs diff: Diffing solenv/inc/startup/UNIX
cvs diff: Diffing solenv/inc/startup/wnt
cvs diff: Diffing solenv/prj
cvs diff: Diffing solenv/src
cvs diff: Diffing solenv/unxmacxp
cvs diff: Diffing solenv/unxmacxp/inc
cvs diff: Diffing xmloff
cvs diff: Diffing xmloff/dtd
cvs diff: Diffing xmloff/inc
cvs diff: Diffing xmloff/inc/pch
cvs diff: Diffing xmloff/inc/xmloff
cvs diff: Diffing xmloff/prj
cvs diff: Diffing xmloff/qa
cvs diff: Diffing xmloff/qa/unoapi
cvs diff: Diffing xmloff/qa/unoapi/testdocuments
cvs diff: Diffing xmloff/source
cvs diff: Diffing xmloff/source/chart
Index: xmloff/source/chart/SchXMLExport.cxx
===================================================================
RCS file: /cvs/xml/xmloff/source/chart/SchXMLExport.cxx,v
retrieving revision 1.88
retrieving revision 1.88.6.1
diff -u -u -p -r1.88 -r1.88.6.1
--- xmloff/source/chart/SchXMLExport.cxx	27 Jun 2007 14:47:51 -0000	1.88
+++ xmloff/source/chart/SchXMLExport.cxx	13 Jul 2007 12:08:46 -0000	1.88.6.1
@@ -3298,21 +3298,16 @@ void SchXMLExportHelper::InitRangeSegmen
             {
                 Reference< chart2::data::XDataSource > xDataSource( lcl_pressUsedDataIntoRectangularFormat( xChartDoc, mbHasCategoryLabels ));
                 Sequence< beans::PropertyValue > aArgs( xDataProvider->detectArguments( xDataSource ));
+                ::rtl::OUString sCellRange, sBrokenRange;
+                bool bBrokenRangeAvailable = false;
                 for( sal_Int32 i=0; i<aArgs.getLength(); ++i )
                 {
                     if( aArgs[i].Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM("CellRangeRepresentation")))
+                        aArgs[i].Value >>= sCellRange;
+                    else if( aArgs[i].Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM("BrokenCellRangeForExport")))
                     {
-                        ::rtl::OUString sAddressFromDataProvider;
-                        aArgs[i].Value >>= sAddressFromDataProvider;
-                        // convert format to XML-conform one
-                        if( sAddressFromDataProvider.getLength() > 0 )
-                        {
-                            Reference< chart2::data::XRangeXMLConversion > xConversion( xDataProvider, uno::UNO_QUERY );
-                            if( xConversion.is())
-                                msChartAddress = xConversion->convertRangeToXML( sAddressFromDataProvider );
-                            else
-                                msChartAddress = sAddressFromDataProvider;
-                        }
+                        if( aArgs[i].Value >>= sBrokenRange )
+                            bBrokenRangeAvailable = true;
                     }
                     else if( aArgs[i].Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM("DataRowSource")))
                     {
@@ -3327,6 +3322,18 @@ void SchXMLExportHelper::InitRangeSegmen
                     else if( aArgs[i].Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM("TableNumberList")))
                         aArgs[i].Value >>= msTableNumberList;
                 }
+
+                // #i79009# For Writer we have to export a broken version of the
+                // range, where every row number is noe too large, so that older
+                // version can correctly read those files.
+                msChartAddress = (bBrokenRangeAvailable ? sBrokenRange : sCellRange);
+                if( msChartAddress.getLength() > 0 )
+                {
+                    // convert format to XML-conform one
+                    Reference< chart2::data::XRangeXMLConversion > xConversion( xDataProvider, uno::UNO_QUERY );
+                    if( xConversion.is())
+                        msChartAddress = xConversion->convertRangeToXML( msChartAddress );
+                }
             }
         }
         catch( uno::Exception & ex )
Index: xmloff/source/chart/SchXMLPlotAreaContext.cxx
===================================================================
RCS file: /cvs/xml/xmloff/source/chart/SchXMLPlotAreaContext.cxx,v
retrieving revision 1.39
retrieving revision 1.38.54.2
diff -u -u -p -r1.39 -r1.38.54.2
--- xmloff/source/chart/SchXMLPlotAreaContext.cxx	27 Jun 2007 14:48:55 -0000	1.39
+++ xmloff/source/chart/SchXMLPlotAreaContext.cxx	6 Jul 2007 15:40:22 -0000	1.38.54.2
@@ -1016,6 +1016,8 @@ void SchXMLAxisContext::CreateAxis()
 	uno::Reference< beans::XPropertySet > xProp;
 	uno::Any aTrueBool;
 	aTrueBool <<= (sal_Bool)(sal_True);
+    uno::Any aFalseBool;
+	aFalseBool <<= (sal_Bool)(sal_False);
 	uno::Reference< frame::XModel > xDoc( mrImportHelper.GetChartDocument(), uno::UNO_QUERY );
 
     switch( maCurrentAxis.eClass )
@@ -1127,6 +1129,8 @@ void SchXMLAxisContext::CreateAxis()
 	// set properties
 	if( xProp.is())
 	{
+        xProp->setPropertyValue( rtl::OUString::createFromAscii( "DisplayLabels" ), aFalseBool );
+
         // #88077# AutoOrigin 'on' is default
         xProp->setPropertyValue( rtl::OUString::createFromAscii( "AutoOrigin" ), aTrueBool );
 
cvs diff: Diffing xmloff/source/core
cvs diff: Diffing xmloff/source/draw
cvs diff: Diffing xmloff/source/forms
cvs diff: Diffing xmloff/source/meta
cvs diff: Diffing xmloff/source/script
cvs diff: Diffing xmloff/source/style
cvs diff: Diffing xmloff/source/text
cvs diff: Diffing xmloff/source/transform
cvs diff: Diffing xmloff/source/xforms
cvs diff: Diffing xmloff/util
cvs diff: Diffing xmloff/util/defs
cvs diff: Diffing xmloff/xml
cvs diff: Diffing sc
cvs diff: Diffing sc/addin
cvs diff: Diffing sc/addin/datefunc
cvs diff: Diffing sc/addin/inc
cvs diff: Diffing sc/addin/rot13
cvs diff: Diffing sc/addin/util
cvs diff: Diffing sc/inc
Index: sc/inc/chart2uno.hxx
===================================================================
RCS file: /cvs/sc/sc/inc/chart2uno.hxx,v
retrieving revision 1.4
retrieving revision 1.4.24.1
diff -u -u -p -r1.4 -r1.4.24.1
--- sc/inc/chart2uno.hxx	22 May 2007 19:37:54 -0000	1.4
+++ sc/inc/chart2uno.hxx	26 Jun 2007 16:13:51 -0000	1.4.24.1
@@ -129,6 +129,10 @@ public:
 
     // XDataProvider ---------------------------------------------------------
 
+    virtual ::sal_Bool SAL_CALL createDataSourcePossible(
+        const ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue >& aArguments )
+        throw (::com::sun::star::uno::RuntimeException);
+
     virtual ::com::sun::star::uno::Reference<
         ::com::sun::star::chart2::data::XDataSource > SAL_CALL createDataSource(
             const ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue >& aArguments )
@@ -139,6 +143,10 @@ public:
             const ::com::sun::star::uno::Reference< ::com::sun::star::chart2::data::XDataSource >& xDataSource )
             throw (::com::sun::star::uno::RuntimeException);
 
+    virtual ::sal_Bool SAL_CALL createDataSequenceByRangeRepresentationPossible(
+        const ::rtl::OUString& aRangeRepresentation )
+        throw (::com::sun::star::uno::RuntimeException);
+
     virtual ::com::sun::star::uno::Reference<
         ::com::sun::star::chart2::data::XDataSequence > SAL_CALL createDataSequenceByRangeRepresentation(
             const ::rtl::OUString& aRangeRepresentation )
cvs diff: Diffing sc/inc/pch
cvs diff: Diffing sc/prj
cvs diff: Diffing sc/qa
cvs diff: Diffing sc/qa/complex
cvs diff: Diffing sc/qa/complex/dataPilot
cvs diff: Diffing sc/qa/complex/dataPilot/interfaceTests
cvs diff: Diffing sc/qa/complex/dataPilot/interfaceTests/beans
cvs diff: Diffing sc/qa/complex/dataPilot/interfaceTests/container
cvs diff: Diffing sc/qa/complex/dataPilot/interfaceTests/sheet
cvs diff: Diffing sc/qa/complex/sc
cvs diff: Diffing sc/qa/unoapi
cvs diff: Diffing sc/qa/unoapi/testdocuments
cvs diff: Diffing sc/sdi
cvs diff: Diffing sc/source
cvs diff: Diffing sc/source/core
cvs diff: Diffing sc/source/core/data
cvs diff: Diffing sc/source/core/inc
cvs diff: Diffing sc/source/core/src
cvs diff: Diffing sc/source/core/tool
cvs diff: Diffing sc/source/filter
cvs diff: Diffing sc/source/filter/dif
cvs diff: Diffing sc/source/filter/excel
cvs diff: Diffing sc/source/filter/ftools
cvs diff: Diffing sc/source/filter/html
cvs diff: Diffing sc/source/filter/inc
cvs diff: Diffing sc/source/filter/lotus
cvs diff: Diffing sc/source/filter/qpro
cvs diff: Diffing sc/source/filter/rtf
cvs diff: Diffing sc/source/filter/starcalc
cvs diff: Diffing sc/source/filter/xcl97
cvs diff: Diffing sc/source/filter/xml
Index: sc/source/filter/xml/XMLTableShapeImportHelper.cxx
===================================================================
RCS file: /cvs/sc/sc/source/filter/xml/XMLTableShapeImportHelper.cxx,v
retrieving revision 1.27
retrieving revision 1.27.24.1
diff -u -u -p -r1.27 -r1.27.24.1
--- sc/source/filter/xml/XMLTableShapeImportHelper.cxx	22 May 2007 20:03:11 -0000	1.27
+++ sc/source/filter/xml/XMLTableShapeImportHelper.cxx	12 Jun 2007 18:33:30 -0000	1.27.24.1
@@ -175,6 +175,17 @@ void XMLTableShapeImportHelper::finishSh
 		    }
 		    else
 		    {
+                if ( pRangeList )
+                {
+                    // #i78086# If there are notification ranges, the ChartListener must be created
+                    // also when anchored to the sheet
+                    // -> call AddShape with invalid cell position (checked in ScMyShapeResizer::ResizeShapes)
+
+                    table::CellAddress aInvalidPos( -1, -1, -1 );
+                    static_cast<ScXMLImport&>(mrImporter).GetTables().AddShape(rShape,
+                        pRangeList, aInvalidPos, aInvalidPos, 0, 0);
+                }
+
 			    SvxShape* pShapeImp = SvxShape::getImplementation(rShape);
 			    if (pShapeImp)
 			    {
Index: sc/source/filter/xml/XMLTableShapeResizer.cxx
===================================================================
RCS file: /cvs/sc/sc/source/filter/xml/XMLTableShapeResizer.cxx,v
retrieving revision 1.28
retrieving revision 1.28.24.1
diff -u -u -p -r1.28 -r1.28.24.1
--- sc/source/filter/xml/XMLTableShapeResizer.cxx	22 May 2007 20:03:22 -0000	1.28
+++ sc/source/filter/xml/XMLTableShapeResizer.cxx	12 Jun 2007 18:33:30 -0000	1.28.24.1
@@ -217,159 +217,164 @@ void ScMyShapeResizer::ResizeShapes()
 				rImport.LockSolarMutex();
 				while (aItr != aEndItr)
 				{
-					if ((nOldSheet != aItr->aEndCell.Sheet) || !xSheet.is())
-					{
-						nOldSheet = aItr->aEndCell.Sheet;
-                        xSheet.set(xIndex->getByIndex(nOldSheet), uno::UNO_QUERY);
-						if (xSheet.is())
-						{
-							uno::Reference<table::XColumnRowRange> xColumnRowRange (xSheet, uno::UNO_QUERY);
-							if (xColumnRowRange.is())
-								xTableRows = xColumnRowRange->getRows();
-						}
-					}
-					if (xTableRows.is())
-					{
-						if (nOldRow != aItr->aEndCell.Row || !xTableRow.is())
-						{
-							nOldRow = aItr->aEndCell.Row;
-							xTableRows->getByIndex(nOldRow) >>= xTableRow;
-						}
-						if (xTableRow.is())
-						{
-							uno::Reference <beans::XPropertySet> xRowProperties(xTableRow, uno::UNO_QUERY);
-							if (xRowProperties.is())
-							{
-								sal_Int32 nHeight;
-								if (xRowProperties->getPropertyValue(sRowHeight) >>= nHeight)
-								{
-									Rectangle aRec = pDoc->GetMMRect(static_cast<SCCOL>(aItr->aStartCell.Column), static_cast<SCROW>(aItr->aStartCell.Row),
-										static_cast<SCCOL>(aItr->aStartCell.Column), static_cast<SCROW>(aItr->aStartCell.Row), aItr->aStartCell.Sheet);
-									awt::Point aPoint(aItr->xShape->getPosition());
-									awt::Size aSize(aItr->xShape->getSize());
-                                    if (pDoc->IsNegativePage(static_cast<SCTAB>(nOldSheet)))
-                                        aPoint.X += aSize.Width;
-									if (aItr->nEndY >= 0 && aItr->nEndX >= 0)
-									{
-                                        if (aItr->xShape->getShapeType().equals(sConnectorShape))
-                                        {
-                                            //#103122#; handle connected Connectorshapes
-                                            uno::Reference<beans::XPropertySet> xShapeProps (aItr->xShape, uno::UNO_QUERY);
-                                            if(xShapeProps.is())
+                    // #i78086# invalid cell position is used to call CreateChartListener only
+                    if ( aItr->aEndCell.Sheet >= 0 )
+                    {
+    					if ((nOldSheet != aItr->aEndCell.Sheet) || !xSheet.is())
+    					{
+    						nOldSheet = aItr->aEndCell.Sheet;
+                            xSheet.set(xIndex->getByIndex(nOldSheet), uno::UNO_QUERY);
+    						if (xSheet.is())
+    						{
+    							uno::Reference<table::XColumnRowRange> xColumnRowRange (xSheet, uno::UNO_QUERY);
+    							if (xColumnRowRange.is())
+    								xTableRows = xColumnRowRange->getRows();
+    						}
+    					}
+    					if (xTableRows.is())
+    					{
+    						if (nOldRow != aItr->aEndCell.Row || !xTableRow.is())
+    						{
+    							nOldRow = aItr->aEndCell.Row;
+    							xTableRows->getByIndex(nOldRow) >>= xTableRow;
+    						}
+    						if (xTableRow.is())
+    						{
+    							uno::Reference <beans::XPropertySet> xRowProperties(xTableRow, uno::UNO_QUERY);
+    							if (xRowProperties.is())
+    							{
+    								sal_Int32 nHeight;
+    								if (xRowProperties->getPropertyValue(sRowHeight) >>= nHeight)
+    								{
+    									Rectangle aRec = pDoc->GetMMRect(static_cast<SCCOL>(aItr->aStartCell.Column), static_cast<SCROW>(aItr->aStartCell.Row),
+    										static_cast<SCCOL>(aItr->aStartCell.Column), static_cast<SCROW>(aItr->aStartCell.Row), aItr->aStartCell.Sheet);
+    									awt::Point aPoint(aItr->xShape->getPosition());
+    									awt::Size aSize(aItr->xShape->getSize());
+                                        if (pDoc->IsNegativePage(static_cast<SCTAB>(nOldSheet)))
+                                            aPoint.X += aSize.Width;
+    									if (aItr->nEndY >= 0 && aItr->nEndX >= 0)
+    									{
+                                            if (aItr->xShape->getShapeType().equals(sConnectorShape))
                                             {
-                                                uno::Reference<drawing::XShape> xStartShape(xShapeProps->getPropertyValue(	sStartShape ), uno::UNO_QUERY);
-                                                uno::Reference<drawing::XShape> xEndShape(xShapeProps->getPropertyValue( sEndShape ), uno::UNO_QUERY);
-                                                if (!xStartShape.is() && !xEndShape.is())
-                                                {
-										            awt::Size aOldSize(aSize);
-                                                    GetNewShapeSizePos(pDoc, aRec, aItr->aEndCell, aPoint, aSize, aItr->nEndX, aItr->nEndY);
-	                                                aItr->xShape->setPosition(aPoint);
-	                                                if( (aSize.Width != aOldSize.Width) ||
-		                                                (aSize.Height != aOldSize.Height) )
-		                                                aItr->xShape->setSize(aSize);
-                                                }
-                                                else if (xStartShape.is() && xEndShape.is())
-                                                {
-                                                    // do nothing, because they are connected
-                                                }
-                                                else
+                                                //#103122#; handle connected Connectorshapes
+                                                uno::Reference<beans::XPropertySet> xShapeProps (aItr->xShape, uno::UNO_QUERY);
+                                                if(xShapeProps.is())
                                                 {
-                                                    // only one point is connected, the other should be moved
-
-                                                    rtl::OUString sProperty;
-                                                    if (xStartShape.is())
+                                                    uno::Reference<drawing::XShape> xStartShape(xShapeProps->getPropertyValue(	sStartShape ), uno::UNO_QUERY);
+                                                    uno::Reference<drawing::XShape> xEndShape(xShapeProps->getPropertyValue( sEndShape ), uno::UNO_QUERY);
+                                                    if (!xStartShape.is() && !xEndShape.is())
+                                                    {
+    										            awt::Size aOldSize(aSize);
+                                                        GetNewShapeSizePos(pDoc, aRec, aItr->aEndCell, aPoint, aSize, aItr->nEndX, aItr->nEndY);
+    	                                                aItr->xShape->setPosition(aPoint);
+    	                                                if( (aSize.Width != aOldSize.Width) ||
+    		                                                (aSize.Height != aOldSize.Height) )
+    		                                                aItr->xShape->setSize(aSize);
+                                                    }
+                                                    else if (xStartShape.is() && xEndShape.is())
                                                     {
-                                                        awt::Point aEndPoint;
-                                                        xShapeProps->getPropertyValue(sEndPosition) >>= aEndPoint;
-                                                        aPoint.X = aRec.Left() + aEndPoint.X;
-                                                        aPoint.Y = aRec.Top() + aEndPoint.Y;
-                                                        sProperty = sEndPosition;
+                                                        // do nothing, because they are connected
                                                     }
                                                     else
                                                     {
-                                                        awt::Point aStartPoint;
-                                                        xShapeProps->getPropertyValue(sStartPosition) >>= aStartPoint;
-                                                        aPoint.X = aRec.Left() + aStartPoint.X;
-                                                        aPoint.Y = aRec.Top() + aStartPoint.Y;
-                                                        sProperty = sStartPosition;
+                                                        // only one point is connected, the other should be moved
+
+                                                        rtl::OUString sProperty;
+                                                        if (xStartShape.is())
+                                                        {
+                                                            awt::Point aEndPoint;
+                                                            xShapeProps->getPropertyValue(sEndPosition) >>= aEndPoint;
+                                                            aPoint.X = aRec.Left() + aEndPoint.X;
+                                                            aPoint.Y = aRec.Top() + aEndPoint.Y;
+                                                            sProperty = sEndPosition;
+                                                        }
+                                                        else
+                                                        {
+                                                            awt::Point aStartPoint;
+                                                            xShapeProps->getPropertyValue(sStartPosition) >>= aStartPoint;
+                                                            aPoint.X = aRec.Left() + aStartPoint.X;
+                                                            aPoint.Y = aRec.Top() + aStartPoint.Y;
+                                                            sProperty = sStartPosition;
+                                                        }
+                                                        xShapeProps->setPropertyValue(sProperty, uno::makeAny(aPoint));
                                                     }
-                                                    xShapeProps->setPropertyValue(sProperty, uno::makeAny(aPoint));
                                                 }
                                             }
-                                        }
-                                        else
-                                        {
-										    awt::Size aOldSize(aSize);
-                                            GetNewShapeSizePos(pDoc, aRec, aItr->aEndCell, aPoint, aSize, aItr->nEndX, aItr->nEndY);
-                                            if (pDoc->IsNegativePage(static_cast<SCTAB>(nOldSheet)))
-                                                aPoint.X -= aSize.Width;
-	                                        aItr->xShape->setPosition(aPoint);
-	                                        if( (aSize.Width != aOldSize.Width) ||
-		                                        (aSize.Height != aOldSize.Height) )
-		                                        aItr->xShape->setSize(aSize);
-                                        }
-									}
-									else
-									{
-										if (aItr->xShape->getShapeType().equals(sCaptionShape))
-										{
-											Rectangle aRectangle(aPoint.X, aPoint.Y, aPoint.X + aSize.Width, aPoint.Y + aSize.Height);
-
-											awt::Point aCaptionPoint;
-											uno::Reference< beans::XPropertySet > xShapeProps(aItr->xShape, uno::UNO_QUERY);
-											if (xShapeProps.is())
-											{
-												try
-												{
-													xShapeProps->getPropertyValue( sCaptionPoint ) >>= aCaptionPoint;
-												}
-												catch ( uno::Exception& )
-												{
-													DBG_ERROR("This Captionshape has no CaptionPoint property.");
-												}
-											}
-											Point aCorePoint(aPoint.X, aPoint.Y);
-											Point aCoreCaptionPoint(aCaptionPoint.X, aCaptionPoint.Y);
-											aCoreCaptionPoint += aCorePoint;
-											aRectangle.Union(Rectangle(aCoreCaptionPoint, aCoreCaptionPoint));
-
-											Point aBeforeRightBottomPoint(aRectangle.BottomRight());
-
-											aRectangle += aRec.TopLeft();
-											if (aRectangle.Left() > aRec.Right())
-												aRectangle -= (Point(aRectangle.Left() - aRec.Right() + 2, 0));
-											if (aRectangle.Top() > aRec.Bottom())
-												aRectangle -= (Point(0, aRectangle.Top() - aRec.Bottom() + 2));
-
-											Point aDifferencePoint(aRectangle.BottomRight() - aBeforeRightBottomPoint);
-											aPoint.X += aDifferencePoint.X();
-											aPoint.Y += aDifferencePoint.Y();
-
-											aItr->xShape->setPosition(aPoint);
-										}
-										else
-										{
-											// #96159# it is possible, that shapes have a negative position
-											// this is now handled here
-											DBG_ERROR("no or negative end address of this shape");
-											awt::Point aRefPoint;
-											aRefPoint.X = aRec.Left();
-											aRefPoint.Y = aRec.Top();
-											aPoint.X += aRefPoint.X;
-											if (aPoint.X > aRec.Right())
-												aPoint.X = aRec.Right() - 2; // decrement by 2 100th_mm because the cellheight is internal in twips
-											aPoint.Y += aRefPoint.Y;
-											if (aPoint.Y > aRec.Bottom())
-												aPoint.Y = aRec.Bottom() - 2; // decrement by 2 100th_mm because the cellheight is internal in twips
-											aItr->xShape->setPosition(aPoint);
-										}
-									}
-								}
-							}
-						}
-					}
-					else
-						DBG_ERROR("something wents wrong");
+                                            else
+                                            {
+    										    awt::Size aOldSize(aSize);
+                                                GetNewShapeSizePos(pDoc, aRec, aItr->aEndCell, aPoint, aSize, aItr->nEndX, aItr->nEndY);
+                                                if (pDoc->IsNegativePage(static_cast<SCTAB>(nOldSheet)))
+                                                    aPoint.X -= aSize.Width;
+    	                                        aItr->xShape->setPosition(aPoint);
+    	                                        if( (aSize.Width != aOldSize.Width) ||
+    		                                        (aSize.Height != aOldSize.Height) )
+    		                                        aItr->xShape->setSize(aSize);
+                                            }
+    									}
+    									else
+    									{
+    										if (aItr->xShape->getShapeType().equals(sCaptionShape))
+    										{
+    											Rectangle aRectangle(aPoint.X, aPoint.Y, aPoint.X + aSize.Width, aPoint.Y + aSize.Height);
+
+    											awt::Point aCaptionPoint;
+    											uno::Reference< beans::XPropertySet > xShapeProps(aItr->xShape, uno::UNO_QUERY);
+    											if (xShapeProps.is())
+    											{
+    												try
+    												{
+    													xShapeProps->getPropertyValue( sCaptionPoint ) >>= aCaptionPoint;
+    												}
+    												catch ( uno::Exception& )
+    												{
+    													DBG_ERROR("This Captionshape has no CaptionPoint property.");
+    												}
+    											}
+    											Point aCorePoint(aPoint.X, aPoint.Y);
+    											Point aCoreCaptionPoint(aCaptionPoint.X, aCaptionPoint.Y);
+    											aCoreCaptionPoint += aCorePoint;
+    											aRectangle.Union(Rectangle(aCoreCaptionPoint, aCoreCaptionPoint));
+
+    											Point aBeforeRightBottomPoint(aRectangle.BottomRight());
+
+    											aRectangle += aRec.TopLeft();
+    											if (aRectangle.Left() > aRec.Right())
+    												aRectangle -= (Point(aRectangle.Left() - aRec.Right() + 2, 0));
+    											if (aRectangle.Top() > aRec.Bottom())
+    												aRectangle -= (Point(0, aRectangle.Top() - aRec.Bottom() + 2));
+
+    											Point aDifferencePoint(aRectangle.BottomRight() - aBeforeRightBottomPoint);
+    											aPoint.X += aDifferencePoint.X();
+    											aPoint.Y += aDifferencePoint.Y();
+
+    											aItr->xShape->setPosition(aPoint);
+    										}
+    										else
+    										{
+    											// #96159# it is possible, that shapes have a negative position
+    											// this is now handled here
+    											DBG_ERROR("no or negative end address of this shape");
+    											awt::Point aRefPoint;
+    											aRefPoint.X = aRec.Left();
+    											aRefPoint.Y = aRec.Top();
+    											aPoint.X += aRefPoint.X;
+    											if (aPoint.X > aRec.Right())
+    												aPoint.X = aRec.Right() - 2; // decrement by 2 100th_mm because the cellheight is internal in twips
+    											aPoint.Y += aRefPoint.Y;
+    											if (aPoint.Y > aRec.Bottom())
+    												aPoint.Y = aRec.Bottom() - 2; // decrement by 2 100th_mm because the cellheight is internal in twips
+    											aItr->xShape->setPosition(aPoint);
+    										}
+    									}
+    								}
+    							}
+    						}
+    					}
+    					else
+    						DBG_ERROR("something wents wrong");
+                    }
+                    // #i78086# call CreateChartListener also for invalid position (anchored to sheet)
 					if (IsOLE(aItr->xShape))
 					{
 						uno::Reference < beans::XPropertySet > xShapeProps ( aItr->xShape, uno::UNO_QUERY );
cvs diff: Diffing sc/source/ui
cvs diff: Diffing sc/source/ui/Accessibility
cvs diff: Diffing sc/source/ui/app
cvs diff: Diffing sc/source/ui/attrdlg
cvs diff: Diffing sc/source/ui/cctrl
cvs diff: Diffing sc/source/ui/dbgui
cvs diff: Diffing sc/source/ui/docshell
cvs diff: Diffing sc/source/ui/drawfunc
Index: sc/source/ui/drawfunc/fuins2.cxx
===================================================================
RCS file: /cvs/sc/sc/source/ui/drawfunc/fuins2.cxx,v
retrieving revision 1.26
retrieving revision 1.26.24.1
diff -u -u -p -r1.26 -r1.26.24.1
--- sc/source/ui/drawfunc/fuins2.cxx	22 May 2007 20:06:02 -0000	1.26
+++ sc/source/ui/drawfunc/fuins2.cxx	12 Jul 2007 17:33:30 -0000	1.26.24.1
@@ -180,6 +180,11 @@ void lcl_ChartInit( const uno::Reference
             aRangeListRef->Parse( aRangeString, pScDoc );
             if ( aRangeListRef->Count() )
             {
+                pScDoc->LimitChartIfAll( aRangeListRef );               // limit whole columns/rows to used area
+                String aTmpStr;                            
+                aRangeListRef->Format( aTmpStr, SCR_ABS_3D, pScDoc );   // update string from changed ranges
+                aRangeString = aTmpStr;
+
                 ScChartPositioner aChartPositioner( pScDoc, aRangeListRef );
                 if ( eDataRowSource == chart::ChartDataRowSource_COLUMNS )
                 {
cvs diff: Diffing sc/source/ui/formdlg
cvs diff: Diffing sc/source/ui/inc
cvs diff: Diffing sc/source/ui/miscdlgs
cvs diff: Diffing sc/source/ui/namedlg
cvs diff: Diffing sc/source/ui/navipi
cvs diff: Diffing sc/source/ui/optdlg
cvs diff: Diffing sc/source/ui/pagedlg
cvs diff: Diffing sc/source/ui/src
cvs diff: Diffing sc/source/ui/styleui
cvs diff: Diffing sc/source/ui/undo
cvs diff: Diffing sc/source/ui/unoobj
Index: sc/source/ui/unoobj/chart2uno.cxx
===================================================================
RCS file: /cvs/sc/sc/source/ui/unoobj/chart2uno.cxx,v
retrieving revision 1.7
retrieving revision 1.7.24.2
diff -u -u -p -r1.7 -r1.7.24.2
--- sc/source/ui/unoobj/chart2uno.cxx	22 May 2007 20:11:06 -0000	1.7
+++ sc/source/ui/unoobj/chart2uno.cxx	13 Jul 2007 15:15:10 -0000	1.7.24.2
@@ -274,6 +274,33 @@ void lcl_SeperateOneRowRange(ScRange aR,
     }
 }
 
+::sal_Bool SAL_CALL ScChart2DataProvider::createDataSourcePossible( const uno::Sequence< beans::PropertyValue >& aArguments )
+    throw (uno::RuntimeException)
+{
+    ScUnoGuard aGuard;
+    if( ! m_pDocument )
+        return false;
+
+    rtl::OUString aRangeRepresentation;
+    for(sal_Int32 i = 0; i < aArguments.getLength(); ++i)
+    {
+        rtl::OUString sName(aArguments[i].Name);
+        if (aArguments[i].Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM("CellRangeRepresentation")))
+        {
+            aArguments[i].Value >>= aRangeRepresentation;
+        }
+    }
+
+    ScRangeList aRangeList;
+    USHORT nResult = aRangeList.Parse( aRangeRepresentation, m_pDocument );
+    //! if anything is missing, SCA_VALID shouldn't be set
+    const USHORT nNeeded = SCA_VALID | SCA_VALID_COL | SCA_VALID_ROW | SCA_VALID_TAB |
+                           SCA_VALID_COL2 | SCA_VALID_ROW2 | SCA_VALID_TAB2;
+    bool bValid = ( (nResult & nNeeded ) == nNeeded );
+
+    return bValid;
+}
+
 uno::Reference< chart2::data::XDataSource> SAL_CALL
 ScChart2DataProvider::createDataSource(
     const uno::Sequence< beans::PropertyValue >& aArguments )
@@ -935,6 +962,23 @@ void ScChart2DataProvider::detectArgumen
     }
 }
 
+::sal_Bool SAL_CALL ScChart2DataProvider::createDataSequenceByRangeRepresentationPossible( const ::rtl::OUString& aRangeRepresentation )
+    throw (uno::RuntimeException)
+{
+    ScUnoGuard aGuard;
+    if( ! m_pDocument )
+        return false;
+
+    ScRangeList aRangeList;
+    USHORT nResult = aRangeList.Parse( aRangeRepresentation, m_pDocument );
+    //! if anything is missing, SCA_VALID shouldn't be set
+    const USHORT nNeeded = SCA_VALID | SCA_VALID_COL | SCA_VALID_ROW | SCA_VALID_TAB |
+                           SCA_VALID_COL2 | SCA_VALID_ROW2 | SCA_VALID_TAB2;
+    bool bValid = ( (nResult & nNeeded ) == nNeeded );
+
+    return bValid;
+}
+
 uno::Reference< chart2::data::XDataSequence > SAL_CALL
     ScChart2DataProvider::createDataSequenceByRangeRepresentation(
     const ::rtl::OUString& aRangeRepresentation )
cvs diff: Diffing sc/source/ui/vba
cvs diff: Diffing sc/source/ui/view
cvs diff: Diffing sc/uiconfig
cvs diff: Diffing sc/uiconfig/scalc
cvs diff: Diffing sc/uiconfig/scalc/accelerator
cvs diff: Diffing sc/uiconfig/scalc/accelerator/de
cvs diff: Diffing sc/uiconfig/scalc/accelerator/en-GB
cvs diff: Diffing sc/uiconfig/scalc/accelerator/en-US
cvs diff: Diffing sc/uiconfig/scalc/accelerator/es
cvs diff: Diffing sc/uiconfig/scalc/accelerator/fr
cvs diff: Diffing sc/uiconfig/scalc/menubar
cvs diff: Diffing sc/uiconfig/scalc/statusbar
cvs diff: Diffing sc/uiconfig/scalc/toolbar
cvs diff: Diffing sc/util
cvs diff: Diffing sc/util/defs
cvs diff: Diffing sc/workben
cvs diff: Diffing sc/xml
cvs diff: Diffing sw
cvs diff: Diffing sw/inc
cvs diff: Diffing sw/inc/pch
cvs diff: Diffing sw/prj
cvs diff: Diffing sw/qa
cvs diff: Diffing sw/qa/complex
cvs diff: Diffing sw/qa/complex/accessibility
cvs diff: Diffing sw/qa/core
cvs diff: Diffing sw/qa/unoapi
cvs diff: Diffing sw/qa/unoapi/testdocuments
cvs diff: Diffing sw/sdi
cvs diff: Diffing sw/source
cvs diff: Diffing sw/source/core
cvs diff: Diffing sw/source/core/SwNumberTree
cvs diff: Diffing sw/source/core/access
cvs diff: Diffing sw/source/core/attr
cvs diff: Diffing sw/source/core/bastyp
cvs diff: Diffing sw/source/core/crsr
cvs diff: Diffing sw/source/core/doc
cvs diff: Diffing sw/source/core/docnode
cvs diff: Diffing sw/source/core/draw
cvs diff: Diffing sw/source/core/edit
cvs diff: Diffing sw/source/core/except
cvs diff: Diffing sw/source/core/fields
cvs diff: Diffing sw/source/core/frmedt
cvs diff: Diffing sw/source/core/graphic
cvs diff: Diffing sw/source/core/inc
cvs diff: Diffing sw/source/core/layout
cvs diff: Diffing sw/source/core/objectpositioning
cvs diff: Diffing sw/source/core/ole
cvs diff: Diffing sw/source/core/para
cvs diff: Diffing sw/source/core/sw3io
cvs diff: Diffing sw/source/core/swg
cvs diff: Diffing sw/source/core/table
Index: sw/source/core/table/swtable.cxx
===================================================================
RCS file: /cvs/sw/sw/source/core/table/swtable.cxx,v
retrieving revision 1.5
retrieving revision 1.5.40.1
diff -u -u -p -r1.5 -r1.5.40.1
--- sw/source/core/table/swtable.cxx	25 May 2007 13:01:16 -0000	1.5
+++ sw/source/core/table/swtable.cxx	13 Jul 2007 11:03:28 -0000	1.5.40.1
@@ -1475,11 +1475,26 @@ void SwTable::NewSetTabCols( Parm &rParm
 |*	Letzte Aenderung	JP 30. Jun. 93
 |*
 |*************************************************************************/
+
+
+BOOL IsValidRowName( const String& rStr )
+{
+	BOOL bIsValid = TRUE;
+	xub_StrLen nLen = rStr.Len();
+	for (xub_StrLen i = 0;  i < nLen && bIsValid;  ++i)
+	{
+		const sal_Unicode cChar = rStr.GetChar(i);
+		if (cChar < '0' || cChar > '9')
+			bIsValid = FALSE;
+	}
+	return bIsValid;
+}
+
 USHORT SwTable::_GetBoxNum( String& rStr, BOOL bFirst )
 {
 	USHORT nRet = 0;
 	xub_StrLen nPos = 0;
-	if( bFirst )
+	if( bFirst )	// TRUE == column; FALSE == row
 	{
 		// die 1. ist mit Buchstaben addressiert!
 		sal_Unicode cChar;
@@ -1501,12 +1516,17 @@ USHORT SwTable::_GetBoxNum( String& rStr
 	}
 	else if( STRING_NOTFOUND == ( nPos = rStr.Search( aDotStr ) ))
 	{
-        nRet = static_cast<USHORT>(rStr.ToInt32());
+        nRet = 0;
+		if (IsValidRowName( rStr ))
+			nRet = static_cast<USHORT>(rStr.ToInt32());
 		rStr.Erase();
 	}
 	else
 	{
-        nRet = static_cast<USHORT>(rStr.Copy( 0, nPos ).ToInt32());
+        nRet = 0;
+		String aTxt( rStr.Copy( 0, nPos ) );
+		if (IsValidRowName( aTxt ))
+			nRet = static_cast<USHORT>(aTxt.ToInt32());
 		rStr.Erase( 0, nPos+1 );
 	}
 	return nRet;
cvs diff: Diffing sw/source/core/text
cvs diff: Diffing sw/source/core/tox
cvs diff: Diffing sw/source/core/txtnode
cvs diff: Diffing sw/source/core/undo
cvs diff: Diffing sw/source/core/unocore
cvs diff: Diffing sw/source/core/view
cvs diff: Diffing sw/source/filter
cvs diff: Diffing sw/source/filter/ascii
cvs diff: Diffing sw/source/filter/basflt
cvs diff: Diffing sw/source/filter/html
cvs diff: Diffing sw/source/filter/inc
cvs diff: Diffing sw/source/filter/rtf
cvs diff: Diffing sw/source/filter/w4w
cvs diff: Diffing sw/source/filter/writer
cvs diff: Diffing sw/source/filter/ww1
cvs diff: Diffing sw/source/filter/ww8
cvs diff: Diffing sw/source/filter/ww8/dump
cvs diff: Diffing sw/source/filter/xml
cvs diff: Diffing sw/source/ui
cvs diff: Diffing sw/source/ui/app
cvs diff: Diffing sw/source/ui/cctrl
cvs diff: Diffing sw/source/ui/chrdlg
cvs diff: Diffing sw/source/ui/config
cvs diff: Diffing sw/source/ui/dbui
cvs diff: Diffing sw/source/ui/dialog
cvs diff: Diffing sw/source/ui/dochdl
cvs diff: Diffing sw/source/ui/docvw
cvs diff: Diffing sw/source/ui/envelp
cvs diff: Diffing sw/source/ui/fldui
cvs diff: Diffing sw/source/ui/fmtui
cvs diff: Diffing sw/source/ui/frmdlg
cvs diff: Diffing sw/source/ui/globdoc
cvs diff: Diffing sw/source/ui/inc
cvs diff: Diffing sw/source/ui/index
cvs diff: Diffing sw/source/ui/lingu
cvs diff: Diffing sw/source/ui/misc
cvs diff: Diffing sw/source/ui/ribbar
cvs diff: Diffing sw/source/ui/shells
cvs diff: Diffing sw/source/ui/smartmenu
cvs diff: Diffing sw/source/ui/table
cvs diff: Diffing sw/source/ui/uiview
cvs diff: Diffing sw/source/ui/uno
cvs diff: Diffing sw/source/ui/utlui
cvs diff: Diffing sw/source/ui/web
cvs diff: Diffing sw/source/ui/wrtsh
cvs diff: Diffing sw/uiconfig
cvs diff: Diffing sw/uiconfig/sglobal
cvs diff: Diffing sw/uiconfig/sglobal/accelerator
cvs diff: Diffing sw/uiconfig/sglobal/accelerator/de
cvs diff: Diffing sw/uiconfig/sglobal/accelerator/en-GB
cvs diff: Diffing sw/uiconfig/sglobal/accelerator/en-US
cvs diff: Diffing sw/uiconfig/sglobal/accelerator/es
cvs diff: Diffing sw/uiconfig/sglobal/accelerator/fr
cvs diff: Diffing sw/uiconfig/sglobal/menubar
cvs diff: Diffing sw/uiconfig/sglobal/statusbar
cvs diff: Diffing sw/uiconfig/sglobal/toolbar
cvs diff: Diffing sw/uiconfig/sweb
cvs diff: Diffing sw/uiconfig/sweb/accelerator
cvs diff: Diffing sw/uiconfig/sweb/accelerator/de
cvs diff: Diffing sw/uiconfig/sweb/accelerator/en-GB
cvs diff: Diffing sw/uiconfig/sweb/accelerator/en-US
cvs diff: Diffing sw/uiconfig/sweb/accelerator/es
cvs diff: Diffing sw/uiconfig/sweb/accelerator/fr
cvs diff: Diffing sw/uiconfig/sweb/menubar
cvs diff: Diffing sw/uiconfig/sweb/statusbar
cvs diff: Diffing sw/uiconfig/sweb/toolbar
cvs diff: Diffing sw/uiconfig/swform
cvs diff: Diffing sw/uiconfig/swform/accelerator
cvs diff: Diffing sw/uiconfig/swform/accelerator/de
cvs diff: Diffing sw/uiconfig/swform/accelerator/en-US
cvs diff: Diffing sw/uiconfig/swform/accelerator/es
cvs diff: Diffing sw/uiconfig/swform/accelerator/fr
cvs diff: Diffing sw/uiconfig/swform/menubar
cvs diff: Diffing sw/uiconfig/swform/statusbar
cvs diff: Diffing sw/uiconfig/swform/toolbar
cvs diff: Diffing sw/uiconfig/swreport
cvs diff: Diffing sw/uiconfig/swreport/accelerator
cvs diff: Diffing sw/uiconfig/swreport/accelerator/de
cvs diff: Diffing sw/uiconfig/swreport/accelerator/en-GB
cvs diff: Diffing sw/uiconfig/swreport/accelerator/en-US
cvs diff: Diffing sw/uiconfig/swreport/accelerator/es
cvs diff: Diffing sw/uiconfig/swreport/accelerator/fr
cvs diff: Diffing sw/uiconfig/swreport/menubar
cvs diff: Diffing sw/uiconfig/swreport/statusbar
cvs diff: Diffing sw/uiconfig/swreport/toolbar
cvs diff: Diffing sw/uiconfig/swriter
cvs diff: Diffing sw/uiconfig/swriter/accelerator
cvs diff: Diffing sw/uiconfig/swriter/accelerator/de
cvs diff: Diffing sw/uiconfig/swriter/accelerator/en-GB
cvs diff: Diffing sw/uiconfig/swriter/accelerator/en-US
cvs diff: Diffing sw/uiconfig/swriter/accelerator/es
cvs diff: Diffing sw/uiconfig/swriter/accelerator/fr
cvs diff: Diffing sw/uiconfig/swriter/menubar
cvs diff: Diffing sw/uiconfig/swriter/statusbar
cvs diff: Diffing sw/uiconfig/swriter/toolbar
cvs diff: Diffing sw/uiconfig/swxform
cvs diff: Diffing sw/uiconfig/swxform/accelerator
cvs diff: Diffing sw/uiconfig/swxform/accelerator/de
cvs diff: Diffing sw/uiconfig/swxform/accelerator/en-GB
cvs diff: Diffing sw/uiconfig/swxform/accelerator/en-US
cvs diff: Diffing sw/uiconfig/swxform/accelerator/es
cvs diff: Diffing sw/uiconfig/swxform/accelerator/fr
cvs diff: Diffing sw/uiconfig/swxform/menubar
cvs diff: Diffing sw/uiconfig/swxform/statusbar
cvs diff: Diffing sw/uiconfig/swxform/toolbar
cvs diff: Diffing sw/util
cvs diff: Diffing sw/util/defs
cvs diff: Diffing sw/xml
cvs diff: Diffing offuh
cvs diff: Diffing offuh/prj
cvs diff: Diffing offuh/source
cvs diff: Diffing offapi
cvs diff: Diffing offapi/com
cvs diff: Diffing offapi/com/sun
cvs diff: Diffing offapi/com/sun/star
cvs diff: Diffing offapi/com/sun/star/accessibility
cvs diff: Diffing offapi/com/sun/star/animations
cvs diff: Diffing offapi/com/sun/star/auth
cvs diff: Diffing offapi/com/sun/star/awt
cvs diff: Diffing offapi/com/sun/star/awt/tree
cvs diff: Diffing offapi/com/sun/star/chart
cvs diff: Diffing offapi/com/sun/star/chart2
Index: offapi/com/sun/star/chart2/ChartDocument.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/chart2/ChartDocument.idl,v
retrieving revision 1.2
retrieving revision 1.2.44.1
diff -u -u -p -r1.2 -r1.2.44.1
--- offapi/com/sun/star/chart2/ChartDocument.idl	22 May 2007 14:48:44 -0000	1.2
+++ offapi/com/sun/star/chart2/ChartDocument.idl	25 Jun 2007 12:50:33 -0000	1.2.44.1
@@ -39,6 +39,7 @@
 #include <com/sun/star/util/XNumberFormatsSupplier.idl>
 
 #include <com/sun/star/chart2/XChartDocument.idl>
+#include <com/sun/star/chart2/XUndoSupplier.idl>
 #include <com/sun/star/chart2/data/XDataReceiver.idl>
 
 #include <com/sun/star/chart2/XTitled.idl>
@@ -87,6 +88,8 @@ service ChartDocument
         </ol>
      */
     [optional] interface  ::com::sun::star::lang::XInitialization;
+
+    [optional] interface XUndoSupplier;
 };
 
 } ; // chart2
Index: offapi/com/sun/star/chart2/XUndoHelper.idl
===================================================================
RCS file: offapi/com/sun/star/chart2/XUndoHelper.idl
diff -N offapi/com/sun/star/chart2/XUndoHelper.idl
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ offapi/com/sun/star/chart2/XUndoHelper.idl	27 Jun 2007 09:02:45 -0000	1.1.2.1
@@ -0,0 +1,98 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef com_sun_star_chart2_XUndoHelper_idl
+#define com_sun_star_chart2_XUndoHelper_idl
+
+#include <com/sun/star/uno/XInterface.idl>
+#include <com/sun/star/frame/XModel.idl>
+// #include <com/sun/star/beans/PropertyValue.idl>
+
+module com
+{
+module sun
+{
+module star
+{
+module chart2
+{
+
+/** An interface for storing frame::XModel objects for container undo.
+ */
+interface XUndoHelper : ::com::sun::star::uno::XInterface
+{
+    /** call this before you change the xCurrentModel
+
+        @return a clone of the current model that can later be used to
+                restore the state of a changed model
+     */
+    ::com::sun::star::frame::XModel getModelCloneForUndo(
+        [in] ::com::sun::star::frame::XModel xModelBeforeChange );
+
+    /** call this before you change the xCurrentModel. You can pass
+        parameters to refine the information that is cloned.
+
+        @return a clone of the current model that can later be used to
+                restore the state of a changed model using the same
+                arguments in applyModelContentWithArguments.
+     */
+//     ::com::sun::star::frame::XModel getModelCloneForUndoWithArguments(
+//         [in] ::com::sun::star::frame::XModel xModelBeforeChange,
+//         [in] sequence< ::com::sun::star::beans::PropertyValue > aArguments );
+
+    /** apply the content of xModelToCopyFrom to the XModel in xModelToChange
+     */
+    void applyModelContent( [inout] ::com::sun::star::frame::XModel xModelToChange,
+                            [in] ::com::sun::star::frame::XModel xModelToCopyFrom );
+
+    /** apply the content of xModelToCopyFrom to the XModel in
+        xModelToChange. You can pass parameters to refine the
+        information that is applied.
+
+        <p>Note that xModelToCopyFrom should have been created with
+        getModelCloneForUndoWithArguments using the same arguments as
+        are passed here.</p>
+     */
+//     void applyModelContentWithArguments(
+//         [inout] ::com::sun::star::frame::XModel xModelToChange,
+//         [in] ::com::sun::star::frame::XModel xModelToCopyFrom,
+//         [in] sequence< ::com::sun::star::beans::PropertyValue > aArguments );
+};
+
+} ; // chart2
+} ; // com
+} ; // sun
+} ; // star
+
+#endif
Index: offapi/com/sun/star/chart2/XUndoManager.idl
===================================================================
RCS file: offapi/com/sun/star/chart2/XUndoManager.idl
diff -N offapi/com/sun/star/chart2/XUndoManager.idl
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ offapi/com/sun/star/chart2/XUndoManager.idl	27 Jun 2007 09:03:39 -0000	1.1.2.3
@@ -0,0 +1,119 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef com_sun_star_chart2_XUndoManager_idl
+#define com_sun_star_chart2_XUndoManager_idl
+
+#include <com/sun/star/uno/XInterface.idl>
+#include <com/sun/star/frame/XModel.idl>
+#include <com/sun/star/beans/PropertyValue.idl>
+
+module com
+{
+module sun
+{
+module star
+{
+module chart2
+{
+
+/** An interface for undo functionality based on passing frame::XModel
+    objects.
+ */
+interface XUndoManager : ::com::sun::star::uno::XInterface
+{
+    /** call this before you change the xCurrentModel
+     */
+    void preAction( [in] ::com::sun::star::frame::XModel xModelBeforeChange );
+
+    /** call this before you change the xCurrentModel. You can pass
+        parameters to refine the undo action.
+     */
+    void preActionWithArguments( [in] ::com::sun::star::frame::XModel xModelBeforeChange,
+                                 [in] sequence< ::com::sun::star::beans::PropertyValue > aArguments );
+
+    /** call this after you successfully did changes to your current model
+     */
+    void postAction( [in] string aUndoText );
+    /** call this if you aborted the current action.
+     */
+    void cancelAction();
+
+    /** same as cancelAction() but restores the given model to the
+        state set in preAction.  This is useful for cancellation in
+        live-preview dialogs.
+    */
+    void cancelActionWithUndo( [inout] ::com::sun::star::frame::XModel xModelToRestore );
+
+    /** give the current model to be put into the redo-stack
+     */
+    void undo( [inout] ::com::sun::star::frame::XModel xCurrentModel );
+
+    /** give the current model to be put into the undo-stack
+     */
+    void redo( [inout] ::com::sun::star::frame::XModel xCurrentModel );
+
+    /** @return </TRUE> if the undo stack is not empty, i.e. a call to undo() will succeed
+     */
+    boolean undoPossible();
+
+    /** @return </TRUE> if the redo stack is not empty, i.e. a call to redo() will succeed
+     */
+    boolean redoPossible();
+
+    /** Retrieves the undo string for the most recent undo step
+     */
+    string getCurrentUndoString();
+
+    /** Retrieves the redo string for the most recent undo step
+     */
+    string getCurrentRedoString();
+
+    /** Retrieves the undo strings of all stored undo actions in
+        chronological order starting with the most recent.
+     */
+    sequence< string > getAllUndoStrings();
+
+    /** Retrieves the redo strings of all stored undo actions in
+        chronological order starting with the most recent.
+    */
+    sequence< string > getAllRedoStrings();
+};
+
+} ; // chart2
+} ; // com
+} ; // sun
+} ; // star
+
+#endif
Index: offapi/com/sun/star/chart2/XUndoSupplier.idl
===================================================================
RCS file: offapi/com/sun/star/chart2/XUndoSupplier.idl
diff -N offapi/com/sun/star/chart2/XUndoSupplier.idl
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ offapi/com/sun/star/chart2/XUndoSupplier.idl	25 Jun 2007 12:48:01 -0000	1.1.2.1
@@ -0,0 +1,65 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef com_sun_star_chart2_XUndoSupplier_idl
+#define com_sun_star_chart2_XUndoSupplier_idl
+
+#include <com/sun/star/chart2/XUndoManager.idl>
+
+module com
+{
+module sun
+{
+module star
+{
+module chart2
+{
+
+/** An interface for providing an UndoManager based on frame::XModel
+    objects.
+ */
+interface XUndoSupplier : ::com::sun::star::uno::XInterface
+{
+    /** @return an undo manager that allows doing undo and redo of a
+                frame::XModel based object
+     */
+    XUndoManager getUndoManager();
+};
+
+} ; // chart2
+} ; // com
+} ; // sun
+} ; // star
+
+#endif
Index: offapi/com/sun/star/chart2/makefile.mk
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/chart2/makefile.mk,v
retrieving revision 1.5
retrieving revision 1.5.44.2
diff -u -u -p -r1.5 -r1.5.44.2
--- offapi/com/sun/star/chart2/makefile.mk	22 May 2007 15:06:14 -0000	1.5
+++ offapi/com/sun/star/chart2/makefile.mk	27 Jun 2007 09:03:10 -0000	1.5.44.2
@@ -109,7 +109,10 @@ IDLFILES= \
 	XTarget.idl \
 	XTitle.idl \
 	XTitled.idl \
-	XTransformation.idl
+	XTransformation.idl \
+	XUndoManager.idl \
+	XUndoSupplier.idl \
+	XUndoHelper.idl
 
 # --- Targets ------------------------------------------------------
 
cvs diff: Diffing offapi/com/sun/star/chart2/data
Index: offapi/com/sun/star/chart2/data/XDataProvider.idl
===================================================================
RCS file: /cvs/api/offapi/com/sun/star/chart2/data/XDataProvider.idl,v
retrieving revision 1.2
retrieving revision 1.2.44.1
diff -u -u -p -r1.2 -r1.2.44.1
--- offapi/com/sun/star/chart2/data/XDataProvider.idl	22 May 2007 15:08:15 -0000	1.2
+++ offapi/com/sun/star/chart2/data/XDataProvider.idl	26 Jun 2007 16:11:45 -0000	1.2.44.1
@@ -60,6 +60,12 @@ module data
  */
 interface XDataProvider  : ::com::sun::star::uno::XInterface
 {
+    /** If </TRUE> is returned a call to createDataSource with the
+        same arguments must return a valid XDataSequence object.  If
+        </FALSE> is returned, createDataSource throws an exception.
+     */
+    boolean createDataSourcePossible( [in] sequence< com::sun::star::beans::PropertyValue > aArguments );
+
     /** Creates a data source object that matches the given range
         representation string.
 
@@ -85,7 +91,7 @@ interface XDataProvider  : ::com::sun::s
             unable to interpret the arguments passed in
 	 		<code>aArguments</code> appropriately.
      */
-    XDataSource createDataSource( // createDataByRangeRepresentation
+    XDataSource createDataSource(
         [in] sequence< com::sun::star::beans::PropertyValue > aArguments )
         raises( com::sun::star::lang::IllegalArgumentException );
 
@@ -115,6 +121,13 @@ interface XDataProvider  : ::com::sun::s
     sequence< com::sun::star::beans::PropertyValue > detectArguments(
         [in] XDataSource xDataSource );
 
+    /** If </TRUE> is returned a call to
+        createDataSequenceByRangeRepresentation with the same argument must
+        return a valid XDataSequence object.  If </FALSE> is returned,
+        createDataSequenceByRangeRepresentation throws an exception.
+     */
+    boolean createDataSequenceByRangeRepresentationPossible( [in] string aRangeRepresentation );
+
     /** creates a single data sequence for the given data range.
 
         @param aRangeRepresentation
cvs diff: Diffing offapi/com/sun/star/configuration
cvs diff: Diffing offapi/com/sun/star/configuration/backend
cvs diff: Diffing offapi/com/sun/star/configuration/backend/xml
cvs diff: Diffing offapi/com/sun/star/configuration/bootstrap
cvs diff: Diffing offapi/com/sun/star/datatransfer
cvs diff: Diffing offapi/com/sun/star/datatransfer/clipboard
cvs diff: Diffing offapi/com/sun/star/datatransfer/dnd
cvs diff: Diffing offapi/com/sun/star/deployment
cvs diff: Diffing offapi/com/sun/star/deployment/test
cvs diff: Diffing offapi/com/sun/star/deployment/ui
cvs diff: Diffing offapi/com/sun/star/document
cvs diff: Diffing offapi/com/sun/star/drawing
cvs diff: Diffing offapi/com/sun/star/drawing/framework
cvs diff: Diffing offapi/com/sun/star/embed
cvs diff: Diffing offapi/com/sun/star/form
cvs diff: Diffing offapi/com/sun/star/form/binding
cvs diff: Diffing offapi/com/sun/star/form/component
cvs diff: Diffing offapi/com/sun/star/form/control
cvs diff: Diffing offapi/com/sun/star/form/inspection
cvs diff: Diffing offapi/com/sun/star/form/runtime
cvs diff: Diffing offapi/com/sun/star/form/submission
cvs diff: Diffing offapi/com/sun/star/form/validation
cvs diff: Diffing offapi/com/sun/star/formula
cvs diff: Diffing offapi/com/sun/star/frame
cvs diff: Diffing offapi/com/sun/star/frame/status
cvs diff: Diffing offapi/com/sun/star/gallery
cvs diff: Diffing offapi/com/sun/star/geometry
cvs diff: Diffing offapi/com/sun/star/graphic
cvs diff: Diffing offapi/com/sun/star/i18n
cvs diff: Diffing offapi/com/sun/star/image
cvs diff: Diffing offapi/com/sun/star/inspection
cvs diff: Diffing offapi/com/sun/star/installation
cvs diff: Diffing offapi/com/sun/star/ldap
cvs diff: Diffing offapi/com/sun/star/linguistic2
cvs diff: Diffing offapi/com/sun/star/logging
cvs diff: Diffing offapi/com/sun/star/mail
cvs diff: Diffing offapi/com/sun/star/media
cvs diff: Diffing offapi/com/sun/star/mozilla
cvs diff: Diffing offapi/com/sun/star/packages
cvs diff: Diffing offapi/com/sun/star/packages/manifest
cvs diff: Diffing offapi/com/sun/star/packages/zip
cvs diff: Diffing offapi/com/sun/star/plugin
cvs diff: Diffing offapi/com/sun/star/presentation
cvs diff: Diffing offapi/com/sun/star/presentation/textfield
cvs diff: Diffing offapi/com/sun/star/rendering
cvs diff: Diffing offapi/com/sun/star/resource
cvs diff: Diffing offapi/com/sun/star/scanner
cvs diff: Diffing offapi/com/sun/star/script
cvs diff: Diffing offapi/com/sun/star/script/browse
cvs diff: Diffing offapi/com/sun/star/script/provider
cvs diff: Diffing offapi/com/sun/star/sdb
cvs diff: Diffing offapi/com/sun/star/sdb/application
cvs diff: Diffing offapi/com/sun/star/sdb/tools
cvs diff: Diffing offapi/com/sun/star/sdbc
cvs diff: Diffing offapi/com/sun/star/sdbcx
cvs diff: Diffing offapi/com/sun/star/security
cvs diff: Diffing offapi/com/sun/star/setup
cvs diff: Diffing offapi/com/sun/star/sheet
cvs diff: Diffing offapi/com/sun/star/smarttags
cvs diff: Diffing offapi/com/sun/star/style
cvs diff: Diffing offapi/com/sun/star/svg
cvs diff: Diffing offapi/com/sun/star/sync
cvs diff: Diffing offapi/com/sun/star/sync2
cvs diff: Diffing offapi/com/sun/star/system
cvs diff: Diffing offapi/com/sun/star/table
cvs diff: Diffing offapi/com/sun/star/task
cvs diff: Diffing offapi/com/sun/star/text
cvs diff: Diffing offapi/com/sun/star/text/fieldmaster
cvs diff: Diffing offapi/com/sun/star/text/textfield
cvs diff: Diffing offapi/com/sun/star/text/textfield/docinfo
cvs diff: Diffing offapi/com/sun/star/ucb
cvs diff: Diffing offapi/com/sun/star/ucb/smart
cvs diff: Diffing offapi/com/sun/star/ui
cvs diff: Diffing offapi/com/sun/star/ui/dialogs
cvs diff: Diffing offapi/com/sun/star/util
cvs diff: Diffing offapi/com/sun/star/view
cvs diff: Diffing offapi/com/sun/star/xforms
cvs diff: Diffing offapi/com/sun/star/xml
cvs diff: Diffing offapi/com/sun/star/xml/crypto
cvs diff: Diffing offapi/com/sun/star/xml/crypto/sax
cvs diff: Diffing offapi/com/sun/star/xml/csax
cvs diff: Diffing offapi/com/sun/star/xml/dom
cvs diff: Diffing offapi/com/sun/star/xml/dom/events
cvs diff: Diffing offapi/com/sun/star/xml/dom/views
cvs diff: Diffing offapi/com/sun/star/xml/input
cvs diff: Diffing offapi/com/sun/star/xml/sax
cvs diff: Diffing offapi/com/sun/star/xml/wrapper
cvs diff: Diffing offapi/com/sun/star/xml/xpath
cvs diff: Diffing offapi/com/sun/star/xsd
cvs diff: Diffing offapi/drafts
cvs diff: Diffing offapi/drafts/com
cvs diff: Diffing offapi/drafts/com/sun
cvs diff: Diffing offapi/drafts/com/sun/star
cvs diff: Diffing offapi/drafts/com/sun/star/form
cvs diff: Diffing offapi/prj
cvs diff: Diffing offapi/type_reference
cvs diff: Diffing offapi/util
cvs diff: Diffing svx
cvs diff: Diffing svx/doc
cvs diff: Diffing svx/doc/UML
cvs diff: Diffing svx/inc
cvs diff: Diffing svx/inc/pch
cvs diff: Diffing svx/inc/svx
cvs diff: Diffing svx/inc/svx/sdr
cvs diff: Diffing svx/inc/svx/sdr/animation
cvs diff: Diffing svx/inc/svx/sdr/contact
cvs diff: Diffing svx/inc/svx/sdr/event
cvs diff: Diffing svx/inc/svx/sdr/mixer
cvs diff: Diffing svx/inc/svx/sdr/overlay
cvs diff: Diffing svx/inc/svx/sdr/properties
cvs diff: Diffing svx/prj
cvs diff: Diffing svx/qa
cvs diff: Diffing svx/qa/unoapi
cvs diff: Diffing svx/qa/unoapi/testdocuments
cvs diff: Diffing svx/sdi
cvs diff: Diffing svx/source
cvs diff: Diffing svx/source/accessibility
cvs diff: Diffing svx/source/customshapes
cvs diff: Diffing svx/source/dialog
cvs diff: Diffing svx/source/editeng
cvs diff: Diffing svx/source/engine3d
cvs diff: Diffing svx/source/fmcomp
cvs diff: Diffing svx/source/form
cvs diff: Diffing svx/source/gallery2
cvs diff: Diffing svx/source/gengal
cvs diff: Diffing svx/source/inc
cvs diff: Diffing svx/source/init
cvs diff: Diffing svx/source/intro
cvs diff: Diffing svx/source/items
cvs diff: Diffing svx/source/mnuctrls
cvs diff: Diffing svx/source/msfilter
cvs diff: Diffing svx/source/options
cvs diff: Diffing svx/source/outliner
cvs diff: Diffing svx/source/sdr
cvs diff: Diffing svx/source/sdr/animation
cvs diff: Diffing svx/source/sdr/contact
cvs diff: Diffing svx/source/sdr/event
cvs diff: Diffing svx/source/sdr/mixer
cvs diff: Diffing svx/source/sdr/overlay
cvs diff: Diffing svx/source/sdr/properties
cvs diff: Diffing svx/source/smarttags
cvs diff: Diffing svx/source/src
cvs diff: Diffing svx/source/stbctrls
cvs diff: Diffing svx/source/svdraw
cvs diff: Diffing svx/source/svrtf
cvs diff: Diffing svx/source/svxlink
cvs diff: Diffing svx/source/tbxctrls
Index: svx/source/tbxctrls/tbcontrl.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/tbxctrls/tbcontrl.cxx,v
retrieving revision 1.78
retrieving revision 1.78.16.1
diff -u -u -p -r1.78 -r1.78.16.1
--- svx/source/tbxctrls/tbcontrl.cxx	27 Jun 2007 19:18:43 -0000	1.78
+++ svx/source/tbxctrls/tbcontrl.cxx	9 Jul 2007 15:47:01 -0000	1.78.16.1
@@ -1101,7 +1101,7 @@ void SvxFontSizeBox_Impl::DataChanged( c
 #endif
 
 #define PALETTE_X 10
-#define PALETTE_Y 10
+#define PALETTE_Y 11
 #define PALETTE_SIZE (PALETTE_X * PALETTE_Y)
 
 SvxColorWindow_Impl::SvxColorWindow_Impl( const OUString&            rCommand,
cvs diff: Diffing svx/source/toolbars
cvs diff: Diffing svx/source/unodialogs
cvs diff: Diffing svx/source/unodialogs/inc
cvs diff: Diffing svx/source/unodialogs/textconversiondlgs
cvs diff: Diffing svx/source/unodraw
Index: svx/source/unodraw/UnoGraphicExporter.cxx
===================================================================
RCS file: /cvs/graphics/svx/source/unodraw/UnoGraphicExporter.cxx,v
retrieving revision 1.38
retrieving revision 1.38.16.1
diff -u -u -p -r1.38 -r1.38.16.1
--- svx/source/unodraw/UnoGraphicExporter.cxx	27 Jun 2007 19:21:23 -0000	1.38
+++ svx/source/unodraw/UnoGraphicExporter.cxx	12 Jul 2007 13:16:47 -0000	1.38.16.1
@@ -650,6 +650,8 @@ sal_Bool SAL_CALL GraphicExporter::filte
     com::sun::star::uno::Reference< com::sun::star::graphic::XGraphicRenderer > xGraphicRenderer;
 	com::sun::star::uno::Reference< com::sun::star::task::XStatusIndicator >	xStatusIndicator;
 	com::sun::star::uno::Reference< com::sun::star::task::XInteractionHandler >	xInteractionHandler;
+    Fraction    aScaleX( mpDoc->GetScaleFraction() );
+    Fraction    aScaleY( mpDoc->GetScaleFraction() );
 	{
 		sal_Int32 nArgs = aDescriptor.getLength();
 		const PropertyValue* pValues = aDescriptor.getConstArray();
@@ -766,7 +768,31 @@ sal_Bool SAL_CALL GraphicExporter::filte
 								mpCurrentPage = pUnoPage->GetSdrPage();
 						}
 					}
-
+                    else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleXNumerator" ) ) )
+                    {
+                        sal_Int32 nVal = 1;
+                        if( pDataValues->Value >>= nVal )
+                            aScaleX = Fraction( nVal, aScaleX.GetDenominator() );
+                    }
+                    else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleXDenominator" ) ) )
+                    {
+                        sal_Int32 nVal = 1;
+                        if( pDataValues->Value >>= nVal )
+                            aScaleX = Fraction( aScaleX.GetNumerator(), nVal );
+                    }
+                    else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleYNumerator" ) ) )
+                    {
+                        sal_Int32 nVal = 1;
+                        if( pDataValues->Value >>= nVal )
+                            aScaleY = Fraction( nVal, aScaleY.GetDenominator() );
+                    }
+                    else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleYDenominator" ) ) )
+                    {
+                        sal_Int32 nVal = 1;
+                        if( pDataValues->Value >>= nVal )
+                            aScaleY = Fraction( aScaleY.GetNumerator(), nVal );
+                    }
+                    
 					pDataValues++;
 				}
 			}
@@ -789,8 +815,7 @@ sal_Bool SAL_CALL GraphicExporter::filte
 
 	Graphic 			aGraphic;
 	VirtualDevice		aVDev;
-	const Fraction		aFrac( mpDoc->GetScaleFraction() );
-	const MapMode 		aMap( mpDoc->GetScaleUnit(), Point(), aFrac, aFrac );
+	const MapMode 		aMap( mpDoc->GetScaleUnit(), Point(), aScaleX, aScaleY );
 	const sal_uInt16	nFilter = aMediaType.getLength()
 							? pFilter->GetExportFormatNumberForMediaType( aMediaType )
 							: pFilter->GetExportFormatNumberForShortName( aFilterName );
cvs diff: Diffing svx/source/unoedit
cvs diff: Diffing svx/source/unogallery
cvs diff: Diffing svx/source/xml
cvs diff: Diffing svx/source/xoutdev
cvs diff: Diffing svx/uiconfig
cvs diff: Diffing svx/uiconfig/accelerator
cvs diff: Diffing svx/uiconfig/accelerator/en-US
cvs diff: Diffing svx/uiconfig/accelerator/es
cvs diff: Diffing svx/util
cvs diff: Diffing svx/util/defs
cvs diff: Diffing svx/workben
cvs diff: Diffing svx/workben/msview
cvs diff: Diffing svx/xml
cvs diff: Diffing stlport
Index: stlport/STLport-4.5.patch
===================================================================
RCS file: /cvs/external/stlport/STLport-4.5.patch,v
retrieving revision 1.34
retrieving revision 1.34.2.1
diff -u -u -p -r1.34 -r1.34.2.1
--- stlport/STLport-4.5.patch	18 Jun 2007 16:35:07 -0000	1.34
+++ stlport/STLport-4.5.patch	11 Jul 2007 11:47:50 -0000	1.34.2.1
@@ -1084,3 +1084,18 @@
   # define _STLP_MUTEX_INITIALIZER
   # endif
   
+*** misc/STLport-4.5/stlport/stl/_valarray.h    Wed Jul 11 13:38:45 2007
+--- misc/build/STLport-4.5/stlport/stl/_valarray.h      Wed Jul 11 13:40:22 2007
+***************
+*** 19,24 ****
+--- 19,28 ----
+  #ifndef _STLP_VALARRAY_H
+  #define _STLP_VALARRAY_H
+
++ #if defined __GNUC__
++ #pragma GCC system_header
++ #endif
++
+  #ifndef _STLP_CMATH
+  #include <cmath>
+  #endif
cvs diff: Diffing stlport/download
cvs diff: Diffing stlport/prj
cvs diff: Diffing stlport/systemstl
cvs diff: Diffing chart2
cvs diff: Diffing chart2/inc
cvs diff: Diffing chart2/inc/pch
cvs diff: Diffing chart2/prj
cvs diff: Diffing chart2/qa
cvs diff: Diffing chart2/source
cvs diff: Diffing chart2/source/controller
cvs diff: Diffing chart2/source/controller/accessibility
Index: chart2/source/controller/accessibility/AccessibleBase.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/accessibility/AccessibleBase.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/accessibility/AccessibleBase.cxx	22 May 2007 17:14:25 -0000	1.2
+++ chart2/source/controller/accessibility/AccessibleBase.cxx	10 Jul 2007 14:02:51 -0000	1.2.12.2
@@ -125,11 +125,12 @@ AccessibleBase::AccessibleBase(
         m_bIsDisposed( false ),
         m_bMayHaveChildren( bMayHaveChildren ),
         m_bChildrenInitialized( false ),
+        m_nEventNotifierId(0),
         m_pStateSetHelper( new ::utl::AccessibleStateSetHelper() ),
         m_aStateSet( m_pStateSetHelper ),
         m_aAccInfo( rAccInfo ),
         m_bAlwaysTransparent( bAlwaysTransparent ),
-        m_nEventNotifierId(0)
+        m_bStateSetInitialized( false )
 {
     // initialize some states
     OSL_ASSERT( m_pStateSetHelper );
@@ -995,7 +996,7 @@ uno::Sequence< OUString > SAL_CALL Acces
 }
 
 // ________ AccessibleBase::XEventListener ________
-void SAL_CALL AccessibleBase::disposing( const lang::EventObject& Source )
+void SAL_CALL AccessibleBase::disposing( const lang::EventObject& /*Source*/ )
     throw (RuntimeException)
 {
 }
Index: chart2/source/controller/accessibility/AccessibleChartElement.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/accessibility/AccessibleChartElement.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/accessibility/AccessibleChartElement.cxx	22 May 2007 17:14:35 -0000	1.2
+++ chart2/source/controller/accessibility/AccessibleChartElement.cxx	26 Jun 2007 11:02:31 -0000	1.2.12.1
@@ -253,7 +253,9 @@ Reference< awt::XFont > SAL_CALL Accessi
     CheckDisposeState();
 
     Reference< awt::XFont > xFont;
-    Reference< awt::XDevice > xDevice( Reference< awt::XWindow >( GetInfo().m_xWindow ), uno::UNO_QUERY );
+    // using assignment for broken gcc 3.3
+    Reference< awt::XDevice > xDevice = Reference< awt::XDevice >(
+        Reference< awt::XWindow >( GetInfo().m_xWindow ), uno::UNO_QUERY );
 
     if( xDevice.is())
     {
Index: chart2/source/controller/accessibility/AccessibleChartView.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/accessibility/AccessibleChartView.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/accessibility/AccessibleChartView.cxx	22 May 2007 17:14:55 -0000	1.2
+++ chart2/source/controller/accessibility/AccessibleChartView.cxx	10 Jul 2007 11:57:27 -0000	1.2.12.1
@@ -381,7 +381,7 @@ ExplicitValueProvider* AccessibleChartVi
 // view::XSelectionChangeListener
 //-------------------------------------------------------------------------
 
-void SAL_CALL AccessibleChartView::selectionChanged( const lang::EventObject& rEvent )
+void SAL_CALL AccessibleChartView::selectionChanged( const lang::EventObject& /*rEvent*/ )
                 throw (uno::RuntimeException)
 {
     Reference< view::XSelectionSupplier > xSelectionSupplier;
@@ -416,7 +416,7 @@ void SAL_CALL AccessibleChartView::dispo
 //-------------------------------------------------------------------------
 // XEventListener
 //-------------------------------------------------------------------------
-void SAL_CALL AccessibleChartView::disposing( const lang::EventObject& Source )
+void SAL_CALL AccessibleChartView::disposing( const lang::EventObject& /*Source*/ )
     throw (uno::RuntimeException)
 {
 }
cvs diff: Diffing chart2/source/controller/chartapiwrapper
Index: chart2/source/controller/chartapiwrapper/AreaWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/AreaWrapper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/AreaWrapper.cxx	22 May 2007 17:15:43 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/AreaWrapper.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -124,7 +124,7 @@ awt::Point SAL_CALL AreaWrapper::getPosi
     return awt::Point(0,0);
 }
 
-void SAL_CALL AreaWrapper::setPosition( const awt::Point& aPosition )
+void SAL_CALL AreaWrapper::setPosition( const awt::Point& /*aPosition*/ )
     throw (uno::RuntimeException)
 {
     OSL_ENSURE( false, "trying to set position of chart area" );
@@ -136,7 +136,7 @@ awt::Size SAL_CALL AreaWrapper::getSize(
     return m_spChart2ModelContact->GetPageSize();
 }
 
-void SAL_CALL AreaWrapper::setSize( const awt::Size& aSize )
+void SAL_CALL AreaWrapper::setSize( const awt::Size& /*aSize*/ )
     throw (beans::PropertyVetoException,
            uno::RuntimeException)
 {
Index: chart2/source/controller/chartapiwrapper/AxisWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/AxisWrapper.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.2
diff -u -u -p -r1.5 -r1.5.12.2
--- chart2/source/controller/chartapiwrapper/AxisWrapper.cxx	22 May 2007 17:16:13 -0000	1.5
+++ chart2/source/controller/chartapiwrapper/AxisWrapper.cxx	10 Jul 2007 11:57:28 -0000	1.5.12.2
@@ -347,7 +347,7 @@ awt::Point SAL_CALL AxisWrapper::getPosi
     return aResult;
 }
 
-void SAL_CALL AxisWrapper::setPosition( const awt::Point& aPosition )
+void SAL_CALL AxisWrapper::setPosition( const awt::Point& /*aPosition*/ )
     throw (uno::RuntimeException)
 {
     OSL_ENSURE( false, "trying to set position of Axis" );
@@ -360,7 +360,7 @@ awt::Size SAL_CALL AxisWrapper::getSize(
     return aSize;
 }
 
-void SAL_CALL AxisWrapper::setSize( const awt::Size& aSize )
+void SAL_CALL AxisWrapper::setSize( const awt::Size& /*aSize*/ )
     throw (beans::PropertyVetoException,
            uno::RuntimeException)
 {
@@ -513,7 +513,7 @@ const std::vector< WrappedProperty* > Ax
     aWrappedProperties.push_back( new WrappedProperty( C2U( "TextCanOverlap" ), C2U( "TextOverlap" ) ) );
     aWrappedProperties.push_back( new WrappedProperty( C2U( "ArrangeOrder" ), C2U( "ArrangeOrder" ) ) );
     aWrappedProperties.push_back( new WrappedProperty( C2U( "Visible" ), C2U( "Show" ) ) );
-    aWrappedProperties.push_back( new WrappedDefaultProperty( C2U( "DisplayLabels" ), C2U( "DisplayLabels" ), uno::makeAny( false ) ) );
+    aWrappedProperties.push_back( new WrappedDirectStateProperty( C2U( "DisplayLabels" ), C2U( "DisplayLabels" ) ) );
     aWrappedProperties.push_back( new WrappedDirectStateProperty( C2U( "TextBreak" ), C2U( "TextBreak" ) ) );
     WrappedNumberFormatProperty* pWrappedNumberFormatProperty = new WrappedNumberFormatProperty( m_spChart2ModelContact );
     aWrappedProperties.push_back( pWrappedNumberFormatProperty );
Index: chart2/source/controller/chartapiwrapper/ChartDataWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/ChartDataWrapper.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.2
diff -u -u -p -r1.5 -r1.5.12.2
--- chart2/source/controller/chartapiwrapper/ChartDataWrapper.cxx	22 May 2007 17:16:54 -0000	1.5
+++ chart2/source/controller/chartapiwrapper/ChartDataWrapper.cxx	2 Jul 2007 21:34:07 -0000	1.5.12.2
@@ -358,7 +358,7 @@ void SAL_CALL ChartDataWrapper::removeEv
 }
 
 // ____ XEventListener ____
-void SAL_CALL ChartDataWrapper::disposing( const lang::EventObject& Source )
+void SAL_CALL ChartDataWrapper::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
 }
@@ -500,7 +500,7 @@ void ChartDataWrapper::refreshData()
 
                 for( sal_Int32 nInner=0; nInner<nInnerSize; ++nInner )
                 {
-                    uno::Sequence< double > aValues(
+                    uno::Sequence< double > aValues = uno::Sequence< double > (
                         lcl_DataSequenceToDoubleSeq() (aSequenceVector[nInner] ));
                     sal_Int32 nMax = ::std::min( nOuterSize, aValues.getLength());
                     for( sal_Int32 nOuter=0; nOuter<nMax; ++nOuter )
@@ -673,6 +673,12 @@ void ChartDataWrapper::applyData( bool b
         bool bOnlyAtFirstChartType = false;
         DiagramHelper::setStackMode( xDia, eStackMode, bOnlyAtFirstChartType );
     }
+
+    // notify listeners
+    ::com::sun::star::chart::ChartDataChangeEvent aEvent(
+        static_cast< ::cppu::OWeakObject* >( this ),
+        ::com::sun::star::chart::ChartDataChangeType_ALL, 0, 0, 0, 0 );
+    fireChartDataChangeEvent( aEvent );
     // \-- locked controllers
 }
 
Index: chart2/source/controller/chartapiwrapper/ChartDocumentWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/ChartDocumentWrapper.cxx,v
retrieving revision 1.6
retrieving revision 1.6.8.2
diff -u -u -p -r1.6 -r1.6.8.2
--- chart2/source/controller/chartapiwrapper/ChartDocumentWrapper.cxx	11 Jun 2007 14:57:09 -0000	1.6
+++ chart2/source/controller/chartapiwrapper/ChartDocumentWrapper.cxx	10 Jul 2007 15:10:21 -0000	1.6.8.2
@@ -312,7 +312,7 @@ WrappedDataSourceLabelsInFirstRowPropert
 {
 }
 
-void WrappedDataSourceLabelsInFirstRowProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedDataSourceLabelsInFirstRowProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bLabelsInFirstRow = sal_True;
@@ -345,7 +345,7 @@ void WrappedDataSourceLabelsInFirstRowPr
     }
 }
 
-Any WrappedDataSourceLabelsInFirstRowProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedDataSourceLabelsInFirstRowProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     ::rtl::OUString aRangeString;
@@ -369,7 +369,7 @@ Any WrappedDataSourceLabelsInFirstRowPro
     return m_aOuterValue;
 }
 
-Any WrappedDataSourceLabelsInFirstRowProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedDataSourceLabelsInFirstRowProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -414,7 +414,7 @@ WrappedDataSourceLabelsInFirstColumnProp
 {
 }
 
-void WrappedDataSourceLabelsInFirstColumnProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedDataSourceLabelsInFirstColumnProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bLabelsInFirstRow = sal_True;
@@ -447,7 +447,7 @@ void WrappedDataSourceLabelsInFirstColum
     }
 }
 
-Any WrappedDataSourceLabelsInFirstColumnProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedDataSourceLabelsInFirstColumnProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     ::rtl::OUString aRangeString;
@@ -471,7 +471,7 @@ Any WrappedDataSourceLabelsInFirstColumn
     return m_aOuterValue;
 }
 
-Any WrappedDataSourceLabelsInFirstColumnProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedDataSourceLabelsInFirstColumnProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -513,7 +513,7 @@ WrappedHasLegendProperty::~WrappedHasLeg
 {
 }
 
-void WrappedHasLegendProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedHasLegendProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bNewValue = sal_True;
@@ -539,7 +539,7 @@ void WrappedHasLegendProperty::setProper
     }
 }
 
-Any WrappedHasLegendProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedHasLegendProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -559,7 +559,7 @@ Any WrappedHasLegendProperty::getPropert
     return aRet;
 }
 
-Any WrappedHasLegendProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedHasLegendProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -601,7 +601,7 @@ WrappedHasMainTitleProperty::~WrappedHas
 {
 }
 
-void WrappedHasMainTitleProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedHasMainTitleProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bNewValue = sal_True;
@@ -621,7 +621,7 @@ void WrappedHasMainTitleProperty::setPro
     }
 }
 
-Any WrappedHasMainTitleProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedHasMainTitleProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -636,7 +636,7 @@ Any WrappedHasMainTitleProperty::getProp
     return aRet;
 }
 
-Any WrappedHasMainTitleProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedHasMainTitleProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -678,7 +678,7 @@ WrappedHasSubTitleProperty::~WrappedHasS
 {
 }
 
-void WrappedHasSubTitleProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedHasSubTitleProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bNewValue = sal_True;
@@ -699,7 +699,7 @@ void WrappedHasSubTitleProperty::setProp
     }
 }
 
-Any WrappedHasSubTitleProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedHasSubTitleProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -714,7 +714,7 @@ Any WrappedHasSubTitleProperty::getPrope
     return aRet;
 }
 
-Any WrappedHasSubTitleProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedHasSubTitleProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -729,8 +729,8 @@ Any WrappedHasSubTitleProperty::getPrope
 ChartDocumentWrapper::ChartDocumentWrapper(
     const Reference< uno::XComponentContext > & xContext ) :
         m_spChart2ModelContact( new Chart2ModelContact( xContext ) ),
-        m_bIsDisposed( false ),
-        m_bUpdateAddIn( sal_True )
+        m_bUpdateAddIn( sal_True ),
+        m_bIsDisposed( false )
 {
 }
 
@@ -1549,6 +1549,7 @@ uno::Reference< uno::XInterface > SAL_CA
            uno::RuntimeException)
 {
     OSL_ENSURE( Arguments.getLength(), "createInstanceWithArguments: Warning: Arguments are ignored" );
+    (void)(Arguments);
 
     return createInstance( ServiceSpecifier );
 }
Index: chart2/source/controller/chartapiwrapper/DataSeriesPointWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/DataSeriesPointWrapper.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.3
diff -u -u -p -r1.6 -r1.6.12.3
--- chart2/source/controller/chartapiwrapper/DataSeriesPointWrapper.cxx	22 May 2007 17:17:29 -0000	1.6
+++ chart2/source/controller/chartapiwrapper/DataSeriesPointWrapper.cxx	10 Jul 2007 15:17:01 -0000	1.6.12.3
@@ -155,7 +155,7 @@ void lcl_AddPropertiesToVector_SeriesOnl
                   | beans::PropertyAttribute::MAYBEDEFAULT ));
 }
 
-const uno::Sequence< Property > & lcl_GetPropertySequence( DataSeriesPointWrapper::eType eType )
+const uno::Sequence< Property > & lcl_GetPropertySequence( DataSeriesPointWrapper::eType _eType )
 {
     static uno::Sequence< Property > aSeriesPropSeq;
     static uno::Sequence< Property > aPointPropSeq;
@@ -163,14 +163,14 @@ const uno::Sequence< Property > & lcl_Ge
     // /--
     MutexGuard aGuard( ::osl::Mutex::getGlobalMutex() );
     uno::Sequence< Property >& rPropSeq =
-        (eType == DataSeriesPointWrapper::DATA_SERIES) ? aSeriesPropSeq : aPointPropSeq;
+        (_eType == DataSeriesPointWrapper::DATA_SERIES) ? aSeriesPropSeq : aPointPropSeq;
     if( 0 == rPropSeq.getLength() )
     {
         // get properties
         ::std::vector< ::com::sun::star::beans::Property > aProperties;
 
         lcl_AddPropertiesToVector_PointProperties( aProperties );
-        if( eType == DataSeriesPointWrapper::DATA_SERIES )
+        if( _eType == DataSeriesPointWrapper::DATA_SERIES )
         {
             lcl_AddPropertiesToVector_SeriesOnly( aProperties );
             WrappedStatisticProperties::addProperties( aProperties );
@@ -228,7 +228,7 @@ WrappedAttachedAxisProperty::~WrappedAtt
 {
 }
 
-Any WrappedAttachedAxisProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedAttachedAxisProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -552,15 +552,15 @@ void SAL_CALL DataSeriesPointWrapper::in
         m_eType = DATA_SERIES;
 }
 
-DataSeriesPointWrapper::DataSeriesPointWrapper( eType eType
+DataSeriesPointWrapper::DataSeriesPointWrapper( eType _eType
             , sal_Int32 nSeriesIndexInNewAPI
             , sal_Int32 nPointIndex //ignored for series
             , ::boost::shared_ptr< Chart2ModelContact > spChart2ModelContact )
         : m_spChart2ModelContact( spChart2ModelContact )
         , m_aEventListenerContainer( m_aMutex )
-        , m_eType( DATA_SERIES )
+        , m_eType( _eType )
         , m_nSeriesIndexInNewAPI( nSeriesIndexInNewAPI )
-        , m_nPointIndex( 0 )
+        , m_nPointIndex( (_eType == DATA_POINT) ? nPointIndex : -1 )
         , m_xDataSeries(0)
 {
 }
@@ -595,7 +595,7 @@ void SAL_CALL DataSeriesPointWrapper::re
 }
 
 // ____ XEventListener ____
-void SAL_CALL DataSeriesPointWrapper::disposing( const lang::EventObject& Source )
+void SAL_CALL DataSeriesPointWrapper::disposing( const lang::EventObject& /*Source*/ )
     throw (uno::RuntimeException)
 {
 }
@@ -749,6 +749,7 @@ Any SAL_CALL DataSeriesPointWrapper::get
     }
     catch( beans::UnknownPropertyException& ex )
     {
+        (void)(ex);
         aRet = WrappedPropertySet::getPropertyDefault( rPropertyName );
     }
     return aRet;
Index: chart2/source/controller/chartapiwrapper/DiagramWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/DiagramWrapper.cxx,v
retrieving revision 1.7
retrieving revision 1.7.4.1
diff -u -u -p -r1.7 -r1.7.4.1
--- chart2/source/controller/chartapiwrapper/DiagramWrapper.cxx	3 Jul 2007 13:36:19 -0000	1.7
+++ chart2/source/controller/chartapiwrapper/DiagramWrapper.cxx	10 Jul 2007 11:57:28 -0000	1.7.4.1
@@ -1093,7 +1093,7 @@ WrappedDataRowSourceProperty::~WrappedDa
 {
 }
 
-void WrappedDataRowSourceProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedDataRowSourceProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     ::com::sun::star::chart::ChartDataRowSource eChartDataRowSource = ::com::sun::star::chart::ChartDataRowSource_ROWS;
@@ -1123,7 +1123,7 @@ void WrappedDataRowSourceProperty::setPr
     }
 }
 
-Any WrappedDataRowSourceProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedDataRowSourceProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     ::rtl::OUString aRangeString;
@@ -1146,7 +1146,7 @@ Any WrappedDataRowSourceProperty::getPro
     return m_aOuterValue;
 }
 
-Any WrappedDataRowSourceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedDataRowSourceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1230,7 +1230,7 @@ bool WrappedStackingProperty::detectInne
     return bHasDetectableInnerValue;
 }
 
-void WrappedStackingProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedStackingProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bNewValue;
@@ -1259,7 +1259,7 @@ void WrappedStackingProperty::setPropert
     }
 }
 
-Any WrappedStackingProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedStackingProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     StackMode eInnerStackMode;
@@ -1273,7 +1273,7 @@ Any WrappedStackingProperty::getProperty
     return m_aOuterValue;
 }
 
-Any WrappedStackingProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedStackingProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1318,7 +1318,7 @@ WrappedDim3DProperty::~WrappedDim3DPrope
 {
 }
 
-void WrappedDim3DProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedDim3DProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bNew3D;
@@ -1336,7 +1336,7 @@ void WrappedDim3DProperty::setPropertyVa
         DiagramHelper::setDimension( xDiagram, bNew3D ? 3 : 2 );
 }
 
-Any WrappedDim3DProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedDim3DProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Reference< chart2::XDiagram > xDiagram( m_spChart2ModelContact->getChart2Diagram() );
@@ -1348,7 +1348,7 @@ Any WrappedDim3DProperty::getPropertyVal
     return m_aOuterValue;
 }
 
-Any WrappedDim3DProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedDim3DProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1393,7 +1393,7 @@ WrappedVerticalProperty::~WrappedVertica
 {
 }
 
-void WrappedVerticalProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedVerticalProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bNewVertical;
@@ -1413,7 +1413,7 @@ void WrappedVerticalProperty::setPropert
         DiagramHelper::setVertical( xDiagram, bNewVertical );
 }
 
-Any WrappedVerticalProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedVerticalProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     bool bFound = false;
@@ -1428,7 +1428,7 @@ Any WrappedVerticalProperty::getProperty
     return m_aOuterValue;
 }
 
-Any WrappedVerticalProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedVerticalProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1510,7 +1510,7 @@ bool WrappedNumberOfLinesProperty::detec
     return bHasDetectableInnerValue;
 }
 
-void WrappedNumberOfLinesProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedNumberOfLinesProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Int32 nNewValue;
@@ -1578,7 +1578,7 @@ void WrappedNumberOfLinesProperty::setPr
     }
 }
 
-Any WrappedNumberOfLinesProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedNumberOfLinesProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1587,7 +1587,7 @@ Any WrappedNumberOfLinesProperty::getPro
     return aRet;
 }
 
-Any WrappedNumberOfLinesProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedNumberOfLinesProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1632,7 +1632,7 @@ WrappedAttributedDataPointsProperty::~Wr
 {
 }
 
-void WrappedAttributedDataPointsProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedAttributedDataPointsProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     uno::Sequence< uno::Sequence< sal_Int32 > > aNewValue;
@@ -1674,7 +1674,7 @@ void WrappedAttributedDataPointsProperty
     }
 }
 
-Any WrappedAttributedDataPointsProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedAttributedDataPointsProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Reference< chart2::XDiagram >    xDiagram( m_spChart2ModelContact->getChart2Diagram() );
@@ -1707,7 +1707,7 @@ Any WrappedAttributedDataPointsProperty:
     return m_aOuterValue;
 }
 
-Any WrappedAttributedDataPointsProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedAttributedDataPointsProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -1724,7 +1724,7 @@ Reference< chart2::XDiagram > SAL_CALL D
 }
 
 void SAL_CALL DiagramWrapper::setDiagram(
-    const Reference< chart2::XDiagram >& xDiagram )
+    const Reference< chart2::XDiagram >& /*xDiagram*/ )
     throw (uno::RuntimeException)
 {
     //@todo: remove this method from interface
Index: chart2/source/controller/chartapiwrapper/LegendWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/LegendWrapper.cxx,v
retrieving revision 1.6
retrieving revision 1.6.4.1
diff -u -u -p -r1.6 -r1.6.4.1
--- chart2/source/controller/chartapiwrapper/LegendWrapper.cxx	3 Jul 2007 13:36:32 -0000	1.6
+++ chart2/source/controller/chartapiwrapper/LegendWrapper.cxx	7 Jul 2007 11:55:52 -0000	1.6.4.1
@@ -168,14 +168,17 @@ void WrappedLegendAlignmentProperty::set
         chart2::LegendPosition eNewInnerPos(chart2::LegendPosition_LINE_END);
         if( aInnerValue >>= eNewInnerPos )
         {
-            chart2::LegendExpansion eNewExpansion = chart2::LegendExpansion_WIDE;
-            if( eNewInnerPos == chart2::LegendPosition_LINE_END || eNewInnerPos == chart2::LegendPosition_LINE_START )
-                eNewExpansion = chart2::LegendExpansion_HIGH;
+            chart2::LegendExpansion eNewExpansion =
+                ( eNewInnerPos == chart2::LegendPosition_LINE_END ||
+                  eNewInnerPos == chart2::LegendPosition_LINE_START )
+                ? chart2::LegendExpansion_HIGH
+                : chart2::LegendExpansion_WIDE;
+
+            chart2::LegendExpansion eOldExpansion( chart2::LegendExpansion_HIGH );
+            bool bExpansionWasSet(
+                xInnerPropertySet->getPropertyValue( C2U( "Expansion" ) ) >>= eOldExpansion );
 
-            chart2::LegendExpansion eOldExpansion( chart2::LegendExpansion_WIDE );
-            xInnerPropertySet->getPropertyValue( C2U( "Expansion" ) ) >>= eOldExpansion;
-
-            if(eOldExpansion != eNewExpansion)
+            if( !bExpansionWasSet || (eOldExpansion != eNewExpansion))
                 xInnerPropertySet->setPropertyValue( C2U( "Expansion" ), uno::makeAny( eNewExpansion ));
         }
 
Index: chart2/source/controller/chartapiwrapper/MinMaxLineWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/MinMaxLineWrapper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/MinMaxLineWrapper.cxx	22 May 2007 17:18:54 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/MinMaxLineWrapper.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -171,10 +171,7 @@ uno::Reference< beans::XPropertySetInfo 
         // /--
         ::osl::MutexGuard aGuard( GetMutex() );
         if( !m_xInfo.is() )
-        {
-            sal_Bool bSorted = sal_True;
             m_xInfo = ::cppu::OPropertySetHelper::createPropertySetInfo( getInfoHelper() );
-        }
         // \--
     }
     return m_xInfo;
@@ -262,22 +259,22 @@ uno::Any SAL_CALL MinMaxLineWrapper::get
     return aRet;
 }
 
-void SAL_CALL MinMaxLineWrapper::addPropertyChangeListener( const ::rtl::OUString& aPropertyName, const uno::Reference< beans::XPropertyChangeListener >& xListener )
+void SAL_CALL MinMaxLineWrapper::addPropertyChangeListener( const ::rtl::OUString& /*aPropertyName*/, const uno::Reference< beans::XPropertyChangeListener >& /*xListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL MinMaxLineWrapper::removePropertyChangeListener( const ::rtl::OUString& aPropertyName, const uno::Reference< beans::XPropertyChangeListener >& aListener )
+void SAL_CALL MinMaxLineWrapper::removePropertyChangeListener( const ::rtl::OUString& /*aPropertyName*/, const uno::Reference< beans::XPropertyChangeListener >& /*aListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL MinMaxLineWrapper::addVetoableChangeListener( const ::rtl::OUString& PropertyName, const uno::Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL MinMaxLineWrapper::addVetoableChangeListener( const ::rtl::OUString& /*PropertyName*/, const uno::Reference< beans::XVetoableChangeListener >& /*aListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL MinMaxLineWrapper::removeVetoableChangeListener( const ::rtl::OUString& PropertyName, const uno::Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL MinMaxLineWrapper::removeVetoableChangeListener( const ::rtl::OUString& /*PropertyName*/, const uno::Reference< beans::XVetoableChangeListener >& /*aListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
@@ -322,17 +319,22 @@ uno::Sequence< uno::Any > SAL_CALL MinMa
     }
     return aRetSeq;
 }
-void SAL_CALL MinMaxLineWrapper::addPropertiesChangeListener( const uno::Sequence< ::rtl::OUString >& aPropertyNames, const uno::Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL MinMaxLineWrapper::addPropertiesChangeListener(
+    const uno::Sequence< ::rtl::OUString >& /* aPropertyNames */,
+    const uno::Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL MinMaxLineWrapper::removePropertiesChangeListener( const uno::Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL MinMaxLineWrapper::removePropertiesChangeListener(
+    const uno::Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL MinMaxLineWrapper::firePropertiesChangeEvent( const uno::Sequence< ::rtl::OUString >& aPropertyNames, const uno::Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL MinMaxLineWrapper::firePropertiesChangeEvent(
+    const uno::Sequence< ::rtl::OUString >& /* aPropertyNames */,
+    const uno::Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
Index: chart2/source/controller/chartapiwrapper/TitleWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/TitleWrapper.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/controller/chartapiwrapper/TitleWrapper.cxx	22 May 2007 17:19:25 -0000	1.5
+++ chart2/source/controller/chartapiwrapper/TitleWrapper.cxx	10 Jul 2007 11:57:28 -0000	1.5.12.1
@@ -131,7 +131,7 @@ Any WrappedTitleStringProperty::getPrope
     }
     return aRet;
 }
-Any WrappedTitleStringProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedTitleStringProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return uno::makeAny( rtl::OUString() );//default title is a empty String
@@ -277,7 +277,7 @@ awt::Size SAL_CALL TitleWrapper::getSize
     return m_spChart2ModelContact->GetTitleSize( this->getTitle() );
 }
 
-void SAL_CALL TitleWrapper::setSize( const awt::Size& aSize )
+void SAL_CALL TitleWrapper::setSize( const awt::Size& /*aSize*/ )
     throw (beans::PropertyVetoException,
            uno::RuntimeException)
 {
@@ -412,7 +412,7 @@ Any SAL_CALL TitleWrapper::getPropertyVa
 beans::PropertyState SAL_CALL TitleWrapper::getPropertyState( const OUString& rPropertyName )
                                     throw (beans::UnknownPropertyException, uno::RuntimeException)
 {
-    beans::PropertyState aState;
+    beans::PropertyState aState( beans::PropertyState_DIRECT_VALUE );
 
     sal_Int32 nHandle = getInfoHelper().getHandleByName( rPropertyName );
     if( CharacterProperties::IsCharacterPropertyHandle( nHandle ) )
Index: chart2/source/controller/chartapiwrapper/UpDownBarWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/UpDownBarWrapper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/chartapiwrapper/UpDownBarWrapper.cxx	22 May 2007 17:19:45 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/UpDownBarWrapper.cxx	10 Jul 2007 13:38:13 -0000	1.2.12.2
@@ -177,10 +177,7 @@ uno::Reference< beans::XPropertySetInfo 
         // /--
         ::osl::MutexGuard aGuard( GetMutex() );
         if( !m_xInfo.is() )
-        {
-            sal_Bool bSorted = sal_True;
             m_xInfo = ::cppu::OPropertySetHelper::createPropertySetInfo( getInfoHelper() );
-        }
         // \--
     }
     return m_xInfo;
@@ -259,22 +256,22 @@ uno::Any SAL_CALL UpDownBarWrapper::getP
     return aRet;
 }
 
-void SAL_CALL UpDownBarWrapper::addPropertyChangeListener( const ::rtl::OUString& aPropertyName, const uno::Reference< beans::XPropertyChangeListener >& xListener )
+void SAL_CALL UpDownBarWrapper::addPropertyChangeListener( const ::rtl::OUString& /*aPropertyName*/, const uno::Reference< beans::XPropertyChangeListener >& /*xListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL UpDownBarWrapper::removePropertyChangeListener( const ::rtl::OUString& aPropertyName, const uno::Reference< beans::XPropertyChangeListener >& aListener )
+void SAL_CALL UpDownBarWrapper::removePropertyChangeListener( const ::rtl::OUString& /*aPropertyName*/, const uno::Reference< beans::XPropertyChangeListener >& /*aListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL UpDownBarWrapper::addVetoableChangeListener( const ::rtl::OUString& PropertyName, const uno::Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL UpDownBarWrapper::addVetoableChangeListener( const ::rtl::OUString& /*PropertyName*/, const uno::Reference< beans::XVetoableChangeListener >& /*aListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL UpDownBarWrapper::removeVetoableChangeListener( const ::rtl::OUString& PropertyName, const uno::Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL UpDownBarWrapper::removeVetoableChangeListener( const ::rtl::OUString& /*PropertyName*/, const uno::Reference< beans::XVetoableChangeListener >& /*aListener*/ )
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
@@ -319,17 +316,17 @@ uno::Sequence< uno::Any > SAL_CALL UpDow
     }
     return aRetSeq;
 }
-void SAL_CALL UpDownBarWrapper::addPropertiesChangeListener( const uno::Sequence< ::rtl::OUString >& aPropertyNames, const uno::Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL UpDownBarWrapper::addPropertiesChangeListener( const uno::Sequence< ::rtl::OUString >& /* aPropertyNames */, const uno::Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL UpDownBarWrapper::removePropertiesChangeListener( const uno::Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL UpDownBarWrapper::removePropertiesChangeListener( const uno::Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
-void SAL_CALL UpDownBarWrapper::firePropertiesChangeEvent( const uno::Sequence< ::rtl::OUString >& aPropertyNames, const uno::Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL UpDownBarWrapper::firePropertiesChangeEvent( const uno::Sequence< ::rtl::OUString >& /* aPropertyNames */, const uno::Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
Index: chart2/source/controller/chartapiwrapper/WrappedAddInProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedAddInProperty.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/chartapiwrapper/WrappedAddInProperty.cxx	22 May 2007 17:20:29 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedAddInProperty.cxx	10 Jul 2007 13:38:13 -0000	1.2.12.2
@@ -60,7 +60,7 @@ WrappedAddInProperty::~WrappedAddInPrope
 {
 }
 
-void WrappedAddInProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedAddInProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Reference< util::XRefreshable > xAddIn;
@@ -70,7 +70,7 @@ void WrappedAddInProperty::setPropertyVa
     m_rChartDocumentWrapper.setAddIn( xAddIn );
 }
 
-Any WrappedAddInProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedAddInProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return uno::makeAny( m_rChartDocumentWrapper.getAddIn() );
@@ -89,7 +89,7 @@ WrappedBaseDiagramProperty::~WrappedBase
 {
 }
 
-void WrappedBaseDiagramProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedBaseDiagramProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     rtl::OUString aBaseDiagram;
@@ -99,7 +99,7 @@ void WrappedBaseDiagramProperty::setProp
     m_rChartDocumentWrapper.setBaseDiagram( aBaseDiagram );
 }
 
-Any WrappedBaseDiagramProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedBaseDiagramProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return uno::makeAny( m_rChartDocumentWrapper.getBaseDiagram() );
@@ -118,13 +118,13 @@ WrappedAdditionalShapesProperty::~Wrappe
 {
 }
 
-void WrappedAdditionalShapesProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedAdditionalShapesProperty::setPropertyValue( const Any& /*rOuterValue*/, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     throw lang::IllegalArgumentException( C2U("AdditionalShapes is a read only property"), 0, 0 );
 }
 
-Any WrappedAdditionalShapesProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedAdditionalShapesProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return uno::makeAny( m_rChartDocumentWrapper.getAdditionalShapes() );
@@ -143,7 +143,7 @@ WrappedRefreshAddInAllowedProperty::~Wra
 {
 }
 
-void WrappedRefreshAddInAllowedProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedRefreshAddInAllowedProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /* xInnerPropertySet */ ) const
                         throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bUpdateAddIn = sal_True;
@@ -153,7 +153,7 @@ void WrappedRefreshAddInAllowedProperty:
     m_rChartDocumentWrapper.setUpdateAddIn( bUpdateAddIn );
 }
 
-Any WrappedRefreshAddInAllowedProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedRefreshAddInAllowedProperty::getPropertyValue( const Reference< beans::XPropertySet >& /* xInnerPropertySet */ ) const
                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return uno::makeAny( m_rChartDocumentWrapper.getUpdateAddIn() );
Index: chart2/source/controller/chartapiwrapper/WrappedAxisAndGridExistenceProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedAxisAndGridExistenceProperties.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/chartapiwrapper/WrappedAxisAndGridExistenceProperties.cxx	22 May 2007 17:20:49 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedAxisAndGridExistenceProperties.cxx	10 Jul 2007 13:38:13 -0000	1.2.12.2
@@ -196,7 +196,7 @@ void WrappedAxisAndGridExistenceProperty
     }
 }
 
-Any WrappedAxisAndGridExistenceProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedAxisAndGridExistenceProperty::getPropertyValue( const Reference< beans::XPropertySet >& /* xInnerPropertySet */ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -214,7 +214,7 @@ Any WrappedAxisAndGridExistenceProperty:
     return aRet;
 }
 
-Any WrappedAxisAndGridExistenceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedAxisAndGridExistenceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -308,7 +308,7 @@ void WrappedAxisTitleExistenceProperty::
     }
 }
 
-Any WrappedAxisTitleExistenceProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedAxisTitleExistenceProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Bool bHasTitle = sal_False;
@@ -323,7 +323,7 @@ Any WrappedAxisTitleExistenceProperty::g
 
 }
 
-Any WrappedAxisTitleExistenceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedAxisTitleExistenceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -420,7 +420,7 @@ void WrappedAxisLabelExistenceProperty::
         xProp->setPropertyValue( C2U( "DisplayLabels" ), rOuterValue );
 }
 
-Any WrappedAxisLabelExistenceProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedAxisLabelExistenceProperty::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
@@ -433,7 +433,7 @@ Any WrappedAxisLabelExistenceProperty::g
     return aRet;
 }
 
-Any WrappedAxisLabelExistenceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedAxisLabelExistenceProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Any aRet;
Index: chart2/source/controller/chartapiwrapper/WrappedCharacterHeightProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedCharacterHeightProperty.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/WrappedCharacterHeightProperty.cxx	22 May 2007 17:21:08 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedCharacterHeightProperty.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -128,7 +128,7 @@ Any WrappedCharacterHeightProperty_Base:
     return aRet;
 }
 
-beans::PropertyState WrappedCharacterHeightProperty_Base::getPropertyState( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+beans::PropertyState WrappedCharacterHeightProperty_Base::getPropertyState( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, uno::RuntimeException)
 {
     return beans::PropertyState_DIRECT_VALUE;
Index: chart2/source/controller/chartapiwrapper/WrappedGapwidthProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedGapwidthProperty.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/WrappedGapwidthProperty.cxx	22 May 2007 17:21:45 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedGapwidthProperty.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -84,7 +84,7 @@ WrappedBarPositionProperty_Base::~Wrappe
 {
 }
 
-void WrappedBarPositionProperty_Base::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedBarPositionProperty_Base::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
     sal_Int32 nNewValue;
@@ -134,7 +134,7 @@ void WrappedBarPositionProperty_Base::se
     }
 }
 
-Any WrappedBarPositionProperty_Base::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedBarPositionProperty_Base::getPropertyValue( const Reference< beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     Reference< chart2::XDiagram > xDiagram( m_spChart2ModelContact->getChart2Diagram() );
Index: chart2/source/controller/chartapiwrapper/WrappedNumberFormatProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedNumberFormatProperty.cxx,v
retrieving revision 1.3
retrieving revision 1.3.8.1
diff -u -u -p -r1.3 -r1.3.8.1
--- chart2/source/controller/chartapiwrapper/WrappedNumberFormatProperty.cxx	11 Jun 2007 14:57:34 -0000	1.3
+++ chart2/source/controller/chartapiwrapper/WrappedNumberFormatProperty.cxx	10 Jul 2007 11:57:28 -0000	1.3.8.1
@@ -112,7 +112,7 @@ Any WrappedNumberFormatProperty::getProp
     return aRet;
 }
 
-Any WrappedNumberFormatProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedNumberFormatProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return uno::makeAny( sal_Int32( 0 ) );
@@ -184,7 +184,7 @@ Any WrappedLinkNumberFormatProperty::get
     return uno::makeAny( bLink );
 }
 
-Any WrappedLinkNumberFormatProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedLinkNumberFormatProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     bool bLink = true;
Index: chart2/source/controller/chartapiwrapper/WrappedSeriesOrDiagramProperty.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedSeriesOrDiagramProperty.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/WrappedSeriesOrDiagramProperty.hxx	22 May 2007 17:23:39 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedSeriesOrDiagramProperty.hxx	26 Jun 2007 09:59:19 -0000	1.2.12.1
@@ -166,7 +166,7 @@ public:
         }
     }
 
-    ::com::sun::star::uno::Any getPropertyDefault( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertyState >& xInnerPropertyState ) const
+    ::com::sun::star::uno::Any getPropertyDefault( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertyState >& /* xInnerPropertyState */ ) const
                             throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
     {
         return m_aDefaultValue;
Index: chart2/source/controller/chartapiwrapper/WrappedSplineProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedSplineProperties.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/WrappedSplineProperties.cxx	22 May 2007 17:23:49 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedSplineProperties.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -122,7 +122,7 @@ public:
         }
         return bHasDetectableInnerValue;
     }
-    void setPropertyValue( const ::com::sun::star::uno::Any& rOuterValue, const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& xInnerPropertySet ) const
+    void setPropertyValue( const ::com::sun::star::uno::Any& rOuterValue, const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                     throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::beans::PropertyVetoException, ::com::sun::star::lang::IllegalArgumentException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
     {
         PROPERTYTYPE aNewValue;
@@ -160,7 +160,7 @@ public:
         }
     }
 
-    ::com::sun::star::uno::Any getPropertyValue( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& xInnerPropertySet ) const
+    ::com::sun::star::uno::Any getPropertyValue( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                             throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
     {
         bool bHasAmbiguousValue = false;
@@ -172,7 +172,7 @@ public:
         return m_aOuterValue;
     }
 
-    ::com::sun::star::uno::Any getPropertyDefault( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertyState >& xInnerPropertyState ) const
+    ::com::sun::star::uno::Any getPropertyDefault( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                             throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
     {
         return m_aDefaultValue;
Index: chart2/source/controller/chartapiwrapper/WrappedStatisticProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedStatisticProperties.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/WrappedStatisticProperties.cxx	22 May 2007 17:24:08 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedStatisticProperties.cxx	4 Jul 2007 16:44:17 -0000	1.2.12.1
@@ -726,8 +726,8 @@ Reference< beans::XPropertySet > Wrapped
 }
 
 void WrappedStatisticPropertySetProperty::setValueToSeries(
-    const Reference< beans::XPropertySet >& xSeriesPropertySet
-    , Reference< beans::XPropertySet > xNewValue ) const
+    const Reference< beans::XPropertySet >& /* xSeriesPropertySet */
+    , Reference< beans::XPropertySet > /* xNewValue */ ) const
 {
     OSL_ENSURE( false, "Trying to set a read-only property" );
 }
Index: chart2/source/controller/chartapiwrapper/WrappedStockProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedStockProperties.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/chartapiwrapper/WrappedStockProperties.cxx	22 May 2007 17:24:28 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedStockProperties.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -104,7 +104,7 @@ WrappedStockProperty::~WrappedStockPrope
 {
 }
 
-void WrappedStockProperty::setPropertyValue( const ::com::sun::star::uno::Any& rOuterValue, const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedStockProperty::setPropertyValue( const ::com::sun::star::uno::Any& rOuterValue, const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                 throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::beans::PropertyVetoException, ::com::sun::star::lang::IllegalArgumentException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
     sal_Bool bNewValue;
@@ -142,7 +142,7 @@ void WrappedStockProperty::setPropertyVa
     }
 }
 
-::com::sun::star::uno::Any WrappedStockProperty::getPropertyDefault( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertyState >& xInnerPropertyState ) const
+::com::sun::star::uno::Any WrappedStockProperty::getPropertyDefault( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertyState >& /*xInnerPropertyState*/ ) const
                         throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
     return m_aDefaultValue;
@@ -172,7 +172,7 @@ WrappedVolumeProperty::~WrappedVolumePro
 {
 }
 
-::com::sun::star::uno::Any WrappedVolumeProperty::getPropertyValue( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& xInnerPropertySet ) const
+::com::sun::star::uno::Any WrappedVolumeProperty::getPropertyValue( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
     Reference< chart2::XChartDocument > xChartDoc( m_spChart2ModelContact->getChart2Document() );
@@ -245,7 +245,7 @@ WrappedUpDownProperty::WrappedUpDownProp
 WrappedUpDownProperty::~WrappedUpDownProperty()
 {
 }
-::com::sun::star::uno::Any WrappedUpDownProperty::getPropertyValue( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& xInnerPropertySet ) const
+::com::sun::star::uno::Any WrappedUpDownProperty::getPropertyValue( const ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >& /*xInnerPropertySet*/ ) const
                         throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::lang::WrappedTargetException, ::com::sun::star::uno::RuntimeException)
 {
     Reference< chart2::XChartDocument > xChartDoc( m_spChart2ModelContact->getChart2Document() );
Index: chart2/source/controller/chartapiwrapper/WrappedSymbolProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/chartapiwrapper/WrappedSymbolProperties.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/chartapiwrapper/WrappedSymbolProperties.cxx	22 May 2007 17:24:48 -0000	1.2
+++ chart2/source/controller/chartapiwrapper/WrappedSymbolProperties.cxx	9 Jul 2007 15:43:47 -0000	1.2.12.2
@@ -61,6 +61,8 @@
 #include <com/sun/star/drawing/LineStyle.hpp>
 #endif
 
+#include <com/sun/star/graphic/XGraphicProvider.hpp>
+
 // for UNO_NAME_GRAPHOBJ_URLPREFIX
 #include <svx/unoprnms.hxx>
 
@@ -73,6 +75,7 @@
 #include <goodies/grfmgr.hxx>
 #endif
 
+#include <comphelper/processfactory.hxx>
 
 using namespace ::com::sun::star;
 using ::com::sun::star::uno::Any;
@@ -340,10 +343,31 @@ void WrappedSymbolBitmapURLProperty::set
         OSL_ENSURE( bMatchesPrefix, "Invalid URL for Symbol Bitmap" );
         if( bMatchesPrefix )
         {
-            GraphicObject aGrObj( ByteString( U2C( aNewGraphicURL.copy( sizeof( UNO_NAME_GRAPHOBJ_URLPREFIX ) - 1 ))));
+            GraphicObject aGrObj = GraphicObject(
+                ByteString( U2C( aNewGraphicURL.copy( sizeof( UNO_NAME_GRAPHOBJ_URLPREFIX ) - 1 ))));
             aSymbol.Graphic.set( aGrObj.GetGraphic().GetXGraphic());
             xSeriesPropertySet->setPropertyValue( C2U("Symbol"), uno::makeAny( aSymbol ) );
         }
+        else
+        {
+            try
+            {
+                // @todo: get factory from some context?
+                Reference< lang::XMultiServiceFactory > xFact( comphelper::getProcessServiceFactory(), uno::UNO_QUERY_THROW );
+                Reference< graphic::XGraphicProvider > xGraphProv(
+                    xFact->createInstance( C2U("com.sun.star.graphic.GraphicProvider")), uno::UNO_QUERY_THROW );
+                Sequence< beans::PropertyValue > aArgs(1);
+                aArgs[0] = beans::PropertyValue(
+                    C2U("URL"), -1, uno::makeAny( aNewGraphicURL ),
+                    beans::PropertyState_DIRECT_VALUE );
+                aSymbol.Graphic.set( xGraphProv->queryGraphic( aArgs ));
+                xSeriesPropertySet->setPropertyValue( C2U("Symbol"), uno::makeAny( aSymbol ) );
+            }
+            catch( const uno::Exception & ex )
+            {
+                ASSERT_EXCEPTION( ex );
+            }
+        }
     }
 }
 
cvs diff: Diffing chart2/source/controller/dialogs
Index: chart2/source/controller/dialogs/ChartTypeDialogController.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/ChartTypeDialogController.cxx,v
retrieving revision 1.3
retrieving revision 1.3.4.1
diff -u -u -p -r1.3 -r1.3.4.1
--- chart2/source/controller/dialogs/ChartTypeDialogController.cxx	3 Jul 2007 13:36:54 -0000	1.3
+++ chart2/source/controller/dialogs/ChartTypeDialogController.cxx	10 Jul 2007 11:57:28 -0000	1.3.4.1
@@ -161,7 +161,7 @@ ChartTypeDialogController::ChartTypeDial
 ChartTypeDialogController::~ChartTypeDialogController()
 {
 }
-Image ChartTypeDialogController::getImage( bool bIsHighContrast )
+Image ChartTypeDialogController::getImage( bool /*bIsHighContrast*/ )
 {
     return Image();
 }
@@ -208,7 +208,7 @@ ChartTypeParameter ChartTypeDialogContro
     }
     return aRet;
 }
-void ChartTypeDialogController::adjustSubTypeAndEnableControls( ChartTypeParameter& rParameter )
+void ChartTypeDialogController::adjustSubTypeAndEnableControls( ChartTypeParameter& /*rParameter*/ )
 {
 }
 void ChartTypeDialogController::adjustParameterToSubType( ChartTypeParameter& rParameter )
@@ -385,7 +385,7 @@ bool ChartTypeDialogController::commitTo
     }
     return false;
 }
-void ChartTypeDialogController::fillSubTypeList( ValueSet& rSubTypeList, bool bIsHighContrast, const ChartTypeParameter& rParameter )
+void ChartTypeDialogController::fillSubTypeList( ValueSet& rSubTypeList, bool /*bIsHighContrast*/, const ChartTypeParameter& /*rParameter*/ )
 {
     rSubTypeList.Clear();
 }
@@ -418,18 +418,18 @@ bool ChartTypeDialogController::shouldSh
     return false;
 }
 
-void ChartTypeDialogController::showExtraControls( Window* pParent, const Point& rPosition, const Size& rSize )
+void ChartTypeDialogController::showExtraControls( Window* /*pParent*/, const Point& /*rPosition*/, const Size& /*rSize*/ )
 {
 }
 void ChartTypeDialogController::hideExtraControls() const
 {
 }
-void ChartTypeDialogController::fillExtraControls( const ChartTypeParameter& rParameter
-                                                  , const uno::Reference< XChartDocument >& xChartModel
-                                                  , const uno::Reference< beans::XPropertySet >& xTemplateProps ) const
+void ChartTypeDialogController::fillExtraControls( const ChartTypeParameter& /*rParameter*/
+                                                  , const uno::Reference< XChartDocument >& /*xChartModel*/
+                                                  , const uno::Reference< beans::XPropertySet >& /*xTemplateProps*/ ) const
 {
 }
-void ChartTypeDialogController::setTemplateProperties( const uno::Reference< beans::XPropertySet >& xTemplateProps ) const throw (uno::RuntimeException)
+void ChartTypeDialogController::setTemplateProperties( const uno::Reference< beans::XPropertySet >& /*xTemplateProps*/ ) const throw (uno::RuntimeException)
 {
 }
 //--------------------------------------------------------------------------
@@ -1082,7 +1082,7 @@ const tTemplateServiceChartTypeParameter
     ;
     return m_aTemplateMap;
 }
-void StockChartDialogController::fillSubTypeList( ValueSet& rSubTypeList, bool bIsHighContrast, const ChartTypeParameter& rParameter )
+void StockChartDialogController::fillSubTypeList( ValueSet& rSubTypeList, bool bIsHighContrast, const ChartTypeParameter& /*rParameter*/ )
 {
     rSubTypeList.Clear();
     rSubTypeList.InsertItem( 1, SELECT_BITMAP( BMP_STOCK_1 ) );
@@ -1131,7 +1131,7 @@ const tTemplateServiceChartTypeParameter
     ;
     return m_aTemplateMap;
 }
-void CombiColumnLineChartDialogController::fillSubTypeList( ValueSet& rSubTypeList, bool bIsHighContrast, const ChartTypeParameter& rParameter )
+void CombiColumnLineChartDialogController::fillSubTypeList( ValueSet& rSubTypeList, bool bIsHighContrast, const ChartTypeParameter& /*rParameter*/ )
 {
     rSubTypeList.Clear();
     rSubTypeList.InsertItem( 1, SELECT_BITMAP( BMP_COLUMN_LINE ) );
@@ -1182,7 +1182,7 @@ void CombiColumnLineChartDialogControlle
     if(m_pMF_NumberOfLines)
         m_pMF_NumberOfLines->Hide();
 }
-void CombiColumnLineChartDialogController::fillExtraControls( const ChartTypeParameter& rParameter
+void CombiColumnLineChartDialogController::fillExtraControls( const ChartTypeParameter& /*rParameter*/
                 , const uno::Reference< XChartDocument >& xChartModel
                 , const uno::Reference< beans::XPropertySet >& xTemplateProps ) const
 {
@@ -1220,7 +1220,7 @@ void CombiColumnLineChartDialogControlle
 {
     if( xTemplateProps.is() )
     {
-        sal_Int32 nNumLines = m_pMF_NumberOfLines->GetValue();
+        sal_Int32 nNumLines = static_cast< sal_Int32 >( m_pMF_NumberOfLines->GetValue());
         xTemplateProps->setPropertyValue( C2U( "NumberOfLines" ), uno::makeAny(nNumLines) );
     }
 }
Index: chart2/source/controller/dialogs/DataBrowser.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/DataBrowser.cxx,v
retrieving revision 1.3
retrieving revision 1.3.8.1
diff -u -u -p -r1.3 -r1.3.8.1
--- chart2/source/controller/dialogs/DataBrowser.cxx	11 Jun 2007 14:57:46 -0000	1.3
+++ chart2/source/controller/dialogs/DataBrowser.cxx	10 Jul 2007 15:21:02 -0000	1.3.8.1
@@ -640,13 +640,14 @@ void DataBrowser::RenewTable()
 
     sal_Int32 nColumnWidth( GetDataWindow().LogicToPixel( Size( nDefaultColumnWidth, 0 )).getWidth());
     sal_Int32 nColumnCount = m_apDataBrowserModel->getColumnCount();
-    sal_Int32 nRowCount = m_apDataBrowserModel->getMaxRowCount();
+    // nRowCount is a member of a base class
+    sal_Int32 nRowCountLocal = m_apDataBrowserModel->getMaxRowCount();
     for( sal_Int32 nColIdx=1; nColIdx<=nColumnCount; ++nColIdx )
     {
         InsertDataColumn( static_cast< sal_uInt16 >( nColIdx ), GetColString( nColIdx ), nColumnWidth );
     }
 
-    RowInserted( 1, nRowCount );
+    RowInserted( 1, nRowCountLocal );
     GoToRow( ::std::min( nOldRow, GetRowCount() - 1 ));
     GoToColumnId( ::std::min( nOldColId, static_cast< USHORT >( ColCount() - 1 )));
 
Index: chart2/source/controller/dialogs/DataBrowserModel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/DataBrowserModel.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/dialogs/DataBrowserModel.cxx	22 May 2007 17:27:50 -0000	1.2
+++ chart2/source/controller/dialogs/DataBrowserModel.cxx	10 Jul 2007 15:21:56 -0000	1.2.12.2
@@ -622,7 +622,7 @@ bool DataBrowserModel::setCellAny( sal_I
         }
         catch( const uno::Exception & ex )
         {
-            (void*)(&ex);
+            (void)(ex);
             bResult = false;
         }
     }
@@ -803,7 +803,7 @@ void DataBrowserModel::updateFromModel()
                         }
                         catch( const beans::UnknownPropertyException & ex )
                         {
-                            (void*)&ex;
+                            (void)ex;
                         }
                         m_aHeaders.push_back(
                             tDataHeader(
Index: chart2/source/controller/dialogs/DialogModel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/DialogModel.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/DialogModel.cxx	22 May 2007 17:28:10 -0000	1.2
+++ chart2/source/controller/dialogs/DialogModel.cxx	21 Jun 2007 16:54:02 -0000	1.2.12.1
@@ -52,32 +52,17 @@
 #include "ControllerLockGuard.hxx"
 #include "ChartTypeHelper.hxx"
 
-#ifndef _COM_SUN_STAR_UTIL_XCLONEABLE_HPP_
 #include <com/sun/star/util/XCloneable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_AXISTYPE_HPP_
 #include <com/sun/star/chart2/AxisType.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XTITLED_HPP_
 #include <com/sun/star/chart2/XTitled.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XCOORDINATESYSTEMCONTAINER_HPP_
 #include <com/sun/star/chart2/XCoordinateSystemContainer.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XCHARTTYPECONTAINER_HPP_
 #include <com/sun/star/chart2/XChartTypeContainer.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XDATASERIESCONTAINER_HPP_
 #include <com/sun/star/chart2/XDataSeriesContainer.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_DATA_XDATASINK_HPP_
 #include <com/sun/star/chart2/data/XDataSink.hpp>
-#endif
 
-#ifndef _STRING_HXX
 #include <tools/string.hxx>
-#endif
 
+#include <utility>
 #include <algorithm>
 #include <iterator>
 #include <functional>
@@ -330,10 +315,10 @@ Reference< XDataSeries > lcl_CreateNewSe
         if( xChartType.is() && xSink.is())
         {
             ::std::vector< Reference< data::XLabeledDataSequence > > aNewSequences;
-            OUString aRoleOfSeqForSeriesLabel = xChartType->getRoleOfSequenceForSeriesLabel();
-            OUString aLabel( String( ::chart::SchResId( STR_DATA_UNNAMED_SERIES )));
-            Sequence< OUString > aRoles( xChartType->getSupportedMandatoryRoles());
-            Sequence< OUString > aOptRoles( xChartType->getSupportedOptionalRoles());
+            const OUString aRoleOfSeqForSeriesLabel = xChartType->getRoleOfSequenceForSeriesLabel();
+            const OUString aLabel( String( ::chart::SchResId( STR_DATA_UNNAMED_SERIES )));
+            const Sequence< OUString > aRoles( xChartType->getSupportedMandatoryRoles());
+            const Sequence< OUString > aOptRoles( xChartType->getSupportedOptionalRoles());
             sal_Int32 nI = 0;
 
             for(nI=0; nI<aRoles.getLength(); ++nI)
@@ -372,7 +357,7 @@ Reference< XDataSeries > lcl_CreateNewSe
 struct lcl_addSeriesNumber : public ::std::binary_function<
         sal_Int32, Reference< XDataSeriesContainer >, sal_Int32 >
 {
-    sal_Int32 operator() ( sal_Int32 nCurrentNumber, const Reference< XDataSeriesContainer > & xCnt )
+    sal_Int32 operator() ( sal_Int32 nCurrentNumber, const Reference< XDataSeriesContainer > & xCnt ) const
     {
         if( xCnt.is())
             return nCurrentNumber + (xCnt->getDataSeries().getLength());
@@ -408,7 +393,7 @@ void DialogModel::setTemplate(
 }
 
 ::boost::shared_ptr< RangeSelectionHelper >
-    DialogModel::getRangeSelectionHelper() const throw()
+    DialogModel::getRangeSelectionHelper() const
 {
     if( ! m_spRangeSelectionHelper.get())
         m_spRangeSelectionHelper.reset(
@@ -417,13 +402,13 @@ void DialogModel::setTemplate(
     return m_spRangeSelectionHelper;
 }
 
-Reference< frame::XModel > DialogModel::getChartModel() const throw()
+Reference< frame::XModel > DialogModel::getChartModel() const
 {
     Reference< frame::XModel > xResult( m_xChartDocument, uno::UNO_QUERY );
     return xResult;
 }
 
-Reference< data::XDataProvider > DialogModel::getDataProvider() const throw()
+Reference< data::XDataProvider > DialogModel::getDataProvider() const
 {
     Reference< data::XDataProvider > xResult;
     if( m_xChartDocument.is())
@@ -432,7 +417,7 @@ Reference< data::XDataProvider > DialogM
 }
 
 ::std::vector< Reference< XDataSeriesContainer > >
-    DialogModel::getAllDataSeriesContainers() const throw()
+    DialogModel::getAllDataSeriesContainers() const
 {
     ::std::vector< Reference< XDataSeriesContainer > > aResult;
 
@@ -467,7 +452,7 @@ Reference< data::XDataProvider > DialogM
 }
 
 ::std::vector< DialogModel::tSeriesWithChartTypeByName >
-    DialogModel::getAllDataSeriesWithLabel() const throw()
+    DialogModel::getAllDataSeriesWithLabel() const
 {
     ::std::vector< tSeriesWithChartTypeByName > aResult;
     ::std::vector< Reference< XDataSeriesContainer > > aContainers(
@@ -481,13 +466,13 @@ Reference< data::XDataProvider > DialogM
 DialogModel::tRolesWithRanges DialogModel::getRolesWithRanges(
     const Reference< XDataSeries > & xSeries,
     const ::rtl::OUString & aRoleOfSequenceForLabel,
-    const Reference< chart2::XChartType > & xChartType )
+    const Reference< chart2::XChartType > & xChartType ) const
 {
     DialogModel::tRolesWithRanges aResult;
     try
     {
         Reference< data::XDataSource > xSource( xSeries, uno::UNO_QUERY_THROW );
-        Sequence< Reference< data::XLabeledDataSequence > > aSeq( xSource->getDataSequences());
+        const Sequence< Reference< data::XLabeledDataSequence > > aSeq( xSource->getDataSequences());
         ::std::copy( aSeq.getConstArray(), aSeq.getConstArray() + aSeq.getLength(),
                      lcl_RolesWithRangeAppend( aResult, aRoleOfSequenceForLabel ));
         if( xChartType.is())
@@ -532,7 +517,7 @@ void DialogModel::moveSeries(
 Reference< chart2::XDataSeries > DialogModel::insertSeriesAfter(
     const Reference< XDataSeries > & xSeries,
     const Reference< XChartType > & xChartType,
-    bool bCreateDataCachedSequences /* = false */ ) throw()
+    bool bCreateDataCachedSequences /* = false */ )
 {
     m_aTimerTriggeredControllerLock.startTimer();
     ControllerLockGuard aLockedControllers( Reference< frame::XModel >( m_xChartDocument, uno::UNO_QUERY ) );
@@ -541,7 +526,7 @@ Reference< chart2::XDataSeries > DialogM
     try
     {
         sal_Int32 nSeriesInChartType = 0;
-        sal_Int32 nTotalSeries = countSeries();
+        const sal_Int32 nTotalSeries = countSeries();
         if( xChartType.is())
         {
             Reference< XDataSeriesContainer > xCnt( xChartType, uno::UNO_QUERY_THROW );
@@ -586,7 +571,7 @@ Reference< chart2::XDataSeries > DialogM
 
 void DialogModel::deleteSeries(
     const Reference< XDataSeries > & xSeries,
-    const Reference< XChartType > & xChartType ) throw()
+    const Reference< XChartType > & xChartType )
 {
     m_aTimerTriggeredControllerLock.startTimer();
     ControllerLockGuard aLockedControllers( Reference< frame::XModel >( m_xChartDocument, uno::UNO_QUERY ) );
@@ -594,7 +579,7 @@ void DialogModel::deleteSeries(
     DataSeriesHelper::deleteSeries( xSeries, xChartType );
 }
 
-Reference< data::XLabeledDataSequence > DialogModel::getCategories() const throw()
+Reference< data::XLabeledDataSequence > DialogModel::getCategories() const
 {
     Reference< data::XLabeledDataSequence > xResult;
     try
@@ -633,7 +618,7 @@ void DialogModel::setCategories( const R
     }
 }
 
-OUString DialogModel::getCategoriesRange() const throw()
+OUString DialogModel::getCategoriesRange() const
 {
     Reference< data::XLabeledDataSequence > xLSeq( getCategories());
     OUString aRange;
@@ -646,7 +631,7 @@ OUString DialogModel::getCategoriesRange
     return aRange;
 }
 
-bool DialogModel::isCategoryDiagram() const throw()
+bool DialogModel::isCategoryDiagram() const
 {
     bool bRet = false;
     if( m_xChartDocument.is())
@@ -658,7 +643,7 @@ void DialogModel::detectArguments(
     OUString & rOutRangeString,
     bool & rOutUseColumns,
     bool & rOutFirstCellAsLabel,
-    bool & rOutHasCategories ) const throw()
+    bool & rOutHasCategories ) const
 {
     try
     {
@@ -687,7 +672,7 @@ void DialogModel::startControllerLockTim
 }
 
 bool DialogModel::setData(
-    const Sequence< beans::PropertyValue > & rArguments ) throw()
+    const Sequence< beans::PropertyValue > & rArguments )
 {
     m_aTimerTriggeredControllerLock.startTimer();
     ControllerLockGuard aLockedControllers( Reference< frame::XModel >( m_xChartDocument, uno::UNO_QUERY ) );
@@ -807,10 +792,10 @@ bool DialogModel::isSeriesValid(
         sal_Int32 nFoundRoles = 0;
         DialogModel::tRolesWithRanges aRolesWithRanges;
         Reference< data::XDataSource > xSource( xSeries, uno::UNO_QUERY_THROW );
-        Sequence< Reference< data::XLabeledDataSequence > > aSeq( xSource->getDataSequences());
+        const Sequence< Reference< data::XLabeledDataSequence > > aSeq( xSource->getDataSequences());
         ::std::copy( aSeq.getConstArray(), aSeq.getConstArray() + aSeq.getLength(),
                      lcl_RolesWithRangeAppend( aRolesWithRanges, aRoleOfSequenceForLabel ));
-        Sequence< OUString > aRoles( xChartType->getSupportedMandatoryRoles());
+        const Sequence< OUString > aRoles( xChartType->getSupportedMandatoryRoles());
         for( sal_Int32 nI = 0; nI < aRoles.getLength(); ++nI )
             if( !aRoles[nI].equals( lcl_aLabelRole ) && aRolesWithRanges.find( aRoles[nI] ) != aRolesWithRanges.end() )
                 ++nFoundRoles;
@@ -818,7 +803,7 @@ bool DialogModel::isSeriesValid(
 //             if( !aRoles[nI].equals( lcl_aLabelRole ) && aRolesWithRanges.find( aRoles[nI] ) == aRolesWithRanges.end() )
 //                 return false;
         // weak condition: one mandatory role exists
-        if( aRoles.getLength() > 0 & nFoundRoles == 0 )
+        if( aRoles.getLength() > 0 && nFoundRoles == 0 )
             return false;
     }
     catch( uno::Exception & ex )
@@ -861,8 +846,11 @@ void DialogModel::applyInterpretedData(
         // styles
         if( bSetStyles && m_xTemplate.is() )
         {
-            sal_Int32 nGroup=0, nOuterSize=rNewData.Series.getLength(),
-                nSeriesCounter=0, nNewSeriesIndex = static_cast< sal_Int32 >( rSeriesToReUse.size());
+            sal_Int32 nGroup = 0;
+            sal_Int32 nSeriesCounter = 0;
+            sal_Int32 nNewSeriesIndex = static_cast< sal_Int32 >( rSeriesToReUse.size());
+            const sal_Int32 nOuterSize=rNewData.Series.getLength();
+
             for(; nGroup < nOuterSize; ++nGroup)
             {
                 Sequence< Reference< XDataSeries > > aSeries( rNewData.Series[ nGroup ] );
Index: chart2/source/controller/dialogs/DialogModel.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/DialogModel.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/DialogModel.hxx	22 May 2007 17:28:19 -0000	1.2
+++ chart2/source/controller/dialogs/DialogModel.hxx	21 Jun 2007 16:54:02 -0000	1.2.12.1
@@ -94,29 +94,29 @@ public:
             ::com::sun::star::chart2::XChartTypeTemplate > & xTemplate );
 
     ::boost::shared_ptr< RangeSelectionHelper >
-        getRangeSelectionHelper() const throw();
+        getRangeSelectionHelper() const;
 
     ::com::sun::star::uno::Reference<
         ::com::sun::star::frame::XModel >
-        getChartModel() const throw();
+        getChartModel() const;
 
     ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::data::XDataProvider >
-        getDataProvider() const throw();
+        getDataProvider() const;
 
     ::std::vector< ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::XDataSeriesContainer > >
-        getAllDataSeriesContainers() const throw();
+        getAllDataSeriesContainers() const;
 
     ::std::vector< tSeriesWithChartTypeByName >
-        getAllDataSeriesWithLabel() const throw();
+        getAllDataSeriesWithLabel() const;
 
     tRolesWithRanges getRolesWithRanges(
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::XDataSeries > & xSeries,
         const ::rtl::OUString & aRoleOfSequenceForLabel,
         const ::com::sun::star::uno::Reference<
-            ::com::sun::star::chart2::XChartType > & xChartType );
+            ::com::sun::star::chart2::XChartType > & xChartType ) const;
 
     enum eMoveDirection
     {
@@ -135,33 +135,33 @@ public:
                     ::com::sun::star::chart2::XDataSeries > & xSeries,
                 const ::com::sun::star::uno::Reference<
                     ::com::sun::star::chart2::XChartType > & xChartType,
-                bool bCreateDataCachedSequences = false ) throw();
+                bool bCreateDataCachedSequences = false );
 
     void deleteSeries(
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::XDataSeries > & xSeries,
         const ::com::sun::star::uno::Reference<
-            ::com::sun::star::chart2::XChartType > & xChartType ) throw();
+            ::com::sun::star::chart2::XChartType > & xChartType );
 
     ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::data::XLabeledDataSequence >
-        getCategories() const throw();
+        getCategories() const;
 
     void setCategories( const ::com::sun::star::uno::Reference<
                         ::com::sun::star::chart2::data::XLabeledDataSequence > & xCategories );
 
-    ::rtl::OUString getCategoriesRange() const throw();
+    ::rtl::OUString getCategoriesRange() const;
 
-    bool isCategoryDiagram() const throw();
+    bool isCategoryDiagram() const;
 
     void detectArguments(
         ::rtl::OUString & rOutRangeString,
-        bool & rOutUseColumns, bool & rOutFirstCellAsLabel, bool & rOutHasCategories ) const throw();
+        bool & rOutUseColumns, bool & rOutFirstCellAsLabel, bool & rOutHasCategories ) const;
 
     bool allArgumentsForRectRangeDetected() const;
 
     bool setData( const ::com::sun::star::uno::Sequence<
-                      ::com::sun::star::beans::PropertyValue > & rArguments ) throw();
+                      ::com::sun::star::beans::PropertyValue > & rArguments );
 
     void startControllerLockTimer();
 
Index: chart2/source/controller/dialogs/ObjectNameProvider.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/ObjectNameProvider.cxx,v
retrieving revision 1.3
retrieving revision 1.2.12.2
diff -u -u -p -r1.3 -r1.2.12.2
--- chart2/source/controller/dialogs/ObjectNameProvider.cxx	3 Jul 2007 13:37:23 -0000	1.3
+++ chart2/source/controller/dialogs/ObjectNameProvider.cxx	6 Jul 2007 16:45:56 -0000	1.2.12.2
@@ -192,7 +192,7 @@ OUString lcl_getDataPointValueText( cons
 
     if( aX.getLength() == 0 )
     {
-        rtl::OUString aCategory(String(SchResId(STR_TIP_CATEGORY_VALUE)));
+        rtl::OUString aCategory = ::rtl::OUString( String(SchResId(STR_TIP_CATEGORY_VALUE)));
 
         replaceParamterInString( aCategory
             , C2U("%CATEGORYVALUE")
Index: chart2/source/controller/dialogs/RangeSelectionHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/RangeSelectionHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/dialogs/RangeSelectionHelper.cxx	22 May 2007 17:29:07 -0000	1.2
+++ chart2/source/controller/dialogs/RangeSelectionHelper.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.2
@@ -297,58 +297,16 @@ bool RangeSelectionHelper::verifyCellRan
     if( ! xDataProvider.is())
         return false;
 
-    bool bResult = false;
+    return xDataProvider->createDataSequenceByRangeRepresentationPossible( rRangeStr );
+}
 
-    // 1. check if range is valid by converting it to XML format
-    Reference< chart2::data::XRangeXMLConversion > xConversion( xDataProvider, uno::UNO_QUERY );
-    if( xConversion.is())
-    {
-        try
-        {
-            xConversion->convertRangeToXML( rRangeStr );
-            bResult = true;
-        }
-        catch( const uno::Exception & ex )
-        {
-            bResult = false;
-        }
-    }
-    else
-    {
-        // 2. check via the XCellRangesAccess interface
-        Reference< sheet::XCellRangesAccess > xRangesAccess( getCellRangesAccess());
-        if( xRangesAccess.is() )
-        {
-            // @todo: the interface should provide a method to determine if a cell
-            // range is correct, rather than waiting for an exception
-            try
-            {
-                xRangesAccess->getCellRangesByName( rRangeStr );
-                bResult = true;
-            }
-            catch( const uno::Exception & )
-            {
-                bResult = false;
-            }
-        }
-        else
-        {
-            // 3. check via createDataSequenceByRangeRepresentation. Note, that
-            // this may only work for "simple" ranges (in Writer)
-            try
-            {
-                // if creation fails, we get an exception
-                xDataProvider->createDataSequenceByRangeRepresentation( rRangeStr );
-                bResult = true;
-            }
-            catch( const uno::Exception & ex )
-            {
-                bResult = false;
-            }
-        }
-    }
+bool RangeSelectionHelper::verifyArguments( const Sequence< beans::PropertyValue > & rArguments )
+{
+    Reference< chart2::data::XDataProvider > xDataProvider( m_xChartDocument->getDataProvider());
+    if( ! xDataProvider.is())
+        return false;
 
-    return bResult;
+    return xDataProvider->createDataSourcePossible( rArguments );
 }
 
 OUString RangeSelectionHelper::getCellRangeContent( const OUString & rRangeStr )
@@ -364,8 +322,9 @@ OUString RangeSelectionHelper::getCellRa
         {
             aResult = lcl_getTextFromRanges( xRangesAccess->getCellRangesByName( rRangeStr ) );
         }
-        catch( uno::Exception )
+        catch( const uno::Exception & ex )
         {
+            ASSERT_EXCEPTION( ex );
         }
     }
 
Index: chart2/source/controller/dialogs/RangeSelectionHelper.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/RangeSelectionHelper.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/RangeSelectionHelper.hxx	22 May 2007 17:29:17 -0000	1.2
+++ chart2/source/controller/dialogs/RangeSelectionHelper.hxx	28 Jun 2007 06:15:29 -0000	1.2.12.1
@@ -35,9 +35,8 @@
 #ifndef CHART2_RANGESELECTIONHELPER_HXX
 #define CHART2_RANGESELECTIONHELPER_HXX
 
-#ifndef _COM_SUN_STAR_CHART2_XCHARTDOCUMENT_HPP_
 #include <com/sun/star/chart2/XChartDocument.hpp>
-#endif
+#include <com/sun/star/beans/PropertyValue.hpp>
 
 namespace com { namespace sun { namespace star {
     namespace sheet{
@@ -72,6 +71,7 @@ public:
         RangeSelectionListenerParent & rListenerParent );
     void stopRangeListening( bool bRemoveListener = true );
     bool verifyCellRange( const ::rtl::OUString & rRangeStr );
+    bool verifyArguments( const ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue >& rArguments );
     ::rtl::OUString getCellRangeContent( const ::rtl::OUString & rRangeStr );
 
 private:
Index: chart2/source/controller/dialogs/RangeSelectionListener.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/RangeSelectionListener.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/RangeSelectionListener.cxx	22 May 2007 17:29:27 -0000	1.2
+++ chart2/source/controller/dialogs/RangeSelectionListener.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -67,14 +67,14 @@ void SAL_CALL RangeSelectionListener::do
     m_rParent.listeningFinished( m_aRange );
 }
 
-void SAL_CALL RangeSelectionListener::aborted( const sheet::RangeSelectionEvent& aEvent )
+void SAL_CALL RangeSelectionListener::aborted( const sheet::RangeSelectionEvent& /*aEvent*/ )
     throw (uno::RuntimeException)
 {
     m_rParent.listeningFinished( m_aRange );
 }
 
 // ____ XEventListener ____
-void SAL_CALL RangeSelectionListener::disposing( const lang::EventObject& Source )
+void SAL_CALL RangeSelectionListener::disposing( const lang::EventObject& /*Source*/ )
     throw (uno::RuntimeException)
 {
     m_rParent.disposingRangeSelection();
Index: chart2/source/controller/dialogs/TabPages.hrc
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/TabPages.hrc,v
retrieving revision 1.3
retrieving revision 1.3.12.2
diff -u -u -p -r1.3 -r1.3.12.2
--- chart2/source/controller/dialogs/TabPages.hrc	22 May 2007 17:31:10 -0000	1.3
+++ chart2/source/controller/dialogs/TabPages.hrc	13 Jul 2007 11:14:44 -0000	1.3.12.2
@@ -43,11 +43,6 @@
 #define GRP_LEGEND 1
 
 //#define TP_DATA_DESCR 901
-#define CB_VALUE 1
-#define CB_TEXT 2
-#define CB_SYMBOL 3
-#define RB_NUMBER 1
-#define RB_PERCENT 2
 
 //#define TP_ALIGNMENT 902
 ////#define FL_ORDER 2
@@ -57,24 +52,6 @@
 ////#define RBT_AUTOORDER 4
 
 //#define TP_STAT                   905
-#define FL_ERROR                    1
-#define RBT_NONE                    1
-#define RBT_VARIANT                 2
-#define RBT_SIGMA                   3
-#define RBT_PERCENT                 4
-#define RBT_BIGERROR                5
-#define RBT_CONST                   6
-#define CBX_AVERAGE                 1
-#define MTR_FLD_PERCENT             1
-#define	MTR_FLD_BIGERROR            2
-#define MTR_FLD_PLUS                3
-#define MTR_FLD_MINUS               4
-#define	FT_PERCENT_PLUS             1
-#define FT_PERCENT_MINUS            2
-#define FT_INDICATE                 3
-#define FT_REGRESS                  4
-#define CT_INDICATE                 1
-#define CT_REGRESS                  2
 #define FL_TEXTBREAK                3
 #define CBX_TEXTBREAK               2
 #define CBX_TEXTOVERLAP             4
Index: chart2/source/controller/dialogs/dlg_CreationWizard.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_CreationWizard.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/dlg_CreationWizard.cxx	22 May 2007 17:32:17 -0000	1.2
+++ chart2/source/controller/dialogs/dlg_CreationWizard.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -201,7 +201,7 @@ svt::OWizardPage* CreationWizard::create
     return pRet;
 }
 
-sal_Bool CreationWizard::leaveState( WizardState _nState )
+sal_Bool CreationWizard::leaveState( WizardState /*_nState*/ )
 {
     return m_bCanTravel;
 }
Index: chart2/source/controller/dialogs/dlg_CreationWizard_UNO.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_CreationWizard_UNO.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/dlg_CreationWizard_UNO.cxx	22 May 2007 17:32:46 -0000	1.2
+++ chart2/source/controller/dialogs/dlg_CreationWizard_UNO.cxx	10 Jul 2007 11:57:28 -0000	1.2.12.1
@@ -207,7 +207,7 @@ uno::Sequence< sal_Int8 > SAL_CALL Creat
 //-------------------------------------------------------------------------
 
 // XTerminateListener
-void SAL_CALL CreationWizardUnoDlg::queryTermination( const lang::EventObject& Event ) throw( frame::TerminationVetoException, uno::RuntimeException)
+void SAL_CALL CreationWizardUnoDlg::queryTermination( const lang::EventObject& /*Event*/ ) throw( frame::TerminationVetoException, uno::RuntimeException)
 {
 	::vos::OGuard aSolarGuard( Application::GetSolarMutex());
 
@@ -221,19 +221,19 @@ void SAL_CALL CreationWizardUnoDlg::quer
 
 //-------------------------------------------------------------------------
 
-void SAL_CALL CreationWizardUnoDlg::notifyTermination( const lang::EventObject& Event ) throw (uno::RuntimeException)
+void SAL_CALL CreationWizardUnoDlg::notifyTermination( const lang::EventObject& /*Event*/ ) throw (uno::RuntimeException)
 {
 	// we are going down, so dispose us!
 	dispose();
 }
 
-void SAL_CALL CreationWizardUnoDlg::disposing( const lang::EventObject& Source ) throw (uno::RuntimeException)
+void SAL_CALL CreationWizardUnoDlg::disposing( const lang::EventObject& /*Source*/ ) throw (uno::RuntimeException)
 {
     //Listener should deregister himself and relaese all references to the closing object.
 }
 
 //-------------------------------------------------------------------------
-void SAL_CALL CreationWizardUnoDlg::setTitle( const ::rtl::OUString& rTitle ) throw(uno::RuntimeException)
+void SAL_CALL CreationWizardUnoDlg::setTitle( const ::rtl::OUString& /*rTitle*/ ) throw(uno::RuntimeException)
 {
 }
 //-------------------------------------------------------------------------
@@ -434,25 +434,25 @@ uno::Any SAL_CALL CreationWizardUnoDlg::
 }
 
 void SAL_CALL CreationWizardUnoDlg::addPropertyChangeListener(
-        const ::rtl::OUString& aPropertyName, const uno::Reference< beans::XPropertyChangeListener >& xListener )
+        const ::rtl::OUString& /* aPropertyName */, const uno::Reference< beans::XPropertyChangeListener >& /* xListener */ )
         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
 void SAL_CALL CreationWizardUnoDlg::removePropertyChangeListener(
-    const ::rtl::OUString& aPropertyName, const uno::Reference< beans::XPropertyChangeListener >& aListener )
+    const ::rtl::OUString& /* aPropertyName */, const uno::Reference< beans::XPropertyChangeListener >& /* aListener */ )
     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
 
-void SAL_CALL CreationWizardUnoDlg::addVetoableChangeListener( const ::rtl::OUString& PropertyName, const uno::Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL CreationWizardUnoDlg::addVetoableChangeListener( const ::rtl::OUString& /* PropertyName */, const uno::Reference< beans::XVetoableChangeListener >& /* aListener */ )
     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
 
-void SAL_CALL CreationWizardUnoDlg::removeVetoableChangeListener( const ::rtl::OUString& PropertyName, const uno::Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL CreationWizardUnoDlg::removeVetoableChangeListener( const ::rtl::OUString& /* PropertyName */, const uno::Reference< beans::XVetoableChangeListener >& /* aListener */ )
     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
Index: chart2/source/controller/dialogs/dlg_InsertDataLabel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_InsertDataLabel.cxx,v
retrieving revision 1.7
retrieving revision 1.7.12.1
diff -u -u -p -r1.7 -r1.7.12.1
--- chart2/source/controller/dialogs/dlg_InsertDataLabel.cxx	22 May 2007 17:34:31 -0000	1.7
+++ chart2/source/controller/dialogs/dlg_InsertDataLabel.cxx	13 Jul 2007 11:20:01 -0000	1.7.12.1
@@ -35,187 +35,46 @@
 
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_chart2.hxx"
+
 #include "dlg_InsertDataLabel.hxx"
 #include "dlg_InsertDataLabel.hrc"
 #include "ResId.hxx"
-#include "chartview/ChartSfxItemIds.hxx"
-#include "NoWarningThisInCTOR.hxx"
 #include "ObjectNameProvider.hxx"
-
-// header for class SfxBoolItem
-#ifndef _SFXENUMITEM_HXX
-#include <svtools/eitem.hxx>
-#endif
-// header for class SvxChartDataDescrItem
-#ifndef _SVX_CHRTITEM_HXX
-#include <svx/chrtitem.hxx>
-#endif
+#include "res_DataLabel.hxx"
 
 //.............................................................................
 namespace chart
 {
 //.............................................................................
 
-/*************************************************************************
-|*
-|* Dialog zum Aendern der Beschriftungen
-|*
-\************************************************************************/
-
-SchDataDescrDlg::SchDataDescrDlg(Window* pWindow, const SfxItemSet& rInAttrs) :
+DataLabelsDialog::DataLabelsDialog(Window* pWindow, const SfxItemSet& rInAttrs, SvNumberFormatter* pFormatter) :
 	ModalDialog(pWindow, SchResId(DLG_DATA_DESCR)),
-	aCbValue(this, SchResId(CB_VALUE)),
-	aRbNumber(this, SchResId(RB_NUMBER)),
-	aRbPercent(this, SchResId(RB_PERCENT)),
-	aCbText(this, SchResId(CB_TEXT)),
-	aFlDescr(this, SchResId(FL_DESCR)),
-	aCbSymbol(this, SchResId(CB_SYMBOL)),
-	aBtnOK(this, SchResId(BTN_OK)),
-	aBtnCancel(this, SchResId(BTN_CANCEL)),
-	aBtnHelp(this, SchResId(BTN_HELP)),
+	m_aBtnOK(this, SchResId(BTN_OK)),
+	m_aBtnCancel(this, SchResId(BTN_CANCEL)),
+	m_aBtnHelp(this, SchResId(BTN_HELP)),
+    m_apDataLabelResources( new DataLabelResources(this,rInAttrs) ),
+    m_aFlDescr(this, SchResId(FL_DESCR)),
 	m_rInAttrs(rInAttrs)
 {
 	FreeResource();
-
     SetText( ObjectNameProvider::getName(OBJECTTYPE_DATA_LABELS) );
-    aFlDescr.SetText( ObjectNameProvider::getName(OBJECTTYPE_DATA_LABELS) );
-
-	aCbValue.SetClickHdl( LINK( this, SchDataDescrDlg, EnableHdl ));
-	aCbText.SetClickHdl(  LINK( this, SchDataDescrDlg, EnableHdl ));
-
+    m_aFlDescr.SetText( ObjectNameProvider::getName(OBJECTTYPE_DATA_LABELS) );
+    m_apDataLabelResources->SetNumberFormatter( pFormatter );
 	Reset();
 }
 
-/*************************************************************************
-|*
-|* Dtor
-|*
-\************************************************************************/
-
-SchDataDescrDlg::~SchDataDescrDlg()
-{
-}
-
-/*************************************************************************
-|*
-|*	handler for enable/disable 'show symbol' and options for value
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchDataDescrDlg, EnableHdl, CheckBox *, pControl )
+DataLabelsDialog::~DataLabelsDialog()
 {
-	aCbSymbol.Enable( aCbValue.IsChecked() || aCbText.IsChecked() );
-	if( pControl == &aCbValue )
-	{
-		aRbPercent.Enable( aCbValue.IsChecked() );
-		aRbNumber.Enable( aCbValue.IsChecked() );
-	}
-
-	return 0;
 }
 
-/*************************************************************************
-|*
-|*	Initialisierung
-|*
-\*************************************************************************/
-
-void SchDataDescrDlg::Reset()
+void DataLabelsDialog::Reset()
 {
-	const SfxPoolItem *pPoolItem = NULL;
-
-	// default state
-	aRbNumber.Enable( FALSE );
-	aRbPercent.Enable( FALSE );
-	aCbSymbol.Enable( FALSE );
-
-    SfxItemState aState = m_rInAttrs.GetItemState(SCHATTR_DATADESCR_SHOW_SYM, TRUE, &pPoolItem);
-	if( aState == SFX_ITEM_SET )
-		aCbSymbol.Check( ((const SfxBoolItem*)pPoolItem)->GetValue() );
-    else
-    {
-        aCbSymbol.EnableTriState( TRUE );
-        aCbSymbol.SetState( STATE_DONTKNOW );
-    }
-
-    aState = m_rInAttrs.GetItemState(SCHATTR_DATADESCR_DESCR, TRUE, &pPoolItem);
-	if( aState == SFX_ITEM_SET )
-	{
-		switch( ((const SvxChartDataDescrItem*)pPoolItem)->GetValue() )
-		{
-			case CHDESCR_VALUE:
-				aCbValue.Check();
-				aRbNumber.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			case CHDESCR_PERCENT:
-				aCbValue.Check();
-				aRbPercent.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			case CHDESCR_TEXT:
-				aCbText.Check();
-				EnableHdl( &aCbText );
-				break;
-
-			case CHDESCR_TEXTANDPERCENT:
-				aCbText.Check();
-				aCbValue.Check();
-				aRbPercent.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			case CHDESCR_TEXTANDVALUE:
-				aCbText.Check();
-				aCbValue.Check();
-				aRbNumber.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			default:
-				break;
-		}
-	}
-    else
-    {
-        aCbText.EnableTriState( TRUE );
-        aCbText.SetState( STATE_DONTKNOW );
-
-        aCbValue.EnableTriState( TRUE );
-        aCbValue.SetState( STATE_DONTKNOW );
-    }
-	if( !aRbNumber.IsChecked() && !aRbPercent.IsChecked() )
-		aRbNumber.Check();
+	m_apDataLabelResources->Reset(m_rInAttrs);
 }
 
-/*************************************************************************
-|*
-|*    Fuellt uebergebenen Item-Set mit Dialogbox-Attributen
-|*
-\*************************************************************************/
-
-void SchDataDescrDlg::GetAttr(SfxItemSet& rOutAttrs)
+void DataLabelsDialog::FillItemSet(SfxItemSet& rOutAttrs)
 {
-	BOOL bText = aCbText.IsChecked();
-	SvxChartDataDescr eDescr;
-
-	if( aCbValue.IsChecked() )
-	{
-		if( aRbNumber.IsChecked() )
-			eDescr = (bText? CHDESCR_TEXTANDVALUE : CHDESCR_VALUE);
-		else
-			eDescr = (bText? CHDESCR_TEXTANDPERCENT : CHDESCR_PERCENT);
-	}
-	else if( aCbText.IsChecked() )
-		eDescr = CHDESCR_TEXT;
-	else
-		eDescr = CHDESCR_NONE;
-
-    rOutAttrs.Put(SvxChartDataDescrItem(eDescr, SCHATTR_DATADESCR_DESCR));
-	rOutAttrs.Put(SfxBoolItem( SCHATTR_DATADESCR_SHOW_SYM,
-                                aCbSymbol.IsChecked()) );
+    m_apDataLabelResources->FillItemSet(rOutAttrs);
 }
 
 //.............................................................................
Index: chart2/source/controller/dialogs/dlg_InsertDataLabel.hrc
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_InsertDataLabel.hrc,v
retrieving revision 1.3
retrieving revision 1.3.12.1
diff -u -u -p -r1.3 -r1.3.12.1
--- chart2/source/controller/dialogs/dlg_InsertDataLabel.hrc	22 May 2007 17:34:41 -0000	1.3
+++ chart2/source/controller/dialogs/dlg_InsertDataLabel.hrc	13 Jul 2007 11:13:17 -0000	1.3.12.1
@@ -39,8 +39,3 @@
 #define BTN_CANCEL 1
 #define BTN_HELP 1
 #define FL_DESCR 1
-#define CB_VALUE 1
-#define CB_TEXT 2
-#define CB_SYMBOL 3
-#define RB_NUMBER 1
-#define RB_PERCENT 2
Index: chart2/source/controller/dialogs/dlg_InsertStatistic.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_InsertStatistic.cxx,v
retrieving revision 1.11
retrieving revision 1.11.12.2
diff -u -u -p -r1.11 -r1.11.12.2
--- chart2/source/controller/dialogs/dlg_InsertStatistic.cxx	22 May 2007 17:35:41 -0000	1.11
+++ chart2/source/controller/dialogs/dlg_InsertStatistic.cxx	6 Jul 2007 13:25:22 -0000	1.11.12.2
@@ -35,581 +35,110 @@
 
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_chart2.hxx"
+
 #include "dlg_InsertStatistic.hxx"
 #include "dlg_InsertStatistic.hrc"
+#include "res_ErrorBar.hxx"
 #include "ResId.hxx"
-#include "chartview/ChartSfxItemIds.hxx"
 #include "Strings.hrc"
-#include "Bitmaps.hrc"
-#include "Bitmaps_HC.hrc"
-#include "NoWarningThisInCTOR.hxx"
-
-// header for class SfxBoolItem
-#ifndef _SFXENUMITEM_HXX
-#include <svtools/eitem.hxx>
+#include "chartview/ExplicitValueProvider.hxx"
+#include "ChartModelHelper.hxx"
+#include "ObjectIdentifier.hxx"
+#include "DiagramHelper.hxx"
+#include "AxisHelper.hxx"
+
+#ifndef _COM_SUN_STAR_CHART2_XAXIS_HPP_
+#include <com/sun/star/chart2/XAxis.hpp>
 #endif
+#ifndef _COM_SUN_STAR_CHART2_XDIAGRAM_HPP_
+#include <com/sun/star/chart2/XDiagram.hpp>
+#endif
+
+using namespace ::com::sun::star;
+using namespace ::com::sun::star::chart2;
 
 //.............................................................................
 namespace chart
 {
 //.............................................................................
 
-// macro for selecting a normal or high contrast bitmap the stack variable
-// bIsHighContrast must exist and reflect the correct state
-
-#define SELECT_BITMAP(name) Bitmap( SchResId( bIsHighContrast ? name ## _HC : name ))
-
-enum StatIndicator
+SchDataStatisticsDlg::SchDataStatisticsDlg(Window* pWindow, const SfxItemSet &rMyAttrs)
+    : ModalDialog(pWindow, SchResId(DLG_DATA_STAT)),
+    rInAttrs(rMyAttrs),
+    aBtnOK (this, SchResId (BTN_OK)),
+    aBtnCancel (this, SchResId (BTN_CANCEL)),
+    aBtnHelp (this, SchResId (BTN_HELP)),
+    m_apErrorBarResources( new ErrorBarResources(this,rInAttrs) )
 {
-	INDICATE_NONE,
-	INDICATE_BOTH,
-	INDICATE_UP,
-	INDICATE_DOWN
-};
-
-enum StatRegression
-{
-	REGRESSION_NONE,
-	REGRESSION_LINE,
-	REGRESSION_LOG,
-	REGRESSION_EXP,
-	REGRESSION_POW
-};
-
-/*************************************************************************
-|*
-|* Dialog fuer die Statistikfunktionen
-|*
-\************************************************************************/
-
-SchDataStatisticsDlg::SchDataStatisticsDlg(Window           *pWindow,
-										   const SfxItemSet &rMyAttrs) :
-	ModalDialog(pWindow, SchResId(DLG_DATA_STAT)),
-	aCbxAverage (this, SchResId (CBX_AVERAGE)),
-	aRbtNone (this, SchResId (RBT_NONE)),
-	aRbtVariant (this, SchResId (RBT_VARIANT)),
-	aRbtSigma (this, SchResId (RBT_SIGMA)),
-	aRbtPercent (this, SchResId (RBT_PERCENT)),
-	aRbtBigError (this, SchResId (RBT_BIGERROR)),
-	aRbtConst (this, SchResId (RBT_CONST)),
-	aFlDescr (this, SchResId (FL_ERROR)),
-	aMtrFldPercent (this, SchResId (MTR_FLD_PERCENT)),
-	aMtrFldBigError (this, SchResId (MTR_FLD_BIGERROR)),
-	aFTConstPlus (this, SchResId (FT_PERCENT_PLUS)),
-	aMtrFldConstPlus (this, SchResId (MTR_FLD_PLUS)),
-	aFTConstMinus (this, SchResId (FT_PERCENT_MINUS)),
-	aMtrFldConstMinus (this, SchResId (MTR_FLD_MINUS)),
-	aFTIndicate (this, SchResId (FT_INDICATE)),
-	aFTRegress (this, SchResId (FT_REGRESS)),
-	aSet (this, SchResId (CT_INDICATE)),
-	aRegression (this, SchResId (CT_REGRESS)),
-	aBtnOK (this, SchResId (BTN_OK)),
-	aBtnCancel (this, SchResId (BTN_CANCEL)),
-	aBtnHelp (this, SchResId (BTN_HELP)),
-    m_bEnableRegression( false ),
-	rInAttrs(rMyAttrs),
-    m_eErrorKind( CHERROR_NONE ),
-    m_bErrorKindUnique( true ),
-    m_eIndicate( CHINDICATE_BOTH ),
-    m_bIndicatorUnique( true ),
-    m_eRegression( CHREGRESS_NONE ),
-    m_bRegressionUnique( true ),
-
-    m_bPlusUnique( true ),
-    m_bMinusUnique( true )
-{
-	FreeResource();
-
+    FreeResource();
     this->SetText( String( SchResId( STR_PAGE_STATISTICS ) ) );
-
-	aRbtNone.SetClickHdl(LINK(this, SchDataStatisticsDlg, RBtnClick));
-	aRbtVariant.SetClickHdl(LINK(this, SchDataStatisticsDlg, RBtnClick));
-	aRbtSigma.SetClickHdl(LINK(this, SchDataStatisticsDlg, RBtnClick));
-	aRbtPercent.SetClickHdl(LINK(this, SchDataStatisticsDlg, RBtnClick));
-	aRbtBigError.SetClickHdl(LINK(this, SchDataStatisticsDlg, RBtnClick));
-	aRbtConst.SetClickHdl(LINK(this, SchDataStatisticsDlg, RBtnClick));
-	aCbxAverage.SetClickHdl(LINK(this, SchDataStatisticsDlg, CbxClick));
-// 	aMtrFldConstPlus.SetLoseFocusHdl(LINK(this, SchDataStatisticsDlg, EditLoseFocusHdl));
-// 	aMtrFldConstMinus.SetLoseFocusHdl(LINK(this, SchDataStatisticsDlg, EditLoseFocusHdl));
-
-    FillValueSets();
-
-    aSet.SetStyle (aSet.GetStyle () /*| WB_ITEMBORDER | WB_DOUBLEBORDER*/ | WB_NAMEFIELD /*| WB_VSCROLL*/ );
-	aSet.SetColCount(5);
-	aSet.SetLineCount(1);
-	aSet.SetExtraSpacing(2);
-	aSet.SetSelectHdl(LINK(this, SchDataStatisticsDlg, SelectIndicate));
-
-	aRegression.SetStyle (aSet.GetStyle () /*| WB_ITEMBORDER | WB_DOUBLEBORDER*/ | WB_NAMEFIELD /*| WB_VSCROLL*/ );
-	aRegression.SetColCount(5);
-	aRegression.SetLineCount(1);
-	aRegression.SetExtraSpacing(2);
-	aRegression.SetSelectHdl(LINK(this, SchDataStatisticsDlg, SelectRegression));
-
-	Reset();
 }
 
-/*************************************************************************
-|*
-|* Dtor
-|*
-\************************************************************************/
-
 SchDataStatisticsDlg::~SchDataStatisticsDlg()
 {
 }
 
-/*************************************************************************
-|*
-|*	Handler fuer Mittelwert-Button
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchDataStatisticsDlg, CbxClick, CheckBox *, pBtn )
-{
-	return 0;
-}
-
-/*************************************************************************
-|*
-|*	Handler fuer die Radiobuttons
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchDataStatisticsDlg, RBtnClick, Button *, pBtn )
+void SchDataStatisticsDlg::Reset()
 {
-	aMtrFldPercent.Enable (pBtn == &aRbtPercent);
-	aMtrFldBigError.Enable (pBtn == &aRbtBigError);
-	aMtrFldConstPlus.Enable (pBtn == &aRbtConst);
-	aMtrFldConstMinus.Enable (pBtn == &aRbtConst);
-	aSet.Enable (pBtn != &aRbtNone);
-	aFTIndicate.Enable (pBtn != &aRbtNone);
-
-	if (pBtn == &aRbtPercent) m_eErrorKind = CHERROR_PERCENT;
-	if (pBtn == &aRbtBigError) m_eErrorKind = CHERROR_BIGERROR;
-	if (pBtn == &aRbtConst) m_eErrorKind = CHERROR_CONST;
-
-	if (pBtn == &aRbtNone)
-	{
-		aSet.Hide ();
-		m_eErrorKind = CHERROR_NONE;
-	}
-	else
-	{
-		aSet.Show ();
-		if (pBtn == &aRbtVariant) m_eErrorKind = CHERROR_VARIANT;
-			else if (pBtn == &aRbtSigma) m_eErrorKind = CHERROR_SIGMA;
-	}
-    m_bErrorKindUnique = true;
-
-	return 0;
+    m_apErrorBarResources->Reset(rInAttrs);
 }
 
-/*************************************************************************
-|*
-|*	Initialisierung
-|*
-\*************************************************************************/
-
-void SchDataStatisticsDlg::Reset()
+void SchDataStatisticsDlg::FillItemSet(SfxItemSet& rOutAttrs)
 {
-	const SfxPoolItem *pPoolItem = NULL;
-    SfxItemState aState = SFX_ITEM_UNKNOWN;
-
-    aState = rInAttrs.GetItemState( SCHATTR_STAT_AVERAGE, TRUE, &pPoolItem );
-    if( aState == SFX_ITEM_DONTCARE )
-    {
-        aCbxAverage.EnableTriState( TRUE );
-        aCbxAverage.SetState( STATE_DONTKNOW );
-    }
-    else
-    {
-        aCbxAverage.EnableTriState( FALSE );
-        if( aState == SFX_ITEM_SET )
-            aCbxAverage.Check( static_cast< const SfxBoolItem * >( pPoolItem )->GetValue());
-    }
-
-    m_eErrorKind = CHERROR_NONE;
-    aState = rInAttrs.GetItemState( SCHATTR_STAT_KIND_ERROR, TRUE, &pPoolItem );
-    m_bErrorKindUnique = ( aState != SFX_ITEM_DONTCARE );
-
-    if( aState == SFX_ITEM_SET )
-        m_eErrorKind = ((const SvxChartKindErrorItem*) pPoolItem)->GetValue();
-
-    if( m_bErrorKindUnique )
-    {
-        aRbtNone.Check    ( m_eErrorKind == CHERROR_NONE );
-        aRbtVariant.Check ( m_eErrorKind == CHERROR_VARIANT );
-        aRbtSigma.Check   ( m_eErrorKind == CHERROR_SIGMA );
-        aRbtPercent.Check ( m_eErrorKind == CHERROR_PERCENT );
-        aRbtBigError.Check( m_eErrorKind == CHERROR_BIGERROR );
-        aRbtConst.Check   ( m_eErrorKind == CHERROR_CONST );
-    }
-    else
-    {
-        aRbtNone.Check    ( FALSE );
-        aRbtVariant.Check ( FALSE );
-        aRbtSigma.Check   ( FALSE );
-        aRbtPercent.Check ( FALSE );
-        aRbtBigError.Check( FALSE );
-        aRbtConst.Check   ( FALSE );
-    }
-
-    aSet.Enable (m_eErrorKind != CHERROR_NONE);
-	aFTIndicate.Enable (m_eErrorKind != CHERROR_NONE);
-
-	if (m_eErrorKind == CHERROR_NONE) aSet.Hide ();
-	else aSet.Show ();
-
-    aState = rInAttrs.GetItemState( SCHATTR_STAT_CONSTPLUS, TRUE, &pPoolItem );
-    m_bPlusUnique = ( aState != SFX_ITEM_DONTCARE );
-    sal_Int32 nPlusValue = 0;
-    if( aState == SFX_ITEM_SET )
-    {
-        nPlusValue = static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue() * 10.0);
-		aMtrFldConstPlus.SetValue( nPlusValue );
-    }
-
-    aState = rInAttrs.GetItemState( SCHATTR_STAT_CONSTMINUS, TRUE, &pPoolItem );
-    m_bMinusUnique = ( aState != SFX_ITEM_DONTCARE );
-    sal_Int32 nMinusValue = 0;
-    if( aState == SFX_ITEM_SET )
-    {
-        nMinusValue = static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue() * 10.0);
-		aMtrFldConstMinus.SetValue( nMinusValue );
-    }
-
-    if( m_bPlusUnique && m_bMinusUnique )
-    {
-        sal_Int32 nAvg = (nPlusValue + nMinusValue) / 2;
-        aMtrFldPercent.SetValue(  nAvg );
-        aMtrFldBigError.SetValue( nAvg );
-    }
-
-//     if (rInAttrs.GetItemState(SCHATTR_STAT_PERCENT, TRUE, &pPoolItem) == SFX_ITEM_SET)
-// 		aMtrFldPercent.SetValue( static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue()));
-// 	else aMtrFldPercent.SetValue(0);
-
-// 	if (rInAttrs.GetItemState(SCHATTR_STAT_BIGERROR, TRUE, &pPoolItem) == SFX_ITEM_SET)
-// 		aMtrFldBigError.SetValue( static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue()));
-// 	else aMtrFldBigError.SetValue(0);
-
-    if( m_bEnableRegression )
-    {
-        aFTRegress.Show ();
-        aRegression.Show ();
-    }
-    else
-    {
-        aRegression.Hide ();
-        aFTRegress.Hide ();
-    }
-
-	if ((m_eErrorKind == CHERROR_NONE) ||
-		(m_eErrorKind == CHERROR_VARIANT) ||
-		(m_eErrorKind == CHERROR_SIGMA))
-	{
-		aMtrFldPercent.Enable (FALSE);
-		aMtrFldBigError.Enable (FALSE);
-		aMtrFldConstPlus.Enable (FALSE);
-		aMtrFldConstMinus.Enable (FALSE);
-	}
-	else if (m_eErrorKind == CHERROR_PERCENT)
-		 {
-			 aMtrFldPercent.Enable (TRUE);
-			 aMtrFldBigError.Enable (FALSE);
-			 aMtrFldConstPlus.Enable (FALSE);
-			 aMtrFldConstMinus.Enable (FALSE);
-		 }
-		 else if (m_eErrorKind == CHERROR_BIGERROR)
-			  {
-				  aMtrFldPercent.Enable (FALSE);
-				  aMtrFldBigError.Enable (TRUE);
-				  aMtrFldConstPlus.Enable (FALSE);
-				  aMtrFldConstMinus.Enable (FALSE);
-			  }
-			  else if (m_eErrorKind == CHERROR_CONST)
-				   {
-					   aMtrFldPercent.Enable (FALSE);
-					   aMtrFldBigError.Enable (FALSE);
-					   aMtrFldConstPlus.Enable (TRUE);
-					   aMtrFldConstMinus.Enable (TRUE);
-				   }
-
-	aState = rInAttrs.GetItemState( SCHATTR_STAT_INDICATE, TRUE, &pPoolItem );
-    m_bIndicatorUnique = ( aState != SFX_ITEM_DONTCARE );
-    if( aState == SFX_ITEM_SET)
-		m_eIndicate = ((const SvxChartIndicateItem * ) pPoolItem)->GetValue();
-
-    if( m_bIndicatorUnique )
-    {
-        switch( m_eIndicate )
-        {
-            case CHINDICATE_NONE :
-                aSet.SelectItem(INDICATE_NONE + 1);
-                break;
-            case CHINDICATE_BOTH :
-                aSet.SelectItem(INDICATE_BOTH + 1);
-                break;
-            case CHINDICATE_UP :
-                aSet.SelectItem(INDICATE_UP + 1);
-                break;
-            case CHINDICATE_DOWN :
-                aSet.SelectItem(INDICATE_DOWN + 1);
-                break;
-        }                                                             \
-    }
-    else
-        aSet.SetNoSelection();
-
-	aState = rInAttrs.GetItemState( SCHATTR_STAT_REGRESSTYPE, TRUE, &pPoolItem );
-    m_bRegressionUnique = ( aState != SFX_ITEM_DONTCARE );
-    if( aState == SFX_ITEM_SET )
-        m_eRegression = ((const SvxChartRegressItem * ) pPoolItem)->GetValue();
-
-    if( m_bRegressionUnique )
-    {
-        switch( m_eRegression )
-        {
-            case CHREGRESS_NONE :
-                aRegression.SelectItem(REGRESSION_NONE + 1);
-                break;
-            case CHREGRESS_LINEAR :
-                aRegression.SelectItem(REGRESSION_LINE + 1);
-                break;
-            case CHREGRESS_LOG :
-                aRegression.SelectItem(REGRESSION_LOG + 1);
-                break;
-            case CHREGRESS_EXP :
-                aRegression.SelectItem(REGRESSION_EXP + 1);
-                break;
-            case CHREGRESS_POWER :
-                aRegression.SelectItem(REGRESSION_POW + 1);
-                break;
-        }
-    }
-
+    m_apErrorBarResources->FillItemSet(rOutAttrs);
 }
 
-/*************************************************************************
-|*
-|*    Fuellt uebergebenen Item-Set mit Dialogbox-Attributen
-|*
-\*************************************************************************/
-
-void SchDataStatisticsDlg::GetAttr(SfxItemSet& rOutAttrs)
+void SchDataStatisticsDlg::DataChanged( const DataChangedEvent& rDCEvt )
 {
-    if( aCbxAverage.GetState() != STATE_DONTKNOW )
-        rOutAttrs.Put( SfxBoolItem( SCHATTR_STAT_AVERAGE, aCbxAverage.IsChecked() ));
-    if( m_bErrorKindUnique )
-        rOutAttrs.Put( SvxChartKindErrorItem( m_eErrorKind, SCHATTR_STAT_KIND_ERROR ));
-
-    if( m_bIndicatorUnique )
-        rOutAttrs.Put( SvxChartIndicateItem( m_eIndicate, SCHATTR_STAT_INDICATE ));
-
-	if( m_bEnableRegression &&
-        m_bRegressionUnique )
-        rOutAttrs.Put( SvxChartRegressItem( m_eRegression, SCHATTR_STAT_REGRESSTYPE ));
+    ModalDialog::DataChanged( rDCEvt );
 
-    if( m_bErrorKindUnique )
-    {
-        switch( m_eErrorKind )
-        {
-            case CHERROR_PERCENT :
-                if( aMtrFldPercent.IsModified())
-                    rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldPercent.GetValue () / 10.0, SCHATTR_STAT_PERCENT));
-                break;
-            case CHERROR_BIGERROR :
-                if( aMtrFldBigError.IsModified())
-                    rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldBigError.GetValue () / 10.0, SCHATTR_STAT_BIGERROR));
-                break;
-            case CHERROR_CONST :
-                if( aMtrFldConstPlus.IsModified())
-                    rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldConstPlus.GetValue () / 10.0, SCHATTR_STAT_CONSTPLUS));
-                if( aMtrFldConstMinus.IsModified())
-                    rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldConstMinus.GetValue () / 10.0, SCHATTR_STAT_CONSTMINUS));
-                break;
-            case CHERROR_NONE:
-            case CHERROR_VARIANT:
-            case CHERROR_SIGMA:
-                // nothing
-                break;
-        }
-    }
+    if ( (rDCEvt.GetType() == DATACHANGED_SETTINGS) && (rDCEvt.GetFlags() & SETTINGS_STYLE) )
+        m_apErrorBarResources->FillValueSets();
 }
 
-/*************************************************************************
-|*
-|*    Bearbeitet das Werteset der Fehlerbalken
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchDataStatisticsDlg, SelectIndicate, void *, EMPTYARG )
+void SchDataStatisticsDlg::EnableTrendLine( bool bEnable )
 {
-	StatIndicator eSelection = (StatIndicator) aSet.GetSelectItemId();
-
-    switch (eSelection - 1)
-	{
-		case INDICATE_NONE :
-			m_eIndicate = CHINDICATE_NONE;
-			break;
-
-		case INDICATE_BOTH :
-			m_eIndicate = CHINDICATE_BOTH;
-			break;
-
-		case INDICATE_UP :
-			m_eIndicate = CHINDICATE_UP;
-			break;
-
-		case INDICATE_DOWN :
-			m_eIndicate = CHINDICATE_DOWN;
-			break;
-	}
-
-	aSet.SelectItem(eSelection);
-	aSet.Show ();
-    m_bIndicatorUnique = true;
-
-	return 0;
+    m_apErrorBarResources->EnableTrendLine( bEnable );
+    Reset();
 }
 
-/*************************************************************************
-|*
-|*    Bearbeitet das Werteset der Regression
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchDataStatisticsDlg, SelectRegression, void *, EMPTYARG )
+void SchDataStatisticsDlg::SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth )
 {
-	StatRegression eSelection = (StatRegression) aRegression.GetSelectItemId();
-
-    switch (eSelection - 1)
-	{
-		case REGRESSION_NONE :
-			m_eRegression = CHREGRESS_NONE;
-			break;
-
-		case REGRESSION_LINE :
-			m_eRegression = CHREGRESS_LINEAR;
-			break;
-
-		case REGRESSION_LOG :
-			m_eRegression = CHREGRESS_LOG;
-			break;
-
-		case REGRESSION_EXP :
-			m_eRegression = CHREGRESS_EXP;
-			break;
-
-		case REGRESSION_POW :
-			m_eRegression = CHREGRESS_POWER;
-			break;
-	}
-
-	aRegression.SelectItem(eSelection);
-	aRegression.Show ();
-    m_bRegressionUnique = true;
-
-	return 0;
+    m_apErrorBarResources->SetAxisMinorStepWidthForErrorBarDecimals( fMinorStepWidth );
 }
 
-/*************************************************************************
-|*
-|*    Bearbeite das Valueset
-|*
-\*************************************************************************/
-
-// IMPL_LINK( SchDataStatisticsDlg, EditLoseFocusHdl, Control *, pControl )
-// {
-// 	if ((double) aMtrFldConstPlus.GetValue () == 0.0)
-// 	{
-// 		if ((double) aMtrFldConstMinus.GetValue () == 0.0)
-// 		{
-// 			m_eIndicate = CHINDICATE_NONE;
-// 			aSet.SelectItem(INDICATE_NONE + 1);
-// 		}
-// 		else if (m_eIndicate != CHINDICATE_NONE)
-// 			 {
-// 				 m_eIndicate = CHINDICATE_DOWN;
-// 				 aSet.SelectItem(INDICATE_DOWN + 1);
-// 			 }
-// 	}
-// 	else if ((double) aMtrFldConstMinus.GetValue () == 0.0)
-// 		 {
-// 			 if (m_eIndicate != CHINDICATE_NONE)
-// 			 {
-// 				 m_eIndicate = CHINDICATE_UP;
-// 				 aSet.SelectItem(INDICATE_UP + 1);
-// 			 }
-// 		 }
-// 		 else
-// 		 {
-// 			 m_eIndicate = CHINDICATE_BOTH;
-// 			 aSet.SelectItem(INDICATE_BOTH + 1);
-// 		 }
-
-// 	return 0;
-// }
-
-void SchDataStatisticsDlg::FillValueSets()
+//static
+double SchDataStatisticsDlg::getAxisMinorStepWidthForErrorBarDecimals(
+            const uno::Reference< frame::XModel >& xChartModel,
+            const uno::Reference< uno::XInterface >& xChartView,
+            const ::rtl::OUString& rSelectedObjectCID )
 {
-    bool bIsHighContrast = ( true && GetDisplayBackground().GetColor().IsDark() );
+    double fStepWidth = 0.001;
 
-    if( aSet.GetItemCount() == 0 )
-    {
-        aSet.InsertItem( INDICATE_NONE + 1, SELECT_BITMAP( BMP_INDICATE_NONE ),
-                         String(SchResId(STR_INDICATE_NONE)));
-        aSet.InsertItem( INDICATE_BOTH + 1, SELECT_BITMAP( BMP_INDICATE_BOTH ),
-                         String(SchResId(STR_INDICATE_BOTH)));
-        aSet.InsertItem( INDICATE_DOWN + 1, SELECT_BITMAP( BMP_INDICATE_DOWN ),
-                         String(SchResId(STR_INDICATE_DOWN)));
-        aSet.InsertItem( INDICATE_UP + 1, SELECT_BITMAP( BMP_INDICATE_UP ),
-                         String(SchResId(STR_INDICATE_UP)));
-    }
-    else
-    {
-        aSet.SetItemImage( INDICATE_NONE + 1, SELECT_BITMAP( BMP_INDICATE_NONE ));
-        aSet.SetItemImage( INDICATE_BOTH + 1, SELECT_BITMAP( BMP_INDICATE_BOTH ));
-        aSet.SetItemImage( INDICATE_DOWN + 1, SELECT_BITMAP( BMP_INDICATE_DOWN ));
-        aSet.SetItemImage( INDICATE_UP + 1, SELECT_BITMAP( BMP_INDICATE_UP ));
-    }
-
-    if( aRegression.GetItemCount() == 0 )
-    {
-        aRegression.InsertItem( REGRESSION_NONE + 1, SELECT_BITMAP( BMP_REGRESSION_NONE ),
-                                String(SchResId(STR_REGRESSION_NONE)));
-        aRegression.InsertItem( REGRESSION_LINE + 1, SELECT_BITMAP( BMP_REGRESSION_LINEAR ),
-                                String(SchResId(STR_REGRESSION_LINEAR)));
-        aRegression.InsertItem( REGRESSION_LOG + 1, SELECT_BITMAP( BMP_REGRESSION_LOG ),
-                                String(SchResId(STR_REGRESSION_LOG)));
-        aRegression.InsertItem( REGRESSION_EXP + 1, SELECT_BITMAP( BMP_REGRESSION_EXP ),
-                                String(SchResId(STR_REGRESSION_EXP)));
-        aRegression.InsertItem( REGRESSION_POW + 1, SELECT_BITMAP( BMP_REGRESSION_POWER ),
-                                String(SchResId(STR_REGRESSION_POWER)));
-    }
-    else
+    ExplicitValueProvider* pExplicitValueProvider( ExplicitValueProvider::getExplicitValueProvider(xChartView) );
+    if( pExplicitValueProvider )
     {
-        aRegression.SetItemImage( REGRESSION_NONE + 1, SELECT_BITMAP( BMP_REGRESSION_NONE ));
-        aRegression.SetItemImage( REGRESSION_LINE + 1, SELECT_BITMAP( BMP_REGRESSION_LINEAR ));
-        aRegression.SetItemImage( REGRESSION_LOG + 1, SELECT_BITMAP( BMP_REGRESSION_LOG ));
-        aRegression.SetItemImage( REGRESSION_EXP + 1, SELECT_BITMAP( BMP_REGRESSION_EXP ));
-        aRegression.SetItemImage( REGRESSION_POW + 1, SELECT_BITMAP( BMP_REGRESSION_POWER ));
+        uno::Reference< XAxis > xAxis;
+        uno::Reference< XDiagram > xDiagram( ChartModelHelper::findDiagram( xChartModel ) );
+        uno::Reference< XDataSeries > xSeries = ObjectIdentifier::getDataSeriesForCID( rSelectedObjectCID, xChartModel );
+        xAxis = DiagramHelper::getAttachedAxis( xSeries, xDiagram );
+        if(!xAxis.is())
+            xAxis = AxisHelper::getAxis( 1/*nDimensionIndex*/, true/*bMainAxis*/, xDiagram );
+        if(xAxis.is())
+        {
+            ExplicitScaleData aExplicitScale;
+            ExplicitIncrementData aExplicitIncrement;
+            pExplicitValueProvider->getExplicitValuesForAxis( xAxis,aExplicitScale, aExplicitIncrement );
+
+            fStepWidth = aExplicitIncrement.Distance;
+            if( aExplicitIncrement.SubIncrements.getLength()  && aExplicitIncrement.SubIncrements[0].IntervalCount>0 )
+                fStepWidth=fStepWidth/double(aExplicitIncrement.SubIncrements[0].IntervalCount);
+            else
+                fStepWidth/=10;
+        }
     }
-}
-
-void SchDataStatisticsDlg::DataChanged( const DataChangedEvent& rDCEvt )
-{
-    ModalDialog::DataChanged( rDCEvt );
-
-    if ( (rDCEvt.GetType() == DATACHANGED_SETTINGS) && (rDCEvt.GetFlags() & SETTINGS_STYLE) )
-        FillValueSets();
-}
 
-void SchDataStatisticsDlg::EnableRegression( bool bEnable /* = true */ )
-{
-    m_bEnableRegression = bEnable;
-    Reset();
+    return fStepWidth;
 }
 
 //.............................................................................
Index: chart2/source/controller/dialogs/dlg_InsertStatistic.hrc
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_InsertStatistic.hrc,v
retrieving revision 1.3
retrieving revision 1.3.12.1
diff -u -u -p -r1.3 -r1.3.12.1
--- chart2/source/controller/dialogs/dlg_InsertStatistic.hrc	22 May 2007 17:35:53 -0000	1.3
+++ chart2/source/controller/dialogs/dlg_InsertStatistic.hrc	5 Jul 2007 12:54:07 -0000	1.3.12.1
@@ -37,21 +37,3 @@
 #define BTN_OK 1
 #define BTN_CANCEL 1
 #define BTN_HELP 1
-#define CBX_AVERAGE 1
-#define FL_ERROR 1
-#define RBT_NONE 1
-#define RBT_VARIANT 2
-#define RBT_SIGMA 3
-#define RBT_PERCENT 4
-#define RBT_BIGERROR 5
-#define RBT_CONST 6
-#define MTR_FLD_PERCENT 1
-#define MTR_FLD_BIGERROR 2
-#define MTR_FLD_PLUS 3
-#define MTR_FLD_MINUS 4
-#define FT_PERCENT_PLUS 1
-#define FT_PERCENT_MINUS 2
-#define FT_INDICATE 3
-#define FT_REGRESS 4
-#define CT_INDICATE 1
-#define CT_REGRESS 2
Index: chart2/source/controller/dialogs/dlg_ObjectProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/dlg_ObjectProperties.cxx,v
retrieving revision 1.16
retrieving revision 1.16.12.3
diff -u -u -p -r1.16 -r1.16.12.3
--- chart2/source/controller/dialogs/dlg_ObjectProperties.cxx	22 May 2007 17:37:01 -0000	1.16
+++ chart2/source/controller/dialogs/dlg_ObjectProperties.cxx	13 Jul 2007 11:18:01 -0000	1.16.12.3
@@ -268,6 +268,11 @@ void SchAttribTabDlg::setSymbolInformati
     m_pAutoSymbolGraphic = pAutoSymbolGraphic;
 }
 
+void SchAttribTabDlg::SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth )
+{
+    m_fAxisMinorStepWidthForErrorBarDecimals = fMinorStepWidth;
+}
+
 SchAttribTabDlg::SchAttribTabDlg(Window* pParent,
                                  const SfxItemSet* pAttr,
                                  const ObjectPropertiesDialogParameter* pDialogParameter,
@@ -283,6 +288,7 @@ SchAttribTabDlg::SchAttribTabDlg(Window*
     , m_pNumberFormatter(0)
     , m_pSymbolShapeProperties(NULL)
     , m_pAutoSymbolGraphic(NULL)
+    , m_fAxisMinorStepWidthForErrorBarDecimals(0.1)
 {
     FreeResource();
     
@@ -323,7 +329,7 @@ SchAttribTabDlg::SchAttribTabDlg(Window*
             }
             AddTabPage(RID_SVXPAGE_CHAR_NAME, String(SchResId(STR_PAGE_CHARACTERS)));
             AddTabPage(RID_SVXPAGE_CHAR_EFFECTS, String(SchResId(STR_PAGE_FONT_EFFECTS)));
-            AddTabPage(TP_DATA_DESCR, String(SchResId(STR_OBJECT_DATALABELS)), SchDataDescrTabPage::Create, NULL);
+            AddTabPage(TP_DATA_DESCR, String(SchResId(STR_OBJECT_DATALABELS)), DataLabelsTabPage::Create, NULL);
             if( m_pParameter->HasStatisticProperties() )
                 AddTabPage(TP_STAT, String(SchResId(STR_PAGE_STATISTICS)), SchStatisticTabPage::Create, NULL);
             if( m_pParameter->HasGeometryProperties() )
@@ -493,6 +499,12 @@ void SchAttribTabDlg::PageCreated(USHORT
                 rAxisTabPage.SetNumFormatter( &aNumberFormatter );
             }
             break;
+//DLNF         case TP_DATA_DESCR:
+//DLNF             {
+//DLNF                 DataLabelsTabPage & rLabelPage = static_cast< DataLabelsTabPage & >( rPage );
+//DLNF                 rLabelPage.SetNumberFormatter( m_pNumberFormatter );
+//DLNF             }
+//DLNF             break;
 
         case RID_SVXPAGE_NUMBERFORMAT:
            	aSet.Put (SvxNumberInfoItem( m_pNumberFormatter, (const USHORT)SID_ATTR_NUMBERFORMAT_INFO));
@@ -500,8 +512,10 @@ void SchAttribTabDlg::PageCreated(USHORT
             break;
 
         case TP_STAT:
-            static_cast< SchStatisticTabPage & >( rPage ).EnableRegression(
+            static_cast< SchStatisticTabPage & >( rPage ).EnableTrendLine(
                 m_pParameter->HasRegressionProperties() );
+            static_cast< SchStatisticTabPage & >( rPage ).SetAxisMinorStepWidthForErrorBarDecimals(
+                m_fAxisMinorStepWidthForErrorBarDecimals );
             break;
     }
 }
Index: chart2/source/controller/dialogs/makefile.mk
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/makefile.mk,v
retrieving revision 1.11
retrieving revision 1.10.12.3
diff -u -u -p -r1.11 -r1.10.12.3
--- chart2/source/controller/dialogs/makefile.mk	3 Jul 2007 13:38:39 -0000	1.11
+++ chart2/source/controller/dialogs/makefile.mk	13 Jul 2007 11:11:14 -0000	1.10.12.3
@@ -63,8 +63,10 @@ SLOFILES=   	\
 				$(SLO)$/DialogModel.obj \
                 $(SLO)$/TitleDialogData.obj \
                 $(SLO)$/res_Titles.obj \
+                $(SLO)$/res_ErrorBar.obj \
                 $(SLO)$/res_BarGeometry.obj \
                 $(SLO)$/res_LegendPosition.obj \
+                $(SLO)$/res_DataLabel.obj \
                 $(SLO)$/ChartTypeDialogController.obj \
                 $(SLO)$/tp_ChartType.obj \
                 $(SLO)$/tp_RangeChooser.obj \
Index: chart2/source/controller/dialogs/res_DataLabel.cxx
===================================================================
RCS file: chart2/source/controller/dialogs/res_DataLabel.cxx
diff -N chart2/source/controller/dialogs/res_DataLabel.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ chart2/source/controller/dialogs/res_DataLabel.cxx	13 Jul 2007 11:03:13 -0000	1.1.4.2
@@ -0,0 +1,317 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_chart2.hxx"
+
+#include "res_DataLabel.hxx"
+#include "res_DataLabel_IDs.hrc"
+
+#include "Strings.hrc"
+#include "ResId.hxx"
+#include "chartview/ChartSfxItemIds.hxx"
+#include "NoWarningThisInCTOR.hxx"
+//DLNF #include "dlg_NumberFormat.hxx"
+
+// header for class SvxNumberInfoItem
+#ifndef _SVX_NUMINF_HXX
+#include <svx/numinf.hxx>
+#endif
+#ifndef _SFXENUMITEM_HXX
+#include <svtools/eitem.hxx>
+#endif
+#ifndef _SVX_CHRTITEM_HXX
+#include <svx/chrtitem.hxx>
+#endif
+// for SfxInt32Item
+#ifndef _SFXINTITEM_HXX
+#include <svtools/intitem.hxx>
+#endif
+// header for define RET_OK
+#ifndef _SV_MSGBOX_HXX
+#include <vcl/msgbox.hxx>
+#endif
+#ifndef _SVX_SVXIDS_HRC
+#include <svx/svxids.hrc>
+#endif
+// header for SvNumberFormatter
+#ifndef _ZFORLIST_HXX
+#include <svtools/zforlist.hxx>
+#endif
+
+//.............................................................................
+namespace chart
+{
+//.............................................................................
+
+namespace
+{
+
+void lcl_ReadNumberFormatFromItemSet( const SfxItemSet& rSet, USHORT nValueWhich, USHORT nSourceFormatWhich, ULONG& rnFormatKeyOut, bool& rbSourceFormatOut )
+{
+    const SfxPoolItem *pItem1 = NULL;
+    if( rSet.GetItemState( nValueWhich, TRUE, &pItem1 ) == SFX_ITEM_SET )
+    {
+        const SfxUInt32Item * pNumItem = dynamic_cast< const SfxUInt32Item * >( pItem1 );
+        if( pNumItem )
+            rnFormatKeyOut = pNumItem->GetValue();
+    }
+
+    const SfxPoolItem *pItem2 = NULL;
+    if( rSet.GetItemState( nSourceFormatWhich, TRUE, &pItem2 ) == SFX_ITEM_SET )
+    {
+        const SfxBoolItem * pBoolItem = dynamic_cast< const SfxBoolItem * >( pItem2 );
+        if( pBoolItem )
+            rbSourceFormatOut = pBoolItem->GetValue();
+    }
+}
+
+}//end anonymous namespace
+
+DataLabelResources::DataLabelResources( Window* pWindow, const SfxItemSet& rInAttrs )
+    : m_aCbValue(pWindow, SchResId(CB_VALUE)),
+    m_aRbNumber(pWindow, SchResId(RB_NUMBER)),
+    m_aRbPercent(pWindow, SchResId(RB_PERCENT)),
+//DLNF    m_aPB_NumberFormatForValue(pWindow, SchResId(PB_NUMBERFORMAT)),
+//DLNF    m_aPB_NumberFormatForPercent(pWindow, SchResId(PB_PERCENT_NUMBERFORMAT)),
+    m_aCbText(pWindow, SchResId(CB_TEXT)),
+    m_aCbSymbol(pWindow, SchResId(CB_SYMBOL)),
+    m_pNumberFormatter(0),
+    m_nNumberFormatForValue(0),
+    m_nNumberFormatForPercent(11),
+    m_bSourceFormatForValue(true),
+    m_bSourceFormatForPercent(true),
+    m_pWindow(pWindow),
+    m_pPool(rInAttrs.GetPool())
+{
+//DLNF    Size aPBSize( m_aPB_NumberFormatForPercent.GetSizePixel() );
+//DLNF    long nMinWidth = ::std::max( m_aPB_NumberFormatForPercent.CalcMinimumSize().getWidth(), m_aPB_NumberFormatForValue.CalcMinimumSize().getWidth() );
+//DLNF    aPBSize.setWidth( nMinWidth+20 );//the min with is to small to fit, hm... so add alittle
+
+//DLNF    m_aPB_NumberFormatForValue.SetSizePixel( aPBSize );
+//DLNF    m_aPB_NumberFormatForPercent.SetSizePixel( aPBSize );
+
+//DLNF    m_aPB_NumberFormatForValue.SetClickHdl( LINK( this, DataLabelResources, NumberFormatDialogHdl ) );
+//DLNF    m_aPB_NumberFormatForPercent.SetClickHdl( LINK( this, DataLabelResources, NumberFormatDialogHdl ) );
+    m_aCbValue.SetClickHdl( LINK( this, DataLabelResources, CheckHdl ));
+    m_aCbText.SetClickHdl(  LINK( this, DataLabelResources, CheckHdl ));
+    m_aCbSymbol.SetClickHdl(  LINK( this, DataLabelResources, CheckHdl ));
+
+//DLNF    lcl_ReadNumberFormatFromItemSet( rInAttrs, SID_ATTR_NUMBERFORMAT_VALUE, SID_ATTR_NUMBERFORMAT_SOURCE, m_nNumberFormatForValue, m_bSourceFormatForValue );
+//DLNF    lcl_ReadNumberFormatFromItemSet( rInAttrs, SCHATTR_PERCENT_NUMBERFORMAT_VALUE, SCHATTR_PERCENT_NUMBERFORMAT_SOURCE, m_nNumberFormatForPercent, m_bSourceFormatForPercent );
+}
+
+DataLabelResources::~DataLabelResources()
+{
+}
+
+void DataLabelResources::SetNumberFormatter( SvNumberFormatter* pFormatter )
+{
+    m_pNumberFormatter = pFormatter;
+}
+//DLNF
+/*
+IMPL_LINK( DataLabelResources, NumberFormatDialogHdl, PushButton *, pButton )
+{
+    if( !m_pPool || !m_pNumberFormatter )
+    {
+        DBG_ERROR("Missing item pool or number formatter");
+        return 1;
+    }
+
+    if( pButton == &m_aPB_NumberFormatForValue && !m_aRbNumber.IsChecked())
+        m_aRbNumber.Check();
+    else if( pButton == &m_aPB_NumberFormatForPercent && !m_aRbPercent.IsChecked())
+        m_aRbPercent.Check();
+
+    SfxItemSet aNumberSet = NumberFormatDialog::CreateEmptyItemSetForNumberFormatDialog( *m_pPool );
+    aNumberSet.Put (SvxNumberInfoItem( m_pNumberFormatter, (const USHORT)SID_ATTR_NUMBERFORMAT_INFO));
+
+    bool bPercent = ( pButton == &m_aPB_NumberFormatForPercent );
+
+    ULONG& rnFormatKey = bPercent ? m_nNumberFormatForPercent : m_nNumberFormatForValue;
+    bool& rUseSourceFormat = bPercent ? m_bSourceFormatForPercent : m_bSourceFormatForValue;
+
+    aNumberSet.Put( SfxUInt32Item( SID_ATTR_NUMBERFORMAT_VALUE, rnFormatKey ));
+    aNumberSet.Put( SfxBoolItem( SID_ATTR_NUMBERFORMAT_SOURCE, rUseSourceFormat ));
+
+    NumberFormatDialog aDlg(m_pWindow, aNumberSet);
+    if( bPercent )
+        aDlg.SetText( String( SchResId( STR_DLG_NUMBERFORMAT_FOR_PERCENTAGE_VALUE ) ) );
+    if( RET_OK == aDlg.Execute() )
+    {
+        const SfxItemSet* pResult = aDlg.GetOutputItemSet();
+        if( pResult )
+            lcl_ReadNumberFormatFromItemSet( *pResult, SID_ATTR_NUMBERFORMAT_VALUE, SID_ATTR_NUMBERFORMAT_SOURCE, rnFormatKey, rUseSourceFormat );
+    }
+    return 0;
+}
+*/
+IMPL_LINK( DataLabelResources, CheckHdl, CheckBox*, pBox )
+{
+    if( pBox == &m_aCbValue || pBox == &m_aCbText )
+    {
+        m_aCbValue.EnableTriState( FALSE );
+        m_aCbText.EnableTriState( FALSE );
+        m_aCbSymbol.EnableTriState( FALSE );
+    }
+    else if( pBox == &m_aCbSymbol )
+        m_aCbSymbol.EnableTriState( FALSE );
+
+    EnableControls();
+    
+    return 0;
+}
+
+void DataLabelResources::EnableControls()
+{
+    m_aCbSymbol.Enable( m_aCbValue.IsChecked() || m_aCbText.IsChecked() );
+
+    m_aRbPercent.Enable( m_aCbValue.IsChecked() );
+    m_aRbNumber.Enable( m_aCbValue.IsChecked() );
+
+//DLNF    m_aPB_NumberFormatForValue.Enable( m_pNumberFormatter && m_aCbValue.IsChecked() );
+//DLNF    m_aPB_NumberFormatForPercent.Enable( m_pNumberFormatter && m_aCbValue.IsChecked() );
+}
+
+BOOL DataLabelResources::FillItemSet( SfxItemSet& rOutAttrs ) const
+{
+    BOOL bText = m_aCbText.IsChecked();
+    SvxChartDataDescr eDescr;
+
+    if( m_aCbValue.IsChecked() )
+    {
+        if( m_aRbNumber.IsChecked() )
+        {
+            eDescr = (bText? CHDESCR_TEXTANDVALUE : CHDESCR_VALUE);
+//DLNF            rOutAttrs.Put( SfxUInt32Item( SID_ATTR_NUMBERFORMAT_VALUE, m_nNumberFormatForValue ));
+//DLNF            rOutAttrs.Put( SfxBoolItem( SID_ATTR_NUMBERFORMAT_SOURCE, m_bSourceFormatForValue ));
+        }
+        else
+        {
+            eDescr = (bText? CHDESCR_TEXTANDPERCENT : CHDESCR_PERCENT);
+//DLNF            rOutAttrs.Put( SfxUInt32Item( SCHATTR_PERCENT_NUMBERFORMAT_VALUE, m_nNumberFormatForPercent ));
+//DLNF            rOutAttrs.Put( SfxBoolItem( SCHATTR_PERCENT_NUMBERFORMAT_SOURCE, m_bSourceFormatForPercent ));
+        }
+    }
+    else if( m_aCbText.IsChecked() )
+        eDescr = CHDESCR_TEXT;
+    else
+        eDescr = CHDESCR_NONE;
+
+    if( m_aCbValue.GetState()!= STATE_DONTKNOW || m_aCbText.GetState()!= STATE_DONTKNOW )
+    {
+        rOutAttrs.Put(SvxChartDataDescrItem(eDescr, SCHATTR_DATADESCR_DESCR));
+        rOutAttrs.Put(SfxBoolItem( SCHATTR_DATADESCR_SHOW_SYM, m_aCbSymbol.IsChecked()) );
+    }
+    return TRUE;
+}
+
+void DataLabelResources::Reset(const SfxItemSet& rInAttrs)
+{
+    const SfxPoolItem *pPoolItem = NULL;
+
+    // default state
+    m_aRbNumber.Enable( FALSE );
+    m_aRbPercent.Enable( FALSE );
+    m_aCbSymbol.Enable( FALSE );
+
+    m_aCbValue.EnableTriState( FALSE );
+    m_aCbText.EnableTriState( FALSE );
+    m_aCbSymbol.EnableTriState( FALSE );
+
+    if( rInAttrs.GetItemState(SCHATTR_DATADESCR_SHOW_SYM, TRUE, &pPoolItem) == SFX_ITEM_SET )
+        m_aCbSymbol.Check( ((const SfxBoolItem*)pPoolItem)->GetValue() );
+    else
+    {
+        m_aCbSymbol.EnableTriState( TRUE );
+        m_aCbSymbol.SetState( STATE_DONTKNOW );
+    }
+
+    if( rInAttrs.GetItemState(SCHATTR_DATADESCR_DESCR,
+                              TRUE, &pPoolItem) == SFX_ITEM_SET )
+    {
+        switch( ((const SvxChartDataDescrItem*)pPoolItem)->GetValue() )
+        {
+            case CHDESCR_VALUE:
+                m_aCbValue.Check();
+                m_aRbNumber.Check();
+                break;
+
+            case CHDESCR_PERCENT:
+                m_aCbValue.Check();
+                m_aRbPercent.Check();
+                break;
+
+            case CHDESCR_TEXT:
+                m_aCbText.Check();
+                break;
+
+            case CHDESCR_TEXTANDPERCENT:
+                m_aCbText.Check();
+                m_aCbValue.Check();
+                m_aRbPercent.Check();
+                break;
+
+            case CHDESCR_TEXTANDVALUE:
+                m_aCbText.Check();
+                m_aCbValue.Check();
+                m_aRbNumber.Check();
+                break;
+
+            default:
+                break;
+        }
+    }
+    else
+    {
+        m_aCbText.EnableTriState( TRUE );
+        m_aCbText.SetState( STATE_DONTKNOW );
+
+        m_aCbValue.EnableTriState( TRUE );
+        m_aCbValue.SetState( STATE_DONTKNOW );
+    }
+    if( !m_aRbNumber.IsChecked() && !m_aRbPercent.IsChecked() )
+        m_aRbNumber.Check();
+
+//DLNF    lcl_ReadNumberFormatFromItemSet( rInAttrs, SID_ATTR_NUMBERFORMAT_VALUE, SID_ATTR_NUMBERFORMAT_SOURCE, m_nNumberFormatForValue, m_bSourceFormatForValue );
+//DLNF    lcl_ReadNumberFormatFromItemSet( rInAttrs, SCHATTR_PERCENT_NUMBERFORMAT_VALUE, SCHATTR_PERCENT_NUMBERFORMAT_SOURCE, m_nNumberFormatForPercent, m_bSourceFormatForPercent );
+
+    EnableControls();
+}
+
+//.............................................................................
+} //namespace chart
+//.............................................................................
Index: chart2/source/controller/dialogs/res_DataLabel.hxx
===================================================================
RCS file: chart2/source/controller/dialogs/res_DataLabel.hxx
diff -N chart2/source/controller/dialogs/res_DataLabel.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ chart2/source/controller/dialogs/res_DataLabel.hxx	13 Jul 2007 10:59:03 -0000	1.1.4.2
@@ -0,0 +1,92 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef CHART2_RES_DATALABEL_HXX
+#define CHART2_RES_DATALABEL_HXX
+
+// header for class CheckBox
+#ifndef _SV_BUTTON_HXX
+#include <vcl/button.hxx>
+#endif
+// header for class SfxItemSet
+#ifndef _SFXITEMSET_HXX
+#include <svtools/itemset.hxx>
+#endif
+
+class SvNumberFormatter;
+
+//.............................................................................
+namespace chart
+{
+//.............................................................................
+
+class DataLabelResources
+{
+public:
+    DataLabelResources( Window* pParent, const SfxItemSet& rInAttrs );
+    virtual ~DataLabelResources();
+
+    BOOL FillItemSet(SfxItemSet& rOutAttrs) const;
+    void Reset(const SfxItemSet& rInAttrs);
+
+    void SetNumberFormatter( SvNumberFormatter* pFormatter );
+    
+private:
+    CheckBox            m_aCbValue;
+    RadioButton         m_aRbNumber;
+    RadioButton         m_aRbPercent;
+//DLNF    PushButton          m_aPB_NumberFormatForValue;
+//DLNF    PushButton          m_aPB_NumberFormatForPercent;
+    CheckBox            m_aCbText;
+    CheckBox            m_aCbSymbol;
+
+    SvNumberFormatter*  m_pNumberFormatter;
+    ULONG               m_nNumberFormatForValue;
+    ULONG               m_nNumberFormatForPercent;
+    bool                m_bSourceFormatForValue;
+    bool                m_bSourceFormatForPercent;
+
+    Window*             m_pWindow;
+    SfxItemPool*        m_pPool;
+
+//DLNF    DECL_LINK(NumberFormatDialogHdl, PushButton * );
+    DECL_LINK(CheckHdl, CheckBox* );
+    void EnableControls();
+};
+
+//.............................................................................
+} //namespace chart
+//.............................................................................
+
+#endif
Index: chart2/source/controller/dialogs/res_DataLabel_IDs.hrc
===================================================================
RCS file: chart2/source/controller/dialogs/res_DataLabel_IDs.hrc
diff -N chart2/source/controller/dialogs/res_DataLabel_IDs.hrc
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ chart2/source/controller/dialogs/res_DataLabel_IDs.hrc	13 Jul 2007 11:09:41 -0000	1.1.4.2
@@ -0,0 +1,43 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#define CB_VALUE 1
+#define CB_TEXT 2
+#define CB_SYMBOL 3
+#define RB_NUMBER 1
+#define RB_PERCENT 2
+
+//DLNF #define PB_NUMBERFORMAT 20
+//DLNF #define PB_PERCENT_NUMBERFORMAT 21
Index: chart2/source/controller/dialogs/res_DataLabel_tmpl.hrc
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/res_DataLabel_tmpl.hrc,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/controller/dialogs/res_DataLabel_tmpl.hrc	22 May 2007 17:39:35 -0000	1.5
+++ chart2/source/controller/dialogs/res_DataLabel_tmpl.hrc	13 Jul 2007 11:14:05 -0000	1.5.12.1
@@ -36,6 +36,7 @@
 #define _CHART2_RESOURCE_DATALABEL_HXX
 
 #include "HelpIds.hrc"
+#include "res_DataLabel_IDs.hrc"
 
 #define RESOURCE_DATALABEL( xpos, ypos ) \
 CheckBox CB_VALUE \
Index: chart2/source/controller/dialogs/res_ErrorBar.cxx
===================================================================
RCS file: chart2/source/controller/dialogs/res_ErrorBar.cxx
diff -N chart2/source/controller/dialogs/res_ErrorBar.cxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ chart2/source/controller/dialogs/res_ErrorBar.cxx	10 Jul 2007 13:38:13 -0000	1.1.2.5
@@ -0,0 +1,495 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+// MARKER(update_precomp.py): autogen include statement, do not remove
+#include "precompiled_chart2.hxx"
+
+#include "res_ErrorBar.hxx"
+#include "res_ErrorBar_IDs.hrc"
+#include "ResId.hxx"
+#include "Strings.hrc"
+#include "Bitmaps.hrc"
+#include "Bitmaps_HC.hrc"
+
+#ifndef INCLUDED_RTL_MATH_HXX
+#include <rtl/math.hxx>
+#endif
+
+//.............................................................................
+namespace chart
+{
+//.............................................................................
+
+// macro for selecting a normal or high contrast bitmap the stack variable
+// bIsHighContrast must exist and reflect the correct state
+#define SELECT_BITMAP(name) Bitmap( SchResId( bIsHighContrast ? name ## _HC : name ))
+
+enum StatIndicator
+{
+    INDICATE_NONE,
+    INDICATE_BOTH,
+    INDICATE_UP,
+    INDICATE_DOWN
+};
+
+enum StatTrendLine
+{
+    TRENDLINE_NONE,
+    TRENDLINE_LINE,
+    TRENDLINE_LOG,
+    TRENDLINE_EXP,
+    TRENDLINE_POW
+};
+
+ErrorBarResources::ErrorBarResources( Window* pWindow, const SfxItemSet& rInAttrs )
+    : m_aCbxAverage (pWindow, SchResId (CBX_AVERAGE)),
+    m_aFlErrorCategory (pWindow, SchResId (FL_ERROR)),
+    m_aRbtNone (pWindow, SchResId (RBT_NONE)),
+    m_aRbtVariant (pWindow, SchResId (RBT_VARIANT)),
+    m_aRbtSigma (pWindow, SchResId (RBT_SIGMA)),
+    m_aRbtPercent (pWindow, SchResId (RBT_PERCENT)),
+    m_aRbtBigError (pWindow, SchResId (RBT_BIGERROR)),
+    m_aRbtConst (pWindow, SchResId (RBT_CONST)),
+    m_aMtrFldPercent (pWindow, SchResId (MTR_FLD_PERCENT)),
+    m_aMtrFldBigError (pWindow, SchResId (MTR_FLD_BIGERROR)),
+    m_aFTConstPlus (pWindow, SchResId (FT_PERCENT_PLUS)),
+    m_aMtrFldConstPlus (pWindow, SchResId (MTR_FLD_PLUS)),
+    m_aFTConstMinus (pWindow, SchResId (FT_PERCENT_MINUS)),
+    m_aMtrFldConstMinus (pWindow, SchResId (MTR_FLD_MINUS)),
+    m_aFTIndicate (pWindow, SchResId (FT_INDICATE)),
+    m_aIndicatorSet (pWindow, SchResId (CT_INDICATE)),
+    m_aFTTrendLine (pWindow, SchResId (FT_REGRESS)),
+    m_aTrendLineSet (pWindow, SchResId (CT_REGRESS)),
+    m_bEnableTrendLine( false ),
+    m_eErrorKind( CHERROR_NONE ),
+    m_eIndicate( CHINDICATE_BOTH ),
+    m_eTrendLineType( CHREGRESS_NONE ),
+    m_bErrorKindUnique( true ),
+    m_bIndicatorUnique( true ),
+    m_bTrendLineUnique( true ),
+    m_bPlusUnique( true ),
+    m_bMinusUnique( true )
+{
+    m_aRbtNone.SetClickHdl(LINK(this, ErrorBarResources, RBtnClick));
+    m_aRbtVariant.SetClickHdl(LINK(this, ErrorBarResources, RBtnClick));
+    m_aRbtSigma.SetClickHdl(LINK(this, ErrorBarResources, RBtnClick));
+    m_aRbtPercent.SetClickHdl(LINK(this, ErrorBarResources, RBtnClick));
+    m_aRbtBigError.SetClickHdl(LINK(this, ErrorBarResources, RBtnClick));
+    m_aRbtConst.SetClickHdl(LINK(this, ErrorBarResources, RBtnClick));
+
+    FillValueSets();
+
+    m_aIndicatorSet.SetStyle (m_aIndicatorSet.GetStyle () /*| WB_ITEMBORDER | WB_DOUBLEBORDER*/ | WB_NAMEFIELD /*| WB_VSCROLL*/ );
+    m_aIndicatorSet.SetColCount(5);
+    m_aIndicatorSet.SetLineCount(1);
+    m_aIndicatorSet.SetExtraSpacing(2);
+    m_aIndicatorSet.SetSelectHdl(LINK(this, ErrorBarResources, SelectIndicate));
+
+    m_aTrendLineSet.SetStyle (m_aIndicatorSet.GetStyle () /*| WB_ITEMBORDER | WB_DOUBLEBORDER*/ | WB_NAMEFIELD /*| WB_VSCROLL*/ );
+    m_aTrendLineSet.SetColCount(5);
+    m_aTrendLineSet.SetLineCount(1);
+    m_aTrendLineSet.SetExtraSpacing(2);
+    m_aTrendLineSet.SetSelectHdl(LINK(this, ErrorBarResources, SelectTrendLine));
+
+    Reset( rInAttrs );
+}
+
+ErrorBarResources::~ErrorBarResources()
+{
+}
+
+void ErrorBarResources::EnableTrendLine( bool bEnable )
+{
+    m_bEnableTrendLine = bEnable;
+}
+
+void ErrorBarResources::SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth )
+{
+    USHORT nDecimalDigits = 1;
+    if( fMinorStepWidth < 0 )
+        fMinorStepWidth *= -1.0;
+    if( !::rtl::math::approxEqual(fMinorStepWidth,0.0) )
+    {
+        sal_Int32 nExponent = static_cast< sal_Int32 >( ::rtl::math::approxFloor( log10( fMinorStepWidth ) ) );
+        if(nExponent<0)
+            nDecimalDigits = static_cast< sal_uInt16 >( -nExponent );
+    }
+    m_aMtrFldConstPlus.SetDecimalDigits(nDecimalDigits);
+    m_aMtrFldConstMinus.SetDecimalDigits(nDecimalDigits);
+}
+
+IMPL_LINK( ErrorBarResources, RBtnClick, Button *, pBtn )
+{
+	m_aMtrFldPercent.Enable (pBtn == &m_aRbtPercent);
+	m_aMtrFldBigError.Enable (pBtn == &m_aRbtBigError);
+	m_aMtrFldConstPlus.Enable (pBtn == &m_aRbtConst);
+	m_aMtrFldConstMinus.Enable (pBtn == &m_aRbtConst);
+    m_aFTConstPlus.Enable (pBtn == &m_aRbtConst);
+    m_aFTConstMinus.Enable (pBtn == &m_aRbtConst);
+    m_aIndicatorSet.Show (pBtn != &m_aRbtNone);
+    m_aFTIndicate.Show (pBtn != &m_aRbtNone);
+
+	if (pBtn == &m_aRbtPercent) m_eErrorKind = CHERROR_PERCENT;
+    else if (pBtn == &m_aRbtBigError) m_eErrorKind = CHERROR_BIGERROR;
+    else if (pBtn == &m_aRbtConst) m_eErrorKind = CHERROR_CONST;
+    else if (pBtn == &m_aRbtNone) m_eErrorKind = CHERROR_NONE;
+    else if (pBtn == &m_aRbtVariant) m_eErrorKind = CHERROR_VARIANT;
+    else if (pBtn == &m_aRbtSigma) m_eErrorKind = CHERROR_SIGMA;
+
+    m_bErrorKindUnique = true;
+
+    if( pBtn != &m_aRbtNone )
+    {
+        if( m_eIndicate == CHINDICATE_NONE )
+        {
+            m_bIndicatorUnique = true;
+            m_eIndicate = CHINDICATE_BOTH;
+            m_aIndicatorSet.SelectItem(INDICATE_BOTH + 1);
+        }
+    }
+    
+	return 0;
+}
+
+IMPL_LINK( ErrorBarResources, SelectIndicate, void *, EMPTYARG )
+{
+	StatIndicator eSelection = (StatIndicator) m_aIndicatorSet.GetSelectItemId();
+
+	switch (eSelection - 1)
+	{
+		case INDICATE_NONE :
+			m_eIndicate = CHINDICATE_NONE;
+			break;
+
+		case INDICATE_BOTH :
+			m_eIndicate = CHINDICATE_BOTH;
+			break;
+
+		case INDICATE_UP :
+			m_eIndicate = CHINDICATE_UP;
+			break;
+
+		case INDICATE_DOWN :
+			m_eIndicate = CHINDICATE_DOWN;
+			break;
+	}
+
+	m_aIndicatorSet.SelectItem( static_cast< sal_uInt16 >(eSelection));
+	m_aIndicatorSet.Show ();
+    m_aFTIndicate.Show();
+
+    m_bIndicatorUnique = true;
+
+	return 0;
+}
+
+IMPL_LINK( ErrorBarResources, SelectTrendLine, void *, EMPTYARG )
+{
+	StatTrendLine eSelection = (StatTrendLine) m_aTrendLineSet.GetSelectItemId();
+
+    switch (eSelection - 1)
+	{
+		case TRENDLINE_NONE :
+			m_eTrendLineType = CHREGRESS_NONE;
+			break;
+
+		case TRENDLINE_LINE :
+			m_eTrendLineType = CHREGRESS_LINEAR;
+			break;
+
+		case TRENDLINE_LOG :
+			m_eTrendLineType = CHREGRESS_LOG;
+			break;
+
+		case TRENDLINE_EXP :
+			m_eTrendLineType = CHREGRESS_EXP;
+			break;
+
+		case TRENDLINE_POW :
+			m_eTrendLineType = CHREGRESS_POWER;
+			break;
+	}
+
+	m_aTrendLineSet.SelectItem( static_cast< sal_uInt16 >(eSelection));
+	m_aTrendLineSet.Show ();
+    m_aFTTrendLine.Show ();
+    m_bTrendLineUnique = true;
+
+    return 0;
+}
+
+void ErrorBarResources::Reset(const SfxItemSet& rInAttrs)
+{
+	const SfxPoolItem *pPoolItem = NULL;
+    SfxItemState aState = SFX_ITEM_UNKNOWN;
+
+	aState = rInAttrs.GetItemState( SCHATTR_STAT_AVERAGE, TRUE, &pPoolItem );
+    if( aState == SFX_ITEM_DONTCARE )
+    {
+        m_aCbxAverage.EnableTriState( TRUE );
+        m_aCbxAverage.SetState( STATE_DONTKNOW );
+    }
+    else
+    {
+        m_aCbxAverage.EnableTriState( FALSE );
+        if( aState == SFX_ITEM_SET )
+            m_aCbxAverage.Check( static_cast< const SfxBoolItem * >( pPoolItem )->GetValue());
+    }
+
+    //-----
+
+	m_eErrorKind = CHERROR_NONE;
+    aState = rInAttrs.GetItemState( SCHATTR_STAT_KIND_ERROR, TRUE, &pPoolItem );
+    m_bErrorKindUnique = ( aState != SFX_ITEM_DONTCARE );
+
+    if( aState == SFX_ITEM_SET )
+        m_eErrorKind = ((const SvxChartKindErrorItem*) pPoolItem)->GetValue();
+
+    if( m_bErrorKindUnique )
+    {
+        m_aRbtNone.Check    ( m_eErrorKind == CHERROR_NONE );
+        m_aRbtVariant.Check ( m_eErrorKind == CHERROR_VARIANT );
+        m_aRbtSigma.Check   ( m_eErrorKind == CHERROR_SIGMA );
+        m_aRbtPercent.Check ( m_eErrorKind == CHERROR_PERCENT );
+        m_aRbtBigError.Check( m_eErrorKind == CHERROR_BIGERROR );
+        m_aRbtConst.Check   ( m_eErrorKind == CHERROR_CONST );
+    }
+    else
+    {
+        m_aRbtNone.Check    ( FALSE );
+        m_aRbtVariant.Check ( FALSE );
+        m_aRbtSigma.Check   ( FALSE );
+        m_aRbtPercent.Check ( FALSE );
+        m_aRbtBigError.Check( FALSE );
+        m_aRbtConst.Check   ( FALSE );
+    }
+
+    m_aIndicatorSet.Show(m_eErrorKind != CHERROR_NONE);
+    m_aFTIndicate.Show(m_eErrorKind != CHERROR_NONE);
+
+    //-----
+
+    aState = rInAttrs.GetItemState( SCHATTR_STAT_CONSTPLUS, TRUE, &pPoolItem );
+    m_bPlusUnique = ( aState != SFX_ITEM_DONTCARE );
+    double fPlusValue = 0.0;
+    if( aState == SFX_ITEM_SET )
+    {
+        fPlusValue = ((const SvxDoubleItem*) pPoolItem)->GetValue();
+        sal_Int32 nPlusValue = static_cast< sal_Int32 >( fPlusValue * pow(10.0,m_aMtrFldConstPlus.GetDecimalDigits()) );
+		m_aMtrFldConstPlus.SetValue( nPlusValue );
+    }
+
+    aState = rInAttrs.GetItemState( SCHATTR_STAT_CONSTMINUS, TRUE, &pPoolItem );
+    m_bMinusUnique = ( aState != SFX_ITEM_DONTCARE );
+    double fMinusValue = 0.0;
+    if( aState == SFX_ITEM_SET )
+    {
+        fMinusValue = ((const SvxDoubleItem*) pPoolItem)->GetValue();
+        sal_Int32 nMinusValue = static_cast< sal_Int32 >( fMinusValue * pow(10.0,m_aMtrFldConstMinus.GetDecimalDigits()) );
+		m_aMtrFldConstMinus.SetValue( nMinusValue );
+    }
+
+    if( m_bPlusUnique && m_bMinusUnique )
+    {
+        sal_Int32 nAvg = static_cast< sal_Int32 >( ((fPlusValue + fMinusValue)/ 2.0) * pow(10.0,m_aMtrFldPercent.GetDecimalDigits()) );
+        m_aMtrFldBigError.SetDecimalDigits( m_aMtrFldPercent.GetDecimalDigits() );
+        m_aMtrFldPercent.SetValue(  nAvg );
+        m_aMtrFldBigError.SetValue( nAvg );
+    }
+
+    m_aMtrFldPercent.Enable (m_eErrorKind == CHERROR_PERCENT);
+    m_aMtrFldBigError.Enable (m_eErrorKind == CHERROR_BIGERROR);
+    m_aMtrFldConstPlus.Enable (m_eErrorKind == CHERROR_CONST);
+    m_aMtrFldConstMinus.Enable (m_eErrorKind == CHERROR_CONST);
+    m_aFTConstPlus.Enable (m_eErrorKind == CHERROR_CONST);
+    m_aFTConstMinus.Enable (m_eErrorKind == CHERROR_CONST);
+
+
+    aState = rInAttrs.GetItemState( SCHATTR_STAT_INDICATE, TRUE, &pPoolItem );
+    m_bIndicatorUnique = ( aState != SFX_ITEM_DONTCARE );
+    if( aState == SFX_ITEM_SET)
+		m_eIndicate = ((const SvxChartIndicateItem * ) pPoolItem)->GetValue();
+
+    if( m_bIndicatorUnique )
+    {
+        switch( m_eIndicate )
+        {
+            case CHINDICATE_NONE :
+                m_aIndicatorSet.SelectItem(INDICATE_NONE + 1);
+                break;
+            case CHINDICATE_BOTH :
+                m_aIndicatorSet.SelectItem(INDICATE_BOTH + 1);
+                break;
+            case CHINDICATE_UP :
+                m_aIndicatorSet.SelectItem(INDICATE_UP + 1);
+                break;
+            case CHINDICATE_DOWN :
+                m_aIndicatorSet.SelectItem(INDICATE_DOWN + 1);
+                break;
+        }                                                             \
+    }
+    else
+        m_aIndicatorSet.SetNoSelection();
+
+    //----- Trend Lines
+
+    if( m_bEnableTrendLine )
+    {
+        m_aFTTrendLine.Show ();
+        m_aTrendLineSet.Show ();
+    }
+    else
+    {
+        m_aTrendLineSet.Hide ();
+        m_aFTTrendLine.Hide ();
+    }
+	
+	aState = rInAttrs.GetItemState( SCHATTR_STAT_REGRESSTYPE, TRUE, &pPoolItem );
+    m_bTrendLineUnique = ( aState != SFX_ITEM_DONTCARE );
+    if( aState == SFX_ITEM_SET )
+        m_eTrendLineType = ((const SvxChartRegressItem * ) pPoolItem)->GetValue();
+
+    if( m_bTrendLineUnique )
+    {
+        switch( m_eTrendLineType )
+        {
+            case CHREGRESS_NONE :
+                m_aTrendLineSet.SelectItem(TRENDLINE_NONE + 1);
+                break;
+            case CHREGRESS_LINEAR :
+                m_aTrendLineSet.SelectItem(TRENDLINE_LINE + 1);
+                break;
+            case CHREGRESS_LOG :
+                m_aTrendLineSet.SelectItem(TRENDLINE_LOG + 1);
+                break;
+            case CHREGRESS_EXP :
+                m_aTrendLineSet.SelectItem(TRENDLINE_EXP + 1);
+                break;
+            case CHREGRESS_POWER :
+                m_aTrendLineSet.SelectItem(TRENDLINE_POW + 1);
+                break;
+        }
+    }
+}
+
+BOOL ErrorBarResources::FillItemSet(SfxItemSet& rOutAttrs) const
+{
+    if( m_aCbxAverage.GetState() != STATE_DONTKNOW )
+        rOutAttrs.Put( SfxBoolItem( SCHATTR_STAT_AVERAGE, m_aCbxAverage.IsChecked() ));
+    if( m_bErrorKindUnique )
+        rOutAttrs.Put( SvxChartKindErrorItem( m_eErrorKind, SCHATTR_STAT_KIND_ERROR ));
+    if( m_bIndicatorUnique )
+        rOutAttrs.Put( SvxChartIndicateItem( m_eIndicate, SCHATTR_STAT_INDICATE ));
+
+    if( m_bEnableTrendLine && m_bTrendLineUnique )
+        rOutAttrs.Put( SvxChartRegressItem( m_eTrendLineType, SCHATTR_STAT_REGRESSTYPE ));
+	
+    if( m_bErrorKindUnique )
+    {
+        switch( m_eErrorKind )
+        {
+            case CHERROR_PERCENT :
+                rOutAttrs.Put (SvxDoubleItem ((double) m_aMtrFldPercent.GetValue () / double(pow(10.0,m_aMtrFldPercent.GetDecimalDigits())), SCHATTR_STAT_PERCENT));
+                break;
+
+            case CHERROR_BIGERROR :
+                rOutAttrs.Put (SvxDoubleItem ((double) m_aMtrFldBigError.GetValue () / double(pow(10.0,m_aMtrFldBigError.GetDecimalDigits())), SCHATTR_STAT_BIGERROR));
+                break;
+
+            case CHERROR_CONST :
+                rOutAttrs.Put (SvxDoubleItem ((double) m_aMtrFldConstPlus.GetValue () / double(pow(10.0,m_aMtrFldConstPlus.GetDecimalDigits())), SCHATTR_STAT_CONSTPLUS));
+                rOutAttrs.Put (SvxDoubleItem ((double) m_aMtrFldConstMinus.GetValue () / double(pow(10.0,m_aMtrFldConstMinus.GetDecimalDigits())), SCHATTR_STAT_CONSTMINUS));
+                break;
+
+            case CHERROR_NONE:
+            case CHERROR_VARIANT:
+            case CHERROR_SIGMA:
+                // nothing
+                break;
+        }
+    }
+
+	return TRUE;
+}
+
+void ErrorBarResources::FillValueSets()
+{
+    bool bIsHighContrast = ( true && m_aRbtNone.GetDisplayBackground().GetColor().IsDark() );
+
+    if( m_aIndicatorSet.GetItemCount() == 0 )
+    {
+        m_aIndicatorSet.InsertItem( INDICATE_NONE + 1, SELECT_BITMAP( BMP_INDICATE_NONE ),
+                         String(SchResId(STR_INDICATE_NONE)));
+        m_aIndicatorSet.InsertItem( INDICATE_BOTH + 1, SELECT_BITMAP( BMP_INDICATE_BOTH ),
+                         String(SchResId(STR_INDICATE_BOTH)));
+        m_aIndicatorSet.InsertItem( INDICATE_DOWN + 1, SELECT_BITMAP( BMP_INDICATE_DOWN ),
+                         String(SchResId(STR_INDICATE_DOWN)));
+        m_aIndicatorSet.InsertItem( INDICATE_UP + 1, SELECT_BITMAP( BMP_INDICATE_UP ),
+                         String(SchResId(STR_INDICATE_UP)));
+    }
+    else
+    {
+        m_aIndicatorSet.SetItemImage( INDICATE_NONE + 1, SELECT_BITMAP( BMP_INDICATE_NONE ));
+        m_aIndicatorSet.SetItemImage( INDICATE_BOTH + 1, SELECT_BITMAP( BMP_INDICATE_BOTH ));
+        m_aIndicatorSet.SetItemImage( INDICATE_DOWN + 1, SELECT_BITMAP( BMP_INDICATE_DOWN ));
+        m_aIndicatorSet.SetItemImage( INDICATE_UP + 1, SELECT_BITMAP( BMP_INDICATE_UP ));
+    }
+
+    if( m_aTrendLineSet.GetItemCount() == 0 )
+    {
+        m_aTrendLineSet.InsertItem( TRENDLINE_NONE + 1, SELECT_BITMAP( BMP_REGRESSION_NONE ),
+                                String(SchResId(STR_REGRESSION_NONE)));
+        m_aTrendLineSet.InsertItem( TRENDLINE_LINE + 1, SELECT_BITMAP( BMP_REGRESSION_LINEAR ),
+                                String(SchResId(STR_REGRESSION_LINEAR)));
+        m_aTrendLineSet.InsertItem( TRENDLINE_LOG + 1, SELECT_BITMAP( BMP_REGRESSION_LOG ),
+                                String(SchResId(STR_REGRESSION_LOG)));
+        m_aTrendLineSet.InsertItem( TRENDLINE_EXP + 1, SELECT_BITMAP( BMP_REGRESSION_EXP ),
+                                String(SchResId(STR_REGRESSION_EXP)));
+        m_aTrendLineSet.InsertItem( TRENDLINE_POW + 1, SELECT_BITMAP( BMP_REGRESSION_POWER ),
+                                String(SchResId(STR_REGRESSION_POWER)));
+    }
+    else
+    {
+        m_aTrendLineSet.SetItemImage( TRENDLINE_NONE + 1, SELECT_BITMAP( BMP_REGRESSION_NONE ));
+        m_aTrendLineSet.SetItemImage( TRENDLINE_LINE + 1, SELECT_BITMAP( BMP_REGRESSION_LINEAR ));
+        m_aTrendLineSet.SetItemImage( TRENDLINE_LOG + 1, SELECT_BITMAP( BMP_REGRESSION_LOG ));
+        m_aTrendLineSet.SetItemImage( TRENDLINE_EXP + 1, SELECT_BITMAP( BMP_REGRESSION_EXP ));
+        m_aTrendLineSet.SetItemImage( TRENDLINE_POW + 1, SELECT_BITMAP( BMP_REGRESSION_POWER ));
+    }
+}
+
+//.............................................................................
+} //namespace chart
+//.............................................................................
Index: chart2/source/controller/dialogs/res_ErrorBar.hxx
===================================================================
RCS file: chart2/source/controller/dialogs/res_ErrorBar.hxx
diff -N chart2/source/controller/dialogs/res_ErrorBar.hxx
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ chart2/source/controller/dialogs/res_ErrorBar.hxx	6 Jul 2007 13:26:10 -0000	1.1.2.2
@@ -0,0 +1,123 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+#ifndef CHART2_RES_ERRORBAR_HXX
+#define CHART2_RES_ERRORBAR_HXX
+
+// header for class CheckBox
+#ifndef _SV_BUTTON_HXX
+#include <vcl/button.hxx>
+#endif
+// header for class FixedLine
+#ifndef _SV_FIXED_HXX
+#include <vcl/fixed.hxx>
+#endif
+// header for class MetricField
+#ifndef _SV_FIELD_HXX
+#include <vcl/field.hxx>
+#endif
+// header for class ValueSet
+#ifndef _VALUESET_HXX
+#include <svtools/valueset.hxx>
+#endif
+// header for class SfxItemSet
+#ifndef _SFXITEMSET_HXX
+#include <svtools/itemset.hxx>
+#endif
+// header for enum SvxChartKindError
+#include "chartview/ChartSfxItemIds.hxx"
+#ifndef _SVX_CHRTITEM_HXX
+#include <svx/chrtitem.hxx>
+#endif
+
+//.............................................................................
+namespace chart
+{
+//.............................................................................
+
+class ErrorBarResources
+{
+public:
+    ErrorBarResources( Window* pParent, const SfxItemSet& rInAttrs );
+    virtual ~ErrorBarResources();
+
+    void EnableTrendLine( bool bEnable );
+    void SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth );
+
+    void Reset(const SfxItemSet& rInAttrs);
+    BOOL FillItemSet(SfxItemSet& rOutAttrs) const;
+
+    void FillValueSets();
+    
+private:
+    CheckBox        m_aCbxAverage;
+    FixedLine       m_aFlErrorCategory;
+    RadioButton     m_aRbtNone;
+    RadioButton     m_aRbtVariant;
+    RadioButton     m_aRbtSigma;
+    RadioButton     m_aRbtPercent;
+    RadioButton     m_aRbtBigError;
+    RadioButton     m_aRbtConst;
+    MetricField     m_aMtrFldPercent;
+    MetricField     m_aMtrFldBigError;
+    FixedText       m_aFTConstPlus;
+    MetricField     m_aMtrFldConstPlus;
+    FixedText       m_aFTConstMinus;
+    MetricField     m_aMtrFldConstMinus;
+    FixedText       m_aFTIndicate;
+    ValueSet        m_aIndicatorSet;
+    FixedText       m_aFTTrendLine;
+    ValueSet        m_aTrendLineSet;
+
+    bool                m_bEnableTrendLine;
+    SvxChartKindError   m_eErrorKind;
+    SvxChartIndicate    m_eIndicate;
+    SvxChartRegress     m_eTrendLineType;
+
+    bool                m_bErrorKindUnique;
+    bool                m_bIndicatorUnique;
+    bool                m_bTrendLineUnique;
+    bool                m_bPlusUnique;
+    bool                m_bMinusUnique;
+
+    DECL_LINK(RBtnClick, Button *);
+    DECL_LINK(SelectIndicate, void *);
+    DECL_LINK(SelectTrendLine, void *);
+};
+
+//.............................................................................
+} //namespace chart
+//.............................................................................
+
+#endif
Index: chart2/source/controller/dialogs/res_ErrorBar_IDs.hrc
===================================================================
RCS file: chart2/source/controller/dialogs/res_ErrorBar_IDs.hrc
diff -N chart2/source/controller/dialogs/res_ErrorBar_IDs.hrc
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ chart2/source/controller/dialogs/res_ErrorBar_IDs.hrc	5 Jul 2007 12:49:00 -0000	1.1.2.1
@@ -0,0 +1,53 @@
+/*************************************************************************
+ *
+ *  OpenOffice.org - a multi-platform office productivity suite
+ *
+ *  $RCSfile$
+ *
+ *  $Revision$
+ *
+ *  last change: $Author$ $Date$
+ *
+ *  The Contents of this file are made available subject to
+ *  the terms of GNU Lesser General Public License Version 2.1.
+ *
+ *
+ *    GNU Lesser General Public License Version 2.1
+ *    =============================================
+ *    Copyright 2005 by Sun Microsystems, Inc.
+ *    901 San Antonio Road, Palo Alto, CA 94303, USA
+ *
+ *    This library is free software; you can redistribute it and/or
+ *    modify it under the terms of the GNU Lesser General Public
+ *    License version 2.1, as published by the Free Software Foundation.
+ *
+ *    This library is distributed in the hope that it will be useful,
+ *    but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ *    Lesser General Public License for more details.
+ *
+ *    You should have received a copy of the GNU Lesser General Public
+ *    License along with this library; if not, write to the Free Software
+ *    Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+ *    MA  02111-1307  USA
+ *
+ ************************************************************************/
+
+#define CBX_AVERAGE 1
+#define FL_ERROR 1
+#define RBT_NONE 1
+#define RBT_VARIANT 2
+#define RBT_SIGMA 3
+#define RBT_PERCENT 4
+#define RBT_BIGERROR 5
+#define RBT_CONST 6
+#define MTR_FLD_PERCENT 1
+#define MTR_FLD_BIGERROR 2
+#define MTR_FLD_PLUS 3
+#define MTR_FLD_MINUS 4
+#define FT_PERCENT_PLUS 1
+#define FT_PERCENT_MINUS 2
+#define FT_INDICATE 3
+#define FT_REGRESS 4
+#define CT_INDICATE 1
+#define CT_REGRESS 2
Index: chart2/source/controller/dialogs/res_Statistic_tmpl.hrc
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/res_Statistic_tmpl.hrc,v
retrieving revision 1.6
retrieving revision 1.6.12.3
diff -u -u -p -r1.6 -r1.6.12.3
--- chart2/source/controller/dialogs/res_Statistic_tmpl.hrc	22 May 2007 17:40:43 -0000	1.6
+++ chart2/source/controller/dialogs/res_Statistic_tmpl.hrc	9 Jul 2007 13:06:51 -0000	1.6.12.3
@@ -35,6 +35,8 @@
 #ifndef _CHART2_RESOURCE_STATISTIC_HXX
 #define _CHART2_RESOURCE_STATISTIC_HXX
 
+#include "res_ErrorBar_IDs.hrc"
+
 #define RESOURCE_STATISTIC( imagelistsyposition, linelength ) \
 CheckBox CBX_AVERAGE \
 { \
@@ -107,15 +109,15 @@ MetricField MTR_FLD_PERCENT \
 	TabStop = TRUE ; \
 	Repeat = TRUE ; \
 	Spin = TRUE ; \
-	Minimum = 1 ; \
-	Maximum = 1000 ; \
+	Minimum = 0 ; \
+	Maximum = 10000 ; \
 	StrictFormat = TRUE ; \
 	Unit = FUNIT_CUSTOM ; \
 	CustomUnitText = " %" ; \
-	First = 1 ; \
-	Last = 1000 ; \
-	SpinSize = 1 ; \
-	DecimalDigits = 1 ; \
+	First = 100 ; \
+	Last = 10000 ; \
+	SpinSize = 100 ; \
+	DecimalDigits = 2 ; \
 }; \
 MetricField MTR_FLD_BIGERROR \
 { \
@@ -126,15 +128,15 @@ MetricField MTR_FLD_BIGERROR \
 	TabStop = TRUE ; \
 	Repeat = TRUE ; \
 	Spin = TRUE ; \
-	Minimum = 1 ; \
-	Maximum = 1000 ; \
+	Minimum = 0 ; \
+	Maximum = 10000 ; \
 	StrictFormat = TRUE ; \
 	Unit = FUNIT_CUSTOM ; \
 	CustomUnitText  = " %" ; \
-	First = 1 ; \
-	Last = 1000 ; \
-	SpinSize = 1 ; \
-	DecimalDigits = 1 ; \
+	First = 100 ; \
+	Last = 10000 ; \
+	SpinSize = 100 ; \
+	DecimalDigits = 2 ; \
 }; \
 FixedText FT_PERCENT_PLUS \
 { \
@@ -151,14 +153,14 @@ MetricField MTR_FLD_PLUS \
 	TabStop = TRUE ; \
 	Repeat = TRUE ; \
 	Spin = TRUE ; \
-	Minimum = 1 ; \
+	Minimum = 0 ; \
 	Maximum = 100000000 ; \
 	StrictFormat = TRUE ; \
 	Unit = FUNIT_CUSTOM ; \
-	First = 1 ; \
+	First = 0 ; \
 	Last = 100000000 ; \
 	SpinSize = 1 ; \
-	DecimalDigits = 1 ; \
+	DecimalDigits = 3 ; \
 }; \
 FixedText FT_PERCENT_MINUS \
 { \
@@ -175,14 +177,14 @@ MetricField MTR_FLD_MINUS \
 	TabStop = TRUE ; \
 	Repeat = TRUE ; \
 	Spin = TRUE ; \
-	Minimum = 1 ; \
+	Minimum = 0 ; \
 	Maximum = 100000000 ; \
 	StrictFormat = TRUE ; \
 	Unit = FUNIT_CUSTOM ; \
-	First = 1 ; \
+	First = 0 ; \
 	Last = 100000000 ; \
 	SpinSize = 1 ; \
-	DecimalDigits = 1 ; \
+	DecimalDigits = 3 ; \
 }; \
 FixedText FT_INDICATE \
 { \
Index: chart2/source/controller/dialogs/tp_3D_SceneAppearance.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_3D_SceneAppearance.cxx,v
retrieving revision 1.3
retrieving revision 1.3.4.1
diff -u -u -p -r1.3 -r1.3.4.1
--- chart2/source/controller/dialogs/tp_3D_SceneAppearance.cxx	3 Jul 2007 13:38:55 -0000	1.3
+++ chart2/source/controller/dialogs/tp_3D_SceneAppearance.cxx	10 Jul 2007 15:24:14 -0000	1.3.4.1
@@ -127,8 +127,8 @@ ThreeD_SceneAppearance_TabPage::ThreeD_S
                 , m_aCB_RoundedEdge ( this, SchResId( CB_ROUNDEDEDGE ) )
                 , m_aCB_Shading	    ( this, SchResId( CB_SHADING ) )
                 , m_aCB_ObjectLines ( this, SchResId( CB_OBJECTLINES ) )
-                , m_bCommitToModel( true )
                 , m_bUpdateOtherControls( true )
+                , m_bCommitToModel( true )
                 , m_rControllerLockHelper( rControllerLockHelper )
 {
 	FreeResource();
Index: chart2/source/controller/dialogs/tp_3D_SceneGeometry.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_3D_SceneGeometry.cxx,v
retrieving revision 1.3
retrieving revision 1.3.4.3
diff -u -u -p -r1.3 -r1.3.4.3
--- chart2/source/controller/dialogs/tp_3D_SceneGeometry.cxx	3 Jul 2007 13:39:11 -0000	1.3
+++ chart2/source/controller/dialogs/tp_3D_SceneGeometry.cxx	11 Jul 2007 15:48:28 -0000	1.3.4.3
@@ -277,7 +277,7 @@ void ThreeD_SceneGeometry_TabPage::apply
         m_xSceneProperties->setPropertyValue( C2U("D3DScenePerspective"), uno::makeAny( aMode ));
 
         ThreeDHelper::setCameraDistance( m_xSceneProperties
-            , lcl_PerspectiveToCameraDistance( m_aMFPerspective.GetValue() ) );
+            , lcl_PerspectiveToCameraDistance( (double)m_aMFPerspective.GetValue() ) );
     }
     catch( const uno::Exception & ex )
     {
@@ -320,12 +320,12 @@ IMPL_LINK( ThreeD_SceneGeometry_TabPage,
         m_nYRotation = m_aMFYRotation.GetValue();
         m_nZRotation = m_aMFZRotation.GetValue();
        
-        m_aMFXRotation.SetValue(ThreeDHelper::getValueClippedToRange(m_nXRotation, ThreeDHelper::getXDegreeAngleLimitForRightAngledAxes() ));
-        m_aMFYRotation.SetValue(ThreeDHelper::getValueClippedToRange(m_nYRotation, ThreeDHelper::getYDegreeAngleLimitForRightAngledAxes() ));
+        m_aMFXRotation.SetValue(static_cast<sal_Int64>(ThreeDHelper::getValueClippedToRange(static_cast<double>(m_nXRotation), ThreeDHelper::getXDegreeAngleLimitForRightAngledAxes())));
+        m_aMFYRotation.SetValue(static_cast<sal_Int64>(ThreeDHelper::getValueClippedToRange(static_cast<double>(m_nYRotation), ThreeDHelper::getYDegreeAngleLimitForRightAngledAxes())));
         m_aMFZRotation.SetEmptyFieldValue();
 
-        lcl_SetMetricFieldLimits( m_aMFXRotation, ThreeDHelper::getXDegreeAngleLimitForRightAngledAxes() );
-        lcl_SetMetricFieldLimits( m_aMFYRotation, ThreeDHelper::getYDegreeAngleLimitForRightAngledAxes() );
+        lcl_SetMetricFieldLimits( m_aMFXRotation, static_cast<sal_Int64>(ThreeDHelper::getXDegreeAngleLimitForRightAngledAxes()));
+        lcl_SetMetricFieldLimits( m_aMFYRotation, static_cast<sal_Int64>(ThreeDHelper::getYDegreeAngleLimitForRightAngledAxes()));
     }
     else
     {
Index: chart2/source/controller/dialogs/tp_3D_SceneIllumination.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_3D_SceneIllumination.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/tp_3D_SceneIllumination.cxx	22 May 2007 17:42:51 -0000	1.2
+++ chart2/source/controller/dialogs/tp_3D_SceneIllumination.cxx	11 Jul 2007 16:43:16 -0000	1.2.12.1
@@ -218,6 +218,7 @@ namespace
             }
             catch( const uno::Exception & ex )
             {
+                (void)(ex); // no warning in non-debug builds
                 OSL_ENSURE( false, ::rtl::OUStringToOString(
                                 ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Property Exception caught. Message: " )) +
                                 ex.Message, RTL_TEXTENCODING_ASCII_US ).getStr());
@@ -249,6 +250,7 @@ namespace
             }
             catch( const uno::Exception & ex )
             {
+                (void)(ex); // no warning in non-debug builds
                 OSL_ENSURE( false, ::rtl::OUStringToOString(
                                 ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Property Exception caught. Message: " )) +
                                 ex.Message, RTL_TEXTENCODING_ASCII_US ).getStr());
@@ -267,6 +269,7 @@ namespace
         }
         catch( const uno::Exception & ex )
         {
+            (void)(ex); // no warning in non-debug builds
             OSL_ENSURE( false, ::rtl::OUStringToOString(
                             ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Property Exception caught. Message: " )) +
                             ex.Message, RTL_TEXTENCODING_ASCII_US ).getStr());
@@ -286,6 +289,7 @@ namespace
         }
         catch( const uno::Exception & ex )
         {
+            (void)(ex); // no warning in non-debug builds
             OSL_ENSURE( false, ::rtl::OUStringToOString(
                             ::rtl::OUString( RTL_CONSTASCII_USTRINGPARAM( "Property Exception caught. Message: " )) +
                             ex.Message, RTL_TEXTENCODING_ASCII_US ).getStr());
Index: chart2/source/controller/dialogs/tp_AxisLabel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_AxisLabel.cxx,v
retrieving revision 1.8
retrieving revision 1.8.12.1
diff -u -u -p -r1.8 -r1.8.12.1
--- chart2/source/controller/dialogs/tp_AxisLabel.cxx	22 May 2007 17:43:33 -0000	1.8
+++ chart2/source/controller/dialogs/tp_AxisLabel.cxx	10 Jul 2007 11:57:29 -0000	1.8.12.1
@@ -133,7 +133,7 @@ BOOL SchAxisLabelTabPage::FillItemSet( S
 
     if( m_bShowStaggeringControls )
 	{
-		SvxChartTextOrder eOrder;
+		SvxChartTextOrder eOrder = CHTXTORDER_SIDEBYSIDE;
         bool bRadioButtonChecked = true;
 
 		if( aRbUpDown.IsChecked())
Index: chart2/source/controller/dialogs/tp_ChartType.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_ChartType.cxx,v
retrieving revision 1.3
retrieving revision 1.3.4.2
diff -u -u -p -r1.3 -r1.3.4.2
--- chart2/source/controller/dialogs/tp_ChartType.cxx	3 Jul 2007 13:40:13 -0000	1.3
+++ chart2/source/controller/dialogs/tp_ChartType.cxx	10 Jul 2007 13:38:14 -0000	1.3.4.2
@@ -158,7 +158,7 @@ void AxisTypeResourceGroup::fillParamete
 {
     rParameter.bXAxisWithValues = !m_aCB_XAxis_Categories.IsChecked();
 }
-IMPL_LINK( AxisTypeResourceGroup, AxisTypeCheckHdl, CheckBox*, pCheckBox )
+IMPL_LINK( AxisTypeResourceGroup, AxisTypeCheckHdl, CheckBox*, EMPTYARG )
 {
     if( m_pChangeListener )
         m_pChangeListener->stateChanged(this);
@@ -254,7 +254,7 @@ void Dim3DLookResourceGroup::fillParamet
     else
         rParameter.eThreeDLookScheme = ThreeDLookScheme_Unknown;
 }
-IMPL_LINK( Dim3DLookResourceGroup, Dim3DLookCheckHdl, CheckBox*, pCheckBox )
+IMPL_LINK( Dim3DLookResourceGroup, Dim3DLookCheckHdl, CheckBox*, EMPTYARG )
 {
     if(m_pChangeListener)
         m_pChangeListener->stateChanged(this);
@@ -322,7 +322,7 @@ void SortByXValuesResourceGroup::fillPar
 {
     rParameter.bSortByXValues = m_aCB_XValueSorting.IsChecked();
 }
-IMPL_LINK( SortByXValuesResourceGroup, SortByXValuesCheckHdl, CheckBox*, pCheckBox )
+IMPL_LINK( SortByXValuesResourceGroup, SortByXValuesCheckHdl, CheckBox*, EMPTYARG )
 {
     if(m_pChangeListener)
         m_pChangeListener->stateChanged(this);
@@ -577,10 +577,10 @@ void SplinePropertiesDialog::fillParamet
     else if(m_aRB_Splines_B.IsChecked())
         rParameter.eCurveStyle=CurveStyle_B_SPLINES;
 
-    rParameter.nCurveResolution = m_aMF_SplineResolution.GetValue();
-    rParameter.nSplineOrder = m_aMF_SplineOrder.GetValue();
+    rParameter.nCurveResolution = static_cast< sal_Int32 >( m_aMF_SplineResolution.GetValue());
+    rParameter.nSplineOrder = static_cast< sal_Int32 >( m_aMF_SplineOrder.GetValue());
 }
-IMPL_LINK( SplinePropertiesDialog, SplineModeRadioHdl, RadioButton*, pButton )
+IMPL_LINK( SplinePropertiesDialog, SplineModeRadioHdl, RadioButton*, EMPTYARG )
 {
     m_aFT_SplineOrder.Enable(m_aRB_Splines_B.IsChecked());
     m_aMF_SplineOrder.Enable(m_aRB_Splines_B.IsChecked());
@@ -917,7 +917,7 @@ void ChartTypeTabPage::commitToModel( co
     ControllerLockGuard aLockedControllers( uno::Reference< frame::XModel >( m_xChartModel, uno::UNO_QUERY ) );
     m_pCurrentMainType->commitToModel( rParameter, m_xChartModel );
 }
-void ChartTypeTabPage::stateChanged( ChangingResource* pResource )
+void ChartTypeTabPage::stateChanged( ChangingResource* /*pResource*/ )
 {
     if(m_nChangingCalls)
         return;
@@ -1056,7 +1056,7 @@ void ChartTypeTabPage::showAllControls( 
     rTypeController.showExtraControls( this, Point( nXPos, nYPos ), aRemainingSize );
 }
 
-void ChartTypeTabPage::fillAllControls( const ChartTypeParameter& rParameter, const uno::Reference< beans::XPropertySet >& xTemplateProps )
+void ChartTypeTabPage::fillAllControls( const ChartTypeParameter& rParameter, const uno::Reference< beans::XPropertySet >& /*xTemplateProps*/ )
 {
     m_nChangingCalls++;
     if( m_pCurrentMainType )
@@ -1127,7 +1127,7 @@ void ChartTypeTabPage::initializePage()
     }
 }
 
-sal_Bool ChartTypeTabPage::commitPage( COMMIT_REASON eReason )
+sal_Bool ChartTypeTabPage::commitPage( COMMIT_REASON /*eReason*/ )
 {
     //commit changes to model
     if( !m_bDoLiveUpdate && m_pCurrentMainType )
Index: chart2/source/controller/dialogs/tp_DataLabel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_DataLabel.cxx,v
retrieving revision 1.7
retrieving revision 1.7.12.1
diff -u -u -p -r1.7 -r1.7.12.1
--- chart2/source/controller/dialogs/tp_DataLabel.cxx	22 May 2007 17:44:44 -0000	1.7
+++ chart2/source/controller/dialogs/tp_DataLabel.cxx	13 Jul 2007 11:17:12 -0000	1.7.12.1
@@ -36,168 +36,45 @@
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_chart2.hxx"
 #include "tp_DataLabel.hxx"
+
 #include "TabPages.hrc"
 #include "ResId.hxx"
-#include "chartview/ChartSfxItemIds.hxx"
-#include "NoWarningThisInCTOR.hxx"
-
-#ifndef _SFXENUMITEM_HXX
-#include <svtools/eitem.hxx>
-#endif
-#ifndef _SVX_CHRTITEM_HXX
-#include <svx/chrtitem.hxx>
-#endif
 
 //.............................................................................
 namespace chart
 {
 //.............................................................................
 
-SchDataDescrTabPage::SchDataDescrTabPage(Window* pWindow,
-										 const SfxItemSet& rInAttrs) :
+DataLabelsTabPage::DataLabelsTabPage(Window* pWindow, const SfxItemSet& rInAttrs) :
 		SfxTabPage(pWindow, SchResId(TP_DATA_DESCR), rInAttrs),
-		aCbValue(this, SchResId(CB_VALUE)),
-		aRbNumber(this, SchResId(RB_NUMBER)),
-		aRbPercent(this, SchResId(RB_PERCENT)),
-		aCbText(this, SchResId(CB_TEXT)),
-		aCbSymbol(this, SchResId(CB_SYMBOL))
+        m_aDataLabelResources(this, rInAttrs)
 {
 	FreeResource();
-
-	aCbValue.SetClickHdl( LINK( this, SchDataDescrTabPage, EnableHdl ));
-	aCbText.SetClickHdl(  LINK( this, SchDataDescrTabPage, EnableHdl ));
 }
 
-/*************************************************************************
-|*
-|* Dtor
-|*
-\************************************************************************/
-
-SchDataDescrTabPage::~SchDataDescrTabPage()
+DataLabelsTabPage::~DataLabelsTabPage()
 {
 }
 
-/*************************************************************************
-|*
-|*	Handler fuer ShowSym-Button enablen/disablen
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchDataDescrTabPage, EnableHdl, CheckBox *, pControl )
+SfxTabPage* DataLabelsTabPage::Create(Window* pWindow,
+										const SfxItemSet& rOutAttrs)
 {
-	aCbSymbol.Enable( aCbValue.IsChecked() || aCbText.IsChecked() );
-	if( pControl == &aCbValue )
-	{
-		aRbPercent.Enable( aCbValue.IsChecked() );
-		aRbNumber.Enable( aCbValue.IsChecked() );
-	}
-
-	return 0;
+	return new DataLabelsTabPage(pWindow, rOutAttrs);
 }
 
-/*************************************************************************
-|*
-|* Erzeugung
-|*
-\*************************************************************************/
+BOOL DataLabelsTabPage::FillItemSet(SfxItemSet& rOutAttrs)
+{
+    return m_aDataLabelResources.FillItemSet(rOutAttrs);
+}
 
-SfxTabPage* SchDataDescrTabPage::Create(Window* pWindow,
-										const SfxItemSet& rOutAttrs)
+void DataLabelsTabPage::Reset(const SfxItemSet& rInAttrs)
 {
-	return new SchDataDescrTabPage(pWindow, rOutAttrs);
+	m_aDataLabelResources.Reset(rInAttrs);
 }
 
-/*************************************************************************
-|*
-|* Fuellt uebergebenen Item-Set mit Dialogbox-Attributen
-|*
-\*************************************************************************/
-
-BOOL SchDataDescrTabPage::FillItemSet(SfxItemSet& rOutAttrs)
-{
-	BOOL bText = aCbText.IsChecked();
-	SvxChartDataDescr eDescr;
-
-	if( aCbValue.IsChecked() )
-	{
-		if( aRbNumber.IsChecked() )
-			eDescr = (bText? CHDESCR_TEXTANDVALUE : CHDESCR_VALUE);
-		else
-			eDescr = (bText? CHDESCR_TEXTANDPERCENT : CHDESCR_PERCENT);
-	}
-	else if( aCbText.IsChecked() )
-		eDescr = CHDESCR_TEXT;
-	else
-		eDescr = CHDESCR_NONE;
-
-    rOutAttrs.Put(SvxChartDataDescrItem(eDescr, SCHATTR_DATADESCR_DESCR));
-	rOutAttrs.Put(SfxBoolItem( SCHATTR_DATADESCR_SHOW_SYM,
-                               aCbSymbol.IsChecked()) );
-	return TRUE;
-}
-
-/*************************************************************************
-|*
-|* Initialisierung
-|*
-\*************************************************************************/
-
-void SchDataDescrTabPage::Reset(const SfxItemSet& rInAttrs)
-{
-	const SfxPoolItem *pPoolItem = NULL;
-
-	// default state
-	aRbNumber.Enable( FALSE );
-	aRbPercent.Enable( FALSE );
-	aCbSymbol.Enable( FALSE );
-
-	if( rInAttrs.GetItemState(SCHATTR_DATADESCR_SHOW_SYM,
-                              TRUE, &pPoolItem) == SFX_ITEM_SET )
-		aCbSymbol.Check( ((const SfxBoolItem*)pPoolItem)->GetValue() );
-
-	if( rInAttrs.GetItemState(SCHATTR_DATADESCR_DESCR,
-                              TRUE, &pPoolItem) == SFX_ITEM_SET )
-	{
-		switch( ((const SvxChartDataDescrItem*)pPoolItem)->GetValue() )
-		{
-			case CHDESCR_VALUE:
-				aCbValue.Check();
-				aRbNumber.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			case CHDESCR_PERCENT:
-				aCbValue.Check();
-				aRbPercent.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			case CHDESCR_TEXT:
-				aCbText.Check();
-				EnableHdl( &aCbText );
-				break;
-
-			case CHDESCR_TEXTANDPERCENT:
-				aCbText.Check();
-				aCbValue.Check();
-				aRbPercent.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			case CHDESCR_TEXTANDVALUE:
-				aCbText.Check();
-				aCbValue.Check();
-				aRbNumber.Check();
-				EnableHdl( &aCbValue );
-				break;
-
-			default:
-				break;
-		}
-	}
-	if( !aRbNumber.IsChecked() && !aRbPercent.IsChecked() )
-		aRbNumber.Check();
+void DataLabelsTabPage::SetNumberFormatter( SvNumberFormatter* pFormatter )
+{
+    m_aDataLabelResources.SetNumberFormatter( pFormatter );
 }
 
 //.............................................................................
Index: chart2/source/controller/dialogs/tp_DataLabel.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_DataLabel.hxx,v
retrieving revision 1.3
retrieving revision 1.3.136.1
diff -u -u -p -r1.3 -r1.3.136.1
--- chart2/source/controller/dialogs/tp_DataLabel.hxx	8 Sep 2005 00:14:37 -0000	1.3
+++ chart2/source/controller/dialogs/tp_DataLabel.hxx	13 Jul 2007 11:16:41 -0000	1.3.136.1
@@ -35,10 +35,14 @@
 #ifndef _CHART2_TP_DATALABEL_HXX
 #define _CHART2_TP_DATALABEL_HXX
 
+#include "res_DataLabel.hxx"
+
 #ifndef _SFXTABDLG_HXX
 #include <sfx2/tabdlg.hxx>
 #endif
 
+class SvNumberFormatter;
+
 //.............................................................................
 namespace chart
 {
@@ -48,24 +52,21 @@ namespace chart
 /**
 */
 
-class SchDataDescrTabPage : public SfxTabPage
+class DataLabelsTabPage : public SfxTabPage
 {
-private:
-	CheckBox			aCbValue;
-	RadioButton			aRbNumber;
-	RadioButton			aRbPercent;
-	CheckBox			aCbText;
-	CheckBox			aCbSymbol;
-
-	DECL_LINK(EnableHdl, CheckBox * );
-
 public:
-	SchDataDescrTabPage(Window* pParent, const SfxItemSet& rInAttrs);
-	virtual ~SchDataDescrTabPage();
+	DataLabelsTabPage(Window* pParent, const SfxItemSet& rInAttrs);
+	virtual ~DataLabelsTabPage();
 
 	static SfxTabPage* Create(Window* pParent, const SfxItemSet& rInAttrs);
-	virtual BOOL FillItemSet(SfxItemSet& rOutAttrs);
+
+    void SetNumberFormatter( SvNumberFormatter* pFormatter );
+
 	virtual void Reset(const SfxItemSet& rInAttrs);
+    virtual BOOL FillItemSet(SfxItemSet& rOutAttrs);
+
+private:
+    DataLabelResources  m_aDataLabelResources;
 };
 
 //.............................................................................
Index: chart2/source/controller/dialogs/tp_DataSource.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_DataSource.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/tp_DataSource.cxx	22 May 2007 17:44:53 -0000	1.2
+++ chart2/source/controller/dialogs/tp_DataSource.cxx	21 Jun 2007 15:50:09 -0000	1.2.12.1
@@ -665,7 +665,8 @@ IMPL_LINK( DataSourceTabPage, MainRangeB
 {
     OSL_ASSERT( m_pCurrentRangeChoosingField == 0 );
     m_pCurrentRangeChoosingField = & m_aEDT_RANGE;
-    if( ! updateModelFromControl( m_pCurrentRangeChoosingField ))
+    if( m_aEDT_RANGE.GetText().Len() > 0 &&
+        ! updateModelFromControl( m_pCurrentRangeChoosingField ))
         return 0;
 
     SeriesEntry * pEntry = dynamic_cast< SeriesEntry * >( m_apLB_SERIES->FirstSelected());
@@ -708,7 +709,8 @@ IMPL_LINK( DataSourceTabPage, Categories
 {
     OSL_ASSERT( m_pCurrentRangeChoosingField == 0 );
     m_pCurrentRangeChoosingField = & m_aEDT_CATEGORIES;
-    if( ! updateModelFromControl( m_pCurrentRangeChoosingField ))
+    if( m_aEDT_CATEGORIES.GetText().Len() > 0 &&
+        ! updateModelFromControl( m_pCurrentRangeChoosingField ))
         return 0;
 
     String aStr( SchResId( m_aFT_CATEGORIES.IsVisible() ? STR_DATA_SELECT_RANGE_FOR_CATEGORIES : STR_DATA_SELECT_RANGE_FOR_DATALABELS ));
Index: chart2/source/controller/dialogs/tp_RangeChooser.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_RangeChooser.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.4
diff -u -u -p -r1.2 -r1.2.12.4
--- chart2/source/controller/dialogs/tp_RangeChooser.cxx	22 May 2007 17:47:43 -0000	1.2
+++ chart2/source/controller/dialogs/tp_RangeChooser.cxx	13 Jul 2007 08:07:27 -0000	1.2.12.4
@@ -177,10 +177,10 @@ RangeChooserTabPage::RangeChooserTabPage
     // #i75179# enable setting the background to a different color
     m_aED_Range.SetStyle( m_aED_Range.GetStyle() | WB_FORCECTRLBACKGROUND );
 
-    m_aED_Range.SetModifyHdl( LINK( this, RangeChooserTabPage, EditRangeHdl ));
-    m_aRB_Rows.SetToggleHdl( LINK( this, RangeChooserTabPage, ToogleRowsColumnsHdl ) );
-    m_aCB_FirstRowAsLabel.SetToggleHdl( LINK( this, RangeChooserTabPage, ToogleLabelHdl ) );
-    m_aCB_FirstColumnAsLabel.SetToggleHdl( LINK( this, RangeChooserTabPage, ToogleLabelHdl ) );
+    m_aED_Range.SetModifyHdl( LINK( this, RangeChooserTabPage, ControlChangedHdl ));
+    m_aRB_Rows.SetToggleHdl( LINK( this, RangeChooserTabPage, ControlChangedHdl ) );
+    m_aCB_FirstRowAsLabel.SetToggleHdl( LINK( this, RangeChooserTabPage, ControlChangedHdl ) );
+    m_aCB_FirstColumnAsLabel.SetToggleHdl( LINK( this, RangeChooserTabPage, ControlChangedHdl ) );
 }
 
 RangeChooserTabPage::~RangeChooserTabPage()
@@ -280,8 +280,14 @@ void RangeChooserTabPage::changeDialogMo
 bool RangeChooserTabPage::isValid()
 {
     ::rtl::OUString aRange( m_aED_Range.GetText());
+    sal_Bool bFirstCellAsLabel = ( m_aCB_FirstColumnAsLabel.IsChecked() && !m_aRB_Columns.IsChecked() )
+        || ( m_aCB_FirstRowAsLabel.IsChecked()    && !m_aRB_Rows.IsChecked() );
+    sal_Bool bHasCategories = ( m_aCB_FirstColumnAsLabel.IsChecked() && m_aRB_Columns.IsChecked() )
+        || ( m_aCB_FirstRowAsLabel.IsChecked()    && m_aRB_Rows.IsChecked() );
     bool bIsValid = ( aRange.getLength() == 0 ) ||
-        m_rDialogModel.getRangeSelectionHelper()->verifyCellRange( aRange );
+        m_rDialogModel.getRangeSelectionHelper()->verifyArguments(
+            DataSourceHelper::createArguments(
+                aRange, Sequence< sal_Int32 >(), m_aRB_Columns.IsChecked(), bFirstCellAsLabel, bHasCategories ));
 
     if( bIsValid )
     {
@@ -300,10 +306,37 @@ bool RangeChooserTabPage::isValid()
     }
 
     // enable/disable controls
-    m_aRB_Rows.Enable( bIsValid );
-    m_aRB_Columns.Enable( bIsValid );
-    m_aCB_FirstRowAsLabel.Enable( bIsValid );
-    m_aCB_FirstColumnAsLabel.Enable( bIsValid );
+    // #i79531# if the range is valid but an action of one of these buttons
+    // would render it invalid, the button should be disabled
+    if( bIsValid )
+    {
+        bool bDataInColumns = m_aRB_Columns.IsChecked();
+        bool bIsSwappedRangeValid = m_rDialogModel.getRangeSelectionHelper()->verifyArguments(
+            DataSourceHelper::createArguments(
+                aRange, Sequence< sal_Int32 >(), ! bDataInColumns, bHasCategories, bFirstCellAsLabel ));
+        m_aRB_Rows.Enable( bIsSwappedRangeValid );
+        m_aRB_Columns.Enable( bIsSwappedRangeValid );
+
+        m_aCB_FirstRowAsLabel.Enable(
+            m_rDialogModel.getRangeSelectionHelper()->verifyArguments(
+                DataSourceHelper::createArguments(
+                    aRange, Sequence< sal_Int32 >(), m_aRB_Columns.IsChecked(),
+                    bDataInColumns ? ! bFirstCellAsLabel : bFirstCellAsLabel,
+                    bDataInColumns ? bHasCategories : ! bHasCategories )));
+        m_aCB_FirstColumnAsLabel.Enable(
+            m_rDialogModel.getRangeSelectionHelper()->verifyArguments(
+                DataSourceHelper::createArguments(
+                    aRange, Sequence< sal_Int32 >(), m_aRB_Columns.IsChecked(),
+                    bDataInColumns ? bFirstCellAsLabel : ! bFirstCellAsLabel,
+                    bDataInColumns ? ! bHasCategories : bHasCategories )));
+    }
+    else
+    {
+        m_aRB_Rows.Enable( bIsValid );
+        m_aRB_Columns.Enable( bIsValid );
+        m_aCB_FirstRowAsLabel.Enable( bIsValid );
+        m_aCB_FirstColumnAsLabel.Enable( bIsValid );
+}
     BOOL bShowIB = m_rDialogModel.getRangeSelectionHelper()->hasRangeSelection();
     lcl_ShowChooserButton( m_aIB_Range, m_aED_Range, bShowIB );
 
@@ -311,29 +344,19 @@ bool RangeChooserTabPage::isValid()
 }
 
 
-IMPL_LINK( RangeChooserTabPage, ToogleRowsColumnsHdl, void*, EMPTYARG )
-{
-    setDirty();
-    changeDialogModelAccordingToControls();
-    return 0;
-}
-IMPL_LINK( RangeChooserTabPage, ToogleLabelHdl, CheckBox*, EMPTYARG /* pCheckBox */ )
-{
-    setDirty();
-    changeDialogModelAccordingToControls();
-    return 0;
-}
-IMPL_LINK( RangeChooserTabPage, EditRangeHdl, void*, EMPTYARG )
+IMPL_LINK( RangeChooserTabPage, ControlChangedHdl, void*, EMPTYARG )
 {
     setDirty();
     if( isValid())
         changeDialogModelAccordingToControls();
     return 0;
 }
+
 IMPL_LINK( RangeChooserTabPage, ChooseRangeHdl, void *, EMPTYARG )
 {
     rtl::OUString aRange = m_aED_Range.GetText();
-    rtl::OUString aTitle( String( SchResId( STR_PAGE_DATA_RANGE ) ));
+    // using assignment for broken gcc 3.3
+    rtl::OUString aTitle = ::rtl::OUString( String( SchResId( STR_PAGE_DATA_RANGE ) ));
 
     lcl_enableRangeChoosing( true, m_pParentDialog );
     m_rDialogModel.getRangeSelectionHelper()->chooseRange( aRange, aTitle, *this );
Index: chart2/source/controller/dialogs/tp_RangeChooser.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_RangeChooser.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/tp_RangeChooser.hxx	22 May 2007 17:48:01 -0000	1.2
+++ chart2/source/controller/dialogs/tp_RangeChooser.hxx	12 Jul 2007 14:39:10 -0000	1.2.12.1
@@ -101,9 +101,7 @@ protected: //methods
     bool isDirty() const;
 
     DECL_LINK( ChooseRangeHdl, void* );
-    DECL_LINK( EditRangeHdl, void* );
-    DECL_LINK( ToogleRowsColumnsHdl, void* );
-    DECL_LINK( ToogleLabelHdl, CheckBox* );
+    DECL_LINK( ControlChangedHdl, void* );
 
 protected: //member
 
Index: chart2/source/controller/dialogs/tp_Scale.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_Scale.cxx,v
retrieving revision 1.8
retrieving revision 1.8.12.1
diff -u -u -p -r1.8 -r1.8.12.1
--- chart2/source/controller/dialogs/tp_Scale.cxx	22 May 2007 17:48:21 -0000	1.8
+++ chart2/source/controller/dialogs/tp_Scale.cxx	10 Jul 2007 11:57:29 -0000	1.8.12.1
@@ -283,7 +283,7 @@ int SchScaleYAxisTabPage::DeactivatePage
 	fMin = aFmtFldMin.GetValue();
 	fOrigin = aFmtFldOrigin.GetValue();
 	fStepMain = aFmtFldStepMain.GetValue();
-    nStepHelp = aMtStepHelp.GetValue();
+    nStepHelp = static_cast< sal_Int32 >( aMtStepHelp.GetValue());
 
     //do some reasonable automatic correction of user input if necessary
     if (!aCbxAutoMax.IsChecked() && !aCbxAutoMin.IsChecked() &&
Index: chart2/source/controller/dialogs/tp_Scale.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_Scale.hxx,v
retrieving revision 1.4
retrieving revision 1.4.12.1
diff -u -u -p -r1.4 -r1.4.12.1
--- chart2/source/controller/dialogs/tp_Scale.hxx	22 May 2007 17:48:32 -0000	1.4
+++ chart2/source/controller/dialogs/tp_Scale.hxx	21 Jun 2007 09:29:22 -0000	1.4.12.1
@@ -127,6 +127,7 @@ public:
 	static SfxTabPage* Create( Window* pParent, const SfxItemSet& rInAttrs );
 	virtual BOOL FillItemSet( SfxItemSet& rOutAttrs );
 	virtual void Reset( const SfxItemSet& rInAttrs );
+    using TabPage::DeactivatePage;
 	virtual int DeactivatePage( SfxItemSet* pItemSet = NULL );
 
 	void SetNumFormatter( SvNumberFormatter* pFormatter );
Index: chart2/source/controller/dialogs/tp_SeriesStatistic.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_SeriesStatistic.cxx,v
retrieving revision 1.10
retrieving revision 1.10.12.2
diff -u -u -p -r1.10 -r1.10.12.2
--- chart2/source/controller/dialogs/tp_SeriesStatistic.cxx	22 May 2007 17:48:56 -0000	1.10
+++ chart2/source/controller/dialogs/tp_SeriesStatistic.cxx	6 Jul 2007 13:27:35 -0000	1.10.12.2
@@ -35,485 +35,41 @@
 
 // MARKER(update_precomp.py): autogen include statement, do not remove
 #include "precompiled_chart2.hxx"
-#include "tp_SeriesStatistic.hxx"
 
+#include "tp_SeriesStatistic.hxx"
 #include "ResId.hxx"
 #include "TabPages.hrc"
-#include "Strings.hrc"
-#include "Bitmaps.hrc"
-#include "Bitmaps_HC.hrc"
-#include "NoWarningThisInCTOR.hxx"
-
-#ifndef _SVX_CHRTITEM_HXX //autogen
-#include <svx/chrtitem.hxx>
-#endif
-
-// macro for selecting a normal or high contrast bitmap the stack variable
-// bIsHighContrast must exist and reflect the correct state
-#define SELECT_BITMAP(name) Bitmap( SchResId( bIsHighContrast ? name ## _HC : name ))
 
 //.............................................................................
 namespace chart
 {
 //.............................................................................
 
-enum StatIndicator
-{
-	INDICATE_NONE,
-	INDICATE_BOTH,
-	INDICATE_UP,
-	INDICATE_DOWN
-};
-
-enum StatRegression
-{
-	REGRESSION_NONE,
-	REGRESSION_LINE,
-	REGRESSION_LOG,
-	REGRESSION_EXP,
-	REGRESSION_POW
-};
-
-/*************************************************************************
-|*
-|* Dialog zur Ausrichtung der Legende
-|*
-\************************************************************************/
-
-SchStatisticTabPage::SchStatisticTabPage(
-    Window* pWindow,
-    const SfxItemSet& rInAttrs ) :
-        SfxTabPage(pWindow, SchResId(TP_STAT), rInAttrs),
-        aCbxAverage (this, SchResId (CBX_AVERAGE)),
-        aFlDescr (this, SchResId (FL_ERROR)),
-        aRbtNone (this, SchResId (RBT_NONE)),
-        aRbtVariant (this, SchResId (RBT_VARIANT)),
-        aRbtSigma (this, SchResId (RBT_SIGMA)),
-        aRbtPercent (this, SchResId (RBT_PERCENT)),
-        aRbtBigError (this, SchResId (RBT_BIGERROR)),
-        aRbtConst (this, SchResId (RBT_CONST)),
-        aMtrFldPercent (this, SchResId (MTR_FLD_PERCENT)),
-        aMtrFldBigError (this, SchResId (MTR_FLD_BIGERROR)),
-        aFTConstPlus (this, SchResId (FT_PERCENT_PLUS)),
-        aMtrFldConstPlus (this, SchResId (MTR_FLD_PLUS)),
-        aFTConstMinus (this, SchResId (FT_PERCENT_MINUS)),
-        aMtrFldConstMinus (this, SchResId (MTR_FLD_MINUS)),
-        aFTIndicate (this, SchResId (FT_INDICATE)),
-        aSet (this, SchResId (CT_INDICATE)),
-        aFTRegress (this, SchResId (FT_REGRESS)),
-        aRegression (this, SchResId (CT_REGRESS)),
-        m_bEnableRegression( false )
+SchStatisticTabPage::SchStatisticTabPage( Window* pWindow, const SfxItemSet& rInAttrs )
+    : SfxTabPage(pWindow, SchResId(TP_STAT), rInAttrs),
+    m_aErrorBarResources( this,rInAttrs )
 {
-	FreeResource();
-
-	aRbtNone.SetClickHdl(LINK(this, SchStatisticTabPage, RBtnClick));
-	aRbtVariant.SetClickHdl(LINK(this, SchStatisticTabPage, RBtnClick));
-	aRbtSigma.SetClickHdl(LINK(this, SchStatisticTabPage, RBtnClick));
-	aRbtPercent.SetClickHdl(LINK(this, SchStatisticTabPage, RBtnClick));
-	aRbtBigError.SetClickHdl(LINK(this, SchStatisticTabPage, RBtnClick));
-	aRbtConst.SetClickHdl(LINK(this, SchStatisticTabPage, RBtnClick));
-	aCbxAverage.SetClickHdl(LINK(this, SchStatisticTabPage, CbxClick));
-// 	aMtrFldConstPlus.SetLoseFocusHdl(LINK(this, SchStatisticTabPage, EditLoseFocusHdl));
-// 	aMtrFldConstMinus.SetLoseFocusHdl(LINK(this, SchStatisticTabPage, EditLoseFocusHdl));
-
-    FillValueSets();
-
-	aSet.SetStyle (aSet.GetStyle () /*| WB_ITEMBORDER | WB_DOUBLEBORDER*/ | WB_NAMEFIELD /*| WB_VSCROLL*/ );
-	aSet.SetColCount(5);
-	aSet.SetLineCount(1);
-	aSet.SetExtraSpacing(2);
-	aSet.SetSelectHdl(LINK(this, SchStatisticTabPage, SelectIndicate));
-
-    aRegression.SetStyle (aSet.GetStyle () /*| WB_ITEMBORDER | WB_DOUBLEBORDER*/ | WB_NAMEFIELD /*| WB_VSCROLL*/ );
-	aRegression.SetColCount(5);
-	aRegression.SetLineCount(1);
-	aRegression.SetExtraSpacing(2);
-	aRegression.SetSelectHdl(LINK(this, SchStatisticTabPage, SelectRegression));
+    FreeResource();
 }
 
-/*************************************************************************
-|*
-|* Dtor
-|*
-\************************************************************************/
-
 SchStatisticTabPage::~SchStatisticTabPage()
 {
 }
 
-/*************************************************************************
-|*
-|*	Handler fuer ShowSym-Button enablen/disablen
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchStatisticTabPage, RBtnClick, Button *, pBtn )
-{
-	aMtrFldPercent.Enable (pBtn == &aRbtPercent);
-	aMtrFldBigError.Enable (pBtn == &aRbtBigError);
-	aMtrFldConstPlus.Enable (pBtn == &aRbtConst);
-	aMtrFldConstMinus.Enable (pBtn == &aRbtConst);
-    aFTConstPlus.Enable (pBtn == &aRbtConst);
-    aFTConstMinus.Enable (pBtn == &aRbtConst);
-    aSet.Show (pBtn != &aRbtNone);
-    aFTIndicate.Show (pBtn != &aRbtNone);
-
-	if (pBtn == &aRbtPercent) eKindError = CHERROR_PERCENT;
-    else if (pBtn == &aRbtBigError) eKindError = CHERROR_BIGERROR;
-    else if (pBtn == &aRbtConst) eKindError = CHERROR_CONST;
-    else if (pBtn == &aRbtNone) eKindError = CHERROR_NONE;
-    else if (pBtn == &aRbtVariant) eKindError = CHERROR_VARIANT;
-    else if (pBtn == &aRbtSigma) eKindError = CHERROR_SIGMA;
-
-	return 0;
-}
-
-
-/*************************************************************************
-|*
-|*    Bearbeitet das Werteset der Fehlerbalken
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchStatisticTabPage, SelectIndicate, void *, EMPTYARG )
-{
-	StatIndicator eSelection = (StatIndicator) aSet.GetSelectItemId();
-
-	switch (eSelection - 1)
-	{
-		case INDICATE_NONE :
-			eIndicate = CHINDICATE_NONE;
-			break;
-
-		case INDICATE_BOTH :
-			eIndicate = CHINDICATE_BOTH;
-			break;
-
-		case INDICATE_UP :
-			eIndicate = CHINDICATE_UP;
-			break;
-
-		case INDICATE_DOWN :
-			eIndicate = CHINDICATE_DOWN;
-			break;
-	}
-
-	aSet.SelectItem(eSelection);
-	aSet.Show ();
-    aFTIndicate.Show();
-
-	return 0;
-}
-
-/*************************************************************************
-|*
-|*	Handler fuer Mittelwert-Button
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchStatisticTabPage, CbxClick, CheckBox *, pBtn )
-{
-	return 0;
-}
-
-/*************************************************************************
-|*
-|* Erzeugung
-|*
-\*************************************************************************/
-
 SfxTabPage* SchStatisticTabPage::Create(Window* pWindow,
 										const SfxItemSet& rOutAttrs)
 {
-	return new SchStatisticTabPage(pWindow, rOutAttrs);
+    return new SchStatisticTabPage(pWindow, rOutAttrs);
 }
 
-/*************************************************************************
-|*
-|* Fuellt uebergebenen Item-Set mit Dialogbox-Attributen
-|*
-\*************************************************************************/
-
 BOOL SchStatisticTabPage::FillItemSet(SfxItemSet& rOutAttrs)
 {
-    rOutAttrs.Put( SvxChartKindErrorItem( eKindError, SCHATTR_STAT_KIND_ERROR ));
-    rOutAttrs.Put( SvxChartIndicateItem( eIndicate, SCHATTR_STAT_INDICATE ));
-	rOutAttrs.Put( SfxBoolItem (SCHATTR_STAT_AVERAGE, aCbxAverage.IsChecked ()));
-
-	if( m_bEnableRegression )
-        rOutAttrs.Put( SvxChartRegressItem( m_eRegression, SCHATTR_STAT_REGRESSTYPE ));
-
-	switch (eKindError)
-	{
-		case CHERROR_PERCENT :
-			rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldPercent.GetValue () / 10.0, SCHATTR_STAT_PERCENT));
-			break;
-
-		case CHERROR_BIGERROR :
-			rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldBigError.GetValue () / 10.0, SCHATTR_STAT_BIGERROR));
-			break;
-
-		case CHERROR_CONST :
-			rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldConstPlus.GetValue () / 10.0, SCHATTR_STAT_CONSTPLUS));
-			rOutAttrs.Put (SvxDoubleItem ((double) aMtrFldConstMinus.GetValue () / 10.0, SCHATTR_STAT_CONSTMINUS));
-			break;
-
-        case CHERROR_NONE:
-        case CHERROR_VARIANT:
-        case CHERROR_SIGMA:
-            // nothing
-            break;
-	}
-
-	return TRUE;
+    return m_aErrorBarResources.FillItemSet(rOutAttrs);
 }
 
-/*************************************************************************
-|*
-|* Initialisierung
-|*
-\*************************************************************************/
-
 void SchStatisticTabPage::Reset(const SfxItemSet& rInAttrs)
 {
-	const SfxPoolItem *pPoolItem = NULL;
-
-	if (rInAttrs.GetItemState(SCHATTR_STAT_AVERAGE, TRUE, &pPoolItem) == SFX_ITEM_SET)
-		aCbxAverage.Check(((const SfxBoolItem*) pPoolItem)->GetValue());
-
-	if (rInAttrs.GetItemState(SCHATTR_STAT_KIND_ERROR, TRUE, &pPoolItem) == SFX_ITEM_SET)
-		eKindError = ((const SvxChartKindErrorItem*) pPoolItem)->GetValue();
-	else eKindError = CHERROR_NONE;
-
-    aSet.Show(eKindError != CHERROR_NONE);
-    aFTIndicate.Show(eKindError != CHERROR_NONE);
-
-    sal_Int32 nPlusValue = 0;
-	if (rInAttrs.GetItemState(SCHATTR_STAT_CONSTPLUS, TRUE, &pPoolItem) == SFX_ITEM_SET)
-    {
-        nPlusValue = static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue() * 10.0);
-		aMtrFldConstPlus.SetValue( nPlusValue );
-    }
-
-    sal_Int32 nMinusValue = 0;
-	if (rInAttrs.GetItemState(SCHATTR_STAT_CONSTMINUS, TRUE, &pPoolItem) == SFX_ITEM_SET)
-    {
-        nMinusValue = static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue() * 10.0);
-        aMtrFldConstMinus.SetValue( nMinusValue );
-    }
-
-    {
-        sal_Int32 nAvg = (nPlusValue + nMinusValue) / 2;
-        aMtrFldPercent.SetValue(  nAvg );
-        aMtrFldBigError.SetValue( nAvg );
-    }
-
-// 	if (rInAttrs.GetItemState(SCHATTR_STAT_PERCENT, TRUE, &pPoolItem) == SFX_ITEM_SET)
-// 		aMtrFldPercent.SetValue( static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue()  * 10.0 ));
-// 	else aMtrFldPercent.SetValue( 0 );
-
-// 	if (rInAttrs.GetItemState(SCHATTR_STAT_BIGERROR, TRUE, &pPoolItem) == SFX_ITEM_SET)
-// 		aMtrFldBigError.SetValue( static_cast< sal_Int32 >(((const SvxDoubleItem*) pPoolItem)->GetValue()  * 10.0 ));
-// 	else aMtrFldBigError.SetValue( 0 );
-
-    if( m_bEnableRegression )
-    {
-        aFTRegress.Show ();
-        aRegression.Show ();
-    }
-    else
-    {
-        aRegression.Hide ();
-        aFTRegress.Hide ();
-    }
-
-	aRbtNone.Check (eKindError == CHERROR_NONE);
-	aRbtVariant.Check (eKindError == CHERROR_VARIANT);
-	aRbtSigma.Check (eKindError == CHERROR_SIGMA);
-	aRbtPercent.Check (eKindError == CHERROR_PERCENT);
-	aRbtBigError.Check (eKindError == CHERROR_BIGERROR);
-	aRbtConst.Check (eKindError == CHERROR_CONST);
-
-    aMtrFldPercent.Enable (eKindError == CHERROR_PERCENT);
-    aMtrFldBigError.Enable (eKindError == CHERROR_BIGERROR);
-    aMtrFldConstPlus.Enable (eKindError == CHERROR_CONST);
-    aMtrFldConstMinus.Enable (eKindError == CHERROR_CONST);
-    aFTConstPlus.Enable (eKindError == CHERROR_CONST);
-    aFTConstMinus.Enable (eKindError == CHERROR_CONST);
-
-	if (rInAttrs.GetItemState(SCHATTR_STAT_INDICATE, TRUE, &pPoolItem) == SFX_ITEM_SET)
-		eIndicate = ((const SvxChartIndicateItem*) pPoolItem)->GetValue();
-	else eIndicate = CHINDICATE_BOTH;
-
-	switch (eIndicate)
-	{
-		case CHINDICATE_NONE :
-			aSet.SelectItem(INDICATE_NONE + 1);
-			break;
-
-		case CHINDICATE_BOTH :
-			aSet.SelectItem(INDICATE_BOTH + 1);
-			break;
-
-		case CHINDICATE_UP :
-			aSet.SelectItem(INDICATE_UP + 1);
-			break;
-
-		case CHINDICATE_DOWN :
-			aSet.SelectItem(INDICATE_DOWN + 1);
-			break;
-	}
-
-	if (rInAttrs.GetItemState(SCHATTR_STAT_REGRESSTYPE, TRUE, &pPoolItem) == SFX_ITEM_SET)
-		m_eRegression = ((const SvxChartRegressItem *) pPoolItem)->GetValue();
-	else m_eRegression = CHREGRESS_NONE;
-
-	switch (m_eRegression)
-	{
-		case CHREGRESS_NONE :
-			aRegression.SelectItem(REGRESSION_NONE + 1);
-			break;
-
-		case CHREGRESS_LINEAR :
-			aRegression.SelectItem(REGRESSION_LINE + 1);
-			break;
-
-		case CHREGRESS_LOG :
-			aRegression.SelectItem(REGRESSION_LOG + 1);
-			break;
-
-		case CHREGRESS_EXP :
-			aRegression.SelectItem(REGRESSION_EXP + 1);
-			break;
-
-		case CHREGRESS_POWER :
-			aRegression.SelectItem(REGRESSION_POW + 1);
-			break;
-	}
-}
-
-/*************************************************************************
-|*
-|*    Bearbeite das Valueset
-|*
-\*************************************************************************/
-
-// IMPL_LINK( SchStatisticTabPage, EditLoseFocusHdl, Control *, pControl )
-// {
-// 	if ((double) aMtrFldConstPlus.GetValue () == 0.0)
-// 	{
-// 		if ((double) aMtrFldConstMinus.GetValue () == 0.0)
-// 		{
-// 			eIndicate = CHINDICATE_NONE;
-// 			aSet.SelectItem(INDICATE_NONE + 1);
-// 		}
-// 		else if (eIndicate != CHINDICATE_NONE)
-// 			 {
-// 				 eIndicate = CHINDICATE_DOWN;
-// 				 aSet.SelectItem(INDICATE_DOWN + 1);
-// 			 }
-// 	}
-// 	else if ((double) aMtrFldConstMinus.GetValue () == 0.0)
-// 		 {
-// 			 if (eIndicate != CHINDICATE_NONE)
-// 			 {
-// 				 eIndicate = CHINDICATE_UP;
-// 				 aSet.SelectItem(INDICATE_UP + 1);
-// 			 }
-// 		 }
-// 		 else
-// 		 {
-// 			 eIndicate = CHINDICATE_BOTH;
-// 			 aSet.SelectItem(INDICATE_BOTH + 1);
-// 		 }
-
-// 	return 0;
-// }
-
-/*************************************************************************
-|*
-|*    Bearbeitet das Werteset der Regression
-|*
-\*************************************************************************/
-
-IMPL_LINK( SchStatisticTabPage, SelectRegression, void *, EMPTYARG )
-{
-	StatRegression eSelection = (StatRegression) aRegression.GetSelectItemId();
-
-    switch (eSelection - 1)
-	{
-		case REGRESSION_NONE :
-			m_eRegression = CHREGRESS_NONE;
-			break;
-
-		case REGRESSION_LINE :
-			m_eRegression = CHREGRESS_LINEAR;
-			break;
-
-		case REGRESSION_LOG :
-			m_eRegression = CHREGRESS_LOG;
-			break;
-
-		case REGRESSION_EXP :
-			m_eRegression = CHREGRESS_EXP;
-			break;
-
-		case REGRESSION_POW :
-			m_eRegression = CHREGRESS_POWER;
-			break;
-	}
-
-	aRegression.SelectItem(eSelection);
-	aRegression.Show ();
-    aFTRegress.Show ();
-
-    return 0;
-}
-
-void SchStatisticTabPage::FillValueSets()
-{
-    bool bIsHighContrast = ( true && GetDisplayBackground().GetColor().IsDark() );
-
-    if( aSet.GetItemCount() == 0 )
-    {
-        aSet.InsertItem( INDICATE_NONE + 1, SELECT_BITMAP( BMP_INDICATE_NONE ),
-                         String(SchResId(STR_INDICATE_NONE)));
-        aSet.InsertItem( INDICATE_BOTH + 1, SELECT_BITMAP( BMP_INDICATE_BOTH ),
-                         String(SchResId(STR_INDICATE_BOTH)));
-        aSet.InsertItem( INDICATE_DOWN + 1, SELECT_BITMAP( BMP_INDICATE_DOWN ),
-                         String(SchResId(STR_INDICATE_DOWN)));
-        aSet.InsertItem( INDICATE_UP + 1, SELECT_BITMAP( BMP_INDICATE_UP ),
-                         String(SchResId(STR_INDICATE_UP)));
-    }
-    else
-    {
-        aSet.SetItemImage( INDICATE_NONE + 1, SELECT_BITMAP( BMP_INDICATE_NONE ));
-        aSet.SetItemImage( INDICATE_BOTH + 1, SELECT_BITMAP( BMP_INDICATE_BOTH ));
-        aSet.SetItemImage( INDICATE_DOWN + 1, SELECT_BITMAP( BMP_INDICATE_DOWN ));
-        aSet.SetItemImage( INDICATE_UP + 1, SELECT_BITMAP( BMP_INDICATE_UP ));
-    }
-
-    if( aRegression.GetItemCount() == 0 )
-    {
-        aRegression.InsertItem( REGRESSION_NONE + 1, SELECT_BITMAP( BMP_REGRESSION_NONE ),
-                                String(SchResId(STR_REGRESSION_NONE)));
-        aRegression.InsertItem( REGRESSION_LINE + 1, SELECT_BITMAP( BMP_REGRESSION_LINEAR ),
-                                String(SchResId(STR_REGRESSION_LINEAR)));
-        aRegression.InsertItem( REGRESSION_LOG + 1, SELECT_BITMAP( BMP_REGRESSION_LOG ),
-                                String(SchResId(STR_REGRESSION_LOG)));
-        aRegression.InsertItem( REGRESSION_EXP + 1, SELECT_BITMAP( BMP_REGRESSION_EXP ),
-                                String(SchResId(STR_REGRESSION_EXP)));
-        aRegression.InsertItem( REGRESSION_POW + 1, SELECT_BITMAP( BMP_REGRESSION_POWER ),
-                                String(SchResId(STR_REGRESSION_POWER)));
-    }
-    else
-    {
-        aRegression.SetItemImage( REGRESSION_NONE + 1, SELECT_BITMAP( BMP_REGRESSION_NONE ));
-        aRegression.SetItemImage( REGRESSION_LINE + 1, SELECT_BITMAP( BMP_REGRESSION_LINEAR ));
-        aRegression.SetItemImage( REGRESSION_LOG + 1, SELECT_BITMAP( BMP_REGRESSION_LOG ));
-        aRegression.SetItemImage( REGRESSION_EXP + 1, SELECT_BITMAP( BMP_REGRESSION_EXP ));
-        aRegression.SetItemImage( REGRESSION_POW + 1, SELECT_BITMAP( BMP_REGRESSION_POWER ));
-    }
+    m_aErrorBarResources.Reset(rInAttrs);
 }
 
 void SchStatisticTabPage::DataChanged( const DataChangedEvent& rDCEvt )
@@ -521,14 +77,18 @@ void SchStatisticTabPage::DataChanged( c
     SfxTabPage::DataChanged( rDCEvt );
 
     if ( (rDCEvt.GetType() == DATACHANGED_SETTINGS) && (rDCEvt.GetFlags() & SETTINGS_STYLE) )
-        FillValueSets();
+        m_aErrorBarResources.FillValueSets();
 }
 
-void SchStatisticTabPage::EnableRegression( bool bEnable /* = true */ )
+void SchStatisticTabPage::EnableTrendLine( bool bEnable )
 {
-    m_bEnableRegression = bEnable;
+    m_aErrorBarResources.EnableTrendLine( bEnable );
 }
 
+void SchStatisticTabPage::SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth )
+{
+    m_aErrorBarResources.SetAxisMinorStepWidthForErrorBarDecimals( fMinorStepWidth );
+}
 //.............................................................................
 } //namespace chart
 //.............................................................................
Index: chart2/source/controller/dialogs/tp_SeriesStatistic.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_SeriesStatistic.hxx,v
retrieving revision 1.7
retrieving revision 1.7.12.2
diff -u -u -p -r1.7 -r1.7.12.2
--- chart2/source/controller/dialogs/tp_SeriesStatistic.hxx	22 May 2007 17:49:08 -0000	1.7
+++ chart2/source/controller/dialogs/tp_SeriesStatistic.hxx	6 Jul 2007 13:27:15 -0000	1.7.12.2
@@ -35,32 +35,12 @@
 #ifndef _CHART2_TP_SERIESSTATISTIC_HXX
 #define _CHART2_TP_SERIESSTATISTIC_HXX
 
-#include "chartview/ChartSfxItemIds.hxx"
-// header for enum SvxChartKindError
-#ifndef _SVX_CHRTITEM_HXX //autogen
-#include <svx/chrtitem.hxx>
-#endif
+#include "res_ErrorBar.hxx"
 
 // header for SfxTabPage
 #ifndef _SFXTABDLG_HXX
 #include <sfx2/tabdlg.hxx>
 #endif
-// header for class ValueSet
-#ifndef _VALUESET_HXX
-#include <svtools/valueset.hxx>
-#endif
-// header for FixedText
-#ifndef _SV_FIXED_HXX
-#include <vcl/fixed.hxx>
-#endif
-// header for CheckBox
-#ifndef _SV_BUTTON_HXX
-#include <vcl/button.hxx>
-#endif
-// header for MetricField
-#ifndef _SV_FIELD_HXX
-#include <vcl/field.hxx>
-#endif
 
 //.............................................................................
 namespace chart
@@ -69,52 +49,21 @@ namespace chart
 
 class SchStatisticTabPage : public SfxTabPage
 {
-private:
-	CheckBox    aCbxAverage;
-	FixedLine   aFlDescr;
-	RadioButton aRbtNone;
-	RadioButton aRbtVariant;
-	RadioButton aRbtSigma;
-	RadioButton aRbtPercent;
-	RadioButton aRbtBigError;
-	RadioButton aRbtConst;
-	MetricField aMtrFldPercent;
-	MetricField aMtrFldBigError;
-	FixedText	aFTConstPlus;
-	MetricField aMtrFldConstPlus;
-	FixedText	aFTConstMinus;
-	MetricField aMtrFldConstMinus;
-	FixedText	aFTIndicate;
-	ValueSet 	aSet;
-	FixedText	aFTRegress;
-	ValueSet 	aRegression;
-
-    bool                m_bEnableRegression;
-	BOOL                bDisabled;
-	SvxChartKindError   eKindError;
-	SvxChartIndicate    eIndicate;
-	SvxChartRegress     m_eRegression;
-
-	DECL_LINK(CbxClick, CheckBox *);
-	DECL_LINK(RBtnClick, Button *);
-	DECL_LINK(SelectIndicate, void *);
-	DECL_LINK(SelectRegression, void *);
-// 	DECL_LINK(EditLoseFocusHdl, Control*);
-
-    void FillValueSets();
-
 public:
-	SchStatisticTabPage (Window* pParent, const SfxItemSet& rInAttrs);
-	virtual ~SchStatisticTabPage ();
+    SchStatisticTabPage (Window* pParent, const SfxItemSet& rInAttrs);
+    virtual ~SchStatisticTabPage ();
 
-	static SfxTabPage* Create(Window* pParent, const SfxItemSet& rInAttrs);
-	virtual BOOL FillItemSet(SfxItemSet& rOutAttrs);
-	virtual void Reset(const SfxItemSet& rInAttrs);
+    void EnableTrendLine( bool bEnable );
+    void SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth );
 
-	virtual void	DataChanged( const DataChangedEvent& rDCEvt );
+    static SfxTabPage* Create(Window* pParent, const SfxItemSet& rInAttrs);
+    virtual BOOL FillItemSet(SfxItemSet& rOutAttrs);
+    virtual void Reset(const SfxItemSet& rInAttrs);
 
-    /// per default regression is disabled
-    void EnableRegression( bool bEnable = true );
+    virtual void	DataChanged( const DataChangedEvent& rDCEvt );
+
+private:
+    ErrorBarResources   m_aErrorBarResources;
 };
 
 //.............................................................................
Index: chart2/source/controller/dialogs/tp_SeriesToAxis.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_SeriesToAxis.cxx,v
retrieving revision 1.7
retrieving revision 1.7.8.1
diff -u -u -p -r1.7 -r1.7.8.1
--- chart2/source/controller/dialogs/tp_SeriesToAxis.cxx	11 Jun 2007 14:58:16 -0000	1.7
+++ chart2/source/controller/dialogs/tp_SeriesToAxis.cxx	10 Jul 2007 11:57:29 -0000	1.7.8.1
@@ -106,10 +106,10 @@ BOOL SchOptionTabPage::FillItemSet(SfxIt
 		rOutAttrs.Put(SfxInt32Item(SCHATTR_AXIS,CHART_AXIS_PRIMARY_Y));
 
 	if(aMTGap.IsVisible())
-		rOutAttrs.Put(SfxInt32Item(SCHATTR_BAR_GAPWIDTH,aMTGap.GetValue()));
+		rOutAttrs.Put(SfxInt32Item(SCHATTR_BAR_GAPWIDTH,static_cast< sal_Int32 >( aMTGap.GetValue())));
 
 	if(aMTOverlap.IsVisible())
-		rOutAttrs.Put(SfxInt32Item(SCHATTR_BAR_OVERLAP,aMTOverlap.GetValue()));
+		rOutAttrs.Put(SfxInt32Item(SCHATTR_BAR_OVERLAP,static_cast< sal_Int32 >( aMTOverlap.GetValue())));
 
 	if(aCBConnect.IsVisible())
 		rOutAttrs.Put(SfxBoolItem(SCHATTR_BAR_CONNECT,aCBConnect.IsChecked()));
Index: chart2/source/controller/dialogs/tp_TitleRotation.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_TitleRotation.cxx,v
retrieving revision 1.9
retrieving revision 1.9.12.1
diff -u -u -p -r1.9 -r1.9.12.1
--- chart2/source/controller/dialogs/tp_TitleRotation.cxx	22 May 2007 17:49:40 -0000	1.9
+++ chart2/source/controller/dialogs/tp_TitleRotation.cxx	10 Jul 2007 11:57:29 -0000	1.9.12.1
@@ -90,7 +90,6 @@ BOOL SchAlignmentTabPage::FillItemSet(Sf
 
 void SchAlignmentTabPage::Reset(const SfxItemSet& rInAttrs)
 {
-	const SfxPoolItem *pPoolItem = NULL;
     const SfxPoolItem* pItem = GetItem( rInAttrs, SCHATTR_TEXT_DEGREES );
 
     sal_Int32 nDegrees = pItem ? ((const SfxInt32Item*)pItem)->GetValue() : 0;
Index: chart2/source/controller/dialogs/tp_Wizard_TitlesAndObjects.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/dialogs/tp_Wizard_TitlesAndObjects.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/dialogs/tp_Wizard_TitlesAndObjects.cxx	22 May 2007 17:50:14 -0000	1.2
+++ chart2/source/controller/dialogs/tp_Wizard_TitlesAndObjects.cxx	10 Jul 2007 11:57:29 -0000	1.2.12.1
@@ -133,7 +133,7 @@ void TitlesAndObjectsTabPage::initialize
     m_bCommitToModel = true;
 }
 
-sal_Bool TitlesAndObjectsTabPage::commitPage( COMMIT_REASON eReason )
+sal_Bool TitlesAndObjectsTabPage::commitPage( COMMIT_REASON /*eReason*/ )
 {
     if( m_apTitleResources->IsModified() ) //titles may have changed in the meanwhile
         commitToModel();
cvs diff: Diffing chart2/source/controller/drawinglayer
Index: chart2/source/controller/drawinglayer/DrawViewWrapper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/drawinglayer/DrawViewWrapper.cxx,v
retrieving revision 1.15
retrieving revision 1.15.12.2
diff -u -u -p -r1.15 -r1.15.12.2
--- chart2/source/controller/drawinglayer/DrawViewWrapper.cxx	22 May 2007 17:51:08 -0000	1.15
+++ chart2/source/controller/drawinglayer/DrawViewWrapper.cxx	10 Jul 2007 11:57:29 -0000	1.15.12.2
@@ -278,7 +278,9 @@ void DrawViewWrapper::setMarkHandleProvi
     m_pMarkHandleProvider = pMarkHandleProvider;
 }
 
-void DrawViewWrapper::CompleteRedraw( OutputDevice* pOut, const Region& rReg )
+void DrawViewWrapper::CompleteRedraw(
+    OutputDevice* pOut, const Region& rReg, USHORT /* nPaintMode */,
+    ::sdr::contact::ViewObjectContactRedirector* /* pRedirector */ )
 {
     svtools::ColorConfig aColorConfig;
     Color aFillColor = Color( aColorConfig.GetColorValue( svtools::DOCCOLOR ).nColor );
@@ -333,7 +335,7 @@ SfxItemSet DrawViewWrapper::getPositionA
                     0);
     SfxItemSet aGeoSet( E3dView::GetGeoAttrFromMarked() );
     aFullSet.Put( aGeoSet );
-    aFullSet.Put( SfxUInt16Item(SID_ATTR_METRIC,ConfigurationAccess::getConfigurationAccess()->getFieldUnit()) );
+    aFullSet.Put( SfxUInt16Item(SID_ATTR_METRIC,static_cast< sal_uInt16 >( ConfigurationAccess::getConfigurationAccess()->getFieldUnit())));
     return aFullSet;
 }
 
cvs diff: Diffing chart2/source/controller/inc
Index: chart2/source/controller/inc/DataPointItemConverter.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/inc/DataPointItemConverter.hxx,v
retrieving revision 1.9
retrieving revision 1.9.12.1
diff -u -u -p -r1.9 -r1.9.12.1
--- chart2/source/controller/inc/DataPointItemConverter.hxx	22 May 2007 17:53:07 -0000	1.9
+++ chart2/source/controller/inc/DataPointItemConverter.hxx	13 Jul 2007 13:01:15 -0000	1.9.12.1
@@ -81,7 +81,8 @@ public:
             ::std::auto_ptr< ::com::sun::star::awt::Size >(),
         bool bDataSeries = false,
         bool bUseSpecialFillColor = false,
-        sal_Int32 nSpecialFillColor = 0 );
+        sal_Int32 nSpecialFillColor = 0,
+        bool bOverwriteLabelsForAttributedDataPointsAlso=false );
 
     virtual ~DataPointItemConverter();
 
@@ -101,6 +102,7 @@ private:
     ::std::vector< ItemConverter * >    m_aConverters;
     NumberFormatterWrapper *            m_pNumberFormatterWrapper;
     bool                                m_bDataSeries;
+    bool                                m_bOverwriteLabelsForAttributedDataPointsAlso;
     bool                                m_bColorPerPoint;
     bool                                m_bUseSpecialFillColor;
     sal_Int32                           m_nSpecialFillColor;
Index: chart2/source/controller/inc/DrawViewWrapper.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/inc/DrawViewWrapper.hxx,v
retrieving revision 1.8
retrieving revision 1.8.12.1
diff -u -u -p -r1.8 -r1.8.12.1
--- chart2/source/controller/inc/DrawViewWrapper.hxx	22 May 2007 17:53:29 -0000	1.8
+++ chart2/source/controller/inc/DrawViewWrapper.hxx	21 Jun 2007 11:26:34 -0000	1.8.12.1
@@ -94,8 +94,8 @@ public:
     //----------------------
     //pMarkHandleProvider can be NULL; ownership is not taken
     void setMarkHandleProvider( MarkHandleProvider* pMarkHandleProvider );
-
-    void CompleteRedraw( OutputDevice* pOut, const Region& rReg );
+    void CompleteRedraw( OutputDevice* pOut, const Region& rReg, USHORT nPaintMode = 0,
+                         ::sdr::contact::ViewObjectContactRedirector* pRedirector = 0L );
 
     SdrObject*   getSelectedObject() const;
     SdrObject*   getTextEditObject() const;
Index: chart2/source/controller/inc/dlg_InsertDataLabel.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/inc/dlg_InsertDataLabel.hxx,v
retrieving revision 1.3
retrieving revision 1.3.136.1
diff -u -u -p -r1.3 -r1.3.136.1
--- chart2/source/controller/inc/dlg_InsertDataLabel.hxx	8 Sep 2005 00:27:02 -0000	1.3
+++ chart2/source/controller/inc/dlg_InsertDataLabel.hxx	13 Jul 2007 11:19:02 -0000	1.3.136.1
@@ -32,8 +32,8 @@
  *    MA  02111-1307  USA
  *
  ************************************************************************/
-#ifndef _CHART2_DLG_INSERT_DATALABELS_GRID_HXX
-#define _CHART2_DLG_INSERT_DATALABELS_GRID_HXX
+#ifndef CHART2_DLG_INSERT_DATALABELS_GRID_HXX
+#define CHART2_DLG_INSERT_DATALABELS_GRID_HXX
 
 // header for class ModalDialog
 #ifndef _SV_DIALOG_HXX
@@ -51,41 +51,35 @@
 #ifndef _SFXITEMSET_HXX
 #include <svtools/itemset.hxx>
 #endif
+//for auto_ptr
+#include <memory>
+
+class SvNumberFormatter;
 
 //.............................................................................
 namespace chart
 {
 //.............................................................................
 
-/*************************************************************************
-|*
-|* Datenbeschriftungen-Dialog
-|*
-\************************************************************************/
-class SchDataDescrDlg : public ModalDialog
+class DataLabelResources;
+class DataLabelsDialog : public ModalDialog
 {
 private:
-	CheckBox			aCbValue;
-	RadioButton			aRbNumber;
-	RadioButton			aRbPercent;
-	CheckBox			aCbText;
-	FixedLine			aFlDescr;
-	CheckBox			aCbSymbol;
-	OKButton			aBtnOK;
-	CancelButton		aBtnCancel;
-	HelpButton			aBtnHelp;
+	OKButton			m_aBtnOK;
+	CancelButton		m_aBtnCancel;
+	HelpButton			m_aBtnHelp;
+    ::std::auto_ptr< DataLabelResources >    m_apDataLabelResources;
+    FixedLine			m_aFlDescr;
 
 	const SfxItemSet&	m_rInAttrs;
 
-	DECL_LINK( EnableHdl, CheckBox * );
-
 	void Reset();
 
 public:
-	SchDataDescrDlg(Window* pParent, const SfxItemSet& rInAttrs);
-	virtual ~SchDataDescrDlg();
+	DataLabelsDialog(Window* pParent, const SfxItemSet& rInAttrs, SvNumberFormatter* pFormatter);
+	virtual ~DataLabelsDialog();
 
-	void GetAttr(SfxItemSet& rOutAttrs);
+	void FillItemSet(SfxItemSet& rOutAttrs);
 };
 
 //.............................................................................
Index: chart2/source/controller/inc/dlg_InsertStatistic.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/inc/dlg_InsertStatistic.hxx,v
retrieving revision 1.6
retrieving revision 1.6.12.2
diff -u -u -p -r1.6 -r1.6.12.2
--- chart2/source/controller/inc/dlg_InsertStatistic.hxx	22 May 2007 17:59:07 -0000	1.6
+++ chart2/source/controller/inc/dlg_InsertStatistic.hxx	6 Jul 2007 13:24:21 -0000	1.6.12.2
@@ -39,11 +39,7 @@
 #ifndef _SV_DIALOG_HXX
 #include <vcl/dialog.hxx>
 #endif
-// header for class FixedLine
-#ifndef _SV_FIXED_HXX
-#include <vcl/fixed.hxx>
-#endif
-// header for class CheckBox
+// header for buttons
 #ifndef _SV_BUTTON_HXX
 #include <vcl/button.hxx>
 #endif
@@ -51,18 +47,11 @@
 #ifndef _SFXITEMSET_HXX
 #include <svtools/itemset.hxx>
 #endif
-// header for class MetricField
-#ifndef _SV_FIELD_HXX
-#include <vcl/field.hxx>
-#endif
-// header for class ValueSet
-#ifndef _VALUESET_HXX
-#include <svtools/valueset.hxx>
-#endif
-// header for enum SvxChartKindError
-#include "chartview/ChartSfxItemIds.hxx"
-#ifndef _SVX_CHRTITEM_HXX
-#include <svx/chrtitem.hxx>
+//for auto_ptr
+#include <memory>
+
+#ifndef _COM_SUN_STAR_FRAME_XMODEL_HPP_
+#include <com/sun/star/frame/XModel.hpp>
 #endif
 
 //.............................................................................
@@ -70,68 +59,35 @@ namespace chart
 {
 //.............................................................................
 
-/*************************************************************************
-|*
-|* Datenbeschriftungen-Dialog
-|*
-\************************************************************************/
+class ErrorBarResources;
 class SchDataStatisticsDlg : public ModalDialog
 {
-private:
-	CheckBox            aCbxAverage;
-	RadioButton         aRbtNone;
-	RadioButton         aRbtVariant;
-	RadioButton         aRbtSigma;
-	RadioButton         aRbtPercent;
-	RadioButton         aRbtBigError;
-	RadioButton         aRbtConst;
-	FixedLine			aFlDescr;
-	MetricField         aMtrFldPercent;
-	MetricField         aMtrFldBigError;
-	FixedText		    aFTConstPlus;
-	MetricField         aMtrFldConstPlus;
-	FixedText		    aFTConstMinus;
-	MetricField         aMtrFldConstMinus;
-	FixedText		    aFTIndicate;
-	FixedText		    aFTRegress;
-	ValueSet 		    aSet;
-	ValueSet 		    aRegression;
-	OKButton			aBtnOK;
-	CancelButton		aBtnCancel;
-	HelpButton			aBtnHelp;
-    bool                m_bEnableRegression;
-
-	const SfxItemSet    &rInAttrs;
-	SvxChartKindError   m_eErrorKind;
-    bool                m_bErrorKindUnique;
-	SvxChartIndicate    m_eIndicate;
-    bool                m_bIndicatorUnique;
-	SvxChartRegress     m_eRegression;
-    bool                m_bRegressionUnique;
-
-    bool                m_bPlusUnique;
-    bool                m_bMinusUnique;
-
-	DECL_LINK(CbxClick, CheckBox *);
-	DECL_LINK(RBtnClick, Button *);
-	DECL_LINK(SelectIndicate, void *);
-	DECL_LINK(SelectRegression, void *);
-// 	DECL_LINK(EditLoseFocusHdl, Control*);
-
-	void Reset();
-    void FillValueSets();
-
 public:
-	SchDataStatisticsDlg (Window           *pParent,
-						  const SfxItemSet &rMyAttrs);
+    SchDataStatisticsDlg(Window* pParent, const SfxItemSet &rMyAttrs);
+    virtual ~SchDataStatisticsDlg ();
 
-	virtual ~SchDataStatisticsDlg ();
+    void EnableTrendLine( bool bEnable );
+    void SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth );
 
-	void GetAttr(SfxItemSet &rOutAttrs);
+    static double getAxisMinorStepWidthForErrorBarDecimals(
+        const ::com::sun::star::uno::Reference<
+            ::com::sun::star::frame::XModel >& xChartModel,
+        const ::com::sun::star::uno::Reference<
+            ::com::sun::star::uno::XInterface >& xChartView,
+        const ::rtl::OUString& rSelectedObjectCID );
 
+    void FillItemSet(SfxItemSet &rOutAttrs);
     virtual void	DataChanged( const DataChangedEvent& rDCEvt );
 
-    void EnableRegression( bool bEnable = true );
+private:
+    void Reset();
+    const SfxItemSet    &rInAttrs;
+
+    OKButton			aBtnOK;
+    CancelButton		aBtnCancel;
+    HelpButton			aBtnHelp;
+
+    ::std::auto_ptr< ErrorBarResources >    m_apErrorBarResources;
 };
 
 //.............................................................................
Index: chart2/source/controller/inc/dlg_ObjectProperties.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/inc/dlg_ObjectProperties.hxx,v
retrieving revision 1.6
retrieving revision 1.6.12.1
diff -u -u -p -r1.6 -r1.6.12.1
--- chart2/source/controller/inc/dlg_ObjectProperties.hxx	22 May 2007 17:59:32 -0000	1.6
+++ chart2/source/controller/inc/dlg_ObjectProperties.hxx	6 Jul 2007 13:29:43 -0000	1.6.12.1
@@ -117,6 +117,8 @@ private:
     SfxItemSet*     m_pSymbolShapeProperties;
     Graphic*		m_pAutoSymbolGraphic;
 
+    double          m_fAxisMinorStepWidthForErrorBarDecimals;
+
     virtual void PageCreated(USHORT nId, SfxTabPage& rPage);
 
 public:
@@ -131,6 +133,8 @@ public:
     //pAutoSymbolGraphic: Graphic to be shown if AutoSymbol gets selected
     //this class takes ownership over both parameter
     void setSymbolInformation( SfxItemSet* pSymbolShapeProperties, Graphic* pAutoSymbolGraphic );
+
+    void SetAxisMinorStepWidthForErrorBarDecimals( double fMinorStepWidth );
 };
 
 //.............................................................................
cvs diff: Diffing chart2/source/controller/itemsetwrapper
Index: chart2/source/controller/itemsetwrapper/AxisItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/AxisItemConverter.cxx,v
retrieving revision 1.9
retrieving revision 1.9.12.1
diff -u -u -p -r1.9 -r1.9.12.1
--- chart2/source/controller/itemsetwrapper/AxisItemConverter.cxx	22 May 2007 18:00:06 -0000	1.9
+++ chart2/source/controller/itemsetwrapper/AxisItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.9.12.1
@@ -386,7 +386,7 @@ bool AxisItemConverter::ApplySpecialItem
     switch( nWhichId )
     {
         case SCHATTR_AXIS_AUTO_MAX:
-            if( (reinterpret_cast< const SfxBoolItem & >(
+            if( (static_cast< const SfxBoolItem & >(
                      rItemSet.Get( nWhichId )).GetValue() ))
             {
                 aScale.Maximum.clear();
@@ -397,7 +397,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         case SCHATTR_AXIS_MAX:
             // only if auto if false
-            if( ! (reinterpret_cast< const SfxBoolItem & >(
+            if( ! (static_cast< const SfxBoolItem & >(
                        rItemSet.Get( SCHATTR_AXIS_AUTO_MAX )).GetValue() ))
             {
                 rItemSet.Get( nWhichId ).QueryValue( aValue );
@@ -411,7 +411,7 @@ bool AxisItemConverter::ApplySpecialItem
             break;
 
         case SCHATTR_AXIS_AUTO_MIN:
-            if( (reinterpret_cast< const SfxBoolItem & >(
+            if( (static_cast< const SfxBoolItem & >(
                      rItemSet.Get( nWhichId )).GetValue() ))
             {
                 aScale.Minimum.clear();
@@ -422,7 +422,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         case SCHATTR_AXIS_MIN:
             // only if auto if false
-            if( ! (reinterpret_cast< const SfxBoolItem & >(
+            if( ! (static_cast< const SfxBoolItem & >(
                        rItemSet.Get( SCHATTR_AXIS_AUTO_MIN )).GetValue() ))
             {
                 rItemSet.Get( nWhichId ).QueryValue( aValue );
@@ -445,7 +445,7 @@ bool AxisItemConverter::ApplySpecialItem
                   (xServiceName->getServiceName()).equals(
                       C2U( "com.sun.star.chart2.LogarithmicScaling" )));
 
-            if( (reinterpret_cast< const SfxBoolItem & >(
+            if( (static_cast< const SfxBoolItem & >(
                      rItemSet.Get( nWhichId )).GetValue() ))
             {
                 // logarithm is true
@@ -469,7 +469,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         // Increment
         case SCHATTR_AXIS_AUTO_STEP_MAIN:
-            if( (reinterpret_cast< const SfxBoolItem & >(
+            if( (static_cast< const SfxBoolItem & >(
                      rItemSet.Get( nWhichId )).GetValue() ))
             {
                 aScale.IncrementData.Distance.clear();
@@ -480,7 +480,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         case SCHATTR_AXIS_STEP_MAIN:
             // only if auto if false
-            if( ! (reinterpret_cast< const SfxBoolItem & >(
+            if( ! (static_cast< const SfxBoolItem & >(
                        rItemSet.Get( SCHATTR_AXIS_AUTO_STEP_MAIN )).GetValue() ))
             {
                 rItemSet.Get( nWhichId ).QueryValue( aValue );
@@ -495,7 +495,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         // SubIncrement
         case SCHATTR_AXIS_AUTO_STEP_HELP:
-            if( (reinterpret_cast< const SfxBoolItem & >(
+            if( (static_cast< const SfxBoolItem & >(
                      rItemSet.Get( nWhichId )).GetValue() ) &&
                 aScale.IncrementData.SubIncrements.getLength() > 0 &&
                 aScale.IncrementData.SubIncrements[0].IntervalCount.hasValue() )
@@ -508,7 +508,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         case SCHATTR_AXIS_STEP_HELP:
             // only if auto if false
-            if( ! (reinterpret_cast< const SfxBoolItem & >(
+            if( ! (static_cast< const SfxBoolItem & >(
                        rItemSet.Get( SCHATTR_AXIS_AUTO_STEP_HELP )).GetValue() ) &&
                 aScale.IncrementData.SubIncrements.getLength() > 0 )
             {
@@ -526,7 +526,7 @@ bool AxisItemConverter::ApplySpecialItem
 
         case SCHATTR_AXIS_AUTO_ORIGIN:
         {
-            if( (reinterpret_cast< const SfxBoolItem & >(
+            if( (static_cast< const SfxBoolItem & >(
                      rItemSet.Get( nWhichId )).GetValue() ))
             {
                 aScale.Origin.clear();
@@ -538,7 +538,7 @@ bool AxisItemConverter::ApplySpecialItem
         case SCHATTR_AXIS_ORIGIN:
         {
             // only if auto is false
-            if( ! (reinterpret_cast< const SfxBoolItem & >(
+            if( ! (static_cast< const SfxBoolItem & >(
                        rItemSet.Get( SCHATTR_AXIS_AUTO_ORIGIN )).GetValue() ))
             {
                 rItemSet.Get( nWhichId ).QueryValue( aValue );
@@ -556,7 +556,7 @@ bool AxisItemConverter::ApplySpecialItem
         {
             // convert int to double (divided by 100)
             double fVal = static_cast< double >(
-                reinterpret_cast< const SfxInt32Item & >(
+                static_cast< const SfxInt32Item & >(
                     rItemSet.Get( nWhichId )).GetValue()) / 100.0;
             double fOldVal = 0.0;
             bool bPropExisted =
@@ -577,13 +577,13 @@ bool AxisItemConverter::ApplySpecialItem
             if( m_pExplicitScale )
             {
                 bool bUseSourceFormat =
-                    (reinterpret_cast< const SfxBoolItem & >(
+                    (static_cast< const SfxBoolItem & >(
                         rItemSet.Get( SID_ATTR_NUMBERFORMAT_SOURCE )).GetValue() );
 
                 if( ! bUseSourceFormat )
                 {
                     sal_Int32 nFmt = static_cast< sal_Int32 >(
-                        reinterpret_cast< const SfxUInt32Item & >(
+                        static_cast< const SfxUInt32Item & >(
                             rItemSet.Get( nWhichId )).GetValue());
 
                     aValue = uno::makeAny(nFmt);
@@ -600,7 +600,7 @@ bool AxisItemConverter::ApplySpecialItem
         case SID_ATTR_NUMBERFORMAT_SOURCE:
         {
             bool bUseSourceFormat =
-                (reinterpret_cast< const SfxBoolItem & >(
+                (static_cast< const SfxBoolItem & >(
                     rItemSet.Get( nWhichId )).GetValue() );
             bool bNumberFormatIsSet = ( GetPropertySet()->getPropertyValue( C2U( "NumberFormat" )).hasValue());
 
@@ -609,13 +609,11 @@ bool AxisItemConverter::ApplySpecialItem
             {
                 if( ! bUseSourceFormat )
                 {
-                    sal_Int32 nTest = 0;
-
                     SfxItemState aState = rItemSet.GetItemState( SID_ATTR_NUMBERFORMAT_VALUE );
                     if( aState == SFX_ITEM_SET )
                     {
                         sal_Int32 nFormatKey = static_cast< sal_Int32 >(
-                        reinterpret_cast< const SfxUInt32Item & >(
+                        static_cast< const SfxUInt32Item & >(
                             rItemSet.Get( SID_ATTR_NUMBERFORMAT_VALUE )).GetValue());
                         aValue <<= nFormatKey;
                     }
Index: chart2/source/controller/itemsetwrapper/CharacterPropertyItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/CharacterPropertyItemConverter.cxx,v
retrieving revision 1.10
retrieving revision 1.10.12.1
diff -u -u -p -r1.10 -r1.10.12.1
--- chart2/source/controller/itemsetwrapper/CharacterPropertyItemConverter.cxx	22 May 2007 18:00:20 -0000	1.10
+++ chart2/source/controller/itemsetwrapper/CharacterPropertyItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.10.12.1
@@ -318,7 +318,7 @@ bool CharacterPropertyItemConverter::App
                 aPostfix = C2U( "Complex" );
 
             const SvxFontItem & rItem =
-                reinterpret_cast< const SvxFontItem & >(
+                static_cast< const SvxFontItem & >(
                     rItemSet.Get( nWhichId ));
 
             if( rItem.QueryValue( aValue, MID_FONT_FAMILY_NAME ))
@@ -367,7 +367,7 @@ bool CharacterPropertyItemConverter::App
         case EE_CHAR_UNDERLINE:
         {
             const SvxUnderlineItem & rItem =
-                reinterpret_cast< const SvxUnderlineItem & >(
+               static_cast< const SvxUnderlineItem & >(
                     rItemSet.Get( nWhichId ));
 
             if( rItem.QueryValue( aValue, MID_UNDERLINE ))
@@ -410,7 +410,7 @@ bool CharacterPropertyItemConverter::App
                 aPostfix = C2U( "Complex" );
 
             const SvxPostureItem & rItem =
-                reinterpret_cast< const SvxPostureItem & >(
+                static_cast< const SvxPostureItem & >(
                     rItemSet.Get( nWhichId ));
 
             if( rItem.QueryValue( aValue, MID_POSTURE ))
@@ -435,7 +435,7 @@ bool CharacterPropertyItemConverter::App
                 aPostfix = C2U( "Complex" );
 
             const SvxWeightItem & rItem =
-                reinterpret_cast< const SvxWeightItem & >(
+                static_cast< const SvxWeightItem & >(
                     rItemSet.Get( nWhichId ));
 
             if( rItem.QueryValue( aValue, MID_WEIGHT ))
@@ -460,7 +460,7 @@ bool CharacterPropertyItemConverter::App
                 aPostfix = C2U( "Complex" );
 
             const SvxFontHeightItem & rItem =
-                reinterpret_cast< const SvxFontHeightItem & >(
+                static_cast< const SvxFontHeightItem & >(
                     rItemSet.Get( nWhichId ));
 
             try
Index: chart2/source/controller/itemsetwrapper/DataPointItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/DataPointItemConverter.cxx,v
retrieving revision 1.14
retrieving revision 1.14.12.2
diff -u -u -p -r1.14 -r1.14.12.2
--- chart2/source/controller/itemsetwrapper/DataPointItemConverter.cxx	22 May 2007 18:00:32 -0000	1.14
+++ chart2/source/controller/itemsetwrapper/DataPointItemConverter.cxx	13 Jul 2007 13:01:50 -0000	1.14.12.2
@@ -44,6 +44,7 @@
 #include "CharacterPropertyItemConverter.hxx"
 #include "StatisticsItemConverter.hxx"
 #include "SeriesOptionsItemConverter.hxx"
+#include "DataSeriesHelper.hxx"
 
 #ifndef _SVX_CHRTITEM_HXX
 #include <svx/chrtitem.hxx>
@@ -85,6 +86,7 @@
 #include <algorithm>
 
 using namespace ::com::sun::star;
+using ::com::sun::star::uno::Reference;
 
 namespace
 {
@@ -144,11 +146,13 @@ DataPointItemConverter::DataPointItemCon
     ::std::auto_ptr< awt::Size > pRefSize /* = NULL */,
     bool bDataSeries /* = false */,
     bool bUseSpecialFillColor /* = false */,
-    sal_Int32 nSpecialFillColor /* =0 */
+    sal_Int32 nSpecialFillColor /* =0 */,
+    bool bOverwriteLabelsForAttributedDataPointsAlso /*false*/
     ) :
         ItemConverter( rPropertySet, rItemPool ),
         m_pNumberFormatterWrapper( pNumFormatter ),
         m_bDataSeries( bDataSeries ),
+        m_bOverwriteLabelsForAttributedDataPointsAlso(m_bDataSeries && bOverwriteLabelsForAttributedDataPointsAlso),
         m_bUseSpecialFillColor(bUseSpecialFillColor),
         m_nSpecialFillColor(nSpecialFillColor)
 {
@@ -228,7 +232,7 @@ bool DataPointItemConverter::ApplySpecia
         case SCHATTR_DATADESCR_DESCR:
         {
             const SvxChartDataDescrItem & rItem =
-                reinterpret_cast< const SvxChartDataDescrItem & >(
+                static_cast< const SvxChartDataDescrItem & >(
                     rItemSet.Get( nWhichId ));
 
             chart2::DataPointLabel aLabel;
@@ -271,7 +275,19 @@ bool DataPointItemConverter::ApplySpecia
                 }
 
                 aValue <<= aLabel;
-                if( aValue != GetPropertySet()->getPropertyValue( C2U( "Label" ) ))
+
+                uno::Any aOldValue( GetPropertySet()->getPropertyValue( C2U( "Label" ) ));
+                if( m_bOverwriteLabelsForAttributedDataPointsAlso )
+                {
+                    Reference< chart2::XDataSeries > xSeries( GetPropertySet(), uno::UNO_QUERY);
+                    if( aValue != aOldValue || 
+                        DataSeriesHelper::hasAttributedDataPointDifferentValue( xSeries, C2U( "Label" ), aOldValue ) )
+                    {
+                        DataSeriesHelper::setPropertyAlsoToAllAttributedDataPoints( xSeries, C2U( "Label" ), aValue );
+                        bChanged = true;
+                    }
+                }
+                else if( aValue != aOldValue )
                 {
                     GetPropertySet()->setPropertyValue( C2U( "Label" ), aValue );
                     bChanged = true;
@@ -283,15 +299,26 @@ bool DataPointItemConverter::ApplySpecia
         case SCHATTR_DATADESCR_SHOW_SYM:
         {
             const SvxChartDataDescrItem & rItem =
-                reinterpret_cast< const SvxChartDataDescrItem & >(
+                static_cast< const SvxChartDataDescrItem & >(
                     rItemSet.Get( nWhichId ));
 
+            uno::Any aOldValue( GetPropertySet()->getPropertyValue( C2U( "Label" ) ));
             chart2::DataPointLabel aLabel;
-            if( GetPropertySet()->getPropertyValue( C2U( "Label" )) >>= aLabel )
+            if( aOldValue >>= aLabel )
             {
                 sal_Bool bOldValue = aLabel.ShowLegendSymbol;
                 aLabel.ShowLegendSymbol = static_cast< sal_Bool >( rItem.GetValue() );
-                if( bOldValue != aLabel.ShowLegendSymbol )
+                if( m_bOverwriteLabelsForAttributedDataPointsAlso )
+                {
+                    Reference< chart2::XDataSeries > xSeries( GetPropertySet(), uno::UNO_QUERY);
+                    if( bOldValue != aLabel.ShowLegendSymbol || 
+                        DataSeriesHelper::hasAttributedDataPointDifferentValue( xSeries, C2U( "Label" ), aOldValue ) )
+                    {
+                        DataSeriesHelper::setPropertyAlsoToAllAttributedDataPoints( xSeries, C2U( "Label" ), uno::makeAny( aLabel ) );
+                        bChanged = true;
+                    }
+                }
+                else if( bOldValue != aLabel.ShowLegendSymbol )
                 {
                     GetPropertySet()->setPropertyValue( C2U( "Label" ), uno::makeAny( aLabel ));
                     bChanged = true;
@@ -305,7 +332,7 @@ bool DataPointItemConverter::ApplySpecia
             if( m_pNumberFormatterWrapper )
             {
                 sal_Int32 nFmt = static_cast< sal_Int32 >(
-                    reinterpret_cast< const SfxUInt32Item & >(
+                    static_cast< const SfxUInt32Item & >(
                         rItemSet.Get( nWhichId )).GetValue());
 
                 aValue = uno::makeAny(nFmt);
@@ -325,7 +352,7 @@ bool DataPointItemConverter::ApplySpecia
         case SCHATTR_STYLE_SYMBOL:
         {
             sal_Int32 nStyle =
-                reinterpret_cast< const SfxInt32Item & >(
+                static_cast< const SfxInt32Item & >(
                     rItemSet.Get( nWhichId )).GetValue();
             chart2::Symbol aSymbol;
 
@@ -367,7 +394,7 @@ bool DataPointItemConverter::ApplySpecia
 
         case SCHATTR_SYMBOL_SIZE:
         {
-            Size aSize = reinterpret_cast< const SvxSizeItem & >(
+            Size aSize = static_cast< const SvxSizeItem & >(
                 rItemSet.Get( nWhichId )).GetSize();
             chart2::Symbol aSymbol;
 
@@ -386,7 +413,7 @@ bool DataPointItemConverter::ApplySpecia
 
         case SCHATTR_SYMBOL_BRUSH:
         {
-            const SvxBrushItem & rBrshItem( reinterpret_cast< const SvxBrushItem & >(
+            const SvxBrushItem & rBrshItem( static_cast< const SvxBrushItem & >(
                                                 rItemSet.Get( nWhichId )));
             uno::Any aXGraphicAny;
             const Graphic *pGraphic( rBrshItem.GetGraphic());
@@ -451,6 +478,16 @@ void DataPointItemConverter::FillSpecial
 
                 rOutItemSet.Put( SvxChartDataDescrItem( aDescr, SCHATTR_DATADESCR_DESCR ));
                 rOutItemSet.Put( SfxBoolItem( SCHATTR_DATADESCR_SHOW_SYM, aLabel.ShowLegendSymbol ));
+
+                if( m_bOverwriteLabelsForAttributedDataPointsAlso )
+                {
+                    if( DataSeriesHelper::hasAttributedDataPointDifferentValue(
+                        Reference< chart2::XDataSeries >( GetPropertySet(), uno::UNO_QUERY), C2U( "Label" ), uno::makeAny(aLabel) ) )
+                    {
+                        rOutItemSet.InvalidateItem(SCHATTR_DATADESCR_DESCR);
+                        rOutItemSet.InvalidateItem(SCHATTR_DATADESCR_SHOW_SYM);
+                    }
+                }
             }
         }
         break;
Index: chart2/source/controller/itemsetwrapper/GraphicPropertyItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/GraphicPropertyItemConverter.cxx,v
retrieving revision 1.9
retrieving revision 1.9.12.1
diff -u -u -p -r1.9 -r1.9.12.1
--- chart2/source/controller/itemsetwrapper/GraphicPropertyItemConverter.cxx	22 May 2007 18:00:42 -0000	1.9
+++ chart2/source/controller/itemsetwrapper/GraphicPropertyItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.9.12.1
@@ -555,7 +555,7 @@ bool GraphicPropertyItemConverter::Apply
             if( lcl_supportsFillProperties( m_eGraphicObjectType ))
             {
                 const ::rtl::OUString aModePropName = C2U("FillBitmapMode");
-                bool bStretched = reinterpret_cast< const XFillBmpStretchItem & >(
+                bool bStretched = static_cast< const XFillBmpStretchItem & >(
                     rItemSet.Get( XATTR_FILLBMP_STRETCH )).GetValue();
                 drawing::BitmapMode aMode =
                     (bStretched ? drawing::BitmapMode_STRETCH : drawing::BitmapMode_NO_REPEAT);
@@ -573,7 +573,7 @@ bool GraphicPropertyItemConverter::Apply
             if( lcl_supportsFillProperties( m_eGraphicObjectType ))
             {
                 const ::rtl::OUString aModePropName = C2U("FillBitmapMode");
-                bool bTiled = reinterpret_cast< const XFillBmpTileItem & >(
+                bool bTiled = static_cast< const XFillBmpTileItem & >(
                     rItemSet.Get( XATTR_FILLBMP_TILE )).GetValue();
                 drawing::BitmapMode aMode =
                     (bTiled ? drawing::BitmapMode_REPEAT : drawing::BitmapMode_NO_REPEAT);
@@ -622,7 +622,7 @@ bool GraphicPropertyItemConverter::Apply
                           : C2U( "FillTransparenceGradientName" );
 
                     const XFillFloatTransparenceItem & rItem =
-                        reinterpret_cast< const XFillFloatTransparenceItem & >(
+                        static_cast< const XFillFloatTransparenceItem & >(
                             rItemSet.Get( nWhichId ));
 
                     if( rItem.IsEnabled() &&
@@ -672,7 +672,7 @@ bool GraphicPropertyItemConverter::Apply
                     ? C2U( "GradientStepCount" )
                     : C2U( "FillGradientStepCount" );
 
-                sal_Int16 nStepCount = ( reinterpret_cast< const XGradientStepCountItem & >(
+                sal_Int16 nStepCount = ( static_cast< const XGradientStepCountItem & >(
                             rItemSet.Get( nWhichId ))).GetValue();
 
                 aValue <<= nStepCount;
@@ -697,7 +697,7 @@ bool GraphicPropertyItemConverter::Apply
                     : C2U( "LineDashName" );
 
                 const XLineDashItem & rItem =
-                    reinterpret_cast< const XLineDashItem & >(
+                    static_cast< const XLineDashItem & >(
                         rItemSet.Get( nWhichId ));
 
                 if( rItem.QueryValue( aValue, MID_NAME ))
@@ -730,7 +730,7 @@ bool GraphicPropertyItemConverter::Apply
                     : C2U( "FillGradientName" );
 
                 const XFillGradientItem & rItem =
-                    reinterpret_cast< const XFillGradientItem & >(
+                    static_cast< const XFillGradientItem & >(
                         rItemSet.Get( nWhichId ));
 
                 if( rItem.QueryValue( aValue, MID_NAME ))
@@ -763,7 +763,7 @@ bool GraphicPropertyItemConverter::Apply
                     : C2U( "FillHatchName" );
 
                 const XFillHatchItem & rItem =
-                    reinterpret_cast< const XFillHatchItem & >(
+                    static_cast< const XFillHatchItem & >(
                         rItemSet.Get( nWhichId ));
 
                 if( rItem.QueryValue( aValue, MID_NAME ))
@@ -791,7 +791,7 @@ bool GraphicPropertyItemConverter::Apply
             if( lcl_supportsFillProperties( m_eGraphicObjectType ))
             {
                 const XFillBitmapItem & rItem =
-                    reinterpret_cast< const XFillBitmapItem & >(
+                    static_cast< const XFillBitmapItem & >(
                         rItemSet.Get( nWhichId ));
 
                 if( rItem.QueryValue( aValue, MID_NAME ))
@@ -827,7 +827,7 @@ bool GraphicPropertyItemConverter::Apply
                       : C2U( "LineTransparence" );
 
                 const XLineTransparenceItem & rItem =
-                    reinterpret_cast< const XLineTransparenceItem & >(
+                    static_cast< const XLineTransparenceItem & >(
                         rItemSet.Get( nWhichId ));
 
                 if( rItem.QueryValue( aValue ))
@@ -864,7 +864,7 @@ bool GraphicPropertyItemConverter::Apply
                       : C2U( "FillTransparence" );
 
                 const XFillTransparenceItem & rItem =
-                    reinterpret_cast< const XFillTransparenceItem & >(
+                    static_cast< const XFillTransparenceItem & >(
                         rItemSet.Get( nWhichId ));
 
                 if( rItem.QueryValue( aValue ))
@@ -972,7 +972,7 @@ void GraphicPropertyItemConverter::Apply
             case XATTR_FILLBITMAP:
             {
                 const XFillBitmapItem & rBitmapItem =
-                    reinterpret_cast< const XFillBitmapItem & >(
+                    static_cast< const XFillBitmapItem & >(
                         rItemSet.Get( nWhichId ));
                 rBitmapItem.QueryValue( aValue, MID_GRAFURL );
                 aValue >>= aBitmap.aURL;
@@ -988,10 +988,10 @@ void GraphicPropertyItemConverter::Apply
             case XATTR_FILLBMP_STRETCH:
             {
                 const XFillBmpStretchItem & rStretchItem =
-                    reinterpret_cast< const XFillBmpStretchItem & >(
+                    static_cast< const XFillBmpStretchItem & >(
                         rItemSet.Get( XATTR_FILLBMP_STRETCH ));
                 const XFillBmpTileItem & rTileItem =
-                    reinterpret_cast< const XFillBmpTileItem & >(
+                    static_cast< const XFillBmpTileItem & >(
                         rItemSet.Get( XATTR_FILLBMP_TILE ));
 
                 if( rTileItem.GetValue() != FALSE )
Index: chart2/source/controller/itemsetwrapper/ItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/ItemConverter.cxx,v
retrieving revision 1.10
retrieving revision 1.10.12.1
diff -u -u -p -r1.10 -r1.10.12.1
--- chart2/source/controller/itemsetwrapper/ItemConverter.cxx	22 May 2007 18:00:55 -0000	1.10
+++ chart2/source/controller/itemsetwrapper/ItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.10.12.1
@@ -185,14 +185,14 @@ void ItemConverter::FillItemSet( SfxItem
 }
 
 void ItemConverter::FillSpecialItem(
-    USHORT nWhichId, SfxItemSet & rOutItemSet ) const
+    USHORT /*nWhichId*/, SfxItemSet & /*rOutItemSet*/ ) const
     throw( uno::Exception )
 {
     OSL_ENSURE( false, "ItemConverter: Unhandled special item found!" );
 }
 
 bool ItemConverter::ApplySpecialItem(
-    USHORT nWhichId, const SfxItemSet & rItemSet )
+    USHORT /*nWhichId*/, const SfxItemSet & /*rItemSet*/ )
     throw( uno::Exception )
 {
     OSL_ENSURE( false, "ItemConverter: Unhandled special item found!" );
Index: chart2/source/controller/itemsetwrapper/LegendItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/LegendItemConverter.cxx,v
retrieving revision 1.14
retrieving revision 1.14.12.1
diff -u -u -p -r1.14 -r1.14.12.1
--- chart2/source/controller/itemsetwrapper/LegendItemConverter.cxx	22 May 2007 18:01:06 -0000	1.14
+++ chart2/source/controller/itemsetwrapper/LegendItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.14.12.1
@@ -115,7 +115,7 @@ const USHORT * LegendItemConverter::GetW
     return nLegendWhichPairs;
 }
 
-bool LegendItemConverter::GetItemProperty( tWhichIdType nWhichId, tPropertyNameWithMemberId & rOutProperty ) const
+bool LegendItemConverter::GetItemProperty( tWhichIdType /*nWhichId*/, tPropertyNameWithMemberId & /*rOutProperty*/ ) const
 {
     // No own (non-special) properties
     return false;
@@ -132,12 +132,13 @@ bool LegendItemConverter::ApplySpecialIt
     {
         case SCHATTR_LEGEND_POS:
         {
-            chart2::LegendPosition eNewPos, eOldPos;
+            chart2::LegendPosition eNewPos = chart2::LegendPosition_LINE_END;
+            chart2::LegendPosition eOldPos;
             bool bIsWide = false;
             sal_Bool bShow = sal_True;
 
             SvxChartLegendPos eItemPos =
-                reinterpret_cast< const SvxChartLegendPosItem & >(
+                static_cast< const SvxChartLegendPosItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
             switch( eItemPos )
             {
Index: chart2/source/controller/itemsetwrapper/MultipleChartConverters.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/MultipleChartConverters.cxx,v
retrieving revision 1.9
retrieving revision 1.9.12.2
diff -u -u -p -r1.9 -r1.9.12.2
--- chart2/source/controller/itemsetwrapper/MultipleChartConverters.cxx	22 May 2007 18:01:18 -0000	1.9
+++ chart2/source/controller/itemsetwrapper/MultipleChartConverters.cxx	13 Jul 2007 13:02:50 -0000	1.9.12.2
@@ -64,7 +64,7 @@ AllAxisItemConverter::AllAxisItemConvert
     const uno::Reference< frame::XModel > & xChartModel,
     SfxItemPool& rItemPool,
     SdrModel& rDrawModel,
-    const uno::Reference< lang::XMultiServiceFactory > & xNamedPropertyContainerFactory,
+    const uno::Reference< lang::XMultiServiceFactory > & /*xNamedPropertyContainerFactory*/,
     ::std::auto_ptr< awt::Size > pRefSize )
         : MultipleItemConverter( rItemPool )
 {
@@ -143,17 +143,17 @@ AllDataLabelItemConverter::AllDataLabelI
     {
         uno::Reference< beans::XPropertySet > xObjectProperties( *aIt, uno::UNO_QUERY);
         uno::Reference< uno::XComponentContext>	xContext(0);//do not need Context for label properties
-        if( pRefSize.get())
-            m_aConverters.push_back( new ::chart::wrapper::DataPointItemConverter(
+        m_aConverters.push_back( new ::chart::wrapper::DataPointItemConverter(
                                          xChartModel, xContext,
                                          xObjectProperties, rItemPool, rDrawModel, NULL,
                                          xNamedPropertyContainerFactory,
                                          GraphicPropertyItemConverter::FILLED_DATA_POINT,
-                                         ::std::auto_ptr< awt::Size >( new awt::Size( *pRefSize )) ));
-        else
-            m_aConverters.push_back( new ::chart::wrapper::DataPointItemConverter(
-                                         xChartModel, xContext, xObjectProperties, rItemPool, rDrawModel, NULL,
-                                         xNamedPropertyContainerFactory ));
+                                         ::std::auto_ptr< awt::Size >( pRefSize.get() ? new awt::Size( *pRefSize ) : 0),
+                                         true, /*bDataSeries*/
+                                         false, /*bUseSpecialFillColor*/
+                                         0, /*nSpecialFillColor*/
+                                         true /*bOverwriteLabelsForAttributedDataPointsAlso*/
+                                         ));
     }
 }
 
Index: chart2/source/controller/itemsetwrapper/MultipleItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/MultipleItemConverter.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.1
diff -u -u -p -r1.6 -r1.6.12.1
--- chart2/source/controller/itemsetwrapper/MultipleItemConverter.cxx	22 May 2007 18:01:30 -0000	1.6
+++ chart2/source/controller/itemsetwrapper/MultipleItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.6.12.1
@@ -84,7 +84,7 @@ bool MultipleItemConverter::ApplyItemSet
     return bResult;
 }
 
-bool MultipleItemConverter::GetItemProperty( tWhichIdType nWhichId, tPropertyNameWithMemberId & rOutProperty ) const
+bool MultipleItemConverter::GetItemProperty( tWhichIdType /*nWhichId*/, tPropertyNameWithMemberId & /*rOutProperty*/ ) const
 {
     return false;
 }
Index: chart2/source/controller/itemsetwrapper/SeriesOptionsItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/SeriesOptionsItemConverter.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/itemsetwrapper/SeriesOptionsItemConverter.cxx	22 May 2007 18:02:05 -0000	1.2
+++ chart2/source/controller/itemsetwrapper/SeriesOptionsItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.2.12.1
@@ -148,7 +148,7 @@ const USHORT * SeriesOptionsItemConverte
     return nSeriesOptionsWhichPairs;
 }
 
-bool SeriesOptionsItemConverter::GetItemProperty( tWhichIdType nWhichId, tPropertyNameWithMemberId & rOutProperty ) const
+bool SeriesOptionsItemConverter::GetItemProperty( tWhichIdType /*nWhichId*/, tPropertyNameWithMemberId & /*rOutProperty*/ ) const
 {
     return false;
 }
@@ -161,7 +161,7 @@ bool SeriesOptionsItemConverter::ApplySp
     {
         case SCHATTR_AXIS:
         {
-            sal_Int32 nItemValue = reinterpret_cast< const SfxInt32Item & >(
+            sal_Int32 nItemValue = static_cast< const SfxInt32Item & >(
                     rItemSet.Get( nWhichId )).GetValue();
             bool bAttachToMainAxis = nItemValue == CHART_AXIS_PRIMARY_Y;
             if( bAttachToMainAxis != m_bAttachToMainAxis )
@@ -182,7 +182,7 @@ bool SeriesOptionsItemConverter::ApplySp
             if( m_bSupportingOverlapAndGapWidthProperties )
             {
                 sal_Int32& rBarPosition = ( SCHATTR_BAR_OVERLAP == nWhichId ) ? m_nBarOverlap : m_nGapWidth;
-                rBarPosition = reinterpret_cast< const SfxInt32Item & >( rItemSet.Get( nWhichId )).GetValue();
+                rBarPosition = static_cast< const SfxInt32Item & >( rItemSet.Get( nWhichId )).GetValue();
 
                 rtl::OUString aPropName( C2U( "GapwidthSequence" ) );
                 if( SCHATTR_BAR_OVERLAP == nWhichId )
@@ -214,7 +214,7 @@ bool SeriesOptionsItemConverter::ApplySp
         case SCHATTR_BAR_CONNECT:
         {
             sal_Bool bOldConnectBars = sal_False;
-            m_bConnectBars = reinterpret_cast< const SfxBoolItem & >(
+            m_bConnectBars = static_cast< const SfxBoolItem & >(
                 rItemSet.Get( nWhichId )).GetValue();
             if( m_bSupportingBarConnectors )
             {
Index: chart2/source/controller/itemsetwrapper/StatisticsItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/StatisticsItemConverter.cxx,v
retrieving revision 1.16
retrieving revision 1.16.12.1
diff -u -u -p -r1.16 -r1.16.12.1
--- chart2/source/controller/itemsetwrapper/StatisticsItemConverter.cxx	22 May 2007 18:02:17 -0000	1.16
+++ chart2/source/controller/itemsetwrapper/StatisticsItemConverter.cxx	4 Jul 2007 16:46:34 -0000	1.16.12.1
@@ -197,7 +197,9 @@ const USHORT * StatisticsItemConverter::
     return nStatWhichPairs;
 }
 
-bool StatisticsItemConverter::GetItemProperty( tWhichIdType nWhichId, tPropertyNameWithMemberId & rOutProperty ) const
+bool StatisticsItemConverter::GetItemProperty(
+    tWhichIdType /* nWhichId */,
+    tPropertyNameWithMemberId & /* rOutProperty */ ) const
 {
     return false;
 }
@@ -218,7 +220,7 @@ bool StatisticsItemConverter::ApplySpeci
             bool bOldHasMeanValueLine = RegressionCurveHelper::hasMeanValueLine( xRegCnt );
 
             bool bNewHasMeanValueLine =
-                reinterpret_cast< const SfxBoolItem & >( rItemSet.Get( nWhichId )).GetValue();
+                static_cast< const SfxBoolItem & >( rItemSet.Get( nWhichId )).GetValue();
 
             if( bOldHasMeanValueLine != bNewHasMeanValueLine )
             {
@@ -241,7 +243,7 @@ bool StatisticsItemConverter::ApplySpeci
                 lcl_GetYErrorBar( GetPropertySet() ));
 
             SvxChartKindError eErrorKind =
-                reinterpret_cast< const SvxChartKindErrorItem & >(
+                static_cast< const SvxChartKindErrorItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
 
             if( !xOldErrorBarProp.is() && eErrorKind == CHERROR_NONE)
@@ -290,7 +292,7 @@ bool StatisticsItemConverter::ApplySpeci
             bool bOldHasErrorBar = xOldErrorBarProp.is();
 
             double fValue =
-                reinterpret_cast< const SvxDoubleItem & >(
+                static_cast< const SvxDoubleItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
             double fPos, fNeg;
             lcl_getErrorValues( xOldErrorBarProp, fPos, fNeg );
@@ -317,7 +319,7 @@ bool StatisticsItemConverter::ApplySpeci
             bool bOldHasErrorBar = xOldErrorBarProp.is();
 
             double fValue =
-                reinterpret_cast< const SvxDoubleItem & >(
+                static_cast< const SvxDoubleItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
             double fPos, fNeg;
             lcl_getErrorValues( xOldErrorBarProp, fPos, fNeg );
@@ -340,7 +342,7 @@ bool StatisticsItemConverter::ApplySpeci
             bool bOldHasErrorBar = xOldErrorBarProp.is();
 
             double fValue =
-                reinterpret_cast< const SvxDoubleItem & >(
+                static_cast< const SvxDoubleItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
             double fPos, fNeg;
             lcl_getErrorValues( xOldErrorBarProp, fPos, fNeg );
@@ -359,7 +361,7 @@ bool StatisticsItemConverter::ApplySpeci
         case SCHATTR_STAT_REGRESSTYPE:
         {
             SvxChartRegress eRegress =
-                reinterpret_cast< const SvxChartRegressItem & >(
+                static_cast< const SvxChartRegressItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
 
             uno::Reference< chart2::XRegressionCurveContainer > xRegCnt(
@@ -397,7 +399,7 @@ bool StatisticsItemConverter::ApplySpeci
             bool bOldHasErrorBar = xOldErrorBarProp.is();
 
             SvxChartIndicate eIndicate =
-                reinterpret_cast< const SvxChartIndicateItem & >(
+                static_cast< const SvxChartIndicateItem & >(
                     rItemSet.Get( nWhichId )).GetValue();
 
             bool bNewIndPos = (eIndicate == CHINDICATE_BOTH || eIndicate == CHINDICATE_UP );
Index: chart2/source/controller/itemsetwrapper/TitleItemConverter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/itemsetwrapper/TitleItemConverter.cxx,v
retrieving revision 1.9
retrieving revision 1.9.12.1
diff -u -u -p -r1.9 -r1.9.12.1
--- chart2/source/controller/itemsetwrapper/TitleItemConverter.cxx	22 May 2007 18:02:28 -0000	1.9
+++ chart2/source/controller/itemsetwrapper/TitleItemConverter.cxx	10 Jul 2007 11:57:29 -0000	1.9.12.1
@@ -214,7 +214,7 @@ bool TitleItemConverter::ApplySpecialIte
         {
             // convert int to double (divided by 100)
             double fVal = static_cast< double >(
-                reinterpret_cast< const SfxInt32Item & >(
+                static_cast< const SfxInt32Item & >(
                     rItemSet.Get( nWhichId )).GetValue()) / 100.0;
             double fOldVal = 0.0;
             bool bPropExisted =
cvs diff: Diffing chart2/source/controller/main
Index: chart2/source/controller/main/ChartController.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController.cxx,v
retrieving revision 1.22
retrieving revision 1.21.12.10
diff -u -u -p -r1.22 -r1.21.12.10
--- chart2/source/controller/main/ChartController.cxx	11 Jun 2007 14:58:28 -0000	1.22
+++ chart2/source/controller/main/ChartController.cxx	11 Jul 2007 16:54:19 -0000	1.21.12.10
@@ -61,33 +61,16 @@
 
 #include <comphelper/InlineContainer.hxx>
 
-#ifndef _COM_SUN_STAR_AWT_POSSIZE_HPP_
 #include <com/sun/star/awt/PosSize.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XCHARTDOCUMENT_HPP_
 #include <com/sun/star/chart2/XChartDocument.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_DATA_XDATARECEIVER_HPP_
+#include <com/sun/star/chart2/XUndoSupplier.hpp>
 #include <com/sun/star/chart2/data/XDataReceiver.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XLOADABLE_HPP_
 #include <com/sun/star/frame/XLoadable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XCLONEABLE_HPP_
 #include <com/sun/star/util/XCloneable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_EMBED_XEMBEDDEDCLIENT_HPP_
 #include <com/sun/star/embed/XEmbeddedClient.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODECHANGEBROADCASTER_HPP_
 #include <com/sun/star/util/XModeChangeBroadcaster.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODIFYBROADCASTER_HPP_
 #include <com/sun/star/util/XModifyBroadcaster.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_LAYOUTMANAGEREVENTS_HPP_
 #include <com/sun/star/frame/LayoutManagerEvents.hpp>
-#endif
 
 //-------
 // header for define RET_OK
@@ -97,35 +80,18 @@
 //-------
 
 //-------
-#ifndef _TOOLKIT_AWT_VCLXWINDOW_HXX_
 #include <toolkit/awt/vclxwindow.hxx>
-#endif
-#ifndef _TOOLKIT_HELPER_VCLUNOHELPER_HXX_
 #include <toolkit/helper/vclunohelper.hxx>
-#endif
-#ifndef _SV_SVAPP_HXX
 #include <vcl/svapp.hxx>
-#endif
-#ifndef _VOS_MUTEX_HXX_
 #include <vos/mutex.hxx>
-#endif
 //-------
-#ifndef _COM_SUN_STAR_FRAME_XLAYOUTMANAGER_HPP_
 #include <com/sun/star/frame/XLayoutManager.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UI_DIALOGS_XEXECUTABLEDIALOG_HPP_
 #include <com/sun/star/ui/dialogs/XExecutableDialog.hpp>
-#endif
 
 // this is needed to properly destroy the auto_ptr to the AcceleratorExecute
 // object in the DTOR
-#ifndef INCLUDED_SVTOOLS_ACCELERATOREXECUTE_HXX
 #include <svtools/acceleratorexecute.hxx>
-#endif
-
-#ifndef _SVX_ACTIONDESCRIPTIONPROVIDER_HXX
 #include <svx/ActionDescriptionProvider.hxx>
-#endif
 
 // enable the following define to let the controller listen to model changes and
 // react on this by rebuilding the view
@@ -169,9 +135,10 @@ ChartController::ChartController(uno::Re
     , m_bWaitingForDoubleClick(false)
     , m_bWaitingForMouseUp(false)
     , m_bConnectingToView(false)
+    , m_xUndoManager( 0 )
     , m_aDispatchContainer( m_xCC )
 {
-    m_aDispatchContainer.setUndoManager( & m_aUndoManager );
+//     m_aDispatchContainer.setUndoManager( m_xUndoManager );
     m_aDoubleClickTimer.SetTimeoutHdl( LINK( this, ChartController, DoubleClickWaitingHdl ) );
 }
 
@@ -299,6 +266,7 @@ void ChartController::TheModel::tryTermi
 	}
 	catch( uno::Exception& ex)
 	{
+        (void)(ex); // no warning in non-debug builds
 		OSL_ENSURE( sal_False, ( rtl::OString("Termination of model failed: ")
 			+ rtl::OUStringToOString( ex.Message, RTL_TEXTENCODING_ASCII_US ) ).getStr() );
 	}
@@ -473,15 +441,13 @@ APPHELPER_XSERVICEINFO_IMPL(ChartControl
                 if ( xLayoutManager.is() )
                 {
 					xLayoutManager->lock();
-                    // @todo: All create calls here should not be necessary as
-                    // request should include this. Remove when fixed version is
-                    // in master
                     xLayoutManager->requestElement( C2U( "private:resource/menubar/menubar" ) );
-                    xLayoutManager->createElement( C2U( "private:resource/toolbar/standardbar" ) );
+                    //@todo: createElement should become unnecessary, remove when #i79198# is fixed
+                    xLayoutManager->createElement(  C2U( "private:resource/toolbar/standardbar" ) );
                     xLayoutManager->requestElement( C2U( "private:resource/toolbar/standardbar" ) );
-                    xLayoutManager->createElement( C2U( "private:resource/toolbar/toolbar" ) );
+                    //@todo: createElement should become unnecessary, remove when #i79198# is fixed
+                    xLayoutManager->createElement(  C2U( "private:resource/toolbar/toolbar" ) );
                     xLayoutManager->requestElement( C2U( "private:resource/toolbar/toolbar" ) );
-                    xLayoutManager->createElement( C2U( "private:resource/statusbar/statusbar" ) );
                     xLayoutManager->requestElement( C2U( "private:resource/statusbar/statusbar" ) );
                     xLayoutManager->unlock();
 
@@ -623,12 +589,15 @@ void SAL_CALL ChartController::modeChang
         if( xViewBroadcaster.is() )
             xViewBroadcaster->addModeChangeListener(this);
     }
-    
 
 	//the frameloader is responsible to call xModel->connectController
     if( m_pChartWindow )
         m_pChartWindow->Invalidate();
 
+    uno::Reference< chart2::XUndoSupplier > xUndoSupplier( m_aModel->getModel(), uno::UNO_QUERY );
+    if( xUndoSupplier.is())
+        m_xUndoManager.set( xUndoSupplier->getUndoManager());
+
 	return sal_True;
 }
 
@@ -674,7 +643,7 @@ void SAL_CALL ChartController::modeChang
 }
 
 		void SAL_CALL ChartController
-::restoreViewData( const uno::Any& Value )
+::restoreViewData( const uno::Any& /* Value */ )
 		throw(uno::RuntimeException)
 {
 	//restores the view status using the data gotten from a previous call to XController::getViewData()
@@ -783,10 +752,14 @@ void ChartController::impl_deleteDrawVie
 
         this->stopDoubleClickWaiting();
 
+        TheModelRef aModelRef( m_aModel, m_aModelMutex);
+        m_aModel = NULL;
+
         //end range highlighting
+        if( aModelRef.is())
         {
             uno::Reference< view::XSelectionChangeListener > xSelectionChangeListener;
-            uno::Reference< chart2::data::XDataReceiver > xDataReceiver( m_aModel->getModel(), uno::UNO_QUERY );
+            uno::Reference< chart2::data::XDataReceiver > xDataReceiver( aModelRef->getModel(), uno::UNO_QUERY );
             if( xDataReceiver.is() )
                 xSelectionChangeListener = uno::Reference< view::XSelectionChangeListener >( xDataReceiver->getRangeHighlighter(), uno::UNO_QUERY );
             if( xSelectionChangeListener.is() )
@@ -827,16 +800,14 @@ void ChartController::impl_deleteDrawVie
             m_xLayoutManagerEventBroadcaster.set( 0 );
         }
 
-        m_xFrame = NULL;
-        uno::Reference< frame::XModel > xModel( m_aModel->getModel() );
-        if(xModel.is())
-            xModel->disconnectController( uno::Reference< frame::XController >( this ));
-
-        TheModelRef aModelRef( m_aModel, m_aModelMutex);
-        m_aModel = NULL;
-
-        if(aModelRef.is())
+        m_xFrame.clear();
+        m_xUndoManager.clear();
+        if( aModelRef.is())
         {
+            uno::Reference< frame::XModel > xModel( aModelRef->getModel() );
+            if(xModel.is())
+                xModel->disconnectController( uno::Reference< frame::XController >( this ));
+
             aModelRef->removeListener( this );
 #ifdef TEST_ENABLE_MODIFY_LISTENER
             try
@@ -931,11 +902,27 @@ void ChartController::impl_deleteDrawVie
 {
 	//Listener should deregister himself and relaese all references to the closing object.
 
-	TheModelRef aModelRef( 0, m_aModelMutex);
+	TheModelRef aModelRef( m_aModel, m_aModelMutex);
     if( impl_releaseThisModel( rSource.Source ) )
     {
 	    //--stop listening to the closing model
 	    aModelRef->removeListener( this );
+
+        // #i79087# If the model using this controller is closed, the frame is
+        // expected to be closed as well
+        Reference< util::XCloseable > xFrameCloseable( m_xFrame, uno::UNO_QUERY );
+        if( xFrameCloseable.is())
+        {
+            try
+            {
+                xFrameCloseable->close( sal_False /* DeliverOwnership */ );
+                m_xFrame.clear();
+            }
+            catch( util::CloseVetoException & )
+            {
+                // closing was vetoed
+            }
+        }
     }
 }
 
@@ -947,6 +934,7 @@ bool ChartController::impl_releaseThisMo
 		if( m_aModel.is() && m_aModel->getModel() == xModel )
 		{
 			m_aModel = NULL;
+            m_xUndoManager.clear();
 			bReleaseModel = true;
 		}
 	}
@@ -967,7 +955,7 @@ bool ChartController::impl_releaseThisMo
     }
 }
 
-void SAL_CALL ChartController::layoutEvent( const lang::EventObject& aSource, ::sal_Int16 eLayoutEvent, const uno::Any& aInfo )
+void SAL_CALL ChartController::layoutEvent( const lang::EventObject& aSource, ::sal_Int16 eLayoutEvent, const uno::Any& /* aInfo */ )
     throw (uno::RuntimeException)
 {
     if( eLayoutEvent == frame::LayoutManagerEvents::MERGEDMENUBAR )
@@ -1024,7 +1012,7 @@ bool lcl_isFormatObjectCommand( const rt
 		uno::Reference<frame::XDispatch> SAL_CALL ChartController
 ::queryDispatch( const util::URL& rURL
 		, const rtl::OUString& rTargetFrameName
-		, sal_Int32 nSearchFlags)
+		, sal_Int32 /* nSearchFlags */)
 		throw(uno::RuntimeException)
 {
 	if ( !m_aLifeTimeManager.impl_isDisposed() )
@@ -1054,7 +1042,7 @@ bool lcl_isFormatObjectCommand( const rt
 
 	void SAL_CALL ChartController
 ::dispatch( const util::URL& rURL
-			, const uno::Sequence< beans::PropertyValue >& rArgs )
+			, const uno::Sequence< beans::PropertyValue >& /* rArgs */ )
 			throw (uno::RuntimeException)
 {
     //@todo avoid OString (see Mathias mail on bug #104387#)
@@ -1155,8 +1143,8 @@ bool lcl_isFormatObjectCommand( const rt
 }
 
 	void SAL_CALL ChartController
-::addStatusListener( const uno::Reference<frame::XStatusListener >& xControl
-			, const util::URL& aURL )
+::addStatusListener( const uno::Reference<frame::XStatusListener >& /* xControl */
+			, const util::URL& /* aURL */ )
 			throw (uno::RuntimeException)
 {
 //     // TODO: add listener by URL !
@@ -1169,8 +1157,8 @@ bool lcl_isFormatObjectCommand( const rt
 }
 
 	void SAL_CALL ChartController
-::removeStatusListener( const uno::Reference<frame::XStatusListener >& xControl
-			, const util::URL& aURL )
+::removeStatusListener( const uno::Reference<frame::XStatusListener >& /* xControl */
+			, const util::URL& /* aURL */ )
 			throw (uno::RuntimeException)
 {
 //     // TODO: remove listener by URL !
@@ -1187,7 +1175,7 @@ bool lcl_isFormatObjectCommand( const rt
 //-----------------------------------------------------------------
 		void SAL_CALL ChartController
 ::registerContextMenuInterceptor( const uno::Reference<
-		ui::XContextMenuInterceptor > & xInterceptor)
+		ui::XContextMenuInterceptor > & /* xInterceptor */)
 		throw(uno::RuntimeException)
 {
 	//@todo
@@ -1195,7 +1183,7 @@ bool lcl_isFormatObjectCommand( const rt
 
 		void SAL_CALL ChartController
 ::releaseContextMenuInterceptor( const uno::Reference<
-		ui::XContextMenuInterceptor > & xInterceptor)
+		ui::XContextMenuInterceptor > & /* xInterceptor */)
 		throw(uno::RuntimeException)
 {
 	//@todo
@@ -1210,7 +1198,9 @@ bool lcl_isFormatObjectCommand( const rt
 
 void SAL_CALL ChartController::executeDispatch_ChartType()
 {
-    UndoLiveUpdateGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_CHARTTYPE ))), m_aUndoManager, m_aModel->getModel() );
+    // using assignment for broken gcc 3.3
+    UndoLiveUpdateGuard aUndoGuard = UndoLiveUpdateGuard(
+        ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_CHARTTYPE ))), m_xUndoManager, m_aModel->getModel() );
 
     // /--
     ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
@@ -1233,8 +1223,9 @@ void SAL_CALL ChartController::executeDi
     if( !xChartDoc.is())
         return;
 
-    UndoLiveUpdateGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_DATA_RANGES ))),
-                                    m_aUndoManager, m_aModel->getModel() );
+    // using assignment for broken gcc 3.3
+    UndoLiveUpdateGuard aUndoGuard = UndoLiveUpdateGuard(
+        ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_DATA_RANGES ))), m_xUndoManager, m_aModel->getModel() );
     if( xChartDoc.is())
     {
         // /--
@@ -1262,7 +1253,7 @@ void SAL_CALL ChartController::executeDi
         ActionDescriptionProvider::createDescription(
             (bForward ? ActionDescriptionProvider::MOVE_TOTOP : ActionDescriptionProvider::MOVE_TOBOTTOM),
             ::rtl::OUString( String( SchResId( STR_OBJECT_DATASERIES )))),
-        m_aUndoManager, m_aModel->getModel());
+        m_xUndoManager, m_aModel->getModel());
 
     bool bChanged = DiagramHelper::moveSeries( ChartModelHelper::findDiagram( m_aModel->getModel() ), xGivenDataSeries, bForward );
     if( bChanged )
@@ -1284,7 +1275,7 @@ uno::Reference< uno::XInterface > SAL_CA
 
 uno::Reference< uno::XInterface > SAL_CALL
     ChartController::createInstanceWithArguments( const ::rtl::OUString& ServiceSpecifier,
-                                 const uno::Sequence< uno::Any >& Arguments )
+                                 const uno::Sequence< uno::Any >& /* Arguments */ )
     throw (uno::Exception,
            uno::RuntimeException)
 {
@@ -1308,7 +1299,7 @@ uno::Sequence< ::rtl::OUString > SAL_CAL
 }
 
 // ____ XModifyListener ____
-void SAL_CALL ChartController::modified( const lang::EventObject& aEvent )
+void SAL_CALL ChartController::modified( const lang::EventObject& /* aEvent */ )
     throw (uno::RuntimeException)
 {
     // the source can also be a subobject of the ChartModel
Index: chart2/source/controller/main/ChartController.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController.hxx,v
retrieving revision 1.7
retrieving revision 1.7.12.1
diff -u -u -p -r1.7 -r1.7.12.1
--- chart2/source/controller/main/ChartController.hxx	22 May 2007 18:03:06 -0000	1.7
+++ chart2/source/controller/main/ChartController.hxx	25 Jun 2007 12:52:10 -0000	1.7.12.1
@@ -37,93 +37,43 @@
 
 #include "LifeTime.hxx"
 #include "ServiceMacros.hxx"
-#include "UndoManager.hxx"
 #include "CommandDispatchContainer.hxx"
 #include "SelectionHelper.hxx"
 
 // header for enum SdrDragMode
-#ifndef _SVDTYPES_HXX
 #include <svx/svdtypes.hxx>
-#endif
 // header for class Timer
-#ifndef _SV_TIMER_HXX
 #include <vcl/timer.hxx>
-#endif
+// header for class MouseEvent
+#include <vcl/event.hxx>
+
+#include <cppuhelper/implbase12.hxx>
 
-#ifndef _COM_SUN_STAR_ACCESSIBILITY_XACCESSIBLE_HPP_
 #include <com/sun/star/accessibility/XAccessible.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XCONTROLLER_HPP_
+#include <com/sun/star/chart2/XUndoManager.hpp>
 #include <com/sun/star/frame/XController.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XDISPATCHPROVIDER_HPP_
 #include <com/sun/star/frame/XDispatchProvider.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XDISPATCH_HPP_
 #include <com/sun/star/frame/XDispatch.hpp>
-#endif
-#ifndef _COM_SUN_STAR_VIEW_XSELECTIONSUPPLIER_HPP_
 #include <com/sun/star/view/XSelectionSupplier.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UI_XCONTEXTMENUINTERCEPTION_HPP_
 #include <com/sun/star/ui/XContextMenuInterception.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UNO_XWEAK_HPP_
 #include <com/sun/star/uno/XWeak.hpp>
-#endif
-#ifndef _COM_SUN_STAR_SDBC_XCLOSELISTENER_HPP_
 #include <com/sun/star/util/XCloseListener.hpp>
-#endif
-#ifndef _COM_SUN_STAR_SDBC_XCLOSEABLE_HPP_
 #include <com/sun/star/util/XCloseable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_LANG_XINITIALIZATION_HPP_
 #include <com/sun/star/lang/XInitialization.hpp>
-#endif
-#ifndef _COM_SUN_STAR_LANG_XSERVICEINFO_HPP_
 #include <com/sun/star/lang/XServiceInfo.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
 #include <com/sun/star/uno/XComponentContext.hpp>
-#endif
-#ifndef _COM_SUN_STAR_lang_XMULTISERVICEFACTORY_HPP_
 #include <com/sun/star/lang/XMultiServiceFactory.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODIFYLISTENER_HPP_
 #include <com/sun/star/util/XModifyListener.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODECHANGELISTENER_HPP_
 #include <com/sun/star/util/XModeChangeListener.hpp>
-#endif
-#ifndef _COM_SUN_STAR_AWT_SIZE_HPP_
 #include <com/sun/star/awt/Size.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XURLTRANSFORMER_HPP_
 #include <com/sun/star/util/XURLTransformer.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XLAYOUTMANAGERLISTENER_HPP_
 #include <com/sun/star/frame/XLayoutManagerListener.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XLAYOUTMANAGEREVENTBROADCASTER_HPP_
 #include <com/sun/star/frame/XLayoutManagerEventBroadcaster.hpp>
-#endif
-
-#ifndef _CPPUHELPER_IMPLBASE12_HXX_
-#include <cppuhelper/implbase12.hxx>
-#endif
-
-// header for class MouseEvent
-#ifndef _SV_EVENT_HXX
-#include <vcl/event.hxx>
-#endif
 
 #include <memory>
 #include <boost/shared_ptr.hpp>
 #include <set>
 
-//=============================================================================
-/** this is an example implementation for the service ::com::sun::star::frame::Controller
-*/
 
 class SdrModel;
 
@@ -517,8 +467,7 @@ public:
     //-----------------------------------------------------------------
     //-----------------------------------------------------------------
 
-    static bool isObjectDeleteable( const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XController > & xController
-                                  , const ::com::sun::star::uno::Any& rSelection );
+    static bool isObjectDeleteable( const ::com::sun::star::uno::Any& rSelection );
 
 public:
     //-----------------------------------------------------------------
@@ -621,7 +570,7 @@ private:
 
     bool volatile       m_bConnectingToView;
 
-    UndoManager         m_aUndoManager;
+    ::com::sun::star::uno::Reference< ::com::sun::star::chart2::XUndoManager > m_xUndoManager;
     /// needed for dispatching URLs in FeatureStateEvents
     mutable ::com::sun::star::uno::Reference< ::com::sun::star::util::XURLTransformer > m_xURLTransformer;
 
Index: chart2/source/controller/main/ChartController_EditData.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_EditData.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.2
diff -u -u -p -r1.5 -r1.5.12.2
--- chart2/source/controller/main/ChartController_EditData.cxx	22 May 2007 18:03:19 -0000	1.5
+++ chart2/source/controller/main/ChartController_EditData.cxx	26 Jun 2007 11:09:57 -0000	1.5.12.2
@@ -82,9 +82,10 @@ void ChartController::executeDispatch_Ed
         {
             // /--
             ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
-            UndoLiveUpdateGuardWithData aUndoGuard(
+            // using assignment for broken gcc 3.3
+            UndoLiveUpdateGuardWithData aUndoGuard = UndoLiveUpdateGuardWithData(
                 ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_CHART_DATA ))),
-                m_aUndoManager, m_aModel->getModel());
+                m_xUndoManager, m_aModel->getModel());
             DataEditor aDataEditorDialog( pParent, xChartDoc, m_xCC );
             // the dialog has no OK/Cancel
             aDataEditorDialog.Execute();
Index: chart2/source/controller/main/ChartController_Insert.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_Insert.cxx,v
retrieving revision 1.11
retrieving revision 1.11.12.4
diff -u -u -p -r1.11 -r1.11.12.4
--- chart2/source/controller/main/ChartController_Insert.cxx	22 May 2007 18:03:30 -0000	1.11
+++ chart2/source/controller/main/ChartController_Insert.cxx	13 Jul 2007 11:20:44 -0000	1.11.12.4
@@ -56,6 +56,7 @@
 #include "ResId.hxx"
 #include "Strings.hrc"
 #include "ReferenceSizeProvider.hxx"
+#include "chartview/NumberFormatterWrapper.hxx"
 
 #ifndef _SVX_ACTIONDESCRIPTIONPROVIDER_HXX
 #include <svx/ActionDescriptionProvider.hxx>
@@ -96,7 +97,7 @@ void SAL_CALL ChartController::executeDi
     UndoGuard aUndoGuard(
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::INSERT, ::rtl::OUString( String( SchResId( STR_OBJECT_AXES )))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     try
     {
@@ -134,7 +135,7 @@ void SAL_CALL ChartController::executeDi
     UndoGuard aUndoGuard(
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::INSERT, ::rtl::OUString( String( SchResId( STR_OBJECT_GRIDS )))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     try
     {
@@ -171,7 +172,7 @@ void SAL_CALL ChartController::executeDi
     UndoGuard aUndoGuard(
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::INSERT, ::rtl::OUString( String( SchResId( STR_OBJECT_TITLES )))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     try
     {
@@ -202,7 +203,7 @@ void SAL_CALL ChartController::executeDi
     UndoGuard aUndoGuard(
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::INSERT, ::rtl::OUString( String( SchResId( STR_OBJECT_LEGEND )))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     try
     {
@@ -233,7 +234,7 @@ void SAL_CALL ChartController::executeDi
     UndoGuard aUndoGuard(
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::INSERT, ::rtl::OUString( String( SchResId( STR_OBJECT_DATALABELS )))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     try
     {
@@ -247,11 +248,18 @@ void SAL_CALL ChartController::executeDi
 
         //prepare and open dialog
         ::vos::OGuard aGuard( Application::GetSolarMutex());
-        SchDataDescrDlg aDlg( m_pChartWindow, aItemSet);
+
+        //get number formatter
+        uno::Reference< util::XNumberFormatsSupplier > xNumberFormatsSupplier( m_aModel->getModel(), uno::UNO_QUERY );
+        NumberFormatterWrapper aNumberFormatterWrapper( xNumberFormatsSupplier );
+        SvNumberFormatter* pNumberFormatter = aNumberFormatterWrapper.getSvNumberFormatter();
+
+        DataLabelsDialog aDlg( m_pChartWindow, aItemSet, pNumberFormatter);
+
         if( aDlg.Execute() == RET_OK )
         {
             SfxItemSet aOutItemSet = aItemConverter.CreateEmptyItemSet();
-            aDlg.GetAttr( aOutItemSet );
+            aDlg.FillItemSet( aOutItemSet );
             // lock controllers till end of block
             ControllerLockGuard aCLGuard( m_aModel->getModel());
             bool bChanged = aItemConverter.ApplyItemSet( aOutItemSet );//model should be changed now
@@ -270,7 +278,7 @@ void SAL_CALL ChartController::executeDi
     UndoGuard aUndoGuard(
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::INSERT, ::rtl::OUString( String( SchResId( STR_PAGE_STATISTICS )))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     try
     {
@@ -282,13 +290,15 @@ void SAL_CALL ChartController::executeDi
         //prepare and open dialog
         ::vos::OGuard aGuard( Application::GetSolarMutex());
         SchDataStatisticsDlg aDlg( m_pChartWindow, aItemSet);
-//         aDlg.EnableRegression( ChartTypeHelper::isSupportingRegressionProperties( xChartType ));
-        aDlg.EnableRegression( true );
+//         aDlg.EnableTrendLine( ChartTypeHelper::isSupportingRegressionProperties( xChartType ));
+        aDlg.EnableTrendLine( true );
+        aDlg.SetAxisMinorStepWidthForErrorBarDecimals( 
+            SchDataStatisticsDlg::getAxisMinorStepWidthForErrorBarDecimals( m_aModel->getModel(), m_xChartView, rtl::OUString() ) );
 
         if( aDlg.Execute() == RET_OK )
         {
             SfxItemSet aOutItemSet = aItemConverter.CreateEmptyItemSet();
-            aDlg.GetAttr( aOutItemSet );
+            aDlg.FillItemSet( aOutItemSet );
 
             // lock controllers till end of block
             ControllerLockGuard aCLGuard( m_aModel->getModel());
Index: chart2/source/controller/main/ChartController_Position.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_Position.cxx,v
retrieving revision 1.8
retrieving revision 1.8.12.1
diff -u -u -p -r1.8 -r1.8.12.1
--- chart2/source/controller/main/ChartController_Position.cxx	22 May 2007 18:03:42 -0000	1.8
+++ chart2/source/controller/main/ChartController_Position.cxx	25 Jun 2007 12:52:11 -0000	1.8.12.1
@@ -115,7 +115,7 @@ void SAL_CALL ChartController::executeDi
         ActionDescriptionProvider::createDescription(
             ActionDescriptionProvider::POS_SIZE,
             ObjectNameProvider::getName( ObjectIdentifier::getObjectType( aCID ))),
-        m_aUndoManager, m_aModel->getModel() );
+        m_xUndoManager, m_aModel->getModel() );
 
     SfxAbstractTabDialog * pDlg = NULL;
     try
Index: chart2/source/controller/main/ChartController_Properties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_Properties.cxx,v
retrieving revision 1.27
retrieving revision 1.27.12.3
diff -u -u -p -r1.27 -r1.27.12.3
--- chart2/source/controller/main/ChartController_Properties.cxx	22 May 2007 18:03:55 -0000	1.27
+++ chart2/source/controller/main/ChartController_Properties.cxx	6 Jul 2007 13:31:24 -0000	1.27.12.3
@@ -43,6 +43,7 @@
 #include "macros.hxx"
 #include "dlg_ObjectProperties.hxx"
 #include "dlg_View3D.hxx"
+#include "dlg_InsertStatistic.hxx"
 #include "ViewElementListProvider.hxx"
 #include "DataPointItemConverter.hxx"
 #include "AxisItemConverter.hxx"
@@ -422,7 +423,7 @@ rtl::OUString lcl_getGridCIDForCommand( 
 }
 rtl::OUString lcl_getObjectCIDForCommand( const ::rtl::OString& rDispatchCommand, const uno::Reference< XChartDocument > & xChartDocument )
 {
-    ObjectType eObjectType;
+    ObjectType eObjectType = OBJECTTYPE_UNKNOWN;
     rtl::OUString aParticleID;
 
     uno::Reference< frame::XModel > xChartModel( xChartDocument, uno::UNO_QUERY );
@@ -555,7 +556,7 @@ void SAL_CALL ChartController::executeDl
             ActionDescriptionProvider::createDescription(
                 ActionDescriptionProvider::FORMAT,
                 ObjectNameProvider::getName( ObjectIdentifier::getObjectType( aObjectCID ))),
-            m_aUndoManager, m_aModel->getModel() );
+            m_xUndoManager, m_aModel->getModel() );
 
         //-------------------------------------------------------------
         //convert properties to ItemSet
@@ -607,6 +608,11 @@ void SAL_CALL ChartController::executeDl
             // note: the dialog takes the ownership of pSymbolShapeProperties and pAutoSymbolGraphic
             aDlg.setSymbolInformation( pSymbolShapeProperties, pAutoSymbolGraphic );
         }
+        if( aDialogParameter.HasRegressionProperties() )
+        {
+            aDlg.SetAxisMinorStepWidthForErrorBarDecimals( 
+                SchDataStatisticsDlg::getAxisMinorStepWidthForErrorBarDecimals( m_aModel->getModel(), m_xChartView, aObjectCID ) );
+        }
 
         //-------------------------------------------------------------
         //open the dialog
@@ -682,8 +688,10 @@ void SAL_CALL ChartController::executeDi
 {
     try
     {
-        UndoLiveUpdateGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_3D_VIEW ))),
-                              m_aUndoManager, m_aModel->getModel());
+        // using assignment for broken gcc 3.3
+        UndoLiveUpdateGuard aUndoGuard = UndoLiveUpdateGuard(
+            ::rtl::OUString( String( SchResId( STR_ACTION_EDIT_3D_VIEW ))),
+            m_xUndoManager, m_aModel->getModel());
 
         // /--
         //open dialog
Index: chart2/source/controller/main/ChartController_TextEdit.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_TextEdit.cxx,v
retrieving revision 1.11
retrieving revision 1.11.12.1
diff -u -u -p -r1.11 -r1.11.12.1
--- chart2/source/controller/main/ChartController_TextEdit.cxx	22 May 2007 18:04:08 -0000	1.11
+++ chart2/source/controller/main/ChartController_TextEdit.cxx	25 Jun 2007 12:52:11 -0000	1.11.12.1
@@ -104,7 +104,7 @@ void ChartController::StartTextEdit()
     if(!pTextObj)
         return;
 
-    m_aUndoManager.preAction( m_aModel->getModel());
+    m_xUndoManager->preAction( m_aModel->getModel());
     SdrOutliner* pOutliner = m_pDrawViewWrapper->getOutliner();
     //pOutliner->SetRefDevice(m_pChartWindow);
     //pOutliner->SetStyleSheetPool((SfxStyleSheetPool*)pStyleSheetPool);
@@ -162,7 +162,7 @@ bool ChartController::EndTextEdit()
             ::com::sun::star::chart2::XTitle >::query( xPropSet ), m_xCC );
 		try
 		{
-            m_aUndoManager.postAction( C2U("Edit Text") );
+            m_xUndoManager->postAction( C2U("Edit Text") );
 		}
 		catch( uno::RuntimeException& e)
 		{
Index: chart2/source/controller/main/ChartController_Tools.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_Tools.cxx,v
retrieving revision 1.3
retrieving revision 1.2.12.4
diff -u -u -p -r1.3 -r1.2.12.4
--- chart2/source/controller/main/ChartController_Tools.cxx	3 Jul 2007 13:40:28 -0000	1.3
+++ chart2/source/controller/main/ChartController_Tools.cxx	6 Jul 2007 16:48:07 -0000	1.2.12.4
@@ -249,8 +249,10 @@ void ChartController::executeDispatch_Ne
         Reference< chart2::XDiagram > xDiagram( ChartModelHelper::findDiagram( xModel ));
         if( xDiagram.is())
         {
-            UndoGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_REARRANGE_CHART ))),
-                                  m_aUndoManager, xModel );
+            // using assignment for broken gcc 3.3
+            UndoGuard aUndoGuard = UndoGuard(
+                ::rtl::OUString( String( SchResId( STR_ACTION_REARRANGE_CHART ))),
+                m_xUndoManager, xModel );
             ControllerLockGuard aCtlLockGuard( xModel );
 
             // diagram
@@ -296,8 +298,10 @@ void ChartController::executeDispatch_Ne
 void ChartController::executeDispatch_ScaleText()
 {
     ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
-    UndoGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_SCALE_TEXT ))),
-                          m_aUndoManager, m_aModel->getModel());
+    // using assignment for broken gcc 3.3
+    UndoGuard aUndoGuard = UndoGuard(
+        ::rtl::OUString( String( SchResId( STR_ACTION_SCALE_TEXT ))),
+        m_xUndoManager, m_aModel->getModel());
     ControllerLockGuard aCtlLockGuard( m_aModel->getModel());
     ::std::auto_ptr< ReferenceSizeProvider > apRefSizeProv( impl_createReferenceSizeProvider());
     OSL_ASSERT( apRefSizeProv.get());
@@ -472,8 +476,7 @@ void ChartController::executeDispatch_Cu
 }
 
 //static
-bool ChartController::isObjectDeleteable( const uno::Reference< frame::XController > & xController
-                                        , const uno::Any& rSelection )
+bool ChartController::isObjectDeleteable( const uno::Any& rSelection )
 {
     OUString aSelObjCID;
     if( (rSelection >>= aSelObjCID) && aSelObjCID.getLength() > 0 )
@@ -509,10 +512,11 @@ bool ChartController::executeDispatch_De
         {
             case OBJECTTYPE_TITLE:
             {
-                UndoGuard aUndoGuard(
+                // using assignment for broken gcc 3.3
+                UndoGuard aUndoGuard = UndoGuard(
                     ActionDescriptionProvider::createDescription(
                         ActionDescriptionProvider::DELETE, ::rtl::OUString( String( SchResId( STR_OBJECT_TITLE )))),
-                    m_aUndoManager, m_aModel->getModel() );
+                    m_xUndoManager, m_aModel->getModel() );
                 TitleHelper::removeTitle(
                     ObjectIdentifier::getTitleTypeForCID( aCID ), m_aModel->getModel());
                 bReturn = true;
@@ -527,10 +531,11 @@ bool ChartController::executeDispatch_De
                     uno::Reference< beans::XPropertySet > xLegendProp( xDiagram->getLegend(), uno::UNO_QUERY );
                     if( xLegendProp.is())
                     {
-                        UndoGuard aUndoGuard(
+                        // using assignment for broken gcc 3.3
+                        UndoGuard aUndoGuard = UndoGuard(
                             ActionDescriptionProvider::createDescription(
                                 ActionDescriptionProvider::DELETE, ::rtl::OUString( String( SchResId( STR_OBJECT_LEGEND )))),
-                            m_aUndoManager, m_aModel->getModel() );
+                            m_xUndoManager, m_aModel->getModel() );
                         xLegendProp->setPropertyValue( C2U("Show"), uno::makeAny( false ));
                         bReturn = true;
                         aUndoGuard.commitAction();
@@ -551,7 +556,7 @@ bool ChartController::executeDispatch_De
                         UndoGuard aUndoGuard(
                             ActionDescriptionProvider::createDescription(
                                 ActionDescriptionProvider::DELETE, ::rtl::OUString( String( SchResId( STR_OBJECT_DATASERIES )))),
-                            m_aUndoManager, m_aModel->getModel() );
+                            m_xUndoManager, m_aModel->getModel() );
                         DataSeriesHelper::deleteSeries( xSeries, xChartType );
                         bReturn = true;
                         aUndoGuard.commitAction();
@@ -586,8 +591,8 @@ bool ChartController::executeDispatch_De
 void ChartController::executeDispatch_ToggleLegend()
 {
     Reference< frame::XModel > xModel( m_aModel->getModel());
-    UndoGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_TOGGLE_LEGEND ))),
-                          m_aUndoManager, xModel );
+    UndoGuard aUndoGuard = UndoGuard(
+        ::rtl::OUString( String( SchResId( STR_ACTION_TOGGLE_LEGEND ))), m_xUndoManager, xModel );
     Reference< beans::XPropertySet > xLegendProp( LegendHelper::getLegend( xModel ), uno::UNO_QUERY );
     bool bChanged = false;
     if( xLegendProp.is())
@@ -620,8 +625,8 @@ void ChartController::executeDispatch_To
 void ChartController::executeDispatch_ToggleGridHorizontal()
 {
     Reference< frame::XModel > xModel( m_aModel->getModel());
-    UndoGuard aUndoGuard( ::rtl::OUString( String( SchResId( STR_ACTION_TOGGLE_GRID_HORZ ))),
-                          m_aUndoManager, xModel );
+    UndoGuard aUndoGuard = UndoGuard(
+        ::rtl::OUString( String( SchResId( STR_ACTION_TOGGLE_GRID_HORZ ))), m_xUndoManager, xModel );
     Reference< chart2::XDiagram > xDiagram( ChartModelHelper::findDiagram( m_aModel->getModel()));
     if( xDiagram.is())
     {
Index: chart2/source/controller/main/ChartController_Window.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ChartController_Window.cxx,v
retrieving revision 1.24
retrieving revision 1.23.12.4
diff -u -u -p -r1.24 -r1.23.12.4
--- chart2/source/controller/main/ChartController_Window.cxx	11 Jun 2007 14:58:40 -0000	1.24
+++ chart2/source/controller/main/ChartController_Window.cxx	12 Jul 2007 13:22:10 -0000	1.23.12.4
@@ -211,11 +211,32 @@ const short HITPIX=2; //hit-tolerance in
         {
             //change map mode to fit new size
             awt::Size aModelPageSize = ChartModelHelper::getPageSize( m_aModel->getModel() );
+            sal_Int32 nScaleXNumerator = aLogicSize.Width();
+            sal_Int32 nScaleXDenominator = aModelPageSize.Width;
+            sal_Int32 nScaleYNumerator = aLogicSize.Height();
+            sal_Int32 nScaleYDenominator = aModelPageSize.Height;
             MapMode aNewMapMode( MAP_100TH_MM, Point(0,0)
-            , Fraction(aLogicSize.Width(),aModelPageSize.Width)
-            , Fraction(aLogicSize.Height(),aModelPageSize.Height) );
+            , Fraction(nScaleXNumerator,nScaleXDenominator)
+            , Fraction(nScaleYNumerator,nScaleYDenominator) );
             pWindow->SetMapMode(aNewMapMode);
             pWindow->SetPosSizePixel( X, Y, Width, Height, Flags );
+
+            //#i75867# poor quality of ole's alternative view with 3D scenes and zoomfactors besides 100%
+            uno::Reference< beans::XPropertySet > xProp( m_xChartView, uno::UNO_QUERY );
+            if( xProp.is() )
+            {
+                uno::Sequence< beans::PropertyValue > aZoomFactors(4);
+                aZoomFactors[0].Name = C2U("ScaleXNumerator");
+                aZoomFactors[0].Value = uno::makeAny( nScaleXNumerator );
+                aZoomFactors[1].Name = C2U("ScaleXDenominator");
+                aZoomFactors[1].Value = uno::makeAny( nScaleXDenominator );
+                aZoomFactors[2].Name = C2U("ScaleYNumerator");
+                aZoomFactors[2].Value = uno::makeAny( nScaleYNumerator );
+                aZoomFactors[3].Name = C2U("ScaleYDenominator");
+                aZoomFactors[3].Value = uno::makeAny( nScaleYDenominator );
+                xProp->setPropertyValue( C2U("ZoomFactors"), uno::makeAny( aZoomFactors ));
+            }
+
             //a correct work area is at least necessary for correct values in the position and  size dialog and for dragging area
             if(m_pDrawViewWrapper)
             {
@@ -509,7 +530,7 @@ IMPL_LINK( ChartController, DoubleClickW
         {
             Window::PointerState aPointerState( m_pChartWindow->GetPointerState() );
             MouseEvent aMouseEvent( aPointerState.maPos,1/*nClicks*/,
-                                    0/*nMode*/, aPointerState.mnState/*nButtons*/,
+                                    0/*nMode*/, static_cast< USHORT >( aPointerState.mnState )/*nButtons*/,
                                     0/*nModifier*/ );
             impl_SetMousePointer( aMouseEvent );
         }
@@ -688,7 +709,7 @@ void ChartController::execute_MouseButto
             {
                 ControllerLockGuard aCLGuard( m_aModel->getModel());
                 UndoGuard aUndoGuard( pChartDragMethod->getUndoDescription(),
-                        m_aUndoManager, m_aModel->getModel() );
+                        m_xUndoManager, m_aModel->getModel() );
 
                 if( pDrawViewWrapper->EndDragObj(false) )
                 {
@@ -721,7 +742,7 @@ void ChartController::execute_MouseButto
                             ActionDescriptionProvider::createDescription(
                                 eActionType,
                                 ObjectNameProvider::getName( ObjectIdentifier::getObjectType( m_aSelection.getSelectedCID() ))),
-                            m_aUndoManager, m_aModel->getModel() );
+                            m_xUndoManager, m_aModel->getModel() );
                         bool bChanged = PositionAndSizeHelper::moveObject( m_aSelection.getSelectedCID()
                                         , m_aModel->getModel()
                                         , awt::Rectangle(aObjectRect.getX(),aObjectRect.getY(),aObjectRect.getWidth(),aObjectRect.getHeight())
@@ -893,7 +914,7 @@ bool ChartController::execute_KeyInput( 
 
     KeyCode aKeyCode( rKEvt.GetKeyCode());
     sal_uInt16 nCode = aKeyCode.GetCode();
-    bool bShift = aKeyCode.IsShift();
+//     bool bShift = aKeyCode.IsShift();
     bool bAlternate = aKeyCode.IsMod2();
 
     if( m_apAccelExecute.get() )
@@ -1060,8 +1081,8 @@ bool ChartController::execute_KeyInput( 
                             awt::Point aPos( xShape->getPosition() );
                             awt::Size aSize( xShape->getSize() );
                             awt::Size aPageSize( ChartModelHelper::getPageSize( m_aModel->getModel() ) );
-                            aPos.X += fShiftAmountX;
-                            aPos.Y += fShiftAmountY;
+                            aPos.X = static_cast< long >( static_cast< double >( aPos.X ) + fShiftAmountX );
+                            aPos.Y = static_cast< long >( static_cast< double >( aPos.Y ) + fShiftAmountY );
                             if( aPos.X + aSize.Width > aPageSize.Width )
                                 aPos.X = aPageSize.Width - aSize.Width;
                             if( aPos.X < 0 )
@@ -1150,6 +1171,12 @@ bool ChartController::requestQuickHelp(
     ::rtl::OUString & rOutQuickHelpText,
     awt::Rectangle & rOutEqualRect )
 {
+    uno::Reference< frame::XModel > xChartModel;
+    if( m_aModel.is())
+        xChartModel.set( m_aModel->getModel());
+    if( !xChartModel.is())
+        return false;
+
     // help text
     ::rtl::OUString aCID;
     if( m_pDrawViewWrapper )
@@ -1162,7 +1189,7 @@ bool ChartController::requestQuickHelp(
     if( bResult )
     {
         // get help text
-        rOutQuickHelpText = ObjectNameProvider::getHelpText( aCID, m_aModel->getModel(), bIsBalloonHelp /* bVerbose */ );
+        rOutQuickHelpText = ObjectNameProvider::getHelpText( aCID, xChartModel, bIsBalloonHelp /* bVerbose */ );
 
         // set rectangle
         ExplicitValueProvider * pValueProvider(
@@ -1325,7 +1352,7 @@ bool ChartController::impl_moveOrResizeO
                 ActionDescriptionProvider::createDescription(
                     eActionType,
                     ObjectNameProvider::getName( ObjectIdentifier::getObjectType( rCID ))),
-                m_aUndoManager, xChartModel );
+                m_xUndoManager, xChartModel );
             {
                 ControllerLockGuard aCLGuard( xChartModel );
                 if( bNeedShift )
Index: chart2/source/controller/main/CommandDispatch.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/CommandDispatch.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/CommandDispatch.cxx	22 May 2007 18:05:57 -0000	1.2
+++ chart2/source/controller/main/CommandDispatch.cxx	10 Jul 2007 13:38:14 -0000	1.2.12.1
@@ -106,7 +106,7 @@ void SAL_CALL CommandDispatch::disposing
 }
 
 // ____ XDispatch ____
-void SAL_CALL CommandDispatch::dispatch( const util::URL& URL, const Sequence< beans::PropertyValue >& Arguments )
+void SAL_CALL CommandDispatch::dispatch( const util::URL& /* URL */, const Sequence< beans::PropertyValue >& /* Arguments */ )
     throw (uno::RuntimeException)
 {}
 
@@ -135,14 +135,14 @@ void SAL_CALL CommandDispatch::removeSta
 }
 
 // ____ XModifyListener ____
-void SAL_CALL CommandDispatch::modified( const lang::EventObject& aEvent )
+void SAL_CALL CommandDispatch::modified( const lang::EventObject& /* aEvent */ )
     throw (uno::RuntimeException)
 {
     fireAllStatusEvents( 0 );
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL CommandDispatch::disposing( const lang::EventObject& Source )
+void SAL_CALL CommandDispatch::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {}
 
Index: chart2/source/controller/main/CommandDispatchContainer.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/CommandDispatchContainer.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/CommandDispatchContainer.cxx	22 May 2007 18:06:17 -0000	1.2
+++ chart2/source/controller/main/CommandDispatchContainer.cxx	25 Jun 2007 12:52:11 -0000	1.2.12.1
@@ -76,10 +76,11 @@ void CommandDispatchContainer::setModel(
     m_xModel.set( xModel );
 }
 
-void CommandDispatchContainer::setUndoManager( UndoManager * pUndoManager )
-{
-    m_pUndoManager = pUndoManager;
-}
+// void CommandDispatchContainer::setUndoManager(
+//     const Reference< chart2::XUndoManager > & xUndoManager )
+// {
+//     m_xUndoManager = xUndoManager;
+// }
 
 void CommandDispatchContainer::setFallbackDispatch(
     const Reference< frame::XDispatch > xFallbackDispatch,
@@ -104,7 +105,7 @@ Reference< frame::XDispatch > CommandDis
         if( rURL.Path.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "Undo" ))
             || rURL.Path.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "Redo" )))
         {
-            CommandDispatch * pDispatch = new UndoCommandDispatch( m_xContext, m_pUndoManager, m_xModel );
+            CommandDispatch * pDispatch = new UndoCommandDispatch( m_xContext, m_xModel );
             xResult.set( pDispatch );
             pDispatch->initialize();
             m_aCachedDispatches[ C2U(".uno:Undo") ].set( xResult );
Index: chart2/source/controller/main/CommandDispatchContainer.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/CommandDispatchContainer.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/CommandDispatchContainer.hxx	22 May 2007 18:06:27 -0000	1.2
+++ chart2/source/controller/main/CommandDispatchContainer.hxx	25 Jun 2007 12:52:11 -0000	1.2.12.1
@@ -35,24 +35,13 @@
 #ifndef CHART2_COMMANDDISPATCHCONTAINER_HXX
 #define CHART2_COMMANDDISPATCHCONTAINER_HXX
 
-#include "UndoManager.hxx"
-
-#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
 #include <com/sun/star/uno/XComponentContext.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XDISPATCH_HPP_
+#include <com/sun/star/chart2/XUndoManager.hpp>
 #include <com/sun/star/frame/XDispatch.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XMODEL_HPP_
 #include <com/sun/star/frame/XModel.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_DISPATCHDESCRIPTOR_HPP_
 #include <com/sun/star/frame/DispatchDescriptor.hpp>
-#endif
 
-#ifndef _CPPUHELPER_INTERFACECONTAINER_HXX_
 #include <cppuhelper/interfacecontainer.hxx>
-#endif
 
 #include <set>
 #include <map>
@@ -99,7 +88,9 @@ public:
     void setModel(
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
-    void setUndoManager( UndoManager * pUndoManager );
+//     void setUndoManager(
+//         const ::com::sun::star::uno::Reference<
+//             ::com::sun::star::chart2::XUndoManager > & xUndoManager );
 
     /** Set a fallback dispatcher that is used for all commands contained in
         rFallbackCommands
@@ -144,7 +135,7 @@ private:
 
     ::com::sun::star::uno::Reference< ::com::sun::star::uno::XComponentContext > m_xContext;
     ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel > m_xModel;
-    UndoManager * m_pUndoManager;
+    ::com::sun::star::uno::Reference< ::com::sun::star::chart2::XUndoManager > m_xUndoManager;
 
     ::com::sun::star::uno::Reference< ::com::sun::star::frame::XDispatch > m_xFallbackDispatcher;
     ::std::set< ::rtl::OUString >                                          m_aFallbackCommands;
Index: chart2/source/controller/main/ControllerCommandDispatch.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/ControllerCommandDispatch.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/ControllerCommandDispatch.cxx	22 May 2007 18:06:56 -0000	1.2
+++ chart2/source/controller/main/ControllerCommandDispatch.cxx	25 Jun 2007 12:52:11 -0000	1.2.12.1
@@ -183,7 +183,7 @@ void ControllerState::update(
             ObjectIdentifier::getDataSeriesForCID(
                 aSelObjCID, xModel ) );
 
-        bIsDeleteableObjectSelected = ChartController::isObjectDeleteable( xController, aSelObj );
+        bIsDeleteableObjectSelected = ChartController::isObjectDeleteable( aSelObj );
 
         bMayMoveSeriesForward = DiagramHelper::isSeriesMoveable(
             ChartModelHelper::findDiagram( xModel ),
@@ -523,7 +523,7 @@ void SAL_CALL ControllerCommandDispatch:
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL ControllerCommandDispatch::disposing( const lang::EventObject& Source )
+void SAL_CALL ControllerCommandDispatch::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     m_xController.clear();
Index: chart2/source/controller/main/DragMethod_PieSegment.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/DragMethod_PieSegment.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/DragMethod_PieSegment.cxx	22 May 2007 18:07:37 -0000	1.2
+++ chart2/source/controller/main/DragMethod_PieSegment.cxx	10 Jul 2007 13:38:14 -0000	1.2.12.1
@@ -148,7 +148,7 @@ void DragMethod_PieSegment::Mov(const Po
 		}
     }
 }
-FASTBOOL DragMethod_PieSegment::End(FASTBOOL bCopy)
+FASTBOOL DragMethod_PieSegment::End(FASTBOOL /* bCopy */)
 {
     Hide();
 
Index: chart2/source/controller/main/DragMethod_RotateDiagram.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/DragMethod_RotateDiagram.cxx,v
retrieving revision 1.3
retrieving revision 1.3.4.1
diff -u -u -p -r1.3 -r1.3.4.1
--- chart2/source/controller/main/DragMethod_RotateDiagram.cxx	3 Jul 2007 13:40:41 -0000	1.3
+++ chart2/source/controller/main/DragMethod_RotateDiagram.cxx	10 Jul 2007 13:38:14 -0000	1.3.4.1
@@ -215,7 +215,7 @@ void DragMethod_RotateDiagram::CreateOve
 	}
 }
 
-FASTBOOL DragMethod_RotateDiagram::End(FASTBOOL bCopy)
+FASTBOOL DragMethod_RotateDiagram::End(FASTBOOL /* bCopy */)
 {
     Hide();
 
Index: chart2/source/controller/main/StatusBarCommandDispatch.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/StatusBarCommandDispatch.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/StatusBarCommandDispatch.cxx	22 May 2007 18:09:28 -0000	1.2
+++ chart2/source/controller/main/StatusBarCommandDispatch.cxx	10 Jul 2007 13:38:14 -0000	1.2.12.1
@@ -120,8 +120,8 @@ void StatusBarCommandDispatch::fireStatu
 
 // ____ XDispatch ____
 void SAL_CALL StatusBarCommandDispatch::dispatch(
-    const util::URL& URL,
-    const Sequence< beans::PropertyValue >& Arguments )
+    const util::URL& /* URL */,
+    const Sequence< beans::PropertyValue >& /* Arguments */ )
     throw (uno::RuntimeException)
 {
     // nothing to do here
@@ -136,7 +136,7 @@ void SAL_CALL StatusBarCommandDispatch::
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL StatusBarCommandDispatch::disposing( const lang::EventObject& Source )
+void SAL_CALL StatusBarCommandDispatch::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     m_xModifiable.clear();
@@ -154,7 +154,7 @@ void SAL_CALL StatusBarCommandDispatch::
 }
 
 // ____ XSelectionChangeListener ____
-void SAL_CALL StatusBarCommandDispatch::selectionChanged( const lang::EventObject& aEvent )
+void SAL_CALL StatusBarCommandDispatch::selectionChanged( const lang::EventObject& /* aEvent */ )
     throw (uno::RuntimeException)
 {
     if( m_xSelectionSupplier.is())
Index: chart2/source/controller/main/UndoCommandDispatch.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/UndoCommandDispatch.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/controller/main/UndoCommandDispatch.cxx	22 May 2007 18:09:48 -0000	1.2
+++ chart2/source/controller/main/UndoCommandDispatch.cxx	26 Jun 2007 11:19:05 -0000	1.2.12.2
@@ -39,16 +39,11 @@
 #include "UndoCommandDispatch.hxx"
 #include "macros.hxx"
 
-#ifndef _COM_SUN_STAR_UTIL_XMODIFYBROADCASTER_HPP_
+#include <com/sun/star/chart2/XUndoSupplier.hpp>
 #include <com/sun/star/util/XModifyBroadcaster.hpp>
-#endif
 
-#ifndef _VOS_MUTEX_HXX_
 #include <vos/mutex.hxx>
-#endif
-#ifndef _SV_SVAPP_HXX
 #include <vcl/svapp.hxx>
-#endif
 
 // for ressource strings STR_UNDO and STR_REDO
 #include <sfx2/sfx.hrc>
@@ -66,21 +61,25 @@ namespace chart
 
 UndoCommandDispatch::UndoCommandDispatch(
     const Reference< uno::XComponentContext > & xContext,
-    UndoManager * pUndoManager,
     const Reference< frame::XModel > & xModel ) :
         CommandDispatch( xContext ),
-        m_pUndoManager( pUndoManager ),
         m_xModel( xModel )
-{}
+{
+    Reference< chart2::XUndoSupplier > xUndoSupplier( xModel, uno::UNO_QUERY );
+    OSL_ASSERT( xUndoSupplier.is());
+    if( xUndoSupplier.is())
+        m_xUndoManager.set( xUndoSupplier->getUndoManager());
+}
 
 UndoCommandDispatch::~UndoCommandDispatch()
 {}
 
 void UndoCommandDispatch::initialize()
 {
-    if( m_pUndoManager )
+    Reference< util::XModifyBroadcaster > xBroadcaster( m_xUndoManager, uno::UNO_QUERY );
+    if( xBroadcaster.is() )
     {
-        m_pUndoManager->addModifyListener( this );
+        xBroadcaster->addModifyListener( this );
     }
 }
 
@@ -88,43 +87,45 @@ void UndoCommandDispatch::fireStatusEven
     const OUString & rURL,
     const Reference< frame::XStatusListener > & xSingleListener /* = 0 */ )
 {
-    if( m_pUndoManager )
+    if( m_xUndoManager.is() )
     {
         bool bFireAll = (rURL.getLength() == 0);
         uno::Any aUndoState, aRedoState;
-        if( m_pUndoManager->canUndo())
+        if( m_xUndoManager->undoPossible())
         {
-            OUString aUndo( String( SchResId( STR_UNDO )));
-            aUndoState <<= ( aUndo + m_pUndoManager->getCurrentUndoString());
+            // using assignment for broken gcc 3.3
+            OUString aUndo = OUString( String( SchResId( STR_UNDO )));
+            aUndoState <<= ( aUndo + m_xUndoManager->getCurrentUndoString());
         }
-        if( m_pUndoManager->canRedo())
+        if( m_xUndoManager->redoPossible())
         {
-            OUString aRedo( String( SchResId( STR_REDO )));
-            aRedoState <<= ( aRedo + m_pUndoManager->getCurrentRedoString());
+            // using assignment for broken gcc 3.3
+            OUString aRedo = OUString( String( SchResId( STR_REDO )));
+            aRedoState <<= ( aRedo + m_xUndoManager->getCurrentRedoString());
         }
 
         if( bFireAll || rURL.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM(".uno:Undo")))
-            fireStatusEventForURL( C2U(".uno:Undo"), aUndoState, m_pUndoManager->canUndo(), xSingleListener );
+            fireStatusEventForURL( C2U(".uno:Undo"), aUndoState, m_xUndoManager->undoPossible(), xSingleListener );
         if( bFireAll || rURL.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM(".uno:Redo")))
-            fireStatusEventForURL( C2U(".uno:Redo"), aRedoState, m_pUndoManager->canRedo(), xSingleListener );
+            fireStatusEventForURL( C2U(".uno:Redo"), aRedoState, m_xUndoManager->redoPossible(), xSingleListener );
     }
 }
 
 // ____ XDispatch ____
 void SAL_CALL UndoCommandDispatch::dispatch(
     const util::URL& URL,
-    const Sequence< beans::PropertyValue >& Arguments )
+    const Sequence< beans::PropertyValue >& /* Arguments */ )
     throw (uno::RuntimeException)
 {
-    if( m_pUndoManager )
+    if( m_xUndoManager.is() )
     {
         // why is it necessary to lock the solar mutex here?
         // /--
         ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
         if( URL.Path.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "Undo" )))
-            m_pUndoManager->undo( m_xModel );
+            m_xUndoManager->undo( m_xModel );
         else
-            m_pUndoManager->redo( m_xModel );
+            m_xUndoManager->redo( m_xModel );
         // \--
     }
 }
@@ -133,21 +134,21 @@ void SAL_CALL UndoCommandDispatch::dispa
 /// is called when this is disposed
 void SAL_CALL UndoCommandDispatch::disposing()
 {
-    if( m_pUndoManager )
+    Reference< util::XModifyBroadcaster > xBroadcaster( m_xUndoManager, uno::UNO_QUERY );
+    if( xBroadcaster.is() )
     {
-        m_pUndoManager->removeModifyListener( this );
-        // not owner
-        m_pUndoManager = 0;
+        xBroadcaster->removeModifyListener( this );
     }
 
+    m_xUndoManager.clear();
     m_xModel.clear();
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL UndoCommandDispatch::disposing( const lang::EventObject& Source )
+void SAL_CALL UndoCommandDispatch::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
-    m_pUndoManager = 0;
+    m_xUndoManager.clear();
     m_xModel.clear();
 }
 
Index: chart2/source/controller/main/UndoCommandDispatch.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/UndoCommandDispatch.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/controller/main/UndoCommandDispatch.hxx	22 May 2007 18:09:58 -0000	1.2
+++ chart2/source/controller/main/UndoCommandDispatch.hxx	25 Jun 2007 12:52:11 -0000	1.2.12.1
@@ -36,11 +36,9 @@
 #define CHART2_UNDOCOMMANDDISPATCH_HXX
 
 #include "CommandDispatch.hxx"
-#include "UndoManager.hxx"
 
-#ifndef _COM_SUN_STAR_FRAME_XMODEL_HPP_
 #include <com/sun/star/frame/XModel.hpp>
-#endif
+#include <com/sun/star/chart2/XUndoManager.hpp>
 
 namespace chart
 {
@@ -56,7 +54,6 @@ public:
 	explicit UndoCommandDispatch(
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::uno::XComponentContext > & xContext,
-        UndoManager * pUndoManager,
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
 	virtual ~UndoCommandDispatch();
@@ -85,9 +82,10 @@ protected:
         const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XStatusListener > & xSingleListener );
 
 private:
-    UndoManager * m_pUndoManager;
     ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > m_xModel;
+    ::com::sun::star::uno::Reference<
+            ::com::sun::star::chart2::XUndoManager > m_xUndoManager;
 };
 
 } //  namespace chart
Index: chart2/source/controller/main/_serviceregistration_controller.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/controller/main/_serviceregistration_controller.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/controller/main/_serviceregistration_controller.cxx	22 May 2007 18:10:24 -0000	1.5
+++ chart2/source/controller/main/_serviceregistration_controller.cxx	25 Jun 2007 12:52:11 -0000	1.5.12.1
@@ -95,7 +95,7 @@ extern "C"
 {
 //==================================================================================================
 void SAL_CALL component_getImplementationEnvironment(
-	const sal_Char ** ppEnvTypeName, uno_Environment ** ppEnv )
+	const sal_Char ** ppEnvTypeName, uno_Environment ** /* ppEnv */ )
 {
 	*ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
 }
cvs diff: Diffing chart2/source/inc
Index: chart2/source/inc/ErrorBar.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/ErrorBar.hxx,v
retrieving revision 1.4
retrieving revision 1.4.12.1
diff -u -u -p -r1.4 -r1.4.12.1
--- chart2/source/inc/ErrorBar.hxx	22 May 2007 18:16:01 -0000	1.4
+++ chart2/source/inc/ErrorBar.hxx	12 Jul 2007 05:29:01 -0000	1.4.12.1
@@ -104,9 +104,8 @@ protected:
     // ____ OPropertySet ____
     virtual ::com::sun::star::uno::Any GetDefaultValue( sal_Int32 nHandle ) const
         throw(::com::sun::star::beans::UnknownPropertyException);
-
-    // ____ OPropertySet ____
 	virtual ::cppu::IPropertyArrayHelper & SAL_CALL getInfoHelper();
+	using OPropertySet::disposing;
 
     // ____ XPropertySet ____
     virtual ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySetInfo > SAL_CALL
Index: chart2/source/inc/InternalDataProvider.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/InternalDataProvider.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/inc/InternalDataProvider.hxx	22 May 2007 18:17:36 -0000	1.2
+++ chart2/source/inc/InternalDataProvider.hxx	10 Jul 2007 13:18:55 -0000	1.2.12.2
@@ -78,6 +78,14 @@ namespace chart
 namespace impl
 {
 class InternalData;
+
+typedef ::cppu::WeakImplHelper5<
+        ::com::sun::star::chart2::XInternalDataProvider,
+        ::com::sun::star::chart2::data::XRangeXMLConversion,
+        ::com::sun::star::chart::XChartDataArray,
+        ::com::sun::star::util::XCloneable,
+        ::com::sun::star::lang::XServiceInfo >
+    InternalDataProvider_Base;
 }
 
 /** Data provider that handles data internally.  This is used for charts with
@@ -91,12 +99,7 @@ class InternalData;
     that?)</p>
  */
 class InternalDataProvider :
-        public ::cppu::WeakImplHelper5<
-            ::com::sun::star::chart2::XInternalDataProvider,
-            ::com::sun::star::chart2::data::XRangeXMLConversion,
-            ::com::sun::star::chart::XChartDataArray,
-            ::com::sun::star::util::XCloneable,
-            ::com::sun::star::lang::XServiceInfo >
+        public impl::InternalDataProvider_Base
 {
 public:
 	explicit InternalDataProvider();
@@ -141,6 +144,9 @@ public:
         throw (::com::sun::star::uno::RuntimeException);
 
     // ____ XDataProvider (base of XInternalDataProvider) ____
+    virtual ::sal_Bool SAL_CALL createDataSourcePossible(
+        const ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue >& aArguments )
+        throw (::com::sun::star::uno::RuntimeException);
     virtual ::com::sun::star::uno::Reference< ::com::sun::star::chart2::data::XDataSource > SAL_CALL createDataSource(
         const ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue >& aArguments )
         throw (::com::sun::star::lang::IllegalArgumentException,
@@ -148,6 +154,9 @@ public:
     virtual ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue > SAL_CALL detectArguments(
         const ::com::sun::star::uno::Reference< ::com::sun::star::chart2::data::XDataSource >& xDataSource )
         throw (::com::sun::star::uno::RuntimeException);
+    virtual ::sal_Bool SAL_CALL createDataSequenceByRangeRepresentationPossible(
+        const ::rtl::OUString& aRangeRepresentation )
+        throw (::com::sun::star::uno::RuntimeException);
     virtual ::com::sun::star::uno::Reference< ::com::sun::star::chart2::data::XDataSequence > SAL_CALL createDataSequenceByRangeRepresentation(
         const ::rtl::OUString& aRangeRepresentation )
         throw (::com::sun::star::lang::IllegalArgumentException,
Index: chart2/source/inc/NameContainer.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/NameContainer.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/inc/NameContainer.hxx	22 May 2007 18:19:47 -0000	1.2
+++ chart2/source/inc/NameContainer.hxx	10 Jul 2007 14:42:15 -0000	1.2.12.1
@@ -60,11 +60,16 @@ namespace chart
 {
 //.............................................................................
 
-class NameContainer : public ::cppu::WeakImplHelper3<
-          ::com::sun::star::container::XNameContainer
-		, ::com::sun::star::lang::XServiceInfo
-        , ::com::sun::star::util::XCloneable
-		>
+namespace impl
+{
+typedef ::cppu::WeakImplHelper3<
+        ::com::sun::star::container::XNameContainer,
+        ::com::sun::star::lang::XServiceInfo,
+        ::com::sun::star::util::XCloneable >
+    NameContainer_Base;
+}
+
+class NameContainer : public impl::NameContainer_Base
 {
 public:
 	NameContainer( const ::com::sun::star::uno::Type& rType, const rtl::OUString& rServicename, const rtl::OUString& rImplementationName );
Index: chart2/source/inc/OPropertySet.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/OPropertySet.hxx,v
retrieving revision 1.4
retrieving revision 1.4.12.1
diff -u -u -p -r1.4 -r1.4.12.1
--- chart2/source/inc/OPropertySet.hxx	22 May 2007 18:20:42 -0000	1.4
+++ chart2/source/inc/OPropertySet.hxx	4 Jul 2007 16:47:34 -0000	1.4.12.1
@@ -151,9 +151,9 @@ protected:
 
         @see ::cppu::OPropertySetHelper
     */
-    virtual ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySetInfo > SAL_CALL
-        getPropertySetInfo()
-        throw (::com::sun::star::uno::RuntimeException) = 0;
+//     virtual ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySetInfo > SAL_CALL
+//         getPropertySetInfo()
+//         throw (::com::sun::star::uno::RuntimeException) = 0;
 
     /** Try to convert the value <code>rValue</code> to the type required by the
         property associated with <code>nHandle</code>.
Index: chart2/source/inc/UndoGuard.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/UndoGuard.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/inc/UndoGuard.hxx	22 May 2007 18:23:47 -0000	1.2
+++ chart2/source/inc/UndoGuard.hxx	25 Jun 2007 12:52:12 -0000	1.2.12.1
@@ -35,15 +35,11 @@
 #ifndef CHART2_UNDOGUARD_HXX
 #define CHART2_UNDOGUARD_HXX
 
-#ifndef _COM_SUN_STAR_FRAME_XMODEL_HPP_
 #include <com/sun/star/frame/XModel.hpp>
-#endif
+#include <com/sun/star/chart2/XUndoManager.hpp>
+
 // header for class OUString
-#ifndef _RTL_USTRING_HXX_
 #include <rtl/ustring.hxx>
-#endif
-
-#include "UndoManager.hxx"
 
 namespace chart
 {
@@ -52,8 +48,9 @@ namespace chart
 class UndoGuard_Base
 {
 public:
-    explicit UndoGuard_Base( const rtl::OUString& rUndoMessage
-        , UndoManager& rUndoManager
+    explicit UndoGuard_Base( const rtl::OUString & rUndoMessage
+        , const ::com::sun::star::uno::Reference<
+            ::com::sun::star::chart2::XUndoManager > & xUndoManager
         , const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
     virtual ~UndoGuard_Base();
@@ -63,8 +60,9 @@ public:
 protected:
     ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > m_xModel;
+    ::com::sun::star::uno::Reference<
+            ::com::sun::star::chart2::XUndoManager > m_xUndoManager;
 
-    UndoManager&    m_rUndoManager;
     rtl::OUString   m_aUndoString;
     bool            m_bActionPosted;
 };
@@ -77,7 +75,8 @@ class UndoGuard : public UndoGuard_Base
 {
 public:
     explicit UndoGuard( const rtl::OUString& rUndoMessage
-        , UndoManager& rUndoManager
+        , const ::com::sun::star::uno::Reference<
+            ::com::sun::star::chart2::XUndoManager > & xUndoManager
         , const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
     virtual ~UndoGuard();
@@ -91,7 +90,8 @@ class UndoLiveUpdateGuard : public UndoG
 {
 public:
     explicit UndoLiveUpdateGuard( const rtl::OUString& rUndoMessage
-        , UndoManager& rUndoManager
+        , const ::com::sun::star::uno::Reference<
+            ::com::sun::star::chart2::XUndoManager > & xUndoManager
         , const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
     virtual ~UndoLiveUpdateGuard();
@@ -104,7 +104,8 @@ class UndoLiveUpdateGuardWithData : publ
 {
 public:
     explicit UndoLiveUpdateGuardWithData( const rtl::OUString& rUndoMessage
-        , UndoManager& rUndoManager
+        , const ::com::sun::star::uno::Reference<
+            ::com::sun::star::chart2::XUndoManager > & xUndoManager
         , const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
     virtual ~UndoLiveUpdateGuardWithData();
Index: chart2/source/inc/UndoManager.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/UndoManager.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/inc/UndoManager.hxx	22 May 2007 18:23:57 -0000	1.2
+++ chart2/source/inc/UndoManager.hxx	27 Jun 2007 09:05:41 -0000	1.2.12.2
@@ -36,23 +36,17 @@
 #define CHART2_UNDOMANAGER_HXX
 
 #include "ConfigItemListener.hxx"
+#include "MutexContainer.hxx"
 
-#ifndef _COM_SUN_STAR_UNO_REFERENCE_HXX_
 #include <com/sun/star/uno/Reference.hxx>
-#endif
-#ifndef _COM_SUN_STAR_UNO_SEQUENCE_HXX_
 #include <com/sun/star/uno/Sequence.hxx>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODIFYBROADCASTER_HPP_
 #include <com/sun/star/util/XModifyBroadcaster.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODIFYLISTENER_HPP_
 #include <com/sun/star/util/XModifyListener.hpp>
-#endif
+#include <com/sun/star/chart2/XUndoManager.hpp>
+#include <com/sun/star/chart2/XUndoHelper.hpp>
 
-#ifndef _RTL_USTRING_HXX_
+#include <cppuhelper/compbase3.hxx>
 #include <rtl/ustring.hxx>
-#endif
 
 // for pair
 #include <utility>
@@ -76,6 +70,12 @@ class UndoElement;
 class  UndoStack;
 class  ModifyBroadcaster;
 
+typedef ::cppu::WeakComponentImplHelper3<
+            ::com::sun::star::util::XModifyBroadcaster,
+            ::com::sun::star::chart2::XUndoManager,
+            ::com::sun::star::chart2::XUndoHelper >
+    UndoManager_Base;
+
 } // namespace impl
 // ----------------------------------------
 
@@ -86,68 +86,71 @@ class  ModifyBroadcaster;
     redo-stacks support the css::util::XCloneable interface, which is
     implemented such that the entire model is cloned.
  */
-class UndoManager : public ConfigItemListener
+class UndoManager :
+        public MutexContainer,
+        public ConfigItemListener,
+        public impl::UndoManager_Base
 {
 public:
 	explicit UndoManager();
 	virtual ~UndoManager();
 
-    /// call this before you change the xCurrentModel
-    void preAction( const ::com::sun::star::uno::Reference<
-                    ::com::sun::star::frame::XModel > & xCurrentModel );
-    /// call this after you successfully did changes to your current model
-    void postAction( const ::rtl::OUString & rUndoString );
-    /// call this if you aborted the current action.
-    void cancelAction();
-    /** same as cancelAction() but restores the given model to the state set in
-        preAction.  This is useful for cancellation in live-preview dialogs.
-    */
-    void cancelActionUndo( const ::com::sun::star::uno::Reference<
-                               ::com::sun::star::frame::XModel > & xModelToRestore );
-
-    /// same as preAction but with cloning the data for the chart in addition to the model
-    void preActionWithData( const ::com::sun::star::uno::Reference<
-                            ::com::sun::star::frame::XModel > & xCurrentModel );
-
-    /// give the current model to be put into the redo-stack
-    void undo( const ::com::sun::star::uno::Reference<
-               ::com::sun::star::frame::XModel > & xCurrentModel );
-    /// give the current model to be put into the undo-stack
-    void redo( const ::com::sun::star::uno::Reference<
-               ::com::sun::star::frame::XModel > & xCurrentModel );
-
-    bool canUndo() const;
-    bool canRedo() const;
-
-    ::rtl::OUString getCurrentUndoString() const;
-    ::rtl::OUString getCurrentRedoString() const;
-
-    ::com::sun::star::uno::Sequence< ::rtl::OUString > getUndoStrings() const;
-    ::com::sun::star::uno::Sequence< ::rtl::OUString > getRedoStrings() const;
-
-    /** limits the size of the undo- and the redo-stack
-
-        The default is defined by the registry entry Common/Undo/Steps.
-        (Default is 100, the allowed range is 1 to 1000)
-    */
-//     void setMaximumNumberOfUndoSteps( sal_Int32 nMaxUndoSteps );
-    /// gets the current maximum size of the undo- and the redo-stack
-    sal_Int32 getMaximumNumberOfUndoSteps();
-
-    void addModifyListener( const ::com::sun::star::uno::Reference<
-							    ::com::sun::star::util::XModifyListener >& xListener );
-    void removeModifyListener( const ::com::sun::star::uno::Reference<
-                                   ::com::sun::star::util::XModifyListener >& xListener );
-
 protected:
     // ____ ConfigItemListener ____
     virtual void notify( const ::rtl::OUString & rPropertyName );
 
+    // ____ util::XModifyBroadcaster ____
+    virtual void SAL_CALL addModifyListener(
+        const ::com::sun::star::uno::Reference< ::com::sun::star::util::XModifyListener >& aListener )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL removeModifyListener(
+        const ::com::sun::star::uno::Reference< ::com::sun::star::util::XModifyListener >& aListener )
+        throw (::com::sun::star::uno::RuntimeException);
+
+    // ____ chart2::XUndoManager ____
+    virtual void SAL_CALL preAction( const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xModelBeforeChange )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL preActionWithArguments(
+        const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xModelBeforeChange,
+        const ::com::sun::star::uno::Sequence< ::com::sun::star::beans::PropertyValue >& aArguments )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL postAction( const ::rtl::OUString& aUndoText )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL cancelAction()
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL cancelActionWithUndo( ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xModelToRestore )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL undo( ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xCurrentModel )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL redo( ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xCurrentModel )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual ::sal_Bool SAL_CALL undoPossible()
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual ::sal_Bool SAL_CALL redoPossible()
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual ::rtl::OUString SAL_CALL getCurrentUndoString()
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual ::rtl::OUString SAL_CALL getCurrentRedoString()
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Sequence< ::rtl::OUString > SAL_CALL getAllUndoStrings()
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual ::com::sun::star::uno::Sequence< ::rtl::OUString > SAL_CALL getAllRedoStrings()
+        throw (::com::sun::star::uno::RuntimeException);
+
+    // ____ XUndoHelper ____
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel > SAL_CALL getModelCloneForUndo(
+        const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xModelBeforeChange )
+        throw (::com::sun::star::uno::RuntimeException);
+    virtual void SAL_CALL applyModelContent(
+        ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xModelToChange,
+        const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel >& xModelToCopyFrom )
+        throw (::com::sun::star::uno::RuntimeException);
+
 private:
     void retrieveConfigUndoSteps();
     void fireModifyEvent();
     void impl_undoRedo(
-        const ::com::sun::star::uno::Reference<
+        ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xCurrentModel,
         impl::UndoStack * pStackToRemoveFrom,
         impl::UndoStack * pStackToAddTo );
Index: chart2/source/inc/WeakListenerAdapter.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/WeakListenerAdapter.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/inc/WeakListenerAdapter.hxx	22 May 2007 18:24:07 -0000	1.2
+++ chart2/source/inc/WeakListenerAdapter.hxx	26 Jun 2007 10:59:44 -0000	1.2.12.1
@@ -93,7 +93,9 @@ protected:
         throw (::com::sun::star::uno::RuntimeException)
     {
         ::com::sun::star::uno::Reference<
-              ::com::sun::star::lang::XEventListener > xEventListener(
+              ::com::sun::star::lang::XEventListener > xEventListener =
+          ::com::sun::star::uno::Reference<
+              ::com::sun::star::lang::XEventListener >(
                   ::com::sun::star::uno::Reference< Listener >( m_xListener), ::com::sun::star::uno::UNO_QUERY );
         if( xEventListener.is())
             xEventListener->disposing( Source );
Index: chart2/source/inc/WrappedIgnoreProperty.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/WrappedIgnoreProperty.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/inc/WrappedIgnoreProperty.hxx	22 May 2007 18:24:36 -0000	1.2
+++ chart2/source/inc/WrappedIgnoreProperty.hxx	7 Jul 2007 12:01:48 -0000	1.2.12.1
@@ -66,7 +66,8 @@ public:
                         throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::uno::RuntimeException);
 
 protected:
-    ::com::sun::star::uno::Any     m_aDefaultValue;
+    ::com::sun::star::uno::Any          m_aDefaultValue;
+    mutable ::com::sun::star::uno::Any  m_aCurrentValue;
 };
 
 class WrappedIgnoreProperties
Index: chart2/source/inc/macros.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/inc/macros.hxx,v
retrieving revision 1.3
retrieving revision 1.3.12.1
diff -u -u -p -r1.3 -r1.3.12.1
--- chart2/source/inc/macros.hxx	22 May 2007 18:25:29 -0000	1.3
+++ chart2/source/inc/macros.hxx	11 Jul 2007 16:53:41 -0000	1.3.12.1
@@ -52,7 +52,7 @@
     ex.Message, RTL_TEXTENCODING_ASCII_US ).getStr())
 #else
 //avoid compilation warnings
-#define ASSERT_EXCEPTION(ex) ex.Context.is();
+#define ASSERT_EXCEPTION(ex) (void)(ex);
 #endif
 
 #define U2C(ouString) (::rtl::OUStringToOString(ouString,RTL_TEXTENCODING_ASCII_US).getStr())
cvs diff: Diffing chart2/source/inc/chartview
cvs diff: Diffing chart2/source/model
cvs diff: Diffing chart2/source/model/filter
cvs diff: Diffing chart2/source/model/inc
cvs diff: Diffing chart2/source/model/main
Index: chart2/source/model/main/Axis.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/Axis.cxx,v
retrieving revision 1.10
retrieving revision 1.9.12.3
diff -u -u -p -r1.10 -r1.9.12.3
--- chart2/source/model/main/Axis.cxx	3 Jul 2007 13:42:15 -0000	1.10
+++ chart2/source/model/main/Axis.cxx	11 Jul 2007 14:49:19 -0000	1.9.12.3
@@ -325,6 +325,7 @@ void lcl_CloneSubGrids(
         ++pDestIt;
     }
     OSL_ASSERT( pDestIt == pDestEnd );
+    (void)(pDestEnd); // avoid warning
 }
 
 } // anonymous namespace
@@ -354,6 +355,8 @@ Axis::Axis( Reference< uno::XComponentCo
 }
 
 Axis::Axis( const Axis & rOther ) :
+        MutexContainer(),
+        impl::Axis_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex )),
     m_aScaleData( rOther.m_aScaleData )
@@ -375,7 +378,7 @@ Axis::Axis( const Axis & rOther ) :
 }
 
 // late initialization to call after copy-constructing
-void Axis::Init( const Axis & rOther )
+void Axis::Init( const Axis & /* rOther */ )
 {
     if( m_aScaleData.Categories.is())
         EventListenerHelper::addListener( m_aScaleData.Categories, this );
Index: chart2/source/model/main/BaseCoordinateSystem.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/BaseCoordinateSystem.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/model/main/BaseCoordinateSystem.cxx	22 May 2007 18:31:16 -0000	1.2
+++ chart2/source/model/main/BaseCoordinateSystem.cxx	11 Jul 2007 14:49:19 -0000	1.2.12.2
@@ -125,9 +125,9 @@ BaseCoordinateSystem::BaseCoordinateSyst
     sal_Bool bSwapXAndYAxis /* = sal_False */ ) :
         ::property::OPropertySet( m_aMutex ),
         m_xContext( xContext ),
-        m_nDimensionCount( nDimensionCount ),
-        m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
-{
+        m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex )),
+        m_nDimensionCount( nDimensionCount )
+ {
     m_aAllAxis.resize( m_nDimensionCount );
     for( sal_Int32 nN=0; nN<m_nDimensionCount; nN++ )
     {
@@ -162,11 +162,13 @@ BaseCoordinateSystem::BaseCoordinateSyst
 // explicit
 BaseCoordinateSystem::BaseCoordinateSystem(
     const BaseCoordinateSystem & rSource ) :
+        impl::BaseCoordinateSystem_Base(),
+        MutexContainer(),
         ::property::OPropertySet( rSource, m_aMutex ),
     m_xContext( rSource.m_xContext ),
+    m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex )),
     m_nDimensionCount( rSource.m_nDimensionCount ),
-    m_aOrigin( rSource.m_aOrigin ),
-    m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
+    m_aOrigin( rSource.m_aOrigin )
 {
     m_aAllAxis.resize(rSource.m_aAllAxis.size());
     tAxisVecVecType::size_type nN=0;
@@ -343,7 +345,7 @@ void SAL_CALL BaseCoordinateSystem::modi
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL BaseCoordinateSystem::disposing( const lang::EventObject& Source )
+void SAL_CALL BaseCoordinateSystem::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/ChartModel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/ChartModel.cxx,v
retrieving revision 1.11
retrieving revision 1.10.12.5
diff -u -u -p -r1.11 -r1.10.12.5
--- chart2/source/model/main/ChartModel.cxx	11 Jun 2007 14:59:54 -0000	1.11
+++ chart2/source/model/main/ChartModel.cxx	11 Jul 2007 14:49:20 -0000	1.10.12.5
@@ -47,6 +47,7 @@
 #include "RangeHighlighter.hxx"
 #include "DisposeHelper.hxx"
 #include "ControllerLockGuard.hxx"
+#include "ObjectIdentifier.hxx"
 
 #ifndef INCLUDED_COMPHELPER_INLINE_CONTAINER_HXX
 #include <comphelper/InlineContainer.hxx>
@@ -186,7 +187,8 @@ ChartModel::ChartModel(uno::Reference<un
 }
 
 ChartModel::ChartModel( const ChartModel & rOther )
-	: m_aLifeTimeManager( this, this )
+	: impl::ChartModel_Base()
+    , m_aLifeTimeManager( this, this )
 	, m_bReadOnly( rOther.m_bReadOnly )
 	, m_bModified( rOther.m_bModified )
     , m_nInLoad(0)
@@ -507,9 +509,7 @@ APPHELPER_XSERVICEINFO_IMPL(ChartModel,C
             rtl::OUString aObjectCID;
             if( aSel >>= aObjectCID )
             {
-                OSL_ENSURE( false, "getCurrentSelection(): not implemented yet.");
-                //todo get the accessory model object
-			    //xReturn = ;
+			    xReturn.set( ObjectIdentifier::getObjectPropertySet( aObjectCID, Reference< XChartDocument >(this)));
             }
 		}
 	}
@@ -568,7 +568,7 @@ APPHELPER_XSERVICEINFO_IMPL(ChartModel,C
 	if( m_aLifeTimeManager.impl_isDisposedOrClosed() )
 		return; //behave passive if already disposed or closed
 
-	m_aLifeTimeManager.m_aListenerContainer.addInterface( ::getCppuType((const uno::Reference< util::XCloseListener >*)0), xListener );
+	m_aLifeTimeManager.m_aListenerContainer.addInterface( ::getCppuType((const uno::Reference< lang::XEventListener >*)0), xListener );
 }
 
 		void SAL_CALL ChartModel
@@ -578,7 +578,7 @@ APPHELPER_XSERVICEINFO_IMPL(ChartModel,C
 	if( m_aLifeTimeManager.impl_isDisposedOrClosed() )
 		return; //behave passive if already disposed or closed
 
-	m_aLifeTimeManager.m_aListenerContainer.removeInterface( ::getCppuType((const uno::Reference< util::XCloseListener >*)0), xListener );
+	m_aLifeTimeManager.m_aListenerContainer.removeInterface( ::getCppuType((const uno::Reference< lang::XEventListener >*)0), xListener );
 	return;
 }
 
@@ -826,12 +826,14 @@ APPHELPER_XSERVICEINFO_IMPL(ChartModel,C
             throw (uno::RuntimeException)
 {
     OSL_ASSERT( m_pImplChartModel.get() != 0 );
-    // /--
-    MutexGuard aGuard( m_aModelMutex );
-    m_pImplChartModel->RemoveAllDiagrams();
-    m_pImplChartModel->AppendDiagram( xDiagram );
+    {
+        // /--
+        MutexGuard aGuard( m_aModelMutex );
+        m_pImplChartModel->RemoveAllDiagrams();
+        m_pImplChartModel->AppendDiagram( xDiagram );
+        // \--
+    }
     setModified( sal_True );
-    // \--
 }
 
         void SAL_CALL ChartModel
@@ -872,11 +874,13 @@ sal_Bool SAL_CALL ChartModel::hasInterna
             throw (uno::RuntimeException)
 {
     OSL_ASSERT( m_pImplChartModel.get() != 0 );
-    // /--
-    MutexGuard aGuard( m_aModelMutex );
-    m_pImplChartModel->SetDataProvider( xProvider );
+    {
+        // /--
+        MutexGuard aGuard( m_aModelMutex );
+        m_pImplChartModel->SetDataProvider( xProvider );
+        // \--
+    }
     setModified( sal_True );
-    // \--
 }
 
             void SAL_CALL ChartModel
@@ -884,11 +888,13 @@ sal_Bool SAL_CALL ChartModel::hasInterna
             throw (uno::RuntimeException)
 {
     OSL_ASSERT( m_pImplChartModel.get() != 0 );
-    // /--
-    MutexGuard aGuard( m_aModelMutex );
-    m_pImplChartModel->SetNumberFormatsSupplier( xSupplier );
+    {
+        // /--
+        MutexGuard aGuard( m_aModelMutex );
+        m_pImplChartModel->SetNumberFormatsSupplier( xSupplier );
+        // \--
+    }
     setModified( sal_True );
-    // \--
 }
 
         void SAL_CALL ChartModel
@@ -897,20 +903,22 @@ sal_Bool SAL_CALL ChartModel::hasInterna
                    uno::RuntimeException)
 {
     OSL_ASSERT( m_pImplChartModel.get() != 0 );
-    // /--
-    MutexGuard aGuard( m_aModelMutex );
-    lockControllers();
-    try
-    {
-        m_pImplChartModel->SetArguments( aArguments, true /* bSetData */ );
-    }
-    catch( const uno::Exception & ex )
     {
-        ASSERT_EXCEPTION( ex );
+        // /--
+        MutexGuard aGuard( m_aModelMutex );
+        lockControllers();
+        try
+        {
+            m_pImplChartModel->SetArguments( aArguments, true /* bSetData */ );
+        }
+        catch( const uno::Exception & ex )
+        {
+            ASSERT_EXCEPTION( ex );
+        }
+        unlockControllers();
+        // \--
     }
-    unlockControllers();
     setModified( sal_True );
-    // \--
 }
 
         Sequence< OUString > SAL_CALL ChartModel
@@ -946,11 +954,13 @@ sal_Bool SAL_CALL ChartModel::hasInterna
             throw (uno::RuntimeException)
 {
     OSL_ASSERT( m_pImplChartModel.get() != 0 );
-    // /--
-    MutexGuard aGuard( m_aModelMutex );
-    m_pImplChartModel->SetChartTypeManager( xNewManager );
+    {
+        // /--
+        MutexGuard aGuard( m_aModelMutex );
+        m_pImplChartModel->SetChartTypeManager( xNewManager );
+        // \--
+    }
     setModified( sal_True );
-    // \--
 }
 
         uno::Reference< chart2::XChartTypeManager > SAL_CALL ChartModel
@@ -992,11 +1002,13 @@ void SAL_CALL ChartModel::setTitle(
     throw (uno::RuntimeException)
 {
     OSL_ASSERT( m_pImplChartModel.get() != 0 );
-    // /--
-    MutexGuard aGuard( m_aModelMutex );
-    m_pImplChartModel->SetTitle( Title );
+    {
+        // /--
+        MutexGuard aGuard( m_aModelMutex );
+        m_pImplChartModel->SetTitle( Title );
+        // \--
+    }
     setModified( sal_True );
-    // \--
 }
 
 void ChartModel::impl_createOldModelAgg()
@@ -1072,6 +1084,7 @@ awt::Size SAL_CALL ChartModel::getVisual
 {
     OSL_ENSURE( nAspect == embed::Aspects::MSOLE_CONTENT,
                 "No aspects other than content are supported" );
+    (void)(nAspect); // avoid warning in non-debug builds
     // other possible aspects are MSOLE_THUMBNAIL, MSOLE_ICON and MSOLE_DOCPRINT
 
     return m_aVisualAreaSize;
@@ -1085,6 +1098,7 @@ embed::VisualRepresentation SAL_CALL Cha
 {
     OSL_ENSURE( nAspect == embed::Aspects::MSOLE_CONTENT,
                 "No aspects other than content are supported" );
+    (void)(nAspect); // avoid warning in non-debug builds
 
     embed::VisualRepresentation aResult;
 
@@ -1124,6 +1138,7 @@ embed::VisualRepresentation SAL_CALL Cha
 {
     OSL_ENSURE( nAspect == embed::Aspects::MSOLE_CONTENT,
                 "No aspects other than content are supported" );
+    (void)(nAspect); // avoid warning in non-debug builds
     return embed::EmbedMapUnits::ONE_100TH_MM;
 }
 
@@ -1277,6 +1292,7 @@ Reference< uno::XInterface > SAL_CALL Ch
             throw( uno::Exception, uno::RuntimeException )
 {
     OSL_ENSURE( Arguments.getLength(), "createInstanceWithArguments: Warning: Arguments are ignored" );
+    (void)(Arguments); // avoid warning in non-debug builds
     return createInstance( rServiceSpecifier );
 }
 
@@ -1359,4 +1375,11 @@ void SAL_CALL ChartModel::setParent( con
         m_xParent.set( Parent, uno::UNO_QUERY );
 }
 
+// ____ XUndoManager ____
+Reference< chart2::XUndoManager > SAL_CALL ChartModel::getUndoManager()
+    throw (uno::RuntimeException)
+{
+    return m_pImplChartModel->GetUndoManager();
+}
+
 }  // namespace chart
Index: chart2/source/model/main/ChartModel.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/ChartModel.hxx,v
retrieving revision 1.7
retrieving revision 1.7.12.2
diff -u -u -p -r1.7 -r1.7.12.2
--- chart2/source/model/main/ChartModel.hxx	22 May 2007 18:32:37 -0000	1.7
+++ chart2/source/model/main/ChartModel.hxx	25 Jun 2007 16:18:36 -0000	1.7.12.2
@@ -38,95 +38,42 @@
 #include "LifeTime.hxx"
 #include "ServiceMacros.hxx"
 
-#ifndef _COM_SUN_STAR_FRAME_XMODEL_HPP_
 #include <com/sun/star/frame/XModel.hpp>
-#endif
-#ifndef _COM_SUN_STAR_FRAME_XSTORABLE2_HPP_
 #include <com/sun/star/frame/XStorable2.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XMODIFIABLE_HPP_
 #include <com/sun/star/util/XModifiable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_SDBC_XCLOSEABLE_HPP_
 #include <com/sun/star/util/XCloseable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_VIEW_XPRINTABLE_HPP_
 #include <com/sun/star/view/XPrintable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DOCUMENT_XEVENTBROADCASTER_HPP_
 #include <com/sun/star/document/XEventBroadcaster.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DOCUMENT_XEVENTSSUPPLIER_HPP_
 #include <com/sun/star/document/XEventsSupplier.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DOCUMENT_XDOCUMENTINFOSUPPLIER_HPP_
 #include <com/sun/star/document/XDocumentInfoSupplier.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DOCUMENT_XVIEWDATASUPPLIER_HPP_
 #include <com/sun/star/document/XViewDataSupplier.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DOCUMENT_XFILTER_HPP_
 #include <com/sun/star/document/XFilter.hpp>
-#endif
-#ifndef _COM_SUN_STAR_LANG_XMULTISERVICEFACTORY_HPP_
 #include <com/sun/star/lang/XMultiServiceFactory.hpp>
-#endif
-#ifndef _COM_SUN_STAR_LANG_XSERVICEINFO_HPP_
 #include <com/sun/star/lang/XServiceInfo.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UNO_XCOMPONENTCONTEXT_HPP_
 #include <com/sun/star/uno/XComponentContext.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XCLONEABLE_HPP_
 #include <com/sun/star/util/XCloneable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_EMBED_XVISUALOBJECT_HPP_
 #include <com/sun/star/embed/XVisualObject.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DOCUMENT_XSTORAGEBASEDDOCUMENT_HPP_
 #include <com/sun/star/document/XStorageBasedDocument.hpp>
-#endif
-#ifndef _COM_SUN_STAR_LANG_XUNOTUNNEL_HPP_
 #include <com/sun/star/lang/XUnoTunnel.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XNUMBERFORMATSSUPPLIER_HPP_
 #include <com/sun/star/util/XNumberFormatsSupplier.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CONTAINER_XCHILD_HPP_
 #include <com/sun/star/container/XChild.hpp>
-#endif
+#include <com/sun/star/chart2/XUndoSupplier.hpp>
 
 // public API
-#ifndef _COM_SUN_STAR_CHART2_DATA_XDATAPROVIDER_HPP_
 #include <com/sun/star/chart2/data/XDataProvider.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_DATA_XDATARECEIVER_HPP_
 #include <com/sun/star/chart2/data/XDataReceiver.hpp>
-#endif
 
-#ifndef _COM_SUN_STAR_CHART2_XCHARTDOCUMENT_HPP_
 #include <com/sun/star/chart2/XChartDocument.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XTITLED_HPP_
 #include <com/sun/star/chart2/XTitled.hpp>
-#endif
 
-#ifndef _COM_SUN_STAR_FRAME_XLOADABLE_HPP_
 #include <com/sun/star/frame/XLoadable.hpp>
-#endif
-#ifndef _COM_SUN_STAR_EMBED_XEMBEDDEDOBJECT_HPP_
 #include <com/sun/star/embed/XEmbeddedObject.hpp>
-#endif
-#ifndef _COM_SUN_STAR_EMBED_XSTORAGE_HPP_
 #include <com/sun/star/embed/XStorage.hpp>
-#endif
-#ifndef _COM_SUN_STAR_DATATRANSFER_XTRANSFERABLE_HPP_
 #include <com/sun/star/datatransfer/XTransferable.hpp>
-#endif
 
-#if ! defined(INCLUDED_COMPHELPER_IMPLBASE_VAR_HXX_17)
-#define INCLUDED_COMPHELPER_IMPLBASE_VAR_HXX_17
-#define COMPHELPER_IMPLBASE_INTERFACE_NUMBER 17
+#if ! defined(INCLUDED_COMPHELPER_IMPLBASE_VAR_HXX_18)
+#define INCLUDED_COMPHELPER_IMPLBASE_VAR_HXX_18
+#define COMPHELPER_IMPLBASE_INTERFACE_NUMBER 18
 #include "comphelper/implbase_var.hxx"
 #endif
 
@@ -157,7 +104,7 @@ namespace impl
     class ImplChartModel;
 
 // Note: needed for queryInterface (if it calls the base-class implementation)
-typedef ::comphelper::WeakImplHelper17<
+typedef ::comphelper::WeakImplHelper18<
 // 		 ::com::sun::star::frame::XModel		//comprehends XComponent (required interface), base of XChartDocument
 		 ::com::sun::star::util::XCloseable		//comprehends XCloseBroadcaster
 		,::com::sun::star::frame::XStorable2	//(extension of XStorable)
@@ -187,6 +134,7 @@ typedef ::comphelper::WeakImplHelper17<
         ,::com::sun::star::container::XChild
         ,::com::sun::star::util::XModifyListener
         ,::com::sun::star::datatransfer::XTransferable
+        ,::com::sun::star::chart2::XUndoSupplier
 		>
     ChartModel_Base;
 }
@@ -702,6 +650,10 @@ public:
         const ::com::sun::star::uno::Reference< ::com::sun::star::uno::XInterface >& Parent )
         throw (::com::sun::star::lang::NoSupportException,
                ::com::sun::star::uno::RuntimeException);
+
+    // ____ XUndoSupplier ____
+    virtual ::com::sun::star::uno::Reference< ::com::sun::star::chart2::XUndoManager > SAL_CALL getUndoManager()
+        throw (::com::sun::star::uno::RuntimeException);
 };
 
 }  // namespace chart
Index: chart2/source/model/main/DataPoint.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/DataPoint.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/model/main/DataPoint.cxx	22 May 2007 18:33:22 -0000	1.5
+++ chart2/source/model/main/DataPoint.cxx	11 Jul 2007 14:49:20 -0000	1.5.12.1
@@ -114,6 +114,8 @@ DataPoint::DataPoint( const uno::Referen
 {}
 
 DataPoint::DataPoint( const DataPoint & rOther ) :
+        MutexContainer(),
+        impl::DataPoint_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
         m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {
Index: chart2/source/model/main/DataSeries.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/DataSeries.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.1
diff -u -u -p -r1.6 -r1.6.12.1
--- chart2/source/model/main/DataSeries.cxx	22 May 2007 18:34:26 -0000	1.6
+++ chart2/source/model/main/DataSeries.cxx	11 Jul 2007 14:49:20 -0000	1.6.12.1
@@ -140,6 +140,8 @@ DataSeries::DataSeries( const uno::Refer
 }
 
 DataSeries::DataSeries( const DataSeries & rOther ) :
+        MutexContainer(),
+        impl::DataSeries_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xContext( rOther.m_xContext ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
Index: chart2/source/model/main/Diagram.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/Diagram.cxx,v
retrieving revision 1.15
retrieving revision 1.14.12.3
diff -u -u -p -r1.15 -r1.14.12.3
--- chart2/source/model/main/Diagram.cxx	3 Jul 2007 13:42:45 -0000	1.15
+++ chart2/source/model/main/Diagram.cxx	11 Jul 2007 14:49:20 -0000	1.14.12.3
@@ -226,6 +226,8 @@ Diagram::Diagram( uno::Reference< uno::X
 }
 
 Diagram::Diagram( const Diagram & rOther ) :
+        MutexContainer(),
+        impl::Diagram_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xContext( rOther.m_xContext ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
@@ -483,7 +485,7 @@ void SAL_CALL Diagram::modified( const l
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL Diagram::disposing( const lang::EventObject& Source )
+void SAL_CALL Diagram::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/FormattedString.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/FormattedString.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.2
diff -u -u -p -r1.6 -r1.6.12.2
--- chart2/source/model/main/FormattedString.cxx	22 May 2007 18:36:42 -0000	1.6
+++ chart2/source/model/main/FormattedString.cxx	11 Jul 2007 14:49:20 -0000	1.6.12.2
@@ -102,13 +102,15 @@ FormattedString::FormattedString( const 
 {}
 
 FormattedString::FormattedString(
-        uno::Reference< uno::XComponentContext > const & xContext ) :
+        uno::Reference< uno::XComponentContext > const & /* xContext */ ) :
         ::property::OPropertySet( m_aMutex ),
     m_aString(),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {}
 
 FormattedString::FormattedString( const FormattedString & rOther ) :
+        MutexContainer(),
+        impl::FormattedString_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_aString( rOther.m_aString ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
@@ -181,7 +183,7 @@ void SAL_CALL FormattedString::modified(
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL FormattedString::disposing( const lang::EventObject& Source )
+void SAL_CALL FormattedString::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/GridProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/GridProperties.cxx,v
retrieving revision 1.3
retrieving revision 1.2.12.3
diff -u -u -p -r1.3 -r1.2.12.3
--- chart2/source/model/main/GridProperties.cxx	3 Jul 2007 13:43:00 -0000	1.3
+++ chart2/source/model/main/GridProperties.cxx	11 Jul 2007 14:49:20 -0000	1.2.12.3
@@ -142,7 +142,7 @@ const Sequence< Property > & lcl_getProp
 namespace chart
 {
 
-GridProperties::GridProperties( Reference< uno::XComponentContext > const & xContext ) :
+GridProperties::GridProperties( Reference< uno::XComponentContext > const & /* xContext */ ) :
         ::property::OPropertySet( m_aMutex ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {
@@ -154,6 +154,8 @@ GridProperties::GridProperties() :
 {}
 
 GridProperties::GridProperties( const GridProperties & rOther ) :
+        MutexContainer(),
+        impl::GridProperties_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {
@@ -256,7 +258,7 @@ void SAL_CALL GridProperties::modified( 
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL GridProperties::disposing( const lang::EventObject& Source )
+void SAL_CALL GridProperties::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/ImplChartModel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/ImplChartModel.cxx,v
retrieving revision 1.13
retrieving revision 1.11.12.4
diff -u -u -p -r1.13 -r1.11.12.4
--- chart2/source/model/main/ImplChartModel.cxx	3 Jul 2007 13:43:15 -0000	1.13
+++ chart2/source/model/main/ImplChartModel.cxx	11 Jul 2007 14:49:20 -0000	1.11.12.4
@@ -49,6 +49,7 @@
 #include "ModifyListenerHelper.hxx"
 #include "DataSourceHelper.hxx"
 #include "DisposeHelper.hxx"
+#include "UndoManager.hxx"
 #include "ThreeDHelper.hxx"
 
 // header for class SvNumberFormatter
@@ -149,7 +150,10 @@ ImplChartModel::ImplChartModel(
     Reference< uno::XComponentContext > const & xContext,
     const Reference< util::XModifyListener > & xListener ) :
         m_xContext( xContext ),
+        m_spChartData( new ChartData( m_xContext )),
         m_bIsDisposed( false ),
+        m_xPageBackground( new PageBackground( m_xContext )),
+        m_xUndoManager( new UndoManager()),
         m_xDashTable( new NameContainer( ::getCppuType( reinterpret_cast< const drawing::LineDash * >(0)),
                 C2U( "com.sun.star.drawing.DashTable" ), C2U( "com.sun.star.comp.chart.DashTable" ) )),
         m_xGradientTable( new NameContainer( ::getCppuType( reinterpret_cast< const awt::Gradient * >(0)),
@@ -164,8 +168,6 @@ ImplChartModel::ImplChartModel(
                 C2U( "com.sun.star.xml.NamespaceMap" ), C2U( "com.sun.star.comp.chart.XMLNameSpaceMap" ) )),
         m_xModifyListener( xListener )
 {
-    m_spChartData.reset( new ChartData( m_xContext ));
-    m_xPageBackground.set( new PageBackground( m_xContext ));
     ModifyListenerHelper::addListener( m_xPageBackground, m_xModifyListener );
     m_xChartTypeManager.set(
         xContext->getServiceManager()->createInstanceWithContext(
@@ -596,6 +598,11 @@ Reference< beans::XPropertySet > ImplCha
     return m_xPageBackground;
 }
 
+Reference< chart2::XUndoManager > ImplChartModel::GetUndoManager()
+{
+    return m_xUndoManager;
+}
+
 // OUString
 ::std::vector< Reference< chart2::data::XLabeledDataSequence > > ImplChartModel::GetData()
 {
Index: chart2/source/model/main/ImplChartModel.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/ImplChartModel.hxx,v
retrieving revision 1.8
retrieving revision 1.7.12.3
diff -u -u -p -r1.8 -r1.7.12.3
--- chart2/source/model/main/ImplChartModel.hxx	11 Jun 2007 15:00:52 -0000	1.8
+++ chart2/source/model/main/ImplChartModel.hxx	25 Jun 2007 13:58:05 -0000	1.7.12.3
@@ -35,50 +35,23 @@
 #ifndef CHART_IMPLCHARTMODEL_HXX
 #define CHART_IMPLCHARTMODEL_HXX
 
-#ifndef _COM_SUN_STAR_CHART2_DATA_XDATASOURCE_HPP_
 #include <com/sun/star/chart2/data/XDataSource.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XDATASERIES_HPP_
 #include <com/sun/star/chart2/XDataSeries.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_DATA_XLABELEDDATASEQUENCE_HPP_
 #include <com/sun/star/chart2/data/XLabeledDataSequence.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XDIAGRAM_HPP_
 #include <com/sun/star/chart2/XDiagram.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_DATA_XDATAPROVIDER_HPP_
 #include <com/sun/star/chart2/data/XDataProvider.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XCHARTTYPEMANAGER_HPP_
 #include <com/sun/star/chart2/XChartTypeManager.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XCHARTTYPETEMPLATE_HPP_
 #include <com/sun/star/chart2/XChartTypeTemplate.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XTITLE_HPP_
 #include <com/sun/star/chart2/XTitle.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CHART2_XCHARTDOCUMENT_HPP_
 #include <com/sun/star/chart2/XChartDocument.hpp>
-#endif
+#include <com/sun/star/chart2/XUndoManager.hpp>
 
-#ifndef _COM_SUN_STAR_CONTAINER_XNAMECONTAINER_HPP_
 #include <com/sun/star/container/XNameContainer.hpp>
-#endif
-#ifndef _COM_SUN_STAR_CONTAINER_NOSUCHELEMENTEXCEPTION_HPP_
 #include <com/sun/star/container/NoSuchElementException.hpp>
-#endif
-#ifndef _COM_SUN_STAR_IO_IOEXCEPTION_HPP_
 #include <com/sun/star/io/IOException.hpp>
-#endif
-#ifndef _COM_SUN_STAR_UTIL_XNUMBERFORMATSSUPPLIER_HPP_
 #include <com/sun/star/util/XNumberFormatsSupplier.hpp>
-#endif
 
-#ifndef _CPPUHELPER_WEAKREF_HXX_
 #include <cppuhelper/weakref.hxx>
-#endif
 
 #include "ChartData.hxx"
 
@@ -195,6 +168,9 @@ public:
     ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >
         GetPageBackground();
 
+    ::com::sun::star::uno::Reference< ::com::sun::star::chart2::XUndoManager >
+        GetUndoManager();
+
     ::std::vector< ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::data::XLabeledDataSequence > > GetData();
 
@@ -270,6 +246,8 @@ private:
     bool                                  m_bIsDisposed;
     ::com::sun::star::uno::Reference< ::com::sun::star::beans::XPropertySet >
                                           m_xPageBackground;
+    ::com::sun::star::uno::Reference< ::com::sun::star::chart2::XUndoManager >
+                                          m_xUndoManager;
 
     ::com::sun::star::uno::Reference< ::com::sun::star::container::XNameContainer > m_xDashTable;
     ::com::sun::star::uno::Reference< ::com::sun::star::container::XNameContainer > m_xGradientTable;
Index: chart2/source/model/main/Legend.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/Legend.cxx,v
retrieving revision 1.14
retrieving revision 1.14.12.3
diff -u -u -p -r1.14 -r1.14.12.3
--- chart2/source/model/main/Legend.cxx	22 May 2007 18:39:27 -0000	1.14
+++ chart2/source/model/main/Legend.cxx	11 Jul 2007 14:49:20 -0000	1.14.12.3
@@ -135,6 +135,9 @@ void lcl_AddDefaultsToMap(
     OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_LEGEND_ANCHOR_POSITION ));
     rOutMap[ PROP_LEGEND_ANCHOR_POSITION ] =
         uno::makeAny( chart2::LegendPosition_LINE_END );
+    OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_LEGEND_PREFERRED_EXPANSION ));
+    rOutMap[ PROP_LEGEND_PREFERRED_EXPANSION ] =
+        uno::makeAny( chart2::LegendExpansion_HIGH );
 
     OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_LEGEND_SHOW ));
     rOutMap[ PROP_LEGEND_SHOW ] =
@@ -190,13 +193,15 @@ const Sequence< Property > & lcl_GetProp
 namespace chart
 {
 
-Legend::Legend( Reference< uno::XComponentContext > const & xContext ) :
+Legend::Legend( Reference< uno::XComponentContext > const & /* xContext */ ) :
         ::property::OPropertySet( m_aMutex ),
         m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {
 }
 
 Legend::Legend( const Legend & rOther ) :
+        MutexContainer(),
+        impl::Legend_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {
@@ -298,7 +303,7 @@ void SAL_CALL Legend::modified( const la
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL Legend::disposing( const lang::EventObject& Source )
+void SAL_CALL Legend::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/PageBackground.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/PageBackground.cxx,v
retrieving revision 1.7
retrieving revision 1.7.8.2
diff -u -u -p -r1.7 -r1.7.8.2
--- chart2/source/model/main/PageBackground.cxx	11 Jun 2007 15:01:05 -0000	1.7
+++ chart2/source/model/main/PageBackground.cxx	11 Jul 2007 14:49:20 -0000	1.7.8.2
@@ -128,6 +128,8 @@ PageBackground::PageBackground( const un
 {}
 
 PageBackground::PageBackground( const PageBackground & rOther ) :
+        MutexContainer(),
+        impl::PageBackground_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xContext( rOther.m_xContext ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
@@ -235,7 +237,7 @@ void SAL_CALL PageBackground::modified( 
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL PageBackground::disposing( const lang::EventObject& Source )
+void SAL_CALL PageBackground::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/StockBar.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/StockBar.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/model/main/StockBar.cxx	22 May 2007 18:41:18 -0000	1.2
+++ chart2/source/model/main/StockBar.cxx	11 Jul 2007 14:49:20 -0000	1.2.12.2
@@ -140,6 +140,8 @@ StockBar::StockBar( bool bRisingCourse )
 }
 
 StockBar::StockBar( const StockBar & rOther ) :
+        MutexContainer(),
+        impl::StockBar_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_bRisingCourse( rOther.m_bRisingCourse ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
@@ -246,7 +248,7 @@ void SAL_CALL StockBar::modified( const 
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL StockBar::disposing( const lang::EventObject& Source )
+void SAL_CALL StockBar::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/Title.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/Title.cxx,v
retrieving revision 1.10
retrieving revision 1.10.12.2
diff -u -u -p -r1.10 -r1.10.12.2
--- chart2/source/model/main/Title.cxx	22 May 2007 18:41:54 -0000	1.10
+++ chart2/source/model/main/Title.cxx	11 Jul 2007 14:49:20 -0000	1.10.12.2
@@ -267,12 +267,14 @@ const uno::Sequence< Property > & lcl_Ge
 namespace chart
 {
 
-Title::Title( uno::Reference< uno::XComponentContext > const & xContext ) :
+Title::Title( uno::Reference< uno::XComponentContext > const & /* xContext */ ) :
         ::property::OPropertySet( m_aMutex ),
         m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {}
 
 Title::Title( const Title & rOther ) :
+        MutexContainer(),
+        impl::Title_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
         m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {
@@ -411,7 +413,7 @@ void SAL_CALL Title::modified( const lan
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL Title::disposing( const lang::EventObject& Source )
+void SAL_CALL Title::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/Wall.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/Wall.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.2
diff -u -u -p -r1.6 -r1.6.12.2
--- chart2/source/model/main/Wall.cxx	22 May 2007 18:42:23 -0000	1.6
+++ chart2/source/model/main/Wall.cxx	11 Jul 2007 14:49:20 -0000	1.6.12.2
@@ -145,6 +145,8 @@ Wall::Wall() :
 {}
 
 Wall::Wall( const Wall & rOther ) :
+        MutexContainer(),
+        impl::Wall_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
 {}
@@ -253,7 +255,7 @@ void SAL_CALL Wall::modified( const lang
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL Wall::disposing( const lang::EventObject& Source )
+void SAL_CALL Wall::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/main/_serviceregistration_model.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/main/_serviceregistration_model.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/model/main/_serviceregistration_model.cxx	22 May 2007 18:43:16 -0000	1.5
+++ chart2/source/model/main/_serviceregistration_model.cxx	25 Jun 2007 12:52:12 -0000	1.5.12.1
@@ -190,7 +190,7 @@ extern "C"
 {
 //==================================================================================================
 void SAL_CALL component_getImplementationEnvironment(
-	const sal_Char ** ppEnvTypeName, uno_Environment ** ppEnv )
+	const sal_Char ** ppEnvTypeName, uno_Environment ** /* ppEnv */ )
 {
 	*ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
 }
cvs diff: Diffing chart2/source/model/template
Index: chart2/source/model/template/AreaChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/AreaChartTypeTemplate.cxx,v
retrieving revision 1.7
retrieving revision 1.7.12.1
diff -u -u -p -r1.7 -r1.7.12.1
--- chart2/source/model/template/AreaChartTypeTemplate.cxx	22 May 2007 18:44:11 -0000	1.7
+++ chart2/source/model/template/AreaChartTypeTemplate.cxx	27 Jun 2007 13:40:23 -0000	1.7.12.1
@@ -211,7 +211,7 @@ sal_Int32 AreaChartTypeTemplate::getDime
     return nDim;
 }
 
-StackMode AreaChartTypeTemplate::getStackMode( sal_Int32 nChartTypeIndex ) const
+StackMode AreaChartTypeTemplate::getStackMode( sal_Int32 /* nChartTypeIndex */ ) const
 {
     return m_eStackMode;
 }
Index: chart2/source/model/template/BarChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/BarChartTypeTemplate.cxx,v
retrieving revision 1.8
retrieving revision 1.7.12.2
diff -u -u -p -r1.8 -r1.7.12.2
--- chart2/source/model/template/BarChartTypeTemplate.cxx	3 Jul 2007 13:43:29 -0000	1.8
+++ chart2/source/model/template/BarChartTypeTemplate.cxx	6 Jul 2007 16:51:09 -0000	1.7.12.2
@@ -164,7 +164,7 @@ sal_Int32 BarChartTypeTemplate::getDimen
     return m_nDim;
 }
 
-StackMode BarChartTypeTemplate::getStackMode( sal_Int32 nChartTypeIndex ) const
+StackMode BarChartTypeTemplate::getStackMode( sal_Int32 /* nChartTypeIndex */ ) const
 {
     return m_eStackMode;
 }
@@ -197,7 +197,7 @@ sal_Bool SAL_CALL BarChartTypeTemplate::
         ::std::vector< Reference< chart2::XDataSeries > > aSeriesVec(
             DiagramHelper::getDataSeriesFromDiagram( xDiagram ));
 
-        sal_Int32 aCommonGeom;
+        sal_Int32 aCommonGeom( 0 );
         bool bGeomFound = false, bAdaptGeom = false;
         for( ::std::vector< Reference< chart2::XDataSeries > >::const_iterator aIt =
                  aSeriesVec.begin(); aIt != aSeriesVec.end(); ++aIt )
Index: chart2/source/model/template/CandleStickChartType.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/CandleStickChartType.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/model/template/CandleStickChartType.cxx	22 May 2007 18:45:29 -0000	1.2
+++ chart2/source/model/template/CandleStickChartType.cxx	27 Jun 2007 13:40:23 -0000	1.2.12.1
@@ -110,6 +110,7 @@ void lcl_AddDefaultsToMap(
     ::chart::tPropertyValueMap & rOutMap,
     ::osl::Mutex & rMutex )
 {
+    ::osl::MutexGuard aGuard( rMutex );
     // must match default in CTOR!
     OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CANDLESTICKCHARTTYPE_JAPANESE ));
     rOutMap[ PROP_CANDLESTICKCHARTTYPE_JAPANESE ] =
Index: chart2/source/model/template/ChartType.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/ChartType.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.2
diff -u -u -p -r1.5 -r1.5.12.2
--- chart2/source/model/template/ChartType.cxx	22 May 2007 18:45:53 -0000	1.5
+++ chart2/source/model/template/ChartType.cxx	11 Jul 2007 14:49:20 -0000	1.5.12.2
@@ -74,6 +74,8 @@ ChartType::ChartType(
 {}
 
 ChartType::ChartType( const ChartType & rOther ) :
+        MutexContainer(),
+        impl::ChartType_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex )),
     m_xContext( rOther.m_xContext ),
@@ -236,7 +238,7 @@ void SAL_CALL ChartType::setDataSeries( 
 }
 
 // ____ OPropertySet ____
-uno::Any ChartType::GetDefaultValue( sal_Int32 nHandle ) const
+uno::Any ChartType::GetDefaultValue( sal_Int32 /* nHandle */ ) const
     throw(beans::UnknownPropertyException)
 {
     return uno::Any();
@@ -245,7 +247,8 @@ uno::Any ChartType::GetDefaultValue( sal
 // ____ OPropertySet ____
 ::cppu::IPropertyArrayHelper & SAL_CALL ChartType::getInfoHelper()
 {
-    static ::cppu::OPropertyArrayHelper aArrayHelper(
+    // using assignment for broken gcc 3.3
+    static ::cppu::OPropertyArrayHelper aArrayHelper = ::cppu::OPropertyArrayHelper(
         Sequence< beans::Property >(), /* bSorted */ sal_True );
 
     return aArrayHelper;
@@ -308,7 +311,7 @@ void SAL_CALL ChartType::modified( const
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL ChartType::disposing( const lang::EventObject& Source )
+void SAL_CALL ChartType::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/model/template/ChartTypeManager.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/ChartTypeManager.cxx,v
retrieving revision 1.16
retrieving revision 1.16.12.1
diff -u -u -p -r1.16 -r1.16.12.1
--- chart2/source/model/template/ChartTypeManager.cxx	22 May 2007 18:46:20 -0000	1.16
+++ chart2/source/model/template/ChartTypeManager.cxx	27 Jun 2007 13:40:23 -0000	1.16.12.1
@@ -552,7 +552,7 @@ uno::Reference< uno::XInterface > SAL_CA
 
 uno::Reference< uno::XInterface > SAL_CALL ChartTypeManager::createInstanceWithArguments(
     const OUString& ServiceSpecifier,
-    const uno::Sequence< uno::Any >& Arguments )
+    const uno::Sequence< uno::Any >& /* Arguments */ )
     throw (uno::Exception,
            uno::RuntimeException)
 {
Index: chart2/source/model/template/ChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/ChartTypeTemplate.cxx,v
retrieving revision 1.15
retrieving revision 1.15.12.1
diff -u -u -p -r1.15 -r1.15.12.1
--- chart2/source/model/template/ChartTypeTemplate.cxx	22 May 2007 18:46:33 -0000	1.15
+++ chart2/source/model/template/ChartTypeTemplate.cxx	27 Jun 2007 13:40:23 -0000	1.15.12.1
@@ -357,7 +357,7 @@ void SAL_CALL ChartTypeTemplate::changeD
 
 sal_Bool SAL_CALL ChartTypeTemplate::matchesTemplate(
     const Reference< chart2::XDiagram >& xDiagram,
-    sal_Bool bAdaptProperties )
+    sal_Bool /* bAdaptProperties */ )
     throw (uno::RuntimeException)
 {
     sal_Bool bResult = sal_False;
@@ -420,8 +420,8 @@ Reference< chart2::XDataInterpreter > SA
 void SAL_CALL ChartTypeTemplate::applyStyle(
     const Reference< chart2::XDataSeries >& xSeries,
     ::sal_Int32 nChartTypeIndex,
-    ::sal_Int32 nSeriesIndex,
-    ::sal_Int32 nSeriesCount )
+    ::sal_Int32 /* nSeriesIndex */,
+    ::sal_Int32 /* nSeriesCount */ )
     throw (uno::RuntimeException)
 {
     // sset stacking mode
@@ -487,7 +487,7 @@ sal_Int32 ChartTypeTemplate::getDimensio
     return 2;
 }
 
-StackMode ChartTypeTemplate::getStackMode( sal_Int32 nChartTypeIndex ) const
+StackMode ChartTypeTemplate::getStackMode( sal_Int32 /* nChartTypeIndex */ ) const
 {
     return StackMode_NONE;
 }
@@ -629,7 +629,7 @@ void ChartTypeTemplate::adaptScales(
     }
 }
 
-void ChartTypeTemplate::adaptDiagram( const Reference< XDiagram > & xDiagram )
+void ChartTypeTemplate::adaptDiagram( const Reference< XDiagram > & /* xDiagram */ )
 {
     return;
 }
@@ -722,7 +722,7 @@ void ChartTypeTemplate::FillDiagram(
     const Sequence< Sequence< Reference< XDataSeries > > >& aSeriesSeq,
     Reference< data::XLabeledDataSequence > xCategories,
     const Sequence< Reference< XChartType > >& aOldChartTypesSeq,
-    bool bCreate )
+    bool /* bCreate */ )
 {
     adaptDiagram( xDiagram );
 
Index: chart2/source/model/template/LineChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/LineChartTypeTemplate.cxx,v
retrieving revision 1.14
retrieving revision 1.14.12.1
diff -u -u -p -r1.14 -r1.14.12.1
--- chart2/source/model/template/LineChartTypeTemplate.cxx	22 May 2007 18:49:33 -0000	1.14
+++ chart2/source/model/template/LineChartTypeTemplate.cxx	27 Jun 2007 13:40:23 -0000	1.14.12.1
@@ -238,7 +238,7 @@ sal_Int32 LineChartTypeTemplate::getDime
     return m_nDim;
 }
 
-StackMode LineChartTypeTemplate::getStackMode( sal_Int32 nChartTypeIndex ) const
+StackMode LineChartTypeTemplate::getStackMode( sal_Int32 /* nChartTypeIndex */ ) const
 {
     return m_eStackMode;
 }
Index: chart2/source/model/template/NetChartType.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/NetChartType.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/model/template/NetChartType.cxx	22 May 2007 18:49:59 -0000	1.5
+++ chart2/source/model/template/NetChartType.cxx	27 Jun 2007 13:40:23 -0000	1.5.12.1
@@ -66,12 +66,12 @@ namespace
 {
 
 void lcl_AddPropertiesToVector(
-    ::std::vector< Property > & rOutProperties )
+    ::std::vector< Property > & /* rOutProperties */ )
 {
 }
 
 void lcl_AddDefaultsToMap(
-    ::chart::tPropertyValueMap & rOutMap )
+    ::chart::tPropertyValueMap & /* rOutMap */ )
 {
 }
 
Index: chart2/source/model/template/NetChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/NetChartTypeTemplate.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.1
diff -u -u -p -r1.6 -r1.6.12.1
--- chart2/source/model/template/NetChartTypeTemplate.cxx	22 May 2007 18:50:23 -0000	1.6
+++ chart2/source/model/template/NetChartTypeTemplate.cxx	27 Jun 2007 13:40:23 -0000	1.6.12.1
@@ -87,7 +87,7 @@ NetChartTypeTemplate::NetChartTypeTempla
 NetChartTypeTemplate::~NetChartTypeTemplate()
 {}
 
-StackMode NetChartTypeTemplate::getStackMode( sal_Int32 nChartTypeIndex ) const
+StackMode NetChartTypeTemplate::getStackMode( sal_Int32 /* nChartTypeIndex */ ) const
 {
     return m_eStackMode;
 }
@@ -130,9 +130,6 @@ sal_Bool SAL_CALL NetChartTypeTemplate::
     {
         ::std::vector< Reference< chart2::XDataSeries > > aSeriesVec(
             DiagramHelper::getDataSeriesFromDiagram( xDiagram ));
-        chart2::SymbolStyle eStyle = m_bHasSymbols
-            ? chart2::SymbolStyle_STANDARD
-            : chart2::SymbolStyle_NONE;
 
         for( ::std::vector< Reference< chart2::XDataSeries > >::const_iterator aIt =
                  aSeriesVec.begin(); aIt != aSeriesVec.end(); ++aIt )
Index: chart2/source/model/template/PieChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/PieChartTypeTemplate.cxx,v
retrieving revision 1.10
retrieving revision 1.9.12.3
diff -u -u -p -r1.10 -r1.9.12.3
--- chart2/source/model/template/PieChartTypeTemplate.cxx	3 Jul 2007 13:43:43 -0000	1.10
+++ chart2/source/model/template/PieChartTypeTemplate.cxx	10 Jul 2007 13:39:35 -0000	1.9.12.3
@@ -41,7 +41,6 @@
 #include "CommonConverters.hxx"
 #include "DiagramHelper.hxx"
 #include "servicenames_charttypes.hxx"
-#include "Rotation.hxx"
 #include "DataSeriesHelper.hxx"
 #include "ContainerHelper.hxx"
 #include "BaseGFXHelper.hxx"
@@ -326,7 +325,7 @@ void PieChartTypeTemplate::adaptScales(
 void PieChartTypeTemplate::createChartTypes(
     const Sequence< Sequence< Reference< chart2::XDataSeries > > > & aSeriesSeq,
     const Sequence< Reference< chart2::XCoordinateSystem > > & rCoordSys,
-    const Sequence< Reference< chart2::XChartType > >& aOldChartTypesSeq )
+    const Sequence< Reference< chart2::XChartType > >& /* aOldChartTypesSeq */ )
 {
     if( rCoordSys.getLength() == 0 ||
         ! rCoordSys[0].is() )
Index: chart2/source/model/template/ScatterChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/ScatterChartTypeTemplate.cxx,v
retrieving revision 1.9
retrieving revision 1.9.8.1
diff -u -u -p -r1.9 -r1.9.8.1
--- chart2/source/model/template/ScatterChartTypeTemplate.cxx	11 Jun 2007 15:01:16 -0000	1.9
+++ chart2/source/model/template/ScatterChartTypeTemplate.cxx	27 Jun 2007 13:40:23 -0000	1.9.8.1
@@ -240,7 +240,7 @@ sal_Int32 ScatterChartTypeTemplate::getD
     return m_nDim;
 }
 
-StackMode ScatterChartTypeTemplate::getStackMode( sal_Int32 nChartTypeIndex ) const
+StackMode ScatterChartTypeTemplate::getStackMode( sal_Int32 /* nChartTypeIndex */ ) const
 {
     if( m_nDim == 3 )
         return StackMode_Z_STACKED;
Index: chart2/source/model/template/StockChartTypeTemplate.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/model/template/StockChartTypeTemplate.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.1
diff -u -u -p -r1.6 -r1.6.12.1
--- chart2/source/model/template/StockChartTypeTemplate.cxx	22 May 2007 18:52:27 -0000	1.6
+++ chart2/source/model/template/StockChartTypeTemplate.cxx	27 Jun 2007 13:40:23 -0000	1.6.12.1
@@ -343,7 +343,7 @@ void SAL_CALL StockChartTypeTemplate::re
 void StockChartTypeTemplate::createChartTypes(
     const Sequence< Sequence< Reference< XDataSeries > > > & aSeriesSeq,
     const Sequence< Reference< XCoordinateSystem > > & rCoordSys,
-    const Sequence< Reference< XChartType > >& aOldChartTypesSeq )
+    const Sequence< Reference< XChartType > >& /* aOldChartTypesSeq */ )
 {
     if( rCoordSys.getLength() < 1 )
         return;
@@ -431,7 +431,7 @@ void StockChartTypeTemplate::createChart
 // ____ XChartTypeTemplate ____
 sal_Bool SAL_CALL StockChartTypeTemplate::matchesTemplate(
     const uno::Reference< XDiagram >& xDiagram,
-    sal_Bool bAdaptProperties )
+    sal_Bool /* bAdaptProperties */ )
     throw (uno::RuntimeException)
 {
     sal_Bool bResult = sal_False;
cvs diff: Diffing chart2/source/tools
Index: chart2/source/tools/BaseGFXHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/BaseGFXHelper.cxx,v
retrieving revision 1.3
retrieving revision 1.3.4.1
diff -u -u -p -r1.3 -r1.3.4.1
--- chart2/source/tools/BaseGFXHelper.cxx	3 Jul 2007 13:43:56 -0000	1.3
+++ chart2/source/tools/BaseGFXHelper.cxx	10 Jul 2007 11:57:30 -0000	1.3.4.1
@@ -95,14 +95,16 @@ awt::Point B2IRectangleToAWTPoint( const
 
 awt::Size B2IRectangleToAWTSize( const ::basegfx::B2IRectangle& rB2IRectangle )
 {
-    return awt::Size( rB2IRectangle.getWidth(), rB2IRectangle.getHeight() );
+    return awt::Size( static_cast< sal_Int32 >( rB2IRectangle.getWidth()),
+                      static_cast< sal_Int32 >( rB2IRectangle.getHeight()));
 }
 
 awt::Rectangle B2IRectangleToAWTRectangle(
     const ::basegfx::B2IRectangle& rB2IRectangle )
 {
-    return awt::Rectangle( rB2IRectangle.getMinX(), rB2IRectangle.getMinY()
-        , rB2IRectangle.getWidth(), rB2IRectangle.getHeight() );
+    return awt::Rectangle( rB2IRectangle.getMinX(), rB2IRectangle.getMinY(),
+                           static_cast< sal_Int32 >( rB2IRectangle.getWidth()),
+                           static_cast< sal_Int32 >( rB2IRectangle.getHeight()));
 }
 
 B3DVector Direction3DToB3DVector( const Direction3D& rDirection )
Index: chart2/source/tools/CachedDataSequence.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/CachedDataSequence.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/tools/CachedDataSequence.cxx	22 May 2007 18:55:26 -0000	1.2
+++ chart2/source/tools/CachedDataSequence.cxx	10 Jul 2007 12:51:31 -0000	1.2.12.2
@@ -64,6 +64,8 @@ using ::osl::MutexGuard;
 
 // necessary for MS compiler
 using ::comphelper::OPropertyContainer;
+using ::comphelper::OMutexAndBroadcastHelper;
+using ::comphelper::OPropertyArrayUsageHelper;
 using ::chart::impl::CachedDataSequence_Base;
 
 namespace
@@ -142,7 +144,9 @@ CachedDataSequence::CachedDataSequence( 
 }
 
 CachedDataSequence::CachedDataSequence( const CachedDataSequence & rSource )
-        : OPropertyContainer( GetBroadcastHelper()),
+        : OMutexAndBroadcastHelper(),
+          OPropertyContainer( GetBroadcastHelper()),
+          OPropertyArrayUsageHelper< CachedDataSequence >(),
           CachedDataSequence_Base( GetMutex()),
           m_nNumberFormatKey( rSource.m_nNumberFormatKey ),
           m_sRole( rSource.m_sRole ),
@@ -448,14 +452,14 @@ OUString SAL_CALL CachedDataSequence::ge
     return m_sRole;
 }
 
-Sequence< OUString > SAL_CALL CachedDataSequence::generateLabel( chart2::data::LabelOrigin eLabelOrigin )
+Sequence< OUString > SAL_CALL CachedDataSequence::generateLabel( chart2::data::LabelOrigin  /*eLabelOrigin*/ )
     throw (uno::RuntimeException)
 {
     // return empty label, as we have no range representaions to determine something useful
     return Sequence< OUString >();
 }
 
-::sal_Int32 SAL_CALL CachedDataSequence::getNumberFormatKeyByIndex( ::sal_Int32 nIndex )
+::sal_Int32 SAL_CALL CachedDataSequence::getNumberFormatKeyByIndex( ::sal_Int32 /*nIndex*/ )
     throw (lang::IndexOutOfBoundsException,
            uno::RuntimeException)
 {
Index: chart2/source/tools/CharacterProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/CharacterProperties.cxx,v
retrieving revision 1.4
retrieving revision 1.4.12.1
diff -u -u -p -r1.4 -r1.4.12.1
--- chart2/source/tools/CharacterProperties.cxx	22 May 2007 18:55:38 -0000	1.4
+++ chart2/source/tools/CharacterProperties.cxx	6 Jul 2007 11:16:50 -0000	1.4.12.1
@@ -82,7 +82,8 @@ void CharacterProperties::AddPropertiesT
                   PROP_CHAR_FONT_STYLE_NAME,
                   ::getCppuType( reinterpret_cast< const  OUString * >(0)),
                   beans::PropertyAttribute::BOUND
-                  | beans::PropertyAttribute::MAYBEDEFAULT ));
+                  | beans::PropertyAttribute::MAYBEDEFAULT
+                  | beans::PropertyAttribute::MAYBEVOID ));
     // CharFontFamily (see awt.FontFamily)
     rOutProperties.push_back(
         Property( C2U( "CharFontFamily" ),
@@ -329,7 +330,8 @@ void CharacterProperties::AddPropertiesT
                   PROP_CHAR_ASIAN_FONT_STYLE_NAME,
                   ::getCppuType( reinterpret_cast< const OUString * >(0)),
                   beans::PropertyAttribute::BOUND
-                  | beans::PropertyAttribute::MAYBEDEFAULT ));
+                  | beans::PropertyAttribute::MAYBEDEFAULT
+                  | beans::PropertyAttribute::MAYBEVOID ));
     // CharFontFamilyAsian (see awt.FontFamily)
     rOutProperties.push_back(
         Property( C2U( "CharFontFamilyAsian" ),
@@ -395,7 +397,8 @@ void CharacterProperties::AddPropertiesT
                   PROP_CHAR_COMPLEX_FONT_STYLE_NAME,
                   ::getCppuType( reinterpret_cast< const OUString * >(0)),
                   beans::PropertyAttribute::BOUND
-                  | beans::PropertyAttribute::MAYBEDEFAULT ));
+                  | beans::PropertyAttribute::MAYBEDEFAULT
+                  | beans::PropertyAttribute::MAYBEVOID ));
     // CharFontFamilyComplex (see awt.FontFamily)
     rOutProperties.push_back(
         Property( C2U( "CharFontFamilyComplex" ),
@@ -458,8 +461,6 @@ void CharacterProperties::AddDefaultsToM
     //todo correct font default:
     //see static Font OutputDevice::GetDefaultFont( USHORT nType, LanguageType eLang, ULONG nFlags, const OutputDevice* pOutDev = NULL );
     //or  SvxFontItem ... (old chart source/core/chtmodel.cxx :Font aCJKFont )
-    OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CHAR_FONT_STYLE_NAME ));
-    rOutMap[ PROP_CHAR_FONT_STYLE_NAME ] = uno::Any();
     OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CHAR_FONT_FAMILY ));
     rOutMap[ PROP_CHAR_FONT_FAMILY ] =
         uno::makeAny( awt::FontFamily::SWISS );
@@ -580,8 +581,6 @@ void CharacterProperties::AddDefaultsToM
     //todo correct font default:
     //see static Font OutputDevice::GetDefaultFont( USHORT nType, LanguageType eLang, ULONG nFlags, const OutputDevice* pOutDev = NULL );
     //or  SvxFontItem ... (old chart source/core/chtmodel.cxx :Font aCJKFont )
-    OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CHAR_ASIAN_FONT_STYLE_NAME ));
-    rOutMap[ PROP_CHAR_ASIAN_FONT_STYLE_NAME ] = uno::Any();
     OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CHAR_ASIAN_FONT_FAMILY ));
     rOutMap[ PROP_CHAR_ASIAN_FONT_FAMILY ] =
         uno::makeAny( awt::FontFamily::SWISS );//todo correct default
@@ -611,8 +610,6 @@ void CharacterProperties::AddDefaultsToM
     //todo correct font default:
     //see static Font OutputDevice::GetDefaultFont( USHORT nType, LanguageType eLang, ULONG nFlags, const OutputDevice* pOutDev = NULL );
     //or  SvxFontItem ... (old chart source/core/chtmodel.cxx :Font aCJKFont )
-    OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CHAR_COMPLEX_FONT_STYLE_NAME ));
-    rOutMap[ PROP_CHAR_COMPLEX_FONT_STYLE_NAME ] = uno::Any();
     OSL_ASSERT( rOutMap.end() == rOutMap.find( PROP_CHAR_COMPLEX_FONT_FAMILY ));
     rOutMap[ PROP_CHAR_COMPLEX_FONT_FAMILY ] =
         uno::makeAny( awt::FontFamily::SWISS );//todo correct default
Index: chart2/source/tools/ChartDebugTrace.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ChartDebugTrace.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/ChartDebugTrace.cxx	22 May 2007 18:55:48 -0000	1.2
+++ chart2/source/tools/ChartDebugTrace.cxx	10 Jul 2007 11:57:30 -0000	1.2.12.1
@@ -344,8 +344,8 @@ namespace debug
 {
 
 void ChartDebugTraceDocument(
-    const Reference< XChartDocument > & xDoc,
-    int nIndent )
+    const Reference< XChartDocument > & /*xDoc*/,
+    int /*nIndent*/ )
 {
     /*
 #if OSL_DEBUG_LEVEL >= CHART_TRACE_OSL_DEBUG_LEVEL
@@ -379,8 +379,8 @@ void ChartDebugTraceDocument(
 }
 
 void ChartDebugTraceDiagram(
-    const Reference< XDiagram > & xDiagram,
-    int nIndent )
+    const Reference< XDiagram > & /*xDiagram*/,
+    int /*nIndent*/ )
 {
     /*
 #if OSL_DEBUG_LEVEL >= CHART_TRACE_OSL_DEBUG_LEVEL
Index: chart2/source/tools/ChartTypeHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ChartTypeHelper.cxx,v
retrieving revision 1.13
retrieving revision 1.13.4.1
diff -u -u -p -r1.13 -r1.13.4.1
--- chart2/source/tools/ChartTypeHelper.cxx	3 Jul 2007 13:44:14 -0000	1.13
+++ chart2/source/tools/ChartTypeHelper.cxx	10 Jul 2007 11:57:30 -0000	1.13.4.1
@@ -167,7 +167,7 @@ sal_Bool ChartTypeHelper::isSupportingMa
 	return sal_True;
 }
 
-sal_Bool ChartTypeHelper::isSupportingSecondaryAxis( const uno::Reference< XChartType >& xChartType, sal_Int32 nDimensionCount, sal_Int32 nDimensionIndex )
+sal_Bool ChartTypeHelper::isSupportingSecondaryAxis( const uno::Reference< XChartType >& xChartType, sal_Int32 nDimensionCount, sal_Int32 /*nDimensionIndex*/ )
 {
 	//3D, pie and net charts do not support a secondary axis at all
 
Index: chart2/source/tools/CommonConverters.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/CommonConverters.cxx,v
retrieving revision 1.10
retrieving revision 1.10.12.1
diff -u -u -p -r1.10 -r1.10.12.1
--- chart2/source/tools/CommonConverters.cxx	22 May 2007 18:56:47 -0000	1.10
+++ chart2/source/tools/CommonConverters.cxx	10 Jul 2007 11:57:30 -0000	1.10.12.1
@@ -444,7 +444,7 @@ drawing::PolyPolygonShape3D BezierToPoly
     const drawing::PolyPolygonBezierCoords& rBezier )
 {
     const drawing::PointSequenceSequence& rPointSequence = rBezier.Coordinates;
-    const drawing::FlagSequenceSequence& rFlags = rBezier.Flags;
+//     const drawing::FlagSequenceSequence& rFlags = rBezier.Flags;
 
     drawing::PolyPolygonShape3D aRet;
     aRet.SequenceX.realloc( rPointSequence.getLength() );
Index: chart2/source/tools/DataSeriesHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/DataSeriesHelper.cxx,v
retrieving revision 1.5
retrieving revision 1.5.8.1
diff -u -u -p -r1.5 -r1.5.8.1
--- chart2/source/tools/DataSeriesHelper.cxx	11 Jun 2007 15:01:54 -0000	1.5
+++ chart2/source/tools/DataSeriesHelper.cxx	10 Jul 2007 14:40:44 -0000	1.5.8.1
@@ -407,6 +407,7 @@ StackMode getStackModeFromSeries(
             // property is not MAYBEVOID
             bool bSuccess = ( xProp->getPropertyValue( C2U("StackingDirection") ) >>= eCurrentDirection );
             OSL_ASSERT( bSuccess );
+            (void)(bSuccess);  // avoid warning in non-debug builds
             if( ! bDirectionInitialized )
             {
                 eCommonDirection = eCurrentDirection;
Index: chart2/source/tools/DataSource.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/DataSource.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/DataSource.cxx	22 May 2007 18:57:52 -0000	1.2
+++ chart2/source/tools/DataSource.cxx	10 Jul 2007 11:57:30 -0000	1.2.12.1
@@ -58,7 +58,7 @@ namespace chart
 {
 
 DataSource::DataSource(
-    const Reference< uno::XComponentContext > & xContext )
+    const Reference< uno::XComponentContext > & /*xContext*/ )
 {}
 
 DataSource::DataSource(
Index: chart2/source/tools/DataSourceHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/DataSourceHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/DataSourceHelper.cxx	22 May 2007 18:58:02 -0000	1.2
+++ chart2/source/tools/DataSourceHelper.cxx	10 Jul 2007 12:56:07 -0000	1.2.12.1
@@ -338,6 +338,7 @@ bool DataSourceHelper::detectRangeSegmen
         return bSomethingDetected;
 
     OSL_ASSERT( !bIncludeUnusedData ); //bIncludeUnusedData is not supported currently
+    (void)(bIncludeUnusedData); // avoid warning in non-debug build
 
     try
     {
Index: chart2/source/tools/DiagramHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/DiagramHelper.cxx,v
retrieving revision 1.10
retrieving revision 1.10.4.2
diff -u -u -p -r1.10 -r1.10.4.2
--- chart2/source/tools/DiagramHelper.cxx	3 Jul 2007 13:44:26 -0000	1.10
+++ chart2/source/tools/DiagramHelper.cxx	10 Jul 2007 13:01:44 -0000	1.10.4.2
@@ -188,7 +188,7 @@ void DiagramHelper::setVertical(
                 bool bChanged = false;
                 if( xProp.is() )
                 {
-                    sal_Bool bOldSwap = sal_False;
+                    bool bOldSwap = sal_False;
                     if( !(xProp->getPropertyValue( C2U("SwapXAndYAxis") ) >>= bOldSwap)
                         || bVertical != bOldSwap )
                         bChanged = true;
@@ -901,10 +901,13 @@ void DiagramHelper::setCategoriesToDiagr
         {
             ScaleData aScaleData( xCatAxis->getScaleData());
             aScaleData.Categories = xCategories;
-            if( bCategoryAxis )
-                aScaleData.AxisType = AxisType::CATEGORY;
-            else if( aScaleData.AxisType == AxisType::CATEGORY )
-                aScaleData.AxisType = AxisType::REALNUMBER;
+            if( bSetAxisType )
+            {
+                if( bCategoryAxis )
+                    aScaleData.AxisType = AxisType::CATEGORY;
+                else if( aScaleData.AxisType == AxisType::CATEGORY )
+                    aScaleData.AxisType = AxisType::REALNUMBER;
+            }
             xCatAxis->setScaleData( aScaleData );
         }
     }
@@ -1175,8 +1178,6 @@ bool lcl_moveSeriesOrCheckIfMoveIsAllowe
                         // We found the series we are interrested in !
                         if( xGivenDataSeries==aSeriesList[nS] )
                         {
-                            sal_Int32 nOldCooSysIndex = nCS;
-                            sal_Int32 nOldChartTypeIndex = nT;
                             sal_Int32 nOldSeriesIndex = nS;
                             bFound = true;
 
Index: chart2/source/tools/ErrorBar.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ErrorBar.cxx,v
retrieving revision 1.6
retrieving revision 1.6.12.2
diff -u -u -p -r1.6 -r1.6.12.2
--- chart2/source/tools/ErrorBar.cxx	22 May 2007 18:58:26 -0000	1.6
+++ chart2/source/tools/ErrorBar.cxx	10 Jul 2007 12:56:19 -0000	1.6.12.2
@@ -192,6 +192,8 @@ ErrorBar::ErrorBar(
 {}
 
 ErrorBar::ErrorBar( const ErrorBar & rOther ) :
+        MutexContainer(),
+        impl::ErrorBar_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xContext( rOther.m_xContext ),
     m_xModifyEventForwarder( new ModifyListenerHelper::ModifyEventForwarder( m_aMutex ))
@@ -295,7 +297,7 @@ void SAL_CALL ErrorBar::modified( const 
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL ErrorBar::disposing( const lang::EventObject& Source )
+void SAL_CALL ErrorBar::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/tools/FillProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/FillProperties.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/tools/FillProperties.cxx	22 May 2007 18:58:47 -0000	1.5
+++ chart2/source/tools/FillProperties.cxx	9 Jul 2007 07:27:22 -0000	1.5.12.1
@@ -90,6 +90,7 @@ void lcl_AddPropertiesToVector_without_B
                   FillProperties::PROP_FILL_TRANSPARENCE_GRADIENT_NAME,
                   ::getCppuType( reinterpret_cast< const ::rtl::OUString * >(0)),
                   beans::PropertyAttribute::BOUND
+                  | beans::PropertyAttribute::MAYBEVOID
                   | beans::PropertyAttribute::MAYBEDEFAULT ));
 
     //optional
@@ -106,6 +107,7 @@ void lcl_AddPropertiesToVector_without_B
                   FillProperties::PROP_FILL_GRADIENT_NAME,
                   ::getCppuType( reinterpret_cast< const ::rtl::OUString * >(0)),
                   beans::PropertyAttribute::BOUND
+                  | beans::PropertyAttribute::MAYBEVOID
                   | beans::PropertyAttribute::MAYBEDEFAULT ));
 
     rOutProperties.push_back(
@@ -129,6 +131,7 @@ void lcl_AddPropertiesToVector_without_B
                   FillProperties::PROP_FILL_HATCH_NAME,
                   ::getCppuType( reinterpret_cast< const ::rtl::OUString * >(0)),
                   beans::PropertyAttribute::BOUND
+                  | beans::PropertyAttribute::MAYBEVOID
                   | beans::PropertyAttribute::MAYBEDEFAULT ));
 
     //optional
@@ -158,6 +161,7 @@ void lcl_AddPropertiesToVector_only_Bitm
                   FillProperties::PROP_FILL_BITMAP_NAME,
                   ::getCppuType( reinterpret_cast< const ::rtl::OUString * >(0)),
                   beans::PropertyAttribute::BOUND
+                  | beans::PropertyAttribute::MAYBEVOID
                   | beans::PropertyAttribute::MAYBEDEFAULT ));
 
     //optional
Index: chart2/source/tools/ImplUndoManager.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ImplUndoManager.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.3
diff -u -u -p -r1.2 -r1.2.12.3
--- chart2/source/tools/ImplUndoManager.cxx	22 May 2007 18:59:30 -0000	1.2
+++ chart2/source/tools/ImplUndoManager.cxx	12 Jul 2007 09:09:20 -0000	1.2.12.3
@@ -65,6 +65,29 @@ namespace chart
 namespace impl
 {
 
+void ImplApplyDataToModel(
+    Reference< frame::XModel > & xInOutModelToChange,
+    const Reference< chart2::XInternalDataProvider > & xData )
+{
+    Reference< chart2::XChartDocument > xDoc( xInOutModelToChange, uno::UNO_QUERY );
+    OSL_ASSERT( xDoc.is() && xDoc->hasInternalDataProvider());
+
+    // copy data from stored internal data provider
+    if( xDoc.is() && xDoc->hasInternalDataProvider())
+    {
+        Reference< XChartDataArray > xCurrentData( xDoc->getDataProvider(), uno::UNO_QUERY );
+        Reference< XChartDataArray > xSavedData( xData, uno::UNO_QUERY );
+        if( xCurrentData.is() && xSavedData.is())
+        {
+            xCurrentData->setData( xSavedData->getData());
+            xCurrentData->setRowDescriptions( xSavedData->getRowDescriptions());
+            xCurrentData->setColumnDescriptions( xSavedData->getColumnDescriptions());
+        }
+    }
+}
+
+// ----------------------------------------
+
 UndoElement::UndoElement(
     const OUString & rActionString,
     const Reference< frame::XModel > & xModel ) :
@@ -90,10 +113,7 @@ UndoElement::~UndoElement()
 
 void UndoElement::initialize( const Reference< frame::XModel > & xModel )
 {
-    uno::Reference< util::XCloneable > xCloneable( xModel, uno::UNO_QUERY );
-    OSL_ENSURE( xCloneable.is(), "Cannot clone model" );
-    if( xCloneable.is())
-        m_xModel.set( xCloneable->createClone(), uno::UNO_QUERY );
+    m_xModel.set( UndoElement::cloneModel( xModel ));
 }
 
 void UndoElement::dispose()
@@ -105,15 +125,53 @@ void UndoElement::dispose()
 }
 
 void UndoElement::applyToModel(
-    const Reference< frame::XModel > & xInOutModelToChange )
+    Reference< frame::XModel > & xInOutModelToChange )
+{
+    UndoElement::applyModelContentToModel( xInOutModelToChange, m_xModel );
+}
+
+UndoElement * UndoElement::createFromModel(
+    const Reference< frame::XModel > & xModel )
+{
+    return new UndoElement( getActionString(), xModel );
+}
+
+void UndoElement::setActionString( const ::rtl::OUString & rActionString )
+{
+    m_aActionString = rActionString;
+}
+
+OUString UndoElement::getActionString() const
+{
+    return m_aActionString;
+}
+
+// static
+Reference< frame::XModel > UndoElement::cloneModel( const Reference< frame::XModel > & xModel )
 {
-    if( m_xModel.is() && xInOutModelToChange.is())
+    Reference< frame::XModel > xResult;
+    uno::Reference< util::XCloneable > xCloneable( xModel, uno::UNO_QUERY );
+    OSL_ENSURE( xCloneable.is(), "Cannot clone model" );
+    if( xCloneable.is())
+        xResult.set( xCloneable->createClone(), uno::UNO_QUERY );
+
+    return xResult;
+}
+
+// static
+void UndoElement::applyModelContentToModel(
+    Reference< frame::XModel > & xInOutModelToChange,
+    const Reference< frame::XModel > & xModelToCopyFrom,
+    const Reference< chart2::XInternalDataProvider > & xData /* = 0 */ )
+{
+
+    if( xModelToCopyFrom.is() && xInOutModelToChange.is())
     {
         try
         {
             // /-- loccked controllers of destination
             ControllerLockGuard aLockedControllers( xInOutModelToChange );
-            Reference< chart2::XChartDocument > xSource( m_xModel, uno::UNO_QUERY_THROW );
+            Reference< chart2::XChartDocument > xSource( xModelToCopyFrom, uno::UNO_QUERY_THROW );
             Reference< chart2::XChartDocument > xDestination( xInOutModelToChange, uno::UNO_QUERY_THROW );
 
             // diagram
@@ -130,17 +188,18 @@ void UndoElement::applyToModel(
                 xDestination->getPageBackground() );
 
             // apply data (not applied in standard Undo)
-            applyDataToModel( xInOutModelToChange );
+            if( xData.is())
+                ImplApplyDataToModel( xInOutModelToChange, xData );
 
             // register all sequences at the internal data provider to get adapted
             // indexes when columns are added/removed
             if( xDestination->hasInternalDataProvider())
             {
                 Reference< chart2::XInternalDataProvider > xNewDataProvider( xDestination->getDataProvider(), uno::UNO_QUERY );
-                Reference< chart2::data::XDataSource > xData( DataSourceHelper::getUsedData( xInOutModelToChange ));
-                if( xData.is() && xNewDataProvider.is())
+                Reference< chart2::data::XDataSource > xUsedData( DataSourceHelper::getUsedData( xInOutModelToChange ));
+                if( xUsedData.is() && xNewDataProvider.is())
                 {
-                    Sequence< Reference< chart2::data::XLabeledDataSequence > > aData( xData->getDataSequences());
+                    Sequence< Reference< chart2::data::XLabeledDataSequence > > aData( xUsedData->getDataSequences());
                     for( sal_Int32 i=0; i<aData.getLength(); ++i )
                     {
                         xNewDataProvider->registerDataSequenceForChanges( aData[i]->getValues());
@@ -165,28 +224,6 @@ void UndoElement::applyToModel(
     }
 }
 
-void UndoElement::applyDataToModel(
-    const Reference< frame::XModel > & )
-{
-    // do nothing (this is overwritten by UndoElementWithData)
-}
-
-UndoElement * UndoElement::createFromModel(
-    const Reference< frame::XModel > & xModel )
-{
-    return new UndoElement( getActionString(), xModel );
-}
-
-void UndoElement::setActionString( const ::rtl::OUString & rActionString )
-{
-    m_aActionString = rActionString;
-}
-
-OUString UndoElement::getActionString() const
-{
-    return m_aActionString;
-}
-
 // ----------------------------------------
 
 UndoElementWithData::UndoElementWithData(
@@ -194,14 +231,14 @@ UndoElementWithData::UndoElementWithData
     const Reference< frame::XModel > & xModel ) :
         UndoElement( rActionString, xModel )
 {
-    initialize();
+    initializeData();
 }
 
 UndoElementWithData::UndoElementWithData(
     const Reference< frame::XModel > & xModel ) :
         UndoElement( xModel )
 {
-    initialize();
+    initializeData();
 }
 
 
@@ -209,13 +246,13 @@ UndoElementWithData::UndoElementWithData
     const UndoElementWithData & rOther ) :
         UndoElement( rOther )
 {
-    initialize();
+    initializeData();
 }
 
 UndoElementWithData::~UndoElementWithData()
 {}
 
-void UndoElementWithData::initialize()
+void UndoElementWithData::initializeData()
 {
     try
     {
@@ -240,24 +277,10 @@ void UndoElementWithData::dispose()
     m_xData.set( 0 );
 }
 
-void UndoElementWithData::applyDataToModel(
-    const Reference< frame::XModel > & xInOutModelToChange )
+void UndoElementWithData::applyToModel(
+    Reference< frame::XModel > & xInOutModelToChange )
 {
-    Reference< chart2::XChartDocument > xDoc( xInOutModelToChange, uno::UNO_QUERY );
-    OSL_ASSERT( xDoc.is() && xDoc->hasInternalDataProvider());
-
-    // copy data from stored internal data provider
-    if( xDoc.is() && xDoc->hasInternalDataProvider())
-    {
-        Reference< XChartDataArray > xCurrentData( xDoc->getDataProvider(), uno::UNO_QUERY );
-        Reference< XChartDataArray > xSavedData( m_xData, uno::UNO_QUERY );
-        if( xCurrentData.is() && xSavedData.is())
-        {
-            xCurrentData->setData( xSavedData->getData());
-            xCurrentData->setRowDescriptions( xSavedData->getRowDescriptions());
-            xCurrentData->setColumnDescriptions( xSavedData->getColumnDescriptions());
-        }
-    }
+    UndoElement::applyModelContentToModel( xInOutModelToChange, m_xModel, m_xData );
 }
 
 UndoElement * UndoElementWithData::createFromModel(
Index: chart2/source/tools/ImplUndoManager.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ImplUndoManager.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/tools/ImplUndoManager.hxx	22 May 2007 18:59:40 -0000	1.2
+++ chart2/source/tools/ImplUndoManager.hxx	12 Jul 2007 09:09:37 -0000	1.2.12.2
@@ -74,18 +74,22 @@ public:
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
 
-    void applyToModel(
-        const ::com::sun::star::uno::Reference<
+    virtual void applyToModel(
+        ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xInOutModelToChange );
 
     void setActionString( const ::rtl::OUString & rActionString );
     ::rtl::OUString getActionString() const;
 
-protected:
-    virtual void applyDataToModel(
-        const ::com::sun::star::uno::Reference<
-            ::com::sun::star::frame::XModel > & xInOutModelToChange );
+    static ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel > cloneModel(
+        const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel > & xModel );
 
+    static void applyModelContentToModel(
+        ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel > & xInOutModelToChange,
+        const ::com::sun::star::uno::Reference< ::com::sun::star::frame::XModel > & xModelToCopyFrom,
+        const ::com::sun::star::uno::Reference< ::com::sun::star::chart2::XInternalDataProvider > & xData = 0 );
+
+protected:
     ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > m_xModel;
 
@@ -112,13 +116,12 @@ public:
         const ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xModel );
 
-protected:
-        virtual void applyDataToModel(
-        const ::com::sun::star::uno::Reference<
+    virtual void applyToModel(
+        ::com::sun::star::uno::Reference<
             ::com::sun::star::frame::XModel > & xInOutModelToChange );
 
 private:
-    void initialize();
+    void initializeData();
 
     ::com::sun::star::uno::Reference<
             ::com::sun::star::chart2::XInternalDataProvider > m_xData;
Index: chart2/source/tools/InternalDataProvider.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/InternalDataProvider.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.5
diff -u -u -p -r1.2 -r1.2.12.5
--- chart2/source/tools/InternalDataProvider.cxx	22 May 2007 18:59:49 -0000	1.2
+++ chart2/source/tools/InternalDataProvider.cxx	12 Jul 2007 12:50:50 -0000	1.2.12.5
@@ -322,12 +322,14 @@ Sequence< Sequence< double > > InternalD
     if( bDataInColumns )
     {
         for( sal_Int32 i=0; i<m_nColumnCount; ++i )
-            aResult[i] = lcl_ValarrayToSequence( m_aData[ ::std::slice( i, m_nRowCount, m_nColumnCount ) ] );
+            aResult[i] = lcl_ValarrayToSequence< tDataType::value_type >(
+                m_aData[ ::std::slice( i, m_nRowCount, m_nColumnCount ) ] );
     }
     else
     {
         for( sal_Int32 i=0; i<m_nRowCount; ++i )
-            aResult[i] = lcl_ValarrayToSequence( m_aData[ ::std::slice( i*m_nColumnCount, m_nColumnCount, 1 ) ] );
+            aResult[i] = lcl_ValarrayToSequence< tDataType::value_type >(
+                m_aData[ ::std::slice( i*m_nColumnCount, m_nColumnCount, 1 ) ] );
     }
 
     return aResult;
@@ -340,12 +342,14 @@ Sequence< double > InternalData::getData
     if( bDataInColumns )
     {
         if( nIndex < m_nColumnCount )
-            return lcl_ValarrayToSequence( m_aData[ ::std::slice( nIndex, m_nRowCount, m_nColumnCount ) ] );
+            return lcl_ValarrayToSequence< tDataType::value_type >(
+                m_aData[ ::std::slice( nIndex, m_nRowCount, m_nColumnCount ) ] );
     }
     else
     {
         if( nIndex < m_nRowCount )
-            return lcl_ValarrayToSequence( m_aData[ ::std::slice( nIndex*m_nColumnCount, m_nColumnCount, 1 ) ] );
+            return lcl_ValarrayToSequence< tDataType::value_type >(
+                m_aData[ ::std::slice( nIndex*m_nColumnCount, m_nColumnCount, 1 ) ] );
     }
 
     return Sequence< double >();
@@ -732,7 +736,7 @@ struct lcl_DataProviderRangeCreator : pu
             {
                 // data provider cannot create single data sequences, but then
                 // detectArguments should work also with an empty data source
-                (void*)(&ex);
+                (void)(ex);
             }
             catch( const uno::Exception & ex )
             {
@@ -898,6 +902,7 @@ InternalDataProvider::InternalDataProvid
 
 // copy-CTOR
 InternalDataProvider::InternalDataProvider( const InternalDataProvider & rOther ) :
+        impl::InternalDataProvider_Base(),
         m_aSequenceMap( rOther.m_aSequenceMap ),
         m_apData( new impl::InternalData( rOther.getInternalData())),
         m_bDataInColumns( rOther.m_bDataInColumns )
@@ -939,7 +944,7 @@ void InternalDataProvider::adaptMapRefer
     const OUString & rNewRangeRepresentation )
 {
     tSequenceMapRange aRange( m_aSequenceMap.equal_range( rOldRangeRepresentation ));
-    ::std::vector< tSequenceMap::value_type > aNewElements;
+    tSequenceMap aNewElements;
     for( tSequenceMap::iterator aIt( aRange.first ); aIt != aRange.second; ++aIt )
     {
         Reference< chart2::data::XDataSequence > xSeq( aIt->second );
@@ -949,7 +954,7 @@ void InternalDataProvider::adaptMapRefer
             if( xNamed.is())
                 xNamed->setName( rNewRangeRepresentation );
         }
-        aNewElements.push_back( tSequenceMap::value_type( rNewRangeRepresentation, aIt->second ));
+        aNewElements.insert( tSequenceMap::value_type( rNewRangeRepresentation, aIt->second ));
     }
     // erase map values for old index
     m_aSequenceMap.erase( aRange.first, aRange.second );
@@ -1026,6 +1031,12 @@ void InternalDataProvider::createDefault
 }
 
 // ____ XDataProvider ____
+::sal_Bool SAL_CALL InternalDataProvider::createDataSourcePossible( const Sequence< beans::PropertyValue >& /* aArguments */ )
+    throw (uno::RuntimeException)
+{
+    return true;
+}
+
 Reference< chart2::data::XDataSource > SAL_CALL InternalDataProvider::createDataSource(
     const Sequence< beans::PropertyValue >& aArguments )
     throw (lang::IllegalArgumentException,
@@ -1183,28 +1194,33 @@ Sequence< beans::PropertyValue > SAL_CAL
     return aArguments;
 }
 
+::sal_Bool SAL_CALL InternalDataProvider::createDataSequenceByRangeRepresentationPossible( const OUString& /* aRangeRepresentation */ )
+    throw (uno::RuntimeException)
+{
+    return true;
+}
+
 Reference< chart2::data::XDataSequence > SAL_CALL InternalDataProvider::createDataSequenceByRangeRepresentation(
     const OUString& aRangeRepresentation )
     throw (lang::IllegalArgumentException,
            uno::RuntimeException)
 {
     if( aRangeRepresentation.equals( lcl_aCategoriesRangeName ))
+    {
         // categories
         return createDataSequenceAndAddToMap( lcl_aCategoriesRangeName, lcl_aCategoriesRoleName );
+    }
     else if( aRangeRepresentation.match( lcl_aLabelRangePrefix ))
     {
         // label
         sal_Int32 nIndex = aRangeRepresentation.copy( lcl_aLabelRangePrefix.getLength()).toInt32();
         return createDataSequenceAndAddToMap( lcl_aLabelRangePrefix + OUString::valueOf( nIndex ));
     }
-    else
-    {
-        // data
-        sal_Int32 nIndex = aRangeRepresentation.toInt32();
-        return createDataSequenceAndAddToMap( OUString::valueOf( nIndex ));
-    }
+    // else
 
-    return Reference< chart2::data::XDataSequence >();
+    // data
+    sal_Int32 nIndex = aRangeRepresentation.toInt32();
+    return createDataSequenceAndAddToMap( OUString::valueOf( nIndex ));
 }
 
 Reference< sheet::XRangeSelection > SAL_CALL InternalDataProvider::getRangeSelection()
Index: chart2/source/tools/LifeTime.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/LifeTime.cxx,v
retrieving revision 1.4
retrieving revision 1.4.12.1
diff -u -u -p -r1.4 -r1.4.12.1
--- chart2/source/tools/LifeTime.cxx	22 May 2007 19:00:40 -0000	1.4
+++ chart2/source/tools/LifeTime.cxx	9 Jul 2007 14:22:50 -0000	1.4.12.1
@@ -41,11 +41,9 @@
 #ifndef _OSL_DIAGNOSE_H_
 #include <osl/diagnose.h>
 #endif
-/*
-#ifndef _COM_SUN_STAR_LANG_XEVENTLISTENER_HPP_
-#include <com/sun/star/lang/XEventListener.hpp>
-#endif
-*/
+
+#include <com/sun/star/util/XModifyListener.hpp>
+#include <com/sun/star/util/XCloseListener.hpp>
 
 using namespace ::com::sun::star;
 
@@ -158,13 +156,9 @@ LifeTimeManager::~LifeTimeManager()
 			uno::Reference< lang::XComponent >(m_pComponent);;
 		if(xComponent.is())
 		{
-			::cppu::OInterfaceContainerHelper* pIC = m_aListenerContainer.getContainer(
-						::getCppuType((const uno::Reference< lang::XEventListener >*)0) );
-			if( pIC )
-			{
-				lang::EventObject aEvent( xComponent );
-				pIC->disposeAndClear( aEvent );
-			}
+            // notify XCLoseListeners
+            lang::EventObject aEvent( xComponent );
+            m_aListenerContainer.disposeAndClear( aEvent );
 		}
 	}
 
@@ -271,13 +265,14 @@ CloseableLifeTimeManager::~CloseableLife
 	{
 		//no mutex is acquired
 		g_close_endTryClose(bDeliverOwnership, sal_False);
+        (void)(ex);
         throw;
 	}
 	return sal_True;
 }
 
 	void CloseableLifeTimeManager
-::g_close_endTryClose(sal_Bool bDeliverOwnership, sal_Bool bMyVeto)
+::g_close_endTryClose(sal_Bool bDeliverOwnership, sal_Bool /* bMyVeto */ )
 {
 	//this method is called, if the try to close was not successfull
 	osl::Guard< osl::Mutex > aGuard( m_aAccessMutex );
Index: chart2/source/tools/MeanValueRegressionCurveCalculator.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/MeanValueRegressionCurveCalculator.cxx,v
retrieving revision 1.4
retrieving revision 1.4.58.1
diff -u -u -p -r1.4 -r1.4.58.1
--- chart2/source/tools/MeanValueRegressionCurveCalculator.cxx	17 Sep 2006 13:26:17 -0000	1.4
+++ chart2/source/tools/MeanValueRegressionCurveCalculator.cxx	10 Jul 2007 11:57:30 -0000	1.4.58.1
@@ -67,7 +67,7 @@ MeanValueRegressionCurveCalculator::~Mea
 
 // ____ XRegressionCurveCalculator ____
 void SAL_CALL MeanValueRegressionCurveCalculator::recalculateRegression(
-    const uno::Sequence< double >& aXValues,
+    const uno::Sequence< double >& /*aXValues*/,
     const uno::Sequence< double >& aYValues )
     throw (uno::RuntimeException)
 {
@@ -93,7 +93,7 @@ void SAL_CALL MeanValueRegressionCurveCa
 //     m_fCorrelationCoeffitient = ?;
 }
 
-double SAL_CALL MeanValueRegressionCurveCalculator::getCurveValue( double x )
+double SAL_CALL MeanValueRegressionCurveCalculator::getCurveValue( double /*x*/ )
     throw (lang::IllegalArgumentException,
            uno::RuntimeException)
 {
Index: chart2/source/tools/ModifyListenerCallBack.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ModifyListenerCallBack.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/ModifyListenerCallBack.cxx	22 May 2007 19:01:37 -0000	1.2
+++ chart2/source/tools/ModifyListenerCallBack.cxx	10 Jul 2007 11:57:30 -0000	1.2.12.1
@@ -87,13 +87,13 @@ ModifyListenerCallBack_impl::~ModifyList
 }
 
 //XModifyListener
-void SAL_CALL ModifyListenerCallBack_impl::modified( const lang::EventObject& aEvent ) throw (uno::RuntimeException)
+void SAL_CALL ModifyListenerCallBack_impl::modified( const lang::EventObject& /*aEvent*/ ) throw (uno::RuntimeException)
 {
     m_aLink.Call(0);
 }
 
 //XEventListener
-void SAL_CALL ModifyListenerCallBack_impl::disposing( const lang::EventObject& Source ) throw (uno::RuntimeException)
+void SAL_CALL ModifyListenerCallBack_impl::disposing( const lang::EventObject& /*Source*/ ) throw (uno::RuntimeException)
 {
     m_xBroadcaster.clear();
 }
Index: chart2/source/tools/ModifyListenerHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ModifyListenerHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/ModifyListenerHelper.cxx	22 May 2007 19:01:48 -0000	1.2
+++ chart2/source/tools/ModifyListenerHelper.cxx	26 Jun 2007 11:28:31 -0000	1.2.12.1
@@ -205,7 +205,7 @@ void SAL_CALL ModifyEventForwarder::modi
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL ModifyEventForwarder::disposing( const lang::EventObject& Source )
+void SAL_CALL ModifyEventForwarder::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
@@ -255,7 +255,7 @@ bool ModifyListenerOnDemmandRefresh::nee
 
 // ____ XModifyListener ____
 void SAL_CALL ModifyListenerOnDemmandRefresh::modified(
-    const lang::EventObject& aEvent )
+    const lang::EventObject& /* aEvent */ )
     throw (uno::RuntimeException)
 {
     m_bNeedsUpdate = true;
@@ -263,7 +263,7 @@ void SAL_CALL ModifyListenerOnDemmandRef
 
 // ____ XEventListener (base of XModifyListener) ____
 void SAL_CALL ModifyListenerOnDemmandRefresh::disposing(
-    const lang::EventObject& Source )
+    const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     m_bNeedsUpdate = true;
Index: chart2/source/tools/NameContainer.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/NameContainer.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/NameContainer.cxx	22 May 2007 19:02:13 -0000	1.2
+++ chart2/source/tools/NameContainer.cxx	10 Jul 2007 14:42:03 -0000	1.2.12.1
@@ -70,7 +70,8 @@ NameContainer::NameContainer( const ::co
 
 NameContainer::NameContainer(
     const NameContainer & rOther )
-    : m_aType( rOther.m_aType )
+    : impl::NameContainer_Base()
+    , m_aType( rOther.m_aType )
     , m_aServicename( rOther.m_aServicename )
     , m_aImplementationName( rOther.m_aImplementationName )
     , m_aMap( rOther.m_aMap )
Index: chart2/source/tools/OIndexContainer.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/OIndexContainer.cxx,v
retrieving revision 1.3
retrieving revision 1.3.58.1
diff -u -u -p -r1.3 -r1.3.58.1
--- chart2/source/tools/OIndexContainer.cxx	17 Sep 2006 13:27:38 -0000	1.3
+++ chart2/source/tools/OIndexContainer.cxx	10 Jul 2007 11:57:30 -0000	1.3.58.1
@@ -86,7 +86,7 @@ void SAL_CALL OIndexContainer::insertByI
     // /--
     MutexGuard aGuard( GetMutex());
 
-    if( nIndex < 0 ||
+    if( Index < 0 ||
         nIndex > m_aContainer.size() )
         throw lang::IndexOutOfBoundsException();
 
@@ -113,7 +113,7 @@ void SAL_CALL OIndexContainer::removeByI
     // /--
     MutexGuard aGuard( GetMutex());
 
-    if( nIndex < 0 ||
+    if( Index < 0 ||
         nIndex > m_aContainer.size() )
         throw lang::IndexOutOfBoundsException();
 
@@ -135,7 +135,7 @@ void SAL_CALL OIndexContainer::replaceBy
     // /--
     MutexGuard aGuard( GetMutex());
 
-    if( nIndex < 0 ||
+    if( Index < 0 ||
         nIndex > m_aContainer.size() )
         throw lang::IndexOutOfBoundsException();
 
@@ -169,7 +169,7 @@ uno::Any SAL_CALL OIndexContainer::getBy
     // /--
     MutexGuard aGuard( GetMutex());
 
-    if( nIndex < 0 ||
+    if( Index < 0 ||
         nIndex > m_aContainer.size() )
         throw lang::IndexOutOfBoundsException();
 
Index: chart2/source/tools/OPropertySet.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/OPropertySet.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.1
diff -u -u -p -r1.5 -r1.5.12.1
--- chart2/source/tools/OPropertySet.cxx	22 May 2007 19:02:51 -0000	1.5
+++ chart2/source/tools/OPropertySet.cxx	10 Jul 2007 14:42:03 -0000	1.5.12.1
@@ -77,11 +77,11 @@ OPropertySet::OPropertySet( ::osl::Mutex
 {
 }
 
-OPropertySet::OPropertySet( const OPropertySet & rOther, ::osl::Mutex & rMutex ) :
-        OBroadcastHelper( rMutex ),
+OPropertySet::OPropertySet( const OPropertySet & rOther, ::osl::Mutex & par_rMutex ) :
+        OBroadcastHelper( par_rMutex ),
         // the following causes a warning; there seems to be no way to avoid it
         OPropertySetHelper( static_cast< OBroadcastHelper & >( *this )),
-        m_rMutex( rMutex )
+        m_rMutex( par_rMutex )
 {
     // /--
     MutexGuard aGuard( m_rMutex );
Index: chart2/source/tools/ObjectIdentifier.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ObjectIdentifier.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/ObjectIdentifier.cxx	22 May 2007 19:03:13 -0000	1.2
+++ chart2/source/tools/ObjectIdentifier.cxx	10 Jul 2007 11:57:30 -0000	1.2.12.1
@@ -400,8 +400,8 @@ OUString ObjectIdentifier::createClassif
 
 //static
 OUString ObjectIdentifier::createParticleForDiagram(
-          const Reference< XDiagram >& xDiagram
-        , const Reference< frame::XModel >& xChartModel )
+          const Reference< XDiagram >& /*xDiagram*/
+        , const Reference< frame::XModel >& /*xChartModel*/ )
 {
     static OUString aRet(C2U("D=0"));
     //todo: if more than one diagram is implemeted, add the correct diagram index here
@@ -536,7 +536,7 @@ OUString ObjectIdentifier::createParticl
 
 //static
 OUString ObjectIdentifier::createParticleForLegend(
-          const Reference< XLegend >& xLegend
+          const Reference< XLegend >& /*xLegend*/
         , const Reference< frame::XModel >& xChartModel )
 {
     OUStringBuffer aRet;
@@ -1319,7 +1319,7 @@ Reference< XDiagram > ObjectIdentifier::
 
 TitleHelper::eTitleType ObjectIdentifier::getTitleTypeForCID( const OUString& rCID )
 {
-    TitleHelper::eTitleType eRet;
+    TitleHelper::eTitleType eRet( TitleHelper::MAIN_TITLE );
 
     OUString aParentParticle = ObjectIdentifier::getFullParentParticle( rCID );
     const tTitleMap& rMap = lcl_getTitleMap();
Index: chart2/source/tools/RangeHighlighter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/RangeHighlighter.cxx,v
retrieving revision 1.3
retrieving revision 1.3.8.1
diff -u -u -p -r1.3 -r1.3.8.1
--- chart2/source/tools/RangeHighlighter.cxx	11 Jun 2007 15:02:20 -0000	1.3
+++ chart2/source/tools/RangeHighlighter.cxx	10 Jul 2007 11:57:30 -0000	1.3.8.1
@@ -295,7 +295,7 @@ void SAL_CALL RangeHighlighter::removeSe
 }
 
 // ____ XSelectionChangeListener ____
-void SAL_CALL RangeHighlighter::selectionChanged( const lang::EventObject& aEvent )
+void SAL_CALL RangeHighlighter::selectionChanged( const lang::EventObject& /*aEvent*/ )
     throw (uno::RuntimeException)
 {
     determineRanges();
Index: chart2/source/tools/RegressionCalculationHelper.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/RegressionCalculationHelper.hxx,v
retrieving revision 1.3
retrieving revision 1.3.136.1
diff -u -u -p -r1.3 -r1.3.136.1
--- chart2/source/tools/RegressionCalculationHelper.hxx	8 Sep 2005 01:33:26 -0000	1.3
+++ chart2/source/tools/RegressionCalculationHelper.hxx	12 Jul 2007 05:50:10 -0000	1.3.136.1
@@ -65,7 +65,7 @@ typedef ::std::pair< ::std::vector< doub
     used to pass as parameter aPred.</p>
  */
 template< class Pred >
-static tDoubleVectorPair
+tDoubleVectorPair
     cleanup( const ::com::sun::star::uno::Sequence< double > & rXValues,
              const ::com::sun::star::uno::Sequence< double > & rYValues,
              Pred aPred )
Index: chart2/source/tools/RegressionCurveHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/RegressionCurveHelper.cxx,v
retrieving revision 1.10
retrieving revision 1.10.12.1
diff -u -u -p -r1.10 -r1.10.12.1
--- chart2/source/tools/RegressionCurveHelper.cxx	22 May 2007 19:03:52 -0000	1.10
+++ chart2/source/tools/RegressionCurveHelper.cxx	4 Jul 2007 16:48:58 -0000	1.10.12.1
@@ -360,7 +360,7 @@ void RegressionCurveHelper::removeMeanVa
 void RegressionCurveHelper::addRegressionCurve(
     tRegressionType eType,
     uno::Reference< XRegressionCurveContainer > & xRegCnt,
-    const uno::Reference< XComponentContext > & xContext,
+    const uno::Reference< XComponentContext > & /* xContext */,
     const uno::Reference< beans::XPropertySet >& xPropertySource )
 {
     if( !xRegCnt.is() )
Index: chart2/source/tools/RegressionCurveModel.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/RegressionCurveModel.cxx,v
retrieving revision 1.5
retrieving revision 1.5.12.2
diff -u -u -p -r1.5 -r1.5.12.2
--- chart2/source/tools/RegressionCurveModel.cxx	22 May 2007 19:04:04 -0000	1.5
+++ chart2/source/tools/RegressionCurveModel.cxx	10 Jul 2007 14:42:03 -0000	1.5.12.2
@@ -124,6 +124,8 @@ RegressionCurveModel::RegressionCurveMod
 }
 
 RegressionCurveModel::RegressionCurveModel( const RegressionCurveModel & rOther ) :
+        MutexContainer(),
+        impl::RegressionCurveModel_Base(),
         ::property::OPropertySet( rOther, m_aMutex ),
     m_xContext( rOther.m_xContext ),
     m_eRegressionCurveType( rOther.m_eRegressionCurveType ),
@@ -199,7 +201,7 @@ void SAL_CALL RegressionCurveModel::modi
 }
 
 // ____ XEventListener (base of XModifyListener) ____
-void SAL_CALL RegressionCurveModel::disposing( const lang::EventObject& Source )
+void SAL_CALL RegressionCurveModel::disposing( const lang::EventObject& /* Source */ )
     throw (uno::RuntimeException)
 {
     // nothing
Index: chart2/source/tools/RelativePositionHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/RelativePositionHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/RelativePositionHelper.cxx	22 May 2007 19:04:27 -0000	1.2
+++ chart2/source/tools/RelativePositionHelper.cxx	10 Jul 2007 11:57:30 -0000	1.2.12.1
@@ -92,6 +92,8 @@ chart2::RelativePosition RelativePositio
                 nShiftHalfWidths  -= 2;
                 nShiftHalfHeights -= 2;
                 break;
+            case drawing::Alignment_MAKE_FIXED_SIZE:
+                break;
         }
 
         // transform
@@ -127,6 +129,8 @@ chart2::RelativePosition RelativePositio
                 nShiftHalfWidths  += 2;
                 nShiftHalfHeights += 2;
                 break;
+            case drawing::Alignment_MAKE_FIXED_SIZE:
+                break;
         }
 
         if( nShiftHalfWidths != 0 )
@@ -298,6 +302,8 @@ bool RelativePositionHelper::centerGrow(
         case drawing::Alignment_BOTTOM_RIGHT:
             aPos.Primary += fShiftAmountX;
             break;
+        case drawing::Alignment_MAKE_FIXED_SIZE:
+            break;
     }
 
     // shift Y
@@ -318,6 +324,8 @@ bool RelativePositionHelper::centerGrow(
         case drawing::Alignment_BOTTOM_RIGHT:
             aPos.Secondary += fShiftAmountY;
             break;
+        case drawing::Alignment_MAKE_FIXED_SIZE:
+            break;
     }
 
     // anchor must not be changed
Index: chart2/source/tools/ThreeDHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/ThreeDHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.4.3
diff -u -u -p -r1.2 -r1.2.4.3
--- chart2/source/tools/ThreeDHelper.cxx	3 Jul 2007 13:44:51 -0000	1.2
+++ chart2/source/tools/ThreeDHelper.cxx	10 Jul 2007 14:27:24 -0000	1.2.4.3
@@ -184,7 +184,6 @@ bool lcl_isLightScheme( const uno::Refer
         xDiagramProps->getPropertyValue( C2U("RightAngledAxes")) >>= bRightAngledAxes;
         if(!bRightAngledAxes)
         {
-            uno::Reference< chart2::XDiagram > xDiagram( xDiagramProps, uno::UNO_QUERY );
             if( ChartTypeHelper::isSupportingRightAngledAxes( 
                     DiagramHelper::getChartTypeByIndex( xDiagram, 0 ) ) )
             {
@@ -230,7 +229,6 @@ void lcl_setLightsForScheme( const uno::
         xDiagramProps->getPropertyValue( C2U("RightAngledAxes")) >>= bRightAngledAxes;
         if(!bRightAngledAxes)
         {
-            uno::Reference< chart2::XDiagram > xDiagram( xDiagramProps, uno::UNO_QUERY );
             if( ChartTypeHelper::isSupportingRightAngledAxes( xChartType ) )
             {
                 ::basegfx::B3DHomMatrix aRotation( lcl_getCompleteRotationMatrix( xDiagramProps ) );
@@ -691,7 +689,7 @@ void ThreeDHelper::getRoundedEdgesAndObj
         bool bDifferentRoundedEdges = false;
         bool bDifferentObjectLines = false;
 
-        drawing::LineStyle aLineStyle;
+        drawing::LineStyle aLineStyle( drawing::LineStyle_SOLID );
 
         ::std::vector< uno::Reference< XDataSeries > > aSeriesList(
             DiagramHelper::getDataSeriesFromDiagram( xDiagram ) );
Index: chart2/source/tools/UncachedDataSequence.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/UncachedDataSequence.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/UncachedDataSequence.cxx	22 May 2007 19:06:00 -0000	1.2
+++ chart2/source/tools/UncachedDataSequence.cxx	10 Jul 2007 13:56:32 -0000	1.2.12.1
@@ -113,7 +113,9 @@ UncachedDataSequence::UncachedDataSequen
 }
 
 UncachedDataSequence::UncachedDataSequence( const UncachedDataSequence & rSource )
-        : OPropertyContainer( GetBroadcastHelper()),
+        : ::comphelper::OMutexAndBroadcastHelper(),
+          OPropertyContainer( GetBroadcastHelper()),
+          ::comphelper::OPropertyArrayUsageHelper< UncachedDataSequence >(),
           UncachedDataSequence_Base( GetMutex()),
           m_nNumberFormatKey( rSource.m_nNumberFormatKey ),
           m_sRole( rSource.m_sRole ),
Index: chart2/source/tools/UndoGuard.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/UndoGuard.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/UndoGuard.cxx	22 May 2007 19:06:12 -0000	1.2
+++ chart2/source/tools/UndoGuard.cxx	25 Jun 2007 12:52:12 -0000	1.2.12.1
@@ -47,11 +47,11 @@ using ::rtl::OUString;
 namespace chart
 {
 
-UndoGuard_Base::UndoGuard_Base( const rtl::OUString& rUndoString
-        , UndoManager& rUndoManager
+UndoGuard_Base::UndoGuard_Base( const OUString& rUndoString
+        , const uno::Reference< chart2::XUndoManager > & xUndoManager
         , const uno::Reference< frame::XModel > & xModel )
         : m_xModel( xModel )
-        , m_rUndoManager( rUndoManager )
+        , m_xUndoManager( xUndoManager )
         , m_aUndoString( rUndoString )
         , m_bActionPosted( false )
 {
@@ -64,56 +64,60 @@ UndoGuard_Base::~UndoGuard_Base()
 void UndoGuard_Base::commitAction()
 {
     if( !m_bActionPosted )
-        m_rUndoManager.postAction( m_aUndoString );
+        m_xUndoManager->postAction( m_aUndoString );
     m_bActionPosted = true;
 }
 
 //-----------------------------------------------------------------------------
 
-UndoGuard::UndoGuard( const rtl::OUString& rUndoString
-        , UndoManager& rUndoManager
+UndoGuard::UndoGuard( const OUString& rUndoString
+        , const uno::Reference< chart2::XUndoManager > & xUndoManager
         , const uno::Reference< frame::XModel > & xModel )
-        : UndoGuard_Base( rUndoString, rUndoManager, xModel )
+        : UndoGuard_Base( rUndoString, xUndoManager, xModel )
 {
-    m_rUndoManager.preAction( m_xModel );
+    m_xUndoManager->preAction( m_xModel );
 }
 
 UndoGuard::~UndoGuard()
 {
     if( !m_bActionPosted )
-        m_rUndoManager.cancelAction();
+        m_xUndoManager->cancelAction();
 }
 
 //-----------------------------------------------------------------------------
 
-UndoLiveUpdateGuard::UndoLiveUpdateGuard( const rtl::OUString& rUndoString
-        , UndoManager& rUndoManager
+UndoLiveUpdateGuard::UndoLiveUpdateGuard( const OUString& rUndoString
+        , const uno::Reference< chart2::XUndoManager > & xUndoManager
         , const uno::Reference< frame::XModel > & xModel )
-        : UndoGuard_Base( rUndoString, rUndoManager, xModel )
+        : UndoGuard_Base( rUndoString, xUndoManager, xModel )
 {
-    m_rUndoManager.preAction( m_xModel );
+    m_xUndoManager->preAction( m_xModel );
 }
 
 UndoLiveUpdateGuard::~UndoLiveUpdateGuard()
 {
     if( !m_bActionPosted )
-        m_rUndoManager.cancelActionUndo( m_xModel );
+        m_xUndoManager->cancelActionWithUndo( m_xModel );
 }
 
 //-----------------------------------------------------------------------------
 
-UndoLiveUpdateGuardWithData::UndoLiveUpdateGuardWithData( const rtl::OUString& rUndoString
-        , UndoManager& rUndoManager
+UndoLiveUpdateGuardWithData::UndoLiveUpdateGuardWithData( const OUString& rUndoString
+        , const uno::Reference< chart2::XUndoManager > & xUndoManager
         , const uno::Reference< frame::XModel > & xModel )
-        : UndoGuard_Base( rUndoString, rUndoManager, xModel )
+        : UndoGuard_Base( rUndoString, xUndoManager, xModel )
 {
-    m_rUndoManager.preActionWithData( m_xModel );
+    Sequence< beans::PropertyValue > aArgs(1);
+    aArgs[0] = beans::PropertyValue(
+        OUString( RTL_CONSTASCII_USTRINGPARAM("WithData")), -1, uno::Any(),
+        beans::PropertyState_DIRECT_VALUE );
+    m_xUndoManager->preActionWithArguments( m_xModel, aArgs );
 }
 
 UndoLiveUpdateGuardWithData::~UndoLiveUpdateGuardWithData()
 {
     if( !m_bActionPosted )
-        m_rUndoManager.cancelActionUndo( m_xModel );
+        m_xUndoManager->cancelActionWithUndo( m_xModel );
 }
 
 } //  namespace chart
Index: chart2/source/tools/UndoManager.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/UndoManager.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.4
diff -u -u -p -r1.2 -r1.2.12.4
--- chart2/source/tools/UndoManager.cxx	22 May 2007 19:06:21 -0000	1.2
+++ chart2/source/tools/UndoManager.cxx	10 Jul 2007 13:58:57 -0000	1.2.12.4
@@ -118,14 +118,15 @@ void ModifyBroadcaster::fireEvent()
 	}
 }
 
-}
+} // namespace impl
 
 UndoManager::UndoManager() :
-        m_apUndoStack( new impl::UndoStack()),
-        m_apRedoStack( new impl::UndoStack()),
-        m_pLastRemeberedUndoElement( 0 ),
-        m_nMaxNumberOfUndos( 100 ),
-        m_pModifyBroadcaster( 0 )
+        impl::UndoManager_Base( m_aMutex ),
+    m_apUndoStack( new impl::UndoStack()),
+    m_apRedoStack( new impl::UndoStack()),
+    m_pLastRemeberedUndoElement( 0 ),
+    m_nMaxNumberOfUndos( 100 ),
+    m_pModifyBroadcaster( 0 )
 {}
 
 UndoManager::~UndoManager()
@@ -139,7 +140,7 @@ UndoManager::~UndoManager()
 }
 
 void UndoManager::impl_undoRedo(
-    const Reference< frame::XModel > & xCurrentModel,
+    Reference< frame::XModel > & xCurrentModel,
     impl::UndoStack * pStackToRemoveFrom,
     impl::UndoStack * pStackToAddTo )
 {
@@ -166,66 +167,92 @@ void UndoManager::impl_undoRedo(
     }
 }
 
-void UndoManager::undo( const Reference< frame::XModel > & xCurrentModel )
+void UndoManager::fireModifyEvent()
 {
-    OSL_ASSERT( m_apUndoStack.get() && m_apRedoStack.get());
-    impl_undoRedo( xCurrentModel, m_apUndoStack.get(), m_apRedoStack.get());
+    if( m_xModifyBroadcaster.is())
+        m_pModifyBroadcaster->fireEvent();
 }
 
-void UndoManager::redo( const Reference< frame::XModel > & xCurrentModel )
-{
-    OSL_ASSERT( m_apUndoStack.get() && m_apRedoStack.get());
-    impl_undoRedo( xCurrentModel, m_apRedoStack.get(), m_apUndoStack.get());
-}
 
-bool UndoManager::canUndo() const
-{
-    return ! m_apUndoStack->empty();
-}
-
-bool UndoManager::canRedo() const
+// ____ ConfigItemListener ____
+void UndoManager::notify( const ::rtl::OUString & rPropertyName )
 {
-    return ! m_apRedoStack->empty();
+    OSL_ENSURE( rPropertyName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "Steps" )),
+                "Unwanted config property change Notified" );
+    if( rPropertyName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "Steps" )))
+        retrieveConfigUndoSteps();
 }
 
-OUString UndoManager::getCurrentUndoString() const
+void UndoManager::retrieveConfigUndoSteps()
 {
-    return m_apUndoStack->topUndoString();
-}
+    if( ! m_apUndoStepsConfigItem.get())
+        m_apUndoStepsConfigItem.reset( new impl::UndoStepsConfigItem( *this ));
+    m_nMaxNumberOfUndos = m_apUndoStepsConfigItem->getUndoSteps();
+    m_apUndoStack->limitSize( m_nMaxNumberOfUndos );
+    m_apRedoStack->limitSize( m_nMaxNumberOfUndos );
 
-OUString UndoManager::getCurrentRedoString() const
-{
-    return m_apRedoStack->topUndoString();
+    // a list of available undo steps could shrink here
+    fireModifyEvent();
 }
 
-Sequence< OUString > UndoManager::getUndoStrings() const
+// ____ XModifyBroadcaster ____
+void SAL_CALL UndoManager::addModifyListener( const Reference< util::XModifyListener >& aListener )
+    throw (uno::RuntimeException)
 {
-    return m_apUndoStack->getUndoStrings();
+    if( ! m_xModifyBroadcaster.is())
+    {
+        m_pModifyBroadcaster = new impl::ModifyBroadcaster();
+        m_xModifyBroadcaster.set( static_cast< cppu::OWeakObject* >( m_pModifyBroadcaster ), uno::UNO_QUERY );
+    }
+    m_xModifyBroadcaster->addModifyListener( aListener );
 }
 
-Sequence< OUString > UndoManager::getRedoStrings() const
+void SAL_CALL UndoManager::removeModifyListener( const Reference< util::XModifyListener >& aListener )
+    throw (uno::RuntimeException)
 {
-    return m_apRedoStack->getUndoStrings();
+    if( ! m_xModifyBroadcaster.is())
+    {
+        m_pModifyBroadcaster = new impl::ModifyBroadcaster();
+        m_xModifyBroadcaster.set( static_cast< cppu::OWeakObject* >( m_pModifyBroadcaster ), uno::UNO_QUERY );
+    }
+    m_xModifyBroadcaster->removeModifyListener( aListener );
 }
 
-void UndoManager::preAction( const Reference< frame::XModel > & xCurrentModel )
+// ____ chart2::XUndoManager ____
+void SAL_CALL UndoManager::preAction( const Reference< frame::XModel >& xModelBeforeChange )
+    throw (uno::RuntimeException)
 {
     OSL_ENSURE( ! m_pLastRemeberedUndoElement, "Looks like postAction or cancelAction call was missing" );
-    m_pLastRemeberedUndoElement = new impl::UndoElement( xCurrentModel );
+    m_pLastRemeberedUndoElement = new impl::UndoElement( xModelBeforeChange );
 }
 
-void UndoManager::preActionWithData( const Reference< frame::XModel > & xCurrentModel )
+void SAL_CALL UndoManager::preActionWithArguments(
+    const Reference< frame::XModel >& xModelBeforeChange,
+    const Sequence< beans::PropertyValue >& aArguments )
+    throw (uno::RuntimeException)
 {
+    bool bActionHandled( false );
     OSL_ENSURE( ! m_pLastRemeberedUndoElement, "Looks like postAction or cancelAction call was missing" );
-    m_pLastRemeberedUndoElement = new impl::UndoElementWithData( xCurrentModel );
+    if( aArguments.getLength() > 0 )
+    {
+        if( aArguments[0].Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM("WithData")))
+        {
+            m_pLastRemeberedUndoElement = new impl::UndoElementWithData( xModelBeforeChange );
+            bActionHandled = true;
+        }
+    }
+
+    if( !bActionHandled )
+        preAction( xModelBeforeChange );
 }
 
-void UndoManager::postAction( const OUString & rUndoString )
+void SAL_CALL UndoManager::postAction( const OUString& aUndoText )
+    throw (uno::RuntimeException)
 {
     OSL_ENSURE( m_pLastRemeberedUndoElement, "Looks like preAction call was missing" );
     if( m_pLastRemeberedUndoElement )
     {
-        m_pLastRemeberedUndoElement->setActionString( rUndoString );
+        m_pLastRemeberedUndoElement->setActionString( aUndoText );
         m_apUndoStack->push( m_pLastRemeberedUndoElement );
         m_pLastRemeberedUndoElement = 0;
 
@@ -241,13 +268,15 @@ void UndoManager::postAction( const OUSt
     }
 }
 
-void UndoManager::cancelAction()
+void SAL_CALL UndoManager::cancelAction()
+    throw (uno::RuntimeException)
 {
     delete m_pLastRemeberedUndoElement;
     m_pLastRemeberedUndoElement = 0;
 }
 
-void UndoManager::cancelActionUndo( const Reference< frame::XModel > & xModelToRestore )
+void SAL_CALL UndoManager::cancelActionWithUndo( Reference< frame::XModel >& xModelToRestore )
+    throw (uno::RuntimeException)
 {
     if( m_pLastRemeberedUndoElement )
     {
@@ -256,59 +285,70 @@ void UndoManager::cancelActionUndo( cons
     }
 }
 
-void UndoManager::fireModifyEvent()
+void SAL_CALL UndoManager::undo( Reference< frame::XModel >& xCurrentModel )
+    throw (uno::RuntimeException)
 {
-    if( m_xModifyBroadcaster.is())
-        m_pModifyBroadcaster->fireEvent();
+    OSL_ASSERT( m_apUndoStack.get() && m_apRedoStack.get());
+    impl_undoRedo( xCurrentModel, m_apUndoStack.get(), m_apRedoStack.get());
 }
 
+void SAL_CALL UndoManager::redo( Reference< frame::XModel >& xCurrentModel )
+    throw (uno::RuntimeException)
+{
+    OSL_ASSERT( m_apUndoStack.get() && m_apRedoStack.get());
+    impl_undoRedo( xCurrentModel, m_apRedoStack.get(), m_apUndoStack.get());
+}
 
-// ____ ConfigItemListener ____
-void UndoManager::notify( const ::rtl::OUString & rPropertyName )
+::sal_Bool SAL_CALL UndoManager::undoPossible()
+    throw (uno::RuntimeException)
 {
-    OSL_ENSURE( rPropertyName.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "Steps" )),
-                "Unwanted config property change Notified" );
-    retrieveConfigUndoSteps();
+    return ! m_apUndoStack->empty();
 }
 
-sal_Int32 UndoManager::getMaximumNumberOfUndoSteps()
+::sal_Bool SAL_CALL UndoManager::redoPossible()
+    throw (uno::RuntimeException)
 {
-    return m_nMaxNumberOfUndos;
+    return ! m_apRedoStack->empty();
 }
 
-void UndoManager::retrieveConfigUndoSteps()
+OUString SAL_CALL UndoManager::getCurrentUndoString()
+    throw (uno::RuntimeException)
 {
-    if( ! m_apUndoStepsConfigItem.get())
-        m_apUndoStepsConfigItem.reset( new impl::UndoStepsConfigItem( *this ));
-    m_nMaxNumberOfUndos = m_apUndoStepsConfigItem->getUndoSteps();
-    m_apUndoStack->limitSize( m_nMaxNumberOfUndos );
-    m_apRedoStack->limitSize( m_nMaxNumberOfUndos );
+    return m_apUndoStack->topUndoString();
+}
 
-    // a list of available undo steps could shrink here
-    fireModifyEvent();
+OUString SAL_CALL UndoManager::getCurrentRedoString()
+    throw (uno::RuntimeException)
+{
+    return m_apRedoStack->topUndoString();
 }
 
-void UndoManager::addModifyListener(
-    const Reference< util::XModifyListener >& xListener )
+Sequence< OUString > SAL_CALL UndoManager::getAllUndoStrings()
+    throw (uno::RuntimeException)
 {
-    if( ! m_xModifyBroadcaster.is())
-    {
-        m_pModifyBroadcaster = new impl::ModifyBroadcaster();
-        m_xModifyBroadcaster.set( static_cast< cppu::OWeakObject* >( m_pModifyBroadcaster ), uno::UNO_QUERY );
-    }
-    m_xModifyBroadcaster->addModifyListener( xListener );
+    return m_apUndoStack->getUndoStrings();
 }
 
-void UndoManager::removeModifyListener(
-    const Reference< util::XModifyListener >& xListener )
+Sequence< OUString > SAL_CALL UndoManager::getAllRedoStrings()
+    throw (uno::RuntimeException)
 {
-    if( ! m_xModifyBroadcaster.is())
-    {
-        m_pModifyBroadcaster = new impl::ModifyBroadcaster();
-        m_xModifyBroadcaster.set( static_cast< cppu::OWeakObject* >( m_pModifyBroadcaster ), uno::UNO_QUERY );
-    }
-    m_xModifyBroadcaster->removeModifyListener( xListener );
+    return m_apRedoStack->getUndoStrings();
 }
 
+// ____ XUndoHelper ____
+Reference< frame::XModel > SAL_CALL UndoManager::getModelCloneForUndo(
+    const Reference< frame::XModel >& xModelBeforeChange )
+    throw (uno::RuntimeException)
+{
+    return impl::UndoElement::cloneModel( xModelBeforeChange );
+}
+
+void SAL_CALL UndoManager::applyModelContent(
+    Reference< frame::XModel >& xModelToChange,
+    const Reference< frame::XModel >& xModelToCopyFrom )
+    throw (uno::RuntimeException)
+{
+    impl::UndoElement::applyModelContentToModel( xModelToChange, xModelToCopyFrom );
+}
 
 } //  namespace chart
Index: chart2/source/tools/WrappedDefaultProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/WrappedDefaultProperty.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/WrappedDefaultProperty.cxx	22 May 2007 19:06:39 -0000	1.2
+++ chart2/source/tools/WrappedDefaultProperty.cxx	10 Jul 2007 13:38:42 -0000	1.2.12.1
@@ -69,7 +69,7 @@ void WrappedDefaultProperty::setProperty
 }
 
 uno::Any WrappedDefaultProperty::getPropertyDefault(
-    const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+    const Reference< beans::XPropertyState >& /* xInnerPropertyState */ ) const
     throw (beans::UnknownPropertyException,
            lang::WrappedTargetException,
            uno::RuntimeException)
Index: chart2/source/tools/WrappedDirectStateProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/WrappedDirectStateProperty.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/WrappedDirectStateProperty.cxx	22 May 2007 19:06:49 -0000	1.2
+++ chart2/source/tools/WrappedDirectStateProperty.cxx	10 Jul 2007 13:38:42 -0000	1.2.12.1
@@ -57,7 +57,7 @@ WrappedDirectStateProperty::~WrappedDire
 {}
 
 beans::PropertyState WrappedDirectStateProperty::getPropertyState(
-    const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+    const Reference< beans::XPropertyState >& /* xInnerPropertyState */ ) const
     throw (beans::UnknownPropertyException,
            uno::RuntimeException)
 {
Index: chart2/source/tools/WrappedIgnoreProperty.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/WrappedIgnoreProperty.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.2
diff -u -u -p -r1.2 -r1.2.12.2
--- chart2/source/tools/WrappedIgnoreProperty.cxx	22 May 2007 19:06:58 -0000	1.2
+++ chart2/source/tools/WrappedIgnoreProperty.cxx	10 Jul 2007 13:38:42 -0000	1.2.12.2
@@ -78,38 +78,43 @@ namespace chart
 WrappedIgnoreProperty::WrappedIgnoreProperty( const OUString& rOuterName, const Any& rDefaultValue )
                          : WrappedProperty( rOuterName, OUString() )
                          , m_aDefaultValue( rDefaultValue )
+                         , m_aCurrentValue( rDefaultValue )
 {
 }
 WrappedIgnoreProperty::~WrappedIgnoreProperty()
 {
 }
 
-void WrappedIgnoreProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+void WrappedIgnoreProperty::setPropertyValue( const Any& rOuterValue, const Reference< beans::XPropertySet >& /* xInnerPropertySet */ ) const
                 throw (beans::UnknownPropertyException, beans::PropertyVetoException, lang::IllegalArgumentException, lang::WrappedTargetException, uno::RuntimeException)
 {
+    m_aCurrentValue = rOuterValue;
 }
 
-Any WrappedIgnoreProperty::getPropertyValue( const Reference< beans::XPropertySet >& xInnerPropertySet ) const
+Any WrappedIgnoreProperty::getPropertyValue( const Reference< beans::XPropertySet >& /* xInnerPropertySet */ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
-    return getPropertyDefault(0);
+    return m_aCurrentValue;
 }
 
-void WrappedIgnoreProperty::setPropertyToDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+void WrappedIgnoreProperty::setPropertyToDefault( const Reference< beans::XPropertyState >& /* xInnerPropertyState */ ) const
                         throw (::com::sun::star::beans::UnknownPropertyException, ::com::sun::star::uno::RuntimeException)
 {
+    m_aCurrentValue = m_aDefaultValue;
 }
 
-Any WrappedIgnoreProperty::getPropertyDefault( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+Any WrappedIgnoreProperty::getPropertyDefault( const Reference< beans::XPropertyState >& /* xInnerPropertyState */ ) const
                         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     return m_aDefaultValue;
 }
 
-beans::PropertyState WrappedIgnoreProperty::getPropertyState( const Reference< beans::XPropertyState >& xInnerPropertyState ) const
+beans::PropertyState WrappedIgnoreProperty::getPropertyState( const Reference< beans::XPropertyState >& /* xInnerPropertyState */ ) const
                         throw (beans::UnknownPropertyException, uno::RuntimeException)
 {
-    return beans::PropertyState_DEFAULT_VALUE;
+    return ( m_aCurrentValue == m_aDefaultValue
+             ? beans::PropertyState_DEFAULT_VALUE
+             : beans::PropertyState_DIRECT_VALUE );
 }
 
 //static
Index: chart2/source/tools/WrappedPropertySet.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/WrappedPropertySet.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/WrappedPropertySet.cxx	22 May 2007 19:07:16 -0000	1.2
+++ chart2/source/tools/WrappedPropertySet.cxx	6 Jul 2007 12:00:53 -0000	1.2.12.1
@@ -129,23 +129,23 @@ void SAL_CALL WrappedPropertySet::setPro
     }
     catch( beans::UnknownPropertyException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( beans::PropertyVetoException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( lang::IllegalArgumentException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( lang::WrappedTargetException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( uno::RuntimeException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( uno::Exception& ex )
     {
@@ -174,15 +174,15 @@ Any SAL_CALL WrappedPropertySet::getProp
     }
     catch( beans::UnknownPropertyException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( lang::WrappedTargetException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( uno::RuntimeException& ex )
     {
-        throw;
+        throw ex;
     }
     catch( uno::Exception& ex )
     {
@@ -198,9 +198,6 @@ Any SAL_CALL WrappedPropertySet::getProp
 void SAL_CALL WrappedPropertySet::addPropertyChangeListener( const OUString& rPropertyName, const Reference< beans::XPropertyChangeListener >& xListener )
                                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
-    OSL_ENSURE(false,"not implemented yet");
-    //todo
-    /*
     Reference< beans::XPropertySet > xInnerPropertySet( this->getInnerPropertySet() );
     if( xInnerPropertySet.is() )
     {
@@ -210,26 +207,46 @@ void SAL_CALL WrappedPropertySet::addPro
         else
             xInnerPropertySet->addPropertyChangeListener( rPropertyName, xListener );
     }
-    m_aBoundListenerContainer.addInterface( (sal_Int32)nHandle, xListener );
-    */
+//     m_aBoundListenerContainer.addInterface( (sal_Int32)nHandle, xListener );
 }
 void SAL_CALL WrappedPropertySet::removePropertyChangeListener( const OUString& rPropertyName, const Reference< beans::XPropertyChangeListener >& aListener )
                                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
-    OSL_ENSURE(false,"not implemented yet");
-    //todo
+    Reference< beans::XPropertySet > xInnerPropertySet( this->getInnerPropertySet() );
+    if( xInnerPropertySet.is() )
+    {
+        const WrappedProperty* pWrappedProperty = getWrappedProperty( rPropertyName );
+        if( pWrappedProperty )
+            xInnerPropertySet->removePropertyChangeListener( pWrappedProperty->getInnerName(), aListener );
+        else
+            xInnerPropertySet->removePropertyChangeListener( rPropertyName, aListener );
+    }
 }
 void SAL_CALL WrappedPropertySet::addVetoableChangeListener( const OUString& rPropertyName, const Reference< beans::XVetoableChangeListener >& aListener )
                                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
-    OSL_ENSURE(false,"not implemented yet");
-    //todo
+    Reference< beans::XPropertySet > xInnerPropertySet( this->getInnerPropertySet() );
+    if( xInnerPropertySet.is() )
+    {
+        const WrappedProperty* pWrappedProperty = getWrappedProperty( rPropertyName );
+        if( pWrappedProperty )
+            xInnerPropertySet->addVetoableChangeListener( pWrappedProperty->getInnerName(), aListener );
+        else
+            xInnerPropertySet->addVetoableChangeListener( rPropertyName, aListener );
+    }
 }
 void SAL_CALL WrappedPropertySet::removeVetoableChangeListener( const OUString& rPropertyName, const Reference< beans::XVetoableChangeListener >& aListener )
                                     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
-    OSL_ENSURE(false,"not implemented yet");
-    //todo
+    Reference< beans::XPropertySet > xInnerPropertySet( this->getInnerPropertySet() );
+    if( xInnerPropertySet.is() )
+    {
+        const WrappedProperty* pWrappedProperty = getWrappedProperty( rPropertyName );
+        if( pWrappedProperty )
+            xInnerPropertySet->removeVetoableChangeListener( pWrappedProperty->getInnerName(), aListener );
+        else
+            xInnerPropertySet->removeVetoableChangeListener( rPropertyName, aListener );
+    }
 }
 
 //XMultiPropertySet
@@ -281,19 +298,19 @@ Sequence< Any > SAL_CALL WrappedProperty
     }
     return aRetSeq;
 }
-void SAL_CALL WrappedPropertySet::addPropertiesChangeListener( const Sequence< OUString >& rNameSeq, const Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL WrappedPropertySet::addPropertiesChangeListener( const Sequence< OUString >& /* rNameSeq */, const Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented yet");
     //todo
 }
-void SAL_CALL WrappedPropertySet::removePropertiesChangeListener( const Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL WrappedPropertySet::removePropertiesChangeListener( const Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented yet");
     //todo
 }
-void SAL_CALL WrappedPropertySet::firePropertiesChangeEvent( const Sequence< OUString >& rNameSeq, const Reference< beans::XPropertiesChangeListener >& xListener )
+void SAL_CALL WrappedPropertySet::firePropertiesChangeEvent( const Sequence< OUString >& /* rNameSeq */, const Reference< beans::XPropertiesChangeListener >& /* xListener */ )
                                     throw (uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented yet");
Index: chart2/source/tools/XMLRangeHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/XMLRangeHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/XMLRangeHelper.cxx	22 May 2007 19:07:25 -0000	1.2
+++ chart2/source/tools/XMLRangeHelper.cxx	10 Jul 2007 13:59:36 -0000	1.2.12.1
@@ -323,7 +323,7 @@ CellRange getCellRangeFromXMLString( con
 {
     static const sal_Unicode aSpace( ' ' );
     static const sal_Unicode aQuote( '\'' );
-    static const sal_Unicode aDoubleQuote( '\"' );
+//     static const sal_Unicode aDoubleQuote( '\"' );
     static const sal_Unicode aDollar( '$' );
     static const sal_Unicode aBackslash( '\\' );
 
Index: chart2/source/tools/_serviceregistration_tools.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/_serviceregistration_tools.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/tools/_serviceregistration_tools.cxx	22 May 2007 19:07:43 -0000	1.2
+++ chart2/source/tools/_serviceregistration_tools.cxx	4 Jul 2007 16:48:58 -0000	1.2.12.1
@@ -161,7 +161,7 @@ extern "C"
 {
 //==================================================================================================
 void SAL_CALL component_getImplementationEnvironment(
-	const sal_Char ** ppEnvTypeName, uno_Environment ** ppEnv )
+	const sal_Char ** ppEnvTypeName, uno_Environment ** /* ppEnv */ )
 {
 	*ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
 }
Index: chart2/source/tools/makefile.mk
===================================================================
RCS file: /cvs/graphics/chart2/source/tools/makefile.mk,v
retrieving revision 1.23
retrieving revision 1.23.4.1
diff -u -u -p -r1.23 -r1.23.4.1
--- chart2/source/tools/makefile.mk	3 Jul 2007 13:45:07 -0000	1.23
+++ chart2/source/tools/makefile.mk	10 Jul 2007 12:47:37 -0000	1.23.4.1
@@ -87,7 +87,6 @@ SLOFILES=	\
 	$(SLO)$/PotentialRegressionCurveCalculator.obj \
 	$(SLO)$/RegressionCurveHelper.obj \
 	$(SLO)$/RegressionCurveModel.obj \
-	$(SLO)$/Rotation.obj \
 	$(SLO)$/RelativeSizeHelper.obj \
 	$(SLO)$/RelativePositionHelper.obj \
 	$(SLO)$/Scaling.obj \
cvs diff: Diffing chart2/source/tools/defs
cvs diff: Diffing chart2/source/view
cvs diff: Diffing chart2/source/view/axes
Index: chart2/source/view/axes/VAxisProperties.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/axes/VAxisProperties.cxx,v
retrieving revision 1.11
retrieving revision 1.11.12.1
diff -u -u -p -r1.11 -r1.11.12.1
--- chart2/source/view/axes/VAxisProperties.cxx	22 May 2007 19:10:13 -0000	1.11
+++ chart2/source/view/axes/VAxisProperties.cxx	10 Jul 2007 13:48:37 -0000	1.11.12.1
@@ -122,7 +122,7 @@ double lcl_getTickOffset(sal_Int32 nLeng
     return fPercent*nLength;
 }
 
-VLineProperties AxisProperties::makeLinePropertiesForDepth( sal_Int32 nDepth ) const
+VLineProperties AxisProperties::makeLinePropertiesForDepth( sal_Int32 /* nDepth */ ) const
 {
     //@todo get this from somewhere; maybe for each subincrement
     //so far the model does not offer different settings for each tick depth
Index: chart2/source/view/axes/VCartesianAxis.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/axes/VCartesianAxis.cxx,v
retrieving revision 1.7
retrieving revision 1.7.12.1
diff -u -u -p -r1.7 -r1.7.12.1
--- chart2/source/view/axes/VCartesianAxis.cxx	22 May 2007 19:10:36 -0000	1.7
+++ chart2/source/view/axes/VCartesianAxis.cxx	11 Jul 2007 15:03:57 -0000	1.7.12.1
@@ -493,7 +493,7 @@ B2DVector lcl_getStaggerDistance( LabelI
         DBG_ASSERT(xShape2DText.is(),"LabelIterator does not work correctly");
 
         awt::Size aSize  = xShape2DText->getSize();
-        if(abs(aStaggerDirection.getX())>abs(aStaggerDirection.getY()))
+        if(fabs(aStaggerDirection.getX())>fabs(aStaggerDirection.getY()))
             nDistance = ::std::max(nDistance,aSize.Width);
         else
             nDistance = ::std::max(nDistance,aSize.Height);
@@ -502,7 +502,7 @@ B2DVector lcl_getStaggerDistance( LabelI
     aRet = aStaggerDirection*nDistance;
 
     //add extra distance for vertical distance
-    if(abs(aStaggerDirection.getX())>abs(aStaggerDirection.getY()))
+    if(fabs(aStaggerDirection.getX())>fabs(aStaggerDirection.getY()))
         aRet += rDistanceTickToText;
 
     return aRet;
@@ -948,8 +948,8 @@ sal_Int32 VCartesianAxis::estimateMaximu
     B2DVector aStart, aEnd;
     this->get2DAxisMainLine( aStart, aEnd, this->getLogicValueWhereMainLineCrossesOtherAxis() );
 
-    sal_Int32 nMaxHeight = static_cast<sal_Int32>(abs(aEnd.getY()-aStart.getY()));
-    sal_Int32 nMaxWidth = static_cast<sal_Int32>(abs(aEnd.getX()-aStart.getX()));
+    sal_Int32 nMaxHeight = static_cast<sal_Int32>(fabs(aEnd.getY()-aStart.getY()));
+    sal_Int32 nMaxWidth = static_cast<sal_Int32>(fabs(aEnd.getX()-aStart.getX()));
 
     sal_Int32 nTotalAvailable = nMaxHeight;
     sal_Int32 nSingleNeeded = m_nMaximumTextHeightSoFar;
Index: chart2/source/view/axes/VCoordinateSystem.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/axes/VCoordinateSystem.cxx,v
retrieving revision 1.8
retrieving revision 1.8.12.3
diff -u -u -p -r1.8 -r1.8.12.3
--- chart2/source/view/axes/VCoordinateSystem.cxx	22 May 2007 19:11:44 -0000	1.8
+++ chart2/source/view/axes/VCoordinateSystem.cxx	11 Jul 2007 15:03:57 -0000	1.8.12.3
@@ -103,14 +103,14 @@ VCoordinateSystem* VCoordinateSystem::cr
 
 VCoordinateSystem::VCoordinateSystem( const Reference< XCoordinateSystem >& xCooSys )
     : m_xCooSysModel(xCooSys)
-    , m_aExplicitScales(3)
-    , m_aExplicitIncrements(3)
     , m_xLogicTargetForGrids(0)
     , m_xLogicTargetForAxes(0)
     , m_xFinalTarget(0)
     , m_xShapeFactory(0)
     , m_aMatrixSceneToScreen()
     , m_aMergedMinimumAndMaximumSupplier()
+    , m_aExplicitScales(3)
+    , m_aExplicitIncrements(3)
     , m_aExplicitCategoriesProvider( new ExplicitCategoriesProvider( m_xCooSysModel ) )
 {
     if( !m_xCooSysModel.is() || m_xCooSysModel->getDimension()<3 )
@@ -197,15 +197,15 @@ uno::Sequence< sal_Int32 > VCoordinateSy
         BaseGFXHelper::HomogenMatrixToB3DHomMatrix(
             m_aMatrixSceneToScreen ) ) );
 
-    double fCoosysWidth = abs(aScale.getX()*FIXED_SIZE_FOR_3D_CHART_VOLUME);
-    double fCoosysHeight = abs(aScale.getY()*FIXED_SIZE_FOR_3D_CHART_VOLUME);
+    double fCoosysWidth = static_cast< double >( fabs(aScale.getX()*FIXED_SIZE_FOR_3D_CHART_VOLUME));
+    double fCoosysHeight = static_cast< double >( fabs(aScale.getY()*FIXED_SIZE_FOR_3D_CHART_VOLUME));
 
     double fPageWidth = rPageSize.Width;
     double fPageHeight = rPageSize.Height;
 
     //factor 2 to avoid rounding problems
-    sal_Int32 nXResolution = 2*rPageResolution.Width*fCoosysWidth/fPageWidth;
-    sal_Int32 nYResolution = 2*rPageResolution.Height*fCoosysHeight/fPageHeight;
+    sal_Int32 nXResolution = static_cast<sal_Int32>(2.0*static_cast<double>(rPageResolution.Width)*fCoosysWidth/fPageWidth);
+    sal_Int32 nYResolution = static_cast<sal_Int32>(2.0*static_cast<double>(rPageResolution.Height)*fCoosysHeight/fPageHeight);
 
     if( nXResolution < 10 )
         nXResolution = 10;
@@ -364,12 +364,12 @@ sal_Int32 VCoordinateSystem::getMaximumI
     return nRet;
 }
 
-rtl::OUString VCoordinateSystem::createCIDForAxis( const Reference< chart2::XAxis >& xAxis, sal_Int32 nDimensionIndex, sal_Int32 nAxisIndex )
+rtl::OUString VCoordinateSystem::createCIDForAxis( const Reference< chart2::XAxis >& /* xAxis */, sal_Int32 nDimensionIndex, sal_Int32 nAxisIndex )
 {
     rtl::OUString aAxisParticle( ObjectIdentifier::createParticleForAxis( nDimensionIndex, nAxisIndex ) );
     return ObjectIdentifier::createClassifiedIdentifierForParticles( m_aCooSysParticle, aAxisParticle );
 }
-rtl::OUString VCoordinateSystem::createCIDForGrid( const Reference< chart2::XAxis >& xAxis, sal_Int32 nDimensionIndex, sal_Int32 nAxisIndex )
+rtl::OUString VCoordinateSystem::createCIDForGrid( const Reference< chart2::XAxis >& /* xAxis */, sal_Int32 nDimensionIndex, sal_Int32 nAxisIndex )
 {
     rtl::OUString aGridParticle( ObjectIdentifier::createParticleForGrid( nDimensionIndex, nAxisIndex ) );
     return ObjectIdentifier::createClassifiedIdentifierForParticles( m_aCooSysParticle, aGridParticle );
@@ -393,9 +393,9 @@ sal_Int32 VCoordinateSystem::getMaximumA
 }
 
 void VCoordinateSystem::createVAxisList(
-              const uno::Reference< util::XNumberFormatsSupplier > & xNumberFormatsSupplier
-            , const awt::Size& rFontReferenceSize
-            , const awt::Rectangle& rMaximumSpaceForLabels
+              const uno::Reference< util::XNumberFormatsSupplier > & /* xNumberFormatsSupplier */
+            , const awt::Size& /* rFontReferenceSize */
+            , const awt::Rectangle& /* rMaximumSpaceForLabels */
             )
 {
 }
Index: chart2/source/view/axes/VPolarCoordinateSystem.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/axes/VPolarCoordinateSystem.cxx,v
retrieving revision 1.8
retrieving revision 1.8.12.1
diff -u -u -p -r1.8 -r1.8.12.1
--- chart2/source/view/axes/VPolarCoordinateSystem.cxx	22 May 2007 19:13:04 -0000	1.8
+++ chart2/source/view/axes/VPolarCoordinateSystem.cxx	10 Jul 2007 13:48:38 -0000	1.8.12.1
@@ -93,7 +93,7 @@ void VPolarCoordinateSystem::createVAxis
     //    return;
 
     sal_Int32 nDimensionCount = m_xCooSysModel->getDimension();
-    bool bSwapXAndY = this->getPropertySwapXAndYAxis();
+//     bool bSwapXAndY = this->getPropertySwapXAndYAxis();
 
     sal_Int32 nDimensionIndex = 0;
     
Index: chart2/source/view/axes/VPolarGrid.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/axes/VPolarGrid.cxx,v
retrieving revision 1.8
retrieving revision 1.8.12.1
diff -u -u -p -r1.8 -r1.8.12.1
--- chart2/source/view/axes/VPolarGrid.cxx	22 May 2007 19:13:27 -0000	1.8
+++ chart2/source/view/axes/VPolarGrid.cxx	10 Jul 2007 13:48:38 -0000	1.8.12.1
@@ -127,7 +127,7 @@ void VPolarGrid::createLinePointSequence
 }
 
 void VPolarGrid::create2DAngleGrid( const Reference< drawing::XShapes >& xLogicTarget
-        , ::std::vector< ::std::vector< TickInfo > >& rRadiusTickInfos
+        , ::std::vector< ::std::vector< TickInfo > >& /* rRadiusTickInfos */
         , ::std::vector< ::std::vector< TickInfo > >& rAngleTickInfos
         , const ::std::vector<VLineProperties>& rLinePropertiesList )
 {
cvs diff: Diffing chart2/source/view/charttypes
Index: chart2/source/view/charttypes/AreaChart.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/AreaChart.cxx,v
retrieving revision 1.47
retrieving revision 1.47.8.1
diff -u -u -p -r1.47 -r1.47.8.1
--- chart2/source/view/charttypes/AreaChart.cxx	11 Jun 2007 15:03:07 -0000	1.47
+++ chart2/source/view/charttypes/AreaChart.cxx	9 Jul 2007 12:52:57 -0000	1.47.8.1
@@ -738,9 +738,8 @@ void AreaChart::createShapes()
                         }
                     }
 
-                    bool bCreateSymbol = m_bSymbol;
-                    Symbol* pSymbolProperties = (*aSeriesIter)->getSymbolProperties( nIndex );
-                    bCreateSymbol = pSymbolProperties && (pSymbolProperties->Style != SymbolStyle_NONE);
+                    Symbol* pSymbolProperties = m_bSymbol ? (*aSeriesIter)->getSymbolProperties( nIndex ) : 0;
+                    bool bCreateSymbol = pSymbolProperties && (pSymbolProperties->Style != SymbolStyle_NONE);
 
                     if( !bCreateSymbol && !bCreateErrorBar && !pSeries->getDataPointLabelIfLabel(nIndex) )
                         continue;
Index: chart2/source/view/charttypes/BarChart.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/BarChart.cxx,v
retrieving revision 1.18
retrieving revision 1.18.12.1
diff -u -u -p -r1.18 -r1.18.12.1
--- chart2/source/view/charttypes/BarChart.cxx	22 May 2007 19:14:43 -0000	1.18
+++ chart2/source/view/charttypes/BarChart.cxx	6 Jul 2007 14:47:23 -0000	1.18.12.1
@@ -362,7 +362,7 @@ void BarChart::createShapes()
     //---------------------------------------------
     //check necessary here that different Y axis can not be stacked in the same group? ... hm?
 
-    double fLogicZ        = 1.0;//as defined
+    double fLogicZ        = 0.0;//as defined
 
     bool bDrawConnectionLines = false;
     bool bDrawConnectionLinesInited = false;
Index: chart2/source/view/charttypes/BarPositionHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/BarPositionHelper.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/view/charttypes/BarPositionHelper.cxx	22 May 2007 19:15:03 -0000	1.2
+++ chart2/source/view/charttypes/BarPositionHelper.cxx	10 Jul 2007 13:49:01 -0000	1.2.12.1
@@ -48,7 +48,7 @@ namespace chart
 using namespace ::com::sun::star;
 using namespace ::com::sun::star::chart2;
 
-BarPositionHelper::BarPositionHelper( bool bSwapXAndY )
+BarPositionHelper::BarPositionHelper( bool /* bSwapXAndY */ )
         : CategoryPositionHelper( 1 )
 {
 }
Index: chart2/source/view/charttypes/CandleStickChart.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/CandleStickChart.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/view/charttypes/CandleStickChart.cxx	22 May 2007 19:15:23 -0000	1.2
+++ chart2/source/view/charttypes/CandleStickChart.cxx	10 Jul 2007 13:49:01 -0000	1.2.12.1
@@ -107,7 +107,7 @@ double CandleStickChart::getMaximumX()
     }
     return VSeriesPlotter::getMaximumX();
 }
-bool CandleStickChart::isSeperateStackingForDifferentSigns( sal_Int32 nDimensionIndex )
+bool CandleStickChart::isSeperateStackingForDifferentSigns( sal_Int32 /* nDimensionIndex */ )
 {
     return false;
 }
@@ -153,7 +153,7 @@ drawing::Direction3D CandleStickChart::g
     return drawing::Direction3D(-1,-1,-1);
 }
 
-void CandleStickChart::addSeries( VDataSeries* pSeries, sal_Int32 zSlot, sal_Int32 xSlot, sal_Int32 ySlot )
+void CandleStickChart::addSeries( VDataSeries* pSeries, sal_Int32 /* zSlot */, sal_Int32 xSlot, sal_Int32 ySlot )
 {
     //ignore y stacking for candle stick chart
     VSeriesPlotter::addSeries( pSeries, 0, xSlot, ySlot );
Index: chart2/source/view/charttypes/PieChart.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/PieChart.cxx,v
retrieving revision 1.15
retrieving revision 1.15.12.1
diff -u -u -p -r1.15 -r1.15.12.1
--- chart2/source/view/charttypes/PieChart.cxx	22 May 2007 19:16:08 -0000	1.15
+++ chart2/source/view/charttypes/PieChart.cxx	10 Jul 2007 13:49:01 -0000	1.15.12.1
@@ -168,7 +168,7 @@ PieChart::~PieChart()
 //-----------------------------------------------------------------
 
 void SAL_CALL PieChart::setScales( const uno::Sequence< ExplicitScaleData >& rScales
-                                     , sal_Bool bSwapXAndYAxis )
+                                     , sal_Bool /* bSwapXAndYAxis */ )
                             throw (uno::RuntimeException)
 {
     DBG_ASSERT(m_nDimension<=rScales.getLength(),"Dimension of Plotter does not fit two dimension of given scale sequence");
@@ -255,7 +255,7 @@ uno::Reference< drawing::XShape > PieCha
     return xShape;
 }
 
-void PieChart::addSeries( VDataSeries* pSeries, sal_Int32 zSlot, sal_Int32 xSlot, sal_Int32 ySlot )
+void PieChart::addSeries( VDataSeries* pSeries, sal_Int32 /* zSlot */, sal_Int32 /* xSlot */, sal_Int32 /* ySlot */ )
 {
     VSeriesPlotter::addSeries( pSeries, 0, -1, 0 );
 }
@@ -310,37 +310,37 @@ double PieChart::getMaximumX()
         return m_aZSlots[0].size()+0.5+fMaxOffset;
     return 1.5+fMaxOffset;
 }
-double PieChart::getMinimumYInRange( double fMinimumX, double fMaximumX, sal_Int32 nAxisIndex )
+double PieChart::getMinimumYInRange( double /* fMinimumX */, double /* fMaximumX */, sal_Int32 /* nAxisIndex */ )
 {
     return 0.0;
 }
 
-double PieChart::getMaximumYInRange( double fMinimumX, double fMaximumX, sal_Int32 nAxisIndex )
+double PieChart::getMaximumYInRange( double /* fMinimumX */, double /* fMaximumX */, sal_Int32 /* nAxisIndex */ )
 {
     return 1.0;
 }
 
-bool PieChart::isExpandBorderToIncrementRhythm( sal_Int32 nDimensionIndex )
+bool PieChart::isExpandBorderToIncrementRhythm( sal_Int32 /* nDimensionIndex */ )
 {
     return false;
 }
 
-bool PieChart::isExpandIfValuesCloseToBorder( sal_Int32 nDimensionIndex )
+bool PieChart::isExpandIfValuesCloseToBorder( sal_Int32 /* nDimensionIndex */ )
 {
     return false;
 }
 
-bool PieChart::isExpandWideValuesToZero( sal_Int32 nDimensionIndex )
+bool PieChart::isExpandWideValuesToZero( sal_Int32 /* nDimensionIndex */ )
 {
     return false;
 }
 
-bool PieChart::isExpandNarrowValuesTowardZero( sal_Int32 nDimensionIndex )
+bool PieChart::isExpandNarrowValuesTowardZero( sal_Int32 /* nDimensionIndex */ )
 {
     return false;
 }
 
-bool PieChart::isSeperateStackingForDifferentSigns( sal_Int32 nDimensionIndex )
+bool PieChart::isSeperateStackingForDifferentSigns( sal_Int32 /* nDimensionIndex */ )
 {
     return false;
 }
Index: chart2/source/view/charttypes/Splines.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/Splines.cxx,v
retrieving revision 1.9
retrieving revision 1.9.12.3
diff -u -u -p -r1.9 -r1.9.12.3
--- chart2/source/view/charttypes/Splines.cxx	22 May 2007 19:16:34 -0000	1.9
+++ chart2/source/view/charttypes/Splines.cxx	16 Jul 2007 08:28:45 -0000	1.9.12.3
@@ -429,17 +429,6 @@ void BVector(double x, sal_Int32 n, sal_
 			b[i] = TLeft(x, i, j, t) * b[i] + TRight(x, i, j, t) * b [i + 1];
 }
 
-//calculate single point
-void BSPoint(sal_Int32 n, double& rY1, double& rY2
-             , const double* pKnownPointsY, double *b)
-{
-	for (sal_Int32 i = 0; i <= n; i ++)
-	{
-		rY1 = rY1 + b[i] * pKnownPointsY[i];
-		rY2 = rY2 + b[n-i] * pKnownPointsY[i];
-	}
-}
-
 } //  anonymous namespace
 
 //-----------------------------------------------------------------------------
@@ -459,56 +448,101 @@ void SplineCalculater::CalculateCubicSpl
     if( !rInput.SequenceX.getLength() )
         return;
     if( rInput.SequenceX[0].getLength() <= 1 )
-        return;
+        return; //we need at least two points
+
+    sal_Int32 nMaxIndexPoints = rInput.SequenceX[0].getLength()-1; // is >=1
+    const double* pOldX = rInput.SequenceX[0].getConstArray();
+    const double* pOldY = rInput.SequenceY[0].getConstArray();
+    const double* pOldZ = rInput.SequenceZ[0].getConstArray();
+
+    // #i13699# The curve gets a parameter and then for each coordinate a
+    // separate spline will be calculated using the parameter as first argument
+    // and the point coordinate as second argument. Therefore the points need
+    // not to be sorted in its x-coordinates. The parameter is sorted by
+    // construction.
+
+    ::std::vector < double > aParameter(nMaxIndexPoints+1);
+    aParameter[0]=0.0;
+    for( sal_Int32 nIndex=1; nIndex<=nMaxIndexPoints; nIndex++ )
+    {
+        // The euclidian distance leads to curve loops for functions having single extreme points
+//         aParameter[nIndex]=aParameter[nIndex-1]+
+//             sqrt( (pOldX[nIndex]-pOldX[nIndex-1])*(pOldX[nIndex]-pOldX[nIndex-1])+
+//                   (pOldY[nIndex]-pOldY[nIndex-1])*(pOldY[nIndex]-pOldY[nIndex-1])+
+//                   (pOldZ[nIndex]-pOldZ[nIndex-1])*(pOldZ[nIndex]-pOldZ[nIndex-1]));
+
+        // use increment of 1 instead
+        aParameter[nIndex]=aParameter[nIndex-1]+1;
+    }
+    // Split the calculation to X, Y and Z coordinate
+    tPointVecType aInputX;
+    aInputX.resize(nMaxIndexPoints+1);
+    tPointVecType aInputY;
+    aInputY.resize(nMaxIndexPoints+1);
+    tPointVecType aInputZ;
+    aInputZ.resize(nMaxIndexPoints+1);
+    for (sal_Int32 nN=0;nN<=nMaxIndexPoints; nN++ )
+    {
+      aInputX[ nN ].first=aParameter[nN];
+      aInputX[ nN ].second=pOldX[ nN ];
+      aInputY[ nN ].first=aParameter[nN];
+      aInputY[ nN ].second=pOldY[ nN ];
+      aInputZ[ nN ].first=aParameter[nN];
+      aInputZ[ nN ].second=pOldZ[ nN ];
+    }
 
-    drawing::PolyPolygonShape3D aSortedInput;
-    lcl_getSortedPolyPolygonShape3D( rInput, aSortedInput );
+    // generate a spline for each coordinate. It holds the complete
+    // information to calculate each point of the curve
 
-    // calculate second derivates
+    // generate the kind "natural spline"
     double fInfty;
     ::rtl::math::setInf( &fInfty, sal_False );
-    lcl_SplineCalculation aSpline( makeVector(aSortedInput), fInfty, fInfty );
+    lcl_SplineCalculation aSplineX( aInputX, fInfty, fInfty );
+    lcl_SplineCalculation aSplineY( aInputY, fInfty, fInfty );
+    lcl_SplineCalculation aSplineZ( aInputZ, fInfty, fInfty );
 
     // fill result polygon with calculated values
-    lcl_tSizeType nOldPointCount = aSortedInput.SequenceX[0].getLength();
-
     rResult.SequenceX.realloc(1);
     rResult.SequenceY.realloc(1);
     rResult.SequenceZ.realloc(1);
-    rResult.SequenceX[0].realloc( (nOldPointCount-1)*nGranularity + 1);
-    rResult.SequenceY[0].realloc( (nOldPointCount-1)*nGranularity + 1);
-    rResult.SequenceZ[0].realloc( (nOldPointCount-1)*nGranularity + 1);
+    rResult.SequenceX[0].realloc( nMaxIndexPoints*nGranularity + 1);
+    rResult.SequenceY[0].realloc( nMaxIndexPoints*nGranularity + 1);
+    rResult.SequenceZ[0].realloc( nMaxIndexPoints*nGranularity + 1);
 
     double* pNewX = rResult.SequenceX[0].getArray();
     double* pNewY = rResult.SequenceY[0].getArray();
     double* pNewZ = rResult.SequenceZ[0].getArray();
 
-    const double* pOldX = aSortedInput.SequenceX[0].getConstArray();
-    const double* pOldY = aSortedInput.SequenceY[0].getConstArray();
-    const double* pOldZ = aSortedInput.SequenceZ[0].getConstArray();
-
-    //we know that their is at least one point here
-    pNewX[0]=pOldX[0];
-    pNewY[0]=pOldY[0];
-    pNewZ[0]=pOldZ[0];
-
-    // calculate all additional points on spline curve
-    sal_Int32 nNewPointIndex = 1;
-    for( lcl_tSizeType i = 1; i < nOldPointCount; ++i )
-    {
-        double fBaseX = pOldX[ i - 1 ];
-        double fInc = ( pOldX[ i ] - fBaseX ) /
-            static_cast< double >( nGranularity );
+    sal_Int32 nNewPointIndex = 0; // Index in result points
+    // needed for inner loop
+    double    fInc;   // step for intermediate points
+    sal_Int32 nj;     // for loop
+    double    fParam; // a intermediate parameter value
 
-        for( sal_Int32 j = 1; j <= nGranularity; ++j, nNewPointIndex++ )
+    for( sal_Int32 ni = 0; ni < nMaxIndexPoints; ni++ )
+    {
+        // given point is surely a curve point
+        pNewX[nNewPointIndex] = pOldX[ni];
+        pNewY[nNewPointIndex] = pOldY[ni];
+        pNewZ[nNewPointIndex] = pOldZ[ni];
+        nNewPointIndex++;
+
+        // calculate intermediate points
+        fInc = ( aParameter[ ni+1 ] - aParameter[ni] ) / static_cast< double >( nGranularity );
+        for(nj = 1; nj < nGranularity; nj++)
         {
-            double x = fBaseX + ( fInc * static_cast< double >( j ) );
+            fParam = aParameter[ni] + ( fInc * static_cast< double >( nj ) );
 
-            pNewX[nNewPointIndex]=x;
-            pNewY[nNewPointIndex]=aSpline.GetInterpolatedValue( x );
-            pNewZ[nNewPointIndex]=pOldZ[i];
+            pNewX[nNewPointIndex]=aSplineX.GetInterpolatedValue( fParam );
+            pNewY[nNewPointIndex]=aSplineY.GetInterpolatedValue( fParam );
+            pNewZ[nNewPointIndex]=aSplineZ.GetInterpolatedValue( fParam );
+            nNewPointIndex++;
         }
     }
+    // add last point
+    pNewX[nNewPointIndex] = pOldX[nMaxIndexPoints];
+    pNewY[nNewPointIndex] = pOldY[nMaxIndexPoints];
+    pNewZ[nNewPointIndex] = pOldZ[nMaxIndexPoints];
 }
 
 void SplineCalculater::CalculateBSplines(
@@ -517,69 +551,85 @@ void SplineCalculater::CalculateBSplines
             , sal_Int32 nGranularity
 			, sal_Int32 nDegree )
 {
-    nDegree = nDegree + 1;
-
-    DBG_ASSERT( nGranularity > 0, "Granularity is invalid" );
-    rResult.SequenceX.realloc(0);
-    rResult.SequenceY.realloc(0);
-    rResult.SequenceZ.realloc(0);
-
-    if( !rInput.SequenceX.getLength() )
-        return;
-    if( rInput.SequenceX[0].getLength() <= 1 )
-        return;
-
-    drawing::PolyPolygonShape3D aSortedInput;
-    lcl_getSortedPolyPolygonShape3D( rInput, aSortedInput );
-
-    const double* pOldX = aSortedInput.SequenceX[0].getConstArray();
-    const double* pOldY = aSortedInput.SequenceY[0].getConstArray();
-
-    sal_Int32 n = aSortedInput.SequenceX[0].getLength()-1;//maximim index of control points
+	// #issue 72216#
+	// k is the order of the BSpline, nDegree is the degree of its polynoms
+	sal_Int32 k = nDegree + 1;
+
+	rResult.SequenceX.realloc(0);
+	rResult.SequenceY.realloc(0);
+	rResult.SequenceZ.realloc(0);
+	
+	if( !rInput.SequenceX.getLength() )
+		return; // no input
+
+	if( rInput.SequenceX[0].getLength() <= 1 )
+		return; // need at least 2 control points
+		
+	sal_Int32 n = rInput.SequenceX[0].getLength()-1; // maximum index of control points
+	
+	double fCurveparam =0.0; // parameter for the curve
+	// 0<= fCurveparam < fMaxCurveparam
+	double fMaxCurveparam = 2.0+ n - k;
+	if (fMaxCurveparam <= 0.0)
+		return; // not enough control points for desired spline order
+	
+	if (nGranularity < 1)
+		return; //need at least 1 line for each part beween the control points
+
+	const double* pOldX = rInput.SequenceX[0].getConstArray();
+	const double* pOldY = rInput.SequenceY[0].getConstArray();
+	const double* pOldZ = rInput.SequenceZ[0].getConstArray();
+		
+	// keep this amount of steps to go well with old version
 	sal_Int32 nNewSectorCount = nGranularity * n;
+	double fCurveStep = fMaxCurveparam/static_cast< double >(nNewSectorCount);
 
-	double *b       = new double [n + nDegree + 1];
-	double xStep    = ((double) n - (double)nDegree + 2.0) / (double) nNewSectorCount;
-	double dStep    = ( pOldX[n] - pOldX[0] ) / (double) nNewSectorCount;
-	double dXUp     = pOldX[0];
-	double dXDown   = pOldX[n];
-	double x        = 0.0;
+	double *b       = new double [n + k + 1]; // values of blending functions
 
-	const double* t = createTVector(n, nDegree);
+	const double* t = createTVector(n, k); // knot vector
 
-    sal_Int32 nHalf  = nNewSectorCount / 2 + 1;
-    rResult.SequenceX.realloc(1);
-    rResult.SequenceY.realloc(1);
-    rResult.SequenceZ.realloc(1);
-    rResult.SequenceX[0].realloc(nNewSectorCount+1);
-    rResult.SequenceY[0].realloc(nNewSectorCount+1);
-    rResult.SequenceZ[0].realloc(nNewSectorCount+1);
-    double* pNewX = rResult.SequenceX[0].getArray();
-    double* pNewY = rResult.SequenceY[0].getArray();
-    double* pNewZ = rResult.SequenceZ[0].getArray();
-
-    double zValue = rInput.SequenceZ[0][0];
-
-	for(sal_Int32 j=0; j<=nHalf; j++ )
-	{
-        double fY1=0.0;
-        double fY2=0.0;
-
-		BVector(x, n, nDegree, b, t);
-		BSPoint(n, fY1, fY2, pOldY, b);
-
-		pNewX[j]                   = dXUp;
-		pNewY[j]                   = fY1;
-		pNewX[nNewSectorCount - j] = dXDown;
-		pNewY[nNewSectorCount - j] = fY2;
-
-        pNewZ[j]                   = zValue;
-        pNewZ[nNewSectorCount - j] = zValue;
-
-		x      += xStep;
-		dXUp   += dStep;
-		dXDown -= dStep;
+	rResult.SequenceX.realloc(1);
+	rResult.SequenceY.realloc(1);
+	rResult.SequenceZ.realloc(1);
+	rResult.SequenceX[0].realloc(nNewSectorCount+1);
+	rResult.SequenceY[0].realloc(nNewSectorCount+1);
+	rResult.SequenceZ[0].realloc(nNewSectorCount+1);
+	double* pNewX = rResult.SequenceX[0].getArray();
+	double* pNewY = rResult.SequenceY[0].getArray();
+	double* pNewZ = rResult.SequenceZ[0].getArray();
+	
+	// variables needed inside loop, when calculating one point of output
+	sal_Int32 nPointIndex =0; //index of given contol points
+	double fX=0.0;
+	double fY=0.0;
+	double fZ=0.0; //coordinates of a new BSpline point
+
+	for(sal_Int32 nNewSector=0; nNewSector<nNewSectorCount; nNewSector++)
+	{ // in first looping fCurveparam has value 0.0
+		
+		// Calculate the values of the blending functions for actual curve parameter
+		BVector(fCurveparam, n, k, b, t);
+		
+		// output point(fCurveparam) = sum over {input point * value of blending function}
+		fX = 0.0;
+		fY = 0.0;
+		fZ = 0.0;
+		for (nPointIndex=0;nPointIndex<=n;nPointIndex++)
+		{
+			fX +=pOldX[nPointIndex]*b[nPointIndex];
+			fY +=pOldY[nPointIndex]*b[nPointIndex];
+			fZ +=pOldZ[nPointIndex]*b[nPointIndex];
+		}
+		pNewX[nNewSector] = fX;
+		pNewY[nNewSector] = fY;
+		pNewZ[nNewSector] = fZ;
+		
+		fCurveparam += fCurveStep; //for next looping
 	}
+	// add last control point to BSpline curve
+	pNewX[nNewSectorCount] = pOldX[n];
+	pNewY[nNewSectorCount] = pOldY[n];
+	pNewZ[nNewSectorCount] = pOldZ[n];
 
 	delete[] t;
 	delete[] b;
@@ -588,3 +638,4 @@ void SplineCalculater::CalculateBSplines
 //.............................................................................
 } //namespace chart
 //.............................................................................
+
Index: chart2/source/view/charttypes/VSeriesPlotter.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/charttypes/VSeriesPlotter.cxx,v
retrieving revision 1.35
retrieving revision 1.35.12.2
diff -u -u -p -r1.35 -r1.35.12.2
--- chart2/source/view/charttypes/VSeriesPlotter.cxx	22 May 2007 19:17:25 -0000	1.35
+++ chart2/source/view/charttypes/VSeriesPlotter.cxx	10 Jul 2007 13:49:01 -0000	1.35.12.2
@@ -1770,6 +1770,9 @@ std::vector< ViewLegendEntry > SAL_CALL 
         }
 
         // regression curves
+        if ( 3 == m_nDimension )  // #i63016#
+            return aResult;
+
         Reference< XRegressionCurveContainer > xRegrCont( rSeries.getModel(), uno::UNO_QUERY );
         if( xRegrCont.is())
         {
@@ -1820,10 +1823,10 @@ std::vector< ViewLegendEntry > SAL_CALL 
 }
 
 std::vector< ViewLegendEntry > SAL_CALL VSeriesPlotter::createLegendEntriesForChartType(
-            const Reference< beans::XPropertySet >& xTextProperties,
-            const Reference< drawing::XShapes >& xTarget,
-            const Reference< lang::XMultiServiceFactory >& xShapeFactory,
-            const Reference< uno::XComponentContext >& xContext
+            const Reference< beans::XPropertySet >& /* xTextProperties */,
+            const Reference< drawing::XShapes >& /* xTarget */,
+            const Reference< lang::XMultiServiceFactory >& /* xShapeFactory */,
+            const Reference< uno::XComponentContext >& /* xContext */
                 )
 {
     return std::vector< ViewLegendEntry >();
cvs diff: Diffing chart2/source/view/defs
cvs diff: Diffing chart2/source/view/diagram
Index: chart2/source/view/diagram/VDiagram.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/diagram/VDiagram.cxx,v
retrieving revision 1.15
retrieving revision 1.15.4.4
diff -u -u -p -r1.15 -r1.15.4.4
--- chart2/source/view/diagram/VDiagram.cxx	3 Jul 2007 13:45:24 -0000	1.15
+++ chart2/source/view/diagram/VDiagram.cxx	11 Jul 2007 16:43:47 -0000	1.15.4.4
@@ -40,7 +40,6 @@
 #include "ViewDefines.hxx"
 #include "Stripe.hxx"
 #include "macros.hxx"
-#include "Rotation.hxx"
 #include "ObjectIdentifier.hxx"
 #include "DiagramHelper.hxx"
 #include "BaseGFXHelper.hxx"
@@ -187,7 +186,8 @@ void VDiagram::createShapes( const awt::
     if( m_aPreferredAspectRatio.DirectionX > 0 && m_aPreferredAspectRatio.DirectionY > 0)
     {
         //do not change aspect ratio
-        awt::Size  aAspectRatio( m_aPreferredAspectRatio.DirectionX*FIXED_SIZE_FOR_3D_CHART_VOLUME, m_aPreferredAspectRatio.DirectionY*FIXED_SIZE_FOR_3D_CHART_VOLUME );
+        awt::Size  aAspectRatio( static_cast<sal_Int32>(m_aPreferredAspectRatio.DirectionX*FIXED_SIZE_FOR_3D_CHART_VOLUME),
+                                 static_cast<sal_Int32>(m_aPreferredAspectRatio.DirectionY*FIXED_SIZE_FOR_3D_CHART_VOLUME ));
         m_aCurrentSizeWithoutAxes = awt::Size( ShapeFactory::calculateNewSizeRespectingAspectRatio(
                         rAvailableSize, aAspectRatio ) );
         //center diagram position
@@ -386,9 +386,9 @@ void VDiagram::adjustAspectRatio3d( cons
                 double fW = rAvailableSize.Width;
                 double fH = rAvailableSize.Height;
 
-                double cx = fabs(cos(m_fXAnglePi));
+//                 double cx = fabs(cos(m_fXAnglePi));
                 double sx = fabs(sin(m_fXAnglePi));
-                double cy = fabs(cos(m_fYAnglePi));
+//                 double cy = fabs(cos(m_fYAnglePi));
                 double sy = fabs(sin(m_fYAnglePi));
                 double cz = fabs(cos(m_fZAnglePi));
                 double sz = fabs(sin(m_fZAnglePi));
@@ -791,14 +791,14 @@ void VDiagram::reduceToMimimumSize()
     ::basegfx::B2IRectangle rAvailableOuterRect(
         BaseGFXHelper::makeRectangle(m_aAvailablePosIncludingAxes,m_aAvailableSizeIncludingAxes) );
     
-    sal_Int32 nDeltaWidth = rAvailableOuterRect.getWidth() - rConsumedOuterRect.getWidth();
-    sal_Int32 nDeltaHeight = rAvailableOuterRect.getHeight() - rConsumedOuterRect.getHeight();
+    sal_Int32 nDeltaWidth = static_cast<sal_Int32>(rAvailableOuterRect.getWidth() - rConsumedOuterRect.getWidth());
+    sal_Int32 nDeltaHeight = static_cast<sal_Int32>(rAvailableOuterRect.getHeight() - rConsumedOuterRect.getHeight());
     if( (aNewSize.Width + nDeltaWidth) < rAvailableOuterRect.getWidth()/3 )
-        nDeltaWidth = rAvailableOuterRect.getWidth()/3 - aNewSize.Width;
+        nDeltaWidth = static_cast<sal_Int32>(rAvailableOuterRect.getWidth()/3 - aNewSize.Width);
     aNewSize.Width += nDeltaWidth;
     
     if( (aNewSize.Height + nDeltaHeight) < rAvailableOuterRect.getHeight()/3 )
-        nDeltaHeight = rAvailableOuterRect.getHeight()/3 - aNewSize.Height;
+        nDeltaHeight = static_cast<sal_Int32>(rAvailableOuterRect.getHeight()/3 - aNewSize.Height);
     aNewSize.Height += nDeltaHeight;
 
     sal_Int32 nDiffLeft = rConsumedOuterRect.getMinX() - rAvailableOuterRect.getMinX();
cvs diff: Diffing chart2/source/view/inc
cvs diff: Diffing chart2/source/view/main
Index: chart2/source/view/main/ChartItemPool.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/ChartItemPool.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/view/main/ChartItemPool.cxx	22 May 2007 19:22:25 -0000	1.2
+++ chart2/source/view/main/ChartItemPool.cxx	10 Jul 2007 13:48:52 -0000	1.2.12.1
@@ -497,7 +497,7 @@ SfxItemPool* ChartItemPool::Clone() cons
 	return new ChartItemPool(*this);
 }
 
-SfxMapUnit ChartItemPool::GetMetric(USHORT nWhich) const
+SfxMapUnit ChartItemPool::GetMetric(USHORT /* nWhich */) const
 {
 	return SFX_MAPUNIT_100TH_MM;
 }
Index: chart2/source/view/main/ChartView.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/ChartView.cxx,v
retrieving revision 1.37
retrieving revision 1.37.8.4
diff -u -u -p -r1.37 -r1.37.8.4
--- chart2/source/view/main/ChartView.cxx	11 Jun 2007 15:03:54 -0000	1.37
+++ chart2/source/view/main/ChartView.cxx	12 Jul 2007 13:20:33 -0000	1.37.8.4
@@ -212,6 +212,10 @@ ChartView::ChartView(
     , m_bViewUpdatePending(false)
     , m_bRefreshAddIn(true)
     , m_aPageResolution(1000,1000)
+    , m_nScaleXNumerator(1)
+    , m_nScaleXDenominator(1)
+    , m_nScaleYNumerator(1)
+    , m_nScaleYDenominator(1)
 {
 }
 
@@ -240,9 +244,12 @@ void SAL_CALL ChartView::initialize( con
 
     if( !m_pDrawModelWrapper.get() )
     {
+        // /--
+        ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
         m_pDrawModelWrapper = ::boost::shared_ptr< DrawModelWrapper >( new DrawModelWrapper( m_xCC ) );
         m_xShapeFactory = m_pDrawModelWrapper->getShapeFactory();
         m_xDrawPage = m_pDrawModelWrapper->getMainDrawPage();
+        // \--
     }
 }
 
@@ -273,6 +280,23 @@ const rtl::OUString lcl_aGDIMetaFileMIME
     RTL_CONSTASCII_USTRINGPARAM("application/x-openoffice-gdimetafile;windows_formatname=\"GDIMetaFile\""));
 const rtl::OUString lcl_aGDIMetaFileMIMETypeHighContrast(
     RTL_CONSTASCII_USTRINGPARAM("application/x-openoffice-highcontrast-gdimetafile;windows_formatname=\"GDIMetaFile\""));
+
+bool lcl_IgnoreCurrentZoom( uno::Reference< frame::XModel > xModel )
+{
+    bool bIgnoreCurrentZoom = false; 
+    uno::Reference< container::XChild > xChild( xModel, uno::UNO_QUERY );
+    if( xChild.is() )
+    {
+        uno::Reference< lang::XServiceInfo > xParentInfo( xChild->getParent(), uno::UNO_QUERY );
+        if( xParentInfo.is() )
+        {
+            if( xParentInfo->supportsService( C2U("com.sun.star.presentation.PresentationDocument") ) )
+                bIgnoreCurrentZoom = true;//optimize for presentation mode
+        }
+    }
+    return bIgnoreCurrentZoom;
+}
+
 } // anonymous namespace
 
 void ChartView::getMetaFile( const uno::Reference< io::XOutputStream >& xOutStream
@@ -313,6 +337,20 @@ void ChartView::getMetaFile( const uno::
     aFilterData[3].Name = C2U("CurrentPage");
     aFilterData[3].Value <<= uno::Reference< uno::XInterface >( m_xDrawPage, uno::UNO_QUERY );
 
+    //#i75867# poor quality of ole's alternative view with 3D scenes and zoomfactors besides 100%
+    if( !lcl_IgnoreCurrentZoom( m_xChartModel ) )
+    {
+        aFilterData.realloc( aFilterData.getLength()+4 );
+        aFilterData[4].Name = C2U("ScaleXNumerator");
+        aFilterData[4].Value = uno::makeAny( m_nScaleXNumerator );
+        aFilterData[5].Name = C2U("ScaleXDenominator");
+        aFilterData[5].Value = uno::makeAny( m_nScaleXDenominator );
+        aFilterData[6].Name = C2U("ScaleYNumerator");
+        aFilterData[6].Value = uno::makeAny( m_nScaleYNumerator );
+        aFilterData[7].Name = C2U("ScaleYDenominator");
+        aFilterData[7].Value = uno::makeAny( m_nScaleYDenominator );
+    }
+
     aProps[2].Name = C2U("FilterData");
     aProps[2].Value <<= aFilterData;
 
@@ -391,7 +429,7 @@ uno::Sequence< datatransfer::DataFlavor 
 														 aIdentifier.getConstArray(), 16 ) )
 	{
         ExplicitValueProvider* pProvider = this;
-        return (sal_Int64)pProvider;
+        return reinterpret_cast<sal_Int64>(pProvider);
 	}
 	return 0;
 }
@@ -608,7 +646,7 @@ SeriesPlotterContainer::SeriesPlotterCon
 SeriesPlotterContainer::~SeriesPlotterContainer()
 {
     // - remove plotter from coordinatesystems
-    for( sal_Int32 nC=0; nC < m_rVCooSysList.size(); nC++)
+    for( size_t nC=0; nC < m_rVCooSysList.size(); nC++)
         m_rVCooSysList[nC]->clearMinimumAndMaximumSupplierList();
     // - delete all plotter
     ::std::vector< VSeriesPlotter* >::const_iterator       aPlotterIter = m_aSeriesPlotterList.begin();
@@ -752,6 +790,9 @@ void SeriesPlotterContainer::initializeC
                     case StackingDirection_Z_STACKING:
                         zSlot++; xSlot=-1; ySlot=-1;
                         break;
+                    default:
+                        // UNO enums have one additional auto-generated case
+                        break;
                 }
                 pPlotter->addSeries( pSeries, zSlot, xSlot, ySlot );
             }
@@ -891,7 +932,7 @@ void SeriesPlotterContainer::setNumberFo
 
 void SeriesPlotterContainer::updateScalesAndIncrementsOnAxes()
 {
-    for( sal_Int32 nC=0; nC < m_rVCooSysList.size(); nC++)
+    for( size_t nC=0; nC < m_rVCooSysList.size(); nC++)
         m_rVCooSysList[nC]->updateScalesAndIncrementsOnAxes();
 }
 
@@ -1041,7 +1082,7 @@ void ChartView::impl_createDiagramAndCon
             , const awt::Size& rAvailableSize
             , const awt::Size& rPageSize )
 {
-    sal_Int32 nDiagramIndex = 0;//todo if more than one diagam is supported
+//     sal_Int32 nDiagramIndex = 0;//todo if more than one diagam is supported
     uno::Reference< XDiagram > xDiagram( ChartModelHelper::findDiagram( m_xChartModel ) );
     if( !xDiagram.is())
         return;
@@ -1060,7 +1101,7 @@ void ChartView::impl_createDiagramAndCon
 
     //create VAxis, so they can give necessary information for automatic scaling
     uno::Reference< util::XNumberFormatsSupplier > xNumberFormatsSupplier( m_xChartModel, uno::UNO_QUERY );
-    sal_Int32 nC = 0;
+    size_t nC = 0;
     for( nC=0; nC < rVCooSysList.size(); nC++)
     {
         VCoordinateSystem* pVCooSys = rVCooSysList[nC];
@@ -1084,7 +1125,7 @@ void ChartView::impl_createDiagramAndCon
     //aspect ratio
     drawing::Direction3D aPreferredAspectRatio(
         rSeriesPlotterContainer.getPreferredAspectRatio() );
-    bool bKeepAspectRatio = rSeriesPlotterContainer.shouldKeep2DAspectRatio();
+//     bool bKeepAspectRatio = rSeriesPlotterContainer.shouldKeep2DAspectRatio();
     
     uno::Reference< drawing::XShapes > xCoordinateRegionTarget(0);
     VDiagram aVDiagram(xDiagram, aPreferredAspectRatio, nDimensionCount);
@@ -1464,11 +1505,11 @@ sal_Int32 ExplicitValueProvider::getExpl
                                     continue;
                                 Reference< data::XDataSequence > xSeq( aLabeledSeq[nLSeqIdx]->getValues());
                                 OSL_ASSERT( xSeq.is());
-                                Reference< beans::XPropertySet > xProp( xSeq, uno::UNO_QUERY );
+                                Reference< beans::XPropertySet > xSeqProp( xSeq, uno::UNO_QUERY );
                                 ::rtl::OUString aRole;
                                 bool bTakeIntoAccount =
-                                    ( xProp.is() && (aRoleToMatch.getLength() > 0) &&
-                                    (xProp->getPropertyValue(C2U("Role")) >>= aRole ) &&
+                                    ( xSeqProp.is() && (aRoleToMatch.getLength() > 0) &&
+                                    (xSeqProp->getPropertyValue(C2U("Role")) >>= aRole ) &&
                                     aRole.equals( aRoleToMatch ));
 
                                 if( bTakeIntoAccount )
@@ -1976,7 +2017,12 @@ void ChartView::createShapes()
 
     impl_deleteCoordinateSystems();
     if( m_pDrawModelWrapper )
+    {
+        // /--
+        ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
         m_pDrawModelWrapper->clearMainDrawPage();
+        // \--
+    }
 
     awt::Size aPageSize = ChartModelHelper::getPageSize( m_xChartModel );
 
@@ -2100,7 +2146,7 @@ void ChartView::createShapes()
 //-----------------------------------------------------------------
 // util::XEventListener (base of XCloseListener)
 //-----------------------------------------------------------------
-void SAL_CALL ChartView::disposing( const lang::EventObject& rSource )
+void SAL_CALL ChartView::disposing( const lang::EventObject& /* rSource */ )
 		throw(uno::RuntimeException)
 {
     impl_setChartModel( 0 );
@@ -2121,9 +2167,14 @@ void ChartView::impl_updateView()
 		    impl_notifyModeChangeListener(C2U("invalid"));
 
 		    //prepare draw model
-		    m_pDrawModelWrapper->lockControllers();
-		    m_pDrawModelWrapper->updateTablesFromChartModel( m_xChartModel );
-    		
+            {
+                // /--
+                ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
+                m_pDrawModelWrapper->lockControllers();
+                m_pDrawModelWrapper->updateTablesFromChartModel( m_xChartModel );
+                // \--
+            }
+
 		    //create chart view
 		    {
 			    /*
@@ -2165,8 +2216,13 @@ void ChartView::impl_updateView()
 		    ASSERT_EXCEPTION( ex );
 	    }
 
-        m_pDrawModelWrapper->unlockControllers();
-        
+        {
+            // /--
+            ::vos::OGuard aSolarGuard( Application::GetSolarMutex());
+            m_pDrawModelWrapper->unlockControllers();
+            // \--
+        }
+
 	    impl_notifyModeChangeListener(C2U("valid"));
 
         //m_bRefreshAddIn = bOldRefreshAddIn;
@@ -2174,7 +2230,7 @@ void ChartView::impl_updateView()
 }
 
 // ____ XModifyListener ____
-void SAL_CALL ChartView::modified( const lang::EventObject& aEvent )
+void SAL_CALL ChartView::modified( const lang::EventObject& /* aEvent */ )
     throw (uno::RuntimeException)
 {
     m_bViewDirty = sal_True;
@@ -2218,12 +2274,12 @@ void SAL_CALL ChartView::removeModeChang
     m_aListenerContainer.removeInterface(
         ::getCppuType((const uno::Reference< util::XModeChangeListener >*)0), xListener );
 }
-void SAL_CALL ChartView::addModeChangeApproveListener( const uno::Reference< util::XModeChangeApproveListener >& _rxListener )
+void SAL_CALL ChartView::addModeChangeApproveListener( const uno::Reference< util::XModeChangeApproveListener >& /* _rxListener */ )
     throw (lang::NoSupportException, uno::RuntimeException)
 {
 
 }
-void SAL_CALL ChartView::removeModeChangeApproveListener( const uno::Reference< util::XModeChangeApproveListener >& _rxListener )
+void SAL_CALL ChartView::removeModeChangeApproveListener( const uno::Reference< util::XModeChangeApproveListener >& /* _rxListener */ )
     throw (lang::NoSupportException, uno::RuntimeException)
 {
 
@@ -2265,6 +2321,29 @@ void SAL_CALL ChartView::setPropertyValu
                 this->modified( lang::EventObject(  static_cast< uno::XWeak* >( this )  ) );
         }
     }
+    else if( rPropertyName.equals(C2U("ZoomFactors")) )
+    {
+        //#i75867# poor quality of ole's alternative view with 3D scenes and zoomfactors besides 100%
+        uno::Sequence< beans::PropertyValue > aZoomFactors;
+        if( ! (rValue >>= aZoomFactors) )
+            throw lang::IllegalArgumentException( C2U("Property 'ZoomFactors' requires value of type Sequence< PropertyValue >"), 0, 0 );
+
+        sal_Int32 nFilterArgs = aZoomFactors.getLength();
+        beans::PropertyValue* pDataValues = aZoomFactors.getArray();
+        while( nFilterArgs-- )
+        {
+            if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleXNumerator" ) ) )
+                pDataValues->Value >>= m_nScaleXNumerator;
+            else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleXDenominator" ) ) )
+                pDataValues->Value >>= m_nScaleXDenominator;
+            else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleYNumerator" ) ) )
+                pDataValues->Value >>= m_nScaleYNumerator;
+            else if( pDataValues->Name.equalsAsciiL( RTL_CONSTASCII_STRINGPARAM( "ScaleYDenominator" ) ) )
+                pDataValues->Value >>= m_nScaleYDenominator;
+
+            pDataValues++;
+        }
+    }
     else
         throw beans::UnknownPropertyException( C2U("unknown property was tried to set to chart wizard"), 0 );
 }
@@ -2283,25 +2362,25 @@ Any SAL_CALL ChartView::getPropertyValue
 }
 
 void SAL_CALL ChartView::addPropertyChangeListener(
-        const ::rtl::OUString& aPropertyName, const Reference< beans::XPropertyChangeListener >& xListener )
+    const ::rtl::OUString& /* aPropertyName */, const Reference< beans::XPropertyChangeListener >& /* xListener */ )
         throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
 void SAL_CALL ChartView::removePropertyChangeListener(
-    const ::rtl::OUString& aPropertyName, const Reference< beans::XPropertyChangeListener >& aListener )
+    const ::rtl::OUString& /* aPropertyName */, const Reference< beans::XPropertyChangeListener >& /* aListener */ )
     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
 
-void SAL_CALL ChartView::addVetoableChangeListener( const ::rtl::OUString& PropertyName, const Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL ChartView::addVetoableChangeListener( const ::rtl::OUString& /* PropertyName */, const Reference< beans::XVetoableChangeListener >& /* aListener */ )
     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
 }
 
-void SAL_CALL ChartView::removeVetoableChangeListener( const ::rtl::OUString& PropertyName, const Reference< beans::XVetoableChangeListener >& aListener )
+void SAL_CALL ChartView::removeVetoableChangeListener( const ::rtl::OUString& /* PropertyName */, const Reference< beans::XVetoableChangeListener >& /* aListener */ )
     throw (beans::UnknownPropertyException, lang::WrappedTargetException, uno::RuntimeException)
 {
     OSL_ENSURE(false,"not implemented");
Index: chart2/source/view/main/ChartView.hxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/ChartView.hxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/view/main/ChartView.hxx	22 May 2007 19:22:55 -0000	1.2
+++ chart2/source/view/main/ChartView.hxx	12 Jul 2007 13:19:29 -0000	1.2.12.1
@@ -251,6 +251,12 @@ private: //member
 
     //better performance for big data
     ::com::sun::star::awt::Size m_aPageResolution;
+
+    //#i75867# poor quality of ole's alternative view with 3D scenes and zoomfactors besides 100%
+    sal_Int32 m_nScaleXNumerator;
+    sal_Int32 m_nScaleXDenominator;
+    sal_Int32 m_nScaleYNumerator;
+    sal_Int32 m_nScaleYDenominator;
 };
 
 //.............................................................................
Index: chart2/source/view/main/PlottingPositionHelper.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/PlottingPositionHelper.cxx,v
retrieving revision 1.13
retrieving revision 1.13.12.2
diff -u -u -p -r1.13 -r1.13.12.2
--- chart2/source/view/main/PlottingPositionHelper.cxx	22 May 2007 19:25:05 -0000	1.13
+++ chart2/source/view/main/PlottingPositionHelper.cxx	10 Jul 2007 14:33:40 -0000	1.13.12.2
@@ -570,9 +570,9 @@ double PolarPlottingPositionHelper::tran
         }
 
         if( bMinIsInnerRadius )
-            fInnerScaledLogicRadius -= abs(m_fRadiusOffset);
+            fInnerScaledLogicRadius -= fabs(m_fRadiusOffset);
         else
-            fInnerScaledLogicRadius += abs(m_fRadiusOffset);
+            fInnerScaledLogicRadius += fabs(m_fRadiusOffset);
         fNormalRadius = (fScaledLogicRadiusValue-fInnerScaledLogicRadius)/(fOuterScaledLogicRadius-fInnerScaledLogicRadius);
     }
     return fNormalRadius;
@@ -596,7 +596,7 @@ drawing::Position3D PolarPlottingPositio
     return this->transformAngleRadiusToScene( fLogicValueOnAngleAxis, fLogicValueOnRadiusAxis, fZ, false );
 }
 drawing::Position3D PolarPlottingPositionHelper::transformUnitCircleToScene( double fUnitAngleDegree, double fUnitRadius
-                                                                            , double fLogicZ, bool bDoScaling ) const
+                                                                            , double fLogicZ, bool /* bDoScaling */ ) const
 {
     double fAnglePi = fUnitAngleDegree*F_PI/180.0;
 
Index: chart2/source/view/main/ShapeFactory.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/ShapeFactory.cxx,v
retrieving revision 1.23
retrieving revision 1.23.8.1
diff -u -u -p -r1.23 -r1.23.8.1
--- chart2/source/view/main/ShapeFactory.cxx	11 Jun 2007 15:04:20 -0000	1.23
+++ chart2/source/view/main/ShapeFactory.cxx	11 Jul 2007 15:03:58 -0000	1.23.8.1
@@ -250,7 +250,7 @@ uno::Any createPolyPolygon_Cube(
     //fWidthH stands for Half Width
     const double fWidthH = rSize.DirectionX >=0.0?  rSize.DirectionX/2.0  : -rSize.DirectionX/2.0;
     const double fHeight = rSize.DirectionY;
-    const double fDepth  = rSize.DirectionZ >=0.0?  rSize.DirectionZ      : -rSize.DirectionZ ;
+//     const double fDepth  = rSize.DirectionZ >=0.0?  rSize.DirectionZ      : -rSize.DirectionZ ;
 
     const double fHeightSign = fHeight >= 0.0 ? 1.0 : -1.0;
 
Index: chart2/source/view/main/VDataSeries.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/VDataSeries.cxx,v
retrieving revision 1.25
retrieving revision 1.25.8.1
diff -u -u -p -r1.25 -r1.25.8.1
--- chart2/source/view/main/VDataSeries.cxx	11 Jun 2007 15:04:31 -0000	1.25
+++ chart2/source/view/main/VDataSeries.cxx	11 Jul 2007 14:49:20 -0000	1.25.8.1
@@ -154,12 +154,15 @@ VDataSeries::VDataSeries()
 }
 
 VDataSeries::VDataSeries( const uno::Reference< XDataSeries >& xDataSeries )
-    : m_xGroupShape(NULL)
+    : m_nPolygonIndex(0)
+    , m_fLogicMinX(0.0)
+    , m_fLogicMaxX(0.0)
+    , m_fLogicZPos(0.0)
+    , m_xGroupShape(NULL)
     , m_xLabelsGroupShape(NULL)
     , m_xErrorBarsGroupShape(NULL)
     , m_xFrontSubGroupShape(NULL)
     , m_xBackSubGroupShape(NULL)
-    , m_nPolygonIndex(0)
     , m_xDataSeries(xDataSeries)
     , m_aDataSequences()
     , m_nPointCount(0)
@@ -188,14 +191,14 @@ VDataSeries::VDataSeries( const uno::Ref
     , m_apLabel_Series(NULL)
     , m_apLabelPropNames_Series(NULL)
     , m_apLabelPropValues_Series(NULL)
+    , m_apSymbolProperties_Series(NULL)
+
     , m_apLabel_AttributedPoint(NULL)
     , m_apLabelPropNames_AttributedPoint(NULL)
     , m_apLabelPropValues_AttributedPoint(NULL)
-
-    , m_nCurrentAttributedPoint(-1)
-    , m_apSymbolProperties_Series(NULL)
     , m_apSymbolProperties_AttributedPoint(NULL)
     , m_apSymbolProperties_InvisibleSymbolForSelection(NULL)
+    , m_nCurrentAttributedPoint(-1)
 {
     uno::Reference<data::XDataSource> xDataSource =
             uno::Reference<data::XDataSource>( xDataSeries, uno::UNO_QUERY );
Index: chart2/source/view/main/_serviceregistration_view.cxx
===================================================================
RCS file: /cvs/graphics/chart2/source/view/main/_serviceregistration_view.cxx,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -u -p -r1.2 -r1.2.12.1
--- chart2/source/view/main/_serviceregistration_view.cxx	22 May 2007 19:27:47 -0000	1.2
+++ chart2/source/view/main/_serviceregistration_view.cxx	10 Jul 2007 13:48:52 -0000	1.2.12.1
@@ -60,7 +60,7 @@ extern "C"
 {
 //==================================================================================================
 void SAL_CALL component_getImplementationEnvironment(
-	const sal_Char ** ppEnvTypeName, uno_Environment ** ppEnv )
+	const sal_Char ** ppEnvTypeName, uno_Environment ** /* ppEnv */ )
 {
 	*ppEnvTypeName = CPPU_CURRENT_LANGUAGE_BINDING_NAME;
 }
cvs diff: Diffing chart2/uiconfig
cvs diff: Diffing chart2/uiconfig/accelerator
cvs diff: Diffing chart2/uiconfig/accelerator/en-US
cvs diff: Diffing chart2/uiconfig/menubar
cvs diff: Diffing chart2/uiconfig/statusbar
cvs diff: Diffing chart2/uiconfig/toolbar
cvs diff: Diffing chart2/util
cvs diff: Diffing chart2/workbench
cvs diff: Diffing chart2/workbench/addin
cvs diff: Diffing chart2/workbench/anyperformance
cvs diff: Diffing chart2/workbench/fileformat
cvs diff: Diffing chart2/workbench/officeintegration
cvs diff: Diffing chart2/workbench/sampledata
cvs diff: Diffing chart2/workbench/stub
