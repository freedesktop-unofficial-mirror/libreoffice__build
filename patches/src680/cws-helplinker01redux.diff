Index: helpcontent2/makefile.pmk
===================================================================
RCS file: /cvs/documentation/helpcontent2/makefile.pmk,v
retrieving revision 1.23
retrieving revision 1.23.4.1
diff -u -p -u -p -r1.23 -r1.23.4.1
--- helpcontent2/makefile.pmk	8 Jun 2007 16:13:43 -0000	1.23
+++ helpcontent2/makefile.pmk	13 Jun 2007 13:07:36 -0000	1.23.4.1
@@ -36,9 +36,7 @@
 SHELL_PACKAGE:=$(subst,/,$/ $(PACKAGE))
 HLANGXHPFILES:=$(foreach,i,$(XHPFILES) $(foreach,j,$(aux_alllangiso) $(COMMONMISC)$/$j$/$(SHELL_PACKAGE)$/$(i:f)))
 
-.IF "$(SOLAR_JAVA)"!=""
 ALLTAR : $(COMMONMISC)$/$(TARGET).done $(COMMONMISC)$/xhp_changed.flag optix
-.ENDIF
 
 $(HLANGXHPFILES) : $$(@:d)thisdir.created
 
Index: helpcontent2/helpers/linkmakefile.template
===================================================================
RCS file: /cvs/documentation/helpcontent2/helpers/linkmakefile.template,v
retrieving revision 1.10
retrieving revision 1.10.4.1
diff -u -p -u -p -r1.10 -r1.10.4.1
--- helpcontent2/helpers/linkmakefile.template	8 Jun 2007 16:12:22 -0000	1.10
+++ helpcontent2/helpers/linkmakefile.template	13 Jun 2007 13:07:25 -0000	1.10.4.1
@@ -26,7 +26,6 @@ TARGET  = util_%module%
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_%module%
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/%module%$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=%module%
 LINKADDEDFILES= \
Index: helpcontent2/util/target.pmk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/target.pmk,v
retrieving revision 1.18
retrieving revision 1.18.4.1
diff -u -p -u -p -r1.18 -r1.18.4.1
--- helpcontent2/util/target.pmk	8 Jun 2007 16:35:26 -0000	1.18
+++ helpcontent2/util/target.pmk	13 Jun 2007 13:07:15 -0000	1.18.4.1
@@ -36,27 +36,7 @@
 LINKALLTARGETS=$(foreach,i,$(aux_alllangiso) $(BIN)$/$(LINKNAME)_$i.zip)
 LINKALLADDEDDEPS=$(foreach,i,$(aux_alllangiso) $(subst,LANGUAGE,$i $(LINKADDEDDPES)))
 
-.IF "$(SOLAR_JAVA)"!=""
 ALLTAR : $(LINKALLTARGETS)
-.ENDIF
-
-.IF "$(SYSTEM_DB)" != "YES"
-JAVA_LIBRARY_PATH= -Djava.library.path=$(SOLARSHAREDBIN)
-.ENDIF
-
-.IF "$(JDK)" != "gcj"
-JAVA_VM_HEAP_SIZE = -Xms256m -Xmx256m
-.ENDIF
-
-.IF "$(JAVAAOTCOMPILER)" != ""
-CLASSPATH!:=$(my_cp)
-.EXPORT : CLASSPATH
-.ENDIF
 
 $(LINKALLTARGETS) : $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/$$(@:b:s/_/./:e:s/.//)/$i) $(subst,LANGUAGE,$$(@:b:s/_/./:e:s/.//) $(LINKADDEDDEPS)) $(COMMONMISC)$/xhp_changed.flag
-.IF "$(JAVAAOTCOMPILER)" != ""
-	com.sun.star.help.HelpLinker @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -idx $(PRJ)$/source$/auxiliary$/index.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
-.ELSE
-	$(JAVAI) $(JAVA_VM_HEAP_SIZE) $(JAVA_LIBRARY_PATH) -Djavax.xml.parsers.SAXParserFactory=org.apache.xerces.jaxp.SAXParserFactoryImpl -Djavax.xml.parsers.DocumentBuilderFactory=org.apache.xerces.jaxp.DocumentBuilderFactoryImpl -cp $(my_cp) com.sun.star.help.HelpLinker @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -idx $(PRJ)$/source$/auxiliary$/index.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
-.ENDIF
-
+	$(WRAPCMD) HelpLinker @$(mktmp -mod $(LINKNAME) -hid $(PRJ)$/helpers/hid.lst -src $(COMMONMISC) -sty $(PRJ)$/source$/auxiliary$/embed.xsl -idx $(PRJ)$/source$/auxiliary$/index.xsl -lang {$(subst,$(LINKNAME)_, $(@:b))} $(subst,LANGUAGE,{$(subst,$(LINKNAME)_, $(@:b))} $(LINKADDEDFILES)) $(foreach,i,$(LINKLINKFILES) $(COMMONMISC)$/{$(subst,$(LINKNAME)_, $(@:b))}/$i) -o $@)
Index: helpcontent2/util/sbasic/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/sbasic/makefile.mk,v
retrieving revision 1.30
retrieving revision 1.30.2.1
diff -u -p -u -p -r1.30 -r1.30.2.1
--- helpcontent2/util/sbasic/makefile.mk	8 Jun 2007 16:20:35 -0000	1.30
+++ helpcontent2/util/sbasic/makefile.mk	13 Jun 2007 13:07:16 -0000	1.30.2.1
@@ -26,7 +26,6 @@ TARGET  = util_sbasic
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_sbasic
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/sbasic$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=sbasic
 LINKADDEDFILES= \
Index: helpcontent2/util/scalc/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/scalc/makefile.mk,v
retrieving revision 1.34
retrieving revision 1.34.2.1
diff -u -p -u -p -r1.34 -r1.34.2.1
--- helpcontent2/util/scalc/makefile.mk	8 Jun 2007 16:22:12 -0000	1.34
+++ helpcontent2/util/scalc/makefile.mk	13 Jun 2007 13:07:16 -0000	1.34.2.1
@@ -26,7 +26,6 @@ TARGET  = util_scalc
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_scalc
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/scalc$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=scalc
 LINKADDEDFILES= \
Index: helpcontent2/util/schart/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/schart/makefile.mk,v
retrieving revision 1.19
retrieving revision 1.19.2.1
diff -u -p -u -p -r1.19 -r1.19.2.1
--- helpcontent2/util/schart/makefile.mk	8 Jun 2007 16:23:29 -0000	1.19
+++ helpcontent2/util/schart/makefile.mk	13 Jun 2007 13:07:17 -0000	1.19.2.1
@@ -26,7 +26,6 @@ TARGET  = util_schart
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_schart
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/schart$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=schart
 LINKADDEDFILES= \
Index: helpcontent2/util/sdatabase/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/sdatabase/makefile.mk,v
retrieving revision 1.19
retrieving revision 1.19.2.1
diff -u -p -u -p -r1.19 -r1.19.2.1
--- helpcontent2/util/sdatabase/makefile.mk	8 Jun 2007 16:27:01 -0000	1.19
+++ helpcontent2/util/sdatabase/makefile.mk	13 Jun 2007 13:07:17 -0000	1.19.2.1
@@ -26,7 +26,6 @@ TARGET  = util_sdatabase
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_sdatabase
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/shared$/explorer$/database$/main.xhp
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=sdatabase
 LINKADDEDFILES= \
Index: helpcontent2/util/sdraw/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/sdraw/makefile.mk,v
retrieving revision 1.31
retrieving revision 1.31.2.1
diff -u -p -u -p -r1.31 -r1.31.2.1
--- helpcontent2/util/sdraw/makefile.mk	8 Jun 2007 16:28:42 -0000	1.31
+++ helpcontent2/util/sdraw/makefile.mk	13 Jun 2007 13:07:17 -0000	1.31.2.1
@@ -26,7 +26,6 @@ TARGET  = util_sdraw
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_sdraw
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/sdraw$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=sdraw
 LINKADDEDFILES= \
Index: helpcontent2/util/shared/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/shared/makefile.mk,v
retrieving revision 1.17
retrieving revision 1.17.2.1
diff -u -p -u -p -r1.17 -r1.17.2.1
--- helpcontent2/util/shared/makefile.mk	8 Jun 2007 16:29:59 -0000	1.17
+++ helpcontent2/util/shared/makefile.mk	13 Jun 2007 13:07:17 -0000	1.17.2.1
@@ -26,7 +26,6 @@ TARGET  = util_shared
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_shared
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/shared$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=shared
 LINKADDEDFILES= \
Index: helpcontent2/util/simpress/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/simpress/makefile.mk,v
retrieving revision 1.30
retrieving revision 1.30.2.1
diff -u -p -u -p -r1.30 -r1.30.2.1
--- helpcontent2/util/simpress/makefile.mk	8 Jun 2007 16:31:27 -0000	1.30
+++ helpcontent2/util/simpress/makefile.mk	13 Jun 2007 13:07:18 -0000	1.30.2.1
@@ -26,7 +26,6 @@ TARGET  = util_simpress
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_simpress
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/simpress$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=simpress
 LINKADDEDFILES= \
Index: helpcontent2/util/smath/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/smath/makefile.mk,v
retrieving revision 1.29
retrieving revision 1.29.2.1
diff -u -p -u -p -r1.29 -r1.29.2.1
--- helpcontent2/util/smath/makefile.mk	8 Jun 2007 16:33:17 -0000	1.29
+++ helpcontent2/util/smath/makefile.mk	13 Jun 2007 13:07:18 -0000	1.29.2.1
@@ -26,7 +26,6 @@ TARGET  = util_smath
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_smath
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/smath$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=smath
 LINKADDEDFILES= \
Index: helpcontent2/util/swriter/makefile.mk
===================================================================
RCS file: /cvs/documentation/helpcontent2/util/swriter/makefile.mk,v
retrieving revision 1.33
retrieving revision 1.33.2.1
diff -u -p -u -p -r1.33 -r1.33.2.1
--- helpcontent2/util/swriter/makefile.mk	8 Jun 2007 16:34:19 -0000	1.33
+++ helpcontent2/util/swriter/makefile.mk	13 Jun 2007 13:07:18 -0000	1.33.2.1
@@ -26,7 +26,6 @@ TARGET  = util_swriter
 .INCLUDE : settings.mk
 .INCLUDE : $(PRJ)$/settings.pmk
 
-.IF "$(SOLAR_JAVA)"!=""
 common_build_zip:=
 zip1generatedlangs=TRUE
 zip1langdirs=$(aux_alllangiso)
@@ -34,8 +33,6 @@ ZIP1TARGET=xhp_swriter
 ZIP1FLAGS= -u -r
 ZIP1DIR=$(COMMONMISC)$/$(LANGDIR)
 ZIP1LIST=$(LANGDIR)$/text$/swriter$/* -x "*.xhp????*" -x "*.dphh*" -x "*.hzip" -x "*.created"
-.ENDIF			# "$(SOLAR_JAVA)"!=""
-
 
 LINKNAME=swriter
 LINKADDEDFILES= \
Index: libxslt/makefile.mk
===================================================================
RCS file: /cvs/external/libxslt/makefile.mk,v
retrieving revision 1.4
retrieving revision 1.4.8.1
diff -u -p -u -p -r1.4 -r1.4.8.1
--- libxslt/makefile.mk	10 May 2007 13:10:21 -0000	1.4
+++ libxslt/makefile.mk	17 Jun 2007 11:01:24 -0000	1.4.8.1
@@ -71,13 +71,13 @@ BUILD_DIR=$(CONFIGURE_DIR)
 .ELSE
 .IF "$(SYSBASE)"!=""
 xslt_CFLAGS+=-I$(SYSBASE)$/usr$/include -I$(SOLARINCDIR)$/external
-.IF "$(COMNAME)"=="sunpro5"
-xslt_CFLAGS+=$(C_RESTRICTIONFLAGS)
-.ENDIF			# "$(COMNAME)"=="sunpro5"
 .IF "$(OS)"=="SOLARIS" || "$(OS)"=="LINUX"
 xslt_LDFLAGS+=-L$(SYSBASE)$/lib -L$(SYSBASE)$/usr$/lib -L$(SOLARLIBDIR) -lpthread -ldl
 .ENDIF
 .ENDIF			# "$(SYSBASE)"!=""
+.IF "$(COMNAME)"=="sunpro5"
+xslt_CFLAGS+=-xc99=none
+.ENDIF                  # "$(COMNAME)"=="sunpro5"
 CONFIGURE_DIR=
 CONFIGURE_ACTION=chmod 777 libxml2-config && .$/configure
 CONFIGURE_FLAGS=--enable-ipv6=no --without-crypto --without-python --enable-static=no --with-sax1=yes CFLAGS="$(xslt_CFLAGS)" LDFLAGS="$(xslt_LDFLAGS)"
Index: xmlhelp/prj/build.lst
===================================================================
RCS file: /cvs/util/xmlhelp/prj/build.lst,v
retrieving revision 1.14
retrieving revision 1.14.2.1
diff -u -p -u -p -r1.14 -r1.14.2.1
--- xmlhelp/prj/build.lst	8 Jun 2007 16:37:14 -0000	1.14
+++ xmlhelp/prj/build.lst	13 Jun 2007 12:11:15 -0000	1.14.2.1
@@ -1,4 +1,4 @@
-xh	xmlhelp	:	ucbhelper XmlSearch LIBXSLT:libxslt jut unoil BERKELEYDB:berkeleydb svtools NULL
+xh	xmlhelp	:	ucbhelper LIBXSLT:libxslt jut unoil BERKELEYDB:berkeleydb svtools NULL
 xh	xmlhelp									usr1	-	all	xh_mkout NULL
 xh	xmlhelp\inc								nmake	-	all	xh_inc NULL
 xh	xmlhelp\source\helpprovider				nmake	-	all	xh_helpprovider xh_inc NULL
Index: xmlhelp/prj/d.lst
===================================================================
RCS file: /cvs/util/xmlhelp/prj/d.lst,v
retrieving revision 1.16
retrieving revision 1.16.2.1
diff -u -p -u -p -r1.16 -r1.16.2.1
--- xmlhelp/prj/d.lst	8 Jun 2007 16:38:15 -0000	1.16
+++ xmlhelp/prj/d.lst	13 Jun 2007 12:11:15 -0000	1.16.2.1
@@ -1,5 +1,5 @@
 ..\%__SRC%\bin\*.dll %_DEST%\bin%_EXT%\*.*
-..\%__SRC%\bin\com.sun.star.help.HelpLinker %_DEST%\bin%_EXT%\com.sun.star.help.HelpLinker
+..\%__SRC%\bin\HelpLinker* %_DEST%\bin%_EXT%
 ..\%__SRC%\lib\lib*.so %_DEST%\lib%_EXT%
 ..\%__SRC%\lib\*.dylib %_DEST%\lib%_EXT%\*.*
 ..\%__SRC%\class\*.jar %_DEST%\bin%_EXT%\*.*
Index: xmlhelp/source/com/sun/star/help/HelpCompiler.cxx
===================================================================
RCS file: /cvs/util/xmlhelp/source/com/sun/star/help/HelpCompiler.cxx,v
retrieving revision 1.2
retrieving revision 1.2.2.1
diff -u -p -u -p -r1.2 -r1.2.2.1
--- xmlhelp/source/com/sun/star/help/HelpCompiler.cxx	5 Jun 2007 10:24:30 -0000	1.2
+++ xmlhelp/source/com/sun/star/help/HelpCompiler.cxx	16 Jun 2007 15:47:33 -0000	1.2.2.1
@@ -426,6 +426,7 @@ bool HelpCompiler::compile()
 
         if (modulename == "DEFAULT")
         {
+            streamTable.dropdefault();
             streamTable.default_doc = docResolvedDoc;
             streamTable.default_hidlist = aparser.hidlist;
             streamTable.default_helptexts = aparser.helptexts;
@@ -433,6 +434,7 @@ bool HelpCompiler::compile()
         }
         else if (modulename == module)
         {
+            streamTable.dropappl();
             streamTable.appl_doc = docResolvedDoc;
             streamTable.appl_hidlist = aparser.hidlist;
             streamTable.appl_helptexts = aparser.helptexts;
Index: xmlhelp/source/com/sun/star/help/HelpCompiler.hxx
===================================================================
RCS file: /cvs/util/xmlhelp/source/com/sun/star/help/HelpCompiler.hxx,v
retrieving revision 1.3
retrieving revision 1.3.2.3
diff -u -p -u -p -r1.3 -r1.3.2.3
--- xmlhelp/source/com/sun/star/help/HelpCompiler.hxx	8 Jun 2007 15:00:57 -0000	1.3
+++ xmlhelp/source/com/sun/star/help/HelpCompiler.hxx	16 Jun 2007 15:47:33 -0000	1.3.2.3
@@ -66,7 +66,6 @@
 #include <osl/file.hxx>
 
 #define EMULATEORIGINAL 1
-//#define CMCDEBUG
 #ifdef CMCDEBUG
     #define HCDBG(foo) do { if (1) foo; } while(0)
 #else
@@ -240,17 +239,25 @@ public:
         appl_hidlist(NULL), appl_keywords(NULL), appl_helptexts(NULL), appl_doc(NULL), 
         default_hidlist(NULL), default_keywords(NULL), default_helptexts(NULL), default_doc(NULL) 
     {}
-    ~StreamTable()
-    { 
-        delete appl_hidlist;
-        delete appl_keywords;
-        delete appl_helptexts;
-        if (appl_doc) xmlFreeDoc(appl_doc); 
+    void dropdefault()
+    {
         delete default_hidlist;
         delete default_keywords;
         delete default_helptexts;
         if (default_doc) xmlFreeDoc(default_doc); 
     }
+    void dropappl()
+    {
+        delete appl_hidlist;
+        delete appl_keywords;
+        delete appl_helptexts;
+        if (appl_doc) xmlFreeDoc(appl_doc); 
+    }
+    ~StreamTable()
+    { 
+        dropappl();
+        dropdefault();
+    }
 };
 
 class HelpCompiler
Index: xmlhelp/source/com/sun/star/help/HelpLinker.cxx
===================================================================
RCS file: /cvs/util/xmlhelp/source/com/sun/star/help/HelpLinker.cxx,v
retrieving revision 1.3
retrieving revision 1.3.2.6
diff -u -p -u -p -r1.3 -r1.3.2.6
--- xmlhelp/source/com/sun/star/help/HelpLinker.cxx	8 Jun 2007 15:01:10 -0000	1.3
+++ xmlhelp/source/com/sun/star/help/HelpLinker.cxx	21 Jun 2007 08:16:50 -0000	1.3.2.6
@@ -413,18 +413,19 @@ int readInt(std::fstream &in)
 {
     HCDBG(std::cerr << "want to read at " << in.tellg() << std::endl);
     int ret = 0;
-    for (int i = 3; i >= 0; --i)
+    for (char i = 3; i >= 0; --i)
     {
         unsigned char byte;
-        in >> byte;
+        in.read( (char*)&byte, 1 ); 
         ret |= (byte << (i*8));
+        HCDBG(fprintf(stderr, "inputting %x ret is now %x\n", byte, ret));
     }
     return ret;
 }
 
 void writeByte(std::fstream &out, unsigned char byte)
 {
-    out << byte;
+    out.write( (const char *)&byte, 1 );
 }
 
 void writeShort(std::fstream &out, int item)
@@ -432,17 +433,18 @@ void writeShort(std::fstream &out, int i
     for (int i = 1; i >= 0; --i)
     {
         unsigned char byte = static_cast<unsigned char>((item >> (i*8)));
-        out << byte;
+        out.write( (const char*)&byte, 1 );
     }
 }
 
 void writeInt(std::fstream &out, int item)
 {
+    HCDBG(std::cerr << "want to write at " << out.tellp() << std::endl);
     for (int i = 3; i >= 0; --i)
     {
         unsigned char byte = static_cast<unsigned char>((item >> (i*8)));
-        HCDBG(fprintf(stderr, "outputting %x\n", byte));
-        out << byte;
+        HCDBG(fprintf(stderr, "outputting %x in is %x\n", byte, item));
+        out.write( (const char*)&byte, 1 );
     }
 }
 
@@ -519,7 +521,7 @@ public:
     {
         writeInt(out, _number);
         writeInt(out, _free | (_isLeaf ? 0x80000000 : 0));
-        out.write((char*)(&_data[0]), _data.size());
+        out.write((const char*)(&_data[0]), _data.size());
     }
 };
 
@@ -915,9 +917,7 @@ void BlockManager::addDescriptor(Block *
 {
     BlockDescriptor desc(block);
     _blockTab.push_back(desc);
-    // Ivo debug
-    fprintf(stderr, "numbers are %lx %lx\n", block->_number,
-            _blockTab.size() - 1);
+    HCDBG(fprintf(stderr, "numbers are %lx %lx\n", block->_number, _blockTab.size() - 1));
     if (block->_number != _blockTab.size() - 1)
     {
         std::cerr << "totally screwed" << std::endl;
@@ -2049,11 +2049,11 @@ public:
         std::fstream *indexFile = _index.getOutputStream("DOCS.TAB");
         unsigned char byte = static_cast<unsigned char>(
             _compr.compressAscending(_concepts));
-        *indexFile << byte; // write k
+        indexFile->write( (const char*)&byte, 1 ); // write k
         _compr.write(*indexFile);
         _compr.clear();
         byte = static_cast<unsigned char>(_compr.minimize(_offsets, K));
-        *indexFile << byte; // write k
+        indexFile->write( (const char*)&byte, 1 ); // write k
         _compr.write(*indexFile);
         indexFile->close();
         delete indexFile;
@@ -2100,7 +2100,7 @@ private: 
                 toDifferences(_arrays[i], _diffs);
                 unsigned char byte = static_cast<unsigned char>(
                     _compr.minimize(_diffs, K));
-                *_mainFile << byte; // write k
+                _mainFile->write( (const char*)&byte, 1 ); // write k
                 _offsets.push_back(_compr.byteCount() + 1);
                 _compr.write(*_mainFile);
                 _concepts.push_back(_minConcept + i);
@@ -2819,7 +2819,7 @@ public:  
     int getNextByte()
     { 
         unsigned char ret;
-        *_input >> ret;
+        _input->read( (char*)&ret, 1 ); 
         HCDBG(fprintf(stderr, "StreamDecompressor::getNextByte of %d\n", ret));
         return ret;
     }
@@ -2848,17 +2848,17 @@ void Index::readOffsetsTables(const std:
 {
     std::ifstream in(indexFile(fileName).native_file_string().c_str(), std::ios::binary);
     unsigned char k1;
-    in >> k1;
+    in.read( (char*)&k1, 1 ); 
     StreamDecompressor sddocs(in);
     sddocs.decode(k1, _documents);
     unsigned char k2;
-    in >> k2;
+    in.read( (char*)&k2, 1 );
     _microIndexOffsets.clear();
     StreamDecompressor sdoffsets(in);
     sdoffsets.ascDecode(k2, _microIndexOffsets);
     // decompress titles' ids table
     unsigned char k3;
-    in >> k3;
+    in.read( (char*)&k3, 1 );
     _titles.clear();
     StreamDecompressor sdtitles(in);
     sdtitles.decode(k3, _titles);
@@ -2868,12 +2868,12 @@ void Index::readDocumentsTable(const std
 {
     std::ifstream in(indexFile(fileName).native_file_string().c_str(), std::ios::binary);
     unsigned char k1;
-    in >> k1;
+    in.read( (char*)&k1, 1 );
     _concepts.clear();
     StreamDecompressor sddocs(in);
     sddocs.ascDecode(k1, _concepts);
     unsigned char k2;
-    in >> k2;
+    in.read( (char*)&k2, 1 );
     _offsets.clear();
     _offsets.push_back(0);
     StreamDecompressor sdoffsets(in);
@@ -3277,7 +3277,7 @@ void XmlIndex::writeOutOffsets()
         std::fstream &out = getOffsetsFile();
         Compressor offsets2;
         char k = static_cast<char>(offsets2.compressAscending(_contextsOffsets));
-        out << k;
+        out.write( (const char*)&k, 1 );
         offsets2.write(out);
     }
 }
@@ -3321,13 +3321,15 @@ public:
 Tokenizer::Tokenizer() : start(BreakIterator::DONE), utfbuffer(64)
 {
     UErrorCode status = U_ZERO_ERROR;
-    bi = BreakIterator::createWordInstance(Locale::getUS(), status);
+    bi = BreakIterator::createWordInstance("en_US", status);
     utf8 = ucnv_open("utf-8", &status);
 }
 
 Tokenizer::~Tokenizer()
 {
+#if !defined(SOLARIS)
     delete bi;
+#endif
     ucnv_close(utf8);
 }
 
@@ -3853,14 +3855,13 @@ class XmlIndexBuilder
 {
 private:
     fs::path _transformLocation;
-    xsltStylesheetPtr _defaultTransform;
     xsltStylesheetPtr _indexingTransform;
     IndexAdapter _indexAdapter;
     int _currentDocID;
     void reset();
     xsltStylesheetPtr getTransform(const std::string &stylesheetName);
 public: 
-    XmlIndexBuilder() : _defaultTransform(0), _indexingTransform(0) {}
+    XmlIndexBuilder() : _indexingTransform(0) {}
     XmlIndexBuilder(const fs::path &dir);
     ~XmlIndexBuilder();
     void clearIndex();
@@ -4355,7 +4356,7 @@ private:
             if (_nGroups > 1) 
             {
                 unsigned char byte = static_cast<unsigned char>((0x80 | _kk));
-                out << byte;
+                out.write( (const char*)&byte, 1 );
                 HCDBG(std::cerr << "writeOut of " << int(byte) << std::endl);
                 _kCompr.write(out); // concatenated k,l,m
                 for (size_t j = 0; j < _freeComp; j++)
@@ -4363,8 +4364,10 @@ private:
             }
             else // single group, no extents; code: 00
             {
-                out << (unsigned char)(_kTable[0]); // k1
-                out << (unsigned char)(_kTable[1]); // k2
+                unsigned char k1 = (unsigned char)(_kTable[0]);
+                unsigned char k2 = (unsigned char)(_kTable[1]);
+                out.write( (const char*)&k1, 1 );
+                out.write( (const char*)&k2, 1 );
                 _compressors[0].write(out); // C/P
             }
         }
@@ -4372,7 +4375,7 @@ private:
         {               // extents
             unsigned char byte = static_cast<unsigned char>(
                 (_nGroups > 1 ? 0xC0 : 0x40) | _kk);
-            out << byte;
+            out.write( (const char*)&byte, 1 );
             _kCompr.write(out);
             for (size_t j = 0; j < _freeComp; j++)
                 _compressors[j].write(out);
@@ -4447,15 +4450,15 @@ void Index::writeOutOffsets()
     out.clear();
     unsigned char byte;
     byte = static_cast<unsigned char>(k1);
-    out << byte;
+    out.write( (const char*)&byte, 1 );
     HCDBG(fprintf(stderr, "a: offset dump of %x\n", byte));
     documents.write(out);
     byte = static_cast<unsigned char>(k2);
-    out << byte;
+    out.write( (const char*)&byte, 1 );
     HCDBG(fprintf(stderr, "b: offset dump of %x\n", byte));
     offsets.write(out);
     byte = static_cast<unsigned char>(k3);
-    out << byte;
+    out.write( (const char*)&byte, 1 );
     HCDBG(fprintf(stderr, "c: offset dump of %x\n", byte));
     titles.write(out);
 }
@@ -4568,8 +4571,6 @@ void XmlIndexBuilder::indexDocument(xmlD
 
 XmlIndexBuilder::~XmlIndexBuilder()
 {
-    if (_defaultTransform) xsltFreeStylesheet(_defaultTransform);
-    if (_indexingTransform) xsltFreeStylesheet(_indexingTransform);
     delete _indexAdapter._index;
 }
 
@@ -4586,7 +4587,6 @@ xsltStylesheetPtr XmlIndexBuilder::getTr
 
 void XmlIndexBuilder::initXmlProcessor(const std::string &transform)
 {
-    _defaultTransform = getTransform("default");
     _indexingTransform = getTransform(transform);
 }
 
@@ -4625,8 +4625,7 @@ void XmlIndexBuilder::reset()
 }
 
 XmlIndexBuilder::XmlIndexBuilder(const fs::path &indexDir)
-    : _defaultTransform(0), _indexingTransform(0),
-    _currentDocID(0)
+    : _indexingTransform(0), _currentDocID(0)
 {
     HCDBG(std::cerr << "indexDir is " << indexDir.native_directory_string() << std::endl);
     _indexAdapter._index = new XmlIndex(indexDir, true);
@@ -4730,12 +4729,12 @@ std::string replaceAll(std::string resul
 
 void JarOutputStream::addFile(const std::string &fileName, const std::string &name)
 {
-    perlline << "$zip->addFile(\"" << replaceAll(fileName, "\\", "\\\\") << "\", \"" << name << "\"); ";
+    perlline << "$zip->addFile(\"" << replaceAll(fileName, "\\", "/") << "\", \"" << name << "\"); ";
 }
 
 void JarOutputStream::addTree(const std::string &tree, const std::string &name)
 {
-    perlline << "$zip->addTree(\"" << replaceAll(tree, "\\", "\\\\") << "\", \"" << name << "\"); ";
+    perlline << "$zip->addTree(\"" << replaceAll(tree, "\\", "/") << "\", \"" << name << "\"); ";
 }
 
 void JarOutputStream::dontCompress(const std::string &key)
@@ -4746,32 +4745,33 @@ void JarOutputStream::dontCompress(const
 
 void JarOutputStream::commit()
 {
-    perlline << "$zip->writeToFileNamed(\"" << replaceAll(getname().native_file_string(), "\\", "\\\\") << "\"); ";
+    perlline << "print $zip->writeToFileNamed(\"" << replaceAll(getname().native_file_string(), "\\", "/") << "\").\"\\n\"; ";
 
     fs::path tmp = getname();
     tmp.append(".perl");
-    std::string perlfile = tmp.native_file_string();
+    std::string perlfile = replaceAll( tmp.native_file_string(), "\\", "/");
     std::ofstream fos(perlfile.c_str());
     fos << perlline.str();
     fos.close();
 
-    std::string myperl( getenv( "PERL" ) );
+    std::string myperl;
+    if( myperl.empty() ) myperl = "perl";
     std::string commandline; 
     const std::string is4nt ( getenv( "USE_SHELL" ) );
     if( !is4nt.empty() && is4nt == "4nt" )
     {
-        std::string myperl2 = replaceAll( myperl , "\\" , "\\\\" );    
-        myperl  = myperl2 ;
-        myperl2 = replaceAll( perlfile , "\\" , "\\\\" );
-        perlfile = myperl2 ;
-        commandline = myperl + " " + perlfile;
+        // in SO windows environment perl isn't in the path and
+        // needs to be fetched from the environment. this doesn't
+        // work in a cygwin shell as "/usr/bin/perl" will fail in a
+        // native shell (see system call).
+        myperl = getenv( "PERL" );
     }
-//    std::string commandline = "perl " + perlfile;
-    else 
-        commandline = "perl " + perlfile;
-
+    commandline = myperl + " " + perlfile;
     HCDBG(std::cerr << "command line 3 is" << commandline << std::endl);
-    system(commandline.c_str());
+    // on windows, calling perl (either cygwin or native) from a native
+    // shell the only chance to survive is using "c:/foo" notation
+    if ( system(commandline.c_str()) )
+        fprintf (stderr, "ERROR: calling generated perl script failed!\n");
 
     fs::remove(tmp);
 }
@@ -4953,19 +4953,19 @@ void HelpLinker::link()
         appl = appl.substr(1);
 
     fs::path helpTextFileName(indexDirParentName / (mod + ".ht"));
-    DB* helpText;
+    DB* helpText(0);
     db_create(&helpText,0,0);
     helpText->open(helpText, NULL, helpTextFileName.native_file_string().c_str(), NULL, DB_BTREE, 
         DB_CREATE | DB_TRUNCATE, 0644);
 
     fs::path dbBaseFileName(indexDirParentName / (mod + ".db"));
-    DB* dbBase;
+    DB* dbBase(0);
     db_create(&dbBase,0,0);
     dbBase->open(dbBase, NULL, dbBaseFileName.native_file_string().c_str(), NULL, DB_BTREE, 
         DB_CREATE | DB_TRUNCATE, 0644);
 
     fs::path keyWordFileName(indexDirParentName / (mod + ".key"));
-    DB* keyWord;
+    DB* keyWord(0);
     db_create(&keyWord,0,0);
     keyWord->open(keyWord, NULL, keyWordFileName.native_file_string().c_str(), NULL, DB_BTREE, 
         DB_CREATE | DB_TRUNCATE, 0644);
Index: xmlhelp/source/com/sun/star/help/aottarget.mk
===================================================================
RCS file: xmlhelp/source/com/sun/star/help/aottarget.mk
diff -N xmlhelp/source/com/sun/star/help/aottarget.mk
--- xmlhelp/source/com/sun/star/help/aottarget.mk	15 Jan 2007 12:37:58 -0000	1.4
+++ /dev/null	1 Jan 1970 00:00:00 -0000
@@ -1,73 +0,0 @@
-#*************************************************************************
-#
-#   OpenOffice.org - a multi-platform office productivity suite
-#
-#   $RCSfile: aottarget.mk,v $
-#
-#   $Revision: 1.4 $
-#
-#   last change: $Author: vg $ $Date: 2007/01/15 12:37:58 $
-#
-#   The Contents of this file are made available subject to
-#   the terms of GNU Lesser General Public License Version 2.1.
-#
-#
-#     GNU Lesser General Public License Version 2.1
-#     =============================================
-#     Copyright 2005 by Sun Microsystems, Inc.
-#     901 San Antonio Road, Palo Alto, CA 94303, USA
-#
-#     This library is free software; you can redistribute it and/or
-#     modify it under the terms of the GNU Lesser General Public
-#     License version 2.1, as published by the Free Software Foundation.
-#
-#     This library is distributed in the hope that it will be useful,
-#     but WITHOUT ANY WARRANTY; without even the implied warranty of
-#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-#     Lesser General Public License for more details.
-#
-#     You should have received a copy of the GNU Lesser General Public
-#     License along with this library; if not, write to the Free Software
-#     Foundation, Inc., 59 Temple Place, Suite 330, Boston,
-#     MA  02111-1307  USA
-#
-#*************************************************************************
-
-#this generates .jar.so files into the local LIB dir from the global solver
-#dir, so that would need to be resolved before making this a generic solution
-#in solenv for all java build-time tools 
-
-AOTTARGETN=$(BIN)$/$(AOTTARGET)
-
-AOTFILES = $(foreach,i,$(NEWCLASS) $(LB)$/lib$(i:b).jar.so)
-
-.IF "$(SYSTEM_DB)" == "YES"
-AOTFILES+= $(LB)$/libdb.jar.so
-$(AOTTARGETN) : $(LB)$/libdb.jar.so
-.ENDIF
-
-.IF "$(SYSTEM_XT)" == "YES"
-AOTFILES+= $(LB)$/libxt.jar.so
-$(AOTTARGETN) : $(LB)$/libxt.jar.so
-.ENDIF
-
-AOTLINKFLAGS=$(subst,.so, $(subst,$(LB)$/lib,-l $(AOTFILES)))
-
-$(LB)$/lib%.jar.so : $(SOLARBINDIR)$/%.jar
-	$(JAVAAOTCOMPILER) --classpath=. -shared -fPIC -Wl,-Bsymbolic -O2 \
-	-fno-bounds-check -fno-store-check -findirect-dispatch -fjni -o $@ $<
-
-$(LB)$/libdb.jar.so:
-	$(JAVAAOTCOMPILER) --classpath=. -shared -fPIC -Wl,-Bsymbolic -O2 \
-	-fno-bounds-check -fno-store-check -findirect-dispatch -fjni -o $(LB)$/libdb.jar.so $(DB_JAR)
-
-$(LB)$/libxt.jar.so:
-	$(JAVAAOTCOMPILER) --classpath=. -shared -fPIC -Wl,-Bsymbolic -O2 \
-	-fno-bounds-check -fno-store-check -findirect-dispatch -fjni -o $(LB)$/libxt.jar.so $(XT_JAR)
-
-$(AOTTARGETN) : $(JARTARGETN) $(AOTFILES)
-	$(JAVAAOTCOMPILER) --main=$(AOTTARGET) -o $(BIN)$/$(AOTTARGET) \
-		-Wl,-Bsymbolic -O2 --no-bounds-check -fno-store-check -findirect-dispatch -fjni \
-		-Djavax.xml.parsers.SAXParserFactory=org.apache.xerces.jaxp.SAXParserFactoryImpl \
-		-Djavax.xml.parsers.DocumentBuilderFactory=org.apache.xerces.jaxp.DocumentBuilderFactoryImpl \
-		$(JAVACPS) $(CLASSPATH) $(JARTARGETN) -L$(LB) $(AOTLINKFLAGS)
Index: xmlhelp/source/com/sun/star/help/makefile.mk
===================================================================
RCS file: /cvs/util/xmlhelp/source/com/sun/star/help/makefile.mk,v
retrieving revision 1.28
retrieving revision 1.28.2.1
diff -u -p -u -p -r1.28 -r1.28.2.1
--- xmlhelp/source/com/sun/star/help/makefile.mk	8 Jun 2007 16:42:33 -0000	1.28
+++ xmlhelp/source/com/sun/star/help/makefile.mk	13 Jun 2007 12:11:15 -0000	1.28.2.1
@@ -35,103 +35,41 @@
 
 PRJ		= ..$/..$/..$/..$/..
 PRJNAME = xmlhelp
-PACKAGE = com$/sun$/star$/help
-TARGET  = com_sun_star_help
+TARGET  = HelpLinker
+TARGETTYPE=CUI
+LIBTARGET=no
 
 # --- Settings -----------------------------------------------------
 
 .INCLUDE : settings.mk
 
-JARFILES 	= xt-xmlsearch.jar unoil.jar ridl.jar jurt.jar jut.jar xmlsearch.jar
-EXTRAJARFILES 	= 
-
-.IF "$(SYSTEM_XT)" == "YES"
-XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(XT_JAR)
+.IF "$(SYSTEM_LIBXSLT)" == "YES"
+CFLAGS+= $(LIBXSLT_CFLAGS)
 .ELSE
-JARFILES += xt.jar
+LIBXSLTINCDIR=external$/libxslt
+CFLAGS+= -I$(SOLARINCDIR)$/$(LIBXSLTINCDIR)
 .ENDIF
 
-.IF "$(SYSTEM_XML_APIS)" == "YES"
-.IF "$(XCLASSPATH)" != ""
-XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(XML_APIS_JAR)
-.ELSE
-XCLASSPATH!:=$(XML_APIS_JAR)
-.ENDIF
-.ELSE
-JARFILES += xml-apis.jar
+.IF "$(SYSTEM_DB)" == "YES"
+CFLAGS+=-DSYSTEM_DB -I$(DB_INCLUDES)
 .ENDIF
 
-.IF "$(SYSTEM_XERCES)" == "YES"
-.IF "$(XCLASSPATH)" != ""
-XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(XERCES_JAR)
-.ELSE
-XCLASSPATH!:=$(XERCES_JAR)
-.ENDIF
-.ELSE
-JARFILES += xercesImpl.jar
-.ENDIF
+OBJFILES=\
+        $(OBJ)$/HelpLinker.obj \
+        $(OBJ)$/HelpCompiler.obj
 
-.IF "$(SYSTEM_DB)" == "YES"
-.IF "$(XCLASSPATH)" != ""
-XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(DB_JAR)
-.ELSE
-XCLASSPATH!:=$(DB_JAR)
-.ENDIF
-.ELSE
-JARFILES += db.jar
-.ENDIF
+EXCEPTIONSFILES=\
+        $(OBJ)$/HelpLinker.obj \
+        $(OBJ)$/HelpCompiler.obj
 
-CLASSGENDIR		= $(OUT)$/classgen
-RDB	 		= $(SOLARBINDIR)$/types.rdb
-JAVAFILES		= $(subst,$(CLASSDIR)$/$(PACKAGE)$/, $(subst,.class,.java $(JAVACLASSFILES))) 
-
-# --- Files --------------------------------------------------------
-
-JAVACLASSFILES = \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpCompiler.class			        \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpLinker.class  			        \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpContentIdentifier.class        \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpProvider.class                 \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpContent.class                  \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpOutputStream.class             \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpDatabases.class                \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpURLStreamHandlerFactory.class  \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpURLStreamHandler.class         \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpURLStreamHandlerWithJars.class \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpURLConnection.class            \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpURLConnectionWithJars.class    \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpURLParameter.class             \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpResultSetFactory.class         \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpDynamicResultSet.class         \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpResultSetBase.class            \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpResultSet.class                \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpResultSetForRoot.class         \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpIndexer.class                  \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpKeyword.class                  \
-	$(CLASSDIR)$/$(PACKAGE)$/HelpPackager.class                 \
-	$(CLASSDIR)$/$(PACKAGE)$/XSLData.class                      \
-	$(CLASSDIR)$/$(PACKAGE)$/MemoryURLConnection.class          \
-	$(CLASSDIR)$/$(PACKAGE)$/StringDbt.class 
-
-.IF "$(JDK)"=="gcj"
-JAVACLASSFILES += \
-	$(CLASSDIR)$/$(PACKAGE)$/GCJFileURLStreamHandler.class
-.ELSE
-JAVACLASSFILES += \
-	$(CLASSDIR)$/$(PACKAGE)$/FileURLStreamHandler.class
-.ENDIF
 
-JARCLASSDIRS	= com
-JARTARGET		= $(PRJNAME).jar
-JARCOMPRESS 	= TRUE
-CUSTOMMANIFESTFILE = manifest
+APP1TARGET= $(TARGET)
+APP1OBJS=\
+      $(OBJ)$/HelpLinker.obj \
+      $(OBJ)$/HelpCompiler.obj
+
+APP1STDLIBS+=$(SALLIB) $(BERKELEYLIB) $(ICUUCLIB) $(XSLTLIB)
 
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :  target.mk
-
-.IF "$(JAVAAOTCOMPILER)" != ""
-AOTTARGET = com.sun.star.help.HelpLinker
-.INCLUDE :  aottarget.mk
-ALLTAR : $(AOTTARGETN)
-.ENDIF
Index: berkeleydb/db-4.2.52-mingw.patch
===================================================================
RCS file: /cvs/external/berkeleydb/db-4.2.52-mingw.patch,v
retrieving revision 1.2
retrieving revision 1.2.12.1
diff -u -p -u -p -r1.2 -r1.2.12.1
--- berkeleydb/db-4.2.52-mingw.patch	26 Mar 2007 13:03:50 -0000	1.2
+++ berkeleydb/db-4.2.52-mingw.patch	17 Jun 2007 14:43:16 -0000	1.2.12.1
@@ -163,3 +163,22 @@
  	    -o $@ $(JAVA_OBJS) $(C_OBJS) $(LIBJSO_LIBS)
  
  # Shared Tcl library.
+*** misc/build/db-4.2.52.NC/btree/bt_put.c.orig	2003-11-17 19:58:20.000000000 +0000
+--- misc/build/db-4.2.52.NC/btree/bt_put.c	2007-06-17 15:05:09.000000000 +0100
+***************
+*** 702,708 ****
+  
+  	/* Sum up all the data items. */
+  	for (cnt = 0, first = indx;
+! 	    inp[first] == inp[indx] && indx < NUM_ENT(h);
+  	    ++cnt, indx += P_INDX) {
+  		bk = GET_BKEYDATA(dbp, h, indx + O_INDX);
+  		sz += B_TYPE(bk->type) == B_KEYDATA ?
+--- 702,708 ----
+  
+  	/* Sum up all the data items. */
+  	for (cnt = 0, first = indx;
+! 	    indx < NUM_ENT(h) && inp[first] == inp[indx];
+  	    ++cnt, indx += P_INDX) {
+  		bk = GET_BKEYDATA(dbp, h, indx + O_INDX);
+  		sz += B_TYPE(bk->type) == B_KEYDATA ?
Index: berkeleydb/db-4.2.52.patch
===================================================================
RCS file: /cvs/external/berkeleydb/db-4.2.52.patch,v
retrieving revision 1.19
retrieving revision 1.19.10.1
diff -u -p -u -p -r1.19 -r1.19.10.1
--- berkeleydb/db-4.2.52.patch	26 Mar 2007 12:24:38 -0000	1.19
+++ berkeleydb/db-4.2.52.patch	17 Jun 2007 14:43:16 -0000	1.19.10.1
@@ -1080,3 +1080,22 @@
 ! 			$(SLO)$/xa_map.obj
 ! 
 ! .INCLUDE :  target.mk
+*** misc/db-4.2.52.NC/btree/bt_put.c	2003-11-17 19:58:20.000000000 +0000
+--- misc/build/db-4.2.52.NC/btree/bt_put.c	2007-06-17 15:05:09.000000000 +0100
+***************
+*** 702,708 ****
+  
+  	/* Sum up all the data items. */
+  	for (cnt = 0, first = indx;
+! 	    inp[first] == inp[indx] && indx < NUM_ENT(h);
+  	    ++cnt, indx += P_INDX) {
+  		bk = GET_BKEYDATA(dbp, h, indx + O_INDX);
+  		sz += B_TYPE(bk->type) == B_KEYDATA ?
+--- 702,708 ----
+  
+  	/* Sum up all the data items. */
+  	for (cnt = 0, first = indx;
+! 	    indx < NUM_ENT(h) && inp[first] == inp[indx];
+  	    ++cnt, indx += P_INDX) {
+  		bk = GET_BKEYDATA(dbp, h, indx + O_INDX);
+  		sz += B_TYPE(bk->type) == B_KEYDATA ?
Index: boost/boost-1.30.2.patch
===================================================================
RCS file: /cvs/external/boost/boost-1.30.2.patch,v
retrieving revision 1.9
retrieving revision 1.9.2.1
diff -u -p -u -p -r1.9 -r1.9.2.1
--- boost/boost-1.30.2.patch	8 Jun 2007 16:05:03 -0000	1.9
+++ boost/boost-1.30.2.patch	13 Jun 2007 12:10:09 -0000	1.9.2.1
@@ -668,3 +668,45 @@
 + 
   #endif // BOOST_MPL_SEQUENCE_TAG_HPP_INCLUDED
 
+*** misc/build/boost-1.30.2/boost/token_functions.hpp	2007-05-20 07:38:11.000000000 -0400
+--- misc/modified/boost-1.30.2/boost/token_functions.hpp	2007-05-20 08:05:05.000000000 -0400
+***************
+*** 64,70 ****
+    // character (backslash \), can be assigned to other characters.
+  
+    struct escaped_list_error : public std::runtime_error{
+!     escaped_list_error(const std::string& what):std::runtime_error(what) { }
+    };
+    
+  
+--- 64,70 ----
+    // character (backslash \), can be assigned to other characters.
+  
+    struct escaped_list_error : public std::runtime_error{
+!     escaped_list_error(const std::string& s_what) : std::runtime_error(s_what) { }
+    };
+    
+  
+*** misc/build/boost-1.30.2/boost/token_iterator.hpp	2007-05-20 07:38:10.000000000 -0400
+--- misc/modified/boost-1.30.2/boost/token_iterator.hpp	2007-05-20 08:10:20.000000000 -0400
+***************
+*** 64,72 ****
+              
+              template<class Iterator>
+                  typename Iterator::reference
+!                 dereference(const Iterator& a) const{
+                  using namespace std;
+!                 assert(a.base().valid_);
+                  return tok_;
+              }   
+              template <class Iterator>
+--- 64,72 ----
+              
+              template<class Iterator>
+                  typename Iterator::reference
+!                 dereference(const Iterator& /*a*/) const{
+                  using namespace std;
+!                 //assert(a.base().valid_);
+                  return tok_;
+              }   
+              template <class Iterator>
Index: boost/spirit-1.6.1.patch
===================================================================
RCS file: /cvs/external/boost/spirit-1.6.1.patch,v
retrieving revision 1.9
retrieving revision 1.9.2.1
diff -u -p -u -p -r1.9 -r1.9.2.1
--- boost/spirit-1.6.1.patch	8 Jun 2007 16:09:50 -0000	1.9
+++ boost/spirit-1.6.1.patch	13 Jun 2007 12:10:09 -0000	1.9.2.1
@@ -1564,3 +1564,150 @@
 + #endif
 + 
   #endif // BOOST_UTILITY_ADDRESSOF_HPP
+*** misc/spirit-1.6.1/miniboost/boost/concept_check.hpp	2007-05-20 07:38:14.000000000 -0400
+--- misc/build/spirit-1.6.1/miniboost/boost/concept_check.hpp	2007-05-20 07:52:59.000000000 -0400
+***************
+*** 708,719 ****
+        function_requires< AssignableConcept<Container> >();
+        const_constraints(c);
+      }
+!     void const_constraints(const Container& c) {
+!       i = c.begin();
+!       i = c.end();
+!       n = c.size();
+!       n = c.max_size();
+!       b = c.empty();
+      }
+      Container c;
+      bool b;
+--- 708,719 ----
+        function_requires< AssignableConcept<Container> >();
+        const_constraints(c);
+      }
+!     void const_constraints(const Container& cnr) {
+!       i = cnr.begin();
+!       i = cnr.end();
+!       n = cnr.size();
+!       n = cnr.max_size();
+!       b = cnr.empty();
+      }
+      Container c;
+      bool b;
+***************
+*** 777,785 ****
+          BidirectionalIteratorConcept<const_reverse_iterator> >();
+        const_constraints(c);
+      }
+!     void const_constraints(const ReversibleContainer& c) {
+!       const_reverse_iterator i = c.rbegin();
+!       i = c.rend();
+      }
+      ReversibleContainer c;
+    };
+--- 777,785 ----
+          BidirectionalIteratorConcept<const_reverse_iterator> >();
+        const_constraints(c);
+      }
+!     void const_constraints(const ReversibleContainer& cnr) {
+!       const_reverse_iterator i = cnr.rbegin();
+!       i = cnr.rend();
+      }
+      ReversibleContainer c;
+    };
+***************
+*** 821,828 ****
+  
+        const_constraints(c);
+      }
+!     void const_constraints(const RandomAccessContainer& c) {
+!       const_reference r = c[n];
+        ignore_unused_variable_warning(r);
+      }
+      RandomAccessContainer c;
+--- 821,828 ----
+  
+        const_constraints(c);
+      }
+!     void const_constraints(const RandomAccessContainer& cnr) {
+!       const_reference r = cnr[n];
+        ignore_unused_variable_warning(r);
+      }
+      RandomAccessContainer c;
+***************
+*** 925,932 ****
+        reference r = c.back();
+        ignore_unused_variable_warning(r);
+      }
+!     void const_constraints(const BackInsertionSequence& c) {
+!       const_reference r = c.back();
+        ignore_unused_variable_warning(r);
+      };
+      BackInsertionSequence c;
+--- 925,932 ----
+        reference r = c.back();
+        ignore_unused_variable_warning(r);
+      }
+!     void const_constraints(const BackInsertionSequence& cnr) {
+!       const_reference r = cnr.back();
+        ignore_unused_variable_warning(r);
+      };
+      BackInsertionSequence c;
+***************
+*** 947,956 ****
+        c.erase(r.first, r.second);
+        const_constraints(c);
+      }
+!     void const_constraints(const AssociativeContainer& c) {
+!       ci = c.find(k);
+!       n = c.count(k);
+!       cr = c.equal_range(k);
+      }
+      typedef typename AssociativeContainer::iterator iterator;
+      typedef typename AssociativeContainer::const_iterator const_iterator;
+--- 947,956 ----
+        c.erase(r.first, r.second);
+        const_constraints(c);
+      }
+!     void const_constraints(const AssociativeContainer& cnr) {
+!       ci = cnr.find(k);
+!       n = cnr.count(k);
+!       cr = cnr.equal_range(k);
+      }
+      typedef typename AssociativeContainer::iterator iterator;
+      typedef typename AssociativeContainer::const_iterator const_iterator;
+*** misc/spirit-1.6.1/miniboost/boost/type_traits/type_with_alignment.hpp	Wed May 23 19:45:34 2007
+--- misc/build/spirit-1.6.1/miniboost/boost/type_traits/type_with_alignment.hpp	Wed May 23 19:47:00 2007
+***************
+*** 72,78 ****
+  #undef BOOST_TT_CHOOSE_MIN_ALIGNMENT
+  #undef BOOST_TT_CHOOSE_T
+  
+! template<int TAlign, int Align>
+  struct is_aligned
+  {
+      BOOST_STATIC_CONSTANT(bool,
+--- 72,78 ----
+  #undef BOOST_TT_CHOOSE_MIN_ALIGNMENT
+  #undef BOOST_TT_CHOOSE_T
+  
+! template<std::size_t TAlign, std::size_t Align>
+  struct is_aligned
+  {
+      BOOST_STATIC_CONSTANT(bool,
+***************
+*** 93,99 ****
+  
+  // This alignment method originally due to Brian Parker, implemented by David
+  // Abrahams, and then ported here by Doug Gregor. 
+! template <int Align>
+  class type_with_alignment
+  {
+      typedef detail::lower_alignment<Align> t1;
+--- 93,99 ----
+  
+  // This alignment method originally due to Brian Parker, implemented by David
+  // Abrahams, and then ported here by Doug Gregor. 
+! template <std::size_t Align>
+  class type_with_alignment
+  {
+      typedef detail::lower_alignment<Align> t1;
Index: boost/prj/d.lst
===================================================================
RCS file: /cvs/external/boost/prj/d.lst,v
retrieving revision 1.13
retrieving revision 1.13.2.1
diff -u -p -u -p -r1.13 -r1.13.2.1
--- boost/prj/d.lst	8 Jun 2007 16:07:05 -0000	1.13
+++ boost/prj/d.lst	13 Jun 2007 12:10:09 -0000	1.13.2.1
@@ -2,6 +2,9 @@ mkdir: %_DEST%\inc%_EXT%\boost
 
 ..\%__SRC%\misc\build\boost-1.30.2\boost\rational.hpp %_DEST%\inc%_EXT%\boost\rational.hpp
 ..\%__SRC%\misc\build\boost-1.30.2\boost\operators.hpp %_DEST%\inc%_EXT%\boost\operators.hpp
+..\%__SRC%\misc\build\boost-1.30.2\boost\tokenizer.hpp %_DEST%\inc%_EXT%\boost\tokenizer.hpp
+..\%__SRC%\misc\build\boost-1.30.2\boost\token_iterator.hpp %_DEST%\inc%_EXT%\boost\token_iterator.hpp
+..\%__SRC%\misc\build\boost-1.30.2\boost\token_functions.hpp %_DEST%\inc%_EXT%\boost\token_functions.hpp
 ..\%__SRC%\misc\build\boost-1.30.2\boost\enable_shared_from_this.hpp %_DEST%\inc%_EXT%\boost\enable_shared_from_this.hpp
 
 ..\%__SRC%\misc\build\boost-1.30.2\boost\cast.hpp %_DEST%\inc%_EXT%\boost\cast.hpp
