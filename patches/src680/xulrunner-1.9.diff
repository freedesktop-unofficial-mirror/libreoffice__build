Index: configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.249
diff -u -r1.249 configure.in
--- config_office/configure.in	19 Feb 2008 12:37:37 -0000	1.249
+++ config_office/configure.in	4 Mar 2008 08:43:21 -0000
@@ -466,7 +466,7 @@
                           components cannot be built against a contemporary
                           mozilla. The flavour used can be specified by
                           --with-system-mozilla=<flavour>. Supported are:
-                          xulrunner (default), firefox, seamonkey, mozilla
+                          libxul (default), firefox, seamonkey, mozilla
 ], WITH_SYSTEM_MOZILLA=$withval, WITH_SYSTEM_MOZILLA=no)
 AC_ARG_WITH(stlport,
 [  --with-stlport         The location that STLport is installed in. The STL
@@ -3794,7 +3794,9 @@
     AC_MSG_RESULT([external])
     SYSTEM_MOZILLA=YES
     AC_MSG_CHECKING([which Mozilla flavour to use])
-    if test -n "$with_system_mozilla" && test "$with_system_mozilla" = "xulrunner"; then
+    if test -n "$with_system_mozilla" && test "$with_system_mozilla" = "libxul"; then
+      MOZ_FLAVOUR=libxul
+    elif test -n "$with_system_mozilla" && test "$with_system_mozilla" = "xulrunner"; then
       MOZ_FLAVOUR=xulrunner
     elif test -n "$with_system_mozilla" && test "$with_system_mozilla" = "seamonkey"; then
       MOZ_FLAVOUR=seamonkey
@@ -3803,12 +3805,24 @@
     elif test -n "$with_system_mozilla" && test "$with_system_mozilla" = "mozilla"; then
       MOZ_FLAVOUR=mozilla
     else
-      MOZ_FLAVOUR=xulrunner
+      MOZ_FLAVOUR=libxul
     fi
     tmp=`echo $MOZ_FLAVOUR | $PERL -e 'print ucfirst(<STDIN>);'`
     AC_MSG_RESULT($tmp)
 
-    PKG_CHECK_MODULES( MOZILLAXPCOM, $MOZ_FLAVOUR-xpcom )
+    #e.g. http://fedoraproject.org/wiki/Releases/FeatureXULRunnerAPIChanges
+    #the plugin pkg-config etc. reverts to "mozilla-plugin" with libxul
+    if test "$MOZ_FLAVOUR" == "libxul"; then
+        MOZ_FLAVOUR="mozilla"
+    fi
+
+    PKG_CHECK_MODULES( MOZ_NSS, nss, STANDALONENSS="TRUE", STANDALONENSS="" )
+    if test -z "$STANDALONENSS"; then
+        PKG_CHECK_MODULES( MOZ_NSS, $MOZ_FLAVOUR-nss )
+    else
+        NSS_LIB="-L`$PKG_CONFIG --variable=libdir nss`"
+        AC_SUBST(NSS_LIB)
+    fi
 
     if $PKG_CONFIG --exists nspr ; then
       PKG_CHECK_MODULES( MOZ_NSPR, nspr )
@@ -3818,12 +3832,14 @@
       PKG_CHECK_MODULES( MOZ_NSPR, $MOZ_FLAVOUR-nspr )
     fi
 
-    PKG_CHECK_MODULES( MOZ_NSS, nss, STANDALONENSS="TRUE", STANDALONENSS="" )
-    if test -z "$STANDALONENSS"; then
-        PKG_CHECK_MODULES( MOZ_NSS, $MOZ_FLAVOUR-nss )
+    if $PKG_CONFIG --exists libxul ; then
+      PKG_CHECK_MODULES( MOZILLAXPCOM, libxul )
+      MOZ_INC=`$PKG_CONFIG --variable=includedir libxul`
+      MOZ_LIB=`$PKG_CONFIG --variable=libdir libxul`
     else
-        NSS_LIB="-L`$PKG_CONFIG --variable=libdir nss`"
-        AC_SUBST(NSS_LIB)
+      PKG_CHECK_MODULES( MOZILLAXPCOM, $MOZ_FLAVOUR-xpcom )
+      MOZ_INC=`$PKG_CONFIG --variable=includedir $MOZ_FLAVOUR-xpcom`
+      MOZ_LIB=`$PKG_CONFIG --variable=libdir $MOZ_FLAVOUR-xpcom`
     fi
 
     save_CPPFLAGS="$CPPFLAGS"
@@ -3839,8 +3855,6 @@
     CPPFLAGS="$save_CPPFLAGS"
     LIBS="$save_LIBS"
 
-    MOZ_INC=`$PKG_CONFIG --variable=includedir $MOZ_FLAVOUR-xpcom`
-    MOZ_LIB=`$PKG_CONFIG --variable=libdir $MOZ_FLAVOUR-xpcom`
     MOZ_LIB_XPCOM=$MOZILLAXPCOM_LIBS
     if test "$WITH_LDAP" != "NO" && test "$WITH_OPENLDAP" != "YES"; then
       AC_MSG_CHECKING([whether $tmp was compiled with --enable-ldap])
