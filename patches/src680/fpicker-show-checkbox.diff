--- svx/source/dialog/makefile.mk	2004-11-11 15:39:46.767302904 +0100
+++ svx/source/dialog/makefile.mk	2004-11-11 15:49:39.271228616 +0100
@@ -70,10 +70,6 @@ LIBTARGET=NO
 .INCLUDE :  settings.mk
 .INCLUDE :  $(PRJ)$/util$/makefile.pmk
 
-.IF "$(ENABLE_GTK)" != ""
-CFLAGS+=-DENABLE_GTK
-.ENDIF
-
 CFLAGS+=-DDG_DLL
 RSCDEFS += -Dause_hack
 
--- svx/source/dialog/optgdlg.cxx	2004-11-11 15:38:43.400936056 +0100
+++ svx/source/dialog/optgdlg.cxx	2004-11-11 16:01:50.667039552 +0100
@@ -260,12 +260,28 @@ OfaMiscTabPage::OfaMiscTabPage(Window* p
 {
 	FreeResource();
 
-    //system fileopen only available in Windows and with gtk vclplug based
-    //picker
-#if !defined( WNT ) && !defined( ENABLE_GTK )
-    aFileDlgFL.Hide();
-    aFileDlgCB.Hide();
-#endif
+    //system fileopen only available in Windows, Gnome and KDE
+    static bool bHasSystemFpicker = false;
+    static bool bHasSystemFpickerInitialized = false;
+    
+    if ( !bHasSystemFpickerInitialized )
+    {
+        bHasSystemFpickerInitialized = true;
+        const OUString &rDesktopEnvironment = Application::GetDesktopEnvironment();
+
+        if ( rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "gnome" ) ||
+                rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "kde" ) ||
+                rDesktopEnvironment.equalsIgnoreAsciiCaseAscii( "windows" ) )
+        {
+            bHasSystemFpicker = true;
+        }
+    }
+
+    if ( !bHasSystemFpicker )
+    {
+        aFileDlgFL.Hide();
+        aFileDlgCB.Hide();
+    }
 
 	// at least the button is as wide as its text
 	long nTxtWidth = aHelpAgentResetBtn.GetTextWidth( aHelpAgentResetBtn.GetText() );
