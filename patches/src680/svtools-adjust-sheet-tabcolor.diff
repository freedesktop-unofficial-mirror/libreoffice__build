diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svtools.vpj svtools.clean/source/control/tabbar.cxx svtools/source/control/tabbar.cxx
--- svtools.clean/source/control/tabbar.cxx	2008-05-02 23:19:10.000000000 -0400
+++ svtools/source/control/tabbar.cxx	2008-05-02 23:22:27.000000000 -0400
@@ -518,6 +518,32 @@ void TabBar::ImplGetColors( Color& rFace
     else
         rSelectTextColor = rStyleSettings.GetWindowTextColor();
 
+    // Make sure the normal tab color is darker or brighter enough than the
+    // selected tab color.
+
+    int nDelta = abs(rSelectColor.GetRed() - rFaceColor.GetRed()) + 
+        abs(rSelectColor.GetGreen() - rFaceColor.GetGreen()) + 
+        abs(rSelectColor.GetBlue() - rFaceColor.GetBlue());
+
+    if (nDelta < 80)
+    {
+        // There isn't enough contrast between the two colors.
+        if ( rFaceColor.IsDark() )
+        {
+            double fRate = 1.0 + 2.0*(80.0 - nDelta)/80.0;
+            rFaceColor.SetRed( rFaceColor.GetRed()*fRate );
+            rFaceColor.SetGreen( rFaceColor.GetGreen()*fRate );
+            rFaceColor.SetBlue( rFaceColor.GetBlue()*fRate );
+        }
+        else
+        {
+            double fRate = 1.0 - 0.12*(80.0 - nDelta)/80.0;
+            rFaceColor.SetRed( rFaceColor.GetRed()*fRate );
+            rFaceColor.SetGreen( rFaceColor.GetGreen()*fRate );
+            rFaceColor.SetBlue( rFaceColor.GetBlue()*fRate );
+        }
+    }
+
     // Bei 3D-Tabs wird Selektions- und Face-Farbe umgedreht, da die
     // selektierten Tabs in 3D erscheinen sollen
     if ( mnWinStyle & WB_3DTAB )
