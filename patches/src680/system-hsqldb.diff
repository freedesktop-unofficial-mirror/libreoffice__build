Index: com/sun/star/sdbcx/comp/hsqldb/makefile.mk
===================================================================
RCS file: /cvs/dba/connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk,v
retrieving revision 1.5
diff -u -p -r1.5 makefile.mk
--- connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk	15 Mar 2005 09:04:54 -0000	1.5
+++ connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk	4 Aug 2005 14:57:40 -0000
@@ -70,7 +70,14 @@ TARGET  = sdbc_hsqldb 
 # --- Files --------------------------------------------------------  
 
 
-JARFILES = ridl.jar unoil.jar jurt.jar juh.jar hsqldb.jar
+JARFILES = ridl.jar unoil.jar jurt.jar juh.jar
+
+.IF "$(SYSTEM_HSQLDB)" == "YES"
+XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(HSQLDB_JAR)
+.ELSE
+JARFILES+= hsqldb.jar
+.ENDIF
+
 JAVAFILES =\
 	NativeInputStreamHelper.java\
 	NativeOutputStreamHelper.java\
Index: makefile.mk
===================================================================
RCS file: /cvs/external/hsqldb/makefile.mk,v
retrieving revision 1.9
diff -u -p -r1.9 makefile.mk
--- hsqldb/makefile.mk	20 Jul 2005 13:24:41 -0000	1.9
+++ hsqldb/makefile.mk	4 Aug 2005 14:58:27 -0000
@@ -69,6 +69,12 @@ TARGET=so_hsqldb
 .INCLUDE :  version.mk
 .INCLUDE :	minor.mk
 
+.IF "$(SYSTEM_HSQLDB)" == "YES"
+all:
+        @echo "An already available installation of hsqldb should exist on your system."
+        @echo "Therefore the version provided here does not need to be built in addition."
+.ENDIF
+
 .IF "$(SOLAR_JAVA)" != ""
 # --- Files --------------------------------------------------------
 
--- solenv/config/ssrc680.ini	2005-08-04 12:50:37.000000000 +0100
+++ solenv/config/ssrc680.ini	2005-08-04 12:51:28.000000000 +0100
@@ -113,7 +113,7 @@
 			BIG_SVX TRUE
 			BIG_GOODIES TRUE
 			BMP_WRITES_FLAG TRUE
-            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS CURL DICTIONARIES FREETYPE JPEG LIBXML2 LIBXMLSEC MOZ NAS NEON PYTHON ZLIB SNDFILE PORTAUDIO SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK
+            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS CURL DICTIONARIES FREETYPE JPEG LIBXML2 LIBXMLSEC HSQLDB MOZ NAS NEON PYTHON ZLIB SNDFILE PORTAUDIO SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK
 			RES_ENUS TRUE
 			RES_GER TRUE
 			NO_REC_RES TRUE
Index: configure.in
===================================================================
RCS file: /cvs/tools/config_office/configure.in,v
retrieving revision 1.128
diff -u -u -r1.128 configure.in
--- config_office/configure.in	14 Jul 2005 13:45:35 -0000	1.128
+++ config_office/configure.in	7 Aug 2005 21:13:01 -0000
@@ -212,6 +212,9 @@
 [  --with-db-jar=JARFILE   Specify path to jarfile manually ],
 [ DB_JAR="$withval"
 ])
+AC_ARG_WITH(system-hsqldb,
+[  --with-system-hsqldb    Use hsqldb already on system
+],,)
 AC_ARG_WITH(system-sablot,
 [  --with-system-sablot    Use sablot already on system
 ],,)
@@ -2534,6 +2541,40 @@
 AC_SUBST(DB_VERSION)
 AC_SUBST(DB_INCLUDES)
 AC_SUBST(DB_JAR)
+
+dnl ===================================================================
+dnl Check for system hsqldb
+dnl ===================================================================
+AC_MSG_CHECKING([which hsqldb to use])
+if test -n "$with_system_hsqldb" -o -n "$with_system_libs" && \
+       test "$with_system_hsqldb" != "no"; then
+        AC_MSG_RESULT([external])
+        SYSTEM_HSQLDB=YES
+	 HSQLDB_JAR=/usr/share/java/hsqldb.jar
+        AC_CHECK_FILE($HSQLDB_JAR, [],
+               [AC_MSG_ERROR(hsqldb.jar not found.)], [])
+        AC_MSG_CHECKING([whether hsqldb is >= 1.8.0])
+        export HSQLDB_JAR
+        if $PERL -e 'use Archive::Zip;
+            my $file = "$ENV{'HSQLDB_JAR'}";
+            my $zip = Archive::Zip->new( $file );
+            my $mf = $zip->contents ( "META-INF/MANIFEST.MF" );
+            if ( $mf =~ m/Specification-Version: 1.8.*/ ) {
+               exit 0;
+            } else {
+               exit 1;
+            }'; then
+            AC_MSG_RESULT([yes]) 
+         else
+            AC_MSG_ERROR([no, hsqldb >= 1.8.0 is needed])
+         fi
+else
+    AC_MSG_RESULT([internal])
+    SYSTEM_HSQLDB=NO
+    BUILD_TYPE="$BUILD_TYPE HSQLDB"
+fi
+AC_SUBST(SYSTEM_HSQLDB)
+AC_SUBST(HSQLDB_JAR)
 
 dnl ===================================================================
 dnl Check for system sablot
Index: set_soenv.in
===================================================================
RCS file: /cvs/tools/config_office/set_soenv.in,v
retrieving revision 1.70
diff -u -u -r1.70 set_soenv.in
--- config_office/set_soenv.in	14 Jul 2005 13:45:49 -0000	1.70
+++ config_office/set_soenv.in	7 Aug 2005 21:13:01 -0000
@@ -1733,6 +1733,8 @@
 ToFile( "DB_VERSION",        "@DB_VERSION@",       "e" );
 ToFile( "DB_INCLUDES",       "@DB_INCLUDES@",      "e" );
 ToFile( "DB_JAR",            "@DB_JAR@",           "e" );
+ToFile( "SYSTEM_HSQLDB",     "@SYSTEM_HSQLDB@",    "e" );
+ToFile( "HSQLDB_JAR",        "@HSQLDB_JAR@",       "e" );
 ToFile( "SYSTEM_SABLOT",     "@SYSTEM_SABLOT@",    "e" );
 ToFile( "SABLOT_LIBS",       "@SABLOT_LIBS@",      "e" );
 ToFile( "SYSTEM_ODBC_HEADERS","@SYSTEM_ODBC_HEADERS@","e" );
Index: file_ooo.scp
===================================================================
RCS file: /cvs/installation/scp2/source/ooo/file_ooo.scp,v
retrieving revision 1.107
diff -u -u -r1.107 file_ooo.scp
--- scp2/source/ooo/file_ooo.scp	20 Jul 2005 12:31:10 -0000	1.107
+++ scp2/source/ooo/file_ooo.scp	7 Aug 2005 23:47:26 -0000
@@ -722,7 +722,9 @@
 #endif
 
 #ifdef SOLAR_JAVA
+#ifndef SYSTEM_HSQLDB
 STD_JAR_FILE_PATCH( gid_File_Jar_Hsqldb, hsqldb )
+#endif
 STD_JAR_FILE( gid_File_Jar_Hsqldb_Sdbc, sdbc_hsqldb )
 #endif
 
Index: makefile.mk
===================================================================
RCS file: /cvs/installation/scp2/source/ooo/makefile.mk,v
retrieving revision 1.33
diff -u -u -r1.33 makefile.mk
--- scp2/source/ooo/makefile.mk	17 Jun 2005 14:14:51 -0000	1.33
+++ scp2/source/ooo/makefile.mk	7 Aug 2005 23:47:26 -0000
@@ -158,6 +158,10 @@
 SCPDEFS+=-DSYSTEM_MYSPELL
 .ENDIF
 
+.IF "$(SYSTEM_HSQLDB)" == "YES"
+SCPDEFS+=-DSYSTEM_HSQLDB
+.ENDIF
+
 SCPDEFS+=\
     -DICU_MAJOR=$(ICU_MAJOR) \
     -DICU_MINOR=$(ICU_MINOR) \
Index: profileitem_ooo.scp
===================================================================
RCS file: /cvs/installation/scp2/source/ooo/profileitem_ooo.scp,v
retrieving revision 1.24
diff -u -u -r1.24 profileitem_ooo.scp
--- scp2/source/ooo/profileitem_ooo.scp	1 Jul 2005 12:20:55 -0000	1.24
+++ scp2/source/ooo/profileitem_ooo.scp	7 Aug 2005 23:47:26 -0000
@@ -741,6 +741,10 @@
     Section = "Bootstrap";
     Order = 7;
     Key = "UNO_JAVA_JFW_CLASSPATH_URLS";
-    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/docbook.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/XFlatXml.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar $ORIGIN/classes/hsqldb.jar $ORIGIN/classes/sdbc_hsqldb.jar";
+#ifndef SYSTEM_HSQLDB
+    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/docbook.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/XFlatXml.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar $ORIGIN/classes/hsqldb.jar  $ORIGIN/classes/sdbc_hsqldb.jar";
+#else
+    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/docbook.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/XFlatXml.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar file:///usr/share/java/hsqldb.jar $ORIGIN/classes/sdbc_hsqldb.jar";
+#endif
 End
 
