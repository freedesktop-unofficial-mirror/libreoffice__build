Index: connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk
===================================================================
--- connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk.orig	2005-09-08 06:56:11.000000000 +0200
+++ connectivity/com/sun/star/sdbcx/comp/hsqldb/makefile.mk	2005-12-28 13:10:02.000000000 +0100
@@ -43,7 +43,14 @@ TARGET  = sdbc_hsqldb 
 # --- Files --------------------------------------------------------  
 
 
-JARFILES = ridl.jar unoil.jar jurt.jar juh.jar hsqldb.jar
+JARFILES = ridl.jar unoil.jar jurt.jar juh.jar
+
+.IF "$(SYSTEM_HSQLDB)" == "YES"
+XCLASSPATH!:=$(XCLASSPATH)$(PATH_SEPERATOR)$(HSQLDB_JAR)
+.ELSE
+JARFILES+= hsqldb.jar
+.ENDIF
+
 JAVAFILES =\
 	NativeInputStreamHelper.java\
 	NativeOutputStreamHelper.java\
Index: hsqldb/makefile.mk
===================================================================
--- hsqldb/makefile.mk.orig	2005-12-28 13:08:18.000000000 +0100
+++ hsqldb/makefile.mk	2005-12-28 13:10:02.000000000 +0100
@@ -44,6 +44,12 @@ TARGET=so_hsqldb
 .INCLUDE :  version.mk
 .INCLUDE :	minor.mk
 
+.IF "$(SYSTEM_HSQLDB)" == "YES"
+all:
+        @echo "An already available installation of hsqldb should exist on your system."
+        @echo "Therefore the version provided here does not need to be built in addition."
+.ENDIF
+
 .IF "$(SOLAR_JAVA)" != ""
 # --- Files --------------------------------------------------------
 
Index: solenv/config/ssrc680.ini
===================================================================
--- solenv/config/ssrc680.ini.orig	2005-12-15 11:17:55.000000000 +0100
+++ solenv/config/ssrc680.ini	2005-12-28 13:10:54.000000000 +0100
@@ -108,7 +108,7 @@ common
 			BIG_SVX TRUE
 			BIG_GOODIES TRUE
 			BMP_WRITES_FLAG TRUE
-            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS CURL DICTIONARIES FREETYPE JPEG LIBXML2 LIBXMLSEC MOZ NAS NEON NP_SDK TWAIN PYTHON ZLIB SNDFILE PORTAUDIO SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK MSFONTEXTRACT MATHMLDTD BOOST EXPAT CRASHREP BERKELEYDB SABLOT XALAN SUN AGG
+            BUILD_TYPE SO OOo EXT BINFILTER BITSTREAM_VERA_FONTS CURL DICTIONARIES FREETYPE JPEG LIBXML2 LIBXMLSEC MOZ NAS NEON NP_SDK TWAIN PYTHON ZLIB SNDFILE PORTAUDIO SANE UNIXODBC X11_EXTENSIONS LIBWPD EPM QADEVOOO ODK MSFONTEXTRACT MATHMLDTD BOOST EXPAT CRASHREP BERKELEYDB SABLOT XALAN SUN AGG HSQLDB
 			RES_ENUS TRUE
 			RES_GER TRUE
 			NO_REC_RES TRUE
Index: config_office/configure.in
===================================================================
--- config_office/configure.in.orig	2005-12-28 13:08:22.000000000 +0100
+++ config_office/configure.in	2005-12-28 13:10:02.000000000 +0100
@@ -236,6 +236,9 @@ AC_ARG_WITH(db-jar,
 [  --with-db-jar=JARFILE   Specify path to jarfile manually ],
 [ DB_JAR="$withval"
 ])
+AC_ARG_WITH(system-hsqldb,
+[  --with-system-hsqldb    Use hsqldb already on system
+],,)
 AC_ARG_WITH(system-sablot,
 [  --with-system-sablot    Use sablot already on system
 ],,)
@@ -2663,6 +2666,40 @@ AC_SUBST(DB_INCLUDES)
 AC_SUBST(DB_JAR)
 
 dnl ===================================================================
+dnl Check for system hsqldb
+dnl ===================================================================
+AC_MSG_CHECKING([which hsqldb to use])
+if test -n "$with_system_hsqldb" -o -n "$with_system_libs" && \
+       test "$with_system_hsqldb" != "no"; then
+        AC_MSG_RESULT([external])
+        SYSTEM_HSQLDB=YES
+	 HSQLDB_JAR=/usr/share/java/hsqldb.jar
+        AC_CHECK_FILE($HSQLDB_JAR, [],
+               [AC_MSG_ERROR(hsqldb.jar not found.)], [])
+        AC_MSG_CHECKING([whether hsqldb is >= 1.8.0])
+        export HSQLDB_JAR
+        if $PERL -e 'use Archive::Zip;
+            my $file = "$ENV{'HSQLDB_JAR'}";
+            my $zip = Archive::Zip->new( $file );
+            my $mf = $zip->contents ( "META-INF/MANIFEST.MF" );
+            if ( $mf =~ m/Specification-Version: 1.8.*/ ) {
+               exit 0;
+            } else {
+               exit 1;
+            }'; then
+            AC_MSG_RESULT([yes]) 
+         else
+            AC_MSG_ERROR([no, hsqldb >= 1.8.0 is needed])
+         fi
+else
+    AC_MSG_RESULT([internal])
+    SYSTEM_HSQLDB=NO
+    BUILD_TYPE="$BUILD_TYPE HSQLDB"
+fi
+AC_SUBST(SYSTEM_HSQLDB)
+AC_SUBST(HSQLDB_JAR)
+
+dnl ===================================================================
 dnl Check for system sablot
 dnl ===================================================================
 AC_MSG_CHECKING([which sablot to use])
Index: config_office/set_soenv.in
===================================================================
--- config_office/set_soenv.in.orig	2005-12-28 13:08:22.000000000 +0100
+++ config_office/set_soenv.in	2005-12-28 13:10:02.000000000 +0100
@@ -1765,6 +1765,8 @@ ToFile( "SYSTEM_DB",         "@SYSTEM_DB
 ToFile( "DB_VERSION",        "@DB_VERSION@",       "e" );
 ToFile( "DB_INCLUDES",       "@DB_INCLUDES@",      "e" );
 ToFile( "DB_JAR",            "@DB_JAR@",           "e" );
+ToFile( "SYSTEM_HSQLDB",     "@SYSTEM_HSQLDB@",    "e" );
+ToFile( "HSQLDB_JAR",        "@HSQLDB_JAR@",       "e" );
 ToFile( "SYSTEM_SABLOT",     "@SYSTEM_SABLOT@",    "e" );
 ToFile( "SABLOT_LIBS",       "@SABLOT_LIBS@",      "e" );
 ToFile( "SYSTEM_ODBC_HEADERS","@SYSTEM_ODBC_HEADERS@","e" );
Index: scp2/source/ooo/file_ooo.scp
===================================================================
--- scp2/source/ooo/file_ooo.scp.orig	2005-12-28 13:08:23.000000000 +0100
+++ scp2/source/ooo/file_ooo.scp	2005-12-28 13:10:02.000000000 +0100
@@ -710,7 +710,9 @@ UNO_JAR_FILE( gid_File_Jar_Web, web )
 #endif
 
 #ifdef SOLAR_JAVA
+#ifndef SYSTEM_HSQLDB
 STD_JAR_FILE_PATCH( gid_File_Jar_Hsqldb, hsqldb )
+#endif
 STD_JAR_FILE( gid_File_Jar_Hsqldb_Sdbc, sdbc_hsqldb )
 #endif
 
Index: scp2/source/ooo/makefile.mk
===================================================================
--- scp2/source/ooo/makefile.mk.orig	2005-12-28 13:08:22.000000000 +0100
+++ scp2/source/ooo/makefile.mk	2005-12-28 13:10:02.000000000 +0100
@@ -142,6 +142,10 @@ SCPDEFS+=-DSYSTEM_XALAN
 SCPDEFS+=-DSYSTEM_XMLSEC
 .ENDIF
 
+.IF "$(SYSTEM_HSQLDB)" == "YES"
+SCPDEFS+=-DSYSTEM_HSQLDB
+.ENDIF
+
 .IF "$(SYSTEM_ICU)" == "YES"
 SCPDEFS+=-DSYSTEM_ICU
 .ELSE
Index: scp2/source/ooo/profileitem_ooo.scp
===================================================================
--- scp2/source/ooo/profileitem_ooo.scp.orig	2005-11-17 19:01:36.000000000 +0100
+++ scp2/source/ooo/profileitem_ooo.scp	2005-12-28 13:10:02.000000000 +0100
@@ -758,6 +758,10 @@ ProfileItem gid_Profileitem_Jvmfwk_Uno_J
     Section = "Bootstrap";
     Order = 7;
     Key = "UNO_JAVA_JFW_CLASSPATH_URLS";
-    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar $ORIGIN/classes/hsqldb.jar $ORIGIN/classes/sdbc_hsqldb.jar";
+#ifndef SYSTEM_HSQLDB
+    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar $ORIGIN/classes/hsqldb.jar  $ORIGIN/classes/sdbc_hsqldb.jar";
+#else
+    Value = "${${$ORIGIN/$UNO_SETTINGS:PKG_UserUnoFile}:UNO_JAVA_CLASSPATH} ${${$ORIGIN/$UNO_SETTINGS:PKG_SharedUnoFile}:UNO_JAVA_CLASSPATH} $ORIGIN/classes/jurt.jar $ORIGIN/classes/ridl.jar $ORIGIN/classes/java_uno.jar $ORIGIN/classes/sandbox.jar $ORIGIN/classes/bsh.jar $ORIGIN/classes/classes.jar $ORIGIN/classes/commonwizards.jar $ORIGIN/classes/htmlsoff.jar $ORIGIN/classes/java_uno_accessbridge.jar $ORIGIN/classes/js.jar $ORIGIN/classes/juh.jar $ORIGIN/classes/jut.jar $ORIGIN/classes/letter.jar $ORIGIN/classes/officebean.jar $ORIGIN/classes/query.jar $ORIGIN/classes/report.jar $ORIGIN/classes/ScriptFramework.jar $ORIGIN/classes/ScriptProviderForBeanShell.jar $ORIGIN/classes/ScriptProviderForJava.jar $ORIGIN/classes/ScriptProviderForJavaScript.jar $ORIGIN/classes/tutorial.jar $ORIGIN/classes/unoil.jar $ORIGIN/classes/web.jar $ORIGIN/classes/xmerge.jar $ORIGIN/classes/XMergeBridge.jar $ORIGIN/classes/XSLTFilter.jar $ORIGIN/classes/XSLTValidate.jar $ORIGIN/classes/xt.jar $ORIGIN/classes/activation.jar $ORIGIN/classes/agenda.jar $ORIGIN/classes/aportisdoc.jar $ORIGIN/classes/avmedia.jar $ORIGIN/classes/email.jar $ORIGIN/classes/fax.jar $ORIGIN/classes/pexcel.jar $ORIGIN/classes/pocketword.jar $ORIGIN/classes/mail.jar file:///usr/share/java/hsqldb.jar $ORIGIN/classes/sdbc_hsqldb.jar";
+#endif
 End
 
