--- sfx2/source/dialog/filedlghelper.cxx	2006-02-17 14:27:13.000000000 +0000
+++ sfx2/source/dialog/filedlghelper.cxx	2006-02-17 14:32:27.000000000 +0000
@@ -2394,6 +2394,28 @@ ErrCode FileDialogHelper::GetGraphic( Gr
 }
 
 // ------------------------------------------------------------------------
+bool impl_isFolder( const OUString& rPath, bool &rIsFolder )
+{
+	rIsFolder = false;
+	try
+	{
+		::ucb::Content aContent( 
+			rPath, star::uno::Reference< star::ucb::XCommandEnvironment >() );
+		if ( aContent.isFolder() )
+			rIsFolder = true;
+
+		return true;
+	}
+	catch ( star::ucb::ContentCreationException const & )
+	{
+	}
+	catch ( star::ucb::InteractiveAugmentedIOException const & )
+	{
+	}
+
+	return false;
+}
+
 void FileDialogHelper::SetDisplayDirectory( const String& _rPath )
 {
 	if ( !_rPath.Len() )
@@ -2403,29 +2425,24 @@ void FileDialogHelper::SetDisplayDirecto
 	// and take it as filename and the rest of the path should be
 	// the folder
 
-	::rtl::OUString sPath;
-	::rtl::OUString sFileName;
-
 	INetURLObject aObj( _rPath );
-	try
-	{
-		::ucb::Content aContent( 
-			_rPath, star::uno::Reference< star::ucb::XCommandEnvironment >() );
-		if ( !aContent.isFolder() )
-		{
-			sFileName = aObj.GetName( INetURLObject::DECODE_WITH_CHARSET );
-			aObj.removeSegment();
-			mpImp->setFileName( sFileName );
-		}
-	}
-	catch ( star::ucb::ContentCreationException const & )
+
+	::rtl::OUString sFileName = aObj.GetName( INetURLObject::DECODE_WITH_CHARSET );
+	aObj.removeSegment();
+	::rtl::OUString sPath = aObj.GetMainURL( INetURLObject::DECODE_WITH_CHARSET );
+
+	bool bIsFolder = false;
+	if ( ( impl_isFolder( _rPath, bIsFolder ) && !bIsFolder ) ||
+		 ( impl_isFolder( sPath, bIsFolder ) && bIsFolder ) )
 	{
+		mpImp->setFileName( sFileName );
+		mpImp->displayFolder( sPath );
 	}
-	catch ( star::ucb::InteractiveAugmentedIOException const & )
+	else
 	{
+		INetURLObject aObjPathName( _rPath );
+		mpImp->displayFolder( aObjPathName.GetMainURL( INetURLObject::NO_DECODE ) );
 	}
-
-    mpImp->displayFolder( aObj.GetMainURL( INetURLObject::NO_DECODE ) );
 }
 
 // ------------------------------------------------------------------------
