diff -urN --exclude='*.orig' sc.clean/source/ui/dbgui/fieldwnd.cxx sc/source/ui/dbgui/fieldwnd.cxx
--- sc.clean/source/ui/dbgui/fieldwnd.cxx	2007-10-29 12:01:46.000000000 -0400
+++ sc/source/ui/dbgui/fieldwnd.cxx	2007-10-29 12:18:58.000000000 -0400
@@ -644,7 +644,7 @@
 
 void ScDPFieldWindow::ClearFields()
 {
-    if( eType == TYPE_SELECT )
+    if( eType == TYPE_SELECT || eType == TYPE_PAGE || eType == TYPE_COL || eType == TYPE_ROW || eType == TYPE_DATA)
 	{
         com::sun::star::uno::Reference < com::sun::star::accessibility::XAccessible > xTempAcc = xAccessible;
         if (!xTempAcc.is() && pAccessible)
diff -urN --exclude='*.orig' sc.clean/source/ui/dbgui/pivot.hrc sc/source/ui/dbgui/pivot.hrc
--- sc.clean/source/ui/dbgui/pivot.hrc	2007-10-29 12:01:46.000000000 -0400
+++ sc/source/ui/dbgui/pivot.hrc	2007-10-29 12:02:15.000000000 -0400
@@ -82,4 +82,6 @@
 #define PIVOTSTR_DEV2			9
 #define PIVOTSTR_VAR			10
 #define PIVOTSTR_VAR2			11
-
+#define FT_INAREA			40
+#define RB_INAREA			41
+#define ED_INAREA			42
diff -urN --exclude='*.orig' sc.clean/source/ui/dbgui/pivot.src sc/source/ui/dbgui/pivot.src
--- sc.clean/source/ui/dbgui/pivot.src	2007-10-29 12:01:46.000000000 -0400
+++ sc/source/ui/dbgui/pivot.src	2007-10-29 12:02:15.000000000 -0400
@@ -39,7 +39,7 @@
 {
 	OutputSize = TRUE ;
 	HelpId = SID_OPENDLG_PIVOTTABLE ;
-    Size = MAP_APPFONT ( 336 , 190 ) ;
+    Size = MAP_APPFONT ( 336 , 200 ) ;
 	Hide = TRUE ;
 	SVLook = TRUE ;
 	Moveable = TRUE ;
@@ -124,6 +124,47 @@
         Size = MAP_APPFONT ( 268 , 8 ) ;
 		Text [ en-US ] = "Layout";
 	};
+
+	FixedText FT_INAREA
+        {
+        Pos = MAP_APPFONT ( 6 , 180 ) ;
+        Size = MAP_APPFONT ( 59 , 8 ) ;
+                Hide = FALSE ;
+	Text [ en-US ] = "Selection from" ;
+		Text[ de ] = "Auswahl aus";
+		Text[ es ] = "Selección de";
+		Text[ fr ] = "Sélection à partir de";
+		Text[ it ] = "Seleziona da";
+		Text[ ja ] = "選択元";
+		Text[ pt-BR ] = "Seleção de ";
+		Text[ zh-CN ] = "选择范围";
+		Text[ zh-TW ] = "選項來源";
+	};
+
+        Edit ED_INAREA
+        {
+                Border = TRUE ;
+        Pos = MAP_APPFONT ( 65 , 180 ) ;
+        Size = MAP_APPFONT ( 100 , 12 ) ;
+                TabStop = TRUE ;
+                Hide = FALSE ;
+        };
+        ImageButton RB_INAREA
+        {
+        Pos = MAP_APPFONT ( 172 , 180 ) ;
+                Size = MAP_APPFONT ( 12 , 12 ) ;
+        TabStop = TRUE ;
+        Hide = FALSE ;
+                QuickHelpText [ de ] = "Verkleinern" ;
+                QuickHelpText [ en-US ] = "Shrink" ;
+		QuickHelpText[ es ] = "Reducir";
+		QuickHelpText[ fr ] = "Comprimer";
+		QuickHelpText[ it ] = "Comprimi";
+		QuickHelpText[ ja ] = "縮小";
+		QuickHelpText[ pt-BR ] = "Diminuir";
+		QuickHelpText[ zh-CN ] = "收缩";
+		QuickHelpText[ zh-TW ] = "縮小";
+	};
 	OKButton BTN_OK
 	{
         Pos = MAP_APPFONT ( 280 , 6 ) ;
diff -urN --exclude='*.orig' sc.clean/source/ui/dbgui/pvlaydlg.cxx sc/source/ui/dbgui/pvlaydlg.cxx
--- sc.clean/source/ui/dbgui/pvlaydlg.cxx	2007-10-29 12:01:46.000000000 -0400
+++ sc/source/ui/dbgui/pvlaydlg.cxx	2007-10-29 12:18:58.000000000 -0400
@@ -41,6 +41,7 @@
 //----------------------------------------------------------------------------
 
 #include "pvlaydlg.hxx"
+#include "dbdocfun.hxx"
 
 #include <sfx2/dispatch.hxx>
 #include <vcl/msgbox.hxx>
@@ -60,6 +61,7 @@
 #include "pivot.hrc"
 #include "dpobject.hxx"
 #include "dpsave.hxx"
+#include "dpshttab.hxx"
 #include "scmod.hxx"
 
 #include "sc.hrc" //CHINA001
@@ -128,6 +130,9 @@
 		aFtOutArea		( this, ScResId( FT_OUTAREA ) ),
 		aEdOutPos		( this, ScResId( ED_OUTAREA ) ),
 		aRbOutPos		( this, ScResId( RB_OUTAREA ), &aEdOutPos ),
+		aFtInArea		( this, ScResId( FT_INAREA) ),
+		aEdInPos		( this, ScResId( ED_INAREA) ),
+		aRbInPos		( this, ScResId( RB_INAREA ), &aEdInPos ),
 		aBtnIgnEmptyRows( this, ScResId( BTN_IGNEMPTYROWS ) ),
 		aBtnDetectCat	( this, ScResId( BTN_DETECTCAT ) ),
 		aBtnTotalCol	( this, ScResId( BTN_TOTALCOL ) ),
@@ -155,7 +160,7 @@
 								GetViewData() ),
 		pDoc			( ((ScTabViewShell*)SfxViewShell::Current())->
 								GetViewData()->GetDocument() ),
-		bRefInputMode	( FALSE )
+		bRefInputMode	( TRUE )
 {
     xDlgDPObject->SetAlive( TRUE );     // needed to get structure information
     xDlgDPObject->FillOldParam( thePivotData, FALSE );
@@ -242,6 +247,24 @@
 	InitWnd( thePivotData.aRowArr,  static_cast<long>(thePivotData.nRowCount),  TYPE_ROW );
 	InitWnd( thePivotData.aDataArr, static_cast<long>(thePivotData.nDataCount), TYPE_DATA );
 
+	ScRange inRange;
+	String inString;
+	if (xDlgDPObject->GetSheetDesc())
+	{
+		aEdInPos.Enable();
+		aRbInPos.Enable();
+		inRange = xDlgDPObject->GetSheetDesc()->aSourceRange;
+		inRange.Format( inString, STD_FORMAT, pDoc);
+		aEdInPos.SetText(inString);
+	}
+	else 
+	{
+		/* Data is not reachable, so could be a remote database */
+		aEdInPos.Disable();
+		aRbInPos.Disable();
+		
+	}
+	
     aSlider.SetPageSize( PAGE_SIZE );
     aSlider.SetVisibleSize( PAGE_SIZE );
     aSlider.SetLineSize( LINE_SIZE );
@@ -259,6 +282,7 @@
 
     aLbOutPos .SetSelectHdl( LINK( this, ScDPLayoutDlg, SelAreaHdl ) );
     aEdOutPos .SetModifyHdl( LINK( this, ScDPLayoutDlg, EdModifyHdl ) );
+    aEdInPos  .SetModifyHdl( LINK( this, ScDPLayoutDlg, EdInModifyHdl ) );	
     aBtnOk    .SetClickHdl ( LINK( this, ScDPLayoutDlg, OkHdl ) );
     aBtnCancel.SetClickHdl ( LINK( this, ScDPLayoutDlg, CancelHdl ) );
 
@@ -1318,17 +1342,34 @@
 
 void ScDPLayoutDlg::SetReference( const ScRange& rRef, ScDocument* pDocP )
 {
+	ScRefEdit *tmpREd;
+	ScRefButton *tmpRBtn;
+	
 	if ( bRefInputMode )
 	{
+		tmpRBtn = GetRefButton();
+		tmpREd = tmpRBtn->GetReferencesEdit();
 		if ( rRef.aStart != rRef.aEnd )
-			RefInputStart( &aEdOutPos );
+			RefInputStart( tmpREd, tmpRBtn);
+
 /*
 		ScAddress	aAdr( nStartCol, nStartRow, nStartTab );
 		aAdr.PutInOrder( ScAddress( nEndCol, nEndRow, nEndTab ) );
 */
+
 		String aRefStr;
-        rRef.aStart.Format( aRefStr, STD_FORMAT, pDocP );
-		aEdOutPos.SetRefString( aRefStr );
+
+		if ( tmpREd== &aEdInPos)
+		{
+			USHORT	 	nFmt = SCR_ABS_3D;		 //!!! nCurTab fehlt noch		
+			if ( rRef.aStart.Tab() != rRef.aEnd.Tab() )
+				nFmt |= SCA_TAB2_3D;		
+			rRef.Format( aRefStr, nFmt, pDocP );
+		}
+		else			
+			rRef.aStart.Format( aRefStr, STD_FORMAT, pDocP );
+		
+		tmpREd->SetRefString( aRefStr );
 	}
 }
 
@@ -1516,7 +1557,7 @@
 	}
 	else
 	{
-		bRefInputMode = FALSE;
+
 		//@BugID 54702 Enablen/Disablen nur noch in Basisklasse
 		//SFX_APPWINDOW->Disable(FALSE);		//! allgemeine Methode im ScAnyRefDlg
 	}
@@ -1553,6 +1594,99 @@
 }
 
 
+IMPL_LINK( ScDPLayoutDlg, EdInModifyHdl, Edit *, EMPTYARG )
+{
+
+	String	theCurPosStr = aEdInPos.GetText();
+	ScSheetSourceDesc inSheet = *(xDlgDPObject->GetSheetDesc());
+        ScRange aR = xDlgDPObject->GetSheetDesc()->aSourceRange;        
+	ScRefAddress start, end;
+	ConvertDoubleRef (pDoc, theCurPosStr, 1,  start, end );
+	inSheet.aSourceRange = ScRange(start.GetAddress(), end.GetAddress());
+	xDlgDPObject->SetSheetDesc( inSheet);
+	xDlgDPObject->InvalidateSource();
+	xDlgDPObject->Output();
+	xDlgDPObject->SetAlive( TRUE );		// needed to get structure information
+	xDlgDPObject->FillOldParam( thePivotData, FALSE );
+	xDlgDPObject->FillLabelData( thePivotData );
+
+	ScTabViewShell * pTabViewShell = pViewData->GetViewShell();
+	ScDPObject tmpDPObject(*xDlgDPObject);
+	pTabViewShell->SetDialogDPObject(&tmpDPObject);
+			
+	aR = xDlgDPObject->GetSheetDesc()->aSourceRange;
+	
+	aLabelDataArr.clear();
+	aWndSelect.ClearFields();
+	aWndData.ClearFields();
+	aWndRow.ClearFields();
+	aWndCol.ClearFields();
+	aWndPage.ClearFields();
+	
+	USHORT i;
+ 	for ( i=0; i<MAX_LABELS; i++ )
+		aSelectArr[i].reset();
+
+	for ( i=0; i<MAX_FIELDS; i++ )
+	{
+		RemoveField (TYPE_COL, i);
+		RemoveField (TYPE_ROW, i);
+		RemoveField (TYPE_DATA, i);
+	}
+	for ( i=0; i<MAX_PAGEFIELDS; i++ )
+		RemoveField (TYPE_PAGE, i);
+
+	
+	
+	InitWndSelect( thePivotData.ppLabelArr, thePivotData.nLabels );
+	InitWnd( thePivotData.aColArr,  thePivotData.nColCount,  TYPE_COL );
+	InitWnd( thePivotData.aRowArr,  thePivotData.nRowCount,  TYPE_ROW );
+	InitWnd( thePivotData.aDataArr, thePivotData.nDataCount, TYPE_DATA );
+	aSlider.SetPageSize( PAGE_SIZE );
+	aSlider.SetVisibleSize( PAGE_SIZE );
+	aSlider.SetLineSize( LINE_SIZE );
+	aSlider.SetRange( Range( 0, ((thePivotData.nLabels+LINE_SIZE-1)/LINE_SIZE)*LINE_SIZE ) );
+
+	if ( thePivotData.nLabels > PAGE_SIZE )
+	{
+        aSlider.SetEndScrollHdl( LINK( this, ScDPLayoutDlg, ScrollHdl ) );
+		aSlider.Show();
+	}
+	else
+		aSlider.Hide();
+
+	if ( pViewData && pDoc )
+	{
+		/*
+		 * Aus den RangeNames des Dokumentes werden nun die
+		 * in einem Zeiger-Array gemerkt, bei denen es sich
+		 * um sinnvolle Bereiche handelt
+		 */
+
+		aLbOutPos.Clear();
+		aLbOutPos.InsertEntry( aStrUndefined, 0 );
+		aLbOutPos.InsertEntry( aStrNewTable,  1 );
+
+		ScAreaNameIterator aIter( pDoc );
+		String aName;
+		ScRange aRange;
+		String aRefStr;
+		while ( aIter.Next( aName, aRange ) )
+		{
+			if ( !aIter.WasDBName() )		// hier keine DB-Bereiche !
+			{
+				USHORT nInsert = aLbOutPos.InsertEntry( aName );
+
+				aRange.aStart.Format( aRefStr, SCA_ABS_3D, pDoc );
+				aLbOutPos.SetEntryData( nInsert, new String( aRefStr ) );
+			}
+		}
+	}
+
+	return 0;
+}
+
+
 //----------------------------------------------------------------------------
 
 IMPL_LINK( ScDPLayoutDlg, SelAreaHdl, ListBox *, EMPTYARG )
diff -urN --exclude='*.orig' sc.clean/source/ui/inc/anyrefdg.hxx sc/source/ui/inc/anyrefdg.hxx
--- sc.clean/source/ui/inc/anyrefdg.hxx	2007-10-29 12:01:46.000000000 -0400
+++ sc/source/ui/inc/anyrefdg.hxx	2007-10-29 12:02:15.000000000 -0400
@@ -115,7 +115,7 @@
                         ScRefButton( Window* pParent, const ResId& rResId );
 
     void                SetReferences( ScAnyRefDlg* pDlg, ScRefEdit* pEdit );
-
+    ScRefEdit* 	   GetReferencesEdit ();
     void                SetStartImage();
     void                SetEndImage();
     inline void         DoRef() { Click(); }
@@ -169,6 +169,7 @@
                         ScAnyRefDlg( SfxBindings* pB, SfxChildWindow* pCW,
                                      Window* pParent, USHORT nResId);
     virtual             ~ScAnyRefDlg();
+    ScRefButton* GetRefButton()	{ return pRefBtn; }
 
     virtual void        SetReference( const ScRange& rRef, ScDocument* pDoc ) = 0;
     virtual void        AddRefEntry();
diff -urN --exclude='*.orig' sc.clean/source/ui/inc/pvlaydlg.hxx sc/source/ui/inc/pvlaydlg.hxx
--- sc.clean/source/ui/inc/pvlaydlg.hxx	2007-10-29 12:01:46.000000000 -0400
+++ sc/source/ui/inc/pvlaydlg.hxx	2007-10-29 12:02:15.000000000 -0400
@@ -145,8 +145,11 @@
     FixedLine               aFlAreas;
     ListBox                 aLbOutPos;
     FixedText               aFtOutArea;
+    FixedText			aFtInArea;
     ScRefEdit               aEdOutPos;
     ScRefButton             aRbOutPos;
+    ScRefEdit               aEdInPos;
+    ScRefButton             aRbInPos;
     CheckBox                aBtnIgnEmptyRows;
     CheckBox                aBtnDetectCat;
     CheckBox                aBtnTotalCol;
@@ -227,6 +230,7 @@
 	DECL_LINK( SelAreaHdl, ListBox * );
 	DECL_LINK( MoreClickHdl, MoreButton * );
 	DECL_LINK( EdModifyHdl, Edit * );
+	DECL_LINK( EdInModifyHdl, Edit * );
 	DECL_LINK( OkHdl, OKButton * );
 	DECL_LINK( CancelHdl, CancelButton * );
 };
diff -urN --exclude='*.orig' sc.clean/source/ui/miscdlgs/anyrefdg.cxx sc/source/ui/miscdlgs/anyrefdg.cxx
--- sc.clean/source/ui/miscdlgs/anyrefdg.cxx	2007-10-29 12:01:47.000000000 -0400
+++ sc/source/ui/miscdlgs/anyrefdg.cxx	2007-10-29 12:02:15.000000000 -0400
@@ -290,6 +290,11 @@
     pRefEdit = pEdit;
 }
 
+ScRefEdit* ScRefButton::GetReferencesEdit ()
+{
+    return pRefEdit;
+}
+
 //----------------------------------------------------------------------------
 
 void ScRefButton::Click()
