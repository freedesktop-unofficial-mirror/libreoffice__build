diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/inc/svx/editeng.hxx svx/inc/svx/editeng.hxx
--- svx.clean/inc/svx/editeng.hxx	2008-02-25 11:50:16.000000000 -0500
+++ svx/inc/svx/editeng.hxx	2008-02-27 23:29:13.000000000 -0500
@@ -61,6 +61,7 @@ class Rectangle;
 class SvStream;
 class Link;
 class OutputDevice;
+class Window;
 class SvUShorts;
 class SfxPoolItem;
 class SvxNumBulletItem;
@@ -133,7 +134,7 @@ private:
 	SVX_DLLPRIVATE EditEngine&		operator=( const EditEngine& );
 
 //#if 0 // _SOLAR__PRIVATE
-	SVX_DLLPRIVATE BOOL				PostKeyEvent( const KeyEvent& rKeyEvent, EditView* pView );
+	SVX_DLLPRIVATE BOOL				PostKeyEvent( const KeyEvent& rKeyEvent, EditView* pView, Window* pFrameWin = NULL );
 //#endif
 
 public:
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/inc/svx/editview.hxx svx/inc/svx/editview.hxx
--- svx.clean/inc/svx/editview.hxx	2008-02-25 11:50:16.000000000 -0500
+++ svx/inc/svx/editview.hxx	2008-02-27 23:15:13.000000000 -0500
@@ -162,7 +162,7 @@ public:
 
 	void			InsertText( const String& rNew, BOOL bSelect = FALSE );
 
-	BOOL			PostKeyEvent( const KeyEvent& rKeyEvent );
+	BOOL			PostKeyEvent( const KeyEvent& rKeyEvent, Window* pFrameWin = NULL );
 
 	BOOL			MouseButtonUp( const MouseEvent& rMouseEvent );
 	BOOL			MouseButtonDown( const MouseEvent& rMouseEvent );
@@ -225,7 +225,7 @@ public:
 
 	BOOL			MatchGroup();
 
-	void			CompleteAutoCorrect();
+	void			CompleteAutoCorrect( Window* pFrameWin = NULL );
 
 	EESpellState	StartSpeller( BOOL bMultipleDoc = FALSE );
 	EESpellState	StartThesaurus();
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/inc/svx/outliner.hxx svx/inc/svx/outliner.hxx
--- svx.clean/inc/svx/outliner.hxx	2008-02-25 11:50:16.000000000 -0500
+++ svx/inc/svx/outliner.hxx	2008-02-28 18:57:43.000000000 -0500
@@ -274,7 +274,7 @@ public:
 	void        Scroll( long nHorzScroll, long nVertScroll );
 
 	void        Paint( const Rectangle& rRect );
-	BOOL        PostKeyEvent( const KeyEvent& rKEvt );
+	BOOL        PostKeyEvent( const KeyEvent& rKEvt, Window* pFrameWin = NULL );
 	BOOL        MouseButtonDown( const MouseEvent& );
 	BOOL        MouseButtonUp( const MouseEvent& );
 	BOOL        MouseMove( const MouseEvent& );
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/inc/svx/svxacorr.hxx svx/inc/svx/svxacorr.hxx
--- svx.clean/inc/svx/svxacorr.hxx	2008-02-25 11:50:16.000000000 -0500
+++ svx/inc/svx/svxacorr.hxx	2008-02-28 11:46:04.000000000 -0500
@@ -75,6 +75,7 @@ class SvxAutoCorrLanguageTable_Impl;
 class SvxAutoCorrLastFileAskTable_Impl;
 class SotStorageRef;
 class SotStorage;
+class Window;
 
 // Flags fuer die AutoKorrekt-Flags
 const long CptlSttSntnc		= 0x00000001;	// Gross-Buchstaben am SatzAnfang
@@ -90,6 +91,7 @@ const long SaveWordCplSttLst= 0x00000200
 const long SaveWordWrdSttLst= 0x00000400;	// 2 GrB. am WortAnf. auto. aufnehmen
 const long IngnoreDoubleSpace= 0x00000800;	// 2 Spaces ignorieren
 const long ChgSglQuotes		= 0x00001000;	// einfache Quotes ersetzen
+const long CorrectCapsLock  = 0x00002000;   // Correct accidental use of cAPS LOCK key
 
 const long ChgWordLstLoad	= 0x20000000;	// Ersetzungsliste geladen
 const long CplSttLstLoad	= 0x40000000;	// Exceptionlist fuer CplStart geladen
@@ -277,7 +279,7 @@ public:
 	// fuehre eine AutoKorrektur aus.
 	// returnt was ausgefuehrt wurde; entsprechend den obigen Flags
 	ULONG AutoCorrect( SvxAutoCorrDoc& rDoc, const String& rTxt,
-						xub_StrLen nPos, sal_Unicode cInsChar, BOOL bInsert );
+						xub_StrLen nPos, sal_Unicode cInsChar, BOOL bInsert, Window* pFrameWin = NULL );
 
 	// return fuer die Autotext Expandierung das vorherige Wort, was dem
 	// AutoCorrect - Algorythmus entspricht.
@@ -402,6 +404,10 @@ public:
 								xub_StrLen nSttPos, xub_StrLen nEndPos,
 								LanguageType eLang  = LANGUAGE_SYSTEM);
 
+    bool FnCorrectCapsLock( SvxAutoCorrDoc&, const String&, 
+                            xub_StrLen nSttPos, xub_StrLen nEndPos,
+                            LanguageType eLang  = LANGUAGE_SYSTEM );
+
 	static long			GetDefaultFlags();
 
 // returns TRUE for charcters where the function
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/dialog/autocdlg.cxx svx/source/dialog/autocdlg.cxx
--- svx.clean/source/dialog/autocdlg.cxx	2008-02-25 11:50:19.000000000 -0500
+++ svx/source/dialog/autocdlg.cxx	2008-02-25 23:26:30.000000000 -0500
@@ -260,7 +260,8 @@ OfaAutocorrOptionsPage::OfaAutocorrOptio
     sNoDblSpaces        (SVX_RES(STR_NO_DBL_SPACES    )),
     sHalf               (SVX_RES(ST_FRACTION          )),
 	sDash    			(SVX_RES(ST_DASH	         	)),
-    sFirst              (SVX_RES(ST_ORDINAL           ))
+    sFirst              (SVX_RES(ST_ORDINAL           )),
+    sAccidentalCaps     (SVX_RES(ST_CORRECT_ACCIDENTAL_CAPS_LOCK))
 {
 	FreeResource();
 
@@ -306,6 +307,7 @@ BOOL OfaAutocorrOptionsPage::FillItemSet
 	pAutoCorrect->SetAutoCorrFlag(ChgFractionSymbol,	aCheckLB.IsChecked(nPos++));
 	pAutoCorrect->SetAutoCorrFlag(ChgToEnEmDash,		aCheckLB.IsChecked(nPos++));
 	pAutoCorrect->SetAutoCorrFlag(IngnoreDoubleSpace,	aCheckLB.IsChecked(nPos++));
+    pAutoCorrect->SetAutoCorrFlag(CorrectCapsLock,      aCheckLB.IsChecked(nPos++));
 
 	BOOL bReturn = nFlags != pAutoCorrect->GetFlags();
 	if(bReturn )
@@ -347,6 +349,7 @@ void OfaAutocorrOptionsPage::Reset( cons
 	aCheckLB.InsertEntry(sHalf);
 	aCheckLB.InsertEntry(sDash);
 	aCheckLB.InsertEntry(sNoDblSpaces);
+    aCheckLB.InsertEntry(sAccidentalCaps);
 
 	USHORT nPos = 0;
 	aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & Autocorrect) );
@@ -358,6 +361,7 @@ void OfaAutocorrOptionsPage::Reset( cons
 	aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & ChgFractionSymbol) );
 	aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & ChgToEnEmDash) );
 	aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & IngnoreDoubleSpace) );
+    aCheckLB.CheckEntryPos( nPos++, 0 != (nFlags & CorrectCapsLock) );
 
 	aCheckLB.SetUpdateMode(TRUE);
 }
@@ -490,6 +494,7 @@ enum OfaAutoFmtOptions
 	DEL_SPACES_AT_STT_END,
 	DEL_SPACES_BETWEEN_LINES,
 	IGNORE_DBLSPACE,
+    CORRECT_CAPS_LOCK,
 	APPLY_NUMBERING,
 	INSERT_BORDER,
 	CREATE_TABLE,
@@ -519,6 +524,7 @@ OfaSwAutoFmtOptionsPage::OfaSwAutoFmtOpt
 	sBullet				(SVX_RES(	ST_BULLET       )),
 	sBoldUnder			(SVX_RES(	ST_BOLD_UNDER   )),
 	sNoDblSpaces		(SVX_RES(	STR_NO_DBL_SPACES)),
+    sCorrectCapsLock    (SVX_RES(   ST_CORRECT_ACCIDENTAL_CAPS_LOCK)),
 	sFraction			(SVX_RES(	ST_FRACTION     )),
 	sDetectURL			(SVX_RES(	ST_DETECT_URL   )),
 	sDash				(SVX_RES(	ST_DASH         )),
@@ -659,6 +665,9 @@ BOOL OfaSwAutoFmtOptionsPage::FillItemSe
 	pAutoCorrect->SetAutoCorrFlag(IngnoreDoubleSpace,
 						aCheckLB.IsChecked(IGNORE_DBLSPACE, CBCOL_SECOND));
 
+    pAutoCorrect->SetAutoCorrFlag(CorrectCapsLock,
+                        aCheckLB.IsChecked(CORRECT_CAPS_LOCK, CBCOL_SECOND));
+
 	bCheck = aCheckLB.IsChecked(DETECT_URL, CBCOL_FIRST);
 	bModified |= pOpt->bSetINetAttr != bCheck;
 	pOpt->bSetINetAttr = bCheck;
@@ -790,6 +799,7 @@ void OfaSwAutoFmtOptionsPage::Reset( con
 	aCheckLB.GetModel()->Insert(CreateEntry(sDelSpaceBetweenLines, CBCOL_BOTH  ));
 
 	aCheckLB.GetModel()->Insert(CreateEntry(sNoDblSpaces,		CBCOL_SECOND));
+    aCheckLB.GetModel()->Insert(CreateEntry(sCorrectCapsLock,   CBCOL_SECOND));
 	aCheckLB.GetModel()->Insert(CreateEntry(sNum,				CBCOL_SECOND));
 	aCheckLB.GetModel()->Insert(CreateEntry(sBorder,			CBCOL_SECOND));
 	aCheckLB.GetModel()->Insert(CreateEntry(sTable,				CBCOL_SECOND));
@@ -809,6 +819,7 @@ void OfaSwAutoFmtOptionsPage::Reset( con
 	aCheckLB.CheckEntryPos( BOLD_UNDERLINE,		CBCOL_FIRST,	pOpt->bChgWeightUnderl );
 	aCheckLB.CheckEntryPos( BOLD_UNDERLINE,		CBCOL_SECOND,	0 != (nFlags & ChgWeightUnderl) );
 	aCheckLB.CheckEntryPos( IGNORE_DBLSPACE,	CBCOL_SECOND,	0 != (nFlags & IngnoreDoubleSpace) );
+    aCheckLB.CheckEntryPos( CORRECT_CAPS_LOCK,  CBCOL_SECOND,   0 != (nFlags & CorrectCapsLock) );
 	aCheckLB.CheckEntryPos( DETECT_URL,			CBCOL_FIRST,	pOpt->bSetINetAttr );
 	aCheckLB.CheckEntryPos( DETECT_URL,			CBCOL_SECOND,	0 != (nFlags & SetINetAttr) );
 	aCheckLB.CheckEntryPos( REPLACE_1ST,		CBCOL_FIRST,	pOpt->bChgOrdinalNumber );
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/dialog/autocdlg.hrc svx/source/dialog/autocdlg.hrc
--- svx.clean/source/dialog/autocdlg.hrc	2008-02-25 11:50:19.000000000 -0500
+++ svx/source/dialog/autocdlg.hrc	2008-02-25 17:43:51.000000000 -0500
@@ -157,6 +157,7 @@
 #define ST_DASH                         208
 #define FT_LANG                         209
 #define LB_LANG                         210
+#define ST_CORRECT_ACCIDENTAL_CAPS_LOCK 211
 
 #define CB_SMARTTAGS                    220
 #define FT_SMARTTAGS                    221
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/dialog/autocdlg.hxx svx/source/dialog/autocdlg.hxx
--- svx.clean/source/dialog/autocdlg.hxx	2008-02-25 11:50:19.000000000 -0500
+++ svx/source/dialog/autocdlg.hxx	2008-02-25 19:07:16.000000000 -0500
@@ -149,6 +149,7 @@ private:
 	String		sHalf;
 	String		sDash;
 	String		sFirst;
+    String      sAccidentalCaps;
 
 public:
 						OfaAutocorrOptionsPage( Window* pParent, const SfxItemSet& rSet );
@@ -187,6 +188,7 @@ class OfaSwAutoFmtOptionsPage : public S
 	String			sByInputBullet;
 	String			sBoldUnder;
 	String			sNoDblSpaces;
+    String          sCorrectCapsLock;
 	String			sFraction;
 	String			sDetectURL;
 	String          sDash;
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/dialog/autocdlg.src svx/source/dialog/autocdlg.src
--- svx.clean/source/dialog/autocdlg.src	2008-02-25 11:50:19.000000000 -0500
+++ svx/source/dialog/autocdlg.src	2008-02-25 17:46:00.000000000 -0500
@@ -145,7 +145,11 @@ TabDialog RID_OFA_AUTOCORR_DLG
     String ST_DASH \
     { \
         Text [ en-US ] = "Replace dashes" ; \
-	};
+	}; \
+    String ST_CORRECT_ACCIDENTAL_CAPS_LOCK \
+    { \
+        Text [ en-US ] = "Correct accidental use of cAPS LOCK key" ; \
+    };
 
 /**************************************************************************/
 /*                                                                        */
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/acorrcfg.cxx svx/source/editeng/acorrcfg.cxx
--- svx.clean/source/editeng/acorrcfg.cxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/acorrcfg.cxx	2008-02-25 19:15:21.000000000 -0500
@@ -139,9 +139,10 @@ Sequence<OUString> 	SvxBaseAutoCorrCfg::
 		"SingleQuoteAtEnd",						// 13
 		"ReplaceDoubleQuote",					// 14
 		"DoubleQuoteAtStart",					// 15
-		"DoubleQuoteAtEnd"						// 16
+		"DoubleQuoteAtEnd",						// 16
+        "CorrectAccidentalCapsLock"             // 17
 	};
-	const int nCount = 17;
+	const int nCount = 18;
 	Sequence<OUString> aNames(nCount);
 	OUString* pNames = aNames.getArray();
 	for(int i = 0; i < nCount; i++)
@@ -241,6 +242,10 @@ void SvxBaseAutoCorrCfg::Load(sal_Bool b
 						rParent.pAutoCorrect->SetEndDoubleQuote(
                             sal::static_int_cast< sal_Unicode >( nTemp ) );
 					break;//"DoubleQuoteAtEnd"
+                    case 17:
+                        if(*(sal_Bool*)pValues[nProp].getValue())
+                            nFlags |= CorrectCapsLock;
+                    break;//"CorrectAccidentalCapsLock"
 				}
 			}
 		}
@@ -345,6 +350,10 @@ void SvxBaseAutoCorrCfg::Commit()
 			case 16:
 				pValues[nProp] <<= (sal_Int32) rParent.pAutoCorrect->GetEndDoubleQuote();
 			break;//"DoubleQuoteAtEnd"
+            case 17:
+                bVal = 0 != (nFlags & CorrectCapsLock);
+                pValues[nProp].setValue(&bVal, rType);
+            break;//"CorrectAccidentalCapsLock"
 		}
 	}
 	PutProperties(aNames, aValues);
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/editeng.cxx svx/source/editeng/editeng.cxx
--- svx.clean/source/editeng/editeng.cxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/editeng.cxx	2008-02-28 14:24:30.000000000 -0500
@@ -831,7 +831,7 @@ ESelection EditEngine::CursorRight( cons
 	return pE->pImpEditEngine->CreateESel( aSel );
 }
 
-sal_Bool EditEngine::PostKeyEvent( const KeyEvent& rKeyEvent, EditView* pEditView )
+sal_Bool EditEngine::PostKeyEvent( const KeyEvent& rKeyEvent, EditView* pEditView, Window* pFrameWin )
 {
 	DBG_CHKTHIS( EditEngine, 0 );
 	DBG_CHKOBJ( pEditView, EditView, 0 );
@@ -1018,7 +1018,7 @@ sal_Bool EditEngine::PostKeyEvent( const
 						if ( bSel )
 							pImpEditEngine->UndoActionStart( EDITUNDO_INSERT );
 						if ( pImpEditEngine->GetStatus().DoAutoCorrect() )
-							aCurSel = pImpEditEngine->AutoCorrect( aCurSel, 0, !pEditView->IsInsertMode() );
+							aCurSel = pImpEditEngine->AutoCorrect( aCurSel, 0, !pEditView->IsInsertMode(), pFrameWin );
 						aCurSel = pImpEditEngine->InsertTab( aCurSel );
 						if ( bSel )
 							pImpEditEngine->UndoActionEnd( EDITUNDO_INSERT );
@@ -1039,7 +1039,7 @@ sal_Bool EditEngine::PostKeyEvent( const
 						pImpEditEngine->UndoActionStart( EDITUNDO_INSERT );
 						if ( rKeyEvent.GetKeyCode().IsShift() )
                         {
-                            aCurSel = pImpEditEngine->AutoCorrect( aCurSel, 0, !pEditView->IsInsertMode() );
+                            aCurSel = pImpEditEngine->AutoCorrect( aCurSel, 0, !pEditView->IsInsertMode(), pFrameWin );
 							aCurSel = pImpEditEngine->InsertLineBreak( aCurSel );
                         }
 						else
@@ -1047,7 +1047,7 @@ sal_Bool EditEngine::PostKeyEvent( const
 							if ( !aAutoText.Len() )
 							{
 								if ( pImpEditEngine->GetStatus().DoAutoCorrect() )
-									aCurSel = pImpEditEngine->AutoCorrect( aCurSel, 0, !pEditView->IsInsertMode() );
+									aCurSel = pImpEditEngine->AutoCorrect( aCurSel, 0, !pEditView->IsInsertMode(), pFrameWin );
 								aCurSel = pImpEditEngine->InsertParaBreak( aCurSel );
 							}
 							else
@@ -1095,7 +1095,8 @@ sal_Bool EditEngine::PostKeyEvent( const
 						 	( nCharCode == '\"' ) || ( nCharCode == '\'' ) ||
 							( nCharCode == '_' )  ))
 					{
-						aCurSel = pImpEditEngine->AutoCorrect( aCurSel, nCharCode, !pEditView->IsInsertMode() );
+						aCurSel = pImpEditEngine->AutoCorrect( 
+                            aCurSel, nCharCode, !pEditView->IsInsertMode(), pFrameWin );
 					}
 					else
 					{
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/editview.cxx svx/source/editeng/editview.cxx
--- svx.clean/source/editeng/editview.cxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/editview.cxx	2008-02-28 11:52:15.000000000 -0500
@@ -59,6 +59,7 @@
 #include <helpid.hrc>
 #include <i18npool/lang.h>
 #include <vcl/menu.hxx>
+#include <vcl/window.hxx>
 #include <acorrcfg.hxx>
 
 #ifndef _UNO_LINGU_HXX
@@ -434,11 +435,11 @@ void EditView::InsertText( const XubStri
 	pImpEE->FormatAndUpdate( this );
 }
 
-sal_Bool EditView::PostKeyEvent( const KeyEvent& rKeyEvent )
+sal_Bool EditView::PostKeyEvent( const KeyEvent& rKeyEvent, Window* pFrameWin )
 {
 	DBG_CHKTHIS( EditView, 0 );
 	DBG_CHKOBJ( pImpEditView->pEditEngine, EditEngine, 0 );
-	return pImpEditView->PostKeyEvent( rKeyEvent );
+	return pImpEditView->PostKeyEvent( rKeyEvent, pFrameWin );
 }
 
 sal_Bool EditView::MouseButtonUp( const MouseEvent& rMouseEvent )
@@ -934,7 +935,7 @@ sal_Bool EditView::MatchGroup()
 	return sal_False;
 }
 
-void EditView::CompleteAutoCorrect()
+void EditView::CompleteAutoCorrect( Window* pFrameWin )
 {
 	DBG_CHKTHIS( EditView, 0 );
 	DBG_CHKOBJ( pImpEditView->pEditEngine, EditEngine, 0 );
@@ -944,7 +945,7 @@ void EditView::CompleteAutoCorrect()
 		EditSelection aSel = pImpEditView->GetEditSelection();
 		aSel = PIMPEE->EndOfWord( aSel.Max() );
 		// MT 06/00: Why pass EditSelection to AutoCorrect, not EditPaM?!
-		aSel = PIMPEE->AutoCorrect( aSel, 0, !IsInsertMode() );
+		aSel = PIMPEE->AutoCorrect( aSel, 0, !IsInsertMode(), pFrameWin );
 		pImpEditView->SetEditSelection( aSel );
 		if ( PIMPEE->IsModified() )
 			PIMPEE->FormatAndUpdate( this );
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/impedit2.cxx svx/source/editeng/impedit2.cxx
--- svx.clean/source/editeng/impedit2.cxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/impedit2.cxx	2008-02-28 11:56:17.000000000 -0500
@@ -2428,7 +2428,8 @@ void ImpEditEngine::ImpRemoveParagraph( 
 	}
 }
 
-EditPaM ImpEditEngine::AutoCorrect( const EditSelection& rCurSel, xub_Unicode c, BOOL bOverwrite )
+EditPaM ImpEditEngine::AutoCorrect( const EditSelection& rCurSel, xub_Unicode c, 
+                                    bool bOverwrite, Window* pFrameWin )
 {
 	EditSelection aSel( rCurSel );
 #ifndef SVX_LIGHT
@@ -2478,7 +2479,7 @@ EditPaM ImpEditEngine::AutoCorrect( cons
 		ContentNode* pNode = aSel.Max().GetNode();
 		USHORT nIndex = aSel.Max().GetIndex();
 		EdtAutoCorrDoc aAuto( this, pNode, nIndex, c );
-		pAutoCorrect->AutoCorrect( aAuto, *pNode, nIndex, c, !bOverwrite );
+		pAutoCorrect->AutoCorrect( aAuto, *pNode, nIndex, c, !bOverwrite, pFrameWin );
 		aSel.Max().SetIndex( aAuto.GetCursor() );
 
 		// #i78661 since the SvxAutoCorrect object used here is
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/impedit.cxx svx/source/editeng/impedit.cxx
--- svx.clean/source/editeng/impedit.cxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/impedit.cxx	2008-02-28 02:02:11.000000000 -0500
@@ -1041,7 +1041,7 @@ Pair ImpEditView::Scroll( long ndX, long
 	return Pair( nRealDiffX, nRealDiffY );
 }
 
-sal_Bool ImpEditView::PostKeyEvent( const KeyEvent& rKeyEvent )
+sal_Bool ImpEditView::PostKeyEvent( const KeyEvent& rKeyEvent, Window* pFrameWin )
 {
     BOOL bDone = FALSE;
 
@@ -1085,7 +1085,7 @@ sal_Bool ImpEditView::PostKeyEvent( cons
     }
 
     if( !bDone )
-	    bDone = pEditEngine->PostKeyEvent( rKeyEvent, GetEditViewPtr() );
+	    bDone = pEditEngine->PostKeyEvent( rKeyEvent, GetEditViewPtr(), pFrameWin );
 
     return bDone;
 }
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/impedit.hxx svx/source/editeng/impedit.hxx
--- svx.clean/source/editeng/impedit.hxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/impedit.hxx	2008-02-28 11:51:11.000000000 -0500
@@ -138,6 +138,8 @@ class TextRanger;
 class SvKeyValueIterator;
 class SvxForbiddenCharactersTable;
 class SvtCTLOptions;
+class Window;
+
 #ifndef SVX_SPELL_PORTIONS_HXX
 #include <svx/SpellPortions.hxx>
 #endif
@@ -333,7 +335,7 @@ public:
 
 	BOOL			IsVertical() const;
 
-	BOOL			PostKeyEvent( const KeyEvent& rKeyEvent );
+	BOOL			PostKeyEvent( const KeyEvent& rKeyEvent, Window* pFrameWin = NULL );
 
 	BOOL			MouseButtonUp( const MouseEvent& rMouseEvent );
 	BOOL			MouseButtonDown( const MouseEvent& rMouseEvent );
@@ -833,7 +835,7 @@ public:
 	EditPaM			DeleteSelected( EditSelection aEditSelection);
     EditPaM         InsertText( const EditSelection& rCurEditSelection, sal_Unicode c, sal_Bool bOverwrite, sal_Bool bIsUserInput = sal_False );
 	EditPaM			InsertText( EditSelection aCurEditSelection, const String& rStr );
-	EditPaM			AutoCorrect( const EditSelection& rCurEditSelection, sal_Unicode c, sal_Bool bOverwrite );
+	EditPaM			AutoCorrect( const EditSelection& rCurEditSelection, sal_Unicode c, bool bOverwrite, Window* pFrameWin = NULL );
 	EditPaM			DeleteLeftOrRight( const EditSelection& rEditSelection, BYTE nMode, BYTE nDelMode = DELMODE_SIMPLE );
 	EditPaM			InsertParaBreak( EditSelection aEditSelection );
 	EditPaM			InsertLineBreak( EditSelection aEditSelection );
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/editeng/svxacorr.cxx svx/source/editeng/svxacorr.cxx
--- svx.clean/source/editeng/svxacorr.cxx	2008-02-25 11:50:18.000000000 -0500
+++ svx/source/editeng/svxacorr.cxx	2008-02-28 22:39:51.000000000 -0500
@@ -119,6 +119,7 @@
 #include <svx/escpitem.hxx>
 #include <svx/svxacorr.hxx>
 #include "unolingu.hxx"
+#include "vcl/window.hxx"
 
 #ifndef _SVX_HELPID_HRC
 #include <helpid.hrc>
@@ -412,7 +413,8 @@ long SvxAutoCorrect::GetDefaultFlags()
 					| SetINetAttr
 					| ChgQuotes
 					| SaveWordCplSttLst
-					| SaveWordWrdSttLst;
+					| SaveWordWrdSttLst
+                    | CorrectCapsLock;
 	LanguageType eLang = GetAppLang();
 	switch( eLang )
 	{
@@ -1113,6 +1115,49 @@ BOOL SvxAutoCorrect::FnCptlSttSntnc( Svx
 
 	return bRet;
 }
+
+bool SvxAutoCorrect::FnCorrectCapsLock( SvxAutoCorrDoc& rDoc, const String& rTxt,
+                                        xub_StrLen nSttPos, xub_StrLen nEndPos,
+                                        LanguageType eLang )
+{
+    if (nEndPos - nSttPos < 2)
+        // string must be at least 2-character long.
+        return false;
+
+    CharClass& rCC = GetCharClass( eLang );
+
+    // Check the first 2 letters.
+    if ( !IsLowerLetter(rCC.getCharacterType(rTxt, nSttPos)) )
+        return false;
+
+    if ( !IsUpperLetter(rCC.getCharacterType(rTxt, nSttPos+1)) )
+        return false;
+
+    String aConverted;
+    aConverted.Append( rCC.upper(rTxt.GetChar(nSttPos)) );
+    aConverted.Append( rCC.lower(rTxt.GetChar(nSttPos+1)) );
+
+    for (xub_StrLen i = nSttPos+2; i < nEndPos; ++i)
+    {
+        if ( IsLowerLetter(rCC.getCharacterType(rTxt, i)) )
+            // A lowercase letter disqualifies the whole text.
+            return false;
+
+        if ( IsUpperLetter(rCC.getCharacterType(rTxt, i)) )
+            // Another uppercase letter.  Convert it.
+            aConverted.Append( rCC.lower(rTxt.GetChar(i)) );
+        else
+            // This is not an alphabetic letter.  Leave it as-is.
+            aConverted.Append(rTxt.GetChar(i));
+    }
+
+    // Replace the word.
+    rDoc.Delete(nSttPos, nEndPos);
+    rDoc.Insert(nSttPos, aConverted);
+
+    return true;
+}
+
 //The method below is renamed from _GetQuote to GetQuote by BerryJia for Bug95846 Time:2002-8-13 15:50
 sal_Unicode SvxAutoCorrect::GetQuote( sal_Unicode cInsChar, BOOL bSttQuote,
 										LanguageType eLang ) const
@@ -1226,7 +1271,7 @@ String SvxAutoCorrect::GetQuote( SvxAuto
 
 ULONG SvxAutoCorrect::AutoCorrect( SvxAutoCorrDoc& rDoc, const String& rTxt,
 									xub_StrLen nInsPos, sal_Unicode cChar,
-									BOOL bInsert )
+									BOOL bInsert, Window* pFrameWin )
 {
 	ULONG nRet = 0;
 	do{		                            // only for middle check loop !!
@@ -1369,7 +1414,19 @@ ULONG SvxAutoCorrect::AutoCorrect( SvxAu
 			;
 		else
 		{
+            bool bLockKeyOn = pFrameWin && (pFrameWin->GetIndicatorState() & INDICATOR_CAPSLOCK);
+
 			nRet = 0;
+            if ( bLockKeyOn && IsAutoCorrFlag( CorrectCapsLock ) &&
+                 FnCorrectCapsLock( rDoc, rTxt, nCapLttrPos, nInsPos, eLang ) )
+            {
+                // Correct accidental use of cAPS LOCK key (do this only when 
+                // the caps or shift lock key is pressed).  Turn off the caps
+                // lock afterwords.
+                nRet |= CorrectCapsLock;
+                pFrameWin->SimulateKeyPress( KEY_CAPSLOCK );
+            }
+
 			// Grossbuchstabe am Satz-Anfang ??
 			if( IsAutoCorrFlag( CptlSttSntnc ) &&
 				FnCptlSttSntnc( rDoc, rTxt, TRUE, nCapLttrPos, nInsPos, eLang ) )
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/outliner/outlvw.cxx svx/source/outliner/outlvw.cxx
--- svx.clean/source/outliner/outlvw.cxx	2008-02-25 11:50:19.000000000 -0500
+++ svx/source/outliner/outlvw.cxx	2008-02-28 18:58:04.000000000 -0500
@@ -109,7 +109,7 @@ void OutlinerView::Paint( const Rectangl
 	pEditView->Paint( rRect );
 }
 
-BOOL OutlinerView::PostKeyEvent( const KeyEvent& rKEvt )
+BOOL OutlinerView::PostKeyEvent( const KeyEvent& rKEvt, Window* pFrameWin )
 {
 	DBG_CHKTHIS( OutlinerView, 0 );
 
@@ -274,7 +274,7 @@ BOOL OutlinerView::PostKeyEvent( const K
 		}
 	}
 
-	return bKeyProcessed ? TRUE : pEditView->PostKeyEvent( rKEvt );
+	return bKeyProcessed ? TRUE : pEditView->PostKeyEvent( rKEvt, pFrameWin );
 }
 
 
diff -urp --exclude=CVS --exclude=unxlngi6.pro --exclude=svx.vpj svx.clean/source/svdraw/svdedxv.cxx svx/source/svdraw/svdedxv.cxx
--- svx.clean/source/svdraw/svdedxv.cxx	2008-02-25 11:50:19.000000000 -0500
+++ svx/source/svdraw/svdedxv.cxx	2008-02-28 18:58:41.000000000 -0500
@@ -1203,7 +1203,7 @@ BOOL SdrObjEditView::KeyInput(const KeyE
 				ShowItemBrowser();
         }
 #endif
-		if (pTextEditOutlinerView->PostKeyEvent(rKEvt))
+		if (pTextEditOutlinerView->PostKeyEvent(rKEvt, pWin))
 		{
 			if( pMod && !pMod->IsChanged() )
 			{
