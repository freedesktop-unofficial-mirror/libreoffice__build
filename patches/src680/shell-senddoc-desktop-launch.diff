--- shell/source/unix/misc/senddoc.sh	2005-02-15 11:31:36.785446473 +0100
+++ shell/source/unix/misc/senddoc.sh	2005-02-15 14:33:17.202728652 +0100
@@ -93,7 +93,7 @@ if [ "$1" = "--mailclient" ]; then
 fi
 
 # autodetect mail client from executable name
-case `basename $MAILER | sed 's/-.*$//'` in
+case `basename "$MAILER" | sed 's/-.*$//'` in
 
 	mozilla | netscape | thunderbird)
 	
@@ -274,12 +274,56 @@ case `basename $MAILER | sed 's/-.*$//'`
 		 ${MAILER} ${TO:+--compose} ${TO:-} ${ATTACH:+--attach} ${ATTACH:-}
 		;;
 
-	*)
-		if [ "$MAILER" != "" ]; then
-			echo "Unsupported mail client: `basename $MAILER | sed 's/-.*^//'`"
+	"")
+	
+		# DESKTOP_LAUNCH, see http://freedesktop.org/pipermail/xdg/2004-August/004489.html
+		if [ -n "$DESKTOP_LAUNCH" ]; then
+			while [ "$1" != "" ]; do
+				case $1 in
+					--to)
+						if [ "${TO}" != "" ]; then
+							MAILTO="${MAILTO:-}${MAILTO:+&}to=$2"
+						else
+							TO="$2"
+						fi
+						shift
+						;;
+					--cc)
+						MAILTO="${MAILTO:-}${MAILTO:+&}cc=`echo $2| ${URI_ENCODE}`"
+						shift
+						;;
+					--bcc)
+						MAILTO="${MAILTO:-}${MAILTO:+&}bcc=`echo $2| ${URI_ENCODE}`"
+						shift
+						;;
+					--subject)
+						MAILTO="${MAILTO:-}${MAILTO:+&}subject=`echo $2 | ${URI_ENCODE}`"
+						shift
+						;;
+					--body)
+						MAILTO="${MAILTO:-}${MAILTO:+&}body=`echo $2 | ${URI_ENCODE}`"
+						shift
+						;;
+					--attach)
+						MAILTO="${MAILTO:-}${MAILTO:+&}attachment=`echo $2 | ${URI_ENCODE}`"
+						shift
+						;;
+					*)
+						;;
+				esac
+				shift;
+			done
+		
+			MAILTO="mailto:${TO}?${MAILTO}"
+			${DESKTOP_LAUNCH} "${MAILTO}" &
 		else
 			echo "Could not determine a mail client to use."
+			exit 2
 		fi
+		;;
+		
+	*)
+		echo "Unsupported mail client: `basename $MAILER | sed 's/-.*^//'`"
 		exit 2
 		;;
 esac  
