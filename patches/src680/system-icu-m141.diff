--- vcl/prj/build.lst.sysicu	2005-08-30 09:37:21.000000000 +0000
+++ vcl/prj/build.lst	2005-11-05 16:10:44.000000000 +0000
@@ -1,4 +1,4 @@
-vc	vcl	:	BOOST:boost NAS:nas FREETYPE:freetype psprint rsc sot ucbhelper unotools rvpapi icu i18npool unoil ridljar X11_EXTENSIONS:x11_extensions offuh basegfx SNDFILE:sndfile PORTAUDIO:portaudio transex3 NULL
+v	vcl	:	BOOST:boost NAS:nas FREETYPE:freetype psprint rsc sot ucbhelper unotools rvpapi ICU:icu i18npool unoil ridljar X11_EXTENSIONS:x11_extensions offuh basegfx SNDFILE:sndfile PORTAUDIO:portaudio transex3 NULL
 vc	vcl										usr1	-	all	vc_mkout NULL
 vc	vcl\source\unotypes						nmake	-	all	vc_unot NULL
 vc	vcl\source\glyphs						nmake	-	all	vc_glyphs vc_unot NULL
--- config_office/configure.in.sysicu	2005-11-05 16:04:34.000000000 +0000
+++ config_office/configure.in	2005-11-05 16:10:44.000000000 +0000
@@ -226,9 +226,9 @@
 AC_ARG_WITH(system-python,
 [  --with-system-python    Use python already on system
 ],,)
-#AC_ARG_WITH(system-icu,
-#[  --with-system-icu       Use icu already on system
-#],,)
+AC_ARG_WITH(system-icu,
+[  --with-system-icu       Use icu already on system
+],,)
 AC_ARG_WITH(system-db,
 [  --with-system-db        Use berkeley db already on system
 ],,)
@@ -2976,32 +2976,32 @@
 fi
 AC_SUBST(SYSTEM_SANE_HEADER)
 
-# DISABLED; INCOMPLETE
 dnl ===================================================================
 dnl Check for system icu
 dnl ===================================================================
-#AC_MSG_CHECKING([which icu to use])
-#if test -n "$with_system_icu" -o -n "$with_system_libs" && \
-#	test "$with_system_icu" != "no"; then
-#   AC_MSG_RESULT([external])
-#   SYSTEM_ICU=YES
-#   AC_MSG_CHECKING([for unicode/rbbi.h])
-#   AC_TRY_CPP(unicode/rbbi.h, AC_MSG_RESULT([checked.]), AC_MSG_ERROR([icu headers not found.]))
-#   AC_PATH_PROG(SYSTEM_GENBRK, genbrk)
-#   if test -z "$SYSTEM_GENBRK"; then
-#      AC_MSG_ERROR([\"genbrk\" not found in \$PATH, install the icu development tool \"genbrk"\])
-#   fi
-#   AC_PATH_PROG(SYSTEM_GENCCODE, genccode)
-#   if test -z "$SYSTEM_GENCCODE"; then
-#      AC_MSG_ERROR([\"genccode\" not found in \$PATH, install the icu development tool \"genccode"\])
-#   fi
-#else
-#    AC_MSG_RESULT([internal])
-#    SYSTEM_ICU=NO
-#fi
-#AC_SUBST(SYSTEM_ICU)
-#AC_SUBST(SYSTEM_GENBRK)
-#AC_SUBST(SYSTEM_GENCCODE)
+AC_MSG_CHECKING([which icu to use])
+if test -n "$with_system_icu" -o -n "$with_system_libs" && \
+	test "$with_system_icu" != "no"; then
+   AC_MSG_RESULT([external])
+   SYSTEM_ICU=YES
+   AC_MSG_CHECKING([for unicode/rbbi.h])
+   AC_TRY_CPP(unicode/rbbi.h, AC_MSG_RESULT([checked.]), AC_MSG_ERROR([icu headers not found.]))
+   AC_PATH_PROG(SYSTEM_GENBRK, genbrk)
+   if test -z "$SYSTEM_GENBRK"; then
+      AC_MSG_ERROR([\"genbrk\" not found in \$PATH, install the icu development tool \"genbrk"\])
+   fi
+   AC_PATH_PROG(SYSTEM_GENCCODE, genccode)
+   if test -z "$SYSTEM_GENCCODE"; then
+      AC_MSG_ERROR([\"genccode\" not found in \$PATH, install the icu development tool \"genccode"\])
+   fi
+else
+    AC_MSG_RESULT([internal])
+    SYSTEM_ICU=NO
+    BUILD_TYPE="$BUILD_TYPE ICU"
+fi
+AC_SUBST(SYSTEM_ICU)
+AC_SUBST(SYSTEM_GENBRK)
+AC_SUBST(SYSTEM_GENCCODE)
 
 dnl ===================================================================
 dnl Checks for libraries.
--- config_office/set_soenv.in.sysicu	2005-11-05 16:04:33.000000000 +0000
+++ config_office/set_soenv.in	2005-11-05 16:10:44.000000000 +0000
@@ -1746,9 +1746,9 @@
 ToFile( "SYSTEM_PYTHON",     "@SYSTEM_PYTHON@",    "e" );
 ToFile( "PYTHON_CFLAGS",     "@PYTHON_CFLAGS@",    "e" );
 ToFile( "PYTHON_LIBS",       "@PYTHON_LIBS@",      "e" );
-#ToFile( "SYSTEM_ICU",        "@SYSTEM_ICU@",       "e" );
-#ToFile( "SYSTEM_GENBRK",     "@SYSTEM_GENBRK@",    "e" );
-#ToFile( "SYSTEM_GENCCODE",   "@SYSTEM_GENCCODE@",  "e" );
+ToFile( "SYSTEM_ICU",        "@SYSTEM_ICU@",       "e" );
+ToFile( "SYSTEM_GENBRK",     "@SYSTEM_GENBRK@",    "e" );
+ToFile( "SYSTEM_GENCCODE",   "@SYSTEM_GENCCODE@",  "e" );
 ToFile( "SYSTEM_JPEG",       "@SYSTEM_JPEG@",      "e" );
 ToFile( "SYSTEM_FREETYPE",   "@SYSTEM_FREETYPE@",  "e" );
 ToFile( "FREETYPE_CFLAGS",   "@FREETYPE_CFLAGS@",  "e" );
--- linguistic/source/hhconvdic.cxx.sysicu	2005-09-07 19:51:22.000000000 +0000
+++ linguistic/source/hhconvdic.cxx	2005-11-05 16:10:44.000000000 +0000
@@ -34,7 +34,7 @@
  ************************************************************************/
 
 #ifndef USCRIPT_H
-#include <external/unicode/uscript.h>
+#include <unicode/uscript.h>
 #endif
 
 #ifndef _LANG_HXX //autogen wg. LANGUAGE_ENGLISH_US
--- i18npool/prj/build.lst.sysicu	2005-11-04 14:45:20.000000000 +0000
+++ i18npool/prj/build.lst	2005-11-05 16:13:25.000000000 +0000
@@ -1,4 +1,4 @@
-inp  i18npool    :   bridges sax stoc comphelper icu i18nutil regexp NULL
+inp  i18npool    :   bridges sax stoc comphelper ICU:icu i18nutil regexp NULL
 inp  i18npool                                   usr1    -   all inp_mkout NULL
 inp  i18npool\source\unotypes                   nmake   -   all inp_utypes NULL
 inp  i18npool\source\registerservices           nmake   -   all inp_rserv inp_utypes NULL
--- i18npool/source/breakiterator/breakiterator_unicode.cxx.sysicu	2005-10-17 15:42:30.000000000 +0000
+++ i18npool/source/breakiterator/breakiterator_unicode.cxx	2005-11-05 16:10:44.000000000 +0000
@@ -42,7 +42,9 @@
 extern const char OpenOffice_icu_dat[];
 U_CDECL_END
 
-using namespace ::com::sun::star::uno;
+using ::com::sun::star::uno::RuntimeException;
+using ::com::sun::star::uno::Reference;
+using ::com::sun::star::uno::Sequence;
 using namespace ::com::sun::star::lang;
 using namespace ::rtl;
 
@@ -90,7 +92,7 @@
             if ( !U_SUCCESS(status) ) throw ERROR;
 
             status = U_ZERO_ERROR;
-            aBreakIterator = new RuleBasedBreakIterator(udata_open("OpenOffice", "brk", 
+            aBreakIterator = new RuleBasedBreakIterator(udata_open("OpenOffice_icu/OpenOffice", "brk", 
                     OUStringToOString(OUString::createFromAscii(rule)+OUString::createFromAscii("_")+rLocale.Language,
                     RTL_TEXTENCODING_ASCII_US).getStr(), &status), status);
             if (!U_SUCCESS(status) ) {
--- i18npool/source/breakiterator/makefile.mk.sysicu	2005-11-04 14:45:24.000000000 +0000
+++ i18npool/source/breakiterator/makefile.mk	2005-11-05 16:10:44.000000000 +0000
@@ -53,6 +53,8 @@
 # insert "OpenOffice" as icu package name in front of the  name of each rule file for searching on application provided data
 MY_BRK_BRKFILES:=$(subst,data/,$(MISC)$/OpenOffice_ $(MY_BRK_TXTFILES:s/.txt/.brk/))
 
+MY_BRK_NAMEDBRKFILES:=$(subst,data/,OpenOffice_ $(MY_BRK_TXTFILES:s/.txt/.brk/))
+
 # OpenOffice_icu_dat.c is a generated file from the rule file list by gencmn
 MY_MISC_CXXFILES := \
         $(MISC)$/OpenOffice_icu_dat.c \
@@ -80,8 +82,8 @@
 
 # 'gencmn', 'genbrk' and 'genccode' are tools generated and delivered by icu project to process icu breakiterator rules.
 $(MISC)$/OpenOffice_icu_dat.c :  $(MY_BRK_BRKFILES)
-    +$(WRAPCMD) $(SOLARBINDIR)$/gencmn -e OpenOffice_icu -n OpenOffice_icu -S -d $(MISC) O $(mktmp $(MY_BRK_BRKFILES:t"\n"))
+    +$(WRAPCMD) gencmn -e OpenOffice_icu -n OpenOffice_icu -S -d $(MISC) O $(mktmp $(MY_BRK_NAMEDBRKFILES:t"\n"))
 $(MISC)$/OpenOffice_%.brk : data/%.txt
-    +$(WRAPCMD) $(SOLARBINDIR)$/genbrk -r $< -o $(MISC)$/OpenOffice_$*.brk
+    +$(WRAPCMD) genbrk -r $< -o $(MISC)$/OpenOffice_$*.brk
 $(MISC)$/%_brk.c : $(MISC)$/%.brk
-    +$(WRAPCMD) $(SOLARBINDIR)$/genccode -d $(MISC)$ $(MISC)$/$*.brk
+    +$(WRAPCMD) genccode -e OpenOffice_icu -n OpenOffice_icu -d $(MISC)$ $(MISC)$/$*.brk
--- i18npool/source/collator/makefile.mk.sysicu	2005-11-05 16:01:52.000000000 +0000
+++ i18npool/source/collator/makefile.mk	2005-11-05 16:10:44.000000000 +0000
@@ -88,6 +88,10 @@
 		$(ICUINLIB) \
 		$(ICUUCLIB)
 
+.IF "$(SYSTEM_ICU)" == "YES"
+CFLAGS += -DSYSTEM_ICU
+.ENDIF
+
 # --- Targets ------------------------------------------------------
 
 .INCLUDE :	target.mk
--- i18npool/source/collator/collator_unicode.cxx.sysicu	2005-10-17 15:43:36.000000000 +0000
+++ i18npool/source/collator/collator_unicode.cxx	2005-11-05 16:10:44.000000000 +0000
@@ -77,7 +77,11 @@
         // load ICU collator
         UErrorCode status = U_ZERO_ERROR;
         if (rulesImage) {
+#ifdef SYSTEM_ICU
+            collator = new RuleBasedCollator(rulesImage, -1, NULL, status);
+#else
             collator = new RuleBasedCollator(rulesImage, status);
+#endif
         } else {
            // load ICU collator
             /** ICU collators are loaded using a locale only.
--- scp2/prj/build.lst.sysicu	2005-08-05 17:26:02.000000000 +0000
+++ scp2/prj/build.lst	2005-11-05 16:10:44.000000000 +0000
@@ -1,4 +1,4 @@
-cp    scp2    :    setup_native transex3 PYTHON:python icu NULL
+cp    scp2    :    setup_native transex3 PYTHON:python ICU:icu NULL
 cp    scp2                        usr1     -    all    cp_mkout NULL
 cp    scp2\macros                 nmake    -    all    cp_langmacros NULL
 cp    scp2\source\activex         nmake    -    all    cp_activex cp_langmacros NULL
--- scp2/source/ooo/file_library_ooo.scp.sysicu	2005-11-04 15:41:25.000000000 +0000
+++ scp2/source/ooo/file_library_ooo.scp	2005-11-05 16:10:44.000000000 +0000
@@ -795,6 +795,8 @@
     Styles = (PACKED,PATCH);
 End
 
+#ifndef SYSTEM_ICU
+
 File gid_File_Lib_Icudata
     TXT_FILE_BODY;
   #ifdef UNX
@@ -839,6 +841,8 @@
     Styles = (PACKED);
 End
 
+#endif
+
 File gid_File_Lib_Iiopbrdg
     TXT_FILE_BODY;
     Styles = (PACKED,UNO_COMPONENT);
--- scp2/source/ooo/makefile.mk.sysicu	2005-09-28 15:47:30.000000000 +0000
+++ scp2/source/ooo/makefile.mk	2005-11-05 16:10:44.000000000 +0000
@@ -45,7 +45,6 @@
 # --- Settings -----------------------------------------------------
 
 .INCLUDE :  settings.mk
-.INCLUDE :  icuversion.mk
 
 .IF "$(ENABLE_CRASHDUMP)"!=""
 SCPDEFS+=-DENABLE_CRASHDUMP
@@ -139,10 +138,15 @@
 SCPDEFS+=-DSYSTEM_XALAN
 .ENDIF
 
+.IF "$(SYSTEM_ICU)" == "YES"
+SCPDEFS+=-DSYSTEM_ICU
+.ELSE
+.INCLUDE :  icuversion.mk
 SCPDEFS+=\
     -DICU_MAJOR=$(ICU_MAJOR) \
     -DICU_MINOR=$(ICU_MINOR) \
     -DICU_MICRO=$(ICU_MICRO)
+.ENDIF
 
 SCP_PRODUCT_TYPE=osl
 
--- scp2/source/ooo/shortcut_ooo.scp.sysicu	2005-09-09 01:42:03.000000000 +0000
+++ scp2/source/ooo/shortcut_ooo.scp	2005-11-05 16:10:44.000000000 +0000
@@ -167,6 +167,7 @@
 #endif
 
 #ifdef UNX
+#ifndef SYSTEM_ICU
 
 Shortcut gid_Shortcut_Lib_Icudata_0
     FileID = gid_File_Lib_Icudata;
@@ -175,10 +176,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icudata_1
     FileID = gid_File_Lib_Icudata;
     Dir = gid_Dir_Program;
@@ -186,10 +183,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icui18n_0
     FileID = gid_File_Lib_Icui18n;
     Dir = gid_Dir_Program;
@@ -197,10 +190,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icui18n_1
     FileID = gid_File_Lib_Icui18n;
     Dir = gid_Dir_Program;
@@ -208,10 +197,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icule_0
     FileID = gid_File_Lib_Icule;
     Dir = gid_Dir_Program;
@@ -219,10 +204,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icule_1
     FileID = gid_File_Lib_Icule;
     Dir = gid_Dir_Program;
@@ -230,10 +211,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icuuc_0
     FileID = gid_File_Lib_Icuuc;
     Dir = gid_Dir_Program;
@@ -241,10 +218,6 @@
     Styles = (NETWORK,RELATIVE);
 End
 
-#endif
-
-#ifdef UNX
-
 Shortcut gid_Shortcut_Lib_Icuuc_1
     FileID = gid_File_Lib_Icuuc;
     Dir = gid_Dir_Program;
@@ -253,6 +226,7 @@
 End
 
 #endif
+#endif
 
 #ifdef UNX
 
