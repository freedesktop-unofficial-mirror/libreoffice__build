Index: sal/osl/unx/thread.c
===================================================================
RCS file: /cvs/porting/sal/osl/unx/thread.c,v
retrieving revision 1.28
diff -u -p -u -r1.28 thread.c
--- sal/osl/unx/thread.c	6 Jul 2006 14:42:32 -0000	1.28
+++ sal/osl/unx/thread.c	23 Aug 2006 13:54:16 -0000
@@ -136,7 +136,7 @@ static void* osl_thread_start_Impl (void
 static void  osl_thread_cleanup_Impl (void * pData);
 
 static oslThread osl_thread_create_Impl (
-	oslWorkerFunction pWorker, void * pThreadData, short nFlags);
+	oslWorkerFunction pWorker, void * pThreadData, short nFlags, sal_Int32 nFrames );
 
 static void osl_thread_join_cleanup_Impl (void * opaque);
 static void osl_thread_wait_cleanup_Impl (void * opaque);
@@ -290,7 +290,8 @@ static void* osl_thread_start_Impl (void
 static oslThread osl_thread_create_Impl (
 	oslWorkerFunction pWorker,
 	void*             pThreadData,
-	short             nFlags)
+	short             nFlags,
+	sal_Int32         nFrames)
 {
 	Thread_Impl* pImpl;
     int nRet=0;
@@ -305,10 +306,24 @@ static oslThread osl_thread_create_Impl 
 
     pthread_mutex_lock (&(pImpl->m_Lock));
 
+	pthread_attr_t attr;
+	pthread_attr_init (&attr);
+
+#if defined (LINUX) || defined (SOLARIS)
+	if (nFrames > 0)
+	{
+	  size_t stack_size = sysconf (_SC_THREAD_STACK_MIN);
+	  if (nFrames * 128 > stack_size)
+		  stack_size = nFrames * 128;
+//	  if (!getenv ("DISABLE_SIZE"))
+		  pthread_attr_setstacksize (&attr, stack_size);
+//	  fprintf (stderr, "Set stack size %d\n", stack_size);
+	}
+#endif
+
 	if ((nRet = pthread_create (
 		&(pImpl->m_hThread),
-		PTHREAD_ATTR_DEFAULT,
-		osl_thread_start_Impl,
+		&attr, osl_thread_start_Impl,
 		(void*)(pImpl))) != 0)
 	{
 	    OSL_TRACE("osl_thread_create_Impl(): errno: %d, %s\n",
@@ -344,7 +359,21 @@ oslThread osl_createThread (
     return osl_thread_create_Impl (
 		pWorker,
 		pThreadData,
-		THREADIMPL_FLAGS_ATTACHED);
+		THREADIMPL_FLAGS_ATTACHED,
+		-1);
+}
+
+oslThread
+osl_createThreadWithStack(
+		oslWorkerFunction pWorker,
+		void *            pThreadData,
+		sal_uInt32        nFrames)
+{
+    return osl_thread_create_Impl (
+		pWorker,
+		pThreadData,
+		THREADIMPL_FLAGS_ATTACHED,
+		nFrames);
 }
 
 /*****************************************************************************/
@@ -358,7 +387,8 @@ oslThread osl_createSuspendedThread (
 		pWorker,
 		pThreadData,
 		THREADIMPL_FLAGS_ATTACHED |
-		THREADIMPL_FLAGS_SUSPENDED );
+		THREADIMPL_FLAGS_SUSPENDED,
+		-1);
 }
 
 /*****************************************************************************/
Index: sal/inc/osl/thread.h
===================================================================
RCS file: /cvs/porting/sal/inc/osl/thread.h,v
retrieving revision 1.10
diff -u -p -u -r1.10 thread.h
--- sal/inc/osl/thread.h	8 Sep 2005 14:33:56 -0000	1.10
+++ sal/inc/osl/thread.h	23 Aug 2006 13:54:16 -0000
@@ -87,6 +87,7 @@ typedef sal_uInt32 oslThreadKey;
 	@return 0 if creation failed, otherwise a handle to the thread
 */
 oslThread SAL_CALL osl_createThread(oslWorkerFunction pWorker, void* pThreadData);
+oslThread SAL_CALL osl_createThreadWithStack(oslWorkerFunction pWorker, void* pThreadData, sal_uInt32 nFrames);
 
 /** Create the thread, using the function-ptr pWorker as
 	its main (worker) function. This functions receives in
Index: desktop/source/app/officeipcthread.cxx
===================================================================
RCS file: /cvs/framework/desktop/source/app/officeipcthread.cxx,v
retrieving revision 1.51
diff -u -p -u -r1.51 officeipcthread.cxx
--- desktop/source/app/officeipcthread.cxx	8 May 2006 15:36:08 -0000	1.51
+++ desktop/source/app/officeipcthread.cxx	23 Aug 2006 13:54:16 -0000
@@ -404,7 +404,7 @@ OfficeIPCThread::Status OfficeIPCThread:
 	{
 		// Seems we are the one and only, so start listening thread
 		pGlobalOfficeIPCThread = pThread;
-		pThread->create(); // starts thread
+		pThread->createWithStack( 1024 ); // starts thread
 	}
 	else
 	{
Index: vcl/unx/source/app/sm.cxx
===================================================================
RCS file: /cvs/gsl/vcl/unx/source/app/sm.cxx,v
retrieving revision 1.26.90.1
diff -u -p -u -r1.26.90.1 sm.cxx
--- vcl/unx/source/app/sm.cxx	10 Aug 2006 14:57:49 -0000	1.26.90.1
+++ vcl/unx/source/app/sm.cxx	23 Aug 2006 13:54:17 -0000
@@ -710,8 +723,7 @@ void ICEConnectionObserver::ICEWatchProc
                     flags |= O_NONBLOCK;
                     fcntl (nWakeupFiles[1], F_SETFL, flags);
                 }
-                ICEThread = osl_createSuspendedThread( ICEConnectionWorker, NULL );
-                osl_resumeThread( ICEThread );
+                ICEThread = osl_createThreadWithStack( ICEConnectionWorker, NULL, 1024 );
             }
         }
     }
Index: vos/inc/vos/thread.hxx
===================================================================
RCS file: /cvs/udk/vos/inc/vos/thread.hxx,v
retrieving revision 1.7
diff -u -p -u -r1.7 thread.hxx
--- vos/inc/vos/thread.hxx	20 Jun 2006 11:18:52 -0000	1.7
+++ vos/inc/vos/thread.hxx	23 Aug 2006 13:54:17 -0000
@@ -119,6 +119,12 @@ public:
 	*/
 	sal_Bool SAL_CALL create();
 
+	/** Create running instance of a thread,
+		with a given stack size, or -1 for system default.
+		@returns True if thread could be created.
+	*/
+	sal_Bool SAL_CALL createWithStack(sal_Int32 nFrames);
+
 	/** Create suspended instance of a thread.
 		@returns True if thread could be created.
 	*/
Index: vos/source/thread.cxx
===================================================================
RCS file: /cvs/udk/vos/source/thread.cxx,v
retrieving revision 1.8
diff -u -p -u -r1.8 thread.cxx
--- vos/source/thread.cxx	20 Jun 2006 11:23:08 -0000	1.8
+++ vos/source/thread.cxx	23 Aug 2006 13:54:17 -0000
@@ -84,18 +84,21 @@ OThread::~OThread() 
     osl_destroyCondition( m_aCondition );
 }
 
-sal_Bool OThread::create() 
+sal_Bool OThread::createWithStack(sal_Int32 nFrames)
 {
 	VOS_ASSERT(m_hThread == 0);	// only one running thread per instance
 
-    m_hThread = osl_createSuspendedThread(
-        threadWorkerFunction_impl, (void*)this);
-	if (m_hThread)
-		osl_resumeThread(m_hThread);							             
+    m_hThread = osl_createThreadWithStack(
+        threadWorkerFunction_impl, (void*)this, nFrames);
 
 	return m_hThread != 0;
 }
 
+sal_Bool OThread::create() 
+{
+	return createWithStack(-1);
+}
+
 sal_Bool OThread::createSuspended() 
 {
 	VOS_ASSERT(m_hThread == 0);	// only one running thread per instance
Index: dtrans/source/X11/X11_selection.cxx
===================================================================
RCS file: /cvs/gsl/dtrans/source/X11/X11_selection.cxx,v
retrieving revision 1.79.6.1
diff -u -p -u -r1.79.6.1 X11_selection.cxx
--- dtrans/source/X11/X11_selection.cxx	10 Aug 2006 14:48:39 -0000	1.79.6.1
+++ dtrans/source/X11/X11_selection.cxx	23 Aug 2006 13:54:18 -0000
@@ -464,9 +464,7 @@ void SelectionManager::initialize( const
 				m_xDropTransferable = new X11Transferable( *this, static_cast< OWeakObject* >(this), m_nXdndSelection );
 				registerHandler( m_nXdndSelection, *this );
 
-				m_aThread = osl_createSuspendedThread( call_SelectionManager_run, this );
-    			if( m_aThread )
-        			osl_resumeThread( m_aThread );
+				m_aThread = osl_createThreadWithStack( call_SelectionManager_run, this, 1024 );
 #if OSL_DEBUG_LEVEL > 1
 				else
 					fprintf( stderr, "SelectionManager::initialize: creation of dispatch thread failed !\n" );
Index: sal/rtl/source/alloc_cache.c
===================================================================
RCS file: /cvs/porting/sal/rtl/source/alloc_cache.c,v
retrieving revision 1.3
diff -u -p -u -r1.3 alloc_cache.c
--- sal/rtl/source/alloc_cache.c	20 Jun 2006 04:28:39 -0000	1.3
+++ sal/rtl/source/alloc_cache.c	23 Aug 2006 13:55:58 -0000
@@ -1376,11 +1376,26 @@ rtl_cache_wsupdate_all (void * arg);
 static void
 rtl_cache_wsupdate_init (void)
 {
+	pthread_attr_t attr;
+
 	RTL_MEMORY_LOCK_ACQUIRE(&(g_cache_list.m_lock));
 	g_cache_list.m_update_done = 0;
 	(void) pthread_cond_init (&(g_cache_list.m_update_cond), NULL);
+
+	pthread_attr_init (&attr);
+#if defined (LINUX) || defined (SOLARIS)
+	{
+		const size_t nBytes = 64 * 1024;
+		size_t stack_size = sysconf (_SC_THREAD_STACK_MIN);
+		if (nBytes > stack_size)
+			stack_size = nBytes;
+//		if (!getenv ("DISABLE_SIZE"))
+			pthread_attr_setstacksize (&attr, stack_size);
+//		fprintf (stderr, "Sal set size to %d\n", stack_size);
+	}
+#endif
 	if (pthread_create (
-			&(g_cache_list.m_update_thread), NULL, rtl_cache_wsupdate_all, (void*)(10)) != 0)
+			&(g_cache_list.m_update_thread), &attr, rtl_cache_wsupdate_all, (void*)(10)) != 0)
 	{
 		/* failure */
 		g_cache_list.m_update_thread = (pthread_t)(0);


Index: sal/util/sal.map
===================================================================
RCS file: /cvs/porting/sal/util/sal.map,v
retrieving revision 1.57
diff -u -p -u -r1.57 sal.map
--- sal/util/sal.map	26 Jul 2006 07:46:09 -0000	1.57
+++ sal/util/sal.map	23 Aug 2006 15:29:42 -0000
@@ -34,6 +34,7 @@ UDK_3_0_0 {
         osl_createSuspendedThread;
         osl_createThread;
         osl_createThreadKey;
+        osl_createThreadWithStack;
         osl_decrementInterlockedCount;
         osl_demultiplexSocketEvents;
         osl_destroyCondition;
