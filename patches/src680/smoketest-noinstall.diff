cvs diff: Diffing .
Index: smoketestoo_native/smoketest.pl
===================================================================
RCS file: /cvs/installation/smoketestoo_native/smoketest.pl,v
retrieving revision 1.16
diff -u -r1.16 smoketest.pl
--- smoketestoo_native/smoketest.pl	28 Sep 2005 14:43:42 -0000	1.16
+++ smoketestoo_native/smoketest.pl	27 Feb 2006 23:57:55 -0000
@@ -55,11 +55,12 @@
 $is_command_infos = 0;
 $is_protocol_test = 0;
 $is_remove_on_error = 0;
-$is_remove_at_end = 1;
+$is_remove_at_end = 0;
 $is_do_statistics = 0;
 $is_do_deinstall = 0;
 $is_admin_installation = 1;
 $is_oo = 1;
+$is_package_smoketest = 1;
 
 $gui = $ENV{GUI};
 $temp_path = $ENV{TEMP};
@@ -187,7 +188,7 @@
 			'Error in setup log',
 			'installationsset is not complete',
 			'can not copy all basic scripts',
-			'can not patch bottstrapini',
+			'can not patch bootstrapini',
 			'msiexec failed. Maybe you have got an installed version',
 			'deinstallation is incomplete'
 );
@@ -218,13 +219,15 @@
 	$PRODUCT="StarOffice";
 }
 
-$StandDir = $ENV{SOLARSRC} . $PathSeparator;
-$SHIP = defined $ENV{SHIPDRIVE} ? $ENV{SHIPDRIVE} . $PathSeparator : "shipdrive_not_set";
-$PORDUCT = "$SHIP$ENV{INPATH}$PathSeparator$PRODUCT$PathSeparator$packpackage$PathSeparator";
-$DATA="$ENV{DMAKE_WORK_DIR}$PathSeparator" . "data$PathSeparator";
-$WORK_STAMP_LC=$ENV{WORK_STAMP};
-$WORK_STAMP_LC =~ tr/A-Z/a-z/;
-$ENV{DBGSV_INIT} = $DATA . "dbgsv.ini";
+if (!is_package_smoketest) {
+	$StandDir = $ENV{SOLARSRC} . $PathSeparator;
+	$SHIP = defined $ENV{SHIPDRIVE} ? $ENV{SHIPDRIVE} . $PathSeparator : "shipdrive_not_set";
+	$PORDUCT = "$SHIP$ENV{INPATH}$PathSeparator$PRODUCT$PathSeparator$packpackage$PathSeparator";
+	$DATA="$ENV{DMAKE_WORK_DIR}$PathSeparator" . "data$PathSeparator";
+	$WORK_STAMP_LC=$ENV{WORK_STAMP};
+	$WORK_STAMP_LC =~ tr/A-Z/a-z/;
+	$ENV{DBGSV_INIT} = $DATA . "dbgsv.ini";
+}
 
 if (defined($ENV{INSTALLPATH_SMOKETEST})) {
 	$installpath_without = $ENV{INSTALLPATH_SMOKETEST};
@@ -281,11 +284,18 @@
 	save_sversion ($SVERSION_INI);
 }
 
-($INSTSETNAME, $INSTALLSET) = getInstset();
+if (!is_package_smoketest) {
+	($INSTSETNAME, $INSTALLSET) = getInstset();
+
+	print "Install: $INSTALLSET$INSTSETNAME\n";
+}
 
-print "Install: $INSTALLSET$INSTSETNAME\n";
 prepare();
-doTest();
+if (is_package_smoketest) {
+	doSmokeTest("$ENV{OOINSTBASE}/", "$ENV{OOUSERDIR}/");
+} else {
+	doTest();
+}
 
 if (!$is_debug) {
 	restore_sversion ($SVERSION_INI);
@@ -417,13 +427,11 @@
 
 	$basedir = doInstall ("$INSTALLSET$INSTSETNAME$PathSeparator", $installpath);
 	print "$basedir\n";
-	$programpath = "$basedir". "program$PathSeparator";
 	$userinstallpath_without = $installpath . $userinstalldir;
 	$userinstallpath = $userinstallpath_without . $PathSeparator;
 	$userpath = "$userinstallpath" . "user$PathSeparator";
 	$basicpath = $userpath . "basic$PathSeparator";
 	$standardbasicpath = "$basedir" . "presets$PathSeparator" . "basic$PathSeparator"; 
-	$LOGPATH="$userinstallpath" . "user" . $PathSeparator . "temp";
 
 	if ($gui eq "UNX") {
 		$Command = "chmod -R 777 \"$installpath\"*";
@@ -455,6 +463,22 @@
 		print_error ($error_messages[$error_patchBootstrap], $error_patchBootstrap);
 	}
 
+	doSmokeTest ($basedir, $userinstallpath);
+
+	# deinstall office (error 6)
+
+	if ($is_remove_at_end) {
+		print "Deinstalling Office\n";
+	}
+#	$Command = "$PERL deinstall.pl \"$LOGPATH\" \"$installpath\"";
+#	execute_Command ($Command, $error_deinstall, $show_NoMessage, $command_normal);
+}
+
+sub doSmokeTest {
+	my ($basedir, $userinstallpath) = @_;
+	$programpath = "$basedir". "program$PathSeparator";
+	$LOGPATH="$userinstallpath" . "user" . $PathSeparator . "temp";
+
 	# start office (error 4)
 
 	print "Starting Testtool ($INSTSETNAME)\n";
@@ -476,14 +500,6 @@
 
 	$Command = "$PERL testlog.pl \"$LOGPATH\"";
 	execute_Command ($Command, $error_testResult, $show_Message, $command_normal);
-
-	# deinstall office (error 6)
-
-	if ($is_remove_at_end) {
-		print "Deinstalling Office\n";
-	}
-#	$Command = "$PERL deinstall.pl \"$LOGPATH\" \"$installpath\"";
-#	execute_Command ($Command, $error_deinstall, $show_NoMessage, $command_normal);
 }
 
 sub doInstall {
cvs diff: Diffing data
cvs diff: Diffing data/scripts
cvs diff: Diffing data/solaris
cvs diff: Diffing data/solaris/sparc
cvs diff: Diffing data/solaris/x86
cvs diff: Diffing prj
cvs diff: Diffing statjars
