--- svx/source/gallery2/gallery1.cxx.old	2004-12-13 13:18:25.000000000 +0100
+++ svx/source/gallery2/gallery1.cxx	2005-04-12 14:52:32.000000000 +0200
@@ -715,14 +715,15 @@
 
 // ------------------------------------------------------------------------
 
-BOOL Gallery::CreateTheme( const String& rThemeName )
+BOOL Gallery::CreateTheme( const String& rThemeName, UINT32 nNumFrom )
 {
 	BOOL bRet = FALSE;
 
 	if( !HasTheme( rThemeName ) && ( GetUserURL().GetProtocol() != INET_PROT_NOT_VALID ) )
 	{
+		nLastFileNumber=nNumFrom > nLastFileNumber ? nNumFrom : ++nLastFileNumber;
 		GalleryThemeEntry* pNewEntry = new GalleryThemeEntry( GetUserURL(), rThemeName,
-															  ++nLastFileNumber,
+															  nLastFileNumber,
 															  FALSE, FALSE, TRUE, 0, FALSE );
 
 		aThemeList.Insert( pNewEntry, LIST_APPEND );
--- svx/inc/gallery1.hxx.old	2004-08-31 16:51:50.000000000 +0200
+++ svx/inc/gallery1.hxx	2005-04-12 14:53:12.000000000 +0200
@@ -195,7 +195,7 @@
 	BOOL						HasTheme( const String& rThemeName );
 	String						GetThemeName( ULONG nThemeId ) const;
 
-	BOOL						CreateTheme( const String& rThemeName );
+	BOOL						CreateTheme( const String& rThemeName, UINT32 nNumFrom = 0 );
 	BOOL						CreateImportTheme( const INetURLObject& rURL, const String& rFileName );
 	BOOL						RenameTheme( const String& rOldName, const String& rNewName );
 	BOOL						RemoveTheme( const String& rThemeName );
--- svx/source/gengal/gengal.cxx.old	2005-04-12 15:46:09.000000000 +0200
+++ svx/source/gengal/gengal.cxx	2005-04-12 15:43:21.000000000 +0200
@@ -73,6 +73,7 @@
 static void createTheme( rtl::OUString aThemeName,
 						 rtl::OUString aGalleryURL,
 						 rtl::OUString aDestDir,
+						 UINT32 nNumFrom,
 						 FileNameList &rFiles )
 {
 	Gallery* pGallery;
@@ -92,7 +93,7 @@
 
 	GalleryTheme *pGalTheme;
 	if( !pGallery->HasTheme( aThemeName) ) {
-			if( !pGallery->CreateTheme( aThemeName ) ) {
+			if( !pGallery->CreateTheme( aThemeName, nNumFrom ) ) {
 					fprintf( stderr, "Failed to create theme\n" );
 					exit( 1 );
 			}
@@ -169,8 +170,8 @@
 {
 	fprintf( stdout, "Utility to generate OO.o gallery files\n\n" );
 	
-	fprintf( stdout, "using: gengal.bin --name <name> --path <dir> [--destdir <path>]\n");
-	fprintf( stdout, "                  [ files ... ]\n\n" );
+	fprintf( stdout, "using: gengal --name <name> --path <dir> [ --destdir <path> ]\n");
+	fprintf( stdout, "              [ --number-from <num> ] [ files ... ]\n\n" );
 	
 	fprintf( stdout, "options:\n");
 	fprintf( stdout, " --name <theme>\t\tdefines a name of the created or updated theme.\n");
@@ -179,6 +180,8 @@
 	fprintf( stdout, " --destdir <dir>\tdefines a path prefix to be removed from the paths\n");
 	fprintf( stdout, "\t\t\tstored in the gallery files. It is useful to create\n");
 	fprintf( stdout, "\t\t\tRPM packages using the BuildRoot feature.\n");
+	fprintf( stdout, " --number-from <num>\tdefines minimal number for the newly created gallery\n");
+	fprintf( stdout, "\t\t\ttheme files.\n");
 	fprintf( stdout, " files\t\t\tlists files to be added to the gallery. Absolute paths\n");
 	fprintf( stdout, "\t\t\tare required.\n");
 }
@@ -249,6 +252,7 @@
 	bool bHelp = false;
 	rtl::OUString aPath, aDestDir;
 	rtl::OUString aName = rtl::OUString::createFromAscii( "Default name" );
+	UINT32 nNumFrom = 0;
 	FileNameList aFiles;
 
 	for( USHORT i = 0; i < GetCommandLineParamCount(); i++ )
@@ -268,6 +272,9 @@
 		else if ( aParam.equalsAscii( "--destdir" ) )
 			aDestDir = GetCommandLineParam( ++i );
 
+		else if ( aParam.equalsAscii( "--number-from" ) )
+			 nNumFrom = GetCommandLineParam( ++i ).ToInt32();
+
 		else
 			aFiles.push_back( Smartify( aParam ) );
 	}
@@ -278,7 +285,7 @@
 		return;
 	}
 
-	createTheme( aName, aPath, aDestDir, aFiles );
+	createTheme( aName, aPath, aDestDir, nNumFrom, aFiles );
 }
 
 GalApp aGalApp;
--- svx/source/gengal/gengal.sh.old	2005-04-12 14:24:31.000000000 +0200
+++ svx/source/gengal/gengal.sh	2005-04-12 15:06:27.000000000 +0200
@@ -1,160 +1,157 @@
 #!/bin/sh
+#*************************************************************************
+#
+#   The Contents of this file are made available subject to the terms of
+#   either of the following licenses
+#
+#          - GNU Lesser General Public License Version 2.1
+#          - Sun Industry Standards Source License Version 1.1
+#
+#   Sun Microsystems Inc., October, 2000
+#
+#   GNU Lesser General Public License Version 2.1
+#   =============================================
+#   Copyright 2000 by Sun Microsystems, Inc.
+#   901 San Antonio Road, Palo Alto, CA 94303, USA
+#
+#   This library is free software; you can redistribute it and/or
+#   modify it under the terms of the GNU Lesser General Public
+#   License version 2.1, as published by the Free Software Foundation.
+#
+#   This library is distributed in the hope that it will be useful,
+#   but WITHOUT ANY WARRANTY; without even the implied warranty of
+#   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+#   Lesser General Public License for more details.
+#
+#   You should have received a copy of the GNU Lesser General Public
+#   License along with this library; if not, write to the Free Software
+#   Foundation, Inc., 59 Temple Place, Suite 330, Boston,
+#   MA  02111-1307  USA
+#
+#
+#   Sun Industry Standards Source License Version 1.1
+#   =================================================
+#   The contents of this file are subject to the Sun Industry Standards
+#   Source License Version 1.1 (the "License"); You may not use this file
+#   except in compliance with the License. You may obtain a copy of the
+#   License at http://www.openoffice.org/license.html.
+#
+#   Software provided under this License is provided on an "AS IS" basis,
+#   WITHOUT WARRUNTY OF ANY KIND, EITHER EXPRESS OR IMPLIED, INCLUDING,
+#   WITHOUT LIMITATION, WARRUNTIES THAT THE SOFTWARE IS FREE OF DEFECTS,
+#   MERCHANTABLE, FIT FOR A PARTICULAR PURPOSE, OR NON-INFRINGING.
+#   See the License for the specific provisions governing your rights and
+#   obligations concerning the Software.
+#
+#   The Initial Developer of the Original Code is: Sun Microsystems, Inc..
+#
+#   Copyright: 2000 by Sun Microsystems, Inc.
+#
+#   All Rights Reserved.
+#
+#   Contributor(s): _______________________________________
+#
+#
+#
+#*************************************************************************
 
-#*****************************************************************************
-# 
-#  gengal - wrapper for gengal.bin
-#  gengal.bin - utility to generare or update galleries usable with OpenOffice.org
-# 
-#  Initial version by: Petr Mladek <pmladek@suse.cz>
-#
-#  This program is free software; you can redistribute it and/or modify
-#  it under the terms of the GNU General Public License version 2, as
-#  published by the Free Software Foundation.
-# 
-#  This program is distributed in the hope that it will be useful,
-#  but WITHOUT ANY WARRANTY; without even the implied warranty of
-#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-#  GNU General Public License for more details.
-# 
-#  You should have received a copy of the GNU General Public License
-#  along with this program; if not, write to the Free Software
-#  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
-# 
-#*****************************************************************************
-
-# default setting
-GAL_NAME=
-GAL_PATH=
-GAL_DESTDIR=
-GAL_NUM=1
-GAL_FORCE=false
-
-# suffixes of gallery-related files
-GAL_SUFFIXES=".sdg .sdv .thm"
-
-usage()
-{
-    echo -e "Utility to generare or update galleries usable with OpenOffice.org"
-    echo -e
-    echo -e "Usage: ${0##*/} --name name --path path [--num number] [--force] file..."
-    echo -e 
-    echo -e "Options:"
-    echo -e "\t--name name:  defines a name of the gallery that will be shown in OOo."
-    echo -e "\t--path path:  defines a path where the actual version of the gallery is"
-    echo -e "\t\t      located and where to put the new version."
-    echo -e "\t--num number: defines number of the gallery. It is 1 by default."
-    echo -e "\t--force:      only a gallery with the same name can be updated. This"
-    echo -e "\t\t      option forces to replace the old uncompatible gallery with"
-    echo -e "\t\t      the new one."
-    echo -e "\tfile...:      list of file that have to be added to the gallery."
-    echo -e "\t\t      Absolute paths are required."
-}
-
-clean_and_exit()
-{
-    test "z$GAL_TMP" != "z" -a -d $GAL_TMP && rm -rf $GAL_TMP
-    exit 1;
-}
-
-
-while test "${1#--}" != "$1" ; do
-    case "$1" in
-	"--help") usage
-		exit 0;
-		;;
-	"--name")
-		shift
-		GAL_NAME="$1"
-		;;
-	"--path")
-		shift;
-		GAL_PATH="$1"
-		if test "z${GAL_PATH##/*}" != "z" ; then
-		    echo "Error: --path option requires an absolute path as the parameter"
-		    exit 1;
-		fi
-		;;
-	"--destdir")
-		shift;
-		GAL_DESTDIR="$1"
-		;;
-	"--num")
-		shift;
-		GAL_NUM="$1"
-		if test "z${GAL_NUM#*[!0-9]}" != "z$GAL_NUM" ; then
-		    echo "Error: --num option requires a number as the parameter"
-		    exit 1;
-		fi
-		;;
-	"--force")
-		GAL_FORCE=true
-		;;
-	*)
-		echo "Error: unknown option \"$1\", try --help"
-		exit 1;
-		;;
-    esac
-    shift;
-done
-
-
-# checks for required options
-
-if test "z$GAL_NAME" = "z" ; then
-    echo "Error: --name is required option"
-    exit 1;
+# enable file locking
+SAL_ENABLE_FILE_LOCKING=1
+export SAL_ENABLE_FILE_LOCKING
+
+# resolve installation directory
+sd_cwd="`pwd`"
+if [ -h "$0" ] ; then
+	sd_basename=`basename "$0"`
+ 	sd_script=`ls -l "$0" | sed "s/.*${sd_basename} -> //g"` 
+    cd "`dirname "$0"`"
+    cd "`dirname "$sd_script"`"
+else
+    cd "`dirname "$0"`"
 fi
 
-if test "z$GAL_PATH" = "z" ; then
-    echo "Error: --path is required option"
-    exit 1;
+sd_prog="`pwd`"
+
+cd ..
+sd_binary=`basename "$0"`".bin"
+sd_inst="`pwd`"
+
+# change back directory
+cd "$sd_cwd"
+
+# check if all required patches are installed
+if [ -x "$sd_prog/sopatchlevel.sh" ]; then
+    "$sd_prog/sopatchlevel.sh"
+    if [ $? -eq 1 ]; then
+        exit 0
+    fi
 fi
 
-# checks for absolute paths
-for file in "$@" ; do
-    if test "z${file##/*}" != "z" ; then
-	echo "Error: Abosolute file names are required, such that \"$file\" is not a valid parameter."
-	exit 1;
+# set search path for shared libraries
+sd_platform=`uname -s`
+case $sd_platform in
+  AIX)
+    LIBPATH="$sd_prog":$LIBPATH
+    export LIBPATH
+    ;;
+
+  Darwin)
+    DYLD_LIBRARY_PATH="$sd_prog":$DYLD_LIBRARY_PATH
+    export DYLD_LIBRARY_PATH
+    ;;
+
+  HP-UX)
+    SHLIB_PATH="$sd_prog":/usr/openwin/lib:$SHLIB_PATH
+    export SHLIB_PATH
+    ;;
+
+  IRIX*)
+    LD_LIBRARYN32_PATH=:"$sd_prog":$LD_LIBRARYN32_PATH
+    export LD_LIBRARYN32_PATH
+    ;;
+
+  *)
+    LD_LIBRARY_PATH="$sd_prog":$LD_LIBRARY_PATH
+    export LD_LIBRARY_PATH
+    ;;
+esac
+
+# extend the ld_library_path for java: javaldx checks the sofficerc for us
+if [ -x "$sd_prog/javaldx" ] ; then
+    java_ld_library_path=`"$sd_prog/javaldx"`
+    if [ "$java_ld_library_path" != "" ] ; then
+        case $sd_platform in
+            AIX)
+                LIBPATH=${java_ld_library_path}:${LIBPATH}
+                ;;
+            Darwin)
+                DYLD_LIBRARY_PATH=${java_ld_library_path}:${DYLD_LIBRARY_PATH}
+                ;;
+            HP-UX)
+                SHLIB_PATH=${java_ld_library_path}:${SHLIB_PATH}
+                ;;
+            IRIX*)
+                LD_LIBRARYN32_PATH=${java_ld_library_path}:${LD_LIBRARYN32_PATH}
+                ;;
+            *)
+                LD_LIBRARY_PATH=${java_ld_library_path}:${LD_LIBRARY_PATH}
+                ;;
+        esac
     fi
-done
+fi
 
-# temp dir
-GAL_TMP=`mktemp -d /tmp/gal-XXXXXXXX`
+# misc. environment variables
+OPENOFFICE_MOZILLA_FIVE_HOME="$sd_inst/program"
+export OPENOFFICE_MOZILLA_FIVE_HOME
 
-# move already existing version to temp dir
-gal_orig_exist=true
-for suffix in $GAL_SUFFIXES ; do
-    test -f $GAL_PATH/sg$GAL_NUM$suffix || gal_orig_exist=false
-done
-
-if $gal_orig_exist ; then
-    for suffix in $GAL_SUFFIXES ; do
-	cp $GAL_PATH/sg$GAL_NUM$suffix $GAL_TMP/sg1$suffix || clean_and_exit;
-    done
-fi
+unset XENVIRONMENT
 
-# create/update gallery
-"$0.bin" --name "$GAL_NAME" --path $GAL_TMP --destdir "$GAL_DESTDIR" "$@" || clean_and_exit;
+# uncomment line below to disable anti aliasing of fonts
+# SAL_ANTIALIAS_DISABLE=true; export SAL_ANTIALIAS_DISABLE
 
-# if $GAL_TMP/sd2.sdg exists, it means that the older gallery cannot be updated
-# (used another name), so a new one was created instead
-GAL_CURRENT=sg1
-if test -f $GAL_TMP/sg2.sdg ; then
-    if "$GAL_FORCE" ; then
-	# remove the older gallery, if will replaced
-	for suffix in $GAL_SUFFIXES ; do
-	    rm $GAL_TMP/$GAL_CURRENT$suffix || clean_and_exit;
-	done
-	GAL_CURRENT=sg2
-    else
-	echo "Error: The gallery \"sg$GAL_NUM\" already exists with another name."
-	echo "       Use --foce to replace it."
-	clean_and_exit
-    fi
-fi
+# set path so that other apps can be started just by name
+PATH="$sd_prog":$PATH
+export PATH
 
-# move the greated gallery from 
-for suffix in $GAL_SUFFIXES ; do
-    mv -f $GAL_TMP/$GAL_CURRENT$suffix $GAL_PATH/sg$GAL_NUM$suffix || clean_and_exit
-done
-rmdir $GAL_TMP
+# execute binary
+exec "$sd_prog/$sd_binary" "$@"
