Index: desktop/source/app/officeipcthread.cxx
===================================================================
RCS file: /cvs/framework/desktop/source/app/officeipcthread.cxx,v
retrieving revision 1.50
diff -u -p -u -r1.50 officeipcthread.cxx
--- desktop/source/app/officeipcthread.cxx	19 Oct 2005 12:20:26 -0000	1.50
+++ desktop/source/app/officeipcthread.cxx	6 Jan 2006 13:09:01 -0000
@@ -54,9 +54,12 @@
 #ifndef _UTL_CONFIGMGR_HXX_
 #include <unotools/configmgr.hxx>
 #endif
-#ifndef _THREAD_HXX_
+#ifndef _OSL_THREAD_HXX_
 #include <osl/thread.hxx>
 #endif
+#ifndef _OSL_FILE_HXX_
+#include <osl/file.hxx>
+#endif
 #ifndef _RTL_DIGEST_H_
 #include <rtl/digest.h>
 #endif
@@ -361,7 +364,36 @@ OfficeIPCThread::Status OfficeIPCThread:
 		aUserInstallPathHashCode = OUString( szBuffer, strlen(szBuffer), osl_getThreadTextEncoding() );
     }
 	else
+	{
+#ifdef UNX			
+		// Since we mangle the UID in anyway, the home path adds nothing
+		// but the need to parse bootstraprc => use sys install path instead.
+		rtl::OUString aPath;
+		aInfo.getExecutableFile( aPath );
+		lastIndex = aPath.lastIndexOf('/');
+		if ( lastIndex > 0 )
+			aPath = aPath.copy( 0, lastIndex+1 );
+
+		osl::File::getSystemPathFromFileURL( aPath, aUserInstallPathHashCode);
+
+		/* Quick and simple to replicate hash */
+		sal_uInt32 nHash = 0;
+		if (aUserInstallPathHashCode.getLength() > 0)
+		{
+			rtl::OString aUTF8 = rtl::OUStringToOString( aUserInstallPathHashCode,
+														 RTL_TEXTENCODING_UTF8 );
+			const sal_Char *pStr = aUTF8;
+			nHash = *pStr;
+			for (sal_Int32 i = 1; i < aUTF8.getLength(); i++)
+				nHash = (nHash << 5) - nHash + pStr[i];
+		}
+		sal_Char szBuffer[128];
+		sprintf( szBuffer, "%d-%x", SUPD, nHash );
+		aUserInstallPathHashCode = OUString( szBuffer, strlen(szBuffer), osl_getThreadTextEncoding() );
+#else
 		aUserInstallPathHashCode = CreateMD5FromString( aDummy );
+#endif
+	}
 	
 
 	// Check result to create a hash code from the user install path
